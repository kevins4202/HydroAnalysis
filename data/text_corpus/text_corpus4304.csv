index,text
21520,fan wings as a form of aircraft propulsion have shown effectiveness for underwater propulsion the underwater fan wing thruster uft which is composed of a fixed wing and a cross flow fan under the fixed wing can generate significate vertical force underwater although some experiments and simulations are carried out to analyze the uft the role of the fixed wing to the uft has not been researched in depth in this paper four parameters the front opening angle rear opening angle upper horizontal length and incoming flow angle are selected for the role study in four aspects including vertical force thrust force torque and efficiency computational fluid dynamics cfd simulations in different rotational speeds of the cross flow fan and incoming flow velocities conditions are carried out for the ufts with different parameters which concurred with towing experiments self driving experiments are also carried out for studying the actual cruise performance of the uft with different parameters after that mechanisms of the effects are analyzed on many velocity magnitude cloud maps from cfd simulation a physical model is utilized to explain some of the unique fluid phenomena finally the role of the fixed wing is summarized and some principle on parameter setting is proposed keywords underwater fan wing thruster fixed wing computational fluid dynamics self driving experiment towing experiment 1 introduction an wing and fan wing aircrafts fashioned a wave of global research after 1998 when the british inventor peebles achieved the first flying test of a fan wing aircraft meng et al 2015 numerous groups and companies such as kogler s group from imperial college london fan wing company from the uk and propulsive wing llc from the usa gradually joined the study meng et al 2015 these researches focus on how to optimize the shape of fan wings and structure of fan wing aircrafts improve the load and maneuverability performance of fan wing aircrafts wind tunnel tests computer fluid dynamics cfd simulations and flight tests of aircrafts are used in these researches benferhat et al 2019 seyfang 2012 xiangnan 2015 meng and ye 2016 sun et al 2015 yamafuji 1975 duddempudi yaoet al 2007 shojaeefard and askari 2012 askari and shojaeefard 2009 ahad and graham 2007 du and tang 2018 du et al 2016 the fan wing aircrafts are proved to have a better load performance and a shorter takeoff and landing distance than fix wing aircrafts and higher speeds than rotorcrafts the underwater fan wing thruster uft is another propulsion system based on the fan wing the uft is effective in thrust and vertical force underwater generation different from the fan wing on the fan wing aircraft the cross flow fan is installed under the fixed wing in order to generate a striking downward vertical force according to our previous work in 2018 a uft model was demonstrated underwater and the effectiveness of underwater running was proved gao and lin 2018a after that a fan wing underwater vehicle fuv which is a remotely operated underwater vehicle driven by two ufts was also designed and tested underwater as shown in fig 1 gao and lin 2018b 2019 the fuv can achieve 5 dof movements with only two moving parts and the vertical force on the fuv is excellent enough to replace an overall buoyancy regulation system in order to find out the hydrodynamic mechanism of the uft we also studied a model of the uft by experiment cfd simulation and physical model analyses gao et al 2020 a particular designed experiment device which is applicable for both self driving and towing underwater experiments was used for experiments for the uft a unique physical model was also built for analyzing the mechanism the uft has different thrust force tf and vertical force vf with different rotational speeds of the cross flow fan and different incoming flow velocities the uft is also found out to have its maximum efficiency point with different incoming flow velocities in previous works about optimizing or analyzing the fan wing fan wing aircrafts uft and fuv only some typical fan wing shapes and structures are selected for example yufeng yao s group mainly analyzed the effect of the housing exit high duddempudi yaoet al 2007 and s askari s group mainly analyzed the effect of the open sides and six typical shapes of the fixed wing shojaeefard and askari 2012 askari and shojaeefard 2009 these results make sense but they are too specific to abstract the rules for working out the influence of each part of the fan wing on the whole fan wing besides previous works about the fan wing used on an aircraft are abundant but the shape optimizing and analyzing of the uft which works in the underwater condition of lower rotational speed and incoming flow velocity is seldom carried out in this work the role of the fixed wing to the uft is studied the influence of fixed wing on uft is basically abstracted into three independent parameters and one associated parameter these four parameters are separately studied by changing only one parameter four characters which are vf tf torque and efficiency are used to evaluate the effect of the parameters all the studies are based on experiments and cfd simulations similar to our previous work and flow cloud maps and physical models are also used to analyze the mechanism finally based on the reorganization of the parameter role ways to design and optimize the uft are put forward for different operation conditions the main contributions of this paper can be summarized as follows i four parameters of the fixed wing in the uft are selected ii the effects and mechanisms of the parameters on the hydrodynamic performance of the uft are worked out iii the effects of the fixed wing to the uft are summarized iv selection methods of the parameters according to the actual working state of the uft are proposed in this paper the abstracted parameters experiment and simulation methods and the physical model are firstly expounded then the four parameters are separately studied finally some ways to optimize the uft for different conditions are discussed 2 methods of studies 2 1 abstraction of parameters the fixed wing is one of the essential parts of a uft the fixed wing partially shades the cross flow fan and guides the wake to some extent relative sizes of the fixed wing may determine the hydrodynamic performance of a uft according to the function of fixed wing we can simplify its interaction with the cross flow fan as the main parameters as shown in fig 2 at different rotational speeds n of the cross flow fan and different incoming flow velocities v the parameters including front opening angle foa α rear opening angle roa β upper horizontal length uhl l 1 of the fix wing and incoming flow angle ifa θ are the main parameters based on previous relative works gao et al 2020 the incoming flow should go across the cross flow fan and outflow along the lower surface of the fixed wing thus the influence of fixed wing on the cross flow fan can be divided into three stages i the fixed wing affects the access of incoming flow ii the fixed wing influences the outflow from the cross flow fan iii the fixed wing guides the wake the foa can be used to quantize the first stage since it can characterize the degree to which the fixed wing shades the front of the cross flow fan relative to the entire circumference the roa can be used to estimate the influence of the second stage because it can characterize the degree to which the fixed wing shades the rear of the cross flow fan relative to the entire circumference the uhl can be used to measure the third effect as it directly affects the tilt angle of the lower surface of the fixed wing without affecting the upper surface to be horizontal in addition ifa can affect the above three independent parameters at the same time studying the ifa is essential to work out the relation of the roles of three independent parameters 2 2 experiment methods the effects of the parameters can be studied by experiments the experiment device is used in our previous work and is proved to be effective for self driving and towing experiments of ufts gao et al 2020 as shown in fig 3 the experiment device is composed of a slidable platform and a stable base the slidable platform can slide along the parallel rails on the stable base driven by the timing belt or the thrust force on the uft model when the slidable platform is driven by the timing belt which is a towing experiment the vf on the uft model in some given conditions can be measured when the slidable platform is driven by the tf on the uft model which is a self driving experiment vf in a real running condition of the fuv can be measured all the vfs are measured by a force sensor in the middle of the slidable platform the maximum range of the force sensor is 200 n with 1 20 n error besides the rotational speed of the cross flow fan and the sliding speeds can also be measured by this device the variety of the parameters can be achieved by alternating the fixed wing of the uft in each experiment the fixed wing in the uft model is made of polylactic acid pla which can be easily and quickly shaped by three dimension printing for the three independent parameters including foa roa and uhl three different models in different shapes are tested for the ifa five different attitudes of the model are tested the increase in the number of ifa experiment cases is due to the fact that ifa can be positive or negative for each uft model towing experiments and self driving experiments are carried out vfs on the uft rotational speeds of the cross flow fan and sliding or self driving speeds are measured in all of the cases similar to the previous work gao et al 2020 the vf data is filtered and the average value of the data is used to represent the real vf 2 3 cfd simulation methods as a complement to the experiments the computational fluid dynamics cfd simulations are also carried out for analyzing the impacts of the parameters fig 4 indicates a group of mesh generated for a uft with α 30 β 30 l 1 100 m m θ 0 all the groups of mesh used in cfd simulations have the same total size with the same ways of flow field encryption the mesh is separated into two domains including a static domain and a rotational domain for simulating rotation of the cross flow fan the cross section size of the total mesh and encrypted mesh is shown in fig 4 boundary layers are also added for enhancing the accuracy in simulating near wall turbulence since vortices of different scales need to be simulated simultaneously the turbulence model is set to the detached eddy simulation des in the cfd simulations finite volumes method is used for space discretization implicit instability with a time step of 1 667 10 4 s is used for time integration the left boundary is set to be a velocity inlet and the right boundary is set to be a pressure outlet with 0 0 relative pressures the temperature is set to 300 k the reference pressure is set to 1 013 10 5 p a the medium is set to the water with a density of 997 561 k g m 3 and a dynamic viscosity coefficient of 8 8871 10 4 p a s the simulation conditions are consistent with the experimental conditions all of the calculations are carried out by the commercial software star ccm 12 06 the tf vf torque with different parameter values and conditions can be solved out by the cfd simulations in addition some cloud maps can also be simulated these cloud maps reflect more detailed information about the flow field which is meaningful for studying mechanism of the effects 2 4 physical model methods a physical model is also necessary to study the parameters as shown in fig 2 the flow field can be separated into five successive zones names zone a b c d e gao et al 2020 each zone has its unique kinematic and dynamic boundary conditions which are directly related to the parameters by simplifying each of the zones into ideal fluid elements the effects of the parameters can be finely discussed according to our previous work gao et al 2020 there are two assumptions for the physical model i the influence of blade shape is ignored so all of the fluid elements in the normal direction have the same kinematic and dynamic characteristics ii the zone interface is considered to be a sudden change in the flow field besides efficiency is also considered as defined in eq 1 1 η f vf p f tf v f vf t n 9 55 f tf v where η is the efficiency f v f is the value of vf f v f on the uft t is the value of torque t of the cross flow fan n is the value of the rotational speed n of the cross flow fan f t f is the value of tf f t f on the uft and v is the magnitude of the incoming flow velocity v these symbols are indicated in fig 2 3 effects of the front opening angle foa the front opening angle foa is the opening angle of the fixed wing front end relative to the cross flow fan the foa directly affects the reaction of the incoming flow and cross flow fan in order to maintain the streamlined shape of the fixed wing the range in discussing for the foa is set to 5 60 if the foa is smaller than 5 the stagnation point would be formed on the fixed wing and if the foa is more significant than 60 the effect of flow guide on the upper surface of fixed wing would be rapidly weakened the foa in an appropriate setting can be studied by experiments cfd simulations and physical model studies moreover the effects of the rotational speed of the cross flow fan and incoming flow velocity at different foa should be separately discussed since the role of foa may vary in different actual conditions 3 1 foa and rotational speeds fig 5 a h show cfd simulation result curves of performances including vertical force f v f thrust force f t f torque t and efficiency η with different foa different rotational speeds and constant velocities fig 5 a and b indicate the curves about the vertical force f v f generally with an increase in rotational speed the vf increases and a larger foa causes a tremendous vf however in the conditions of 0 5 knots velocity and high 800 rpm rotational speed the vf on the uft model with large foa α 45 α 60 sharply decreases therefore the enlarge of foa promotes the increase of vf but still have risks of the disappearance of vf in conditions of high rotational speed and small velocity fig 5 c and d indicate two curves about the thrust force f t f similar to the curves about the f v f an increase of rotational speed and foa is a benefit to an increase of tf in high rotational speed and small velocity conditions the enlarge of foa can lead to a significant margin increase of tf fig 5 e and f illustrate the results of torque t with an increase of rotational speed and foa the torque increases the condition of high rotational speed and small velocity is also a unique condition where the model with large foa needs exceptionally high torque fig 5 g and h show the curves of efficiency η all the efficiencies decrease with the growth of rotational speed the model with foa equal to 15 has the highest efficiency in almost all the conditions especially in the condition of low rotational speed although the vf of the ufts with high foa is excellent these models are inefficient as a brief summary higher foa is suitable for the improvement of vf and tf but that is at the cost of considerable torque consumption and inefficient the uft with foa equal to 15 has the highest efficiency the uft with high foa also has the risk of vf going down in the conditions of high rotational speed and low velocity 3 2 foa and velocities fig 5 i p indicate some cfd simulation curves results with different foas different velocities and constant rotational speed the four performances are also discussed fig 5 i and g illustrate two groups of vf curves with different velocities the uft with higher foa can generate greater vf in all the conditions with different velocity however the extent of this impact decrease with the growth of foa when the rotational speed is low as shown in fig 4 i fig 5 k and l show the results of tfs all the ufts has a similar tendency which is going up first and then going down with an increase of velocity ufts with higher foa also has a greater tf fig 5 m and n reveal the curves about torque the uft with larger foa consumes higher torque which is the same in all the conditions with different velocities fig 5 o and p indicate the curve results of efficiency with different velocities when the foa is equal to 15 the efficiency is almost maximum the ufts with high foa also has the lowest efficiency as a summary the increase in velocity has almost the same effects on the increase of rotational speed vf and tf are great when the foa is large but torque consumption and efficiency are worse the uft with foa equal to 15 has the highest efficiency in almost all the conditions 3 3 experiment comparison and self driving results towing and self driving experiments are also carried out to the models with different foas the range of foa in the test is set to 15 30 45 the towing experiment results can be used to compare with the cfd simulation results in order to verify the reliability of simulation ones table 1 shows some typical towing experiments and cfd simulation results the error between these two ways of study is almost limited within 10 so the cfd simulation results are trustful self driving experiment results indicate the actual operating performance of a uft fig 6 illustrates the self driving experiment results with different foas and rotational speeds as shown in fig 6 a at the same rotational speed the uft with different foa has a similar vf in self driving however the uft with a larger foa has a higher velocity at the same rotational speed as shown in fig 6 b that is to say the enlarge of foa can accelerate the uft to a higher speed without changing the vf since a higher speed leads to higher resistance and a higher resistance need to offset by a greater tf the tf can be independently increased by setting a larger foa this phenomenon can also be explained by the cfd simulation results the self driving experiments are in low velocity and a high rotational speed condition in this condition the tf is more sensitive than the vf comparing fig 5 i and k besides the sensitivity of vf is much higher when the rotational speed changes than when the velocity changes in this condition comparing fig 5 b and j thus with an enlarge of foa the tf can be markedly improved and the vf still remains 3 4 velocity magnitude cloud map analyses although final performance results can be obtained by cfd simulations and experiments the causes of the performance with different foa cannot be easily analyzed only basing on the final data some velocity cloud maps generated by cfd simulations are considered as the cfd simulation is verified by towing experiments the cloud maps with different foas trustful as well fig 7 illustrates some of the cloud maps in three typical conditions i the condition of v 0 5 k n n 1000 r p m which is a typical condition with a low velocity and a high rotational speed ii the condition of v 2 k n n 750 r p m which is a steady condition with a moderate velocity and rotational speed iii the condition of v 4 k n n 500 r p m which is a condition with a high velocity and a low rotational speed based on fig 7 a e as the enlarge of foa the flow around the uft tends to unsteady in the first condition when α 5 almost all the fluid can flow backward along the lower surface of the fixed wing however when α 45 or α 60 the fluid in front of the cross flow fan tends to move downward and the wake tends to unsteady this phenomenon can be used to explain the vf disappearance previously discussed since the backward fluid turns to move downward the vf which is generated by the retroaction of the flow sharply turns to negative based on fig 7 f j as the enlarge of foa the flow around the uft remains steady in the second condition some eccentric vortexes meng and ye 2016 sun et al 2015 yamafuji 1975 duddempudi yaoet al 2007 shojaeefard and askari 2012 are generated by internal cross flow fan the shape of the eccentric vortex tends to be an ellipse and the size tends to be smaller the eccentric vortexes are generated only under the part that can be surrounded by the fixed wing based on fig 7 k o as the enlarge of foa the flow around the uft tends to as steady as the second condition in the third condition when the foa is small there is a low speed triangle region lstr the lstr is increasingly split by a wake flow with an enlarge of foa and the separated lstr gradually merges into the surrounding fluid the increase of vertical and tf as an enlarge of foa can be explained that the lstr tends to be split means that the wake flow tends to be enhanced the ability of fluid acceleration is improved with an enlarging of foa thus tf and vf are increased 3 5 physical model analyses the physical model can also be used to analyze the role of foa enlarge since the foa is set within 5 60 only a quarter of the cross flow fan is mainly influenced as circled in fig 8 the motion variety of fluid elements in the considered quarter should represent the effects of foa in zone a the velocity of a fluid element can be decomposed into a normal velocity v a n and a tangential velocity v a t since the fluid in zone a is covered by the fixed wing the normal velocity can be ignored if a fluid element moves from the start to the interface the velocity in the direction of x and y can be expressed as eq 2 where v a x is the value of x direction velocity in zone a v a y is the value of y direction velocity in zone a α 1 is the angle between v a n and x direction t is the time consumed related to the start time t 0 when the fluid element moves to zone b the boundary condition of the fluid element is changed and the velocity in the direction of x and y can be rewritten as eq 3 3 v b x v b n cos α 1 v b t sin α 1 v v b n cos π 2 2 π n t v b t sin π 2 2 π n t v v b y v b t cos α 1 v b n sin α 1 v b t cos π 2 2 π n t v b n sin π 2 2 π n t where v b x is the value of x direction velocity in zone b v b y is the value of y direction velocity in zone b v b n is the value of standard velocity component in zone b and v b t is the value of the tangential velocity component in zone b during the movement from the start to the end the average force in x and y direction can be expressed by total work per total length as indicated in eq 4 4 f x 1 0 r d l 0 r cos α m d v a x d t d l r cos α r m d v b x d t d l f y 1 0 r d l r sin α r m d v a y d t d l 0 r sin α m d v b y d t d l where f x is the average force to the fluid element in x direction f y is the average force to the fluid element in y direction and r is the radius distance of the fluid element relative to the axis of the cross flow fan m is the mess of the fluid element if v b t v a t v t eq 4 can be solved as expressed in eq 5 the derivative of force with respect to α can also be found as shown in eq 6 5 f x 2 π m n v t π 4 v bn v bn 1 4 sin 2 α α 2 f y 2 π m n v t v bn 1 4 sin 2 α α 2 6 d f x d α π m n v bn 1 cos 2 α 0 d f y d α π m n v bn 1 cos 2 α 0 since d f x dα and d f y dα stay non negative the f x and f y increase with an enlarge of α therefore the vf and tf on the uft tend to increase with the enlarge of foa besides the increase in torque can also be explained in the region where the quarter considered and the zone b intersect the angle between v and v b t is more significant than 90 thus the incoming flow hinders the rotation of the cross flow fan in this region with the enlarge of foa the hindered region expands so the torque increases 4 effects of the rear opening angle roa rear opening angle roa is the opening angle of the fixed wing middle section relative to the right side of the cross flow fan a variety of roa impacts the outflow from the cross flow fan the range of roa can be set to 5 45 considering the angle of the outflow if the roa is smaller than 5 the flow in zone c can be stopped on a large scale if the roa is larger than 45 the diversion effect of the fixed wing may evolve into a hindrance some ufts with different roas are also tested by towing and self driving cfd simulation and physical model also works when analyzing the role of roa 4 1 roa and rotational speeds fig 9 a h indicate parts of cfd simulation result curves of four different performances with different roa different rotational speeds and a constant velocity fig 9 a and b indicate the curves about the vertical force f v f when the velocity is small in value and the roa is a small angle the effect of the roa on the vf is negligible however in the condition of high rotational speed n 1250 r p m with low velocity v 0 5 k n the vf on the uft with a large roa β 45 plummets to a negative value in the condition of higher velocity v 1 k n the advantage of small roa β 5 15 in generating vf outstands notably the uft with a 5 roa generates the maximum vf when the rotational speed is high n 1000 r p m a n d n 1250 r p m fig 9 c and d illustrate some curves about the tf generally the uft with a large roa can generate a greater tf especially when the rotational speed is high n 1250 r p m and the velocity is low v 0 5 k n in the condition of higher velocity v 1 k n with an increase of rotating speed the tf on the uft with a small roa increases faster than that with a large roa fig 9 e and f show the results of torque at different roas an increase of the roa can notably increase the torque consumed however the uft with a 5 roa needs the weakest torque fig 9 g and h indicate curves of the efficiency as the increase of roa the efficiency gradually decreases and the uft with a 5 roa also has the best efficiency as a brief summary the uft with a 5 roa has the best performance to generate vf with the least torque consumption and the best efficiency on the other hand a larger roa is helpful to enhance the tf performance but the enhancement is inefficient 4 2 roa and velocities fig 9 i p reveal the cfd simulation curves results with different roas different velocities and constant rotational speed the four performances are also studied fig 9 i and g show two groups of curves of vf the uft with a 5 roa also performed well with a growth of velocity while the enhancement of vf is not significant fig 9 k and l illustrate curves of the tf performance in the condition of low velocity v 2 k n the uft with a large roa has a better performance on tf generation which is similar to the results at a constant velocity however when the velocity is higher the uft with a 5 roa turns to be the best model on tf in the condition of higher rotational speed n 1250 r p m the advantage to generating tf is also enhanced fig 9 m and n show groups of curves about torque the uft with a large foa still consumes more torque while the 5 and 5 roa uft consumes the least fig 9 o and p indicate curves of efficiency all the curves have a similar tendency which is a sharp increase and then a gradual decrease the 5 roa uft still performs the best as a summary the 5 roa uft has the best performance on all the four aspects and the uft with a large roa has an advantage only in generating tf at a low velocity 4 3 experiment comparison and self driving results towing and self driving experiments are also carried out to the models with different roas the range of roa in the test is set to 5 15 30 table 2 shows some vf results by towing experiments the results are compared with the cfd simulations ones and the error is acceptable the self driving experiment results with different roas are indicated in fig 10 generally the uft with higher rotational speed can generate a higher vf and the velocity can be improved as well this character can be explained by the cfd simulation results with an enlarge of roa the tf on the uft increase faster than the vf therefore in the self driving condition the uft with a large roa can move with a higher velocity and a higher vf caused by the velocity increase happens besides the vf on the uft with a large roa may sharply decrease when the rotational speed is high as shown in fig 10 a similarly as shown in fig 9 a the vf may sharply decrease in the condition of high rotational speed and low velocity these two phenomena are mutually validated 4 4 velocity magnitude cloud map analyses fig 11 indicates 15 velocity magnitude cloud maps with different roas the role of roa can be studied by these maps fig 11 a e show the maps with different roas in the condition of low velocity v 0 5 k n and a high rotational speed n 1000 r p m with an enlarge of roa the fluid tends to unsteady and the eccentric vortex tends to disappear the outflow from the cross flow fan spreads around rather than goes back along the fixed wing this phenomenon can be used to explain the vf sharp decrease the vf is mainly caused by the backward flow out of the cross flow fan with an enlarge of roa the backward flow spreads around so the vf sharply decreased fig 11 f j illustrate the maps with different roas in the condition of moderate rotational speed and velocity n 750 r p m v 2 k n all the uft models are steadily work in this condition and all the eccentric vortexes have a similar position and shape as the enlarge of roa there is an accumulation vortex generated under the middle of fixed wing as marked in fig 11 i and j fig 11 k o reveal the maps with different roas in the condition of high velocity v 4 k n and a low rotational speed n 500 r p m same to the maps in the moderate condition all the maps are similar and all the eccentric vortexes are in a similar state however compared to fig 11 i and n or fig 11 j and o the size of accumulation vortex tends to be enlarged the formation and generation of the accumulation vortex may impact on uft performance 4 5 physical model analyses according to the previous discussions two phenomena remain to be explained i the 5 roa uft has the best performance ii the formation and generation of the accumulation vortex these phenomena may be explained by the physical model analyses fig 12 illustrates the fluid element motion in two conditions with different roas in zone c the resultant velocity v c of the fluid element can be decomposed into a normal velocity v c n and a tangential velocity v c t and the angle between v c and v c n can be defined as ξ the angle between a tangential velocity v c n or v a n and x direction can be defined as β 1 and the angle between a resultant velocity v c or v a and x direction can be defined as β 2 what s more γ is used to stand for the angle between the fixed wing lower surface and the x direction the relations of the angle can be expressed as eq 7 7 β 2 ξ β 1 β 1 90 min β β 3 ξ β 1 ε β 1 min β β 3 β 90 β 1 β 1 β 90 where β 3 is the critical angle at which the boundary condition of the zone c changes ε is the corrective coefficient for the boundary condition variety the left inlet boundary condition in zone c relies on the outlet boundary condition of zone d and the outlet boundary condition of zone d can be classified as an eccentric vortex boundary condition and an outflow boundary condition the critical angle β 3 is used to distinguish the variety of the boundary condition when β 1 β 3 the left inlet boundary condition can be approximated as an inflow when β 1 β 3 the left boundary condition can be approximated as a weaker inflow since some of the fluid starts to around the eccentric vortex in the condition of β 1 β 3 the inflow from the zone d outflow along the tangential direction of a blade end after acceleration and turning in zone c so ξ should be equal to the 60 which is the tangential direction angle of a blade in the condition of β 1 β 3 the value of v c n may decrease because of the continuity of fluid and the corrective coefficient ε is used to stand for the increase of β 2 cause by the v c n decrease in zone a the v a n is far less than the v a t because of a shelter of fixed wing therefore the β 2 can be expressed as eq 7 the relation of β and β 3 determines the performance of uft and the relation can be discussed as follows i β β 3 the inflow from zone d may be stopped by the fixed wing and the mass flow may be reduced ii β β 3 all of the inflow from zone d can outflow from the right side of zone c iii β β 3 although all of the inflow from zone d can outflow from the right side of zone c the position where the fluid direction changed is moved to the lower plane of the fixed wing in the condition of β β 3 the outflow rate is low where β 1 β β 3 in zone c the outflow from the side where β 1 β 3 may continually flow to the fixed wing and finally arrives at the lower plane of the fixed wing between the position of arrival and the turning point of the fixed wing the fluid is accumulated the accumulated fluid gradually forms a vortex which is the accumulation vortex under viscous shear caused by the outflow as shown in fig 12 b the angle between the outflow and lower plane of the fixed wing is enlarged because γ decreases as β increases so the viscous shear loss increases as β increases indeed the 5 roa uft has the best performance is because of the β 3 5 according to fig 11 f o in this condition the uft has the most significant outflow and the lest shear loss by the accumulation vortex 5 effects of the upper horizontal length uhl upper horizontal length uhl is the horizontal length of the fixed wing upper surface in a cross section a variety of uhl affects the guidance of flow on the lower surface of the fixed wing and influences the synthesis of flow on the upper and lower surfaces of the fixed wing the range of uhl can be set to 50 m m 150 m m to compare with that the external diameter of the cross flow fan is 60 mm if the uhl is shorter than 50 mm the tail of the fixed wing tends to disappear if the uhl is longer than 150 mm the effect of uhl variety on fluid synthesis and guidance is not significant the role of uhl is also studied by cfd simulations experiments and physical model analyses 5 1 uhl and rotational speeds fig 13 a h indicate curves of cfd simulation result on four different performances with different uhl different rotational speeds and constant velocities fig 13 a and b show the curves about vf it is regular that the vf decreases with the extent of uhl and the 50 mm uhl uft has the best vf performance fig 13 c and d illustrate the curves about the tf with different uhls the uft with a uhl longer than 100 mm can generate tf of similar value however the 50 mm uhl uft nearly loss the function of tf generation fig 13 e and f reveal the results of torque with different uhls the uft with a100 mm uhl needs the least torque consumption particularly in high rotational speed conditions on the other hand the uft with a uhl longer or shorter than 100 mm consumes a similar torque fig 13 g and h indicate two groups of curves about efficiency when the rotational speed is small in value n 500 r p m the ufts with a short l 1 100 m m uhl has higher efficiency when the rotational speed is higher in value n 500 r p m the 100 mm uhl uft turns to be the most efficient basically the efficiency of the uft with a long uhl l 1 100 m m is small in value as a brief summary longer uhl can improve the performance of tf while shorter uhl can improve the function of vf generation the uhl with a moderate uhl has the least torque consumption and the best efficiency 5 2 uhl and velocities fig 13 i p show some cfd simulation curves results with different uhls different velocities and constant rotational speed the four performances are also discussed fig 13 i and j indicate the curves of vf it is regular that shorter uhl benefits the vf generation with the increase of velocity this superiority tends to be enhanced fig 13 k and l reveal the curves about tf the uhls with a longer uhl can generate a higher tf and the velocity range with a positive tf is also extended however the uhls with a short uhl l 1 50 m m loss the tf and has a significate high resistance fig 13 m and n illustrate the results of torque basically uhl impacts little 20 to the torque the uft with a short uhl needs only a little more torque fig 13 o and p show two groups of curves about efficiency when the velocity is small in value v 1 k n the uft with a short uhl is more efficient however when the velocity is large in value v 1 k n the uft with a 100 mm uhl has the best efficiency as a summary the extension of uhl is helpful to increase the tf but the increase is limited when the uhl is longer than 100 mm the reduction of uhl is effective in increasing the vf and affection is remarkable however tf on the 50 mm uft may totally be disappeared the 100 mm uhl uft is the most efficient 5 3 experiment comparison and self driving results some models with a uhl in the set of 50 mm 100 mm 150 mm are also tested by towing and self driving experiments the comparison of the towing experiment and cfd simulation results are shown in table 3 the error is also limited within 10 so the cfd simulation results are trustful the self driving experiment results are shown in fig 14 with a reduction of uhl the vf increases but the velocity decrease that is to say in the self driving condition the vf can be improved by a reduction of uhl even though the velocity decreases therefore the uhl reduction is an effective way to increase the vf independently fig 15 reveals some magnitude cloud maps with different uhls the influence of uhl variety can be studied by these maps fig 15 a e indicate the maps with different uhls in the condition of low velocity v 0 5 k n and a high rotational speed n 1000 r p m the variety of uhl has nearly no effects on the cross flow fan however because of the guidance of flow the uft with a long uhl can force the unsteady flow backward rather than spread thus the extension of uhl helps the uft to improve the tf without additional torque consumption fig 15 f j show the maps with different uhls in the condition of moderate rotational speed and velocity n 750 r p m v 2 k n the flow inside the cross flow fan also nearly the same but the wake is various when the uhl is short the wake goes along the lower surface of the fixed wing to the upward direction as the extension of uhl the lower surface of the fixed wing tends to be horizontal and the wake tends to go backward therefore the increase of vf is caused by the increase of flow in the upward direction and the increase of tf in caused by the increase of flow in the backward direction the direction of the lower surface of the fixed wing determines the direction of the resultant force fig 15 k o reveal the maps with different uhls in the condition of high velocity v 6 k n and a low rotational speed n 500 r p m as the velocity is much higher than the speed of wake the effects of the rotation of the cross flow fan tend to be weaker there is a trailing vortex behind the short uhl uft the trailing vortex is caused by the boundary layer separation and the boundary layer separation is caused by the obstruction of the cross flow fan to the incoming flow with an extension of uhl the trailing vortex tends to be weaker 5 4 physical model analyses according to the less variable torque curves in fig 13 e f m and n and magnitude cloud maps in fig 15 the uhl has only a little effect on the flow around the cross flow fan therefore when considering the effect of uhl on uft the flow field around the cross flow fan can be considered as approximately unaffected the effect of the cross flow fan can be approximated as turning incoming flow velocity v into a velocity v e along the lower surface of fixed wing and then the motion of the fluid elements just in zone e can be analyzed independently to study the role of uhl as shown in fig 16 since the effects of uhl on the tf vf and torque are clearly explained by velocity cloud map analyses only the reason for the formation and generation of the trailing vortex needs to be studied in the condition of moderate rotational speed and velocity the incoming flow can be accelerated by the cross flow fan so the outflow velocity v e satisfies the condition of v e c o s γ v the cross flow fan jets high velocity flow into the low velocity field in this condition some vortexes may be caused by the shear effect of the jet flow but the energy of these vortexes can be dissipated in the far field the length of uhl only affects the direction of v e and the vortex is not under its control in the condition of low rotational speed and high velocity the incoming flow cannot be accelerated by the cross flow fan or even is obstructed by the cross flow fan so the outflow velocity v e satisfies the condition of v e c o s γ v the uft is surrounded by a high velocity flow in this condition the shear effect may cause a trailing vortex behind the uft when two fluid elements a and b the location of a and b are shown in fig 16 are considered the vorticity ζ of a relative to b can be approximately expressed as eq 8 herbert 2019 if v e and v remain constant with an extension of uhl γ decreases so the vorticity ζ decreases therefore the extension of uhl is helpful in decreasing the vorticity of the trailing vortex 8 ζ v x y v y x v v e cos γ y 1 v e sin γ x 1 6 effects of the incoming flow angle ifa incoming flow angle ifa is the angle between incoming flow velocity and the upper surface of fixed wing a variety of ifa is the same as a rotation of fixed wing relative to the cross flow fan the rotation of fixed wing is similar to change foa roa and uhl simultaneously therefore studying the ifa is an excellent way to find out the relation between the three independent parameters the range of study for the ifa is set to 45 45 where the positive value means that the fixed wing rotates clockwise cfd simulations experiments and physical model studies are also carried out in this section 6 1 ifa and rotational speeds fig 17 a h indicate curves of cfd simulation result on four different performances with different ifas different rotational speeds and constant velocities fig 17 a and b illustrate curves about vf with an enlarge of ifa the vf decreases when the ifa is set to 30 the vf stays zero with an increase of rotational speed when the ifa is set to 45 the vf trends to decrease with an increase of the rotational speed the uft with a 30 ifa has the best vf generation performance fig 17 c and d show the simulation results of tf different from the tendency of vf the tf increases with an enlarge of ifa when the ifa is smaller than 15 the tfs stay negative in value which means that the uft cannot generate tf in these conditions even when the ifa is 45 the tf which turns to the drag force decreases with an increase of rotational speed fig 17 e and f reveal the torque curves the effect of ifa on the torque is not significant the uft with a 0 ifa needs the least torque when the rotational is high while the uft with a 45 ifa has the least torque consumption when the rotational speed is low when the ifa is set to be larger than 7 5 the torque slightly increases fig 17 g and h indicates the curve results of efficiency the uft with a negative ifa is more efficient the uft with a positive ifa has an efficiency value close to zero when the rotational speed is high a 0 ifa uft has the best efficiency as a brief summary the uft with a significant positive ifa has a better performance on tf and the uft with a large negative ifa has a better performance on vf and efficiency and torque consumption when the rotational speed is high and the velocity is less than 1 knot the uft with a 0 ifa has the best performance on efficiency and torque consumption 6 2 ifa and velocities fig 17 i p illustrate cfd simulation curves with different ifas different velocities and constant rotational speed the four performances are also discussed fig 17 i and j show the curves about vf it is regular that the vf increases with a decrease of ifa when the ifa is larger than 15 the vf trends to decrease with an increase of the velocity the uft with a 30 ifa still has the best vf generation performance with different velocities notably the 45 ifa uft can generate a weaker vf than that of 30 fig 17 k and l indicates the curve results about tf the ufts with a large negative ifa also lose their function on tf generation and the uft with a positive ifa generates a higher tf even when the velocity is high notably the 15 ifa uft can generate the highest tf but when the ifa is enlarged to higher than 15 the tf sharply decreases even when the ifa is set to 45 the tf on the uft is just close to that of 15 ifa fig 17 m and n show the curves of torque with different ifas the uft with a large negative ifa needs the least torque while the uft with a 15 ifa needs the most considerable torque the 15 is also a turning point where the increased tendency of torque turns to decrease with an enlarge of ifa fig 17 o and p reveal the results of efficiency generally the uft with a negative ifa has better efficiency the significant negative ifa has the best efficiency when the velocity is low while the small negative ifa has the best efficiency when the velocity is high the efficiency of 15 and 30 ifa closes to zero value as a summary if ifa is set to a positive value the tf of uft will be improved if ifa is set to a negative value the vf torque consumption and efficiency of uft will be improved notably the 30 ifa uft has the best performance on vf generation and the 15 ifa uft has the best performance on tf generation 6 3 experiment comparison and self driving results some uft models with different ifas are also tested by towing and self driving experiments the cfd simulation is also trustful based on the results indicated in table 4 fig 18 illustrates some vf and velocity results of self driving experiments the uft with a negative ifa can generate almost the same amount of vf in self driving conditions while the uft with a positive ifa can generate a negative vf which is a kind of upward force according to fig 18 a fig 18 b shows that the uft with a 15 ifa has the highest velocity and the uft with a 30 ifa can hardly drive itself moving forward the results shown in fig 18 b can explain why dose the vf stay with an enlarge of ifa in self driving experiments although a larger ifa is helpful to increase the tf in a particular condition of constant rotational speed and velocity the increase of vf may be offset by the vf decrease caused by the velocity decrease besides outstanding performances of the 30 ifa uft on vf generation and the 15 ifa uft on tf generation are confirmed by self driving experiments 6 4 velocity magnitude cloud map analyses some magnitude cloud maps with different ifas are indicated in fig 19 fig 19 a e show the maps with different ifas in the condition of low velocity v 0 5 k n and a high rotational speed n 1000 r p m as an enlarge of ifa flow around the cross flow fan has no significant change with different ifas the not significate change of torque can also prove this phenomenon the variety of ifa just affects the spread of wake flow this effect is similar to the influence of uhl fig 19 f j illustrate the maps with different ifas in the condition of moderate rotational speed and velocity n 750 r p m v 2 k n as the rotation of the fixed wing the eccentric vortex rotates in the same direction the velocity magnitude inside the cross flow fan increases with an enlarge of ifa the wake is guided by the lower surface of fixed wing so the direction of the wake also rotates with the fixed wing the decrease of vf and the increase of tf is caused by the direction change of wake besides when the ifa is set to 30 the boundary layer separation occurs on the upper surface of fixed wing the decrease of tf when the ifa is larger than 15 is partly because of the boundary layer separation fig 19 k o reveal the maps with different ifas in the condition of high velocity v 6 k n and a low rotational speed n 500 r p m the variety of the flow around the cross flow fan and the upper surface of fixed wing is similar to the results indicated in fig 19 f j particularly when the ifa is negative in value the trailing vortex will be generated behind the fixed wing with a reduction of ifa the trailing vortex has a tendency to break into turbulence as shown in fig 19 k 6 5 physical model analyses the role of ifa can be studied by a combination of previous physical model analyses results and discussed in categories as follows i θ 0 as an enlarge of positive ifa the foa α is enlarged the roa β is reduced and the uhl l 1 is the extent as shown in fig 20 the enlarge of foa causes that more incoming flow can inflow and be accelerated in zone b the reduction of roa causes a block of flow in zone c the extension of uhl causes that the wake flow to backward direction therefore as an enlarge of ifa much more flow can inflow and be accelerated but less part of flow has the opportunity to outflow and the wake finally flows to nearly the x direction the increase of tf is caused by the wake direction change the torque increase is caused by the acceleration in zone b the inefficiency is caused by the block of flow in zone c ii θ 0 with an increase of negative ifa the foa is reduced the roa is enlarged the uhl is shortened the reduction of foa causes less fluid can flow into the cross flow fan the enlarge of roa can make sure that the fluid inside the cross flow fan can totally flow out to zone e the shorten of uhl causes that the wake trend to flow upwards therefore as an enlarge of a negative ifa less flow can flow into the cross flow fan but all of them can flow out and the wake is in the upward direction the increase of vf is mainly caused by the upward wake the decrease of torque consumption is caused by the inlet flow decrease the increase of efficiency is caused by the full acceleration in zone c when θ 30 the decrease of vf and efficiency is partly caused by the inlet flow decrease 7 summary and analysis 7 1 the role of fixed wing based on discussions of the parameters including foa roa uhl and ifa in different conditions the tf vf torque and efficiency performance of uft are analyzed the role of fixed wing can be summarized as follows i the fixed wing can regulate the incoming flow into a cross flow fan and limit the number of blades which can accelerate the fluid the magnitude of this impact is mainly determined by the foa and ifa ii the fixed wing can regulate the flow of fluid out of a cross flow fan the magnitude of this effect is mainly determined by the roa and ifa iii the fixed wing can adjust the rate and direction of the wake flow the magnitude of this influence is mainly determined by the roa uhl and ifa iv the fixed wing can affect the formation and generation of some unique flow field phenomena such as the eccentric vortex accumulation vortex trailing vortex and boundary layer separation the eccentric vortex is mainly determined by the foa and ifa the accumulation vortex is mainly caused by the roa the trailing vortex is mainly caused by the uhl and roa the boundary layer separation is mainly determined by the ifa in the process of uft design the performance is set or be targeted and the parameters are the results of design therefore it is necessary to discuss how to improve only a kind of performance alone table 5 indicates ways to achieve four different kinds of targets by improving the parameters there is no way to change parameters to meet all targets positively and a tradeoff is more necessary to discuss 7 2 balance of thrust force tf and vertical force vf the magnitude of tf and vf are mainly affected by the rotational speed and velocity the rotational speed is provided and maintained by an active motor enough tf is the premise of uft to achieve an absolute velocity when the uft works in a self driving condition for this reason the tf is mainly affected by the rotational speed and the vf is mainly affected by tf and rotational speed in self driving conditions a variety of parameters can directly affect the ability of motor rotation to be converted into tf and vf an enlarge of foa can make the uft work on more fluid so the performance of tf and vf will be improved the variety of roa and uhl affects the rate and direction of the wake so the distribution of tf and vf are influenced the role of ifa is an effective combination of the other three parameters if the uft is designed to be the main thruster working in a self driving condition a specific tf should be guaranteed a larger roa and longer uhl are the right choices since these help the tf to perform well especially at a low velocity thanks to the excellent performance on tf a higher velocity can be achieved so the vf can also be guaranteed while cruising if the uft is designed to be an auxiliary thruster for an underwater vehicle significate and adjustable vf should be guaranteed setting roa to 5 and reduce uhl is an excellent choice for maintaining a tremendous vf changing ifa or uhl is an excellent way to adjust the vf 7 3 balance of forces and efficiency according to the definition of efficiency η in eq 1 η mainly reflects an efficiency on vf generation higher η means greater vf can be generated when consuming the same amount of power in self driving conditions the vf performance partly reflects the tf performance therefore η comprehensively reflects the ability of force generation in fact all power is output through rotation of the cross flow fan thus η stands for the proportion of vf within the many effects that cross flow fans impact on the field if the uft is designed to be the main thruster working in a self driving condition a higher efficiency should be guaranteed the foa needs to be set to 15 and roa needs to be set to 5 and the uhl needs to be set within 75 mm 100 mm if it s just for maximum efficiency considering the force performance the uhl should be extended in order to achieve a higher tf and velocity therefore the uhl can be set to 100 mm if the uft is designed to be an auxiliary thruster for an underwater vehicle the power consumption of the uft may be much smaller than the main thruster and limitations of efficiency can be weakened the foa can be enlarged to achieve a much higher tf and vf 8 conclusion in this paper the role of fixed wing on underwater fan wing thrusters uft is studied four parameters including front opening angle foa rear opening angle roa upper horizontal length uhl of the fix wing and incoming flow angle ifa are abstracted as the main parameter to study the uft computational fluid dynamics cfd simulations towing and self driving experiments and physical model analyses are carried out for analyzing the performance including vf tf torque and efficiency in different rotational speeds of the cross flow fan and different velocities the fixed wing can adjust the inflow and outflow to the cross flow fan and regulate the number of blades in work the fixed wing can also limit the rate and direction of the wake and affects the formation of some field phenomena including the eccentric vortex accumulation vortex trailing vortex and boundary layer separation some ways to balance the vf and tf and balance the forces and efficiency are proposed these ways can be used on uft design considering different conditions of whether the uft is used as the main thruster to an underwater vehicle there are some contributions firstly the role of the fixed wing to the uft is studied for the first time different from selecting a few typical airfoils for analysis four parameters are abstracted and studied under many different working conditions secondly the study of uft is based on lots of towing and self driving experiments for the first time almost all the cfd simulation results are proved by towing experiments the actual working conditions of a uft with different paraments are studied by self driving experiments thirdly the effect mechanisms of the parameters are studied based on a physical model for the first time the effect of foa is explained by fluid element motion analysis the formation of accumulation vortex and trailing vortex are explained finally some uft fixed wing design principles based on actual working conditions have been proposed for the first time there are a few limitations to this work the selection of parameters may not be the best choice the angle γ can also be selected as a parameter to replace uhl and the span of the fixed wing can be included as a parameter besides the airfoil of the fixed wing is set to constant if the upper surface and lower surface are designed to be curved the fixed wing may have other effects to explore on uft credit authorship contribution statement tianzhu gao conceptualization methodology software validation investigation resources data curation formal analysis writing original draft yang lin supervision project administration funding acquisition hongliang ren writing review editing visualization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this work was partially supported by chinese academy of sciences no gqrc 19 16 china scholarship council no 201904910602 and singapore academic research fund under grant r 397 000 353 114 and r 397 000 719 733 appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j oceaneng 2020 108049 
21520,fan wings as a form of aircraft propulsion have shown effectiveness for underwater propulsion the underwater fan wing thruster uft which is composed of a fixed wing and a cross flow fan under the fixed wing can generate significate vertical force underwater although some experiments and simulations are carried out to analyze the uft the role of the fixed wing to the uft has not been researched in depth in this paper four parameters the front opening angle rear opening angle upper horizontal length and incoming flow angle are selected for the role study in four aspects including vertical force thrust force torque and efficiency computational fluid dynamics cfd simulations in different rotational speeds of the cross flow fan and incoming flow velocities conditions are carried out for the ufts with different parameters which concurred with towing experiments self driving experiments are also carried out for studying the actual cruise performance of the uft with different parameters after that mechanisms of the effects are analyzed on many velocity magnitude cloud maps from cfd simulation a physical model is utilized to explain some of the unique fluid phenomena finally the role of the fixed wing is summarized and some principle on parameter setting is proposed keywords underwater fan wing thruster fixed wing computational fluid dynamics self driving experiment towing experiment 1 introduction an wing and fan wing aircrafts fashioned a wave of global research after 1998 when the british inventor peebles achieved the first flying test of a fan wing aircraft meng et al 2015 numerous groups and companies such as kogler s group from imperial college london fan wing company from the uk and propulsive wing llc from the usa gradually joined the study meng et al 2015 these researches focus on how to optimize the shape of fan wings and structure of fan wing aircrafts improve the load and maneuverability performance of fan wing aircrafts wind tunnel tests computer fluid dynamics cfd simulations and flight tests of aircrafts are used in these researches benferhat et al 2019 seyfang 2012 xiangnan 2015 meng and ye 2016 sun et al 2015 yamafuji 1975 duddempudi yaoet al 2007 shojaeefard and askari 2012 askari and shojaeefard 2009 ahad and graham 2007 du and tang 2018 du et al 2016 the fan wing aircrafts are proved to have a better load performance and a shorter takeoff and landing distance than fix wing aircrafts and higher speeds than rotorcrafts the underwater fan wing thruster uft is another propulsion system based on the fan wing the uft is effective in thrust and vertical force underwater generation different from the fan wing on the fan wing aircraft the cross flow fan is installed under the fixed wing in order to generate a striking downward vertical force according to our previous work in 2018 a uft model was demonstrated underwater and the effectiveness of underwater running was proved gao and lin 2018a after that a fan wing underwater vehicle fuv which is a remotely operated underwater vehicle driven by two ufts was also designed and tested underwater as shown in fig 1 gao and lin 2018b 2019 the fuv can achieve 5 dof movements with only two moving parts and the vertical force on the fuv is excellent enough to replace an overall buoyancy regulation system in order to find out the hydrodynamic mechanism of the uft we also studied a model of the uft by experiment cfd simulation and physical model analyses gao et al 2020 a particular designed experiment device which is applicable for both self driving and towing underwater experiments was used for experiments for the uft a unique physical model was also built for analyzing the mechanism the uft has different thrust force tf and vertical force vf with different rotational speeds of the cross flow fan and different incoming flow velocities the uft is also found out to have its maximum efficiency point with different incoming flow velocities in previous works about optimizing or analyzing the fan wing fan wing aircrafts uft and fuv only some typical fan wing shapes and structures are selected for example yufeng yao s group mainly analyzed the effect of the housing exit high duddempudi yaoet al 2007 and s askari s group mainly analyzed the effect of the open sides and six typical shapes of the fixed wing shojaeefard and askari 2012 askari and shojaeefard 2009 these results make sense but they are too specific to abstract the rules for working out the influence of each part of the fan wing on the whole fan wing besides previous works about the fan wing used on an aircraft are abundant but the shape optimizing and analyzing of the uft which works in the underwater condition of lower rotational speed and incoming flow velocity is seldom carried out in this work the role of the fixed wing to the uft is studied the influence of fixed wing on uft is basically abstracted into three independent parameters and one associated parameter these four parameters are separately studied by changing only one parameter four characters which are vf tf torque and efficiency are used to evaluate the effect of the parameters all the studies are based on experiments and cfd simulations similar to our previous work and flow cloud maps and physical models are also used to analyze the mechanism finally based on the reorganization of the parameter role ways to design and optimize the uft are put forward for different operation conditions the main contributions of this paper can be summarized as follows i four parameters of the fixed wing in the uft are selected ii the effects and mechanisms of the parameters on the hydrodynamic performance of the uft are worked out iii the effects of the fixed wing to the uft are summarized iv selection methods of the parameters according to the actual working state of the uft are proposed in this paper the abstracted parameters experiment and simulation methods and the physical model are firstly expounded then the four parameters are separately studied finally some ways to optimize the uft for different conditions are discussed 2 methods of studies 2 1 abstraction of parameters the fixed wing is one of the essential parts of a uft the fixed wing partially shades the cross flow fan and guides the wake to some extent relative sizes of the fixed wing may determine the hydrodynamic performance of a uft according to the function of fixed wing we can simplify its interaction with the cross flow fan as the main parameters as shown in fig 2 at different rotational speeds n of the cross flow fan and different incoming flow velocities v the parameters including front opening angle foa α rear opening angle roa β upper horizontal length uhl l 1 of the fix wing and incoming flow angle ifa θ are the main parameters based on previous relative works gao et al 2020 the incoming flow should go across the cross flow fan and outflow along the lower surface of the fixed wing thus the influence of fixed wing on the cross flow fan can be divided into three stages i the fixed wing affects the access of incoming flow ii the fixed wing influences the outflow from the cross flow fan iii the fixed wing guides the wake the foa can be used to quantize the first stage since it can characterize the degree to which the fixed wing shades the front of the cross flow fan relative to the entire circumference the roa can be used to estimate the influence of the second stage because it can characterize the degree to which the fixed wing shades the rear of the cross flow fan relative to the entire circumference the uhl can be used to measure the third effect as it directly affects the tilt angle of the lower surface of the fixed wing without affecting the upper surface to be horizontal in addition ifa can affect the above three independent parameters at the same time studying the ifa is essential to work out the relation of the roles of three independent parameters 2 2 experiment methods the effects of the parameters can be studied by experiments the experiment device is used in our previous work and is proved to be effective for self driving and towing experiments of ufts gao et al 2020 as shown in fig 3 the experiment device is composed of a slidable platform and a stable base the slidable platform can slide along the parallel rails on the stable base driven by the timing belt or the thrust force on the uft model when the slidable platform is driven by the timing belt which is a towing experiment the vf on the uft model in some given conditions can be measured when the slidable platform is driven by the tf on the uft model which is a self driving experiment vf in a real running condition of the fuv can be measured all the vfs are measured by a force sensor in the middle of the slidable platform the maximum range of the force sensor is 200 n with 1 20 n error besides the rotational speed of the cross flow fan and the sliding speeds can also be measured by this device the variety of the parameters can be achieved by alternating the fixed wing of the uft in each experiment the fixed wing in the uft model is made of polylactic acid pla which can be easily and quickly shaped by three dimension printing for the three independent parameters including foa roa and uhl three different models in different shapes are tested for the ifa five different attitudes of the model are tested the increase in the number of ifa experiment cases is due to the fact that ifa can be positive or negative for each uft model towing experiments and self driving experiments are carried out vfs on the uft rotational speeds of the cross flow fan and sliding or self driving speeds are measured in all of the cases similar to the previous work gao et al 2020 the vf data is filtered and the average value of the data is used to represent the real vf 2 3 cfd simulation methods as a complement to the experiments the computational fluid dynamics cfd simulations are also carried out for analyzing the impacts of the parameters fig 4 indicates a group of mesh generated for a uft with α 30 β 30 l 1 100 m m θ 0 all the groups of mesh used in cfd simulations have the same total size with the same ways of flow field encryption the mesh is separated into two domains including a static domain and a rotational domain for simulating rotation of the cross flow fan the cross section size of the total mesh and encrypted mesh is shown in fig 4 boundary layers are also added for enhancing the accuracy in simulating near wall turbulence since vortices of different scales need to be simulated simultaneously the turbulence model is set to the detached eddy simulation des in the cfd simulations finite volumes method is used for space discretization implicit instability with a time step of 1 667 10 4 s is used for time integration the left boundary is set to be a velocity inlet and the right boundary is set to be a pressure outlet with 0 0 relative pressures the temperature is set to 300 k the reference pressure is set to 1 013 10 5 p a the medium is set to the water with a density of 997 561 k g m 3 and a dynamic viscosity coefficient of 8 8871 10 4 p a s the simulation conditions are consistent with the experimental conditions all of the calculations are carried out by the commercial software star ccm 12 06 the tf vf torque with different parameter values and conditions can be solved out by the cfd simulations in addition some cloud maps can also be simulated these cloud maps reflect more detailed information about the flow field which is meaningful for studying mechanism of the effects 2 4 physical model methods a physical model is also necessary to study the parameters as shown in fig 2 the flow field can be separated into five successive zones names zone a b c d e gao et al 2020 each zone has its unique kinematic and dynamic boundary conditions which are directly related to the parameters by simplifying each of the zones into ideal fluid elements the effects of the parameters can be finely discussed according to our previous work gao et al 2020 there are two assumptions for the physical model i the influence of blade shape is ignored so all of the fluid elements in the normal direction have the same kinematic and dynamic characteristics ii the zone interface is considered to be a sudden change in the flow field besides efficiency is also considered as defined in eq 1 1 η f vf p f tf v f vf t n 9 55 f tf v where η is the efficiency f v f is the value of vf f v f on the uft t is the value of torque t of the cross flow fan n is the value of the rotational speed n of the cross flow fan f t f is the value of tf f t f on the uft and v is the magnitude of the incoming flow velocity v these symbols are indicated in fig 2 3 effects of the front opening angle foa the front opening angle foa is the opening angle of the fixed wing front end relative to the cross flow fan the foa directly affects the reaction of the incoming flow and cross flow fan in order to maintain the streamlined shape of the fixed wing the range in discussing for the foa is set to 5 60 if the foa is smaller than 5 the stagnation point would be formed on the fixed wing and if the foa is more significant than 60 the effect of flow guide on the upper surface of fixed wing would be rapidly weakened the foa in an appropriate setting can be studied by experiments cfd simulations and physical model studies moreover the effects of the rotational speed of the cross flow fan and incoming flow velocity at different foa should be separately discussed since the role of foa may vary in different actual conditions 3 1 foa and rotational speeds fig 5 a h show cfd simulation result curves of performances including vertical force f v f thrust force f t f torque t and efficiency η with different foa different rotational speeds and constant velocities fig 5 a and b indicate the curves about the vertical force f v f generally with an increase in rotational speed the vf increases and a larger foa causes a tremendous vf however in the conditions of 0 5 knots velocity and high 800 rpm rotational speed the vf on the uft model with large foa α 45 α 60 sharply decreases therefore the enlarge of foa promotes the increase of vf but still have risks of the disappearance of vf in conditions of high rotational speed and small velocity fig 5 c and d indicate two curves about the thrust force f t f similar to the curves about the f v f an increase of rotational speed and foa is a benefit to an increase of tf in high rotational speed and small velocity conditions the enlarge of foa can lead to a significant margin increase of tf fig 5 e and f illustrate the results of torque t with an increase of rotational speed and foa the torque increases the condition of high rotational speed and small velocity is also a unique condition where the model with large foa needs exceptionally high torque fig 5 g and h show the curves of efficiency η all the efficiencies decrease with the growth of rotational speed the model with foa equal to 15 has the highest efficiency in almost all the conditions especially in the condition of low rotational speed although the vf of the ufts with high foa is excellent these models are inefficient as a brief summary higher foa is suitable for the improvement of vf and tf but that is at the cost of considerable torque consumption and inefficient the uft with foa equal to 15 has the highest efficiency the uft with high foa also has the risk of vf going down in the conditions of high rotational speed and low velocity 3 2 foa and velocities fig 5 i p indicate some cfd simulation curves results with different foas different velocities and constant rotational speed the four performances are also discussed fig 5 i and g illustrate two groups of vf curves with different velocities the uft with higher foa can generate greater vf in all the conditions with different velocity however the extent of this impact decrease with the growth of foa when the rotational speed is low as shown in fig 4 i fig 5 k and l show the results of tfs all the ufts has a similar tendency which is going up first and then going down with an increase of velocity ufts with higher foa also has a greater tf fig 5 m and n reveal the curves about torque the uft with larger foa consumes higher torque which is the same in all the conditions with different velocities fig 5 o and p indicate the curve results of efficiency with different velocities when the foa is equal to 15 the efficiency is almost maximum the ufts with high foa also has the lowest efficiency as a summary the increase in velocity has almost the same effects on the increase of rotational speed vf and tf are great when the foa is large but torque consumption and efficiency are worse the uft with foa equal to 15 has the highest efficiency in almost all the conditions 3 3 experiment comparison and self driving results towing and self driving experiments are also carried out to the models with different foas the range of foa in the test is set to 15 30 45 the towing experiment results can be used to compare with the cfd simulation results in order to verify the reliability of simulation ones table 1 shows some typical towing experiments and cfd simulation results the error between these two ways of study is almost limited within 10 so the cfd simulation results are trustful self driving experiment results indicate the actual operating performance of a uft fig 6 illustrates the self driving experiment results with different foas and rotational speeds as shown in fig 6 a at the same rotational speed the uft with different foa has a similar vf in self driving however the uft with a larger foa has a higher velocity at the same rotational speed as shown in fig 6 b that is to say the enlarge of foa can accelerate the uft to a higher speed without changing the vf since a higher speed leads to higher resistance and a higher resistance need to offset by a greater tf the tf can be independently increased by setting a larger foa this phenomenon can also be explained by the cfd simulation results the self driving experiments are in low velocity and a high rotational speed condition in this condition the tf is more sensitive than the vf comparing fig 5 i and k besides the sensitivity of vf is much higher when the rotational speed changes than when the velocity changes in this condition comparing fig 5 b and j thus with an enlarge of foa the tf can be markedly improved and the vf still remains 3 4 velocity magnitude cloud map analyses although final performance results can be obtained by cfd simulations and experiments the causes of the performance with different foa cannot be easily analyzed only basing on the final data some velocity cloud maps generated by cfd simulations are considered as the cfd simulation is verified by towing experiments the cloud maps with different foas trustful as well fig 7 illustrates some of the cloud maps in three typical conditions i the condition of v 0 5 k n n 1000 r p m which is a typical condition with a low velocity and a high rotational speed ii the condition of v 2 k n n 750 r p m which is a steady condition with a moderate velocity and rotational speed iii the condition of v 4 k n n 500 r p m which is a condition with a high velocity and a low rotational speed based on fig 7 a e as the enlarge of foa the flow around the uft tends to unsteady in the first condition when α 5 almost all the fluid can flow backward along the lower surface of the fixed wing however when α 45 or α 60 the fluid in front of the cross flow fan tends to move downward and the wake tends to unsteady this phenomenon can be used to explain the vf disappearance previously discussed since the backward fluid turns to move downward the vf which is generated by the retroaction of the flow sharply turns to negative based on fig 7 f j as the enlarge of foa the flow around the uft remains steady in the second condition some eccentric vortexes meng and ye 2016 sun et al 2015 yamafuji 1975 duddempudi yaoet al 2007 shojaeefard and askari 2012 are generated by internal cross flow fan the shape of the eccentric vortex tends to be an ellipse and the size tends to be smaller the eccentric vortexes are generated only under the part that can be surrounded by the fixed wing based on fig 7 k o as the enlarge of foa the flow around the uft tends to as steady as the second condition in the third condition when the foa is small there is a low speed triangle region lstr the lstr is increasingly split by a wake flow with an enlarge of foa and the separated lstr gradually merges into the surrounding fluid the increase of vertical and tf as an enlarge of foa can be explained that the lstr tends to be split means that the wake flow tends to be enhanced the ability of fluid acceleration is improved with an enlarging of foa thus tf and vf are increased 3 5 physical model analyses the physical model can also be used to analyze the role of foa enlarge since the foa is set within 5 60 only a quarter of the cross flow fan is mainly influenced as circled in fig 8 the motion variety of fluid elements in the considered quarter should represent the effects of foa in zone a the velocity of a fluid element can be decomposed into a normal velocity v a n and a tangential velocity v a t since the fluid in zone a is covered by the fixed wing the normal velocity can be ignored if a fluid element moves from the start to the interface the velocity in the direction of x and y can be expressed as eq 2 where v a x is the value of x direction velocity in zone a v a y is the value of y direction velocity in zone a α 1 is the angle between v a n and x direction t is the time consumed related to the start time t 0 when the fluid element moves to zone b the boundary condition of the fluid element is changed and the velocity in the direction of x and y can be rewritten as eq 3 3 v b x v b n cos α 1 v b t sin α 1 v v b n cos π 2 2 π n t v b t sin π 2 2 π n t v v b y v b t cos α 1 v b n sin α 1 v b t cos π 2 2 π n t v b n sin π 2 2 π n t where v b x is the value of x direction velocity in zone b v b y is the value of y direction velocity in zone b v b n is the value of standard velocity component in zone b and v b t is the value of the tangential velocity component in zone b during the movement from the start to the end the average force in x and y direction can be expressed by total work per total length as indicated in eq 4 4 f x 1 0 r d l 0 r cos α m d v a x d t d l r cos α r m d v b x d t d l f y 1 0 r d l r sin α r m d v a y d t d l 0 r sin α m d v b y d t d l where f x is the average force to the fluid element in x direction f y is the average force to the fluid element in y direction and r is the radius distance of the fluid element relative to the axis of the cross flow fan m is the mess of the fluid element if v b t v a t v t eq 4 can be solved as expressed in eq 5 the derivative of force with respect to α can also be found as shown in eq 6 5 f x 2 π m n v t π 4 v bn v bn 1 4 sin 2 α α 2 f y 2 π m n v t v bn 1 4 sin 2 α α 2 6 d f x d α π m n v bn 1 cos 2 α 0 d f y d α π m n v bn 1 cos 2 α 0 since d f x dα and d f y dα stay non negative the f x and f y increase with an enlarge of α therefore the vf and tf on the uft tend to increase with the enlarge of foa besides the increase in torque can also be explained in the region where the quarter considered and the zone b intersect the angle between v and v b t is more significant than 90 thus the incoming flow hinders the rotation of the cross flow fan in this region with the enlarge of foa the hindered region expands so the torque increases 4 effects of the rear opening angle roa rear opening angle roa is the opening angle of the fixed wing middle section relative to the right side of the cross flow fan a variety of roa impacts the outflow from the cross flow fan the range of roa can be set to 5 45 considering the angle of the outflow if the roa is smaller than 5 the flow in zone c can be stopped on a large scale if the roa is larger than 45 the diversion effect of the fixed wing may evolve into a hindrance some ufts with different roas are also tested by towing and self driving cfd simulation and physical model also works when analyzing the role of roa 4 1 roa and rotational speeds fig 9 a h indicate parts of cfd simulation result curves of four different performances with different roa different rotational speeds and a constant velocity fig 9 a and b indicate the curves about the vertical force f v f when the velocity is small in value and the roa is a small angle the effect of the roa on the vf is negligible however in the condition of high rotational speed n 1250 r p m with low velocity v 0 5 k n the vf on the uft with a large roa β 45 plummets to a negative value in the condition of higher velocity v 1 k n the advantage of small roa β 5 15 in generating vf outstands notably the uft with a 5 roa generates the maximum vf when the rotational speed is high n 1000 r p m a n d n 1250 r p m fig 9 c and d illustrate some curves about the tf generally the uft with a large roa can generate a greater tf especially when the rotational speed is high n 1250 r p m and the velocity is low v 0 5 k n in the condition of higher velocity v 1 k n with an increase of rotating speed the tf on the uft with a small roa increases faster than that with a large roa fig 9 e and f show the results of torque at different roas an increase of the roa can notably increase the torque consumed however the uft with a 5 roa needs the weakest torque fig 9 g and h indicate curves of the efficiency as the increase of roa the efficiency gradually decreases and the uft with a 5 roa also has the best efficiency as a brief summary the uft with a 5 roa has the best performance to generate vf with the least torque consumption and the best efficiency on the other hand a larger roa is helpful to enhance the tf performance but the enhancement is inefficient 4 2 roa and velocities fig 9 i p reveal the cfd simulation curves results with different roas different velocities and constant rotational speed the four performances are also studied fig 9 i and g show two groups of curves of vf the uft with a 5 roa also performed well with a growth of velocity while the enhancement of vf is not significant fig 9 k and l illustrate curves of the tf performance in the condition of low velocity v 2 k n the uft with a large roa has a better performance on tf generation which is similar to the results at a constant velocity however when the velocity is higher the uft with a 5 roa turns to be the best model on tf in the condition of higher rotational speed n 1250 r p m the advantage to generating tf is also enhanced fig 9 m and n show groups of curves about torque the uft with a large foa still consumes more torque while the 5 and 5 roa uft consumes the least fig 9 o and p indicate curves of efficiency all the curves have a similar tendency which is a sharp increase and then a gradual decrease the 5 roa uft still performs the best as a summary the 5 roa uft has the best performance on all the four aspects and the uft with a large roa has an advantage only in generating tf at a low velocity 4 3 experiment comparison and self driving results towing and self driving experiments are also carried out to the models with different roas the range of roa in the test is set to 5 15 30 table 2 shows some vf results by towing experiments the results are compared with the cfd simulations ones and the error is acceptable the self driving experiment results with different roas are indicated in fig 10 generally the uft with higher rotational speed can generate a higher vf and the velocity can be improved as well this character can be explained by the cfd simulation results with an enlarge of roa the tf on the uft increase faster than the vf therefore in the self driving condition the uft with a large roa can move with a higher velocity and a higher vf caused by the velocity increase happens besides the vf on the uft with a large roa may sharply decrease when the rotational speed is high as shown in fig 10 a similarly as shown in fig 9 a the vf may sharply decrease in the condition of high rotational speed and low velocity these two phenomena are mutually validated 4 4 velocity magnitude cloud map analyses fig 11 indicates 15 velocity magnitude cloud maps with different roas the role of roa can be studied by these maps fig 11 a e show the maps with different roas in the condition of low velocity v 0 5 k n and a high rotational speed n 1000 r p m with an enlarge of roa the fluid tends to unsteady and the eccentric vortex tends to disappear the outflow from the cross flow fan spreads around rather than goes back along the fixed wing this phenomenon can be used to explain the vf sharp decrease the vf is mainly caused by the backward flow out of the cross flow fan with an enlarge of roa the backward flow spreads around so the vf sharply decreased fig 11 f j illustrate the maps with different roas in the condition of moderate rotational speed and velocity n 750 r p m v 2 k n all the uft models are steadily work in this condition and all the eccentric vortexes have a similar position and shape as the enlarge of roa there is an accumulation vortex generated under the middle of fixed wing as marked in fig 11 i and j fig 11 k o reveal the maps with different roas in the condition of high velocity v 4 k n and a low rotational speed n 500 r p m same to the maps in the moderate condition all the maps are similar and all the eccentric vortexes are in a similar state however compared to fig 11 i and n or fig 11 j and o the size of accumulation vortex tends to be enlarged the formation and generation of the accumulation vortex may impact on uft performance 4 5 physical model analyses according to the previous discussions two phenomena remain to be explained i the 5 roa uft has the best performance ii the formation and generation of the accumulation vortex these phenomena may be explained by the physical model analyses fig 12 illustrates the fluid element motion in two conditions with different roas in zone c the resultant velocity v c of the fluid element can be decomposed into a normal velocity v c n and a tangential velocity v c t and the angle between v c and v c n can be defined as ξ the angle between a tangential velocity v c n or v a n and x direction can be defined as β 1 and the angle between a resultant velocity v c or v a and x direction can be defined as β 2 what s more γ is used to stand for the angle between the fixed wing lower surface and the x direction the relations of the angle can be expressed as eq 7 7 β 2 ξ β 1 β 1 90 min β β 3 ξ β 1 ε β 1 min β β 3 β 90 β 1 β 1 β 90 where β 3 is the critical angle at which the boundary condition of the zone c changes ε is the corrective coefficient for the boundary condition variety the left inlet boundary condition in zone c relies on the outlet boundary condition of zone d and the outlet boundary condition of zone d can be classified as an eccentric vortex boundary condition and an outflow boundary condition the critical angle β 3 is used to distinguish the variety of the boundary condition when β 1 β 3 the left inlet boundary condition can be approximated as an inflow when β 1 β 3 the left boundary condition can be approximated as a weaker inflow since some of the fluid starts to around the eccentric vortex in the condition of β 1 β 3 the inflow from the zone d outflow along the tangential direction of a blade end after acceleration and turning in zone c so ξ should be equal to the 60 which is the tangential direction angle of a blade in the condition of β 1 β 3 the value of v c n may decrease because of the continuity of fluid and the corrective coefficient ε is used to stand for the increase of β 2 cause by the v c n decrease in zone a the v a n is far less than the v a t because of a shelter of fixed wing therefore the β 2 can be expressed as eq 7 the relation of β and β 3 determines the performance of uft and the relation can be discussed as follows i β β 3 the inflow from zone d may be stopped by the fixed wing and the mass flow may be reduced ii β β 3 all of the inflow from zone d can outflow from the right side of zone c iii β β 3 although all of the inflow from zone d can outflow from the right side of zone c the position where the fluid direction changed is moved to the lower plane of the fixed wing in the condition of β β 3 the outflow rate is low where β 1 β β 3 in zone c the outflow from the side where β 1 β 3 may continually flow to the fixed wing and finally arrives at the lower plane of the fixed wing between the position of arrival and the turning point of the fixed wing the fluid is accumulated the accumulated fluid gradually forms a vortex which is the accumulation vortex under viscous shear caused by the outflow as shown in fig 12 b the angle between the outflow and lower plane of the fixed wing is enlarged because γ decreases as β increases so the viscous shear loss increases as β increases indeed the 5 roa uft has the best performance is because of the β 3 5 according to fig 11 f o in this condition the uft has the most significant outflow and the lest shear loss by the accumulation vortex 5 effects of the upper horizontal length uhl upper horizontal length uhl is the horizontal length of the fixed wing upper surface in a cross section a variety of uhl affects the guidance of flow on the lower surface of the fixed wing and influences the synthesis of flow on the upper and lower surfaces of the fixed wing the range of uhl can be set to 50 m m 150 m m to compare with that the external diameter of the cross flow fan is 60 mm if the uhl is shorter than 50 mm the tail of the fixed wing tends to disappear if the uhl is longer than 150 mm the effect of uhl variety on fluid synthesis and guidance is not significant the role of uhl is also studied by cfd simulations experiments and physical model analyses 5 1 uhl and rotational speeds fig 13 a h indicate curves of cfd simulation result on four different performances with different uhl different rotational speeds and constant velocities fig 13 a and b show the curves about vf it is regular that the vf decreases with the extent of uhl and the 50 mm uhl uft has the best vf performance fig 13 c and d illustrate the curves about the tf with different uhls the uft with a uhl longer than 100 mm can generate tf of similar value however the 50 mm uhl uft nearly loss the function of tf generation fig 13 e and f reveal the results of torque with different uhls the uft with a100 mm uhl needs the least torque consumption particularly in high rotational speed conditions on the other hand the uft with a uhl longer or shorter than 100 mm consumes a similar torque fig 13 g and h indicate two groups of curves about efficiency when the rotational speed is small in value n 500 r p m the ufts with a short l 1 100 m m uhl has higher efficiency when the rotational speed is higher in value n 500 r p m the 100 mm uhl uft turns to be the most efficient basically the efficiency of the uft with a long uhl l 1 100 m m is small in value as a brief summary longer uhl can improve the performance of tf while shorter uhl can improve the function of vf generation the uhl with a moderate uhl has the least torque consumption and the best efficiency 5 2 uhl and velocities fig 13 i p show some cfd simulation curves results with different uhls different velocities and constant rotational speed the four performances are also discussed fig 13 i and j indicate the curves of vf it is regular that shorter uhl benefits the vf generation with the increase of velocity this superiority tends to be enhanced fig 13 k and l reveal the curves about tf the uhls with a longer uhl can generate a higher tf and the velocity range with a positive tf is also extended however the uhls with a short uhl l 1 50 m m loss the tf and has a significate high resistance fig 13 m and n illustrate the results of torque basically uhl impacts little 20 to the torque the uft with a short uhl needs only a little more torque fig 13 o and p show two groups of curves about efficiency when the velocity is small in value v 1 k n the uft with a short uhl is more efficient however when the velocity is large in value v 1 k n the uft with a 100 mm uhl has the best efficiency as a summary the extension of uhl is helpful to increase the tf but the increase is limited when the uhl is longer than 100 mm the reduction of uhl is effective in increasing the vf and affection is remarkable however tf on the 50 mm uft may totally be disappeared the 100 mm uhl uft is the most efficient 5 3 experiment comparison and self driving results some models with a uhl in the set of 50 mm 100 mm 150 mm are also tested by towing and self driving experiments the comparison of the towing experiment and cfd simulation results are shown in table 3 the error is also limited within 10 so the cfd simulation results are trustful the self driving experiment results are shown in fig 14 with a reduction of uhl the vf increases but the velocity decrease that is to say in the self driving condition the vf can be improved by a reduction of uhl even though the velocity decreases therefore the uhl reduction is an effective way to increase the vf independently fig 15 reveals some magnitude cloud maps with different uhls the influence of uhl variety can be studied by these maps fig 15 a e indicate the maps with different uhls in the condition of low velocity v 0 5 k n and a high rotational speed n 1000 r p m the variety of uhl has nearly no effects on the cross flow fan however because of the guidance of flow the uft with a long uhl can force the unsteady flow backward rather than spread thus the extension of uhl helps the uft to improve the tf without additional torque consumption fig 15 f j show the maps with different uhls in the condition of moderate rotational speed and velocity n 750 r p m v 2 k n the flow inside the cross flow fan also nearly the same but the wake is various when the uhl is short the wake goes along the lower surface of the fixed wing to the upward direction as the extension of uhl the lower surface of the fixed wing tends to be horizontal and the wake tends to go backward therefore the increase of vf is caused by the increase of flow in the upward direction and the increase of tf in caused by the increase of flow in the backward direction the direction of the lower surface of the fixed wing determines the direction of the resultant force fig 15 k o reveal the maps with different uhls in the condition of high velocity v 6 k n and a low rotational speed n 500 r p m as the velocity is much higher than the speed of wake the effects of the rotation of the cross flow fan tend to be weaker there is a trailing vortex behind the short uhl uft the trailing vortex is caused by the boundary layer separation and the boundary layer separation is caused by the obstruction of the cross flow fan to the incoming flow with an extension of uhl the trailing vortex tends to be weaker 5 4 physical model analyses according to the less variable torque curves in fig 13 e f m and n and magnitude cloud maps in fig 15 the uhl has only a little effect on the flow around the cross flow fan therefore when considering the effect of uhl on uft the flow field around the cross flow fan can be considered as approximately unaffected the effect of the cross flow fan can be approximated as turning incoming flow velocity v into a velocity v e along the lower surface of fixed wing and then the motion of the fluid elements just in zone e can be analyzed independently to study the role of uhl as shown in fig 16 since the effects of uhl on the tf vf and torque are clearly explained by velocity cloud map analyses only the reason for the formation and generation of the trailing vortex needs to be studied in the condition of moderate rotational speed and velocity the incoming flow can be accelerated by the cross flow fan so the outflow velocity v e satisfies the condition of v e c o s γ v the cross flow fan jets high velocity flow into the low velocity field in this condition some vortexes may be caused by the shear effect of the jet flow but the energy of these vortexes can be dissipated in the far field the length of uhl only affects the direction of v e and the vortex is not under its control in the condition of low rotational speed and high velocity the incoming flow cannot be accelerated by the cross flow fan or even is obstructed by the cross flow fan so the outflow velocity v e satisfies the condition of v e c o s γ v the uft is surrounded by a high velocity flow in this condition the shear effect may cause a trailing vortex behind the uft when two fluid elements a and b the location of a and b are shown in fig 16 are considered the vorticity ζ of a relative to b can be approximately expressed as eq 8 herbert 2019 if v e and v remain constant with an extension of uhl γ decreases so the vorticity ζ decreases therefore the extension of uhl is helpful in decreasing the vorticity of the trailing vortex 8 ζ v x y v y x v v e cos γ y 1 v e sin γ x 1 6 effects of the incoming flow angle ifa incoming flow angle ifa is the angle between incoming flow velocity and the upper surface of fixed wing a variety of ifa is the same as a rotation of fixed wing relative to the cross flow fan the rotation of fixed wing is similar to change foa roa and uhl simultaneously therefore studying the ifa is an excellent way to find out the relation between the three independent parameters the range of study for the ifa is set to 45 45 where the positive value means that the fixed wing rotates clockwise cfd simulations experiments and physical model studies are also carried out in this section 6 1 ifa and rotational speeds fig 17 a h indicate curves of cfd simulation result on four different performances with different ifas different rotational speeds and constant velocities fig 17 a and b illustrate curves about vf with an enlarge of ifa the vf decreases when the ifa is set to 30 the vf stays zero with an increase of rotational speed when the ifa is set to 45 the vf trends to decrease with an increase of the rotational speed the uft with a 30 ifa has the best vf generation performance fig 17 c and d show the simulation results of tf different from the tendency of vf the tf increases with an enlarge of ifa when the ifa is smaller than 15 the tfs stay negative in value which means that the uft cannot generate tf in these conditions even when the ifa is 45 the tf which turns to the drag force decreases with an increase of rotational speed fig 17 e and f reveal the torque curves the effect of ifa on the torque is not significant the uft with a 0 ifa needs the least torque when the rotational is high while the uft with a 45 ifa has the least torque consumption when the rotational speed is low when the ifa is set to be larger than 7 5 the torque slightly increases fig 17 g and h indicates the curve results of efficiency the uft with a negative ifa is more efficient the uft with a positive ifa has an efficiency value close to zero when the rotational speed is high a 0 ifa uft has the best efficiency as a brief summary the uft with a significant positive ifa has a better performance on tf and the uft with a large negative ifa has a better performance on vf and efficiency and torque consumption when the rotational speed is high and the velocity is less than 1 knot the uft with a 0 ifa has the best performance on efficiency and torque consumption 6 2 ifa and velocities fig 17 i p illustrate cfd simulation curves with different ifas different velocities and constant rotational speed the four performances are also discussed fig 17 i and j show the curves about vf it is regular that the vf increases with a decrease of ifa when the ifa is larger than 15 the vf trends to decrease with an increase of the velocity the uft with a 30 ifa still has the best vf generation performance with different velocities notably the 45 ifa uft can generate a weaker vf than that of 30 fig 17 k and l indicates the curve results about tf the ufts with a large negative ifa also lose their function on tf generation and the uft with a positive ifa generates a higher tf even when the velocity is high notably the 15 ifa uft can generate the highest tf but when the ifa is enlarged to higher than 15 the tf sharply decreases even when the ifa is set to 45 the tf on the uft is just close to that of 15 ifa fig 17 m and n show the curves of torque with different ifas the uft with a large negative ifa needs the least torque while the uft with a 15 ifa needs the most considerable torque the 15 is also a turning point where the increased tendency of torque turns to decrease with an enlarge of ifa fig 17 o and p reveal the results of efficiency generally the uft with a negative ifa has better efficiency the significant negative ifa has the best efficiency when the velocity is low while the small negative ifa has the best efficiency when the velocity is high the efficiency of 15 and 30 ifa closes to zero value as a summary if ifa is set to a positive value the tf of uft will be improved if ifa is set to a negative value the vf torque consumption and efficiency of uft will be improved notably the 30 ifa uft has the best performance on vf generation and the 15 ifa uft has the best performance on tf generation 6 3 experiment comparison and self driving results some uft models with different ifas are also tested by towing and self driving experiments the cfd simulation is also trustful based on the results indicated in table 4 fig 18 illustrates some vf and velocity results of self driving experiments the uft with a negative ifa can generate almost the same amount of vf in self driving conditions while the uft with a positive ifa can generate a negative vf which is a kind of upward force according to fig 18 a fig 18 b shows that the uft with a 15 ifa has the highest velocity and the uft with a 30 ifa can hardly drive itself moving forward the results shown in fig 18 b can explain why dose the vf stay with an enlarge of ifa in self driving experiments although a larger ifa is helpful to increase the tf in a particular condition of constant rotational speed and velocity the increase of vf may be offset by the vf decrease caused by the velocity decrease besides outstanding performances of the 30 ifa uft on vf generation and the 15 ifa uft on tf generation are confirmed by self driving experiments 6 4 velocity magnitude cloud map analyses some magnitude cloud maps with different ifas are indicated in fig 19 fig 19 a e show the maps with different ifas in the condition of low velocity v 0 5 k n and a high rotational speed n 1000 r p m as an enlarge of ifa flow around the cross flow fan has no significant change with different ifas the not significate change of torque can also prove this phenomenon the variety of ifa just affects the spread of wake flow this effect is similar to the influence of uhl fig 19 f j illustrate the maps with different ifas in the condition of moderate rotational speed and velocity n 750 r p m v 2 k n as the rotation of the fixed wing the eccentric vortex rotates in the same direction the velocity magnitude inside the cross flow fan increases with an enlarge of ifa the wake is guided by the lower surface of fixed wing so the direction of the wake also rotates with the fixed wing the decrease of vf and the increase of tf is caused by the direction change of wake besides when the ifa is set to 30 the boundary layer separation occurs on the upper surface of fixed wing the decrease of tf when the ifa is larger than 15 is partly because of the boundary layer separation fig 19 k o reveal the maps with different ifas in the condition of high velocity v 6 k n and a low rotational speed n 500 r p m the variety of the flow around the cross flow fan and the upper surface of fixed wing is similar to the results indicated in fig 19 f j particularly when the ifa is negative in value the trailing vortex will be generated behind the fixed wing with a reduction of ifa the trailing vortex has a tendency to break into turbulence as shown in fig 19 k 6 5 physical model analyses the role of ifa can be studied by a combination of previous physical model analyses results and discussed in categories as follows i θ 0 as an enlarge of positive ifa the foa α is enlarged the roa β is reduced and the uhl l 1 is the extent as shown in fig 20 the enlarge of foa causes that more incoming flow can inflow and be accelerated in zone b the reduction of roa causes a block of flow in zone c the extension of uhl causes that the wake flow to backward direction therefore as an enlarge of ifa much more flow can inflow and be accelerated but less part of flow has the opportunity to outflow and the wake finally flows to nearly the x direction the increase of tf is caused by the wake direction change the torque increase is caused by the acceleration in zone b the inefficiency is caused by the block of flow in zone c ii θ 0 with an increase of negative ifa the foa is reduced the roa is enlarged the uhl is shortened the reduction of foa causes less fluid can flow into the cross flow fan the enlarge of roa can make sure that the fluid inside the cross flow fan can totally flow out to zone e the shorten of uhl causes that the wake trend to flow upwards therefore as an enlarge of a negative ifa less flow can flow into the cross flow fan but all of them can flow out and the wake is in the upward direction the increase of vf is mainly caused by the upward wake the decrease of torque consumption is caused by the inlet flow decrease the increase of efficiency is caused by the full acceleration in zone c when θ 30 the decrease of vf and efficiency is partly caused by the inlet flow decrease 7 summary and analysis 7 1 the role of fixed wing based on discussions of the parameters including foa roa uhl and ifa in different conditions the tf vf torque and efficiency performance of uft are analyzed the role of fixed wing can be summarized as follows i the fixed wing can regulate the incoming flow into a cross flow fan and limit the number of blades which can accelerate the fluid the magnitude of this impact is mainly determined by the foa and ifa ii the fixed wing can regulate the flow of fluid out of a cross flow fan the magnitude of this effect is mainly determined by the roa and ifa iii the fixed wing can adjust the rate and direction of the wake flow the magnitude of this influence is mainly determined by the roa uhl and ifa iv the fixed wing can affect the formation and generation of some unique flow field phenomena such as the eccentric vortex accumulation vortex trailing vortex and boundary layer separation the eccentric vortex is mainly determined by the foa and ifa the accumulation vortex is mainly caused by the roa the trailing vortex is mainly caused by the uhl and roa the boundary layer separation is mainly determined by the ifa in the process of uft design the performance is set or be targeted and the parameters are the results of design therefore it is necessary to discuss how to improve only a kind of performance alone table 5 indicates ways to achieve four different kinds of targets by improving the parameters there is no way to change parameters to meet all targets positively and a tradeoff is more necessary to discuss 7 2 balance of thrust force tf and vertical force vf the magnitude of tf and vf are mainly affected by the rotational speed and velocity the rotational speed is provided and maintained by an active motor enough tf is the premise of uft to achieve an absolute velocity when the uft works in a self driving condition for this reason the tf is mainly affected by the rotational speed and the vf is mainly affected by tf and rotational speed in self driving conditions a variety of parameters can directly affect the ability of motor rotation to be converted into tf and vf an enlarge of foa can make the uft work on more fluid so the performance of tf and vf will be improved the variety of roa and uhl affects the rate and direction of the wake so the distribution of tf and vf are influenced the role of ifa is an effective combination of the other three parameters if the uft is designed to be the main thruster working in a self driving condition a specific tf should be guaranteed a larger roa and longer uhl are the right choices since these help the tf to perform well especially at a low velocity thanks to the excellent performance on tf a higher velocity can be achieved so the vf can also be guaranteed while cruising if the uft is designed to be an auxiliary thruster for an underwater vehicle significate and adjustable vf should be guaranteed setting roa to 5 and reduce uhl is an excellent choice for maintaining a tremendous vf changing ifa or uhl is an excellent way to adjust the vf 7 3 balance of forces and efficiency according to the definition of efficiency η in eq 1 η mainly reflects an efficiency on vf generation higher η means greater vf can be generated when consuming the same amount of power in self driving conditions the vf performance partly reflects the tf performance therefore η comprehensively reflects the ability of force generation in fact all power is output through rotation of the cross flow fan thus η stands for the proportion of vf within the many effects that cross flow fans impact on the field if the uft is designed to be the main thruster working in a self driving condition a higher efficiency should be guaranteed the foa needs to be set to 15 and roa needs to be set to 5 and the uhl needs to be set within 75 mm 100 mm if it s just for maximum efficiency considering the force performance the uhl should be extended in order to achieve a higher tf and velocity therefore the uhl can be set to 100 mm if the uft is designed to be an auxiliary thruster for an underwater vehicle the power consumption of the uft may be much smaller than the main thruster and limitations of efficiency can be weakened the foa can be enlarged to achieve a much higher tf and vf 8 conclusion in this paper the role of fixed wing on underwater fan wing thrusters uft is studied four parameters including front opening angle foa rear opening angle roa upper horizontal length uhl of the fix wing and incoming flow angle ifa are abstracted as the main parameter to study the uft computational fluid dynamics cfd simulations towing and self driving experiments and physical model analyses are carried out for analyzing the performance including vf tf torque and efficiency in different rotational speeds of the cross flow fan and different velocities the fixed wing can adjust the inflow and outflow to the cross flow fan and regulate the number of blades in work the fixed wing can also limit the rate and direction of the wake and affects the formation of some field phenomena including the eccentric vortex accumulation vortex trailing vortex and boundary layer separation some ways to balance the vf and tf and balance the forces and efficiency are proposed these ways can be used on uft design considering different conditions of whether the uft is used as the main thruster to an underwater vehicle there are some contributions firstly the role of the fixed wing to the uft is studied for the first time different from selecting a few typical airfoils for analysis four parameters are abstracted and studied under many different working conditions secondly the study of uft is based on lots of towing and self driving experiments for the first time almost all the cfd simulation results are proved by towing experiments the actual working conditions of a uft with different paraments are studied by self driving experiments thirdly the effect mechanisms of the parameters are studied based on a physical model for the first time the effect of foa is explained by fluid element motion analysis the formation of accumulation vortex and trailing vortex are explained finally some uft fixed wing design principles based on actual working conditions have been proposed for the first time there are a few limitations to this work the selection of parameters may not be the best choice the angle γ can also be selected as a parameter to replace uhl and the span of the fixed wing can be included as a parameter besides the airfoil of the fixed wing is set to constant if the upper surface and lower surface are designed to be curved the fixed wing may have other effects to explore on uft credit authorship contribution statement tianzhu gao conceptualization methodology software validation investigation resources data curation formal analysis writing original draft yang lin supervision project administration funding acquisition hongliang ren writing review editing visualization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this work was partially supported by chinese academy of sciences no gqrc 19 16 china scholarship council no 201904910602 and singapore academic research fund under grant r 397 000 353 114 and r 397 000 719 733 appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j oceaneng 2020 108049 
21521,wax and other precipitates deposit on the inner wall of the pipeline during the transportation of petroleum and its products they greatly reduce the transportation efficiency and cause potential safety hazards in the process of offshore oil production and transportation it is easier to produce wax and precipitates because of the low temperature and high pressure which causes more serious issues the jet end is a key component of underwater intelligent pigging robot uipr because performance of wax and precipitates removal highly depends on the high speed flow generated by the jet end in this paper the influence of the structural parameters of the jet end on the downstream flow field is analyzed by using the simulation method of k epsilon the simulation results show that different internal surfaces of baffles will have a greater impact on the pressure velocity and turbulent kinetic energy of the flow field and the change of turbulent kinetic energy and velocity is more than 10 the baffle with witonzinsky curve is found to superior in increasing turbulence kinetic energy and pressure in addition an orifice in the disc of jet cylinder contributes to reduce the pressure near the jet end and the loss of turbulent kinetic energy keywords offshore pipeline uipr robot pigging technology jetting device 1 introduction pigging technology is an effective maintenance method in the process of oil transportation in the process of oil pipeline paraffin and other impurities combined condensate generate from petroleum flow and deposit on the inner wall of the pipeline which reduces the transportation efficiency of petroleum and leads to potential security risks like pipeline blockage ararimeh aiyejina studied the problem of paraffin condensation on the oil pipe wall in 2011 ararimeh et al 2011 his article described the cause of paraffin condensation in detail wang further analyzed and sorted out this problem in 2014 wang et al 2014 in order to remove pipeline impurities pig has been proposed and become one of the most effective pigging methods for offshore pipeline pig robots are usually used to clean up oil pipeline which include pipeline cleaning pipeline detection and other functions royal dutch shell group of companies successfully developed a pigging machine with detection function as early as 1940s which can simply carry out pipeline detection and complete pigging operation zhang 1998 to improve performance of pigging robots great efforts have been paid on their function and structure design m h w hendrix used the experimental platform to study the friction behavior of disc pig and quantified the corresponding difference of coulomb friction coefficient by finite element calculation m h w hendrix et al 2018 ali ahmadian mazreah proposed a pig model in 2017 effectively eliminating the impact of hydraulic transient ali et al 2017 in 2018 zhang and dong designed a pigging structure with pneumatic deformation adjustment by using simulation and experimental methods zhang et al 2020 devesh mishra proposed a pig for long distance pipeline in 2019 devesh et al 2019 in the field of offshore oil engineering because of the low temperature and high pressure environment under water the paraffin condensation problem on the oil pipeline becomes more serious the paraffin precipitation from crude oil will be affected by the material of pipeline the internal flow rate of pipeline and the temperature difference between the liquid and the pipe wall the specific performance is as follows a the paraffin precipitation phenomenon is more likely to occur in the soft pipeline than in the hard pipeline b the flow rate of the oil in the pipe will affect the shear force of the oil on the pipe wall and the oil flow in the laminar flow condition is easier to condense paraffin on the pipe wall c the wax evolution characteristics of the crude depend on the temperature of the crude and the temperature difference between the crude and the pipe wall which was studied by yang liu huang and others huang qiyu et al 2006 pu et al 2011 liu et al 2012 tian zhen et al 2015 liu rongrong et al 2016 on the 1st north american conference on multiphase technology in 1998 o b rygg pointed out the influence of wax deposition on offshore pipeline systems o b rygg et al 1998 as early as 1986 kiefner j f pointed out the application value and significance of intelligent pig in pipeline nondestructive testing kiefner et al 1986 in 2020 jianheng chen and limin he studied the bypass pigging technology in offshore pipeline jianheng chen et al 2020 jianheng chen and limin he studied the structural parameters of jetting pig and movement characteristics of liquid loading in the process of pigging in 2018 and then studied the jetting pigging technology in offshore pipeline jianheng chen et al 2018 jianheng chen et al 2020 by means of experiments and simulations the influence of controlling the bypass quantity on the working effect of the pig has been tested the results show that the jet pig can effectively control the downstream two phase flow pattern it realizes the regular distribution of downstream liquid impurities in the gas pipeline which innovates the current study intelligent pig has also been used in the subsea intelligent pipeline system in 2014 chapter 4 of subsea pipeline integrity and risk management written by yong bai and qian bai 2014 proposed the subsea intelligent pipeline system with intelligent pipeline pigging device mohammed s el abbasy used the artificial neural network model to predict risks of the offshore oil and gas pipeline yong et al 2014 mohammed et al 2014 compared with the intelligent pipeline intelligent cleaning robot has the advantage in adaptability they are able to serve for both new smart pipes and conventional pipes those conventional pipes are more inclined to use simple pigging foam or pigging balls a jet end for underwater intelligent pigging robot uipr is proposed in this study aiming for flexible application for both conventional and intelligent pipelines because of the jet end the paraffin and other impurities on the inner surface of the pipeline can be washed by launching a high kinetic energy flow to complete the pigging task compared with the traditional pig and pig ball the jet end of uipr can launch high speed fluid which can break up the accumulation dredge the pipeline and reduce the wax plug risk through the software simulation this paper analyzes the jet flow field at the jet end of uipr as well as the pressure turbulence kinetic energy and velocity of the jet flow field at the exit increase the jet velocity and reduce the energy loss caused by turbulence kinetic energy 2 method the jet end of uipr is divided into two parts accelerating bucket and baffle the accelerating bucket has a traditional pig structure which is composed of two discs and accelerating channels the baffles are disc shaped and fixed at the end of the accelerating bucket outlet the jet end has an axial symmetric structure in this paper its research model is simplified the two dimensional flow field model replaces the three dimensional flow field model its basic size and structure are shown in fig 1 the flow field model of pipeline and jet end is shown in fig 1 c 2 1 mechanical model the mechanical model of the jet end is analyzed as shown in fig 2 it is subjected to gravity pressure upstream and downstream of the flow field fluid drag force pipe wall friction and jet pressure on the baffles the energy conservation equation model of the jet end is established as formula 1 1 m d v p i g d t s p i p e s h p 1 p 2 f f m g sin α f h f p b where s pipe is the sectional area of the pipeline s h is the area of jet hole p 1 is the upstream pressure of the pig p 2 is the downstream pressure of the pig ɑ is the angle between the pipeline and the horizontal plane p b is the pressure borne by the baffles f hf is the drag force of the fluid 2 2 finite element model for the analysis of mechanical model this paper uses the finite element method which is widely used in the research of rigid body flexible body fluid thermal electromagnetic and other disciplines the physical model of jet end working in pipeline is simplified as follows a the fluid medium fills the pipeline b the fluid medium is newtonian fluid which is incompressible and satisfies newtonian internal friction law c the simulated environment is a gravity field of 9 8 m s2 in the y axis direction d the inlet flow rate is 1 2 m s and the outlet pressure is 1000000pa according to the hydrodynamics analysis the equation of motion is obtained as shown in formula 2 2 d v x d t div v x v div μ grad v x 1 ρ d p d x d v y d t div v y v div μ grad v y 1 ρ d p d y d v z d t div v z v div μ grad v z 1 ρ d p d z where v is the velocity vector of fluid v x v y and v z are the velocity components of x axis y axis and z axis t is the time μ dynamic viscosity ρ is the density of fluid the turbulence model adopts the standard k epsilon model in fluent module and its turbulent flow energy k and dissipation rate ε mathematical model are shown in formula 3 3 t ρ k x i ρ k u i x j μ μ t σ k k x j g k g b ρ ε y m s k t ρ ε x i ρ ε u i x j μ μ t σ ε ε x j c 1 ε ε k g k c 3 ε g b c 2 ε ρ ε 2 k s ε where g k represents the turbulent kinetic energy generated by the average velocity gradient g b represents the turbulent kinetic energy generated by the buoyancy y m represents the impact of the fluctuating expansion in the compressible turbulence on the total dissipation rate c 1ε c 2ε and c 3ε are constants σ ε σ k are k and ε prandtl numbers the turbulent viscosity μt model is shown in formula 4 4 μ t ρ c μ k 2 ε where c μ is constant value is 0 09 2 3 analysis process in the process of simulation this paper analyzes the flow velocity turbulent kinetic energy and pressure of the jet end outlet of crude and product oil as transportation pipelines the density of crude is 870 kg m3 and the viscosity is 10 mpa s the density of product oil is 830 kg m3 and the viscosity is 0 00332 mpa s in this paper the design of the discharge hole on the jet end disc is made and the internal surface of the baffle plate is changed which makes use of the contraction curve of the water tunnel experimental platform the contraction curve of the water tunnel experimental platform can improve the state of the flow beam uniformly accelerate the fluid reduce the turbulence reduce the fluid noise and save energy morel et al 1975 mikhail et al 1979 su et al 1991 fang et al 2001 zhou et al 2009 the curve equations used in this paper are trigonometric function curve such as formula 5 3 order function curve such as formula 6 5 order function curve two kinds such as equation group 7 witonzinsky curve such as formula 8 zhou et al 2009 as shown in fig 3 5 r 7 cos π x 2 5 6 r 8 14 1 4 x 2 5 3 0 x l 0 5 4 1 x 2 5 2 0 5 x l 1 7 r 8 14 1 6 x 2 5 3 7 x 2 5 4 2 x 2 5 5 x m 0 4 1 10 x 2 5 3 15 x 2 5 4 6 x 2 5 5 x m 0 5 8 r 8 1 1 8 22 2 1 3 x 2 7 5 2 1 x 2 7 5 3 in this paper the flow field of the jet end in crude pipeline and product oil pipeline is analyzed respectively and the maximum values of pressure turbulence kinetic energy and flow velocity at different axial positions are collected as shown in fig 4 the results of grid independence research are shown in fig 5 when the grid size is less than 1 3 mm the grid size has less than 1 impact on the results and it is determined that it has no impact on the simulation 3 results and analysis 3 1 crude pipeline environment in the crude pipeline environment the working flow field of the jet end with different baffles is shown in fig 6 the maximum values of pressure turbulent kinetic energy and velocity at different axial positions for different jet ends are shown in fig 7 fig 8 and fig 9 the curve segment starts from 5 mm and it can be found that all parameters produce extreme points at 5 mm for the pressure the change trend of each curve is the same almost no change occurs in the range of 0 5 mm and continues to decline in the range of 5 7 5 mm it can be clearly seen that the straight board baffle has the maximum pressure value in the range of 0 5 mm and its change is also cliff type compared with the three order function curve baffle its change is relatively gentle the pressure of baffles with different surfaces becomes similar when the beam reaches the outlet 7 5 mm for turbulent kinetic energy the release of turbulent kinetic energy at the end of the jet can effectively break up the aggregation of the pipe wall but the release at other positions will cause energy loss therefore the judgment of turbulent kinetic energy should be based on the total turbulent kinetic energy in the range of 0 5 mm and the turbulent flow energy at 7 5 mm it can be found that the turbulent kinetic energy consumed by the straight board is the largest in the range of 0 5 mm followed by the linear function baffles and the witonzinsky function curve baffles the turbulent kinetic energy of the other baffles is basically the same the turbulent kinetic energy released by the witonzinsky function curve baffle is the largest at 7 5 mm followed by the five order function x 0 5 curve baffle for the velocity the article mentioned the influence of velocity on paraffin condensation in the introduction the variation of velocity is positively related to the shear force of jet from the result the velocity of straight board baffle is the highest at 7 5 mm the second is linear function baffle and the velocity of other baffle is basically the same at 7 5 mm the influence of pressure turbulent kinetic energy and jet velocity on pigging effect needs further experiments which is also the next work 3 2 product oil pipeline environment in the product oil pipeline environment the working flow field of the jet end with different baffle surfaces is shown in fig 10 the maximum values of pressure turbulence kinetic energy and velocity at different axial positions for different jet ends are shown in fig 11 fig 12 and fig 13 with regard to the pressure it is still clear that the straight board baffles have the maximum pressure value in the range of 0 5 mm but the changes of these baffles are basically the same in comparison the jet end value of the baffles with witonzinsky function curve is kept at the minimum in the range of 0 4 5 mm and 5 5 7 5 mm when the jet end works in the product oil pipeline compared with the crude oil pipeline the turbulent kinetic energy becomes very small which is 50 times different which is related to the viscosity coefficient of the product oil therefore when the jet end works in the product oil pipeline the impact of the turbulence kinetic energy factors should be ignored for the flow rate the article mentioned the effect of the flow rate on paraffin condensation in the introduction the change of the flow rate is positively related to the shear force of the jet so from the results the straight board baffle has the same advantages in the product oil pipeline 3 3 flow field analysis of structure without discharge hole at the same time the simulation results of the structure without discharge hole are shown in fig 14 and fig 15 through the simulation image of the working flow field it can be seen that compared with the jet end with discharge hole the structure without discharge hole will generate turbulence at the edge of the disc and consume jet energy at the same time the discharge hole can play the role of diversion and improve the jet effect the maximum values of pressure turbulent kinetic energy and flow velocity in different axial positions of the flow field without discharge hole structure are shown in fig 16 and fig 17 compared with the jet end without a discharge hole the jet end with a discharge hole has smaller pressure velocity and turbulent kinetic energy but the variation law is basically the same 4 experimental study we use a simple experimental platform to verify the flow field of the jet end with and without holes in the disk the schematic diagram of the experimental device is shown in fig 18 the specific work of the jet end is to use its own structure to blow 2 mm and 3 mm glass spheres respectively in a transparent acrylic tube and determine the different flow field by observing the state of the spheres in the flow field the physical model of the jet end is shown in fig 19 and the total length of the pipeline is 1000 mm the blow off test results of 2 mm glass beads are shown in fig 20 and the blow off test results of 3 mm glass beads are shown in fig 21 we can find that in the 2 mm glass bead blowing experiment witonzinsky baffle jet end without discharge hole has the best blowing effect followed by the straight baffle jet end in the 3 mm glass bead blowing experiment the straight baffle jet end has the best blowing effect followed by witonzinsky baffle jet end with discharge hole 5 conclusion this paper presents a jet end of intelligence pig robot uipr device which can shoot a high speed flow beam on the inner wall of the pipe at the end of the pig robot so as to remove the dirt on the pipe wall and prevent the dirt from blocking downstream of the pig robot the jet end includes the body and baffle structure in this paper the internal surface of baffle structure is improved which use the contraction curve equation of water tunnel experimental platform in this paper the crude pipeline environment and the product oil pipeline environment are simulated in the simulation study according to the axial position the corresponding highlight is drawn it is found that there is a certain rule in the formation process of high speed flow beam in the crude pipeline the simulation results of baffles are obviously different from the results of zhou zhou et al 2009 which is due to the large difference between the viscosity coefficient of crude oil and water in the product pipeline the simulation results are similar to the results of zhou zhou et al 2009 and the pig using the deflector with witonzinsky curve and the five order function x 0 5 curve has good performance in the crude pipeline the linear baffle has the largest flow velocity at the outlet the total turbulent energy of the witonzinsky function curve is the minimum which effectively reduces the energy loss the composite jet end with the five order x 0 5 curve has the slowest descending speed in the range of 5 7 5 mm of the outlet in the product pipeline the jet end with straight board has advantages in flow rate witonzinsky baffle jet end has advantages in turbulent kinetic energy and pressure the head loss of the five order curve is small the simulation results show that different internal surfaces of baffles will have a greater impact on the results of the jet end and the change of this value is more than 10 in this paper the experiments of 2 mm glass beads and 3 mm glass beads are also carried out in the 2 mm glass bead blowing experiment witonzinsky baffle jet end without discharge hole has the best blowing effect followed by the straight baffle jet end in the 3 mm glass bead blowing experiment the straight baffle jet end has the best blowing effect followed by witonzinsky baffle jet end with discharge hole the simulation results still need to be verified by experiments which will be one of the future work credit authorship contribution statement shangjunnan liu methodology software validation formal analysis investigation resources data curation writing original draft writing review editing supervision shuhai liu writing original draft writing review editing project administration funding acquisition huaping xiao writing original draft declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this work was supported by science foundation of china university of petroleum beijing no 2462020xkjs01 appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j oceaneng 2020 108092 
21521,wax and other precipitates deposit on the inner wall of the pipeline during the transportation of petroleum and its products they greatly reduce the transportation efficiency and cause potential safety hazards in the process of offshore oil production and transportation it is easier to produce wax and precipitates because of the low temperature and high pressure which causes more serious issues the jet end is a key component of underwater intelligent pigging robot uipr because performance of wax and precipitates removal highly depends on the high speed flow generated by the jet end in this paper the influence of the structural parameters of the jet end on the downstream flow field is analyzed by using the simulation method of k epsilon the simulation results show that different internal surfaces of baffles will have a greater impact on the pressure velocity and turbulent kinetic energy of the flow field and the change of turbulent kinetic energy and velocity is more than 10 the baffle with witonzinsky curve is found to superior in increasing turbulence kinetic energy and pressure in addition an orifice in the disc of jet cylinder contributes to reduce the pressure near the jet end and the loss of turbulent kinetic energy keywords offshore pipeline uipr robot pigging technology jetting device 1 introduction pigging technology is an effective maintenance method in the process of oil transportation in the process of oil pipeline paraffin and other impurities combined condensate generate from petroleum flow and deposit on the inner wall of the pipeline which reduces the transportation efficiency of petroleum and leads to potential security risks like pipeline blockage ararimeh aiyejina studied the problem of paraffin condensation on the oil pipe wall in 2011 ararimeh et al 2011 his article described the cause of paraffin condensation in detail wang further analyzed and sorted out this problem in 2014 wang et al 2014 in order to remove pipeline impurities pig has been proposed and become one of the most effective pigging methods for offshore pipeline pig robots are usually used to clean up oil pipeline which include pipeline cleaning pipeline detection and other functions royal dutch shell group of companies successfully developed a pigging machine with detection function as early as 1940s which can simply carry out pipeline detection and complete pigging operation zhang 1998 to improve performance of pigging robots great efforts have been paid on their function and structure design m h w hendrix used the experimental platform to study the friction behavior of disc pig and quantified the corresponding difference of coulomb friction coefficient by finite element calculation m h w hendrix et al 2018 ali ahmadian mazreah proposed a pig model in 2017 effectively eliminating the impact of hydraulic transient ali et al 2017 in 2018 zhang and dong designed a pigging structure with pneumatic deformation adjustment by using simulation and experimental methods zhang et al 2020 devesh mishra proposed a pig for long distance pipeline in 2019 devesh et al 2019 in the field of offshore oil engineering because of the low temperature and high pressure environment under water the paraffin condensation problem on the oil pipeline becomes more serious the paraffin precipitation from crude oil will be affected by the material of pipeline the internal flow rate of pipeline and the temperature difference between the liquid and the pipe wall the specific performance is as follows a the paraffin precipitation phenomenon is more likely to occur in the soft pipeline than in the hard pipeline b the flow rate of the oil in the pipe will affect the shear force of the oil on the pipe wall and the oil flow in the laminar flow condition is easier to condense paraffin on the pipe wall c the wax evolution characteristics of the crude depend on the temperature of the crude and the temperature difference between the crude and the pipe wall which was studied by yang liu huang and others huang qiyu et al 2006 pu et al 2011 liu et al 2012 tian zhen et al 2015 liu rongrong et al 2016 on the 1st north american conference on multiphase technology in 1998 o b rygg pointed out the influence of wax deposition on offshore pipeline systems o b rygg et al 1998 as early as 1986 kiefner j f pointed out the application value and significance of intelligent pig in pipeline nondestructive testing kiefner et al 1986 in 2020 jianheng chen and limin he studied the bypass pigging technology in offshore pipeline jianheng chen et al 2020 jianheng chen and limin he studied the structural parameters of jetting pig and movement characteristics of liquid loading in the process of pigging in 2018 and then studied the jetting pigging technology in offshore pipeline jianheng chen et al 2018 jianheng chen et al 2020 by means of experiments and simulations the influence of controlling the bypass quantity on the working effect of the pig has been tested the results show that the jet pig can effectively control the downstream two phase flow pattern it realizes the regular distribution of downstream liquid impurities in the gas pipeline which innovates the current study intelligent pig has also been used in the subsea intelligent pipeline system in 2014 chapter 4 of subsea pipeline integrity and risk management written by yong bai and qian bai 2014 proposed the subsea intelligent pipeline system with intelligent pipeline pigging device mohammed s el abbasy used the artificial neural network model to predict risks of the offshore oil and gas pipeline yong et al 2014 mohammed et al 2014 compared with the intelligent pipeline intelligent cleaning robot has the advantage in adaptability they are able to serve for both new smart pipes and conventional pipes those conventional pipes are more inclined to use simple pigging foam or pigging balls a jet end for underwater intelligent pigging robot uipr is proposed in this study aiming for flexible application for both conventional and intelligent pipelines because of the jet end the paraffin and other impurities on the inner surface of the pipeline can be washed by launching a high kinetic energy flow to complete the pigging task compared with the traditional pig and pig ball the jet end of uipr can launch high speed fluid which can break up the accumulation dredge the pipeline and reduce the wax plug risk through the software simulation this paper analyzes the jet flow field at the jet end of uipr as well as the pressure turbulence kinetic energy and velocity of the jet flow field at the exit increase the jet velocity and reduce the energy loss caused by turbulence kinetic energy 2 method the jet end of uipr is divided into two parts accelerating bucket and baffle the accelerating bucket has a traditional pig structure which is composed of two discs and accelerating channels the baffles are disc shaped and fixed at the end of the accelerating bucket outlet the jet end has an axial symmetric structure in this paper its research model is simplified the two dimensional flow field model replaces the three dimensional flow field model its basic size and structure are shown in fig 1 the flow field model of pipeline and jet end is shown in fig 1 c 2 1 mechanical model the mechanical model of the jet end is analyzed as shown in fig 2 it is subjected to gravity pressure upstream and downstream of the flow field fluid drag force pipe wall friction and jet pressure on the baffles the energy conservation equation model of the jet end is established as formula 1 1 m d v p i g d t s p i p e s h p 1 p 2 f f m g sin α f h f p b where s pipe is the sectional area of the pipeline s h is the area of jet hole p 1 is the upstream pressure of the pig p 2 is the downstream pressure of the pig ɑ is the angle between the pipeline and the horizontal plane p b is the pressure borne by the baffles f hf is the drag force of the fluid 2 2 finite element model for the analysis of mechanical model this paper uses the finite element method which is widely used in the research of rigid body flexible body fluid thermal electromagnetic and other disciplines the physical model of jet end working in pipeline is simplified as follows a the fluid medium fills the pipeline b the fluid medium is newtonian fluid which is incompressible and satisfies newtonian internal friction law c the simulated environment is a gravity field of 9 8 m s2 in the y axis direction d the inlet flow rate is 1 2 m s and the outlet pressure is 1000000pa according to the hydrodynamics analysis the equation of motion is obtained as shown in formula 2 2 d v x d t div v x v div μ grad v x 1 ρ d p d x d v y d t div v y v div μ grad v y 1 ρ d p d y d v z d t div v z v div μ grad v z 1 ρ d p d z where v is the velocity vector of fluid v x v y and v z are the velocity components of x axis y axis and z axis t is the time μ dynamic viscosity ρ is the density of fluid the turbulence model adopts the standard k epsilon model in fluent module and its turbulent flow energy k and dissipation rate ε mathematical model are shown in formula 3 3 t ρ k x i ρ k u i x j μ μ t σ k k x j g k g b ρ ε y m s k t ρ ε x i ρ ε u i x j μ μ t σ ε ε x j c 1 ε ε k g k c 3 ε g b c 2 ε ρ ε 2 k s ε where g k represents the turbulent kinetic energy generated by the average velocity gradient g b represents the turbulent kinetic energy generated by the buoyancy y m represents the impact of the fluctuating expansion in the compressible turbulence on the total dissipation rate c 1ε c 2ε and c 3ε are constants σ ε σ k are k and ε prandtl numbers the turbulent viscosity μt model is shown in formula 4 4 μ t ρ c μ k 2 ε where c μ is constant value is 0 09 2 3 analysis process in the process of simulation this paper analyzes the flow velocity turbulent kinetic energy and pressure of the jet end outlet of crude and product oil as transportation pipelines the density of crude is 870 kg m3 and the viscosity is 10 mpa s the density of product oil is 830 kg m3 and the viscosity is 0 00332 mpa s in this paper the design of the discharge hole on the jet end disc is made and the internal surface of the baffle plate is changed which makes use of the contraction curve of the water tunnel experimental platform the contraction curve of the water tunnel experimental platform can improve the state of the flow beam uniformly accelerate the fluid reduce the turbulence reduce the fluid noise and save energy morel et al 1975 mikhail et al 1979 su et al 1991 fang et al 2001 zhou et al 2009 the curve equations used in this paper are trigonometric function curve such as formula 5 3 order function curve such as formula 6 5 order function curve two kinds such as equation group 7 witonzinsky curve such as formula 8 zhou et al 2009 as shown in fig 3 5 r 7 cos π x 2 5 6 r 8 14 1 4 x 2 5 3 0 x l 0 5 4 1 x 2 5 2 0 5 x l 1 7 r 8 14 1 6 x 2 5 3 7 x 2 5 4 2 x 2 5 5 x m 0 4 1 10 x 2 5 3 15 x 2 5 4 6 x 2 5 5 x m 0 5 8 r 8 1 1 8 22 2 1 3 x 2 7 5 2 1 x 2 7 5 3 in this paper the flow field of the jet end in crude pipeline and product oil pipeline is analyzed respectively and the maximum values of pressure turbulence kinetic energy and flow velocity at different axial positions are collected as shown in fig 4 the results of grid independence research are shown in fig 5 when the grid size is less than 1 3 mm the grid size has less than 1 impact on the results and it is determined that it has no impact on the simulation 3 results and analysis 3 1 crude pipeline environment in the crude pipeline environment the working flow field of the jet end with different baffles is shown in fig 6 the maximum values of pressure turbulent kinetic energy and velocity at different axial positions for different jet ends are shown in fig 7 fig 8 and fig 9 the curve segment starts from 5 mm and it can be found that all parameters produce extreme points at 5 mm for the pressure the change trend of each curve is the same almost no change occurs in the range of 0 5 mm and continues to decline in the range of 5 7 5 mm it can be clearly seen that the straight board baffle has the maximum pressure value in the range of 0 5 mm and its change is also cliff type compared with the three order function curve baffle its change is relatively gentle the pressure of baffles with different surfaces becomes similar when the beam reaches the outlet 7 5 mm for turbulent kinetic energy the release of turbulent kinetic energy at the end of the jet can effectively break up the aggregation of the pipe wall but the release at other positions will cause energy loss therefore the judgment of turbulent kinetic energy should be based on the total turbulent kinetic energy in the range of 0 5 mm and the turbulent flow energy at 7 5 mm it can be found that the turbulent kinetic energy consumed by the straight board is the largest in the range of 0 5 mm followed by the linear function baffles and the witonzinsky function curve baffles the turbulent kinetic energy of the other baffles is basically the same the turbulent kinetic energy released by the witonzinsky function curve baffle is the largest at 7 5 mm followed by the five order function x 0 5 curve baffle for the velocity the article mentioned the influence of velocity on paraffin condensation in the introduction the variation of velocity is positively related to the shear force of jet from the result the velocity of straight board baffle is the highest at 7 5 mm the second is linear function baffle and the velocity of other baffle is basically the same at 7 5 mm the influence of pressure turbulent kinetic energy and jet velocity on pigging effect needs further experiments which is also the next work 3 2 product oil pipeline environment in the product oil pipeline environment the working flow field of the jet end with different baffle surfaces is shown in fig 10 the maximum values of pressure turbulence kinetic energy and velocity at different axial positions for different jet ends are shown in fig 11 fig 12 and fig 13 with regard to the pressure it is still clear that the straight board baffles have the maximum pressure value in the range of 0 5 mm but the changes of these baffles are basically the same in comparison the jet end value of the baffles with witonzinsky function curve is kept at the minimum in the range of 0 4 5 mm and 5 5 7 5 mm when the jet end works in the product oil pipeline compared with the crude oil pipeline the turbulent kinetic energy becomes very small which is 50 times different which is related to the viscosity coefficient of the product oil therefore when the jet end works in the product oil pipeline the impact of the turbulence kinetic energy factors should be ignored for the flow rate the article mentioned the effect of the flow rate on paraffin condensation in the introduction the change of the flow rate is positively related to the shear force of the jet so from the results the straight board baffle has the same advantages in the product oil pipeline 3 3 flow field analysis of structure without discharge hole at the same time the simulation results of the structure without discharge hole are shown in fig 14 and fig 15 through the simulation image of the working flow field it can be seen that compared with the jet end with discharge hole the structure without discharge hole will generate turbulence at the edge of the disc and consume jet energy at the same time the discharge hole can play the role of diversion and improve the jet effect the maximum values of pressure turbulent kinetic energy and flow velocity in different axial positions of the flow field without discharge hole structure are shown in fig 16 and fig 17 compared with the jet end without a discharge hole the jet end with a discharge hole has smaller pressure velocity and turbulent kinetic energy but the variation law is basically the same 4 experimental study we use a simple experimental platform to verify the flow field of the jet end with and without holes in the disk the schematic diagram of the experimental device is shown in fig 18 the specific work of the jet end is to use its own structure to blow 2 mm and 3 mm glass spheres respectively in a transparent acrylic tube and determine the different flow field by observing the state of the spheres in the flow field the physical model of the jet end is shown in fig 19 and the total length of the pipeline is 1000 mm the blow off test results of 2 mm glass beads are shown in fig 20 and the blow off test results of 3 mm glass beads are shown in fig 21 we can find that in the 2 mm glass bead blowing experiment witonzinsky baffle jet end without discharge hole has the best blowing effect followed by the straight baffle jet end in the 3 mm glass bead blowing experiment the straight baffle jet end has the best blowing effect followed by witonzinsky baffle jet end with discharge hole 5 conclusion this paper presents a jet end of intelligence pig robot uipr device which can shoot a high speed flow beam on the inner wall of the pipe at the end of the pig robot so as to remove the dirt on the pipe wall and prevent the dirt from blocking downstream of the pig robot the jet end includes the body and baffle structure in this paper the internal surface of baffle structure is improved which use the contraction curve equation of water tunnel experimental platform in this paper the crude pipeline environment and the product oil pipeline environment are simulated in the simulation study according to the axial position the corresponding highlight is drawn it is found that there is a certain rule in the formation process of high speed flow beam in the crude pipeline the simulation results of baffles are obviously different from the results of zhou zhou et al 2009 which is due to the large difference between the viscosity coefficient of crude oil and water in the product pipeline the simulation results are similar to the results of zhou zhou et al 2009 and the pig using the deflector with witonzinsky curve and the five order function x 0 5 curve has good performance in the crude pipeline the linear baffle has the largest flow velocity at the outlet the total turbulent energy of the witonzinsky function curve is the minimum which effectively reduces the energy loss the composite jet end with the five order x 0 5 curve has the slowest descending speed in the range of 5 7 5 mm of the outlet in the product pipeline the jet end with straight board has advantages in flow rate witonzinsky baffle jet end has advantages in turbulent kinetic energy and pressure the head loss of the five order curve is small the simulation results show that different internal surfaces of baffles will have a greater impact on the results of the jet end and the change of this value is more than 10 in this paper the experiments of 2 mm glass beads and 3 mm glass beads are also carried out in the 2 mm glass bead blowing experiment witonzinsky baffle jet end without discharge hole has the best blowing effect followed by the straight baffle jet end in the 3 mm glass bead blowing experiment the straight baffle jet end has the best blowing effect followed by witonzinsky baffle jet end with discharge hole the simulation results still need to be verified by experiments which will be one of the future work credit authorship contribution statement shangjunnan liu methodology software validation formal analysis investigation resources data curation writing original draft writing review editing supervision shuhai liu writing original draft writing review editing project administration funding acquisition huaping xiao writing original draft declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this work was supported by science foundation of china university of petroleum beijing no 2462020xkjs01 appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j oceaneng 2020 108092 
21522,a non hydrostatic shock capturing model is developed to address deep water wave evolution including wave breaking the present model is based on the euler equations with a hybrid finite volume finite difference fv fd method and the high resolution godunov type numerical scheme using these numerical schemes wave breaking can be captured as a shock or a hydraulic jump without adopting additional wave breaking parameters or terms such as breaking onset criteria the parallel method of the message passing interface mpi is used to accelerate the simulation this model was applied to simulate deep water wave propagation including breaking as a consequence of dispersive focusing or due to the modulational instability by comparison with existing experiments the ability of the present model to predict breaking onset and breaking energy dissipation is evaluated additionally a dynamic criterion is applied to provide additional information on wave breaking onset and the wavelet transform is applied to predict the energy as a function of frequency and time keywords non hydrostatic model shock capturing wave breaking wavelet transform 1 introduction one of the least understood and yet important events in the ocean upper layer is the breaking of surface waves as opposed to shallow water deep water implies a depth that is sufficiently large that the surface waves are unaffected by the variations in bed topography thus even a small pond can support breaking deep water waves banner and peregrine 1993 generally laboratory researchers use dispersive wave packets or the modulational instability to generate breaking waves in deep water babanin 2011 by varying the wave trains in experiments and numerical models one can obtain different breaker types including plunging breakers and spilling breakers wave breaking is a complicated and very rapid process and due to its usual two phase flow causes difficulties in laboratory observation and measurements alternatively numerical simulation may be used to study wave breaking at present although many wave breaking treatment techniques have been developed detailed breaking processes remain elusive perlin et al 2013 many researchers have developed different models to simulate the process of wave breaking based on various explanations of the attendant physical mechanisms additionally various methods have been implemented to dissipate energy in these schemes for breaking induced energy dissipation models typically three types are used eddy viscosity models surface roller models and vorticity models in eddy viscosity models dissipation due to turbulence generated by wave breaking is treated by a diffusion term in the momentum equations the amount of dissipation is governed by the value of the eddy viscosity coefficient which can be expressed in terms of a mixing length parameter kennedy et al 2000 zelt 1991 the surface roller concept was introduced by svendsen 1984 in which the added term depends on the dynamically determined roller thickness and mean front slope of the breaker along with other parameters that must be tuned during the numerical implementation on the other hand a vorticity model is based on a transport equation for the breaker generated vorticity the above three models require a breaking onset criterion to decide where and when to activate the energy dissipation terms therefore ad hoc parameters are required in these models and some of them are empirical although these energy dissipation models combined with different breaking onset criteria have been widely used for simulating breaking events in deep water and in the swash zone the determination of the breaking related parameters is nontrivial that is the robustness of these approaches remains an issue there is another approach known as shock capturing which does not require added energy dissipation terms to compute the associated energy dissipation nor does it require a breaking onset criterion to have the model know when to initiate breaking in one of these approaches artificial viscosity is implemented via a viscosity term in the 1 d euler equation this restricts numerical oscillations near shocks and was developed by vonneumann and richtmyer 1950 however the extra viscosity terms are not necessary for modern shock capturing methods such as muscl monotonic upstream center scheme for the conservation laws van leer 1979 eno essential non oscillation harten et al 1987 which usually get numerical viscosity from the numerical scheme itself these schemes are also called high resolution schemes and can provide high resolution during shocks i e the sharp shocks are not rounded by numerical diffusion and do not exhibit non physical oscillations near the primary shock although the shock capturing concept originated in aerodynamics it is now used in hydrodynamics first the shock capturing method was applied to solve nonlinear shallow water equations nswe handling bores and dam break flows glaister 1988 dodd 1998 more recently this method has been extended for many problems including wave runup overtopping and wave breaking and it has been utilized in numerical models based on different governing equations including boussinesq type bt equations roeber et al 2010 tonelli and petti 2012 navier stokes n s or euler equations zijlema et al 2011 ma et al 2012 these non hydrostatic models use euler or reynolds averaged navier stokes equations as the governing equations and are even applied to the simulation of breaking waves in deep water with a shock capturing method there appears to be no theoretical limitation on the performance of nonlinearity and dispersion for non hydrostatic models bai and cheung 2013 2015 at least in terms of the governing equations to improve frequency dispersion non hydrostatic models need only have the number of vertical grid points or layers increased zijlema and stelling 2008 second euler equations are hyperbolic equations which admit both continuous and discontinuous solutions wu and cheung 2008 thus they are easily adaptable to shock capturing techniques on the other hand bt models must have the high order dispersive terms turned off to degenerate into nswe that are also hyperbolic additionally non hydrostatic models track the free surface motion using a single valued function compared with marker and cell and volume of fluid techniques although multi valued surfaces cannot be described i e wave overturning cannot be modeled the non hydrostatic models are computationally more efficient in this paper a shock capturing non hydrostatic model is used to simulate wave breaking in deep water in the present model a first order explicit euler scheme for time integration is used and it has proven reliable for the conditions addressed herein in solving shock problems with godunov type finite volume methods there are two critical processes the first is the manner in which the values of the conservative variables at cell faces based on cell data which are defined at the cell center are constructed and it is known as reconstruction the so called weighted essential non oscillation weno schemes are designed for problems with piecewise smooth solutions containing discontinuities thus the third order weno scheme chen and shi 2006 is used to automatically achieve higher order accuracy and non oscillatory properties near discontinuities the second process is to calculate fluxes at cell faces after reconstruction usually thought of as riemann problems herein the approach known as multiple stage musta flux function developed by toro and titarev 2006 is applied as the riemann solver consequently a high resolution godunov type scheme in conjunction with a riemann solver is developed which has remarkable shock capturing capabilities to describe breaking waves as bores and conserve flow volume and momentum across discontinuities roeber et al 2010 last this model is applied to wave breaking induced by both wave energy focusing and by the modulational instability as a final note although these models seem to give reasonable results and most definitely are able to calculate solutions and proceed beyond the break point it is unknown to what extent the model dissipation and results represents reality that is the manner in which they facilitate calculation beyond breaking is not well understood 2 mathematical formulation 2 1 governing equations as mentioned the euler equations are adopted as governing equations referring to ma et al 2012 the euler equations in cartesian coordinates x y z are transformed to σ coordinates x y σ to apply a shock capturing scheme the governing equations are cast in conservation form which preserves the conservative characteristics for the variables as shown in eqs 1 2 with the sigma coordinate transformation the varying vertical coordinate in the physical domain is transformed to a space coordinate where σ spans 0 to 1 and σ 0 represents the bottom and σ 1 represents the surface these equations are as follows 1 d t d u x d v y w σ 0 2 u t f x g y h σ s h s p here the total depth d is the sum of the still water depth h and the free surface elevation η i e d x y t h x y t η x y t u d u d v d w t f g h are flux vectors and s h is a bed slope source term and s p is a dynamic pressure term calculated using the dynamic pressure p referring to liang and marche 2009 the above equations have to be reformulated to balance the flux terms eq 3 and source terms eq 4 as 3 f d u u 1 2 g η 2 g h η d u v d u w g d u v d v v 1 2 g η 2 g h η d v w h u w v w w w 4 s h g η h x g η h y 0 s p d ρ p x p σ σ x d ρ p y p σ σ y 1 ρ p σ additionally the relationship between w i e the vertical velocity in the sigma coordinate and w the vertical velocity in the cartesian coordinate is given by 5 w d σ t u σ x v σ y w σ z applying chain rule differentiation for the transformation between cartesian coordinates and σ coordinates ma et al 2012 gives 6 w w h t σ d t u h x σ d x v h y σ d y integrating eq 1 over σ from 0 through 1 and using the boundary conditions at the free surface and at the bottom for w we obtain the equation for calculating free surface 7 d t x d 0 1 u d σ y d 0 1 v d σ 0 the layout of the computational variables and the boundary conditions including kinematic boundary conditions and pressure conditions at the free surface and bottom can be found in ma et al 2012 2 2 numerical method 2 2 1 time integration scheme for hyperbolic equations time marching is a common solution technique the explicit first order euler scheme is used for the time integration additionally the dynamic pressure and hydrostatic pressure are solved using a predictor corrector method which is quite different from some non hydrostatic models that solve the pressure in two fractional steps the predictor corrector scheme can be written as 8 u u n δ t f x g y h σ n s h n s p n 9 u n 1 u δ t s p n 1 s p n s δ p n 1 eq 8 is the predictor step while eq 9 is the corrector step for the velocity field predicted by eq 8 u is an intermediate variable and u n u n 1 are u values at the time levels n and n 1 rather than using a fractional step to calculate the dynamic pressure u with s p n the dynamic pressure at time level n u is corrected by δ p the differential value of the dynamic pressure between time levels n and n 1 to give u n 1 from eq 9 we obtain 10 d u n 1 d u δ t ρ d δ p x δ p σ σ x n 1 11 d v n 1 d v δ t ρ d δ p y δ p σ σ y n 1 12 d w n 1 d w δ t ρ δ p n 1 σ it is noted that the conservative variables d u d v d w are used in eqs 10 12 rather than u v and w applying the principle of σ coordinate transformation eq 1 can be expressed as 13 d u x d u σ σ x d v y d v σ σ y w σ 0 substituting eqs 10 12 into eq 13 a poisson type equation is obtained for δ p in the sigma coordinate system as presented in eq 14 with δ p known the dynamic pressure at time step n 1 can be obtained and velocities at each stage can be updated 14 d x δ p x δ p σ σ x d y δ p y δ p σ σ y d σ δ p x σ x d σ δ p y σ y d σ x 2 σ y 2 1 σ δ p σ d x δ p x δ p σ σ x d y δ p y δ p σ σ y ρ δ t d u x d u σ σ x d v y d v σ σ y w σ eq 14 is discretized with the second order space centered finite difference method the conservative variables d u d v d w at vertical cell faces are found by interpolation of adjacent cell centered values the resulting linear equation is given by 15 a 1 p i j 1 k 1 a 2 p i 1 j k 1 a 3 p i j k 1 a 4 p i 1 j k 1 a 5 p i j 1 k 1 a 6 p i j 1 k a 7 p i 1 j k a 8 p i j k a 9 p i 1 j k a 10 p i j 1 k a 11 p i j 1 k 1 a 12 p i 1 j k 1 a 13 p i j k 1 a 14 p i 1 j k 1 a 15 p i j 1 k 1 r p where a 1 d i j σ y i j 1 k 2 δ y δ σ k δ σ k 1 σ y i j k 2 δ y δ σ k δ σ k 1 a 2 d i j σ x i 1 j k 2 δ x δ σ k δ σ k 1 σ x i j k 2 δ x δ σ k δ σ k 1 a 3 d i j σ x 2 σ y 2 1 d i j 2 i j k 0 5 δ σ k δ σ k 1 δ σ k 1 d x i j σ x δ σ k δ σ k 1 d y i j σ y δ σ k δ σ k 1 a 4 d i j σ x i 1 j k 2 δ x δ σ k δ σ k 1 σ x i j k 2 δ x δ σ k δ σ k 1 a 5 d i j σ y i j 1 k 2 δ y δ σ k δ σ k 1 σ y i j k 2 δ y δ σ k δ σ k 1 a 6 d i j δ y 2 d y i j 1 2 δ y a 7 d i j δ x 2 d x i j 1 2 δ x a 8 2 δ x 2 2 δ y 2 σ x 2 σ y 2 1 d 2 i j k 0 5 δ σ k δ σ k 1 δ σ k σ x 2 σ y 2 1 d 2 i j k 0 5 δ σ k δ σ k 1 δ σ k 1 a 9 d i j δ x 2 d x i j 1 2 δ x a 10 d i j δ y 2 d y i j 1 2 δ y a 11 d i j σ y i j 1 k 2 δ y δ σ k δ σ k 1 σ y i j k 2 δ y δ σ k δ σ k 1 a 12 d i j σ x i 1 j k 2 δ x δ σ k δ σ k 1 σ x i j k 2 δ x δ σ k δ σ k 1 a 13 σ x 2 σ y 2 1 d 2 i j k 0 5 δ σ k δ σ k 1 δ σ k d x i j σ x δ σ k δ σ k 1 d y i j σ y δ σ k δ σ k 1 a 14 d i j σ x i 1 j k 2 δ x δ σ k δ σ k 1 σ x i j k 2 δ x δ σ k δ σ k 1 a 15 d i j σ y i j 1 k 2 δ y δ σ k δ σ k 1 σ y i j k 2 δ y δ σ k δ σ k 1 r p ρ δ t u x u σ σ x v y v σ σ y 1 d w σ also σ x σ x σ y σ y as is evident the coefficient matrix is asymmetric and has a total of 15 diagonal lines the mpi openmp hybrid programming technique and high performance preconditioner hypre library are chosen to solve this linear system 2 2 2 shock capturing spatial finite volume scheme it is noted that space discretization is the key to implementing shock capturing methods a combined finite volume fv and finite difference scheme with a godunov type method is applied to discretize eqs 1 2 in the framework of the fv method fluxes as shown in eq 3 based on the conservative variable are required at the cell faces the values of the conservative variables at the cell faces are calculated using a reconstruction method based on the cell center data in this paper the third order weighted essentially non oscillatory method chen and shi 2006 is used for the reconstruction of variables at the cell faces in the horizontal direction for problems comprising both shocks and complex smooth solution structures weno schemes can provide higher accuracy than second order schemes along with good resolution near discontinuities for cell i j a reconstruction function p i j x y is introduced the reconstruction at cell faces i 1 2 j and i j 1 2 is 16 u i 1 2 j p i 1 2 1 2 j x i 1 2 y j u i j 1 2 p i j 1 2 1 2 x i y j 1 2 u i 1 2 j p i 1 2 1 2 j x i 1 2 y j u i j 1 2 p i j 1 2 1 2 x i y j 1 2 where the superscript and represent right and left respectively p i j x y is defined as 17 p i j x y 1 θ x y p i x θ x y p j y in eq 17 0 θ x y 1 and θ x i 1 2 y j 0 θ x j y j 1 2 1 here p i x only is provided while p j y is easily obtained as 18 p i x ω l p l x ω r p r x ω c p c x where 19 p l x u i j u i j u i 1 j 2 x x j p r x u i j u i 1 j u i j 2 x x j p c x u i j 1 12 u i 1 j 2 u i j u i 1 j 1 12 u i j 1 2 u i j u i j 1 u i 1 j u i 1 j 2 δ x x x j u i 1 j 2 u i j u i 1 j δ x 2 x x j 2 and the weighting values are 20 ω i α i m α m α i c i ε i s i i m l r c c l c r 1 4 c c 1 2 the smoothing factors are 21 i s l u i j u i 1 j 2 i s r u i 1 j u i j 2 i s c 13 3 u i 1 j 2 u i j u i 1 j 2 1 4 u i 1 j u i 1 j 2 the same procedure is applied to the y direction after the reconstruction mentioned above a local riemann problem is formed at each cell face due to the different left values and right values some approximate riemann solvers such as hll and roe have been widely and successfully used in godunov type schemes however one needs to calculate the detailed eigen structure of the governing equations which are complex computationally expensive and sometimes difficult to achieve in the present study a musta scheme is employed for the flux evaluation which does not require the use of an eigen structure and hence is more efficient than roe and hll schemes toro and titarev 2006 referring to fang et al 2015 we have the following numerical algorithm to calculate the musta flux step 1 to compute the flux evaluation the flux at cell face i 1 2 is determined by 22 f i k f u i k f i 1 k f u i 1 k u i 1 2 k 1 2 u i k u i 1 k 1 2 δ t δ x f i 1 k f i k f m k f u i 1 2 k f i 1 2 k 1 4 f i k 2 f m k f i 1 k δ x δ t u i 1 k u i k if k k the process ends k is the predefined total number of steps and k represents the k t h step step 2 so called opening of the riemann fan 23 u i k 1 u i k δ x δ t f i 1 2 k f i k u i 1 k 1 u i 1 k δ x δ t f i 1 k f i 1 2 k step 3 return to step 1 in theory the larger the number of stages k the closer the resulting numerical flux is to the exact riemann solver nevertheless the choice k 1 is recommended for practical applications according to previous studies the above procedure is also applied to the y direction 3 numerical results to examine the capability of the present model for simulating wave breaking the experimental data of tian et al 2012 are used to compare with the simulation results including the free surface total potential energy density and power spectral density in addition to their dispersive focusing results the modulational instability to induce breaking is considered as well 3 1 dispersive focused wave groups the incident wave group is generated at the model upstream boundary for the focusing wave groups the total surface elevation η at the incident wave boundary x 0 far left of the computational domain shown in fig 1 is described as 24 η 0 t i 1 n a i cos 2 π f i t t b k i x b where n is the number of sinusoidal components a i f i and k i are the amplitude cyclic frequency and wavenumber of the i th wave component respectively and x b 7 0 m and t b 25 0 s are the predefined focusing location and the time of breaking the discrete frequencies f i are uniformly spaced over the band 1 0 2 4 hz i e the frequency bandwidth δ f 1 4 hz with a central frequency defined by f c f n f 1 2 by varying the global steepness s i 1 n a i k i and the non dimensionalized bandwidth δ f f c different breaking intensities can be generated the input wave group parameters for the simulation cases are summarized in table 1 from tian et al 2012 tp1 is a non breaking case while tp2 tp4 are breaking cases with the breaking strength increasing with increasing steepness simulations of the dispersive focusing wave groups are conducted in a numerical wave tank 20 0 m long with a sponge layer placed in the domain from 15 m 20 m as shown in fig 1 the grid resolution in the horizontal direction is 0 01 m about 1 80 of the wavelength for the center frequency wave component and a constant time step 0 001 s is used in the simulations the total simulation period is 40 95 s which is sufficient for the wave groups to propagate beyond the end of the flume fig 2 shows the simulated surface elevations at locations in front and behind the predefined focusing points for tp1 tp4 all the simulations are conducted with 124 σ levels note that convergence is discussed in the appendix as shown in these figures there is no doubt that the larger the initial global wave steepness the closer the wave focus location which is accompanied also by larger wave surface elevations wave breaking events occurred earlier for cases with larger steepness see tp3 and tp4 tian et al 2012 reported that for case tp4 there were multiple breakers far upstream of x b 7 0 m roughly from x 4 8 m to 9 6 m where wave breaking occurred at different locations repeatedly generally the simulation results agree quite well with the experimental data in both amplitude and phase the most remarkable discrepancy appears near the focusing breaking region for all the cases especially when wave elevations are close to reaching their maximum this is due likely to the complicated phenomenon of breaking and as is evident there is still an issue for the present model to correctly compute all wave components particularly the high frequency ones fig 3 provides a comparison of the surface variance between the computed and measured surface elevations according to wave theory the variance is proportional to the local energy at a wave measurement location thus the spatial variations of ζ 2 0 t ζ x t 2 d t can be used to quantitatively access the wave variance here refers to time integration and t 40 95 s the major breaking regions in the laboratory experiments are indicated with dash lines note that locations of secondary breaking prior to and or subsequent to the major ones are not indicated as shown in fig 3 clearly the total potential energy as a function of space for both non breaking and breaking wave groups is predicted well in the simulations though the comparison for wave group tp4 the most violent breaking case is not as good as the others for tp4 the present model does capture the dramatic decrease of energy but the values from about x 5 0 m to x 8 0 m do not match well with the experimental data the simulations under predict the energy loss compared with measured data this may be due to the simplified surface stress boundary condition used in both the present model and ma et al 2012 therefore it might be better to take the consistent surface boundary condition derakhti et al 2016a for large wave slope similar underestimation of wave breaking induced energy loss in steepness limited breaking packets was reported in derakhti et al 2016b where the entire energy loss was due to numerical dissipation and that the physical dissipation was approximately zero another possible reason for the discrepancy is the absence of turbulence dissipation or other explicit viscous dissipative terms in the present model considering that shock capturing is a simple technique that requires no tuned parameters and that the breaking intensity of tp4 is a maximum the results are quite reasonable additionally it is noted that oscillations can be observed in numerical results at the focusing breaking areas and this should be and is more evident for the more dramatic breaking cases these oscillations were reported also by the numerical study in tian et al 2010 and in fact these fluctuations may have been present in the experiments however there may have been an insufficient number of wave probes to quantify them fig 3 seems to show that breaking did occur in the numerical results and in the approximate correct locations due to its shock capturing scheme and necessarily single valued free surface treatment the present non hydrostatic model cannot indicate the breaking onset time per se thus a dimensionless parameter δ t is used in post processing to determine further information on breaking onset this is the breaking onset dynamic criterion proposed by song and banner 2002 which could distinguish breaking waves from nonbreaking ones with a threshold range δ c 1 4 0 1 1 0 3 the initial wave group structure as well as the number of waves in the wave groups wind forcing and surface shear has little influence on the threshold range song and banner 2002 δ t is a dimensionless parameter based on the growth rate of the local wave energy density and is given by 25 δ t 1 ω c d μ d t μ e m a x k 2 ρ g here ω c 2 π f c is a characteristic angular frequency e g taken as the initial angular frequency of the center component of the dispersive packet ρ is water density and g is the gravitational acceleration d d t represents the total derivative following the wave group μ is the dimensionless local wave energy density to solve μ k and e m a x must be computed in advance k is the local wavenumber calculated based on two consecutive zero crossings adjacent to the breaking crest as shown in fig 4 compared with other methods this approach for calculating k shows small time fluctuations 21 as shown in fig 5 for non breaking condition tp1 the temporal variation of local wavenumber k exhibits near symmetry with respect to the focusing time t 25 0 s for the breaking cases tp2 tp4 k decreases over time and a sharp decrease was detected at around t 22 5 s for tp3 and tp4 which basically coincides with wave breaking the local wavenumber increases for greater incident wave steepness e m a x is the total energy at the maximum surface displacement determined by summing the kinetic and potential energies of the fluid particles along a vertical line at position x and time t as in eq 26 usually linear wave theory is used to calculate the kinetic energy for e x t in laboratory experiments due to the difficulty of measuring particle velocities beneath breaking waves numerically of course it is simple to compute the kinetic energy 26 e x t h η 1 2 ρ u 2 v 2 w 2 d z 1 2 ρ g η 2 e k e p fig 6 presents the numerical results of the ratio of potential energy to total energy at the maximum surface displacements maximum crests and troughs in the current study the potential energy represents approximately 68 to 70 of the total local energy at the trough maxima the proportion increases slightly with wave steepness while the ratio at crests maxima decreases as the wave steepens compared with the crests the potential energy at the troughs represents a higher percentage of the total energy however the ratio at the crests varies more significantly than at the troughs and change more dramatically as does the breaking intensity taking tp4 as example the ratio decreases from approximately 0 61 to 0 38 as the waves evolve to breaking and returns to its initial value after breaking while for the non breaking case tp1 the ratio decreases from 0 65 to 0 52 a similar change can be found in the numerical results given by derakhti and kirby 2016 in addition the averaging procedure denoted by was proposed by song and banner 2002 to remove large oscillations of μ that was involved in the determination of the upper and lower envelopes of μ the calculation of the time averaged local wave density μ t is non trivial perlin et al 2013 but the μ t with certain time duration is necessary in this process to find extreme points that is it cannot be computed at each time step synchronously thus it is limited for application to numerical models to determine breaking onset in this study the curve fitting toolbox of matlab was used to fit smoothing splines to the respective sets of detected maximum and minimum points of μ t and then the local average μ t was taken as the average of the smooth splined maximum and minimum curves as shown in left panel of fig 7 the growth rate of the breaking parameter δ t is shown in the right panel of fig 7 with threshold values δ c also indicated there by horizontal lines it is quite obvious that numerical tp1 is non breaking because its maximum value of μ t is less than 5 0 1 0 4 one third of δ c in the laboratory experiments tp2 was an incipient spilling breaker this is indicated by δ t of the numerical simulation of tp2 which is just greater than the lower breaking limit 1 3 1 0 3 it is apparent that the value of the breaking parameter increases with the breaking intensity as the maximum values of δ t of tp3 and tp4 exceed the upper breaking limit 1 5 1 0 3 this is especially true in the case tp4 as its δ t has exceeded the threshold much earlier than tp3 this is due to the preceding weaker breaking wave that occurred prior to the main breaker at around t 20 s as observed in the corresponding laboratory measurements by tian et al 2012 thus this dynamic criterion appears to properly detect breaking events from nonbreaking ones in the following the continuous wavelet transform is used to study the spatiotemporal structure and the relative phasing of different wave components in the packet in fig 8 the wavelet transform of the non breaking tp1 and the plunging breaker tp3 are exhibited other breaking cases give similar results with x 3 32 m and 11 06 m far upstream and downstream of the focusing breaking region respectively for both tp1 and tp3 wave components of lower frequencies occurred first and it is obvious that longer waves are more energetic mainly distributed within the range from 1 0 1 5 hz and then it can be seen that all wave components are maximum at the point x 7 22 m which is very close to the predefined focusing point x 7 0 m the predefined focusing point based on linear theory is not the actual focusing point for breaking or nonlinear cases the wavelet spectrum is almost symmetric at x 7 22 m which is also identified as a focusing phenomenon for tp3 it should be noticed also that the energy of higher frequencies above 3 hz grows as the wave focuses however after breaking focusing the energy of the high frequencies is dissipated this trend is apparent in the non breaking tp1 although less obvious 3 2 wave groups subject to modulational instability to study the modulational instability of water waves wave groups composed of a carrier wave and two side band perturbation components are generated the surface displacements at the wavemaker can be described by 27 ζ t a 0 cos ω 0 t b cos ω 1 t π 4 b cos ω 2 t π 4 where ω 0 ω 1 and ω 2 are the angular frequencies of the carrier wave and the lower and the upper side band perturbations respectively a 0 and b are the amplitudes of the carrier wave and the side band perturbations respectively the amplitude ratio b a 0 was in the range 0 3 to 0 5 depending on the specific wave group details of the wave group parameters 23 are given in table 2 the analytical solution of the fifth order stokes wave theory is used to generate the wave at the left input boundary considering the steepness and using a deep water condition in addition the space step d x 0 01 m time step d t 0 001 s and there are 124 vertical levels the same values used for the focusing wave groups similarly integration of the power of the surface displacement ξ 2 is used to detect energy dissipation because it is in direct proportion to the wave total energy the long time 0 50 s integration of the surface variance for these four cases are shown in fig 9 for both cases bfi 1710 and bfi 1716 the energy as a function of space is predicted reasonably well especially considering that multiple breakers occurred at different locations repeatedly in the physical experiments for bfi 1720 the breaking region is roughly from x 4 8 m to x 9 6 m and a dramatic decrease of energy is captured from around 4 0 m to 8 0 m thus the comparison is reasonable to x 8 0 m however obvious disagreement between the simulated and measured results is observed following the violent wave breaking event it seems as though there may have been another breaking wave in the region after x 8 0 m because of another sudden decrement of energy there which our model failed to capture this problem might due to the absence of a turbulence model or other explicit viscous dissipative terms following the insufficient numerical viscosity dissipation and corresponding underestimation of energy loss as mentioned in derakhti et al 2016b note that the decrease of this long time integration for the non breaking case bfi 1710 is due primarily to the fact that the integration is limited from 0 to 50 s that is that not all waves generated upstream had arrived at the downstream wave station during that time span see surface elevation in fig 10 next wavelet analysis is employed to investigate the energy transport mechanism of modulated wave trains fig 10 shows the free surface variation and related wavelet spectra of case bfi 1716 before and after wave breaking respectively according to the laboratory experiments wave breaking was observed roughly in the region from x 7 0 m to x 11 0 m at the wave gauges far upstream of the breaking area fig 10 a the wavelet spectrum is nearly symmetric about the frequency of the carrier wave f 1 7 hz specifically on the leading wave front both the frequency and the amplitude modulate to high frequencies before wave breaking the same trend can be seen in fig 10 b at the right side of each packet rather than left side in fig 10 c and the change of energy of the high frequencies is consistent with increased surface elevation this phenomenon is very similar to the findings from wave group experiments presented by hwung et al 2006 following breaking as the wave trains propagate further downstream the surface deforms significantly due to nonlinearity and eventually a breaking wave occurs meanwhile the peak frequency shifts to a lower frequency after wave breaking 4 conclusions in this paper a surface and terrain following shock capturing non hydrostatic model is presented the governing equations incompressible euler equations are discretized in combined finite volume and finite difference framework with the godunov type method the weno scheme is applied for variables reconstruction to get high resolution near shocks and the musta approximate riemann solver is employed to compute fluxes at cell faces the performance of the model is investigated with several cases especially as it relates to capturing breaking waves and treating breaking induced energy dissipation in deep water dispersive wave packets and modulation instability breaking are simulated these numerical results are compared with corresponding experiments while the wavelet transform technique is used to conduct a preliminary analysis for energy transport in most cases the present model captures reasonably well the breaking waves not only for a single breaking wave but also for multiple breakers additionally the breaking induced energy dissipation is simulated sensibly by the present model thus the shock capturing technique is shown to simulate wave breaking in deep water in a reasonable manner for the most violent breaking cases simulated results are acceptable but they are not as good as they are for milder breaking compared with other wave breaking methods shock capturing models involve no breaking onset criteria and no special energy dissipation terms no ad hoc parameters are required however it must be mentioned that the relationship between shocks discontinuities and breaking waves remains unclear it cannot explain how the energy is dissipated via the equations or formulations and as there are many shock capturing schemes it is difficult to evaluate or quantify their performance on wave breaking especially when combined with other methods in fact in some researchers views shock capturing methods are not reliable as a consequence of their uncertain physical significance importantly due the method being a single valued free surface technique and in the present implementation a single phase flow wave surface overturning and bubble entrainment cannot be described regardless the deviations between the numerical and measured data are reasonable in terms of wave height and energy given the simplicity and robustness of the implementation shock capturing non hydrostatic models should be powerful models to capture wave breaking phenomena credit authorship contribution statement dongbin he methodology software formal analysis writing original draft yuxiang ma conceptualization resources supervision project administration guohai dong writing review editing project administration supervision marc perlin validation formal analysis writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research is supported financially by the national natural science foundation of china grant nos 51720105010 51679031 51979029 liaoning revitalization talents program grant no xlyc 1807010 and the fundamental research funds for the central universities grant no dut2019tb02 appendix usually the nonlinearity and dispersion for non hydrostatic models are improved as the number of vertical layers is increased however for a specified model and a particular case the results may converge when the number of layers reach some value henceforth the model is assessed using the statistical method developed by willmott 1981 28 s k i l l 1 i 1 n ψ i sim ψ i obs 2 i 1 n ψ i sim ψ obs ψ i obs ψ obs 2 where ψ is the variable being compared and ψ is its sample mean perfect agreement between both results yields a skill value of 1 0 whereas complete disagreement yields a skill of 0 in other words as used here skill represents the difference between the results of the free surface elevations as a function of downstream position based on the numbers of layers identified with each curve equivalently it provides a visual convergence based on the number of layers used thus eq 28 is used to calculate the skill for results with varied numbers of layers i e 10 20 31 62 124 to determine the convergence of the present model for case tp4 subscripts sim and obs represent the results from a varied number of layers for example the legend named 20 and 10 stands for predictive skill for 20 levels and 10 levels as shown in fig 11 the greatest discrepancies are in the focusing breaking regions and it can be found that the discrepancy decreased as the number of levels increased as shown in fig 11 the skill of 124 levels is approaching 1 0 as are the results of 62 levels thus for case tp4 the present model can achieve the convergence precision using 62 σ levels 
21522,a non hydrostatic shock capturing model is developed to address deep water wave evolution including wave breaking the present model is based on the euler equations with a hybrid finite volume finite difference fv fd method and the high resolution godunov type numerical scheme using these numerical schemes wave breaking can be captured as a shock or a hydraulic jump without adopting additional wave breaking parameters or terms such as breaking onset criteria the parallel method of the message passing interface mpi is used to accelerate the simulation this model was applied to simulate deep water wave propagation including breaking as a consequence of dispersive focusing or due to the modulational instability by comparison with existing experiments the ability of the present model to predict breaking onset and breaking energy dissipation is evaluated additionally a dynamic criterion is applied to provide additional information on wave breaking onset and the wavelet transform is applied to predict the energy as a function of frequency and time keywords non hydrostatic model shock capturing wave breaking wavelet transform 1 introduction one of the least understood and yet important events in the ocean upper layer is the breaking of surface waves as opposed to shallow water deep water implies a depth that is sufficiently large that the surface waves are unaffected by the variations in bed topography thus even a small pond can support breaking deep water waves banner and peregrine 1993 generally laboratory researchers use dispersive wave packets or the modulational instability to generate breaking waves in deep water babanin 2011 by varying the wave trains in experiments and numerical models one can obtain different breaker types including plunging breakers and spilling breakers wave breaking is a complicated and very rapid process and due to its usual two phase flow causes difficulties in laboratory observation and measurements alternatively numerical simulation may be used to study wave breaking at present although many wave breaking treatment techniques have been developed detailed breaking processes remain elusive perlin et al 2013 many researchers have developed different models to simulate the process of wave breaking based on various explanations of the attendant physical mechanisms additionally various methods have been implemented to dissipate energy in these schemes for breaking induced energy dissipation models typically three types are used eddy viscosity models surface roller models and vorticity models in eddy viscosity models dissipation due to turbulence generated by wave breaking is treated by a diffusion term in the momentum equations the amount of dissipation is governed by the value of the eddy viscosity coefficient which can be expressed in terms of a mixing length parameter kennedy et al 2000 zelt 1991 the surface roller concept was introduced by svendsen 1984 in which the added term depends on the dynamically determined roller thickness and mean front slope of the breaker along with other parameters that must be tuned during the numerical implementation on the other hand a vorticity model is based on a transport equation for the breaker generated vorticity the above three models require a breaking onset criterion to decide where and when to activate the energy dissipation terms therefore ad hoc parameters are required in these models and some of them are empirical although these energy dissipation models combined with different breaking onset criteria have been widely used for simulating breaking events in deep water and in the swash zone the determination of the breaking related parameters is nontrivial that is the robustness of these approaches remains an issue there is another approach known as shock capturing which does not require added energy dissipation terms to compute the associated energy dissipation nor does it require a breaking onset criterion to have the model know when to initiate breaking in one of these approaches artificial viscosity is implemented via a viscosity term in the 1 d euler equation this restricts numerical oscillations near shocks and was developed by vonneumann and richtmyer 1950 however the extra viscosity terms are not necessary for modern shock capturing methods such as muscl monotonic upstream center scheme for the conservation laws van leer 1979 eno essential non oscillation harten et al 1987 which usually get numerical viscosity from the numerical scheme itself these schemes are also called high resolution schemes and can provide high resolution during shocks i e the sharp shocks are not rounded by numerical diffusion and do not exhibit non physical oscillations near the primary shock although the shock capturing concept originated in aerodynamics it is now used in hydrodynamics first the shock capturing method was applied to solve nonlinear shallow water equations nswe handling bores and dam break flows glaister 1988 dodd 1998 more recently this method has been extended for many problems including wave runup overtopping and wave breaking and it has been utilized in numerical models based on different governing equations including boussinesq type bt equations roeber et al 2010 tonelli and petti 2012 navier stokes n s or euler equations zijlema et al 2011 ma et al 2012 these non hydrostatic models use euler or reynolds averaged navier stokes equations as the governing equations and are even applied to the simulation of breaking waves in deep water with a shock capturing method there appears to be no theoretical limitation on the performance of nonlinearity and dispersion for non hydrostatic models bai and cheung 2013 2015 at least in terms of the governing equations to improve frequency dispersion non hydrostatic models need only have the number of vertical grid points or layers increased zijlema and stelling 2008 second euler equations are hyperbolic equations which admit both continuous and discontinuous solutions wu and cheung 2008 thus they are easily adaptable to shock capturing techniques on the other hand bt models must have the high order dispersive terms turned off to degenerate into nswe that are also hyperbolic additionally non hydrostatic models track the free surface motion using a single valued function compared with marker and cell and volume of fluid techniques although multi valued surfaces cannot be described i e wave overturning cannot be modeled the non hydrostatic models are computationally more efficient in this paper a shock capturing non hydrostatic model is used to simulate wave breaking in deep water in the present model a first order explicit euler scheme for time integration is used and it has proven reliable for the conditions addressed herein in solving shock problems with godunov type finite volume methods there are two critical processes the first is the manner in which the values of the conservative variables at cell faces based on cell data which are defined at the cell center are constructed and it is known as reconstruction the so called weighted essential non oscillation weno schemes are designed for problems with piecewise smooth solutions containing discontinuities thus the third order weno scheme chen and shi 2006 is used to automatically achieve higher order accuracy and non oscillatory properties near discontinuities the second process is to calculate fluxes at cell faces after reconstruction usually thought of as riemann problems herein the approach known as multiple stage musta flux function developed by toro and titarev 2006 is applied as the riemann solver consequently a high resolution godunov type scheme in conjunction with a riemann solver is developed which has remarkable shock capturing capabilities to describe breaking waves as bores and conserve flow volume and momentum across discontinuities roeber et al 2010 last this model is applied to wave breaking induced by both wave energy focusing and by the modulational instability as a final note although these models seem to give reasonable results and most definitely are able to calculate solutions and proceed beyond the break point it is unknown to what extent the model dissipation and results represents reality that is the manner in which they facilitate calculation beyond breaking is not well understood 2 mathematical formulation 2 1 governing equations as mentioned the euler equations are adopted as governing equations referring to ma et al 2012 the euler equations in cartesian coordinates x y z are transformed to σ coordinates x y σ to apply a shock capturing scheme the governing equations are cast in conservation form which preserves the conservative characteristics for the variables as shown in eqs 1 2 with the sigma coordinate transformation the varying vertical coordinate in the physical domain is transformed to a space coordinate where σ spans 0 to 1 and σ 0 represents the bottom and σ 1 represents the surface these equations are as follows 1 d t d u x d v y w σ 0 2 u t f x g y h σ s h s p here the total depth d is the sum of the still water depth h and the free surface elevation η i e d x y t h x y t η x y t u d u d v d w t f g h are flux vectors and s h is a bed slope source term and s p is a dynamic pressure term calculated using the dynamic pressure p referring to liang and marche 2009 the above equations have to be reformulated to balance the flux terms eq 3 and source terms eq 4 as 3 f d u u 1 2 g η 2 g h η d u v d u w g d u v d v v 1 2 g η 2 g h η d v w h u w v w w w 4 s h g η h x g η h y 0 s p d ρ p x p σ σ x d ρ p y p σ σ y 1 ρ p σ additionally the relationship between w i e the vertical velocity in the sigma coordinate and w the vertical velocity in the cartesian coordinate is given by 5 w d σ t u σ x v σ y w σ z applying chain rule differentiation for the transformation between cartesian coordinates and σ coordinates ma et al 2012 gives 6 w w h t σ d t u h x σ d x v h y σ d y integrating eq 1 over σ from 0 through 1 and using the boundary conditions at the free surface and at the bottom for w we obtain the equation for calculating free surface 7 d t x d 0 1 u d σ y d 0 1 v d σ 0 the layout of the computational variables and the boundary conditions including kinematic boundary conditions and pressure conditions at the free surface and bottom can be found in ma et al 2012 2 2 numerical method 2 2 1 time integration scheme for hyperbolic equations time marching is a common solution technique the explicit first order euler scheme is used for the time integration additionally the dynamic pressure and hydrostatic pressure are solved using a predictor corrector method which is quite different from some non hydrostatic models that solve the pressure in two fractional steps the predictor corrector scheme can be written as 8 u u n δ t f x g y h σ n s h n s p n 9 u n 1 u δ t s p n 1 s p n s δ p n 1 eq 8 is the predictor step while eq 9 is the corrector step for the velocity field predicted by eq 8 u is an intermediate variable and u n u n 1 are u values at the time levels n and n 1 rather than using a fractional step to calculate the dynamic pressure u with s p n the dynamic pressure at time level n u is corrected by δ p the differential value of the dynamic pressure between time levels n and n 1 to give u n 1 from eq 9 we obtain 10 d u n 1 d u δ t ρ d δ p x δ p σ σ x n 1 11 d v n 1 d v δ t ρ d δ p y δ p σ σ y n 1 12 d w n 1 d w δ t ρ δ p n 1 σ it is noted that the conservative variables d u d v d w are used in eqs 10 12 rather than u v and w applying the principle of σ coordinate transformation eq 1 can be expressed as 13 d u x d u σ σ x d v y d v σ σ y w σ 0 substituting eqs 10 12 into eq 13 a poisson type equation is obtained for δ p in the sigma coordinate system as presented in eq 14 with δ p known the dynamic pressure at time step n 1 can be obtained and velocities at each stage can be updated 14 d x δ p x δ p σ σ x d y δ p y δ p σ σ y d σ δ p x σ x d σ δ p y σ y d σ x 2 σ y 2 1 σ δ p σ d x δ p x δ p σ σ x d y δ p y δ p σ σ y ρ δ t d u x d u σ σ x d v y d v σ σ y w σ eq 14 is discretized with the second order space centered finite difference method the conservative variables d u d v d w at vertical cell faces are found by interpolation of adjacent cell centered values the resulting linear equation is given by 15 a 1 p i j 1 k 1 a 2 p i 1 j k 1 a 3 p i j k 1 a 4 p i 1 j k 1 a 5 p i j 1 k 1 a 6 p i j 1 k a 7 p i 1 j k a 8 p i j k a 9 p i 1 j k a 10 p i j 1 k a 11 p i j 1 k 1 a 12 p i 1 j k 1 a 13 p i j k 1 a 14 p i 1 j k 1 a 15 p i j 1 k 1 r p where a 1 d i j σ y i j 1 k 2 δ y δ σ k δ σ k 1 σ y i j k 2 δ y δ σ k δ σ k 1 a 2 d i j σ x i 1 j k 2 δ x δ σ k δ σ k 1 σ x i j k 2 δ x δ σ k δ σ k 1 a 3 d i j σ x 2 σ y 2 1 d i j 2 i j k 0 5 δ σ k δ σ k 1 δ σ k 1 d x i j σ x δ σ k δ σ k 1 d y i j σ y δ σ k δ σ k 1 a 4 d i j σ x i 1 j k 2 δ x δ σ k δ σ k 1 σ x i j k 2 δ x δ σ k δ σ k 1 a 5 d i j σ y i j 1 k 2 δ y δ σ k δ σ k 1 σ y i j k 2 δ y δ σ k δ σ k 1 a 6 d i j δ y 2 d y i j 1 2 δ y a 7 d i j δ x 2 d x i j 1 2 δ x a 8 2 δ x 2 2 δ y 2 σ x 2 σ y 2 1 d 2 i j k 0 5 δ σ k δ σ k 1 δ σ k σ x 2 σ y 2 1 d 2 i j k 0 5 δ σ k δ σ k 1 δ σ k 1 a 9 d i j δ x 2 d x i j 1 2 δ x a 10 d i j δ y 2 d y i j 1 2 δ y a 11 d i j σ y i j 1 k 2 δ y δ σ k δ σ k 1 σ y i j k 2 δ y δ σ k δ σ k 1 a 12 d i j σ x i 1 j k 2 δ x δ σ k δ σ k 1 σ x i j k 2 δ x δ σ k δ σ k 1 a 13 σ x 2 σ y 2 1 d 2 i j k 0 5 δ σ k δ σ k 1 δ σ k d x i j σ x δ σ k δ σ k 1 d y i j σ y δ σ k δ σ k 1 a 14 d i j σ x i 1 j k 2 δ x δ σ k δ σ k 1 σ x i j k 2 δ x δ σ k δ σ k 1 a 15 d i j σ y i j 1 k 2 δ y δ σ k δ σ k 1 σ y i j k 2 δ y δ σ k δ σ k 1 r p ρ δ t u x u σ σ x v y v σ σ y 1 d w σ also σ x σ x σ y σ y as is evident the coefficient matrix is asymmetric and has a total of 15 diagonal lines the mpi openmp hybrid programming technique and high performance preconditioner hypre library are chosen to solve this linear system 2 2 2 shock capturing spatial finite volume scheme it is noted that space discretization is the key to implementing shock capturing methods a combined finite volume fv and finite difference scheme with a godunov type method is applied to discretize eqs 1 2 in the framework of the fv method fluxes as shown in eq 3 based on the conservative variable are required at the cell faces the values of the conservative variables at the cell faces are calculated using a reconstruction method based on the cell center data in this paper the third order weighted essentially non oscillatory method chen and shi 2006 is used for the reconstruction of variables at the cell faces in the horizontal direction for problems comprising both shocks and complex smooth solution structures weno schemes can provide higher accuracy than second order schemes along with good resolution near discontinuities for cell i j a reconstruction function p i j x y is introduced the reconstruction at cell faces i 1 2 j and i j 1 2 is 16 u i 1 2 j p i 1 2 1 2 j x i 1 2 y j u i j 1 2 p i j 1 2 1 2 x i y j 1 2 u i 1 2 j p i 1 2 1 2 j x i 1 2 y j u i j 1 2 p i j 1 2 1 2 x i y j 1 2 where the superscript and represent right and left respectively p i j x y is defined as 17 p i j x y 1 θ x y p i x θ x y p j y in eq 17 0 θ x y 1 and θ x i 1 2 y j 0 θ x j y j 1 2 1 here p i x only is provided while p j y is easily obtained as 18 p i x ω l p l x ω r p r x ω c p c x where 19 p l x u i j u i j u i 1 j 2 x x j p r x u i j u i 1 j u i j 2 x x j p c x u i j 1 12 u i 1 j 2 u i j u i 1 j 1 12 u i j 1 2 u i j u i j 1 u i 1 j u i 1 j 2 δ x x x j u i 1 j 2 u i j u i 1 j δ x 2 x x j 2 and the weighting values are 20 ω i α i m α m α i c i ε i s i i m l r c c l c r 1 4 c c 1 2 the smoothing factors are 21 i s l u i j u i 1 j 2 i s r u i 1 j u i j 2 i s c 13 3 u i 1 j 2 u i j u i 1 j 2 1 4 u i 1 j u i 1 j 2 the same procedure is applied to the y direction after the reconstruction mentioned above a local riemann problem is formed at each cell face due to the different left values and right values some approximate riemann solvers such as hll and roe have been widely and successfully used in godunov type schemes however one needs to calculate the detailed eigen structure of the governing equations which are complex computationally expensive and sometimes difficult to achieve in the present study a musta scheme is employed for the flux evaluation which does not require the use of an eigen structure and hence is more efficient than roe and hll schemes toro and titarev 2006 referring to fang et al 2015 we have the following numerical algorithm to calculate the musta flux step 1 to compute the flux evaluation the flux at cell face i 1 2 is determined by 22 f i k f u i k f i 1 k f u i 1 k u i 1 2 k 1 2 u i k u i 1 k 1 2 δ t δ x f i 1 k f i k f m k f u i 1 2 k f i 1 2 k 1 4 f i k 2 f m k f i 1 k δ x δ t u i 1 k u i k if k k the process ends k is the predefined total number of steps and k represents the k t h step step 2 so called opening of the riemann fan 23 u i k 1 u i k δ x δ t f i 1 2 k f i k u i 1 k 1 u i 1 k δ x δ t f i 1 k f i 1 2 k step 3 return to step 1 in theory the larger the number of stages k the closer the resulting numerical flux is to the exact riemann solver nevertheless the choice k 1 is recommended for practical applications according to previous studies the above procedure is also applied to the y direction 3 numerical results to examine the capability of the present model for simulating wave breaking the experimental data of tian et al 2012 are used to compare with the simulation results including the free surface total potential energy density and power spectral density in addition to their dispersive focusing results the modulational instability to induce breaking is considered as well 3 1 dispersive focused wave groups the incident wave group is generated at the model upstream boundary for the focusing wave groups the total surface elevation η at the incident wave boundary x 0 far left of the computational domain shown in fig 1 is described as 24 η 0 t i 1 n a i cos 2 π f i t t b k i x b where n is the number of sinusoidal components a i f i and k i are the amplitude cyclic frequency and wavenumber of the i th wave component respectively and x b 7 0 m and t b 25 0 s are the predefined focusing location and the time of breaking the discrete frequencies f i are uniformly spaced over the band 1 0 2 4 hz i e the frequency bandwidth δ f 1 4 hz with a central frequency defined by f c f n f 1 2 by varying the global steepness s i 1 n a i k i and the non dimensionalized bandwidth δ f f c different breaking intensities can be generated the input wave group parameters for the simulation cases are summarized in table 1 from tian et al 2012 tp1 is a non breaking case while tp2 tp4 are breaking cases with the breaking strength increasing with increasing steepness simulations of the dispersive focusing wave groups are conducted in a numerical wave tank 20 0 m long with a sponge layer placed in the domain from 15 m 20 m as shown in fig 1 the grid resolution in the horizontal direction is 0 01 m about 1 80 of the wavelength for the center frequency wave component and a constant time step 0 001 s is used in the simulations the total simulation period is 40 95 s which is sufficient for the wave groups to propagate beyond the end of the flume fig 2 shows the simulated surface elevations at locations in front and behind the predefined focusing points for tp1 tp4 all the simulations are conducted with 124 σ levels note that convergence is discussed in the appendix as shown in these figures there is no doubt that the larger the initial global wave steepness the closer the wave focus location which is accompanied also by larger wave surface elevations wave breaking events occurred earlier for cases with larger steepness see tp3 and tp4 tian et al 2012 reported that for case tp4 there were multiple breakers far upstream of x b 7 0 m roughly from x 4 8 m to 9 6 m where wave breaking occurred at different locations repeatedly generally the simulation results agree quite well with the experimental data in both amplitude and phase the most remarkable discrepancy appears near the focusing breaking region for all the cases especially when wave elevations are close to reaching their maximum this is due likely to the complicated phenomenon of breaking and as is evident there is still an issue for the present model to correctly compute all wave components particularly the high frequency ones fig 3 provides a comparison of the surface variance between the computed and measured surface elevations according to wave theory the variance is proportional to the local energy at a wave measurement location thus the spatial variations of ζ 2 0 t ζ x t 2 d t can be used to quantitatively access the wave variance here refers to time integration and t 40 95 s the major breaking regions in the laboratory experiments are indicated with dash lines note that locations of secondary breaking prior to and or subsequent to the major ones are not indicated as shown in fig 3 clearly the total potential energy as a function of space for both non breaking and breaking wave groups is predicted well in the simulations though the comparison for wave group tp4 the most violent breaking case is not as good as the others for tp4 the present model does capture the dramatic decrease of energy but the values from about x 5 0 m to x 8 0 m do not match well with the experimental data the simulations under predict the energy loss compared with measured data this may be due to the simplified surface stress boundary condition used in both the present model and ma et al 2012 therefore it might be better to take the consistent surface boundary condition derakhti et al 2016a for large wave slope similar underestimation of wave breaking induced energy loss in steepness limited breaking packets was reported in derakhti et al 2016b where the entire energy loss was due to numerical dissipation and that the physical dissipation was approximately zero another possible reason for the discrepancy is the absence of turbulence dissipation or other explicit viscous dissipative terms in the present model considering that shock capturing is a simple technique that requires no tuned parameters and that the breaking intensity of tp4 is a maximum the results are quite reasonable additionally it is noted that oscillations can be observed in numerical results at the focusing breaking areas and this should be and is more evident for the more dramatic breaking cases these oscillations were reported also by the numerical study in tian et al 2010 and in fact these fluctuations may have been present in the experiments however there may have been an insufficient number of wave probes to quantify them fig 3 seems to show that breaking did occur in the numerical results and in the approximate correct locations due to its shock capturing scheme and necessarily single valued free surface treatment the present non hydrostatic model cannot indicate the breaking onset time per se thus a dimensionless parameter δ t is used in post processing to determine further information on breaking onset this is the breaking onset dynamic criterion proposed by song and banner 2002 which could distinguish breaking waves from nonbreaking ones with a threshold range δ c 1 4 0 1 1 0 3 the initial wave group structure as well as the number of waves in the wave groups wind forcing and surface shear has little influence on the threshold range song and banner 2002 δ t is a dimensionless parameter based on the growth rate of the local wave energy density and is given by 25 δ t 1 ω c d μ d t μ e m a x k 2 ρ g here ω c 2 π f c is a characteristic angular frequency e g taken as the initial angular frequency of the center component of the dispersive packet ρ is water density and g is the gravitational acceleration d d t represents the total derivative following the wave group μ is the dimensionless local wave energy density to solve μ k and e m a x must be computed in advance k is the local wavenumber calculated based on two consecutive zero crossings adjacent to the breaking crest as shown in fig 4 compared with other methods this approach for calculating k shows small time fluctuations 21 as shown in fig 5 for non breaking condition tp1 the temporal variation of local wavenumber k exhibits near symmetry with respect to the focusing time t 25 0 s for the breaking cases tp2 tp4 k decreases over time and a sharp decrease was detected at around t 22 5 s for tp3 and tp4 which basically coincides with wave breaking the local wavenumber increases for greater incident wave steepness e m a x is the total energy at the maximum surface displacement determined by summing the kinetic and potential energies of the fluid particles along a vertical line at position x and time t as in eq 26 usually linear wave theory is used to calculate the kinetic energy for e x t in laboratory experiments due to the difficulty of measuring particle velocities beneath breaking waves numerically of course it is simple to compute the kinetic energy 26 e x t h η 1 2 ρ u 2 v 2 w 2 d z 1 2 ρ g η 2 e k e p fig 6 presents the numerical results of the ratio of potential energy to total energy at the maximum surface displacements maximum crests and troughs in the current study the potential energy represents approximately 68 to 70 of the total local energy at the trough maxima the proportion increases slightly with wave steepness while the ratio at crests maxima decreases as the wave steepens compared with the crests the potential energy at the troughs represents a higher percentage of the total energy however the ratio at the crests varies more significantly than at the troughs and change more dramatically as does the breaking intensity taking tp4 as example the ratio decreases from approximately 0 61 to 0 38 as the waves evolve to breaking and returns to its initial value after breaking while for the non breaking case tp1 the ratio decreases from 0 65 to 0 52 a similar change can be found in the numerical results given by derakhti and kirby 2016 in addition the averaging procedure denoted by was proposed by song and banner 2002 to remove large oscillations of μ that was involved in the determination of the upper and lower envelopes of μ the calculation of the time averaged local wave density μ t is non trivial perlin et al 2013 but the μ t with certain time duration is necessary in this process to find extreme points that is it cannot be computed at each time step synchronously thus it is limited for application to numerical models to determine breaking onset in this study the curve fitting toolbox of matlab was used to fit smoothing splines to the respective sets of detected maximum and minimum points of μ t and then the local average μ t was taken as the average of the smooth splined maximum and minimum curves as shown in left panel of fig 7 the growth rate of the breaking parameter δ t is shown in the right panel of fig 7 with threshold values δ c also indicated there by horizontal lines it is quite obvious that numerical tp1 is non breaking because its maximum value of μ t is less than 5 0 1 0 4 one third of δ c in the laboratory experiments tp2 was an incipient spilling breaker this is indicated by δ t of the numerical simulation of tp2 which is just greater than the lower breaking limit 1 3 1 0 3 it is apparent that the value of the breaking parameter increases with the breaking intensity as the maximum values of δ t of tp3 and tp4 exceed the upper breaking limit 1 5 1 0 3 this is especially true in the case tp4 as its δ t has exceeded the threshold much earlier than tp3 this is due to the preceding weaker breaking wave that occurred prior to the main breaker at around t 20 s as observed in the corresponding laboratory measurements by tian et al 2012 thus this dynamic criterion appears to properly detect breaking events from nonbreaking ones in the following the continuous wavelet transform is used to study the spatiotemporal structure and the relative phasing of different wave components in the packet in fig 8 the wavelet transform of the non breaking tp1 and the plunging breaker tp3 are exhibited other breaking cases give similar results with x 3 32 m and 11 06 m far upstream and downstream of the focusing breaking region respectively for both tp1 and tp3 wave components of lower frequencies occurred first and it is obvious that longer waves are more energetic mainly distributed within the range from 1 0 1 5 hz and then it can be seen that all wave components are maximum at the point x 7 22 m which is very close to the predefined focusing point x 7 0 m the predefined focusing point based on linear theory is not the actual focusing point for breaking or nonlinear cases the wavelet spectrum is almost symmetric at x 7 22 m which is also identified as a focusing phenomenon for tp3 it should be noticed also that the energy of higher frequencies above 3 hz grows as the wave focuses however after breaking focusing the energy of the high frequencies is dissipated this trend is apparent in the non breaking tp1 although less obvious 3 2 wave groups subject to modulational instability to study the modulational instability of water waves wave groups composed of a carrier wave and two side band perturbation components are generated the surface displacements at the wavemaker can be described by 27 ζ t a 0 cos ω 0 t b cos ω 1 t π 4 b cos ω 2 t π 4 where ω 0 ω 1 and ω 2 are the angular frequencies of the carrier wave and the lower and the upper side band perturbations respectively a 0 and b are the amplitudes of the carrier wave and the side band perturbations respectively the amplitude ratio b a 0 was in the range 0 3 to 0 5 depending on the specific wave group details of the wave group parameters 23 are given in table 2 the analytical solution of the fifth order stokes wave theory is used to generate the wave at the left input boundary considering the steepness and using a deep water condition in addition the space step d x 0 01 m time step d t 0 001 s and there are 124 vertical levels the same values used for the focusing wave groups similarly integration of the power of the surface displacement ξ 2 is used to detect energy dissipation because it is in direct proportion to the wave total energy the long time 0 50 s integration of the surface variance for these four cases are shown in fig 9 for both cases bfi 1710 and bfi 1716 the energy as a function of space is predicted reasonably well especially considering that multiple breakers occurred at different locations repeatedly in the physical experiments for bfi 1720 the breaking region is roughly from x 4 8 m to x 9 6 m and a dramatic decrease of energy is captured from around 4 0 m to 8 0 m thus the comparison is reasonable to x 8 0 m however obvious disagreement between the simulated and measured results is observed following the violent wave breaking event it seems as though there may have been another breaking wave in the region after x 8 0 m because of another sudden decrement of energy there which our model failed to capture this problem might due to the absence of a turbulence model or other explicit viscous dissipative terms following the insufficient numerical viscosity dissipation and corresponding underestimation of energy loss as mentioned in derakhti et al 2016b note that the decrease of this long time integration for the non breaking case bfi 1710 is due primarily to the fact that the integration is limited from 0 to 50 s that is that not all waves generated upstream had arrived at the downstream wave station during that time span see surface elevation in fig 10 next wavelet analysis is employed to investigate the energy transport mechanism of modulated wave trains fig 10 shows the free surface variation and related wavelet spectra of case bfi 1716 before and after wave breaking respectively according to the laboratory experiments wave breaking was observed roughly in the region from x 7 0 m to x 11 0 m at the wave gauges far upstream of the breaking area fig 10 a the wavelet spectrum is nearly symmetric about the frequency of the carrier wave f 1 7 hz specifically on the leading wave front both the frequency and the amplitude modulate to high frequencies before wave breaking the same trend can be seen in fig 10 b at the right side of each packet rather than left side in fig 10 c and the change of energy of the high frequencies is consistent with increased surface elevation this phenomenon is very similar to the findings from wave group experiments presented by hwung et al 2006 following breaking as the wave trains propagate further downstream the surface deforms significantly due to nonlinearity and eventually a breaking wave occurs meanwhile the peak frequency shifts to a lower frequency after wave breaking 4 conclusions in this paper a surface and terrain following shock capturing non hydrostatic model is presented the governing equations incompressible euler equations are discretized in combined finite volume and finite difference framework with the godunov type method the weno scheme is applied for variables reconstruction to get high resolution near shocks and the musta approximate riemann solver is employed to compute fluxes at cell faces the performance of the model is investigated with several cases especially as it relates to capturing breaking waves and treating breaking induced energy dissipation in deep water dispersive wave packets and modulation instability breaking are simulated these numerical results are compared with corresponding experiments while the wavelet transform technique is used to conduct a preliminary analysis for energy transport in most cases the present model captures reasonably well the breaking waves not only for a single breaking wave but also for multiple breakers additionally the breaking induced energy dissipation is simulated sensibly by the present model thus the shock capturing technique is shown to simulate wave breaking in deep water in a reasonable manner for the most violent breaking cases simulated results are acceptable but they are not as good as they are for milder breaking compared with other wave breaking methods shock capturing models involve no breaking onset criteria and no special energy dissipation terms no ad hoc parameters are required however it must be mentioned that the relationship between shocks discontinuities and breaking waves remains unclear it cannot explain how the energy is dissipated via the equations or formulations and as there are many shock capturing schemes it is difficult to evaluate or quantify their performance on wave breaking especially when combined with other methods in fact in some researchers views shock capturing methods are not reliable as a consequence of their uncertain physical significance importantly due the method being a single valued free surface technique and in the present implementation a single phase flow wave surface overturning and bubble entrainment cannot be described regardless the deviations between the numerical and measured data are reasonable in terms of wave height and energy given the simplicity and robustness of the implementation shock capturing non hydrostatic models should be powerful models to capture wave breaking phenomena credit authorship contribution statement dongbin he methodology software formal analysis writing original draft yuxiang ma conceptualization resources supervision project administration guohai dong writing review editing project administration supervision marc perlin validation formal analysis writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research is supported financially by the national natural science foundation of china grant nos 51720105010 51679031 51979029 liaoning revitalization talents program grant no xlyc 1807010 and the fundamental research funds for the central universities grant no dut2019tb02 appendix usually the nonlinearity and dispersion for non hydrostatic models are improved as the number of vertical layers is increased however for a specified model and a particular case the results may converge when the number of layers reach some value henceforth the model is assessed using the statistical method developed by willmott 1981 28 s k i l l 1 i 1 n ψ i sim ψ i obs 2 i 1 n ψ i sim ψ obs ψ i obs ψ obs 2 where ψ is the variable being compared and ψ is its sample mean perfect agreement between both results yields a skill value of 1 0 whereas complete disagreement yields a skill of 0 in other words as used here skill represents the difference between the results of the free surface elevations as a function of downstream position based on the numbers of layers identified with each curve equivalently it provides a visual convergence based on the number of layers used thus eq 28 is used to calculate the skill for results with varied numbers of layers i e 10 20 31 62 124 to determine the convergence of the present model for case tp4 subscripts sim and obs represent the results from a varied number of layers for example the legend named 20 and 10 stands for predictive skill for 20 levels and 10 levels as shown in fig 11 the greatest discrepancies are in the focusing breaking regions and it can be found that the discrepancy decreased as the number of levels increased as shown in fig 11 the skill of 124 levels is approaching 1 0 as are the results of 62 levels thus for case tp4 the present model can achieve the convergence precision using 62 σ levels 
21523,this paper investigates the constrained waypoints based path following control problem of underactuated ships in the presence of the actuator saturation and the unknown disturbance an improved composite neural learning control algorithm is proposed by using the command filter and the robust neural damping techniques in the proposed algorithm the dynamic auxiliary system is established to generate the saturation error compensating sec signal which is used to modify the error dynamics such that the actuator saturation constraint is tackled the neural networks are employed to deal with the model uncertainty and the corresponding compensating effects are improved further by designing the simplified serial parallel estimation model spem by constructing the robust neural damping term only two adaptive parameters are required to be updated online that leads to a smaller computational application burden furthermore the composite disturbance observer cdob is developed by fusion of the prediction error and the compensated tracking one where the unknown disturbance can be estimated accurately and compensated effectively in addition considerable efforts are made to obtain the semi global uniformly ultimately bounded sguub stability of the closed loop system the convictive experiments are performed to verify the effectiveness and superiority of the proposed algorithm keywords underactuated ship path following control composite neural learning input saturation disturbance observer in recent years the path following control of underactuated ships has attracted extensive attentions from the control community due to its wide applications in the field of ocean engineering e g the long disturbance freight transportation the ocean exploitation and the maritime patrol as a result a large number of valuable results have been presented in the existing literatures ghommam et al 2018 do 2016 meng and guo 2015 zhang chu jin and zhang 2020a in the practical engineering the industrial systems are always with some inherent restrictions e g the input saturation constraint and the dead zone dynamics as pointed in tong wang li and zhang 2013 yu et al 2016 esfandiari et al 2014 these physical constraints may cause the inferior closed loop performance and even lead to the system instability once they are omitted in the system design therefore it deserve more investigations on the path following control of underactuated ships with the input saturation that is of theoretical and practical significance in the marine industry in the engineering practice the underactuated ship may inevitably suffer from the actuator input limitation due to its finite actuation energy yu et al 2018 liu et al 2017 for this consideration a variety of pioneering works have been reported in wen et al 2011 chen et al 2011 zheng and sun 2016 boskovic et al 2004 zhu et al 2018 in wen et al 2011 a backstepping based adaptive control algorithm is developed to deal with the regulation problem of the single input single output siso system subject to the input saturation in the algorithm the nussbaum function is used to modify the nonlinear terms arising from the input saturation in addition chen et al 2011 presents the model based control mechanism to stabilize the multi input multi output mimo system where the auxiliary system is introduced to analyze the effect of the actuator physical constraint note that the corresponding theoretical results have been applied into the practical systems including the marine surface vessels zheng and sun 2016 and the spacecrafts boskovic et al 2004 in zhu et al 2018 a constrained adaptive neural control algorithm is proposed for the strict feedback system with the deviate error between the order variable and executing one as the system inputs the auxiliary system is constructed to acquire the unique compensating signals that could generate the damping effect to prevent the saturation phenomenon of the control command especially for the condition that the input order would approach the saturated limitation for the control design of nonlinear system it is still challenging to deal with effectively the system model uncertainity oh and sun 2010 ghommam et al 2018 in the existing literatures a series of approximation based adaptive schemes have been developed by using the neural networks nns shao tian yang and zhang 2020b han et al 2018 and the fuzzy logic system fls tong and li 2010 xiang et al 2018 considering the powerful learning ability of nns a adaptive neural sliding mode controller is designed in chen et al 2013 where the system uncertainty is tackled by compensating its unknown upper bound and the asymptotical stability of the closed loop system can be strictly guaranteed to improve further the approximation accuracy of nns the composite intelligent learning control algorithm is discussed in xu and sun 2017 by introducing the serial parallel estimation model spem the similar effect has also been achieved in li et al 2015 2014 via the fuzzy state observer it is noted that the composite learning control mechanism put much focus on the interpretability of the nns approximation model instead of the lyapunov theory nevertheless the continuous updating of nns weights would lead to the burdensome computation problem when the corresponding algorithm is implemented in the industrial central processing unit cpu chip that may limit the engineering application the theoretical algorithm to this end a concise robust control law is derived by using the dynamic surface control dsc and the minimum learning parameters mlp techniques zhang and zhang 2013 owing to the robust damping technique the proposed algorithm only requires four adaptive parameters to compensate the lumped disturbance and the computation complexity is thus reduced by virtue of the finite time convergence property the corresponding results are extended to the case of the automatic obstacle avoidance and the dynamic positioning control zhang et al 2017 zhang yao xu and zhang 2020b on the other hand due to the fact that the underactuated ship is always exposed to the unknown ocean disturbance it is of great importance to deal with the external disturbance for the controller design based on the nns approximating technique or the disturbance estimating theory various excellent approaches have been presented to compensate the unknown disturbance in the last few years in zhang et al 2017 the unknown disturbance is compensated together with the model uncertainty via the nns related adaptive law for deep insight into the dynamics of the disturbance the disturbance estimating mechanisms have been widely studied in lu et al 2018 a nns based disturbance observer is developed by using the mlp technique and the satisfied disturbance estimation performance is achieved then wang et al 2018 establishes the finite time disturbance observer ftdob for the underactuated ship to perform the path following task it is noted that the ftdob depends on the accurate model parameters and structures of ships however the precise model information is difficult to obtain in the marine practice sun et al 2017 ejaz and chen 2018 motivated by the above observations one concentrates on the practical path following control of underactuated ships where the actuator saturation and waypoints based navigating practice are fully considered the main contributions of this paper are summarized as follows 1 the constrained composite neural control algorithm is proposed for the underactuated ship to perform the waypoints based path following task in the proposed algorithm the inherent physical limitation of actuators is tackled by incorporating the saturation error compensating sec signals specially the related compensating terms are used to modify the system error dynamics and the novel composite adaptive law is thus developed to ensure the control performance and bounded stability of the closed loop system 2 based on the nns approximating theory the ship s uncertain structure and parameters can be compensated and the corresponding compensating effect is improved by incorporating the modified spem though no nns related adaptive parameters are required to be updated online owing to the robust neural damping technique although the filter is introduced to solve the explosion of complexity problem the filter error is eliminated in the proposed scheme via the filter compensating terms furthermore the prediction error and the compensating tracking one are employed to derive the composite disturbance observer cdob where the unknown disturbance can be estimated accurately to guarantee the robustness of the closed loop system 1 problem formulation 1 1 notations throughout this paper denotes the absolute value of a scalar while denotes the frobenius norm of implying that f i 1 n j 1 m x i j 2 where can be either a matrix or vector or scalar sgn denotes the sign function 1 2 mathematical model of underactuated ships this section briefly describes the three degrees of freedom dofs maneuvering model of the underactuated ship moving in the horizontal plane i e eqs 1 3 where only the surge sway and yaw motion are considered for more details around the mathematical model of the underactuated ship the readers are suggested to refer to fossen 2011 1 x u cos ψ v sin ψ y u sin ψ v cos ψ ψ r 2 u f u ν τ u m u d w u v f v ν d w v r f r ν τ r m r d w r with 3 f u ν m v m u v r d u 1 m u u d u 2 m u u u d u 3 m u u 3 f v ν m u m v u r d v 1 m v v d v 2 m v v v d v 3 m v v 3 f r ν m u m v m r u v d r 1 m r r d r 2 m r r r d r 3 m r r 3 as described in fig 1 the position and orientation of the underactuated ship in the earth fixed frame are defined by η x y ψ t ν u v r t denotes the surge sway velocities and yaw rate in the body fixed frame respectively f u f v f r are considered as the high order hydrodynamic effects and the model parameters m u m v m r represent the added mass in three directions d i 1 d i 2 d i 3 i u v r are employed to describe the hydrodynamic damping terms d w u d w v d w r are the external disturbances arising from the wind waves and ocean currents τ u and τ r denote the surge force and the yaw moment which are the control inputs of the underactuated ship in practice the control input of the marine actuator is bounded due to its physical constraint the constraint details can be described by the following saturation function as eq 4 4 τ i sat τ i τ i max i f τ c i τ i max τ c i i f τ i min τ c i τ i max i u r τ i min i f τ c i τ i min where τ c i is the command control input while the τ i max and τ i min are the upper bound and lower bound of the physical limitation assumption 1 there exists an unknown positive constant d i max i u v r such that the external disturbance meets the condition as d w i d i max moreover its first order derivative d w i is considered with an upper bound d w u assumption 2 based on the rigorous analysis in li lee jun and lim 2008 the sway velocity of the underactuated ship is considered as passive bounded remark 1 since the time varying environment disturbance keeps changing with finite energy the disturbance force or moment acting on the marine surface vehicles is usually bounded thus the assumption 1 is reasonable in addition considering that the ship s sway velocity is always attenuated by the hydrodynamic damping effects the passive bounded result of the sway velocity is commonly considered as tenable yu et al 2018 lu et al 2018 in this note our control objective is to develop an improved composite adaptive scheme for underactuated ships such that the waypoints based reference path can be tracked accurately meanwhile all signals in the closed loop system are guaranteed to be semi global uniformly ultimately bounded sguub 1 3 function approximation with nns in the existing studies zhang zhang li and zhang 2020c he et al 2016 the radial basis function nns are usually used to model the unknown nonlinear continuous function due to their universal approximation capability in the proposed algorithm the radial basis function nns are utilized to approximate the ship model uncertainty by fusion of the robust neural damping technique the numerous nns weights are compressed such that the computation burden of the control procedure is reduced dramatically only two adaptive parameters are required to compensate the ship model uncertainty for this consideration lemma 1 is useful lemma 1 shao liu and wang 2020a for any given real continuous functions f x with f 0 0 over a compact set ω x f x could be written as 5 by employing the radial basis function nns approximation technique and the continuous function separation techniques 5 f x s x ax ε x ω x where s x s 1 x s 2 x s n x is the basis function vector with s i x being chosen as the gaussian function 6 ε is the approximating error satisfying ε ε m a x where ε max is a positive unknown constant 6 s i x 1 2 π h i exp x μ i 2 2 h i 2 i 1 n where μ i is the center of the receptive field and h i is the width of the gaussian function a 7 is an optimal weight matrix 7 a w 11 w 12 w 1 m w 21 w 22 w 2 m w n 1 w n 2 w n m 2 logical virtual ship guidance in the marine practice the planned route of the underactuated ship is usually made by the ship officer and the waypoint information w i x i y i will be fully utilized it can be seen easily that the navigating reference path could be splitted into two parts the straight line and the curve one for this consideration the logical virtual ship lvs guidance principle has been proposed to generate the smooth waypoints based attitude reference based on the piecewise logical programming strategy see fig 2 it is noted that the virtual ship 8 is assumed as an ideal ship with no inertia and no damping effects 8 x d u d cos ψ d y d u d sin ψ d ψ d r d part 1 the virtual ship sails at a fixed speed u d when sailing along the straight line l s and the corresponding sailing time could be calculated according to t s l s u d in particular the sailing speed of the virtual ship can be adjusted by the ship officer on the basis of the specific mission requirements part 2 for the curve one one needs to determine the real time turning radius r i 9 to obtain the related turning rate r d where the maneuvering ability and practical heading change δ φ i of underactuated ships will be fully considered 9 r i r max i f δ φ i π 2 r max r min δ φ i sign δ φ i π 2 i f δ φ i π 2 where r min and r max are the maximum turning radius and minimum turning radius of underactuated ships by referring to the calculation method in part 1 one could acquire the sailing time in the curve line path t c δ φ i r d table 1 gives some significant command signals in the waypoints based lvs guidance including the required key command signal rkcs and the given key command signal gkcs that contributes to enhancing the reader s understanding for the lvs guidance principle by means of the lvs guidance principle the smooth waypoints based reference path could be obtained that means that the real time attitude reference signal of the virtual ship could be employed to carry out the path following control as fig 3 remark 2 based on the sailing principle in zhang and zhang 2013 zhang et al 2020a the lvs based guidance mechanism is proposed by fusion of the considerations on the ship maneuverability and the marine experience especially for the determination of the real time turning radius under different path change angles in the proposed lvs based guidance mechanism the automatic programming capability of the virtual ship can be used for acquiring the smooth waypoints based reference path via the piecewise logical programming strategy in the marine practice the proposed guidance mechanism is more aligned with the common path following tasks of the merchant ship for the other marine cases similar to the waypoints based path following mission e g the submarine cable laying operation the lvs based guidance mechanism may become the potential reference strategy to improve the corresponding engineering efficiency 3 design of the disturbance observer based constrained composite neural control algorithm inspired by the command filter and the robust neural damping techniques the disturbance observer based composite neural control law is derived to stabilize the error dynamics between the virtual ship and the real ship in the algorithm some interesting problems are considered to improve the engineering applicability of the proposed algorithms e g the actuator input saturation and the real time computational application burden the systematic design procedure consists of two steps the kinematic and kinetic controls combing the available reference signals and the theoretical assumptions the detailed introduction will be show in this section step 1 in this step the objective is to stabilize the kinematic error dynamics between the actual ship and virtual ship by referring to fig 3 one defines the kinematic error as 10 10 x e x d x y e y d y ψ e ψ r ψ z e x e 2 y e 2 note that ψ r 11 is the desired azimuth angle relative to the virtual ship and it could be obtained by utilizing these kinematic error signals 11 ψ r 0 5 1 sgn x e sgn y e π arctan y e x e in order to overcome the input saturation constraint of marine actuators the dynamical auxiliary system 12 is introduced to generate the compensating signals λ i 1 and λ i 2 i u r 12 λ i 1 λ i 2 μ i 1 λ i 1 λ i 2 δ τ i m i μ i 2 λ i 2 where δ τ i τ i τ i c and the initial value of λ i is 0 μ i 1 and μ i 2 are user defined positive design parameters after incorporating the sec signals the tracking errors are modified as eq 13 13 z e z e λ u 1 ψ e ψ e λ r 1 take the time derivative of z e and ψ e along 10 12 and 13 the corresponding error dynamics 14 can be derived 14 z e π u u λ u 2 μ u 1 λ u 1 ψ e ψ r r λ r 2 μ r 1 λ r 1 where π u x d cos ψ r y d sin ψ r v sin ψ e 2 u sin 2 0 5 ψ e for convenience of the subsequent design the following error variables 15 are defined 15 u e β u u u e u e λ u 2 r e β r r r e r e λ r 2 substituting 15 into 14 yields 16 16 z e π u α u β u α u u e μ u 1 λ u 1 ψ e ψ r α r β r α r r e μ r 1 λ r 1 where α i i u r is the designed virtual control law as for the traditional backstepping approach tong and li 2014 shao et al 2019 the virtual control laws require to be differentiated repeatedly at each step unfortunately that will lead to the explosion of complexity problem for this consideration the dsc and the command filter techniques are proposed to overcome this difficulty shao and shi 2020 zhu et al 2018 in the proposed algorithm the command filter technique is employed to acquire the approximating derivative of the virtual control signals i e β i specially let the virtual control terms pass into a second order filter as fig 4 in the filter ω i is the natural frequency with ω i 0 and ς i 0 1 with the increase of ω i the output signal β i can converge precisely to the input value α i by introducing the filter the analytical calculation of the virtual control signals is thus avoided and the computation complexity is reduced though the filter error is incorporated into the closed loop system which may lead to the inferior control performance for this purpose the related compensating signals 17 are designed to eliminate the adverse impacts caused by the filter error 17 s u 1 k z u 1 s u 1 β u α u s u 2 k z u 2 s u 2 s r 1 k z r 1 s r 1 β r α r s r 2 k z r 2 s r 2 where k z u 1 k z r 1 k z u 2 k z r 2 are some positive design constants for merits of the filter compensating signals the compensating tracking errors are improved as 18 18 z u 1 z e s u 1 π u α u u e k z u 1 s u 1 μ u 1 λ u 1 z r 1 ψ e s r 1 ψ r α r r e k z r 1 s r 1 μ r 1 λ r 1 then the virtual control laws are chosen as 19 19 α u k z u 1 z e s u 2 μ u 1 λ u 1 π u α r k z r 1 ψ e s r 2 μ r 1 λ r 1 ψ r step 2 in this step the goal is to stabilize the kinetic error dynamic of the underactuated ship under assumptions 1 3 by differentiating eq 15 along eqs 2 and 12 the original kinetic error dynamic are constructed as the following 20 20 u e β u f u ν τ u c m u d w u μ u 2 λ u 2 r e β r f r ν τ r c m r d w r μ r 2 λ r 2 as mentioned in xu et al 2013 li et al 2004 the radial basis function nns are with outstanding approximation capability for the nonlinear continuous function based on lemma1 the nonlinear term f i i u r could be treated as 21 21 f i ν s ν a i ν ε i s ν a i β ν λ ν 2 s ν 2 z ν 2 ε i s ν a i β ν λ ν 2 s ν 2 b i s ν w i ε i where z ν 2 z u 2 0 z r 2 t β ν β u 2 v β r 2 t λ ν 2 λ u 2 0 λ r 2 t s ν 2 s u 2 0 s r 2 t it is noted that the nns are with the same basis function for the u and r subsystems therefore the heavy computation burden can be decreased to facilitate the practical implementation of the proposed algorithm to construct the related damping term one defines the following variables as b i a i f a i m a i b i w i a i m z ν 2 and these damping variables can be derived easily as b i w i a i z ν 2 based on the above analysis the related error dynamics 20 could be rewritten as 22 23 22 u e 2 β u ϒ u b u s ν w u τ u c m u d w u μ u 2 λ u 2 r e 2 β r ϒ r b r s ν w r τ r c m r d w r μ r 2 λ r 2 with 23 ϒ i s ν a i β ν λ ν 2 s ν 2 ε i s ν a i f β ν λ ν 2 s ν 2 ε i max θ i ϕ i where θ i max a i f ε i max ϕ i is the related damping term with the following definition as ϕ i 1 s ν β ν λ ν 2 s ν 2 following the design procedure in the step 1 the kinetic error can be modified as 24 by introducing the saturation compensating term 24 z u 2 u e λ u 2 z r 2 r e λ r 2 differentiating z u 2 and z r 2 along 10 and 20 eq 25 can be got to facilitate the control design 25 z u 2 β u ϒ u b u s ν w u τ u c m u d w u μ u 2 λ u 2 k z u 2 s u 2 z r 2 β r ϒ r b r s ν w r τ r c m r d w r μ r 2 λ r 2 k z r 2 s r 2 choose the command control input as 26 26 τ u c m u k z u 2 u e ξ ˆ u φ u z u 2 d ˆ w u μ u 2 λ u 2 z u 1 β u τ r c m r k z r 2 r e ξ ˆ r φ r z r 2 d ˆ w r μ r 2 λ r 2 z r 1 β r where φ i s ν s ν t 4 γ 1 2 ϕ i 2 4 γ 2 2 i u r meets the condition as 0 φ i m i m i γ 1 and γ 2 are positive constants ξ ˆ i is the estimated value of ξ i max θ i 2 b i 2 d ˆ w i is the estimated value of the ocean disturbance d w i to improve the approximation performance of the intelligent approximation model the improved spem 27 is established to generate the estimation value of u and r different from the conventional spem in xu and sun 2017 li et al 2014 the improved spem is with the simplified structure and the intelligent approximation and disturbance estimation is included 27 u ˆ ξ ˆ u φ u δ u d ˆ w u τ u m u ρ u δ u r ˆ ξ ˆ r φ r δ r d ˆ w r τ r m r ρ r δ r note that δ u i u r is the prediction error 28 needed to be defined later and ρ i is the convergence coefficient 28 δ u u u ˆ δ r u r ˆ consequently the adaptive law could be designed as 29 29 ξ ˆ u γ u φ u δ u 2 z u 2 2 σ u ξ ˆ u ξ ˆ u 0 ξ ˆ r γ r φ r δ r 2 z r 2 2 σ r ξ ˆ r ξ ˆ r 0 where l i and σ i are two design parameters selected by the user λ ˆ i is the initial value of λ i d w i d ˆ w i d w i i u r in the existing literatures the external ocean disturbance is usually tackled with the approximation based calculation scheme in this note one develops the disturbance observer 30 to estimate the unknown disturbance as discussed in xu et al 2016 chen et al 2016 the disturbance observer is with the function of the real time estimation and compensation for the unknown disturbance different from the existing results the spem based prediction is included to improve the learning capability of the observer and the faster convergence can be achieved furthermore the proposed cdob is without requiring the extra adaptive parameters to guarantee the disturbance estimating performance 30 d ˆ w i l i i q i i u r q i ξ ˆ i φ i d ˆ w i τ i m i l i 1 z i 2 δ i γ 1 z u 2 2 z r 2 2 where q i is the auxiliary variable in the proposed composite compensating mechanism remark 3 it is worth noticing that the robust neural damping technique is employed to simplify the nns approximation procedure and considerable computation burden is thus reduced by incorporating the disturbance compensating term a modified spem is established such that the system tracking performance could be improved in addition the construction of cdob could enhance the system robustness against the external disturbance especially the proposed cdob does not acquire the accurate model information that is beneficial to the practical applications of the theoretical algorithm 4 stability analysis in this section the complete proof around the stability analysis of the control system will be given which is based on the assessment of the error dynamics between the virtual ship and the real ship the main result of this note is summarized as theorem 1 theorem 1 under assumptions 1 3 consider the underactuated ship model 1 2 3 for any initial conditions satisfying z u 1 0 2 z u 2 0 2 z r 1 0 2 z r 2 0 2 δ u 0 2 δ r 0 2 d w u 0 2 d w r 0 2 ξ u 0 2 ξ r 0 2 2 λ with any λ 0 the composite control law 19 26 the adaptive law 29 the disturbance observer 30 will guarantee that all signals in the closed loop system are sguub by selecting these parameters k z u 1 k z r 1 k z u 2 k z r 2 ρ u ρ r γ 1 γ 2 l u l r μ u 1 μ u 2 μ r 1 μ r 2 γ u γ r appropriately proof choose the following lyapunov candidate function 31 v i u r 1 2 z i 1 2 1 2 z i 2 2 1 2 δ i 2 1 2 d w i 2 1 2 ξ i 2 on the basis of the above systematic analysis the time derivative of 31 could be derived as 32 along 18 19 25 26 29 and 30 32 v i u r z i 1 z i 1 z i 2 z i 2 δ i δ i d w i d w i ξ i ξ i i u r k i e 1 z i 1 2 k i e 2 z i 2 2 ξ i 1 z i 2 d w i z i 2 ρ i δ i 2 d w i δ i ξ i 2 δ i l i d w i 2 l i ξ i 3 d w i d w i ξ i ξ i with 33 ξ i 1 ξ ˆ i φ i z i 2 b i s ν w i ϒ i ξ i 2 ξ ˆ i φ i δ i b i s ν w i ϒ i ξ i 3 ξ ˆ i φ i b i s ν w i ϒ i by virtue of the inequality in 23 and the young s inequality eqs 34 and 35 can be concluded 34 b i s ν w i ϒ i b i s ν w i θ i ϕ i b i 2 s ν s ν t 4 γ 1 2 γ 1 2 w i t w i θ i 2 4 γ 2 2 ϕ i 2 γ 2 2 ξ i φ i γ 1 2 w i t w i γ 2 2 35 w i t w i a i m z ν 2 1 a i f w i 1 2 w i 2 2 w i l 2 z ν 2 t z ν 2 z u 2 2 z r 2 2 owing to the above useful deduction eq 32 can be rewritten as eq 36 36 v i u r k i e 1 z i 1 2 k i e 2 4 γ 1 z i 2 2 l i d w i 2 l i ξ i φ i d w i d w i d w i l i γ 2 d w i ρ i δ i 2 σ i ξ i ξ ˆ ξ ˆ 0 2 γ i 2 2 considering that d w i is with the upper bound d w i 37 could be derived through the young s inequality 37 d w i d w i 1 2 d w i 2 1 2 d w i l i φ i ξ i d w i 1 2 ξ i 2 l i 2 m i 2 1 2 d w i 2 l i γ 2 d w i 1 2 l i 2 γ 2 2 d w i 2 1 2 ξ i ξ ˆ i ξ ˆ i 0 1 2 ξ i 2 1 2 ξ i ξ ˆ i 0 2 based on the above analysis eq 38 could be obtained to achieve the bounded stability of the closed loop system 38 v i u r k i e 1 z i 1 2 k i e 2 4 γ 1 z i 2 2 ρ i δ i 2 l i 1 2 l i 2 γ 2 2 1 d w i 2 1 2 σ i 1 2 l i 2 m i 2 ξ i 2 ϱ where ϱ 1 2 d w u 2 1 2 d w r 2 1 4 γ 2 2 1 2 σ u ξ u ξ ˆ u 0 2 1 2 σ r ξ r ξ ˆ r 0 2 is a small positive constant one selects a 1 k z u 1 a 2 k z r 1 a 3 k z u 2 4 γ 1 a 4 k z r 2 4 γ 1 a 5 ρ u a 6 ρ r a 7 l u 1 2 l u 2 γ 2 2 1 a 8 l r 1 2 l r 2 γ 2 2 1 a 9 1 2 σ u 1 2 l u 2 m u 2 a 10 1 2 σ r 1 2 l r 2 m r 2 and 39 could be derived to facilitate the stability analysis 39 v 2 b v ϱ where b min a 1 a 2 a 3 a 4 a 5 a 6 a 7 a 8 a 9 a 10 integrating two sides of 39 the formula v ϱ 2 b v 0 ϱ 2 b exp 2 b t could be derived based on the discussions concerning the closed loop shaping algorithm in zhang and zhang 2013 it is obvious that v is bounded that also means that all signals closed loop system could be guaranteed to be sguub under the proposed control law and adaptive law the whole stability proof is completed remark 4 by implementing the proposed control scheme all signals in the closed loop system are with the bounded stability in view of the existence of the time varying disturbance such a result can be reasonable and accepted in filed of marine cybernetics although the nns are used to compensate the ship model uncertainty it should be noted that the nns will have the satisfied approximating capability only in the suitable compact set that directly leads to the semi global system stability instead of the global one how to obtain the global stability result is worth more attention and attempt for the ship path following control 5 illustrative experiment to verify the effectiveness and superiority of the proposed scheme some interesting experiments are carried out in this section including the comparative experiment and the practical waypoints based navigating experiment in both experiments the monohull ship is selected as the experiment objective which has the length of 38 m and the mass of 118 10 3 kg and the detailed hydraulic parameters in the mathematical model 1 2 and 3 could be found in do et al 2004 5 1 comparative experiment in this experiment the proposed control law will be compared with the result in meng and guo 2015 in the comparison the parameterized desired path 40 is generated by the virtual ship where the straight path and curve one are included furthermore the nonzero mean time varying disturbance is applied in the plant of interest i e eq 41 that contributes to illustrating the robustness of the proposed controller 40 r d exp 0 005 t 400 0 s t 30 s 0 30 s t 60 s 0 07 60 s t 180 s the design parameters of the proposed method are listed as k z u 1 5 k z r 1 70 μ u 1 35 μ r 1 5 k z u 2 0 96 k z r 2 1 27 μ u 2 1 μ r 2 3 5 l u 180 l r 150 ρ u 1 5 ρ r 1 5 γ 1 4 2 γ 2 4 2 σ u 1 5 σ r 2 5 γ u 5 5 γ r 8 5 u d 4 m s although there exist many design parameters required be determined the trial and error strategy can be used to selecting the appropriate parameters the initial states of the actual ship are selected as x 0 y 0 ψ 0 u 0 v 0 r 0 15 m 15 m 0 2 rad 0 m s 0 m s 0 rad s and the initial states of the other related variables are 0 the nns selected for f u ν and f r ν include 30 nodes with centers spaced in 10 m s 10 m s for the surge speed u 2 5 rad s 2 5 rad s for the yaw velocity r as for the parameter setting in the comparative algorithm the readers are suggested to refer to meng and guo 2015 41 d w u 11 12 1 0 35 sin 0 3 t 0 15 cos 0 5 t d w v 26 17 76 1 0 3 sin 0 4 t 0 2 cos 0 1 t d w r 950 636 1 0 3 sin 0 3 t 0 1 cos 0 5 t the final comparative results are shown in figs 5 8 fig 5 gives the 2 dimensional 2d planar graph of the path following trajectory under two different algorithms although both control mechanisms can achieve the effective tracking for the reference path the proposed algorithm is with the better tracking capability from the local enlarged detail in fig 5 furthermore some critical indexes including the position error and the orientation error are displayed in fig 6 which are valuable to evaluate the tracking performance note that the error steady performance is better under the proposed algorithm moreover since the proposed control algorithm takes the input saturation problem into account the actual control input in fig 7 is with the bounded restriction that is more in accordance with the marine practice due to the incorporation of the prediction error the composite adaptive law can be stabilized quickly from fig 8 although in the presence of the input saturation constraint based on the above analysis the proposed control law is with the better control performance and more competitive in comparison with the result in meng and guo 2015 42 mae 1 t f t 0 t 0 t f e t d t mai 1 t f t 0 t 0 t f τ t d t mtv 1 t f t 0 t 0 t f τ t 1 τ t d t for the quantity analysis some popular performance indexes 42 are employed to validate further the comparison result such as the mean absolute error mae the mean absolute control inputs mai and the mean total variation mtv mae explains the stabilizing capability of the control system mai and mtv are the indexes describing the energy consumption table 2 gives the experiment data under both mechanisms with respect to the above mentioned three performance indexes note that the proposed algorithm is with better performance than the approach in meng and guo 2015 in practice the control procedure runs based on the industrial computer and the considerations on computation burden are critical to explore the computation performance of both algorithms the memory held and the scanning time are used for computation performance comparison and the detailed result is listed on table 3 obviously the computation burden can be reduced greatly by implementing the proposed control law such a superiority will facilitate the practical application of the theoretical algorithm 5 2 waypoints based path following experiment in the simulated environment in this part one performs the waypoints based path following experiment to illustrate the practical feasibility of the proposed scheme where the proposed composite control is implemented with the lvs guidance in the experiment the waypoints based reference path is generated by six waypoints w 1 0 m 0 m w 2 800 m 0 m w 3 1100 m 600 m w 4 2400 m 600 m w 5 3000 m 0 m w 6 3700 m 0 m the initial states of the actual ship are set as x 0 y 0 ψ 0 u 0 v 0 r 0 20 m 20 m 3 14 rad 5 m s 0 m s 0 rad s the initial states of required variables are default as 0 the control parameters are still set along with the comparative example with respect to the environment disturbance the physics based mathematical model is investigated deeply to simulate the complicated disturbance including the wind and wind generated waves specially the wind and waves disturbance are produced based on the norsok wind spectrum and the jonswap wave spectrum respectively the mean wind speed is set as v wind 19 0 m s and the wind direction going from is ψ wind 40 deg the corresponding two dimension wind field and the wave disturbance has been given in fig 9 for the more detailed knowledge around the simulated environment please refer to these representative literatures fossen 2011 the simulated results are shown in figs 10 12 fig 10 describes the waypoints based ship path following trajectory under the proposed scheme note that the proposed algorithm could force the real ship to track closely the reference path in whole process the running performance of the control input as displayed in fig 11 is reasonable meanwhile the input saturation constraint has been also considered fully though there exists the evident chattering phenomenon for the control signals it should be pointed out that the practical marine actuators including the main engine and the rudder servo device are with the filtering effect for the specific input thus there is no need for worrying about the chattering phenomenon in the marine practice furthermore it can be observed from fig 12 that the time varying ocean disturbance could be estimated in real time by the composite disturbance observer and the estimating accuracy is excellent the above experiment results could demonstrate that the proposed scheme can implement effectively the waypoints based path following task even in the presence of the complex ocean disturbance 6 conclusion this paper has proposed a practical control algorithm for the underactuated ship to perform the waypoints based path following mission firstly the saturation compensating signals are designed to modify the tracking error and the actuator input saturation problem is thus tackled although the nns are used to deal with the model uncertainty no nns related adaptive parameters are required to be updated and the approximating performance of nns can be improved further by introducing the simplified spem the command filter technique is employed to solve the explosion of complexity problem and the filter error is removed via the related compensating term in addition the composite disturbance observer is developed to estimate accurately the unknown disturbance in this way the excellent tracking performance and system robustness can be obtained in the proposed algorithm the bounded stability of the closed loop system is also proved by virtue of the lyapunov theory based on the illustrative experiment the effectiveness of the proposed algorithm has been verified well to the authors best knowledge the lvs guidance algorithm has been improved and applied in the field of the cable laying and the automatic obstacle avoidance note that the plant of interest in the corresponding work is still the underactuated surface ship for the autonomous underwater vehicle auvs the existing lvs guidance law requires to be improved in the 3d environment the will be the research focus in our further work credit authorship contribution statement guoqing zhang methodology software formal analysis writing original draft project administration chenliang zhang conceptualization software validation writing review editing tingting yang validation formal analysis writing review editing weidong zhang project administration funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the paper is partially supported by the national natural science foundation of china 51909018 51679024 the natural science foundation of liaoning province 20170520189 20180520039 the science and technology innovation foundation of dalian city 2019j12gx026 the national postdoctoral program for innovative talents bx201600103 the fundamental research funds for the central universities of china 3132019306 3132020124 and the postgraduate innovation project of dalian maritime university sscxxm001 the authors would like to thank anonymous reviewers for their valuable comments 
21523,this paper investigates the constrained waypoints based path following control problem of underactuated ships in the presence of the actuator saturation and the unknown disturbance an improved composite neural learning control algorithm is proposed by using the command filter and the robust neural damping techniques in the proposed algorithm the dynamic auxiliary system is established to generate the saturation error compensating sec signal which is used to modify the error dynamics such that the actuator saturation constraint is tackled the neural networks are employed to deal with the model uncertainty and the corresponding compensating effects are improved further by designing the simplified serial parallel estimation model spem by constructing the robust neural damping term only two adaptive parameters are required to be updated online that leads to a smaller computational application burden furthermore the composite disturbance observer cdob is developed by fusion of the prediction error and the compensated tracking one where the unknown disturbance can be estimated accurately and compensated effectively in addition considerable efforts are made to obtain the semi global uniformly ultimately bounded sguub stability of the closed loop system the convictive experiments are performed to verify the effectiveness and superiority of the proposed algorithm keywords underactuated ship path following control composite neural learning input saturation disturbance observer in recent years the path following control of underactuated ships has attracted extensive attentions from the control community due to its wide applications in the field of ocean engineering e g the long disturbance freight transportation the ocean exploitation and the maritime patrol as a result a large number of valuable results have been presented in the existing literatures ghommam et al 2018 do 2016 meng and guo 2015 zhang chu jin and zhang 2020a in the practical engineering the industrial systems are always with some inherent restrictions e g the input saturation constraint and the dead zone dynamics as pointed in tong wang li and zhang 2013 yu et al 2016 esfandiari et al 2014 these physical constraints may cause the inferior closed loop performance and even lead to the system instability once they are omitted in the system design therefore it deserve more investigations on the path following control of underactuated ships with the input saturation that is of theoretical and practical significance in the marine industry in the engineering practice the underactuated ship may inevitably suffer from the actuator input limitation due to its finite actuation energy yu et al 2018 liu et al 2017 for this consideration a variety of pioneering works have been reported in wen et al 2011 chen et al 2011 zheng and sun 2016 boskovic et al 2004 zhu et al 2018 in wen et al 2011 a backstepping based adaptive control algorithm is developed to deal with the regulation problem of the single input single output siso system subject to the input saturation in the algorithm the nussbaum function is used to modify the nonlinear terms arising from the input saturation in addition chen et al 2011 presents the model based control mechanism to stabilize the multi input multi output mimo system where the auxiliary system is introduced to analyze the effect of the actuator physical constraint note that the corresponding theoretical results have been applied into the practical systems including the marine surface vessels zheng and sun 2016 and the spacecrafts boskovic et al 2004 in zhu et al 2018 a constrained adaptive neural control algorithm is proposed for the strict feedback system with the deviate error between the order variable and executing one as the system inputs the auxiliary system is constructed to acquire the unique compensating signals that could generate the damping effect to prevent the saturation phenomenon of the control command especially for the condition that the input order would approach the saturated limitation for the control design of nonlinear system it is still challenging to deal with effectively the system model uncertainity oh and sun 2010 ghommam et al 2018 in the existing literatures a series of approximation based adaptive schemes have been developed by using the neural networks nns shao tian yang and zhang 2020b han et al 2018 and the fuzzy logic system fls tong and li 2010 xiang et al 2018 considering the powerful learning ability of nns a adaptive neural sliding mode controller is designed in chen et al 2013 where the system uncertainty is tackled by compensating its unknown upper bound and the asymptotical stability of the closed loop system can be strictly guaranteed to improve further the approximation accuracy of nns the composite intelligent learning control algorithm is discussed in xu and sun 2017 by introducing the serial parallel estimation model spem the similar effect has also been achieved in li et al 2015 2014 via the fuzzy state observer it is noted that the composite learning control mechanism put much focus on the interpretability of the nns approximation model instead of the lyapunov theory nevertheless the continuous updating of nns weights would lead to the burdensome computation problem when the corresponding algorithm is implemented in the industrial central processing unit cpu chip that may limit the engineering application the theoretical algorithm to this end a concise robust control law is derived by using the dynamic surface control dsc and the minimum learning parameters mlp techniques zhang and zhang 2013 owing to the robust damping technique the proposed algorithm only requires four adaptive parameters to compensate the lumped disturbance and the computation complexity is thus reduced by virtue of the finite time convergence property the corresponding results are extended to the case of the automatic obstacle avoidance and the dynamic positioning control zhang et al 2017 zhang yao xu and zhang 2020b on the other hand due to the fact that the underactuated ship is always exposed to the unknown ocean disturbance it is of great importance to deal with the external disturbance for the controller design based on the nns approximating technique or the disturbance estimating theory various excellent approaches have been presented to compensate the unknown disturbance in the last few years in zhang et al 2017 the unknown disturbance is compensated together with the model uncertainty via the nns related adaptive law for deep insight into the dynamics of the disturbance the disturbance estimating mechanisms have been widely studied in lu et al 2018 a nns based disturbance observer is developed by using the mlp technique and the satisfied disturbance estimation performance is achieved then wang et al 2018 establishes the finite time disturbance observer ftdob for the underactuated ship to perform the path following task it is noted that the ftdob depends on the accurate model parameters and structures of ships however the precise model information is difficult to obtain in the marine practice sun et al 2017 ejaz and chen 2018 motivated by the above observations one concentrates on the practical path following control of underactuated ships where the actuator saturation and waypoints based navigating practice are fully considered the main contributions of this paper are summarized as follows 1 the constrained composite neural control algorithm is proposed for the underactuated ship to perform the waypoints based path following task in the proposed algorithm the inherent physical limitation of actuators is tackled by incorporating the saturation error compensating sec signals specially the related compensating terms are used to modify the system error dynamics and the novel composite adaptive law is thus developed to ensure the control performance and bounded stability of the closed loop system 2 based on the nns approximating theory the ship s uncertain structure and parameters can be compensated and the corresponding compensating effect is improved by incorporating the modified spem though no nns related adaptive parameters are required to be updated online owing to the robust neural damping technique although the filter is introduced to solve the explosion of complexity problem the filter error is eliminated in the proposed scheme via the filter compensating terms furthermore the prediction error and the compensating tracking one are employed to derive the composite disturbance observer cdob where the unknown disturbance can be estimated accurately to guarantee the robustness of the closed loop system 1 problem formulation 1 1 notations throughout this paper denotes the absolute value of a scalar while denotes the frobenius norm of implying that f i 1 n j 1 m x i j 2 where can be either a matrix or vector or scalar sgn denotes the sign function 1 2 mathematical model of underactuated ships this section briefly describes the three degrees of freedom dofs maneuvering model of the underactuated ship moving in the horizontal plane i e eqs 1 3 where only the surge sway and yaw motion are considered for more details around the mathematical model of the underactuated ship the readers are suggested to refer to fossen 2011 1 x u cos ψ v sin ψ y u sin ψ v cos ψ ψ r 2 u f u ν τ u m u d w u v f v ν d w v r f r ν τ r m r d w r with 3 f u ν m v m u v r d u 1 m u u d u 2 m u u u d u 3 m u u 3 f v ν m u m v u r d v 1 m v v d v 2 m v v v d v 3 m v v 3 f r ν m u m v m r u v d r 1 m r r d r 2 m r r r d r 3 m r r 3 as described in fig 1 the position and orientation of the underactuated ship in the earth fixed frame are defined by η x y ψ t ν u v r t denotes the surge sway velocities and yaw rate in the body fixed frame respectively f u f v f r are considered as the high order hydrodynamic effects and the model parameters m u m v m r represent the added mass in three directions d i 1 d i 2 d i 3 i u v r are employed to describe the hydrodynamic damping terms d w u d w v d w r are the external disturbances arising from the wind waves and ocean currents τ u and τ r denote the surge force and the yaw moment which are the control inputs of the underactuated ship in practice the control input of the marine actuator is bounded due to its physical constraint the constraint details can be described by the following saturation function as eq 4 4 τ i sat τ i τ i max i f τ c i τ i max τ c i i f τ i min τ c i τ i max i u r τ i min i f τ c i τ i min where τ c i is the command control input while the τ i max and τ i min are the upper bound and lower bound of the physical limitation assumption 1 there exists an unknown positive constant d i max i u v r such that the external disturbance meets the condition as d w i d i max moreover its first order derivative d w i is considered with an upper bound d w u assumption 2 based on the rigorous analysis in li lee jun and lim 2008 the sway velocity of the underactuated ship is considered as passive bounded remark 1 since the time varying environment disturbance keeps changing with finite energy the disturbance force or moment acting on the marine surface vehicles is usually bounded thus the assumption 1 is reasonable in addition considering that the ship s sway velocity is always attenuated by the hydrodynamic damping effects the passive bounded result of the sway velocity is commonly considered as tenable yu et al 2018 lu et al 2018 in this note our control objective is to develop an improved composite adaptive scheme for underactuated ships such that the waypoints based reference path can be tracked accurately meanwhile all signals in the closed loop system are guaranteed to be semi global uniformly ultimately bounded sguub 1 3 function approximation with nns in the existing studies zhang zhang li and zhang 2020c he et al 2016 the radial basis function nns are usually used to model the unknown nonlinear continuous function due to their universal approximation capability in the proposed algorithm the radial basis function nns are utilized to approximate the ship model uncertainty by fusion of the robust neural damping technique the numerous nns weights are compressed such that the computation burden of the control procedure is reduced dramatically only two adaptive parameters are required to compensate the ship model uncertainty for this consideration lemma 1 is useful lemma 1 shao liu and wang 2020a for any given real continuous functions f x with f 0 0 over a compact set ω x f x could be written as 5 by employing the radial basis function nns approximation technique and the continuous function separation techniques 5 f x s x ax ε x ω x where s x s 1 x s 2 x s n x is the basis function vector with s i x being chosen as the gaussian function 6 ε is the approximating error satisfying ε ε m a x where ε max is a positive unknown constant 6 s i x 1 2 π h i exp x μ i 2 2 h i 2 i 1 n where μ i is the center of the receptive field and h i is the width of the gaussian function a 7 is an optimal weight matrix 7 a w 11 w 12 w 1 m w 21 w 22 w 2 m w n 1 w n 2 w n m 2 logical virtual ship guidance in the marine practice the planned route of the underactuated ship is usually made by the ship officer and the waypoint information w i x i y i will be fully utilized it can be seen easily that the navigating reference path could be splitted into two parts the straight line and the curve one for this consideration the logical virtual ship lvs guidance principle has been proposed to generate the smooth waypoints based attitude reference based on the piecewise logical programming strategy see fig 2 it is noted that the virtual ship 8 is assumed as an ideal ship with no inertia and no damping effects 8 x d u d cos ψ d y d u d sin ψ d ψ d r d part 1 the virtual ship sails at a fixed speed u d when sailing along the straight line l s and the corresponding sailing time could be calculated according to t s l s u d in particular the sailing speed of the virtual ship can be adjusted by the ship officer on the basis of the specific mission requirements part 2 for the curve one one needs to determine the real time turning radius r i 9 to obtain the related turning rate r d where the maneuvering ability and practical heading change δ φ i of underactuated ships will be fully considered 9 r i r max i f δ φ i π 2 r max r min δ φ i sign δ φ i π 2 i f δ φ i π 2 where r min and r max are the maximum turning radius and minimum turning radius of underactuated ships by referring to the calculation method in part 1 one could acquire the sailing time in the curve line path t c δ φ i r d table 1 gives some significant command signals in the waypoints based lvs guidance including the required key command signal rkcs and the given key command signal gkcs that contributes to enhancing the reader s understanding for the lvs guidance principle by means of the lvs guidance principle the smooth waypoints based reference path could be obtained that means that the real time attitude reference signal of the virtual ship could be employed to carry out the path following control as fig 3 remark 2 based on the sailing principle in zhang and zhang 2013 zhang et al 2020a the lvs based guidance mechanism is proposed by fusion of the considerations on the ship maneuverability and the marine experience especially for the determination of the real time turning radius under different path change angles in the proposed lvs based guidance mechanism the automatic programming capability of the virtual ship can be used for acquiring the smooth waypoints based reference path via the piecewise logical programming strategy in the marine practice the proposed guidance mechanism is more aligned with the common path following tasks of the merchant ship for the other marine cases similar to the waypoints based path following mission e g the submarine cable laying operation the lvs based guidance mechanism may become the potential reference strategy to improve the corresponding engineering efficiency 3 design of the disturbance observer based constrained composite neural control algorithm inspired by the command filter and the robust neural damping techniques the disturbance observer based composite neural control law is derived to stabilize the error dynamics between the virtual ship and the real ship in the algorithm some interesting problems are considered to improve the engineering applicability of the proposed algorithms e g the actuator input saturation and the real time computational application burden the systematic design procedure consists of two steps the kinematic and kinetic controls combing the available reference signals and the theoretical assumptions the detailed introduction will be show in this section step 1 in this step the objective is to stabilize the kinematic error dynamics between the actual ship and virtual ship by referring to fig 3 one defines the kinematic error as 10 10 x e x d x y e y d y ψ e ψ r ψ z e x e 2 y e 2 note that ψ r 11 is the desired azimuth angle relative to the virtual ship and it could be obtained by utilizing these kinematic error signals 11 ψ r 0 5 1 sgn x e sgn y e π arctan y e x e in order to overcome the input saturation constraint of marine actuators the dynamical auxiliary system 12 is introduced to generate the compensating signals λ i 1 and λ i 2 i u r 12 λ i 1 λ i 2 μ i 1 λ i 1 λ i 2 δ τ i m i μ i 2 λ i 2 where δ τ i τ i τ i c and the initial value of λ i is 0 μ i 1 and μ i 2 are user defined positive design parameters after incorporating the sec signals the tracking errors are modified as eq 13 13 z e z e λ u 1 ψ e ψ e λ r 1 take the time derivative of z e and ψ e along 10 12 and 13 the corresponding error dynamics 14 can be derived 14 z e π u u λ u 2 μ u 1 λ u 1 ψ e ψ r r λ r 2 μ r 1 λ r 1 where π u x d cos ψ r y d sin ψ r v sin ψ e 2 u sin 2 0 5 ψ e for convenience of the subsequent design the following error variables 15 are defined 15 u e β u u u e u e λ u 2 r e β r r r e r e λ r 2 substituting 15 into 14 yields 16 16 z e π u α u β u α u u e μ u 1 λ u 1 ψ e ψ r α r β r α r r e μ r 1 λ r 1 where α i i u r is the designed virtual control law as for the traditional backstepping approach tong and li 2014 shao et al 2019 the virtual control laws require to be differentiated repeatedly at each step unfortunately that will lead to the explosion of complexity problem for this consideration the dsc and the command filter techniques are proposed to overcome this difficulty shao and shi 2020 zhu et al 2018 in the proposed algorithm the command filter technique is employed to acquire the approximating derivative of the virtual control signals i e β i specially let the virtual control terms pass into a second order filter as fig 4 in the filter ω i is the natural frequency with ω i 0 and ς i 0 1 with the increase of ω i the output signal β i can converge precisely to the input value α i by introducing the filter the analytical calculation of the virtual control signals is thus avoided and the computation complexity is reduced though the filter error is incorporated into the closed loop system which may lead to the inferior control performance for this purpose the related compensating signals 17 are designed to eliminate the adverse impacts caused by the filter error 17 s u 1 k z u 1 s u 1 β u α u s u 2 k z u 2 s u 2 s r 1 k z r 1 s r 1 β r α r s r 2 k z r 2 s r 2 where k z u 1 k z r 1 k z u 2 k z r 2 are some positive design constants for merits of the filter compensating signals the compensating tracking errors are improved as 18 18 z u 1 z e s u 1 π u α u u e k z u 1 s u 1 μ u 1 λ u 1 z r 1 ψ e s r 1 ψ r α r r e k z r 1 s r 1 μ r 1 λ r 1 then the virtual control laws are chosen as 19 19 α u k z u 1 z e s u 2 μ u 1 λ u 1 π u α r k z r 1 ψ e s r 2 μ r 1 λ r 1 ψ r step 2 in this step the goal is to stabilize the kinetic error dynamic of the underactuated ship under assumptions 1 3 by differentiating eq 15 along eqs 2 and 12 the original kinetic error dynamic are constructed as the following 20 20 u e β u f u ν τ u c m u d w u μ u 2 λ u 2 r e β r f r ν τ r c m r d w r μ r 2 λ r 2 as mentioned in xu et al 2013 li et al 2004 the radial basis function nns are with outstanding approximation capability for the nonlinear continuous function based on lemma1 the nonlinear term f i i u r could be treated as 21 21 f i ν s ν a i ν ε i s ν a i β ν λ ν 2 s ν 2 z ν 2 ε i s ν a i β ν λ ν 2 s ν 2 b i s ν w i ε i where z ν 2 z u 2 0 z r 2 t β ν β u 2 v β r 2 t λ ν 2 λ u 2 0 λ r 2 t s ν 2 s u 2 0 s r 2 t it is noted that the nns are with the same basis function for the u and r subsystems therefore the heavy computation burden can be decreased to facilitate the practical implementation of the proposed algorithm to construct the related damping term one defines the following variables as b i a i f a i m a i b i w i a i m z ν 2 and these damping variables can be derived easily as b i w i a i z ν 2 based on the above analysis the related error dynamics 20 could be rewritten as 22 23 22 u e 2 β u ϒ u b u s ν w u τ u c m u d w u μ u 2 λ u 2 r e 2 β r ϒ r b r s ν w r τ r c m r d w r μ r 2 λ r 2 with 23 ϒ i s ν a i β ν λ ν 2 s ν 2 ε i s ν a i f β ν λ ν 2 s ν 2 ε i max θ i ϕ i where θ i max a i f ε i max ϕ i is the related damping term with the following definition as ϕ i 1 s ν β ν λ ν 2 s ν 2 following the design procedure in the step 1 the kinetic error can be modified as 24 by introducing the saturation compensating term 24 z u 2 u e λ u 2 z r 2 r e λ r 2 differentiating z u 2 and z r 2 along 10 and 20 eq 25 can be got to facilitate the control design 25 z u 2 β u ϒ u b u s ν w u τ u c m u d w u μ u 2 λ u 2 k z u 2 s u 2 z r 2 β r ϒ r b r s ν w r τ r c m r d w r μ r 2 λ r 2 k z r 2 s r 2 choose the command control input as 26 26 τ u c m u k z u 2 u e ξ ˆ u φ u z u 2 d ˆ w u μ u 2 λ u 2 z u 1 β u τ r c m r k z r 2 r e ξ ˆ r φ r z r 2 d ˆ w r μ r 2 λ r 2 z r 1 β r where φ i s ν s ν t 4 γ 1 2 ϕ i 2 4 γ 2 2 i u r meets the condition as 0 φ i m i m i γ 1 and γ 2 are positive constants ξ ˆ i is the estimated value of ξ i max θ i 2 b i 2 d ˆ w i is the estimated value of the ocean disturbance d w i to improve the approximation performance of the intelligent approximation model the improved spem 27 is established to generate the estimation value of u and r different from the conventional spem in xu and sun 2017 li et al 2014 the improved spem is with the simplified structure and the intelligent approximation and disturbance estimation is included 27 u ˆ ξ ˆ u φ u δ u d ˆ w u τ u m u ρ u δ u r ˆ ξ ˆ r φ r δ r d ˆ w r τ r m r ρ r δ r note that δ u i u r is the prediction error 28 needed to be defined later and ρ i is the convergence coefficient 28 δ u u u ˆ δ r u r ˆ consequently the adaptive law could be designed as 29 29 ξ ˆ u γ u φ u δ u 2 z u 2 2 σ u ξ ˆ u ξ ˆ u 0 ξ ˆ r γ r φ r δ r 2 z r 2 2 σ r ξ ˆ r ξ ˆ r 0 where l i and σ i are two design parameters selected by the user λ ˆ i is the initial value of λ i d w i d ˆ w i d w i i u r in the existing literatures the external ocean disturbance is usually tackled with the approximation based calculation scheme in this note one develops the disturbance observer 30 to estimate the unknown disturbance as discussed in xu et al 2016 chen et al 2016 the disturbance observer is with the function of the real time estimation and compensation for the unknown disturbance different from the existing results the spem based prediction is included to improve the learning capability of the observer and the faster convergence can be achieved furthermore the proposed cdob is without requiring the extra adaptive parameters to guarantee the disturbance estimating performance 30 d ˆ w i l i i q i i u r q i ξ ˆ i φ i d ˆ w i τ i m i l i 1 z i 2 δ i γ 1 z u 2 2 z r 2 2 where q i is the auxiliary variable in the proposed composite compensating mechanism remark 3 it is worth noticing that the robust neural damping technique is employed to simplify the nns approximation procedure and considerable computation burden is thus reduced by incorporating the disturbance compensating term a modified spem is established such that the system tracking performance could be improved in addition the construction of cdob could enhance the system robustness against the external disturbance especially the proposed cdob does not acquire the accurate model information that is beneficial to the practical applications of the theoretical algorithm 4 stability analysis in this section the complete proof around the stability analysis of the control system will be given which is based on the assessment of the error dynamics between the virtual ship and the real ship the main result of this note is summarized as theorem 1 theorem 1 under assumptions 1 3 consider the underactuated ship model 1 2 3 for any initial conditions satisfying z u 1 0 2 z u 2 0 2 z r 1 0 2 z r 2 0 2 δ u 0 2 δ r 0 2 d w u 0 2 d w r 0 2 ξ u 0 2 ξ r 0 2 2 λ with any λ 0 the composite control law 19 26 the adaptive law 29 the disturbance observer 30 will guarantee that all signals in the closed loop system are sguub by selecting these parameters k z u 1 k z r 1 k z u 2 k z r 2 ρ u ρ r γ 1 γ 2 l u l r μ u 1 μ u 2 μ r 1 μ r 2 γ u γ r appropriately proof choose the following lyapunov candidate function 31 v i u r 1 2 z i 1 2 1 2 z i 2 2 1 2 δ i 2 1 2 d w i 2 1 2 ξ i 2 on the basis of the above systematic analysis the time derivative of 31 could be derived as 32 along 18 19 25 26 29 and 30 32 v i u r z i 1 z i 1 z i 2 z i 2 δ i δ i d w i d w i ξ i ξ i i u r k i e 1 z i 1 2 k i e 2 z i 2 2 ξ i 1 z i 2 d w i z i 2 ρ i δ i 2 d w i δ i ξ i 2 δ i l i d w i 2 l i ξ i 3 d w i d w i ξ i ξ i with 33 ξ i 1 ξ ˆ i φ i z i 2 b i s ν w i ϒ i ξ i 2 ξ ˆ i φ i δ i b i s ν w i ϒ i ξ i 3 ξ ˆ i φ i b i s ν w i ϒ i by virtue of the inequality in 23 and the young s inequality eqs 34 and 35 can be concluded 34 b i s ν w i ϒ i b i s ν w i θ i ϕ i b i 2 s ν s ν t 4 γ 1 2 γ 1 2 w i t w i θ i 2 4 γ 2 2 ϕ i 2 γ 2 2 ξ i φ i γ 1 2 w i t w i γ 2 2 35 w i t w i a i m z ν 2 1 a i f w i 1 2 w i 2 2 w i l 2 z ν 2 t z ν 2 z u 2 2 z r 2 2 owing to the above useful deduction eq 32 can be rewritten as eq 36 36 v i u r k i e 1 z i 1 2 k i e 2 4 γ 1 z i 2 2 l i d w i 2 l i ξ i φ i d w i d w i d w i l i γ 2 d w i ρ i δ i 2 σ i ξ i ξ ˆ ξ ˆ 0 2 γ i 2 2 considering that d w i is with the upper bound d w i 37 could be derived through the young s inequality 37 d w i d w i 1 2 d w i 2 1 2 d w i l i φ i ξ i d w i 1 2 ξ i 2 l i 2 m i 2 1 2 d w i 2 l i γ 2 d w i 1 2 l i 2 γ 2 2 d w i 2 1 2 ξ i ξ ˆ i ξ ˆ i 0 1 2 ξ i 2 1 2 ξ i ξ ˆ i 0 2 based on the above analysis eq 38 could be obtained to achieve the bounded stability of the closed loop system 38 v i u r k i e 1 z i 1 2 k i e 2 4 γ 1 z i 2 2 ρ i δ i 2 l i 1 2 l i 2 γ 2 2 1 d w i 2 1 2 σ i 1 2 l i 2 m i 2 ξ i 2 ϱ where ϱ 1 2 d w u 2 1 2 d w r 2 1 4 γ 2 2 1 2 σ u ξ u ξ ˆ u 0 2 1 2 σ r ξ r ξ ˆ r 0 2 is a small positive constant one selects a 1 k z u 1 a 2 k z r 1 a 3 k z u 2 4 γ 1 a 4 k z r 2 4 γ 1 a 5 ρ u a 6 ρ r a 7 l u 1 2 l u 2 γ 2 2 1 a 8 l r 1 2 l r 2 γ 2 2 1 a 9 1 2 σ u 1 2 l u 2 m u 2 a 10 1 2 σ r 1 2 l r 2 m r 2 and 39 could be derived to facilitate the stability analysis 39 v 2 b v ϱ where b min a 1 a 2 a 3 a 4 a 5 a 6 a 7 a 8 a 9 a 10 integrating two sides of 39 the formula v ϱ 2 b v 0 ϱ 2 b exp 2 b t could be derived based on the discussions concerning the closed loop shaping algorithm in zhang and zhang 2013 it is obvious that v is bounded that also means that all signals closed loop system could be guaranteed to be sguub under the proposed control law and adaptive law the whole stability proof is completed remark 4 by implementing the proposed control scheme all signals in the closed loop system are with the bounded stability in view of the existence of the time varying disturbance such a result can be reasonable and accepted in filed of marine cybernetics although the nns are used to compensate the ship model uncertainty it should be noted that the nns will have the satisfied approximating capability only in the suitable compact set that directly leads to the semi global system stability instead of the global one how to obtain the global stability result is worth more attention and attempt for the ship path following control 5 illustrative experiment to verify the effectiveness and superiority of the proposed scheme some interesting experiments are carried out in this section including the comparative experiment and the practical waypoints based navigating experiment in both experiments the monohull ship is selected as the experiment objective which has the length of 38 m and the mass of 118 10 3 kg and the detailed hydraulic parameters in the mathematical model 1 2 and 3 could be found in do et al 2004 5 1 comparative experiment in this experiment the proposed control law will be compared with the result in meng and guo 2015 in the comparison the parameterized desired path 40 is generated by the virtual ship where the straight path and curve one are included furthermore the nonzero mean time varying disturbance is applied in the plant of interest i e eq 41 that contributes to illustrating the robustness of the proposed controller 40 r d exp 0 005 t 400 0 s t 30 s 0 30 s t 60 s 0 07 60 s t 180 s the design parameters of the proposed method are listed as k z u 1 5 k z r 1 70 μ u 1 35 μ r 1 5 k z u 2 0 96 k z r 2 1 27 μ u 2 1 μ r 2 3 5 l u 180 l r 150 ρ u 1 5 ρ r 1 5 γ 1 4 2 γ 2 4 2 σ u 1 5 σ r 2 5 γ u 5 5 γ r 8 5 u d 4 m s although there exist many design parameters required be determined the trial and error strategy can be used to selecting the appropriate parameters the initial states of the actual ship are selected as x 0 y 0 ψ 0 u 0 v 0 r 0 15 m 15 m 0 2 rad 0 m s 0 m s 0 rad s and the initial states of the other related variables are 0 the nns selected for f u ν and f r ν include 30 nodes with centers spaced in 10 m s 10 m s for the surge speed u 2 5 rad s 2 5 rad s for the yaw velocity r as for the parameter setting in the comparative algorithm the readers are suggested to refer to meng and guo 2015 41 d w u 11 12 1 0 35 sin 0 3 t 0 15 cos 0 5 t d w v 26 17 76 1 0 3 sin 0 4 t 0 2 cos 0 1 t d w r 950 636 1 0 3 sin 0 3 t 0 1 cos 0 5 t the final comparative results are shown in figs 5 8 fig 5 gives the 2 dimensional 2d planar graph of the path following trajectory under two different algorithms although both control mechanisms can achieve the effective tracking for the reference path the proposed algorithm is with the better tracking capability from the local enlarged detail in fig 5 furthermore some critical indexes including the position error and the orientation error are displayed in fig 6 which are valuable to evaluate the tracking performance note that the error steady performance is better under the proposed algorithm moreover since the proposed control algorithm takes the input saturation problem into account the actual control input in fig 7 is with the bounded restriction that is more in accordance with the marine practice due to the incorporation of the prediction error the composite adaptive law can be stabilized quickly from fig 8 although in the presence of the input saturation constraint based on the above analysis the proposed control law is with the better control performance and more competitive in comparison with the result in meng and guo 2015 42 mae 1 t f t 0 t 0 t f e t d t mai 1 t f t 0 t 0 t f τ t d t mtv 1 t f t 0 t 0 t f τ t 1 τ t d t for the quantity analysis some popular performance indexes 42 are employed to validate further the comparison result such as the mean absolute error mae the mean absolute control inputs mai and the mean total variation mtv mae explains the stabilizing capability of the control system mai and mtv are the indexes describing the energy consumption table 2 gives the experiment data under both mechanisms with respect to the above mentioned three performance indexes note that the proposed algorithm is with better performance than the approach in meng and guo 2015 in practice the control procedure runs based on the industrial computer and the considerations on computation burden are critical to explore the computation performance of both algorithms the memory held and the scanning time are used for computation performance comparison and the detailed result is listed on table 3 obviously the computation burden can be reduced greatly by implementing the proposed control law such a superiority will facilitate the practical application of the theoretical algorithm 5 2 waypoints based path following experiment in the simulated environment in this part one performs the waypoints based path following experiment to illustrate the practical feasibility of the proposed scheme where the proposed composite control is implemented with the lvs guidance in the experiment the waypoints based reference path is generated by six waypoints w 1 0 m 0 m w 2 800 m 0 m w 3 1100 m 600 m w 4 2400 m 600 m w 5 3000 m 0 m w 6 3700 m 0 m the initial states of the actual ship are set as x 0 y 0 ψ 0 u 0 v 0 r 0 20 m 20 m 3 14 rad 5 m s 0 m s 0 rad s the initial states of required variables are default as 0 the control parameters are still set along with the comparative example with respect to the environment disturbance the physics based mathematical model is investigated deeply to simulate the complicated disturbance including the wind and wind generated waves specially the wind and waves disturbance are produced based on the norsok wind spectrum and the jonswap wave spectrum respectively the mean wind speed is set as v wind 19 0 m s and the wind direction going from is ψ wind 40 deg the corresponding two dimension wind field and the wave disturbance has been given in fig 9 for the more detailed knowledge around the simulated environment please refer to these representative literatures fossen 2011 the simulated results are shown in figs 10 12 fig 10 describes the waypoints based ship path following trajectory under the proposed scheme note that the proposed algorithm could force the real ship to track closely the reference path in whole process the running performance of the control input as displayed in fig 11 is reasonable meanwhile the input saturation constraint has been also considered fully though there exists the evident chattering phenomenon for the control signals it should be pointed out that the practical marine actuators including the main engine and the rudder servo device are with the filtering effect for the specific input thus there is no need for worrying about the chattering phenomenon in the marine practice furthermore it can be observed from fig 12 that the time varying ocean disturbance could be estimated in real time by the composite disturbance observer and the estimating accuracy is excellent the above experiment results could demonstrate that the proposed scheme can implement effectively the waypoints based path following task even in the presence of the complex ocean disturbance 6 conclusion this paper has proposed a practical control algorithm for the underactuated ship to perform the waypoints based path following mission firstly the saturation compensating signals are designed to modify the tracking error and the actuator input saturation problem is thus tackled although the nns are used to deal with the model uncertainty no nns related adaptive parameters are required to be updated and the approximating performance of nns can be improved further by introducing the simplified spem the command filter technique is employed to solve the explosion of complexity problem and the filter error is removed via the related compensating term in addition the composite disturbance observer is developed to estimate accurately the unknown disturbance in this way the excellent tracking performance and system robustness can be obtained in the proposed algorithm the bounded stability of the closed loop system is also proved by virtue of the lyapunov theory based on the illustrative experiment the effectiveness of the proposed algorithm has been verified well to the authors best knowledge the lvs guidance algorithm has been improved and applied in the field of the cable laying and the automatic obstacle avoidance note that the plant of interest in the corresponding work is still the underactuated surface ship for the autonomous underwater vehicle auvs the existing lvs guidance law requires to be improved in the 3d environment the will be the research focus in our further work credit authorship contribution statement guoqing zhang methodology software formal analysis writing original draft project administration chenliang zhang conceptualization software validation writing review editing tingting yang validation formal analysis writing review editing weidong zhang project administration funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the paper is partially supported by the national natural science foundation of china 51909018 51679024 the natural science foundation of liaoning province 20170520189 20180520039 the science and technology innovation foundation of dalian city 2019j12gx026 the national postdoctoral program for innovative talents bx201600103 the fundamental research funds for the central universities of china 3132019306 3132020124 and the postgraduate innovation project of dalian maritime university sscxxm001 the authors would like to thank anonymous reviewers for their valuable comments 
21524,this paper deals with the motion planning problem for surface vehicles in the presence of varying environmental disturbances the goal is to steer the vehicles from an initial to a final destination while ensuring connectivity and avoiding collision with fixed and moving obstacles the novelty lies in the coherent combination among various ingredients for path generation and potential field constructions for collision avoidance and connectivity maintenance all gathered in a distributed nmpc nonlinear model predictive control framework i los line of sight guidance and rrt optimal rapidly exploring random tree algorithms are employed for generating a collision free path considering static surroundings ii on off barrier functions activate the proposed potential field components which are in the view range of the agents hence ensuring safe navigation in a dynamic coastal environment with a low computation demand iii a ndo nonlinear disturbance observer is integrated in the nmpc design to compensate the environmental disturbances the proposed algorithm is validated through simulations and comparisons carried out over a benchmark for usvs unmanned surface vehicles safe navigation in the trondheim fjord norway keywords surface vehicles connectivity maintenance and collision avoidance potential field constructions nonlinear disturbance observer nmpc notations the following notation will be used throughout the paper for a vector x r n and a positive definite matrix p r n n x p denotes the weighted norm x t p x x the euclidean norm and x the absolute value of the vector x a polytope is a bounded polyhedron and has a dual representation in terms of intersection of half spaces or convex hull of extreme points p x r n s x k x r n x α i v i α i 1 α i 0 1 introduction 1 1 motivation the increased interest in autonomous robots and their use in various applications pave the way for emerging topics like motion planning and control this represents an essential component in creating autonomous systems able to execute complex tasks for navigation in challenging environments ge et al 2018 in particular multiple usvs unmanned surface vehicles can be used to perform a specific mission with high performance and low costs pang et al 2018 conte et al 2018 however there are some critical issues which need to be considered and solved for achieving the best performance some examples are generating collision free paths with static obstacles e g islands shoreline or ship anchoring and moving obstacles e g other ships while complying with the international regulations for preventing collisions at sea colregs commandant 16672 for both manned and unmanned surface vehicles guaranteeing connectivity maintenance among the ships for information exchange in the course of performing tasks and rejecting the external disturbance from the ocean which may highly affect the performance of the usvs the goal of this paper is to propose an effective algorithm for motion planning of multi surface vehicles complying with the colregs rules while ensuring connectivity and collision avoidance with fixed and mobile obstacles 1 2 related work and remaining open problems the classical problem of collision avoidance which is formulated in terms of non convex constraints added in the control optimization problem is usually addressed through i the use of mip mixed integer programming where the constraints are explicitly taken into account but with the cost of a high computation time prodan et al 2015 cafieri and omheni 2017 some maritime applications using mip are for example determining efficient schedules for usvs uuvs unmanned underwater vehicles in performing a mine countermeasure mission bays et al 2015 reconfigurable usvs gheneti 2019 ii the use of indirect methods based on potential field constructions which show good computational performances tran et al 2017 shibata et al 2018 but where the local minima issue is still a shortcoming of these approaches chao et al 2017 lyu and yin 2017 wang et al zhao show the effectiveness in dealing with obstacle and collision avoidance when apf artificial potential field is used to establish feasible paths for usvs in addition colregs compliance for safe maritime navigation should also be addressed and various approaches for this problem have been tested in the literature fuzzy logic for close proximity conditions huang et al 2020 expert based method perera et al 2014 velocity obstacle kuwata et al 2011 rapidly exploring random tree chiang and tapia 2018 or model predictive control binary variables to choose scenarios with multi moving obstacles with erratic motion johansen et al 2016 using a rolling horizon optimization approach to find optimal heading angles for collision avoidance with other ships li et al 2019a slack variables to change the vessel s direction for specific situations mohamed et al 2018 or elliptical ship domain abdelaal et al 2016 distributed coordination based on constraint optimization chen et al 2018 li et al 2019b these approaches consider disc like approximation for the static or dynamic obstacles which might be too conservative w r t the conditions in a real environment another challenging issue in motion planning for multi agent systems is the connectivity maintenance which ensures that the information exchange and sharing can be reliably realized by forwarding messages among agents while implementing and allocating tasks some applications can be found in a variety of practical tasks such as search and rescue surveillance cooperative transportation by autonomous vehicles at sea or on the ground attitude alignment of clusters of satellites air traffic management system etc related to this problem there are some recent works for always ensuring that the agents lies within their communication range in general we may classify them in two directions 1 imposing hard constraints based on the euclidean distance between agents which must be less than their sensing radius as in filotheou et al 2018 this condition is handled in a decentralized nmpc framework however this approach is too strict and can lead to infeasibility in complex cases 2 using a potential field method to ensure that an algebraic connectivity condition holds i e which refers to the fact that the second smallest eigenvalue of the laplacian matrix is strictly greater than zero fang et al 2017 li et al 2018 here the problem of flocking of second order multi agent systems is addressed using potential hybrid fields which ensure both connectivity preservation and collision avoidance in a distributed control framework we underline that it is necessary to propose robust controllers for multi agent systems to deal with uncertainties soloperto et al 2019 tube based mpc is considered as one of the most popular approaches for coping with perturbations mayne et al 2005 ke et al 2018 the general idea is to maintain the actual state within a safety region along the optimal state trajectory prodan et al 2011 another approach is to design a disturbance observer to reject the disturbances leading to an improved system robustness yu et al 2018a wu et al 2019 the authors in yang and zheng 2014 propose a nonlinear observer within an nmpc scheme for a svc static var compensator system to reject arbitrary disturbances relative degree from its output channels used for shunt compensation to maintain bus voltage magnitude yu et al 2018b presents a compound disturbance observer based mpc scheme applied for a wheeled mobile robot which aims at compensating the slowly varying disturbances affecting the control inputs a similar approach for trajectory tracking of a small helicopter is considered in liu et al 2011 where the disturbance observer ensures the system s robustness against constant wind gusts furthermore there are many works related to disturbance rejection for usvs using observer based robust control the authors in do 2010 yang et al 2014 wang et al 2018 employ a nonlinear observer within a backstepping technique to design a trajectory tracking robust controller of the underactuated ship however the constraints coming from physical limitations are not considered to the best of the authors knowledge there are very few studies using disturbance observer based mpc to ensure the robustness of surface vehicle in case of uncertainties mohamed et al 2018 liu et al 2017 present obstacle and collision avoidance in the presence of external disturbances while tracking a reference path but they only take one ship into account which operates in a simple environment for that reason practical application of safe navigation in a complex coastal environment for multi surface vehicles under uncertainties remains an open problem 1 3 contributions motivated by all the observations above and the results of tran et al the paper introduces enhancements in the distributed motion planning for safe navigation of multiple surface vehicles in the presence of external disturbance in the trondheim fjord complying with the colregs rules specifically the contributions of this paper are 1 generates los line of sight guidance system via a graph based method e g through the rrt optimal rapidly exploring random tree algorithm 2 consider on off barrier functions which guarantee the necessary connectivity distance for information exchange among the agents as well as activate the associated repulsive potential for static and dynamic obstacles 3 consider a ndo nonlinear disturbance observer to reject the disturbances from the ocean that may lead to undesirable performance for the ships 4 integrate the above ingredients in a distributed ndo nmpc based algorithm with a threefold purpose i track the rrt based feasible path through los guidance system ii activate the constraints in the view range 1 1 as required by colregs all ships shall maintain a proper radar lookout has a view of up to several kilometers if there are no physical obstructions to obtain early warning of risk of collision of the agent for on line collision avoidance complying with the colregs rules and iii exchange information for connectivity maintenance 5 validation of the proposed algorithm through simulations over a real benchmark for the safe navigation of ships in the trondheim fjord 1 4 outline the paper is organized as follows section 2 presents the multi agent dynamical models and the on off repulsive potential constructions section 3 presents the distributed motion planning algorithm for connectivity maintenance and colregs compliance section 4 shows the simulation results over a real benchmark section 5 draws the conclusions and presents the future work 2 prerequisites this paper is inspired by the practical application of collision free motion planning of unmanned surface vessels traveling between harbors in the trondheim fjord norway fig 1 illustrates the operating region of the ships which need to navigate to the desired haven while avoiding the shore or small islands and other vessels moving obstacles while simultaneously complying with the colregs rules 2 2 http astat autonomous ship org see appendix a as a benchmark we have used the automatic identification systems ais to provide real numerical data related to the position and velocity of ships as they navigate between harbors in order to efficiently describe the non convex feasible region for the dynamical mobile agent we briefly recall here the system dynamics and various notions which involve polyhedral sets and repulsive potential constructions 2 1 multi autonomous surface vehicles dynamics let us consider a set v including n agents v 1 n n 2 operating in a two dimensional work space the nonlinear dynamics of agent i v under external disturbances wind wave and current are described in fossen 2002 1 x i f i x i t u i t w i t η i r i ψ i ν i m i ν i c i ν i ν i d i ν i u i w i where the state vector x i η i ν i r 6 includes the vector η i p i ψ i r 3 with p i x i y i the system position and ψ i the yaw angle in the inertial frame it also includes vector ν i u i v i r i r 3 describing the surge sway and yaw rates the input vector u i r 3 with u i t u i 0 t r i contains the surge thrust and rudder deflection the addictive disturbance w i w u i 0 w r i r 3 is not a pure gaussian noise but rather the output of such a noise after it passed through a nonlinear filter and is bounded by w i ϱ i and accounts for the ocean environment 3 3 i e wind wave ocean current affect control input of the ship also in 1 r i ψ i m i c i ν i and d i r 3 3 are the rotation mass coriolis and damping matrices respectively 4 4 note that in model 1 the side slip is neglected as presented in eriksen et al 2019 therefore yaw and course are the same 2 2 on off repulsive potential field framework let us first introduce the following logistic regression function which was first applied for population growth studies kyurkchiev and markov 2016 and is commonly used in machine learning algorithms for two class classification 2 f x l 1 e x x o β where x o is the value of the sigmoid s midpoint l is the curve s maximum value and β the steepness of the curve note that a negative or positive value of β will determine the properties of the on off barrier function which we will define hereinafter fig 2 shows the on off barrier function for l 1 x 0 100 and varying β in this work we design on off repulsive potential fields as a combination between on off barrier functions and repulsive potential fields for static and moving obstacles in order to activate and deactivate their influence in the agent s view range assume that agent i v can perceive its neighbors other agents and the forbidden cells fixed obstacles 5 5 the fixed obstacles such as islands and shorelines are a priori known from maps the ship s position in relation to the obstacles is known using global navigation satellite systems as well as transmit information to its neighbors within the range ρ i p i r ρ i where r ρ i r 0 is the radius of the ball centered in p i r 2 the current position of agent i for simplicity the range ρ i p i r ρ i is considered hereinafter simultaneously as the view range i e the zone where the ship can detect all the object and the communication range i e the area where the ships can exchange information with each other the safe distance between the agent and the fixed obstacles d s i ℓ is given by 3 d s i ℓ e i γ ℓ ρ i where e i is a scaling parameter γ ℓ is the radius of the circle defined from the chebyshev center of the ℓ t h forbidden cell and ρ i is the range of the ship moreover the range ρ i p i r ρ i of the i t h agent is also considered as a safe distance of itself with respect to the other agents moving obstacles see fig 3 2 2 1 repulsive potential field of static obstacles let us define the static obstacles islands shore and the like by a union of forbidden polytopic convex regions as 4 o l 1 n c e l l o ℓ where o ℓ p i r 2 a k ℓ p i b k ℓ k 1 n h with a k ℓ r 1 2 b k ℓ r n h ℓ is the number of half spaces describing o ℓ and n cell is the number of forbidden polytopic regions for each bounded polyhedral o ℓ we consider the piecewise linear function 6 6 the function 5 is zero inside the convex set o ℓ defined as in 4 and non zero with a value which grows piecewise linearly as the distance from the set o ℓ increases as in camacho and bordons 5 γ ℓ p i n h ℓ k 1 a k ℓ p i b k ℓ a k ℓ p i b k ℓ using 5 we define s as a union of repulsive potentials of the fixed obstacles as 6 s i 1 n cell s ℓ fix γ ℓ p i with s ℓ fix γ ℓ p i given as 7 s ℓ fix γ ℓ p i c 1 ℓ c 2 ℓ γ ℓ p i 2 where c 1 ℓ and c 2 ℓ are positive parameters representing the strength and effect ranges of repulsive potential hence the on off repulsive potential of the fixed obstacle ω cell is considered as the repulsive potentials of the static obstacles described as in 6 will be activated deactivated if the on off barrier function from 2 is considered as follows 8 ω cell ℓ 1 n cell f i ℓ δ p i ℓ s d s i ℓ s ℓ fix p i with s ℓ fix p i given in 7 f i ℓ defined as an on off barrier function and based on the safety distance d s i ℓ between agent i and the forbidden obstacle ℓ 9 f i ℓ l 1 e δ p i ℓ s d s i ℓ β proposition 1 if a set s of n c e l l n representing static repulsive potential fields eq 6 are only partially activated by the agent s view range through on off barrier functions as defined in eq 8 then a null potential field 7 7 where the various potential components cancel each other value which implies a local minima can be excluded sketch of the proof see appendix b 2 2 2 repulsive potential field of agents moving obstacles hereinafter we represent the moving obstacles and the safety regions around the agents as polytopic regions parametrized in function of their current position therefore let us define p i j i j v i j as the safety region of agent i that agent j must avoid 10 p i j p i p j r 2 a m i p j p i b m i m 1 n h j where p i p j are the current positions of agents i j a m i r 1 2 b m i r n h i is the number of half spaces describing p i j next we define a piecewise linear function similar to 5 for the safety region of agent i 11 θ i j p i p j n h i k 1 a m i p j p i b m i a m i p j p i b m i similarly using 11 we define the repulsive potentials which take into account the shape of the agent i s safety regions 12 s i j mov θ i j p i p j c 1 j c 2 j θ i j p i p j 2 consequently in order to activate or deactivate the repulsive potentials of agents or moving obstacles established as in 12 the on off barrier function from 2 will be integrated into the construction of the repulsive potential to define for the on off repulsive potential of the moving obstacles 13 ω mov j 1 j i n f i j s i j mov p i p j where s i j mov p i p j is given in 12 and f i j δ p i j d ρ i defined as follows 14 f i j l 1 e δ p i j d ρ i β with ρ i defined as i t h agent s view range note that β in 9 and 14 is chosen positive to ensure that if the distance between agent and fixed moving obstacles is greater than the safety distance between them then the value of the on off barrier function goes to zero thus inactivating the repulsive potential and otherwise and coupled with l 1 it conserves the repulsive potential s value 2 3 connectivity maintenance condition we consider here that the information known to agents in a group trajectories velocities and the like can only be exchanged with those which are inside the communication range let us consider the undirected graph g v e where v is the set of nodes representing all agents and e i j v v i j is the set of edges of the graph the adjacency matrix a a i j indicates if a pair of nodes are adjacent or not in the graph hence satisfying the property 15 a i j 1 if i j e 0 otherwise consequently the condition of connectivity maintenance for information exchange among agent i and its neighbors n i is defined as follows 16 n i j v i δ p i j min ρ i ρ j where ρ i and ρ j are the view range of agents i and j in 3 next for any edge between two nodes of set n i we define an on off barrier function as in 2 whose value is always zero within the interval 0 min ρ i ρ j 17 m i j p i p j l i j 1 e δ p i j d min ρ i ρ j β i j note that in this case β i j 0 and l i j has a high value such that the distance among the agents of n i does not exceed the min ρ i ρ j using the above construction we define a so called connectivity maintenance function of agent i with its neighbors n i 18 m i p i p j j n i m i j p i p j 2 4 path generation with los guidance usually for the control part is easier to have a priori defined a path which can be then tracked on line in here rrt is applied for generating an off line optimal collision free path in the workspace for a known initial state x init and set of fixed obstacles o the general idea of the rrt algorithm lavalle pharpatara et al 2015 is to initialize a tree t from an initial vertex x init and to bias growth towards unexplored regions of the state space randomly in the process of exploring the tree shortest paths are generated while verifying the collision free condition with respect to the fixed obstacles after each iteration until reaching a new state close enough to the desired target the feasible path is established based on the connection of shortest paths los algorithms have been used for autonomous ships navigation by fossen 2002 the feasible path obtained from rrt is a set of waypoints x p y p in the horizontal plane for simplicity assuming that the along track error x e is zero thus cross track error y e for the surface vehicle position as in fig 4 is given by 19 0 y e cos δ p α sin δ p α sin δ p α cos δ p α x x d α y y d α where x d α y d α are parametrized by α as 20a x d α x p α cos δ p α 20b y d α y p α sin δ p α where δ p α and x p y p are the orientation and the initial position of the path initialized from way point p with α parametrization variable is a scalar the los angle ψ l o s as can be seen in fig 4 is calculated based on the cross track error y e and the lookahead distance λ expressed as 21 ψ l o s y e y e 2 λ 2 the angle ψ l o s 8 8 note that since locally λ corresponds to the inverse proportional gain breivik and fossen 2008 the convergence to the path depends on the value of λ a low value means faster convergence than a larger one but with a large overshoot is considered as a reference state of the heading angle ψ of surface vehicles to ensures convergence of the ship s position to a feasible path generated by rrt 3 motion planning for connectivity maintenance with colregs compliance in the presence of external disturbances this section presents the motion planning algorithm for multi surface vehicles connectivity maintenance the motion planning strategy is illustrated via the block diagram in fig 5 from a map of the trondheim fjord the ground represented by static obstacles and the coordinates of the harbors can be acquired as seen in fig 1 a collision free path and los guidance system can then be generated off line from the starting harbor to the desired destination based on a set of waypoints yielded by the rrt algorithm ndo based nmpc a feedback control scheme in which an optimization problem is solved on line at each time step will ensure collision avoidance for dynamic obstacles and robustness in the presence of the external disturbances if there are no static or dynamic obstacles the ndo based nmpc will try to re establish path following of the path obtained from rrt 3 1 ndo design for unknown time variant disturbance the unknown varying external disturbances e g ocean currents impact directly the control inputs of vessels leading to bad performance consequently the nonlinear disturbance observer will provide an estimate of the disturbance and its estimation is fed back to the nmpc solver subsequently a disturbance observer is presented for a general nonlinear dynamic which will be later used for the estimation of the disturbance vector w i affecting the i th agent a fundamental idea of disturbance observer in nmpc scheme is to estimate the unknown disturbance w i by an estimate w ˆ i such that w ˆ i w i 0 in fact the acceleration ν i is not available in many robotic manipulators and it is also difficult to construct the acceleration signal from the velocity signal by differentiation due to measurement noise therefore we first need to define the q i m i ν i as the auxiliary variable and its estimation q ˆ i consequently the estimated error q i e is described as below 22 q i e q ˆ i q i from the 1 the time derivative of q ˆ i can be rewritten as 23 q i c i ν i ν i d i ν i ν i u i as the results of do 2010 chen et al 2000 the time derivative of auxiliary variable s estimation q ˆ i is defined as follows 24 q ˆ i l c i ν i ν i d i ν i ν i u i h q i e where l d i a g c 1 c 2 c 3 0 are the gains of the ndo and h q i e r 3 is a design vector to be determined consequently the time derivative of estimated error between auxiliary variable q i and its estimation q ˆ i described as 25 q i e q ˆ i q i l i 3 c i ν i ν i d i ν i ν i u i l h q i e where i 3 is the identity matrix with dimension related to the state space vector of ν i to ensure that 25 converges to zero 25 has to satisfy two conditions 1 l i 3 2 the designed function vector converges towards zero i e h q i e 0 we propose the use of on off barrier function with continuous nature in order to design h q i e based on the estimated error q i e in 22 hence the design function h q i e is described as follows 26 h q i e k 1 i q i e k 2 i q i e j q i e d i j i q i e where j i q i e e β i n d o m i ν i e 1 e β i n d o q i e e β i n d o q i e 1 e β i n d o q i e r 3 is a vector whose dimension depends on vector q i e r 3 k 1 i d i a g k 1 i 1 k 1 i 2 k 1 i 3 k 2 i d i a g k 2 i 1 k 2 i 2 k 2 i 3 and d i d i a g d i 1 d i 2 d i 3 positive semi definite matrices remark 1 in zhu et al 2017 the authors employed signum function j i q i e q i e q i e to design function h q i e however a discontinuity at zero is the main drawback which comes from the property of the signum function since design function h q i e considers the estimation error of the real disturbance a discontinuity at zero means that the convergence of this error toward zero will be indefinite fig 6 compares the proposed function h i with two different values for β n d o with the original signum function as in 26 with h i as in 26 24 can be written as 27 q ˆ i c i ν i ν i d i ν i ν i u i k 1 i q i e k 2 i q i e j i q i e d i j i q i e the estimated disturbance w ˆ i will be given by 28 w ˆ i q ˆ i c i ν i ν i d i ν i ν i u k 1 i q i e k 2 i q i e j q i e d i j q i e h q i e the following proposition is introduced to highlight the convergence of estimated disturbances toward the real disturbances proposition 2 consider the additive disturbances in 1 given the ndo as in eq 27 28 its estimate w ˆ can asymptotically track the input disturbances w in other words w ˆ w 0 proof consider the following lyapunov function 29 v i 1 2 q i e q i e the time derivative of the lyapunov function is 30 v i q i e q i e q i e q i e q ˆ i m i ν i q i e k 1 i q i e k 2 i q i e j i q i e d i j i q i e q i e k 1 i q i e q i e k 2 i q i e j i q i e 2 k 1 i m i n v i 2 k 2 i m i n v i 0 where k 1 i m i n m i n k 1 i 1 k 1 i 2 k 1 i 3 and k 2 i m i n m i n k 2 i 1 k 2 i 2 k 2 i 3 the estimated error q i e will converge to zero i e q i e 0 due to 30 combining 1 and 28 the disturbance error w i e is rewritten as follows 31 w i e w ˆ i w i k 1 i q i e k 2 i q i e h i q i e d i h i q i e m i ν i c i ν i d i ν i u i q ˆ i q i q i e where h i ν i was defined in 26 since ν i e is the velocity error surge sway and yaw rate if ν i e converges to zero ν i e acceleration s error will converge to zero also hence using the ndo as in 27 28 the observer w ˆ i will converge towards the external disturbance w i 3 2 nmpc based distributed motion planning with disturbance compensation nmpc based distributed approach of multi agent systems has an operational mechanism based on information exchange between an agent and its neighbors to converge towards a standard solution fig 7 illustrates the distributed motion planning in the context of this paper if the connectivity among agents is guaranteed each controller of the agent receives information from the others and updates its actions to reach a consensus the disturbances acting on the agents are compensated by using the estimates obtained with the nonlinear observer let us summarize in the following the necessary ingredients for formulating the motion planning with disturbance compensation algorithm 1 to obtain more flexible behavior the lookahead distance λ from 21 is time varying and optimized to obtain accelerated convergence and little overshoot 2 to satisfy collision avoidance with the ground and comply to rules 8 and 13 of the colregs with moving obstacles we add the repulsive potential constructions from 8 13 in an nmpc optimization problem which will be activated only in the view range of the agents 3 to comply with rules 14 and 15 of the colregs we add a slack variable in the cost to give priority to a negative rate of change of yaw moment i e turning to starboard side as in mohamed et al 2018 4 to ensure the agents connectivity we add in the optimization problem the connectivity function given in 18 5 to reject the unknown disturbance from the current affecting the control system of the agents the output of the ndo as in 27 28 is introduced as a compensation signal 6 the implementation is done in a distributed fashion i e the agents exchange information only with those inside their communication range the nominal system of i t h agent is defined from eq 1 by neglecting the disturbances i e w i t 0 and given by 32 x i f i x i t u i t 0 for each nominal system 32 we solve a finite horizon open loop ocp optimal control problem at time t using the measured state x i t over the prediction horizon t p 33 min u i λ i t t t p l i x i τ x j τ u i τ d τ e x i t t p subject to 34a x i f i x i u i 0 x i t x i t 34b u i τ u i 34c λ i λ i τ λ i 34d ε i τ 0 34e t r i τ ε i τ 0 34f x i τ x i 34g x j τ x j τ t t t p the stage cost l i has the following expression 35 l i x i τ x i r e f τ q i 2 u i τ r i 2 u i τ δ r i 2 ω cell x i τ ω mov x i τ x j τ m i x i τ x j τ ε i t s i 2 and the terminal cost is defined as 36 e x i t t p x i t t p x i r e f p i 2 in 34a f i is presented in 1 x i τ u i τ are the predicted states and inputs while u i represents the predicted input trajectory along the prediction horizon t p in the cost per stage 35 u i τ denotes the predicted input variations x i r e f is the reference trajectory ω cell and ω mov are the on off barrier repulsive potential for collision avoidance given in 8 and 13 while m i penalizes the connectivity maintenance between agent i and its neighbors as defined in 18 and the last term ε i is the slack variable prioritizing a certain yaw orientation q i r i p i and s i are semi positive definite weighting matrices of appropriate dimensions the constraint of lookahead distance λ τ is presented in eq 34c constraint 34d is tightened by the positive slack variable ε i 34e in order to prioritize the negative rate of change of the yaw moment this forces the vessel to turn to starboard in any situation hence complying with the rules 13 14 and 15 of colregs see appendix rule 8 is also obeyed through the use of the repulsive potential in 13 in 36 x i r e f is the collision free path generated using rrt and detailed in the forthcoming section at each sampling instance each agent solves its ocp 33 and yields the minimizing control sequence for the nominal system 32 over the interval t t t p then only the first sample of the control input will be combined with the estimated disturbance in a closed loop to yield a compound control as follows 37 u i t u i t w ˆ i t where u i t is the output of the minimization problem 33 34 from 37 agents compensate external disturbances in real time and obtain a predicted collision free trajectory x i τ through the use of repulsive potential fields constructed for fixed and moving obstacles the information predicted trajectory of agent i will be transmitted to its neighbor j n i whenever the connectivity between them holds then the agent j with the information updated from agent i will solve its own ocp 33 this procedure will continue until agent i v solves its own problem 33 and is repeated at next sampling instance note that the repulsive potentials of static obstacles 7 and the moving obstacle other ships 12 are taken into account over the prediction horizon for collision avoidance and is called repeatedly for each time instant τ however they are disabled due to combining with on off barrier function as in 9 and 14 it has a 0 value if nothing is in the ship s view range the repulsive potential will be activated via on off barrier function it has a 1 value if the moving obstacle other ships or the fixed obstacles are in ship s view range this approach has shown effectiveness when the potential field changes constantly via on off barrier function thus allowing the vessel to avoid getting trapped inside a local minima tran et al note that the distributed nmpc scheme employed is a parallel architecture with the aim of improving the closed loop performance for usvs compared with the sequential architecture liu et al 2010 more specifically the separate nmpc controllers are evaluated based on a new measured state as can be seen x t in fig 8 and broadcast their information i e predicted states for example x 1 τ x 2 τ and x 3 τ in fig 8 to their neighbours if they stay interior of the communication range in parallel at the same sampling time fig 8 illustrates the communication topology of the distributed control framework for three agents the details are presented in algorithm 1 several remarks are as follows remark 2 only the nominal system 32 is utilized in ocp remark 3 the initial state of ndo q ˆ i τ 27 has to be provided remark 4 regarding the rate of change of yaw moment t r i there are two possible cases i t r i 0 i e ship will turn to port side ii t r i 0 i e ship will turn to starboard the slack variable weight should be carefully chosen so that t r i can only be a very small positive number but still satisfies constraint 34e while the slack variable ε i is always a small positive number as in 34d therefore this case t r i 0 is improbable in other words the case t r i 0 is strongly encouraged remark 5 the prediction horizon should be chosen large enough to ensure cover of the agent s view range or at least assure that the agent has time enough to avoid the imminent collision conversely the prediction horizon cannot be chosen arbitrarily large due to numerical and computational issues the procedure of information exchange among the agents in algorithm 1 is based on müller et al 2012 collision free motion planning with the rejection of external disturbances through ndo is proposed by the authors and described in the following algorithm 1 information exchange procedure and collision avoidance of the nmpc based distributed motion planning with the rejection of external disturbances through ndo image 1 4 simulations hereinafter we use the cybership ii model for ship dynamics this characterizes a real ship at a scale of 1 70 thus various parameters which appear later like view range ship length surge bound are scaled proportionally since we aim to test our algorithm on a realistic benchmark using real movement data as given by the automatic identification systems ais we scale all the information distances velocities proportionally to the scale mentioned earlier e g the distance between harbors used in simulation is 70 times less than the real one consider a set of n 3 underactuated ships with the dynamical model 1 with the length overall loa is 1 255 m the matrices 9 9 for simplicity the coriolis matrix is neglected r m d and b taken from fredriksen and pettersen 2006 r i cos ψ i sin ψ i 0 sin ψ i cos ψ i 0 0 0 1 m i 25 8 0 0 0 33 8 1 0115 0 1 0115 2 76 d i 0 9257 0 0 0 2 8909 0 2601 0 0 2601 0 5 these vessels are simulated to navigate in the trondheim fjord norway fig 1 illustrates the operating region of the ships which need to navigate to different harbors while maintaining connectivity and avoiding the shore or small islands and other vessels the ais is used to provide real numerical data related to the position and velocity of ships as well as time of navigation between harbors the three agents in the group need to maintain the connectivity among them while traveling from orkanger to trondheim harbor for situation 1 and stjordal harbor for situation 2 and avoid fixed obstacles and a mobile obstacle which has the dynamical model described in 1 the number of cells considered from partitioning the map as in fig 1 is n cell 22 since the view range is used both to receive i e detect obstacles information and transmit signals to other ships the view range of the ships 3 with ρ i 70 m is assumed the scaling coefficient is e i 1 2 1 5 the steepness of the repulsive potential defined in 9 and 14 is given by β i 1 the steepness of connectivity maintenance function 18 β i j and curve s maximum value l i j used as in 17 are β 12 β 13 β 23 0 002 and l 12 l 13 l 23 1000 other parameters of the nmpc optimization problem in 33 are chosen as follows the weighting matrices q i 0 1 i 6 r i 0 1 i 2 p i 0 5 i 2 0 2 0 2 0 2 i 2 0 2 0 2 0 2 i 2 s i 10 6 we consider a conservatively chosen prediction horizon t p 6 s in order to asses less than ideal conditions decisions have to be made when the other ships obstacles are already very close and the sampling time is 2 s the design parameters of the ndo in 27 and 28 are chosen as follows k 1 i d i a g 0 2 0 0 2 k 2 i d i a g 0 025 0 0 025 d i λ i 1 and β i n d o 1 we consider the surge velocity of agent 1 to be the highest u 1 0 2 0 6 m s the surge velocities of agent 2 and 3 equal u 2 u 3 0 2 0 4 m s and less than the surge velocity of agent 1 the yaw angles constraint is π π we consider constraints on the actuation force t u 1 t u 2 t u 3 2 2 n and on the yaw moment t r 1 t r 2 t r 3 0 2 0 2 nm the lookahead distance is taken in the interval λ τ 2 loa 10 loa where loa is the maximum length of a ship s hull 1 255 m as stated in fredriksen and pettersen 2006 the simulations are done using ipopt solver and casadi andersson et al toolkit in matlab r2016a on a computer with the following configuration intel core i7 4790cpu 3 60 ghz 8 gb ram 4 1 scenario 1 this scenario presents a comparison of the proposed method in this paper and the approach of breiviket al 2017 in the context of colregs compliance in particular rule 8 in the absence of uncertainties the approach of breiviket al 2017 first considers the euclidean distance as a collision avoidance constraint among the agents and then proposes a penalty term ensuring that any alteration of course and speed must be significant enough to clear the approaching ships the two conditions will be taken into account over a prediction horizon the method proposed by breiviket al 2017 penalizes the slow alterations of yaw rate and surge velocity of ship 1 as can be seen in fig 9 at time step k 82 the yaw rate drawn in dashed blue is altered rapidly the decrease in yaw rate implies that ship 1 turns starboard the yaw rate in red color changes gradually and changes earlier than the one in dashed blue at time step k 78 increase in yaw rate means that ship 1 turns port also the euclidean distance between ship 1 and 2 which is implemented by algorithm 1 is greater than the safe threshold whereas the relative distance between the two ships of breivik s approach approaches the safe limit in a critical moment as depicted in fig 10 fig 11 shows the actual motion of two usvs while traveling from orkanger to trondheim harbors while complying with rule 8 of colregs the ship 1 in blue for which we used the algorithm proposed by breiviket al 2017 is trapped at time step k 150 where it becomes cornered within a deadlock region due to simultaneously guaranteeing the safe distance with ship 2 and avoiding the coast meanwhile ship 1 in red for which we use our proposed potential field approach for moving obstacle reaches the trondheim harbor in a timely manner it is worth noting that in the next scenarios the repulsive potentials for the three ships moving obstacle will not be illustrated in order to have less cluttered illustrations 4 2 scenario 2 scenario 1 evaluates the validity of motion planning for connectivity maintenance in a group of three vessels in the course of going to desired harbors while maintaining collision avoidance and complying with the colreg rules with dynamic obstacles under los guidance in the absence of disturbance 4 2 1 situation 1 fig 12 shows the off line collision free path generated using the rrt algorithm after 1500 iterations fig 13 depicts the actual motion of the three vessels traveling from orkanger to trondheim harbor in the same figure we show the group of agents at 7 different time instances as they are changing their formation configuration for instance due to the moving obstacle motion illustrated in black fig 17 shows that the connectivity condition is maintained at time instance k 93 the ship 1 in red is overtaking on the port side of the second and third ship hence satisfying the colregs rule 13 the overtaking situation this can also be observed in figs 16 and 15 where ship 2 in green and 3 in blue are being overtaken not changing their course and speed until step k 135 in time interval k 365 400 the colregs rule 14 concerning head on collisions between ships and or mobile obstacles becomes active the first ship in the group in red and the mobile obstacle start changing their course angles to turn to their starboard right side at time step k 365 fig 15 then the course angle of the third ship of the group in blue has a significant increase at time step k 400 see also fig 15 note that if the course angle of the ship is increasing then the vessel is steered to its starboard and vice versa fig 14 depicts the control inputs corresponding to surge thrust and rudder deflection of the three vessels 4 2 2 situation 2 similarly with situation 1 a collision free path is generated from orkanger to stjordal harbor via rrt after 1500 iterations as in fig 18 fig 19 illustrates the actual motion of the three vessels traveling from orkanger to stjordal harbor we show the group of agents at 10 different time instances changing their formation configuration due to the moving obstacle illustrated in black note that starting with time step k 200 the three ships steer away from the given path due to the repulsive potential of the forbidden cell for ensuring a safe distance between agents and the shore line however after some steps in particular at k 416 the agents return tracking the given path a crossing situation rule 15 of colregs between the group of three ships which start from orkanger harbor and the mobile obstacle which starts from trondheim harbor is encountered since the mobile obstacle crosses from the starboard of the three ships group the mobile obstacle can maintain its direction while the three ships must turn starboard for collision avoidance at time step k 500 the change of the ships course angle can also be observed in fig 22 the first the red line and third the blue line ship s course angles start increasing at time steps k 500 and k 515 respectively for collision avoidance on starboard with the mobile obstacle the course angle of the second the green line ship is not changing since the mobile obstacle has passed by the time they enter this area fig 20 and fig 21 present the surge velocities and the control input of the three ships respectively collision avoidance and connectivity preserving among agents are also validated since the relative distances are greater than safety threshold and smaller than the connectivity threshold as can be seen in fig 23 4 3 scenario 3 assume that the disturbances from the ocean environment are time varying and are described as follows 38 w u i 0 96 s i n 0 02 t 0 84 s i n 0 03 t w v i 0 w r i 0 16 s i n 0 09 t π 3 0 02 s i n 0 01 t then the external disturbances are bounded by w u i w r i 1 72 0 18 4 3 1 situation 1 the effectiveness of the combination between nmpc and ndo is shown in fig 24 where the trajectories of three vessels are similar with those shown in situation 1 of scenario 1 the connectivity maintenance is also guaranteed as observed in fig 25 in this scenario the nmpc based optimized control is combined with ndo eq 27 and 28 in the presence of the time varying disturbance as in eq 38 although the course angle of the three ships is oscillating more than in the case of no disturbance in fig 15 there is also an increased trend for the ships and the mobile obstacle to steer to their starboard side for example at the time instance k 368 the course angle of ship 1 red line and mobile obstacle black line increase which also can be observed in fig 26 as a consequence the colreg rules 13 and 14 are maintained as in situation 1 of scenario 1 fig 27 and 28 the control inputs and surge velocities of the three vessels are presented see fig 28 since the nonlinear disturbances of each ship can be estimated and compensated for the estimated perturbations w ˆ of three ships converge towards the real disorder w by depicted in fig 29 the effectiveness of the use of on off barrier function for the designed function 26 for example the ndo of the 2 n d vessel as can be seen in fig 30 the errors between estimated and actual disturbances when applying the on off barrier function the red one have had shown a slight improvement 4 3 2 situation 2 in this situation the connectivity maintenance and collision avoidance among agents in the group are also maintained in the simulation as illustrated in fig 32 rule 13 of colreg overtaking is obeyed as illustrated in fig 31 at time instance k 101 ship 1 in red overtakes on the left side of the two ships moreover rule 15 crossing is also complied when the obstacle ship keeps its direction and ship 1 turns starboard for collision avoidance as can be seen k 486 in fig 31 this can also be seen in fig 33 the course angle of ship 1 red which increases at k 486 while course angles of ship 1 green and 3 blue are not changing since the mobile obstacle has passed by the time they enter this area similar to situation 1 in this scenario good results are obtained because ndo provides an estimate that rapidly converges towards the real disturbances depicted in fig 34 this allows the ships trajectories in the presence of external disturbances fig 31 to behave like the trajectories in the absence of disturbances fig 19 note that in figs 13 19 24 and 31 we also illustrate the repulsive and attractive potentials projected in 2d the repulsive potentials appear around the forbidden region preventing the ship s collison with the fixed and moving obstacles and the attractive potential is represented by circles around the destination harbor see table 1 computation time of the optimization problem trajectory length and number of simulations to arrive at the destination are delineated in tables 2 and 3 4 3 3 situation 3 in this situation a group of 4 ships which need to maintain connectivity and avoid collision are considered the parameters of ship 4 are similar to those of ship 2 and 3 surge sway velocity actuation force yaw moment the effectiveness of the proposed method is illustrated in fig 35 at time instance k 111 ship 1 in red starts overtaking on the port side of the ships 2 4 in yellow and 3 until time instance k 221 at time instance k 380 ship 1 and the mobile obstacle make a right turn to ensure rule 14 head on situation of colregs moreover the communication range and the safe distances among the 4 ships are also guaranteed as can be seen in fig 36 it s worth noting that in this situation the strength and effect range parameters for the 4 t h fixed obstacle are decreased therefore the four ships do not meander too far away from the given path when they approach the 4 t h fixed obstacle with respect to situation 1 of scenario 2 fig 13 and situation 1 of scenario 3 fig 24 as we can see at time instance k 380 the 4 t h ship stays on the desired path while the rest of the ships cannot stay on this path since they must keep a safe distance with ship 4 and with each other 5 discussions and conclusions an ndo based distributed nmpc scheme has been developed for motion planning problem with connectivity maintenance and collision avoidance for multi surface vehicles the classical non convex constraints from this problem were penalized in the cost function through appropriate potential field constructions ndo can estimate the external disturbance and compensate for their impact via feedback control although simulation results prove excellent performance of the algorithm as well as give insights for real implementation there are still some limitations that will be considered in the future work on one hand instead of assuming a fixed slope parameter β we may obtain it through an estimation fitting procedure which maximizes the appearance of the obstacles in the agent s view range i e a collision risk may be alerted earlier the newton raphson bakari et al 2016 al daffaie and khan 2017 and gradient descent kim et al 2018 manogaran and lopez 2018 method as well as its variants such as batch gradient descent and stochastic gradient descent can be employed to estimate this parameter on the other hand one of the most challenging perspectives is to guarantee asymptotic stability of the potential field based mpc scheme by using the predicted input trajectory along the prediction horizon without doubt this is not a trivial problem to deal with since mas have to leave their predicted paths due to repulsive forces coming from the forbidden areas some well known approaches from the literature are promising stability can be ensured for finite horizon problems by suitably choosing a weighting matrix for terminal cost and an attractive terminal region chen and allgöwer 1998 nguyen et al 2019 alternatively closed loop stability can also be achieved for relatively long horizons without the need to use a terminal cost or a terminal constraint grüne 2012 grüne and pannek 2017 stability is guaranteed by tuning the weighting matrices of the cost function declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a colregs rules used in the paper rule 8 action to avoid collision avoidance action must be applied timely before other vessel approaches any alterations of course and or speed must be large enough to clear the approaching vessels rule 13 overtaking the overtaking vessel can pass on either side and must keep out of the way of the vessel being overtaken the vessel being overtaken must hold the course and speed until other vessel is past and well clear rule 14 head on situation when two power driven vessels are meeting on nearly reciprocal courses so as to involve risk of collision then alter course to starboard so that each pass on the port side of each other rule 15 crossing situation when two power driven vessels are crossing so as to involve risk of collision the vessel which has the other on her own starboard side shall keep out of the way rule 16 actions by give way vessel take early and substantial action to keep well clear appendix b sketch of the proof for proposition 1 assume that the operating space of the i t h agent is the total potential field that is denoted by w r n r 0 the potential field which is the summation of repulsive and attractive potential fields and is given as 39 w p i ℓ 1 n cell s ℓ fix γ ℓ p i ξ p i where ξ p i r n r 0 is attractive potential and s ℓ fix γ ℓ p i is the repulsive potential as presented in 7 with respect to the ℓ t h obstacle ℓ 1 n cell therefore eq 39 can be detailed as follows 40 w p i ℓ 1 n cell c 1 ℓ c 2 ℓ γ ℓ p i 2 p i p i r e f q i 2 the simplest control action z i p i r n is given by the descent gradient method were the input is equated with the steepest gradient as presented in khatib 1986 41 z i p i w p i ℓ 1 n cell c 1 ℓ c 2 ℓ γ ℓ p i 3 ℓ 1 n cell γ ℓ p i 2 q i p i p i r e f p i local minima will happen when there is a poor choice of the parameters of the repulsive and attractive potentials making these potential components cancel each other this means that 41 is equal to zero i e 42 ℓ 1 n cell c 1 ℓ c 2 ℓ γ ℓ p i 3 ℓ 1 n cell γ ℓ p i 2 q i p i p i r e f p i considering the on off repulsive potential field 10 10 it is worth noting that all the parameters c 1 ℓ c 2 ℓ and q i of the total potential field have identical values proposed in eq 8 we can write the total potential as 43 w p i ℓ 1 n cell f i ℓ δ p i ℓ s d s i ℓ c 1 ℓ c 2 ℓ γ ℓ p i 2 p i p i r e f q i 2 with f i ℓ as in eq 9 next applying the descent gradient method we calculate the simplest control action given by the steepest gradient of the total potential in eq 43 44 z i p i w p i ℓ 1 n cell f i ℓ δ p i ℓ s d s i ℓ c 1 ℓ c 2 ℓ γ ℓ p i 2 ℓ 1 n obs f i ℓ δ p i ℓ s d s i ℓ c 1 ℓ c 2 ℓ γ ℓ p i 3 ℓ 1 n cell γ ℓ p i 2 q i p i p i r e f p i where 44 will become 41 i e local minima if and only if ℓ 1 n cell f i ℓ 1 and ℓ 1 n cell f i ℓ 0 i e the entire total static repulsive potential must be in the interior of the view range of i t h agent i e all static repulsive fields must be activated the chances of this happening are much reduced since the view range of the agent is significantly smaller than the size of the workspace under consideration therefore 44 always differs from 41 as long as the agent moves i e the local minima area always moves in other words the proposed method can better deal with local minima in comparison to the classical approach author contribution ngo quoc huy tran conceptualization methodology writing original draft implementation ionela prodan conceptualization writing review editing supervision esten ingar grøtli providing data reviewing laurent lefèvre supervision 
21524,this paper deals with the motion planning problem for surface vehicles in the presence of varying environmental disturbances the goal is to steer the vehicles from an initial to a final destination while ensuring connectivity and avoiding collision with fixed and moving obstacles the novelty lies in the coherent combination among various ingredients for path generation and potential field constructions for collision avoidance and connectivity maintenance all gathered in a distributed nmpc nonlinear model predictive control framework i los line of sight guidance and rrt optimal rapidly exploring random tree algorithms are employed for generating a collision free path considering static surroundings ii on off barrier functions activate the proposed potential field components which are in the view range of the agents hence ensuring safe navigation in a dynamic coastal environment with a low computation demand iii a ndo nonlinear disturbance observer is integrated in the nmpc design to compensate the environmental disturbances the proposed algorithm is validated through simulations and comparisons carried out over a benchmark for usvs unmanned surface vehicles safe navigation in the trondheim fjord norway keywords surface vehicles connectivity maintenance and collision avoidance potential field constructions nonlinear disturbance observer nmpc notations the following notation will be used throughout the paper for a vector x r n and a positive definite matrix p r n n x p denotes the weighted norm x t p x x the euclidean norm and x the absolute value of the vector x a polytope is a bounded polyhedron and has a dual representation in terms of intersection of half spaces or convex hull of extreme points p x r n s x k x r n x α i v i α i 1 α i 0 1 introduction 1 1 motivation the increased interest in autonomous robots and their use in various applications pave the way for emerging topics like motion planning and control this represents an essential component in creating autonomous systems able to execute complex tasks for navigation in challenging environments ge et al 2018 in particular multiple usvs unmanned surface vehicles can be used to perform a specific mission with high performance and low costs pang et al 2018 conte et al 2018 however there are some critical issues which need to be considered and solved for achieving the best performance some examples are generating collision free paths with static obstacles e g islands shoreline or ship anchoring and moving obstacles e g other ships while complying with the international regulations for preventing collisions at sea colregs commandant 16672 for both manned and unmanned surface vehicles guaranteeing connectivity maintenance among the ships for information exchange in the course of performing tasks and rejecting the external disturbance from the ocean which may highly affect the performance of the usvs the goal of this paper is to propose an effective algorithm for motion planning of multi surface vehicles complying with the colregs rules while ensuring connectivity and collision avoidance with fixed and mobile obstacles 1 2 related work and remaining open problems the classical problem of collision avoidance which is formulated in terms of non convex constraints added in the control optimization problem is usually addressed through i the use of mip mixed integer programming where the constraints are explicitly taken into account but with the cost of a high computation time prodan et al 2015 cafieri and omheni 2017 some maritime applications using mip are for example determining efficient schedules for usvs uuvs unmanned underwater vehicles in performing a mine countermeasure mission bays et al 2015 reconfigurable usvs gheneti 2019 ii the use of indirect methods based on potential field constructions which show good computational performances tran et al 2017 shibata et al 2018 but where the local minima issue is still a shortcoming of these approaches chao et al 2017 lyu and yin 2017 wang et al zhao show the effectiveness in dealing with obstacle and collision avoidance when apf artificial potential field is used to establish feasible paths for usvs in addition colregs compliance for safe maritime navigation should also be addressed and various approaches for this problem have been tested in the literature fuzzy logic for close proximity conditions huang et al 2020 expert based method perera et al 2014 velocity obstacle kuwata et al 2011 rapidly exploring random tree chiang and tapia 2018 or model predictive control binary variables to choose scenarios with multi moving obstacles with erratic motion johansen et al 2016 using a rolling horizon optimization approach to find optimal heading angles for collision avoidance with other ships li et al 2019a slack variables to change the vessel s direction for specific situations mohamed et al 2018 or elliptical ship domain abdelaal et al 2016 distributed coordination based on constraint optimization chen et al 2018 li et al 2019b these approaches consider disc like approximation for the static or dynamic obstacles which might be too conservative w r t the conditions in a real environment another challenging issue in motion planning for multi agent systems is the connectivity maintenance which ensures that the information exchange and sharing can be reliably realized by forwarding messages among agents while implementing and allocating tasks some applications can be found in a variety of practical tasks such as search and rescue surveillance cooperative transportation by autonomous vehicles at sea or on the ground attitude alignment of clusters of satellites air traffic management system etc related to this problem there are some recent works for always ensuring that the agents lies within their communication range in general we may classify them in two directions 1 imposing hard constraints based on the euclidean distance between agents which must be less than their sensing radius as in filotheou et al 2018 this condition is handled in a decentralized nmpc framework however this approach is too strict and can lead to infeasibility in complex cases 2 using a potential field method to ensure that an algebraic connectivity condition holds i e which refers to the fact that the second smallest eigenvalue of the laplacian matrix is strictly greater than zero fang et al 2017 li et al 2018 here the problem of flocking of second order multi agent systems is addressed using potential hybrid fields which ensure both connectivity preservation and collision avoidance in a distributed control framework we underline that it is necessary to propose robust controllers for multi agent systems to deal with uncertainties soloperto et al 2019 tube based mpc is considered as one of the most popular approaches for coping with perturbations mayne et al 2005 ke et al 2018 the general idea is to maintain the actual state within a safety region along the optimal state trajectory prodan et al 2011 another approach is to design a disturbance observer to reject the disturbances leading to an improved system robustness yu et al 2018a wu et al 2019 the authors in yang and zheng 2014 propose a nonlinear observer within an nmpc scheme for a svc static var compensator system to reject arbitrary disturbances relative degree from its output channels used for shunt compensation to maintain bus voltage magnitude yu et al 2018b presents a compound disturbance observer based mpc scheme applied for a wheeled mobile robot which aims at compensating the slowly varying disturbances affecting the control inputs a similar approach for trajectory tracking of a small helicopter is considered in liu et al 2011 where the disturbance observer ensures the system s robustness against constant wind gusts furthermore there are many works related to disturbance rejection for usvs using observer based robust control the authors in do 2010 yang et al 2014 wang et al 2018 employ a nonlinear observer within a backstepping technique to design a trajectory tracking robust controller of the underactuated ship however the constraints coming from physical limitations are not considered to the best of the authors knowledge there are very few studies using disturbance observer based mpc to ensure the robustness of surface vehicle in case of uncertainties mohamed et al 2018 liu et al 2017 present obstacle and collision avoidance in the presence of external disturbances while tracking a reference path but they only take one ship into account which operates in a simple environment for that reason practical application of safe navigation in a complex coastal environment for multi surface vehicles under uncertainties remains an open problem 1 3 contributions motivated by all the observations above and the results of tran et al the paper introduces enhancements in the distributed motion planning for safe navigation of multiple surface vehicles in the presence of external disturbance in the trondheim fjord complying with the colregs rules specifically the contributions of this paper are 1 generates los line of sight guidance system via a graph based method e g through the rrt optimal rapidly exploring random tree algorithm 2 consider on off barrier functions which guarantee the necessary connectivity distance for information exchange among the agents as well as activate the associated repulsive potential for static and dynamic obstacles 3 consider a ndo nonlinear disturbance observer to reject the disturbances from the ocean that may lead to undesirable performance for the ships 4 integrate the above ingredients in a distributed ndo nmpc based algorithm with a threefold purpose i track the rrt based feasible path through los guidance system ii activate the constraints in the view range 1 1 as required by colregs all ships shall maintain a proper radar lookout has a view of up to several kilometers if there are no physical obstructions to obtain early warning of risk of collision of the agent for on line collision avoidance complying with the colregs rules and iii exchange information for connectivity maintenance 5 validation of the proposed algorithm through simulations over a real benchmark for the safe navigation of ships in the trondheim fjord 1 4 outline the paper is organized as follows section 2 presents the multi agent dynamical models and the on off repulsive potential constructions section 3 presents the distributed motion planning algorithm for connectivity maintenance and colregs compliance section 4 shows the simulation results over a real benchmark section 5 draws the conclusions and presents the future work 2 prerequisites this paper is inspired by the practical application of collision free motion planning of unmanned surface vessels traveling between harbors in the trondheim fjord norway fig 1 illustrates the operating region of the ships which need to navigate to the desired haven while avoiding the shore or small islands and other vessels moving obstacles while simultaneously complying with the colregs rules 2 2 http astat autonomous ship org see appendix a as a benchmark we have used the automatic identification systems ais to provide real numerical data related to the position and velocity of ships as they navigate between harbors in order to efficiently describe the non convex feasible region for the dynamical mobile agent we briefly recall here the system dynamics and various notions which involve polyhedral sets and repulsive potential constructions 2 1 multi autonomous surface vehicles dynamics let us consider a set v including n agents v 1 n n 2 operating in a two dimensional work space the nonlinear dynamics of agent i v under external disturbances wind wave and current are described in fossen 2002 1 x i f i x i t u i t w i t η i r i ψ i ν i m i ν i c i ν i ν i d i ν i u i w i where the state vector x i η i ν i r 6 includes the vector η i p i ψ i r 3 with p i x i y i the system position and ψ i the yaw angle in the inertial frame it also includes vector ν i u i v i r i r 3 describing the surge sway and yaw rates the input vector u i r 3 with u i t u i 0 t r i contains the surge thrust and rudder deflection the addictive disturbance w i w u i 0 w r i r 3 is not a pure gaussian noise but rather the output of such a noise after it passed through a nonlinear filter and is bounded by w i ϱ i and accounts for the ocean environment 3 3 i e wind wave ocean current affect control input of the ship also in 1 r i ψ i m i c i ν i and d i r 3 3 are the rotation mass coriolis and damping matrices respectively 4 4 note that in model 1 the side slip is neglected as presented in eriksen et al 2019 therefore yaw and course are the same 2 2 on off repulsive potential field framework let us first introduce the following logistic regression function which was first applied for population growth studies kyurkchiev and markov 2016 and is commonly used in machine learning algorithms for two class classification 2 f x l 1 e x x o β where x o is the value of the sigmoid s midpoint l is the curve s maximum value and β the steepness of the curve note that a negative or positive value of β will determine the properties of the on off barrier function which we will define hereinafter fig 2 shows the on off barrier function for l 1 x 0 100 and varying β in this work we design on off repulsive potential fields as a combination between on off barrier functions and repulsive potential fields for static and moving obstacles in order to activate and deactivate their influence in the agent s view range assume that agent i v can perceive its neighbors other agents and the forbidden cells fixed obstacles 5 5 the fixed obstacles such as islands and shorelines are a priori known from maps the ship s position in relation to the obstacles is known using global navigation satellite systems as well as transmit information to its neighbors within the range ρ i p i r ρ i where r ρ i r 0 is the radius of the ball centered in p i r 2 the current position of agent i for simplicity the range ρ i p i r ρ i is considered hereinafter simultaneously as the view range i e the zone where the ship can detect all the object and the communication range i e the area where the ships can exchange information with each other the safe distance between the agent and the fixed obstacles d s i ℓ is given by 3 d s i ℓ e i γ ℓ ρ i where e i is a scaling parameter γ ℓ is the radius of the circle defined from the chebyshev center of the ℓ t h forbidden cell and ρ i is the range of the ship moreover the range ρ i p i r ρ i of the i t h agent is also considered as a safe distance of itself with respect to the other agents moving obstacles see fig 3 2 2 1 repulsive potential field of static obstacles let us define the static obstacles islands shore and the like by a union of forbidden polytopic convex regions as 4 o l 1 n c e l l o ℓ where o ℓ p i r 2 a k ℓ p i b k ℓ k 1 n h with a k ℓ r 1 2 b k ℓ r n h ℓ is the number of half spaces describing o ℓ and n cell is the number of forbidden polytopic regions for each bounded polyhedral o ℓ we consider the piecewise linear function 6 6 the function 5 is zero inside the convex set o ℓ defined as in 4 and non zero with a value which grows piecewise linearly as the distance from the set o ℓ increases as in camacho and bordons 5 γ ℓ p i n h ℓ k 1 a k ℓ p i b k ℓ a k ℓ p i b k ℓ using 5 we define s as a union of repulsive potentials of the fixed obstacles as 6 s i 1 n cell s ℓ fix γ ℓ p i with s ℓ fix γ ℓ p i given as 7 s ℓ fix γ ℓ p i c 1 ℓ c 2 ℓ γ ℓ p i 2 where c 1 ℓ and c 2 ℓ are positive parameters representing the strength and effect ranges of repulsive potential hence the on off repulsive potential of the fixed obstacle ω cell is considered as the repulsive potentials of the static obstacles described as in 6 will be activated deactivated if the on off barrier function from 2 is considered as follows 8 ω cell ℓ 1 n cell f i ℓ δ p i ℓ s d s i ℓ s ℓ fix p i with s ℓ fix p i given in 7 f i ℓ defined as an on off barrier function and based on the safety distance d s i ℓ between agent i and the forbidden obstacle ℓ 9 f i ℓ l 1 e δ p i ℓ s d s i ℓ β proposition 1 if a set s of n c e l l n representing static repulsive potential fields eq 6 are only partially activated by the agent s view range through on off barrier functions as defined in eq 8 then a null potential field 7 7 where the various potential components cancel each other value which implies a local minima can be excluded sketch of the proof see appendix b 2 2 2 repulsive potential field of agents moving obstacles hereinafter we represent the moving obstacles and the safety regions around the agents as polytopic regions parametrized in function of their current position therefore let us define p i j i j v i j as the safety region of agent i that agent j must avoid 10 p i j p i p j r 2 a m i p j p i b m i m 1 n h j where p i p j are the current positions of agents i j a m i r 1 2 b m i r n h i is the number of half spaces describing p i j next we define a piecewise linear function similar to 5 for the safety region of agent i 11 θ i j p i p j n h i k 1 a m i p j p i b m i a m i p j p i b m i similarly using 11 we define the repulsive potentials which take into account the shape of the agent i s safety regions 12 s i j mov θ i j p i p j c 1 j c 2 j θ i j p i p j 2 consequently in order to activate or deactivate the repulsive potentials of agents or moving obstacles established as in 12 the on off barrier function from 2 will be integrated into the construction of the repulsive potential to define for the on off repulsive potential of the moving obstacles 13 ω mov j 1 j i n f i j s i j mov p i p j where s i j mov p i p j is given in 12 and f i j δ p i j d ρ i defined as follows 14 f i j l 1 e δ p i j d ρ i β with ρ i defined as i t h agent s view range note that β in 9 and 14 is chosen positive to ensure that if the distance between agent and fixed moving obstacles is greater than the safety distance between them then the value of the on off barrier function goes to zero thus inactivating the repulsive potential and otherwise and coupled with l 1 it conserves the repulsive potential s value 2 3 connectivity maintenance condition we consider here that the information known to agents in a group trajectories velocities and the like can only be exchanged with those which are inside the communication range let us consider the undirected graph g v e where v is the set of nodes representing all agents and e i j v v i j is the set of edges of the graph the adjacency matrix a a i j indicates if a pair of nodes are adjacent or not in the graph hence satisfying the property 15 a i j 1 if i j e 0 otherwise consequently the condition of connectivity maintenance for information exchange among agent i and its neighbors n i is defined as follows 16 n i j v i δ p i j min ρ i ρ j where ρ i and ρ j are the view range of agents i and j in 3 next for any edge between two nodes of set n i we define an on off barrier function as in 2 whose value is always zero within the interval 0 min ρ i ρ j 17 m i j p i p j l i j 1 e δ p i j d min ρ i ρ j β i j note that in this case β i j 0 and l i j has a high value such that the distance among the agents of n i does not exceed the min ρ i ρ j using the above construction we define a so called connectivity maintenance function of agent i with its neighbors n i 18 m i p i p j j n i m i j p i p j 2 4 path generation with los guidance usually for the control part is easier to have a priori defined a path which can be then tracked on line in here rrt is applied for generating an off line optimal collision free path in the workspace for a known initial state x init and set of fixed obstacles o the general idea of the rrt algorithm lavalle pharpatara et al 2015 is to initialize a tree t from an initial vertex x init and to bias growth towards unexplored regions of the state space randomly in the process of exploring the tree shortest paths are generated while verifying the collision free condition with respect to the fixed obstacles after each iteration until reaching a new state close enough to the desired target the feasible path is established based on the connection of shortest paths los algorithms have been used for autonomous ships navigation by fossen 2002 the feasible path obtained from rrt is a set of waypoints x p y p in the horizontal plane for simplicity assuming that the along track error x e is zero thus cross track error y e for the surface vehicle position as in fig 4 is given by 19 0 y e cos δ p α sin δ p α sin δ p α cos δ p α x x d α y y d α where x d α y d α are parametrized by α as 20a x d α x p α cos δ p α 20b y d α y p α sin δ p α where δ p α and x p y p are the orientation and the initial position of the path initialized from way point p with α parametrization variable is a scalar the los angle ψ l o s as can be seen in fig 4 is calculated based on the cross track error y e and the lookahead distance λ expressed as 21 ψ l o s y e y e 2 λ 2 the angle ψ l o s 8 8 note that since locally λ corresponds to the inverse proportional gain breivik and fossen 2008 the convergence to the path depends on the value of λ a low value means faster convergence than a larger one but with a large overshoot is considered as a reference state of the heading angle ψ of surface vehicles to ensures convergence of the ship s position to a feasible path generated by rrt 3 motion planning for connectivity maintenance with colregs compliance in the presence of external disturbances this section presents the motion planning algorithm for multi surface vehicles connectivity maintenance the motion planning strategy is illustrated via the block diagram in fig 5 from a map of the trondheim fjord the ground represented by static obstacles and the coordinates of the harbors can be acquired as seen in fig 1 a collision free path and los guidance system can then be generated off line from the starting harbor to the desired destination based on a set of waypoints yielded by the rrt algorithm ndo based nmpc a feedback control scheme in which an optimization problem is solved on line at each time step will ensure collision avoidance for dynamic obstacles and robustness in the presence of the external disturbances if there are no static or dynamic obstacles the ndo based nmpc will try to re establish path following of the path obtained from rrt 3 1 ndo design for unknown time variant disturbance the unknown varying external disturbances e g ocean currents impact directly the control inputs of vessels leading to bad performance consequently the nonlinear disturbance observer will provide an estimate of the disturbance and its estimation is fed back to the nmpc solver subsequently a disturbance observer is presented for a general nonlinear dynamic which will be later used for the estimation of the disturbance vector w i affecting the i th agent a fundamental idea of disturbance observer in nmpc scheme is to estimate the unknown disturbance w i by an estimate w ˆ i such that w ˆ i w i 0 in fact the acceleration ν i is not available in many robotic manipulators and it is also difficult to construct the acceleration signal from the velocity signal by differentiation due to measurement noise therefore we first need to define the q i m i ν i as the auxiliary variable and its estimation q ˆ i consequently the estimated error q i e is described as below 22 q i e q ˆ i q i from the 1 the time derivative of q ˆ i can be rewritten as 23 q i c i ν i ν i d i ν i ν i u i as the results of do 2010 chen et al 2000 the time derivative of auxiliary variable s estimation q ˆ i is defined as follows 24 q ˆ i l c i ν i ν i d i ν i ν i u i h q i e where l d i a g c 1 c 2 c 3 0 are the gains of the ndo and h q i e r 3 is a design vector to be determined consequently the time derivative of estimated error between auxiliary variable q i and its estimation q ˆ i described as 25 q i e q ˆ i q i l i 3 c i ν i ν i d i ν i ν i u i l h q i e where i 3 is the identity matrix with dimension related to the state space vector of ν i to ensure that 25 converges to zero 25 has to satisfy two conditions 1 l i 3 2 the designed function vector converges towards zero i e h q i e 0 we propose the use of on off barrier function with continuous nature in order to design h q i e based on the estimated error q i e in 22 hence the design function h q i e is described as follows 26 h q i e k 1 i q i e k 2 i q i e j q i e d i j i q i e where j i q i e e β i n d o m i ν i e 1 e β i n d o q i e e β i n d o q i e 1 e β i n d o q i e r 3 is a vector whose dimension depends on vector q i e r 3 k 1 i d i a g k 1 i 1 k 1 i 2 k 1 i 3 k 2 i d i a g k 2 i 1 k 2 i 2 k 2 i 3 and d i d i a g d i 1 d i 2 d i 3 positive semi definite matrices remark 1 in zhu et al 2017 the authors employed signum function j i q i e q i e q i e to design function h q i e however a discontinuity at zero is the main drawback which comes from the property of the signum function since design function h q i e considers the estimation error of the real disturbance a discontinuity at zero means that the convergence of this error toward zero will be indefinite fig 6 compares the proposed function h i with two different values for β n d o with the original signum function as in 26 with h i as in 26 24 can be written as 27 q ˆ i c i ν i ν i d i ν i ν i u i k 1 i q i e k 2 i q i e j i q i e d i j i q i e the estimated disturbance w ˆ i will be given by 28 w ˆ i q ˆ i c i ν i ν i d i ν i ν i u k 1 i q i e k 2 i q i e j q i e d i j q i e h q i e the following proposition is introduced to highlight the convergence of estimated disturbances toward the real disturbances proposition 2 consider the additive disturbances in 1 given the ndo as in eq 27 28 its estimate w ˆ can asymptotically track the input disturbances w in other words w ˆ w 0 proof consider the following lyapunov function 29 v i 1 2 q i e q i e the time derivative of the lyapunov function is 30 v i q i e q i e q i e q i e q ˆ i m i ν i q i e k 1 i q i e k 2 i q i e j i q i e d i j i q i e q i e k 1 i q i e q i e k 2 i q i e j i q i e 2 k 1 i m i n v i 2 k 2 i m i n v i 0 where k 1 i m i n m i n k 1 i 1 k 1 i 2 k 1 i 3 and k 2 i m i n m i n k 2 i 1 k 2 i 2 k 2 i 3 the estimated error q i e will converge to zero i e q i e 0 due to 30 combining 1 and 28 the disturbance error w i e is rewritten as follows 31 w i e w ˆ i w i k 1 i q i e k 2 i q i e h i q i e d i h i q i e m i ν i c i ν i d i ν i u i q ˆ i q i q i e where h i ν i was defined in 26 since ν i e is the velocity error surge sway and yaw rate if ν i e converges to zero ν i e acceleration s error will converge to zero also hence using the ndo as in 27 28 the observer w ˆ i will converge towards the external disturbance w i 3 2 nmpc based distributed motion planning with disturbance compensation nmpc based distributed approach of multi agent systems has an operational mechanism based on information exchange between an agent and its neighbors to converge towards a standard solution fig 7 illustrates the distributed motion planning in the context of this paper if the connectivity among agents is guaranteed each controller of the agent receives information from the others and updates its actions to reach a consensus the disturbances acting on the agents are compensated by using the estimates obtained with the nonlinear observer let us summarize in the following the necessary ingredients for formulating the motion planning with disturbance compensation algorithm 1 to obtain more flexible behavior the lookahead distance λ from 21 is time varying and optimized to obtain accelerated convergence and little overshoot 2 to satisfy collision avoidance with the ground and comply to rules 8 and 13 of the colregs with moving obstacles we add the repulsive potential constructions from 8 13 in an nmpc optimization problem which will be activated only in the view range of the agents 3 to comply with rules 14 and 15 of the colregs we add a slack variable in the cost to give priority to a negative rate of change of yaw moment i e turning to starboard side as in mohamed et al 2018 4 to ensure the agents connectivity we add in the optimization problem the connectivity function given in 18 5 to reject the unknown disturbance from the current affecting the control system of the agents the output of the ndo as in 27 28 is introduced as a compensation signal 6 the implementation is done in a distributed fashion i e the agents exchange information only with those inside their communication range the nominal system of i t h agent is defined from eq 1 by neglecting the disturbances i e w i t 0 and given by 32 x i f i x i t u i t 0 for each nominal system 32 we solve a finite horizon open loop ocp optimal control problem at time t using the measured state x i t over the prediction horizon t p 33 min u i λ i t t t p l i x i τ x j τ u i τ d τ e x i t t p subject to 34a x i f i x i u i 0 x i t x i t 34b u i τ u i 34c λ i λ i τ λ i 34d ε i τ 0 34e t r i τ ε i τ 0 34f x i τ x i 34g x j τ x j τ t t t p the stage cost l i has the following expression 35 l i x i τ x i r e f τ q i 2 u i τ r i 2 u i τ δ r i 2 ω cell x i τ ω mov x i τ x j τ m i x i τ x j τ ε i t s i 2 and the terminal cost is defined as 36 e x i t t p x i t t p x i r e f p i 2 in 34a f i is presented in 1 x i τ u i τ are the predicted states and inputs while u i represents the predicted input trajectory along the prediction horizon t p in the cost per stage 35 u i τ denotes the predicted input variations x i r e f is the reference trajectory ω cell and ω mov are the on off barrier repulsive potential for collision avoidance given in 8 and 13 while m i penalizes the connectivity maintenance between agent i and its neighbors as defined in 18 and the last term ε i is the slack variable prioritizing a certain yaw orientation q i r i p i and s i are semi positive definite weighting matrices of appropriate dimensions the constraint of lookahead distance λ τ is presented in eq 34c constraint 34d is tightened by the positive slack variable ε i 34e in order to prioritize the negative rate of change of the yaw moment this forces the vessel to turn to starboard in any situation hence complying with the rules 13 14 and 15 of colregs see appendix rule 8 is also obeyed through the use of the repulsive potential in 13 in 36 x i r e f is the collision free path generated using rrt and detailed in the forthcoming section at each sampling instance each agent solves its ocp 33 and yields the minimizing control sequence for the nominal system 32 over the interval t t t p then only the first sample of the control input will be combined with the estimated disturbance in a closed loop to yield a compound control as follows 37 u i t u i t w ˆ i t where u i t is the output of the minimization problem 33 34 from 37 agents compensate external disturbances in real time and obtain a predicted collision free trajectory x i τ through the use of repulsive potential fields constructed for fixed and moving obstacles the information predicted trajectory of agent i will be transmitted to its neighbor j n i whenever the connectivity between them holds then the agent j with the information updated from agent i will solve its own ocp 33 this procedure will continue until agent i v solves its own problem 33 and is repeated at next sampling instance note that the repulsive potentials of static obstacles 7 and the moving obstacle other ships 12 are taken into account over the prediction horizon for collision avoidance and is called repeatedly for each time instant τ however they are disabled due to combining with on off barrier function as in 9 and 14 it has a 0 value if nothing is in the ship s view range the repulsive potential will be activated via on off barrier function it has a 1 value if the moving obstacle other ships or the fixed obstacles are in ship s view range this approach has shown effectiveness when the potential field changes constantly via on off barrier function thus allowing the vessel to avoid getting trapped inside a local minima tran et al note that the distributed nmpc scheme employed is a parallel architecture with the aim of improving the closed loop performance for usvs compared with the sequential architecture liu et al 2010 more specifically the separate nmpc controllers are evaluated based on a new measured state as can be seen x t in fig 8 and broadcast their information i e predicted states for example x 1 τ x 2 τ and x 3 τ in fig 8 to their neighbours if they stay interior of the communication range in parallel at the same sampling time fig 8 illustrates the communication topology of the distributed control framework for three agents the details are presented in algorithm 1 several remarks are as follows remark 2 only the nominal system 32 is utilized in ocp remark 3 the initial state of ndo q ˆ i τ 27 has to be provided remark 4 regarding the rate of change of yaw moment t r i there are two possible cases i t r i 0 i e ship will turn to port side ii t r i 0 i e ship will turn to starboard the slack variable weight should be carefully chosen so that t r i can only be a very small positive number but still satisfies constraint 34e while the slack variable ε i is always a small positive number as in 34d therefore this case t r i 0 is improbable in other words the case t r i 0 is strongly encouraged remark 5 the prediction horizon should be chosen large enough to ensure cover of the agent s view range or at least assure that the agent has time enough to avoid the imminent collision conversely the prediction horizon cannot be chosen arbitrarily large due to numerical and computational issues the procedure of information exchange among the agents in algorithm 1 is based on müller et al 2012 collision free motion planning with the rejection of external disturbances through ndo is proposed by the authors and described in the following algorithm 1 information exchange procedure and collision avoidance of the nmpc based distributed motion planning with the rejection of external disturbances through ndo image 1 4 simulations hereinafter we use the cybership ii model for ship dynamics this characterizes a real ship at a scale of 1 70 thus various parameters which appear later like view range ship length surge bound are scaled proportionally since we aim to test our algorithm on a realistic benchmark using real movement data as given by the automatic identification systems ais we scale all the information distances velocities proportionally to the scale mentioned earlier e g the distance between harbors used in simulation is 70 times less than the real one consider a set of n 3 underactuated ships with the dynamical model 1 with the length overall loa is 1 255 m the matrices 9 9 for simplicity the coriolis matrix is neglected r m d and b taken from fredriksen and pettersen 2006 r i cos ψ i sin ψ i 0 sin ψ i cos ψ i 0 0 0 1 m i 25 8 0 0 0 33 8 1 0115 0 1 0115 2 76 d i 0 9257 0 0 0 2 8909 0 2601 0 0 2601 0 5 these vessels are simulated to navigate in the trondheim fjord norway fig 1 illustrates the operating region of the ships which need to navigate to different harbors while maintaining connectivity and avoiding the shore or small islands and other vessels the ais is used to provide real numerical data related to the position and velocity of ships as well as time of navigation between harbors the three agents in the group need to maintain the connectivity among them while traveling from orkanger to trondheim harbor for situation 1 and stjordal harbor for situation 2 and avoid fixed obstacles and a mobile obstacle which has the dynamical model described in 1 the number of cells considered from partitioning the map as in fig 1 is n cell 22 since the view range is used both to receive i e detect obstacles information and transmit signals to other ships the view range of the ships 3 with ρ i 70 m is assumed the scaling coefficient is e i 1 2 1 5 the steepness of the repulsive potential defined in 9 and 14 is given by β i 1 the steepness of connectivity maintenance function 18 β i j and curve s maximum value l i j used as in 17 are β 12 β 13 β 23 0 002 and l 12 l 13 l 23 1000 other parameters of the nmpc optimization problem in 33 are chosen as follows the weighting matrices q i 0 1 i 6 r i 0 1 i 2 p i 0 5 i 2 0 2 0 2 0 2 i 2 0 2 0 2 0 2 i 2 s i 10 6 we consider a conservatively chosen prediction horizon t p 6 s in order to asses less than ideal conditions decisions have to be made when the other ships obstacles are already very close and the sampling time is 2 s the design parameters of the ndo in 27 and 28 are chosen as follows k 1 i d i a g 0 2 0 0 2 k 2 i d i a g 0 025 0 0 025 d i λ i 1 and β i n d o 1 we consider the surge velocity of agent 1 to be the highest u 1 0 2 0 6 m s the surge velocities of agent 2 and 3 equal u 2 u 3 0 2 0 4 m s and less than the surge velocity of agent 1 the yaw angles constraint is π π we consider constraints on the actuation force t u 1 t u 2 t u 3 2 2 n and on the yaw moment t r 1 t r 2 t r 3 0 2 0 2 nm the lookahead distance is taken in the interval λ τ 2 loa 10 loa where loa is the maximum length of a ship s hull 1 255 m as stated in fredriksen and pettersen 2006 the simulations are done using ipopt solver and casadi andersson et al toolkit in matlab r2016a on a computer with the following configuration intel core i7 4790cpu 3 60 ghz 8 gb ram 4 1 scenario 1 this scenario presents a comparison of the proposed method in this paper and the approach of breiviket al 2017 in the context of colregs compliance in particular rule 8 in the absence of uncertainties the approach of breiviket al 2017 first considers the euclidean distance as a collision avoidance constraint among the agents and then proposes a penalty term ensuring that any alteration of course and speed must be significant enough to clear the approaching ships the two conditions will be taken into account over a prediction horizon the method proposed by breiviket al 2017 penalizes the slow alterations of yaw rate and surge velocity of ship 1 as can be seen in fig 9 at time step k 82 the yaw rate drawn in dashed blue is altered rapidly the decrease in yaw rate implies that ship 1 turns starboard the yaw rate in red color changes gradually and changes earlier than the one in dashed blue at time step k 78 increase in yaw rate means that ship 1 turns port also the euclidean distance between ship 1 and 2 which is implemented by algorithm 1 is greater than the safe threshold whereas the relative distance between the two ships of breivik s approach approaches the safe limit in a critical moment as depicted in fig 10 fig 11 shows the actual motion of two usvs while traveling from orkanger to trondheim harbors while complying with rule 8 of colregs the ship 1 in blue for which we used the algorithm proposed by breiviket al 2017 is trapped at time step k 150 where it becomes cornered within a deadlock region due to simultaneously guaranteeing the safe distance with ship 2 and avoiding the coast meanwhile ship 1 in red for which we use our proposed potential field approach for moving obstacle reaches the trondheim harbor in a timely manner it is worth noting that in the next scenarios the repulsive potentials for the three ships moving obstacle will not be illustrated in order to have less cluttered illustrations 4 2 scenario 2 scenario 1 evaluates the validity of motion planning for connectivity maintenance in a group of three vessels in the course of going to desired harbors while maintaining collision avoidance and complying with the colreg rules with dynamic obstacles under los guidance in the absence of disturbance 4 2 1 situation 1 fig 12 shows the off line collision free path generated using the rrt algorithm after 1500 iterations fig 13 depicts the actual motion of the three vessels traveling from orkanger to trondheim harbor in the same figure we show the group of agents at 7 different time instances as they are changing their formation configuration for instance due to the moving obstacle motion illustrated in black fig 17 shows that the connectivity condition is maintained at time instance k 93 the ship 1 in red is overtaking on the port side of the second and third ship hence satisfying the colregs rule 13 the overtaking situation this can also be observed in figs 16 and 15 where ship 2 in green and 3 in blue are being overtaken not changing their course and speed until step k 135 in time interval k 365 400 the colregs rule 14 concerning head on collisions between ships and or mobile obstacles becomes active the first ship in the group in red and the mobile obstacle start changing their course angles to turn to their starboard right side at time step k 365 fig 15 then the course angle of the third ship of the group in blue has a significant increase at time step k 400 see also fig 15 note that if the course angle of the ship is increasing then the vessel is steered to its starboard and vice versa fig 14 depicts the control inputs corresponding to surge thrust and rudder deflection of the three vessels 4 2 2 situation 2 similarly with situation 1 a collision free path is generated from orkanger to stjordal harbor via rrt after 1500 iterations as in fig 18 fig 19 illustrates the actual motion of the three vessels traveling from orkanger to stjordal harbor we show the group of agents at 10 different time instances changing their formation configuration due to the moving obstacle illustrated in black note that starting with time step k 200 the three ships steer away from the given path due to the repulsive potential of the forbidden cell for ensuring a safe distance between agents and the shore line however after some steps in particular at k 416 the agents return tracking the given path a crossing situation rule 15 of colregs between the group of three ships which start from orkanger harbor and the mobile obstacle which starts from trondheim harbor is encountered since the mobile obstacle crosses from the starboard of the three ships group the mobile obstacle can maintain its direction while the three ships must turn starboard for collision avoidance at time step k 500 the change of the ships course angle can also be observed in fig 22 the first the red line and third the blue line ship s course angles start increasing at time steps k 500 and k 515 respectively for collision avoidance on starboard with the mobile obstacle the course angle of the second the green line ship is not changing since the mobile obstacle has passed by the time they enter this area fig 20 and fig 21 present the surge velocities and the control input of the three ships respectively collision avoidance and connectivity preserving among agents are also validated since the relative distances are greater than safety threshold and smaller than the connectivity threshold as can be seen in fig 23 4 3 scenario 3 assume that the disturbances from the ocean environment are time varying and are described as follows 38 w u i 0 96 s i n 0 02 t 0 84 s i n 0 03 t w v i 0 w r i 0 16 s i n 0 09 t π 3 0 02 s i n 0 01 t then the external disturbances are bounded by w u i w r i 1 72 0 18 4 3 1 situation 1 the effectiveness of the combination between nmpc and ndo is shown in fig 24 where the trajectories of three vessels are similar with those shown in situation 1 of scenario 1 the connectivity maintenance is also guaranteed as observed in fig 25 in this scenario the nmpc based optimized control is combined with ndo eq 27 and 28 in the presence of the time varying disturbance as in eq 38 although the course angle of the three ships is oscillating more than in the case of no disturbance in fig 15 there is also an increased trend for the ships and the mobile obstacle to steer to their starboard side for example at the time instance k 368 the course angle of ship 1 red line and mobile obstacle black line increase which also can be observed in fig 26 as a consequence the colreg rules 13 and 14 are maintained as in situation 1 of scenario 1 fig 27 and 28 the control inputs and surge velocities of the three vessels are presented see fig 28 since the nonlinear disturbances of each ship can be estimated and compensated for the estimated perturbations w ˆ of three ships converge towards the real disorder w by depicted in fig 29 the effectiveness of the use of on off barrier function for the designed function 26 for example the ndo of the 2 n d vessel as can be seen in fig 30 the errors between estimated and actual disturbances when applying the on off barrier function the red one have had shown a slight improvement 4 3 2 situation 2 in this situation the connectivity maintenance and collision avoidance among agents in the group are also maintained in the simulation as illustrated in fig 32 rule 13 of colreg overtaking is obeyed as illustrated in fig 31 at time instance k 101 ship 1 in red overtakes on the left side of the two ships moreover rule 15 crossing is also complied when the obstacle ship keeps its direction and ship 1 turns starboard for collision avoidance as can be seen k 486 in fig 31 this can also be seen in fig 33 the course angle of ship 1 red which increases at k 486 while course angles of ship 1 green and 3 blue are not changing since the mobile obstacle has passed by the time they enter this area similar to situation 1 in this scenario good results are obtained because ndo provides an estimate that rapidly converges towards the real disturbances depicted in fig 34 this allows the ships trajectories in the presence of external disturbances fig 31 to behave like the trajectories in the absence of disturbances fig 19 note that in figs 13 19 24 and 31 we also illustrate the repulsive and attractive potentials projected in 2d the repulsive potentials appear around the forbidden region preventing the ship s collison with the fixed and moving obstacles and the attractive potential is represented by circles around the destination harbor see table 1 computation time of the optimization problem trajectory length and number of simulations to arrive at the destination are delineated in tables 2 and 3 4 3 3 situation 3 in this situation a group of 4 ships which need to maintain connectivity and avoid collision are considered the parameters of ship 4 are similar to those of ship 2 and 3 surge sway velocity actuation force yaw moment the effectiveness of the proposed method is illustrated in fig 35 at time instance k 111 ship 1 in red starts overtaking on the port side of the ships 2 4 in yellow and 3 until time instance k 221 at time instance k 380 ship 1 and the mobile obstacle make a right turn to ensure rule 14 head on situation of colregs moreover the communication range and the safe distances among the 4 ships are also guaranteed as can be seen in fig 36 it s worth noting that in this situation the strength and effect range parameters for the 4 t h fixed obstacle are decreased therefore the four ships do not meander too far away from the given path when they approach the 4 t h fixed obstacle with respect to situation 1 of scenario 2 fig 13 and situation 1 of scenario 3 fig 24 as we can see at time instance k 380 the 4 t h ship stays on the desired path while the rest of the ships cannot stay on this path since they must keep a safe distance with ship 4 and with each other 5 discussions and conclusions an ndo based distributed nmpc scheme has been developed for motion planning problem with connectivity maintenance and collision avoidance for multi surface vehicles the classical non convex constraints from this problem were penalized in the cost function through appropriate potential field constructions ndo can estimate the external disturbance and compensate for their impact via feedback control although simulation results prove excellent performance of the algorithm as well as give insights for real implementation there are still some limitations that will be considered in the future work on one hand instead of assuming a fixed slope parameter β we may obtain it through an estimation fitting procedure which maximizes the appearance of the obstacles in the agent s view range i e a collision risk may be alerted earlier the newton raphson bakari et al 2016 al daffaie and khan 2017 and gradient descent kim et al 2018 manogaran and lopez 2018 method as well as its variants such as batch gradient descent and stochastic gradient descent can be employed to estimate this parameter on the other hand one of the most challenging perspectives is to guarantee asymptotic stability of the potential field based mpc scheme by using the predicted input trajectory along the prediction horizon without doubt this is not a trivial problem to deal with since mas have to leave their predicted paths due to repulsive forces coming from the forbidden areas some well known approaches from the literature are promising stability can be ensured for finite horizon problems by suitably choosing a weighting matrix for terminal cost and an attractive terminal region chen and allgöwer 1998 nguyen et al 2019 alternatively closed loop stability can also be achieved for relatively long horizons without the need to use a terminal cost or a terminal constraint grüne 2012 grüne and pannek 2017 stability is guaranteed by tuning the weighting matrices of the cost function declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a colregs rules used in the paper rule 8 action to avoid collision avoidance action must be applied timely before other vessel approaches any alterations of course and or speed must be large enough to clear the approaching vessels rule 13 overtaking the overtaking vessel can pass on either side and must keep out of the way of the vessel being overtaken the vessel being overtaken must hold the course and speed until other vessel is past and well clear rule 14 head on situation when two power driven vessels are meeting on nearly reciprocal courses so as to involve risk of collision then alter course to starboard so that each pass on the port side of each other rule 15 crossing situation when two power driven vessels are crossing so as to involve risk of collision the vessel which has the other on her own starboard side shall keep out of the way rule 16 actions by give way vessel take early and substantial action to keep well clear appendix b sketch of the proof for proposition 1 assume that the operating space of the i t h agent is the total potential field that is denoted by w r n r 0 the potential field which is the summation of repulsive and attractive potential fields and is given as 39 w p i ℓ 1 n cell s ℓ fix γ ℓ p i ξ p i where ξ p i r n r 0 is attractive potential and s ℓ fix γ ℓ p i is the repulsive potential as presented in 7 with respect to the ℓ t h obstacle ℓ 1 n cell therefore eq 39 can be detailed as follows 40 w p i ℓ 1 n cell c 1 ℓ c 2 ℓ γ ℓ p i 2 p i p i r e f q i 2 the simplest control action z i p i r n is given by the descent gradient method were the input is equated with the steepest gradient as presented in khatib 1986 41 z i p i w p i ℓ 1 n cell c 1 ℓ c 2 ℓ γ ℓ p i 3 ℓ 1 n cell γ ℓ p i 2 q i p i p i r e f p i local minima will happen when there is a poor choice of the parameters of the repulsive and attractive potentials making these potential components cancel each other this means that 41 is equal to zero i e 42 ℓ 1 n cell c 1 ℓ c 2 ℓ γ ℓ p i 3 ℓ 1 n cell γ ℓ p i 2 q i p i p i r e f p i considering the on off repulsive potential field 10 10 it is worth noting that all the parameters c 1 ℓ c 2 ℓ and q i of the total potential field have identical values proposed in eq 8 we can write the total potential as 43 w p i ℓ 1 n cell f i ℓ δ p i ℓ s d s i ℓ c 1 ℓ c 2 ℓ γ ℓ p i 2 p i p i r e f q i 2 with f i ℓ as in eq 9 next applying the descent gradient method we calculate the simplest control action given by the steepest gradient of the total potential in eq 43 44 z i p i w p i ℓ 1 n cell f i ℓ δ p i ℓ s d s i ℓ c 1 ℓ c 2 ℓ γ ℓ p i 2 ℓ 1 n obs f i ℓ δ p i ℓ s d s i ℓ c 1 ℓ c 2 ℓ γ ℓ p i 3 ℓ 1 n cell γ ℓ p i 2 q i p i p i r e f p i where 44 will become 41 i e local minima if and only if ℓ 1 n cell f i ℓ 1 and ℓ 1 n cell f i ℓ 0 i e the entire total static repulsive potential must be in the interior of the view range of i t h agent i e all static repulsive fields must be activated the chances of this happening are much reduced since the view range of the agent is significantly smaller than the size of the workspace under consideration therefore 44 always differs from 41 as long as the agent moves i e the local minima area always moves in other words the proposed method can better deal with local minima in comparison to the classical approach author contribution ngo quoc huy tran conceptualization methodology writing original draft implementation ionela prodan conceptualization writing review editing supervision esten ingar grøtli providing data reviewing laurent lefèvre supervision 
