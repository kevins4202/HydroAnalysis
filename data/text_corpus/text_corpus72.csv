index,text
360,data assimilation techniques are widely used in hydrology and water resources management to improve model forecast uncertainty by assimilating observations the big challenge in practical applications is how to describe model uncertainties correctly to avoid the occurrence of spurious covariance during data assimilation in this study the ensemble square root filter ensrf is used to estimate parameters and states of a groundwater model in guantao china which updates ensemble means and perturbations separately and avoids the need to perturb observations the uncertainty in parameters and states decreased with time while assimilating observations however incorrect updates of parameters and states were obtained which could not be corrected by assimilating further observations improving the representation of the hydrological system to compensate for this effect and reduce other sampling errors introduced during assimilation localization and two covariance tuning methods inflation factor and damping factor are explored in the study the results show that alternative scenarios with proper localization length or a large inflation factor or a small damping factor produce better model estimates and improve the filter performance the scenario with a damping factor of 0 05 shows a distinct gain in model predictive capability the damping factor method is superior to the inflation factor method and preferable in real field applications the scenario combining the damping factor with localization further improved the filter performance the performance of the ensrf with respect to different amounts of measurement error is also analysed even though the increase of observation error can increase the error covariance a corresponding filter improvement is not observed as in that case observations are less informative keywords data assimilation ensemble square root filter groundwater model localization inflation factor damping factor 1 introduction hydrological modelling plays a fundamental role in understanding the response of a system such as an aquifer to natural drivers precipitation and river infiltration and anthropogenic impacts irrigation surface water diversion and pumping of groundwater parameter identification is one of the essential task in hydrological modelling the traditional calibration intends to find a combination of parameters one replicate of the parameter set best fitting the observations without accounting for uncertainty in model inputs parameters states and observations inverse modelling therefore the calibrated hydrological model can only describe one realization of possible model behaviour deterministic estimation the reliability of the hydrological model depends primarily on the model uncertainty during the past few decades ensemble based inverse methods are applied to quantify model uncertainty gomez hernandez et al 2003 hendricks franssen et al 2003 zhou et al 2014 normally they are computationally intensive due to the required large ensembles such as the markov chain monte carlo method in contrast the ensemble kalman filter enkf is more computationally feasible with relatively small ensembles more details about stochastic inverse methods in model calibration can be found in zhou et al 2014 the enkf is a typical data assimilation technique which has been developed to not only update model parameters and states incorporating all model uncertainties but also reduce uncertainty in parameters and states by conditioning the model on observation data as they become available in real time the enkf is proposed to compute error statistics by an ensemble algorithm which is viewed as an alternative to solving the exact but computationally demanding error covariance evensen 1994 the enkf is easy in implementation efficient in computation and applicable to nonlinear models this makes it popular in many fields of earth sciences such as climate modelling kang et al 2001 liu et al 2012 land surface modelling ghent et al 2010 zhang et al 2017 soil moisture modelling gruber et al 2015 fairbairn et al 2015 groundwater modelling hendricks franssen et al 2011 rainfall runoff modelling chen et al 2013 and others one use of the enkf in hydrological modelling is to estimate model parameters and reduce parameter uncertainty in an effort to improve the understanding of the hydrological system s behaviour shi et al 2015 applied the enkf in a land surface hydrologic model to diagnose soil parameters another use is to diagnose current model states to provide a better model prediction chen et al 2011 used the enkf to improve predictions of soil moisture and stream flow el gharamti et al 2013 employed the enkf to estimate states in a coupled flow transport model meanwhile the augmented state vector approach to update model parameters together with states has also become common in hydrological modelling xie and zhang 2010 hendricks franssen et al 2011 lü et al 2011 the success of the enkf relies heavily on the quantification of uncertainties in models all uncertainties covered in the enkf are represented by samples of limited size generated from user defined distributions of uncertain input parameters in practice a small ensemble size is preferable for computational reasons however a hydrological model which usually is spatially distributed and has a large number of states and parameters cannot be truly represented by a small ensemble besides the true model error and the error statistics of the input data required for the model can hardly be assessed all these limitations inevitably introduce errors in the calculation of error covariances during data assimilation a spurious error covariance can lead to the deterioration of the filter performance and result in incorrect updates of parameters and states that cannot be corrected by assimilation of further observations covariance localization and inflation are gaining popularity in correcting error covariance localization is used to correct the spurious correlations in the covariance matrix by reducing the impact of observations at large distance hamill et al 2001 hunt et al 2007 zhang et al 2016 covariance inflation tries to achieve a sufficiently large ensemble spread in each update avoiding the underestimation of the error covariance kirchgessner et al 2014 houtekamer and zhang 2016 in this study we tried two alternatives one introduces an inflation factor to adjust error covariances zhang et al 2004 the other one introduces a damping factor in the updating of parameters and states to avoid sudden large variations in parameters and states during assimilation hendricks franssen and kinzelbach 2008 the enkf requires observations to be perturbed with a random error generated from the assumed but unknown distribution of measurement error this introduces an additional sampling error related to the estimation of the error covariance the ensemble square root filter ensrf is proposed to avoid such perturbations in data assimilation whitaker and hamill 2002 the ensrf is a variant of the enkf and updates ensemble means and perturbations separately some studies have already shown that the ensrf can provide better results than the enkf clark et al 2008 li et al 2015 in practical case studies uncertainties related to the hydrological model and observations are often unknown which accordingly leads to a deterioration of the performance of the ensrf adequate investigations of the performance of the ensrf in practical applications are still rare in hydrology and water resources management therefore our goal is to take guantao county as an example to 1 demonstrate the implementation of the ensrf in estimating model parameters and states by assimilating observations and to 2 investigate the improvement of ensrf derived from localization and covariance tuning methods it is obvious that the covariance tuning methods try to adjust the weight between model forecasts and observations when the ensrf gives higher weight to model forecasts than to observations parameters and states have a wider ensemble spread after assimilation indicating a larger uncertainty on the other hand increasing the observation error can also reduce the weights of observations to figure out the impact of less informative observations on the filter performance scenarios with different amounts of observation error have been tested in our study in the following sections we first describe the study area and the data required in the implementation of the ensrf then the hydrological model of guantao is developed it is a groundwater model coupled with a simplified groundwater recharge model abstracted from hydrus 1d simulations after that the ensrf algorithm is introduced including the implementation of localization and covariance tuning methods inflation factor and damping factor furthermore the design and implementation of different scenarios are described finally we discuss the filter performance according to different scenarios and draw some conclusions our intention is to demonstrate the filter improvement in a real case by showing that it improves model prediction and at the same time prevents the model from drifting away from reality eventually model parameters can be corrected by assimilating observations thus providing an improved basis for applications in real time groundwater resources management 2 study area and data guantao county is located in the southern part of hebei province north china plain ncp fig 1 it lies in an alluvial plain with quaternary deposits consisting of fine sand layers interbedded with clay and silt layers the area is quite flat with the topographical elevation decreasing from 45 m above mean sea level a m s l in the southwest to 36 m a m s l in the northeast over a distance of 39 km the county has an area of 456 km2 300 km2 of which are agricultural land mainly used for winter wheat and summer maize production the weiyun river flows along guantao s eastern boundary with heavy runoff in the rainy season between june and september hence the summer crop needs only some supplementary irrigation due to intensive rainfall while for the winter crop full irrigation is required irrigation water is mainly supplied by groundwater from the shallow aquifer over 79 a fraction of 11 is abstracted from the deep aquifer the weixi channel is the main irrigation channel in guantao there are many sub channels distributing surface water for irrigation the intensive groundwater pumping from the shallow aquifer resulted in a groundwater table decline at a rate of 0 6 m a between 1973 and 2005 guantao dwr 2015 to better manage the groundwater resources in the county and to alleviate the groundwater level decline an accurate numerical model is required the data required in the study to develop a hydrological model are available for the period from 2003 to 2012 guantao meteorological bureau provides monthly precipitation data the groundwater pumping data for irrigation are highly dependant on precipitation in the ncp they are obtained from a previous numerical study li et al 2019 the yearly surface water diversions for irrigation have been collected from the water resources bulletin of guantao guantao department of water resources and china geological survey provided data from altogether 44 observation wells with different observation frequencies thirty of these are used in data assimilation fig 1 while the rest is used to define a specified head boundary condition of the numerical model amongst the 30 observation wells there are 4 wells with monthly measurements 10 wells with 2 data records per year and 16 wells with four measurements per year 3 methods 3 1 hydrological model a 2d groundwater flow model is developed using pmwin chiang and kinzelbach 2001 the governing equation of the transient groundwater flow in the shallow aquifer is described in eq 1 the political boundary of guantao is a complicated curvy line black line in fig 1 in the model it is simplified to a trapezoidal boundary along which a specified head boundary condition is used fourteen groundwater head observations close to the boundary are interpolated to define the time varying boundary head values the weiyun river infiltration is implicitly considered in the hydrological model due to the specified head boundary condition the model domain is horizontally discretized into 210 rows and 190 columns with a grid size of 200 m x 200 m vertically there is only one layer corresponding to the shallow aquifer in guantao area the water exchange with the deep confined aquifer is negligible the top elevation is interpolated from srtm data downloaded from the website http srtm csi cgiar org the bottom elevation is interpolated from geological exploration wells the shallow aquifer of guantao is mainly composed of fine sand layers interbedded with less pervious clay or silt lenses the hydraulic conductivity distribution of the model is introduced by zonation four zones from south to north hk1 hk2 hk3 and hk4 are defined based on pumping tests done in 2015 cnacg 2015 they are shown in fig 2 a the specific yield follows the same zonation sy1 sy2 sy3 and sy4 fig 2a the main sources of groundwater recharge in guantao are seepage from precipitation and irrigation backflow which are implemented in the recharge package defined in the software the annual total irrigation amount is the sum of groundwater pumping and surface water diversion which is evenly distributed over the irrigation season march to june and october the groundwater recharge is expressed as a fraction of the sum of precipitation and irrigation water applied at the soil surface the fraction is the so called recharge infiltration ratio which is divided into three zones rr1 rr2 rr3 according to the soil map cnacg 2015 the zonation is shown in fig 2b the weixi channel infiltration is simulated using the river package it is based on the user defined inputs river level bottom width thickness of the riverbed and its hydraulic conductivity the discharge by pumping is implemented in the well package with a spatial distribution proportional to the number of wells per grid cell the model simulation covers 10 years from 2003 to 2012 with a time step of 1 month 1 s y h t k x m h x k y m h y q i n q o u t sy is the specific yield h refers to the groundwater head m t is the time d k is the hydraulic conductivity m d m is the aquifer thickness and is a function of h m qin qout are the source sink terms m d which are defined in the corresponding packages of the pmwin the temporal distribution of recharge from precipitation and irrigation arriving at the water table is obtained from hydrus 1d simunek et al 2008 the details of the hydrus 1d model and results can be found in the literature li et al 2019 the upper boundary is implemented as an atmospheric boundary in the surface layer and the free drainage condition is implemented at the lower boundary the water input at the groundwater surface equals precipitation plus irrigation minus evaporation and evapotranspiration and is determined as the product of the total precipitation and irrigation flux multiplied by a net recharge infiltration ratio the calculated temporal distribution of the groundwater recharge at the groundwater table is the relevant input for the transient groundwater model during implementation of the ensrf hydrus has to be called for each replicate in every time step during the assimilation of observations this takes quite some computation time we therefore simplify the hydrus numerical simulation by deriving a linear functional relation between inputs to and outputs from the hydrus 1d model the details are explained in the supplementary materials section s1 we use manual calibration to minimize the sum of squared errors between observed and computed groundwater head data the rmse from manual calibration is around 1 3 m the results show that the numerical model can roughly capture the dynamics of the groundwater heads but more effort should be put into improving estimates of model parameters and states it is obvious that the manual calibration is not perfect there are still deviations between observed and computed values and the parameters are non unique the ensrf is then introduced to the numerical model to find better estimates of model parameters and states since the numerical model is only a simplification of the real hydrological system and the prior knowledge about model structure model parameters etc is poor the manually calibrated model parameters can be taken as basis values ensemble means to define the parameters prior distributions needed to implement ensrf in the numerical model 3 2 data assimilation 3 2 1 ensemble square root filter the enkf is a sequential data assimilation method based upon monte carle simulation to filter out the best realizations of states and parameters in a dynamic system by assimilating observations thus turning a prior ensemble of realizations into a posterior improved ensemble the ensrf used here is a variant of the enkf which does not require perturbing the observations it updates the parameter state ensemble means and perturbations separately when observations are available the procedure adopted in our study is the same as stated in the literature li et al 2015 the procedure is expressed by the following equations 2 x a x f k y obs y f 3 k p f h t h p f h t r 1 x f y f t y f y f t n 1 r 1 x f y f t c 1 4 x a x f t 5 x a x a x a where the overbar denotes the ensemble mean x is the augmented state vector containing both the ensemble parameters and states groundwater heads superscripts a f represent posterior analysis prior forecast augmented state ensemble n x n n is the number of replicates in the ensemble n is the total number of parameters and states k is the kalman gain y is an ensemble of prior measurement forecasts obtained by running a model using a prior parameter ensemble m x n m is the number of measurements h is an operator projecting the parameter and model states on the observation space here it is the hydrological model yobs is the matrix of model measurements m x n each vector contains the same measurements the apostrophe indicates the ensemble perturbations pf is the forecast error covariance matrix n x n r is the measurement error covariance matrix m x m the ensemble means are updated in the same way as in the enkf while the perturbations are corrected by a transform matrix t the final parameters and states are updated according to eq 5 in the ensrf in traditional enkf the error covariance of parameters states is updated by eq 6 6 p a p f kh p f x f k y f x ft n 1 unlike the traditional enkf the error covariance of augmented states in ensrf is implicitly updated the transform t in eq 4 is derived from the error covariance matrix n x n as follows 7 p a x a x a t n 1 combining eq 3 eq 6 and eq 7 we obtain eq 8 8 x a x a t x f i y f t c 1 y f x f t x f t t t x f t x f t x f t t after applying the eigenvalue decomposition of c we compute c 1 sλ 1st λ is a diagonal matrix s is a square m x m matrix replacing c 1 in eq 8 we have 9 t t t i y f t s λ 1 s t y f i λ 1 2 s t y f t λ 1 2 s t y f i b t b matrix b is a m x n matrix and is computed by the singular value decomposition b uς 1vt u σ and v are matrices of dimension m x m m x n and n x n respectively after replacing b by decomposition matrices in eq 9 the equation is written as follows 10 t t t i u σ 1 v t t u σ 1 v t i v σ t σ v t v i σ t σ v t v i σ t σ η t v i σ t σ η t t where η is a random orthogonal n x n matrix therefore 11 t v i σ t σ η t in our study we let η be equal to v thus t is symmetric and consequently the ensrf is unbiased livings et al 2008 3 2 2 localization localization is used to improve the accuracy of the estimated forecast error covariance by suppressing the impact of observations outside of a predefined distance or correlation length on the analysis of a state the main component of covariance localization is to find a suitable correlation function with local support the most popular function used in the kalman filter family is a fifth order polynomial proposed by gaspari and cohn 1999 because of its superior assimilation performance kirchgessner et al 2014 currently this function is the standard implemented in covariance localization however it is not obvious to apply this correlation function to the error covariance matrix of a square root filter dance et al 2009 some studies have shown that doing so is inappropriate in the ensrf petrie 2008 petrie and dance 2010 therefore in this study an explicit local analysis domain localization is adopted considering only the observations close to the location grid point of the analysis during the assimilation process evensen 2003 ott et al 2004 hunt et al 2007 fig 3 demonstrates how the localization is implemented the analysis of a state is computed grid point by grid point for any analysis grid point state e g pink colour in fig 3a a sub region with a predefined distance l to the analysis grid point is defined first then only the observations located in this sub region 2 observations instead of 5 observations in fig 3a are used in the analysis l is the distance between the centre point of the analysis grid and the observation point the parameters used in this study are characterized by zonation including many grids with the same value fig 3b zonal parameterization is used in hydrological modelling to reduce the degrees of freedom of a model to a number compatible with available observation points the sub regions for the parameter analysis are defined accordingly make them larger than the parameter zone itself by a minimum distance l between the enlarged border and the parameter zone border fig 3b shows the example of 4 observations used in the parameter analysis l corresponds to the radius of the circle used in the cast of state localization 3 2 3 covariance tuning methods 3 2 3 1 inflation factor the inflation factor aims to inflate the error covariance to achieve a better filter performance here we use the method of relaxing the perturbations after analysis and updating of the ensemble mean back to the prior perturbations using the following equation zhang et al 2004 12 x a 1 β x a β x f 0 β 1 where β is an inflation factor β equal to 1 means that the posterior perturbations are identical to the prior perturbations while β equal to zero indicates that no covariance inflation is considered miyoshi 2005 showed that the filter is more stable and produces better results with a larger covariance inflation factor in this study different values of β are tested 3 2 2 2 damping factor the damping factor is introduced to reduce the update magnitude of parameters states and thereby reduce the spurious covariance due to abrupt changes of parameters during the assimilation process furthermore the damping factor also makes the perturbations smoother and produces a sufficiently large ensemble spread achieving the same goal as the inflation factor introduced in the previous section damping of forecast updates has been studied by hendricks franssen and kinzelbach 2008 and rasmussen et al 2015 and 2016 it is achieved using the following equation 13 x a x f γ k y obs p y f 0 γ 1 where yobs p are the perturbed observations γ is a damping factor γ 1 means that there is no damping effect γ 0 indicates an open loop run without assimilating observations since parameter state means and perturbations are updated separately in the square root filter the damping factor in the ensrf is introduced for both ensemble means and perturbations by the following equations 14 x a x f γ k y obs y f 0 γ 1 15 x a γ x a 1 γ x f 0 γ 1 it is clear that eq 14 and eq 15 produce the same effect as eq 13 a damping factor of zero means that the posterior parameters states are equal to their prior while a damping factor 1 indicates no damping influence during the assimilation process to improve the parameter and state estimation several values of the damping factor are tried out 3 3 model uncertainty to successfully implement ensrf in the hydrological model it is required to quantify model uncertainty which usually originates from model structure model parameters driving forces and measurements in our study the uncertainty in model structure is not explicitly quantified it is implicitly considered in the measurement errors the uncertainty in model structure is revealed by differences between observations and the corresponding model outputs a head measurement for example may be influenced by the screening of the observation well while the 2d model uses average heads over depth the discrepancy does not invalidate the model the increase of the measurement error tends to insure that observations generally lie within the respective forecast ensemble in other words larger measurement error gives higher weight to model forecasts accordingly the forecasts uncertainty is less influenced by observations which can be viewed as a compensation for not considering the uncertainty of model structure it should be kept in mind that increasing measurement error is not a complete alternative to representing the structural model error in an adequate model parameterization it is only usful when the deviations between modelled and measured results are not excessive the measurement error cannot be increased to unrealistic values as all true information will be lost the details about the influence of measurement error are discussed in section 4 7 3 3 1 parameters and states to execute the ensrf a number of statistical parameters states are required according to a sensitivity analysis the model parameters which have to be updated include 4 hydraulic conductivities hk1 hk2 hk3 and hk4 4 specific yield values sy1 sy2 sy3 and sy4 and 2 recharge infiltration ratios rr1 and rr2 the parameters are updated between 2003 and 2012 together with the groundwater heads by using an augmented state vector approach liu and gupta 2007 hendricks franssen and kinzelbach 2008 estimating parameters and states together is more likely to introduce errors in error covariance estimation during the assimilation process than in the case of only updating states due to the nonlinear relationship between groundwater heads and hydraulic conductivity the manually calibrated parameter values of the deterministic model are taken as the mean values of the parameter distributions base values in table 1 to generate prior ensemble of parameters the model parameters are assumed to follow log normal distributions with a standard deviation of 0 5 table 1 this value is determined by communications with local experts later scenarios with larger standard deviations for parameters are discussed fifty initial realizations of parameter sets are generated using latin hypercube sampling minasny 2004 the influence of the ensemble size on the filter performance is discussed later the ensemble of initial groundwater heads is generated as follows 16 h ih i j h ih i j o θ ih i j where hih i j and h ih i j o are the perturbed and original initial groundwater head in model cell i j respectively and θih i j is the initial groundwater head error generated from a normal distribution with zero mean and a standard deviation of 1 m 3 3 2 errors from driving forces and observations amongst the input data to the hydrological model of guantao precipitation is the most important source of groundwater recharge the groundwater recharge from precipitation is calculated by multiplying precipitation by the recharge infiltration ratio rr which is updated during the data assimilation process hence the precipitation uncertainty in the ensemble is already considered via the uncertainty of rr the pumping rate time series is uncertain and is assumed to have a normal error distribution as defined in eq 17 θ is a random number generated from a normal distribution with zero mean and a standard deviation of 0 2 17 q pump t q pump t o 1 θ where qpump t is the perturbed pumping rate at time t the superscript o represents the base value without considering errors the uncertainty of specified groundwater heads on the boundary is implemented by adding an error that is normally distributed eq 18 18 h b i j h b i j o θ b i j where hb i j is the groundwater head on the boundary cell i j and θb i j is the error for this head generated from a normal distribution with zero mean and a standard deviation of 1 m the measurement error for groundwater head observations has a strong impact on the posterior distribution of model parameters and states as mentioned in the beginning of this section the measurement error in our study incorporates all other remaining uncertainties that have not been quantified previously such as the uncertainty in the model structure therefore a measurement error of 1 m is set for all observation wells fig 1 which is higher than the true measurement error of about 0 5 m mainly due to the levelling error local communication the value will be tested in a synthetic study in section 4 1 the influence of measurement error on the filter performance will be discussed in section 4 7 3 4 scenario design to demonstrate the filter performance of the ensrf in a hydrological model and its improvements against the standard variant by means of localization and covariance tuning methods several scenarios are implemented in this study synthetic scenario ensrf syn synthetic experiments test the ability of the ensrf in improving estimation of model parameters and states when the true hydrological system is known a true numerical model consists of known model structure boundary conditions model parameters and model inputs the true model is similar to the hydrological model developed in section 3 1 but with one set of parameters randomly generated from the prior distribution of parameters listed in table 1 no perturbations are added in the model inputs the synthetic head observations are generated from the forward run of the model adding random errors which follow a normal distribution with zero mean and a standard deviation of 1 m after that a synthetic filter model ensrf syn is applied based on the true model considering all uncertainties mentioned in section 3 3 with the measurement error of 1 m fifty replicates of parameters and states are updated monthly for the period from january 2003 to december 2012 the true values of model parameters and states are to be detected during the filter implementation basic scenario ensrf now the real observations instead of synthetic observations are assimilated to update model parameters and states the model inputs are perturbed in the same way as stated in the synthetic scenario fifty replicates of parameters and states are updated monthly for the period from january 2003 to december 2012 the assimilation of real observations leads to a more realistic evaluation of filter performance than the synthetic case first an open loop run is carried out considering only parameter uncertainties it consists of an ensemble of model forward runs without assimilating observations then the ensrf is implemented on the ensemble of models by considering input perturbations and assimilating real observations comparison of the results from the open loop runs and the ensrf demonstrates the filter effect with regard to improving model parameters and states estimation unlike in the synthetic case the model parameters and states are unknown in the practical application incorrect ensemble updates are more likely to occur in the basic scenario to reduce the sampling error and find a suitable ensemble size to capture reality different ensemble sizes were used in the basic scenario to explore the impact of the ensemble size on the filter performance scenarios with different realizations of initial ensembles ensrf largp in these scenarios the initial parameter ensembles cover a larger range with a larger standard deviation than used in the basic scenario the model inputs are perturbed in the same way as stated in the basic scenario fifty replicates of parameters and states are updated monthly over 10 years the results will examine the effect of the initial parameter ensembles on the filter performance scenarios with different assimilation frequencies ensrf fre these scenarios are based on the basic scenario and update parameters and states by assimilating groundwater head observations at different frequencies or assimilation time steps respectively this allows observing the influence of different observation frequencies on the filter performance fifty replicates of parameters and states are updated at the predefined assimilation time steps localization scenarios ensrf loc these scenarios apply the localization to the basic scenario different localization lengths are used to demonstrate the effect of localization on the filter performance fifty replicates of parameters and states are updated monthly over 10 years covariance tuning scenarios ensrf inf and ensrf damp covariance tuning methods are used to correct spurious model updates and forecasts of the error covariance these scenarios are based on the basic scenario introducing either an inflation factor or a damping factor fifty replicates of parameters and states are updated monthly over 10 years ensrf inf illustrates the effect of different inflation factors on updating model parameters and states ensrf damp demonstrates the influence of different damping factors on the filter performance scenarios with different observation errors ensrf obs these scenarios are based on the basic scenario and incorporate different amounts of measurement error uncertainty in model parameters and perturbations in model inputs are the same as stated in the basic scenario the ensemble size is fifty and all scenarios assimilate observations monthly over 10 years scenarios with different ensemble sizes these scenarios are based on the selected best scenario considering both localization and covariance tuning fifty replicates of parameters and states are updated monthly over the 10 year period different ensemble sizes were used to explore the impact of the ensemble size on the filter performance 3 5 performance evaluation to evaluate the performance of the ensrf several indicators are adopted in this study besides the means and standard deviations spread of variable ensembles root mean square error rmse the rmse is calculated based on the ensemble mean of the groundwater heads at the observed locations and the corresponding real observations in each time step 19 rmse t 1 t i 1 no h o t hc t i 2 no t where hot is the groundwater observation at time t hc t i is the ensemble mean of the calculated groundwater heads at observation point i at time t no is the number of observations t is the total number of time steps normalized root mean square error ratio nrr this ratio aims to evaluate the confidence of the ensemble mean moradkhani et al 2006 moradkhani and meskele 2010 lei et al 2014 and is defined as follows 20 nrr 2 n n 1 rmse mrmse where n is the ensemble size rmse is the time averaged rmse of the ensemble mean defined in eq 19 mrmse is the mean rmse of the ensemble replicates defined in eq 21 where hct i j is the calculated groundwater head of replicate j at observation point i at time t an nrr of 1 is desirable nrr larger than 1 indicates that the ensemble spread is too narrow while nrr smaller than 1 means a too wide ensemble spread 21 mrmse 1 n j 1 n t 1 t i 1 no h o t i h c t i j 2 no t normalized error reduction index ner ner is an index to measure the magnitude of the improvement of scenario a over scenario b this index has been used by chen et al 2011 lei et al 2014 ner varies between negative infinity and 1 a positive ner means an improvement of scenario a over scenario b with value 1 representing the greatest improvement a value of zero means that there is no improvement and a negative ner signifies a deterioration in the performance of scenario a compared to scenario b 22 ner 1 rms e a rms e b 4 results and discussion 4 1 synthetic scenario ensrf syn after assimilating data under conditions described in the synthetic scenario the posterior distribution of parameters and states are shown in fig 4 it is apparent that the parameters ensemble means deviate from their true vales at the beginning of the assimilation after 40 time steps of data assimilation the parameter ensembles converge to the true values with very small uncertainty in the parameter distributions the parameter spreads decrease with increasing number of assimilation time steps which indicates that the uncertainty of parameters can be significantly reduced by incorporating more and more observations the distribution of parameter rr2 narrows faster than those of the other parameters indicating that the parameter rr2 is more sensitive to observations the posterior ensembles of the groundwater level in three chosen observation wells are shown in fig 4 the well numbers are those given in fig 1 the ensemble mean fits the true values quite well suggesting that the true model states are captured in the process of data assimilation by incorporating the synthetic observations the distribution of the updated groundwater level narrows with time the uncertainty in groundwater level decreases with a growing number of assimilation time steps reflecting the benefits of assimilating observations the standard deviations of updated groundwater levels in wells 11 12 and 2 fig 4d to fig 4f are reduced to 0 13 m 0 11 m and 0 08 m respectively at the last time step similar results can be observed in other observation wells the ensrf is capable of capturing true model parameters and states and reducing their uncertainty this further proves that the measurement error of 1 m is capable of constraining model parameters and states 4 2 basic scenario ensrf the objective of data assimilation is to find the best possible estimates of model parameters states and improve the model accuracy in order to assess the performance of the data assimilation open loop ensemble simulations are carried out as a reference only parameter uncertainty is considered in the open loop simulations the time series of the respective rmses and ensemble spreads of the groundwater level are shown in fig 5 it is clear that data assimilation reduces not only the rmse of the groundwater levels but also their uncertainty the average rmse of the groundwater level over the whole period is around 1 9 m in the open loop while with data assimilation the value is reduced to 1 1 m the ensemble spread of the groundwater level with data assimilation is much smaller than that in the open loop simulations fig 5 right the nrr value of 0 5 in the ensrf compares to a value of only 0 1 in the open loop indicating a relatively wider groundwater level ensemble spread in the open loop simulations the groundwater level is a function of model parameters whose uncertainty is converted to the uncertainty in groundwater levels in each time step this uncertainty is continuously carried over to the simulation of groundwater levels in the next time step therefore the uncertainty in groundwater levels is cumulated with each time step and shows a gradually increasing trend when assimilating observations the uncertainty in the groundwater level is considerably reduced fig 6 shows ensembles of parameters and groundwater levels changing with time after assimilation at each time step the parameter ensemble spread decreases by 80 of its initial value which implies that uncertainty in all parameters is considerably reduced due to assimilating observations at the same time all parameter replicates are supposed to have converged to or be closer to their true values which are not known in this real case the posterior replicates of groundwater levels in three chosen observation wells are demonstrated in fig 6d to fig 6f the filter performance improves from north to south with the rmses in wells 11 12 and 2 of 1 6 m 1 1 m and 0 5 m respectively the replicates of groundwater levels deviate from observations and the spreads are much smaller indicating an incorrect estimation of groundwater levels after assimilation fig 6d shows that the observations are outside of the ensemble range already at the beginning of the simulation while the forecast members at the first time step still contain the observation value the small plot on the top of fig 6d this confirms that the filter degeneration starts right from the beginning it is noted that the ensemble replicates can capture the dynamics of groundwater level but the variations are much smaller than those seen in the observation wells especially in wells 11 and 12 this could be caused by the fact that the ensemble of parameters narrows very fast after a few assimilation steps and converges to spurious values which can no longer be improved by assimilating observations fig 6b convergence is reached on the basis of a short history and an adaptation to longer term variability is no longer possible this phenomenon is frequently observed in practical applications where the true parameters and true errors in model inputs structure and observations are unknown in the synthetic scenario defined in section 4 1 on the other hand all observations contain systematically the true information which lead the filter to find the true parameter values even within a small number of time steps the ensrf uses an ensemble of parameters and states to approximate their true distributions increasing ensemble size not only enables the ensrf to produce error estimates more accurately but also makes the data assimilation computationally expensive in practice it is important to choose an appropriate ensemble size to limit the computation time another two scenarios with ensemble sizes of 20 and 100 are explored ensrf 20 and ensrf 100 the results are shown in fig 7 including the basic scenario ensrf with the ensemble size of 50 ensrf 50 for a smaller ensemble size of 20 the model parameters have smaller variance with the increase of ensemble size the parameters spreads become broader except for parameter rr2 which is not sensitive to the ensemble size fig 7d while an increase of the ensemble size from 50 to 100 slightly improves the parameter variance the computation time increases from about 9 h to around 18 h on one thread of a computer with cpu 3 6 ghz slight improvements in groundwater level are observed in wells 11 12 and 2 with the rmses decreasing by 1 3 and 5 respectively when increasing the ensemble size from 20 to 100 the ensemble spreads of groundwater levels in wells 11 12 and 2 increase by 1 10 and 14 respectively considering both the filter performance and computation cost the ensemble size of 50 is sufficient in our study increasing the ensemble size can reduce the underestimation of uncertainty in parameters and states however the ensrf in our study cannot be considerably improved by increasing the ensemble size only 4 3 influence of initial parameter ensemble theoretically the initial parameter distributions should be as wide as possible to include all possible parameter values in practice the initial parameter ensembles are generated according to means and variances based on prior knowledge this kind of initial parameter ensemble is often subjective especially if experimental data are scarce in order to examine the effect of the initial parameter ensembles on the filter performance a larger variance is taken into account in the scenarios compared to the basic scenario the standard deviation of parameters listed in table 1 change from 0 5 to 1 ensrf largp1 and 1 5 ensrf largp2 respectively the results show that with a wider initial parameter distribution the parameter spread drops dramatically in the first 20 assimilation steps most parameters have similar trends as in fig 8 a but the ensemble members of sy3 are still updated to unacceptable values with larger coverage of the initial ensemble fig 8b the evolution of groundwater levels in fig 8c shows that at the beginning of the assimilation the scenario ensrf largp2 has a larger ensemble spread than the other two scenarios at the end of the assimilation time all scenarios have a similar distribution in groundwater levels this is also signalled by the error statistics listed in table 2 the model accuracy and filter performance improve only slightly by applying larger initial distributions in parameters therefore the initial parameters replicates used in the study are sufficient to include the true parameter characteristics larger variation of initial ensemble cannot prevent updating of ensemble members to wrong values 4 4 influence of different assimilation frequency data assimilation is a sequential updating process following the observation frequency observations with higher frequency result in more assimilation time steps to explore the impact of the number of assimilation time steps observation frequency on the filter performance different intervals between two assimilation steps are tested including 1 month ensrf 3 months ensrf fre 3 m and 6 months ensrf fre 6 m the parameter ensemble distribution narrows for all scenarios with increasing number of assimilation time steps which demonstrates that parameter uncertainty is reduced when longer time series of data are involved fig 9 a the parameters assimilated in scenario ensrf fre 6 m have the largest uncertainty as in this case less observation information is assimilated in the beginning the parameter ensemble members haver larger uncertainty and stay closer to their initial values compared to the basic scenario which results in the updated ensemble of groundwater levels covering initial observation values in scenarios ensrf fre 3 m and ensrf fre 6 m fig 9b with the ongoing assimilation process the parameters are gradually updated to similar values spurious updates still exist localization and covariance tuning methods are necessary to avoid spurious parameter estimation the rmses of groundwater levels are slightly increased by 6 in both scenarios ensrf fre 3 m and ensrf fre 6 m the negative value of ner 0 06 in both scenarios indicates that the filter performed worse when considering lower frequency observations therefore the higher frequency observations are preferable in data assimilation to improve model accuracy and filter performance 4 5 improvement by using localization localization improves estimates of parameters and states by correcting spurious correlations in the covariance matrix scenarios considering different localization lengths are explored in the study localization lengths of 600 m ensrf loc1 1800 m ensrf loc2 6000 m ensrf loc3 and 12 000 m ensrf loc4 are explored the uncertainties in updated parameters and states are shown in fig 10 smaller localization length tends to produce a larger ensemble spread in parameters states and inflates their uncertainty fig 10a to fig 10c when the localization length reaches 12 000 m there is hardly any inflation observed in the parameter uncertainty compared to the basic scenario fig 10a this indicates that a localization length less than 12 000 m is preferable in this study with the increase of the localization length from 600 m to 12 000 m the ensemble spread of the groundwater levels in well 11 at the end of assimilation period increases from 0 17 m ensrf to 0 2 m both ensrf loc1 and ensrf loc2 0 22 m ensrf loc3 and 0 21 ensrf loc4 the rmse of groundwater levels in wells 11decreases from 1 6 m in scenario ensrf to the lowest value of 1 45 m in scenario ensrf loc3 while for wells 12 and 2 the smallest error is observed in ensrf loc4 and ensrf loc3 with the rmse improved by 11 and 8 respectively considering all observations the scenario ensrf loc3 produces slightly better results where the rmse is reduced to 1 02 m from 1 1 m in the basic scenario fig 10d localization is said to remove spurious correlations hamill et al 2001 petrie 2008 a relatively smaller localization length tends to inflate parameter state uncertainty and to reduce the rmse but in this study the results show only a slight improvement in filter performance the negative value of ner indicates a deterioration in filter performance compared to the basic scenario this indicates that it is not advisable to apply a shorter localization length in this study the scenario with a localization length of 6000 m ensrf loc3 generates the best results compared to the basic scenario ensrf with an improvement of 7 showing in the ner value in table 3 4 6 effect of covariance tuning 4 6 1 improvement by introducing an inflation factor in this section we focus on the impact of the inflation factor on filter performance fig 11 shows the evolution of uncertainty of parameters states and the improvement of the rmse in different scenarios that adopt inflation factors of 0 8 ensrf inf 0 8 0 7 ensrf inf 0 7 and 0 5 ensrf inf 0 5 it is clear that a large inflation factor increases the uncertainty in posterior parameters fig 11a and fig 11b this is because a large inflation factor results in lowering weights on observations while increasing weights on model forecasts during assimilation a similar trend can be observed in the distribution of the posterior groundwater level fig 11c the parameter tends to overshoot with updates to larger values followed by updates to smaller values fig 11b the inflation factor increases the variance in groundwater levels and helps the filter to find better posterior groundwater levels the ensemble spread of the groundwater level in well 11 decreases from 1 0 m in the first step to 0 2 m in the last time step benefiting from assimilating observations with time scenario ensrf inf 0 8 the rmse values of groundwater levels in wells 11 12 and 2 decrease from 1 6 m 1 1 m and 0 5 m in scenario ensrf to 1 6 m 0 9 m and 0 4 m respectively in scenario ensrf inf 0 8 even though the groundwater level in scenario ensrf inf 0 8 tends to fit the lower values of observations the higher groundwater level peaks are still strongly underestimated therefore the rmse of groundwater levels in well 11 is hardly reduced fig 11c compared to the basic scenario all scenarios lead to a slight reduction in the rmse of groundwater levels in all observed wells which indicates that the inflation method improves both filter performance and model accuracy fig 11d the error statistics related to scenarios considering different inflation factors are listed in table 4 the rmses of scenarios ensrf inf 0 8 ensrf inf 0 7 and ensrf inf 0 5 are reduced by 9 6 and 4 5 compared to the rmse in scenario ensrf from the ensemble distribution point of view nrr values for all scenarios are smaller than 1 indicating a wider spread in the groundwater level distribution compared to the ensrf the decreased value of nrr in scenarios with increased inflation factor implies an increased uncertainty in groundwater level the ner values in table 4 indicate the quantity of improvement relative to the ensrf they are all positive indicating an improvement in data assimilation due to inflation the scenario ensrf inf 0 8 provides the best filter performance and has a ner value of 0 09 indicating that the filter performance improved by 9 by introducing an inflation factor of 0 8 however this scenario updates the parameter ensembles sy4 to values larger than 0 5 which is unrealistic in this case study therefore the inflation factor of 0 7 is the better choice in the study from the analysis above it is clear that introducing the proper localization length and inflation factor separately can both reduce the rmse and improve the filter performance but the improvement is limited here another scenario is explored applying the inflation factor of 0 7 in combination with a localization length of 6000 m ensrf infloc the ensemble spread of groundwater level in well 11 at the last time step is increased to 0 4 m from 0 2 m in scenario ensrf inf 0 7 while the rmse of groundwater level in well 11 is reduced to 1 5 m from 1 6 m in ensrf inf 0 7 the smaller number of nrr indicates a relatively larger uncertainty in model output compared to the scenario ensrf inf 0 7 the scenario ensrf infloc improved the filter performance and improved the model accuracy by 13 the best filter performance of the ensrf is achieved when localization length and inflation factor are applied in combination in this study similar results can be found in other studies hamill et al 2001 whitaker and hamill 2012 kirchgessner et al 2014 houtekamer and zhang 2016 applying the proper localization length and inflation factor together is recommended for improving model results the optimal values of localization length and inflation factor have to be adapted in every individual study 4 6 2 improvement by introducing a damping factor different scenarios with a damping factor of 0 5 ensrf damp 0 5 0 3 ensrf damp 0 3 0 1 ensrf damp 0 1 0 05 ensrf damp 0 05 and 0 01 ensrf damp 0 01 are explored in this section together with the basic scenario ensrf which corresponds to a damping factor of one there are six scenarios for comparison the effect of the damping factor becomes clear when studying the time series of ensemble spreads and the rmse of groundwater levels fig 12 the parameter uncertainty is clearly reduced over time during assimilation of observations in all scenarios if the damping factor is not used the ensemble spreads of parameters and states are the smallest ensrf fig 12a to fig 12c with the introduction of the damping factor the uncertainty of parameters states increases which results in an improvement in the rmse of the groundwater level fig 12d the ensemble spread of the groundwater level in well 11 increases from 0 17 m ensrf to 0 22 m ensrf damp 0 5 0 33 m ensrf damp 0 3 0 6 m ensrf damp 0 1 1 m ensrf damp 0 05 and 3 5 m ensrf damp 0 01 respectively at the last time step benefiting from the decrease of the damping factor the rmse of groundwater levels in well 11 decreases from 1 6 m in scenario ensrf to 1 4 m in scenario ensrf damp 0 5 1 15 m in scenario ensrf damp 0 1 1 09 m in scenario ensrf damp 0 05 and 1 06 m in scenario ensrf damp 0 01 even though the scenario with the smallest damping factor 0 01 produces the smallest error the uncertainty increases dramatically except for this extremely small value the other scenarios show that decreasing the damping factor improves filter performance this is due to the fact that a smaller damping factor in eq 14 and eq 15 increases the perturbed amplitudes of posterior parameters and states considerably which can then be updated to values better describing the hydrological model it should be kept in mind that an extremely small damping factor can lead to unrealistically large uncertainty in model forecasts table 5 lists the error statistics related to scenarios with different damping factors as expected the overall rmse of groundwater level decreases with decreasing damping factor the scenario with damping factor of 0 01 has the lowest rmse according to the value of ner the scenario ensrf damp 0 01 improves the filter performance by 54 compared to the ensrf the damping factor of 0 01 means that only 1 of the maximum update is used in each assimilation this increases the perturbations of posterior parameters and states and inflates the error covariance the smallest value of nrr 0 06 corresponds to the largest ensemble spread in groundwater level standard deviation of 3 5 m which is unrealistic as it is much larger than the groundwater level dynamics standard deviation of 2 m overall the scenario with damping factor 0 05 produces the best results with a relatively smaller rmse and larger uncertainty compared to the basic scenario relatively small damping factors have also shown to be preferable in other studies hendricks franssen and kinzelbach 2008 rasmussen et al 2015 finally the scenario combining the localization length of 6000 m with the damping factor of 0 05 is discussed ensrf damploc the results show that the parameter uncertainty is slightly increased compared to the results of the ensrf damp 0 05 fig 12a and fig 12b while the ensemble spread of the groundwater level in well 11 at the last time step is decreased by 10 of the value in ensrf damp 0 05 fig 12c the smaller value of nrr 0 16 indicates a relatively larger uncertainty in overall groundwater level overall the filter performs better in scenario ensrf damploc than in ensrf damp 0 05 with lower rmse and higher improvement table 5 introducing localization together with a damping factor is recommended for the improvement of filter performance 4 7 influence of measurement error in the previous analysis the measurement error is predefined and chosen as 1 m standard deviation however it is difficult to obtain a true observation error in the real application due to the unknown sources of uncertainty moreover the measurement error plays an important role in updating parameters and states in the ensrf which tries to balance the weights between model forecasts and observations during assimilation different measurement errors are tested in the study with standard deviations of 0 5 m ensrf obs 0 5 2 m ensrf obs 2 and 5 m ensrf obs 5 respectively as expected the ensemble spreads of parameters and states become wider with the increase of the measurement error because a large measurement error makes the filter give higher weight to model forecasts and lower weight to observations fig 13 a the overall rmses of groundwater level are 1 11 m in ensrf obs 0 5 1 12 m in ensrf 1 11 m in ensrf obs 2 and 1 14 m in ensrf obs 5 respectively the overall rmse of groundwater levels tends to increase slightly with the increase of the measurement error a change in observation error has different impact at individual locations the taylor diagrams in fig 13c to fig 13e summarize the performance of the ensemble mean in different scenarios compared to the observation data taylor 2001 the taylor diagrams are generated by using the function coded by maze 2020 the letter obs refers to observations the dark blue green and red dots represent the results from scenarios ensrf ensrf obs 0 5 ensrf obs 2 and ensrf obs 5 respectively in the previous discussion the standard deviation is referred to as ensemble spread in the taylor diagrams the standard deviation refers to the standard deviation of the ensemble means of groundwater levels in each well for well 11 the filter with measurement error of 5 m improves performance while ensrf obs 2 and ensrf obs 1 produce better results for well 13 and well 2 respectively this may implicitly suggest that different measurement errors should be used for different observation wells in applications the ensemble spreads of parameters are still reduced with time in the scenario ensrf obs 5 indicating that observations even with a large error still play a role in reducing uncertainty in model parameters during the assimilation process in this study the measurement error of 5 m is unrealistic because it is much larger than the groundwater level dynamics it should be noted that the covariance tuning methods described in the previous section also try to improve the filter performance by inflating error covariance which means giving less weight to the observations during assimilation increasing the measurement error indeed increases the uncertainty in model parameters and states however the filter improvement is not comparable to scenarios considering covariance tuning methods this is because less informative observations are assimilated in scenarios considering larger measurement errors while the information in observations is slowly but completely assimilated in scenarios considering covariance tuning 4 8 influence of ensemble size after selecting the proper localization length and the damping factor ensrf damploc several scenarios are implemented to explore the filter performance under varying ensemble size like in the basic scenario we choose the ensemble size of 20 members ensrf damploc 20 50 members ensrf damploc and 100 members ensrf damploc 100 the results show that using more ensemble members slightly increases the ensemble spread of parameters states fig 14 the ensemble spreads of parameters are quite similar when the ensemble size is larger than 50 the ensemble spreads of groundwater levels in wells 11 12 and 2 increase by 3 8 and 2 respectively with their rmses decreased by less than 4 when the ensemble size increase from 20 to 100 the error statistics in table 6 further show that the scenario with 100 ensemble members slightly improves the filter performance while the smaller ensemble size of 20 deteriorates the filter performance as seen from a negative ner value compared to results based on the basic scenario in section 4 2 varying ensemble size in scenario ensrf damploc exhibits only slight changes this indicates that introducing localization and damping factor can also help reduce the error associated with the smaller ensemble size 5 conclusions this study demonstrates how to apply the ensrf in a practical case that involves a distributed groundwater flow model coupled with a simplified model of the unsaturated zone to improve model estimation by considering uncertainties in model parameters model inputs and observations we investigated the impact of localization and covariance tuning methods on the performance of the ensrf the covariance tuning methods are realized by either introducing an inflation factor or by introducing a damping factor the performance of the ensrf with respect to different observation errors is also explored a synthetic assimilation experiment is carried out first to estimate the model parameters and states the result shows that the prior ensembles of parameters and states converge to their true known values by assimilating synthetic observations true groundwater heads plus random errors at the same time it is confirmed that the measurement error of 1 m can constrain model parameters and states by assimilating real observations of groundwater levels it has been found that the ensrf reduced the uncertainty in parameters and states and improved the model accuracy with a smaller rmse compared to ensemble runs without assimilation of observations the increase of the ensemble size alleviated the underestimation of error covariance but also increased the computation time accordingly the results from the ensrf with respect to three different ensemble sizes show that the ensemble size of 50 realizations is reasonable and acceptable in our case study it has been observed that after data assimilation the ensemble of parameters converged to a set of values with smallest uncertainty already in the very beginning of the assimilation and the ensemble of groundwater levels fell within the uncertainty bounds of observations thus the parameters can no longer be updated to values better reflecting the real amplitudes of the model outputs in later assimilation steps which means the filter actually does not work any more such spurious estimation is quite common in practice it hinders the ensrf to find better model estimates by further assimilating informative observations when using a wider initial distribution of parameters to estimate the parameters and states slight filter improvement was observed but ensemble members of parameters are still updated to wrong values scenarios with assimilation time steps of larger than 1 month increase the parameter uncertainty but cannot avoid the spurious updates in parameters since observations are assimilated at a larger time step the filter performed worse than in the basic scenario therefore to fix spurious estimations localization and covariance tuning methods have to be used different localization lengths are tested in the study the results show that too small and too large localization lengths are neither preferable in the study the filter performance was improved with the localization length of 6000 m but the improvement is only 7 compared to the basic scenario two alternatives of covariance tuning methods were applied in the ensrf it has been found that scenarios considering either an inflation factor or a damping factor effectively improve the estimation of model parameters and states however for a large inflation factor the model failed to find reasonable parameters while an extremely small damping factor introduced unrealistic uncertainty in model forecasts except for extreme values all other scenarios suggest that a relatively small damping factor or a relatively large inflation factor is preferable with updating the ensemble mean heads fit the observations quite well indicating an improvement in model estimation of parameters and states simultaneously model uncertainty is reduced with time benefiting from assimilating informative observations combining inflation factor damping factor with localization can further improve the filter performance the best filter performance was obtained in the scenario with a damping factor of 0 05 together with a localization length of 6000 m observation error is important in estimating parameters and states during data assimilation varying the value for the observation error has little effect on the filter performance in the case study the results show that the impact of varying the measurement error on the estimation of groundwater levels differs according to locations this suggests that using the same measurement error for all observations may not be appropriate in practice it is difficult to obtain values for the measurement error for each observation well however even with the unrealistic measurement error of 5 m the distributions of parameters continuously narrowed while assimilating observations this means that the uncertainty of parameters can still be reduced even by assimilating observations with large measurement error in conclusion covariance tuning methods together with localization play an important role in improving the estimation of model parameters and states using the ensrf larger measurement error can increase the uncertainty in model parameters and states accordingly the filter performance tends to deteriorate due to less informative observations the scenario with damping factor outperforms the scenario with inflation factor this is because the damping factor not only inflates the error covariance which has the same effect as the inflation factor but also avoids sudden changes of parameters and states in all realizations during assimilation a feature which cannot be achieved by the inflation factor this helps the filter to avoid spurious estimates in parameters and states to a large degree in practical applications keeping the convergence of the filter slow gives the filter a chance of learning more about the variability of observations over time one should theoretically let the filter converge so slowly that all expected variability of heads has been experienced before convergence besides the damping factor method is easy to implement in the ensrf and its application is therefore preferable and recommended synthetic studies of filter behaviour may confirm the functioning of a filter and its program code however they do not allow to draw conclusions for the real field application besides the factors considered in the section of results and discussion some other factors have not yet been considered here these include the uncertainty in model structure different or smaller scale parameter zonations or a pilot point characterization the impact of different input uncertainties observation correction to reduce model bias localization of kalman gain and the impact of different numbers of observations our ongoing work will focus on investigating some of these issues in a real time model credit authorship contribution statement ning li conceptualization methodology software validation writing original draft wolfgang kinzelbach conceptualization writing review editing supervision haitao li software data curation investigation wenpeng li data curation investigation fei chen investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we gratefully acknowledge the financial support of this research by the swiss agency for development and cooperation sdc in the framework of the project rehabilitation and management strategy for over pumped aquifers under a changing climate we extend our gratitude to mr gu junfang and mr liu hongliang from handan department of water resources and mr yao huaixian mr li guangchao and mr yang dongchao from guantao department of water resources for their assistance in data collection supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103813 appendix supplementary materials image application 1 image application 2 
360,data assimilation techniques are widely used in hydrology and water resources management to improve model forecast uncertainty by assimilating observations the big challenge in practical applications is how to describe model uncertainties correctly to avoid the occurrence of spurious covariance during data assimilation in this study the ensemble square root filter ensrf is used to estimate parameters and states of a groundwater model in guantao china which updates ensemble means and perturbations separately and avoids the need to perturb observations the uncertainty in parameters and states decreased with time while assimilating observations however incorrect updates of parameters and states were obtained which could not be corrected by assimilating further observations improving the representation of the hydrological system to compensate for this effect and reduce other sampling errors introduced during assimilation localization and two covariance tuning methods inflation factor and damping factor are explored in the study the results show that alternative scenarios with proper localization length or a large inflation factor or a small damping factor produce better model estimates and improve the filter performance the scenario with a damping factor of 0 05 shows a distinct gain in model predictive capability the damping factor method is superior to the inflation factor method and preferable in real field applications the scenario combining the damping factor with localization further improved the filter performance the performance of the ensrf with respect to different amounts of measurement error is also analysed even though the increase of observation error can increase the error covariance a corresponding filter improvement is not observed as in that case observations are less informative keywords data assimilation ensemble square root filter groundwater model localization inflation factor damping factor 1 introduction hydrological modelling plays a fundamental role in understanding the response of a system such as an aquifer to natural drivers precipitation and river infiltration and anthropogenic impacts irrigation surface water diversion and pumping of groundwater parameter identification is one of the essential task in hydrological modelling the traditional calibration intends to find a combination of parameters one replicate of the parameter set best fitting the observations without accounting for uncertainty in model inputs parameters states and observations inverse modelling therefore the calibrated hydrological model can only describe one realization of possible model behaviour deterministic estimation the reliability of the hydrological model depends primarily on the model uncertainty during the past few decades ensemble based inverse methods are applied to quantify model uncertainty gomez hernandez et al 2003 hendricks franssen et al 2003 zhou et al 2014 normally they are computationally intensive due to the required large ensembles such as the markov chain monte carlo method in contrast the ensemble kalman filter enkf is more computationally feasible with relatively small ensembles more details about stochastic inverse methods in model calibration can be found in zhou et al 2014 the enkf is a typical data assimilation technique which has been developed to not only update model parameters and states incorporating all model uncertainties but also reduce uncertainty in parameters and states by conditioning the model on observation data as they become available in real time the enkf is proposed to compute error statistics by an ensemble algorithm which is viewed as an alternative to solving the exact but computationally demanding error covariance evensen 1994 the enkf is easy in implementation efficient in computation and applicable to nonlinear models this makes it popular in many fields of earth sciences such as climate modelling kang et al 2001 liu et al 2012 land surface modelling ghent et al 2010 zhang et al 2017 soil moisture modelling gruber et al 2015 fairbairn et al 2015 groundwater modelling hendricks franssen et al 2011 rainfall runoff modelling chen et al 2013 and others one use of the enkf in hydrological modelling is to estimate model parameters and reduce parameter uncertainty in an effort to improve the understanding of the hydrological system s behaviour shi et al 2015 applied the enkf in a land surface hydrologic model to diagnose soil parameters another use is to diagnose current model states to provide a better model prediction chen et al 2011 used the enkf to improve predictions of soil moisture and stream flow el gharamti et al 2013 employed the enkf to estimate states in a coupled flow transport model meanwhile the augmented state vector approach to update model parameters together with states has also become common in hydrological modelling xie and zhang 2010 hendricks franssen et al 2011 lü et al 2011 the success of the enkf relies heavily on the quantification of uncertainties in models all uncertainties covered in the enkf are represented by samples of limited size generated from user defined distributions of uncertain input parameters in practice a small ensemble size is preferable for computational reasons however a hydrological model which usually is spatially distributed and has a large number of states and parameters cannot be truly represented by a small ensemble besides the true model error and the error statistics of the input data required for the model can hardly be assessed all these limitations inevitably introduce errors in the calculation of error covariances during data assimilation a spurious error covariance can lead to the deterioration of the filter performance and result in incorrect updates of parameters and states that cannot be corrected by assimilation of further observations covariance localization and inflation are gaining popularity in correcting error covariance localization is used to correct the spurious correlations in the covariance matrix by reducing the impact of observations at large distance hamill et al 2001 hunt et al 2007 zhang et al 2016 covariance inflation tries to achieve a sufficiently large ensemble spread in each update avoiding the underestimation of the error covariance kirchgessner et al 2014 houtekamer and zhang 2016 in this study we tried two alternatives one introduces an inflation factor to adjust error covariances zhang et al 2004 the other one introduces a damping factor in the updating of parameters and states to avoid sudden large variations in parameters and states during assimilation hendricks franssen and kinzelbach 2008 the enkf requires observations to be perturbed with a random error generated from the assumed but unknown distribution of measurement error this introduces an additional sampling error related to the estimation of the error covariance the ensemble square root filter ensrf is proposed to avoid such perturbations in data assimilation whitaker and hamill 2002 the ensrf is a variant of the enkf and updates ensemble means and perturbations separately some studies have already shown that the ensrf can provide better results than the enkf clark et al 2008 li et al 2015 in practical case studies uncertainties related to the hydrological model and observations are often unknown which accordingly leads to a deterioration of the performance of the ensrf adequate investigations of the performance of the ensrf in practical applications are still rare in hydrology and water resources management therefore our goal is to take guantao county as an example to 1 demonstrate the implementation of the ensrf in estimating model parameters and states by assimilating observations and to 2 investigate the improvement of ensrf derived from localization and covariance tuning methods it is obvious that the covariance tuning methods try to adjust the weight between model forecasts and observations when the ensrf gives higher weight to model forecasts than to observations parameters and states have a wider ensemble spread after assimilation indicating a larger uncertainty on the other hand increasing the observation error can also reduce the weights of observations to figure out the impact of less informative observations on the filter performance scenarios with different amounts of observation error have been tested in our study in the following sections we first describe the study area and the data required in the implementation of the ensrf then the hydrological model of guantao is developed it is a groundwater model coupled with a simplified groundwater recharge model abstracted from hydrus 1d simulations after that the ensrf algorithm is introduced including the implementation of localization and covariance tuning methods inflation factor and damping factor furthermore the design and implementation of different scenarios are described finally we discuss the filter performance according to different scenarios and draw some conclusions our intention is to demonstrate the filter improvement in a real case by showing that it improves model prediction and at the same time prevents the model from drifting away from reality eventually model parameters can be corrected by assimilating observations thus providing an improved basis for applications in real time groundwater resources management 2 study area and data guantao county is located in the southern part of hebei province north china plain ncp fig 1 it lies in an alluvial plain with quaternary deposits consisting of fine sand layers interbedded with clay and silt layers the area is quite flat with the topographical elevation decreasing from 45 m above mean sea level a m s l in the southwest to 36 m a m s l in the northeast over a distance of 39 km the county has an area of 456 km2 300 km2 of which are agricultural land mainly used for winter wheat and summer maize production the weiyun river flows along guantao s eastern boundary with heavy runoff in the rainy season between june and september hence the summer crop needs only some supplementary irrigation due to intensive rainfall while for the winter crop full irrigation is required irrigation water is mainly supplied by groundwater from the shallow aquifer over 79 a fraction of 11 is abstracted from the deep aquifer the weixi channel is the main irrigation channel in guantao there are many sub channels distributing surface water for irrigation the intensive groundwater pumping from the shallow aquifer resulted in a groundwater table decline at a rate of 0 6 m a between 1973 and 2005 guantao dwr 2015 to better manage the groundwater resources in the county and to alleviate the groundwater level decline an accurate numerical model is required the data required in the study to develop a hydrological model are available for the period from 2003 to 2012 guantao meteorological bureau provides monthly precipitation data the groundwater pumping data for irrigation are highly dependant on precipitation in the ncp they are obtained from a previous numerical study li et al 2019 the yearly surface water diversions for irrigation have been collected from the water resources bulletin of guantao guantao department of water resources and china geological survey provided data from altogether 44 observation wells with different observation frequencies thirty of these are used in data assimilation fig 1 while the rest is used to define a specified head boundary condition of the numerical model amongst the 30 observation wells there are 4 wells with monthly measurements 10 wells with 2 data records per year and 16 wells with four measurements per year 3 methods 3 1 hydrological model a 2d groundwater flow model is developed using pmwin chiang and kinzelbach 2001 the governing equation of the transient groundwater flow in the shallow aquifer is described in eq 1 the political boundary of guantao is a complicated curvy line black line in fig 1 in the model it is simplified to a trapezoidal boundary along which a specified head boundary condition is used fourteen groundwater head observations close to the boundary are interpolated to define the time varying boundary head values the weiyun river infiltration is implicitly considered in the hydrological model due to the specified head boundary condition the model domain is horizontally discretized into 210 rows and 190 columns with a grid size of 200 m x 200 m vertically there is only one layer corresponding to the shallow aquifer in guantao area the water exchange with the deep confined aquifer is negligible the top elevation is interpolated from srtm data downloaded from the website http srtm csi cgiar org the bottom elevation is interpolated from geological exploration wells the shallow aquifer of guantao is mainly composed of fine sand layers interbedded with less pervious clay or silt lenses the hydraulic conductivity distribution of the model is introduced by zonation four zones from south to north hk1 hk2 hk3 and hk4 are defined based on pumping tests done in 2015 cnacg 2015 they are shown in fig 2 a the specific yield follows the same zonation sy1 sy2 sy3 and sy4 fig 2a the main sources of groundwater recharge in guantao are seepage from precipitation and irrigation backflow which are implemented in the recharge package defined in the software the annual total irrigation amount is the sum of groundwater pumping and surface water diversion which is evenly distributed over the irrigation season march to june and october the groundwater recharge is expressed as a fraction of the sum of precipitation and irrigation water applied at the soil surface the fraction is the so called recharge infiltration ratio which is divided into three zones rr1 rr2 rr3 according to the soil map cnacg 2015 the zonation is shown in fig 2b the weixi channel infiltration is simulated using the river package it is based on the user defined inputs river level bottom width thickness of the riverbed and its hydraulic conductivity the discharge by pumping is implemented in the well package with a spatial distribution proportional to the number of wells per grid cell the model simulation covers 10 years from 2003 to 2012 with a time step of 1 month 1 s y h t k x m h x k y m h y q i n q o u t sy is the specific yield h refers to the groundwater head m t is the time d k is the hydraulic conductivity m d m is the aquifer thickness and is a function of h m qin qout are the source sink terms m d which are defined in the corresponding packages of the pmwin the temporal distribution of recharge from precipitation and irrigation arriving at the water table is obtained from hydrus 1d simunek et al 2008 the details of the hydrus 1d model and results can be found in the literature li et al 2019 the upper boundary is implemented as an atmospheric boundary in the surface layer and the free drainage condition is implemented at the lower boundary the water input at the groundwater surface equals precipitation plus irrigation minus evaporation and evapotranspiration and is determined as the product of the total precipitation and irrigation flux multiplied by a net recharge infiltration ratio the calculated temporal distribution of the groundwater recharge at the groundwater table is the relevant input for the transient groundwater model during implementation of the ensrf hydrus has to be called for each replicate in every time step during the assimilation of observations this takes quite some computation time we therefore simplify the hydrus numerical simulation by deriving a linear functional relation between inputs to and outputs from the hydrus 1d model the details are explained in the supplementary materials section s1 we use manual calibration to minimize the sum of squared errors between observed and computed groundwater head data the rmse from manual calibration is around 1 3 m the results show that the numerical model can roughly capture the dynamics of the groundwater heads but more effort should be put into improving estimates of model parameters and states it is obvious that the manual calibration is not perfect there are still deviations between observed and computed values and the parameters are non unique the ensrf is then introduced to the numerical model to find better estimates of model parameters and states since the numerical model is only a simplification of the real hydrological system and the prior knowledge about model structure model parameters etc is poor the manually calibrated model parameters can be taken as basis values ensemble means to define the parameters prior distributions needed to implement ensrf in the numerical model 3 2 data assimilation 3 2 1 ensemble square root filter the enkf is a sequential data assimilation method based upon monte carle simulation to filter out the best realizations of states and parameters in a dynamic system by assimilating observations thus turning a prior ensemble of realizations into a posterior improved ensemble the ensrf used here is a variant of the enkf which does not require perturbing the observations it updates the parameter state ensemble means and perturbations separately when observations are available the procedure adopted in our study is the same as stated in the literature li et al 2015 the procedure is expressed by the following equations 2 x a x f k y obs y f 3 k p f h t h p f h t r 1 x f y f t y f y f t n 1 r 1 x f y f t c 1 4 x a x f t 5 x a x a x a where the overbar denotes the ensemble mean x is the augmented state vector containing both the ensemble parameters and states groundwater heads superscripts a f represent posterior analysis prior forecast augmented state ensemble n x n n is the number of replicates in the ensemble n is the total number of parameters and states k is the kalman gain y is an ensemble of prior measurement forecasts obtained by running a model using a prior parameter ensemble m x n m is the number of measurements h is an operator projecting the parameter and model states on the observation space here it is the hydrological model yobs is the matrix of model measurements m x n each vector contains the same measurements the apostrophe indicates the ensemble perturbations pf is the forecast error covariance matrix n x n r is the measurement error covariance matrix m x m the ensemble means are updated in the same way as in the enkf while the perturbations are corrected by a transform matrix t the final parameters and states are updated according to eq 5 in the ensrf in traditional enkf the error covariance of parameters states is updated by eq 6 6 p a p f kh p f x f k y f x ft n 1 unlike the traditional enkf the error covariance of augmented states in ensrf is implicitly updated the transform t in eq 4 is derived from the error covariance matrix n x n as follows 7 p a x a x a t n 1 combining eq 3 eq 6 and eq 7 we obtain eq 8 8 x a x a t x f i y f t c 1 y f x f t x f t t t x f t x f t x f t t after applying the eigenvalue decomposition of c we compute c 1 sλ 1st λ is a diagonal matrix s is a square m x m matrix replacing c 1 in eq 8 we have 9 t t t i y f t s λ 1 s t y f i λ 1 2 s t y f t λ 1 2 s t y f i b t b matrix b is a m x n matrix and is computed by the singular value decomposition b uς 1vt u σ and v are matrices of dimension m x m m x n and n x n respectively after replacing b by decomposition matrices in eq 9 the equation is written as follows 10 t t t i u σ 1 v t t u σ 1 v t i v σ t σ v t v i σ t σ v t v i σ t σ η t v i σ t σ η t t where η is a random orthogonal n x n matrix therefore 11 t v i σ t σ η t in our study we let η be equal to v thus t is symmetric and consequently the ensrf is unbiased livings et al 2008 3 2 2 localization localization is used to improve the accuracy of the estimated forecast error covariance by suppressing the impact of observations outside of a predefined distance or correlation length on the analysis of a state the main component of covariance localization is to find a suitable correlation function with local support the most popular function used in the kalman filter family is a fifth order polynomial proposed by gaspari and cohn 1999 because of its superior assimilation performance kirchgessner et al 2014 currently this function is the standard implemented in covariance localization however it is not obvious to apply this correlation function to the error covariance matrix of a square root filter dance et al 2009 some studies have shown that doing so is inappropriate in the ensrf petrie 2008 petrie and dance 2010 therefore in this study an explicit local analysis domain localization is adopted considering only the observations close to the location grid point of the analysis during the assimilation process evensen 2003 ott et al 2004 hunt et al 2007 fig 3 demonstrates how the localization is implemented the analysis of a state is computed grid point by grid point for any analysis grid point state e g pink colour in fig 3a a sub region with a predefined distance l to the analysis grid point is defined first then only the observations located in this sub region 2 observations instead of 5 observations in fig 3a are used in the analysis l is the distance between the centre point of the analysis grid and the observation point the parameters used in this study are characterized by zonation including many grids with the same value fig 3b zonal parameterization is used in hydrological modelling to reduce the degrees of freedom of a model to a number compatible with available observation points the sub regions for the parameter analysis are defined accordingly make them larger than the parameter zone itself by a minimum distance l between the enlarged border and the parameter zone border fig 3b shows the example of 4 observations used in the parameter analysis l corresponds to the radius of the circle used in the cast of state localization 3 2 3 covariance tuning methods 3 2 3 1 inflation factor the inflation factor aims to inflate the error covariance to achieve a better filter performance here we use the method of relaxing the perturbations after analysis and updating of the ensemble mean back to the prior perturbations using the following equation zhang et al 2004 12 x a 1 β x a β x f 0 β 1 where β is an inflation factor β equal to 1 means that the posterior perturbations are identical to the prior perturbations while β equal to zero indicates that no covariance inflation is considered miyoshi 2005 showed that the filter is more stable and produces better results with a larger covariance inflation factor in this study different values of β are tested 3 2 2 2 damping factor the damping factor is introduced to reduce the update magnitude of parameters states and thereby reduce the spurious covariance due to abrupt changes of parameters during the assimilation process furthermore the damping factor also makes the perturbations smoother and produces a sufficiently large ensemble spread achieving the same goal as the inflation factor introduced in the previous section damping of forecast updates has been studied by hendricks franssen and kinzelbach 2008 and rasmussen et al 2015 and 2016 it is achieved using the following equation 13 x a x f γ k y obs p y f 0 γ 1 where yobs p are the perturbed observations γ is a damping factor γ 1 means that there is no damping effect γ 0 indicates an open loop run without assimilating observations since parameter state means and perturbations are updated separately in the square root filter the damping factor in the ensrf is introduced for both ensemble means and perturbations by the following equations 14 x a x f γ k y obs y f 0 γ 1 15 x a γ x a 1 γ x f 0 γ 1 it is clear that eq 14 and eq 15 produce the same effect as eq 13 a damping factor of zero means that the posterior parameters states are equal to their prior while a damping factor 1 indicates no damping influence during the assimilation process to improve the parameter and state estimation several values of the damping factor are tried out 3 3 model uncertainty to successfully implement ensrf in the hydrological model it is required to quantify model uncertainty which usually originates from model structure model parameters driving forces and measurements in our study the uncertainty in model structure is not explicitly quantified it is implicitly considered in the measurement errors the uncertainty in model structure is revealed by differences between observations and the corresponding model outputs a head measurement for example may be influenced by the screening of the observation well while the 2d model uses average heads over depth the discrepancy does not invalidate the model the increase of the measurement error tends to insure that observations generally lie within the respective forecast ensemble in other words larger measurement error gives higher weight to model forecasts accordingly the forecasts uncertainty is less influenced by observations which can be viewed as a compensation for not considering the uncertainty of model structure it should be kept in mind that increasing measurement error is not a complete alternative to representing the structural model error in an adequate model parameterization it is only usful when the deviations between modelled and measured results are not excessive the measurement error cannot be increased to unrealistic values as all true information will be lost the details about the influence of measurement error are discussed in section 4 7 3 3 1 parameters and states to execute the ensrf a number of statistical parameters states are required according to a sensitivity analysis the model parameters which have to be updated include 4 hydraulic conductivities hk1 hk2 hk3 and hk4 4 specific yield values sy1 sy2 sy3 and sy4 and 2 recharge infiltration ratios rr1 and rr2 the parameters are updated between 2003 and 2012 together with the groundwater heads by using an augmented state vector approach liu and gupta 2007 hendricks franssen and kinzelbach 2008 estimating parameters and states together is more likely to introduce errors in error covariance estimation during the assimilation process than in the case of only updating states due to the nonlinear relationship between groundwater heads and hydraulic conductivity the manually calibrated parameter values of the deterministic model are taken as the mean values of the parameter distributions base values in table 1 to generate prior ensemble of parameters the model parameters are assumed to follow log normal distributions with a standard deviation of 0 5 table 1 this value is determined by communications with local experts later scenarios with larger standard deviations for parameters are discussed fifty initial realizations of parameter sets are generated using latin hypercube sampling minasny 2004 the influence of the ensemble size on the filter performance is discussed later the ensemble of initial groundwater heads is generated as follows 16 h ih i j h ih i j o θ ih i j where hih i j and h ih i j o are the perturbed and original initial groundwater head in model cell i j respectively and θih i j is the initial groundwater head error generated from a normal distribution with zero mean and a standard deviation of 1 m 3 3 2 errors from driving forces and observations amongst the input data to the hydrological model of guantao precipitation is the most important source of groundwater recharge the groundwater recharge from precipitation is calculated by multiplying precipitation by the recharge infiltration ratio rr which is updated during the data assimilation process hence the precipitation uncertainty in the ensemble is already considered via the uncertainty of rr the pumping rate time series is uncertain and is assumed to have a normal error distribution as defined in eq 17 θ is a random number generated from a normal distribution with zero mean and a standard deviation of 0 2 17 q pump t q pump t o 1 θ where qpump t is the perturbed pumping rate at time t the superscript o represents the base value without considering errors the uncertainty of specified groundwater heads on the boundary is implemented by adding an error that is normally distributed eq 18 18 h b i j h b i j o θ b i j where hb i j is the groundwater head on the boundary cell i j and θb i j is the error for this head generated from a normal distribution with zero mean and a standard deviation of 1 m the measurement error for groundwater head observations has a strong impact on the posterior distribution of model parameters and states as mentioned in the beginning of this section the measurement error in our study incorporates all other remaining uncertainties that have not been quantified previously such as the uncertainty in the model structure therefore a measurement error of 1 m is set for all observation wells fig 1 which is higher than the true measurement error of about 0 5 m mainly due to the levelling error local communication the value will be tested in a synthetic study in section 4 1 the influence of measurement error on the filter performance will be discussed in section 4 7 3 4 scenario design to demonstrate the filter performance of the ensrf in a hydrological model and its improvements against the standard variant by means of localization and covariance tuning methods several scenarios are implemented in this study synthetic scenario ensrf syn synthetic experiments test the ability of the ensrf in improving estimation of model parameters and states when the true hydrological system is known a true numerical model consists of known model structure boundary conditions model parameters and model inputs the true model is similar to the hydrological model developed in section 3 1 but with one set of parameters randomly generated from the prior distribution of parameters listed in table 1 no perturbations are added in the model inputs the synthetic head observations are generated from the forward run of the model adding random errors which follow a normal distribution with zero mean and a standard deviation of 1 m after that a synthetic filter model ensrf syn is applied based on the true model considering all uncertainties mentioned in section 3 3 with the measurement error of 1 m fifty replicates of parameters and states are updated monthly for the period from january 2003 to december 2012 the true values of model parameters and states are to be detected during the filter implementation basic scenario ensrf now the real observations instead of synthetic observations are assimilated to update model parameters and states the model inputs are perturbed in the same way as stated in the synthetic scenario fifty replicates of parameters and states are updated monthly for the period from january 2003 to december 2012 the assimilation of real observations leads to a more realistic evaluation of filter performance than the synthetic case first an open loop run is carried out considering only parameter uncertainties it consists of an ensemble of model forward runs without assimilating observations then the ensrf is implemented on the ensemble of models by considering input perturbations and assimilating real observations comparison of the results from the open loop runs and the ensrf demonstrates the filter effect with regard to improving model parameters and states estimation unlike in the synthetic case the model parameters and states are unknown in the practical application incorrect ensemble updates are more likely to occur in the basic scenario to reduce the sampling error and find a suitable ensemble size to capture reality different ensemble sizes were used in the basic scenario to explore the impact of the ensemble size on the filter performance scenarios with different realizations of initial ensembles ensrf largp in these scenarios the initial parameter ensembles cover a larger range with a larger standard deviation than used in the basic scenario the model inputs are perturbed in the same way as stated in the basic scenario fifty replicates of parameters and states are updated monthly over 10 years the results will examine the effect of the initial parameter ensembles on the filter performance scenarios with different assimilation frequencies ensrf fre these scenarios are based on the basic scenario and update parameters and states by assimilating groundwater head observations at different frequencies or assimilation time steps respectively this allows observing the influence of different observation frequencies on the filter performance fifty replicates of parameters and states are updated at the predefined assimilation time steps localization scenarios ensrf loc these scenarios apply the localization to the basic scenario different localization lengths are used to demonstrate the effect of localization on the filter performance fifty replicates of parameters and states are updated monthly over 10 years covariance tuning scenarios ensrf inf and ensrf damp covariance tuning methods are used to correct spurious model updates and forecasts of the error covariance these scenarios are based on the basic scenario introducing either an inflation factor or a damping factor fifty replicates of parameters and states are updated monthly over 10 years ensrf inf illustrates the effect of different inflation factors on updating model parameters and states ensrf damp demonstrates the influence of different damping factors on the filter performance scenarios with different observation errors ensrf obs these scenarios are based on the basic scenario and incorporate different amounts of measurement error uncertainty in model parameters and perturbations in model inputs are the same as stated in the basic scenario the ensemble size is fifty and all scenarios assimilate observations monthly over 10 years scenarios with different ensemble sizes these scenarios are based on the selected best scenario considering both localization and covariance tuning fifty replicates of parameters and states are updated monthly over the 10 year period different ensemble sizes were used to explore the impact of the ensemble size on the filter performance 3 5 performance evaluation to evaluate the performance of the ensrf several indicators are adopted in this study besides the means and standard deviations spread of variable ensembles root mean square error rmse the rmse is calculated based on the ensemble mean of the groundwater heads at the observed locations and the corresponding real observations in each time step 19 rmse t 1 t i 1 no h o t hc t i 2 no t where hot is the groundwater observation at time t hc t i is the ensemble mean of the calculated groundwater heads at observation point i at time t no is the number of observations t is the total number of time steps normalized root mean square error ratio nrr this ratio aims to evaluate the confidence of the ensemble mean moradkhani et al 2006 moradkhani and meskele 2010 lei et al 2014 and is defined as follows 20 nrr 2 n n 1 rmse mrmse where n is the ensemble size rmse is the time averaged rmse of the ensemble mean defined in eq 19 mrmse is the mean rmse of the ensemble replicates defined in eq 21 where hct i j is the calculated groundwater head of replicate j at observation point i at time t an nrr of 1 is desirable nrr larger than 1 indicates that the ensemble spread is too narrow while nrr smaller than 1 means a too wide ensemble spread 21 mrmse 1 n j 1 n t 1 t i 1 no h o t i h c t i j 2 no t normalized error reduction index ner ner is an index to measure the magnitude of the improvement of scenario a over scenario b this index has been used by chen et al 2011 lei et al 2014 ner varies between negative infinity and 1 a positive ner means an improvement of scenario a over scenario b with value 1 representing the greatest improvement a value of zero means that there is no improvement and a negative ner signifies a deterioration in the performance of scenario a compared to scenario b 22 ner 1 rms e a rms e b 4 results and discussion 4 1 synthetic scenario ensrf syn after assimilating data under conditions described in the synthetic scenario the posterior distribution of parameters and states are shown in fig 4 it is apparent that the parameters ensemble means deviate from their true vales at the beginning of the assimilation after 40 time steps of data assimilation the parameter ensembles converge to the true values with very small uncertainty in the parameter distributions the parameter spreads decrease with increasing number of assimilation time steps which indicates that the uncertainty of parameters can be significantly reduced by incorporating more and more observations the distribution of parameter rr2 narrows faster than those of the other parameters indicating that the parameter rr2 is more sensitive to observations the posterior ensembles of the groundwater level in three chosen observation wells are shown in fig 4 the well numbers are those given in fig 1 the ensemble mean fits the true values quite well suggesting that the true model states are captured in the process of data assimilation by incorporating the synthetic observations the distribution of the updated groundwater level narrows with time the uncertainty in groundwater level decreases with a growing number of assimilation time steps reflecting the benefits of assimilating observations the standard deviations of updated groundwater levels in wells 11 12 and 2 fig 4d to fig 4f are reduced to 0 13 m 0 11 m and 0 08 m respectively at the last time step similar results can be observed in other observation wells the ensrf is capable of capturing true model parameters and states and reducing their uncertainty this further proves that the measurement error of 1 m is capable of constraining model parameters and states 4 2 basic scenario ensrf the objective of data assimilation is to find the best possible estimates of model parameters states and improve the model accuracy in order to assess the performance of the data assimilation open loop ensemble simulations are carried out as a reference only parameter uncertainty is considered in the open loop simulations the time series of the respective rmses and ensemble spreads of the groundwater level are shown in fig 5 it is clear that data assimilation reduces not only the rmse of the groundwater levels but also their uncertainty the average rmse of the groundwater level over the whole period is around 1 9 m in the open loop while with data assimilation the value is reduced to 1 1 m the ensemble spread of the groundwater level with data assimilation is much smaller than that in the open loop simulations fig 5 right the nrr value of 0 5 in the ensrf compares to a value of only 0 1 in the open loop indicating a relatively wider groundwater level ensemble spread in the open loop simulations the groundwater level is a function of model parameters whose uncertainty is converted to the uncertainty in groundwater levels in each time step this uncertainty is continuously carried over to the simulation of groundwater levels in the next time step therefore the uncertainty in groundwater levels is cumulated with each time step and shows a gradually increasing trend when assimilating observations the uncertainty in the groundwater level is considerably reduced fig 6 shows ensembles of parameters and groundwater levels changing with time after assimilation at each time step the parameter ensemble spread decreases by 80 of its initial value which implies that uncertainty in all parameters is considerably reduced due to assimilating observations at the same time all parameter replicates are supposed to have converged to or be closer to their true values which are not known in this real case the posterior replicates of groundwater levels in three chosen observation wells are demonstrated in fig 6d to fig 6f the filter performance improves from north to south with the rmses in wells 11 12 and 2 of 1 6 m 1 1 m and 0 5 m respectively the replicates of groundwater levels deviate from observations and the spreads are much smaller indicating an incorrect estimation of groundwater levels after assimilation fig 6d shows that the observations are outside of the ensemble range already at the beginning of the simulation while the forecast members at the first time step still contain the observation value the small plot on the top of fig 6d this confirms that the filter degeneration starts right from the beginning it is noted that the ensemble replicates can capture the dynamics of groundwater level but the variations are much smaller than those seen in the observation wells especially in wells 11 and 12 this could be caused by the fact that the ensemble of parameters narrows very fast after a few assimilation steps and converges to spurious values which can no longer be improved by assimilating observations fig 6b convergence is reached on the basis of a short history and an adaptation to longer term variability is no longer possible this phenomenon is frequently observed in practical applications where the true parameters and true errors in model inputs structure and observations are unknown in the synthetic scenario defined in section 4 1 on the other hand all observations contain systematically the true information which lead the filter to find the true parameter values even within a small number of time steps the ensrf uses an ensemble of parameters and states to approximate their true distributions increasing ensemble size not only enables the ensrf to produce error estimates more accurately but also makes the data assimilation computationally expensive in practice it is important to choose an appropriate ensemble size to limit the computation time another two scenarios with ensemble sizes of 20 and 100 are explored ensrf 20 and ensrf 100 the results are shown in fig 7 including the basic scenario ensrf with the ensemble size of 50 ensrf 50 for a smaller ensemble size of 20 the model parameters have smaller variance with the increase of ensemble size the parameters spreads become broader except for parameter rr2 which is not sensitive to the ensemble size fig 7d while an increase of the ensemble size from 50 to 100 slightly improves the parameter variance the computation time increases from about 9 h to around 18 h on one thread of a computer with cpu 3 6 ghz slight improvements in groundwater level are observed in wells 11 12 and 2 with the rmses decreasing by 1 3 and 5 respectively when increasing the ensemble size from 20 to 100 the ensemble spreads of groundwater levels in wells 11 12 and 2 increase by 1 10 and 14 respectively considering both the filter performance and computation cost the ensemble size of 50 is sufficient in our study increasing the ensemble size can reduce the underestimation of uncertainty in parameters and states however the ensrf in our study cannot be considerably improved by increasing the ensemble size only 4 3 influence of initial parameter ensemble theoretically the initial parameter distributions should be as wide as possible to include all possible parameter values in practice the initial parameter ensembles are generated according to means and variances based on prior knowledge this kind of initial parameter ensemble is often subjective especially if experimental data are scarce in order to examine the effect of the initial parameter ensembles on the filter performance a larger variance is taken into account in the scenarios compared to the basic scenario the standard deviation of parameters listed in table 1 change from 0 5 to 1 ensrf largp1 and 1 5 ensrf largp2 respectively the results show that with a wider initial parameter distribution the parameter spread drops dramatically in the first 20 assimilation steps most parameters have similar trends as in fig 8 a but the ensemble members of sy3 are still updated to unacceptable values with larger coverage of the initial ensemble fig 8b the evolution of groundwater levels in fig 8c shows that at the beginning of the assimilation the scenario ensrf largp2 has a larger ensemble spread than the other two scenarios at the end of the assimilation time all scenarios have a similar distribution in groundwater levels this is also signalled by the error statistics listed in table 2 the model accuracy and filter performance improve only slightly by applying larger initial distributions in parameters therefore the initial parameters replicates used in the study are sufficient to include the true parameter characteristics larger variation of initial ensemble cannot prevent updating of ensemble members to wrong values 4 4 influence of different assimilation frequency data assimilation is a sequential updating process following the observation frequency observations with higher frequency result in more assimilation time steps to explore the impact of the number of assimilation time steps observation frequency on the filter performance different intervals between two assimilation steps are tested including 1 month ensrf 3 months ensrf fre 3 m and 6 months ensrf fre 6 m the parameter ensemble distribution narrows for all scenarios with increasing number of assimilation time steps which demonstrates that parameter uncertainty is reduced when longer time series of data are involved fig 9 a the parameters assimilated in scenario ensrf fre 6 m have the largest uncertainty as in this case less observation information is assimilated in the beginning the parameter ensemble members haver larger uncertainty and stay closer to their initial values compared to the basic scenario which results in the updated ensemble of groundwater levels covering initial observation values in scenarios ensrf fre 3 m and ensrf fre 6 m fig 9b with the ongoing assimilation process the parameters are gradually updated to similar values spurious updates still exist localization and covariance tuning methods are necessary to avoid spurious parameter estimation the rmses of groundwater levels are slightly increased by 6 in both scenarios ensrf fre 3 m and ensrf fre 6 m the negative value of ner 0 06 in both scenarios indicates that the filter performed worse when considering lower frequency observations therefore the higher frequency observations are preferable in data assimilation to improve model accuracy and filter performance 4 5 improvement by using localization localization improves estimates of parameters and states by correcting spurious correlations in the covariance matrix scenarios considering different localization lengths are explored in the study localization lengths of 600 m ensrf loc1 1800 m ensrf loc2 6000 m ensrf loc3 and 12 000 m ensrf loc4 are explored the uncertainties in updated parameters and states are shown in fig 10 smaller localization length tends to produce a larger ensemble spread in parameters states and inflates their uncertainty fig 10a to fig 10c when the localization length reaches 12 000 m there is hardly any inflation observed in the parameter uncertainty compared to the basic scenario fig 10a this indicates that a localization length less than 12 000 m is preferable in this study with the increase of the localization length from 600 m to 12 000 m the ensemble spread of the groundwater levels in well 11 at the end of assimilation period increases from 0 17 m ensrf to 0 2 m both ensrf loc1 and ensrf loc2 0 22 m ensrf loc3 and 0 21 ensrf loc4 the rmse of groundwater levels in wells 11decreases from 1 6 m in scenario ensrf to the lowest value of 1 45 m in scenario ensrf loc3 while for wells 12 and 2 the smallest error is observed in ensrf loc4 and ensrf loc3 with the rmse improved by 11 and 8 respectively considering all observations the scenario ensrf loc3 produces slightly better results where the rmse is reduced to 1 02 m from 1 1 m in the basic scenario fig 10d localization is said to remove spurious correlations hamill et al 2001 petrie 2008 a relatively smaller localization length tends to inflate parameter state uncertainty and to reduce the rmse but in this study the results show only a slight improvement in filter performance the negative value of ner indicates a deterioration in filter performance compared to the basic scenario this indicates that it is not advisable to apply a shorter localization length in this study the scenario with a localization length of 6000 m ensrf loc3 generates the best results compared to the basic scenario ensrf with an improvement of 7 showing in the ner value in table 3 4 6 effect of covariance tuning 4 6 1 improvement by introducing an inflation factor in this section we focus on the impact of the inflation factor on filter performance fig 11 shows the evolution of uncertainty of parameters states and the improvement of the rmse in different scenarios that adopt inflation factors of 0 8 ensrf inf 0 8 0 7 ensrf inf 0 7 and 0 5 ensrf inf 0 5 it is clear that a large inflation factor increases the uncertainty in posterior parameters fig 11a and fig 11b this is because a large inflation factor results in lowering weights on observations while increasing weights on model forecasts during assimilation a similar trend can be observed in the distribution of the posterior groundwater level fig 11c the parameter tends to overshoot with updates to larger values followed by updates to smaller values fig 11b the inflation factor increases the variance in groundwater levels and helps the filter to find better posterior groundwater levels the ensemble spread of the groundwater level in well 11 decreases from 1 0 m in the first step to 0 2 m in the last time step benefiting from assimilating observations with time scenario ensrf inf 0 8 the rmse values of groundwater levels in wells 11 12 and 2 decrease from 1 6 m 1 1 m and 0 5 m in scenario ensrf to 1 6 m 0 9 m and 0 4 m respectively in scenario ensrf inf 0 8 even though the groundwater level in scenario ensrf inf 0 8 tends to fit the lower values of observations the higher groundwater level peaks are still strongly underestimated therefore the rmse of groundwater levels in well 11 is hardly reduced fig 11c compared to the basic scenario all scenarios lead to a slight reduction in the rmse of groundwater levels in all observed wells which indicates that the inflation method improves both filter performance and model accuracy fig 11d the error statistics related to scenarios considering different inflation factors are listed in table 4 the rmses of scenarios ensrf inf 0 8 ensrf inf 0 7 and ensrf inf 0 5 are reduced by 9 6 and 4 5 compared to the rmse in scenario ensrf from the ensemble distribution point of view nrr values for all scenarios are smaller than 1 indicating a wider spread in the groundwater level distribution compared to the ensrf the decreased value of nrr in scenarios with increased inflation factor implies an increased uncertainty in groundwater level the ner values in table 4 indicate the quantity of improvement relative to the ensrf they are all positive indicating an improvement in data assimilation due to inflation the scenario ensrf inf 0 8 provides the best filter performance and has a ner value of 0 09 indicating that the filter performance improved by 9 by introducing an inflation factor of 0 8 however this scenario updates the parameter ensembles sy4 to values larger than 0 5 which is unrealistic in this case study therefore the inflation factor of 0 7 is the better choice in the study from the analysis above it is clear that introducing the proper localization length and inflation factor separately can both reduce the rmse and improve the filter performance but the improvement is limited here another scenario is explored applying the inflation factor of 0 7 in combination with a localization length of 6000 m ensrf infloc the ensemble spread of groundwater level in well 11 at the last time step is increased to 0 4 m from 0 2 m in scenario ensrf inf 0 7 while the rmse of groundwater level in well 11 is reduced to 1 5 m from 1 6 m in ensrf inf 0 7 the smaller number of nrr indicates a relatively larger uncertainty in model output compared to the scenario ensrf inf 0 7 the scenario ensrf infloc improved the filter performance and improved the model accuracy by 13 the best filter performance of the ensrf is achieved when localization length and inflation factor are applied in combination in this study similar results can be found in other studies hamill et al 2001 whitaker and hamill 2012 kirchgessner et al 2014 houtekamer and zhang 2016 applying the proper localization length and inflation factor together is recommended for improving model results the optimal values of localization length and inflation factor have to be adapted in every individual study 4 6 2 improvement by introducing a damping factor different scenarios with a damping factor of 0 5 ensrf damp 0 5 0 3 ensrf damp 0 3 0 1 ensrf damp 0 1 0 05 ensrf damp 0 05 and 0 01 ensrf damp 0 01 are explored in this section together with the basic scenario ensrf which corresponds to a damping factor of one there are six scenarios for comparison the effect of the damping factor becomes clear when studying the time series of ensemble spreads and the rmse of groundwater levels fig 12 the parameter uncertainty is clearly reduced over time during assimilation of observations in all scenarios if the damping factor is not used the ensemble spreads of parameters and states are the smallest ensrf fig 12a to fig 12c with the introduction of the damping factor the uncertainty of parameters states increases which results in an improvement in the rmse of the groundwater level fig 12d the ensemble spread of the groundwater level in well 11 increases from 0 17 m ensrf to 0 22 m ensrf damp 0 5 0 33 m ensrf damp 0 3 0 6 m ensrf damp 0 1 1 m ensrf damp 0 05 and 3 5 m ensrf damp 0 01 respectively at the last time step benefiting from the decrease of the damping factor the rmse of groundwater levels in well 11 decreases from 1 6 m in scenario ensrf to 1 4 m in scenario ensrf damp 0 5 1 15 m in scenario ensrf damp 0 1 1 09 m in scenario ensrf damp 0 05 and 1 06 m in scenario ensrf damp 0 01 even though the scenario with the smallest damping factor 0 01 produces the smallest error the uncertainty increases dramatically except for this extremely small value the other scenarios show that decreasing the damping factor improves filter performance this is due to the fact that a smaller damping factor in eq 14 and eq 15 increases the perturbed amplitudes of posterior parameters and states considerably which can then be updated to values better describing the hydrological model it should be kept in mind that an extremely small damping factor can lead to unrealistically large uncertainty in model forecasts table 5 lists the error statistics related to scenarios with different damping factors as expected the overall rmse of groundwater level decreases with decreasing damping factor the scenario with damping factor of 0 01 has the lowest rmse according to the value of ner the scenario ensrf damp 0 01 improves the filter performance by 54 compared to the ensrf the damping factor of 0 01 means that only 1 of the maximum update is used in each assimilation this increases the perturbations of posterior parameters and states and inflates the error covariance the smallest value of nrr 0 06 corresponds to the largest ensemble spread in groundwater level standard deviation of 3 5 m which is unrealistic as it is much larger than the groundwater level dynamics standard deviation of 2 m overall the scenario with damping factor 0 05 produces the best results with a relatively smaller rmse and larger uncertainty compared to the basic scenario relatively small damping factors have also shown to be preferable in other studies hendricks franssen and kinzelbach 2008 rasmussen et al 2015 finally the scenario combining the localization length of 6000 m with the damping factor of 0 05 is discussed ensrf damploc the results show that the parameter uncertainty is slightly increased compared to the results of the ensrf damp 0 05 fig 12a and fig 12b while the ensemble spread of the groundwater level in well 11 at the last time step is decreased by 10 of the value in ensrf damp 0 05 fig 12c the smaller value of nrr 0 16 indicates a relatively larger uncertainty in overall groundwater level overall the filter performs better in scenario ensrf damploc than in ensrf damp 0 05 with lower rmse and higher improvement table 5 introducing localization together with a damping factor is recommended for the improvement of filter performance 4 7 influence of measurement error in the previous analysis the measurement error is predefined and chosen as 1 m standard deviation however it is difficult to obtain a true observation error in the real application due to the unknown sources of uncertainty moreover the measurement error plays an important role in updating parameters and states in the ensrf which tries to balance the weights between model forecasts and observations during assimilation different measurement errors are tested in the study with standard deviations of 0 5 m ensrf obs 0 5 2 m ensrf obs 2 and 5 m ensrf obs 5 respectively as expected the ensemble spreads of parameters and states become wider with the increase of the measurement error because a large measurement error makes the filter give higher weight to model forecasts and lower weight to observations fig 13 a the overall rmses of groundwater level are 1 11 m in ensrf obs 0 5 1 12 m in ensrf 1 11 m in ensrf obs 2 and 1 14 m in ensrf obs 5 respectively the overall rmse of groundwater levels tends to increase slightly with the increase of the measurement error a change in observation error has different impact at individual locations the taylor diagrams in fig 13c to fig 13e summarize the performance of the ensemble mean in different scenarios compared to the observation data taylor 2001 the taylor diagrams are generated by using the function coded by maze 2020 the letter obs refers to observations the dark blue green and red dots represent the results from scenarios ensrf ensrf obs 0 5 ensrf obs 2 and ensrf obs 5 respectively in the previous discussion the standard deviation is referred to as ensemble spread in the taylor diagrams the standard deviation refers to the standard deviation of the ensemble means of groundwater levels in each well for well 11 the filter with measurement error of 5 m improves performance while ensrf obs 2 and ensrf obs 1 produce better results for well 13 and well 2 respectively this may implicitly suggest that different measurement errors should be used for different observation wells in applications the ensemble spreads of parameters are still reduced with time in the scenario ensrf obs 5 indicating that observations even with a large error still play a role in reducing uncertainty in model parameters during the assimilation process in this study the measurement error of 5 m is unrealistic because it is much larger than the groundwater level dynamics it should be noted that the covariance tuning methods described in the previous section also try to improve the filter performance by inflating error covariance which means giving less weight to the observations during assimilation increasing the measurement error indeed increases the uncertainty in model parameters and states however the filter improvement is not comparable to scenarios considering covariance tuning methods this is because less informative observations are assimilated in scenarios considering larger measurement errors while the information in observations is slowly but completely assimilated in scenarios considering covariance tuning 4 8 influence of ensemble size after selecting the proper localization length and the damping factor ensrf damploc several scenarios are implemented to explore the filter performance under varying ensemble size like in the basic scenario we choose the ensemble size of 20 members ensrf damploc 20 50 members ensrf damploc and 100 members ensrf damploc 100 the results show that using more ensemble members slightly increases the ensemble spread of parameters states fig 14 the ensemble spreads of parameters are quite similar when the ensemble size is larger than 50 the ensemble spreads of groundwater levels in wells 11 12 and 2 increase by 3 8 and 2 respectively with their rmses decreased by less than 4 when the ensemble size increase from 20 to 100 the error statistics in table 6 further show that the scenario with 100 ensemble members slightly improves the filter performance while the smaller ensemble size of 20 deteriorates the filter performance as seen from a negative ner value compared to results based on the basic scenario in section 4 2 varying ensemble size in scenario ensrf damploc exhibits only slight changes this indicates that introducing localization and damping factor can also help reduce the error associated with the smaller ensemble size 5 conclusions this study demonstrates how to apply the ensrf in a practical case that involves a distributed groundwater flow model coupled with a simplified model of the unsaturated zone to improve model estimation by considering uncertainties in model parameters model inputs and observations we investigated the impact of localization and covariance tuning methods on the performance of the ensrf the covariance tuning methods are realized by either introducing an inflation factor or by introducing a damping factor the performance of the ensrf with respect to different observation errors is also explored a synthetic assimilation experiment is carried out first to estimate the model parameters and states the result shows that the prior ensembles of parameters and states converge to their true known values by assimilating synthetic observations true groundwater heads plus random errors at the same time it is confirmed that the measurement error of 1 m can constrain model parameters and states by assimilating real observations of groundwater levels it has been found that the ensrf reduced the uncertainty in parameters and states and improved the model accuracy with a smaller rmse compared to ensemble runs without assimilation of observations the increase of the ensemble size alleviated the underestimation of error covariance but also increased the computation time accordingly the results from the ensrf with respect to three different ensemble sizes show that the ensemble size of 50 realizations is reasonable and acceptable in our case study it has been observed that after data assimilation the ensemble of parameters converged to a set of values with smallest uncertainty already in the very beginning of the assimilation and the ensemble of groundwater levels fell within the uncertainty bounds of observations thus the parameters can no longer be updated to values better reflecting the real amplitudes of the model outputs in later assimilation steps which means the filter actually does not work any more such spurious estimation is quite common in practice it hinders the ensrf to find better model estimates by further assimilating informative observations when using a wider initial distribution of parameters to estimate the parameters and states slight filter improvement was observed but ensemble members of parameters are still updated to wrong values scenarios with assimilation time steps of larger than 1 month increase the parameter uncertainty but cannot avoid the spurious updates in parameters since observations are assimilated at a larger time step the filter performed worse than in the basic scenario therefore to fix spurious estimations localization and covariance tuning methods have to be used different localization lengths are tested in the study the results show that too small and too large localization lengths are neither preferable in the study the filter performance was improved with the localization length of 6000 m but the improvement is only 7 compared to the basic scenario two alternatives of covariance tuning methods were applied in the ensrf it has been found that scenarios considering either an inflation factor or a damping factor effectively improve the estimation of model parameters and states however for a large inflation factor the model failed to find reasonable parameters while an extremely small damping factor introduced unrealistic uncertainty in model forecasts except for extreme values all other scenarios suggest that a relatively small damping factor or a relatively large inflation factor is preferable with updating the ensemble mean heads fit the observations quite well indicating an improvement in model estimation of parameters and states simultaneously model uncertainty is reduced with time benefiting from assimilating informative observations combining inflation factor damping factor with localization can further improve the filter performance the best filter performance was obtained in the scenario with a damping factor of 0 05 together with a localization length of 6000 m observation error is important in estimating parameters and states during data assimilation varying the value for the observation error has little effect on the filter performance in the case study the results show that the impact of varying the measurement error on the estimation of groundwater levels differs according to locations this suggests that using the same measurement error for all observations may not be appropriate in practice it is difficult to obtain values for the measurement error for each observation well however even with the unrealistic measurement error of 5 m the distributions of parameters continuously narrowed while assimilating observations this means that the uncertainty of parameters can still be reduced even by assimilating observations with large measurement error in conclusion covariance tuning methods together with localization play an important role in improving the estimation of model parameters and states using the ensrf larger measurement error can increase the uncertainty in model parameters and states accordingly the filter performance tends to deteriorate due to less informative observations the scenario with damping factor outperforms the scenario with inflation factor this is because the damping factor not only inflates the error covariance which has the same effect as the inflation factor but also avoids sudden changes of parameters and states in all realizations during assimilation a feature which cannot be achieved by the inflation factor this helps the filter to avoid spurious estimates in parameters and states to a large degree in practical applications keeping the convergence of the filter slow gives the filter a chance of learning more about the variability of observations over time one should theoretically let the filter converge so slowly that all expected variability of heads has been experienced before convergence besides the damping factor method is easy to implement in the ensrf and its application is therefore preferable and recommended synthetic studies of filter behaviour may confirm the functioning of a filter and its program code however they do not allow to draw conclusions for the real field application besides the factors considered in the section of results and discussion some other factors have not yet been considered here these include the uncertainty in model structure different or smaller scale parameter zonations or a pilot point characterization the impact of different input uncertainties observation correction to reduce model bias localization of kalman gain and the impact of different numbers of observations our ongoing work will focus on investigating some of these issues in a real time model credit authorship contribution statement ning li conceptualization methodology software validation writing original draft wolfgang kinzelbach conceptualization writing review editing supervision haitao li software data curation investigation wenpeng li data curation investigation fei chen investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we gratefully acknowledge the financial support of this research by the swiss agency for development and cooperation sdc in the framework of the project rehabilitation and management strategy for over pumped aquifers under a changing climate we extend our gratitude to mr gu junfang and mr liu hongliang from handan department of water resources and mr yao huaixian mr li guangchao and mr yang dongchao from guantao department of water resources for their assistance in data collection supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103813 appendix supplementary materials image application 1 image application 2 
361,virtual water flows are used to determine the indirect water requirements of a region or product making them an indispensable tool for water sustainability analysis and assessment commodity flows are a key data needed to compute virtual water but are typically available every 5 years in the united states us the lack of continuous annual commodity flow data severely limits our ability to study and understand the drivers evolution and alterations of virtual water in the us we build and evaluate a machine learning model using random forest rf to predict annual commodity and virtual water flow networks the model is used to perform several modeling experiments and illustrate the prediction of annual virtual water flows in the us during 2013 2018 we show that the rf predictions consistently outperform those from a gravity model the overall performance of the rf algorithm improves as commodities or regions are aggregated into coarser groups likewise the inclusion of past commodity flows as an additional explanatory variable enhances the rf performance the combination of rf classification and regression allows predicting both network connections and flows without comprising performance based on our rf predictions for 2013 2018 we find that temporal variations in virtual water flows can be large for some regions in the us underscoring the need addressed by this study of reconstructing domestic virtual water changes over time by capturing inter regional water consumption interactions in space and time such reconstructed data could be beneficial in the future for anticipating and managing local and regional water scarcity keywords complex network spatial network gravity model random forest trade water footprint 1 introduction virtual water flows quantify the water embodied in the production of goods and services along supply chains allan 1998 they can be used to build production and consumption based accounts of the indirect water requirements of a region to support water sustainability analysis and assessment garcia et al 2020 water footprint network 2019 mahjabin et al 2018 sartori et al 2017 hoekstra and mekonnen 2012 for example the water footprint assessment tool water footprint network 2019 uses virtual water to compute water footprints of consumption that allow users to measure on average the water embodied in the products they consume robust water accounting is a prerequisite for sound water management grafton et al 2018 accounting for both direct and indirect virtual water uses alongside complementary economic analysis and modeling tools can be used to design more comprehensive water management strategies and policies duarte and yang 2011 daniels et al 2011 provide an extensive review of potential applications of indirect water use to policymaking and regional sustainability analysis virtual water is often determined by multiplying a commodity flow by an appropriate virtual water content coefficient by quantifying the transfer of a good from an origin region to a destination region commodity flows are a key input needed for the estimation of virtual water indeed commodity flows are critical for the determination of different types of footprints such as water mahjabin et al 2018 hoekstra and mekonnen 2012 carbon kanemoto et al 2016 henders et al 2015 jakob and marschinski 2013 ecological weinzettel et al 2014 ewing et al 2010 and nutrient li et al 2019 oita et al 2016 footprints in addition commodity flow data are important for building computable general equilibrium models which are the main computational tool used to evaluate the complex interactions among economic policy technological and environmental changes wittwer 2017 nelson et al 2014 tanner 2006 while commodity flows between countries are readily available from various sources in the form of bilateral trade data fao 2019 inter regional within country data are scarce in the united states us both the commodity flow survey us census bureau 2019 and the freight analysis framework faf database center for transportation analysis 2018 provide annual commodity flow data every 5 years to better characterize the interactions between economic activities and environmental pressure continuous time series data of commodity flows are needed the lack of annual time series data severely limits our ability to study and understand the drivers evolution and alterations of virtual water in the us virtual water flows are typically modeled using gravity models gms fracasso et al 2015 fracasso 2014 tamea et al 2014 gms are the workhorse econometric model of bilateral trade tinbergen 1962 gms use nonlinear regression to predict flows often by making statistical assumptions that are difficult to justify silva and tenreyro 2011 2010 for example the multiplicative multiple regression equation of gms is often log linearized with the expectation that errors are gaussian and homoscedastic silva and tenreyro 2006 meeting these error criteria can be challenging in many applications arvis and shepherd 2013 silva and tenreyro 2011 2010 2006 to overcome this limitation machine learning approaches are well suited for handling nonlinear regression problems since they do not make assumptions about the underlying error distribution breiman 2001 breiman et al 1984 here our goal is to build and evaluate a machine learning model of annual virtual water networks in the us using available socioeconomic and virtual water content coefficient data we use random forest rf to predict virtual water networks for various economic commodities such as cereal grains meat pharmaceuticals and textiles among others the rf is compared against a state of the art gm to test the ability of machine learning to enhance flow predictions we use rf to perform several experiments that address challenges encountered in the modeling of virtual water and commodity flows garcia et al 2020 mahjabin et al 2020 garcia and mejia 2019 lin et al 2019 rushforth and ruddell 2018 for example one experiment examines the effect of spatial and commodity aggregation on flow predictions while another addresses the effect of past flows on current predictions in addition the rf is used to perform a case study that consists of predicting annual virtual water flow networks during 2013 2018 in the us with this study we answer the following research questions does a machine learning approach based on rf outperform a gm what are the effects of different types of flows e g virtual water in m3 yr commodities in tons yr or money in us dollars usd yr and aggregation schemes on prediction accuracy can rf enhance the prediction of both network topology and flow magnitudes can past flow information improve the accuracy of current flow predictions for global virtual water networks gms have been extensively utilized to determine and analyze international virtual water flows fracasso et al 2015 fracasso 2014 tamea et al 2014 and to explore the evolution of virtual water sartori et al 2017 gms have been used less frequently to model within country virtual water flows garcia and mejia 2019 to our knowledge machine learning algorithms have thus far not been used to model virtual water flow networks even though they have shown improved performance in related applications involving multiple regression yan et al 2019 knoll et al 2019 sadler et al 2018 forkuor et al 2017 li et al 2016 jeong et al 2016 wheeler et al 2015 povak et al 2014 oliveira et al 2012 several supervised machine learning algorithms are available to predict a response variable such as rf artificial neural networks support vector machine and gradient boosted machines comparisons of various supervised learning algorithms show that rf performs well relative to other algorithms caruana et al 2008 caruana and niculescu mizil 2006 some advantages of rf are its ability to handle nonlinear and nonstationary data and to provide information about the importance of explanatory variables in addition rf algorithms tend to require less hyperparameter tuning than other approaches e g artificial neural networks cutler et al 2011 because of these advantages we use rf in this study rf is a machine learning classification and regression algorithm that uses an ensemble of decision trees to make predictions breiman 2001 in the rf regression algorithm each prediction is based on the average of the outputs from all trees in the forest while in the rf classification algorithm a class is determined by majority voting rf regression has been used and shown to provide better prediction accuracy than other algorithms e g artificial neural networks support vector machine and gradient boosted machines in various applications e g geosciences nawar and mouazen 2017 forkuor et al 2017 rodriguez galiano et al 2015 atmospheric sciences he et al 2016 kühnlein et al 2014 and hydrology nauman et al 2019 knoll et al 2019 yang et al 2017 2016 li et al 2016 likewise the rf classification algorithm has been implemented and shown to lead to better classification accuracy than support vector machines artificial neural networks and decision trees in different applications hong et al 2016 liu et al 2013 jia et al 2013 nappi et al 2011 including classification problems in hydrology woznicki et al 2019 carlisle et al 2019 o neil et al 2018 berhane et al 2018 tesoriero et al 2017 wang et al 2015 baudron et al 2013 there are other more recent decision tree based machine learning algorithms that have been used in hydrologic applications such as extreme gradient boosting chen and guestrin 2016 and extremely randomized trees geurts et al 2006 these algorithms have shown better performance than rf in some applications brédy et al 2020 zhang et al 2019 fan et al 2018 but not in others naghibi et al 2020 jing et al 2020 wu et al 2019 since machine learning has not thus far been widely used to estimate virtual water flows we use rf in this study as this seems to be a more familiar algorithm thus our general aim here is to evaluate and highlight the potential of machine learning to contribute positively to virtual water studies rather than trying to select the best performing ml algorithm this paper is organized as follows section 2 describes the data and methods in section 3 we present the results and discuss their implications section 4 summarizes our main findings and conclusions 2 materials and methods in this section we describe the data models experimental setup and evaluation strategy used in this study as further described below we build and compare a gm and rf using commodity flow socioeconomic and virtual water content coefficient data the models are assessed using a common and robust performance evaluation strategy to ensure comparability and applicability in addition the rf is used to perform several modeling experiments and a case study 2 1 data to train and test the gm and rf we build a common database containing all the data for the response and explanatory variables for the response variable we use commodity flow networks for individual commodity classes fig 1 illustrates the network for the cereal grains commodity class the commodity flow networks are obtained from the faf4 dataset center for transportation analysis 2018 the faf4 provides empirical commodity flow data in units of both tons yr and usd yr every 5 years the faf4 represents commodity flows between 129 regions within the contiguous us for 42 different commodity classes to compare the gm and rf we use empirical commodity flows for the year 2012 which is the latest year of faf4 empirical data in addition the faf4 data include annual commodity flow forecasts during 2013 2018 these faf4 forecasts are generated by combining a national macroeconomic model with regional modeling results and data u s department of transportation 2016 we use the annual faf4 forecasts as a baseline comparison against our temporal predictions in the faf4 data the 129 regions include 83 metropolitan statistical areas or cities 34 remainders of states and 12 states the remainder of a state is the area of a state that is not part of a faf4 metropolitan area for example the faf4 includes the cities of new york albany rochester and buffalo in the state of new york the remainder of the state of new york is the area of the state not covered by those cities the state regions in the faf4 are states that do not have a metropolitan area within their boundaries so each of these states is represented as a single region we use the 129 regions in the faf4 as our network nodes and the commodity flows as the network links and weights out of the 42 commodity classes in the faf4 we focus on the 23 most water intensive classes table s1 in the supporting information lists the 129 regions and table s2 lists the 23 commodity classes to build the gm and rf we use the same set of explanatory variables the variables are selected based on data availability and results from previous studies garcia and mejia 2019 fracasso 2014 fagiolo 2010 we use the following 9 explanatory variables as predictors geodesic distance between any pair of nodes population density at the origin and destination node u s census bureau 2018 number of firms or establishments for each commodity at the origin and destination node u s department of labor 2018 gross domestic product gdp at the origin and destination node u s bureau of economic analysis 2019 and agricultural land for each agricultural commodity at the origin and destination node u s department of agriculture 2018 table s3 in the supporting information shows a summary of all the explanatory variables used in this study other explanatory variables such as employment and wages u s department of labor 2018 were initially considered but later removed as they revealed multicollinearity multicollinearity was assessed using the linear correlation between the explanatory variables and the variance inflation factors test in addition for some commodities employment and wage data can contain a large fraction of missing values which further complicates using these data as explanatory variables for the agricultural commodities we also considered using annual precipitation as an additional explanatory variable but it did not result in consistent improvements in model performance thus we did not use annual precipitation further in building the gm and rf model the geodesic distance is calculated based on the shortest path between the centroids of regions on an ellipsoid using the algorithm of karney 2013 and population density is computed using the area of each region we considered using traveled distance which is included as part of the faf4 dataset instead of geodesic distance but the two distance variables are highly correlated in all the commodity flow networks with the average linear correlation r being 0 98 table s4 furthermore using traveled distance requires the implementation of an additional model to estimate the traveled distance for links that are not part of the faf4 dataset by using geodesic distance and without loss of information we avoid having to implement such model to convert the faf4 commodity flow networks into virtual water flow networks we use blue virtual water content coefficients in m3 tons from a previous study ahams et al 2017 for each faf4 commodity class by multiplying each commodity flow by its corresponding virtual water content coefficient the commodity flow in tons yr is converted into a virtual water flow in m3 yr in summary for each of the 23 commodities considered in the study our database consists of a network with 16 512 possible links representing a fully connected directed network without self loops for each pair of nodes in any of the commodity virtual water networks we use 7 or 9 explanatory variables to predict the network flows 2 2 gravity model in its simplest form the gm states that the trade flow tkj between regions k and j is proportional to the product of their economic masses mkmj usually gdp and inversely proportional to their economic distance dkj usually geographical distance tinbergen 1962 such that 1 t k j c m k α 1 m j α 2 d k j α 3 ε k j where c is a proportionality constant α1 α2 and α3 are unknown parameters which measure respectively the elasticity of trade to the economic mass of the origin and destination region and the elasticity of trade to economic distance and εkj is the error term in practice eq 1 is applied using multiple explanatory variables besides mkmj by taking the logarithmic of eq 1 the gm is often fitted using the ordinary least squares ols estimator there are however limitations to the ols estimator for instance it results in biased parameter estimates under heteroscedasticity does not preserve the total mass and cannot handle zero values more generally when the ols estimator is applied to eq 1 there is no guarantee that it will perform adequately due to jensen s inequality e log tkj log e tkj where e is the expectation operator the poisson pseudo maximum likelihood ppml is an improved alternative to the ols estimator that overcomes these limitations arvis and shepherd 2013 silva and tenreyro 2011 2010 2006 therefore we implement the ppml estimator to obtain the parameter values in the gm to obtain the gm parameter values the ppml estimator solves the following set of conditions 2 i 1 n y i e x i β x i 0 where y y 1 y 2 yn is the vector of commodity flows n is the number of observations each xi is a p 1vector of explanatory variables such that x i x i 1 x i 2 x i p with p being the number of explanatory variables plus 1 thus x is a n p matrix and β β1 β2 β p is the vector of unknown parameters the conditions in eq 2 are numerically equivalent to solving the poisson maximum likelihood function silva and tenreyro 2006 this means that to estimate the gm parameter values the following poisson regression model can be used 3 p y i y i x i β e e x i β e x i β y i y i with the log likelihood function ℓ β given by 4 ℓ β i 1 n e x i β x i β y i ln y i after solving eq 4 the flow predictions are obtained using 5 y i e β 1 β 2 ln x i 1 β p ln x i p to implement the ppml estimator the approach by silva and tenreyro 2006 is followed in addition when fitting the gm model a backward stepwise regression with a selection criterion of p value 0 05 is employed to determine the explanatory variables to include for each flow network 2 3 random forest rf is a machine learning classification and regression algorithm that uses an ensemble of decision trees as base learners breiman 2001 two key features of the rf algorithm are the use of bagging breiman 1996 and the random subspace method ho 1998 bagging or bootstrap aggregating consists of using bootstrap sampling to generate new training sets from a starting training set each new set is used to grow a separate decision tree and the final predictions are made using the tree ensemble the random subspace method consists of using a random subset of all the explanatory variables when building and growing each decision tree both of these features have been shown to improve the performance of rfs cutler et al 2011 breiman 2001 to grow each tree in the rf the non terminal nodes in a tree are split into two child nodes based on the value split point of a single explanatory variable chosen using the random subspace method the split point is selected as the value of the explanatory variable that provides the best partition of the response variable the best partition is obtained by maximizing the response variable s homogeneity in the child nodes to measure the homogeneity gain in the child nodes we use the mean square error mse for the rf regressor and the gini index for the rf classifier data points of the response variable that have a value of the selected explanatory variable less than or equal to the split point are assigned to the left descendent child node and the rest to the right descendent node this process continues recursively throughout all nodes in the tree until one of four possible stopping criteria is met maximum depth of a tree minimum number of samples required to split a node minimum number of samples required to be a terminal node and maximum number of terminal nodes the four stopping criteria together with the number of trees in the forest and the number of explanatory variables in the random subset used to split nodes comprise the six hyperparameters of the rf table 1 the final prediction from the ensemble of decision trees is obtained by averaging in regression and majority of votes in classification further explanations of rf algorithms are available elsewhere biau and scornet 2016 cutler et al 2011 hastie et al 2008 breiman 2001 for each commodity network we use flows as the continuous response variable in the rf regressor and the presence absence of directed links between any pair of nodes as the categorical response variable in the rf classifier the rf is implemented using the algorithm of pedregosa et al 2011 we build a different rf for each commodity network the rf hyperparameters are tuned using a 5 fold cross validation figure s1 in the supporting information shows a diagram of the steps followed to implement the rf fig 2 illustrates the behavior of the hyperparameters for a single network the behavior is similar for other networks note that in fig 2 the kullback leibler efficiency kle is used to evaluate the rf performance this performance metric is properly introduced and defined below as part of our model performance evaluation strategy subsection 2 7 we find that the most sensitive hyperparameters are the minimum number of samples required to be a terminal node fig 2e and the minimum number of samples required to split a non terminal node fig 2f in both cases smaller values tend to increase the performance of the rf indicating that performance improves as the trees in the forest are allowed to grow more fully to obtain the best combination of hyperparameters we use the rf to perform 10 000 simulations for each network for each simulation the hyperparameter values are varied using uniform random sampling based on the hyperparameters range table 1 the range for each hyperparameter is defined based on sensitivity analysis of different networks to select the best hyperparameter set we use the minimum mse for the rf regressor and the maximum accuracy score as for the rf classifier which are calculated using a 5 fold cross validation the mse and as are given by 6 m s e 1 n i 1 n y i y i 2 7 a s 1 n i 1 n 1 y i y i where yi and y i are the observed and predicted values respectively 1 is the indicator function and n is the number of observations 2 4 influence of explanatory variables an important aspect of using gms to predict virtual water flows is identifying the influence of the different explanatory variables on the response variable since the explanatory variables may be interpreted in an econometric sense as drivers of virtual water ye et al 2019 fracasso et al 2015 fracasso 2014 tamea et al 2014 rf algorithms are particularly useful for ranking the importance of variables nauman et al 2019 knoll et al 2019 therefore we compare the influence of explanatory variables using both the gm and rf for the gm we use the parameter values and p values to quantify the significance level of each explanatory variable for the rf we use the gini importance or mean decrease impurity breiman et al 1984 the mean decrease impurity measures how effective an explanatory variable is at reducing errors in the rf regressor using the training set we compute the mean decrease impurity as the total decrease in node error weighted by the proportion of samples reaching that node averaged over all trees in the ensemble the contribution to the decreases in mean impurity from all the explanatory variables sums to 1 and a higher contribution indicates greater importance 2 5 modeling experiments we conduct 4 different modeling experiments using the rf table 2 the modeling experiments are designed to address assumptions that often arise in the modeling of virtual water and commodity flows garcia et al 2020 mahjabin et al 2020 garcia and mejia 2019 lin et al 2019 rushforth and ruddell 2018 for each experiment and commodity flow network we determine the rf with the most suitable hyperparameter values the first modeling experiment analyzes the effect of aggregating commodities on the rf prediction performance we compare the average performance of individual commodities against two groups of aggregated commodities food related and durable commodities the food related group includes agricultural commodities and processed food while the durable group includes different raw and industrial goods table s5 the second experiment explores the effect of spatial aggregation on prediction performance for this we compare the performance of individual networks at both the faf4 129nodes and state level 49 nodes the third experiment examines the ability of rf to predict both network links and weights using a two stage approach the first stage uses the rf classifier to predict the topology of the network and the second stage uses the rf regressor to assign weights to the predicted topology the advantage of the two stage rf is to permit the emergence of new links in a network the fourth experiment evaluates the ability of past flows to improve current predictions we use flows from 2007 as an additional explanatory variable to predict 2012 flows the 2007 and 2012 commodity flows are the latest faf4 empirical datasets to perform this experiment we transform the 2012 faf4 regions to match the 2007 faf4 regions since a few of the 2012 regions are slightly different 2 6 case study for our case study we demonstrate and evaluate the ability of rf to predict annual virtual water networks for individual commodities over time to perform the case study rf regression trained with the 2012 faf4 data is used to predict virtual water flows during 2013 2018 to train the rf we utilize the same 9 explanatory variables used to perform the modeling experiments the rf trained with the 2012 data is used together with the values of the explanatory variables associated with each predicted year to make predictions during 2013 2018 the rf predictions are compared against faf4 forecasts this comparison is only meant to be a benchmark exercise not a model evaluation since we are comparing against faf4 modeled data in addition for this comparison we use the 2012 faf4 data to initialize our predictions this has the effect of removing any systematic bias in our predictions relative to the faf4 forecasts thus we use the empirical faf4 data which are only available for years 2007 and 2012 to train test the rf and perform the modeling experiments for the case study we only use the faf4 forecasts as an additional dataset to compare against our temporal predictions in this way we avoid mixing the faf4 empirical and forecasted data when training and testing the rf 2 7 performance evaluation strategy to evaluate the performance of the gm and rf the data for each network are randomly split into a training 70 and test 30 set the test set is exclusively used to evaluate the performance of the models with out of sample observations we do not split the data into 3 different sets training validation and test set because the size of the available data for the response variable weighted links is relatively small for some of the commodity networks and because using 2 different sets as we do here training and test is common in water resources applications naghibi et al 2020 knoll et al 2019 wu et al 2019 sadler et al 2018 tesoreiro et al 2017 yang et al 2016 to assess the performance of the models we use the kle percent bias pbias and relative squared error rse as follows 8 k l e 1 k y y k y y 9 p b i a s i 1 n y i y i i 1 n y i 100 10 r s e i 1 n y i y i 2 i 1 n y i y 2 k y y and k y y are the kullback leibler divergence kullback and leibler 1951 of the fitted and null model respectively yi and y i are the observed and predicted values respectively y i is the mean of the observed values and n is the number of observations kle is an entropy based goodness of fit measure suitable for nonlinear regression models it measures the proportionate reduction in uncertainty due to the inclusion of regressors cameron and windmeijer 1995 the kle ranges from minus infinity to 1 perfect fit the pbias is used to measure the average tendency of predictions to underestimate positive values or overestimate negative values observations the rse is used as the error metric for both the training and test set the performance metrics in eqs 8 10 are used to evaluate the gm and rf predictions furthermore to assess the uncertainty of the gm and rf predictions we use 100 different test sets to evaluate the variability of the performance metrics for the trained model associated with each network these test sets are obtained through simple random sampling 3 results and discussion 3 1 comparing the performance of the gravity model and random forest we use the gm and rf to predict and compare the network s flows associated with each of the 23 commodities analyzed for this comparison we use commodity flows in tons yr and in the next subsection virtual water flows are evaluated we find that the rf tends to outperform the gm for the training set the rf results in higher kle values than the gm for all commodities fig 3 a with the average kle being 0 74 and 0 39 for the rf and gm respectively similarly errors are smaller for the rf with an average rse of 0 48 compared to 0 87 for the gm fig 3c in terms of the pbias both models have low biases 1 fig 3b although the rf clearly outperforms the gm for the training set the performance is more even for the test set but with the rf still outperforming the gm fig 3 for example the average kle value is 0 48 and 0 40 fig 3a and the average rse value is 0 77 and 0 91 fig 3c for the rf and gm respectively by examining the uncertainty in the evaluation metrics we find that differences in the performance of the rf and gm are significant fig 4 for example the kle boxplots for the rf and gm do not overlap at the individual commodity level fig 4a indicating that differences in the kle values for the gm and rf are significant likewise for the rse the rf tends to display significantly smaller errors than the gm for all commodities fig 4c although the median pbias is similar for both the gm and rf the interquartile range tends to be narrower for the rf fig 4b suggesting the pbias values are more stable and predictions more consistent for the rf the relative difference in performance between the gm and rf is comparable across commodities for instance the linear correlation between the kle values for the gm and rf is 0 41 p value 0 05 and 0 76 p value 0 01 for the training and test set respectively this indicates that the explanatory variables have a similar effect on the performance of both models i e both models tend to perform better for the same set of commodities this also means that the performance gains from the rf relative to the gm are mainly attributed to the improved performance of the rf algorithm both models however show substantial performance variability across commodities for example the median kle range is 0 10 0 55 and 0 50 0 80 respectively for the gm and rf fig 4a the performance of the gm and rf is likely affected by several factors based on previous findings wang et al 2015 ajiboye et al 2015 masucci et al 2013 some likely factors are the association between the explanatory variables and the response variable the connectivity of the network and the distribution of the response variable using the training set we examine the role played by each of these factors on the gm and rf performance in general model performance is enhanced as the association between the explanatory variables and response variable increases to analyze this we determine the nonlinear correlation székely et al 2007 between each explanatory variable and the response variable and select the explanatory variable with the maximum nonlinear correlation for each commodity the maximum nonlinear correlation is then used to measure the association between the explanatory variables and based on the kle model performance we find that this association is weak and non significant with linear correlation values of 0 17 p value 0 45 and 0 28 p value 0 19 for the gm and rf respectively therefore the performance of the models is not dominated by a single explanatory variable alone we use density to measure network connectivity for each network density is calculated as the total number of links divided by the total number of nodes there is a positive linear correlation between the kle and the networks density with values of 0 41 p value 0 05 and 0 13 p value 0 55 for the gm and rf respectively the weaker correlation for the rf is likely due to the use of bootstrap sampling which tends to reduce the sensitivity of the response variable to the training sample in contrast the strong positive correlation for the gm indicates that its performance is somewhat dependent on the sample size i e as the number of links increases higher density the performance of the model tends to improve since this type of sample size dependency reduces the applicability of a model this is a benefit of the rf compared to the gm to examine the role of the flow distributions on model performance we use the gini index we find that the value of the gini index is high 0 75 for all commodities suggesting that flows tend to be heterogeneous however the linear correlation between the gini index and kle is low and non significant with values of 0 12 p value 0 59 and 0 20 p value 0 36 for the gm and rf respectively this indicates that the flow distributions do not play a dominant role in model performance this is consistent with the fact that both the ppml estimator and the rf do not make assumptions about the underlying distribution of the data in summary based on the 3 factors considered only network connectivity plays a significant role in the case of the gm all the other factors have a non significant effect on the performance of both the gm and rf therefore the performance of the models seems to mostly depend on the way the different explanatory variables are utilized by the algorithms this is explored further in the next subsection by quantifying the importance of the explanatory variables 3 2 assessing the importance of explanatory variables for both the trained gm and rf geographical distance is the most influential variable in the prediction of commodity flows for example its average importance is 29 for the rf with the next variable the number of establishments at the origin region having an importance of 14 table s6 the gm and rf however tend to differ on the importance assigned to other explanatory variables for both models table s6 shows the ranking of all the explanatory variables for each commodity the large influence of geographical distance on our flow predictions is not surprising as this is often the case for spatial networks barthélemy 2011 the negative coefficient for geographical distance in the gm table s6 means that inter regional trade is more intense between neighboring regions than distant ones which agrees with the fact that transportation costs distance tend to act as a friction factor on trade following geographical distance the next explanatory variable with the highest importance is gdp and the number of establishments for the gm and rf respectively which underscores a relevant distinction between the two models the gm relies on an aggregate measure of production gdp to make predictions whereas the rf relies on more granular establishment data which varies from commodity to commodity this greater ability to take advantage of finer firm level data is a benefit of the rf since it suggests the algorithm may be able to account for unique features in each commodity class based on the gm the coefficients for gdp and number of establishments are mostly positive table s6 this simply confirms the intuition that trade increases with economic growth and employment the number of establishments at the origin region also tends to be a significant explanatory variable for the gm table s6 for the rf however the number of establishments at both the origin and destination region are important by using industry information at both the origin and destination region the rf may be better at capturing inter industries flows than the gm this could be useful in the future for building computable general equilibrium models since they typically utilize inter industry flows as a model input wittwer 2017 tanner 2006 likewise for agricultural land recall that this explanatory variable is only used for agricultural commodities the rf takes advantage of the information provided by this variable at both the origin and destination region table s6 in fact for the rf adding the percent importance of agricultural land at both the origin and destination results in this variable being as or more important than distance for the agricultural commodities table s6 in contrast the gm does not use the agricultural land variable in predicting flows with the exception being cereal grains at the origin region table s6 3 3 effect of the flow type on model performance the goal with this analysis is to assess whether the flow type can influence or biased the results from our modeling experiments we are concerned with 3 different flow types commodities tons yr virtual water m3 yr and money usd yr hereafter we only use the rf since it outperforms the gm using our three evaluation metrics we find that model performance varies with the flow type at the individual commodity level for both the training and test set fig 5 for instance based on the training set the kle is equal to 0 60 and 0 90 for milled grains in units of tons yr and m3 yr respectively while equal to 0 60 and 0 85 for pharmaceutical products in tons yr and usd yr respectively fig 5 despite the variability of the evaluation metrics across flow types at the individual commodity level fig 5 the metrics show positive and significant correlations between the different flow types these linear correlation values are summarized in table s7 of the supporting information the correlation values in table s7 indicate that overall the flow predictions tend to behave similarly independently of the flow type by examining the average performance from all commodities we find the performance is comparable among the three flow types for the training set the average kle for flows in units of tons yr m3 yr and usd yr is 0 74 0 76 and 0 77 respectively and the average rse is 0 48 0 46 and 0 36 respectively fig 5 similarly for the test set the average kle for flows in units of tons yr m3 yr and usd yr is 0 48 0 49 and 0 48 respectively while the average rse is 0 78 0 78 and 0 71 respectively fig 5 this indicates that if one is interested in using a consistent model to predict virtual water flows for a wide range of commodities the flow type may be a lesser concern that is one can either choose to predict virtual water flows directly or alternatively predict commodity flows first and then convert those to virtual water flows however if one is only interested in a particular commodity or group of commodities then the selection of the flow type may be an important concern as it can influence model performance since this study deals with predictions for different commodities a single flow type is used to perform the modeling experiments to broaden the applicability of our results the experiments are performed using commodity flows given that commodity flows are used to compute embodied virtual flows for different environmental variables e g water energy nutrients and co2 li et al 2019 kanemoto et al 2016 weinzettel et al 2014 hoekstra and mekonnen 2012 3 4 effect of commodity and spatial aggregation on model performance for our first and second modeling experiment we find that aggregating commodities or regions enhances the performance of the rf fig 6 recall that for the first experiment we aggregate commodities into two groups food related and durable commodities the rf performance improves for the aggregated commodities compared to the average performance of individual commodities table s8 for instance the kle and rse for the test set improve by 28 and 5 respectively for the aggregated commodities relative to average performance of the baseline rf for individual commodities fig 6d and f the baseline model refers to the rf previously used in the comparison with the gm the improved performance for the aggregated commodities is most likely due to an increase in the sample size for example the network associated with the food related group consists of 11 307 weighted links compared to 4 004 which is the average number of weighted links for the individual food related networks similarly the network of aggregated durable commodities consists of 16 395 weighted links while for the individual durable networks the average number of weighted links is 10 692 this indicates that all else being equal datasets formed by more disaggregated commodities than the faf4 will likely experience a decline in performance it also suggests that additional explanatory variables than the ones used here might need to be considered when dealing with more disaggregated commodity networks for the second modeling experiment we compare the rf predictions at the faf4 and state level the performance of the rf increases for the state level predictions based on the kle the increased performance relative to the baseline faf4 level rf is 11 and 17 for the training and test set respectively fig 6a and d in terms of the rse the error reduction due to spatial aggregation the state level predictions is 26 and 16 for the training and test set respectively fig 6c and f little or no gains in the pbias are obtained for the state level predictions fig 6b and e a detailed comparison of the faf4 level and state level predictions for individual commodities is shown in figure s2 the enhanced performance from spatial aggregation is likely due to the commodity flows being less heterogeneous at the state level for instance the average coefficient of variation is equal to 5 and 3 for the faf4 and state level commodity flows respectively based on the training set the enhanced performance of the rf for the spatially aggregated commodity networks highlights challenges when trying to predict flows for more spatially disaggregated networks it suggests that using models built at a coarser level of aggregation to make predictions at a finer spatial resolution will likely result in degraded model performance and larger errors this is important because recent approaches are in part aimed at increasing the spatial resolution of empirical commodity flows lin et al 2019 rushforth and ruddell 2018 for such approaches to be robust they will need to pay attention to the fact that when using regression based predictions model performance and errors may vary significantly between different levels of network aggregation 3 5 prediction of both network links and weights in the third modeling experiment we compare the baseline rf against a two stage rf for each commodity network the two stage approach first uses the rf classifier to predict the presence of directed links and then the rf regressor to predict the weights for those links for both the training and test set we find that the two stage and baseline rf perform similarly in terms of our 3 evaluation metrics fig 6 for instance based on the average kle the performance change between the baseline and two stage rf is nearly negligible 1 for the training and test set fig 6a and d likewise for the pbias and rse the performance change is small the value of the evaluation metrics for individual commodities is included in the supporting information figure s3 the main reason for the similarity in performance between the two stage and baseline rf is the high accuracy of the rf classifier across all commodities the link predictions from the rf classifier result in high as values ranging from 0 86 to 1 00 in the training set and from 0 77 to 0 97 in the test set table s9 this means that the explanatory variables capture well the connectivity of the commodity networks that is the explanatory variables are highly effective at predicting the presence or absence of a link between any pair of nodes but less so at predicting the flow through a link similar results have been reported for international trade flows tuninetti et al 2017 because of the high accuracy of the rf classifier in predicting the topology of the commodity networks we suggest that the networks connectivity is equally influenced by common and shared nationwide factors such factors are sufficiently represented by our explanatory variables i e the location and spatial geography of firms establishments population density gdp and agricultural land use in contrast the weight predictions for the different commodity networks do not response as strongly to the explanatory variables because they may be more influenced by local factors and constraints that are difficult to represent with available nationwide variables in addition the prediction of links might be facilitated in this case by redundancies in the underlying transportation infrastructure required to move the commodities between regions as it implies more stable network topologies that is there are multiple alternatives to get from an origin region to a destination region because of the high connectivity of the transportation network in the us gastner and newman 2006 for the faf4 networks this implies that even if the specific origin destination route traveled by a commodity changes often the link connecting the origin and destination region might not change as frequently 3 6 using past flows to enhance model performance for our fourth modeling experiment we use a time dependent rf to enhance predictions the time dependent rf consists of using past empirical flows for 2007 as an additional explanatory variable to predict flows for 2012 while the performance of the time dependent and baseline rf is comparable for the training set the time dependent rf enhances predictions for the test set fig 6 for example the average kle increases by 18 for the time dependent rf relative to the baseline rf in the test set fig 6d likewise for the rse the time dependent rf reduces errors on average by 11 fig 6f in terms of the pbias the improvements from the time dependent rf are small 1 5 fig 6e based on the values of the evaluation metrics we find that the inclusion of past flows as an additional explanatory variable tends to improve the rf predictions figure s4 performing this experiment with the gm also results in improved predictions but the improvements are greater for the rf relative to the gm the performance improvement in terms of the average kle is 27 greater for the rf the ability of the time dependent rf to enhance predictions can be explained by the high similarity between the 2007 and 2012 flows for instance the linear correlation between the kle values for the predicted commodity networks and the linear correlation between the 2007 and 2012 flows is positive and significant for both the training 0 54 p value 0 01 and test set 0 80 p value 0 01 this means that the performance of the time dependent rf tends to be high when the association between the 2007 and 2012 flows is also high moreover in the time dependent rf the 2007 flows is the explanatory variable with the highest importance in most commodities table s10 that is the 2007 flows is the variable that contributes the most to the reduction of errors and therefore it is being used by the rf algorithm more frequently than other variables to split nodes in the rf s trees the average importance value for the 2007 flows is 47 followed by distance with an average importance value of 14 the high contribution of past flows to the rf predictions supports our previous observation that network links do not change as often and tend to be stable it also suggests that the factors determining the network weights may be fairly consistent over time so that past flows contain useful information for improving current predictions 3 7 prediction of annual virtual water networks over time for our case study we use the baseline rf to predict annual virtual water networks for individual commodities during 2013 2018 we find the rf temporal predictions are comparable to the faf4 modeled data table s11 in the supporting information shows the evaluation metrics for each year and commodity network calculated based on the faf4 modeled data taking the faf4 modeled outputs as empirical values for example the average kle and rse from all commodities is 0 63 and 0 61 respectively in 2013 table s11 however differences in the values of the evaluation metrics tend to grow over time indicating the performance of the rf and faf4 diverges over time for instance the range of kle values for all commodities is 0 46 0 77 in 2013 and 0 40 0 69 in 2018 table s11 without empirical data for 2013 2018 however the effect of such divergence on the rf predictions cannot be further assessed in the future assuming empirical data become available one could evaluate whether an ensemble of rf and faf4 predictions is a viable approach for enhancing performance although there are differences between the rf and faf4 predictions over time fig 7 both seem to capture similar temporal variations and trends in the virtual water flows in fig 7 we show the in strength inflows and out strength outflows of virtual water flows for different commodities and regions for example for the remainder of south carolina and virginia the virtual water inflows for cereal grains tend to increase during 2012 2013 and decline during 2013 2018 in both the rf and faf4 predictions fig 7a and b while for los angeles processed food shows a monotonically increasing trend over time in both the rf and faf4 predictions fig 7c the relative variations between the rf and faf4 predictions are also similar for virtual water outflows fig 7d f overall our benchmarking of the rf predictions with the faf4 modeled data supports the use of rf to reconstruct annual virtual water networks for individual commodities there are several possible applications for such reconstructed temporal data one application area is in assessing the changing pressure of economic activity on water consumption which could be useful in the future for addressing local and regional water scarcity issues daniels et al 2011 for instance the supply of meat from the remainder of california to other us regions increased virtual water flows by 7 during 2012 2018 fig 7f this increase is solely attributed to rising meat supply since the virtual water content values stay the same during the study period the increasing meat supply trend in california tracks the overall trend for the us during 2012 2018 usda nass 2020 in addition this period largely coincides with the 2011 2017 california drought lund et al 2018 one of the largest droughts on record for the state thus while california was battling the 2011 2017 drought it was also simultaneously transferring virtual water to other regions in the country through domestic meat exports figure s5 for the remainder of california the rf predictions show a decrease in virtual water for fruits and vegetables during 2014 2017 while the faf4 predictions only show a decline during 2016 2017 fig 7e based on reports from the california agricultural statistics review california department of food and agriculture 2017 2016 agricultural sales in the state experienced a steep decline during 2014 2016 mostly due to drought conditions with the maximum change being 17 this information matches more closely our rf temporal predictions than the faf4 modeled data fig 7e it also shows that the predicted time series may be able to capture the effect of drought induced shocks on commodity and virtual water flows the effect of drought induced shocks is also likely reflected in the virtual water inflow declines in the remainders of south carolina and virginia in fig 7a and b respectively these states rely heavily on cereal grains imports from the southeast and midwest regions of the us figure s6 which experienced multiple drought episodes during 2012 2017 rippey 2015 williams et al 2015 park williams et al 2017 there might be however network configurations that allow some regions to reduce the negative effects of drought induced shocks for example the ability of los angeles to sustain increasing virtual water inflows through processed food during the california drought of 2011 2017 is likely due to its diverse and large number of trading partners rushforth and ruddell 2016 figure s7 having a large number of trading partners could potentially make los angeles more resistant to drought induced shocks through compensatory effects this represents another area of research that could be explored in the future using the temporal commodity and virtual water flow data to summarize the temporal variations of virtual water flows across the us we calculate the coefficient of variation cov of the food related virtual water inflows fig 8 a and outflows fig 8b during 2013 2018 the cov of virtual water inflows is relatively small 10 for the majority of regions these are regions where using an average estimate of virtual water flows which is an assumption often made in the absence of temporal data is likely to have a small impact on accuracy there are however some regions with high 20 cov values such as the remainder of louisiana and nevada tucson vermont and several cities along the gulf coast fig 8a these are regions that might be particularly exposed to food related shocks and sudden changes in water consumption outside their boundaries since their virtual water inflows vary over a broad range of values relative to their average inflows in terms of virtual water outflows temporal variations tend also to be small 10 for most regions with the exception being mainly a few cities such as baton rouge tucson and tulsa fig 8b these outflow regions with high cov values are locations where changes in economic activity may result in substantial variations in water consumption these might be places of special concern for water management purposes since their water consumption can fluctuate widely as food production changes in general the cov of virtual water outflows tends to be higher in eastern and southern regions and along the west coast fig 8b which are locations where population is high or water scarcity is a regional concern these drivers of virtual water flow change seem to be captured by the reconstructed temporal data this kind of analysis could be expanded in the future to evaluate multiple drivers and assess their relative importance e g by combining the reconstructed temporal networks with input output economic data gomez et al 2020 4 summary and conclusion in this study we evaluate the ability of a machine learning algorithm to enhance predictions of virtual water flow networks for various commodities across the us for the machine learning algorithm we use rf since it has been successfully used before in several other water resources applications virtual water flows are typically estimated using commodity flow data commodity flow data are used in the estimation of different embodied virtual flows such as air quality pollutants greenhouse gases energy nutrients etc in addition commodity flows are a key input for computable general equilibrium models which are widely used to assess the environmental implications of economic policy and technological changes therefore the prediction of commodity flows is important beyond applications to virtual water time series of commodity flow networks are critically needed to better understand the drivers and evolution of domestic virtual water and other embodied flows this study provides a comprehensive model evaluation for successfully reconstructing such temporal data although our approach is tested within the us the methods are general so that they could be applied in other locations as long as the necessary data are available the necessary data include within country commodity flows virtual water content and a set of explanatory variables for each commodity class to evaluate the quality of the rf predictions we compare the rf against a gm since gms are a common approach used to predict commodity flows we find that rf can enhance commodity flow predictions beyond what is possible with a state of the art gm the rf improves predictions during both training and testing by increasing the goodness of fit and reducing both errors and biases moreover differences in the evaluation metrics between the rf and gm tend to be significant we also find that the performance of the rf is consistent across flow types predictions are on average similar independently of using physical commodities virtual water or money however there are variations in performance at the individual commodity level that might be important if interest lies in predicting a specific commodity or group of commodities by assessing the importance of explanatory variables and performing 4 different modeling experiments we highlight benefits of using machine learning and clarify several challenges in commodity flow prediction when compared to the gm the rf relies more heavily on explanatory variables that vary from commodity to commodity this suggests the rf is more likely to capture the uniqueness of each commodity flow network the modeling experiments show that rf predictions improve by aggregating commodities or regions into coarser groups and by using past flows to predict current ones these results suggest that obtaining more disaggregated commodity networks than the faf4 level will be generally challenging without compromising model performance using the rf to predict both network links and weights we find the topology of the commodity flow networks is highly predictable that is the challenge is not in identifying the presence or absence of a link between pair of nodes but in predicting the flow through a link with the case study we demonstrate that it is possible to use rf to reconstruct annual virtual water networks in the us the reconstructed temporal data may be used to better understand the drivers of virtual water for our case study we find that virtual water temporal variations can be large for some us regions and that drought induced supply shocks may explain some of that variation such virtual water flow variations may be used in the future to identify and analyze shock prone regions or assess the exposure of regions to water consumption changes outside their boundaries although this study uses rf as the machine learning algorithm it is possible that more recent decision tree based algorithms such as extreme gradient boosting chen and guestrin 2016 and extremely randomized trees geurts et al 2006 could lead to even better performance than demonstrated by rf future work could compare these different algorithms using rf as a benchmark author statement all authors contributed to the conceptualization analysis of results and writing of the paper fiorella oreggioni and alfonso mejia developed the methodology fiorella oreggioni built the models generated the results and created the figures declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we are thankful to the two anonymous reviewers for their constructive comments which helped improve the paper computations for this research were performed on the pennsylvania state university s institute for computational and data sciences roar supercomputer supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103819 appendix supplementary materials image application 1 image application 2 
361,virtual water flows are used to determine the indirect water requirements of a region or product making them an indispensable tool for water sustainability analysis and assessment commodity flows are a key data needed to compute virtual water but are typically available every 5 years in the united states us the lack of continuous annual commodity flow data severely limits our ability to study and understand the drivers evolution and alterations of virtual water in the us we build and evaluate a machine learning model using random forest rf to predict annual commodity and virtual water flow networks the model is used to perform several modeling experiments and illustrate the prediction of annual virtual water flows in the us during 2013 2018 we show that the rf predictions consistently outperform those from a gravity model the overall performance of the rf algorithm improves as commodities or regions are aggregated into coarser groups likewise the inclusion of past commodity flows as an additional explanatory variable enhances the rf performance the combination of rf classification and regression allows predicting both network connections and flows without comprising performance based on our rf predictions for 2013 2018 we find that temporal variations in virtual water flows can be large for some regions in the us underscoring the need addressed by this study of reconstructing domestic virtual water changes over time by capturing inter regional water consumption interactions in space and time such reconstructed data could be beneficial in the future for anticipating and managing local and regional water scarcity keywords complex network spatial network gravity model random forest trade water footprint 1 introduction virtual water flows quantify the water embodied in the production of goods and services along supply chains allan 1998 they can be used to build production and consumption based accounts of the indirect water requirements of a region to support water sustainability analysis and assessment garcia et al 2020 water footprint network 2019 mahjabin et al 2018 sartori et al 2017 hoekstra and mekonnen 2012 for example the water footprint assessment tool water footprint network 2019 uses virtual water to compute water footprints of consumption that allow users to measure on average the water embodied in the products they consume robust water accounting is a prerequisite for sound water management grafton et al 2018 accounting for both direct and indirect virtual water uses alongside complementary economic analysis and modeling tools can be used to design more comprehensive water management strategies and policies duarte and yang 2011 daniels et al 2011 provide an extensive review of potential applications of indirect water use to policymaking and regional sustainability analysis virtual water is often determined by multiplying a commodity flow by an appropriate virtual water content coefficient by quantifying the transfer of a good from an origin region to a destination region commodity flows are a key input needed for the estimation of virtual water indeed commodity flows are critical for the determination of different types of footprints such as water mahjabin et al 2018 hoekstra and mekonnen 2012 carbon kanemoto et al 2016 henders et al 2015 jakob and marschinski 2013 ecological weinzettel et al 2014 ewing et al 2010 and nutrient li et al 2019 oita et al 2016 footprints in addition commodity flow data are important for building computable general equilibrium models which are the main computational tool used to evaluate the complex interactions among economic policy technological and environmental changes wittwer 2017 nelson et al 2014 tanner 2006 while commodity flows between countries are readily available from various sources in the form of bilateral trade data fao 2019 inter regional within country data are scarce in the united states us both the commodity flow survey us census bureau 2019 and the freight analysis framework faf database center for transportation analysis 2018 provide annual commodity flow data every 5 years to better characterize the interactions between economic activities and environmental pressure continuous time series data of commodity flows are needed the lack of annual time series data severely limits our ability to study and understand the drivers evolution and alterations of virtual water in the us virtual water flows are typically modeled using gravity models gms fracasso et al 2015 fracasso 2014 tamea et al 2014 gms are the workhorse econometric model of bilateral trade tinbergen 1962 gms use nonlinear regression to predict flows often by making statistical assumptions that are difficult to justify silva and tenreyro 2011 2010 for example the multiplicative multiple regression equation of gms is often log linearized with the expectation that errors are gaussian and homoscedastic silva and tenreyro 2006 meeting these error criteria can be challenging in many applications arvis and shepherd 2013 silva and tenreyro 2011 2010 2006 to overcome this limitation machine learning approaches are well suited for handling nonlinear regression problems since they do not make assumptions about the underlying error distribution breiman 2001 breiman et al 1984 here our goal is to build and evaluate a machine learning model of annual virtual water networks in the us using available socioeconomic and virtual water content coefficient data we use random forest rf to predict virtual water networks for various economic commodities such as cereal grains meat pharmaceuticals and textiles among others the rf is compared against a state of the art gm to test the ability of machine learning to enhance flow predictions we use rf to perform several experiments that address challenges encountered in the modeling of virtual water and commodity flows garcia et al 2020 mahjabin et al 2020 garcia and mejia 2019 lin et al 2019 rushforth and ruddell 2018 for example one experiment examines the effect of spatial and commodity aggregation on flow predictions while another addresses the effect of past flows on current predictions in addition the rf is used to perform a case study that consists of predicting annual virtual water flow networks during 2013 2018 in the us with this study we answer the following research questions does a machine learning approach based on rf outperform a gm what are the effects of different types of flows e g virtual water in m3 yr commodities in tons yr or money in us dollars usd yr and aggregation schemes on prediction accuracy can rf enhance the prediction of both network topology and flow magnitudes can past flow information improve the accuracy of current flow predictions for global virtual water networks gms have been extensively utilized to determine and analyze international virtual water flows fracasso et al 2015 fracasso 2014 tamea et al 2014 and to explore the evolution of virtual water sartori et al 2017 gms have been used less frequently to model within country virtual water flows garcia and mejia 2019 to our knowledge machine learning algorithms have thus far not been used to model virtual water flow networks even though they have shown improved performance in related applications involving multiple regression yan et al 2019 knoll et al 2019 sadler et al 2018 forkuor et al 2017 li et al 2016 jeong et al 2016 wheeler et al 2015 povak et al 2014 oliveira et al 2012 several supervised machine learning algorithms are available to predict a response variable such as rf artificial neural networks support vector machine and gradient boosted machines comparisons of various supervised learning algorithms show that rf performs well relative to other algorithms caruana et al 2008 caruana and niculescu mizil 2006 some advantages of rf are its ability to handle nonlinear and nonstationary data and to provide information about the importance of explanatory variables in addition rf algorithms tend to require less hyperparameter tuning than other approaches e g artificial neural networks cutler et al 2011 because of these advantages we use rf in this study rf is a machine learning classification and regression algorithm that uses an ensemble of decision trees to make predictions breiman 2001 in the rf regression algorithm each prediction is based on the average of the outputs from all trees in the forest while in the rf classification algorithm a class is determined by majority voting rf regression has been used and shown to provide better prediction accuracy than other algorithms e g artificial neural networks support vector machine and gradient boosted machines in various applications e g geosciences nawar and mouazen 2017 forkuor et al 2017 rodriguez galiano et al 2015 atmospheric sciences he et al 2016 kühnlein et al 2014 and hydrology nauman et al 2019 knoll et al 2019 yang et al 2017 2016 li et al 2016 likewise the rf classification algorithm has been implemented and shown to lead to better classification accuracy than support vector machines artificial neural networks and decision trees in different applications hong et al 2016 liu et al 2013 jia et al 2013 nappi et al 2011 including classification problems in hydrology woznicki et al 2019 carlisle et al 2019 o neil et al 2018 berhane et al 2018 tesoriero et al 2017 wang et al 2015 baudron et al 2013 there are other more recent decision tree based machine learning algorithms that have been used in hydrologic applications such as extreme gradient boosting chen and guestrin 2016 and extremely randomized trees geurts et al 2006 these algorithms have shown better performance than rf in some applications brédy et al 2020 zhang et al 2019 fan et al 2018 but not in others naghibi et al 2020 jing et al 2020 wu et al 2019 since machine learning has not thus far been widely used to estimate virtual water flows we use rf in this study as this seems to be a more familiar algorithm thus our general aim here is to evaluate and highlight the potential of machine learning to contribute positively to virtual water studies rather than trying to select the best performing ml algorithm this paper is organized as follows section 2 describes the data and methods in section 3 we present the results and discuss their implications section 4 summarizes our main findings and conclusions 2 materials and methods in this section we describe the data models experimental setup and evaluation strategy used in this study as further described below we build and compare a gm and rf using commodity flow socioeconomic and virtual water content coefficient data the models are assessed using a common and robust performance evaluation strategy to ensure comparability and applicability in addition the rf is used to perform several modeling experiments and a case study 2 1 data to train and test the gm and rf we build a common database containing all the data for the response and explanatory variables for the response variable we use commodity flow networks for individual commodity classes fig 1 illustrates the network for the cereal grains commodity class the commodity flow networks are obtained from the faf4 dataset center for transportation analysis 2018 the faf4 provides empirical commodity flow data in units of both tons yr and usd yr every 5 years the faf4 represents commodity flows between 129 regions within the contiguous us for 42 different commodity classes to compare the gm and rf we use empirical commodity flows for the year 2012 which is the latest year of faf4 empirical data in addition the faf4 data include annual commodity flow forecasts during 2013 2018 these faf4 forecasts are generated by combining a national macroeconomic model with regional modeling results and data u s department of transportation 2016 we use the annual faf4 forecasts as a baseline comparison against our temporal predictions in the faf4 data the 129 regions include 83 metropolitan statistical areas or cities 34 remainders of states and 12 states the remainder of a state is the area of a state that is not part of a faf4 metropolitan area for example the faf4 includes the cities of new york albany rochester and buffalo in the state of new york the remainder of the state of new york is the area of the state not covered by those cities the state regions in the faf4 are states that do not have a metropolitan area within their boundaries so each of these states is represented as a single region we use the 129 regions in the faf4 as our network nodes and the commodity flows as the network links and weights out of the 42 commodity classes in the faf4 we focus on the 23 most water intensive classes table s1 in the supporting information lists the 129 regions and table s2 lists the 23 commodity classes to build the gm and rf we use the same set of explanatory variables the variables are selected based on data availability and results from previous studies garcia and mejia 2019 fracasso 2014 fagiolo 2010 we use the following 9 explanatory variables as predictors geodesic distance between any pair of nodes population density at the origin and destination node u s census bureau 2018 number of firms or establishments for each commodity at the origin and destination node u s department of labor 2018 gross domestic product gdp at the origin and destination node u s bureau of economic analysis 2019 and agricultural land for each agricultural commodity at the origin and destination node u s department of agriculture 2018 table s3 in the supporting information shows a summary of all the explanatory variables used in this study other explanatory variables such as employment and wages u s department of labor 2018 were initially considered but later removed as they revealed multicollinearity multicollinearity was assessed using the linear correlation between the explanatory variables and the variance inflation factors test in addition for some commodities employment and wage data can contain a large fraction of missing values which further complicates using these data as explanatory variables for the agricultural commodities we also considered using annual precipitation as an additional explanatory variable but it did not result in consistent improvements in model performance thus we did not use annual precipitation further in building the gm and rf model the geodesic distance is calculated based on the shortest path between the centroids of regions on an ellipsoid using the algorithm of karney 2013 and population density is computed using the area of each region we considered using traveled distance which is included as part of the faf4 dataset instead of geodesic distance but the two distance variables are highly correlated in all the commodity flow networks with the average linear correlation r being 0 98 table s4 furthermore using traveled distance requires the implementation of an additional model to estimate the traveled distance for links that are not part of the faf4 dataset by using geodesic distance and without loss of information we avoid having to implement such model to convert the faf4 commodity flow networks into virtual water flow networks we use blue virtual water content coefficients in m3 tons from a previous study ahams et al 2017 for each faf4 commodity class by multiplying each commodity flow by its corresponding virtual water content coefficient the commodity flow in tons yr is converted into a virtual water flow in m3 yr in summary for each of the 23 commodities considered in the study our database consists of a network with 16 512 possible links representing a fully connected directed network without self loops for each pair of nodes in any of the commodity virtual water networks we use 7 or 9 explanatory variables to predict the network flows 2 2 gravity model in its simplest form the gm states that the trade flow tkj between regions k and j is proportional to the product of their economic masses mkmj usually gdp and inversely proportional to their economic distance dkj usually geographical distance tinbergen 1962 such that 1 t k j c m k α 1 m j α 2 d k j α 3 ε k j where c is a proportionality constant α1 α2 and α3 are unknown parameters which measure respectively the elasticity of trade to the economic mass of the origin and destination region and the elasticity of trade to economic distance and εkj is the error term in practice eq 1 is applied using multiple explanatory variables besides mkmj by taking the logarithmic of eq 1 the gm is often fitted using the ordinary least squares ols estimator there are however limitations to the ols estimator for instance it results in biased parameter estimates under heteroscedasticity does not preserve the total mass and cannot handle zero values more generally when the ols estimator is applied to eq 1 there is no guarantee that it will perform adequately due to jensen s inequality e log tkj log e tkj where e is the expectation operator the poisson pseudo maximum likelihood ppml is an improved alternative to the ols estimator that overcomes these limitations arvis and shepherd 2013 silva and tenreyro 2011 2010 2006 therefore we implement the ppml estimator to obtain the parameter values in the gm to obtain the gm parameter values the ppml estimator solves the following set of conditions 2 i 1 n y i e x i β x i 0 where y y 1 y 2 yn is the vector of commodity flows n is the number of observations each xi is a p 1vector of explanatory variables such that x i x i 1 x i 2 x i p with p being the number of explanatory variables plus 1 thus x is a n p matrix and β β1 β2 β p is the vector of unknown parameters the conditions in eq 2 are numerically equivalent to solving the poisson maximum likelihood function silva and tenreyro 2006 this means that to estimate the gm parameter values the following poisson regression model can be used 3 p y i y i x i β e e x i β e x i β y i y i with the log likelihood function ℓ β given by 4 ℓ β i 1 n e x i β x i β y i ln y i after solving eq 4 the flow predictions are obtained using 5 y i e β 1 β 2 ln x i 1 β p ln x i p to implement the ppml estimator the approach by silva and tenreyro 2006 is followed in addition when fitting the gm model a backward stepwise regression with a selection criterion of p value 0 05 is employed to determine the explanatory variables to include for each flow network 2 3 random forest rf is a machine learning classification and regression algorithm that uses an ensemble of decision trees as base learners breiman 2001 two key features of the rf algorithm are the use of bagging breiman 1996 and the random subspace method ho 1998 bagging or bootstrap aggregating consists of using bootstrap sampling to generate new training sets from a starting training set each new set is used to grow a separate decision tree and the final predictions are made using the tree ensemble the random subspace method consists of using a random subset of all the explanatory variables when building and growing each decision tree both of these features have been shown to improve the performance of rfs cutler et al 2011 breiman 2001 to grow each tree in the rf the non terminal nodes in a tree are split into two child nodes based on the value split point of a single explanatory variable chosen using the random subspace method the split point is selected as the value of the explanatory variable that provides the best partition of the response variable the best partition is obtained by maximizing the response variable s homogeneity in the child nodes to measure the homogeneity gain in the child nodes we use the mean square error mse for the rf regressor and the gini index for the rf classifier data points of the response variable that have a value of the selected explanatory variable less than or equal to the split point are assigned to the left descendent child node and the rest to the right descendent node this process continues recursively throughout all nodes in the tree until one of four possible stopping criteria is met maximum depth of a tree minimum number of samples required to split a node minimum number of samples required to be a terminal node and maximum number of terminal nodes the four stopping criteria together with the number of trees in the forest and the number of explanatory variables in the random subset used to split nodes comprise the six hyperparameters of the rf table 1 the final prediction from the ensemble of decision trees is obtained by averaging in regression and majority of votes in classification further explanations of rf algorithms are available elsewhere biau and scornet 2016 cutler et al 2011 hastie et al 2008 breiman 2001 for each commodity network we use flows as the continuous response variable in the rf regressor and the presence absence of directed links between any pair of nodes as the categorical response variable in the rf classifier the rf is implemented using the algorithm of pedregosa et al 2011 we build a different rf for each commodity network the rf hyperparameters are tuned using a 5 fold cross validation figure s1 in the supporting information shows a diagram of the steps followed to implement the rf fig 2 illustrates the behavior of the hyperparameters for a single network the behavior is similar for other networks note that in fig 2 the kullback leibler efficiency kle is used to evaluate the rf performance this performance metric is properly introduced and defined below as part of our model performance evaluation strategy subsection 2 7 we find that the most sensitive hyperparameters are the minimum number of samples required to be a terminal node fig 2e and the minimum number of samples required to split a non terminal node fig 2f in both cases smaller values tend to increase the performance of the rf indicating that performance improves as the trees in the forest are allowed to grow more fully to obtain the best combination of hyperparameters we use the rf to perform 10 000 simulations for each network for each simulation the hyperparameter values are varied using uniform random sampling based on the hyperparameters range table 1 the range for each hyperparameter is defined based on sensitivity analysis of different networks to select the best hyperparameter set we use the minimum mse for the rf regressor and the maximum accuracy score as for the rf classifier which are calculated using a 5 fold cross validation the mse and as are given by 6 m s e 1 n i 1 n y i y i 2 7 a s 1 n i 1 n 1 y i y i where yi and y i are the observed and predicted values respectively 1 is the indicator function and n is the number of observations 2 4 influence of explanatory variables an important aspect of using gms to predict virtual water flows is identifying the influence of the different explanatory variables on the response variable since the explanatory variables may be interpreted in an econometric sense as drivers of virtual water ye et al 2019 fracasso et al 2015 fracasso 2014 tamea et al 2014 rf algorithms are particularly useful for ranking the importance of variables nauman et al 2019 knoll et al 2019 therefore we compare the influence of explanatory variables using both the gm and rf for the gm we use the parameter values and p values to quantify the significance level of each explanatory variable for the rf we use the gini importance or mean decrease impurity breiman et al 1984 the mean decrease impurity measures how effective an explanatory variable is at reducing errors in the rf regressor using the training set we compute the mean decrease impurity as the total decrease in node error weighted by the proportion of samples reaching that node averaged over all trees in the ensemble the contribution to the decreases in mean impurity from all the explanatory variables sums to 1 and a higher contribution indicates greater importance 2 5 modeling experiments we conduct 4 different modeling experiments using the rf table 2 the modeling experiments are designed to address assumptions that often arise in the modeling of virtual water and commodity flows garcia et al 2020 mahjabin et al 2020 garcia and mejia 2019 lin et al 2019 rushforth and ruddell 2018 for each experiment and commodity flow network we determine the rf with the most suitable hyperparameter values the first modeling experiment analyzes the effect of aggregating commodities on the rf prediction performance we compare the average performance of individual commodities against two groups of aggregated commodities food related and durable commodities the food related group includes agricultural commodities and processed food while the durable group includes different raw and industrial goods table s5 the second experiment explores the effect of spatial aggregation on prediction performance for this we compare the performance of individual networks at both the faf4 129nodes and state level 49 nodes the third experiment examines the ability of rf to predict both network links and weights using a two stage approach the first stage uses the rf classifier to predict the topology of the network and the second stage uses the rf regressor to assign weights to the predicted topology the advantage of the two stage rf is to permit the emergence of new links in a network the fourth experiment evaluates the ability of past flows to improve current predictions we use flows from 2007 as an additional explanatory variable to predict 2012 flows the 2007 and 2012 commodity flows are the latest faf4 empirical datasets to perform this experiment we transform the 2012 faf4 regions to match the 2007 faf4 regions since a few of the 2012 regions are slightly different 2 6 case study for our case study we demonstrate and evaluate the ability of rf to predict annual virtual water networks for individual commodities over time to perform the case study rf regression trained with the 2012 faf4 data is used to predict virtual water flows during 2013 2018 to train the rf we utilize the same 9 explanatory variables used to perform the modeling experiments the rf trained with the 2012 data is used together with the values of the explanatory variables associated with each predicted year to make predictions during 2013 2018 the rf predictions are compared against faf4 forecasts this comparison is only meant to be a benchmark exercise not a model evaluation since we are comparing against faf4 modeled data in addition for this comparison we use the 2012 faf4 data to initialize our predictions this has the effect of removing any systematic bias in our predictions relative to the faf4 forecasts thus we use the empirical faf4 data which are only available for years 2007 and 2012 to train test the rf and perform the modeling experiments for the case study we only use the faf4 forecasts as an additional dataset to compare against our temporal predictions in this way we avoid mixing the faf4 empirical and forecasted data when training and testing the rf 2 7 performance evaluation strategy to evaluate the performance of the gm and rf the data for each network are randomly split into a training 70 and test 30 set the test set is exclusively used to evaluate the performance of the models with out of sample observations we do not split the data into 3 different sets training validation and test set because the size of the available data for the response variable weighted links is relatively small for some of the commodity networks and because using 2 different sets as we do here training and test is common in water resources applications naghibi et al 2020 knoll et al 2019 wu et al 2019 sadler et al 2018 tesoreiro et al 2017 yang et al 2016 to assess the performance of the models we use the kle percent bias pbias and relative squared error rse as follows 8 k l e 1 k y y k y y 9 p b i a s i 1 n y i y i i 1 n y i 100 10 r s e i 1 n y i y i 2 i 1 n y i y 2 k y y and k y y are the kullback leibler divergence kullback and leibler 1951 of the fitted and null model respectively yi and y i are the observed and predicted values respectively y i is the mean of the observed values and n is the number of observations kle is an entropy based goodness of fit measure suitable for nonlinear regression models it measures the proportionate reduction in uncertainty due to the inclusion of regressors cameron and windmeijer 1995 the kle ranges from minus infinity to 1 perfect fit the pbias is used to measure the average tendency of predictions to underestimate positive values or overestimate negative values observations the rse is used as the error metric for both the training and test set the performance metrics in eqs 8 10 are used to evaluate the gm and rf predictions furthermore to assess the uncertainty of the gm and rf predictions we use 100 different test sets to evaluate the variability of the performance metrics for the trained model associated with each network these test sets are obtained through simple random sampling 3 results and discussion 3 1 comparing the performance of the gravity model and random forest we use the gm and rf to predict and compare the network s flows associated with each of the 23 commodities analyzed for this comparison we use commodity flows in tons yr and in the next subsection virtual water flows are evaluated we find that the rf tends to outperform the gm for the training set the rf results in higher kle values than the gm for all commodities fig 3 a with the average kle being 0 74 and 0 39 for the rf and gm respectively similarly errors are smaller for the rf with an average rse of 0 48 compared to 0 87 for the gm fig 3c in terms of the pbias both models have low biases 1 fig 3b although the rf clearly outperforms the gm for the training set the performance is more even for the test set but with the rf still outperforming the gm fig 3 for example the average kle value is 0 48 and 0 40 fig 3a and the average rse value is 0 77 and 0 91 fig 3c for the rf and gm respectively by examining the uncertainty in the evaluation metrics we find that differences in the performance of the rf and gm are significant fig 4 for example the kle boxplots for the rf and gm do not overlap at the individual commodity level fig 4a indicating that differences in the kle values for the gm and rf are significant likewise for the rse the rf tends to display significantly smaller errors than the gm for all commodities fig 4c although the median pbias is similar for both the gm and rf the interquartile range tends to be narrower for the rf fig 4b suggesting the pbias values are more stable and predictions more consistent for the rf the relative difference in performance between the gm and rf is comparable across commodities for instance the linear correlation between the kle values for the gm and rf is 0 41 p value 0 05 and 0 76 p value 0 01 for the training and test set respectively this indicates that the explanatory variables have a similar effect on the performance of both models i e both models tend to perform better for the same set of commodities this also means that the performance gains from the rf relative to the gm are mainly attributed to the improved performance of the rf algorithm both models however show substantial performance variability across commodities for example the median kle range is 0 10 0 55 and 0 50 0 80 respectively for the gm and rf fig 4a the performance of the gm and rf is likely affected by several factors based on previous findings wang et al 2015 ajiboye et al 2015 masucci et al 2013 some likely factors are the association between the explanatory variables and the response variable the connectivity of the network and the distribution of the response variable using the training set we examine the role played by each of these factors on the gm and rf performance in general model performance is enhanced as the association between the explanatory variables and response variable increases to analyze this we determine the nonlinear correlation székely et al 2007 between each explanatory variable and the response variable and select the explanatory variable with the maximum nonlinear correlation for each commodity the maximum nonlinear correlation is then used to measure the association between the explanatory variables and based on the kle model performance we find that this association is weak and non significant with linear correlation values of 0 17 p value 0 45 and 0 28 p value 0 19 for the gm and rf respectively therefore the performance of the models is not dominated by a single explanatory variable alone we use density to measure network connectivity for each network density is calculated as the total number of links divided by the total number of nodes there is a positive linear correlation between the kle and the networks density with values of 0 41 p value 0 05 and 0 13 p value 0 55 for the gm and rf respectively the weaker correlation for the rf is likely due to the use of bootstrap sampling which tends to reduce the sensitivity of the response variable to the training sample in contrast the strong positive correlation for the gm indicates that its performance is somewhat dependent on the sample size i e as the number of links increases higher density the performance of the model tends to improve since this type of sample size dependency reduces the applicability of a model this is a benefit of the rf compared to the gm to examine the role of the flow distributions on model performance we use the gini index we find that the value of the gini index is high 0 75 for all commodities suggesting that flows tend to be heterogeneous however the linear correlation between the gini index and kle is low and non significant with values of 0 12 p value 0 59 and 0 20 p value 0 36 for the gm and rf respectively this indicates that the flow distributions do not play a dominant role in model performance this is consistent with the fact that both the ppml estimator and the rf do not make assumptions about the underlying distribution of the data in summary based on the 3 factors considered only network connectivity plays a significant role in the case of the gm all the other factors have a non significant effect on the performance of both the gm and rf therefore the performance of the models seems to mostly depend on the way the different explanatory variables are utilized by the algorithms this is explored further in the next subsection by quantifying the importance of the explanatory variables 3 2 assessing the importance of explanatory variables for both the trained gm and rf geographical distance is the most influential variable in the prediction of commodity flows for example its average importance is 29 for the rf with the next variable the number of establishments at the origin region having an importance of 14 table s6 the gm and rf however tend to differ on the importance assigned to other explanatory variables for both models table s6 shows the ranking of all the explanatory variables for each commodity the large influence of geographical distance on our flow predictions is not surprising as this is often the case for spatial networks barthélemy 2011 the negative coefficient for geographical distance in the gm table s6 means that inter regional trade is more intense between neighboring regions than distant ones which agrees with the fact that transportation costs distance tend to act as a friction factor on trade following geographical distance the next explanatory variable with the highest importance is gdp and the number of establishments for the gm and rf respectively which underscores a relevant distinction between the two models the gm relies on an aggregate measure of production gdp to make predictions whereas the rf relies on more granular establishment data which varies from commodity to commodity this greater ability to take advantage of finer firm level data is a benefit of the rf since it suggests the algorithm may be able to account for unique features in each commodity class based on the gm the coefficients for gdp and number of establishments are mostly positive table s6 this simply confirms the intuition that trade increases with economic growth and employment the number of establishments at the origin region also tends to be a significant explanatory variable for the gm table s6 for the rf however the number of establishments at both the origin and destination region are important by using industry information at both the origin and destination region the rf may be better at capturing inter industries flows than the gm this could be useful in the future for building computable general equilibrium models since they typically utilize inter industry flows as a model input wittwer 2017 tanner 2006 likewise for agricultural land recall that this explanatory variable is only used for agricultural commodities the rf takes advantage of the information provided by this variable at both the origin and destination region table s6 in fact for the rf adding the percent importance of agricultural land at both the origin and destination results in this variable being as or more important than distance for the agricultural commodities table s6 in contrast the gm does not use the agricultural land variable in predicting flows with the exception being cereal grains at the origin region table s6 3 3 effect of the flow type on model performance the goal with this analysis is to assess whether the flow type can influence or biased the results from our modeling experiments we are concerned with 3 different flow types commodities tons yr virtual water m3 yr and money usd yr hereafter we only use the rf since it outperforms the gm using our three evaluation metrics we find that model performance varies with the flow type at the individual commodity level for both the training and test set fig 5 for instance based on the training set the kle is equal to 0 60 and 0 90 for milled grains in units of tons yr and m3 yr respectively while equal to 0 60 and 0 85 for pharmaceutical products in tons yr and usd yr respectively fig 5 despite the variability of the evaluation metrics across flow types at the individual commodity level fig 5 the metrics show positive and significant correlations between the different flow types these linear correlation values are summarized in table s7 of the supporting information the correlation values in table s7 indicate that overall the flow predictions tend to behave similarly independently of the flow type by examining the average performance from all commodities we find the performance is comparable among the three flow types for the training set the average kle for flows in units of tons yr m3 yr and usd yr is 0 74 0 76 and 0 77 respectively and the average rse is 0 48 0 46 and 0 36 respectively fig 5 similarly for the test set the average kle for flows in units of tons yr m3 yr and usd yr is 0 48 0 49 and 0 48 respectively while the average rse is 0 78 0 78 and 0 71 respectively fig 5 this indicates that if one is interested in using a consistent model to predict virtual water flows for a wide range of commodities the flow type may be a lesser concern that is one can either choose to predict virtual water flows directly or alternatively predict commodity flows first and then convert those to virtual water flows however if one is only interested in a particular commodity or group of commodities then the selection of the flow type may be an important concern as it can influence model performance since this study deals with predictions for different commodities a single flow type is used to perform the modeling experiments to broaden the applicability of our results the experiments are performed using commodity flows given that commodity flows are used to compute embodied virtual flows for different environmental variables e g water energy nutrients and co2 li et al 2019 kanemoto et al 2016 weinzettel et al 2014 hoekstra and mekonnen 2012 3 4 effect of commodity and spatial aggregation on model performance for our first and second modeling experiment we find that aggregating commodities or regions enhances the performance of the rf fig 6 recall that for the first experiment we aggregate commodities into two groups food related and durable commodities the rf performance improves for the aggregated commodities compared to the average performance of individual commodities table s8 for instance the kle and rse for the test set improve by 28 and 5 respectively for the aggregated commodities relative to average performance of the baseline rf for individual commodities fig 6d and f the baseline model refers to the rf previously used in the comparison with the gm the improved performance for the aggregated commodities is most likely due to an increase in the sample size for example the network associated with the food related group consists of 11 307 weighted links compared to 4 004 which is the average number of weighted links for the individual food related networks similarly the network of aggregated durable commodities consists of 16 395 weighted links while for the individual durable networks the average number of weighted links is 10 692 this indicates that all else being equal datasets formed by more disaggregated commodities than the faf4 will likely experience a decline in performance it also suggests that additional explanatory variables than the ones used here might need to be considered when dealing with more disaggregated commodity networks for the second modeling experiment we compare the rf predictions at the faf4 and state level the performance of the rf increases for the state level predictions based on the kle the increased performance relative to the baseline faf4 level rf is 11 and 17 for the training and test set respectively fig 6a and d in terms of the rse the error reduction due to spatial aggregation the state level predictions is 26 and 16 for the training and test set respectively fig 6c and f little or no gains in the pbias are obtained for the state level predictions fig 6b and e a detailed comparison of the faf4 level and state level predictions for individual commodities is shown in figure s2 the enhanced performance from spatial aggregation is likely due to the commodity flows being less heterogeneous at the state level for instance the average coefficient of variation is equal to 5 and 3 for the faf4 and state level commodity flows respectively based on the training set the enhanced performance of the rf for the spatially aggregated commodity networks highlights challenges when trying to predict flows for more spatially disaggregated networks it suggests that using models built at a coarser level of aggregation to make predictions at a finer spatial resolution will likely result in degraded model performance and larger errors this is important because recent approaches are in part aimed at increasing the spatial resolution of empirical commodity flows lin et al 2019 rushforth and ruddell 2018 for such approaches to be robust they will need to pay attention to the fact that when using regression based predictions model performance and errors may vary significantly between different levels of network aggregation 3 5 prediction of both network links and weights in the third modeling experiment we compare the baseline rf against a two stage rf for each commodity network the two stage approach first uses the rf classifier to predict the presence of directed links and then the rf regressor to predict the weights for those links for both the training and test set we find that the two stage and baseline rf perform similarly in terms of our 3 evaluation metrics fig 6 for instance based on the average kle the performance change between the baseline and two stage rf is nearly negligible 1 for the training and test set fig 6a and d likewise for the pbias and rse the performance change is small the value of the evaluation metrics for individual commodities is included in the supporting information figure s3 the main reason for the similarity in performance between the two stage and baseline rf is the high accuracy of the rf classifier across all commodities the link predictions from the rf classifier result in high as values ranging from 0 86 to 1 00 in the training set and from 0 77 to 0 97 in the test set table s9 this means that the explanatory variables capture well the connectivity of the commodity networks that is the explanatory variables are highly effective at predicting the presence or absence of a link between any pair of nodes but less so at predicting the flow through a link similar results have been reported for international trade flows tuninetti et al 2017 because of the high accuracy of the rf classifier in predicting the topology of the commodity networks we suggest that the networks connectivity is equally influenced by common and shared nationwide factors such factors are sufficiently represented by our explanatory variables i e the location and spatial geography of firms establishments population density gdp and agricultural land use in contrast the weight predictions for the different commodity networks do not response as strongly to the explanatory variables because they may be more influenced by local factors and constraints that are difficult to represent with available nationwide variables in addition the prediction of links might be facilitated in this case by redundancies in the underlying transportation infrastructure required to move the commodities between regions as it implies more stable network topologies that is there are multiple alternatives to get from an origin region to a destination region because of the high connectivity of the transportation network in the us gastner and newman 2006 for the faf4 networks this implies that even if the specific origin destination route traveled by a commodity changes often the link connecting the origin and destination region might not change as frequently 3 6 using past flows to enhance model performance for our fourth modeling experiment we use a time dependent rf to enhance predictions the time dependent rf consists of using past empirical flows for 2007 as an additional explanatory variable to predict flows for 2012 while the performance of the time dependent and baseline rf is comparable for the training set the time dependent rf enhances predictions for the test set fig 6 for example the average kle increases by 18 for the time dependent rf relative to the baseline rf in the test set fig 6d likewise for the rse the time dependent rf reduces errors on average by 11 fig 6f in terms of the pbias the improvements from the time dependent rf are small 1 5 fig 6e based on the values of the evaluation metrics we find that the inclusion of past flows as an additional explanatory variable tends to improve the rf predictions figure s4 performing this experiment with the gm also results in improved predictions but the improvements are greater for the rf relative to the gm the performance improvement in terms of the average kle is 27 greater for the rf the ability of the time dependent rf to enhance predictions can be explained by the high similarity between the 2007 and 2012 flows for instance the linear correlation between the kle values for the predicted commodity networks and the linear correlation between the 2007 and 2012 flows is positive and significant for both the training 0 54 p value 0 01 and test set 0 80 p value 0 01 this means that the performance of the time dependent rf tends to be high when the association between the 2007 and 2012 flows is also high moreover in the time dependent rf the 2007 flows is the explanatory variable with the highest importance in most commodities table s10 that is the 2007 flows is the variable that contributes the most to the reduction of errors and therefore it is being used by the rf algorithm more frequently than other variables to split nodes in the rf s trees the average importance value for the 2007 flows is 47 followed by distance with an average importance value of 14 the high contribution of past flows to the rf predictions supports our previous observation that network links do not change as often and tend to be stable it also suggests that the factors determining the network weights may be fairly consistent over time so that past flows contain useful information for improving current predictions 3 7 prediction of annual virtual water networks over time for our case study we use the baseline rf to predict annual virtual water networks for individual commodities during 2013 2018 we find the rf temporal predictions are comparable to the faf4 modeled data table s11 in the supporting information shows the evaluation metrics for each year and commodity network calculated based on the faf4 modeled data taking the faf4 modeled outputs as empirical values for example the average kle and rse from all commodities is 0 63 and 0 61 respectively in 2013 table s11 however differences in the values of the evaluation metrics tend to grow over time indicating the performance of the rf and faf4 diverges over time for instance the range of kle values for all commodities is 0 46 0 77 in 2013 and 0 40 0 69 in 2018 table s11 without empirical data for 2013 2018 however the effect of such divergence on the rf predictions cannot be further assessed in the future assuming empirical data become available one could evaluate whether an ensemble of rf and faf4 predictions is a viable approach for enhancing performance although there are differences between the rf and faf4 predictions over time fig 7 both seem to capture similar temporal variations and trends in the virtual water flows in fig 7 we show the in strength inflows and out strength outflows of virtual water flows for different commodities and regions for example for the remainder of south carolina and virginia the virtual water inflows for cereal grains tend to increase during 2012 2013 and decline during 2013 2018 in both the rf and faf4 predictions fig 7a and b while for los angeles processed food shows a monotonically increasing trend over time in both the rf and faf4 predictions fig 7c the relative variations between the rf and faf4 predictions are also similar for virtual water outflows fig 7d f overall our benchmarking of the rf predictions with the faf4 modeled data supports the use of rf to reconstruct annual virtual water networks for individual commodities there are several possible applications for such reconstructed temporal data one application area is in assessing the changing pressure of economic activity on water consumption which could be useful in the future for addressing local and regional water scarcity issues daniels et al 2011 for instance the supply of meat from the remainder of california to other us regions increased virtual water flows by 7 during 2012 2018 fig 7f this increase is solely attributed to rising meat supply since the virtual water content values stay the same during the study period the increasing meat supply trend in california tracks the overall trend for the us during 2012 2018 usda nass 2020 in addition this period largely coincides with the 2011 2017 california drought lund et al 2018 one of the largest droughts on record for the state thus while california was battling the 2011 2017 drought it was also simultaneously transferring virtual water to other regions in the country through domestic meat exports figure s5 for the remainder of california the rf predictions show a decrease in virtual water for fruits and vegetables during 2014 2017 while the faf4 predictions only show a decline during 2016 2017 fig 7e based on reports from the california agricultural statistics review california department of food and agriculture 2017 2016 agricultural sales in the state experienced a steep decline during 2014 2016 mostly due to drought conditions with the maximum change being 17 this information matches more closely our rf temporal predictions than the faf4 modeled data fig 7e it also shows that the predicted time series may be able to capture the effect of drought induced shocks on commodity and virtual water flows the effect of drought induced shocks is also likely reflected in the virtual water inflow declines in the remainders of south carolina and virginia in fig 7a and b respectively these states rely heavily on cereal grains imports from the southeast and midwest regions of the us figure s6 which experienced multiple drought episodes during 2012 2017 rippey 2015 williams et al 2015 park williams et al 2017 there might be however network configurations that allow some regions to reduce the negative effects of drought induced shocks for example the ability of los angeles to sustain increasing virtual water inflows through processed food during the california drought of 2011 2017 is likely due to its diverse and large number of trading partners rushforth and ruddell 2016 figure s7 having a large number of trading partners could potentially make los angeles more resistant to drought induced shocks through compensatory effects this represents another area of research that could be explored in the future using the temporal commodity and virtual water flow data to summarize the temporal variations of virtual water flows across the us we calculate the coefficient of variation cov of the food related virtual water inflows fig 8 a and outflows fig 8b during 2013 2018 the cov of virtual water inflows is relatively small 10 for the majority of regions these are regions where using an average estimate of virtual water flows which is an assumption often made in the absence of temporal data is likely to have a small impact on accuracy there are however some regions with high 20 cov values such as the remainder of louisiana and nevada tucson vermont and several cities along the gulf coast fig 8a these are regions that might be particularly exposed to food related shocks and sudden changes in water consumption outside their boundaries since their virtual water inflows vary over a broad range of values relative to their average inflows in terms of virtual water outflows temporal variations tend also to be small 10 for most regions with the exception being mainly a few cities such as baton rouge tucson and tulsa fig 8b these outflow regions with high cov values are locations where changes in economic activity may result in substantial variations in water consumption these might be places of special concern for water management purposes since their water consumption can fluctuate widely as food production changes in general the cov of virtual water outflows tends to be higher in eastern and southern regions and along the west coast fig 8b which are locations where population is high or water scarcity is a regional concern these drivers of virtual water flow change seem to be captured by the reconstructed temporal data this kind of analysis could be expanded in the future to evaluate multiple drivers and assess their relative importance e g by combining the reconstructed temporal networks with input output economic data gomez et al 2020 4 summary and conclusion in this study we evaluate the ability of a machine learning algorithm to enhance predictions of virtual water flow networks for various commodities across the us for the machine learning algorithm we use rf since it has been successfully used before in several other water resources applications virtual water flows are typically estimated using commodity flow data commodity flow data are used in the estimation of different embodied virtual flows such as air quality pollutants greenhouse gases energy nutrients etc in addition commodity flows are a key input for computable general equilibrium models which are widely used to assess the environmental implications of economic policy and technological changes therefore the prediction of commodity flows is important beyond applications to virtual water time series of commodity flow networks are critically needed to better understand the drivers and evolution of domestic virtual water and other embodied flows this study provides a comprehensive model evaluation for successfully reconstructing such temporal data although our approach is tested within the us the methods are general so that they could be applied in other locations as long as the necessary data are available the necessary data include within country commodity flows virtual water content and a set of explanatory variables for each commodity class to evaluate the quality of the rf predictions we compare the rf against a gm since gms are a common approach used to predict commodity flows we find that rf can enhance commodity flow predictions beyond what is possible with a state of the art gm the rf improves predictions during both training and testing by increasing the goodness of fit and reducing both errors and biases moreover differences in the evaluation metrics between the rf and gm tend to be significant we also find that the performance of the rf is consistent across flow types predictions are on average similar independently of using physical commodities virtual water or money however there are variations in performance at the individual commodity level that might be important if interest lies in predicting a specific commodity or group of commodities by assessing the importance of explanatory variables and performing 4 different modeling experiments we highlight benefits of using machine learning and clarify several challenges in commodity flow prediction when compared to the gm the rf relies more heavily on explanatory variables that vary from commodity to commodity this suggests the rf is more likely to capture the uniqueness of each commodity flow network the modeling experiments show that rf predictions improve by aggregating commodities or regions into coarser groups and by using past flows to predict current ones these results suggest that obtaining more disaggregated commodity networks than the faf4 level will be generally challenging without compromising model performance using the rf to predict both network links and weights we find the topology of the commodity flow networks is highly predictable that is the challenge is not in identifying the presence or absence of a link between pair of nodes but in predicting the flow through a link with the case study we demonstrate that it is possible to use rf to reconstruct annual virtual water networks in the us the reconstructed temporal data may be used to better understand the drivers of virtual water for our case study we find that virtual water temporal variations can be large for some us regions and that drought induced supply shocks may explain some of that variation such virtual water flow variations may be used in the future to identify and analyze shock prone regions or assess the exposure of regions to water consumption changes outside their boundaries although this study uses rf as the machine learning algorithm it is possible that more recent decision tree based algorithms such as extreme gradient boosting chen and guestrin 2016 and extremely randomized trees geurts et al 2006 could lead to even better performance than demonstrated by rf future work could compare these different algorithms using rf as a benchmark author statement all authors contributed to the conceptualization analysis of results and writing of the paper fiorella oreggioni and alfonso mejia developed the methodology fiorella oreggioni built the models generated the results and created the figures declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we are thankful to the two anonymous reviewers for their constructive comments which helped improve the paper computations for this research were performed on the pennsylvania state university s institute for computational and data sciences roar supercomputer supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103819 appendix supplementary materials image application 1 image application 2 
362,to consider the non darcian nature of groundwater flow and the permeability reduction owing to well and aquifer clogging an izbash s law based analytical model with a time dependent hydraulic conductivity function is proposed for constant rate recharge and constant head recharge by means of linearization approximations variable substitutions and the laplace transform approximate analytical solutions for the model are derived comparison of developed approximate analytical solutions with numerical solutions indicates that the approximate solutions are highly accurate except during the short period of initial recharge stage the proposed model provides a theoretical basis for managed aquifer recharge involving clogging related permeability reduction and non darcian flow keywords artificial recharge non darcian flow confined aquifers permeability reduction 1 introduction it has been well understood that the clogging in the well pipe and its close vicinity is one of the most commonly seen difficulties restricting the application of managed aquifer recharge mar using aquifer injection wells because the clogging generally exists in the immediate well vicinity the clogging zone can thus be regarded as a type of well skin which also can be caused by well construction and or development yang and yeh 2005 it seems that the first model considering the skin effect was pioneered by van everdingen 1953 by introducing a skin effect factor later hawkins 1956 modified the skin effect factor in van everdingen s formula by incorporating a realistic skin radius thereafter a considerable number of analytical or semi analytical models including the well skin either infinitesimal or finite thickness type have been developed cassiani et al 1999 chang and chen 1999 chiu et al 2007 feng and zhan 2016 2019 markle et al 1995 novakowski 1993 wen et al 2011 yang and yeh 2002 2005 yeh et al 2003 to the best of our knowledge however all the aforementioned models have assumed a constant hydraulic conductivity of the well skin zone which fail to include the temporally variable permeability of the skin zone owing to the clogging induced pore void evolution to reflect the clogging effect on aquifer permeability some empirical permeability models have been developed based on laboratory or field tests for instance bianchi et al 1978 developed an exponentially decayed model to consider the clogging due to suspended particles on the media permeability based on a horizontal column laboratory test he et al 2002 also proposed an exponentially reduced permeability model based on the geothermal injection field test which can be regarded as the special case of bianchi et al 1978 model when the asymptotic hydraulic conductivity reduces to zero in some recently published literature these empirical models have been incorporated into the classical well hydraulics models e g theis model 1935 and hantush model hantush 1961 to investigate the clogging related permeability reduction effect on the flow dynamics in the recharged aquifer he et al 2003 liu et al 2016b li et al 2019 2020a 2020b however these studies assume the permeability reduction occurs in the entire flow domain this assumption may not be realistic in most circumstance because ample evidence indicates that the clogging primarily exists in the immediate well vicinity with a thickness of millimeters to centimeters du et al 2018 houben et al 2018 huisman and olsthoorn 1983 besides the clogging related permeability reduction the non darcian groundwater flow is another essential issue that should be addressed in the well vicinity where the flow velocity is extremely large deviation from darcy s law can be observed and the flow becomes non darcian to address the non darcian flow issue a series of empirical or semi empirical formulas have been proposed to quantify the relationship between the hydraulic gradient and the specific discharge among which izbash s law 1931 may be one of the most commonly used two the other one is forchheimer s law 1901 because of its excellent convenience in simulating the non darcian flow due to turbulent effect and significant advantage in obtaining an analytical solution ikoku and ramey 1979 liu et al 2016a odeh and yang 1979 wen et al 2008a 2008b up to now however the published izbash s law based analytical models are almost all developed for the constant rate recharge crr without considering the constant head recharge chr meanwhile to the best of our knowledge the transient modeling for well hydraulics simultaneously incorporating the clogging related permeability reduction and non darcian flow is also missing in literature to address the aforementioned issues the present study focuses on the modeling of well hydraulics in well vicinity for both crr and chr tests to include the combined effect of well and aquifer clogging and non darcian flow the aquifer hydraulic conductivity near the test well is assumed to be exponentially reduced with time because of clogging and the radial groundwater flow in this region is assumed to follow the post linear izbash s law by successively adopting the linearization procedure variable substitution and laplace transform the approximate solutions for the proposed model in laplace domain are developed thereafter the laplace domain solutions are inverted numerically using the stehfest method to yield the real time domain solutions which are then compared with numerical solutions the developed model provides a straightforward way for the quantitative assessment of groundwater flow dynamics in well vicinity under the combined effect of clogging and non darcian flow and offers a theoretical basis for designing and redeveloping aquifer injection wells for mar 2 problem statement and mathematical model 2 1 problem statement the present study focuses on the groundwater flow dynamics in the immediate vicinity of an injection well during crr and chr tests the investigation of this issue mainly involves two essential concerns with the first one being well and aquifer clogging because the clogging will always lead to a continuous reduction of the aquifer permeability around the test well it is reasonable to assume a gradually decreased permeability for the clogging zone here the exponentially reduced permeability model developed by bianchi et al 1978 is adopted to reflect the clogging effect on aquifer permeability which can be expressed as 1 k t k k 0 k exp λ t in which k 0 and k respectively denote the initial and asymptotic hydraulic conductivity values lt 1 λ implies the permeability reduction rate t 1 the choice and applicability of eq 1 are also generally supported in laboratory testing and numerical modeling reddi et al 2000 2005 zheng et al 2014 a point to note is that eq 1 only considers the temporal variation of the clogging related permeability without the spatial variation thus the calculated k value by eq 1 should be understood as the volume averaged or equivalent k value of the clogging region instead of a point specific one besides owing to the extremely steep hydraulic gradients in the immediate vicinity of the well the groundwater flow can deviate from darcy s law which constitutes the second concern for the modeling of hydraulic dynamics in the well vicinity to address this issue non darcian flow around the injection well is assumed to follow the post linear izbash equation 1931 in this study which states that the hydraulic gradient is a power function of the specific discharge meanwhile taking the clogging related permeability reduction into account substituting eq 1 into the izbash equation leads to 2 q r t n k k 0 k exp λ t h r t r where q r t denotes the specific discharge lt 1 n is the non darcian exponent ranging from 1 to 2 and denotes the deviation from darcy s law the izbash equation with a constant n has been justified as an effective tool for the non darcian flow dynamics near the well in some previous studies for groundwater extraction feng and wen 2016 houben 2015 sen 1988 1989 2000 wen et al 2008c here we deem this conclusion also holds true for the present study and will present additional elaboration about the applicability of the izbash equation and its limitation in the discussion section section 3 2 2 2 mathematical model a schematic cross section of the investigated well and aquifer configurations is depicted in fig 1 the horizontal confined aquifer with a constant thickness b l exists between two impermeable formations and is fully penetrated by an injection well with a finite radius r w l around the injection well is a homogeneous and isotropic skin zone of a constant thickness r c r w l caused by well and aquifer clogging a cylindrical coordinate system is adopted with the origin at the intersection of aquifer bottom and well center and the horizontal r axis being positive toward infinity the continuity equation in the clogging zone can be described as wen et al 2008b 2008c 3 q r t r q r t r s b h r t t where h r t is the hydraulic head increment or build up l at time t t and radial distance r l respectively s is the storage coefficient of the clogging region dimensionless based on the assumptions in the last section substituting eqs 1 and 2 into eq 3 leads to 4 k t n q r t n 1 2 h r t r 2 k t r q r t n 1 h r t r s b h r t t the clogging region is hydrostatic before the test starts 5 h r 0 0 the well radius is sufficiently small so that the wellbore storage can be neglected thus for a test with a constant injection rate q or a constant injection head h w the boundary condition at the well face can be respectively described as 6 lim r r w 2 π r b q r t q 7 lim r r w h r t h w during the test the total injection rate can be approximately decomposed into two components with the first one being the storage term remaining in the clogging zone and the second one being the injection term flowing into the formation zone outside the clogging zone at early times most of the injection water is stored in the clogging zone whereas the water flowing into the formation zone almost equals to zero as injection proceeds the storage term in the clogging zone continually decreases while the injection term flowing into the formation zone becomes increasingly larger at some point the first term reduces to zero and the second term namely the flux through the interface between clogging zone the formation zone outside the clogging equals to the injection rate the above mentioned procedure is quite similar to the groundwater injection using a large diameter well with wellbore storage and the groundwater flow in the formation zone outside the clogging zone is assumed to follow darcy s law and will finally reach a steady state then one can approximately obtain the hydraulic dynamics outside the clogging zone using some previously developed solutions feng and zhan 2019 wen et al 2017 for the pumping using a large diameter well considering wellbore storage thus the boundary condition at the outer boundary of the clogging zone for the crr and chr tests can be respectively described as 8 lim r r c h r t l 1 q p ζ r c p 9 lim r r c h r t l 1 q p ζ r c p in which 10 ζ r c p i 0 α r k 0 α r c k 0 α r i 0 α r c i 0 α r φ k p k 0 α r φ i p where φ k p π r c 2 p k 0 α r c 2 π r c k 0 b α k 1 α r c φ i p π r c 2 p i 0 α r c 2 π r c k 0 b α i 1 α r c rc is the radius at the outer boundary of the clogging zone p is the variable in laplace domain r is the influence radius l of the well and when r r the hydraulic head change can be ignored l 1 denotes the inverse laplace transform α s p k 0 b i 0 and i 1 are respectively the first kind of the modified bessel functions with the zeroth and first order k 0 and k 1 are respectively the second kind of the modified bessel functions with the zeroth and first order additional elaboration about the validation of the aforementioned outer boundary condition and its limitation will be presented in the discussion section section 3 2 2 3 approximate solutions in laplace domain obviously eq 4 is of high linearity owing to the nonlinear term q r t n 1 it is impractical to solve eq 4 analytically under the present conditions to address this issue the linearization procedure which neglects the aquifer storage release absorption and assumes the same flux q s at each cylindrical cross section ikoku and ramey 1979 liu et al 2016a odeh and yang 1979 wen et al 2008a 2008b 2008c is adopted the nonlinear term after linearization can be expressed as 11 q r t n 1 q s 2 π r b n 1 in crr tests q s equals to the constant injection rate q whereas in chr tests q s reduces gradually with time and eventually approaches a stable value developing the exact expression for q s in chr tests however is quite difficult and contributes little for the analytical tractability of eq 4 therefore for the sake of mathematical convenience q s in chr tests is approximately equal to the late time injection rate which can be determined after a couple of iterations using the derived solution subsequently detailed elaboration about the accuracy of such an approximation will be presented in the next section accepting this assumption and substituting eq 11 into eq 4 leads to 12 2 h r t r 2 n r h r t r n k t q s 2 π r b n 1 s b h r t t to solve the partial differential equations similar to eq 12 the laplace transform is the most commonly used tool ikoku and ramey 1979 odeh and yang 1979 wen et al 2008a 2008b 2008c yang and yeh 2002 2005 yeh et al 2003 at present however because of the term k t on the right hand side of eq 12 it is difficult to conduct the laplace transform on eq 12 directly to address this issue the following variable substitution is performed 13 t k k 0 t k 0 k 1 e λ t λ k 0 substituting eq 13 into the governing equation eq 12 and the initial and boundary conditions eqs 5 9 and applying the linearization procedure to the solution conditions yield 14 2 h r t r 2 n r h r t r n k 0 q s 2 π r b n 1 s b h r t t 15 h r 0 0 16 lim r r w h r t r 1 k t q 2 π r w b n 17 lim r r w h r t h w 18 lim r r c h r t l 1 q 2 π r c k 0 b p ζ r c p δ h 1 r c t 19 lim r r c h r t l 1 q s 2 π r c k 0 b p ζ r c p δ h 2 r c t where δh r c t is the hydraulic head difference due to the variable substitution and equals to h r c t h r c t which can be approximated using a exp α1 t exp α2 t in which a α 1 and α 2 are fitting parameters k t denotes the permeability reduction rate along t and 1 k t can be approximated by fitting the data of k t using a piece wise function as follows 20 1 k t b 1 b 2 exp β 1 t 0 t t 1 b 3 b 4 exp β 2 t t 1 t t 2 b 5 b 6 exp β 3 t t 2 t in which bi i 1 2 3 4 5 6 and βi i 1 2 3 are fitting parameters the laplace transform with respect to t is adopted to solve the developed model after a series of mathematical derivations the approximate solutions in laplace domain for hydraulic head increment at the clogging zone due to crr and chr can be obtained as the detailed derivations can be found in supplementary materials 21 h r p r 1 n 2 c 1 p i 1 n 3 n ξ r p c 2 p k 1 n 3 n ξ r p where overbar represents terms in laplace domain hereinafter ξ r p 2 3 n r 3 n 2 δ p δ p s n p b k 0 q 2 π b n 1 iv and kv are the first and second kinds of the modified bessel functions with the v th order respectively c 1 p and c 2 p in a crr test can be described as 22a c 1 p h c r r r c p r c 1 n 2 k 2 3 n ξ r w p k 1 n 3 n ξ r c p k p r w δ p q 2 π b n i 2 3 n ξ r w p k 1 n 3 n ξ r c p i 1 n 3 n ξ r c p k 2 3 n ξ r w p 22b c 2 p h c r r r c p r c 1 n 2 i 2 3 n ξ r w p i 1 n 3 n ξ r c p k p r w δ p q 2 π b n i 2 3 n ξ r w p k 1 n 3 n ξ r c p i 1 n 3 n ξ r c p k 2 3 n ξ r w p 22c h c r r r c p q 2 π r c k 0 b p ζ r c p a p α 1 a p α 2 22d 1 k p b 1 p 1 e p t 1 b 2 β 1 p 1 e β 1 p t 1 b 3 p e p t 1 e p t 2 b 4 β 2 p e β 2 p t 1 e β 2 p t 2 b 5 p e p t 2 b 6 β 3 p e β 3 p t 2 c 1 p and c 2 p in a chr test can be described as 23a c 1 p h w k 1 n 3 n ξ r c p p r w 1 n 2 h c h r r c p k 1 n 3 n ξ r w p r c 1 n 2 i 1 n 3 n ξ r w p k 1 n 3 n ξ r c p i 1 n 3 n ξ r c p k 1 n 3 n ξ r w p 23b c 2 p h c h r r c p i 1 n 3 n ξ r w p r c 1 n 2 h w i 1 n 3 n ξ r c p p r w 1 n 2 i 1 n 3 n ξ r w p k 1 n 3 n ξ r c p i 1 n 3 n ξ r c p k 1 n 3 n ξ r w p 23c h c h r r c p q s 2 π r c k 0 b ζ r c p a p α 1 a p α 2 based on the developed solutions one can further obtain the quasi solutions at early and late times and steady state and some simplified solutions ignoring the one or both of the clogging related permeability reduction and non darcian flow the details are documented in supplementary materials the newly developed solutions for crr and chr tests are expressed in laplace domain and are difficult to analytically inverse thus the numerical inverse laplace transform is adopted here as demonstrated in many previous studies feng and wen 2016 feng and zhan 2016 wen et al 2008a 2011 the stehfest method stehfest 1970a 1970b is sufficiently accurate to obtain the real time domain solutions for non dacian groundwater flow dynamics and hence will be adopted in this study as well 3 results and discussion 3 1 verification in the derivation of the developed solutions some approximations including the linearization and fitting procedures have been involved to investigate the effect of these approximations and the accuracy of the approximate solutions a matlab function pdepe based program is developed to numerically solve the proposed model the details for obtaining the numerical solutions are documented in supplementary materials the related parameters adopted here are given as follows k 0 0 06 m hr k 0 006 m hr λ 0 05 hr 1 r 1000 m s 0 004 b 20 m q 10 m3 hr h w 20 m fig 2 a plots the comparison among the numerically with and without linearization and analytically after linearization calculated time history curves for the increment of hydraulic head in a crr test at a given r the approximate analytical solutions obtained using the linearization procedure and laplace transform always agree perfectly with the approximate numerical solutions with the linearization indicating the correctness of the developed approximate analytical solutions meanwhile the approximate solutions show great agreement with the numerical solutions without linearization disposal for the most of time except at the very early stage during which the analytical ones are slightly smaller than the numerical ones these discrepancies are mainly attributed to the linearization procedure which assumes flow rate at any radial cross section is the same despite the radial distance this assumption is essentially an approximation of the quasi steady flow state and ignores the aquifer storage as a result the hydraulic head increment due to aquifer elastic storage is ignored leading to the underestimation of the change of hydraulic head at the early stage of the test fig 2 b plots the comparison between the numerical with and without linearization and analytical with linearization results of build up curves for a chr test as can be seen the approximate analytical and numerical solutions with the linearization approach match perfectly well with each other proving the validity of the developed semi analytical solutions moreover the solutions both the analytical and numerical ones with the linearization approximation and the numerical solutions without the linearization procedure overlap each other at most time except at the early stage when the approximate solutions are obviously larger this is mainly because the linearization procedure in chr tests assumes q s in eq 11 to be identical at any radial cross section around the well and equals to the late stage injection rate this assumption not only ignores the aquifer storage but also underestimates the injection rate at the early stage under the combined effect of the two approximations the build up in the recharged aquifer is generally overestimated at the early stage 3 2 discussion the above analysis indicates that the linearization approach can induce some errors at the initial stage during both crr and chr tests nevertheless these errors drop to zero with the elapsed time and the approximate analytical solutions become increasingly accurate the linearization procedure is proven to work very well to handle the nonlinear terms in both crr and chr tests besides the linearization approximation two other essential assumptions have also been adopted to make the developed model analytically tractable which deserve further discussion the first assumption is related to the hydraulic head at the outer boundary of the clogging region which essentially regards the clogging zone as a large diameter well considering wellbore storage this assumption honors the difference of the clogging zone near the injection well and the formation zone away from the injection well as two distinctively different zones which are somewhat similar to the two region models discussed before yeh et al 2003 yang and yeh 2005 wen et al 2008c 2015 obviously this assumption only considers effect of the radial thickness of the clogging zone on hydraulic dynamics in the formation zone outside the clogging region but fail to include the effect of clogging and non darcian flow in this region fortunately s the previously developed two region models either those considering the well skin effect yeh et al 2003 yang and yeh 2005 or those considering the non darcian flow issue wen et al 2008c 2015 have demonstrated that the permeability reduction and or non darcian flow in the near well region only marginally affect the hydraulic dynamics in the far well region thus the assumption about the outer boundary condition at the clogging zone adopted in this study can be regarded as sufficiently accurate the second assumption incorporated into the developed model is the use of empirical k t function for clogging related permeability reduction and the constant n for non darcian flow here both k t function and constant n should be understood as the phenomenological approximations of the groundwater flow dynamics with some kinds of spatial averaging in this way the spatial variation of non darcian flow and permeability reduction is considered this consideration is generally accurate if the spatial variety of non darcian flow and permeability reduction is relatively uniform when the k and n fields change rapidly with positions however the phenomenological approximations of k t function and constant n can fail to reflect the real situations of the flow behaviors as a result the developed model based on these phenomenological approximations can be limited for the quantification of groundwater flow dynamics to overcome the aforementioned limitations two possible candidates with the first one being to develop spatiotemporal k and n fields in radial flow and the second one being to divide the flow domain into a hierarchy of multiple regions may be employed in the future study alternatively the spatiotemporal n field can be replaced using non darcian forchheimer s law forchheimer 1901 to implement the two approaches the main difficulty may be to quantify the spatiotemporal k and n fields accurately meanwhile analytically solving these improved models may also be quite challenging if not impossible these issues remain to be further addressed in future studies 4 conclusions in this study an innovative analytical model is developed for the well hydraulics in well vicinity during both crr and chr tests in this model the well and aquifer clogging is considered using an exponentially reduced k t function while the non darcian flow is included using the post linear izbash s law with a constant exponent n the approximate solutions in laplace domain for both crr and chr tests are then developed by adopting the linearization procedure variable substitution and laplace transform successively the comparison among the approximate analytical and numerical solutions with linearization procedure and the numerical solutions without linearization indicate that the developed approximate analytical solutions are sufficiently accurate and only cause acceptable errors at the initial stage of the test the developed model offers a straightforward way to quantitatively assess the well hydraulics around the injection well under the combined effect of clogging and non darcian flow and offers a theoretical basis for designing and redeveloping aquifer injection wells for managed aquifer recharge however the use of empirical k t function and constant n may not work well to phenomenologically approximate the steeply varying k and n fields which becomes the major limitation of the developed model to overcome this limitation including the real spatiotemporal k and n fields into the developed model or developing a hierarchy of multi region model based on the real spatiotemporal k and n fields will be our future work credit authorship contribution statement jiong li writing original draft methodology software formal analysis xiao he xia funding acquisition supervision hongbin zhan formal analysis writing review editing supervision ming guang li formal analysis jin jian chen conceptualization funding acquisition supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment this study was substantially supported by the national natural science foundation of china grant nos 41727802 and 41977216 and by the shanghai rising star program grant no 19qc1400800 the authors thank the editor dr sander associate editor dr yeh and three anonymous reviewers for their critical and constructive comments which help us improve the quality of the paper greatly supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103820 appendix supplementary materials image application 1 
362,to consider the non darcian nature of groundwater flow and the permeability reduction owing to well and aquifer clogging an izbash s law based analytical model with a time dependent hydraulic conductivity function is proposed for constant rate recharge and constant head recharge by means of linearization approximations variable substitutions and the laplace transform approximate analytical solutions for the model are derived comparison of developed approximate analytical solutions with numerical solutions indicates that the approximate solutions are highly accurate except during the short period of initial recharge stage the proposed model provides a theoretical basis for managed aquifer recharge involving clogging related permeability reduction and non darcian flow keywords artificial recharge non darcian flow confined aquifers permeability reduction 1 introduction it has been well understood that the clogging in the well pipe and its close vicinity is one of the most commonly seen difficulties restricting the application of managed aquifer recharge mar using aquifer injection wells because the clogging generally exists in the immediate well vicinity the clogging zone can thus be regarded as a type of well skin which also can be caused by well construction and or development yang and yeh 2005 it seems that the first model considering the skin effect was pioneered by van everdingen 1953 by introducing a skin effect factor later hawkins 1956 modified the skin effect factor in van everdingen s formula by incorporating a realistic skin radius thereafter a considerable number of analytical or semi analytical models including the well skin either infinitesimal or finite thickness type have been developed cassiani et al 1999 chang and chen 1999 chiu et al 2007 feng and zhan 2016 2019 markle et al 1995 novakowski 1993 wen et al 2011 yang and yeh 2002 2005 yeh et al 2003 to the best of our knowledge however all the aforementioned models have assumed a constant hydraulic conductivity of the well skin zone which fail to include the temporally variable permeability of the skin zone owing to the clogging induced pore void evolution to reflect the clogging effect on aquifer permeability some empirical permeability models have been developed based on laboratory or field tests for instance bianchi et al 1978 developed an exponentially decayed model to consider the clogging due to suspended particles on the media permeability based on a horizontal column laboratory test he et al 2002 also proposed an exponentially reduced permeability model based on the geothermal injection field test which can be regarded as the special case of bianchi et al 1978 model when the asymptotic hydraulic conductivity reduces to zero in some recently published literature these empirical models have been incorporated into the classical well hydraulics models e g theis model 1935 and hantush model hantush 1961 to investigate the clogging related permeability reduction effect on the flow dynamics in the recharged aquifer he et al 2003 liu et al 2016b li et al 2019 2020a 2020b however these studies assume the permeability reduction occurs in the entire flow domain this assumption may not be realistic in most circumstance because ample evidence indicates that the clogging primarily exists in the immediate well vicinity with a thickness of millimeters to centimeters du et al 2018 houben et al 2018 huisman and olsthoorn 1983 besides the clogging related permeability reduction the non darcian groundwater flow is another essential issue that should be addressed in the well vicinity where the flow velocity is extremely large deviation from darcy s law can be observed and the flow becomes non darcian to address the non darcian flow issue a series of empirical or semi empirical formulas have been proposed to quantify the relationship between the hydraulic gradient and the specific discharge among which izbash s law 1931 may be one of the most commonly used two the other one is forchheimer s law 1901 because of its excellent convenience in simulating the non darcian flow due to turbulent effect and significant advantage in obtaining an analytical solution ikoku and ramey 1979 liu et al 2016a odeh and yang 1979 wen et al 2008a 2008b up to now however the published izbash s law based analytical models are almost all developed for the constant rate recharge crr without considering the constant head recharge chr meanwhile to the best of our knowledge the transient modeling for well hydraulics simultaneously incorporating the clogging related permeability reduction and non darcian flow is also missing in literature to address the aforementioned issues the present study focuses on the modeling of well hydraulics in well vicinity for both crr and chr tests to include the combined effect of well and aquifer clogging and non darcian flow the aquifer hydraulic conductivity near the test well is assumed to be exponentially reduced with time because of clogging and the radial groundwater flow in this region is assumed to follow the post linear izbash s law by successively adopting the linearization procedure variable substitution and laplace transform the approximate solutions for the proposed model in laplace domain are developed thereafter the laplace domain solutions are inverted numerically using the stehfest method to yield the real time domain solutions which are then compared with numerical solutions the developed model provides a straightforward way for the quantitative assessment of groundwater flow dynamics in well vicinity under the combined effect of clogging and non darcian flow and offers a theoretical basis for designing and redeveloping aquifer injection wells for mar 2 problem statement and mathematical model 2 1 problem statement the present study focuses on the groundwater flow dynamics in the immediate vicinity of an injection well during crr and chr tests the investigation of this issue mainly involves two essential concerns with the first one being well and aquifer clogging because the clogging will always lead to a continuous reduction of the aquifer permeability around the test well it is reasonable to assume a gradually decreased permeability for the clogging zone here the exponentially reduced permeability model developed by bianchi et al 1978 is adopted to reflect the clogging effect on aquifer permeability which can be expressed as 1 k t k k 0 k exp λ t in which k 0 and k respectively denote the initial and asymptotic hydraulic conductivity values lt 1 λ implies the permeability reduction rate t 1 the choice and applicability of eq 1 are also generally supported in laboratory testing and numerical modeling reddi et al 2000 2005 zheng et al 2014 a point to note is that eq 1 only considers the temporal variation of the clogging related permeability without the spatial variation thus the calculated k value by eq 1 should be understood as the volume averaged or equivalent k value of the clogging region instead of a point specific one besides owing to the extremely steep hydraulic gradients in the immediate vicinity of the well the groundwater flow can deviate from darcy s law which constitutes the second concern for the modeling of hydraulic dynamics in the well vicinity to address this issue non darcian flow around the injection well is assumed to follow the post linear izbash equation 1931 in this study which states that the hydraulic gradient is a power function of the specific discharge meanwhile taking the clogging related permeability reduction into account substituting eq 1 into the izbash equation leads to 2 q r t n k k 0 k exp λ t h r t r where q r t denotes the specific discharge lt 1 n is the non darcian exponent ranging from 1 to 2 and denotes the deviation from darcy s law the izbash equation with a constant n has been justified as an effective tool for the non darcian flow dynamics near the well in some previous studies for groundwater extraction feng and wen 2016 houben 2015 sen 1988 1989 2000 wen et al 2008c here we deem this conclusion also holds true for the present study and will present additional elaboration about the applicability of the izbash equation and its limitation in the discussion section section 3 2 2 2 mathematical model a schematic cross section of the investigated well and aquifer configurations is depicted in fig 1 the horizontal confined aquifer with a constant thickness b l exists between two impermeable formations and is fully penetrated by an injection well with a finite radius r w l around the injection well is a homogeneous and isotropic skin zone of a constant thickness r c r w l caused by well and aquifer clogging a cylindrical coordinate system is adopted with the origin at the intersection of aquifer bottom and well center and the horizontal r axis being positive toward infinity the continuity equation in the clogging zone can be described as wen et al 2008b 2008c 3 q r t r q r t r s b h r t t where h r t is the hydraulic head increment or build up l at time t t and radial distance r l respectively s is the storage coefficient of the clogging region dimensionless based on the assumptions in the last section substituting eqs 1 and 2 into eq 3 leads to 4 k t n q r t n 1 2 h r t r 2 k t r q r t n 1 h r t r s b h r t t the clogging region is hydrostatic before the test starts 5 h r 0 0 the well radius is sufficiently small so that the wellbore storage can be neglected thus for a test with a constant injection rate q or a constant injection head h w the boundary condition at the well face can be respectively described as 6 lim r r w 2 π r b q r t q 7 lim r r w h r t h w during the test the total injection rate can be approximately decomposed into two components with the first one being the storage term remaining in the clogging zone and the second one being the injection term flowing into the formation zone outside the clogging zone at early times most of the injection water is stored in the clogging zone whereas the water flowing into the formation zone almost equals to zero as injection proceeds the storage term in the clogging zone continually decreases while the injection term flowing into the formation zone becomes increasingly larger at some point the first term reduces to zero and the second term namely the flux through the interface between clogging zone the formation zone outside the clogging equals to the injection rate the above mentioned procedure is quite similar to the groundwater injection using a large diameter well with wellbore storage and the groundwater flow in the formation zone outside the clogging zone is assumed to follow darcy s law and will finally reach a steady state then one can approximately obtain the hydraulic dynamics outside the clogging zone using some previously developed solutions feng and zhan 2019 wen et al 2017 for the pumping using a large diameter well considering wellbore storage thus the boundary condition at the outer boundary of the clogging zone for the crr and chr tests can be respectively described as 8 lim r r c h r t l 1 q p ζ r c p 9 lim r r c h r t l 1 q p ζ r c p in which 10 ζ r c p i 0 α r k 0 α r c k 0 α r i 0 α r c i 0 α r φ k p k 0 α r φ i p where φ k p π r c 2 p k 0 α r c 2 π r c k 0 b α k 1 α r c φ i p π r c 2 p i 0 α r c 2 π r c k 0 b α i 1 α r c rc is the radius at the outer boundary of the clogging zone p is the variable in laplace domain r is the influence radius l of the well and when r r the hydraulic head change can be ignored l 1 denotes the inverse laplace transform α s p k 0 b i 0 and i 1 are respectively the first kind of the modified bessel functions with the zeroth and first order k 0 and k 1 are respectively the second kind of the modified bessel functions with the zeroth and first order additional elaboration about the validation of the aforementioned outer boundary condition and its limitation will be presented in the discussion section section 3 2 2 3 approximate solutions in laplace domain obviously eq 4 is of high linearity owing to the nonlinear term q r t n 1 it is impractical to solve eq 4 analytically under the present conditions to address this issue the linearization procedure which neglects the aquifer storage release absorption and assumes the same flux q s at each cylindrical cross section ikoku and ramey 1979 liu et al 2016a odeh and yang 1979 wen et al 2008a 2008b 2008c is adopted the nonlinear term after linearization can be expressed as 11 q r t n 1 q s 2 π r b n 1 in crr tests q s equals to the constant injection rate q whereas in chr tests q s reduces gradually with time and eventually approaches a stable value developing the exact expression for q s in chr tests however is quite difficult and contributes little for the analytical tractability of eq 4 therefore for the sake of mathematical convenience q s in chr tests is approximately equal to the late time injection rate which can be determined after a couple of iterations using the derived solution subsequently detailed elaboration about the accuracy of such an approximation will be presented in the next section accepting this assumption and substituting eq 11 into eq 4 leads to 12 2 h r t r 2 n r h r t r n k t q s 2 π r b n 1 s b h r t t to solve the partial differential equations similar to eq 12 the laplace transform is the most commonly used tool ikoku and ramey 1979 odeh and yang 1979 wen et al 2008a 2008b 2008c yang and yeh 2002 2005 yeh et al 2003 at present however because of the term k t on the right hand side of eq 12 it is difficult to conduct the laplace transform on eq 12 directly to address this issue the following variable substitution is performed 13 t k k 0 t k 0 k 1 e λ t λ k 0 substituting eq 13 into the governing equation eq 12 and the initial and boundary conditions eqs 5 9 and applying the linearization procedure to the solution conditions yield 14 2 h r t r 2 n r h r t r n k 0 q s 2 π r b n 1 s b h r t t 15 h r 0 0 16 lim r r w h r t r 1 k t q 2 π r w b n 17 lim r r w h r t h w 18 lim r r c h r t l 1 q 2 π r c k 0 b p ζ r c p δ h 1 r c t 19 lim r r c h r t l 1 q s 2 π r c k 0 b p ζ r c p δ h 2 r c t where δh r c t is the hydraulic head difference due to the variable substitution and equals to h r c t h r c t which can be approximated using a exp α1 t exp α2 t in which a α 1 and α 2 are fitting parameters k t denotes the permeability reduction rate along t and 1 k t can be approximated by fitting the data of k t using a piece wise function as follows 20 1 k t b 1 b 2 exp β 1 t 0 t t 1 b 3 b 4 exp β 2 t t 1 t t 2 b 5 b 6 exp β 3 t t 2 t in which bi i 1 2 3 4 5 6 and βi i 1 2 3 are fitting parameters the laplace transform with respect to t is adopted to solve the developed model after a series of mathematical derivations the approximate solutions in laplace domain for hydraulic head increment at the clogging zone due to crr and chr can be obtained as the detailed derivations can be found in supplementary materials 21 h r p r 1 n 2 c 1 p i 1 n 3 n ξ r p c 2 p k 1 n 3 n ξ r p where overbar represents terms in laplace domain hereinafter ξ r p 2 3 n r 3 n 2 δ p δ p s n p b k 0 q 2 π b n 1 iv and kv are the first and second kinds of the modified bessel functions with the v th order respectively c 1 p and c 2 p in a crr test can be described as 22a c 1 p h c r r r c p r c 1 n 2 k 2 3 n ξ r w p k 1 n 3 n ξ r c p k p r w δ p q 2 π b n i 2 3 n ξ r w p k 1 n 3 n ξ r c p i 1 n 3 n ξ r c p k 2 3 n ξ r w p 22b c 2 p h c r r r c p r c 1 n 2 i 2 3 n ξ r w p i 1 n 3 n ξ r c p k p r w δ p q 2 π b n i 2 3 n ξ r w p k 1 n 3 n ξ r c p i 1 n 3 n ξ r c p k 2 3 n ξ r w p 22c h c r r r c p q 2 π r c k 0 b p ζ r c p a p α 1 a p α 2 22d 1 k p b 1 p 1 e p t 1 b 2 β 1 p 1 e β 1 p t 1 b 3 p e p t 1 e p t 2 b 4 β 2 p e β 2 p t 1 e β 2 p t 2 b 5 p e p t 2 b 6 β 3 p e β 3 p t 2 c 1 p and c 2 p in a chr test can be described as 23a c 1 p h w k 1 n 3 n ξ r c p p r w 1 n 2 h c h r r c p k 1 n 3 n ξ r w p r c 1 n 2 i 1 n 3 n ξ r w p k 1 n 3 n ξ r c p i 1 n 3 n ξ r c p k 1 n 3 n ξ r w p 23b c 2 p h c h r r c p i 1 n 3 n ξ r w p r c 1 n 2 h w i 1 n 3 n ξ r c p p r w 1 n 2 i 1 n 3 n ξ r w p k 1 n 3 n ξ r c p i 1 n 3 n ξ r c p k 1 n 3 n ξ r w p 23c h c h r r c p q s 2 π r c k 0 b ζ r c p a p α 1 a p α 2 based on the developed solutions one can further obtain the quasi solutions at early and late times and steady state and some simplified solutions ignoring the one or both of the clogging related permeability reduction and non darcian flow the details are documented in supplementary materials the newly developed solutions for crr and chr tests are expressed in laplace domain and are difficult to analytically inverse thus the numerical inverse laplace transform is adopted here as demonstrated in many previous studies feng and wen 2016 feng and zhan 2016 wen et al 2008a 2011 the stehfest method stehfest 1970a 1970b is sufficiently accurate to obtain the real time domain solutions for non dacian groundwater flow dynamics and hence will be adopted in this study as well 3 results and discussion 3 1 verification in the derivation of the developed solutions some approximations including the linearization and fitting procedures have been involved to investigate the effect of these approximations and the accuracy of the approximate solutions a matlab function pdepe based program is developed to numerically solve the proposed model the details for obtaining the numerical solutions are documented in supplementary materials the related parameters adopted here are given as follows k 0 0 06 m hr k 0 006 m hr λ 0 05 hr 1 r 1000 m s 0 004 b 20 m q 10 m3 hr h w 20 m fig 2 a plots the comparison among the numerically with and without linearization and analytically after linearization calculated time history curves for the increment of hydraulic head in a crr test at a given r the approximate analytical solutions obtained using the linearization procedure and laplace transform always agree perfectly with the approximate numerical solutions with the linearization indicating the correctness of the developed approximate analytical solutions meanwhile the approximate solutions show great agreement with the numerical solutions without linearization disposal for the most of time except at the very early stage during which the analytical ones are slightly smaller than the numerical ones these discrepancies are mainly attributed to the linearization procedure which assumes flow rate at any radial cross section is the same despite the radial distance this assumption is essentially an approximation of the quasi steady flow state and ignores the aquifer storage as a result the hydraulic head increment due to aquifer elastic storage is ignored leading to the underestimation of the change of hydraulic head at the early stage of the test fig 2 b plots the comparison between the numerical with and without linearization and analytical with linearization results of build up curves for a chr test as can be seen the approximate analytical and numerical solutions with the linearization approach match perfectly well with each other proving the validity of the developed semi analytical solutions moreover the solutions both the analytical and numerical ones with the linearization approximation and the numerical solutions without the linearization procedure overlap each other at most time except at the early stage when the approximate solutions are obviously larger this is mainly because the linearization procedure in chr tests assumes q s in eq 11 to be identical at any radial cross section around the well and equals to the late stage injection rate this assumption not only ignores the aquifer storage but also underestimates the injection rate at the early stage under the combined effect of the two approximations the build up in the recharged aquifer is generally overestimated at the early stage 3 2 discussion the above analysis indicates that the linearization approach can induce some errors at the initial stage during both crr and chr tests nevertheless these errors drop to zero with the elapsed time and the approximate analytical solutions become increasingly accurate the linearization procedure is proven to work very well to handle the nonlinear terms in both crr and chr tests besides the linearization approximation two other essential assumptions have also been adopted to make the developed model analytically tractable which deserve further discussion the first assumption is related to the hydraulic head at the outer boundary of the clogging region which essentially regards the clogging zone as a large diameter well considering wellbore storage this assumption honors the difference of the clogging zone near the injection well and the formation zone away from the injection well as two distinctively different zones which are somewhat similar to the two region models discussed before yeh et al 2003 yang and yeh 2005 wen et al 2008c 2015 obviously this assumption only considers effect of the radial thickness of the clogging zone on hydraulic dynamics in the formation zone outside the clogging region but fail to include the effect of clogging and non darcian flow in this region fortunately s the previously developed two region models either those considering the well skin effect yeh et al 2003 yang and yeh 2005 or those considering the non darcian flow issue wen et al 2008c 2015 have demonstrated that the permeability reduction and or non darcian flow in the near well region only marginally affect the hydraulic dynamics in the far well region thus the assumption about the outer boundary condition at the clogging zone adopted in this study can be regarded as sufficiently accurate the second assumption incorporated into the developed model is the use of empirical k t function for clogging related permeability reduction and the constant n for non darcian flow here both k t function and constant n should be understood as the phenomenological approximations of the groundwater flow dynamics with some kinds of spatial averaging in this way the spatial variation of non darcian flow and permeability reduction is considered this consideration is generally accurate if the spatial variety of non darcian flow and permeability reduction is relatively uniform when the k and n fields change rapidly with positions however the phenomenological approximations of k t function and constant n can fail to reflect the real situations of the flow behaviors as a result the developed model based on these phenomenological approximations can be limited for the quantification of groundwater flow dynamics to overcome the aforementioned limitations two possible candidates with the first one being to develop spatiotemporal k and n fields in radial flow and the second one being to divide the flow domain into a hierarchy of multiple regions may be employed in the future study alternatively the spatiotemporal n field can be replaced using non darcian forchheimer s law forchheimer 1901 to implement the two approaches the main difficulty may be to quantify the spatiotemporal k and n fields accurately meanwhile analytically solving these improved models may also be quite challenging if not impossible these issues remain to be further addressed in future studies 4 conclusions in this study an innovative analytical model is developed for the well hydraulics in well vicinity during both crr and chr tests in this model the well and aquifer clogging is considered using an exponentially reduced k t function while the non darcian flow is included using the post linear izbash s law with a constant exponent n the approximate solutions in laplace domain for both crr and chr tests are then developed by adopting the linearization procedure variable substitution and laplace transform successively the comparison among the approximate analytical and numerical solutions with linearization procedure and the numerical solutions without linearization indicate that the developed approximate analytical solutions are sufficiently accurate and only cause acceptable errors at the initial stage of the test the developed model offers a straightforward way to quantitatively assess the well hydraulics around the injection well under the combined effect of clogging and non darcian flow and offers a theoretical basis for designing and redeveloping aquifer injection wells for managed aquifer recharge however the use of empirical k t function and constant n may not work well to phenomenologically approximate the steeply varying k and n fields which becomes the major limitation of the developed model to overcome this limitation including the real spatiotemporal k and n fields into the developed model or developing a hierarchy of multi region model based on the real spatiotemporal k and n fields will be our future work credit authorship contribution statement jiong li writing original draft methodology software formal analysis xiao he xia funding acquisition supervision hongbin zhan formal analysis writing review editing supervision ming guang li formal analysis jin jian chen conceptualization funding acquisition supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment this study was substantially supported by the national natural science foundation of china grant nos 41727802 and 41977216 and by the shanghai rising star program grant no 19qc1400800 the authors thank the editor dr sander associate editor dr yeh and three anonymous reviewers for their critical and constructive comments which help us improve the quality of the paper greatly supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103820 appendix supplementary materials image application 1 
363,natural hydrogeological settings may delineate wedge shaped aquifers that are sandwiched between streams lakes or sea water bodies along arbitrary oriented boundary lines this is the case in multiple river basins river deltas alluvial fans and coastal promontories and heterogeneity patterns are likely to arise because of sedimentation zoning the aim of present study is to provide a steady state analytical solution describing the nature of well extraction in heterogeneous wedge shaped aquifers formed by intersection of arbitrary oriented streams this laterally bounded aquifer comprises two zones of constant but differing transmissivity hydraulic conductivity which are hydraulically connected through a common interface first the method of green s function constructs a closed form expression for the spatial distribution of dual zone potential next the stream function is derived from the integration of cauchy riemann equations which in turn completes an analytical representation of the flow net the stream depletion rates are shown to be explicitly linked to the stream function this leads to simple expressions for the stream depletion rates demonstrating that the lateral recharge from adjacent streams varies linearly with the angular position of pumping well without any dependency on the aquifer heterogeneity the present solution encompasses a number of existing solutions for homogeneous aquifer system as subsets flow nets are generated for hypothetical test cases whereby stagnation points are identified semi analytically the present formulation ensures preservation of water balance for a capture zone subject to regional flow sensitivity analysis is conducted to address how drawdown at a certain observation point responds to a heterogeneity perturbation wider wedges appear more sensitive to variation of heterogeneity the formulation is extended to account for rainfall induced recharge over a dual zone unconfined aquifer in each case the computed head profiles agree well with numerical counterparts from finite element method keywords wedge shaped aquifers heterogeneity stream depletion rates stagnation point flow net nomenclature i subscript denoting zone i i 1 2 d d functions defined by eq 18 e e functions defined by eq 19 f function defined by eq 11 gij components of green s function defined by eqs 32 35 hi hydraulic head l hr hl hydraulic head along right and left streams l h heaviside function ki hydraulic conductivity lt 1 n 0 infiltration rate lt 1 p p functions defined by eq 6 q 0i well discharge l3t 1 q i strack s comprehensive discharge vector l2t 1 qr ql depletion rate from right and left streams l3t 1 r radial distance of interzonal boundary from the wedge apex l ra radial extent of recharge area l r θ coordinate of head observation point l radian r 0i θ0i coordinate of well l radian r sp θsp coordinate of stagnation point l radian s normalized sensitivity defined by eq 26 sgn sign function ti transmissivity l2t 1 x y cartesian coordinates l z nondimensional head defined as h h l h l β wedge angle radian γ i r r 0 i r r 0 i r r 0 i r r 0 i ω δ dirac delta function having the inverse dimension of its argument η1 r 01 r r 2 ω η2 r 2 r 02 r ω λ heterogeneity ratio defined as t 1 t 2 in confined and k 1 k 2 in unconfined aquifer φ i strack s comprehensive potential l3t 1 φii potential due to rainfall l3t 1 φ si ψ si potential and stream function due to regional flow l3t 1 φ wi ψ wi potential and stream function due to wells l3t 1 ψ i stream function l3t 1 ω π β 1 introduction typical alluvial fans comprise sediment deposits with a diversity of hydrogeological structures that convey infiltrated water from uplands to floodplain on the regional scale the occurrence of groundwater in such heterogeneous aquifers is affected by spatial variability of porosity and permeability fields on a more local scale ancient alluvial fans may be partitioned into wedge shaped units formed by intersection of arbitrary oriented streams yeh and chang 2006 revealing radial patterns of heterogeneity from the apex of the fan as shown in fig 1 samani and sedghi 2015 in some cases a stream may flow around a topographic feature and delineate a wedge and regional flow is expected to be directed from the high elevation section toward the low elevation section of the stream samani and zarei doudeji 2012 besides the stream heads may not be the same if there exists a geologic fault at the apex of the wedge yeh and chang 2006 these all influence the aquifer response to pumping activities in particular the heterogeneities cause irregular patterns of equipotentials and streamlines inside the capture zone of the well which is consistent with the field data haitjema 1995 similar patterns may be observed in multiple river basins with wells operating near the wedge shaped confluence of two tributaries yeh et al 2008 according to horton s law of stream numbers a higher order stream can potentially result from confluence of two low order tributaries fig 2 and the wedge shaped entities formed in this way may be analyzed separately from each other sedghi et al 2009 samani and zarei doudeji 2012 different zonation approaches have been proposed to mathematically describe the spatial variability of permeability field some studies conceptualize the heterogeneity as a random field sun et al 1998 winter and tartakovsky 2002 neuman and tartakovsky 2009 the others are focusing on deterministic features with hydraulic conductivity varied linearly montalto et al 2006 exponentially wang et al 2011 zlotnik et al 2011 harmonically craig 2009 or by an arbitrary polynomial craig 2015 common to almost all of the above mentioned studies is the assumption of continuously varying porous media in the natural hydrogeological settings it is not uncommon to observe distinct interfaces across which material properties jump abruptly contrasting geological blocks of constant but differing hydraulic conductivity craig 2015 mathematical models established for this purpose often assume spatially piecewise constant permeability such an idealization is also of relevance in evaluating hydrogeological impacts of coastal land reclamation consisting of a hillside aquifer and an oceanic elongated island guo and jiao 2007 hu et al 2008 the solution techniques for groundwater flow with zonal representation of hydraulic conductivity are briefly reviewed here focusing on analytical and semi analytical approaches historically the method of image wells has been widely accepted in groundwater hydraulics a relevant example is a pumping well near an infinitely long interface between two zones of constant but differing hydraulic conductivity haitjema 1995 katsifarakis and tselepidou 2009 the analogy with the problem of finding the electrostatic potential in adjacent semi infinite dielectrics is noticeable jackson 2007 the spatial distribution of drawdown takes a simple form for an aquifer of infinite areal extent but exclusion of external boundaries e g adjacent rivers lakes or bedrock outcrops may lead to an inaccurate estimation of aquifer response to steady state pumping for the case of finite aquifer domains the application of image wells is restricted to certain geometrical entities having rectangular zarei doudeji and samani 2014 or triangular boundaries mahdavi 2019a b all being filled with homogeneous materials the analytic element method has appeared as a mesh free alternative to finite difference and finite element methods for simulating steady flow through highly heterogeneous media craig 2009 strack 2017 the solution domain of the problem can be discretized into a number of polygonal sub domains each assigned a certain value of hydraulic conductivity and may be anisotropic itself despite the flexibilities offered by analytic elements in terms of aquifer geometry and lateral heterogeneity the boundary conditions are met in an approximate sense only but with desired accuracy craig 2015 the method of distributed transfer function originated from heat conduction problems in multilayer composites has been proven efficient in 1 d aquifer settings consisting of arbitrary number of homogenous sub aquifers under transient recharge and fluctuating river stage liang and zhang 2013 complications arise in dealing with transient problems defined by more than one spatial variable and semi analytical techniques are inevitable in most cases laplace domain expression has been derived for drawup due to spatially uniform recharge in dual zone rectangular aquifer surrounded by four constant head water bodies on its border das et al 2014 once obtained in the laplace domain the solution is transformed back to the physical space by numerical laplace inversion the same applies to multi zone wedge shaped aquifers under continuous pumping and the drawdown time series demonstrate how heterogeneity manifests itself at late times in most cases samani and sedghi 2015 the solution is however semi analytical requiring evaluation of infinite series of arbitrary order bessel functions and roots of transcendental equations for the associated eigenvalue problem in view of the mathematical difficulties mentioned above and in an attempt for easily computable solution the present study focuses on steady state response of a heterogeneous aquifer comprising two zones of internally homogeneous materials each containing an arbitrary located pumping well the problem is formulated in terms of the potential making it applicable to both confined and unconfined aquifers a closed form green s function is constructed for the potential and then integrated via the cauchy riemann equations to arrive at the associated stream function this completes analytical framework for the analysis of well capture zone and to the best of author s knowledge there exists no similar solution for the present hydrogeological setting also included is the effect of regional flow due to head difference between the surrounding streams stream depletion rates are given in a mathematically simple form hypothetical test cases illustrate several characteristics of the present solution 2 mathematical model 2 1 dual zone potential development of the mathematical model relies on some simplifying assumptions i the aquifer rests over a horizontal impermeable bed and groundwater flows horizontally in a fully saturated porous medium and under steady state condition ii two adjacent zones comprise the aquifer each of which filled with isotropic and homogeneous material of constant transmissivity ti and hydraulic conductivity ki i 1 2 thereby defining a dual zone structure for the aquifer heterogeneity iii the aquifer zones maintain hydraulic connection through a common interface called interzonal boundary iv for the straight streams sr and sl that surround the aquifer on its right and left sides the stream banks are assumed vertical and seepage faces on them are ignored v the stream heads hr and hl remain constant along the stream banks zero drawdown and regional flow is induced by difference between these two heads vi the boundary streams makes an angle β with each other 0 β 2π and their intersection at the origin of the polar coordinate system forms a wedge shaped domain for the aquifer that extends to infinity in the radial direction fig 3 and vii a system of two fully penetrating wells of infinitesimal radius pump water out of the aquifer at constant rates q 0i the above assumptions render the mathematical model analytically tractable and their physical relevance is discussed herein assumptions ii and iii refer to the regional variation of heterogeneity field and can be justified in aquifer systems with contrasting geological blocks of constant but differing hydraulic conductivity these homogeneous blocks are often interconnected through distinct interfaces across which material properties jump abruptly haitjema 1995 craig 2015 the radial variation of hydraulic conductivity can be observed in alluvial fans where the permeability changes radially from high energy coarse grained deposition near the apex to low energy fine grained deposition downstream samani and sedghi 2015 another interesting example would be the case of groundwater flow around beaver dams revealing a jump in the potential from the beaver pond to the tailwater sharps 1996 ecohydrologically the near pond part of an unconfined aquifer is of most interest because the beavers bioengineers deforest the adjacent woodland the trees perish and the hydraulic conductivity of the corresponding soil may change in the radial manner similar to that assumed in the present study assumptions iv and v establish zero drawdown condition along the adjacent streams in an attempt to closely replicate real world hydrogeological settings zero drawdown condition may be specified on the basis of annual average water level in the stream which may also serve as time independent head for a regional groundwater flow system yeh and chang 2006 assumptions vi and vii consider steady state pumping near the confluence of two tributaries in an alluvial fan or multiple river basin the strack s comprehensive potential for the dual zone aquifer system is denoted by φ i this can be related to the hydraulic head hi r θ as φ i tihi or φ i k i h i 2 2 for confined or unconfined flows respectively the spatial distribution of dual zone potential is governed by the following boundary value problem bvp 1 2 φ i σ i the radial and angular coordinates are denoted by r and θ respectively and pumping wells are placed at r 0i θ0i as shown in fig 3 in eq 1 the laplacian is defined by 2 φ i 1 r r r φ i r 1 r 2 2 φ i θ 2 and the right hand side is σ i q 0i δ r r 0i δ θ θ0i r with δ being the dirac delta function the boundary streams sr and sl run along the lines θ 0 and θ β respectively fig 3 well posedness of the bvp requires boundary conditions that reflect the physical reality as follows 2 φ i r 0 φ r i stream s r φ i r β φ l i stream s l where φ ri tihr and φ li tihl for confined and φ r i k i h r 2 2 and φ l i k i h l 2 2 for unconfined flows it is well known that the hydraulic head and the normal component of the darcian velocity perpendicular to the arc r r indicated by dashed line in fig 3 are continuous across this arc consequently the interzonal conditions in terms of strack s comprehensive potential read haitjema 1995 3 φ 1 r θ λ φ 2 r θ and 4 φ 1 r r θ φ 2 r r θ the heterogeneity ratio of adjacent zones is given by λ t 1 t 2 for confined aquifer and λ k 1 k 2 for unconfined aquifer it is assumed that the radial component of the darcian velocity vanishes at infinitely large distance from the wells and this can be expressed by no flow condition huang et al 2015 5 lim r φ 2 r 0 in view of the linearity of eq 1 the potential φ i fig 3a can be decomposed into two separate components reflecting contributions from wells φ wi fig 3b and regional flow φ si fig 3c the method of green s function constructs a closed form expression for φ wi as follows appendix a 6 φ w 1 r θ q 01 4 π ln p γ 1 θ 01 p γ 1 θ 01 1 λ 1 λ ln p η 1 θ 01 p η 1 θ 01 q 02 λ 2 π 1 λ ln p γ 2 θ 02 p γ 2 θ 02 and 7 φ w 2 r θ q 02 4 π ln p γ 2 θ 02 p γ 2 θ 02 1 λ 1 λ ln p η 2 θ 02 p η 2 θ 02 q 01 2 π 1 λ ln p γ 1 θ 01 p γ 1 θ 01 where p λ ω 1 2λcos ω θ ω λ2 ω π β η 1 r 01 r r 2 ω η 2 r 2 r 02 r ω and γ i r r 0 i r r 0 i r r 0 i r r 0 i ω note that p varies with ω and θ as well but these dependencies are not explicitly displayed on the left hand side of p for notational convenience the solution that satisfies the bvp of fig 3c for regional flow is linear in θ demonstrating a fan like distribution of equipotentials as follows 8 φ s i θ φ r i φ l i φ r i θ β superposition specifies φ i φ wi φ si in each aquifer zone the interzonal conditions 3 and 4 are met by φ si and there would be no regional flow if bounding streams maintain zero head gradient hr hl 2 2 stream function let ψ i r θ denotes the stream function in the dual zone aquifer the potential and stream function are interconnected through the cauchy riemann equations written in the polar form as 9 ψ i r 1 r φ i θ and 10 ψ i θ r φ i r the stream function combines the effects of wells ψ wi and regional flow ψ s1 in each aquifer zone ψ i ψ wi ψ si contours of constant stream function serve as streamlines strack 2017 the cauchy riemann equations are integrated to arrive at the following closed form expressions for the stream function detailed derivation for zone 1 is given in appendix b 11 ψ w 1 r θ q 02 λ π 1 λ f γ 2 θ 02 θ q 01 1 λ 2 π 1 λ f η 1 θ 01 θ q 01 2 π f γ 1 θ 01 θ for 0 r r 01 r q 01 2 π f γ 1 θ 01 θ for 0 r 01 r r and 12 ψ w 2 r θ q 01 π 1 λ f γ 1 θ 01 θ q 02 1 λ 2 π 1 λ f η 2 θ 02 θ q 02 2 π f γ 2 θ 02 θ for r r r 02 q 02 2 π f γ 2 θ 02 θ for r r 02 r and 13 ψ s i r φ r i φ l i β ln r where f λ ω θ ta n 1 λ sin ω θ ω 1 λ cos ω θ ω ta n 1 λ sin ω θ ω 1 λ cos ω θ ω note that f varies with ω as well but this in not explicitly displayed on the left hand side of f for notational convenience 2 3 stream depletion rate sdr the pumping wells can deplete lateral streams and induce inflow to the aquifer sdr values for the right and left streams can be computed in terms of volumetric rates qr and ql as follows 14 q r q r 1 q r 2 0 r 1 r φ w 1 θ θ 0 d r r 1 r φ w 2 θ θ 0 d r 15 q l q l 1 q l 2 0 r 1 r φ w 1 θ θ β d r r 1 r φ w 2 θ θ β d r the above integrals convert to appendix c 16 q r 1 θ 01 β q 01 1 θ 02 β q 02 and 17 q l 1 β θ 01 q 01 θ 02 q 02 interestingly no matter the value of heterogeneity ratio the sdr values merely depend on the angular coordinate of the wells eqs 16 and 17 maintain the water balance for the stream aquifer system by satisfying qr ql q 01 q 02 it is worth mentioning that most of the existing sdr formulations exclude the effect of regional flow and only well induced fluxes are accounted for yeh et al 2008 however the regional flow has an impact on the water balance at capture zone scale as it will be clarified in the next paragraphs 2 4 stagnation points groundwater stagnates at a point where both components of strack s comprehensive discharge vector vanish stagnation points may be detected semi analytically ataie ashtiani et al 2012 mahdavi 2020 the angular and radial components of strack s comprehensive discharge vector q i r θ are computed as q θ i 1 r φ i θ and q r i φ i r respectively kacimov et al 2016 setting them equal to zero results in a system of nonlinear algebraic equations for the coordinates of stagnation point s in each aquifer zone the system consisting of q θ1 0 and q r1 0 can be written respectively as 18 2 λ 1 λ q 02 d γ 2 θ 02 d γ 2 θ 02 1 λ 1 λ q 01 d η 1 θ 01 d η 1 θ 01 q 01 d γ 1 θ 01 d γ 1 θ 01 2 φ r 1 φ l 1 and 19 2 λ 1 λ q 02 e γ 2 θ 02 e γ 2 θ 02 1 λ 1 λ q 01 e η 1 θ 01 e η 1 θ 01 q 01 sgn r r 01 e γ 1 θ 01 e γ 1 θ 01 0 likewise q θ2 0 and q r2 0 give 20 2 1 λ q 01 d γ 1 θ 01 d γ 1 θ 01 1 λ 1 λ q 02 d η 2 θ 02 d η 2 θ 02 q 02 d γ 2 θ 02 d γ 2 θ 02 2 φ r 2 φ l 2 and 21 2 1 λ q 01 e γ 1 θ 01 e γ 1 θ 01 1 λ 1 λ q 02 e η 2 θ 02 e η 2 θ 02 q 02 sgn r r 02 e γ 2 θ 02 e γ 2 θ 02 0 where d λ ω λ sin ω θ ω p λ ω e λ ω λ λ cos ω θ ω p λ ω and sgn is the sign function both of d and e vary with ω and θ as well but this is not explicitly displayed on the left hand side of them for notational convenience the roots of above equations are obtained numerically by the maple function fsolve and denoted by r r sp and θ θsp hereafter 3 results and discussion 3 1 comparison with existing solutions a special case of interest is that of a single zone homogeneous aquifer λ 1 in the absence of regional flow eq 6 thus reduces to φ w 1 q 01 4 π ln p γ 1 θ 01 p γ 1 θ 01 for a single pumping well of discharge q 01 at r 01 θ01 chan et al 1978 obtained the same result under a different notation in terms of drawdown further the sdr values from 16 and 17 simplify to q r 1 θ 01 β q 01 and q l θ 01 β q 01 which represent the solution of yeh et al 2008 in fig 4 the streamlines drawn by 11 are compared with the solution of nagheli et al 2020 for a homogeneous aquifer having β 3θ01 37 r 01 r 0 6 and q 01 50 m3 day fig 4a refers to stream stream wedge as adopted in the foregoing analysis fig 4b examines stream barrier wedge replacing stream sl by an impervious barrier across which no flow can take place the analysis of this case is accomplished by evaluating 11 for ω 2 and inserting an image well of the same pumping rate at r 01 2β θ01 so that the pair of real and image wells are mirror reflections of each other with respect to the boundary line θ β chan et al 1978 mahdavi 2020 the solution of nagheli et al 2020 is treated likewise interaction of real and image wells causes the flow to stagnate at point a on the impervious barrier r spa r 0 6 two convergent streamlines that run tangential to the boundary merge together at this point producing a streamline toward the well the streamlines calculated by both models appear to be indistinguishable from each other as fig 4 indicates next we address the condition under which the present geometry degenerates to an annular wedge shaped domain of the kind discussed by mahdavi 2020 theoretically there would be no resistance against the flow in zone 1 if its permeability approaches infinity in other words the drawdown is expected to be zero everywhere in zone 1 such a trend may be detected by increasing λ in fig 10 this limiting case resembles a zero drawdown stream along the arc r r delineating an annular wedge shaped aquifer that consists only of zone 2 in a similar context haitjema 1995 simulated a lake by specifying infinite hydraulic conductivity inside its region the analysis is accomplished by letting λ and the aquifer response from 7 and 12 reduces to 22 φ w 2 q 02 4 π ln p η 2 θ 02 p γ 2 θ 02 p γ 2 θ 02 p η 2 θ 02 and 23 ψ w 2 q 02 2 π f η 2 θ 02 θ q 02 2 π f γ 2 θ 02 θ for r r r 02 q 02 2 π f γ 2 θ 02 θ for r r 02 r these repeat the solution of mahdavi 2020 for a pumping well of discharge q 02 at r 02 θ02 similarly zone 2 will behave as a constant head lake if λ 0 and eq 6 and eq 12 convert to 24 φ w 1 q 01 4 π ln p η 1 θ 01 p γ 1 θ 01 p γ 1 θ 01 p η 1 θ 01 and 25 ψ w 1 q 01 2 π f η 1 θ 01 θ q 01 2 π f γ 1 θ 01 θ for 0 r r 01 r q 01 2 π f γ 1 θ 01 θ for 0 r 01 r r eqs 24 and 25 describe the flow net in a sector domain of finite radial extent 0 r r interacting with zero drawdown streams or water bodies on its borders the above mentioned solutions may therefore be regarded as special cases of the present solution 3 2 flow nets and capture zone water balance key aspects of the proposed solution are highlighted through a set of hypothetical examples referred to as case 1 case 2 case 3 and case 4 henceforth it is to be noted that a variety of flow nets can be constructed by changing the hydrogeological parameters in the mathematical model e g aquifer geometry location and discharge of the wells heterogeneity ratio and difference in the stream heads default parameters chosen in what follows are r 2500 m t 2 40 m2 day and h l 13 m the pumping rates in case 1 and case 2 are q 01 100 m3 day and q 02 60 m3 day also β 3θ01 2θ02 70 r 01 r 0 8 r 02 r 1 24 and h r 15 m in case 3 β 1 25θ01 1 5θ02 70 and hr 13 m in case 4 β 37 and hr 14 m the nondimensional head is defined as z r θ h r θ h l h l and radial and angular positions are normalized with r and β respectively in case 1 the heterogeneity ratio of confined aquifer is set to λ 0 5 as fig 5 shows the fan like pattern of equipotentials emanating from the origin is disrupted by the pumping wells but recovered far away from the wells where induced drawdown is negligible the contours of nondimensional head are distributed in uniform intervals of 0 02 exception is the contour line that intersects itself at point a zoom in view in fig 5 both of the angular and radial components of discharge vector vanish there hence it represents a stagnation point q 1 r sp a θ sp a 0 a similar behavior can be observed at point b q 2 r sp b θ sp b 0 analogous to snell s law of optics an incident streamline that strikes the interzonal boundary in zone 2 is refracted toward the boundary normal upon entering the less permeable porous medium of zone 1 the flow net reveals nested capture zones for the wells the bounding streamlines marked ac and ad delineate a capture envelope for the first well whose width extends from rc r 0 399 to rd r 2 061 along sr the enclosed area fully encompasses the capture zone of the second well which is formed by the bounding streamlines be and bf the capture envelops are marked by thick lines of different color the extraction wells gain their water from the regional flow and from depletion of sr with different proportions since no water can escape or enter across the bounding streamlines the flow mass must be conserved inside the capture zone in other words the aquifer is recharged over three adjacent segments on sr namely segments ce and ef and a narrow segment between f and d and wells must extract all of this water since different expressions apply to stream function in each zone the recharging segment is divided accordingly to two intervals that extend from r rc to r r in zone 1 and from r r to r rd in zone 2 an analysis similar to that outlined for the sdr calculation suggests that inflow rates can be estimated from difference in the stream function values evaluating eqs 11 13 over respective intervals gives ψ 1 r 01 0 ψ 1 r c 0 ψ 1 r 0 ψ 1 r 01 0 72 94 m 3 day and ψ 2 r 02 0 ψ 2 r 0 ψ 2 r d 0 ψ 2 r 02 0 87 06 m 3 day the sum of which will exactly counterbalance the total extraction rate q 01 q 02 160 m3 day in accordance with the steady state water balance for the capture zone case 2 examines how flow net is affected if transmissivity of zone 1 is halved λ 0 25 keeping the other parameters same the flow net is shown in fig 6 refraction of streamlines is more pronounced compared to previous case the capture zone of the first well has shifted downgradient causing intersection with stream sl at stagnation points a and b contrary the position of stagnation point c is less sensitive to t 1 and remained fairly close to its counterpart in case 1 i e point b in fig 5 it is to be noted that the radial component of the discharge vector identically vanishes along the adjacent streams this can be verified by observing that both of 19 and 21 are satisfied for θ 0 and θ β on the other hand the angular component of the discharge vector is equal to zero at stagnation points consequently the flow locally reverses its direction and incident streamlines reflect at points a and b over segment ab the stream is depleted inflow whereas regional flow leaves the aquifer outflow however the inflow dominates over the outflow so that the net flow is directed toward the first well the volumetric rate to be captured by this well is given by ψ 1 r s p a β ψ 1 r 01 β ψ 1 r 01 β ψ 1 r β ψ 2 r β ψ 2 r s p b β 1 47 m 3 day similar to the previous case a segment of sr extending from rd r 0 303to re r 2 234 recharges the aquifer with the volumetric rate evaluated as ψ 1 r 01 0 ψ 1 r d 0 ψ 1 r 0 ψ 1 r 01 0 ψ 2 r 02 0 ψ 2 r 0 ψ 2 r e 0 ψ 2 r 02 0 158 53 m 3 day again these values sum to total extraction rate and flow mass is conserved inside the capture zone in case 3 the heads assume an initially flat distribution throughout the aquifer by setting hl hr 13 m the heterogeneity ratio is same as previous case but the wells are placed rather close to sl at angular positions θ01 0 8β and θ02 2β 3 and the discharge of well 2 is doubled q 02 120 m3 day the flow net is shown in fig 7 a saddle stagnation point can be observed roughly midway between the wells where four streamlines intersect point a two streamlines originate from and two merge at this point the latter two divide the aquifer area into two subregions on the left zone water is fully drawn by well 1 and on the right zone by well 2 the flow to each well is supplied by depletion of both streams in case 4 a confined aquifer having λ 0 25 is exposed to a permanent source of contamination over a segment of sr that lies between rb r 0 4 and rc r 0 8 a remediation scheme is scheduled to capture the contaminated water by continuously pumping the aquifer within zone 1 to optimally contain the contamination source the capture envelope should pass through the end points of the contaminated segment strack 2017 a primary step to satisfy this constraint is to determine the well position and discharge and this can be addressed on a trial and error basis as a first trial it is customary to place the well on the bisector of the wedge midway between rb and rc at r 01 r 0 6 similar to previous cases the pumping activity is partially supported by regional flow and partially by depletion of stream sr over segment bc the water balance for the capture zone reads ψ 1 r 01 0 ψ 1 r b 0 ψ 1 r c 0 ψ 1 r 01 0 q 01 from which one obtains q 01 17 14 m3 day for the first trial by assessment of the flow net not shown here the intersections of capture envelope with sr are found to occur at rb r 0 426 and rc r 0 851 clearly there exists a downstream offset from the desired values of rb and rc which may be compensated by an upstream shift of the capture envelope to accomplish this the well position is changed iteratively along the radial direction until the bounding streamlines exactly encompass the contamination source the results converge after a few iterations to r 01 r 0 565 and q 01 17 28 m3 day fig 8 depicts the flow net where capture zone is formed upgradient of the stagnation point the flow outside the capture zone is bypassed by the well and all of the streamlines become perpendicular to the adjacent streams overall heads descend in the downgradient direction the remediation layout achieved in this way may be regarded as optimal in the sense that none of the contaminated groundwater can escape from the capture zone keeping the outside regions unaffected by the impact of polluted inflow zarei doudeji and samani 2014 3 3 effects of head difference between the streams this section demonstrates how the position of the stagnation point associated with a single pumping well in zone 2 is affected by the head difference between the streams in a confined aquifer computations are carried out by solving 18 21 for the specified values of β 2θ02 50 r 02 r 1 12 λ 0 25 and q 02 t 2 1 m normalized parameters are defined as r i r 02 r sp r 02 and θ i θ sp θ 02 θ 02 where i 1 if stagnation point is in zone 1 and i 2 if it is in zone 2 these parameters measure the radial and angular deviation of the stagnation point from the well position respectively the induced flow is proportional to the head difference between the streams i hr hl while hr is varied incrementally from 13 m to 15 m and hl is fixed at 13 m the variation of r i and θ i are depicted in fig 9 there exist two stagnation points for the stream heads not exceeding h r 13 7377 m and the head difference associated with this limiting case is denoted by io both of the stagnation points lay along stream s r dashed line for θ 1 θ 2 1 one in zone 1 solid line and the other in zone 2 dash dotted line for i io the variations of r 1 and r 2 indicate that the stagnation points are becoming closer to the well in response to an increase in i once the limiting case of i io is exceeded the stagnation point in zone 1 disappeared and the curve of θ 2 began to descend dotted line however the curve of r 2 shows comparatively slow variation beyond i io when the upper bound of h r is approached the radial coordinate of the stagnation point becomes approximately same as that of the well itself notice the negligibly small values of r 2 indicating that r 02 r sp in practice indeed the velocity magnitudes associated with high values of i are large enough to locally stagnate the flow in the close vicinity of the pumping well 3 4 fem comparison and heterogeneity effects the foregoing comparisons in section 3 1 were restricted to homogeneous aquifers for which analytical solutions are available in the literature response of heterogeneous aquifers case 1 and case 2 is tested here against the matlab finite element toolbox pdetool a variety of 2 d problems of groundwater hydraulics can be implemented in this framework mahdavi and seyyedian 2013 kacimov et al 2017 mahdavi 2019 a b mahdavi 2020 the toolbox allows dealing with the elliptic model x τ h x y τ h y σ subject to dirichlet and neumann boundary conditions in arbitrary shaped domains the cartesian coordinate system x y has its origin at the aquifer vertex with x directed along sr and y positive upward so that the relations x rcosθ and y rsinθ hold the aquifer heterogeneity can be accounted for thanks to the spatial variability of τ which plays the role of transmissivity field in the present analysis the dual zone confined aquifer takes τ t 1 if x 2 y 2 r 2 and outside this region τ t 2 the singular nature of the dirac delta function will pose a numerical challenge for direct implementation of σ in the form of q 0i δ x x 0i δ y y 0i as discussed in a similar context by eftekhari 2015 alternatively an extraction intensity σ q 0i πl 2 can be uniformly distributed over a circle of radius l centered at the well position x 0i y 0i in other words the product of two dirac delta functions is approximated by 1 π l 2 wherever x x 0i 2 y y 0i 2 l 2 and outside this region σ 0 however there is a tradeoff in choosing an optimal radius for the circle in order to adequately represent a well of infinitesimal radius it needs to be appreciably small but not smaller than the average element size after some numerical experiments the optimal radius is found to be l 10 m the computational domain is truncated to a wedge of radius 4r which seems large enough to numerically resemble the condition of infinite radial extent a relatively coarse mesh of triangular elements discretizes the domain at the initial stage of computation finite elements are adaptively refined to return smaller triangles close to the wells where drawdowns vary significantly over distance iterations stop if changes in the solution between two successive refinements fall below a predefined tolerance the results converge when the number of elements is approximately 250 000 head distributions obtained in this way are plotted in fig 10 for case 1 λ 0 5 and case 2 λ 0 25 the results are sampled along radial lines passing through the well positions θ β 3 fig 10a and θ β 2 fig 10b the response of homogenous aquifer λ 1 is also shown as a reference by increasing t 1 hence λ more water is transmitted laterally to the first well which in turn reduces drawdown in zone 1 zone 2 is influenced accordingly though the value of t 2 remained unchanged owing to its larger pumping rate the first well induces noticeable depression along the radial line passing through the second well as can be seen from the curves in fig 10b the vice versa is not however true and fig 10a is free from any visible impact of the second well the curves preserve the continuity of head across the interzonal boundary with radial slopes reflecting aquifer heterogeneity as per eq 4 the analytical and numerical curves are in strictly close agreement more insight into the influence of heterogeneity on aquifer response can be achieved by conducting a sensitivity analysis in the derivative based framework proposed by kabala 2001 in doing so a set of confined aquifers are generated by changing β from 10 to 210 in uniform 1 intervals each undergoing pumping on its bisector with q 01 100 m3 day and r 01 r 0 8 prior to the well activity the aquifer and streams are in hydraulic equilibrium maintaining a constant head h 0 hl hr 13 m throughout the adjacent zones the aquifer response in zone 1 is examined in terms of nondimensional drawdown defined by s z since h 1 φ1 t 2λ has singularity at the well position the drawdown is measured in close vicinity of the well at 1 05r 01 β 2 by definition the normalized sensitivity of s to the changes in λ is evaluated as s s λ λ s λ kabala 2001 the derivatives arising in sensitivity analysis are commonly approximated by forward finite differences yeh et al 2008 mahdavi 2019a but an analytical representation can be explicitly extracted from 6 26 s s λ q 01 4 π t 2 h 0 λ ln p γ 1 θ 01 p γ 1 θ 01 λ 2 2 λ 1 1 λ 2 ln p η 1 θ 01 p η 1 θ 01 it is to be noted that both the well and drawdown observation point belong to the same aquifer zone fig 11 depicts sensitivity contours for heterogeneity ratios ranging from 0 5 to 5 with t 2 kept at 40 m2 day in evaluating 26 a number of observations can be made from the contour map i the values of s are negative everywhere in β λ space indicating that s and λ are negatively correlated indeed any increase in λ will subsequently reduce s as it was already confirmed by fig 10 ii for a certain value of β the drawdown gradually loses its sensitivity by increasing the heterogeneity ratio iii for a certain value of λ s will grow in absolute magnitude as aquifer vertex angle increases in other words the wider the wedge the more pronounced will be the influence of variation of heterogeneity ratio on its drawdown response 3 5 rainfall recharge groundwater resources are naturally replenished by rainfall induced recharge causing spreading groundwater mounds in unconfined aquifers for the present analysis the head is assumed constant everywhere prior to recharge maintaining hydraulic equilibrium between the aquifer and adjacent streams the recharge keeps a spatially constant rate of n 0 over a finite subregion 0 r ra and 0 θ β of the unconfined aquifer which defines the recharge area further the recharge process is assumed to not affect the stream heads but only alters head distribution inside the aquifer so that a groundwater mound will develop das et al 2014 mahdavi and seyyedian 2014 kacimov et al 2016 the mound elevation can be represented in terms of strack s comprehensive potential due to rainfall recharge φii whose spatial variation in the steady state is governed by 27 2 φ i i n 0 the above bvp is treated by extending already derived point source formula eqs 6 and 7 to accommodate areal effects of rainfall recharge accordingly the solution of 27 follows from integration of green s function over the recharge area mahdavi 2015 two cases can be mathematically distinguished regarding the radial extent of recharge area if it is fully encompassed within zone 1 ra r then 28 φ i 1 r θ n 0 0 β 0 r a g 11 r θ r 0 θ 0 r 0 d r 0 d θ 0 and 29 φ i 2 r θ n 0 0 β 0 r a g 21 r θ r 0 θ 0 r 0 d r 0 d θ 0 otherwise if recharge area spreads out to partially cover zone 2 ra r then 30 φ i 1 r θ n 0 0 β 0 r g 11 r θ r 0 θ 0 r 0 d r 0 d θ 0 0 β r r a g 12 r θ r 0 θ 0 r 0 d r 0 d θ 0 and 31 φ i 2 r θ n 0 0 β 0 r g 21 r θ r 0 θ 0 r 0 d r 0 d θ 0 0 β r r a g 22 r θ r 0 θ 0 r 0 d r 0 d θ 0 where gij r θ r 0 θ0 denotes the potential field generated in zone i by a unit source acting at a point r 0 θ0 belonging to zone j i 1 2 j 1 2 for zone 1 the following components of green s function can be identified from eq 6 32 g 11 r θ r 0 θ 0 1 4 π ln p γ 0 θ 0 p γ 0 θ 0 1 λ 1 λ ln p ρ 0 θ 0 p ρ 0 θ 0 and 33 g 12 r θ r 0 θ 0 λ 2 π 1 λ ln p γ 0 θ 0 p γ 0 θ 0 where γ 0 r r 0 r r 0 r r 0 r r 0 ω and ρ 0 r 0 r r 2 ω for zone 2 eq 7 gives 34 g 21 r θ r 0 θ 0 1 2 π 1 λ ln p γ 0 θ 0 p γ 0 θ 0 and 35 g 22 r θ r 0 θ 0 1 4 π ln p γ 0 θ 0 p γ 0 θ 0 1 λ 1 λ ln p ρ 0 1 θ 0 p ρ 0 1 θ 0 each of the green s functions 32 35 possesses the symmetry property in the sense that it remains invariant when the coordinates r θ and r 0 θ0 are interchanged that is gij r θ r 0 θ0 gij r 0 θ0 r θ a numerical test is conducted for an aquifer having β 110 k 1 3 m day and k 2 1 m day λ 3 under areal recharge of rate n 0 0 005 cm day the stream heads are both equal to 20 m the matlab function integral2 performs numerical integrations arising in eqs 28 31 the contour maps of z shown in fig 12 represent nondimensional mound levels in this case the function z is symmetric with respect to the bisector of the wedge and the mound peak occurs in zone 1 if ra r fig 12a and in zone 2 if ra r fig 12b as fig 13 indicates the computed mound profiles agree well with numerical results from finite element method 4 conclusions a steady state green s function was constructed for simulating flow through a heterogeneous wedge shaped aquifer under continuous pumping and regional flow due to head difference between the surrounding streams the analytical representation of the flow net has the advantage of mathematical simplicity while describing an explicit relationship among the variables of interest in capture zone analysis and dual zone heterogeneity the solution is general in the sense that the aquifer vertex angle as well as zonal transmissivities can be chosen arbitrary extension to arbitrary number of wells is straightforward in accordance with the principle of superposition finally the aquifer response to rainfall induced recharge was obtained by integrating the point source formula over wedge shaped recharge area overall the following conclusions can be drawn i in the limit when heterogeneity ratio approaches infinity the aquifer domain degenerates to an annular wedge of infinite radial extent and the present solution reduces to that of mahdavi 2020 for such geometrical entities eqs 22 and 23 ii there exist two stagnation points associated with a pumping well under low gradients of regional flow by exceeding a certain value of regional gradient one of the stagnation points disappeared and the other become more and more close to the well as regional gradient intensifies fig 9 iii stream depletion rates are explicitly linked to the stream function in view of this stream depletion rates are shown to vary linearly with angular position of the well without any dependency on the aquifer heterogeneity eqs 16 and 17 iv the volumetric rate of water exchange over a segment of stream aquifer interface was calculated as a difference in the stream function values at the starting point and at the end point of that segment accordingly the preservation of water balance was assessed at the capture zone scale case 1 and case 2 whereby wells extract the total amount of water coming from depletion of streams and regional flow such analysis may be incorporated into an optimal aquifer remediation design allowing delineation of a capture envelope that encompasses the contaminated area exactly case 4 v aquifer heads decline in both aquifer zones by decreasing the heterogeneity ratio sensitivity analysis indicates that the drawdowns respond more appreciably to a heterogeneity perturbation as the vertex angles become wider fig 11 credit authorship contribution statement ali mahdavi conceptualization methodology validation visualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103823 appendix d supplementary materials image application 1 appendix a the bvp in fig 3b is treated by the method of green s function according to this method the dual zone potential is sought as an expansion in terms of radial and angular components a 1 φ w i r θ n 1 u n i r sin n ω θ the fourier series expansion of the dirac delta function reads a 2 δ θ θ 0 i 2 β n 1 sin n ω θ sin n ω θ 0 i both of a 1 and a 2 satisfy the homogeneous boundary conditions associated with the streams in fig 3b by inserting them into the bvp of fig 3b the governing equation in each aquifer zone will reduce to a nonhomogeneous ode for the radial component a 3 d 2 u n i r d r 2 1 r d u n i r d r n ω r 2 u n i r 2 q 0 i r β δ r r 0 i sin n ω θ 0 i following mahdavi 2020 the solution of a 3 is a 4 u n i r c i 1 r n ω c i 2 r n ω q 0 i n π h r r 0 i r r 0 i n ω r 0 i r n ω sin n ω θ 0 i where h is the heaviside function the four unknown coefficients c i1 and c i2 i 1 2 are determined as follows the potential in zone 1 must be bounded when r 0 thus c 12 0 differentiating u n2 r with respect to r the remote boundary condition 5 can be rearranged as a 5 lim r d u n 2 r d r n ω r n ω 1 c 21 q 02 n π r 02 n ω sin n ω θ 02 n ω r n ω 1 c 22 q 02 n π r 02 n ω sin n ω θ 02 0 the second term vanishes because lim r r n ω 1 0 in the first term however the magnitude of r nω 1 grows unbounded if nω 1 otherwise it becomes unity for a 5 to hold in either case the factor of r nω 1 must be equal to zero resulting in a 6 c 21 q 02 n π r 02 n ω sin n ω θ 02 the interzonal boundary conditions 3 and 4 will transform respectively to u n1 r λu n2 r and d u n 1 d r r d u n 2 d r r resulting in a 7 c 11 r n ω q 01 n π r r 01 n ω r 01 r n ω sin n ω θ 01 c 21 r n ω λ c 22 r n ω λ and a 8 c 11 r n ω q 01 n π r r 01 n ω r 01 r n ω sin n ω θ 01 c 21 r n ω c 22 r n ω or in a more compact from a 9 r n ω r n ω λ r n ω r n ω c 11 c 22 m n where a 10 m c 21 r n ω λ q 01 n π r 01 r n ω r r 01 n ω sin n ω θ 01 n c 21 r n ω q 01 n π r 01 r n ω r r 01 n ω sin n ω θ 01 the solution of a 9 is a 11 c 11 c 22 1 1 λ m λ n r n ω n m r n ω the coefficients already determined are inserted in a 4 a 12 u n 1 r q 01 n π 1 λ 1 λ r 01 r r 2 n ω r r 01 n ω r r 01 n ω r 01 r n ω h r r 01 sin n ω θ 01 2 q 02 λ n π 1 λ r r 02 n ω sin n ω θ 02 and a 13 u n 2 r q 02 n π 1 λ 1 λ r 2 r 02 r n ω r r 02 n ω r r 02 n ω r 02 r n ω h r r 02 sin n ω θ 02 2 q 01 n π 1 λ r 01 r n ω sin n ω θ 01 the heaviside function splits each of a 12 and a 13 into two expressions depending on the relative position of the head observation point r θ with respect to the well r 0i θ0i substituting them in a 1 leads to the following expressions for the dual zone potential a 14 φ w 1 r θ n 1 2 q 02 λ n π 1 λ r r 02 n ω sin n ω θ 02 sin n ω θ q 01 n π 1 λ 1 λ r 01 r r 2 n ω r r 01 n ω sin n ω θ 01 sin n ω θ for 0 r r 01 r q 01 n π 1 λ 1 λ r 01 r r 2 n ω r 01 r n ω sin n ω θ 01 sin n ω θ for 0 r 01 r r and a 15 φ w 2 r θ n 1 2 q 01 n π 1 λ r 01 r n ω sin n ω θ 01 sin n ω θ q 02 n π 1 λ 1 λ r 2 r 02 r n ω r r 02 n ω sin n ω θ 02 sin n ω θ for r r r 02 q 02 n π 1 λ 1 λ r 2 r 02 r n ω r 02 r n ω sin n ω θ 02 sin n ω θ for r r 02 r by introducing the auxiliary variable γ i which takes r r 0i ω for r r 0i and r 0i r ω otherwise both expressions are rendered in a single form valid over entire area of each aquifer zone a 16 φ w 1 r θ n 1 q 02 λ γ 2 n n π 1 λ cos n ω θ θ 02 cos n ω θ θ 02 q 01 2 n π 1 λ 1 λ η 1 n γ 1 n cos n ω θ θ 01 cos n ω θ θ 01 and a 17 φ w 2 r θ n 1 q 01 γ 1 n n π 1 λ cos n ω θ θ 01 cos n ω θ θ 01 q 02 2 n π 1 λ 1 λ η 2 n γ 2 n cos n ω θ θ 02 cos n ω θ θ 02 the infinite series can be summed up analytically as follows gradshteyn and ryzhik 1980 melnikov and melnikov 2012 a 18 n 1 λ n n cos n χ 1 2 ln 1 2 λ cos χ λ 2 the above formula assumes λ 1 and 0 χ 2π which is satisfied here because η i 1 γ i 1 and 0 ω θ θ0i 2π therefore a 16 and a 17 transform to easily computable forms expressed by 6 and 7 appendix b integrals of the generic forms b 1 and b 2 arise when dealing with the cauchy riemann equations in polar coordinates mahdavi 2020 b 1 i ln 1 2 λ cos χ λ 2 χ d λ λ 2 ta n 1 λ sin χ 1 λ cos χ b 2 ln 1 2 λ cos χ λ 2 λ λ d χ i to arrive at the spatial distribution of ψ1 eq 9 is integrated in r as follows b 3 ψ 1 r θ φ 1 θ d r r i 1 q 01 4 π i 2 1 λ 1 λ i 3 q 02 λ 2 π 1 λ i 4 where i 1 φ r 1 φ l 1 β r d r φ r 1 φ l 1 β ln r for r r 01 r and by virtue of b 1 it is easy to verify that b 4 i 2 θ ln p γ 1 θ 01 ln p γ 1 θ 01 d r r 2 f γ 1 θ 01 θ i 3 θ ln p η 1 θ 01 ln p η 1 θ 01 d r r 2 f η 1 θ 01 θ i 4 θ ln p γ 2 θ 02 ln p γ 2 θ 02 d r r 2 f γ 2 θ 02 θ converting b 3 to b 5 ψ 1 r θ φ r 1 φ l 1 β ln r q 01 2 π f γ 1 θ 01 θ 1 λ 1 λ f η 1 θ 01 θ q 02 λ π 1 λ f γ 2 θ 02 θ f 1 θ if r 01 r r then i 2 2f γ1 θ01 θ and b 6 ψ 1 r θ φ r 1 φ l 1 β ln r q 01 2 π f γ 1 θ 01 θ 1 λ 1 λ f η 1 θ 01 θ q 02 λ π 1 λ f γ 2 θ 02 θ f 2 θ where f 1 θ and f 2 θ are constant of integration and need to be determined in doing so eq 10 is integrated in θ b 7 ψ 1 r θ φ 1 r r d θ q 01 4 π i 5 1 λ 1 λ i 6 q 02 λ 2 π 1 λ i 7 in accordance with b 2 the following relations hold for r r 01 r b 8 i 5 r ln p γ 1 θ 01 ln p γ 1 θ 01 r d θ 2 f γ 1 θ 01 θ i 6 r ln p η 1 θ 01 ln p η 1 θ 01 r d θ 2 f η 1 θ 01 θ i 7 r ln p γ 2 θ 02 ln p γ 2 θ 02 r d θ 2 f γ 2 θ 02 θ converting b 7 to b 9 ψ 1 r θ q 01 2 π f γ 1 θ 01 θ 1 λ 1 λ f η 1 θ 01 θ q 02 λ π 1 λ f γ 2 θ 02 θ f 3 r if r 01 r r then i 5 2f γ1 θ01 θ and b 10 ψ 1 r θ q 01 2 π f γ 1 θ 01 θ 1 λ 1 λ f η 1 θ 01 θ q 02 λ π 1 λ f γ 2 θ 02 θ f 4 r similarly f 3 r and f 4 r are constant of integration comparing b 5 with b 9 and b 6 with b 10 it can be concluded that f 3 r φ r 1 φ l 1 β ln r f 1 θ and f 4 r φ r 1 φ l 1 β ln r f 2 θ hence f 1 θ and f 2 θ must be constant which are set equal to zero without loss of generality it is obvious that ψ s1 f 3 f 4 and the rest of terms in ψ1 can be recast as 11 appendix c when combined with 9 the definite integrals in 14 may be evaluated in terms of stream function c 1 q r 0 r ψ w 1 r θ 0 d r q r 1 r ψ w 2 r θ 0 d r q r 2 0 r 01 ψ w 1 r θ 0 d r r 01 r ψ w 1 r θ 0 d r q r 1 r r 02 ψ w 2 r θ 0 d r r 02 ψ w 2 r θ 0 d r q r 2 evaluating the integrals yields c 2 q r 1 ψ w 1 r 01 0 ψ w 1 0 0 ψ w 1 r 0 ψ w 1 r 01 0 q r 2 ψ w 2 r 02 0 ψ w 2 r 0 ψ w 2 0 ψ w 2 r 02 0 the above result is also supported by the fact that the difference in stream function between two consecutive streamlines is equal to the discharge flowing between them similarly substituting 9 in 15 after simplification gives c 3 q l 1 ψ w 1 0 β ψ w 1 r 01 β ψ w 1 r 01 β ψ w 1 r β q l 2 ψ w 2 r β ψ w 2 r 02 β ψ w 2 r 02 β ψ w 2 β the notations r 0 i and r 0 i identify r approaching r 0i from the left side and from the right side respectively since the stream function possesses the property that ψ w1 r θ ψ w2 r θ and ψ w1 0 θ ψ w2 θ 0 then c 4 q r ψ w 1 r 01 0 ψ w 1 r 01 0 ψ w 2 r 02 0 ψ w 2 r 02 0 q l ψ w 1 r 01 β ψ w 1 r 01 β ψ w 2 r 02 β ψ w 2 r 02 β or in terms of f c 5 q r q 01 π f 1 θ 01 0 q 02 π f 1 θ 02 0 and c 6 q l q 01 π f 1 θ 01 β q 02 π f 1 θ 02 β by virtue of the trigonometric identities gradshteyn and ryzhik 1980 it is straightforward to verify that f 1 ω 0 2 ta n 1 sin ω ω 1 cos ω ω π 1 ω β and f 1 ω β 2 ta n 1 sin ω ω 1 cos ω ω ω ω eqs c 5 and c 6 thus simplify to eqs 16 and 17 respectively 
363,natural hydrogeological settings may delineate wedge shaped aquifers that are sandwiched between streams lakes or sea water bodies along arbitrary oriented boundary lines this is the case in multiple river basins river deltas alluvial fans and coastal promontories and heterogeneity patterns are likely to arise because of sedimentation zoning the aim of present study is to provide a steady state analytical solution describing the nature of well extraction in heterogeneous wedge shaped aquifers formed by intersection of arbitrary oriented streams this laterally bounded aquifer comprises two zones of constant but differing transmissivity hydraulic conductivity which are hydraulically connected through a common interface first the method of green s function constructs a closed form expression for the spatial distribution of dual zone potential next the stream function is derived from the integration of cauchy riemann equations which in turn completes an analytical representation of the flow net the stream depletion rates are shown to be explicitly linked to the stream function this leads to simple expressions for the stream depletion rates demonstrating that the lateral recharge from adjacent streams varies linearly with the angular position of pumping well without any dependency on the aquifer heterogeneity the present solution encompasses a number of existing solutions for homogeneous aquifer system as subsets flow nets are generated for hypothetical test cases whereby stagnation points are identified semi analytically the present formulation ensures preservation of water balance for a capture zone subject to regional flow sensitivity analysis is conducted to address how drawdown at a certain observation point responds to a heterogeneity perturbation wider wedges appear more sensitive to variation of heterogeneity the formulation is extended to account for rainfall induced recharge over a dual zone unconfined aquifer in each case the computed head profiles agree well with numerical counterparts from finite element method keywords wedge shaped aquifers heterogeneity stream depletion rates stagnation point flow net nomenclature i subscript denoting zone i i 1 2 d d functions defined by eq 18 e e functions defined by eq 19 f function defined by eq 11 gij components of green s function defined by eqs 32 35 hi hydraulic head l hr hl hydraulic head along right and left streams l h heaviside function ki hydraulic conductivity lt 1 n 0 infiltration rate lt 1 p p functions defined by eq 6 q 0i well discharge l3t 1 q i strack s comprehensive discharge vector l2t 1 qr ql depletion rate from right and left streams l3t 1 r radial distance of interzonal boundary from the wedge apex l ra radial extent of recharge area l r θ coordinate of head observation point l radian r 0i θ0i coordinate of well l radian r sp θsp coordinate of stagnation point l radian s normalized sensitivity defined by eq 26 sgn sign function ti transmissivity l2t 1 x y cartesian coordinates l z nondimensional head defined as h h l h l β wedge angle radian γ i r r 0 i r r 0 i r r 0 i r r 0 i ω δ dirac delta function having the inverse dimension of its argument η1 r 01 r r 2 ω η2 r 2 r 02 r ω λ heterogeneity ratio defined as t 1 t 2 in confined and k 1 k 2 in unconfined aquifer φ i strack s comprehensive potential l3t 1 φii potential due to rainfall l3t 1 φ si ψ si potential and stream function due to regional flow l3t 1 φ wi ψ wi potential and stream function due to wells l3t 1 ψ i stream function l3t 1 ω π β 1 introduction typical alluvial fans comprise sediment deposits with a diversity of hydrogeological structures that convey infiltrated water from uplands to floodplain on the regional scale the occurrence of groundwater in such heterogeneous aquifers is affected by spatial variability of porosity and permeability fields on a more local scale ancient alluvial fans may be partitioned into wedge shaped units formed by intersection of arbitrary oriented streams yeh and chang 2006 revealing radial patterns of heterogeneity from the apex of the fan as shown in fig 1 samani and sedghi 2015 in some cases a stream may flow around a topographic feature and delineate a wedge and regional flow is expected to be directed from the high elevation section toward the low elevation section of the stream samani and zarei doudeji 2012 besides the stream heads may not be the same if there exists a geologic fault at the apex of the wedge yeh and chang 2006 these all influence the aquifer response to pumping activities in particular the heterogeneities cause irregular patterns of equipotentials and streamlines inside the capture zone of the well which is consistent with the field data haitjema 1995 similar patterns may be observed in multiple river basins with wells operating near the wedge shaped confluence of two tributaries yeh et al 2008 according to horton s law of stream numbers a higher order stream can potentially result from confluence of two low order tributaries fig 2 and the wedge shaped entities formed in this way may be analyzed separately from each other sedghi et al 2009 samani and zarei doudeji 2012 different zonation approaches have been proposed to mathematically describe the spatial variability of permeability field some studies conceptualize the heterogeneity as a random field sun et al 1998 winter and tartakovsky 2002 neuman and tartakovsky 2009 the others are focusing on deterministic features with hydraulic conductivity varied linearly montalto et al 2006 exponentially wang et al 2011 zlotnik et al 2011 harmonically craig 2009 or by an arbitrary polynomial craig 2015 common to almost all of the above mentioned studies is the assumption of continuously varying porous media in the natural hydrogeological settings it is not uncommon to observe distinct interfaces across which material properties jump abruptly contrasting geological blocks of constant but differing hydraulic conductivity craig 2015 mathematical models established for this purpose often assume spatially piecewise constant permeability such an idealization is also of relevance in evaluating hydrogeological impacts of coastal land reclamation consisting of a hillside aquifer and an oceanic elongated island guo and jiao 2007 hu et al 2008 the solution techniques for groundwater flow with zonal representation of hydraulic conductivity are briefly reviewed here focusing on analytical and semi analytical approaches historically the method of image wells has been widely accepted in groundwater hydraulics a relevant example is a pumping well near an infinitely long interface between two zones of constant but differing hydraulic conductivity haitjema 1995 katsifarakis and tselepidou 2009 the analogy with the problem of finding the electrostatic potential in adjacent semi infinite dielectrics is noticeable jackson 2007 the spatial distribution of drawdown takes a simple form for an aquifer of infinite areal extent but exclusion of external boundaries e g adjacent rivers lakes or bedrock outcrops may lead to an inaccurate estimation of aquifer response to steady state pumping for the case of finite aquifer domains the application of image wells is restricted to certain geometrical entities having rectangular zarei doudeji and samani 2014 or triangular boundaries mahdavi 2019a b all being filled with homogeneous materials the analytic element method has appeared as a mesh free alternative to finite difference and finite element methods for simulating steady flow through highly heterogeneous media craig 2009 strack 2017 the solution domain of the problem can be discretized into a number of polygonal sub domains each assigned a certain value of hydraulic conductivity and may be anisotropic itself despite the flexibilities offered by analytic elements in terms of aquifer geometry and lateral heterogeneity the boundary conditions are met in an approximate sense only but with desired accuracy craig 2015 the method of distributed transfer function originated from heat conduction problems in multilayer composites has been proven efficient in 1 d aquifer settings consisting of arbitrary number of homogenous sub aquifers under transient recharge and fluctuating river stage liang and zhang 2013 complications arise in dealing with transient problems defined by more than one spatial variable and semi analytical techniques are inevitable in most cases laplace domain expression has been derived for drawup due to spatially uniform recharge in dual zone rectangular aquifer surrounded by four constant head water bodies on its border das et al 2014 once obtained in the laplace domain the solution is transformed back to the physical space by numerical laplace inversion the same applies to multi zone wedge shaped aquifers under continuous pumping and the drawdown time series demonstrate how heterogeneity manifests itself at late times in most cases samani and sedghi 2015 the solution is however semi analytical requiring evaluation of infinite series of arbitrary order bessel functions and roots of transcendental equations for the associated eigenvalue problem in view of the mathematical difficulties mentioned above and in an attempt for easily computable solution the present study focuses on steady state response of a heterogeneous aquifer comprising two zones of internally homogeneous materials each containing an arbitrary located pumping well the problem is formulated in terms of the potential making it applicable to both confined and unconfined aquifers a closed form green s function is constructed for the potential and then integrated via the cauchy riemann equations to arrive at the associated stream function this completes analytical framework for the analysis of well capture zone and to the best of author s knowledge there exists no similar solution for the present hydrogeological setting also included is the effect of regional flow due to head difference between the surrounding streams stream depletion rates are given in a mathematically simple form hypothetical test cases illustrate several characteristics of the present solution 2 mathematical model 2 1 dual zone potential development of the mathematical model relies on some simplifying assumptions i the aquifer rests over a horizontal impermeable bed and groundwater flows horizontally in a fully saturated porous medium and under steady state condition ii two adjacent zones comprise the aquifer each of which filled with isotropic and homogeneous material of constant transmissivity ti and hydraulic conductivity ki i 1 2 thereby defining a dual zone structure for the aquifer heterogeneity iii the aquifer zones maintain hydraulic connection through a common interface called interzonal boundary iv for the straight streams sr and sl that surround the aquifer on its right and left sides the stream banks are assumed vertical and seepage faces on them are ignored v the stream heads hr and hl remain constant along the stream banks zero drawdown and regional flow is induced by difference between these two heads vi the boundary streams makes an angle β with each other 0 β 2π and their intersection at the origin of the polar coordinate system forms a wedge shaped domain for the aquifer that extends to infinity in the radial direction fig 3 and vii a system of two fully penetrating wells of infinitesimal radius pump water out of the aquifer at constant rates q 0i the above assumptions render the mathematical model analytically tractable and their physical relevance is discussed herein assumptions ii and iii refer to the regional variation of heterogeneity field and can be justified in aquifer systems with contrasting geological blocks of constant but differing hydraulic conductivity these homogeneous blocks are often interconnected through distinct interfaces across which material properties jump abruptly haitjema 1995 craig 2015 the radial variation of hydraulic conductivity can be observed in alluvial fans where the permeability changes radially from high energy coarse grained deposition near the apex to low energy fine grained deposition downstream samani and sedghi 2015 another interesting example would be the case of groundwater flow around beaver dams revealing a jump in the potential from the beaver pond to the tailwater sharps 1996 ecohydrologically the near pond part of an unconfined aquifer is of most interest because the beavers bioengineers deforest the adjacent woodland the trees perish and the hydraulic conductivity of the corresponding soil may change in the radial manner similar to that assumed in the present study assumptions iv and v establish zero drawdown condition along the adjacent streams in an attempt to closely replicate real world hydrogeological settings zero drawdown condition may be specified on the basis of annual average water level in the stream which may also serve as time independent head for a regional groundwater flow system yeh and chang 2006 assumptions vi and vii consider steady state pumping near the confluence of two tributaries in an alluvial fan or multiple river basin the strack s comprehensive potential for the dual zone aquifer system is denoted by φ i this can be related to the hydraulic head hi r θ as φ i tihi or φ i k i h i 2 2 for confined or unconfined flows respectively the spatial distribution of dual zone potential is governed by the following boundary value problem bvp 1 2 φ i σ i the radial and angular coordinates are denoted by r and θ respectively and pumping wells are placed at r 0i θ0i as shown in fig 3 in eq 1 the laplacian is defined by 2 φ i 1 r r r φ i r 1 r 2 2 φ i θ 2 and the right hand side is σ i q 0i δ r r 0i δ θ θ0i r with δ being the dirac delta function the boundary streams sr and sl run along the lines θ 0 and θ β respectively fig 3 well posedness of the bvp requires boundary conditions that reflect the physical reality as follows 2 φ i r 0 φ r i stream s r φ i r β φ l i stream s l where φ ri tihr and φ li tihl for confined and φ r i k i h r 2 2 and φ l i k i h l 2 2 for unconfined flows it is well known that the hydraulic head and the normal component of the darcian velocity perpendicular to the arc r r indicated by dashed line in fig 3 are continuous across this arc consequently the interzonal conditions in terms of strack s comprehensive potential read haitjema 1995 3 φ 1 r θ λ φ 2 r θ and 4 φ 1 r r θ φ 2 r r θ the heterogeneity ratio of adjacent zones is given by λ t 1 t 2 for confined aquifer and λ k 1 k 2 for unconfined aquifer it is assumed that the radial component of the darcian velocity vanishes at infinitely large distance from the wells and this can be expressed by no flow condition huang et al 2015 5 lim r φ 2 r 0 in view of the linearity of eq 1 the potential φ i fig 3a can be decomposed into two separate components reflecting contributions from wells φ wi fig 3b and regional flow φ si fig 3c the method of green s function constructs a closed form expression for φ wi as follows appendix a 6 φ w 1 r θ q 01 4 π ln p γ 1 θ 01 p γ 1 θ 01 1 λ 1 λ ln p η 1 θ 01 p η 1 θ 01 q 02 λ 2 π 1 λ ln p γ 2 θ 02 p γ 2 θ 02 and 7 φ w 2 r θ q 02 4 π ln p γ 2 θ 02 p γ 2 θ 02 1 λ 1 λ ln p η 2 θ 02 p η 2 θ 02 q 01 2 π 1 λ ln p γ 1 θ 01 p γ 1 θ 01 where p λ ω 1 2λcos ω θ ω λ2 ω π β η 1 r 01 r r 2 ω η 2 r 2 r 02 r ω and γ i r r 0 i r r 0 i r r 0 i r r 0 i ω note that p varies with ω and θ as well but these dependencies are not explicitly displayed on the left hand side of p for notational convenience the solution that satisfies the bvp of fig 3c for regional flow is linear in θ demonstrating a fan like distribution of equipotentials as follows 8 φ s i θ φ r i φ l i φ r i θ β superposition specifies φ i φ wi φ si in each aquifer zone the interzonal conditions 3 and 4 are met by φ si and there would be no regional flow if bounding streams maintain zero head gradient hr hl 2 2 stream function let ψ i r θ denotes the stream function in the dual zone aquifer the potential and stream function are interconnected through the cauchy riemann equations written in the polar form as 9 ψ i r 1 r φ i θ and 10 ψ i θ r φ i r the stream function combines the effects of wells ψ wi and regional flow ψ s1 in each aquifer zone ψ i ψ wi ψ si contours of constant stream function serve as streamlines strack 2017 the cauchy riemann equations are integrated to arrive at the following closed form expressions for the stream function detailed derivation for zone 1 is given in appendix b 11 ψ w 1 r θ q 02 λ π 1 λ f γ 2 θ 02 θ q 01 1 λ 2 π 1 λ f η 1 θ 01 θ q 01 2 π f γ 1 θ 01 θ for 0 r r 01 r q 01 2 π f γ 1 θ 01 θ for 0 r 01 r r and 12 ψ w 2 r θ q 01 π 1 λ f γ 1 θ 01 θ q 02 1 λ 2 π 1 λ f η 2 θ 02 θ q 02 2 π f γ 2 θ 02 θ for r r r 02 q 02 2 π f γ 2 θ 02 θ for r r 02 r and 13 ψ s i r φ r i φ l i β ln r where f λ ω θ ta n 1 λ sin ω θ ω 1 λ cos ω θ ω ta n 1 λ sin ω θ ω 1 λ cos ω θ ω note that f varies with ω as well but this in not explicitly displayed on the left hand side of f for notational convenience 2 3 stream depletion rate sdr the pumping wells can deplete lateral streams and induce inflow to the aquifer sdr values for the right and left streams can be computed in terms of volumetric rates qr and ql as follows 14 q r q r 1 q r 2 0 r 1 r φ w 1 θ θ 0 d r r 1 r φ w 2 θ θ 0 d r 15 q l q l 1 q l 2 0 r 1 r φ w 1 θ θ β d r r 1 r φ w 2 θ θ β d r the above integrals convert to appendix c 16 q r 1 θ 01 β q 01 1 θ 02 β q 02 and 17 q l 1 β θ 01 q 01 θ 02 q 02 interestingly no matter the value of heterogeneity ratio the sdr values merely depend on the angular coordinate of the wells eqs 16 and 17 maintain the water balance for the stream aquifer system by satisfying qr ql q 01 q 02 it is worth mentioning that most of the existing sdr formulations exclude the effect of regional flow and only well induced fluxes are accounted for yeh et al 2008 however the regional flow has an impact on the water balance at capture zone scale as it will be clarified in the next paragraphs 2 4 stagnation points groundwater stagnates at a point where both components of strack s comprehensive discharge vector vanish stagnation points may be detected semi analytically ataie ashtiani et al 2012 mahdavi 2020 the angular and radial components of strack s comprehensive discharge vector q i r θ are computed as q θ i 1 r φ i θ and q r i φ i r respectively kacimov et al 2016 setting them equal to zero results in a system of nonlinear algebraic equations for the coordinates of stagnation point s in each aquifer zone the system consisting of q θ1 0 and q r1 0 can be written respectively as 18 2 λ 1 λ q 02 d γ 2 θ 02 d γ 2 θ 02 1 λ 1 λ q 01 d η 1 θ 01 d η 1 θ 01 q 01 d γ 1 θ 01 d γ 1 θ 01 2 φ r 1 φ l 1 and 19 2 λ 1 λ q 02 e γ 2 θ 02 e γ 2 θ 02 1 λ 1 λ q 01 e η 1 θ 01 e η 1 θ 01 q 01 sgn r r 01 e γ 1 θ 01 e γ 1 θ 01 0 likewise q θ2 0 and q r2 0 give 20 2 1 λ q 01 d γ 1 θ 01 d γ 1 θ 01 1 λ 1 λ q 02 d η 2 θ 02 d η 2 θ 02 q 02 d γ 2 θ 02 d γ 2 θ 02 2 φ r 2 φ l 2 and 21 2 1 λ q 01 e γ 1 θ 01 e γ 1 θ 01 1 λ 1 λ q 02 e η 2 θ 02 e η 2 θ 02 q 02 sgn r r 02 e γ 2 θ 02 e γ 2 θ 02 0 where d λ ω λ sin ω θ ω p λ ω e λ ω λ λ cos ω θ ω p λ ω and sgn is the sign function both of d and e vary with ω and θ as well but this is not explicitly displayed on the left hand side of them for notational convenience the roots of above equations are obtained numerically by the maple function fsolve and denoted by r r sp and θ θsp hereafter 3 results and discussion 3 1 comparison with existing solutions a special case of interest is that of a single zone homogeneous aquifer λ 1 in the absence of regional flow eq 6 thus reduces to φ w 1 q 01 4 π ln p γ 1 θ 01 p γ 1 θ 01 for a single pumping well of discharge q 01 at r 01 θ01 chan et al 1978 obtained the same result under a different notation in terms of drawdown further the sdr values from 16 and 17 simplify to q r 1 θ 01 β q 01 and q l θ 01 β q 01 which represent the solution of yeh et al 2008 in fig 4 the streamlines drawn by 11 are compared with the solution of nagheli et al 2020 for a homogeneous aquifer having β 3θ01 37 r 01 r 0 6 and q 01 50 m3 day fig 4a refers to stream stream wedge as adopted in the foregoing analysis fig 4b examines stream barrier wedge replacing stream sl by an impervious barrier across which no flow can take place the analysis of this case is accomplished by evaluating 11 for ω 2 and inserting an image well of the same pumping rate at r 01 2β θ01 so that the pair of real and image wells are mirror reflections of each other with respect to the boundary line θ β chan et al 1978 mahdavi 2020 the solution of nagheli et al 2020 is treated likewise interaction of real and image wells causes the flow to stagnate at point a on the impervious barrier r spa r 0 6 two convergent streamlines that run tangential to the boundary merge together at this point producing a streamline toward the well the streamlines calculated by both models appear to be indistinguishable from each other as fig 4 indicates next we address the condition under which the present geometry degenerates to an annular wedge shaped domain of the kind discussed by mahdavi 2020 theoretically there would be no resistance against the flow in zone 1 if its permeability approaches infinity in other words the drawdown is expected to be zero everywhere in zone 1 such a trend may be detected by increasing λ in fig 10 this limiting case resembles a zero drawdown stream along the arc r r delineating an annular wedge shaped aquifer that consists only of zone 2 in a similar context haitjema 1995 simulated a lake by specifying infinite hydraulic conductivity inside its region the analysis is accomplished by letting λ and the aquifer response from 7 and 12 reduces to 22 φ w 2 q 02 4 π ln p η 2 θ 02 p γ 2 θ 02 p γ 2 θ 02 p η 2 θ 02 and 23 ψ w 2 q 02 2 π f η 2 θ 02 θ q 02 2 π f γ 2 θ 02 θ for r r r 02 q 02 2 π f γ 2 θ 02 θ for r r 02 r these repeat the solution of mahdavi 2020 for a pumping well of discharge q 02 at r 02 θ02 similarly zone 2 will behave as a constant head lake if λ 0 and eq 6 and eq 12 convert to 24 φ w 1 q 01 4 π ln p η 1 θ 01 p γ 1 θ 01 p γ 1 θ 01 p η 1 θ 01 and 25 ψ w 1 q 01 2 π f η 1 θ 01 θ q 01 2 π f γ 1 θ 01 θ for 0 r r 01 r q 01 2 π f γ 1 θ 01 θ for 0 r 01 r r eqs 24 and 25 describe the flow net in a sector domain of finite radial extent 0 r r interacting with zero drawdown streams or water bodies on its borders the above mentioned solutions may therefore be regarded as special cases of the present solution 3 2 flow nets and capture zone water balance key aspects of the proposed solution are highlighted through a set of hypothetical examples referred to as case 1 case 2 case 3 and case 4 henceforth it is to be noted that a variety of flow nets can be constructed by changing the hydrogeological parameters in the mathematical model e g aquifer geometry location and discharge of the wells heterogeneity ratio and difference in the stream heads default parameters chosen in what follows are r 2500 m t 2 40 m2 day and h l 13 m the pumping rates in case 1 and case 2 are q 01 100 m3 day and q 02 60 m3 day also β 3θ01 2θ02 70 r 01 r 0 8 r 02 r 1 24 and h r 15 m in case 3 β 1 25θ01 1 5θ02 70 and hr 13 m in case 4 β 37 and hr 14 m the nondimensional head is defined as z r θ h r θ h l h l and radial and angular positions are normalized with r and β respectively in case 1 the heterogeneity ratio of confined aquifer is set to λ 0 5 as fig 5 shows the fan like pattern of equipotentials emanating from the origin is disrupted by the pumping wells but recovered far away from the wells where induced drawdown is negligible the contours of nondimensional head are distributed in uniform intervals of 0 02 exception is the contour line that intersects itself at point a zoom in view in fig 5 both of the angular and radial components of discharge vector vanish there hence it represents a stagnation point q 1 r sp a θ sp a 0 a similar behavior can be observed at point b q 2 r sp b θ sp b 0 analogous to snell s law of optics an incident streamline that strikes the interzonal boundary in zone 2 is refracted toward the boundary normal upon entering the less permeable porous medium of zone 1 the flow net reveals nested capture zones for the wells the bounding streamlines marked ac and ad delineate a capture envelope for the first well whose width extends from rc r 0 399 to rd r 2 061 along sr the enclosed area fully encompasses the capture zone of the second well which is formed by the bounding streamlines be and bf the capture envelops are marked by thick lines of different color the extraction wells gain their water from the regional flow and from depletion of sr with different proportions since no water can escape or enter across the bounding streamlines the flow mass must be conserved inside the capture zone in other words the aquifer is recharged over three adjacent segments on sr namely segments ce and ef and a narrow segment between f and d and wells must extract all of this water since different expressions apply to stream function in each zone the recharging segment is divided accordingly to two intervals that extend from r rc to r r in zone 1 and from r r to r rd in zone 2 an analysis similar to that outlined for the sdr calculation suggests that inflow rates can be estimated from difference in the stream function values evaluating eqs 11 13 over respective intervals gives ψ 1 r 01 0 ψ 1 r c 0 ψ 1 r 0 ψ 1 r 01 0 72 94 m 3 day and ψ 2 r 02 0 ψ 2 r 0 ψ 2 r d 0 ψ 2 r 02 0 87 06 m 3 day the sum of which will exactly counterbalance the total extraction rate q 01 q 02 160 m3 day in accordance with the steady state water balance for the capture zone case 2 examines how flow net is affected if transmissivity of zone 1 is halved λ 0 25 keeping the other parameters same the flow net is shown in fig 6 refraction of streamlines is more pronounced compared to previous case the capture zone of the first well has shifted downgradient causing intersection with stream sl at stagnation points a and b contrary the position of stagnation point c is less sensitive to t 1 and remained fairly close to its counterpart in case 1 i e point b in fig 5 it is to be noted that the radial component of the discharge vector identically vanishes along the adjacent streams this can be verified by observing that both of 19 and 21 are satisfied for θ 0 and θ β on the other hand the angular component of the discharge vector is equal to zero at stagnation points consequently the flow locally reverses its direction and incident streamlines reflect at points a and b over segment ab the stream is depleted inflow whereas regional flow leaves the aquifer outflow however the inflow dominates over the outflow so that the net flow is directed toward the first well the volumetric rate to be captured by this well is given by ψ 1 r s p a β ψ 1 r 01 β ψ 1 r 01 β ψ 1 r β ψ 2 r β ψ 2 r s p b β 1 47 m 3 day similar to the previous case a segment of sr extending from rd r 0 303to re r 2 234 recharges the aquifer with the volumetric rate evaluated as ψ 1 r 01 0 ψ 1 r d 0 ψ 1 r 0 ψ 1 r 01 0 ψ 2 r 02 0 ψ 2 r 0 ψ 2 r e 0 ψ 2 r 02 0 158 53 m 3 day again these values sum to total extraction rate and flow mass is conserved inside the capture zone in case 3 the heads assume an initially flat distribution throughout the aquifer by setting hl hr 13 m the heterogeneity ratio is same as previous case but the wells are placed rather close to sl at angular positions θ01 0 8β and θ02 2β 3 and the discharge of well 2 is doubled q 02 120 m3 day the flow net is shown in fig 7 a saddle stagnation point can be observed roughly midway between the wells where four streamlines intersect point a two streamlines originate from and two merge at this point the latter two divide the aquifer area into two subregions on the left zone water is fully drawn by well 1 and on the right zone by well 2 the flow to each well is supplied by depletion of both streams in case 4 a confined aquifer having λ 0 25 is exposed to a permanent source of contamination over a segment of sr that lies between rb r 0 4 and rc r 0 8 a remediation scheme is scheduled to capture the contaminated water by continuously pumping the aquifer within zone 1 to optimally contain the contamination source the capture envelope should pass through the end points of the contaminated segment strack 2017 a primary step to satisfy this constraint is to determine the well position and discharge and this can be addressed on a trial and error basis as a first trial it is customary to place the well on the bisector of the wedge midway between rb and rc at r 01 r 0 6 similar to previous cases the pumping activity is partially supported by regional flow and partially by depletion of stream sr over segment bc the water balance for the capture zone reads ψ 1 r 01 0 ψ 1 r b 0 ψ 1 r c 0 ψ 1 r 01 0 q 01 from which one obtains q 01 17 14 m3 day for the first trial by assessment of the flow net not shown here the intersections of capture envelope with sr are found to occur at rb r 0 426 and rc r 0 851 clearly there exists a downstream offset from the desired values of rb and rc which may be compensated by an upstream shift of the capture envelope to accomplish this the well position is changed iteratively along the radial direction until the bounding streamlines exactly encompass the contamination source the results converge after a few iterations to r 01 r 0 565 and q 01 17 28 m3 day fig 8 depicts the flow net where capture zone is formed upgradient of the stagnation point the flow outside the capture zone is bypassed by the well and all of the streamlines become perpendicular to the adjacent streams overall heads descend in the downgradient direction the remediation layout achieved in this way may be regarded as optimal in the sense that none of the contaminated groundwater can escape from the capture zone keeping the outside regions unaffected by the impact of polluted inflow zarei doudeji and samani 2014 3 3 effects of head difference between the streams this section demonstrates how the position of the stagnation point associated with a single pumping well in zone 2 is affected by the head difference between the streams in a confined aquifer computations are carried out by solving 18 21 for the specified values of β 2θ02 50 r 02 r 1 12 λ 0 25 and q 02 t 2 1 m normalized parameters are defined as r i r 02 r sp r 02 and θ i θ sp θ 02 θ 02 where i 1 if stagnation point is in zone 1 and i 2 if it is in zone 2 these parameters measure the radial and angular deviation of the stagnation point from the well position respectively the induced flow is proportional to the head difference between the streams i hr hl while hr is varied incrementally from 13 m to 15 m and hl is fixed at 13 m the variation of r i and θ i are depicted in fig 9 there exist two stagnation points for the stream heads not exceeding h r 13 7377 m and the head difference associated with this limiting case is denoted by io both of the stagnation points lay along stream s r dashed line for θ 1 θ 2 1 one in zone 1 solid line and the other in zone 2 dash dotted line for i io the variations of r 1 and r 2 indicate that the stagnation points are becoming closer to the well in response to an increase in i once the limiting case of i io is exceeded the stagnation point in zone 1 disappeared and the curve of θ 2 began to descend dotted line however the curve of r 2 shows comparatively slow variation beyond i io when the upper bound of h r is approached the radial coordinate of the stagnation point becomes approximately same as that of the well itself notice the negligibly small values of r 2 indicating that r 02 r sp in practice indeed the velocity magnitudes associated with high values of i are large enough to locally stagnate the flow in the close vicinity of the pumping well 3 4 fem comparison and heterogeneity effects the foregoing comparisons in section 3 1 were restricted to homogeneous aquifers for which analytical solutions are available in the literature response of heterogeneous aquifers case 1 and case 2 is tested here against the matlab finite element toolbox pdetool a variety of 2 d problems of groundwater hydraulics can be implemented in this framework mahdavi and seyyedian 2013 kacimov et al 2017 mahdavi 2019 a b mahdavi 2020 the toolbox allows dealing with the elliptic model x τ h x y τ h y σ subject to dirichlet and neumann boundary conditions in arbitrary shaped domains the cartesian coordinate system x y has its origin at the aquifer vertex with x directed along sr and y positive upward so that the relations x rcosθ and y rsinθ hold the aquifer heterogeneity can be accounted for thanks to the spatial variability of τ which plays the role of transmissivity field in the present analysis the dual zone confined aquifer takes τ t 1 if x 2 y 2 r 2 and outside this region τ t 2 the singular nature of the dirac delta function will pose a numerical challenge for direct implementation of σ in the form of q 0i δ x x 0i δ y y 0i as discussed in a similar context by eftekhari 2015 alternatively an extraction intensity σ q 0i πl 2 can be uniformly distributed over a circle of radius l centered at the well position x 0i y 0i in other words the product of two dirac delta functions is approximated by 1 π l 2 wherever x x 0i 2 y y 0i 2 l 2 and outside this region σ 0 however there is a tradeoff in choosing an optimal radius for the circle in order to adequately represent a well of infinitesimal radius it needs to be appreciably small but not smaller than the average element size after some numerical experiments the optimal radius is found to be l 10 m the computational domain is truncated to a wedge of radius 4r which seems large enough to numerically resemble the condition of infinite radial extent a relatively coarse mesh of triangular elements discretizes the domain at the initial stage of computation finite elements are adaptively refined to return smaller triangles close to the wells where drawdowns vary significantly over distance iterations stop if changes in the solution between two successive refinements fall below a predefined tolerance the results converge when the number of elements is approximately 250 000 head distributions obtained in this way are plotted in fig 10 for case 1 λ 0 5 and case 2 λ 0 25 the results are sampled along radial lines passing through the well positions θ β 3 fig 10a and θ β 2 fig 10b the response of homogenous aquifer λ 1 is also shown as a reference by increasing t 1 hence λ more water is transmitted laterally to the first well which in turn reduces drawdown in zone 1 zone 2 is influenced accordingly though the value of t 2 remained unchanged owing to its larger pumping rate the first well induces noticeable depression along the radial line passing through the second well as can be seen from the curves in fig 10b the vice versa is not however true and fig 10a is free from any visible impact of the second well the curves preserve the continuity of head across the interzonal boundary with radial slopes reflecting aquifer heterogeneity as per eq 4 the analytical and numerical curves are in strictly close agreement more insight into the influence of heterogeneity on aquifer response can be achieved by conducting a sensitivity analysis in the derivative based framework proposed by kabala 2001 in doing so a set of confined aquifers are generated by changing β from 10 to 210 in uniform 1 intervals each undergoing pumping on its bisector with q 01 100 m3 day and r 01 r 0 8 prior to the well activity the aquifer and streams are in hydraulic equilibrium maintaining a constant head h 0 hl hr 13 m throughout the adjacent zones the aquifer response in zone 1 is examined in terms of nondimensional drawdown defined by s z since h 1 φ1 t 2λ has singularity at the well position the drawdown is measured in close vicinity of the well at 1 05r 01 β 2 by definition the normalized sensitivity of s to the changes in λ is evaluated as s s λ λ s λ kabala 2001 the derivatives arising in sensitivity analysis are commonly approximated by forward finite differences yeh et al 2008 mahdavi 2019a but an analytical representation can be explicitly extracted from 6 26 s s λ q 01 4 π t 2 h 0 λ ln p γ 1 θ 01 p γ 1 θ 01 λ 2 2 λ 1 1 λ 2 ln p η 1 θ 01 p η 1 θ 01 it is to be noted that both the well and drawdown observation point belong to the same aquifer zone fig 11 depicts sensitivity contours for heterogeneity ratios ranging from 0 5 to 5 with t 2 kept at 40 m2 day in evaluating 26 a number of observations can be made from the contour map i the values of s are negative everywhere in β λ space indicating that s and λ are negatively correlated indeed any increase in λ will subsequently reduce s as it was already confirmed by fig 10 ii for a certain value of β the drawdown gradually loses its sensitivity by increasing the heterogeneity ratio iii for a certain value of λ s will grow in absolute magnitude as aquifer vertex angle increases in other words the wider the wedge the more pronounced will be the influence of variation of heterogeneity ratio on its drawdown response 3 5 rainfall recharge groundwater resources are naturally replenished by rainfall induced recharge causing spreading groundwater mounds in unconfined aquifers for the present analysis the head is assumed constant everywhere prior to recharge maintaining hydraulic equilibrium between the aquifer and adjacent streams the recharge keeps a spatially constant rate of n 0 over a finite subregion 0 r ra and 0 θ β of the unconfined aquifer which defines the recharge area further the recharge process is assumed to not affect the stream heads but only alters head distribution inside the aquifer so that a groundwater mound will develop das et al 2014 mahdavi and seyyedian 2014 kacimov et al 2016 the mound elevation can be represented in terms of strack s comprehensive potential due to rainfall recharge φii whose spatial variation in the steady state is governed by 27 2 φ i i n 0 the above bvp is treated by extending already derived point source formula eqs 6 and 7 to accommodate areal effects of rainfall recharge accordingly the solution of 27 follows from integration of green s function over the recharge area mahdavi 2015 two cases can be mathematically distinguished regarding the radial extent of recharge area if it is fully encompassed within zone 1 ra r then 28 φ i 1 r θ n 0 0 β 0 r a g 11 r θ r 0 θ 0 r 0 d r 0 d θ 0 and 29 φ i 2 r θ n 0 0 β 0 r a g 21 r θ r 0 θ 0 r 0 d r 0 d θ 0 otherwise if recharge area spreads out to partially cover zone 2 ra r then 30 φ i 1 r θ n 0 0 β 0 r g 11 r θ r 0 θ 0 r 0 d r 0 d θ 0 0 β r r a g 12 r θ r 0 θ 0 r 0 d r 0 d θ 0 and 31 φ i 2 r θ n 0 0 β 0 r g 21 r θ r 0 θ 0 r 0 d r 0 d θ 0 0 β r r a g 22 r θ r 0 θ 0 r 0 d r 0 d θ 0 where gij r θ r 0 θ0 denotes the potential field generated in zone i by a unit source acting at a point r 0 θ0 belonging to zone j i 1 2 j 1 2 for zone 1 the following components of green s function can be identified from eq 6 32 g 11 r θ r 0 θ 0 1 4 π ln p γ 0 θ 0 p γ 0 θ 0 1 λ 1 λ ln p ρ 0 θ 0 p ρ 0 θ 0 and 33 g 12 r θ r 0 θ 0 λ 2 π 1 λ ln p γ 0 θ 0 p γ 0 θ 0 where γ 0 r r 0 r r 0 r r 0 r r 0 ω and ρ 0 r 0 r r 2 ω for zone 2 eq 7 gives 34 g 21 r θ r 0 θ 0 1 2 π 1 λ ln p γ 0 θ 0 p γ 0 θ 0 and 35 g 22 r θ r 0 θ 0 1 4 π ln p γ 0 θ 0 p γ 0 θ 0 1 λ 1 λ ln p ρ 0 1 θ 0 p ρ 0 1 θ 0 each of the green s functions 32 35 possesses the symmetry property in the sense that it remains invariant when the coordinates r θ and r 0 θ0 are interchanged that is gij r θ r 0 θ0 gij r 0 θ0 r θ a numerical test is conducted for an aquifer having β 110 k 1 3 m day and k 2 1 m day λ 3 under areal recharge of rate n 0 0 005 cm day the stream heads are both equal to 20 m the matlab function integral2 performs numerical integrations arising in eqs 28 31 the contour maps of z shown in fig 12 represent nondimensional mound levels in this case the function z is symmetric with respect to the bisector of the wedge and the mound peak occurs in zone 1 if ra r fig 12a and in zone 2 if ra r fig 12b as fig 13 indicates the computed mound profiles agree well with numerical results from finite element method 4 conclusions a steady state green s function was constructed for simulating flow through a heterogeneous wedge shaped aquifer under continuous pumping and regional flow due to head difference between the surrounding streams the analytical representation of the flow net has the advantage of mathematical simplicity while describing an explicit relationship among the variables of interest in capture zone analysis and dual zone heterogeneity the solution is general in the sense that the aquifer vertex angle as well as zonal transmissivities can be chosen arbitrary extension to arbitrary number of wells is straightforward in accordance with the principle of superposition finally the aquifer response to rainfall induced recharge was obtained by integrating the point source formula over wedge shaped recharge area overall the following conclusions can be drawn i in the limit when heterogeneity ratio approaches infinity the aquifer domain degenerates to an annular wedge of infinite radial extent and the present solution reduces to that of mahdavi 2020 for such geometrical entities eqs 22 and 23 ii there exist two stagnation points associated with a pumping well under low gradients of regional flow by exceeding a certain value of regional gradient one of the stagnation points disappeared and the other become more and more close to the well as regional gradient intensifies fig 9 iii stream depletion rates are explicitly linked to the stream function in view of this stream depletion rates are shown to vary linearly with angular position of the well without any dependency on the aquifer heterogeneity eqs 16 and 17 iv the volumetric rate of water exchange over a segment of stream aquifer interface was calculated as a difference in the stream function values at the starting point and at the end point of that segment accordingly the preservation of water balance was assessed at the capture zone scale case 1 and case 2 whereby wells extract the total amount of water coming from depletion of streams and regional flow such analysis may be incorporated into an optimal aquifer remediation design allowing delineation of a capture envelope that encompasses the contaminated area exactly case 4 v aquifer heads decline in both aquifer zones by decreasing the heterogeneity ratio sensitivity analysis indicates that the drawdowns respond more appreciably to a heterogeneity perturbation as the vertex angles become wider fig 11 credit authorship contribution statement ali mahdavi conceptualization methodology validation visualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103823 appendix d supplementary materials image application 1 appendix a the bvp in fig 3b is treated by the method of green s function according to this method the dual zone potential is sought as an expansion in terms of radial and angular components a 1 φ w i r θ n 1 u n i r sin n ω θ the fourier series expansion of the dirac delta function reads a 2 δ θ θ 0 i 2 β n 1 sin n ω θ sin n ω θ 0 i both of a 1 and a 2 satisfy the homogeneous boundary conditions associated with the streams in fig 3b by inserting them into the bvp of fig 3b the governing equation in each aquifer zone will reduce to a nonhomogeneous ode for the radial component a 3 d 2 u n i r d r 2 1 r d u n i r d r n ω r 2 u n i r 2 q 0 i r β δ r r 0 i sin n ω θ 0 i following mahdavi 2020 the solution of a 3 is a 4 u n i r c i 1 r n ω c i 2 r n ω q 0 i n π h r r 0 i r r 0 i n ω r 0 i r n ω sin n ω θ 0 i where h is the heaviside function the four unknown coefficients c i1 and c i2 i 1 2 are determined as follows the potential in zone 1 must be bounded when r 0 thus c 12 0 differentiating u n2 r with respect to r the remote boundary condition 5 can be rearranged as a 5 lim r d u n 2 r d r n ω r n ω 1 c 21 q 02 n π r 02 n ω sin n ω θ 02 n ω r n ω 1 c 22 q 02 n π r 02 n ω sin n ω θ 02 0 the second term vanishes because lim r r n ω 1 0 in the first term however the magnitude of r nω 1 grows unbounded if nω 1 otherwise it becomes unity for a 5 to hold in either case the factor of r nω 1 must be equal to zero resulting in a 6 c 21 q 02 n π r 02 n ω sin n ω θ 02 the interzonal boundary conditions 3 and 4 will transform respectively to u n1 r λu n2 r and d u n 1 d r r d u n 2 d r r resulting in a 7 c 11 r n ω q 01 n π r r 01 n ω r 01 r n ω sin n ω θ 01 c 21 r n ω λ c 22 r n ω λ and a 8 c 11 r n ω q 01 n π r r 01 n ω r 01 r n ω sin n ω θ 01 c 21 r n ω c 22 r n ω or in a more compact from a 9 r n ω r n ω λ r n ω r n ω c 11 c 22 m n where a 10 m c 21 r n ω λ q 01 n π r 01 r n ω r r 01 n ω sin n ω θ 01 n c 21 r n ω q 01 n π r 01 r n ω r r 01 n ω sin n ω θ 01 the solution of a 9 is a 11 c 11 c 22 1 1 λ m λ n r n ω n m r n ω the coefficients already determined are inserted in a 4 a 12 u n 1 r q 01 n π 1 λ 1 λ r 01 r r 2 n ω r r 01 n ω r r 01 n ω r 01 r n ω h r r 01 sin n ω θ 01 2 q 02 λ n π 1 λ r r 02 n ω sin n ω θ 02 and a 13 u n 2 r q 02 n π 1 λ 1 λ r 2 r 02 r n ω r r 02 n ω r r 02 n ω r 02 r n ω h r r 02 sin n ω θ 02 2 q 01 n π 1 λ r 01 r n ω sin n ω θ 01 the heaviside function splits each of a 12 and a 13 into two expressions depending on the relative position of the head observation point r θ with respect to the well r 0i θ0i substituting them in a 1 leads to the following expressions for the dual zone potential a 14 φ w 1 r θ n 1 2 q 02 λ n π 1 λ r r 02 n ω sin n ω θ 02 sin n ω θ q 01 n π 1 λ 1 λ r 01 r r 2 n ω r r 01 n ω sin n ω θ 01 sin n ω θ for 0 r r 01 r q 01 n π 1 λ 1 λ r 01 r r 2 n ω r 01 r n ω sin n ω θ 01 sin n ω θ for 0 r 01 r r and a 15 φ w 2 r θ n 1 2 q 01 n π 1 λ r 01 r n ω sin n ω θ 01 sin n ω θ q 02 n π 1 λ 1 λ r 2 r 02 r n ω r r 02 n ω sin n ω θ 02 sin n ω θ for r r r 02 q 02 n π 1 λ 1 λ r 2 r 02 r n ω r 02 r n ω sin n ω θ 02 sin n ω θ for r r 02 r by introducing the auxiliary variable γ i which takes r r 0i ω for r r 0i and r 0i r ω otherwise both expressions are rendered in a single form valid over entire area of each aquifer zone a 16 φ w 1 r θ n 1 q 02 λ γ 2 n n π 1 λ cos n ω θ θ 02 cos n ω θ θ 02 q 01 2 n π 1 λ 1 λ η 1 n γ 1 n cos n ω θ θ 01 cos n ω θ θ 01 and a 17 φ w 2 r θ n 1 q 01 γ 1 n n π 1 λ cos n ω θ θ 01 cos n ω θ θ 01 q 02 2 n π 1 λ 1 λ η 2 n γ 2 n cos n ω θ θ 02 cos n ω θ θ 02 the infinite series can be summed up analytically as follows gradshteyn and ryzhik 1980 melnikov and melnikov 2012 a 18 n 1 λ n n cos n χ 1 2 ln 1 2 λ cos χ λ 2 the above formula assumes λ 1 and 0 χ 2π which is satisfied here because η i 1 γ i 1 and 0 ω θ θ0i 2π therefore a 16 and a 17 transform to easily computable forms expressed by 6 and 7 appendix b integrals of the generic forms b 1 and b 2 arise when dealing with the cauchy riemann equations in polar coordinates mahdavi 2020 b 1 i ln 1 2 λ cos χ λ 2 χ d λ λ 2 ta n 1 λ sin χ 1 λ cos χ b 2 ln 1 2 λ cos χ λ 2 λ λ d χ i to arrive at the spatial distribution of ψ1 eq 9 is integrated in r as follows b 3 ψ 1 r θ φ 1 θ d r r i 1 q 01 4 π i 2 1 λ 1 λ i 3 q 02 λ 2 π 1 λ i 4 where i 1 φ r 1 φ l 1 β r d r φ r 1 φ l 1 β ln r for r r 01 r and by virtue of b 1 it is easy to verify that b 4 i 2 θ ln p γ 1 θ 01 ln p γ 1 θ 01 d r r 2 f γ 1 θ 01 θ i 3 θ ln p η 1 θ 01 ln p η 1 θ 01 d r r 2 f η 1 θ 01 θ i 4 θ ln p γ 2 θ 02 ln p γ 2 θ 02 d r r 2 f γ 2 θ 02 θ converting b 3 to b 5 ψ 1 r θ φ r 1 φ l 1 β ln r q 01 2 π f γ 1 θ 01 θ 1 λ 1 λ f η 1 θ 01 θ q 02 λ π 1 λ f γ 2 θ 02 θ f 1 θ if r 01 r r then i 2 2f γ1 θ01 θ and b 6 ψ 1 r θ φ r 1 φ l 1 β ln r q 01 2 π f γ 1 θ 01 θ 1 λ 1 λ f η 1 θ 01 θ q 02 λ π 1 λ f γ 2 θ 02 θ f 2 θ where f 1 θ and f 2 θ are constant of integration and need to be determined in doing so eq 10 is integrated in θ b 7 ψ 1 r θ φ 1 r r d θ q 01 4 π i 5 1 λ 1 λ i 6 q 02 λ 2 π 1 λ i 7 in accordance with b 2 the following relations hold for r r 01 r b 8 i 5 r ln p γ 1 θ 01 ln p γ 1 θ 01 r d θ 2 f γ 1 θ 01 θ i 6 r ln p η 1 θ 01 ln p η 1 θ 01 r d θ 2 f η 1 θ 01 θ i 7 r ln p γ 2 θ 02 ln p γ 2 θ 02 r d θ 2 f γ 2 θ 02 θ converting b 7 to b 9 ψ 1 r θ q 01 2 π f γ 1 θ 01 θ 1 λ 1 λ f η 1 θ 01 θ q 02 λ π 1 λ f γ 2 θ 02 θ f 3 r if r 01 r r then i 5 2f γ1 θ01 θ and b 10 ψ 1 r θ q 01 2 π f γ 1 θ 01 θ 1 λ 1 λ f η 1 θ 01 θ q 02 λ π 1 λ f γ 2 θ 02 θ f 4 r similarly f 3 r and f 4 r are constant of integration comparing b 5 with b 9 and b 6 with b 10 it can be concluded that f 3 r φ r 1 φ l 1 β ln r f 1 θ and f 4 r φ r 1 φ l 1 β ln r f 2 θ hence f 1 θ and f 2 θ must be constant which are set equal to zero without loss of generality it is obvious that ψ s1 f 3 f 4 and the rest of terms in ψ1 can be recast as 11 appendix c when combined with 9 the definite integrals in 14 may be evaluated in terms of stream function c 1 q r 0 r ψ w 1 r θ 0 d r q r 1 r ψ w 2 r θ 0 d r q r 2 0 r 01 ψ w 1 r θ 0 d r r 01 r ψ w 1 r θ 0 d r q r 1 r r 02 ψ w 2 r θ 0 d r r 02 ψ w 2 r θ 0 d r q r 2 evaluating the integrals yields c 2 q r 1 ψ w 1 r 01 0 ψ w 1 0 0 ψ w 1 r 0 ψ w 1 r 01 0 q r 2 ψ w 2 r 02 0 ψ w 2 r 0 ψ w 2 0 ψ w 2 r 02 0 the above result is also supported by the fact that the difference in stream function between two consecutive streamlines is equal to the discharge flowing between them similarly substituting 9 in 15 after simplification gives c 3 q l 1 ψ w 1 0 β ψ w 1 r 01 β ψ w 1 r 01 β ψ w 1 r β q l 2 ψ w 2 r β ψ w 2 r 02 β ψ w 2 r 02 β ψ w 2 β the notations r 0 i and r 0 i identify r approaching r 0i from the left side and from the right side respectively since the stream function possesses the property that ψ w1 r θ ψ w2 r θ and ψ w1 0 θ ψ w2 θ 0 then c 4 q r ψ w 1 r 01 0 ψ w 1 r 01 0 ψ w 2 r 02 0 ψ w 2 r 02 0 q l ψ w 1 r 01 β ψ w 1 r 01 β ψ w 2 r 02 β ψ w 2 r 02 β or in terms of f c 5 q r q 01 π f 1 θ 01 0 q 02 π f 1 θ 02 0 and c 6 q l q 01 π f 1 θ 01 β q 02 π f 1 θ 02 β by virtue of the trigonometric identities gradshteyn and ryzhik 1980 it is straightforward to verify that f 1 ω 0 2 ta n 1 sin ω ω 1 cos ω ω π 1 ω β and f 1 ω β 2 ta n 1 sin ω ω 1 cos ω ω ω ω eqs c 5 and c 6 thus simplify to eqs 16 and 17 respectively 
364,we study the spatial structure of soil moisture fields within savanna ecosystems whose persistence is vital because it is the driver of the entire ecological structure and function these include changes in the physical and biogeochemical conditions of the landscape affecting vegetation state soil composition water fluxes and solar radiation we focus on computations of the probabilistic structure of islands of soil moisture known empirically to be related to that of tree clusters defined as crossing properties of simulated soil moisture fields rainfall is modelled via cox isham space time fields endowed with characteristic scales results show that clusters of soil moisture islands are characterized by robust scale free structures in the region of a phase transition whose order parameter depends on mean soil moisture signatures of this fractal structure are well defined power laws of size distributions of soil moisture clusters their perimeters vs area relations variance vs area of the fields these characteristics allow for the estimation of the fractal dimension of the field and its hurst coefficient from the general covariance equation of a fractal field spatial simulations are possible because its mean and variance are known from the probabilistic structure of soil moisture at a point our results identify the statistics of hotspots of microbial activity deduced from proper moisture islands unattainable otherwise and thus may guide the design of field and remote observations the critical order parameter characterizing the phase transition establishes where the fractal structure of soil moisture fields exists as a function of the climatic drivers and the thresholds reflecting where vegetation survives in the field an example of application of the phase transition diagram presented here is carried out with reference to the nylsvley savanna in south africa keywords cluster size distributions spatial soil moisture patterns hurst parameter savanna ecosystems jitter noise space time precipitation forcings 1 introduction soil moisture is a key hydrologic variable at the center of the hydrologic cycle and the interaction between climate soil and vegetation its dynamics is of fundamental importance for the functioning of ecosystems and has been subject of innumerable research papers e g gardner 1960 cowan 1963 noy meir 1973 eagleson 1978a eagleson 1978b among others the stochastic character of soil moisture presents challenges for its general probabilistic description the interaction between the numerous factors and processes controlling the dynamics makes the use of pure simulation models not very illuminating for conclusions of general character while on the other hand the mathematical analysis of the dynamics needs simplifications which should be carefully analyzed the temporal stochastic dynamics of soil moisture at a point is well known e g rodriguez iturbe et al 1999 both in terms of the stationary pdf of soil moisture and of its crossing properties laio et al 2001 later extended to transient conditions the spatial structure of soil moisture has been a much more difficult challenge for researcher and practitioners previous attempts rodriguez iturbe et al 2006 yielded unrealistically high spatial correlation structures owing to their complete dependence on the correlation structure of rainfall patterns critically these analyses did not account for the local heterogeneities in soil conditions topography and vegetation that are important determinants of the spatial structure of soil moisture this paper incorporates such local effects via a jitter process rodriguez iturbe et al 2019 which is known to represent appropriately the effect of local heterogeneities chen et al 2017 soil moisture dynamics is stochastic in both time and space and in the most general case it is highly non stationary and hard to characterize over large scales rodriguez iturbe et al 1999 entekhabi and rodriguez iturbe 1994 robinson et al 2008 steele dunne et al 2010 sayde et al 2010 crow et al 2012 chen et al 2017 the non stationarity in time one can avoid by dealing with seasonally stationary climate conditions the non stationarity in space forces us to focus on large regions of relatively stationary conditions related to climate vegetation and geomorphology the most important case is savanna ecosystems with large extensions of relatively flat geomorphology and uniform soil conditions which make lateral flows in the subsurface of minor importance thus the soil moisture aggregated to depths of tens of centimeters at any point is dominated by the hydraulic conductivity at the point in question this allows us to use the soil moisture balance equation without consideration of lateral fluxes rodriguez iturbe and porporato 2004 the case of sloping terrains is still under analysis and will be presented somewhere else the probability density function of soil moisture at a point for the above conditions was first presented in rodriguez iturbe et al 1999 and later expanded in laio et al 2001 the stochastic driver is the rainfall at a point represented by a marked poisson process as the input into the soil moisture balance equation which incorporates the soil and vegetation conditions via the leakage and transpiration functions this pdf had been frequently corroborated in field and lab experiments salvucci 2001 moreover it has proven to be very useful in the analysis of vegetation water stress and the stochastic water balance via the analytically derived crossing properties of the soil moisture dynamics at a point rodriguez iturbe and porporato 2004 laio et al 2001 the space time stochastic dynamics of soil moisture the subject of this paper is much more complicated that the one at a single point the next sections will present the general analytic background following chen et al 2017 2 methods 2 1 general background in entekhabi and rodriguez iturbe 1994 the soil moisture balance equation was written by explicitly incorporating the spatial spread of soil water content through a diffusion term i e 1 n z r s u t t k u 2 s u t η s u t ξ u t where the diffusion term is assumed to encompass not only subsurface diffusion but also most importantly the spread of soil moisture that takes place in the surface of the ground due to topography and to the roughness of the terrain the term η s u t is the soil water accounting for transpiration leakage and runoff losses the space time rainfall input is portrayed by the random function ξ u t if the forcing rainfall field is stationary the resulting soil moisture field will evolve to reach a statistical equilibrium state which is also stationary in space and time chen et al 2017 the representation of the rainfall input in eq 1 may be done through different modeling schemes a description of these schemes may be found in chen et al 2017 for the sake of completeness appendix a provides analytic details of the cox and isham modeling scheme cox and isham 1988 that will be used in this paper this model basically represents the rainfall process in a statistically homogeneous region through a space time poisson process of random circular cells with rate λ in brief each cell has a random radius w a random duration d and a random average intensity during its duration x the above random variables are mutually independent and the triplets w d x are independent and identically distributed over the cells at any particular spatial location u and time t the rainfall process is the superposition of all cells overlapping the space time domain u t the random variables w and d are assumed to be exponentially distributed si the rainfall process described above was used as the input to eq 1 in entekhabi and rodriguez iturbe 1994 and chen et al 2017 to analytically study the space time structure of the soil moisture dynamics the focus of the analytical framework is well described in entekhabi and rodriguez iturbe 1994 i e focusing on the key question how is the input rainfall spectrum modified in its space time structure when it is filtered by land surface processes yielding the evolution of the soil moisture field in entekhabi and rodriguez iturbe 1994 the more complete rainfall model of waymire et al 1984 was used as rainfall input but in both studies it was observed that for realistic values of k the diffusion term makes very little difference in the temporal correlation of s u t and the spatial correlation remains always unrealistically high for distances far beyond what is observed in field data in order to adapt a model like eq 1 for the realistic representation of the soil moisture field at space and time scales commonly used in hydrological and ecological studies we need to incorporate the source of fluctuations at scales of interest via a jitter type of process appendix b thus following chen et al 2017 we rewrite eq 1 as 2 s u t t k u 2 s u t a s u t b y u t where all terms at right hand side rhs are normalized by n z r the loss term is approximated by the simple linear form a s with the parameter a depending on soil and vegetation characteristics rodriguez iturbe et al 1999 and the normalized rainfall input is b y u t where the parameter b represents the proportion of rainfall that becomes infiltration after being standardized eq 2 yields a dynamic fundamentally controlled by the rainfall process resulting in a very slow decay of the correlation structure of soil moisture when compared with those observed in the field chen et al 2017 entekhabi and rodriguez iturbe 1994 rodriguez iturbe et al 2006 the impact of local fluctuations in topography soil and vegetation conditions which are fundamentally random and of great importance are not incorporated in eq 2 chen et al 2017 suggest their incorporation through a jitter type of process z u t appendix b so that the soil moisture is now represented by the process s u t such that 3 s u t z u t s u t where z u t is a non negative stationary jitter process with mean μ z and covariance function γ z independent of s u t the covariance function γ z contains three parameters σ 2 α and β which determine the variance and the exponential correlation structure of the jitter appendix b the jitter should only increase the variability of the soil moisture in space and time without affecting its mean thus we impose μ z 1 a complete analytical study of the soil moisture dynamics s u t is presented in chen et al 2017 2 2 simulation of the instantaneous soil moisture field the probabilistic structure of the soil moisture field s u t is studied via simulation as in rodriguez iturbe et al 2019 with the parameter values given in table 1 and 200 runs for each set of parameters for each run the rainfall process y u t appendix a is generated in a 500 500 km 2 square field we then divide the 10 10 km 2 square at the center of the rainfall field into 1000 1000 square pixels u i i 1 2 10 6 of 10 10 m 2 each at the center of each pixel we calculate the soil moisture solely driven by rainfall s u t at fixed time t 0 s u i 0 through the balance equation with k 0 the latter assumption is justified because it has no impact on the spatial correlation structure of the soil moisture fields entekhabi and rodriguez iturbe 1994 the jitter process is also simulated at the center of each pixel at t 0 and the soil moisture s u t is obtained by multiplying s u t by z u t with k 0 we are able to calculate the instantaneous soil moisture process s by eq 2 i e s u 0 b 0 e a v y u 0 v d v b 0 e a v y u v d v by replacing with some large number t s u 0 can be approximated by s u 0 b t 0 e a v y u v d v here we use t 2 years and the rainfall occurrences are simulated in the time period t 0 then s u t is simulated at u u 1 u 2 u 10 6 the jitter process z is simulated as a shifted chi squared field on the 10 10 km 2 area for u u 1 u 2 u 10 6 and t 0 we first simulate a gaussian random field x u t with mean and covariance function respectively e x u t 0 and γ x l h e α l 2 β h 2 then z u t is calculated as z u t 1 σ z 2 x 2 u t 1 simple calculations can show that this transformation results in a shifted chi squared distribution of z with e z u t 1 and γ z l h σ z 2 e α l β h all simulations are done in r the r packages fields and randomfields are used to simulate the jitter process and the r package ebimage is used to identify the soil moisture islands parallel computing is recommended due to high computational complexity 3 results results are obtained by simulating the soil moisture process s u t in a 10 10 km 2 domain with grid points placed at every 10 m in both directions simulations have been carried out under three different climates average wet and dry the values of the model parameters for each climate are listed in table 1 rodriguez iturbe et al 2019 for each case we simulate s u t at the grid points and at an instantaneous time point t t 0 the simulation is repeated 200 times from where we estimate the characteristics of the soil moisture field fig 1 shows an example of the soil moisture field s u t resulting from the model previously described using parameters of rainfall soil vegetation and loses typical of savanna types of ecosystems e g table 1 of particular interest are the crossing features of the soil moisture field s u t the censoring of these fields at different thresholds yields islands i e clusters of soil moisture above the chosen threshold which are of key importance in the cycles of nutrients and organic matter porporato et al 2003a 2003b d odorico et al 2003 the intensity of microbial activity as function of soil moisture and its impact on nitrification denitrification and ammonification is well known porporato et al 2003a the covariance function of the space time soil moisture field was derived in chen et al 2017 see appendix b this covariance function is shown to adequately reproduce that of field measurements chen et al 2017 and its shape in space for realistic parameter values of a savanna ecosystem the spatial correlation at a given time shows a fast exponential decay for about 200 m followed by a long and slow decreasing tail that extends for kilometers chen et al 2017 this shape suggests an approximate fractal structure of the soil moisture field we now proceed to study different aspects of the soil moisture field s u t specifically its fractal structure we concentrate on the spatial 2d characteristics of the field acknowledging that its fractal signatures if present will only exist in a finite size limit and in a limited space of the parameters controlling the dynamics of the process as will be discussed later in a phase transition context we reinforce that the above characteristics of soil moisture islands section 2 suggest a fractal structure of the soil moisture field which is the core subject of this paper moreover they fit well the sizes and perimeters of tree clusters obtained in savannas when corrected for the impact of fires and herbivores as in the data shown in staver et al 2019 rodriguez iturbe et al 2019 thus the power laws of the size of soil moisture islands exist in a range of combinations of climate e g mean soil moisture and thresholds under consideration as pointed out in rodriguez iturbe et al 2019 this is expected since for very dry or very wet climates then the soil moisture fields will not exhibit fractal characteristics being uniformly close to one or zero later in this paper a parameter is found function of the average soil moisture and the threshold under consideration which reflects the characteristics of the vegetation controlling the level of soil moisture for its establishment whose value equal to zero determines the position of the phase transition where exists the fractal structure of the soil moisture field this is similar to the finding in the dynamics of the habitat destroyed in a variety of ecological systems where there exist a critical value of an order parameter at which the habitat destroyed experiences a sudden pronounced change reminiscent of a phase transition sole and bascompte 2006 3 1 variance vs area of the soil moisture field let s u s u 0 be the instantaneous soil moisture field for fields with spatial power law correlation ρ l such that ρ l falls of as l 2 μ 1 for large distances l their variance increases with area as a μ whittle 1962 thus for s a 1 a a s u d u we have v a r s a a μ 2 the analytically derived covariance function of s u shown in si appendix can be used to derive the variance of the instantaneous field integrated over an area a appendix c fig 2 shows one such example for small areas the variance decays in an exponential manner followed by a transition regime leading to a power law decay with slope 0 15 for areas larger than 100 100 m 2 the above implies the spatial correlation decays as 2 μ 2 0 3 for large distances 2 h 1 1 0 3 h 0 85 and fractal dimension d 3 h 2 15 where h is the hurst parameter korvin 1992 rodriguez iturbe and rinaldo 2001 the hursts exponent h has been popularized by benoit mandelbrot mandelbrot 1973 after its introduction to explain the boundless growth of the range of hydrologic signals with the size of the window of observations it is used characterize the possible long term memory of the autocorrelation of any stationary signal in space or in time and the rate of its decrease as the lag of any pair of values of the signal increases the series is termed persistent or anti persistent if h 0 5 0 5 it is the scaling coefficient of a correlation function for the range of a stationary signal assumed its physical meaning is that the signal is persistent if h 0 5 corresponding to a fat tail correlation it quantifies the relative tendency of a signal like a time series or a point measurement in space either to regress strongly to the mean or to cluster in a direction 3 2 islands of soil moisture above a threshold fig 3 shows the distribution of the areas of soil moisture above different thresholds for the instantaneous soil moisture field used in the calculation of fig 2 the cumulative probability distribution p a a is a well defined power law p a a a s with slope s close to 0 65 from d 2 s 1 korvin 1992 p 193 we estimate d 2 32 as the fractal dimension of the instantaneous soil moisture field and h 0 68 which are in the persistence range as those calculated previously based on the variance vs cell area scaling relation because of finite size effects the range covered by the above power law as well as its position but not its slope depends on the link between the size of the domain being analyzed and the threshold being applied for either very large thresholds or very small ones relative to the mean soil moisture it is impossible to obtain a good sample of statistic of the soil moisture areas except if one uses very large domains unsuitable for accurate numerical simulation the distribution of the sizes of islands with soil moisture above a threshold are specially important for the understanding of processes like nitrification denitrification ammonification and others which are highly non linear and controlled by the soil moisture thus they occur at larger rates in areas where the soil moisture is inside well defined ranges weil and brady 2017 as an example the percent of maximum microbial activity in the case of nitrification is in the soil moisture range between 40 and 70 the total area inside islands of soil moisture in any range can be estimated from the distributions obtained above which clarify the spatial structure of the field a simple overall spatial average of soil moisture over the whole field would not be very useful for estimating the dynamics of the processes this occurs because even if the case is that the soil moisture average is very low or very large it is likely to contain a variety of hotspots where there is intense activity for the process under study the probability distribution of soil moisture at a point is well established as function of climate soil and vegetation characteristics rodriguez iturbe et al 1999 but it sheds no light in regard to spatial structure of the soil moisture field 3 3 perimeter vs area scaling of the soil moisture clusters for a fractal island with perimeter p and area a the relationship p a d 2 holds where d is the fractal dimension of the perimeter this is known as the mandelbrot s area perimeter equation mandelbrot 1973 rodriguez iturbe and rinaldo 2001 fig 4 shows the plots of perimeter vs area for the soil moisture islands under three different climates in log log scale interestingly a least square fit yields a slope of d 2 0 73 for all of the three climates which implies d 1 46 then the fractal dimension of the field is estimated d d 1 2 46 and h 2 d 0 54 there is no data presently available that will allow a rigorous testing of the power law distribution of the size of soil moisture islands nor the perimeters of such islands a proxy type of data refers to clusters of trees in savannas whose areas and perimeters have been carefully measured it was found rodriguez iturbe et al 2019 staver et al 2019 that they match very well those obtained through the model used here it is remarkable that a consistent picture has been found therein by ecological consideration on the role of forest fires and the specific choice of threshold tree sizes staver et al 2019 to infer from the power law distribution of the areas of soil moisture islands the distribution of tree clusters found through an accurate combination of field measurements and remote sensing matches remarkably well its features 4 discussion for very dry humid climates the soil moisture field will be close to homogeneous with a very low high relative mean value no fractal characteristics of the kind studied above are then to be expected in terms of vegetation these climates would correspond to desert or forest ecosystems fig 5 shows some characteristics of the clusters of soil moisture for different climates as function of the ratio between threshold and soil moisture it is remarkable how similar the graphs are for different climates as well as their sharp maxima in the number of clusters this is suggestive of a relative sharp change in the structure of the field as function of an order parameter similar to what is observed in first order phase transitions and observed in several ecologic dynamics sole and bascompte 2006 to further explore the issue we study the changes of the habitat destroyed as function of the control parameter habitat destroyed is defined here as the percentage of the landscape estimated to be below the chosen threshold of relative soil moisture epitomized by δ the range between the threshold value where vegetation survives in the field and the mean soil moisture thus values of δ are closely related to the habitat destroyed and we choose it as possible order parameter its value with respect to soil moisture is equivalent to the difference between the threshold and the soil moisture i e δ mean soil moisture threshold mean soil moisture fig 6 shows the plot habitat destroyed vs δ for different climates where there exists a sharp change in the habitat destroyed it is precisely in the region around the order parameter equal to zero where the phase transition takes place and where fractal characteristics of the field are expected thus in fig 3 the values of δ are close to zero in all cases nevertheless this does not mean that the transition takes place following very small changes of soil moisture thus for the dry climate with mean soil moisture 0 1 if δ changes from 0 to 0 05 the threshold changes from 0 1 to 0 6 where there are practically no islands for the dry climate and the fraction of habitat destroyed becomes 1 the abruptness of the transition is less pronounced for the wet climate because in this case the variance of the distribution of soil moisture becomes larger rodriguez iturbe et al 1999 the change between the domain of one phase to the domain of the other phase occurs for all climates near a 62 of the habitat destroyed dry and semi dry savannas are quite sensitive to climate change which will vary their mean soil moisture the spatial structure of soil moisture above and below the corresponding thresholds may be drastically impacted and this will carry important changes in the vegetation patterns different thresholds may be of interest reflecting the soil moisture levels necessary for favorable but different vegetation conditions with a mean soil moisture and threshold of 0 2 and thus δ 0 the spatial structure of soil moisture will be one of a savanna with clusters of soil moisture of all sizes e g power law and near 62 of habitat destroyed if climate change drives the mean soil moisture to 0 10 the spatial structure above the threshold of 0 2 will now be controlled by δ 0 01 with near 2 of habitat destroyed at this particular threshold it is interesting to study the phase transition diagram of fig 6 referring to a real case the nylsvley savanna in south africa has been the subject of long term research throughout the years and constitutes an important benchmark in savanna studies practically all rainfall 98 of annual precipitation occurs from september to april with an average of 600 mm yr the rainfall process at a point is well described by a marked poisson process with arrival rate of 0 167 storms per day and storm depth exponentially distributed with mean of 1 5 cm rodriguez iturbe et al 1999 the soil is mainly sandy 85 90 with porosity of 0 42 and mean saturated hydraulic conductivity 109 8 cm day the dominant woody vegetation is burkea africana whose soil moisture transpiration characteristics can be estimated from the soil water retention curves for the site scholes 1997 the wilting point and the incipient water stress are s w 0 060 and s 0 11 rodriguez iturbe and porporato 2004 from these characteristics the soil moisture probability density function is obtained rodriguez iturbe and porporato 2004 with a mean of s 0 10 it is of interest to study the characteristics of the soil moisture field for a threshold equal to s in the case of the burkea africana in the nylsvley savanna the phase transition order parameter for this threshold is δ 0 001 which corresponds to close to 100 of habitat destroyed e g 100 of the field is below this threshold this is expected because a value of the soil moisture field mostly above s would correspond to a forest type of ecosystem for a threshold of s 0 09 the order parameter becomes δ 0 0009 corresponding to close to 0 of habitat destroyed e g close to 100 of the field is above the threshold and thus vegetation will potentially establish since the wilting point is considerably lower than the threshold although the above thresholds are close to each other the spatial structure of the field censored by the thresholds is very different and the dynamics embeds a sudden change through an intermediate threshold where the soil moisture field will display soil moisture islands of all sizes the results shown herein will be important to guide the planning of campaigns involving remote sensing and field measurements that will be crucial in characterizing the statistical structure of soil moisture fields across spatial scales which in turn controls a number of ecological and biogeochemical processes our results therefore address an issue of great interest to hydrologists ecologists and soil scientists credit authorship contribution statement ignacio rodriguez iturbe conceptualization methodology formal analysis writing review editing zijuan chen software data curation methodology formal analysis writing review editing software andrea rinaldo methodology formal analysis writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments iri and zc acknowledge funding from the texas engineering experimental station and the woodford cain chair i at texas a m university ar acknowledges funding from snf sinergia grant crsii5 186422 the authors wish to thank binayak mohanty amilcare porporato and salvatore calabrese for useful discussions two anonymous reviewers and salvatore manfreda provided useful criticism to a draft of the paper appendix a the cox isham rainfall model the rainfall process is used as input in the space time soil moisture balance equation rainfall occurrences are modelled by a sequence of circular rain cells that occur in a poisson process of rate λ in space and time each cell has a random radius w a random duration d and random average intensity x resulting in a total depth equal to x d the random variables described above are mutually independent and the triples w d x are independent and identically distributed over the cells in this model the cells overlap temporally as well as spatially so that at any particular spatial location u and time t the rainfall process is the superposition of all cells overlapping the space time u t if w and d are exponentially distributed with parameters ρ and η respectively ρ μ w 1 η μ d 1 then the mean and covariance function of the total intensity y u t are cox and isham 1988 rodriguez iturbe et al 1988 isham et al 2005 a 1 e y u t π λ e w 2 μ d μ x 2 π λ μ x η ρ 2 a 2 γ y ℓ h 2 π λ e x 2 η ρ 2 1 ρ ℓ 4 e η h ρ ℓ 2 where e means the expected value and γ y ℓ h denotes the covariance the covariance between the rain intensity at two locations at a distance ℓ and with temporal lag h 0 appendix b the jitter process and the soil moisture field as noted earlier a more direct and physically attractive avenue would be to incorporate directly the crucial impact of correlated local heterogeneities in soil texture microtopography and vegetation into the space time soil moisture balance equation which are known to drastically reduce the correlation embedded in the rainfall fields however direct simulation is unfeasible at present unless for very small control volumes like the ones one would obtain by tomography to do it via the jitter process is our proposal for a simple and effective way of achieving this description in a coherent and verifiable manner space time viability of soil moisture with jitter has already been discussed elsewhere chen et al 2017 technically jitter is the variation in latency i e the delay between when a signal is transmitted and when it is received the correlation structure resulting from the soil moisture balance equation driven only by a stochastic rainfall dynamics is fundamentally controlled by the rainfall process resulting in a very slow decay of the correlation structure of the soil moisture when compared to that observed in the field the impact of fluctuations in topography soil properties and vegetation characteristics is of fundamental importance in leading to a much faster decay of the soil moisture correlation structure these fluctuations are modeled following chen et al 2017 via a jitter process acting on the space time soil moisture resulting from the soil moisture balance equation driven solely by rainfall the jitter process is thus incorporated to account for the variations in local topography as well as in local soil and vegetation conditions with three controlling parameters estimated from real data it has been shown that the jitter process leads to a fast decay in the correlation of the soil moisture and thus the soil moisture field with jitter has successfully represented the correlation structure of soil moisture observed in the data chen et al 2017 the jitter process z u t is a non negative stationary process correlated in space and time with mean one chen et al 2017 the mean and covariance function of z u t are denoted by μ z and γ z ℓ h since the jitter process should only increase the variability of soil moisture without changing its expected value we impose e z u t 1 the covariance function of the jitter process is modelled as b 1 γ z ℓ h σ z 2 e α ℓ β h the parameters σ z 2 α and β are estimated from the data chen et al 2017 with the jitter process the modeled soil moisture field s u t has an analytically known correlation structure that can be expressed as chen et al 2017 b 2 γ s ℓ h γ s ℓ h μ s 2 σ z 2 e α ℓ β h σ z 2 e α ℓ β h γ s ℓ h where μ s and γ s ℓ h are the mean and covariance function of the soil moisture field solely driven by rainfall see chen et al 2017 for the explicit expressions appendix c variance calculations for the soil moisture field recall that we define c 1 s a 1 a a s u d u where a is a square with side length l since the covariance function γ s ℓ h is known we are able to calculate the variance of s a numerically via the relation c 2 v a r s a 1 l 4 a a c o v s u s v d u d v c 3 1 l 4 a a γ s u v 0 d u d v c 4 1 l 4 0 l 0 l l u l v γ s u 2 v 2 0 d u d v where c o v x y the covariance of the fields x y details are in chen et al 2017 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103826 appendix d supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
364,we study the spatial structure of soil moisture fields within savanna ecosystems whose persistence is vital because it is the driver of the entire ecological structure and function these include changes in the physical and biogeochemical conditions of the landscape affecting vegetation state soil composition water fluxes and solar radiation we focus on computations of the probabilistic structure of islands of soil moisture known empirically to be related to that of tree clusters defined as crossing properties of simulated soil moisture fields rainfall is modelled via cox isham space time fields endowed with characteristic scales results show that clusters of soil moisture islands are characterized by robust scale free structures in the region of a phase transition whose order parameter depends on mean soil moisture signatures of this fractal structure are well defined power laws of size distributions of soil moisture clusters their perimeters vs area relations variance vs area of the fields these characteristics allow for the estimation of the fractal dimension of the field and its hurst coefficient from the general covariance equation of a fractal field spatial simulations are possible because its mean and variance are known from the probabilistic structure of soil moisture at a point our results identify the statistics of hotspots of microbial activity deduced from proper moisture islands unattainable otherwise and thus may guide the design of field and remote observations the critical order parameter characterizing the phase transition establishes where the fractal structure of soil moisture fields exists as a function of the climatic drivers and the thresholds reflecting where vegetation survives in the field an example of application of the phase transition diagram presented here is carried out with reference to the nylsvley savanna in south africa keywords cluster size distributions spatial soil moisture patterns hurst parameter savanna ecosystems jitter noise space time precipitation forcings 1 introduction soil moisture is a key hydrologic variable at the center of the hydrologic cycle and the interaction between climate soil and vegetation its dynamics is of fundamental importance for the functioning of ecosystems and has been subject of innumerable research papers e g gardner 1960 cowan 1963 noy meir 1973 eagleson 1978a eagleson 1978b among others the stochastic character of soil moisture presents challenges for its general probabilistic description the interaction between the numerous factors and processes controlling the dynamics makes the use of pure simulation models not very illuminating for conclusions of general character while on the other hand the mathematical analysis of the dynamics needs simplifications which should be carefully analyzed the temporal stochastic dynamics of soil moisture at a point is well known e g rodriguez iturbe et al 1999 both in terms of the stationary pdf of soil moisture and of its crossing properties laio et al 2001 later extended to transient conditions the spatial structure of soil moisture has been a much more difficult challenge for researcher and practitioners previous attempts rodriguez iturbe et al 2006 yielded unrealistically high spatial correlation structures owing to their complete dependence on the correlation structure of rainfall patterns critically these analyses did not account for the local heterogeneities in soil conditions topography and vegetation that are important determinants of the spatial structure of soil moisture this paper incorporates such local effects via a jitter process rodriguez iturbe et al 2019 which is known to represent appropriately the effect of local heterogeneities chen et al 2017 soil moisture dynamics is stochastic in both time and space and in the most general case it is highly non stationary and hard to characterize over large scales rodriguez iturbe et al 1999 entekhabi and rodriguez iturbe 1994 robinson et al 2008 steele dunne et al 2010 sayde et al 2010 crow et al 2012 chen et al 2017 the non stationarity in time one can avoid by dealing with seasonally stationary climate conditions the non stationarity in space forces us to focus on large regions of relatively stationary conditions related to climate vegetation and geomorphology the most important case is savanna ecosystems with large extensions of relatively flat geomorphology and uniform soil conditions which make lateral flows in the subsurface of minor importance thus the soil moisture aggregated to depths of tens of centimeters at any point is dominated by the hydraulic conductivity at the point in question this allows us to use the soil moisture balance equation without consideration of lateral fluxes rodriguez iturbe and porporato 2004 the case of sloping terrains is still under analysis and will be presented somewhere else the probability density function of soil moisture at a point for the above conditions was first presented in rodriguez iturbe et al 1999 and later expanded in laio et al 2001 the stochastic driver is the rainfall at a point represented by a marked poisson process as the input into the soil moisture balance equation which incorporates the soil and vegetation conditions via the leakage and transpiration functions this pdf had been frequently corroborated in field and lab experiments salvucci 2001 moreover it has proven to be very useful in the analysis of vegetation water stress and the stochastic water balance via the analytically derived crossing properties of the soil moisture dynamics at a point rodriguez iturbe and porporato 2004 laio et al 2001 the space time stochastic dynamics of soil moisture the subject of this paper is much more complicated that the one at a single point the next sections will present the general analytic background following chen et al 2017 2 methods 2 1 general background in entekhabi and rodriguez iturbe 1994 the soil moisture balance equation was written by explicitly incorporating the spatial spread of soil water content through a diffusion term i e 1 n z r s u t t k u 2 s u t η s u t ξ u t where the diffusion term is assumed to encompass not only subsurface diffusion but also most importantly the spread of soil moisture that takes place in the surface of the ground due to topography and to the roughness of the terrain the term η s u t is the soil water accounting for transpiration leakage and runoff losses the space time rainfall input is portrayed by the random function ξ u t if the forcing rainfall field is stationary the resulting soil moisture field will evolve to reach a statistical equilibrium state which is also stationary in space and time chen et al 2017 the representation of the rainfall input in eq 1 may be done through different modeling schemes a description of these schemes may be found in chen et al 2017 for the sake of completeness appendix a provides analytic details of the cox and isham modeling scheme cox and isham 1988 that will be used in this paper this model basically represents the rainfall process in a statistically homogeneous region through a space time poisson process of random circular cells with rate λ in brief each cell has a random radius w a random duration d and a random average intensity during its duration x the above random variables are mutually independent and the triplets w d x are independent and identically distributed over the cells at any particular spatial location u and time t the rainfall process is the superposition of all cells overlapping the space time domain u t the random variables w and d are assumed to be exponentially distributed si the rainfall process described above was used as the input to eq 1 in entekhabi and rodriguez iturbe 1994 and chen et al 2017 to analytically study the space time structure of the soil moisture dynamics the focus of the analytical framework is well described in entekhabi and rodriguez iturbe 1994 i e focusing on the key question how is the input rainfall spectrum modified in its space time structure when it is filtered by land surface processes yielding the evolution of the soil moisture field in entekhabi and rodriguez iturbe 1994 the more complete rainfall model of waymire et al 1984 was used as rainfall input but in both studies it was observed that for realistic values of k the diffusion term makes very little difference in the temporal correlation of s u t and the spatial correlation remains always unrealistically high for distances far beyond what is observed in field data in order to adapt a model like eq 1 for the realistic representation of the soil moisture field at space and time scales commonly used in hydrological and ecological studies we need to incorporate the source of fluctuations at scales of interest via a jitter type of process appendix b thus following chen et al 2017 we rewrite eq 1 as 2 s u t t k u 2 s u t a s u t b y u t where all terms at right hand side rhs are normalized by n z r the loss term is approximated by the simple linear form a s with the parameter a depending on soil and vegetation characteristics rodriguez iturbe et al 1999 and the normalized rainfall input is b y u t where the parameter b represents the proportion of rainfall that becomes infiltration after being standardized eq 2 yields a dynamic fundamentally controlled by the rainfall process resulting in a very slow decay of the correlation structure of soil moisture when compared with those observed in the field chen et al 2017 entekhabi and rodriguez iturbe 1994 rodriguez iturbe et al 2006 the impact of local fluctuations in topography soil and vegetation conditions which are fundamentally random and of great importance are not incorporated in eq 2 chen et al 2017 suggest their incorporation through a jitter type of process z u t appendix b so that the soil moisture is now represented by the process s u t such that 3 s u t z u t s u t where z u t is a non negative stationary jitter process with mean μ z and covariance function γ z independent of s u t the covariance function γ z contains three parameters σ 2 α and β which determine the variance and the exponential correlation structure of the jitter appendix b the jitter should only increase the variability of the soil moisture in space and time without affecting its mean thus we impose μ z 1 a complete analytical study of the soil moisture dynamics s u t is presented in chen et al 2017 2 2 simulation of the instantaneous soil moisture field the probabilistic structure of the soil moisture field s u t is studied via simulation as in rodriguez iturbe et al 2019 with the parameter values given in table 1 and 200 runs for each set of parameters for each run the rainfall process y u t appendix a is generated in a 500 500 km 2 square field we then divide the 10 10 km 2 square at the center of the rainfall field into 1000 1000 square pixels u i i 1 2 10 6 of 10 10 m 2 each at the center of each pixel we calculate the soil moisture solely driven by rainfall s u t at fixed time t 0 s u i 0 through the balance equation with k 0 the latter assumption is justified because it has no impact on the spatial correlation structure of the soil moisture fields entekhabi and rodriguez iturbe 1994 the jitter process is also simulated at the center of each pixel at t 0 and the soil moisture s u t is obtained by multiplying s u t by z u t with k 0 we are able to calculate the instantaneous soil moisture process s by eq 2 i e s u 0 b 0 e a v y u 0 v d v b 0 e a v y u v d v by replacing with some large number t s u 0 can be approximated by s u 0 b t 0 e a v y u v d v here we use t 2 years and the rainfall occurrences are simulated in the time period t 0 then s u t is simulated at u u 1 u 2 u 10 6 the jitter process z is simulated as a shifted chi squared field on the 10 10 km 2 area for u u 1 u 2 u 10 6 and t 0 we first simulate a gaussian random field x u t with mean and covariance function respectively e x u t 0 and γ x l h e α l 2 β h 2 then z u t is calculated as z u t 1 σ z 2 x 2 u t 1 simple calculations can show that this transformation results in a shifted chi squared distribution of z with e z u t 1 and γ z l h σ z 2 e α l β h all simulations are done in r the r packages fields and randomfields are used to simulate the jitter process and the r package ebimage is used to identify the soil moisture islands parallel computing is recommended due to high computational complexity 3 results results are obtained by simulating the soil moisture process s u t in a 10 10 km 2 domain with grid points placed at every 10 m in both directions simulations have been carried out under three different climates average wet and dry the values of the model parameters for each climate are listed in table 1 rodriguez iturbe et al 2019 for each case we simulate s u t at the grid points and at an instantaneous time point t t 0 the simulation is repeated 200 times from where we estimate the characteristics of the soil moisture field fig 1 shows an example of the soil moisture field s u t resulting from the model previously described using parameters of rainfall soil vegetation and loses typical of savanna types of ecosystems e g table 1 of particular interest are the crossing features of the soil moisture field s u t the censoring of these fields at different thresholds yields islands i e clusters of soil moisture above the chosen threshold which are of key importance in the cycles of nutrients and organic matter porporato et al 2003a 2003b d odorico et al 2003 the intensity of microbial activity as function of soil moisture and its impact on nitrification denitrification and ammonification is well known porporato et al 2003a the covariance function of the space time soil moisture field was derived in chen et al 2017 see appendix b this covariance function is shown to adequately reproduce that of field measurements chen et al 2017 and its shape in space for realistic parameter values of a savanna ecosystem the spatial correlation at a given time shows a fast exponential decay for about 200 m followed by a long and slow decreasing tail that extends for kilometers chen et al 2017 this shape suggests an approximate fractal structure of the soil moisture field we now proceed to study different aspects of the soil moisture field s u t specifically its fractal structure we concentrate on the spatial 2d characteristics of the field acknowledging that its fractal signatures if present will only exist in a finite size limit and in a limited space of the parameters controlling the dynamics of the process as will be discussed later in a phase transition context we reinforce that the above characteristics of soil moisture islands section 2 suggest a fractal structure of the soil moisture field which is the core subject of this paper moreover they fit well the sizes and perimeters of tree clusters obtained in savannas when corrected for the impact of fires and herbivores as in the data shown in staver et al 2019 rodriguez iturbe et al 2019 thus the power laws of the size of soil moisture islands exist in a range of combinations of climate e g mean soil moisture and thresholds under consideration as pointed out in rodriguez iturbe et al 2019 this is expected since for very dry or very wet climates then the soil moisture fields will not exhibit fractal characteristics being uniformly close to one or zero later in this paper a parameter is found function of the average soil moisture and the threshold under consideration which reflects the characteristics of the vegetation controlling the level of soil moisture for its establishment whose value equal to zero determines the position of the phase transition where exists the fractal structure of the soil moisture field this is similar to the finding in the dynamics of the habitat destroyed in a variety of ecological systems where there exist a critical value of an order parameter at which the habitat destroyed experiences a sudden pronounced change reminiscent of a phase transition sole and bascompte 2006 3 1 variance vs area of the soil moisture field let s u s u 0 be the instantaneous soil moisture field for fields with spatial power law correlation ρ l such that ρ l falls of as l 2 μ 1 for large distances l their variance increases with area as a μ whittle 1962 thus for s a 1 a a s u d u we have v a r s a a μ 2 the analytically derived covariance function of s u shown in si appendix can be used to derive the variance of the instantaneous field integrated over an area a appendix c fig 2 shows one such example for small areas the variance decays in an exponential manner followed by a transition regime leading to a power law decay with slope 0 15 for areas larger than 100 100 m 2 the above implies the spatial correlation decays as 2 μ 2 0 3 for large distances 2 h 1 1 0 3 h 0 85 and fractal dimension d 3 h 2 15 where h is the hurst parameter korvin 1992 rodriguez iturbe and rinaldo 2001 the hursts exponent h has been popularized by benoit mandelbrot mandelbrot 1973 after its introduction to explain the boundless growth of the range of hydrologic signals with the size of the window of observations it is used characterize the possible long term memory of the autocorrelation of any stationary signal in space or in time and the rate of its decrease as the lag of any pair of values of the signal increases the series is termed persistent or anti persistent if h 0 5 0 5 it is the scaling coefficient of a correlation function for the range of a stationary signal assumed its physical meaning is that the signal is persistent if h 0 5 corresponding to a fat tail correlation it quantifies the relative tendency of a signal like a time series or a point measurement in space either to regress strongly to the mean or to cluster in a direction 3 2 islands of soil moisture above a threshold fig 3 shows the distribution of the areas of soil moisture above different thresholds for the instantaneous soil moisture field used in the calculation of fig 2 the cumulative probability distribution p a a is a well defined power law p a a a s with slope s close to 0 65 from d 2 s 1 korvin 1992 p 193 we estimate d 2 32 as the fractal dimension of the instantaneous soil moisture field and h 0 68 which are in the persistence range as those calculated previously based on the variance vs cell area scaling relation because of finite size effects the range covered by the above power law as well as its position but not its slope depends on the link between the size of the domain being analyzed and the threshold being applied for either very large thresholds or very small ones relative to the mean soil moisture it is impossible to obtain a good sample of statistic of the soil moisture areas except if one uses very large domains unsuitable for accurate numerical simulation the distribution of the sizes of islands with soil moisture above a threshold are specially important for the understanding of processes like nitrification denitrification ammonification and others which are highly non linear and controlled by the soil moisture thus they occur at larger rates in areas where the soil moisture is inside well defined ranges weil and brady 2017 as an example the percent of maximum microbial activity in the case of nitrification is in the soil moisture range between 40 and 70 the total area inside islands of soil moisture in any range can be estimated from the distributions obtained above which clarify the spatial structure of the field a simple overall spatial average of soil moisture over the whole field would not be very useful for estimating the dynamics of the processes this occurs because even if the case is that the soil moisture average is very low or very large it is likely to contain a variety of hotspots where there is intense activity for the process under study the probability distribution of soil moisture at a point is well established as function of climate soil and vegetation characteristics rodriguez iturbe et al 1999 but it sheds no light in regard to spatial structure of the soil moisture field 3 3 perimeter vs area scaling of the soil moisture clusters for a fractal island with perimeter p and area a the relationship p a d 2 holds where d is the fractal dimension of the perimeter this is known as the mandelbrot s area perimeter equation mandelbrot 1973 rodriguez iturbe and rinaldo 2001 fig 4 shows the plots of perimeter vs area for the soil moisture islands under three different climates in log log scale interestingly a least square fit yields a slope of d 2 0 73 for all of the three climates which implies d 1 46 then the fractal dimension of the field is estimated d d 1 2 46 and h 2 d 0 54 there is no data presently available that will allow a rigorous testing of the power law distribution of the size of soil moisture islands nor the perimeters of such islands a proxy type of data refers to clusters of trees in savannas whose areas and perimeters have been carefully measured it was found rodriguez iturbe et al 2019 staver et al 2019 that they match very well those obtained through the model used here it is remarkable that a consistent picture has been found therein by ecological consideration on the role of forest fires and the specific choice of threshold tree sizes staver et al 2019 to infer from the power law distribution of the areas of soil moisture islands the distribution of tree clusters found through an accurate combination of field measurements and remote sensing matches remarkably well its features 4 discussion for very dry humid climates the soil moisture field will be close to homogeneous with a very low high relative mean value no fractal characteristics of the kind studied above are then to be expected in terms of vegetation these climates would correspond to desert or forest ecosystems fig 5 shows some characteristics of the clusters of soil moisture for different climates as function of the ratio between threshold and soil moisture it is remarkable how similar the graphs are for different climates as well as their sharp maxima in the number of clusters this is suggestive of a relative sharp change in the structure of the field as function of an order parameter similar to what is observed in first order phase transitions and observed in several ecologic dynamics sole and bascompte 2006 to further explore the issue we study the changes of the habitat destroyed as function of the control parameter habitat destroyed is defined here as the percentage of the landscape estimated to be below the chosen threshold of relative soil moisture epitomized by δ the range between the threshold value where vegetation survives in the field and the mean soil moisture thus values of δ are closely related to the habitat destroyed and we choose it as possible order parameter its value with respect to soil moisture is equivalent to the difference between the threshold and the soil moisture i e δ mean soil moisture threshold mean soil moisture fig 6 shows the plot habitat destroyed vs δ for different climates where there exists a sharp change in the habitat destroyed it is precisely in the region around the order parameter equal to zero where the phase transition takes place and where fractal characteristics of the field are expected thus in fig 3 the values of δ are close to zero in all cases nevertheless this does not mean that the transition takes place following very small changes of soil moisture thus for the dry climate with mean soil moisture 0 1 if δ changes from 0 to 0 05 the threshold changes from 0 1 to 0 6 where there are practically no islands for the dry climate and the fraction of habitat destroyed becomes 1 the abruptness of the transition is less pronounced for the wet climate because in this case the variance of the distribution of soil moisture becomes larger rodriguez iturbe et al 1999 the change between the domain of one phase to the domain of the other phase occurs for all climates near a 62 of the habitat destroyed dry and semi dry savannas are quite sensitive to climate change which will vary their mean soil moisture the spatial structure of soil moisture above and below the corresponding thresholds may be drastically impacted and this will carry important changes in the vegetation patterns different thresholds may be of interest reflecting the soil moisture levels necessary for favorable but different vegetation conditions with a mean soil moisture and threshold of 0 2 and thus δ 0 the spatial structure of soil moisture will be one of a savanna with clusters of soil moisture of all sizes e g power law and near 62 of habitat destroyed if climate change drives the mean soil moisture to 0 10 the spatial structure above the threshold of 0 2 will now be controlled by δ 0 01 with near 2 of habitat destroyed at this particular threshold it is interesting to study the phase transition diagram of fig 6 referring to a real case the nylsvley savanna in south africa has been the subject of long term research throughout the years and constitutes an important benchmark in savanna studies practically all rainfall 98 of annual precipitation occurs from september to april with an average of 600 mm yr the rainfall process at a point is well described by a marked poisson process with arrival rate of 0 167 storms per day and storm depth exponentially distributed with mean of 1 5 cm rodriguez iturbe et al 1999 the soil is mainly sandy 85 90 with porosity of 0 42 and mean saturated hydraulic conductivity 109 8 cm day the dominant woody vegetation is burkea africana whose soil moisture transpiration characteristics can be estimated from the soil water retention curves for the site scholes 1997 the wilting point and the incipient water stress are s w 0 060 and s 0 11 rodriguez iturbe and porporato 2004 from these characteristics the soil moisture probability density function is obtained rodriguez iturbe and porporato 2004 with a mean of s 0 10 it is of interest to study the characteristics of the soil moisture field for a threshold equal to s in the case of the burkea africana in the nylsvley savanna the phase transition order parameter for this threshold is δ 0 001 which corresponds to close to 100 of habitat destroyed e g 100 of the field is below this threshold this is expected because a value of the soil moisture field mostly above s would correspond to a forest type of ecosystem for a threshold of s 0 09 the order parameter becomes δ 0 0009 corresponding to close to 0 of habitat destroyed e g close to 100 of the field is above the threshold and thus vegetation will potentially establish since the wilting point is considerably lower than the threshold although the above thresholds are close to each other the spatial structure of the field censored by the thresholds is very different and the dynamics embeds a sudden change through an intermediate threshold where the soil moisture field will display soil moisture islands of all sizes the results shown herein will be important to guide the planning of campaigns involving remote sensing and field measurements that will be crucial in characterizing the statistical structure of soil moisture fields across spatial scales which in turn controls a number of ecological and biogeochemical processes our results therefore address an issue of great interest to hydrologists ecologists and soil scientists credit authorship contribution statement ignacio rodriguez iturbe conceptualization methodology formal analysis writing review editing zijuan chen software data curation methodology formal analysis writing review editing software andrea rinaldo methodology formal analysis writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments iri and zc acknowledge funding from the texas engineering experimental station and the woodford cain chair i at texas a m university ar acknowledges funding from snf sinergia grant crsii5 186422 the authors wish to thank binayak mohanty amilcare porporato and salvatore calabrese for useful discussions two anonymous reviewers and salvatore manfreda provided useful criticism to a draft of the paper appendix a the cox isham rainfall model the rainfall process is used as input in the space time soil moisture balance equation rainfall occurrences are modelled by a sequence of circular rain cells that occur in a poisson process of rate λ in space and time each cell has a random radius w a random duration d and random average intensity x resulting in a total depth equal to x d the random variables described above are mutually independent and the triples w d x are independent and identically distributed over the cells in this model the cells overlap temporally as well as spatially so that at any particular spatial location u and time t the rainfall process is the superposition of all cells overlapping the space time u t if w and d are exponentially distributed with parameters ρ and η respectively ρ μ w 1 η μ d 1 then the mean and covariance function of the total intensity y u t are cox and isham 1988 rodriguez iturbe et al 1988 isham et al 2005 a 1 e y u t π λ e w 2 μ d μ x 2 π λ μ x η ρ 2 a 2 γ y ℓ h 2 π λ e x 2 η ρ 2 1 ρ ℓ 4 e η h ρ ℓ 2 where e means the expected value and γ y ℓ h denotes the covariance the covariance between the rain intensity at two locations at a distance ℓ and with temporal lag h 0 appendix b the jitter process and the soil moisture field as noted earlier a more direct and physically attractive avenue would be to incorporate directly the crucial impact of correlated local heterogeneities in soil texture microtopography and vegetation into the space time soil moisture balance equation which are known to drastically reduce the correlation embedded in the rainfall fields however direct simulation is unfeasible at present unless for very small control volumes like the ones one would obtain by tomography to do it via the jitter process is our proposal for a simple and effective way of achieving this description in a coherent and verifiable manner space time viability of soil moisture with jitter has already been discussed elsewhere chen et al 2017 technically jitter is the variation in latency i e the delay between when a signal is transmitted and when it is received the correlation structure resulting from the soil moisture balance equation driven only by a stochastic rainfall dynamics is fundamentally controlled by the rainfall process resulting in a very slow decay of the correlation structure of the soil moisture when compared to that observed in the field the impact of fluctuations in topography soil properties and vegetation characteristics is of fundamental importance in leading to a much faster decay of the soil moisture correlation structure these fluctuations are modeled following chen et al 2017 via a jitter process acting on the space time soil moisture resulting from the soil moisture balance equation driven solely by rainfall the jitter process is thus incorporated to account for the variations in local topography as well as in local soil and vegetation conditions with three controlling parameters estimated from real data it has been shown that the jitter process leads to a fast decay in the correlation of the soil moisture and thus the soil moisture field with jitter has successfully represented the correlation structure of soil moisture observed in the data chen et al 2017 the jitter process z u t is a non negative stationary process correlated in space and time with mean one chen et al 2017 the mean and covariance function of z u t are denoted by μ z and γ z ℓ h since the jitter process should only increase the variability of soil moisture without changing its expected value we impose e z u t 1 the covariance function of the jitter process is modelled as b 1 γ z ℓ h σ z 2 e α ℓ β h the parameters σ z 2 α and β are estimated from the data chen et al 2017 with the jitter process the modeled soil moisture field s u t has an analytically known correlation structure that can be expressed as chen et al 2017 b 2 γ s ℓ h γ s ℓ h μ s 2 σ z 2 e α ℓ β h σ z 2 e α ℓ β h γ s ℓ h where μ s and γ s ℓ h are the mean and covariance function of the soil moisture field solely driven by rainfall see chen et al 2017 for the explicit expressions appendix c variance calculations for the soil moisture field recall that we define c 1 s a 1 a a s u d u where a is a square with side length l since the covariance function γ s ℓ h is known we are able to calculate the variance of s a numerically via the relation c 2 v a r s a 1 l 4 a a c o v s u s v d u d v c 3 1 l 4 a a γ s u v 0 d u d v c 4 1 l 4 0 l 0 l l u l v γ s u 2 v 2 0 d u d v where c o v x y the covariance of the fields x y details are in chen et al 2017 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103826 appendix d supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
