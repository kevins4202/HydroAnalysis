index,text
330,advances in instrumentation have made it possible to obtain high resolution images of heterogeneous porous media such advances and the rapid increase in computational power mean that direct numerical simulation of multiphase flow in two and three dimensional 3d images of porous media is feasible and therefore models of pore space that represent simplification and approximation of the actual morphology are dispensable the bottleneck for image based simulation is its long computation time we propose an approach for speeding up simulation of multiphase flow in 3d images of porous media that utilizes curvelet transformations cts the cts are designed for denoising of images that contain complex curved surfaces such as those of heterogeneous porous media this is possible because the morphology of most porous media contain extended correlations implying that their images carry redundant information that can be eliminated by a suitable ct as a result simulation of multiphase flow in the coarser images are far less computationally intensive the new approach is used to simulate two phase flow of co 2 and brine in a 3d image of berea sandstone we demonstrate that the results with the ct processed image are as accurate as those with the original one while computations are significantly faster by a speedup factor between one and more than two orders of magnitude keywords two phase fluid flow porous media curvelet transformation 1 introduction although the physics of two phase flow in heterogeneous porous media is reasonably well understood helmig 1997 sahimi 2011 blunt 2017 its efficient simulation is still the subject of active research in particular due to societal interest in geological sequestration of co 2 there is increasing incentive for studying two phase flow of co 2 and brine in such porous media as depleted oil or gas reservoirs friedlingstein and solomon 2005 metz et al 2005 nordbotten and celia 2011 such simulations are either based on the classical continuum formulation of two phase flows bear 1972 which necessitates supplying the simulator with various properties of the pore space such as its porosity and permeability or entails as the first step developing or assuming a model of the pore space that represents faithfully its morphology and the complexities that are associated with it up until relatively recently the most realistic model of a porous medium at laboratory scale was the pore network model pnm in which the pore space extracted from an image of the medium was represented by a network of interconnected pore throats and pore bodies the effective sizes of which were selected according to some representative statistical distributions that can in principle be measured or obtained from the image based on representation of a pore space by the pnms various approaches were developed in order to simulate two phase flows in porous media they included a variety of percolation models ranging from random see for example sahimi et al 1986 to correlated see for example kantzas and chatzis 1988 and invasion percolation for a simple introduction to invasion percolation see ebrahimi 2010 site bond invasion percolation sahimi et al 1998 that considers the effect of both pore bodies and pore throats on the invasion process detailed pore to pore simulations piri and blunt 2005 valvatne and blunt 2004 and a combination of effective medium approximation and random percolation ghanbarian et al 2016 these models have been described and discussed comprehensively by sahimi 2011 blunt 2017 and hunt and sahimi 2017 and therefore need not be described here there have been tremendous advances in instrumentation which have made it possible to obtain high resolution two or three dimensional 3d images of porous media at laboratory scale such images have been becoming important tools for characterization of porous media as they provide depending on their resolution detailed information about the morphology of the pore space the imaging techniques include focused ion beam scanning electron microscopes lemmens et al 2011 magnetic resonance imaging sheppard et al 2003 and x ray computed tomography kantzas et al 1992 arns et al 2001 2002 porter et al 2010 iglauer et al 2010 berg et al 2013 wildenschild et al 2014 the images have been used to display fluid distributions in 3d porous media sheppard et al 2003 even under reservoir conditions andrew et al 2015 with advances in computational power high resolution images of porous media offer the opportunity for precise simulation of fluid flow and transport in porous media if the physical size of the images is larger than the representative elementary volume rev the minimum volume of a porous medium for its properties to be independent of the dimensions they may be used directly in numerical simulation of fluid flow and transport in porous media arns et al 2001 2002 piller et al 2009 tahmasebi et al 2017 as well as adsorption and deformation bakhshian et al 2018 despite the great increase in computational power numerical simulation of fluid flow and transport in the images of porous media is still computationally very expensive natural and many synthetic porous media have pores with irregular shapes with their surface being rough and often a self affine fractal the pores connectivity is also a spatially distributed property giving rise to highly tortuous flow and transport paths thus one needs a high resolution computational grid that represents such complexities accurately simulation of flow in porous media with the lattice boltzmann lb algorithm huang et al 2015 is still slower than direct numerical simulation based on the stokes equation although progress has recently been made in speeding it up an et al 2020 developed a method that integrates the gpu accelerated volumetric lb method vlbm with an upscaling scheme to solve the pore scale two phase flow they utilized the lb simulator to solve both the level set equation for image segmentation and the governing equations for multiphase flow dynamics the method accelerates the standard lb simulations significantly aside from the lb based methods for image based direct simulation of multiphase flow and transport in porous media based on the navier stokes equation to become the standard approach the speed of the calculations must increase very significantly without losing accuracy see for example etemad et al 2017 for a significant effort in this direction in this paper we describe an approach for image based simulation of multiphase flow in 3d porous media the main idea is to focus on the image process and denoise it and remove the complexities that do not contribute significantly to flow and transport in the pore space and then carry out numerical simulation of multiphase flow in the coarse image the image is denoised by curvelet transformations cts a powerful method developed specifically for image processing as we show in this paper the method increases the speed of computations very significantly between one and more than two orders of magnitude while preserving the accuracy of the solution the rest of this paper is structured as follows in section 2 we describe the essentials of the cts section 3 explains the method for denoising the images the two phase flow problem that we study is described in section 4 followed by the presentation and discussion of the results in section 5 the efficiency of the computation is discussed in section 6 while the paper is summarized in the last section 2 curvelet transformations denoising of an image to obtain its coarse but accurate representation has been an active research field for decades daubechies 1988 1992 and mallat 1989b a advanced the field significantly by introducing multiresolution wavelet transforms wts which decompose an image into a series of high and low pass filter bands and extract the details of its structure in the horizontal vertical and diagonal directions heterogeneous porous media particularly 3d ones are however not only highly noisy but also contain curved pore surfaces thus the three directions that the wts employ are not enough for extracting adequate amount of information from 3d images note however that the wts have been used very fruitfully in upscaling of geological models of heterogeneous porous media mehrabi and sahimi 1997 ebrahimi and sahimi 2002 2004 pancaldi et al 2007 rasaei and sahimi 2008 2009 babaei and king 2011 rezapour et al 2019 in geophysics for reviews see kumar and foufoula georgiou 1997 grinsted et al 2004 and in many other applications the shortcomings of the wts motivated the development of the cts which were introduced by donoho 1999 and candés et al 2005 and are highly effective in identifying an image s important features along curves an aspect that is highly important to the processing of images of porous media the cts are multiscale transforms that are capable of producing optimal sparse representation of an image by precise representation of the edges along curves with very high directional sensitivity they have already been used in geoscience olhede and walden 2004 herrmann et al 2007 neelamani et al 2008 dashtian and sahimi 2014 for denoising of geophysical data such as seismic records other applications were described by ma and plonka 2009 we first describe cts for 2d images after which its extension to 3d will be discussed image processing by the cts is done in the frequency space similar to the wts one can construct many types of curvelet functions to do so two windows are considered one w r is a radial window with r being the polar coordinate while the second window v θ is intended for the angular direction both are smooth nonnegative and real functions that satisfy 1 j w 2 2 j r 1 r 3 4 3 2 2 j v 2 θ j 1 t 1 2 1 2 given w r and v θ one constructs a third window u j in the fourier space defined by 3 u j r θ 2 3 j 4 w 2 j r v 2 j 2 θ 2 π with indicating the number s integer part by definition the domain in which u j is nonzero is a polar wedge set by w r and v θ by varying j one utilizes u j with scale dependent window widths in both directions to ensure that u j takes on real values its symmetric version namely u j r θ u j r θ π is used the mother curvelet φ i x referred to as such because all the curvelets at scale 2 j are obtained by rotation and translation of φ i x is then defined by its fourier transform 4 φ i ω u j ω where u j ω 1 ω 2 u ω scale dependent rotation angles θ l 2 π 2 j 2 with l 0 1 and θ l 0 and a sequence of the translation parameters with k k 1 k 2 z 2 are then introduced then the curvelets as a function of x x 1 x 2 at scale 2 j orientation θ l and position x k j l r θ l 1 k 1 2 j k 2 2 j 2 are constructed by donoho 1999 candés et al 2005 5 φ j l k x φ j r θ l x x k j l where r θ l represents a rotation by θ l radians given by 6 r θ l cos θ l sin θ l sin θ l cos θ l with r θ l 1 r θ l t r θ l here t denotes the transpose operation 3 denoising of images of porous media having set up the cts we now describe their use for processing of 2d and 3d images of porous media 3 1 two dimensional images suppose that a 2d image of a porous medium a n n array of pixels is represented by f x its ct usually referred to as the curvelet coefficients ccs c j l k which are completely analogous to wavelet detail coefficients are defined by 7 c j l k f φ j l k f x φ j l k x d x where the overline denotes a complex conjugate because the cts are constructed and used in the frequency domain by using the plancherel s theorem we rewrite the integral in eq 7 in the frequency domain 8 c j l k 1 2 π 2 f ω φ j l k ω d ω 1 2 π 2 f ω u j r θ l ω exp i x k j l ω d ω moreover a window w 0 is introduced by 9 w 0 r 2 1 j 0 w 2 j r 2 since the goal is to obtain a coarser representation of the image we also define in analogy with the wts for which coarse scale wavelet detail coefficients are also defined for k 1 k 2 z the coarse scale curvelets by 10 φ j 0 k x φ j 0 x 2 j 0 k 11 φ j 0 ω 2 j 0 w 0 2 j 0 ω the difference with the wts is that the coarse scale curvelets are nondirectional whereas those defined for the wts are in the aforementioned three directions a complete ct consists of the fine scale directional curvelets φ j l k j j 0 l k and the coarse scale isotropic φ j 0 k k which is called the father wavelet the idea for processing images of porous media by the cts or by the wts for that matter and denoising them exploits the physical fact that the morphology of such media contains extended spatial correlations between the pores and grains see for example knackstedt et al 2001 thus the same correlations exist between the pixels voxels in 3d in the images of porous media the existence of the correlations implies that images contain redundant information and that their removal will not damage the essential information that the images carry once the redundant information is removed simulation of flow and transport in the resulting coarser images is accelerated very significantly as we demonstrate shortly the denoising exploits the fact that starck et al 2002 the ccs represent a measure of the local complexity of an image which in a porous medium is due to the pores rough surface which is typically a self affine fractal see sahimi 2011 for a comprehensive discussion and its correlation with the surrounding pore space in other words the ccs represent a measure of roughness or curviness of the pore grain interface and due to the extended correlations the pores next to the interface are also affected therefore the larger the ccs the more significant is the curviness and hence the roughness clearly if the roughness is severe its contribution to image based simulation of multiphase flow should be significant thus if we keep only the most curved portions of the pore space i e if we denoise the image a coarser computational grid should suffice for the simulations there are several ways of denoising or compressing an image starck et al 2002 but we choose to take the simplest approach that as we demonstrate shortly suffices for our purpose the approach which is referred to as thresholding in image processing consists of the following steps i curvelet transform the image and compute the ccs c j l k ii normalize the ccs by their largest value iii introduce a threshold 0 ε 1 such that if c j l k ε it is set to zero in this way the algorithm generates a sparser representation of the image in the curvelet space as many of the ccs of the original image are set to zero while it still contains all the essential information the numerical value of ε depends on the computation time and resources that one can afford and has access to 3 2 three dimensional images the cts were originally developed for 2d images their extension to 3d initially encountered some difficulties associated with curved surfaces but curvelets for some 3d systems have also been developed ying et al 2005 woiselle et al 2010 but for reasons that will be explained in section 6 in the present paper we use an alternative approach namely we divide a n n n 3d image into n 2d images of size n n apply the methodology described in 3 1 to each 2d image and then stack together the curvelet transformed 2d denoised images to reconstruct a 3d image the orientations of the 2d images relative to the original 3d image does not play a significant role unless the pore space is strongly anisotropic if strong anisotropy is present one may use a ct based anisotropic feature extraction method shinde et al 2017 in the present work we take the 2d images in the planes perpendicular to the direction of macroscopic flow with the development of fast 3d cts the issue of the orientation of the 2d slices relative to the 3d images becomes irrelevant care must however be taken to ensure that after curvelet transforming and thresholding the transition from one processed 2d slice to the next is seamless and does not generate any artifacts to do this we used an open access image processing package that does the segmentation and the stacking process the software is called fiji schindelin et al 2012 which generates directly 3d images from a series of 2d images and is also designed to automatically address issues that may arise from image thresholding which is why the software is a very power tool for more details see https imagej net fiji 3 3 simulations in the curvelet or real space once the coarser image is developed one has two options i one computes the inverse ct of the thresholded image and carries out numerical simulation of two phase flow in it or ii one curvelet transforms the governing flow equations solves them in the ct space and then computes the inverse ct of the numerical results the results presented in this paper were obtained with option i it can be shown aljasmi and sahimi 2020 that if procedure ii is followed the speed up factor for computations will be a factor of four or better even if the images in the curvelet space is not denoised clearly then if the image is denoised and the computations are still carried out in the ct of the denoised image the speed up factor will be quite large the reason that one has better efficiency even without thresholding is that in the ct space a coarser computational grid suffices because many of the ccs of the image are either very small and thus do not make significant contributions or that due to the correlations they are close to those of their neighbors indicating a relatively smooth local environment hence allowing use of larger grid blocks 4 details of the simulations we now describe the porous medium whose image we have used in the computations and explain the computational procedure 4 1 the porous medium we utilized a 3d image of berea sandstone which is considered a benchmark for testing various computational approaches to simulating multiphase flow in porous media and has been used extensively in the past valvatne and blunt 2004 ramstad et al 2012 raeini et al 2014 the digital and physical sizes of the sample are respectively 200 3 voxels and 2 14 3 mm 3 the porosity and absolute permeability of the sample are respectively 0 196 and 1368 md fig 1 presents the image of the sandstone and its 3d coarse version the size of the image is larger than its corresponding rev 4 2 the governing equations and the numerical simulation procedure we first carried out simulation of single phase flow in the image of the berea sandstone both in the original one and in the processed images in order to not only estimate the absolute permeability of the pore space but also determine the size of the computational grid that yield reliable estimate see below we then simulated two phase flow of co 2 and brine in the same images simulating two phase flow in porous media requires upscaling the microscopic dynamic and capillary pressures to the darcy scale while there are several methods for the upscaling we used the velocity weighted averages of both the viscous forces and the pressure gradient that have been demonstrated raeini et al 2014 to yield results that are in agreement with experimental data as for macroscopic pressure drop δ p α in fluid phase α of the two phase system we utilized a slightly modified versions of the same equations which is given by 12 δ p α 1 q α v μ v d v α α 1 2 where the density ρ and viscosity μ are given by 13 μ ϕ μ 1 1 ϕ μ 2 14 ρ ϕ ρ 1 1 ϕ ρ 2 here q α is the flow rate of phase α v is the velocity field v α is the portion of pore volume filled with phase α μ 1 and μ 2 are viscosities of the two fluids and ϕ is the volume fraction of fluid 1 brine in each grid block since the computational grid is eulerian one needs a method for including the interfacial tension in grid so as to reduce numerical diffusion at the interface between the two fluids several methods have been proposed for this pupose such as the continuous surface stress css gueyffier et al 1999 continuous surface force csf sharp surface force ssf francois et al 2006 and filtered surface force fsf raeini et al 2012 but the csf method may generate spurious fluid velocity field that to some extent is controlled by the ssf method to do so one introduces in the ssf method a sharpened indicator function ϕ of fluid phase 1 that takes on a value of one in fluid 1 brine the wetting fluid and zero in fluid 2 co 2 the non wetting fluid and varies smoothly between the two in the interface region the approach is capable of controlling the sharpness of the capillary pressure the fsf approach utilizes a slightly modified indicator function for the interface motion with a capillary force that compared with the ssf method is smoother this compresses the transition zone of the capillary pressure and hence resolves the issue with the spurious velocities that may arise then the transition area for capillary pressure is only one grid block therefore we utilized the fsf formulation the magnitude f of the interfacial force f is given by 15 f κ σ 2 ρ ρ w ρ n w ϕ with σ being the interfacial tension and κ the curvature given by 16 κ ϕ ϕ the governing equation in addition to the usual mass conservation is the momentum equation 17 t ρ v p μ v f the indicator function ϕ indicating the position of the interface between the two fluids is updated at each time step this is followed by the calculation of the interfacial force f then the velocity and pressure fields are computed by solving the stokes and continuity equations at steady state darcy s law for two phase flow 18 v α k r α k μ α p α α 1 2 is utilized to calculate the relative permeability k r α of fluid phase α as a function of its saturation where k is the absolute permeability as for the fluid properties we used the typical values kohanpur et al 2020 the kinematic viscosities were ν 1 1 0 10 6 for brine ν 2 1 0 10 7 for co 2 both in m 2 s while the densities were ρ 1 ρ 2 10 3 kg m 3 the interfacial tension was assumed to be σ 30 mn m the contact angle for the brine was 0 the openfoam program ubink 1997 and its modified version raeini 2013 which are open source softwares that use finite volume discretization to solve the continuity and the momentum equation in the pore space were utilized for carrying out the numerical simulations for the two phase flow simulation two grid blocks per pixel were used co 2 was injected into the porous medium with a speed of 4 65 10 2 m s at one face so that the capillary number was ca 1 55 10 4 and a fixed atmospheric pressure was applied at the opposite face the other four faces were assumed to be impermeable all the computations were carried out using a hp spectre x360 computer with a speed of 2ghz and 16 gb of memory 5 results as pointed out earlier we carried out simulation of both single and two phase flows in what follows we present and discuss the results 5 1 one phase flow we first carried out a series of simulations of single phase flow varying the resolution of the computational grid the number of grid blocks in order to determine the grid size that yields a permeability independent of the grid s resolution fig 2 presents the results which indicate that a grid with about 3 34 10 6 blocks is necessary to obtain a stable value of the permeability k independent of its resolution the calculated k turned out to be k 1368 md we utilized the same grid in the simulation of two phase flow in the original image without any processing by the ct see below two thresholds ε 0 5 and 0 9 were utilized to denoise the image and carry out simulation of single and two phase flows fig 3 compares the pressure distributions in the original image and in the two coarser ones all the essential features of the three distributions are identical the computed permeabilities are k 1443 and 1467 md for ε 0 5 and 0 9 respectively even the latter estimate with a very high threshold of 0 9 is only 7 3 percent higher than the estimate of k computed with the original image 5 2 two phase flow fig 4 compares the evolution with time of the spatial distribution of co 2 and brine in the original image of the sandstone with those obtained with the ct denoised images with the two thresholds similar to the pressure distribution in single phase flow all the important features of the distributions are completely similar in all the images more quantitatively the differences between the saturations in the original images and the thresholded ones is less than 7 percent in fig 5 we compare the saturation profile of co 2 along the macroscopic direction x of flow at the breakthrough time t b where x x l with l being the linear size of the image the saturation was computed for each plane at position x perpendicular to the direction of macroscopic flow the agreement is excellent fig 6 presents the evolution with time t d of co 2 saturation s co 2 in the original image of the porous medium and compares it with those computed with the thresholded images where t d t t b with t being the actual time at short times the three profiles are identical at longer times all the way to the breakthrough time the maximum difference the profile with ε 0 9 and the original image is about 3 percent fig 7 makes a comparison between the relative permeabilities k r of the two fluids that were computed in the original image of berea sandstone and those calculated with the thresholded images the agreement is excellent in all the cases indicating the accuracy of the computations with the thresholded images to understand the excellence of the accuracy of the computed relative permeabilities we present in fig 8 the distribution of local flow velocities in the original image of the sandstone with those computed with the thresholded images where we have normalized the velocities by their maximum value fig 8 indicates that for velocities up to the maximum of the distributions the agreement between all the distributions is perfect beyond the maximum the agreement is good with all the distributions having the same shape and almost identical tails an important quantity in two phase flow in porous media is the residual saturation s b r of the displaced fluid brine in the present simulation its saturation at the co 2 breakthrough point in table 1 we compare the computed residual saturations in the original image and its thresholded counterparts the maximum difference computed with ε 0 9 between the residual saturations in the original image and the thresholded one is 7 5 percent 6 speed up of the computations we used 2d ct in order to denoise the 3d image for which the computational cost of a digitized image of size n n is o n 2 log n for the 2d slices of size 200 2 pixels the cpu time is very small but since we denoise a large number of them the computation time is relatively significant see below stacking the 200 denoised slices took only 82 cpu seconds in table 1 we compare the details of the computations the total number n of grid blocks the cpu times for all the cases and the brine residual saturations we note that even the computed results with the denoised image with a threshold ε 0 9 are still very accurate and differ from those of the original images by at most 7 percent moreover the speed up factors for the computations with the thresholds ε 0 5 and 0 9 are respectively 263 and 294 these speed up factors are for simulating the two phase flow problem if we add the cpu time for denoising the 2d slices and reconstructing a coarser 3d image to the cpu time for simulating the flow problem then the speed up factor is about one order of magnitude a factor of 7 10 which is still very significant note however that the denoising is done only once while the denoised image can be used in the simulation of a variety of processes in the same image the reason for the very significant speed up is removal of the redundant information from the image which makes it possible to use a coarser computational grid after the image is denoised one must no longer use a highly resolved computational grid everywhere but only in selected areas that are determined by the ct this includes parts of the pores as the difference between their ccs and those of the neighbors and in the solid phase is large and moreover they are also correlated with the areas next to the interface between the pores and the matrix can the efficiency of image based simulation of two phase flows in porous media be increased by other methods it can of course be increased but we are not aware of any method that uses a single processor and achieves the order of the speed uop in the computations that we report while preserving the accuracy based on a transformation whose mathematical foundation is rigorous and was developed precisely for curvy complex space and specifically for image processing according to ying et al 2005 a 256 3 grid takes 250 cpu seconds to be curvelet transformed by a 3d curvelet this does not include its thresholding which is insignificant and inverse transforming its coarser version despite this direct use of 3d ct for denoising a 3d image results in even better speed up factors than what we obtained here even after adding the time of the image processing to the cost of simulating the flow problem we will report on this aspect in the near future 7 summary with the rapid increase in the speed of computations and significant advances in instrumentations it has become possible to simulate multiphase flows in 2d and 3d images of heterogeneous porous media as image based simulation of multiphase flow in heterogeneous porous media becomes more practical one must however address the issue of high computational cost for such simulations while a variety of methods have been proposed such as use of graphics processing units gpus and parallel computations using multiple processors we described in this paper a new methodology to address the issue the approach is based on curvelet transforming the image and processing it by removing those details that do not contribute significantly to physics of fluid flow the computations in the less noisy and coarser images yield results that are as accurate as those in the original ones but with a very large speed up factor this was demonstrated by simulation of two phase flow of co 2 and brine in the 3d images of a sandstone all the properties of the two phase flow system computed with the ct processed images were in excellent agreement with those computed with the original resolved image thus the methodology represents a significant step toward achieving the ultimate goal of direct image based simulations of two phase flows based on the governing equations namely making such simulations a standard practice author statement sahimi conceived the idea sahimi and aljasmi designed the solution aljasi did the computations sahimi and aljasmi analyzed the results sahimi wrote the paper funding was provided by the nsf as the senior investigator declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments a a is grateful to the public authority for applied education and training of kuwait for a ph d scholarship this work was also supported in part by the national science foundation grant cbet 2000968 
330,advances in instrumentation have made it possible to obtain high resolution images of heterogeneous porous media such advances and the rapid increase in computational power mean that direct numerical simulation of multiphase flow in two and three dimensional 3d images of porous media is feasible and therefore models of pore space that represent simplification and approximation of the actual morphology are dispensable the bottleneck for image based simulation is its long computation time we propose an approach for speeding up simulation of multiphase flow in 3d images of porous media that utilizes curvelet transformations cts the cts are designed for denoising of images that contain complex curved surfaces such as those of heterogeneous porous media this is possible because the morphology of most porous media contain extended correlations implying that their images carry redundant information that can be eliminated by a suitable ct as a result simulation of multiphase flow in the coarser images are far less computationally intensive the new approach is used to simulate two phase flow of co 2 and brine in a 3d image of berea sandstone we demonstrate that the results with the ct processed image are as accurate as those with the original one while computations are significantly faster by a speedup factor between one and more than two orders of magnitude keywords two phase fluid flow porous media curvelet transformation 1 introduction although the physics of two phase flow in heterogeneous porous media is reasonably well understood helmig 1997 sahimi 2011 blunt 2017 its efficient simulation is still the subject of active research in particular due to societal interest in geological sequestration of co 2 there is increasing incentive for studying two phase flow of co 2 and brine in such porous media as depleted oil or gas reservoirs friedlingstein and solomon 2005 metz et al 2005 nordbotten and celia 2011 such simulations are either based on the classical continuum formulation of two phase flows bear 1972 which necessitates supplying the simulator with various properties of the pore space such as its porosity and permeability or entails as the first step developing or assuming a model of the pore space that represents faithfully its morphology and the complexities that are associated with it up until relatively recently the most realistic model of a porous medium at laboratory scale was the pore network model pnm in which the pore space extracted from an image of the medium was represented by a network of interconnected pore throats and pore bodies the effective sizes of which were selected according to some representative statistical distributions that can in principle be measured or obtained from the image based on representation of a pore space by the pnms various approaches were developed in order to simulate two phase flows in porous media they included a variety of percolation models ranging from random see for example sahimi et al 1986 to correlated see for example kantzas and chatzis 1988 and invasion percolation for a simple introduction to invasion percolation see ebrahimi 2010 site bond invasion percolation sahimi et al 1998 that considers the effect of both pore bodies and pore throats on the invasion process detailed pore to pore simulations piri and blunt 2005 valvatne and blunt 2004 and a combination of effective medium approximation and random percolation ghanbarian et al 2016 these models have been described and discussed comprehensively by sahimi 2011 blunt 2017 and hunt and sahimi 2017 and therefore need not be described here there have been tremendous advances in instrumentation which have made it possible to obtain high resolution two or three dimensional 3d images of porous media at laboratory scale such images have been becoming important tools for characterization of porous media as they provide depending on their resolution detailed information about the morphology of the pore space the imaging techniques include focused ion beam scanning electron microscopes lemmens et al 2011 magnetic resonance imaging sheppard et al 2003 and x ray computed tomography kantzas et al 1992 arns et al 2001 2002 porter et al 2010 iglauer et al 2010 berg et al 2013 wildenschild et al 2014 the images have been used to display fluid distributions in 3d porous media sheppard et al 2003 even under reservoir conditions andrew et al 2015 with advances in computational power high resolution images of porous media offer the opportunity for precise simulation of fluid flow and transport in porous media if the physical size of the images is larger than the representative elementary volume rev the minimum volume of a porous medium for its properties to be independent of the dimensions they may be used directly in numerical simulation of fluid flow and transport in porous media arns et al 2001 2002 piller et al 2009 tahmasebi et al 2017 as well as adsorption and deformation bakhshian et al 2018 despite the great increase in computational power numerical simulation of fluid flow and transport in the images of porous media is still computationally very expensive natural and many synthetic porous media have pores with irregular shapes with their surface being rough and often a self affine fractal the pores connectivity is also a spatially distributed property giving rise to highly tortuous flow and transport paths thus one needs a high resolution computational grid that represents such complexities accurately simulation of flow in porous media with the lattice boltzmann lb algorithm huang et al 2015 is still slower than direct numerical simulation based on the stokes equation although progress has recently been made in speeding it up an et al 2020 developed a method that integrates the gpu accelerated volumetric lb method vlbm with an upscaling scheme to solve the pore scale two phase flow they utilized the lb simulator to solve both the level set equation for image segmentation and the governing equations for multiphase flow dynamics the method accelerates the standard lb simulations significantly aside from the lb based methods for image based direct simulation of multiphase flow and transport in porous media based on the navier stokes equation to become the standard approach the speed of the calculations must increase very significantly without losing accuracy see for example etemad et al 2017 for a significant effort in this direction in this paper we describe an approach for image based simulation of multiphase flow in 3d porous media the main idea is to focus on the image process and denoise it and remove the complexities that do not contribute significantly to flow and transport in the pore space and then carry out numerical simulation of multiphase flow in the coarse image the image is denoised by curvelet transformations cts a powerful method developed specifically for image processing as we show in this paper the method increases the speed of computations very significantly between one and more than two orders of magnitude while preserving the accuracy of the solution the rest of this paper is structured as follows in section 2 we describe the essentials of the cts section 3 explains the method for denoising the images the two phase flow problem that we study is described in section 4 followed by the presentation and discussion of the results in section 5 the efficiency of the computation is discussed in section 6 while the paper is summarized in the last section 2 curvelet transformations denoising of an image to obtain its coarse but accurate representation has been an active research field for decades daubechies 1988 1992 and mallat 1989b a advanced the field significantly by introducing multiresolution wavelet transforms wts which decompose an image into a series of high and low pass filter bands and extract the details of its structure in the horizontal vertical and diagonal directions heterogeneous porous media particularly 3d ones are however not only highly noisy but also contain curved pore surfaces thus the three directions that the wts employ are not enough for extracting adequate amount of information from 3d images note however that the wts have been used very fruitfully in upscaling of geological models of heterogeneous porous media mehrabi and sahimi 1997 ebrahimi and sahimi 2002 2004 pancaldi et al 2007 rasaei and sahimi 2008 2009 babaei and king 2011 rezapour et al 2019 in geophysics for reviews see kumar and foufoula georgiou 1997 grinsted et al 2004 and in many other applications the shortcomings of the wts motivated the development of the cts which were introduced by donoho 1999 and candés et al 2005 and are highly effective in identifying an image s important features along curves an aspect that is highly important to the processing of images of porous media the cts are multiscale transforms that are capable of producing optimal sparse representation of an image by precise representation of the edges along curves with very high directional sensitivity they have already been used in geoscience olhede and walden 2004 herrmann et al 2007 neelamani et al 2008 dashtian and sahimi 2014 for denoising of geophysical data such as seismic records other applications were described by ma and plonka 2009 we first describe cts for 2d images after which its extension to 3d will be discussed image processing by the cts is done in the frequency space similar to the wts one can construct many types of curvelet functions to do so two windows are considered one w r is a radial window with r being the polar coordinate while the second window v θ is intended for the angular direction both are smooth nonnegative and real functions that satisfy 1 j w 2 2 j r 1 r 3 4 3 2 2 j v 2 θ j 1 t 1 2 1 2 given w r and v θ one constructs a third window u j in the fourier space defined by 3 u j r θ 2 3 j 4 w 2 j r v 2 j 2 θ 2 π with indicating the number s integer part by definition the domain in which u j is nonzero is a polar wedge set by w r and v θ by varying j one utilizes u j with scale dependent window widths in both directions to ensure that u j takes on real values its symmetric version namely u j r θ u j r θ π is used the mother curvelet φ i x referred to as such because all the curvelets at scale 2 j are obtained by rotation and translation of φ i x is then defined by its fourier transform 4 φ i ω u j ω where u j ω 1 ω 2 u ω scale dependent rotation angles θ l 2 π 2 j 2 with l 0 1 and θ l 0 and a sequence of the translation parameters with k k 1 k 2 z 2 are then introduced then the curvelets as a function of x x 1 x 2 at scale 2 j orientation θ l and position x k j l r θ l 1 k 1 2 j k 2 2 j 2 are constructed by donoho 1999 candés et al 2005 5 φ j l k x φ j r θ l x x k j l where r θ l represents a rotation by θ l radians given by 6 r θ l cos θ l sin θ l sin θ l cos θ l with r θ l 1 r θ l t r θ l here t denotes the transpose operation 3 denoising of images of porous media having set up the cts we now describe their use for processing of 2d and 3d images of porous media 3 1 two dimensional images suppose that a 2d image of a porous medium a n n array of pixels is represented by f x its ct usually referred to as the curvelet coefficients ccs c j l k which are completely analogous to wavelet detail coefficients are defined by 7 c j l k f φ j l k f x φ j l k x d x where the overline denotes a complex conjugate because the cts are constructed and used in the frequency domain by using the plancherel s theorem we rewrite the integral in eq 7 in the frequency domain 8 c j l k 1 2 π 2 f ω φ j l k ω d ω 1 2 π 2 f ω u j r θ l ω exp i x k j l ω d ω moreover a window w 0 is introduced by 9 w 0 r 2 1 j 0 w 2 j r 2 since the goal is to obtain a coarser representation of the image we also define in analogy with the wts for which coarse scale wavelet detail coefficients are also defined for k 1 k 2 z the coarse scale curvelets by 10 φ j 0 k x φ j 0 x 2 j 0 k 11 φ j 0 ω 2 j 0 w 0 2 j 0 ω the difference with the wts is that the coarse scale curvelets are nondirectional whereas those defined for the wts are in the aforementioned three directions a complete ct consists of the fine scale directional curvelets φ j l k j j 0 l k and the coarse scale isotropic φ j 0 k k which is called the father wavelet the idea for processing images of porous media by the cts or by the wts for that matter and denoising them exploits the physical fact that the morphology of such media contains extended spatial correlations between the pores and grains see for example knackstedt et al 2001 thus the same correlations exist between the pixels voxels in 3d in the images of porous media the existence of the correlations implies that images contain redundant information and that their removal will not damage the essential information that the images carry once the redundant information is removed simulation of flow and transport in the resulting coarser images is accelerated very significantly as we demonstrate shortly the denoising exploits the fact that starck et al 2002 the ccs represent a measure of the local complexity of an image which in a porous medium is due to the pores rough surface which is typically a self affine fractal see sahimi 2011 for a comprehensive discussion and its correlation with the surrounding pore space in other words the ccs represent a measure of roughness or curviness of the pore grain interface and due to the extended correlations the pores next to the interface are also affected therefore the larger the ccs the more significant is the curviness and hence the roughness clearly if the roughness is severe its contribution to image based simulation of multiphase flow should be significant thus if we keep only the most curved portions of the pore space i e if we denoise the image a coarser computational grid should suffice for the simulations there are several ways of denoising or compressing an image starck et al 2002 but we choose to take the simplest approach that as we demonstrate shortly suffices for our purpose the approach which is referred to as thresholding in image processing consists of the following steps i curvelet transform the image and compute the ccs c j l k ii normalize the ccs by their largest value iii introduce a threshold 0 ε 1 such that if c j l k ε it is set to zero in this way the algorithm generates a sparser representation of the image in the curvelet space as many of the ccs of the original image are set to zero while it still contains all the essential information the numerical value of ε depends on the computation time and resources that one can afford and has access to 3 2 three dimensional images the cts were originally developed for 2d images their extension to 3d initially encountered some difficulties associated with curved surfaces but curvelets for some 3d systems have also been developed ying et al 2005 woiselle et al 2010 but for reasons that will be explained in section 6 in the present paper we use an alternative approach namely we divide a n n n 3d image into n 2d images of size n n apply the methodology described in 3 1 to each 2d image and then stack together the curvelet transformed 2d denoised images to reconstruct a 3d image the orientations of the 2d images relative to the original 3d image does not play a significant role unless the pore space is strongly anisotropic if strong anisotropy is present one may use a ct based anisotropic feature extraction method shinde et al 2017 in the present work we take the 2d images in the planes perpendicular to the direction of macroscopic flow with the development of fast 3d cts the issue of the orientation of the 2d slices relative to the 3d images becomes irrelevant care must however be taken to ensure that after curvelet transforming and thresholding the transition from one processed 2d slice to the next is seamless and does not generate any artifacts to do this we used an open access image processing package that does the segmentation and the stacking process the software is called fiji schindelin et al 2012 which generates directly 3d images from a series of 2d images and is also designed to automatically address issues that may arise from image thresholding which is why the software is a very power tool for more details see https imagej net fiji 3 3 simulations in the curvelet or real space once the coarser image is developed one has two options i one computes the inverse ct of the thresholded image and carries out numerical simulation of two phase flow in it or ii one curvelet transforms the governing flow equations solves them in the ct space and then computes the inverse ct of the numerical results the results presented in this paper were obtained with option i it can be shown aljasmi and sahimi 2020 that if procedure ii is followed the speed up factor for computations will be a factor of four or better even if the images in the curvelet space is not denoised clearly then if the image is denoised and the computations are still carried out in the ct of the denoised image the speed up factor will be quite large the reason that one has better efficiency even without thresholding is that in the ct space a coarser computational grid suffices because many of the ccs of the image are either very small and thus do not make significant contributions or that due to the correlations they are close to those of their neighbors indicating a relatively smooth local environment hence allowing use of larger grid blocks 4 details of the simulations we now describe the porous medium whose image we have used in the computations and explain the computational procedure 4 1 the porous medium we utilized a 3d image of berea sandstone which is considered a benchmark for testing various computational approaches to simulating multiphase flow in porous media and has been used extensively in the past valvatne and blunt 2004 ramstad et al 2012 raeini et al 2014 the digital and physical sizes of the sample are respectively 200 3 voxels and 2 14 3 mm 3 the porosity and absolute permeability of the sample are respectively 0 196 and 1368 md fig 1 presents the image of the sandstone and its 3d coarse version the size of the image is larger than its corresponding rev 4 2 the governing equations and the numerical simulation procedure we first carried out simulation of single phase flow in the image of the berea sandstone both in the original one and in the processed images in order to not only estimate the absolute permeability of the pore space but also determine the size of the computational grid that yield reliable estimate see below we then simulated two phase flow of co 2 and brine in the same images simulating two phase flow in porous media requires upscaling the microscopic dynamic and capillary pressures to the darcy scale while there are several methods for the upscaling we used the velocity weighted averages of both the viscous forces and the pressure gradient that have been demonstrated raeini et al 2014 to yield results that are in agreement with experimental data as for macroscopic pressure drop δ p α in fluid phase α of the two phase system we utilized a slightly modified versions of the same equations which is given by 12 δ p α 1 q α v μ v d v α α 1 2 where the density ρ and viscosity μ are given by 13 μ ϕ μ 1 1 ϕ μ 2 14 ρ ϕ ρ 1 1 ϕ ρ 2 here q α is the flow rate of phase α v is the velocity field v α is the portion of pore volume filled with phase α μ 1 and μ 2 are viscosities of the two fluids and ϕ is the volume fraction of fluid 1 brine in each grid block since the computational grid is eulerian one needs a method for including the interfacial tension in grid so as to reduce numerical diffusion at the interface between the two fluids several methods have been proposed for this pupose such as the continuous surface stress css gueyffier et al 1999 continuous surface force csf sharp surface force ssf francois et al 2006 and filtered surface force fsf raeini et al 2012 but the csf method may generate spurious fluid velocity field that to some extent is controlled by the ssf method to do so one introduces in the ssf method a sharpened indicator function ϕ of fluid phase 1 that takes on a value of one in fluid 1 brine the wetting fluid and zero in fluid 2 co 2 the non wetting fluid and varies smoothly between the two in the interface region the approach is capable of controlling the sharpness of the capillary pressure the fsf approach utilizes a slightly modified indicator function for the interface motion with a capillary force that compared with the ssf method is smoother this compresses the transition zone of the capillary pressure and hence resolves the issue with the spurious velocities that may arise then the transition area for capillary pressure is only one grid block therefore we utilized the fsf formulation the magnitude f of the interfacial force f is given by 15 f κ σ 2 ρ ρ w ρ n w ϕ with σ being the interfacial tension and κ the curvature given by 16 κ ϕ ϕ the governing equation in addition to the usual mass conservation is the momentum equation 17 t ρ v p μ v f the indicator function ϕ indicating the position of the interface between the two fluids is updated at each time step this is followed by the calculation of the interfacial force f then the velocity and pressure fields are computed by solving the stokes and continuity equations at steady state darcy s law for two phase flow 18 v α k r α k μ α p α α 1 2 is utilized to calculate the relative permeability k r α of fluid phase α as a function of its saturation where k is the absolute permeability as for the fluid properties we used the typical values kohanpur et al 2020 the kinematic viscosities were ν 1 1 0 10 6 for brine ν 2 1 0 10 7 for co 2 both in m 2 s while the densities were ρ 1 ρ 2 10 3 kg m 3 the interfacial tension was assumed to be σ 30 mn m the contact angle for the brine was 0 the openfoam program ubink 1997 and its modified version raeini 2013 which are open source softwares that use finite volume discretization to solve the continuity and the momentum equation in the pore space were utilized for carrying out the numerical simulations for the two phase flow simulation two grid blocks per pixel were used co 2 was injected into the porous medium with a speed of 4 65 10 2 m s at one face so that the capillary number was ca 1 55 10 4 and a fixed atmospheric pressure was applied at the opposite face the other four faces were assumed to be impermeable all the computations were carried out using a hp spectre x360 computer with a speed of 2ghz and 16 gb of memory 5 results as pointed out earlier we carried out simulation of both single and two phase flows in what follows we present and discuss the results 5 1 one phase flow we first carried out a series of simulations of single phase flow varying the resolution of the computational grid the number of grid blocks in order to determine the grid size that yields a permeability independent of the grid s resolution fig 2 presents the results which indicate that a grid with about 3 34 10 6 blocks is necessary to obtain a stable value of the permeability k independent of its resolution the calculated k turned out to be k 1368 md we utilized the same grid in the simulation of two phase flow in the original image without any processing by the ct see below two thresholds ε 0 5 and 0 9 were utilized to denoise the image and carry out simulation of single and two phase flows fig 3 compares the pressure distributions in the original image and in the two coarser ones all the essential features of the three distributions are identical the computed permeabilities are k 1443 and 1467 md for ε 0 5 and 0 9 respectively even the latter estimate with a very high threshold of 0 9 is only 7 3 percent higher than the estimate of k computed with the original image 5 2 two phase flow fig 4 compares the evolution with time of the spatial distribution of co 2 and brine in the original image of the sandstone with those obtained with the ct denoised images with the two thresholds similar to the pressure distribution in single phase flow all the important features of the distributions are completely similar in all the images more quantitatively the differences between the saturations in the original images and the thresholded ones is less than 7 percent in fig 5 we compare the saturation profile of co 2 along the macroscopic direction x of flow at the breakthrough time t b where x x l with l being the linear size of the image the saturation was computed for each plane at position x perpendicular to the direction of macroscopic flow the agreement is excellent fig 6 presents the evolution with time t d of co 2 saturation s co 2 in the original image of the porous medium and compares it with those computed with the thresholded images where t d t t b with t being the actual time at short times the three profiles are identical at longer times all the way to the breakthrough time the maximum difference the profile with ε 0 9 and the original image is about 3 percent fig 7 makes a comparison between the relative permeabilities k r of the two fluids that were computed in the original image of berea sandstone and those calculated with the thresholded images the agreement is excellent in all the cases indicating the accuracy of the computations with the thresholded images to understand the excellence of the accuracy of the computed relative permeabilities we present in fig 8 the distribution of local flow velocities in the original image of the sandstone with those computed with the thresholded images where we have normalized the velocities by their maximum value fig 8 indicates that for velocities up to the maximum of the distributions the agreement between all the distributions is perfect beyond the maximum the agreement is good with all the distributions having the same shape and almost identical tails an important quantity in two phase flow in porous media is the residual saturation s b r of the displaced fluid brine in the present simulation its saturation at the co 2 breakthrough point in table 1 we compare the computed residual saturations in the original image and its thresholded counterparts the maximum difference computed with ε 0 9 between the residual saturations in the original image and the thresholded one is 7 5 percent 6 speed up of the computations we used 2d ct in order to denoise the 3d image for which the computational cost of a digitized image of size n n is o n 2 log n for the 2d slices of size 200 2 pixels the cpu time is very small but since we denoise a large number of them the computation time is relatively significant see below stacking the 200 denoised slices took only 82 cpu seconds in table 1 we compare the details of the computations the total number n of grid blocks the cpu times for all the cases and the brine residual saturations we note that even the computed results with the denoised image with a threshold ε 0 9 are still very accurate and differ from those of the original images by at most 7 percent moreover the speed up factors for the computations with the thresholds ε 0 5 and 0 9 are respectively 263 and 294 these speed up factors are for simulating the two phase flow problem if we add the cpu time for denoising the 2d slices and reconstructing a coarser 3d image to the cpu time for simulating the flow problem then the speed up factor is about one order of magnitude a factor of 7 10 which is still very significant note however that the denoising is done only once while the denoised image can be used in the simulation of a variety of processes in the same image the reason for the very significant speed up is removal of the redundant information from the image which makes it possible to use a coarser computational grid after the image is denoised one must no longer use a highly resolved computational grid everywhere but only in selected areas that are determined by the ct this includes parts of the pores as the difference between their ccs and those of the neighbors and in the solid phase is large and moreover they are also correlated with the areas next to the interface between the pores and the matrix can the efficiency of image based simulation of two phase flows in porous media be increased by other methods it can of course be increased but we are not aware of any method that uses a single processor and achieves the order of the speed uop in the computations that we report while preserving the accuracy based on a transformation whose mathematical foundation is rigorous and was developed precisely for curvy complex space and specifically for image processing according to ying et al 2005 a 256 3 grid takes 250 cpu seconds to be curvelet transformed by a 3d curvelet this does not include its thresholding which is insignificant and inverse transforming its coarser version despite this direct use of 3d ct for denoising a 3d image results in even better speed up factors than what we obtained here even after adding the time of the image processing to the cost of simulating the flow problem we will report on this aspect in the near future 7 summary with the rapid increase in the speed of computations and significant advances in instrumentations it has become possible to simulate multiphase flows in 2d and 3d images of heterogeneous porous media as image based simulation of multiphase flow in heterogeneous porous media becomes more practical one must however address the issue of high computational cost for such simulations while a variety of methods have been proposed such as use of graphics processing units gpus and parallel computations using multiple processors we described in this paper a new methodology to address the issue the approach is based on curvelet transforming the image and processing it by removing those details that do not contribute significantly to physics of fluid flow the computations in the less noisy and coarser images yield results that are as accurate as those in the original ones but with a very large speed up factor this was demonstrated by simulation of two phase flow of co 2 and brine in the 3d images of a sandstone all the properties of the two phase flow system computed with the ct processed images were in excellent agreement with those computed with the original resolved image thus the methodology represents a significant step toward achieving the ultimate goal of direct image based simulations of two phase flows based on the governing equations namely making such simulations a standard practice author statement sahimi conceived the idea sahimi and aljasmi designed the solution aljasi did the computations sahimi and aljasmi analyzed the results sahimi wrote the paper funding was provided by the nsf as the senior investigator declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments a a is grateful to the public authority for applied education and training of kuwait for a ph d scholarship this work was also supported in part by the national science foundation grant cbet 2000968 
331,multi decadal prediction of estuarine sedimentation with high fidelity hydromorphodynamic models presents high computation costs especially when accounting for stochasticity and uncertainty a stochastic model for multi decadal estuarine sedimentation seamless is formulated here to support a specific decision need related to resilience planning and coastal management estimating future sedimentation and dredging within a sedimentation basin for different scenarios of sea level rise and rules for dredging seamless combines a reduced dimension process model and a response surface surrogate model to yield an ordinary differential equation that can be integrated over stochastic time series of storm events applications show that seamless can predict probabilities and amounts of future basin sedimentation and dredging with minimal loss of accuracy compared to a high fidelity model while delivering o 10 4 10 5 reduction in computational costs keywords sedimentation hydromorphodynamic modelling delft3d sea level rise surrogate modelling 1 introduction estuaries are embayments open to coastal oceans that receive freshwater runoff pritchard 1967 and are increasingly confronted by climate change and the effects of urban development around the embayment and or in the watershed such as land reclamation and waste discharges lotze et al 2006 estuaries represent critical coastal habitats that support ecosystems including birds fish and invertebrates mclusky and elliott 2004 additionally estuaries provide benefits to society or ecosystem services including recreational opportunities for coastal communities pollutant and nutrient processing support for the shipping defense and fishing industries and urban amenities such as access to wildlife seafood and open spaces barbier et al 2011 these many benefits are often in competition and need to be balanced thus posing challenges for management elliott and whitfield 2011 excess sedimentation is one of the costliest and potentially environmentally damaging management challenges of estuaries chesapeake bay program 2006 kiefer et al 2000 excess deposition negatively affects navigation and damages ecosystems by submerging wetland habitat and changing inundation regimes changes to bathymetry can negatively affect circulation and water quality and the introduction of non native or invasive species through dredging operations can reduce or degrade habitat for sensitive marsh animals haltiner et al 1996 management options such as source control and dredging are costly dredging requirements from federal state and local agencies in the united states are expected to reach 2 billion year with the u s army corps of engineers spending 1 3 billion in 2015 alone us army corps of engineers et al 2016 moreover predicting future dredging requirements is difficult due to uncertain variability in estuarine dynamics and inherent complexities in sedimentation watershed and tidal dynamics and significant changes due to human influences bull et al 2002 in particular estuarine sedimentation is driven by watershed runoff and tidal currents which vary with hourly and longer time scales and are also affected by sea level rise slr and land use management changes mclusky and elliott 2004 griggs et al 2017 high fidelity deterministic models such as delft3d are oftentimes used to answer questions on estuarine sedimentation yu et al 2012 thanh et al 2019 arid regions such as southern california experience highly episodic hydrology with stream flows that vary by several orders of magnitude over time scales of hours to a few days here greater than 90 of sedimentation occurs quickly during the most intense storms kroll 1975 warrick and milliman 2003 the wide range of variability in process magnitude and time scales along with significant uncertainty in model input parameters makes it virtually impossible to deterministically predict future sedimentation and associated dredging requirements thereby motivating the need for stochastic modeling approaches stochastic modeling notably with monte carlo simulations has increasingly been used in environmental studies to characterize ranges and likelihoods of system outcomes over time scales of days months years and even decades or centuries fedra 1983 furthermore stochastic modeling is especially useful for environmental management because probabilities are assigned to a range of outcomes creating opportunities to enhance dialogue and deliberation among stakeholders towards development of cost effective and fair management measures isukapalli et al 1998 however a major limitation of stochastic modeling stems from complex interdependent environmental process dynamics that require use of mechanistic models with high computational demands sparrevik et al 2012 or so called high fidelity models use of high fidelity models make it very difficult or even impossible to complete the thousands or more monte carlo simulations needed to account for stochasticity liu et al 2007 fast running surrogate models have emerged as a promising alternative to high fidelity models with demonstrated ability to radically reduce computational costs razavi et al 2012 one type of surrogate model is a response surface function which captures relationships e g through polynomial approximations between several explanatory variables of a system razavi et al 2012 koziel and leifsson 2013 these response surfaces are developed by running a relatively modest number of high fidelity model simulations over a carefully selected set of input parameter values razavi et al 2012 koziel and leifsson 2013 once the surrogate model is trained to quantify the desired system outcomes over a suitable parameter space thousands or even millions of monte carlo simulations can easily be completed with significantly reduced runtimes compared to the mechanistic model fedra 1983 isukapalli et al 1998 liu et al 2007 razavi et al 2012 koziel and leifsson 2013 examples of response surface surrogate models in water resources include optimization studies razavi et al 2012 improving aquifer management and regulatory support schultz et al 2004 sreekanth and datta 2011 kourakos and mantoglou 2009 and model selection mohammadi et al 2018 another type of surrogate model is a lower fidelity model which can be viewed as a lower resolution versions of a high resolution model razavi et al 2012 within the field of sediment transport and hydromorphodynamics berends et al 2019 present a low fidelity surrogate modeling approach for characterizing the uncertainty of estuarine sedimentation predicted by a high fidelity model the lower resolution model reduced run times by a factor of sixteen compared to the high fidelity model or 6 25 which allowed for an 85 reduction in the overall compute time needed to map out sedimentation patterns and uncertainties using a monte carlo approach additionally mohammadi et al 2018 describe a response surface surrogate model for a hydro morphodynamic model telemac mascaret with sisyphe module of the lower rhine river where bayesian model selection is applied to discern the best choice among empirical sediment transport equations here the response surface surrogate model was applied to quantify the sedimentation uncertainty and model dependence on uncertain parameters nevertheless use of surrogate modeling within hydro morphodynamic simulation is relatively new in this paper we present a new approach to simulate estuarine sedimentation and rule based dredging over multiple decades by combining a reduced dimension process model and a response surface surrogate model within a stochastic monte carlo simulation framework we term this framework the stochastic model for multi decadal estuarine sedimentation seamless the proposed framework is a response to the engagement of coastal stakeholders in southern california under the sedrise project resilient infrastructure and sustainable environments funded by the ecological effects of sea level rise program eeslr of the national centers for coastal ocean science at the national oceanic and atmospheric administration the eeslr program supports transdisciplinary research projects where stakeholders are engaged with the aim of closing the usability gap between what scientists and decision makers consider useful climate rated knowledge delorme et al 2016 in southern california and elsewhere there is a need to plan for accelerating rates of sea level rise and consider changes to sediment management to yield outcomes favorable to coastal ecosystems flood risk management and financial stewardship passeri et al 2015 morris et al 2016 bilskie et al 2016 sea level rise threatens submergence of coastal wetlands thorne et al 2018 and increased flood risk gallien et al 2011 sanders et al 2020 yet the amounts of sea level rise is highly uncertain and partial mitigation of these impacts may be possible through altered sediment management practices sanders and grant 2020 ulibarri et al 2020 the remainder of the paper is organized as follows section 2 presents the theoretical formulation of seamless including the development of a reduced dimension process model that can be integrated efficiently with the aid of a response surface surrogate model section 3 presents an application of seamless to a site in southern california newport bay where sediment fluxes have been subject to management since the 1980s and there is a need to consider sea level rise in adaptation and resilience planning section 4 continues with a second application of seamless to a larger stylized system for which a high fidelity model can more easily be run over long time scales this affords a more critical examination of the seamless framework based on side by side comparisons of seamless and high fidelity model simulations for the same series of storm events section 5 closes the paper with conclusions 2 seamless formulation 2 1 decision support with high fidelity process models high fidelity models for hydro morphodynamics such as delft3d lesser et al 2004 numerically solve process based equations describing fluid flow sediment transport and movement of the fluid bed interface at fine spatial and temporal scales lesser et al 2004 the solution state of a hydro morphodynamic model can be defined by u x t where x r 3 represents the spatial dimensions t represents time and elements of u include the fluid velocity u ground elevation z b sediment concentrations c i for a set of i grain sizes fluid pressure p and fluid density ρ a general representation of hydro morphodynamic models is a system of partial differential equations for u x t that is solved on a spatial domain d and time interval t 0 t as follows 1 u t m u u i where m u is an operator representative of the hydro morphodynamic simulation model and i contains the model inputs that influence the solution including initial conditions boundary conditions and model parameters once the solution is simulated additional operations follow to produce information that is used for decision making that is decision makers likely won t want to know the spatial distributions of fluid velocity pressure and density but rather some integral measures reflective of the level of sedimentation in the system total volume of sediment and or the overall water quality of the system hence there exists a set of decision variables d that are obtained by operating on the solution state m d as follows 2 d m d u decision variables need to be relatively simple and hence d will generally contain orders of magnitude fewer scalar elements than u and maybe even just one or two such as the maximum height of the sediment bed within a collection basin or the total volume of sediment in collection basin generally to meet decision support needs with high fidelity models numerous computationally demanding simulations are run eq 1 to generate output describing the spatial and temporal evolution of the solution state and then results are post processed eq 2 to distill decision variables as shown in fig 1 a 2 2 reduced dimension process model and surrogate model a common decision variable is the spatially averaged value of a system property u t taken over a subset of the model domain d d d the subdomain d d is chosen to align with the decision making needs and in the case of estuarine sedimentation aligns with the spatial extent of a regulatory sedimentation zone or basin where dredging is permitted to occur a general representation of the time wise changes of the spatially averaged solution state within the regulatory basin is given by the following ordinary differential equations ode that is solved for the time interval t 0 t 3 d u d t m u u i where the operator m u represents the bulk effects of hydromorphodynamic processes over the spatial extent of subdomain d d in the case of sedimentation and dredging the key decision variable is simply the total volume of sediment that has accumulated in a regulatory sedimentation basin thus eq 3 simplifies as follows 4 d z b d t m z u i where m z is a refinement of m u that supports output of a single scalar describing the rate of change in average bed elevation as a function of the system state and inputs it is possible to analytically derive the operator m z from the operator m u and the subdomain d d discretize the resulting process based terms and numerically integrate the solution to yield predictions of z b t however this process based approach is not pursued herein rather we introduce a data driven approach using a response surface surrogate model m z as follows 5 d z b d t m z u i whereby the surrogate model depicts the time rate of change of the basin average sediment bed height based on model inputs and system conditions that are found through a diagnostic process to represent the primary controls furthermore the response surface surrogate model is quantified by solving the high fidelity model over a representative range of the control variables which essentially organizes a database or library of known responses that can be accessed as needed to numerically integrate eq 5 hence by combining a reduced dimension process model and a response surface surrogate model decision support needs can be met by numerically integrating an ordinary differential equation eq 5 while leveraging data produced by a high fidelity model as shown in fig 1b site specific considerations will influence the design of the response surface surrogate model m z eq 5 such as the size of the estuary the configuration of the sedimentation basin the tidal dynamics of the estuary and the magnitude and variability of streamflow into the estuary in southern california there are many tidally influenced lagoons flood control channels harbors and embayments subject to sedimentation and dredging these systems are characterized by relatively short lengths and negligible tidal amplification tides in the region have micro tidal amplitudes 1 m with temporal asymmetry that favors export of coarse and fine sediment to the coastal ocean although in some systems tidal asymmetry may favor the import of coarse or fine sediment guo et al 2018 nidzieko 2010 additionally inputs of streamflow and sediment are highly episodic sediment loads vary by orders of magnitude with storm events warrick and milliman 2003 which last less than a day and more than 90 of sedimentation occurs during the most intense storms kroll 1975 warrick and milliman 2003 combining mass balance considerations and sub daily time scale of storm events we can re formulate eq 5 as follows 6 d z b d t 1 ρ s a d m d t where m and a are the sediment mass and planform area of the sedimentation basin respectively and ρ s is the dry bed density of the sediment furthermore we can integrate over the time scale of a storm event t to yield an equation for event based change in sediment basin elevation as follows 7 δ z b t t t d z b d t d t δ m ρ s a and thus we can advance the sediment basin elevation in time from t i to t i 1 as follows 8 z b i 1 z b i δ m i ρ s a subject to an initial condition z b 0 at time t 0 which focuses attention on the need for a surrogate model that characterizes the event based deposition of mass within the sediment basin δ m i taking the event based watershed load of sediment to be l i we can write the event based deposition as 9 δ m i η i l i where η represents the capture efficiency of the sedimentation basin i e the fraction of the sediment load from a storm event that is deposited in the basin moreover through a sensitivity analysis using a high fidelity model described in the following section we find that the primary factors affecting the capture efficiency of the sediment basin are the peak discharge of the storm event q the average basin elevation z b and the tidal conditions which we denote as ϕ hence event based changes in sediment mass required to update eq 8 are computed using a response surface surrogate model for capture efficiency η as follows 10 δ m i η q i z b i ϕ i l i which points to the need for high fidelity model simulations over a parameter space defined by ranges in q z b and ϕ i to create a library of solutions from which values of η can be estimated by interpolation as e g razavi et al 2012 further detail on surrogate model parameterization is left for the next section which presents an application of seamless to a site in southern california two final factors must be considered to support multi decadal simulations of sedimentation sea level rise and dredging events the former is approached by assuming that the height of the sediment bed is measured with respect to a tidal datum mean sea level which implies that increases in mean sea level correspond to decreases in the bed elevation secondly dredging events are modeled by assuming that removal of sediment occurs when the sediment bed elevation reaches a trigger point z b trig and that the sediment bed elevation is lowered to the initial height z b 0 moreover we assume that the post dredging sediment height and trigger height are also measured relative to a tidal datum which preserves the range of depths that occur in the sedimentation basin as sea level rises combining eqs 8 and 10 the final update equation is given as follows 11 z b i 1 z b i η q i z b i ϕ i l i ρ s a δ z slr i if z b z b trig z b 0 if z b z b trig subject to the initial condition given by z b 0 and where δ z slr i represents the change in absolute sea level between t i and t i 1 note that increases in sea level rise act against the effect of sedimentation hence as rates of sea level rise increase the amount of sedimentation required to trigger a dredging event increases moreover in the event that the rate of sea level rise is faster than the rate of sedimentation it is not possible for the sediment bed elevation to reach the trigger height and thus no dredging events occur the seamless framework described herein represents a significant departure from previous sedimentation modeling frameworks involving surrogate modeling e g mohammadi et al 2018 berends et al 2019 whereas previous work focused on more efficiency estimation of uncertainty in sedimentation berends et al 2019 and improved selection of empirical equations for sediment transport rates mohammadi et al 2018 herein we use a response surface surrogate model to evaluate the right hand side of reduced dimension model described by an ordinary differential equation which in turn is configured to account for human influences on sedimentation dredging events as well as changes in mean sea level due to sea level rise with this approach the seamless framework is positioned to make multi decadal predictions of sedimentation and dredging under different sea level rise scenarios and dredging rules which is responsive to coastal management decision making needs in southern california and elsewhere 2 3 surrogate model construction process constructing the response surface surrogate model will rely upon modeling expertise coupled with an iterative process to identify key model sensitivities it is highly unlikely that two surrogate models constructed for different regions will ever look the same or even that key state variables and parameters will remain constant the general overview of model construction is provided to the reader below in list format 1 develop calibrate and validate high fidelity hydromorphodynamic model using best available data 2 identify basin with a well defined geographic boundary and major controls on basin elevation 3 utilize high fidelity model to explore parameter and state variable space to identify key model sensitivities flow tidal condition sediment characteristics dredging basin elevation with which to construct response surface surrogate model 4 compare the surrogate model to high fidelity model output and measured basin elevations to evaluate model performance 5 utilize monte carlo or monte carlo markov chain model to simulate forcing data and use surrogate model to predict future basin elevations 3 seamless application to newport bay 3 1 site description seamless is applied to newport bay a short 10km estuary in southern california that receives sediment input primarily from san diego creek sdc shaded blue as shown in fig 2 the upper portion of the bay contains protected wetland habitat while the lower portion is used as a recreational harbor historically excessive sedimentation from sdc was the greatest driver of habitat change in newport bay threatening to turn protected wetlands into upland habitat trimble 1997 as a result a sediment management strategy for a total maximum daily load tmdl for sdc was implemented stipulating a 50 reduction in overall sediment loads in addition to maintaining a minimum depth of 2 13 meters below msl for subtidal habitat in upper newport bay unb board 2014 newport bay contains two sediment capture basins outlined in red fig 2 basin i iii at the mouth of sdc and basin ii further downstream of sdc constructed in 2010 at a cost of 37 million dollars as part of the sediment tmdl with estimated lifespans of 20 years usacoe 2011 hydrodynamic calibration was reported by guo et al 2018 and additional calibration and evaluation for sedimentation appears in the section 3 5 sedimentation and the corresponding elevation of the unb sediment capture basins is driven by both natural processes and human influences natural processes include fluvial input and transport by estuarine currents which are primarily affected by streamflow and tidal changes in ocean water levels at the mouth of the estuary human influences include land uses that affect runoff and the upstream sources of sediment flood control infrastructure which affects the rate and intensity of streamflow and sediment loads and dredging which affects tidal circulation moreover human influences are shaped by watershed and estuarine management policies including the sediment tdml and dredging policy presently dredging is required when the sediment capture basins fill to an elevation of 2 13 m below msl when that trigger point is reached sediment is dredged to the original basin elevation of 6 65 m below msl and disposed of offshore removing them from the system permanently board 2014 usacoe 2011 hence z b trig 2 13 m and z b 0 6 65 m 3 2 hydrologic oceanographic and bathymetric data stream flow and sediment loading data were acquired for sdc at campus drive a short distance upstream of the connection to newport bay this included a 25 year record of daily peak flow figure s10 and a concurrent five year year record of five minute interval instantaneous flow data figure s1 sediment transport curves as a function of flow for the same time period were provided by oc public works sediment tmdl reports county of orange 2016 figure s2 oceanic water level measurements for the period of interest are available from the los angeles tide gage noaa gage 9410660 bathymetric data of unb for the years 2011 2012 2013 and 2015 at 2 1 meter horizontal resolution vertical errors not reported were available as a result of tmdl compliance monitoring by the army corps of engineers and dredging excavation depths were available for 2010 usacoe 2011 a 2014 survey of lower newport bay lnb bathymetry at 7 6 meter horizontal resolution vertical accuracy of 15 cm was used for lnb usace personal communication and the 2013 noaa coastal topobathy was used to model land elevation and offshore bathymetry horizontal resolution of 1 meter land vertical accuracy of 4 8 cm rsme offshore bathymetry vertical accuracy of 15 cm rsme dewberry 2013 3 3 high fidelity model delft3d a two dimensional depth integrated delft3d model version 4 01 01 was constructed with a domain including the lower part of the san diego creek newport bay and a nearshore zone delft3d resolves fluid flow sediment transport and morphodynamics at fine spatial and temporal scales and has received widespread use for coastal hydromorphodynamics lesser et al 2004 delft3d was configured with an inland inflow boundary where the instantaneous volumetric flow rate and sediment load is specified and an open boundary around 8 km offshore where water level is specified the model mesh contains approximately 46 519 cells with high resolution in the bay and a minimum cell size of 5 10 m with lower resolution offshore and a maximum cell size of roughly 150 350 m the computational mesh and flow resistance parameters are based on a hydrodynamic calibration and evaluation described in guo et al 2018 bed erosion parameters in the delft3d model were developed from field measurements and computational experiments stein 2014 delft3d was calibrated to match morphological change between 2011 and 2012 and then evaluated for the period 2010 2015 five minute interval flow data for 2010 to 2015 was used to specify the freshwater inflow from sdc and sediment loading based on sediment transport curves and six minute interval tide measurements from los angeles were used to specify the water level at the offshore open boundary of the model calibration involved the manual adjustment of several parameters including the sediment curve erosion sedimentation thresholds and dry density of mud within physically plausible ranges which are shown in table 1 a morphological acceleration factor is usually used to achieve decadal to centennial morphodynamic changes roelvink 2006 but for newport bay spatially distributed bed levels were updated at each hydrodynamic time step 0 05 min which corresponds to a morphological acceleration factor of unity a sensitivity analysis using the highest tidal ranges spring tide in january and lowest erosion parameters measured in the bay threshold for erosion 0 16 n m 2 found that little to no morphological changes occurred throughout the whole estuarine system during dry weather 1 of yearly morphodynamic change based on this analysis dry weather events river discharge 20 cms were ignored for the calibration and evaluation phases of the delft3d modeling and time integration of the delft 3d model was limited to the periods of time when sdc streamflow exceeded 20 cms the tidal water level from the la tide gauge was used for each storm to drive the oceanic boundary condition with a period between storms driven by a tidal cycle of 9 to 57 h this was done to ensure that the previous storm was not impacting the hydrodynamics of the proceeding storm two sediment fractions one non cohesive sand grain size of 100 μ m and one cohesive mud settling velocity of 0 25 mm s were used to simulate sediment transport erosion and deposition the largest source of sediment in this system is fine material from san diego creek data collected as part of sediment tmdl found that fines constitute approximately 56 96 of the total load in san diego creek model calibration found that a 95 mud fraction yielded the closest agreement between model and data county of orange 2016 2013 the concentrations of fines are defined by the sediment rating curves see fig s2 based on 25 years of flow and sediment measurements by oc public works county of orange 2016 the relatively small sand fraction of the sediment load is modeled under the assumption of equilibrium concentrations and an unlimited supply of available sediment van rijn et al 1993 deltares 2014 the dry bed densities are 1 600 kg m 3 and 350 kg m 3 for sand and mud respectively the van rijn et al 1993 formula is employed to calculate non cohesive sand transport in which both bed load transport and suspended sediment transport are taken into account details of the van rijn et al 1993 formulae can be found in the user manual of delft3d deltares 2014 and van rijn et al 1993 thus are not repeated here for cohesive sediment the partheniades krone formulation is applied to calculate mud transport partheniades 1965 the critical erosion of the mud used were set to measured values and are 0 16 n m 2 stein 2014 the critical threshold for deposition was calibrated to 0 11 n m 2 from 1 000 n m 2 which resulted in a calibration basin height of 6 14 m for the year 2012 compared to 6 04 m when using 0 11 n m 2 and a measured value of 6 047 for the unit i iii basin these values suggest that erosion only happens when the calculated bed shear stress is 0 16 n m 2 and deposition occurs when shear stress is 0 11 n m 2 deltares 2014 rma 1998 a two dimensional approach was used over a three dimensional formulation using 10 σ layers based on the results of a 2d vs 3d comparison for a one year period 2010 2011 as shown in table 2 the 2d model performed better than the 3d model in the unit i iii basin with a 3 mm difference in modeled vs measured average basin elevation compared to the 3d model s 18 cm difference in the unit ii basin the 3d model performed slightly better than the 2d model with only a 1 cm difference between the two unit i iii basin is largely well mixed trimble 2003 so the 3d model introduces extra physical processes which increases potential model uncertainty and noise explaining the differences between the 2d and 3d model other studies have found that a 2d works equivalently well compared to 3d approach for hydrodynamics salinity sandbach et al 2018 and sediment transport modeling in estuarine systems achete et al 2017 based on the lack of improvement in model accuracy and very significant gains in computational speed roughly 10 times faster the 2d delft3d model was chosen to finish model evaluation and develop the surrogate model 3 4 response surface surrogate model the surrogate model can only be built after a numeric model such as delft3d is calibrated and evaluated at which point numeric model parameters are not changed then the surrogate model can be constructed and evaluated against measured data to ensure surrogate model robustness to develop the response surface surrogate model the high fidelity model was configured to simulate 24 h storm events based on the peak flow into the estuary q a triangular hydrograph shape with a 5 h and 11 h time to rise and fall respectively a pre event sediment basin elevation z b and a mixed regime tidal boundary to match the tides at newport bay with a period of 13 3 h an amplitude a and a phase ϕ these results showed that the most important variables to consider for estimating the sediment capture efficiency η are the flood peak and the pre event basin elevation furthermore results showed that the phasing and amplitude of the tide had a secondary effect with the maximum deposition occurring when the flood peak occurred during the maximum flood currents of a spring tide and the minimum deposition occurring when the flood peak was timed with maximum ebb currents of a spring tide for this system capturing all possible combinations of tidal amplitude and phase would introduce two additional independent variables to the response surface surrogate model in addition to q and z b and assuming that m different values of each independent variable would need to be sampled to map out η the required number of high fidelity model runs would increase from m 2 to m 4 an increase by a factor m 2 this motivated the formulation of capture efficiency as a weighted average of the minimum and maximum capture efficiency over the tidal cycle η min and η max respectively as follows 12 η q z b ϕ 1 θ η min q z b θ η max q z b where θ is a weighting factor that is treated as a random variable between zero and unity in southern california tidal amplitudes transition between small neap tides to large spring tides with a fortnightly cycle and also experience semi diurnal and diurnal variability where a flood peak falls within this cycle is in fact random hence treating θ as a random variable in eq 12 with a uniform distribution between zero and unity leads to a surrogate model for sediment capture efficiency that accounts for both deterministic q and z b and random tidal conditions aspects of the system in the case of newport bay the maximum capture efficiency was found to occur when the flood peak was coincident with the peak flood current η max η flood and the minimum capture efficiency was found to occur when the flood peak was coincident with the maximum ebb current η min η ebb however we anticipate that this could vary from site to site which reiterates the site specific nature of a response surface surrogate model future studies could investigate a diversity of sites and develop potentially develop generalizations of basin response surface surrogate model sensitivities to tides flows sediment supply and basin elevations fig 3 presents the response surfaces for η ebb and η flood respectively for both the unit i iii and unit ii basins basin i iii has an average η of 12 3 and 13 8 and unit ii with an η of 10 1 and 11 1 for peak ebb and flood currents respectively additionally these surfaces show the nonlinear response of capture efficiency to q and z b characterized by local maxima and minima importantly mapping out this dependence using the high fidelity model positions the reduced dimension surrogate model to efficiently make multi decadal simulations with a high level of computational efficiency in two separate basins within the same system 3 5 seamless evaluation the high fidelity model and seamless were both applied to simulate five years of sedimentation 30 storms exceeding baseflow threshold during 2010 2015 in newport bay which corresponds to a duration when annual bathymetric monitoring data are available for validation purposes and gauge measurements are available to specify model inputs including streamflow sediment loads and tides fig 4 presents comparisons of the high fidelity and reduced dimension surrogate model predictions of z b in basin i iii and basin ii which compare favorably to measured changes the models were quantitatively compared based on the root mean square error rsme in basin elevation seamless performs better than the high fidelity model for the unit i iii basin rsme delft 3 d 0 00253 m vs rsme sm 0 00072 m and slightly worse for the unit ii basin rsme delft 3 d 0 00166 m vs rsme sm 0 00180 m this is likely due to stronger tidal currents in the unit ii basin which are also reflected by the larger error bars appearing in fig 4c d compared to fig 4a b furthermore the seamless model uncertainty due to tidal influence bounds the high fidelity model simulations for most years the exception being years 2011 and 2015 in unit i iii the maximum yearly error difference in deposition was 0 081 m and 0 11 m for the surrogate and delft3d models respectively in the unit i iii basin relative runtimes of seamless and the high fidelity model were examined with an 85 year simulation of newport bay seamless was run using a single core on a 3 0 ghz processor while the high fidelity model was run on a high performance computing cluster 64 core compute nodes with 2 33 ghz amd processors and 512 gb of ram using 1 to 64 cores we note that seamless integrates over flood events and the high fidelity model integrates over periods with significant streamflow not dry weather periods although a short period 24 h is modeled between wet weather events for to allow the hydrodynamics to reset to a tidally forced state seamless computes this simulation in 42 s while the high fidelity model run time varies from hundreds to thousands of hours depending on the number of cores table 3 presents the high fidelity model runtimes and seamless speedup defined by the ratio of the high fidelity model runtime to the seamless runtime for a single simulation this shows that individual multi decadal simulations can be completed o 10 4 10 5 times faster using seamless without any obvious loss of accuracy in terms of basin averaged decision variables of interest to stakeholders moreover further gains in computational efficiency are possible through parallel execution of seamless simulations these results show that seamless is ideally configured to support monte carlo markov chain simulations of sedimentation and dredging that account for a range of possible storm peak sequences sea level rise trajectories and dredging rules modeling that would be prohibitively expensive using the high fidelity model 3 6 multi decadal seamless simulation stochasticity is introduced to seamless for multi decadal simulations with daily sdc peak flow q based on a monte carlo markov chain mcmc random sampling see supplemental text for details on mcmc sampler including historical data used to develop the sampler as shown in fig s3 and treating variability in tidal conditions θ as a uniformly distributed random variable eq 12 fig 3 sediment loads for each day are based on sediment rating curves fig s4 and mean sea level is adjusted based on slr projections fig s5 the surrogate model was developed to span the range of possible inflows into newport bay q 10 cms to 1 400 cms basin elevations z b 1 m depth to 6 65 meters depth and tidal condition θ peak ebb or peak flood note that fig 3 only shows the response surface for q 50 cms for visual clarity storms below 50 cms yield complex surfaces due to a higher influence of tidal currents and contribute little to overall basin elevation changes the model accounts for dredging policy by testing for the exceedance of the trigger point 2 13 meters below msl on a daily timescale and resetting the elevation in accordance with the post dredging elevation moreover various scenarios involving changes in natural forcing and human influences are considered to directly simulate dredging the decision variable of interest d as in fig 1 as an example fig 5 shows five mcmc simulations of long term sediment basin elevation changes for the unit i iii b and unit ii c basins given an input of future storm events a generated from the mcmc sampler note that sediment basin elevations z b increase over time increase in proportion to the occurrence and magnitude of storm events q and are lowered with the occurrence of dredging also note significant variability in the timing of dredging which results mainly from the random occurrence of large storm events monte carlo markov chain mcmc simulations of daily peak q were used to drive seamless were run 1 000 times to capture the future uncertainty in dredging scenarios mcmc transition probabilities were kept constant for the purposes this study as incorporating potential changes due to climatic or land use changes is beyond the scope of this work it is important to note however that the speed of the surrogate model allows for quick model re runs and would allow modelers and stakeholders to easily evaluate impacts of changing hydro climatology on dredging given a hydrologic and or meteorological model of the watershed the timing and occurrence of future dredging events is of interest to stakeholders due to the considerable expense in dredging roughly 37 million 2010 dollars per cycle fig 6 demonstrates a potential output of seamless showing the cumulative likelihood of number of dredging events through 2100 for various scenarios this was calculated by taking the mean of the mcmc simulations for the cumulative dredging required to maintain minimum basin depth through 2100 the solid black line shows the cumulative number of required dredging cycles through 2100 under current dredging requirements z b trig 2 13 msl and slr based on the median projection rcp 4 5 scenario 0 61 m by 2100 provided by griggs et al 2017 additionally the range of dredging cycles corresponding to a range in slr through 2100 and a range in the the dredging trigger point are also shown the low and high levels of slr are based on rcp 2 6 0 33 m by 2100 and the h scenario 3 05 m by 2100 reported for southern california by griggs et al 2017 high and low value of z b trig corresponding to 1 0 m and 3 26 m msl or roughly a 1 m change fig 6 shows that the number of dredging events is not very sensitive to slr until after 2050 when the differences in slr become significant in this limit the higher slr scenario h requires less dredging mean 2 58 total dredging cycles compared to the minimum slr scenario rcp 2 6 mean 3 17 dredging cycles this trend is a result of slr adding to basin depth deepening the basin with respect to the original 2 13 meters below 2015 msl focusing now on the dredging trigger point what becomes clear is that the effect on the number of dredging cycles is evident within the first two decades of the simulation before 2040 additionally the effect on the total number of dredging cycles is substantial maintaining a deeper basin elevation 3 26 m msl trigger point mandates more than two additional dredging cycles through 2100 based on 4 36 total dredging events for a 3 26 m msl trigger point and 2 15 dredging events for a 1 0 m msl trigger point the projections shown in fig 6 are responsive to the decision making needs of coastal sediment management stakeholders probabilities for how much dredging will need to be done when it needs to be done and how trigger points rules can be adjusted to manage future dredging as part of the the sedrise project an earlier version of this result was presented at a meeting with stakeholders and received favorably in particular it was reported that dredging events need to be planned and budgeted well over a decade in advance due to challenges with permitting e g ulibarri et al 2020 so a multi decadal forecast of dredging was highly valued in addition stakeholders were very interested on how slr would impact future dredging events simple bathtub approaches for investigating the impacts of slr on coastlines are simple to use and quick to run but inadequately characterize the dynamic effects of slr passeri et al 2015 using seamless for coastal management is beyond the scope of this paper but it s important to emphasize that seamless makes it possible to quickly simulate how a particular management action in this case dredging will be affected by environmental factors like slr and policy factors like dredging trigger points which is valuable for dialogue and deliberation by stakeholders delorme et al 2016 sanders et al 2020 stephens et al 2020 4 seamless application to a stylized estuary a stylized estuary fed by a river and open to the ocean is used to further validate the efficacy of seamless for predicting average sediment basin elevation over multi decadal time scales in systems where sedimentation is controlled by loading during storm events as in southern california moreover we seek to gain a better understanding of seamless limitations with a second stylized application the geometry of the stylized system is presented in fig 7 and is characterized by a 667 meter wide river from the north at 16 meter depth with respect to mean sea level msl the river opens to a 14 38 km long estuary with an average depth of 3 meters and a maintained channel depth of 16 meters the estuary has a 2 2 5 km sedimentation basin where the river meets the estuary which is designed to trap riverine material before it enters the lower portions of the estuary as in newport bay the estuary mouth is 6 km wide with the main channel maintained at 16 meter depth to the open ocean a high fidelity delft3d model is created of this system using a total of 8 993 grid cells with the highest resolution where the river meets the estuary 100 100 meter spacing and the coarsest spacing near the oceanic boundaries 1 000 1 000 meter spacing 4 1 high fidelity model the stylized delft3d model is forced by streamflow at the northern boundary and a tidal time series at the southern boundary and all other boundaries were treated as walls streamflow was simulated with a 24 h flood hydrograph and 12 h time to rise and fall the flood peak was randomly generated using monte carlo sampling of peak flows from 500 20 000 cms which were transformed into daily triangular hydrographs and sediment load was computed with an idealized sediment curve see fig s7 for the peak flow cumulative distribution function and fig s8 for sediment concentration curve used in the high fidelity stylized model a period with 500 cms baseflow in the high fidelity model river lasting a randomly chosen duration between 12 24 h uniform distribution was added between storms to re establish tidal control of the hydrodynamics and to avoid storm peaks being phase locked with the tide tides were modeled by a 1 meter amplitude tide with respect to msl a period of 12 h and phase of zero roughness was modeled using the chezy roughness formula c 65 m 1 2 s with a free slip condition for wall roughness two sediment fractions were used one for sand dry bed density ρ sand 1600 kg m 3 and mud dry bed density ρ mud 500 kg m 3 critical bed shear stress for sedimentation and erosion was 1 000 and 0 5 n m 2 respectively the initial bed layer was a 5 meter thick bed of sand the equilibrium condition for sand transport van rijn and walstra 2003 was used at the inflow boundary a morphological scale factor of 5 was used to speed computation with no loss in accuracy lesser et al 2004 ranasinghe et al 2011 4 2 response surface surrogate model a response surface surrogate model of the form given by eq 12 was developed by running the high fidelity model for a range of q and z b values during peak flood and ebb currents and maximum and minimum tides peak streamflow values were 500 1 000 2 000 4 000 6 000 8 000 10 000 15 000 and 20 000 cms average sediment basin elevations ranged from a low of 3 meters up to 16 meters spaced at intervals between 1 meter from 3 to 4 meters to 2 meters of elevation change from 4 to 16 meters sediment yield for the surrogate model was computed for a given peak flow q by integrating the triangular flow hydrograph multiplied by the instantaneous sediment concentration which yielded the regression equation for sediment load shown in fig s9 the surrogate model accounted for the morphological scaling factor in the high fidelity model simulations by multiplying all incoming sediment volumes by the equivalent scaling factor mf 5 two variants of the surrogate model were developed based on model simulations which found that η max and η min were coincident with peak flood η flood q z b and ebb η ebb q z b currents as in newport bay however the authors note that this is site specific and that high fidelity model simulations of the system are required to investigate the major controls on η max and η min for each site 4 3 multi decadal simulations multi decadal simulation of sedimentation in the stylized estuary was completed by configuring both the high fidelity model and seamless to depict a sequence of n 200 storm events in southern california there are roughly 5 10 storm events which occur in any given year and thus 200 storms roughly equates to 20 40 years integration over events is straightforward using seamless eq 11 a sequence of 200 consecutive monte carlo samples of peak flow created time series of storm events q i i 1 n which were input into both seamless and the high fidelity model these storm peaks were simulated until q i 200 or until the basin infilled to 3 meters below mean sea level whichever came first this was repeated for 100 different storm peak sequences each containing a string of 200 peaks to sample an exhaustive range of possible storm peak sequences and average out tidal effects account of tides between the high fidelity model and seamless was slightly different in accordance with the functionality of each model whereas the high fidelity model uses a random variable to vary the phasing between the storm peak and the tide peak between successive events seamless uses a random variable θ to compute a weighted average of η max and η min moreover for each storm peak sequence seamless was repeated 2 000 times using θ as a random variable hence the final sequence of z b i sm for each storm sequence is computed as the average over 2 000 trials and can be considered to be a tidally averaged solution at the event time scale solutions for each of the 100 different storm sequences were averaged to compute a time series of z b i representative of an average over many different possible storm sequences hence the accuracy of seamless was measured by the mean error me in z b average over 100 storm sequences relative to the high fidelity model averaged over 100 storm sequences 13 me 1 n i 1 n z b i delft 3 d z b i sm where n represents the number of events in the storm sequence when the basin reaches 3 meters below mean sea level or q i 200 storm events the distribution of errors from 100 different storm sequences is shown in fig 8 this distribution passes the k s test for normality p 0 47 with a mean of 0 0607 m and standard deviation σ me of 0 1476 m conceptually the results in fig 8 indicate that the surrogate model sm slightly overestimates average basin elevation by roughly 6 cm on a per storm basis when compared to the high fidelity model this equates to only 0 46 when normalized by overall basin infilling 13 m additional insight is obtained by examining the time series predicted by seamless and the high fidelity model for specific storm sequences that generate different levels of error as measured by eq 13 fig 9 shows time series of z b predicted by seamless and the high fidelity model based on me at a range of quantiles a 95 b 5 c 5 and d 95 while the surrogate model tends to underestimate deposition me 0 0607 m overall the surrogate model shows nearly equivalent performance compared to delft3d as the basin is filled additionally the surrogate model performs with roughly an order of magnitude lower me for the first 100 storm sequences me 0 0061 σ me 0 0922 indicating that seamless is especially adept at predicting basin elevation for roughly the first 10 20 years of basin infilling we attribute the largest source of error in seamless simulation to arise from the assumption that sediment bed elevation is uniform across the sedimentation basin which was used to build the response surface function defining t as the time required for the z b to rise up to the top of the sedimentation basin 3 m fig 10 shows contours of bed elevation predicted for t 0 0 4 t 0 8 t and t this shows that the sediment basin fills in a non uniform manner a feature that is especially evident for t 0 8 t 5 conclusions a reduced dimension surrogate model for estuarine sedimentation within a managed sediment basin seamless is formulated herein and shown to support multi decadal simulation with uncertainty and yield decision variables useful for management in southern california useful output includes the number of expected dredging events in the future the timing of events and volumes of sediment associated with these events under different sea level rise scenarios and rules or trigger points for dredging seamless is shown to yield accuracies comparable to a high fidelity model while the wall clock run time is reduced by a factor of o 10 4 even after the high fidelity model is executed in parallel on a high performance computing cluster with up to 64 cores the accuracy of seamless stems from using a calibrated and validated high fidelity model to develop and parameterize a response surface surrogate model for the capture efficiency of a sedimentation basin η defined as the ratio of sedimentation volume to storm load of sediment over the time scale of a storm event in essence seamless relies on a physics based model to create a set of data that in turn is easily accessed to map out the response of sediment basins to future storm events that bring sediment into the estuary the computational efficiency of the reduced dimension surrogate modeling approach is shown to support monte carlo simulation of future scenarios which provides information about the uncertainty in outcomes sea level rise is expected to reduce the need for dredging in many coastal systems since high sea levels increase depth based on seamless modeling of newport bay expected dredging through 2100 for the lowest estimate of rcp 2 6 and highest estimate h scenario sea level rise trajectories reported by griggs et al 2017 corresponded to 3 2 and 2 6 events respectively however seamless also shows that moving the trigger height for dredging from 2 13 m msl down to 1 m msl or up to 3 26 m msl could change the expected number of dredging events to 2 1 and 4 4 respectively this result shows that rules for dredging exert a strong control over the timing and number of dredging events that are needed to manage critical coastal systems like newport bay under sea level rise and reinforce the utility of the seamless framework as a tool for coastal stakeholder groups to develop rules for dredging under sea level rise seamless was formulated based on coastal embayments in southern california where tidal basins are relatively small and experience episodic runoff and sediment loads lasting less than a day and where dredging is needed to support recreation navigation water equality and ecosystems needs while this general approach may be appropriate at sites elsewhere it is important to acknowledge that response surface surrogate models need to be custom built for each site utilizing a high fidelity numeric model hence a high fidelity model is important for designing the response surface function i e choice of independent variables and for parameterizing the response surface function based on the results of this paper the authors conclude that a surrogate model works when deposition is 1 spatially homogenous 2 the surrogate model area is greater than the numerical model cell size and 3 confined to a well defined basin region further research would benefit surrogate model research by investigating developing surrogate models for spatially heterogeneous regions such as wetlands using statistical methods to describe the spatial structure of deposition additional research incorporating ecological and flood impacts of changing dredging trigger points would improve the utility of the model consideration of a stylized estuary test case also showed that non uniform filling of the sedimentation basin may emerge as a source of error in the sediment capture efficiency used by reduced dimension surrogate model nevertheless the accuracy of seamless was found to be comparable to the high fidelity model for timescales up to several decades credit authorship contribution statement matthew w brand conceptualization methodology software writing original draft writing review editing leicheng guo methodology software validation writing original draft writing review editing eric d stein project administration writing original draft writing review editing brett f sanders conceptualization project administration supervision writing original draft writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is part of the resilient infrastructure and sustainable environments with sediment sedrise project funded by an award na16nos4780206 from the ecological effects of sea level rise program of the national oceanic and atmospheric administration noaa whose support is gratefully acknowledged we also acknowledge financial support by the graduate research fellowship program of the national science foundation nsf for m w brand the statements findings conclusions and recommendations are those of the author s and do not necessarily reflect the views of noaa or nsf the authors also acknowledge invaluable input and feedback from the sedrise management and technology advisory group mtag and research team which contributed to the development and application of the seamless model in particular the authors also thank jian peng and jamie habben at the orange county department of public works for their support in acquiring data for newport bay supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j advwatres 2021 103876 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
331,multi decadal prediction of estuarine sedimentation with high fidelity hydromorphodynamic models presents high computation costs especially when accounting for stochasticity and uncertainty a stochastic model for multi decadal estuarine sedimentation seamless is formulated here to support a specific decision need related to resilience planning and coastal management estimating future sedimentation and dredging within a sedimentation basin for different scenarios of sea level rise and rules for dredging seamless combines a reduced dimension process model and a response surface surrogate model to yield an ordinary differential equation that can be integrated over stochastic time series of storm events applications show that seamless can predict probabilities and amounts of future basin sedimentation and dredging with minimal loss of accuracy compared to a high fidelity model while delivering o 10 4 10 5 reduction in computational costs keywords sedimentation hydromorphodynamic modelling delft3d sea level rise surrogate modelling 1 introduction estuaries are embayments open to coastal oceans that receive freshwater runoff pritchard 1967 and are increasingly confronted by climate change and the effects of urban development around the embayment and or in the watershed such as land reclamation and waste discharges lotze et al 2006 estuaries represent critical coastal habitats that support ecosystems including birds fish and invertebrates mclusky and elliott 2004 additionally estuaries provide benefits to society or ecosystem services including recreational opportunities for coastal communities pollutant and nutrient processing support for the shipping defense and fishing industries and urban amenities such as access to wildlife seafood and open spaces barbier et al 2011 these many benefits are often in competition and need to be balanced thus posing challenges for management elliott and whitfield 2011 excess sedimentation is one of the costliest and potentially environmentally damaging management challenges of estuaries chesapeake bay program 2006 kiefer et al 2000 excess deposition negatively affects navigation and damages ecosystems by submerging wetland habitat and changing inundation regimes changes to bathymetry can negatively affect circulation and water quality and the introduction of non native or invasive species through dredging operations can reduce or degrade habitat for sensitive marsh animals haltiner et al 1996 management options such as source control and dredging are costly dredging requirements from federal state and local agencies in the united states are expected to reach 2 billion year with the u s army corps of engineers spending 1 3 billion in 2015 alone us army corps of engineers et al 2016 moreover predicting future dredging requirements is difficult due to uncertain variability in estuarine dynamics and inherent complexities in sedimentation watershed and tidal dynamics and significant changes due to human influences bull et al 2002 in particular estuarine sedimentation is driven by watershed runoff and tidal currents which vary with hourly and longer time scales and are also affected by sea level rise slr and land use management changes mclusky and elliott 2004 griggs et al 2017 high fidelity deterministic models such as delft3d are oftentimes used to answer questions on estuarine sedimentation yu et al 2012 thanh et al 2019 arid regions such as southern california experience highly episodic hydrology with stream flows that vary by several orders of magnitude over time scales of hours to a few days here greater than 90 of sedimentation occurs quickly during the most intense storms kroll 1975 warrick and milliman 2003 the wide range of variability in process magnitude and time scales along with significant uncertainty in model input parameters makes it virtually impossible to deterministically predict future sedimentation and associated dredging requirements thereby motivating the need for stochastic modeling approaches stochastic modeling notably with monte carlo simulations has increasingly been used in environmental studies to characterize ranges and likelihoods of system outcomes over time scales of days months years and even decades or centuries fedra 1983 furthermore stochastic modeling is especially useful for environmental management because probabilities are assigned to a range of outcomes creating opportunities to enhance dialogue and deliberation among stakeholders towards development of cost effective and fair management measures isukapalli et al 1998 however a major limitation of stochastic modeling stems from complex interdependent environmental process dynamics that require use of mechanistic models with high computational demands sparrevik et al 2012 or so called high fidelity models use of high fidelity models make it very difficult or even impossible to complete the thousands or more monte carlo simulations needed to account for stochasticity liu et al 2007 fast running surrogate models have emerged as a promising alternative to high fidelity models with demonstrated ability to radically reduce computational costs razavi et al 2012 one type of surrogate model is a response surface function which captures relationships e g through polynomial approximations between several explanatory variables of a system razavi et al 2012 koziel and leifsson 2013 these response surfaces are developed by running a relatively modest number of high fidelity model simulations over a carefully selected set of input parameter values razavi et al 2012 koziel and leifsson 2013 once the surrogate model is trained to quantify the desired system outcomes over a suitable parameter space thousands or even millions of monte carlo simulations can easily be completed with significantly reduced runtimes compared to the mechanistic model fedra 1983 isukapalli et al 1998 liu et al 2007 razavi et al 2012 koziel and leifsson 2013 examples of response surface surrogate models in water resources include optimization studies razavi et al 2012 improving aquifer management and regulatory support schultz et al 2004 sreekanth and datta 2011 kourakos and mantoglou 2009 and model selection mohammadi et al 2018 another type of surrogate model is a lower fidelity model which can be viewed as a lower resolution versions of a high resolution model razavi et al 2012 within the field of sediment transport and hydromorphodynamics berends et al 2019 present a low fidelity surrogate modeling approach for characterizing the uncertainty of estuarine sedimentation predicted by a high fidelity model the lower resolution model reduced run times by a factor of sixteen compared to the high fidelity model or 6 25 which allowed for an 85 reduction in the overall compute time needed to map out sedimentation patterns and uncertainties using a monte carlo approach additionally mohammadi et al 2018 describe a response surface surrogate model for a hydro morphodynamic model telemac mascaret with sisyphe module of the lower rhine river where bayesian model selection is applied to discern the best choice among empirical sediment transport equations here the response surface surrogate model was applied to quantify the sedimentation uncertainty and model dependence on uncertain parameters nevertheless use of surrogate modeling within hydro morphodynamic simulation is relatively new in this paper we present a new approach to simulate estuarine sedimentation and rule based dredging over multiple decades by combining a reduced dimension process model and a response surface surrogate model within a stochastic monte carlo simulation framework we term this framework the stochastic model for multi decadal estuarine sedimentation seamless the proposed framework is a response to the engagement of coastal stakeholders in southern california under the sedrise project resilient infrastructure and sustainable environments funded by the ecological effects of sea level rise program eeslr of the national centers for coastal ocean science at the national oceanic and atmospheric administration the eeslr program supports transdisciplinary research projects where stakeholders are engaged with the aim of closing the usability gap between what scientists and decision makers consider useful climate rated knowledge delorme et al 2016 in southern california and elsewhere there is a need to plan for accelerating rates of sea level rise and consider changes to sediment management to yield outcomes favorable to coastal ecosystems flood risk management and financial stewardship passeri et al 2015 morris et al 2016 bilskie et al 2016 sea level rise threatens submergence of coastal wetlands thorne et al 2018 and increased flood risk gallien et al 2011 sanders et al 2020 yet the amounts of sea level rise is highly uncertain and partial mitigation of these impacts may be possible through altered sediment management practices sanders and grant 2020 ulibarri et al 2020 the remainder of the paper is organized as follows section 2 presents the theoretical formulation of seamless including the development of a reduced dimension process model that can be integrated efficiently with the aid of a response surface surrogate model section 3 presents an application of seamless to a site in southern california newport bay where sediment fluxes have been subject to management since the 1980s and there is a need to consider sea level rise in adaptation and resilience planning section 4 continues with a second application of seamless to a larger stylized system for which a high fidelity model can more easily be run over long time scales this affords a more critical examination of the seamless framework based on side by side comparisons of seamless and high fidelity model simulations for the same series of storm events section 5 closes the paper with conclusions 2 seamless formulation 2 1 decision support with high fidelity process models high fidelity models for hydro morphodynamics such as delft3d lesser et al 2004 numerically solve process based equations describing fluid flow sediment transport and movement of the fluid bed interface at fine spatial and temporal scales lesser et al 2004 the solution state of a hydro morphodynamic model can be defined by u x t where x r 3 represents the spatial dimensions t represents time and elements of u include the fluid velocity u ground elevation z b sediment concentrations c i for a set of i grain sizes fluid pressure p and fluid density ρ a general representation of hydro morphodynamic models is a system of partial differential equations for u x t that is solved on a spatial domain d and time interval t 0 t as follows 1 u t m u u i where m u is an operator representative of the hydro morphodynamic simulation model and i contains the model inputs that influence the solution including initial conditions boundary conditions and model parameters once the solution is simulated additional operations follow to produce information that is used for decision making that is decision makers likely won t want to know the spatial distributions of fluid velocity pressure and density but rather some integral measures reflective of the level of sedimentation in the system total volume of sediment and or the overall water quality of the system hence there exists a set of decision variables d that are obtained by operating on the solution state m d as follows 2 d m d u decision variables need to be relatively simple and hence d will generally contain orders of magnitude fewer scalar elements than u and maybe even just one or two such as the maximum height of the sediment bed within a collection basin or the total volume of sediment in collection basin generally to meet decision support needs with high fidelity models numerous computationally demanding simulations are run eq 1 to generate output describing the spatial and temporal evolution of the solution state and then results are post processed eq 2 to distill decision variables as shown in fig 1 a 2 2 reduced dimension process model and surrogate model a common decision variable is the spatially averaged value of a system property u t taken over a subset of the model domain d d d the subdomain d d is chosen to align with the decision making needs and in the case of estuarine sedimentation aligns with the spatial extent of a regulatory sedimentation zone or basin where dredging is permitted to occur a general representation of the time wise changes of the spatially averaged solution state within the regulatory basin is given by the following ordinary differential equations ode that is solved for the time interval t 0 t 3 d u d t m u u i where the operator m u represents the bulk effects of hydromorphodynamic processes over the spatial extent of subdomain d d in the case of sedimentation and dredging the key decision variable is simply the total volume of sediment that has accumulated in a regulatory sedimentation basin thus eq 3 simplifies as follows 4 d z b d t m z u i where m z is a refinement of m u that supports output of a single scalar describing the rate of change in average bed elevation as a function of the system state and inputs it is possible to analytically derive the operator m z from the operator m u and the subdomain d d discretize the resulting process based terms and numerically integrate the solution to yield predictions of z b t however this process based approach is not pursued herein rather we introduce a data driven approach using a response surface surrogate model m z as follows 5 d z b d t m z u i whereby the surrogate model depicts the time rate of change of the basin average sediment bed height based on model inputs and system conditions that are found through a diagnostic process to represent the primary controls furthermore the response surface surrogate model is quantified by solving the high fidelity model over a representative range of the control variables which essentially organizes a database or library of known responses that can be accessed as needed to numerically integrate eq 5 hence by combining a reduced dimension process model and a response surface surrogate model decision support needs can be met by numerically integrating an ordinary differential equation eq 5 while leveraging data produced by a high fidelity model as shown in fig 1b site specific considerations will influence the design of the response surface surrogate model m z eq 5 such as the size of the estuary the configuration of the sedimentation basin the tidal dynamics of the estuary and the magnitude and variability of streamflow into the estuary in southern california there are many tidally influenced lagoons flood control channels harbors and embayments subject to sedimentation and dredging these systems are characterized by relatively short lengths and negligible tidal amplification tides in the region have micro tidal amplitudes 1 m with temporal asymmetry that favors export of coarse and fine sediment to the coastal ocean although in some systems tidal asymmetry may favor the import of coarse or fine sediment guo et al 2018 nidzieko 2010 additionally inputs of streamflow and sediment are highly episodic sediment loads vary by orders of magnitude with storm events warrick and milliman 2003 which last less than a day and more than 90 of sedimentation occurs during the most intense storms kroll 1975 warrick and milliman 2003 combining mass balance considerations and sub daily time scale of storm events we can re formulate eq 5 as follows 6 d z b d t 1 ρ s a d m d t where m and a are the sediment mass and planform area of the sedimentation basin respectively and ρ s is the dry bed density of the sediment furthermore we can integrate over the time scale of a storm event t to yield an equation for event based change in sediment basin elevation as follows 7 δ z b t t t d z b d t d t δ m ρ s a and thus we can advance the sediment basin elevation in time from t i to t i 1 as follows 8 z b i 1 z b i δ m i ρ s a subject to an initial condition z b 0 at time t 0 which focuses attention on the need for a surrogate model that characterizes the event based deposition of mass within the sediment basin δ m i taking the event based watershed load of sediment to be l i we can write the event based deposition as 9 δ m i η i l i where η represents the capture efficiency of the sedimentation basin i e the fraction of the sediment load from a storm event that is deposited in the basin moreover through a sensitivity analysis using a high fidelity model described in the following section we find that the primary factors affecting the capture efficiency of the sediment basin are the peak discharge of the storm event q the average basin elevation z b and the tidal conditions which we denote as ϕ hence event based changes in sediment mass required to update eq 8 are computed using a response surface surrogate model for capture efficiency η as follows 10 δ m i η q i z b i ϕ i l i which points to the need for high fidelity model simulations over a parameter space defined by ranges in q z b and ϕ i to create a library of solutions from which values of η can be estimated by interpolation as e g razavi et al 2012 further detail on surrogate model parameterization is left for the next section which presents an application of seamless to a site in southern california two final factors must be considered to support multi decadal simulations of sedimentation sea level rise and dredging events the former is approached by assuming that the height of the sediment bed is measured with respect to a tidal datum mean sea level which implies that increases in mean sea level correspond to decreases in the bed elevation secondly dredging events are modeled by assuming that removal of sediment occurs when the sediment bed elevation reaches a trigger point z b trig and that the sediment bed elevation is lowered to the initial height z b 0 moreover we assume that the post dredging sediment height and trigger height are also measured relative to a tidal datum which preserves the range of depths that occur in the sedimentation basin as sea level rises combining eqs 8 and 10 the final update equation is given as follows 11 z b i 1 z b i η q i z b i ϕ i l i ρ s a δ z slr i if z b z b trig z b 0 if z b z b trig subject to the initial condition given by z b 0 and where δ z slr i represents the change in absolute sea level between t i and t i 1 note that increases in sea level rise act against the effect of sedimentation hence as rates of sea level rise increase the amount of sedimentation required to trigger a dredging event increases moreover in the event that the rate of sea level rise is faster than the rate of sedimentation it is not possible for the sediment bed elevation to reach the trigger height and thus no dredging events occur the seamless framework described herein represents a significant departure from previous sedimentation modeling frameworks involving surrogate modeling e g mohammadi et al 2018 berends et al 2019 whereas previous work focused on more efficiency estimation of uncertainty in sedimentation berends et al 2019 and improved selection of empirical equations for sediment transport rates mohammadi et al 2018 herein we use a response surface surrogate model to evaluate the right hand side of reduced dimension model described by an ordinary differential equation which in turn is configured to account for human influences on sedimentation dredging events as well as changes in mean sea level due to sea level rise with this approach the seamless framework is positioned to make multi decadal predictions of sedimentation and dredging under different sea level rise scenarios and dredging rules which is responsive to coastal management decision making needs in southern california and elsewhere 2 3 surrogate model construction process constructing the response surface surrogate model will rely upon modeling expertise coupled with an iterative process to identify key model sensitivities it is highly unlikely that two surrogate models constructed for different regions will ever look the same or even that key state variables and parameters will remain constant the general overview of model construction is provided to the reader below in list format 1 develop calibrate and validate high fidelity hydromorphodynamic model using best available data 2 identify basin with a well defined geographic boundary and major controls on basin elevation 3 utilize high fidelity model to explore parameter and state variable space to identify key model sensitivities flow tidal condition sediment characteristics dredging basin elevation with which to construct response surface surrogate model 4 compare the surrogate model to high fidelity model output and measured basin elevations to evaluate model performance 5 utilize monte carlo or monte carlo markov chain model to simulate forcing data and use surrogate model to predict future basin elevations 3 seamless application to newport bay 3 1 site description seamless is applied to newport bay a short 10km estuary in southern california that receives sediment input primarily from san diego creek sdc shaded blue as shown in fig 2 the upper portion of the bay contains protected wetland habitat while the lower portion is used as a recreational harbor historically excessive sedimentation from sdc was the greatest driver of habitat change in newport bay threatening to turn protected wetlands into upland habitat trimble 1997 as a result a sediment management strategy for a total maximum daily load tmdl for sdc was implemented stipulating a 50 reduction in overall sediment loads in addition to maintaining a minimum depth of 2 13 meters below msl for subtidal habitat in upper newport bay unb board 2014 newport bay contains two sediment capture basins outlined in red fig 2 basin i iii at the mouth of sdc and basin ii further downstream of sdc constructed in 2010 at a cost of 37 million dollars as part of the sediment tmdl with estimated lifespans of 20 years usacoe 2011 hydrodynamic calibration was reported by guo et al 2018 and additional calibration and evaluation for sedimentation appears in the section 3 5 sedimentation and the corresponding elevation of the unb sediment capture basins is driven by both natural processes and human influences natural processes include fluvial input and transport by estuarine currents which are primarily affected by streamflow and tidal changes in ocean water levels at the mouth of the estuary human influences include land uses that affect runoff and the upstream sources of sediment flood control infrastructure which affects the rate and intensity of streamflow and sediment loads and dredging which affects tidal circulation moreover human influences are shaped by watershed and estuarine management policies including the sediment tdml and dredging policy presently dredging is required when the sediment capture basins fill to an elevation of 2 13 m below msl when that trigger point is reached sediment is dredged to the original basin elevation of 6 65 m below msl and disposed of offshore removing them from the system permanently board 2014 usacoe 2011 hence z b trig 2 13 m and z b 0 6 65 m 3 2 hydrologic oceanographic and bathymetric data stream flow and sediment loading data were acquired for sdc at campus drive a short distance upstream of the connection to newport bay this included a 25 year record of daily peak flow figure s10 and a concurrent five year year record of five minute interval instantaneous flow data figure s1 sediment transport curves as a function of flow for the same time period were provided by oc public works sediment tmdl reports county of orange 2016 figure s2 oceanic water level measurements for the period of interest are available from the los angeles tide gage noaa gage 9410660 bathymetric data of unb for the years 2011 2012 2013 and 2015 at 2 1 meter horizontal resolution vertical errors not reported were available as a result of tmdl compliance monitoring by the army corps of engineers and dredging excavation depths were available for 2010 usacoe 2011 a 2014 survey of lower newport bay lnb bathymetry at 7 6 meter horizontal resolution vertical accuracy of 15 cm was used for lnb usace personal communication and the 2013 noaa coastal topobathy was used to model land elevation and offshore bathymetry horizontal resolution of 1 meter land vertical accuracy of 4 8 cm rsme offshore bathymetry vertical accuracy of 15 cm rsme dewberry 2013 3 3 high fidelity model delft3d a two dimensional depth integrated delft3d model version 4 01 01 was constructed with a domain including the lower part of the san diego creek newport bay and a nearshore zone delft3d resolves fluid flow sediment transport and morphodynamics at fine spatial and temporal scales and has received widespread use for coastal hydromorphodynamics lesser et al 2004 delft3d was configured with an inland inflow boundary where the instantaneous volumetric flow rate and sediment load is specified and an open boundary around 8 km offshore where water level is specified the model mesh contains approximately 46 519 cells with high resolution in the bay and a minimum cell size of 5 10 m with lower resolution offshore and a maximum cell size of roughly 150 350 m the computational mesh and flow resistance parameters are based on a hydrodynamic calibration and evaluation described in guo et al 2018 bed erosion parameters in the delft3d model were developed from field measurements and computational experiments stein 2014 delft3d was calibrated to match morphological change between 2011 and 2012 and then evaluated for the period 2010 2015 five minute interval flow data for 2010 to 2015 was used to specify the freshwater inflow from sdc and sediment loading based on sediment transport curves and six minute interval tide measurements from los angeles were used to specify the water level at the offshore open boundary of the model calibration involved the manual adjustment of several parameters including the sediment curve erosion sedimentation thresholds and dry density of mud within physically plausible ranges which are shown in table 1 a morphological acceleration factor is usually used to achieve decadal to centennial morphodynamic changes roelvink 2006 but for newport bay spatially distributed bed levels were updated at each hydrodynamic time step 0 05 min which corresponds to a morphological acceleration factor of unity a sensitivity analysis using the highest tidal ranges spring tide in january and lowest erosion parameters measured in the bay threshold for erosion 0 16 n m 2 found that little to no morphological changes occurred throughout the whole estuarine system during dry weather 1 of yearly morphodynamic change based on this analysis dry weather events river discharge 20 cms were ignored for the calibration and evaluation phases of the delft3d modeling and time integration of the delft 3d model was limited to the periods of time when sdc streamflow exceeded 20 cms the tidal water level from the la tide gauge was used for each storm to drive the oceanic boundary condition with a period between storms driven by a tidal cycle of 9 to 57 h this was done to ensure that the previous storm was not impacting the hydrodynamics of the proceeding storm two sediment fractions one non cohesive sand grain size of 100 μ m and one cohesive mud settling velocity of 0 25 mm s were used to simulate sediment transport erosion and deposition the largest source of sediment in this system is fine material from san diego creek data collected as part of sediment tmdl found that fines constitute approximately 56 96 of the total load in san diego creek model calibration found that a 95 mud fraction yielded the closest agreement between model and data county of orange 2016 2013 the concentrations of fines are defined by the sediment rating curves see fig s2 based on 25 years of flow and sediment measurements by oc public works county of orange 2016 the relatively small sand fraction of the sediment load is modeled under the assumption of equilibrium concentrations and an unlimited supply of available sediment van rijn et al 1993 deltares 2014 the dry bed densities are 1 600 kg m 3 and 350 kg m 3 for sand and mud respectively the van rijn et al 1993 formula is employed to calculate non cohesive sand transport in which both bed load transport and suspended sediment transport are taken into account details of the van rijn et al 1993 formulae can be found in the user manual of delft3d deltares 2014 and van rijn et al 1993 thus are not repeated here for cohesive sediment the partheniades krone formulation is applied to calculate mud transport partheniades 1965 the critical erosion of the mud used were set to measured values and are 0 16 n m 2 stein 2014 the critical threshold for deposition was calibrated to 0 11 n m 2 from 1 000 n m 2 which resulted in a calibration basin height of 6 14 m for the year 2012 compared to 6 04 m when using 0 11 n m 2 and a measured value of 6 047 for the unit i iii basin these values suggest that erosion only happens when the calculated bed shear stress is 0 16 n m 2 and deposition occurs when shear stress is 0 11 n m 2 deltares 2014 rma 1998 a two dimensional approach was used over a three dimensional formulation using 10 σ layers based on the results of a 2d vs 3d comparison for a one year period 2010 2011 as shown in table 2 the 2d model performed better than the 3d model in the unit i iii basin with a 3 mm difference in modeled vs measured average basin elevation compared to the 3d model s 18 cm difference in the unit ii basin the 3d model performed slightly better than the 2d model with only a 1 cm difference between the two unit i iii basin is largely well mixed trimble 2003 so the 3d model introduces extra physical processes which increases potential model uncertainty and noise explaining the differences between the 2d and 3d model other studies have found that a 2d works equivalently well compared to 3d approach for hydrodynamics salinity sandbach et al 2018 and sediment transport modeling in estuarine systems achete et al 2017 based on the lack of improvement in model accuracy and very significant gains in computational speed roughly 10 times faster the 2d delft3d model was chosen to finish model evaluation and develop the surrogate model 3 4 response surface surrogate model the surrogate model can only be built after a numeric model such as delft3d is calibrated and evaluated at which point numeric model parameters are not changed then the surrogate model can be constructed and evaluated against measured data to ensure surrogate model robustness to develop the response surface surrogate model the high fidelity model was configured to simulate 24 h storm events based on the peak flow into the estuary q a triangular hydrograph shape with a 5 h and 11 h time to rise and fall respectively a pre event sediment basin elevation z b and a mixed regime tidal boundary to match the tides at newport bay with a period of 13 3 h an amplitude a and a phase ϕ these results showed that the most important variables to consider for estimating the sediment capture efficiency η are the flood peak and the pre event basin elevation furthermore results showed that the phasing and amplitude of the tide had a secondary effect with the maximum deposition occurring when the flood peak occurred during the maximum flood currents of a spring tide and the minimum deposition occurring when the flood peak was timed with maximum ebb currents of a spring tide for this system capturing all possible combinations of tidal amplitude and phase would introduce two additional independent variables to the response surface surrogate model in addition to q and z b and assuming that m different values of each independent variable would need to be sampled to map out η the required number of high fidelity model runs would increase from m 2 to m 4 an increase by a factor m 2 this motivated the formulation of capture efficiency as a weighted average of the minimum and maximum capture efficiency over the tidal cycle η min and η max respectively as follows 12 η q z b ϕ 1 θ η min q z b θ η max q z b where θ is a weighting factor that is treated as a random variable between zero and unity in southern california tidal amplitudes transition between small neap tides to large spring tides with a fortnightly cycle and also experience semi diurnal and diurnal variability where a flood peak falls within this cycle is in fact random hence treating θ as a random variable in eq 12 with a uniform distribution between zero and unity leads to a surrogate model for sediment capture efficiency that accounts for both deterministic q and z b and random tidal conditions aspects of the system in the case of newport bay the maximum capture efficiency was found to occur when the flood peak was coincident with the peak flood current η max η flood and the minimum capture efficiency was found to occur when the flood peak was coincident with the maximum ebb current η min η ebb however we anticipate that this could vary from site to site which reiterates the site specific nature of a response surface surrogate model future studies could investigate a diversity of sites and develop potentially develop generalizations of basin response surface surrogate model sensitivities to tides flows sediment supply and basin elevations fig 3 presents the response surfaces for η ebb and η flood respectively for both the unit i iii and unit ii basins basin i iii has an average η of 12 3 and 13 8 and unit ii with an η of 10 1 and 11 1 for peak ebb and flood currents respectively additionally these surfaces show the nonlinear response of capture efficiency to q and z b characterized by local maxima and minima importantly mapping out this dependence using the high fidelity model positions the reduced dimension surrogate model to efficiently make multi decadal simulations with a high level of computational efficiency in two separate basins within the same system 3 5 seamless evaluation the high fidelity model and seamless were both applied to simulate five years of sedimentation 30 storms exceeding baseflow threshold during 2010 2015 in newport bay which corresponds to a duration when annual bathymetric monitoring data are available for validation purposes and gauge measurements are available to specify model inputs including streamflow sediment loads and tides fig 4 presents comparisons of the high fidelity and reduced dimension surrogate model predictions of z b in basin i iii and basin ii which compare favorably to measured changes the models were quantitatively compared based on the root mean square error rsme in basin elevation seamless performs better than the high fidelity model for the unit i iii basin rsme delft 3 d 0 00253 m vs rsme sm 0 00072 m and slightly worse for the unit ii basin rsme delft 3 d 0 00166 m vs rsme sm 0 00180 m this is likely due to stronger tidal currents in the unit ii basin which are also reflected by the larger error bars appearing in fig 4c d compared to fig 4a b furthermore the seamless model uncertainty due to tidal influence bounds the high fidelity model simulations for most years the exception being years 2011 and 2015 in unit i iii the maximum yearly error difference in deposition was 0 081 m and 0 11 m for the surrogate and delft3d models respectively in the unit i iii basin relative runtimes of seamless and the high fidelity model were examined with an 85 year simulation of newport bay seamless was run using a single core on a 3 0 ghz processor while the high fidelity model was run on a high performance computing cluster 64 core compute nodes with 2 33 ghz amd processors and 512 gb of ram using 1 to 64 cores we note that seamless integrates over flood events and the high fidelity model integrates over periods with significant streamflow not dry weather periods although a short period 24 h is modeled between wet weather events for to allow the hydrodynamics to reset to a tidally forced state seamless computes this simulation in 42 s while the high fidelity model run time varies from hundreds to thousands of hours depending on the number of cores table 3 presents the high fidelity model runtimes and seamless speedup defined by the ratio of the high fidelity model runtime to the seamless runtime for a single simulation this shows that individual multi decadal simulations can be completed o 10 4 10 5 times faster using seamless without any obvious loss of accuracy in terms of basin averaged decision variables of interest to stakeholders moreover further gains in computational efficiency are possible through parallel execution of seamless simulations these results show that seamless is ideally configured to support monte carlo markov chain simulations of sedimentation and dredging that account for a range of possible storm peak sequences sea level rise trajectories and dredging rules modeling that would be prohibitively expensive using the high fidelity model 3 6 multi decadal seamless simulation stochasticity is introduced to seamless for multi decadal simulations with daily sdc peak flow q based on a monte carlo markov chain mcmc random sampling see supplemental text for details on mcmc sampler including historical data used to develop the sampler as shown in fig s3 and treating variability in tidal conditions θ as a uniformly distributed random variable eq 12 fig 3 sediment loads for each day are based on sediment rating curves fig s4 and mean sea level is adjusted based on slr projections fig s5 the surrogate model was developed to span the range of possible inflows into newport bay q 10 cms to 1 400 cms basin elevations z b 1 m depth to 6 65 meters depth and tidal condition θ peak ebb or peak flood note that fig 3 only shows the response surface for q 50 cms for visual clarity storms below 50 cms yield complex surfaces due to a higher influence of tidal currents and contribute little to overall basin elevation changes the model accounts for dredging policy by testing for the exceedance of the trigger point 2 13 meters below msl on a daily timescale and resetting the elevation in accordance with the post dredging elevation moreover various scenarios involving changes in natural forcing and human influences are considered to directly simulate dredging the decision variable of interest d as in fig 1 as an example fig 5 shows five mcmc simulations of long term sediment basin elevation changes for the unit i iii b and unit ii c basins given an input of future storm events a generated from the mcmc sampler note that sediment basin elevations z b increase over time increase in proportion to the occurrence and magnitude of storm events q and are lowered with the occurrence of dredging also note significant variability in the timing of dredging which results mainly from the random occurrence of large storm events monte carlo markov chain mcmc simulations of daily peak q were used to drive seamless were run 1 000 times to capture the future uncertainty in dredging scenarios mcmc transition probabilities were kept constant for the purposes this study as incorporating potential changes due to climatic or land use changes is beyond the scope of this work it is important to note however that the speed of the surrogate model allows for quick model re runs and would allow modelers and stakeholders to easily evaluate impacts of changing hydro climatology on dredging given a hydrologic and or meteorological model of the watershed the timing and occurrence of future dredging events is of interest to stakeholders due to the considerable expense in dredging roughly 37 million 2010 dollars per cycle fig 6 demonstrates a potential output of seamless showing the cumulative likelihood of number of dredging events through 2100 for various scenarios this was calculated by taking the mean of the mcmc simulations for the cumulative dredging required to maintain minimum basin depth through 2100 the solid black line shows the cumulative number of required dredging cycles through 2100 under current dredging requirements z b trig 2 13 msl and slr based on the median projection rcp 4 5 scenario 0 61 m by 2100 provided by griggs et al 2017 additionally the range of dredging cycles corresponding to a range in slr through 2100 and a range in the the dredging trigger point are also shown the low and high levels of slr are based on rcp 2 6 0 33 m by 2100 and the h scenario 3 05 m by 2100 reported for southern california by griggs et al 2017 high and low value of z b trig corresponding to 1 0 m and 3 26 m msl or roughly a 1 m change fig 6 shows that the number of dredging events is not very sensitive to slr until after 2050 when the differences in slr become significant in this limit the higher slr scenario h requires less dredging mean 2 58 total dredging cycles compared to the minimum slr scenario rcp 2 6 mean 3 17 dredging cycles this trend is a result of slr adding to basin depth deepening the basin with respect to the original 2 13 meters below 2015 msl focusing now on the dredging trigger point what becomes clear is that the effect on the number of dredging cycles is evident within the first two decades of the simulation before 2040 additionally the effect on the total number of dredging cycles is substantial maintaining a deeper basin elevation 3 26 m msl trigger point mandates more than two additional dredging cycles through 2100 based on 4 36 total dredging events for a 3 26 m msl trigger point and 2 15 dredging events for a 1 0 m msl trigger point the projections shown in fig 6 are responsive to the decision making needs of coastal sediment management stakeholders probabilities for how much dredging will need to be done when it needs to be done and how trigger points rules can be adjusted to manage future dredging as part of the the sedrise project an earlier version of this result was presented at a meeting with stakeholders and received favorably in particular it was reported that dredging events need to be planned and budgeted well over a decade in advance due to challenges with permitting e g ulibarri et al 2020 so a multi decadal forecast of dredging was highly valued in addition stakeholders were very interested on how slr would impact future dredging events simple bathtub approaches for investigating the impacts of slr on coastlines are simple to use and quick to run but inadequately characterize the dynamic effects of slr passeri et al 2015 using seamless for coastal management is beyond the scope of this paper but it s important to emphasize that seamless makes it possible to quickly simulate how a particular management action in this case dredging will be affected by environmental factors like slr and policy factors like dredging trigger points which is valuable for dialogue and deliberation by stakeholders delorme et al 2016 sanders et al 2020 stephens et al 2020 4 seamless application to a stylized estuary a stylized estuary fed by a river and open to the ocean is used to further validate the efficacy of seamless for predicting average sediment basin elevation over multi decadal time scales in systems where sedimentation is controlled by loading during storm events as in southern california moreover we seek to gain a better understanding of seamless limitations with a second stylized application the geometry of the stylized system is presented in fig 7 and is characterized by a 667 meter wide river from the north at 16 meter depth with respect to mean sea level msl the river opens to a 14 38 km long estuary with an average depth of 3 meters and a maintained channel depth of 16 meters the estuary has a 2 2 5 km sedimentation basin where the river meets the estuary which is designed to trap riverine material before it enters the lower portions of the estuary as in newport bay the estuary mouth is 6 km wide with the main channel maintained at 16 meter depth to the open ocean a high fidelity delft3d model is created of this system using a total of 8 993 grid cells with the highest resolution where the river meets the estuary 100 100 meter spacing and the coarsest spacing near the oceanic boundaries 1 000 1 000 meter spacing 4 1 high fidelity model the stylized delft3d model is forced by streamflow at the northern boundary and a tidal time series at the southern boundary and all other boundaries were treated as walls streamflow was simulated with a 24 h flood hydrograph and 12 h time to rise and fall the flood peak was randomly generated using monte carlo sampling of peak flows from 500 20 000 cms which were transformed into daily triangular hydrographs and sediment load was computed with an idealized sediment curve see fig s7 for the peak flow cumulative distribution function and fig s8 for sediment concentration curve used in the high fidelity stylized model a period with 500 cms baseflow in the high fidelity model river lasting a randomly chosen duration between 12 24 h uniform distribution was added between storms to re establish tidal control of the hydrodynamics and to avoid storm peaks being phase locked with the tide tides were modeled by a 1 meter amplitude tide with respect to msl a period of 12 h and phase of zero roughness was modeled using the chezy roughness formula c 65 m 1 2 s with a free slip condition for wall roughness two sediment fractions were used one for sand dry bed density ρ sand 1600 kg m 3 and mud dry bed density ρ mud 500 kg m 3 critical bed shear stress for sedimentation and erosion was 1 000 and 0 5 n m 2 respectively the initial bed layer was a 5 meter thick bed of sand the equilibrium condition for sand transport van rijn and walstra 2003 was used at the inflow boundary a morphological scale factor of 5 was used to speed computation with no loss in accuracy lesser et al 2004 ranasinghe et al 2011 4 2 response surface surrogate model a response surface surrogate model of the form given by eq 12 was developed by running the high fidelity model for a range of q and z b values during peak flood and ebb currents and maximum and minimum tides peak streamflow values were 500 1 000 2 000 4 000 6 000 8 000 10 000 15 000 and 20 000 cms average sediment basin elevations ranged from a low of 3 meters up to 16 meters spaced at intervals between 1 meter from 3 to 4 meters to 2 meters of elevation change from 4 to 16 meters sediment yield for the surrogate model was computed for a given peak flow q by integrating the triangular flow hydrograph multiplied by the instantaneous sediment concentration which yielded the regression equation for sediment load shown in fig s9 the surrogate model accounted for the morphological scaling factor in the high fidelity model simulations by multiplying all incoming sediment volumes by the equivalent scaling factor mf 5 two variants of the surrogate model were developed based on model simulations which found that η max and η min were coincident with peak flood η flood q z b and ebb η ebb q z b currents as in newport bay however the authors note that this is site specific and that high fidelity model simulations of the system are required to investigate the major controls on η max and η min for each site 4 3 multi decadal simulations multi decadal simulation of sedimentation in the stylized estuary was completed by configuring both the high fidelity model and seamless to depict a sequence of n 200 storm events in southern california there are roughly 5 10 storm events which occur in any given year and thus 200 storms roughly equates to 20 40 years integration over events is straightforward using seamless eq 11 a sequence of 200 consecutive monte carlo samples of peak flow created time series of storm events q i i 1 n which were input into both seamless and the high fidelity model these storm peaks were simulated until q i 200 or until the basin infilled to 3 meters below mean sea level whichever came first this was repeated for 100 different storm peak sequences each containing a string of 200 peaks to sample an exhaustive range of possible storm peak sequences and average out tidal effects account of tides between the high fidelity model and seamless was slightly different in accordance with the functionality of each model whereas the high fidelity model uses a random variable to vary the phasing between the storm peak and the tide peak between successive events seamless uses a random variable θ to compute a weighted average of η max and η min moreover for each storm peak sequence seamless was repeated 2 000 times using θ as a random variable hence the final sequence of z b i sm for each storm sequence is computed as the average over 2 000 trials and can be considered to be a tidally averaged solution at the event time scale solutions for each of the 100 different storm sequences were averaged to compute a time series of z b i representative of an average over many different possible storm sequences hence the accuracy of seamless was measured by the mean error me in z b average over 100 storm sequences relative to the high fidelity model averaged over 100 storm sequences 13 me 1 n i 1 n z b i delft 3 d z b i sm where n represents the number of events in the storm sequence when the basin reaches 3 meters below mean sea level or q i 200 storm events the distribution of errors from 100 different storm sequences is shown in fig 8 this distribution passes the k s test for normality p 0 47 with a mean of 0 0607 m and standard deviation σ me of 0 1476 m conceptually the results in fig 8 indicate that the surrogate model sm slightly overestimates average basin elevation by roughly 6 cm on a per storm basis when compared to the high fidelity model this equates to only 0 46 when normalized by overall basin infilling 13 m additional insight is obtained by examining the time series predicted by seamless and the high fidelity model for specific storm sequences that generate different levels of error as measured by eq 13 fig 9 shows time series of z b predicted by seamless and the high fidelity model based on me at a range of quantiles a 95 b 5 c 5 and d 95 while the surrogate model tends to underestimate deposition me 0 0607 m overall the surrogate model shows nearly equivalent performance compared to delft3d as the basin is filled additionally the surrogate model performs with roughly an order of magnitude lower me for the first 100 storm sequences me 0 0061 σ me 0 0922 indicating that seamless is especially adept at predicting basin elevation for roughly the first 10 20 years of basin infilling we attribute the largest source of error in seamless simulation to arise from the assumption that sediment bed elevation is uniform across the sedimentation basin which was used to build the response surface function defining t as the time required for the z b to rise up to the top of the sedimentation basin 3 m fig 10 shows contours of bed elevation predicted for t 0 0 4 t 0 8 t and t this shows that the sediment basin fills in a non uniform manner a feature that is especially evident for t 0 8 t 5 conclusions a reduced dimension surrogate model for estuarine sedimentation within a managed sediment basin seamless is formulated herein and shown to support multi decadal simulation with uncertainty and yield decision variables useful for management in southern california useful output includes the number of expected dredging events in the future the timing of events and volumes of sediment associated with these events under different sea level rise scenarios and rules or trigger points for dredging seamless is shown to yield accuracies comparable to a high fidelity model while the wall clock run time is reduced by a factor of o 10 4 even after the high fidelity model is executed in parallel on a high performance computing cluster with up to 64 cores the accuracy of seamless stems from using a calibrated and validated high fidelity model to develop and parameterize a response surface surrogate model for the capture efficiency of a sedimentation basin η defined as the ratio of sedimentation volume to storm load of sediment over the time scale of a storm event in essence seamless relies on a physics based model to create a set of data that in turn is easily accessed to map out the response of sediment basins to future storm events that bring sediment into the estuary the computational efficiency of the reduced dimension surrogate modeling approach is shown to support monte carlo simulation of future scenarios which provides information about the uncertainty in outcomes sea level rise is expected to reduce the need for dredging in many coastal systems since high sea levels increase depth based on seamless modeling of newport bay expected dredging through 2100 for the lowest estimate of rcp 2 6 and highest estimate h scenario sea level rise trajectories reported by griggs et al 2017 corresponded to 3 2 and 2 6 events respectively however seamless also shows that moving the trigger height for dredging from 2 13 m msl down to 1 m msl or up to 3 26 m msl could change the expected number of dredging events to 2 1 and 4 4 respectively this result shows that rules for dredging exert a strong control over the timing and number of dredging events that are needed to manage critical coastal systems like newport bay under sea level rise and reinforce the utility of the seamless framework as a tool for coastal stakeholder groups to develop rules for dredging under sea level rise seamless was formulated based on coastal embayments in southern california where tidal basins are relatively small and experience episodic runoff and sediment loads lasting less than a day and where dredging is needed to support recreation navigation water equality and ecosystems needs while this general approach may be appropriate at sites elsewhere it is important to acknowledge that response surface surrogate models need to be custom built for each site utilizing a high fidelity numeric model hence a high fidelity model is important for designing the response surface function i e choice of independent variables and for parameterizing the response surface function based on the results of this paper the authors conclude that a surrogate model works when deposition is 1 spatially homogenous 2 the surrogate model area is greater than the numerical model cell size and 3 confined to a well defined basin region further research would benefit surrogate model research by investigating developing surrogate models for spatially heterogeneous regions such as wetlands using statistical methods to describe the spatial structure of deposition additional research incorporating ecological and flood impacts of changing dredging trigger points would improve the utility of the model consideration of a stylized estuary test case also showed that non uniform filling of the sedimentation basin may emerge as a source of error in the sediment capture efficiency used by reduced dimension surrogate model nevertheless the accuracy of seamless was found to be comparable to the high fidelity model for timescales up to several decades credit authorship contribution statement matthew w brand conceptualization methodology software writing original draft writing review editing leicheng guo methodology software validation writing original draft writing review editing eric d stein project administration writing original draft writing review editing brett f sanders conceptualization project administration supervision writing original draft writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is part of the resilient infrastructure and sustainable environments with sediment sedrise project funded by an award na16nos4780206 from the ecological effects of sea level rise program of the national oceanic and atmospheric administration noaa whose support is gratefully acknowledged we also acknowledge financial support by the graduate research fellowship program of the national science foundation nsf for m w brand the statements findings conclusions and recommendations are those of the author s and do not necessarily reflect the views of noaa or nsf the authors also acknowledge invaluable input and feedback from the sedrise management and technology advisory group mtag and research team which contributed to the development and application of the seamless model in particular the authors also thank jian peng and jamie habben at the orange county department of public works for their support in acquiring data for newport bay supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j advwatres 2021 103876 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
332,we investigate the impact of sub grid scale horizontal lamination on the migration of the co 2 plume during geologic sequestration a new physics based model that includes the effects of capillary and viscous forces is used to obtain effective flow rate dependent capillary pressure and relative permeability functions for this purpose a macroscopic capillary number is derived that accurately describes the viscous capillary force balance the model is based on the fractional flow approach and is implemented in an extended radial buckley leverett solution this provides an easy way to investigate the impact of mm to m scale laminae on the frontal advance of the plume our work shows that at injection rates and volumes commonly used at geologic sequestration sites capillary number dependency is important during the initial phase of the injection period at later stages the use of a capillary limit solution will be a valid approximation even close to the injection well keywords co 2 sequestration flow rate dependency relative permeability capillary pressure fractional flow approach macroscopic capillary number msc 00 01 99 00 1 introduction geologic carbon sequestration can play an important role in reducing the amount of greenhouse gasses emitted to the atmosphere to ensure the long term security of the injected co 2 a good understanding of the fate of the co 2 plume is needed the migration of the plume is impacted by rock structure heterogeneities at many different length scales ranging from the pore to the field scale jackson and krevor 2020 heterogeneities at the mm cm scale are often present in the form of laminae thin layers of less then 1cm thick the grain size and permeability can vary widely between laminae which is reflected in differences in the capillary pressure curves as a result capillary pressure gradients can exist that can lead to capillary induced flows fig 1 it has been shown both experimentally perrin and benson 2010 shi et al 2011 pini et al 2012 wei et al 2014 zhang et al 2014 reynolds and krevor 2015 jackson et al 2018 and numerically krause et al 2013 kong et al 2015 that the co 2 saturation distribution depends on the balance between the viscous forces as a result of the injection flow rate and the capillary forces due to capillary heterogeneity to incorporate the impact of sub grid scale mm to m laminae into upscaled coarse grid systems effective multi phase flow parameters are defined in such a way that the coarse grid systems and fine grid systems act similarly these upscaled effective parameters or pseudo functions are flow rate dependent due to the dependence of the saturation distribution on the viscous capillary force balance they can be obtained by using dynamic kyte and berry 1975 stone 1991 and steady state upscaling methods smith 2012 saad et al 1995 dale et al 1997 stephen and pickup 1999 virnovsky et al 1999 the dynamic method involves running fine scale two phase flow simulations these simulations are time consuming pickup and stephen 2000 and sometimes lead to unrealistic results barker and thibeau 1997 steady state methods form a more efficient approach and rely on the fact that at the small scale behind and ahead of a displacement front the saturation changes very slowly allowing for steady state conditions to be assumed smith 2012 as for dynamic methods steady state methods require an accurate solution of the multi phase flow equations in the asymptotic cases of the viscous limit vl and capillary limit cl an accurate solution of the multi phase flow equations can be obtained by single phase upscaling methods making this a more efficient approach than the dynamic methods smith 2012 dale et al 1997 ekrann and aasen 2000 virnovsky et al 2004 pickup and sorbie 1994 kumar and jerauld 1996 pickup and carruthers 1996 pickup and sorbie 1996 pickup 1998 lohne et al 2006 however using the steady state vl or cl solution for flow rates within the transition zone between these limits can lead to significant errors pickup and stephen 2000 lohne et al 2006 to determine whether it is valid to use either of the asymptotic solutions several different capillary numbers which give the ratio of viscous to capillary forces exist the most commonly used capillary number is given by c a q μ σ where q is the darcy flux m s μ is the viscosity pa s and σ the interfacial tension n m c a defines the viscous capillary force balance at the pore scale where the length scale is the pore throat but does not take into account the capillary gradients that can exist due to heterogeneities at larger scales to describe the viscous capillary force balance at larger scales a macroscopic capillary number should be used that takes into account the scale and the direction of the heterogeneity this can be derived by applying the theory of scaling groups rapoport 1955 shook et al 1992 using this approach a transverse capillary number for horizontally laminated systems can be found of the form jonoud and jackson 2008 yokoyama and lake 1981 zhou et al 1997 1 n c t q h 2 d l where d s w is the capillary diffusion term defined as 2 d s w k κ r n w κ r w μ n w κ r w μ w κ r n w d p c d s w here l and h are length scales m in the principal along lamina and transverse across lamina directions respectively k is the absolute permeability m 2 in the transverse direction κ r the phase relative permeability in the transverse direction μ is the phase viscosity pa s and p c is a characteristic capillary pressure pa the subscripts n w and w indicate the non wetting and the wetting phase respectively if n c t 1 the vl is reached while if n c t 1 the cl is reached an equivalent macroscopic capillary number presented by virnovsky et al 2004 is given by 3 n c v i r n o v s k y h δ p l δ p c f w where δ p is the viscous pressure drop pa along length l and δ p c f w is the difference between the capillary pressure curves of the different layers at the same fractional flow if n c v i r n o v s k y 0 1 the cl is reached the transition from cl to vl occurs close to n c v i r n o v s k y 1 and if n c v i r n o v s k y 10 the vl is reached for both the cl and vl single phase steady state upscaling methods can be used to derive upscaled effective multi phase flow parameters to generate effective parameters for the capillary numbers that fall in the transition regime between these limits the time dependent two phase flow equations need to be solved until steady state is reached which is very computer intensive more efficient approaches based on iterative algorithms to calculate rate dependent effective parameters have been presented by kumar and jerauld 1996 virnovsky et al 2004 the recent study of benham et al 2020 combined asymptotic analysis and numerical simulations to suggest a composite heuristic form for effective relative permeabilities for horizontally layered systems that remains accurate across all flow regimes furthermore they illustrate how the capillary number n c v i r n o v s k y at the flooding front changes over time at early times near the source the front is in the vl regime whereas later on far away from the source it is in the cl regime the recent extensive numerical study on the impact of small scale heterogeneity on field scale plume migration of jackson and krevor 2020 analyzed the impact of layers and numerical steady state upscaling at the cl vl of such systems in detail they showed that capillary equilibrium is generally established within several meters of a co 2 injection well in this paper we derive a new macroscopic capillary number that more accurately describes the capillary viscous force balance in horizontally laminated systems we use this new capillary number to obtain upscaled effective saturation functions including relative permeability capillary pressure and fractional flow over the full range of velocities analytically this new method is based on the fractional flow approach and the obtained flow rate dependent saturation functions can therefore straightforwardly be implemented into an extended buckley leverett analytical solution to predict how small scale lamination effects the frontal advance of the co 2 plume the paper is structured as follows first the physics of the system and the governing equations at the local scale are discussed in sections 2 and 3 next it is shown how upscaled saturation functions in the cl and vl can be derived as a function of fractional flow section 4 1 these asymptotic solutions can be used to obtain the upscaled saturation functions in the transition regime using a newly derived macroscopic capillary number r v c which is discussed in section 4 2 an approximate form of r v c is presented in section 4 3 which can be used to incorporate the observed flow rate dependency into a numerical simulator in section 5 we demonstrate how these flow rate dependent saturation functions can be implemented into an extended buckley leverett analytical solution to investigate the large scale impact of mm m scale layered heterogeneity we validate our approach by deriving effective relative permeability and capillary pressure for a range of laminated systems comprising different aspect ratios a ratio l h permeability ratios and saturation functions and comparing the results with numerical simulations finally the obtained flow rate dependent saturation functions are used in an extended buckley leverett solution to investigate the impact of mm m scale horizontal lamination on co 2 plume migration 2 steady state upscaling in horizontally laminated rock small scale horizontal laminae that are below the grid cell resolution can have a big impact on the migration of the co 2 plume to incorporate the impact of sub grid scale mm to m horizontal lamination into coarse grid systems upscaled effective multi phase flow parameters can be used in this work we present a model based on a steady state upscaling approach to derive these upscaled effective parameters the sub grid scale system that is considered consists of alternating high and low permeability rocktypes parallel to the flow direction as can be seen in figure 1 at the inlet boundary co 2 and water are injected in each of the layers at the same fractional flow until steady state is reached this is a valid boundary condition for high flow rates near the vl for low flow rates near the cl this boundary condition will not strictly be true as the higher entry pressure of the low permeable layer could result in higher water fractional flows in this layer however since capillary equilibrium is reached after a short distance from the inlet this assumption will not significantly impact the upscaled parameters the system is water wet and each rocktype has its own capillary pressure saturation relationship as a result gradients in capillary pressure exist perpendicular to the flow direction this leads to capillary induced crossflow between the layers with water imbibing into the low permeable layers and co 2 flowing into the high permeable layers this will change the fractional flow in the layer and inherently its saturation with distance the distance it takes to even out these capillary gradients depends on the ratio of the viscous to capillary forces boon et al 2018 at steady state three different regions can be defined a region at the inlet where the saturation distribution corresponds to the vl a transition region where the crossflow of water and co 2 even out the capillary gradient and a third region where capillary equilibrium is reached among other factors the length of the transition regime is a function of the injection rate ekrann and aasen 2000 for low flow rates capillary forces dominate and it only takes a short distance before the capillary forces even out the capillary gradient if this distance is much smaller than the lateral extent of the lamina the cl solution can be used for very high flow rates viscous forces dominate and it takes a very long distance before the capillary gradient evens out if the lateral extent of the lamina is much shorter than the length of the transition region the capillary flux can be neglected and the vl solution can be used for intermediate flow rates the length of the transition regime is of the same order as the lateral extent of the lamina in these cases the use of the vl or cl saturation distribution can lead to large errors the lateral extent of laminae in reservoir rocks is typically at least one order of magnitude larger than the thickness of the layer and depends on the depositional conditions in high energy systems like shallow marine fluvial and aeolian depositional environments the lamina extends over much shorter distances than in for example quiet lakes and deep ocean basins ringrose et al 1993 high porosity clastic sediments which can often be found in suitable geologic sequestration sites are most commonly deposited under high energy conditions and likely possess laminae of limited lateral extent it is therefore possible that even for low flow rates the cl steady state solution might not be valid in this paper a simple model is presented to derive upscaled effective saturation functions for the full velocity range which can be implemented into an extended buckley leverett analytical solution to predict the larger scale impacts of these small scale heterogeneities 3 governing equations at the local scale we consider the immiscible displacement of water by co 2 in an incompressible 2 d system the system contains layers of two alternating rocktypes parallel to the flow direction at the mm m scale fig 1 at this small scale capillary forces are important but gravity effects are negligible and are therefore not taken into account at the local scale at steady state the mass balance equation for each phase may be written as 4 q α 0 here q m s is the darcy flux given by 5 q α k κ r α μ α p α where α indicates phase which can either be water or co 2 k is the intrinsic permeability m 2 κ r α is the phase relative permeability μ α is the phase viscosity pa s and p α is the phase pressure pa the intrinsic permeability and the phase relative permeability are assumed to be isotropic at the local scale since the system solely consists of two phases the sum of the individual phase saturation is one 6 s w s c o 2 1 the saturation is a function of the capillary pressure 7 s α s α p c which is defined as 8 p c p c o 2 p w and the relative permeability is a function of the phase saturation 9 κ r α κ r α s α the total flux q t is the sum of two individual phase fluxes 10 q t k κ r w μ w p w k κ r c o 2 μ c o 2 p c o 2 using the expression for capillary pressure eq 8 to relate the pressure in the co 2 phase to the pressure in the water phase the total flux can be expressed as a function of one of the individual phase pressures and the capillary pressure 11 q t k κ r c o 2 μ c o 2 k κ r w μ w p w k κ r c o 2 μ c o 2 d p c d s w s w 12 q t k κ r w μ w k κ r c o 2 μ c o 2 p c o 2 k κ r w μ w d p c d s w s w these equations can be rearranged to write the water and co 2 flux as a function of the total flux 13 k κ r w μ w k κ r c o 2 μ c o 2 k κ r w μ w q t k κ r w μ w k κ r c o 2 μ c o 2 k κ r w μ w k κ r c o 2 μ c o 2 d p c d s w s w k κ r w μ w p w 14 k κ r c o 2 μ c o 2 k κ r w μ w k κ r c o 2 μ c o 2 q t k κ c o 2 μ c o 2 k κ r w μ w k κ r c o 2 μ c o 2 k κ r w μ w d p c d s w s w k κ r c o 2 μ c o 2 p c o 2 the above equations show that the flux of each phase consists of a viscous component and capillary component the second term in eq 13 describes the flux of water as a result of capillary forces and is the same as the capillary diffusion term in equation 2 the flux of co 2 due to the capillary forces is given by the second term of equation 14 in certain cases the capillary forces can be neglected and the fractional flow of water and co 2 are given by respectively 15 f w q w q t k κ r w μ w k κ r c o 2 μ c o 2 k κ r w μ w 16 f c o 2 q c o 2 q t k κ r c o 2 μ c o 2 k κ r c o 2 μ c o 2 k κ r w μ w 4 upscaled saturation functions as a function of fractional flow 4 1 upscaled saturation functions in the vl and cl the analytical derivation of upscaled saturation functions in the vl and cl for horizontally layered systems at steady state has been discussed previously corey and rathjens 1956 odsæter et al 2015 rabinovich et al 2016 here a similar approach is used with the important difference that the upscaled saturation functions will be a function of fractional flow not only for the vl corey and rathjens 1956 odsæter et al 2015 rabinovich et al 2016 but also for the cl in the vl the fractional flow of water is constant along streamlines ekrann and aasen 2000 for the system of figure 1 this means that each layer holds the same fractional flow of water and the steady state saturation in each layer at a particular fractional flow of water can be obtained from the fractional flow curve of each individual rocktype eq 15 in the cl the capillary pressure is constant throughout the system and each layers steady state saturation at a particular capillary pressure can be obtained from the capillary pressure saturation relationship of the corresponding rocktype the steady state saturation in the low and high permeable layer can be used to find each layers relative permeability and capillary pressure the upscaled values are found by taking the weighted arithmetic mean 17 κ r α a v e x i 1 n k κ r α i i 1 n k i 18 p c u p i 1 n θ p c i i 1 n θ i where n corresponds to the amount of layers present in the system i is the layer number and θ is porosity the upscaled saturation is given by 19 s w up i 1 n θ s w i i 1 n θ i in the vl the vertical capillary forces are much smaller than the horizontal viscous forces while in the cl it only takes a very short distance before the capillary forces even out the capillary gradient between the layers therefore for both the vl and cl the capillary term of equation 13 and 14 can be neglected and the upscaled fractional flow of water for this layered system can be described with 20 f w u p q w q t i 1 n k κ r w μ w d p d x i i 1 n k κ r w μ w d p d x k κ r c o 2 μ c o 2 d p d x i i 1 n k κ r w μ w i i 1 n k κ r w μ w k κ r c o 2 μ c o 2 i since the pressure gradients in the vertical direction can be neglected the horizontal pressure gradients can be assumed to be the same in each layer and cancel out once the steady state saturation in each layer is known the upscaled fractional flow curves can be calculated for both the vl and the cl figure 2 shows the upscaled fractional flow curves and corresponding effective relative permeability and effective capillary pressure curves for the vl red color and cl blue color for a horizontally layered rock with k h i g h 19 8md and k l o w 0 198md table 1 system 4 the saturation in each layer is indicated in figure 2a by the dashed and dash dot lines for the high permeable layer and low permeable layer respectively the stars in figure 2b c indicate the upscaled relative permeability and capillary pressure for nine different fractional flows ranging from f w 0 01 to 0 9 for both the vl and cl 4 2 upscaled saturation functions in the transition regime in between the vl and cl there is a transition regime where the capillary pressure gradient cannot be neglected in this transition regime both the fractional flow and the capillary pressure vary between layers to find the upscaled saturation functions in this transition regime a capillary number scaling is used to observe how the saturation changes from the cl towards the vl numerical simulations section 6 were run for nine different injection fractional flows and 17 injection flow rates ranging from the cl to almost the vl for two different layered systems one with an average permeability of 400md and one with an average permeability of 10md system 2 and 4 in table 1 fig 3 shows the normalized co 2 saturation s c o 2 of the low permeable layer which is defined as 21 s c o 2 f w s c o 2 f w s c o 2 c l f w s c o 2 v l f w s c o 2 c l f w for each of the fractional flows and flow rates as a function of the two capillary numbers n c t and n c v i r n o v s k y eq 1 and 3 details on how these numbers were calculated can be found in appendix a a s c o 2 of zero means that the system is in the cl while a s c o 2 of 1 means that the system is in the vl to correctly capture the scaling between the cl and vl the location of s c o 2 0 5 should be around a capillary number of 1 this is not the case for both of the traditional capillary numbers fig 3 a b and the location of s c o 2 0 5 changes with fractional flow and for different systems therefore a new macroscopic capillary number needs to be derived that more accurately describes the viscous capillary force balance for horizontally layered systems to derive this new capillary number the assumption is made that the viscous flux q v i s and capillary flux q c a p can be considered separately with q v i s acting in the principal direction over a length scale l and q c a p in the transverse direction over a length scale h fig 4 the capillary number r v c is defined as the ratio of the time it takes to travel h as a result of the capillary flux over the time it takes to travel l by the viscous flux 22 r v c h l q v i s q c a p at the local scale the first and second term of equations 13 and 14 can be substituted for q v i s and q c a p respectively for the water phase this results in 23 r v c w a t e r h l q t k κ r c o 2 μ c o 2 d p c d z and for the co 2 phase this results in 24 r v c c o 2 h l q t k κ r w μ w d p c d z these local capillary numbers are used to describe the viscous capillary force balance in our system in the case of perfect counter current flow the co 2 and water capillary flux will be equal only in this case the viscous capillary force balance will be the same for both phases and can be described by either of the capillary numbers eq 23 and 24 however in reality there will be a combination of counter and co current flow and the viscous capillary force balance will be different for each phase the saturation in each layer depends on the fractional flow in that layer the fractional flow in the low permeable layer changes as a result of the outward capillary flux of co 2 and the inward capillary flux of water and oppositely for the high permeable layer therefore a correct description of the viscous capillary force balance of our system should take the capillary flux of both phases into account this can be done by taking the average between the capillary flux of the water phase and the capillary flux of the co 2 phase 25 r v c h l 2 q t k κ r w μ w d p c d z k κ r c o 2 μ c o 2 d p c d z the time it takes to travel l by the viscous flux will be different for each layer if we look at the system as a whole then the distance it takes to even out the capillary gradients will be determined by the slowest flowing layer which is the low permeable layer therefore for q t in equation 25 q t l o w will be substituted which is the total flux in the low permeable layer q t l o w can be calculated by dividing the total flow rate over the different layers according to the total mobility in each layer which is defined as 26 λ t i k i κ r w a v e i μ w k i κ r c o 2 a v e i μ c o 2 here the phase relative permeabilities are approximated for each fractional flow by using the average value over the range of water saturation between the vl and the cl for the high permeable layer this is calculated as 27 κ r α av e h s w ca p h s w vh κ r α s w ds s w vh s w ca p h and for the low permeable layer as 28 κ r α av e l s w vl s w ca p l κ r α s w ds s w ca p l s w vl to describe the capillary flux for each of the phases we need to take a closer look at the system for each rocktype the saturation and capillary pressure for each fractional flow in both the vl and cl are known section 4 1 to ensure continuity of pressure at the boundary between each of the layers capillary equilibrium is assumed at each of the boundaries at all times this assumption requires the use of vangenuchten type of capillary pressure curves where p c 0 at s w 1 such that the capillary pressure curves of different rock types will always have an overlapping range and hence p c continuity furthermore it is assumed that in the vl the saturation and capillary pressure along the center line of each layer are at the vl fig 4 in this way the system can be divided into different crossflow regions indicated by the dashed lines in figure 4 where both water and co 2 are flowing in a counter current nature water is flowing into the low permeable layer while at the same time co 2 is flowing into the high permeable layer the capillary flux is dependent on the saturation distribution which is dynamic to approximate an average d p c d z term for a particular f w the average capillary pressure drop between the centers of the low and high permeable layer is calculated and divided by the thickness of the layer 29 d p c f w d z p c v h f w p c c a p f w θ h p c c a p f w p c v l f w θ l θ h θ l h where p c v h is the capillary pressure in the vl in the high permeable layer p c v l is the capillary pressure in the vl in the low permeability layer and p c c a p is the capillary pressure in the cl the phase relative permeabilities in each of the layers is given by equations 27 and 28 the upscaled relative permeability and absolute permeability are approximated for each crossflow region by taking the weighted harmonic mean substituting the above into equation 22 leads to 30 r v c q t f w h l 2 q t l o w k a v e z κ r w a v e z μ w d p c f w d z k a v e z κ r c o 2 a v e z μ c o 2 d p c f w d z equation 30 is a new capillary number that describes the viscous capillary force balance in horizontally layered systems as function of flow rate and fractional flow figure 3c shows the normalized co 2 saturation s c o 2 of the low permeable layer for each of the fractional flows and flow rates as a function of r v c the transition from the cl to the vl indicated by the location of s c o 2 0 5 is around a capillary number of 1 for all fractional flows and for both systems this shows that r v c correctly captures the viscous capillary force balance and can be used to find the saturation in each of the layers in the transition regime for this purpose a logistic function is fitted towards the data presented in figure 3c which is indicated by the black line and given by 31 s c o 2 1 1 1 r v c f w q t 0 8 the saturation in the high permeable layers is scaled in the same way however the saturation change in the high permeable layer between the two limits is very small and often negligible and is therefore not shown for each combination of fractional flow and flow rate the saturation in each layer can be obtained using equation 31 the corresponding multi phase flow parameters can be calculated using the saturation functions of the particular layer the upscaled parameters can be found using equations 17 18 19 with this model flow rate dependent effective fractional flow curves flow rate dependent effective relative permeability curves and flow rate dependent effective capillary pressure curves can be constructed in addition equation 31 can be used to define when the asymptotic solutions can be applied by setting the cl to a s c o 2 0 05 and the vl to s c o 2 0 95 we find that if r v c 0 025 the cl is reached and if r v c 40 the vl is reached 4 3 implementation into a numerical simulator it is not straightforward to implement equation 30 into a numerical scheme however an approximate capillary number can be found based on the average pressure gradient which will be much easier to implement for this the expression for total flux given by equation 10 is used in equation 30 32 r v c h l 2 λ t l λ t a v e z d p d l d p c d z where 33 λ t l k l κ r w a v e l μ w k l κ r c o 2 a v e l μ c o 2 and 34 λ t a v e z k a v e z κ r w a v e z μ w k a v e z κ r c o 2 a v e z μ c o 2 by plotting λ r a t i o λ t l λ t a v e z as a function of fractional flow for each of the systems considered fig 5 it can be seen that this ratio is around 0 5 r v c can therefore be estimated by 35 r v c a p p x h l d p f w d l d p c f w d z equation 35 has the same form as n c v i r n o v s k y eq 3 however the capillary pressure gradient is calculated using equation 29 and is a function of saturation and fractional flow figure 3d shows the normalized co 2 saturation s c o 2 of the low permeable layer for each of the fractional flows and flow rates as a function of r v c a p p x here d p f w d l is calculated by using the upscaled absolute permeability in the principal direction and upscaled relative permeability in the principal direction as a function of fractional flow appendix a it can be seen that both r v c and r v c a p p x correctly capture the viscous capillary force balance r v c a p p x can be used in combination with equation 31 to incorporate the impact of mm m scale horizontal lamination into larger scale reservoir models as long as the grid cell size of the model is sufficiently small such that at the scale of the grid cell gravity effects can be neglected appendix c 5 extended buckley leverett solution most commercial reservoir simulators do not have the capability to incorporate flow rate dependent saturation functions this makes it difficult to analyze the effect of small scale heterogeneities on large scale co 2 plume migration however an extended buckley leverett analytical solution exists where the fractional flow function depends both on the saturation and the radial distance from the well mijic and laforce 2012 rossen et al 2011 which can be used for this purpose in our case the radial dependency arises due to the decreasing flow rate with distance away from the well and the flow rate dependent fractional flow functions section 4 2 can straightforwardly be implemented it should be emphasized that the bl solution is a highly simplified representation of a reservoir and that gravity effects are not taken into account nevertheless the bl solution can help to get a better understanding of the impact of small scale heterogeneity on large scale co 2 plume migration by providing new insights of the physics that takes place in the following the main steps in deriving this extended bl solution are mentioned more details can be found in mijic and laforce 2012 rossen et al 2011 the radial convection equation for co 2 injected into a water saturated reservoir can be written as 36 s c o 2 t q π h θ f c o 2 r 2 0 here s c o 2 is co 2 phase saturation t is time s q is injection flow rate m 3 s h is reservoir thickness m θ is reservoir porosity f c o 2 is fractional flow of co 2 which is a function of both saturation and radial distance and r is radial distance from the well m a constant flux along the entire thickness of the reservoir is assumed the number of variables in equation 36 can be reduced by applying the following transformations in space and time 37 r d r 2 r e 2 38 t d q t π r e 2 h θ where r e is radial extent m of the reservoir resulting in 39 s c o 2 t d f c o 2 r d 0 because f c o 2 depends both on s c o 2 and r d 40 f c o 2 r d f c o 2 s c o 2 r d s c o 2 r d f c o 2 r d s c o 2 substituting equation 40 into equation 39 leads to 41 s c o 2 t d f c o 2 s c o 2 r d s c o 2 r d f c o 2 r d s c o 2 equation 41 is a non homogeneous quasi linear partial differential equation where the characteristics move with a velocity 42 d r d d t d f c o 2 s c o 2 r d the co 2 saturation profile for each time after injection has started can be obtained by integrating equation 42 using a fixed value of flux and the flow rate dependent fractional flow functions corresponding to r d the obtained solution will contain multiple co 2 saturation values at the same location within the reservoir which is physically impossible to find a unique solution the multi valued parts are removed by inserting a shock front in a similar way as done for the 1 d buckley leverett solution the location of the shock front r d f can be determined by integrating the saturation profile using the equal area rule 43 r d f 1 s c o 2 f 0 s c o 2 f r d d s c o 2 the above described extended buckley leverett solution can be used to get a better understanding of the impact of small scale heterogeneity on the sweep efficiency saturation distribution and frontal advance of the plume 6 numerical simulations to verify the validity of our physics based model the results are compared with numerical simulations we simulate the injection of co 2 into several layered reservoirs initially fully saturated with water for a range of fractional flows and flow rates the rock properties of the different systems are given in table 1 the simulations are carried out using the reservoir simulator eclipse schlumberger geoquest the simulation model consists of nine alternating high and low permeable layers this way both the bottom and the top layer of the model are of high permeability ensuring symmetry in the crossflow fluxes the dimensions of the model are 1 91m in the lateral direction and 0 15m thick the number of grid cells in the model are nx 120 ny 90 and nz 1 corresponding to a grid cell size of 0 0160m by 0 00167m by 0 005m a column of grid blocks containing a very high permeability 100 000md and porosity 100 is chosen for the injection wells ensuring a uniform flux across the inlet boundary jonoud and jackson 2008 ekrann and aasen 2000 the inlet of the model consist of constant flow boundary while the outlet consists of constant pressure boundary no flow boundaries exist at the top and bottom a buffer zone of 30 grid cells is created at the inlet to assure that the flow fully develops before it enters the layers the simulations are run for each fractional flow until steady state is reached at steady state the upscaled capillary pressure and upscaled saturation are calculated using equations 18 and 19 respectively the upscaled relative permeability is calculated using the phase pressure gradient in equation 5 krause and benson 2015 7 results 7 1 flow rate dependent effective saturation functions flow rate dependent effective saturation functions were derived for six different horizontally layered systems using the physics based model presented in section 4 and compared with numerical simulations using the eclipse reservoir simulator section 6 each system consists of alternating high and low permeable layers with individual properties that can be found in table 1 the layers are 0 0167m thick and have a lateral extent of 0 167m and 1 28m corresponding to aspect ratios a ratio of 10 and 77 the capillary pressure saturation relationship is described by the vangenuchten hybrid mualem corey model which is defined as 44 p c p e s w 1 m 1 1 m 45 κ r w s w 0 5 1 1 s w 1 m m 2 46 κ r n w 1 s w 2 1 s w 2 47 s w s w s w i r r 1 s w i r r here p e is the capillary entry pressure pa m is the vangenuchten exponent s w is the effective water saturation and s w i r r the irreducible water saturation the saturation functions for each of the rocktypes used can be seen in figure 6 the water and co 2 viscosity are chosen as 5 5e 04 pa s and 2 3e 05 pa s respectively which corresponds to reservoir conditions 50 c and 8963 kpa figures 7 and 9 show the upscaled effective relative permeability of the systems with an average absolute permeability of 400md and 10md respectively for two permeability ratios kratio 10 and 100 and for two different aspect ratios aratio 10 and 77 results are plotted for four different darcy velocities ranging between the cl and vl the corresponding upscaled effective capillary pressure curves can be seen in figures 8 and 10 the triangles are the results from the numerical simulations while the circles connected with a line are the result from our physics based model both the numerical simulations and the physics based model show that for horizontally layered systems the relative permeability of the co 2 phase increases when the systems transition from the vl to the cl while the relative permeability of the water phase decreases the new model is able to correctly capture the transition from the vl to the cl limit which occurs at higher velocities with increasing aspect ratio and increasing permeability ratio 7 2 extended buckley leverett solution the fractional flow functions for all four systems with a ratio 10 are used in the bl model to look at the impact of small scale lamination on co 2 plume migration for this 1261440m 3 of co 2 is injected into a radial reservoir of 20m thickness for three different injection rates a realistic rate of 0 04m3 s kaven et al 2014 furre et al 2017 and two unrealistically high rates of 0 4m3 s and 4m3 s which will help to understand the impact of flow rate dependency the above injection rates correspond to an injection time of 365 days 36 5 days and 3 65 days respectively the results can be seen in figure 11 the graphs on the left show the effective co 2 fractional flow curves for a range of velocities between the vl and cl and the graphs in the middle show the corresponding derivative f c o 2 s c o 2 each velocity corresponds to a different radial distance from the injection well the derivatives are used in equation 42 to obtain the co 2 saturation profile after 1261440m 3 of co 2 has been injected into the reservoir the graphs on the right show the co 2 saturation profiles using the vl fractional flow function the cl fractional flow function and the flow rate dependent fractional flow functions for the three injection rates to validate the use of the bl solution the vl and cl results for system 1 are compared with numerical results obtained with the reservoir simulator eclipse schlumberger geoquest using a fine grid with dr 0 25m the results are indicated by the red and blue dashed lines in figure 11 top right for both the vl and cl a good match is observed between the analytical solution and the numerical simulations however some dispersion is present at the front in the case of the numerical simulations it can be seen that the plume travels further for systems 3 and 4 compared to systems 1 and 2 due to the low porosity of the former systems the plume also travels further when the cl functions are used compared to the vl functions furthermore it shows that the saturation profiles using the flow rate dependent fractional flow functions for an injection rate of 0 04m 3 s overlap with the cl solution for all systems for the injection rate of 0 4m 3 s only system 4 with a permeability of 10md and a permeability ratio of 10 shows the impact of flow rate dependency and the frontal advance of the plume is slightly less then in the cl the same behavior is seen for all systems when the very high injection rate of 4m 3 s is used although it is most pronounced in the systems with a permeability ratio of 10 to get a better understanding of the dynamic behavior the r v c is plotted versus radial distance together with the corresponding fractional flow of co 2 as a function of of volume injected for systems 1 and 3 in figure 12 it can be seen that the f c o 2 at each radial distance increases when more volume is injected i e increases with time consequently the corresponding r v c is decreasing as a result system 1 transitions into the cl after 0 6 of the total volume is injected at an injection rate of 0 04m 3 s this corresponds to 2 2 days of injection and a frontal advance of 40m for the higher injection rate of 0 4m 3 s the transition towards the cl happens after 70 of the total volume is injected corresponding to an injection time of 25 6 days and frontal advance of 580m for the unrealistically high injection rate of 4m 3 s the system stays within the transition regime during the entire injection period although the r v c is decreasing for system 3 the transition into the cl for the lowest injection rate 0 04m 3 s happens after 7 8 of the total volume is injected corresponding to 28 5 days and a frontal advance of 280m which is later compared to system 1 for the higher injection rates 0 4m 3 s 4m 3 s r v c is decreasing with time but the systems stay within the transition regime during the entire injection period furthermore from figure 12 it can be seen that the rvc stays fairly constant throughout the entire plume for each particular time however an increase can be observed close to the well and a gradual decrease is present further away from the well 8 discussion the new capillary number to describe the viscous capillary force balance in horizontally layered systems r v c much better captures the transition from the cl to the vl compared to the previously used n c t eq 1 and n c v i r n o v s k y eq 3 n c t only takes into account the transverse capillary flux of the water phase furthermore the saturation dependency of the capillary flux is not taken into account the transverse capillary flux of water can only describe the systems capillary flux correctly in the case of perfect counter current flow where the transverse flux of water is equal to the transverse flux of co 2 this is often not the case especially for very high and very low fractional flows of co 2 n c v i r n o v s k y does take both the water and co 2 capillary flux into account however similar to n c t the saturation dependency of the capillary flux is not taken into account as a result the location of the transition from the cl to the vl indicated by s c o 2 0 5 changes with fractional flow and for different systems fig 3a b this also becomes clear when comparing the capillary numbers observed in other works benham et al 2020 jackson and krevor 2020 virnovsky et al 2004 by taking into account both the water and co 2 capillary flux and by calculating κ r α and the gradient in p c as a function of fractional flow we have derived a general form of the transverse capillary number r v c eq 30 that is able to correctly describe the viscous capillary force balance for all cases for all systems and fractional flows the transition from the cl to vl defined as the location where s c o 2 0 5 occurs at rvc 1 and follows the same scaling given by equation 31 we can use this scaling to define when the asymptotic solutions can be used by setting the cl to a s c o 2 0 05 and the vl to s c o 2 0 95 we find that if r v c 0 025 the cl is reached and if r v c 40 the vl is reached by using the simple r v c scaling of the saturation given by equation 31 flow rate dependent saturation functions were derived for four systems table 1 for two different aspect ratios as a function of flow rate and fractional flow for all cases our physics based model was able to capture the same behavior as observed in the numerical simulations fig 7 8 9 10 the model requires the use of vangenuchten type of saturation functions where p c 0 at s w 1 such that the capillary pressure curves of different rock types will always have an overlapping range and hence p c continuity for brooks corey type of functions p c p e at s w 1 as a result p c discontinuity at the boundary between the layers arises when the p c falls below the entry pressure of the low permeable layer in such cases the low permeable layer becomes fully saturated with water which leads to a kink in the upscaled capillary pressure and relative permeability curves appendix b this makes the scaling between the cl and the vl in the case of brooks corey type of functions not straightforward however numerical simulations show that using the upscaled brooks corey saturation functions instead of the upscaled vangenuchten saturation functions does not have a significant effect on the lateral extent of the plume appendix b this can be explained by the fact that in the case of high permeability ratios even when vangenuchten type of functions are used the water saturation in the low permeable layer is close to 1 as can be seen in figure 2a and the flow of co 2 is almost entirely through the high permeable layer the good agreement of our physics based model and the numerical simulation results allowed us to implement the model into an extended buckley leverett solution to look at the impact of sub grid scale horizontally layered heterogeneity on the migration of co 2 in larger scale radial systems as stated previously the bl solution is a highly simplified representation of a reservoir and gravity effects are not taken into account the solution can therefore not be used to accurately predict the migration of the plume but does provide new insights of how small scale heterogeneity can impact large scale plume migration to predict the migration of a co 2 plume at real storage sites requires the use of 3 d full physics reservoir models equation 31 can be used in combination with the r v c a p p x to incorporate the impact of mm m scale horizontal lamination in such models as long as the grid cell size of the reservoir model is sufficiently small such that at the scale of the grid cell gravity effects can be neglected the exact scale up to which gravity effects can be neglected depends on the system but will be on the order of meters appendix c in radial buckley leverett systems the local r v c is a function of two competing factors the fractional flow and flow rate typically near the injection well you have very high velocities and very high fractional flows of co 2 while both decrease with radial distance away from the well a decrease in fractional flow of co 2 moves the system towards the vl while a decrease in the flow rate moves the system towards the cl the counterbalance between those two factors determines when and where the vl to cl transition occurs as a result the r v c stays relatively constant with distance at a particular time fig 12 interestingly however changes in the r v c are not monotonic close to the well an increase in r v c is observed because at high fractional flows of co 2 a small decrease in fractional flow of co 2 result in a relatively large decrease in relative permeability further away from the well the r v c decreases gradually as a result of decreasing flow rate the fractional flow of co 2 at each radial distance increases when more volume is injected which makes the r v c a dynamic variable an increase in the co 2 fractional flow leads to an increase in the capillary flux and therefore a decrease in the r v c as a result the system moves towards the cl with time fig 12 in the vl the viscous pressure gradients are overwhelmingly large and the capillary flux becomes extremely small compared to the viscous flux and can therefore be neglected therefore in the true vl p c is not necessary for upscaling and using p c 0 and the vl κ r α curves will lead to the same results however figures 7 8 9 10 show that unrealistically high velocities are needed to move the system into the vl indicating that the vl solution should not be used to model the migration of the co 2 plume in case of horizontally layered systems whether the cl solution is valid depends on the velocity at which the system transitions into the cl if this transition velocity is higher then the velocities observed in the reservoir the cl solution can be used otherwise the incorporation of flow rate dependency will become important r v c tells us that this transition happens at relatively low flow velocities for systems with a low average capillary flux and a low aspect ratio we therefore used the saturation functions of a ratio 10 in the extended bl model the graphs on the left in figure 11 show the effective fractional flow curves for flow rates between the cl and vl here we can see that the transition from the cl to vl happens at lower velocities when the absolute permeability in the transverse direction are low and for low permeability ratios which are two factors that result in a low average capillary flux due to the capillary flux of co 2 into the high permeable layer the relative permeability of the co 2 phase increases when the systems transitions from the vl to the cl while the capillary flux of water into the low permeable layer reduces the relative permeability of the water phase as a result the plume travels further when the system moves towards the cl this can clearly be seen from the graphs on the right in figure 11 which show the saturation profiles after 1261440m 3 of co 2 is injected using the vl solution the cl solution and the capillary number dependent solution for three different injection rates for the realistic injection rate of 0 04m 3 s the cl and the flow rate dependent saturation profiles overlap for all cases considered because each entire system from close to the well all the way to the front of the plume transitions into the cl for system 1 and 3 this happens after 0 6 and 7 8 of the total volume is injected respectively fig 12 left for the very high injection rate of 0 4 m 3 s flow rate dependency is only observed for system 3 with a low absolute permeability in the transverse direction and the low permeability ratio due to the low capillary flux of this system the system remains in the transition regime during the entire injection period fig 12 for the unrealistically high injection rate of 4m 3 s all of the systems considered remain in the transition regime during the entire injection period as can be seen for systems 1 and 3 in figure 12 this work shows that in horizontally layered radial systems at commonly used injection rates and volumes flow rate dependency is only important during the initial phase of the injection period on the order of days to months if the objective is the prediction of the lateral extent of the plume at the end of the injection period it will be valid to use the cl saturation functions even close to the injection well our observations are very similar to those obtained in the extensive numerical study on the impact of small scale heterogeneity on fieldscale plume migration presented by jackson and krevor 2020 they show that most of the system can be effectively modeled at the cl apart from close to the wellbore realistic reservoirs will consist of many different types of heterogeneity and structures including layers perpendicular to the flow direction in such cases the system is pushed out of capillary equilibrium at each boundary this results in capillary number dependency at much lower flow rates the focus of our future work will be applying a similar fractional flow approach to vertically layered systems 9 conclusion a new physics based model has been developed that can obtain effective flow rate dependent relative permeability and capillary pressure functions in horizontally layered systems over the full velocity range analytically for this purpose a new capillary number r v c has been derived that correctly captures the viscous capillary force balance for horizontally layered systems by incorporating both the water and co 2 capillary flux as a function of saturation this new capillary number can accurately determine when it is valid to use either of the asymptotic solutions if r v c 0 025 the cl is reached and if r v c 40 the vl is reached the model is based on the fractional flow approach and the obtained effective flow rate dependent fractional flow functions can be implemented into an extended radial buckley leverett solution to look at the impact of mm m scale heterogeneity on the frontal advance of the co 2 plume the local r v c in the case of radial buckley leverett systems is a function of two competing factors the fractional flow of co 2 and flow rate both factors decrease with radial distance and the fractional flow of co 2 increases with time a decrease in the fractional flow of co 2 moves the system towards the vl while a decrease in flow rate moves the system towards the cl the counterbalance between those two factors determines together with the absolute permeability the permeability ratio and aspect ratio of the layers when and where the vl to cl transition occurs when the system transitions from the vl to the cl the relative permeability of the co 2 phase increases while the relative permeability of the water phase decreases as a result the co 2 plume travels further when the system moves towards the cl our work shows that for injection rates and volumes commonly used at injection sites the cl is reached quickly suggesting that flow rate dependency is only important during the initial phase of the injection period if the objective is the prediction of the lateral extent of the plume at the end of the injection period the use of cl saturation functions will be valid even close to the injection well the theory presented here is very general and can be applied to a wide variety of systems with different interfacial tensions and mobility ratios one could expect very different behaviors for each of these systems this will be investigated in future work credit authorship contribution statement maartje boon methodology writing original draft visualization sally m benson conceptualization writing review editing supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this study is a contribution to geocquest a bhp supported collaborative project of the university of melbourne australia the university of cambridge uk and stanford university usa aimed at developing a better understanding of small scale heterogeneity and its influence on co2 migration and trapping mechanisms the authors would like to thank bhp for providing project funding appendix a macroscopic capillary numbers n c t and n c v i r n o v s k y for the sake of comparison the normalized co 2 saturation eq 21 is plotted as a function of the previously used macroscopic capillary numbers n c t and n c v i r n o v s k y eq 1 and 3 in figure 3a and b respectively to obtain n c t a characteristic capillary pressure p c is calculated for each layer defined as zhou et al 1997 48 p c s w i r r 1 p c s w d s 1 s w i r r and characteristic relative permeabilities are calculated for each layer as 49 κ r α s w i r r 1 κ r α s w d s 1 s w i r r the average relative permeability in the transverse direction κ r α a v e z is calculated by taking the weighted harmonic mean of the characteristic relative permeability eq 49 of the low and high permeable layer the capillary pressure gradient δ p c is calculated from the difference between the characteristic capillary pressure eq 48 of the low and high permeable layer divided by the layer thickness κ r α a v e z and δ p c are used in equation 1 to obtain n c t to obtain n c v i r n o v s k y the same capillary pressure gradient δ p c as calculated for n c t is used the viscous pressure drop δ p is calculated from the darcy equation for the water phase eq 5 using the average absolute permeability in the principal direction and the average water relative permeability in the principal direction κ r α a v e x which is calculated by taking the weighted arithmetic mean between the water relative permeability of the low eq 28 and high eq 27 permeable layer at each particular fractional flow δ p c and δ p f w are used in equation 3 to obtain n c v i r n o v s k y appendix b brooks corey vs vangenuchten type of saturation functions the presented physics based model requires vangenuchten type of saturation functions where p c 0 at s w 1 to ensures p c continuity however for the more commonly used brooks corey type of functions the p c p e at s w 1 to look at the impact of the different saturation functions on the lateral migration of the plume numerical simulation are run using the reservoir simulator eclipse schlumberger geoquest 1261440m 3 of co 2 is injected into a radial reservoir of 20m thickness and a radial distance of 2000m at a constant injection rate of 0 04m 3 s the grid cell size in the radial direction is dr 1m a constant pressure boundary exists at r 2000m while no flow boundaries exist at the top and bottom simulations are run for systems 1 4 table 1 using both the vangenuchten and brooks corey type of saturation functions which can be seen in figure 13 a kink in the upscaled brooks corey curves arises when the capillary pressure drops below the entry pressure of the low permeable layer and the low permeable layer becomes fully saturated with water it is clear from figure 13 that there is no significant difference in the lateral extent of the plume in horizontally layered systems when the brooks corey curves are used compared to the vangenuchten curves this can be explained by the fact that even when vangenuchten type of functions are used in the case of high permeability ratios the saturation in the low permeable layer is close to 1 as can be seen in figure 2a and the flow of co 2 is almost entirely through the high permeable layer appendix c the presented physics based model to derive flow rate dependent saturation functions can be used to incorporate the impact of mm m scale horizontal lamination into larger scale reservoir models as long as the grid cell size of the model is sufficiently small such that at the scale of the grid cell gravity effects can be neglected the scale at which gravity effects can be neglected depends on the system figure 14 shows the saturation in the layers at gravity capillary equilibrium for each of the systems of table 1 the capillary pressure at gravity capillary equilibrium is defined as 50 p c p c 0 δ ρ g z where p c 0 is the capillary pressure at z 0 δ ρ ρ w ρ c o 2 is the difference in fluid density kg m 3 g is the gravitational acceleration m s 2 and z is the height m each colored line in figure 14 represents a different p c 0 ranging between p e of the low permeable layer to 10 times p e of the low permeable layer a larger p c 0 corresponds to a greater column height of co 2 below the system gravity can be neglected as long as the saturation profile of the grid cell stays symmetric figure 14 shows that this is the case for all p c 0 for systems 3 and 4 however for system 1 and 2 the saturation profile is asymmetric for the lower values of p c 0 but becomes more symmetric with increasing p c 0 this shows that systems 1 and 2 will require a smaller grid cell size than systems 3 and 4 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103881 appendix d supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
332,we investigate the impact of sub grid scale horizontal lamination on the migration of the co 2 plume during geologic sequestration a new physics based model that includes the effects of capillary and viscous forces is used to obtain effective flow rate dependent capillary pressure and relative permeability functions for this purpose a macroscopic capillary number is derived that accurately describes the viscous capillary force balance the model is based on the fractional flow approach and is implemented in an extended radial buckley leverett solution this provides an easy way to investigate the impact of mm to m scale laminae on the frontal advance of the plume our work shows that at injection rates and volumes commonly used at geologic sequestration sites capillary number dependency is important during the initial phase of the injection period at later stages the use of a capillary limit solution will be a valid approximation even close to the injection well keywords co 2 sequestration flow rate dependency relative permeability capillary pressure fractional flow approach macroscopic capillary number msc 00 01 99 00 1 introduction geologic carbon sequestration can play an important role in reducing the amount of greenhouse gasses emitted to the atmosphere to ensure the long term security of the injected co 2 a good understanding of the fate of the co 2 plume is needed the migration of the plume is impacted by rock structure heterogeneities at many different length scales ranging from the pore to the field scale jackson and krevor 2020 heterogeneities at the mm cm scale are often present in the form of laminae thin layers of less then 1cm thick the grain size and permeability can vary widely between laminae which is reflected in differences in the capillary pressure curves as a result capillary pressure gradients can exist that can lead to capillary induced flows fig 1 it has been shown both experimentally perrin and benson 2010 shi et al 2011 pini et al 2012 wei et al 2014 zhang et al 2014 reynolds and krevor 2015 jackson et al 2018 and numerically krause et al 2013 kong et al 2015 that the co 2 saturation distribution depends on the balance between the viscous forces as a result of the injection flow rate and the capillary forces due to capillary heterogeneity to incorporate the impact of sub grid scale mm to m laminae into upscaled coarse grid systems effective multi phase flow parameters are defined in such a way that the coarse grid systems and fine grid systems act similarly these upscaled effective parameters or pseudo functions are flow rate dependent due to the dependence of the saturation distribution on the viscous capillary force balance they can be obtained by using dynamic kyte and berry 1975 stone 1991 and steady state upscaling methods smith 2012 saad et al 1995 dale et al 1997 stephen and pickup 1999 virnovsky et al 1999 the dynamic method involves running fine scale two phase flow simulations these simulations are time consuming pickup and stephen 2000 and sometimes lead to unrealistic results barker and thibeau 1997 steady state methods form a more efficient approach and rely on the fact that at the small scale behind and ahead of a displacement front the saturation changes very slowly allowing for steady state conditions to be assumed smith 2012 as for dynamic methods steady state methods require an accurate solution of the multi phase flow equations in the asymptotic cases of the viscous limit vl and capillary limit cl an accurate solution of the multi phase flow equations can be obtained by single phase upscaling methods making this a more efficient approach than the dynamic methods smith 2012 dale et al 1997 ekrann and aasen 2000 virnovsky et al 2004 pickup and sorbie 1994 kumar and jerauld 1996 pickup and carruthers 1996 pickup and sorbie 1996 pickup 1998 lohne et al 2006 however using the steady state vl or cl solution for flow rates within the transition zone between these limits can lead to significant errors pickup and stephen 2000 lohne et al 2006 to determine whether it is valid to use either of the asymptotic solutions several different capillary numbers which give the ratio of viscous to capillary forces exist the most commonly used capillary number is given by c a q μ σ where q is the darcy flux m s μ is the viscosity pa s and σ the interfacial tension n m c a defines the viscous capillary force balance at the pore scale where the length scale is the pore throat but does not take into account the capillary gradients that can exist due to heterogeneities at larger scales to describe the viscous capillary force balance at larger scales a macroscopic capillary number should be used that takes into account the scale and the direction of the heterogeneity this can be derived by applying the theory of scaling groups rapoport 1955 shook et al 1992 using this approach a transverse capillary number for horizontally laminated systems can be found of the form jonoud and jackson 2008 yokoyama and lake 1981 zhou et al 1997 1 n c t q h 2 d l where d s w is the capillary diffusion term defined as 2 d s w k κ r n w κ r w μ n w κ r w μ w κ r n w d p c d s w here l and h are length scales m in the principal along lamina and transverse across lamina directions respectively k is the absolute permeability m 2 in the transverse direction κ r the phase relative permeability in the transverse direction μ is the phase viscosity pa s and p c is a characteristic capillary pressure pa the subscripts n w and w indicate the non wetting and the wetting phase respectively if n c t 1 the vl is reached while if n c t 1 the cl is reached an equivalent macroscopic capillary number presented by virnovsky et al 2004 is given by 3 n c v i r n o v s k y h δ p l δ p c f w where δ p is the viscous pressure drop pa along length l and δ p c f w is the difference between the capillary pressure curves of the different layers at the same fractional flow if n c v i r n o v s k y 0 1 the cl is reached the transition from cl to vl occurs close to n c v i r n o v s k y 1 and if n c v i r n o v s k y 10 the vl is reached for both the cl and vl single phase steady state upscaling methods can be used to derive upscaled effective multi phase flow parameters to generate effective parameters for the capillary numbers that fall in the transition regime between these limits the time dependent two phase flow equations need to be solved until steady state is reached which is very computer intensive more efficient approaches based on iterative algorithms to calculate rate dependent effective parameters have been presented by kumar and jerauld 1996 virnovsky et al 2004 the recent study of benham et al 2020 combined asymptotic analysis and numerical simulations to suggest a composite heuristic form for effective relative permeabilities for horizontally layered systems that remains accurate across all flow regimes furthermore they illustrate how the capillary number n c v i r n o v s k y at the flooding front changes over time at early times near the source the front is in the vl regime whereas later on far away from the source it is in the cl regime the recent extensive numerical study on the impact of small scale heterogeneity on field scale plume migration of jackson and krevor 2020 analyzed the impact of layers and numerical steady state upscaling at the cl vl of such systems in detail they showed that capillary equilibrium is generally established within several meters of a co 2 injection well in this paper we derive a new macroscopic capillary number that more accurately describes the capillary viscous force balance in horizontally laminated systems we use this new capillary number to obtain upscaled effective saturation functions including relative permeability capillary pressure and fractional flow over the full range of velocities analytically this new method is based on the fractional flow approach and the obtained flow rate dependent saturation functions can therefore straightforwardly be implemented into an extended buckley leverett analytical solution to predict how small scale lamination effects the frontal advance of the co 2 plume the paper is structured as follows first the physics of the system and the governing equations at the local scale are discussed in sections 2 and 3 next it is shown how upscaled saturation functions in the cl and vl can be derived as a function of fractional flow section 4 1 these asymptotic solutions can be used to obtain the upscaled saturation functions in the transition regime using a newly derived macroscopic capillary number r v c which is discussed in section 4 2 an approximate form of r v c is presented in section 4 3 which can be used to incorporate the observed flow rate dependency into a numerical simulator in section 5 we demonstrate how these flow rate dependent saturation functions can be implemented into an extended buckley leverett analytical solution to investigate the large scale impact of mm m scale layered heterogeneity we validate our approach by deriving effective relative permeability and capillary pressure for a range of laminated systems comprising different aspect ratios a ratio l h permeability ratios and saturation functions and comparing the results with numerical simulations finally the obtained flow rate dependent saturation functions are used in an extended buckley leverett solution to investigate the impact of mm m scale horizontal lamination on co 2 plume migration 2 steady state upscaling in horizontally laminated rock small scale horizontal laminae that are below the grid cell resolution can have a big impact on the migration of the co 2 plume to incorporate the impact of sub grid scale mm to m horizontal lamination into coarse grid systems upscaled effective multi phase flow parameters can be used in this work we present a model based on a steady state upscaling approach to derive these upscaled effective parameters the sub grid scale system that is considered consists of alternating high and low permeability rocktypes parallel to the flow direction as can be seen in figure 1 at the inlet boundary co 2 and water are injected in each of the layers at the same fractional flow until steady state is reached this is a valid boundary condition for high flow rates near the vl for low flow rates near the cl this boundary condition will not strictly be true as the higher entry pressure of the low permeable layer could result in higher water fractional flows in this layer however since capillary equilibrium is reached after a short distance from the inlet this assumption will not significantly impact the upscaled parameters the system is water wet and each rocktype has its own capillary pressure saturation relationship as a result gradients in capillary pressure exist perpendicular to the flow direction this leads to capillary induced crossflow between the layers with water imbibing into the low permeable layers and co 2 flowing into the high permeable layers this will change the fractional flow in the layer and inherently its saturation with distance the distance it takes to even out these capillary gradients depends on the ratio of the viscous to capillary forces boon et al 2018 at steady state three different regions can be defined a region at the inlet where the saturation distribution corresponds to the vl a transition region where the crossflow of water and co 2 even out the capillary gradient and a third region where capillary equilibrium is reached among other factors the length of the transition regime is a function of the injection rate ekrann and aasen 2000 for low flow rates capillary forces dominate and it only takes a short distance before the capillary forces even out the capillary gradient if this distance is much smaller than the lateral extent of the lamina the cl solution can be used for very high flow rates viscous forces dominate and it takes a very long distance before the capillary gradient evens out if the lateral extent of the lamina is much shorter than the length of the transition region the capillary flux can be neglected and the vl solution can be used for intermediate flow rates the length of the transition regime is of the same order as the lateral extent of the lamina in these cases the use of the vl or cl saturation distribution can lead to large errors the lateral extent of laminae in reservoir rocks is typically at least one order of magnitude larger than the thickness of the layer and depends on the depositional conditions in high energy systems like shallow marine fluvial and aeolian depositional environments the lamina extends over much shorter distances than in for example quiet lakes and deep ocean basins ringrose et al 1993 high porosity clastic sediments which can often be found in suitable geologic sequestration sites are most commonly deposited under high energy conditions and likely possess laminae of limited lateral extent it is therefore possible that even for low flow rates the cl steady state solution might not be valid in this paper a simple model is presented to derive upscaled effective saturation functions for the full velocity range which can be implemented into an extended buckley leverett analytical solution to predict the larger scale impacts of these small scale heterogeneities 3 governing equations at the local scale we consider the immiscible displacement of water by co 2 in an incompressible 2 d system the system contains layers of two alternating rocktypes parallel to the flow direction at the mm m scale fig 1 at this small scale capillary forces are important but gravity effects are negligible and are therefore not taken into account at the local scale at steady state the mass balance equation for each phase may be written as 4 q α 0 here q m s is the darcy flux given by 5 q α k κ r α μ α p α where α indicates phase which can either be water or co 2 k is the intrinsic permeability m 2 κ r α is the phase relative permeability μ α is the phase viscosity pa s and p α is the phase pressure pa the intrinsic permeability and the phase relative permeability are assumed to be isotropic at the local scale since the system solely consists of two phases the sum of the individual phase saturation is one 6 s w s c o 2 1 the saturation is a function of the capillary pressure 7 s α s α p c which is defined as 8 p c p c o 2 p w and the relative permeability is a function of the phase saturation 9 κ r α κ r α s α the total flux q t is the sum of two individual phase fluxes 10 q t k κ r w μ w p w k κ r c o 2 μ c o 2 p c o 2 using the expression for capillary pressure eq 8 to relate the pressure in the co 2 phase to the pressure in the water phase the total flux can be expressed as a function of one of the individual phase pressures and the capillary pressure 11 q t k κ r c o 2 μ c o 2 k κ r w μ w p w k κ r c o 2 μ c o 2 d p c d s w s w 12 q t k κ r w μ w k κ r c o 2 μ c o 2 p c o 2 k κ r w μ w d p c d s w s w these equations can be rearranged to write the water and co 2 flux as a function of the total flux 13 k κ r w μ w k κ r c o 2 μ c o 2 k κ r w μ w q t k κ r w μ w k κ r c o 2 μ c o 2 k κ r w μ w k κ r c o 2 μ c o 2 d p c d s w s w k κ r w μ w p w 14 k κ r c o 2 μ c o 2 k κ r w μ w k κ r c o 2 μ c o 2 q t k κ c o 2 μ c o 2 k κ r w μ w k κ r c o 2 μ c o 2 k κ r w μ w d p c d s w s w k κ r c o 2 μ c o 2 p c o 2 the above equations show that the flux of each phase consists of a viscous component and capillary component the second term in eq 13 describes the flux of water as a result of capillary forces and is the same as the capillary diffusion term in equation 2 the flux of co 2 due to the capillary forces is given by the second term of equation 14 in certain cases the capillary forces can be neglected and the fractional flow of water and co 2 are given by respectively 15 f w q w q t k κ r w μ w k κ r c o 2 μ c o 2 k κ r w μ w 16 f c o 2 q c o 2 q t k κ r c o 2 μ c o 2 k κ r c o 2 μ c o 2 k κ r w μ w 4 upscaled saturation functions as a function of fractional flow 4 1 upscaled saturation functions in the vl and cl the analytical derivation of upscaled saturation functions in the vl and cl for horizontally layered systems at steady state has been discussed previously corey and rathjens 1956 odsæter et al 2015 rabinovich et al 2016 here a similar approach is used with the important difference that the upscaled saturation functions will be a function of fractional flow not only for the vl corey and rathjens 1956 odsæter et al 2015 rabinovich et al 2016 but also for the cl in the vl the fractional flow of water is constant along streamlines ekrann and aasen 2000 for the system of figure 1 this means that each layer holds the same fractional flow of water and the steady state saturation in each layer at a particular fractional flow of water can be obtained from the fractional flow curve of each individual rocktype eq 15 in the cl the capillary pressure is constant throughout the system and each layers steady state saturation at a particular capillary pressure can be obtained from the capillary pressure saturation relationship of the corresponding rocktype the steady state saturation in the low and high permeable layer can be used to find each layers relative permeability and capillary pressure the upscaled values are found by taking the weighted arithmetic mean 17 κ r α a v e x i 1 n k κ r α i i 1 n k i 18 p c u p i 1 n θ p c i i 1 n θ i where n corresponds to the amount of layers present in the system i is the layer number and θ is porosity the upscaled saturation is given by 19 s w up i 1 n θ s w i i 1 n θ i in the vl the vertical capillary forces are much smaller than the horizontal viscous forces while in the cl it only takes a very short distance before the capillary forces even out the capillary gradient between the layers therefore for both the vl and cl the capillary term of equation 13 and 14 can be neglected and the upscaled fractional flow of water for this layered system can be described with 20 f w u p q w q t i 1 n k κ r w μ w d p d x i i 1 n k κ r w μ w d p d x k κ r c o 2 μ c o 2 d p d x i i 1 n k κ r w μ w i i 1 n k κ r w μ w k κ r c o 2 μ c o 2 i since the pressure gradients in the vertical direction can be neglected the horizontal pressure gradients can be assumed to be the same in each layer and cancel out once the steady state saturation in each layer is known the upscaled fractional flow curves can be calculated for both the vl and the cl figure 2 shows the upscaled fractional flow curves and corresponding effective relative permeability and effective capillary pressure curves for the vl red color and cl blue color for a horizontally layered rock with k h i g h 19 8md and k l o w 0 198md table 1 system 4 the saturation in each layer is indicated in figure 2a by the dashed and dash dot lines for the high permeable layer and low permeable layer respectively the stars in figure 2b c indicate the upscaled relative permeability and capillary pressure for nine different fractional flows ranging from f w 0 01 to 0 9 for both the vl and cl 4 2 upscaled saturation functions in the transition regime in between the vl and cl there is a transition regime where the capillary pressure gradient cannot be neglected in this transition regime both the fractional flow and the capillary pressure vary between layers to find the upscaled saturation functions in this transition regime a capillary number scaling is used to observe how the saturation changes from the cl towards the vl numerical simulations section 6 were run for nine different injection fractional flows and 17 injection flow rates ranging from the cl to almost the vl for two different layered systems one with an average permeability of 400md and one with an average permeability of 10md system 2 and 4 in table 1 fig 3 shows the normalized co 2 saturation s c o 2 of the low permeable layer which is defined as 21 s c o 2 f w s c o 2 f w s c o 2 c l f w s c o 2 v l f w s c o 2 c l f w for each of the fractional flows and flow rates as a function of the two capillary numbers n c t and n c v i r n o v s k y eq 1 and 3 details on how these numbers were calculated can be found in appendix a a s c o 2 of zero means that the system is in the cl while a s c o 2 of 1 means that the system is in the vl to correctly capture the scaling between the cl and vl the location of s c o 2 0 5 should be around a capillary number of 1 this is not the case for both of the traditional capillary numbers fig 3 a b and the location of s c o 2 0 5 changes with fractional flow and for different systems therefore a new macroscopic capillary number needs to be derived that more accurately describes the viscous capillary force balance for horizontally layered systems to derive this new capillary number the assumption is made that the viscous flux q v i s and capillary flux q c a p can be considered separately with q v i s acting in the principal direction over a length scale l and q c a p in the transverse direction over a length scale h fig 4 the capillary number r v c is defined as the ratio of the time it takes to travel h as a result of the capillary flux over the time it takes to travel l by the viscous flux 22 r v c h l q v i s q c a p at the local scale the first and second term of equations 13 and 14 can be substituted for q v i s and q c a p respectively for the water phase this results in 23 r v c w a t e r h l q t k κ r c o 2 μ c o 2 d p c d z and for the co 2 phase this results in 24 r v c c o 2 h l q t k κ r w μ w d p c d z these local capillary numbers are used to describe the viscous capillary force balance in our system in the case of perfect counter current flow the co 2 and water capillary flux will be equal only in this case the viscous capillary force balance will be the same for both phases and can be described by either of the capillary numbers eq 23 and 24 however in reality there will be a combination of counter and co current flow and the viscous capillary force balance will be different for each phase the saturation in each layer depends on the fractional flow in that layer the fractional flow in the low permeable layer changes as a result of the outward capillary flux of co 2 and the inward capillary flux of water and oppositely for the high permeable layer therefore a correct description of the viscous capillary force balance of our system should take the capillary flux of both phases into account this can be done by taking the average between the capillary flux of the water phase and the capillary flux of the co 2 phase 25 r v c h l 2 q t k κ r w μ w d p c d z k κ r c o 2 μ c o 2 d p c d z the time it takes to travel l by the viscous flux will be different for each layer if we look at the system as a whole then the distance it takes to even out the capillary gradients will be determined by the slowest flowing layer which is the low permeable layer therefore for q t in equation 25 q t l o w will be substituted which is the total flux in the low permeable layer q t l o w can be calculated by dividing the total flow rate over the different layers according to the total mobility in each layer which is defined as 26 λ t i k i κ r w a v e i μ w k i κ r c o 2 a v e i μ c o 2 here the phase relative permeabilities are approximated for each fractional flow by using the average value over the range of water saturation between the vl and the cl for the high permeable layer this is calculated as 27 κ r α av e h s w ca p h s w vh κ r α s w ds s w vh s w ca p h and for the low permeable layer as 28 κ r α av e l s w vl s w ca p l κ r α s w ds s w ca p l s w vl to describe the capillary flux for each of the phases we need to take a closer look at the system for each rocktype the saturation and capillary pressure for each fractional flow in both the vl and cl are known section 4 1 to ensure continuity of pressure at the boundary between each of the layers capillary equilibrium is assumed at each of the boundaries at all times this assumption requires the use of vangenuchten type of capillary pressure curves where p c 0 at s w 1 such that the capillary pressure curves of different rock types will always have an overlapping range and hence p c continuity furthermore it is assumed that in the vl the saturation and capillary pressure along the center line of each layer are at the vl fig 4 in this way the system can be divided into different crossflow regions indicated by the dashed lines in figure 4 where both water and co 2 are flowing in a counter current nature water is flowing into the low permeable layer while at the same time co 2 is flowing into the high permeable layer the capillary flux is dependent on the saturation distribution which is dynamic to approximate an average d p c d z term for a particular f w the average capillary pressure drop between the centers of the low and high permeable layer is calculated and divided by the thickness of the layer 29 d p c f w d z p c v h f w p c c a p f w θ h p c c a p f w p c v l f w θ l θ h θ l h where p c v h is the capillary pressure in the vl in the high permeable layer p c v l is the capillary pressure in the vl in the low permeability layer and p c c a p is the capillary pressure in the cl the phase relative permeabilities in each of the layers is given by equations 27 and 28 the upscaled relative permeability and absolute permeability are approximated for each crossflow region by taking the weighted harmonic mean substituting the above into equation 22 leads to 30 r v c q t f w h l 2 q t l o w k a v e z κ r w a v e z μ w d p c f w d z k a v e z κ r c o 2 a v e z μ c o 2 d p c f w d z equation 30 is a new capillary number that describes the viscous capillary force balance in horizontally layered systems as function of flow rate and fractional flow figure 3c shows the normalized co 2 saturation s c o 2 of the low permeable layer for each of the fractional flows and flow rates as a function of r v c the transition from the cl to the vl indicated by the location of s c o 2 0 5 is around a capillary number of 1 for all fractional flows and for both systems this shows that r v c correctly captures the viscous capillary force balance and can be used to find the saturation in each of the layers in the transition regime for this purpose a logistic function is fitted towards the data presented in figure 3c which is indicated by the black line and given by 31 s c o 2 1 1 1 r v c f w q t 0 8 the saturation in the high permeable layers is scaled in the same way however the saturation change in the high permeable layer between the two limits is very small and often negligible and is therefore not shown for each combination of fractional flow and flow rate the saturation in each layer can be obtained using equation 31 the corresponding multi phase flow parameters can be calculated using the saturation functions of the particular layer the upscaled parameters can be found using equations 17 18 19 with this model flow rate dependent effective fractional flow curves flow rate dependent effective relative permeability curves and flow rate dependent effective capillary pressure curves can be constructed in addition equation 31 can be used to define when the asymptotic solutions can be applied by setting the cl to a s c o 2 0 05 and the vl to s c o 2 0 95 we find that if r v c 0 025 the cl is reached and if r v c 40 the vl is reached 4 3 implementation into a numerical simulator it is not straightforward to implement equation 30 into a numerical scheme however an approximate capillary number can be found based on the average pressure gradient which will be much easier to implement for this the expression for total flux given by equation 10 is used in equation 30 32 r v c h l 2 λ t l λ t a v e z d p d l d p c d z where 33 λ t l k l κ r w a v e l μ w k l κ r c o 2 a v e l μ c o 2 and 34 λ t a v e z k a v e z κ r w a v e z μ w k a v e z κ r c o 2 a v e z μ c o 2 by plotting λ r a t i o λ t l λ t a v e z as a function of fractional flow for each of the systems considered fig 5 it can be seen that this ratio is around 0 5 r v c can therefore be estimated by 35 r v c a p p x h l d p f w d l d p c f w d z equation 35 has the same form as n c v i r n o v s k y eq 3 however the capillary pressure gradient is calculated using equation 29 and is a function of saturation and fractional flow figure 3d shows the normalized co 2 saturation s c o 2 of the low permeable layer for each of the fractional flows and flow rates as a function of r v c a p p x here d p f w d l is calculated by using the upscaled absolute permeability in the principal direction and upscaled relative permeability in the principal direction as a function of fractional flow appendix a it can be seen that both r v c and r v c a p p x correctly capture the viscous capillary force balance r v c a p p x can be used in combination with equation 31 to incorporate the impact of mm m scale horizontal lamination into larger scale reservoir models as long as the grid cell size of the model is sufficiently small such that at the scale of the grid cell gravity effects can be neglected appendix c 5 extended buckley leverett solution most commercial reservoir simulators do not have the capability to incorporate flow rate dependent saturation functions this makes it difficult to analyze the effect of small scale heterogeneities on large scale co 2 plume migration however an extended buckley leverett analytical solution exists where the fractional flow function depends both on the saturation and the radial distance from the well mijic and laforce 2012 rossen et al 2011 which can be used for this purpose in our case the radial dependency arises due to the decreasing flow rate with distance away from the well and the flow rate dependent fractional flow functions section 4 2 can straightforwardly be implemented it should be emphasized that the bl solution is a highly simplified representation of a reservoir and that gravity effects are not taken into account nevertheless the bl solution can help to get a better understanding of the impact of small scale heterogeneity on large scale co 2 plume migration by providing new insights of the physics that takes place in the following the main steps in deriving this extended bl solution are mentioned more details can be found in mijic and laforce 2012 rossen et al 2011 the radial convection equation for co 2 injected into a water saturated reservoir can be written as 36 s c o 2 t q π h θ f c o 2 r 2 0 here s c o 2 is co 2 phase saturation t is time s q is injection flow rate m 3 s h is reservoir thickness m θ is reservoir porosity f c o 2 is fractional flow of co 2 which is a function of both saturation and radial distance and r is radial distance from the well m a constant flux along the entire thickness of the reservoir is assumed the number of variables in equation 36 can be reduced by applying the following transformations in space and time 37 r d r 2 r e 2 38 t d q t π r e 2 h θ where r e is radial extent m of the reservoir resulting in 39 s c o 2 t d f c o 2 r d 0 because f c o 2 depends both on s c o 2 and r d 40 f c o 2 r d f c o 2 s c o 2 r d s c o 2 r d f c o 2 r d s c o 2 substituting equation 40 into equation 39 leads to 41 s c o 2 t d f c o 2 s c o 2 r d s c o 2 r d f c o 2 r d s c o 2 equation 41 is a non homogeneous quasi linear partial differential equation where the characteristics move with a velocity 42 d r d d t d f c o 2 s c o 2 r d the co 2 saturation profile for each time after injection has started can be obtained by integrating equation 42 using a fixed value of flux and the flow rate dependent fractional flow functions corresponding to r d the obtained solution will contain multiple co 2 saturation values at the same location within the reservoir which is physically impossible to find a unique solution the multi valued parts are removed by inserting a shock front in a similar way as done for the 1 d buckley leverett solution the location of the shock front r d f can be determined by integrating the saturation profile using the equal area rule 43 r d f 1 s c o 2 f 0 s c o 2 f r d d s c o 2 the above described extended buckley leverett solution can be used to get a better understanding of the impact of small scale heterogeneity on the sweep efficiency saturation distribution and frontal advance of the plume 6 numerical simulations to verify the validity of our physics based model the results are compared with numerical simulations we simulate the injection of co 2 into several layered reservoirs initially fully saturated with water for a range of fractional flows and flow rates the rock properties of the different systems are given in table 1 the simulations are carried out using the reservoir simulator eclipse schlumberger geoquest the simulation model consists of nine alternating high and low permeable layers this way both the bottom and the top layer of the model are of high permeability ensuring symmetry in the crossflow fluxes the dimensions of the model are 1 91m in the lateral direction and 0 15m thick the number of grid cells in the model are nx 120 ny 90 and nz 1 corresponding to a grid cell size of 0 0160m by 0 00167m by 0 005m a column of grid blocks containing a very high permeability 100 000md and porosity 100 is chosen for the injection wells ensuring a uniform flux across the inlet boundary jonoud and jackson 2008 ekrann and aasen 2000 the inlet of the model consist of constant flow boundary while the outlet consists of constant pressure boundary no flow boundaries exist at the top and bottom a buffer zone of 30 grid cells is created at the inlet to assure that the flow fully develops before it enters the layers the simulations are run for each fractional flow until steady state is reached at steady state the upscaled capillary pressure and upscaled saturation are calculated using equations 18 and 19 respectively the upscaled relative permeability is calculated using the phase pressure gradient in equation 5 krause and benson 2015 7 results 7 1 flow rate dependent effective saturation functions flow rate dependent effective saturation functions were derived for six different horizontally layered systems using the physics based model presented in section 4 and compared with numerical simulations using the eclipse reservoir simulator section 6 each system consists of alternating high and low permeable layers with individual properties that can be found in table 1 the layers are 0 0167m thick and have a lateral extent of 0 167m and 1 28m corresponding to aspect ratios a ratio of 10 and 77 the capillary pressure saturation relationship is described by the vangenuchten hybrid mualem corey model which is defined as 44 p c p e s w 1 m 1 1 m 45 κ r w s w 0 5 1 1 s w 1 m m 2 46 κ r n w 1 s w 2 1 s w 2 47 s w s w s w i r r 1 s w i r r here p e is the capillary entry pressure pa m is the vangenuchten exponent s w is the effective water saturation and s w i r r the irreducible water saturation the saturation functions for each of the rocktypes used can be seen in figure 6 the water and co 2 viscosity are chosen as 5 5e 04 pa s and 2 3e 05 pa s respectively which corresponds to reservoir conditions 50 c and 8963 kpa figures 7 and 9 show the upscaled effective relative permeability of the systems with an average absolute permeability of 400md and 10md respectively for two permeability ratios kratio 10 and 100 and for two different aspect ratios aratio 10 and 77 results are plotted for four different darcy velocities ranging between the cl and vl the corresponding upscaled effective capillary pressure curves can be seen in figures 8 and 10 the triangles are the results from the numerical simulations while the circles connected with a line are the result from our physics based model both the numerical simulations and the physics based model show that for horizontally layered systems the relative permeability of the co 2 phase increases when the systems transition from the vl to the cl while the relative permeability of the water phase decreases the new model is able to correctly capture the transition from the vl to the cl limit which occurs at higher velocities with increasing aspect ratio and increasing permeability ratio 7 2 extended buckley leverett solution the fractional flow functions for all four systems with a ratio 10 are used in the bl model to look at the impact of small scale lamination on co 2 plume migration for this 1261440m 3 of co 2 is injected into a radial reservoir of 20m thickness for three different injection rates a realistic rate of 0 04m3 s kaven et al 2014 furre et al 2017 and two unrealistically high rates of 0 4m3 s and 4m3 s which will help to understand the impact of flow rate dependency the above injection rates correspond to an injection time of 365 days 36 5 days and 3 65 days respectively the results can be seen in figure 11 the graphs on the left show the effective co 2 fractional flow curves for a range of velocities between the vl and cl and the graphs in the middle show the corresponding derivative f c o 2 s c o 2 each velocity corresponds to a different radial distance from the injection well the derivatives are used in equation 42 to obtain the co 2 saturation profile after 1261440m 3 of co 2 has been injected into the reservoir the graphs on the right show the co 2 saturation profiles using the vl fractional flow function the cl fractional flow function and the flow rate dependent fractional flow functions for the three injection rates to validate the use of the bl solution the vl and cl results for system 1 are compared with numerical results obtained with the reservoir simulator eclipse schlumberger geoquest using a fine grid with dr 0 25m the results are indicated by the red and blue dashed lines in figure 11 top right for both the vl and cl a good match is observed between the analytical solution and the numerical simulations however some dispersion is present at the front in the case of the numerical simulations it can be seen that the plume travels further for systems 3 and 4 compared to systems 1 and 2 due to the low porosity of the former systems the plume also travels further when the cl functions are used compared to the vl functions furthermore it shows that the saturation profiles using the flow rate dependent fractional flow functions for an injection rate of 0 04m 3 s overlap with the cl solution for all systems for the injection rate of 0 4m 3 s only system 4 with a permeability of 10md and a permeability ratio of 10 shows the impact of flow rate dependency and the frontal advance of the plume is slightly less then in the cl the same behavior is seen for all systems when the very high injection rate of 4m 3 s is used although it is most pronounced in the systems with a permeability ratio of 10 to get a better understanding of the dynamic behavior the r v c is plotted versus radial distance together with the corresponding fractional flow of co 2 as a function of of volume injected for systems 1 and 3 in figure 12 it can be seen that the f c o 2 at each radial distance increases when more volume is injected i e increases with time consequently the corresponding r v c is decreasing as a result system 1 transitions into the cl after 0 6 of the total volume is injected at an injection rate of 0 04m 3 s this corresponds to 2 2 days of injection and a frontal advance of 40m for the higher injection rate of 0 4m 3 s the transition towards the cl happens after 70 of the total volume is injected corresponding to an injection time of 25 6 days and frontal advance of 580m for the unrealistically high injection rate of 4m 3 s the system stays within the transition regime during the entire injection period although the r v c is decreasing for system 3 the transition into the cl for the lowest injection rate 0 04m 3 s happens after 7 8 of the total volume is injected corresponding to 28 5 days and a frontal advance of 280m which is later compared to system 1 for the higher injection rates 0 4m 3 s 4m 3 s r v c is decreasing with time but the systems stay within the transition regime during the entire injection period furthermore from figure 12 it can be seen that the rvc stays fairly constant throughout the entire plume for each particular time however an increase can be observed close to the well and a gradual decrease is present further away from the well 8 discussion the new capillary number to describe the viscous capillary force balance in horizontally layered systems r v c much better captures the transition from the cl to the vl compared to the previously used n c t eq 1 and n c v i r n o v s k y eq 3 n c t only takes into account the transverse capillary flux of the water phase furthermore the saturation dependency of the capillary flux is not taken into account the transverse capillary flux of water can only describe the systems capillary flux correctly in the case of perfect counter current flow where the transverse flux of water is equal to the transverse flux of co 2 this is often not the case especially for very high and very low fractional flows of co 2 n c v i r n o v s k y does take both the water and co 2 capillary flux into account however similar to n c t the saturation dependency of the capillary flux is not taken into account as a result the location of the transition from the cl to the vl indicated by s c o 2 0 5 changes with fractional flow and for different systems fig 3a b this also becomes clear when comparing the capillary numbers observed in other works benham et al 2020 jackson and krevor 2020 virnovsky et al 2004 by taking into account both the water and co 2 capillary flux and by calculating κ r α and the gradient in p c as a function of fractional flow we have derived a general form of the transverse capillary number r v c eq 30 that is able to correctly describe the viscous capillary force balance for all cases for all systems and fractional flows the transition from the cl to vl defined as the location where s c o 2 0 5 occurs at rvc 1 and follows the same scaling given by equation 31 we can use this scaling to define when the asymptotic solutions can be used by setting the cl to a s c o 2 0 05 and the vl to s c o 2 0 95 we find that if r v c 0 025 the cl is reached and if r v c 40 the vl is reached by using the simple r v c scaling of the saturation given by equation 31 flow rate dependent saturation functions were derived for four systems table 1 for two different aspect ratios as a function of flow rate and fractional flow for all cases our physics based model was able to capture the same behavior as observed in the numerical simulations fig 7 8 9 10 the model requires the use of vangenuchten type of saturation functions where p c 0 at s w 1 such that the capillary pressure curves of different rock types will always have an overlapping range and hence p c continuity for brooks corey type of functions p c p e at s w 1 as a result p c discontinuity at the boundary between the layers arises when the p c falls below the entry pressure of the low permeable layer in such cases the low permeable layer becomes fully saturated with water which leads to a kink in the upscaled capillary pressure and relative permeability curves appendix b this makes the scaling between the cl and the vl in the case of brooks corey type of functions not straightforward however numerical simulations show that using the upscaled brooks corey saturation functions instead of the upscaled vangenuchten saturation functions does not have a significant effect on the lateral extent of the plume appendix b this can be explained by the fact that in the case of high permeability ratios even when vangenuchten type of functions are used the water saturation in the low permeable layer is close to 1 as can be seen in figure 2a and the flow of co 2 is almost entirely through the high permeable layer the good agreement of our physics based model and the numerical simulation results allowed us to implement the model into an extended buckley leverett solution to look at the impact of sub grid scale horizontally layered heterogeneity on the migration of co 2 in larger scale radial systems as stated previously the bl solution is a highly simplified representation of a reservoir and gravity effects are not taken into account the solution can therefore not be used to accurately predict the migration of the plume but does provide new insights of how small scale heterogeneity can impact large scale plume migration to predict the migration of a co 2 plume at real storage sites requires the use of 3 d full physics reservoir models equation 31 can be used in combination with the r v c a p p x to incorporate the impact of mm m scale horizontal lamination in such models as long as the grid cell size of the reservoir model is sufficiently small such that at the scale of the grid cell gravity effects can be neglected the exact scale up to which gravity effects can be neglected depends on the system but will be on the order of meters appendix c in radial buckley leverett systems the local r v c is a function of two competing factors the fractional flow and flow rate typically near the injection well you have very high velocities and very high fractional flows of co 2 while both decrease with radial distance away from the well a decrease in fractional flow of co 2 moves the system towards the vl while a decrease in the flow rate moves the system towards the cl the counterbalance between those two factors determines when and where the vl to cl transition occurs as a result the r v c stays relatively constant with distance at a particular time fig 12 interestingly however changes in the r v c are not monotonic close to the well an increase in r v c is observed because at high fractional flows of co 2 a small decrease in fractional flow of co 2 result in a relatively large decrease in relative permeability further away from the well the r v c decreases gradually as a result of decreasing flow rate the fractional flow of co 2 at each radial distance increases when more volume is injected which makes the r v c a dynamic variable an increase in the co 2 fractional flow leads to an increase in the capillary flux and therefore a decrease in the r v c as a result the system moves towards the cl with time fig 12 in the vl the viscous pressure gradients are overwhelmingly large and the capillary flux becomes extremely small compared to the viscous flux and can therefore be neglected therefore in the true vl p c is not necessary for upscaling and using p c 0 and the vl κ r α curves will lead to the same results however figures 7 8 9 10 show that unrealistically high velocities are needed to move the system into the vl indicating that the vl solution should not be used to model the migration of the co 2 plume in case of horizontally layered systems whether the cl solution is valid depends on the velocity at which the system transitions into the cl if this transition velocity is higher then the velocities observed in the reservoir the cl solution can be used otherwise the incorporation of flow rate dependency will become important r v c tells us that this transition happens at relatively low flow velocities for systems with a low average capillary flux and a low aspect ratio we therefore used the saturation functions of a ratio 10 in the extended bl model the graphs on the left in figure 11 show the effective fractional flow curves for flow rates between the cl and vl here we can see that the transition from the cl to vl happens at lower velocities when the absolute permeability in the transverse direction are low and for low permeability ratios which are two factors that result in a low average capillary flux due to the capillary flux of co 2 into the high permeable layer the relative permeability of the co 2 phase increases when the systems transitions from the vl to the cl while the capillary flux of water into the low permeable layer reduces the relative permeability of the water phase as a result the plume travels further when the system moves towards the cl this can clearly be seen from the graphs on the right in figure 11 which show the saturation profiles after 1261440m 3 of co 2 is injected using the vl solution the cl solution and the capillary number dependent solution for three different injection rates for the realistic injection rate of 0 04m 3 s the cl and the flow rate dependent saturation profiles overlap for all cases considered because each entire system from close to the well all the way to the front of the plume transitions into the cl for system 1 and 3 this happens after 0 6 and 7 8 of the total volume is injected respectively fig 12 left for the very high injection rate of 0 4 m 3 s flow rate dependency is only observed for system 3 with a low absolute permeability in the transverse direction and the low permeability ratio due to the low capillary flux of this system the system remains in the transition regime during the entire injection period fig 12 for the unrealistically high injection rate of 4m 3 s all of the systems considered remain in the transition regime during the entire injection period as can be seen for systems 1 and 3 in figure 12 this work shows that in horizontally layered radial systems at commonly used injection rates and volumes flow rate dependency is only important during the initial phase of the injection period on the order of days to months if the objective is the prediction of the lateral extent of the plume at the end of the injection period it will be valid to use the cl saturation functions even close to the injection well our observations are very similar to those obtained in the extensive numerical study on the impact of small scale heterogeneity on fieldscale plume migration presented by jackson and krevor 2020 they show that most of the system can be effectively modeled at the cl apart from close to the wellbore realistic reservoirs will consist of many different types of heterogeneity and structures including layers perpendicular to the flow direction in such cases the system is pushed out of capillary equilibrium at each boundary this results in capillary number dependency at much lower flow rates the focus of our future work will be applying a similar fractional flow approach to vertically layered systems 9 conclusion a new physics based model has been developed that can obtain effective flow rate dependent relative permeability and capillary pressure functions in horizontally layered systems over the full velocity range analytically for this purpose a new capillary number r v c has been derived that correctly captures the viscous capillary force balance for horizontally layered systems by incorporating both the water and co 2 capillary flux as a function of saturation this new capillary number can accurately determine when it is valid to use either of the asymptotic solutions if r v c 0 025 the cl is reached and if r v c 40 the vl is reached the model is based on the fractional flow approach and the obtained effective flow rate dependent fractional flow functions can be implemented into an extended radial buckley leverett solution to look at the impact of mm m scale heterogeneity on the frontal advance of the co 2 plume the local r v c in the case of radial buckley leverett systems is a function of two competing factors the fractional flow of co 2 and flow rate both factors decrease with radial distance and the fractional flow of co 2 increases with time a decrease in the fractional flow of co 2 moves the system towards the vl while a decrease in flow rate moves the system towards the cl the counterbalance between those two factors determines together with the absolute permeability the permeability ratio and aspect ratio of the layers when and where the vl to cl transition occurs when the system transitions from the vl to the cl the relative permeability of the co 2 phase increases while the relative permeability of the water phase decreases as a result the co 2 plume travels further when the system moves towards the cl our work shows that for injection rates and volumes commonly used at injection sites the cl is reached quickly suggesting that flow rate dependency is only important during the initial phase of the injection period if the objective is the prediction of the lateral extent of the plume at the end of the injection period the use of cl saturation functions will be valid even close to the injection well the theory presented here is very general and can be applied to a wide variety of systems with different interfacial tensions and mobility ratios one could expect very different behaviors for each of these systems this will be investigated in future work credit authorship contribution statement maartje boon methodology writing original draft visualization sally m benson conceptualization writing review editing supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this study is a contribution to geocquest a bhp supported collaborative project of the university of melbourne australia the university of cambridge uk and stanford university usa aimed at developing a better understanding of small scale heterogeneity and its influence on co2 migration and trapping mechanisms the authors would like to thank bhp for providing project funding appendix a macroscopic capillary numbers n c t and n c v i r n o v s k y for the sake of comparison the normalized co 2 saturation eq 21 is plotted as a function of the previously used macroscopic capillary numbers n c t and n c v i r n o v s k y eq 1 and 3 in figure 3a and b respectively to obtain n c t a characteristic capillary pressure p c is calculated for each layer defined as zhou et al 1997 48 p c s w i r r 1 p c s w d s 1 s w i r r and characteristic relative permeabilities are calculated for each layer as 49 κ r α s w i r r 1 κ r α s w d s 1 s w i r r the average relative permeability in the transverse direction κ r α a v e z is calculated by taking the weighted harmonic mean of the characteristic relative permeability eq 49 of the low and high permeable layer the capillary pressure gradient δ p c is calculated from the difference between the characteristic capillary pressure eq 48 of the low and high permeable layer divided by the layer thickness κ r α a v e z and δ p c are used in equation 1 to obtain n c t to obtain n c v i r n o v s k y the same capillary pressure gradient δ p c as calculated for n c t is used the viscous pressure drop δ p is calculated from the darcy equation for the water phase eq 5 using the average absolute permeability in the principal direction and the average water relative permeability in the principal direction κ r α a v e x which is calculated by taking the weighted arithmetic mean between the water relative permeability of the low eq 28 and high eq 27 permeable layer at each particular fractional flow δ p c and δ p f w are used in equation 3 to obtain n c v i r n o v s k y appendix b brooks corey vs vangenuchten type of saturation functions the presented physics based model requires vangenuchten type of saturation functions where p c 0 at s w 1 to ensures p c continuity however for the more commonly used brooks corey type of functions the p c p e at s w 1 to look at the impact of the different saturation functions on the lateral migration of the plume numerical simulation are run using the reservoir simulator eclipse schlumberger geoquest 1261440m 3 of co 2 is injected into a radial reservoir of 20m thickness and a radial distance of 2000m at a constant injection rate of 0 04m 3 s the grid cell size in the radial direction is dr 1m a constant pressure boundary exists at r 2000m while no flow boundaries exist at the top and bottom simulations are run for systems 1 4 table 1 using both the vangenuchten and brooks corey type of saturation functions which can be seen in figure 13 a kink in the upscaled brooks corey curves arises when the capillary pressure drops below the entry pressure of the low permeable layer and the low permeable layer becomes fully saturated with water it is clear from figure 13 that there is no significant difference in the lateral extent of the plume in horizontally layered systems when the brooks corey curves are used compared to the vangenuchten curves this can be explained by the fact that even when vangenuchten type of functions are used in the case of high permeability ratios the saturation in the low permeable layer is close to 1 as can be seen in figure 2a and the flow of co 2 is almost entirely through the high permeable layer appendix c the presented physics based model to derive flow rate dependent saturation functions can be used to incorporate the impact of mm m scale horizontal lamination into larger scale reservoir models as long as the grid cell size of the model is sufficiently small such that at the scale of the grid cell gravity effects can be neglected the scale at which gravity effects can be neglected depends on the system figure 14 shows the saturation in the layers at gravity capillary equilibrium for each of the systems of table 1 the capillary pressure at gravity capillary equilibrium is defined as 50 p c p c 0 δ ρ g z where p c 0 is the capillary pressure at z 0 δ ρ ρ w ρ c o 2 is the difference in fluid density kg m 3 g is the gravitational acceleration m s 2 and z is the height m each colored line in figure 14 represents a different p c 0 ranging between p e of the low permeable layer to 10 times p e of the low permeable layer a larger p c 0 corresponds to a greater column height of co 2 below the system gravity can be neglected as long as the saturation profile of the grid cell stays symmetric figure 14 shows that this is the case for all p c 0 for systems 3 and 4 however for system 1 and 2 the saturation profile is asymmetric for the lower values of p c 0 but becomes more symmetric with increasing p c 0 this shows that systems 1 and 2 will require a smaller grid cell size than systems 3 and 4 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103881 appendix d supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
333,permeability characterises flow in porous rocks media for upscaling while steady state flow fields allow analysis of reactive transport fines migration and tight unconventional rocks fast calculation of permeability and flow fields obtained from pore network models pnm and laplace semi analytical solvers sas deviate from computationally demanding simulation of navier stokes equations nse due to flow and geometry simplifications coupling pnm sas with direct simulation via lattice boltzmann method lbm provides 5 150 speed up without accuracy loss over 100 samples from 0 7md to 3 5d permeability errors in pnm sas show 10 20 up to 50 70 error pnm shows higher variance from geometric simplifications compared to sas which only makes flow based assumptions pnm sas errors are eliminated by coupling with lbm at a fraction of lbm only compute cost steady state conditions with pnm sas lbm are reached in 2 000 timesteps compared to lbm only which can require 10 5 timesteps in tight domains such as cemented sandstone carbonate coal and shale keywords pore scale permeability pore network models laplace solvers lattice boltzmann methods 1 introduction the flow of fluid within the void space of porous structures is a physical phenomenon that is pervasive in its occurrence with applications in catalysis keil and rieckmann 1994 groundwater hydrogeology oil and gas extraction environmental waste management fenwick and blunt 1998 hilpert and miller 2001 blunt et al 2002 culligan et al 2006 mostaghimi et al 2010 2016 blunt 2017 carbon capture storage blunt et al 2013 and unconventional rocks chen et al 2015 sun et al 2012 these examples highlight the need to accurately capture the physics of fluid flow within porous media this is typically characterised by the permeability which averages flow contributions in the pores to a single value for use in darcy scale modelling there are however also many instances where the flow field in the pore space is itself required for further pore scale analysis of transport phenomena including dispersion mostaghimi et al 2012 reactive transport liu and mostaghimi 2017b 2017a mostaghimi et al 2016 liu et al 2018 and fines migration cheng et al 2018 where the underlying velocity field is used for further simulation these permeabilities and flow fields can be obtained by direct simulation of flow within the resolved pore space of porous media or estimated by simplified methods based on certain assumptions regarding physics and geometry in the pore space direct flow simulation by solving the navier stokes equation nse explicitly offers the highest level of accuracy with the finest degree of detail projecting directly into the domain this can be performed by finite method solutions of the nse white et al 2006 sun et al 2010 sandino et al 2014 song et al 2004 raeini et al 2015 geiger et al 2004 mahbub et al 2020 or by lattice boltzmann methods lbm that also solve the nse mcclure et al 2014 manwart et al 2002 spaid and phelan 1997 stewart et al 2006 boek and venturoli 2010 chen et al 2015 hao and cheng 2009 keehm et al 2004 wang et al 2020a these techniques require significant compute time and memory the computational issues with these methods arise due to them being a time dependent and or b non linear iterative lbm is time dependent nse is both time dependent and non linear in porous media the simplified steady state stokes equation mostaghimi et al 2013 is commonly used instead of the full nse as porous media flow occurs under low reynolds number regimes this stokes equation is linear and time independent but requires iteration to solve due to weak pressure velocity coupling in this study the term steady state refers to the point in which flow simulation converges such that time stepping and or iterations become static furthermore in porous media where steady state solutions are sought after the convergence rate of direct flow simulation to these steady state conditions is also dependent on the geometric complexity of the porous media as such direct simulation of steady state fluid flow in complex geometries i e porous media is a computationally challenging task due to slow convergence in tortuous flow paths this has led to the proliferation of simplified models such as the pore network model pnm blunt et al 2002 rabbani and babaei 2019 dong and blunt 2009 dong et al 2008 delerue et al 2003 and the laplace semi analytical solver sas chung et al 2019 wang et al 2019 2020b torskaya et al 2014 shabro et al 2012 arns and adler 2018 akanji and matthai 2010 while these pnm and laplace sas methods are adequate for predicting the overall permeability of a given pore space saxena et al 2017 the actual velocity fields are also important in many applications as outlined in the previous paragraph the pore space can be represented in a significantly simpler manner by pnms as a collection of chambers pores connected by throats reducing the computational cost significantly at the cost of obtaining an abstraction of the true velocity and pressure fields averaged over simplified geometries of the pore space assuming the pore network itself is generated in a physically representative manner this is typically adequate for the purposes of permeability estimation due to the decomposed nature of pnms these velocity and pressure fields are then projected back into the pore space but as this study will indicate the loss of spatial information is generally too great for these projections to be useable without some correction in this case by direct simulation a middle ground exists between the pnm and direct simulation in porous media called semi analytical solvers sas which are typically derived in the form of a time invariant linear laplace partial differential equation solvable by finite methods the analytical part of the method arises from the need to characterise a conductivity within the pore space using some geometric approximations or otherwise leading to a reduction in flexibility and accuracy in certain geometries outside the scope of the analytical assumptions while errors occur due to the analytical assumptions necessary to characterise the conductivity term in laplace sass the solution is mapped directly to the domain space a common analytical assumption used to generate the conductivity map in laplace sas is poiseuille like flow within the pores chung et al 2019 shabro et al 2012 which has been shown to be a reasonable approximation in conventional rocks to obtain both a permeability estimation and a continuous flow field other analytical solutions have been proposed akanji and matthai 2010 arns and adler 2018 but all suffer from non generality only giving reasonable estimates of flow with errors accumulating in regions of non poiseuille flow such as junctions fractures and elliptical pore channels in this study steady state velocity and pressure fields are computed on test dataset of 100 samples from the deepore set rabbani et al 2020 using a pnm method rabbani and babaei 2019 combined with a velocity and pressure projection algorithm and a laplace sas the pfvs method chung et al 2019 estimates of permeability from underlying velocity fields obtained from pnms and laplace sass tend to deviate from direct simulation due to non physical velocity fields as such these flow fields and their permeability predictions are first compared to results obtained from lbm simulations mcclure et al 2014 wang et al 2020b and then used as initial conditions to accelerate lbm simulations to reach a steady state result in a fraction of the compute time this technique serves to couple together predictions of fluid flow fast limited accuracy with direct flow simulation slow high accuracy and has been successfully used in other cases with velocity predictions from deep learning wang et al 2020c wang et al 2021 which differ from the usual methods of only permeability estimation tian et al 2020 or techniques that couple lbm to the pnm domain rabbani and babaei 2019 zhao et al 2020 this implementation couples pnm laplace to the lbm domain instead the speed up achieved is analysed and it is shown that speedup factors in the order of 5 to 150 are achieved for tight low permeability domains that would otherwise take lbm timesteps of the order of 105 to 106 which depending on the domain size and algorithmic efficiency can span over several days this technique allows permeability estimates to be direct simulation level accurate in a fraction of the direct simulation only compute time and importantly allows crude and inaccurate estimates of velocity fields from pnm pfvs to become physically accurate with minimal extra compute time allowing more efficient transport modelling of reactive transport fines migration and any transport phenomena in rocks and porous media that utilises underlying steady state flow fields 2 materials and methods a set of 100 3d volumes of porous media is used in this study taken from the first 100 samples in the deepore testing dataset rabbani et al 2020 these domains have been extensively analysed for their petrophysical properties and are chosen to represent a wide spectrum of possible porous media of carbonate and sandstone rocks with permeability spanning 4 orders of magnitude with fig 1 showing 5 examples of the 100 domains used featuring a wide range of permeability and a broad variation in pore structure during simulations all samples in this study are assumed to have a voxel length of 1 micrometre resulting in a sample of length 0 256 mm3 2 1 pore network models a pore network model is constructed by first identifying the pores and throats of a porous medium this is done by firstly performing watershed segmentation on the distance map of the porous media shown in fig 2a to c the resulting regions are then converted into pores with throats represented by the 2d cross section between adjacent pores and connectivity between adjacent pores are recorded in a connectivity matrix fig 2d the contact line between adjacent pores and the pore wall forms a throat of arbitrary cross section and the conductivity k t h r o a t of this 2d cross section is estimated from a quadratic correlation based on the mean distance of each throat cross section to the wall d of the form k t h r o a t 1 342 d 2 0 913 d 0 381 rabbani and babaei 2019 from this constructed pnm the overall permeability of the domain can be estimated by solving for the pressure in each pore chamber by assuming steady state incompressible flow occurs through the throats between each pair of pores fig 2e by taking the throat conductivity w 1 2 and pressure difference between the centers of two connecting pore chambers δ p 1 2 p 2 p 1 the average fluid flow rate is obtainable at steady state conditions by q w δ p in order to obtain the pressure at each voxel of the pore space geometry fig 2f voxels containing pore body labels fig 2c are replaced with the corresponding pressure obtained from pore network simulation fig 2e the transitions between the pressure of the pores at their intersections is then smoothed with 20 passes of a averaging filter with kernel size of 3 3 fig 2g as an example to illustrate the effect of pressure smoothing a hypothetical pathway from point a to point b is assumed in the pore space fig 2e to g the changes of pressure vs distance between these two points are schematically presented in fig 2h to j as can be seen step wise changes in the pressure of the discrete map is converted to a gradual variation in fig 2j while the inlet and outlet pressures are kept constant the conservation equation for pnms is not capable of producing vector velocities at the voxel scale and in most applications pnms are used without these local velocity estimates to properly couple together pnm and lbm at the direct simulation level a method of projecting the pnm velocities calculated at the throats to the entire pore space is required in this study we utilise a method described below and evaluate its efficacy in accelerating lbm simulations to steady state it should be noted that this methods of projecting pnm velocity fields to the pore space is a non unique process and so it is entirely possible that a different algorithm could give a different and or improved local velocity field even with the same underlying pnm the velocity magnitude at the centre of each pore chamber is calculated by adding up the magnitude of all incoming flow velocities then we assign this central magnitude to all the voxels of the image located inside the pore chamber this operation creates a discrete map of velocity magnitudes in pore space which goes to a smoothing process similar to the pressure also the unit vectors of velocity map are obtainable by calculating the gradient of the smoothed pressure distribution in the pore space fig 2g finally multiplication of the magnitude and unit vectors of the velocity generates the complete set of projected velocity vectors for each voxel of the pore space 2 2 laplace semi analytical solvers an elliptic diffusion equation also known as the laplace pde of the form w p 0 is used to obtain the spatial pressure distribution and velocity field and hence estimate the absolute permeability if formulated carefully the resulting pressure and velocity fields are also reasonable estimates that obey certain criteria i e no slip parabolic velocity profiles incompressible steady state flow etc this method is relatively cpu time efficient compared to direct simulation as it does not require time stepping or iteration of non linear terms to converge to a solution speed is related only to the domain size and discretisation method resources available and the matrix inversion method used the single major error source arises from the need to provide an analytical solution to the conductivity field the coefficient field w in the laplace pde which is shown in fig 3 in this study the laplace semi analytical solver used is the pfvs method chung et al 2019 2020b wang et al 2019 chung et al 2020a the laplace pde is solved with prescribed constant pressure dirichlet boundary conditions on the inlet and outlet by using two point flux approximation tpfa aarnes et al 2007 lie et al 2012 and finite volume methods with an algebraic multi grid amg solver all solid voxels are removed from the system of equations resulting in a smaller system matrix most importantly for laplace sass the coefficient field w plays a key role in the semi analytical description of the method this field is prescribed analytically by a series of correlative relationships that can vary between implementations and use cases shabro et al 2012 arns and adler 2018 akanji and matthai 2010 in pfvs under the assumptions of laminar incompressible flow and no slip boundary condition the local conductivity w is defined as a weighting function representing the conductivity of a voxel for fluid flow it is a function of two variables the largest inscribed radius of the flow channel d max and the distance from the solid wall d 1 w α r 2 ρ 8 μ 2 d max d d 2 where w is local conductivity α is a shape factor r is the image resolution d max is calculated by an iterative 3d algorithm chung et al 2020a ρ is fluid density and μ is fluid viscosity it should be noted that the largest inscribed radius of the flow channel d max is similar to the various methods of pore throat chamber identification used in pnms to convert the pore space into the pnm instead of using d max for geometric simplification and identification of pores and throats it is used directly for calibrating the conductivity field in the pore space itself bridging the gap between pnm and direct simulation techniques 2 3 lattice boltzmann method flow within the pore space is calculated by the lattice boltzmann method lbm using a multi relaxation time mrt scheme in d3q19 quadrature space wang et al 2020b in order to eliminate spurious parameter coupling between viscosity and permeability that occurs with single relaxation time srt and improve stability in high velocity pore throats problems outlined in detail in yang 2013 lbm reformulates the navier stokes equations nse by numerically estimating the resulting continuum mechanics from underlying kinetic theory because lbm solves the nse time stepping is required unlike finite methods solving nse that require iteration mostaghimi et al 2013 lbm is completely linear in its operations and as such is highly parallelisable and relatively simpler to implement on gpus ovaysi and piri 2012 mcclure et al 2014 nonetheless the resources required to compute lbm steady state solutions are an order of magnitude or more greater than pnms or laplace sass rabbani and babaei 2019 chung et al 2019 the kinetics of a bulk collection of particles within a control volume is estimated with a vector velocity space ξ q and velocity distributions f q for each velocity space vector ξ q the velocity component in the specified direction is given by f q the momentum transport equation at location x i over a timestep δ t takes the form in eq 2 that relies on a collision operation j which recovers the navier stokes equation and outlined in detail in mcclure et al 2014 2 f q x i ξ q δ t t δ t f q x i t j x i t single phase flow is simulated within the pore space of the segmented test samples until steady state conditions are reached this is measured by tracking changes to the sample permeability k by eq 3 3 k μ v l δ p x where μ is the kinematic viscosity v is the mean velocity within the bulk domain l is the length of the sample in the direction of flow and δ p is the pressure difference between the inlet and outlet the permeability of any given porous media is a constant value at steady state conditions when the velocity fields and the pressure fields become time static in this case simulations are run until the change in permeability over 1 000 lbm timesteps k t δ t k t k t δ t 1000 is less than 10 5 all samples are simulated with a constant pressure drop between the inlet and outlet and wall boundary conditions no slip are imposed along the other sides to avoid geometric inconsistencies associated with periodic boundary conditions these boundary conditions and fluid properties are also used for the pnm and laplace sas simulations by taking the pressure and velocity fields estimated from pnm and laplace sas methods outlined in the previous sections of this study lbm simulations can be initialised closer to steady state conditions compared to the typical initialisation of zero velocity pressure gradient which is what this study uses zero velocity uniform pressure is also a common initial condition since the pnm and laplace sas methods are projected directly onto the pore space there is a one to one spatial mapping though the pnm solution needs special preprocessing as outlined in section 2 1 3 results and discussion in this section the comparative accuracies of pnms laplace sass against lbm are first compared and then these methods are coupled together to accelerate lbm simulations to steady state conditions at a fraction of the compute time this speed up factor is measured over the 100 samples and the major influencing factors are investigated the laplace sas used in this comparison is the pfvs method outlined previously in section 2 2 and henceforth pfvs is used to refer to laplace sas results in the following sections 3 1 accuracy of pnms sass and coupling to lbm in terms of accuracy measurement both the permeability and the velocity probability density function pdf are calculated this is to identify both the overall accuracy represented by the permeability and the accuracy of the velocity field distribution itself the permeability is commonly the primary value of interest in digital petrophysics as it is used in larger scale flow equations featuring darcy s law lie et al 2016 aside from the single value of permeability one of the benefits of simulating flow in the pore space is the velocity fields themselves which can be used for modelling of other transport phenomena relating to advection dispersion diffusion reactions mostaghimi et al 2016 liu et al 2018 2017 liu and mostaghimi 2017a mostaghimi et al 2012 wang et al 2020c and as such the accuracy of the velocity fields themselves are an important feature to analyse when comparing pnm pfvs against direct simulation finally the proposed coupling process of using these pnm pfvs flow fields to initialise direct simulation is validated in terms of accuracy compared to only direct simulation for the 100 samples the permeability obtained from pnm and pfvs is compared to the lbm permeability and as validation of the preconditioning the pnm lbm and pnm pfvs results are also compared to lbm only seen in fig 4 comparison of the pnm and pfvs permeability predictions against lbm shown on the left and middle of the figure indicates that typical errors can reach up to 50 70 hovering usually around the 10 20 range pfvs shows a smaller spread of error compared to pnm indicating the improved accuracy achievable from solving for flow on the original domain with simplified physics based on geometric assumptions of cylindrical flow compared to the pnms that simplify the domain directly both techniques perform best at the intermediate permeability range of 100 md 1 micrometre voxel resolution and pnms tend to overpredict at higher permeabilities and underpredict at lower permeabilities while pfvs maintains consistent accuracy at lower permeabilities down to 1 md and tends to underpredict at higher permeabilities one reason for these trends is likely the geometric assumptions made in the pnm and pfvs methods and how these assumptions deviate from the actual geometry of the 100 samples at higher and lower permeabilities in the case of pfvs the pore space of tighter structures is characterised by only a few voxels in diameter in many pore channels and as such approximations of cylindrical flow incurs less error as velocities are mapped to only a few voxels on the other hand in more open samples with comparatively higher permeability flow channels tend to transition from cylindrical structures to networks of flow with many pores interconnected see fig 6 where the influence of the pore wall arises from multiple wide open pore junctions making the conductivity approximation of pfvs see eq 1 less valid over more pore voxels causing underestimation of velocity in these regions overprediction by pnms in high permeability samples may occur due to increased pore to pore connectivity and misrepresentation of throat permeability with respect to the geometry of adjacent chambers similarly at the low end of permeability pnms may struggle with capturing the geometry of tighter samples without some tuning and calibration these error sources from inadequate analytical characterisations of conductivity in pfvs to pnm calibration sensitivity are mitigated by coupling to lbm as a preconditioner since final achieved accuracy will always match that of lbm itself see figs 6 8 errors in the velocity fields of the projected pnm velocity fields and the pfvs velocity fields are measured by calculating the normalised velocity probability density functions pdfs of the normalised velocity distribution v 1 v v v d v this is shown in fig 5 for the same 5 example samples shown in fig 1 that range from low to high permeability the velocity pdfs show clearly that the pnm projection technique struggles to identify sparsely occurring high velocity regions which is expected given the simplified geometry in which the pnm is constructed furthermore the velocity pdfs of pnms also show higher variance at all magnitudes indicating that the projected pnm velocity values are more discretised than lbm and pfvs fields compared to the lbm velocity pdf pfvs and pnm pdfs tend to deviate lower than the lbm pdf indicating that these methods underestimate the overall influence of mid to higher velocity regions such as throats due to how pnm and pfvs will simplify these regions with geometry changes pnm and flow assumptions pfvs these large errors in velocity distribution are mostly eliminated by pnm pfvs lbm and as such indicate that both the permeability and velocity fields are adequately accurate compared to lbm only of note is that the chosen convergence criteria of k t δ t k t k t δ t 1000 10 5 does not appear to be adequate for samples with very low permeability using pnm lbm this is due to both the less spatially accurate projected pnm velocity field compared to the pfvs field see figs 5 and 6 as well as the tighter porous domain requiring more time to reach steady state conditions as such it is important to probe the extent of convergence and speed up to steady state in a robust manner which is explored in the next section permeability results of these 5 example samples from the dataset of 100 also follow the expected trends seen from fig 4 with pfvs giving generally accurate estimates from 1 md up to 1 d and underestimating permeability at higher values pnms are seen to underpredict in tight samples and overpredict in open samples performing best in the 10 1 000 md range these deviations in velocity fields between pnms pfvs and lbm caused by their geometric assumptions and simplifications cause a higher degree of local variation in velocity field compared to what would otherwise be a perhaps 10 deviation in overall permeability these local deviations in velocity field can be seen in fig 6 which show the pnm pfvs and lbm velocity fields for the 5 example samples shown in fig 1 it is clear from visual inspection of rendered velocity fields that first of all from fig 6 that projected pnm velocity fields obtained from projecting the pnm solution back into the pore space show significant differences to the lbm result the projected pnm velocity field shows signs of the pnm itself in the way that velocity regions are separated into clouds roughly in the shape of the pore chambers used to generate the pnm these visual findings are consistent with the higher variance and lack of high velocity signatures in the projected pnm velocity pdfs in fig 5 this projected pnm velocity field is unusable for further transport phenomena modelling but the permeability obtained from this model is within satisfactory error bounds see fig 4 and using these velocity fields as an initial preconditioner for lbm returns direct simulation level accuracy at a fraction of the compute time see next section 3 2 comparing the pfvs velocity fields with lbm shows a better visual match compared to pnm in fig 6 but clear differences can be identified throughout difference maps identify errors as occurring throughout the sample as small differences in velocity but main sources of error occur in the pore throats and high velocity flow paths this mid to high velocity deviation is again consistent with velocity pdf comparisons in fig 5 both pfvs and lbm velocity fields are mass conservative continuous and obey no slip wall conditions as such pfvs velocity fields can be used for further transport phenomena simulations albeit the errors in the throat regions of the underlying velocity field will result in error accumulation 3 2 speedup and influencing factors in the previous section the relative accuracy of pnm pfvs and lbm in terms of both permeability and velocity field shows that there is merit in minimising these errors with direct simulation fig 4 shows that coupling pnm and pfvs estimates to lbm as a preconditioner is stable and will achieve identical steady state results to lbm only in this section the speedup achieved is analysed and contributing factors are discussed firstly the lbm simulation time between lbm only and coupled pnm pfvs lbm is analysed then the real time speedup is analysed and discussed with respect to steady state convergence program optimisation and available hardware a plot of the permeability over simulation time in fig 7 shows that over the 5 example samples see fig 1 the pnm pfvs lbm simulations begin at a reasonable initial preconditioned estimate and remain stable over the simulation to convergence lbm only instead requires significant simulation time to reach the same level of accuracy as the initial pnm and pfvs estimates as such pnm lbm and especially pfvs lbm would only require a fraction of the time to reach acceptable permeability and velocity field estimates of steady state flow compared to lbm only the convergence criteria used in this case of k t δ t k t k t δ t 1000 10 5 appears to be excessive for pnm pfvs lbm which visually show earlier convergence reaching plateau at an earlier time than the convergence criteria would otherwise suggest analysis of simulation time and permeability in the left hand side plot in fig 8 shows a strong correlation between sample permeability and simulation time required to reach steady state tighter samples with low permeability in this dataset of 100 samples require up to 100 000 to 1 000 000 lbm timesteps to converge to steady state the speedup achieved between lbm only and pnm pfvs lbm hovers roughly between 2 to 3 for convergence defined as k t δ t k t k t δ t 1000 10 5 reaching up to 10 in some cases pfvs lbm shows slightly faster convergence compared to pnm lbm which is expected based on their respective initial velocity fields see previous section since pfvs initial estimates are significantly closer to the lbm final result than the pnm initial estimate given the rather poor and inaccurate velocity field estimate given by pnms see previous section the speedup of pnm lbm is compelling since the final result is as accurate as direct simulation due to the faster plateau achieved by pnm pfvs lbm seen in fig 7 it is prudent to investigate how these simulations behave when the convergence criteria is set to a higher value such as 0 1 instead of 10 5 the middle plot in fig 8 shows this with pnm pfvs lbm and lbm only set to report permeability at k t δ t k t k t δ t 1000 0 1 the plots show that pfvs lbm set to 0 1 convergence achieves near perfect accuracy for all 100 samples compared to lbm only set to 10 5 convergence with pnm lbm 0 1 posting similar albeit slightly lower accuracy lbm only 0 1 on the other hand compares poorly to lbm 10 5 in permeability accuracy a given considering the overall slower convergence shown in fig 7 the pnm pfvs lbm 0 1 results compares favourably to the initial accuracy of pnm pfvs fig 4 indicating that a small lbm simulation time is required to correct errors in estimation this is supported by the right hand side plot in fig 8 showing that only 2 000 lbm timesteps or less since the data is logged in intervals of 1 000 are required to reach the 0 1 convergence criteria for all 100 samples tested over the entire permeability spectrum as such the speedup achieved by pnm pfvs lbm 0 1 ranges from around 5 all the way up to 150 while preserving the permeability accuracy of lbm only 10 5 this speed up becomes more predominant the lower the permeability of the sample which becomes increasingly important the tighter the domain is 3 3 convergence criterion analysis it is important to explicitly investigate the velocity field accuracy and the local steady state conditions for the simulation routines in this study this is necessary as the convergence criteria chosen for this study of k t δ t k t k t δ t 1000 1 e 5 does not necessarily guarantee steady state conditions at the local velocity field level as such the mean and max absolute velocity change is tracked for the lbm only pnm lbm and pfvs lbm simulations 300 simulation runs over 100 samples without any convergence but instead for 10 000 000 lbm timesteps which is taken as the ground truth steady state velocity field over the 100 samples in this study using lbm only the mean achieved convergence criteria for these samples in terms of k t δ t k t k t δ t 1000 is 1 48 10 8 and the mean local relative velocity convergence error as calculated by v t δ t i v t i v t i δ t 1000 is 6 58 10 6 for pnm lbm solved to 10 000 000 timesteps the values are respectively 1 17 10 8 and 6 70 10 6 for pfvs lbm solved to 10 000 000 timesteps the values are respectively 1 19 10 8 and 4 43 10 6 based on these values it is reasonable to conclude that these 10 000 000 timestep simulations are representative of ground truth steady state conditions for different convergence criteria table 1 lists the mean local velocity convergence achieved for different permeability convergence criterion on average at a permeability convergence criteria of 10 5 the velocity convergence is 3 5 10 3 for lbm only 5 3 10 3 for pnm lbm and 5 4 10 3 for pfvs lbm and at a permeability convergence criteria of 0 1 the velocity convergence is is 1 98 for lbm only 0 148 for pnm lbm and 0 151 for pfvs lbm based on these results velocity fields tend to converge at a slower rate than permeability calculations due to smearing effects this difference is shown in table 1 which lists the mean local velocity convergence achieved for different permeability convergence criterion it is clear that a more accurate steady state velocity field requires more than the 2 000 lbm timesteps that pnm pfvs lbm 0 1 need to achieve a permeability calculation match to lbm only the speedup factor for steady state velocity field simulations is thus better represented by pnm pfvs lbm 10 5 which posts a speedup factor of between 2 3 over the entire spectrum of permeability convergences 0 1 to 10 14 fig 10 shows the simulation time vs convergence criteria of lbm only and pnm pfvs lbm important to note is that lbm only is inaccurate at low convergence criteria fig 8 and from 10 2 to 10 7 pnm lbm posts a speedup while from 10 2 to 10 12 pfvs lbm posts a speedup factor speedups disappear as the trailing digits converge at a similar rate this effect occurs earlier in pnm lbm due to the lower accuracy in initial estimate overall compared to the long timeframe lbm simulations to 10 000 000 timesteps shorter simulations that use the convergence criteria of k t δ t k t k t δ t 1000 1 e 5 0 1 show a good match in the spatial distribution of velocity shown in figs 5 9 and 11 this breaks down at the lowest permeability samples 1 10 md which report near identical permeability matches between pnm lbm 0 1 10 5 vs lbm only 10 5 10 000 000 timesteps but show overly smoothed velocity fields as expected while preconditioning with pnm pfvs can eliminate permeability deviation from lbm with minimal extra computing effort the speedup to steady state velocity fields is more sensitive to the heterogeneity tightness of the domain for very low perm samples a poorer initialisation pnm projected velocity fields can result in lingering smoothness in the flow field finally to support the steady state convergence analysis performed thus far with local velocity convergence criterion table 1 and probability density function analysis of selected samples fig 11 the mean median local relative velocity error is calculated and reported in fig 12 this metric is calculated between 2 velocity fields the estimated field v i and the ground truth field v g t as m e d i a n v i v g t v g t this is done to better represent the spatial velocity distribution which is heavily skewed to the left with very high velocity outliers results averaged over the 100 samples show consistent accuracy in line with previous figures with pnm showing highest errors lbm 0 1 showing insufficient time for simulation convergence pnm pfvs lbm 0 1 showing higher deviation from true steady state and finally the 10 5 results showing steady state level accuracy most deviations occur in very low permeability samples and especially to pnm lbm see fig 11 3 4 influence of hardware and software implementation while it is clear that on identical hardware and the same programming language and style pnm pfvs solves flow faster than direct simulation it should be noted that this may not always be the case if hardware and software implementations of pnm pfvs and lbm differ too much indeed this study has applied a pnm implementation written in matlab rabbani and babaei 2019 a laplace sas pfvs implementation written in matlab with a c accelerated multigrid solver chung et al 2019 wang et al 2019 chung et al 2020b 2020a and a mpi cuda c lbm mrt implementation that is cpu gpu parallelisable to hpc clusters mcclure et al 2014 wang et al 2020b pnm domains are highly simplified and as such do not require significant optimisation to achieve fast simulation times in the order of seconds rabbani and babaei 2019 on a single cpu core at 3 ghz for the 100 samples tested in this study and have minimal memory requirements in the order of 1gb though in this case extra cpu time overhead is required to smooth and project the velocity and pressure fields into the pore space which takes roughly 60 s which takes roughly 5 times longer than the actual pnm solution itself they can also be parallelised effectively with domain decomposition both for construction and simulation of the pnm rabbani et al 2019 sun et al 2012 for larger domains laplace sas methods such as pfvs ultimately need to invert a matrix of size n by n where n is the number of pore voxels to reach a solution and require workstation grade 8 16 cores cpu time in the order of minutes to solve the 100 samples one limitation of laplace sas methods is the poor memory scaling of the solution matrix 103 to 106 during unpacking which requires roughly 10 gb in memory for these tested samples but can quickly balloon past 100 gb in larger domains though domain decomposition and irregular meshing can alleviate these issues wang et al 2019 chung et al 2020b thus both pnm and pfvs as initial estimators of flow tend to be viable with use on cpu workloads on ordinary workstations with 4 to 16 cores implemented on relatively slow and inefficient programming languages on the other hand direct simulation methods such as lbm require peak optimisation and parallelisation to reach acceptable compute speeds the potential exists for further optimisations that may bring down the simulation time of pnm pfvs by 1 2 more orders of magnitude matlab to c migration mpi implementation etc lbm implementations can span from simple matlab code rabbani and babaei 2019 to parallel c latt et al 2020 to gpu accelerated parallel c mcclure et al 2014 wang et al 2020b in 3d porous media of reasonable size domains such as the samples in this study these implementations can range from hours days for a solution matlab to requiring 10 100 cpu cores to achieve minute hour level speed parallel c to requiring only a few gpus to reach minute level speeds parallel gpu c so far this study has used the lbm timesteps as a hardware software agnostic measurement of speed that only takes into account the discrete mathematics of the method itself translating the lbm timesteps to cpu time requires knowing the number of lattice updates per second lups whereby the cpu time is equal to the number of pore voxels times the number of timesteps divided by the lups value commonly measured in million lups mlups the implementations outlined above span orders of magnitude a basic matlab implementation of lbm mrt can usually achieve around 1 10 mlups while a c parallel implementation can reach 100 mlups over 16 cores a gpu accelerated implementation on the other hand can easily reach 1 000 mlups or more the cpu time required for the various solvers and configurations used in this study are shown in fig 13 and show that depending on the hardware and the implementation available the real speedup achieved between pnm pfvs pnm pfvs lbm and lbm only can range from being significant in the 10 mlups case around 10 to being relatively modest in the 1 000 mlups case around 50 this is due to the lbm implementations shifting from the timescale of days hours 10 mlups to minutes seconds 1 000 mlups which begins to reach the speed achieved by pfvs pnm and making the 2 000 timesteps required for pnm pfvs lbm 0 1 to become solvable within 3 s 4 conclusions and discussion in conclusion this study introduces a method for coupling together simplified estimates of steady state fluid flow in porous media with full direct simulation routines the simplified methods used for analysis in this study are the pore network model pnm and the pore scale finite volume solver pfvs which is a form of laplace semi analytical solvers sas the flow fields estimated from these simplified models are used to precondition a multi relaxation time lattice boltzmann method mrt lbm direct simulator to achieve steady state accuracy in a fraction of the time both the permeability accuracy and the velocity field accuracy of these methods are investigated as permeability is ubiquitous in upscaling from the pore scale and flow fields are critical in further pore scale transport phenomena analysis using 100 distinct samples ranging in permeability from 0 7 md to 3 d assuming a voxel resolution of 1 micrometre the initial permeability estimation errors present in pnm pfvs show a typical error of 10 20 with up to 50 70 error in some cases and pnm results showing higher variance and error due to the extra layer of geometric simplifications compared to pfvs which only makes flow based assumptions pnm pfvs lbm coupling instead returns perfect accuracy in permeability calculation compared with lbm only analysis of the velocity fields and their probability distribution functions pdf shows that pfvs estimates are similar to lbm and that errors are primarily localised to high velocity throat and channels pnms on the other hand are highly discretised compared to the continuous flow fields in lbm and errors in local velocity are significant despite overall permeability closely matching by coupling with lbm these errors large or small in velocity distribution are largely eliminated at a fraction of the lbm only compute cost analysis of the speedup and convergence achieved by pnm pfvs lbm over lbm only shows that less than 2 000 lbm timesteps are required to reach steady state conditions compared to lbm only representing a 5 to 150 speedup compared to lbm only over the entire workflow speedup depends on software implementation and hardware specification sensitivity analysis of the most intensive and variable direct simulation step reveals that speedup can range from 10 in serial cpu implementations to 50 in parallel gpu implementations given that speedup and convergence improves with lower permeability samples this method is especially applicable to tight low permeability porous domains such as tight sandstone heterogenous carbonate coal and shale this speedup of direct simulation which is especially prominent in the lower permeability tight samples see fig 8 essentially erases the errors in both permeability and velocity field for pnm pfvs in the case of pnms this is particularly effective given the significant quantitative and visual differences in projected velocity field and the direct simulation result see figs 5 and 6 for merely 2 000 lbm timesteps in these tested samples which equates to a few minutes of parallel lbm simulation on 16 workstation cores or a few seconds on a few gpus the errors in a pnm estimation are corrected for to reach direct simulation accuracy without the need for the significant computational requirements that direct simulation itself would need without the pnm pfvs estimate to act as preconditioner while permeability error correction to direct simulation accuracy is effective using this method it is important to understand also that the assumption that direct simulation is the ground truth presents a purely computational perspective on the problem of permeability measurement comparison to experimental results of permeability must pass through a few sources of error that are uncontrollable by the flow simulation method itself image quality resolution and segmentation of the pore space are factors that limit the accuracy of even direct simulation to experiments performed in reality mostaghimi et al 2013 though direct simulation holds the potential to completely match a core flooding experiment given the choice direct simulation most closely mirrors experimental results with its main barrier to more common use being the high computational cost especially in tight unconventional rocks chen et al 2015 the primary benefit of this technique is the relatively minor computation required on top of pnm pfvs required to obtain direct simulation level accuracy for permeability and velocity fields at steady state conditions this allows for more efficient further numerical analysis of reactive transport mostaghimi et al 2016 fines migration cheng et al 2018 and other transport phenomena list of acronyms pnm pore network model sas semi analytical solver pfvs pore scale finite volume solver nse navier stokes equation lbm lattice boltzmann method mrt multiple relaxation time srt single relaxation time mlups million lattice updates per second pdf probability density function credit authorship contribution statement ying da wang conceptualization methodology software validation formal analysis traiwit chung software resources writing original draft writing review editing arash rabbani software resources data curation writing original draft writing review editing ryan t armstrong supervision methodology writing review editing peyman mostaghimi supervision conceptualization methodology writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the samples used in this study are taken from the deepore dataset rabbani 2020 http doi org 10 5281 zenodo 3820900 aarnes gimse lie 2007 j e aarnes t gimse k a lie an introduction to the numerics of flow in porous media using matlab 2007 springer berlin heidelberg berlin heidelberg 265 306 aarnes j e gimse t lie k a 2007 an introduction to the numerics of flow in porous media using matlab springer berlin heidelberg berlin heidelberg pp 265 306 10 1007 978 3 540 68783 2 9 akanji matthai 2010 l akanji s matthai finite element based characterization of pore scale geometry and its impact on fluid flow transp porous media 81 2010 241 259 10 1007 s11242 009 9400 7 akanji l matthai s 2010 finite element based characterization of pore scale geometry and its impact on fluid flow transport in porous media 81 241 259 10 1007 s11242 009 9400 7 arns adler 2018 c arns p adler fast laplace solver approach to pore scale permeability phys rev e 97 2 2018 023303 arns c adler p 2018 fast laplace solver approach to pore scale permeability physical review e 97 2 023303 blunt 2017 m j blunt multiphase flow in permeable media a pore scale perspective 2017 cambridge university press blunt m j 2017 multiphase flow in permeable media a pore scale perspective cambridge university press blunt bijeljic dong gharbi iglauer mostaghimi paluszny pentland 2013 m j blunt b bijeljic h dong o gharbi s iglauer p mostaghimi a paluszny c pentland pore scale imaging and modelling advances in water resources 51 2013 197 216 10 1016 j advwatres 2012 03 003 blunt m j bijeljic b dong h gharbi o iglauer s mostaghimi p paluszny a pentland c 2013 pore scale imaging and modelling advances in water resources 51 197 216 35th year anniversary issue 10 1016 j advwatres 2012 03 003 35th year anniversary issue blunt jackson piri valvatne 2002 m j blunt m d jackson m piri p h valvatne detailed physics predictive capabilities and macroscopic consequences for pore network models of multiphase flow adv water resour 25 8 2002 1069 1089 10 1016 s0309 1708 02 00049 0 blunt m j jackson m d piri m valvatne p h 2002 detailed physics predictive capabilities and macroscopic consequences for pore network models of multiphase flow advances in water resources 25 8 1069 1089 10 1016 s0309 1708 02 00049 0 boek venturoli 2010 e s boek m venturoli lattice boltzmann studies of fluid flow in porous media with realistic rock geometries comput math appl 59 7 2010 2305 2314 boek e s venturoli m 2010 lattice boltzmann studies of fluid flow in porous media with realistic rock geometries computers mathematics with applications 59 7 2305 2314 chen zhang kang viswanathan yao tao 2015 l chen l zhang q kang h s viswanathan j yao w tao nanoscale simulation of shale transport properties using the lattice boltzmann method permeability and diffusivity sci rep 5 1 2015 1 8 chen l zhang l kang q viswanathan h s yao j tao w 2015 nanoscale simulation of shale transport properties using the lattice boltzmann method permeability and diffusivity scientific reports 5 1 1 8 cheng wang yang 2018 k cheng y wang q yang a semi resolved cfd dem model for seepage induced fine particle migration in gap graded soils comput geotech 100 2018 30 51 10 1016 j compgeo 2018 04 004 cheng k wang y yang q 2018 a semi resolved cfd dem model for seepage induced fine particle migration in gap graded soils computers and geotechnics 100 30 51 10 1016 j compgeo 2018 04 004 chung wang mostaghimi armstrong 2019 t chung y wang p mostaghimi r armstrong approximating permeability of micro ct images using elliptic flow equations spe j 2019 chung t wang y mostaghimi p armstrong r 2019 approximating permeability of micro ct images using elliptic flow equations spe journal chung wang armstrong mostaghimi 2020 t chung y d wang r t armstrong p mostaghimi cnn pfvs integrating neural networks and finite volume solvers to accelerate flow simulation on pore space images transp porous media 2020 chung t wang y d armstrong r t mostaghimi p 2020a cnn pfvs integrating neural networks and finite volume solvers to accelerate flow simulation on pore space images transport in porous media chung wang armstrong mostaghimi 2020 t chung y d wang r t armstrong p mostaghimi voxel agglomeration for accelerated estimation of permeability from micro ct images j pet sci eng 184 2020 106577 10 1016 j petrol 2019 106577 chung t wang y d armstrong r t mostaghimi p 2020b voxel agglomeration for accelerated estimation of permeability from micro ct images journal of petroleum science and engineering 184 106577 10 1016 j petrol 2019 106577 culligan wildenschild christensen gray rivers 2006 k culligan d wildenschild b christensen w gray m rivers pore scale characteristics of multiphase flow in porous media a comparison of air water and oil water experiments advances in water resources 29 2 2006 227 238 10 1016 j advwatres 2005 03 021 culligan k wildenschild d christensen b gray w rivers m 2006 pore scale characteristics of multiphase flow in porous media a comparison of airwater and oilwater experiments advances in water resources 29 2 227 238 experimental hydrology a bright future 10 1016 j advwatres 2005 03 021 experimental hydrology a bright future delerue lomov parnas verpoest wevers 2003 j f delerue s v lomov r parnas i verpoest m wevers pore network modeling of permeability for textile reinforcements polym compos 24 3 2003 344 357 delerue j f lomov s v parnas r verpoest i wevers m 2003 pore network modeling of permeability for textile reinforcements polymer composites 24 3 344 357 dong blunt 2009 h dong m j blunt pore network extraction from micro computerized tomography images phys rev e 80 3 2009 036307 dong h blunt m j 2009 pore network extraction from micro computerized tomography images physical review e 80 3 036307 dong fjeldstad alberts roth bakke øren et al 2008 h dong s fjeldstad l alberts s roth s bakke p e øren pore network modelling on carbonate a comparative study of different micro ct network extraction methods international symposium of the society of core analysts society of core analysts 2008 dong h fjeldstad s alberts l roth s bakke s øren p e et al 2008 pore network modelling on carbonate a comparative study of different micro ct network extraction methods in international symposium of the society of core analysts society of core analysts fenwick blunt 1998 d h fenwick m j blunt three dimensional modeling of three phase imbibition and drainage adv water resour 21 2 1998 121 143 10 1016 s0309 1708 96 00037 1 fenwick d h blunt m j 1998 three dimensional modeling of three phase imbibition and drainage advances in water resources 21 2 121 143 10 1016 s0309 1708 96 00037 1 geiger roberts matthäi zoppou burri 2004 s geiger s roberts s matthäi c zoppou a burri combining finite element and finite volume methods for efficient multiphase flow simulations in highly heterogeneous and structurally complex geologic media geofluids 4 4 2004 284 299 geiger s roberts s matthäi s zoppou c burri a 2004 combining finite element and finite volume methods for efficient multiphase flow simulations in highly heterogeneous and structurally complex geologic media geofluids 4 4 284 299 hao cheng 2009 l hao p cheng lattice boltzmann simulations of anisotropic permeabilities in carbon paper gas diffusion layers j power sources 186 1 2009 104 114 hao l cheng p 2009 lattice boltzmann simulations of anisotropic permeabilities in carbon paper gas diffusion layers journal of power sources 186 1 104 114 hilpert miller 2001 m hilpert c t miller pore morphology based simulation of drainage in totally wetting porous media advances in water resources 24 3 2001 243 255 10 1016 s0309 1708 00 00056 7 hilpert m miller c t 2001 pore morphology based simulation of drainage in totally wetting porous media advances in water resources 24 3 243 255 pore scale modeling 10 1016 s0309 1708 00 00056 7 pore scale modeling keehm mukerji nur 2004 y keehm t mukerji a nur permeability prediction from thin sections 3d reconstruction and lattice boltzmann flow simulation geophys res lett 31 4 2004 keehm y mukerji t nur a 2004 permeability prediction from thin sections 3d reconstruction and lattice boltzmann flow simulation geophysical research letters 31 4 keil rieckmann 1994 f j keil c rieckmann optimization of three dimensional catalyst pore structures chemical engineering science 49 24 part a 1994 4811 4822 10 1016 s0009 2509 05 80061 2 keil f j rieckmann c 1994 optimization of three dimensional catalyst pore structures chemical engineering science 49 24 part a 4811 4822 chemical reaction engineering science and technology 10 1016 s0009 2509 05 80061 2 chemical reaction engineering science and technology latt malaspinas kontaxakis parmigiani lagrava brogi belgacem thorimbert leclaire li marson lemus kotsalos conradin coreixas petkantchin raynaud beny chopard 2020 j latt o malaspinas d kontaxakis a parmigiani d lagrava f brogi m b belgacem y thorimbert s leclaire s li f marson j lemus c kotsalos r conradin c coreixas r petkantchin f raynaud j beny b chopard palabos parallel lattice boltzmann solver comput math appl 2020 10 1016 j camwa 2020 03 022 latt j malaspinas o kontaxakis d parmigiani a lagrava d brogi f belgacem m b thorimbert y leclaire s li s marson f lemus j kotsalos c conradin r coreixas c petkantchin r raynaud f beny j chopard b 2020 palabos parallel lattice boltzmann solver computers mathematics with applications 10 1016 j camwa 2020 03 022 lie krogstad ligaarden natvig nilsen skaflestad 2012 k a lie s krogstad i s ligaarden j r natvig h m nilsen b skaflestad open source matlab implementation of consistent discretisations on complex grids comput geosci 16 2 2012 297 322 lie k a krogstad s ligaarden i s natvig j r nilsen h m skaflestad b 2012 open source matlab implementation of consistent discretisations on complex grids computational geosciences 16 2 297 322 lie møyner natvig kozlova bratvedt watanabe li 2016 k a lie o møyner j r natvig a kozlova k bratvedt s watanabe z li successful application of multiscale methods in a real reservoir simulator environment ecmor xv 15th european conference on the mathematics of oil recovery 2016 european association of geoscientists engineers cp 494 lie k a møyner o natvig j r kozlova a bratvedt k watanabe s li z 2016 successful application of multiscale methods in a real reservoir simulator environment in ecmor xv 15th european conference on the mathematics of oil recovery european association of geoscientists engineers pp cp 494 liu mostaghimi 2017 m liu p mostaghimi characterisation of reactive transport in pore scale correlated porous media chem eng sci 173 2017 121 130 10 1016 j ces 2017 06 044 liu m mostaghimi p 2017a characterisation of reactive transport in pore scale correlated porous media chemical engineering science 173 121 130 10 1016 j ces 2017 06 044 liu mostaghimi 2017 m liu p mostaghimi pore scale simulation of dissolution induced variations in rock mechanical properties int j heat mass transf 111 2017 842 851 liu m mostaghimi p 2017b pore scale simulation of dissolution induced variations in rock mechanical properties international journal of heat and mass transfer 111 842 851 liu shabaninejad mostaghimi 2017 m liu m shabaninejad p mostaghimi impact of mineralogical heterogeneity on reactive transport modelling comput geosci 104 2017 12 19 10 1016 j cageo 2017 03 020 liu m shabaninejad m mostaghimi p 2017 impact of mineralogical heterogeneity on reactive transport modelling computers and geosciences 104 12 19 10 1016 j cageo 2017 03 020 liu shabaninejad mostaghimi 2018 m liu m shabaninejad p mostaghimi predictions of permeability surface area and average dissolution rate during reactive transport in multi mineral rocks j pet sci eng 170 2018 130 138 10 1016 j petrol 2018 06 010 liu m shabaninejad m mostaghimi p 2018 predictions of permeability surface area and average dissolution rate during reactive transport in multi mineral rocks journal of petroleum science and engineering 170 130 138 10 1016 j petrol 2018 06 010 mahbub shi nasu wang zheng 2020 m a a mahbub f shi n j nasu y wang h zheng mixed stabilized finite element method for the stationary stokes dual permeability fluid flow model comput methods appl mech eng 358 2020 112616 10 1016 j cma 2019 112616 mahbub m a a shi f nasu n j wang y zheng h 2020 mixed stabilized finite element method for the stationary stokes dual permeability fluid flow model computer methods in applied mechanics and engineering 358 112616 10 1016 j cma 2019 112616 manwart aaltosalmi koponen hilfer timonen 2002 c manwart u aaltosalmi a koponen r hilfer j timonen lattice boltzmann and finite difference simulations for the permeability for three dimensional porous media phys rev e 66 1 2002 016702 manwart c aaltosalmi u koponen a hilfer r timonen j 2002 lattice boltzmann and finite difference simulations for the permeability for three dimensional porous media physical review e 66 1 016702 mcclure prins miller 2014 j mcclure j prins c miller a novel heterogeneous algorithm to simulate multiphase flow in porous media on multicore cpu gpu systems comput phys commun 185 7 2014 1865 1874 10 1016 j cpc 2014 03 012 mcclure j prins j miller c 2014 a novel heterogeneous algorithm to simulate multiphase flow in porous media on multicore cpugpu systems computer physics communications 185 7 1865 1874 10 1016 j cpc 2014 03 012 mostaghimi bijeljic blunt et al 2012 p mostaghimi b bijeljic m blunt simulation of flow and dispersion on pore space images spe j 17 04 2012 1 131 mostaghimi p bijeljic b blunt m et al 2012 simulation of flow and dispersion on pore space images spe journal 17 04 1 131 mostaghimi blunt bijeljic 2013 p mostaghimi m j blunt b bijeljic computations of absolute permeability on micro ct images math geosci 45 1 2013 103 125 mostaghimi p blunt m j bijeljic b 2013 computations of absolute permeability on micro ct images mathematical geosciences 45 1 103 125 mostaghimi liu arns 2016 p mostaghimi m liu c h arns numerical simulation of reactive transport on micro ct images math geosci 48 8 2016 963 983 10 1007 s11004 016 9640 3 mostaghimi p liu m arns c h 2016 numerical simulation of reactive transport on micro ct images mathematical geosciences 48 8 963 983 10 1007 s11004 016 9640 3 mostaghimi mahani et al 2010 p mostaghimi h mahani a quantitative and qualitative comparison of coarse grid generation techniques for modeling fluid displacement in heterogeneous porous media spe reservoir eval eng 13 01 2010 24 36 mostaghimi p mahani h et al 2010 a quantitative and qualitative comparison of coarse grid generation techniques for modeling fluid displacement in heterogeneous porous media spe reservoir evaluation engineering 13 01 24 36 ovaysi piri 2012 s ovaysi m piri multi gpu acceleration of direct pore scale modeling of fluid flow in natural porous media comput phys commun 183 9 2012 1890 1898 ovaysi s piri m 2012 multi gpu acceleration of direct pore scale modeling of fluid flow in natural porous media computer physics communications 183 9 1890 1898 rabbani 2020 a rabbani deepore dataset 2020 10 5281 zenodo 3820900 rabbani a 2020 deepore dataset 10 5281 zenodo 3820900 rabbani babaei 2019 a rabbani m babaei hybrid pore network and lattice boltzmann permeability modelling accelerated by machine learning adv water resour 126 2019 116 128 rabbani a babaei m 2019 hybrid pore network and lattice boltzmann permeability modelling accelerated by machine learning advances in water resources 126 116 128 rabbani babaei shams wang chung 2020 a rabbani m babaei r shams y d wang t chung deepore a deep learning workflow for rapid and comprehensive characterization of porous materials adv water resour 146 2020 103787 10 1016 j advwatres 2020 103787 rabbani a babaei m shams r wang y d chung t 2020 deepore a deep learning workflow for rapid and comprehensive characterization of porous materials advances in water resources 146 103787 10 1016 j advwatres 2020 103787 rabbani mostaghimi armstrong 2019 a rabbani p mostaghimi r t armstrong pore network extraction using geometrical domain decomposition adv water resour 123 2019 70 83 rabbani a mostaghimi p armstrong r t 2019 pore network extraction using geometrical domain decomposition advances in water resources 123 70 83 raeini bijeljic blunt 2015 a q raeini b bijeljic m j blunt modelling capillary trapping using finite volume simulation of two phase flow directly on micro ct images adv water resour 83 2015 102 110 raeini a q bijeljic b blunt m j 2015 modelling capillary trapping using finite volume simulation of two phase flow directly on micro ct images advances in water resources 83 102 110 sandino kroliczek mcerlain boyd 2014 c sandino p kroliczek d d mcerlain s k boyd predicting the permeability of trabecular bone by micro computed tomography and finite element modeling j biomech 47 12 2014 3129 3134 sandino c kroliczek p mcerlain d d boyd s k 2014 predicting the permeability of trabecular bone by micro computed tomography and finite element modeling journal of biomechanics 47 12 3129 3134 saxena hofmann alpak berg dietderich agarwal tandon hunter freeman wilson 2017 n saxena r hofmann f o alpak s berg j dietderich u agarwal k tandon s hunter j freeman o b wilson and benchmarks for pore scale flow simulated using micro ct images of porous media and digital rocks adv water resour 109 2017 211 235 saxena n hofmann r alpak f o berg s dietderich j agarwal u tandon k hunter s freeman j wilson o b 2017 
333,permeability characterises flow in porous rocks media for upscaling while steady state flow fields allow analysis of reactive transport fines migration and tight unconventional rocks fast calculation of permeability and flow fields obtained from pore network models pnm and laplace semi analytical solvers sas deviate from computationally demanding simulation of navier stokes equations nse due to flow and geometry simplifications coupling pnm sas with direct simulation via lattice boltzmann method lbm provides 5 150 speed up without accuracy loss over 100 samples from 0 7md to 3 5d permeability errors in pnm sas show 10 20 up to 50 70 error pnm shows higher variance from geometric simplifications compared to sas which only makes flow based assumptions pnm sas errors are eliminated by coupling with lbm at a fraction of lbm only compute cost steady state conditions with pnm sas lbm are reached in 2 000 timesteps compared to lbm only which can require 10 5 timesteps in tight domains such as cemented sandstone carbonate coal and shale keywords pore scale permeability pore network models laplace solvers lattice boltzmann methods 1 introduction the flow of fluid within the void space of porous structures is a physical phenomenon that is pervasive in its occurrence with applications in catalysis keil and rieckmann 1994 groundwater hydrogeology oil and gas extraction environmental waste management fenwick and blunt 1998 hilpert and miller 2001 blunt et al 2002 culligan et al 2006 mostaghimi et al 2010 2016 blunt 2017 carbon capture storage blunt et al 2013 and unconventional rocks chen et al 2015 sun et al 2012 these examples highlight the need to accurately capture the physics of fluid flow within porous media this is typically characterised by the permeability which averages flow contributions in the pores to a single value for use in darcy scale modelling there are however also many instances where the flow field in the pore space is itself required for further pore scale analysis of transport phenomena including dispersion mostaghimi et al 2012 reactive transport liu and mostaghimi 2017b 2017a mostaghimi et al 2016 liu et al 2018 and fines migration cheng et al 2018 where the underlying velocity field is used for further simulation these permeabilities and flow fields can be obtained by direct simulation of flow within the resolved pore space of porous media or estimated by simplified methods based on certain assumptions regarding physics and geometry in the pore space direct flow simulation by solving the navier stokes equation nse explicitly offers the highest level of accuracy with the finest degree of detail projecting directly into the domain this can be performed by finite method solutions of the nse white et al 2006 sun et al 2010 sandino et al 2014 song et al 2004 raeini et al 2015 geiger et al 2004 mahbub et al 2020 or by lattice boltzmann methods lbm that also solve the nse mcclure et al 2014 manwart et al 2002 spaid and phelan 1997 stewart et al 2006 boek and venturoli 2010 chen et al 2015 hao and cheng 2009 keehm et al 2004 wang et al 2020a these techniques require significant compute time and memory the computational issues with these methods arise due to them being a time dependent and or b non linear iterative lbm is time dependent nse is both time dependent and non linear in porous media the simplified steady state stokes equation mostaghimi et al 2013 is commonly used instead of the full nse as porous media flow occurs under low reynolds number regimes this stokes equation is linear and time independent but requires iteration to solve due to weak pressure velocity coupling in this study the term steady state refers to the point in which flow simulation converges such that time stepping and or iterations become static furthermore in porous media where steady state solutions are sought after the convergence rate of direct flow simulation to these steady state conditions is also dependent on the geometric complexity of the porous media as such direct simulation of steady state fluid flow in complex geometries i e porous media is a computationally challenging task due to slow convergence in tortuous flow paths this has led to the proliferation of simplified models such as the pore network model pnm blunt et al 2002 rabbani and babaei 2019 dong and blunt 2009 dong et al 2008 delerue et al 2003 and the laplace semi analytical solver sas chung et al 2019 wang et al 2019 2020b torskaya et al 2014 shabro et al 2012 arns and adler 2018 akanji and matthai 2010 while these pnm and laplace sas methods are adequate for predicting the overall permeability of a given pore space saxena et al 2017 the actual velocity fields are also important in many applications as outlined in the previous paragraph the pore space can be represented in a significantly simpler manner by pnms as a collection of chambers pores connected by throats reducing the computational cost significantly at the cost of obtaining an abstraction of the true velocity and pressure fields averaged over simplified geometries of the pore space assuming the pore network itself is generated in a physically representative manner this is typically adequate for the purposes of permeability estimation due to the decomposed nature of pnms these velocity and pressure fields are then projected back into the pore space but as this study will indicate the loss of spatial information is generally too great for these projections to be useable without some correction in this case by direct simulation a middle ground exists between the pnm and direct simulation in porous media called semi analytical solvers sas which are typically derived in the form of a time invariant linear laplace partial differential equation solvable by finite methods the analytical part of the method arises from the need to characterise a conductivity within the pore space using some geometric approximations or otherwise leading to a reduction in flexibility and accuracy in certain geometries outside the scope of the analytical assumptions while errors occur due to the analytical assumptions necessary to characterise the conductivity term in laplace sass the solution is mapped directly to the domain space a common analytical assumption used to generate the conductivity map in laplace sas is poiseuille like flow within the pores chung et al 2019 shabro et al 2012 which has been shown to be a reasonable approximation in conventional rocks to obtain both a permeability estimation and a continuous flow field other analytical solutions have been proposed akanji and matthai 2010 arns and adler 2018 but all suffer from non generality only giving reasonable estimates of flow with errors accumulating in regions of non poiseuille flow such as junctions fractures and elliptical pore channels in this study steady state velocity and pressure fields are computed on test dataset of 100 samples from the deepore set rabbani et al 2020 using a pnm method rabbani and babaei 2019 combined with a velocity and pressure projection algorithm and a laplace sas the pfvs method chung et al 2019 estimates of permeability from underlying velocity fields obtained from pnms and laplace sass tend to deviate from direct simulation due to non physical velocity fields as such these flow fields and their permeability predictions are first compared to results obtained from lbm simulations mcclure et al 2014 wang et al 2020b and then used as initial conditions to accelerate lbm simulations to reach a steady state result in a fraction of the compute time this technique serves to couple together predictions of fluid flow fast limited accuracy with direct flow simulation slow high accuracy and has been successfully used in other cases with velocity predictions from deep learning wang et al 2020c wang et al 2021 which differ from the usual methods of only permeability estimation tian et al 2020 or techniques that couple lbm to the pnm domain rabbani and babaei 2019 zhao et al 2020 this implementation couples pnm laplace to the lbm domain instead the speed up achieved is analysed and it is shown that speedup factors in the order of 5 to 150 are achieved for tight low permeability domains that would otherwise take lbm timesteps of the order of 105 to 106 which depending on the domain size and algorithmic efficiency can span over several days this technique allows permeability estimates to be direct simulation level accurate in a fraction of the direct simulation only compute time and importantly allows crude and inaccurate estimates of velocity fields from pnm pfvs to become physically accurate with minimal extra compute time allowing more efficient transport modelling of reactive transport fines migration and any transport phenomena in rocks and porous media that utilises underlying steady state flow fields 2 materials and methods a set of 100 3d volumes of porous media is used in this study taken from the first 100 samples in the deepore testing dataset rabbani et al 2020 these domains have been extensively analysed for their petrophysical properties and are chosen to represent a wide spectrum of possible porous media of carbonate and sandstone rocks with permeability spanning 4 orders of magnitude with fig 1 showing 5 examples of the 100 domains used featuring a wide range of permeability and a broad variation in pore structure during simulations all samples in this study are assumed to have a voxel length of 1 micrometre resulting in a sample of length 0 256 mm3 2 1 pore network models a pore network model is constructed by first identifying the pores and throats of a porous medium this is done by firstly performing watershed segmentation on the distance map of the porous media shown in fig 2a to c the resulting regions are then converted into pores with throats represented by the 2d cross section between adjacent pores and connectivity between adjacent pores are recorded in a connectivity matrix fig 2d the contact line between adjacent pores and the pore wall forms a throat of arbitrary cross section and the conductivity k t h r o a t of this 2d cross section is estimated from a quadratic correlation based on the mean distance of each throat cross section to the wall d of the form k t h r o a t 1 342 d 2 0 913 d 0 381 rabbani and babaei 2019 from this constructed pnm the overall permeability of the domain can be estimated by solving for the pressure in each pore chamber by assuming steady state incompressible flow occurs through the throats between each pair of pores fig 2e by taking the throat conductivity w 1 2 and pressure difference between the centers of two connecting pore chambers δ p 1 2 p 2 p 1 the average fluid flow rate is obtainable at steady state conditions by q w δ p in order to obtain the pressure at each voxel of the pore space geometry fig 2f voxels containing pore body labels fig 2c are replaced with the corresponding pressure obtained from pore network simulation fig 2e the transitions between the pressure of the pores at their intersections is then smoothed with 20 passes of a averaging filter with kernel size of 3 3 fig 2g as an example to illustrate the effect of pressure smoothing a hypothetical pathway from point a to point b is assumed in the pore space fig 2e to g the changes of pressure vs distance between these two points are schematically presented in fig 2h to j as can be seen step wise changes in the pressure of the discrete map is converted to a gradual variation in fig 2j while the inlet and outlet pressures are kept constant the conservation equation for pnms is not capable of producing vector velocities at the voxel scale and in most applications pnms are used without these local velocity estimates to properly couple together pnm and lbm at the direct simulation level a method of projecting the pnm velocities calculated at the throats to the entire pore space is required in this study we utilise a method described below and evaluate its efficacy in accelerating lbm simulations to steady state it should be noted that this methods of projecting pnm velocity fields to the pore space is a non unique process and so it is entirely possible that a different algorithm could give a different and or improved local velocity field even with the same underlying pnm the velocity magnitude at the centre of each pore chamber is calculated by adding up the magnitude of all incoming flow velocities then we assign this central magnitude to all the voxels of the image located inside the pore chamber this operation creates a discrete map of velocity magnitudes in pore space which goes to a smoothing process similar to the pressure also the unit vectors of velocity map are obtainable by calculating the gradient of the smoothed pressure distribution in the pore space fig 2g finally multiplication of the magnitude and unit vectors of the velocity generates the complete set of projected velocity vectors for each voxel of the pore space 2 2 laplace semi analytical solvers an elliptic diffusion equation also known as the laplace pde of the form w p 0 is used to obtain the spatial pressure distribution and velocity field and hence estimate the absolute permeability if formulated carefully the resulting pressure and velocity fields are also reasonable estimates that obey certain criteria i e no slip parabolic velocity profiles incompressible steady state flow etc this method is relatively cpu time efficient compared to direct simulation as it does not require time stepping or iteration of non linear terms to converge to a solution speed is related only to the domain size and discretisation method resources available and the matrix inversion method used the single major error source arises from the need to provide an analytical solution to the conductivity field the coefficient field w in the laplace pde which is shown in fig 3 in this study the laplace semi analytical solver used is the pfvs method chung et al 2019 2020b wang et al 2019 chung et al 2020a the laplace pde is solved with prescribed constant pressure dirichlet boundary conditions on the inlet and outlet by using two point flux approximation tpfa aarnes et al 2007 lie et al 2012 and finite volume methods with an algebraic multi grid amg solver all solid voxels are removed from the system of equations resulting in a smaller system matrix most importantly for laplace sass the coefficient field w plays a key role in the semi analytical description of the method this field is prescribed analytically by a series of correlative relationships that can vary between implementations and use cases shabro et al 2012 arns and adler 2018 akanji and matthai 2010 in pfvs under the assumptions of laminar incompressible flow and no slip boundary condition the local conductivity w is defined as a weighting function representing the conductivity of a voxel for fluid flow it is a function of two variables the largest inscribed radius of the flow channel d max and the distance from the solid wall d 1 w α r 2 ρ 8 μ 2 d max d d 2 where w is local conductivity α is a shape factor r is the image resolution d max is calculated by an iterative 3d algorithm chung et al 2020a ρ is fluid density and μ is fluid viscosity it should be noted that the largest inscribed radius of the flow channel d max is similar to the various methods of pore throat chamber identification used in pnms to convert the pore space into the pnm instead of using d max for geometric simplification and identification of pores and throats it is used directly for calibrating the conductivity field in the pore space itself bridging the gap between pnm and direct simulation techniques 2 3 lattice boltzmann method flow within the pore space is calculated by the lattice boltzmann method lbm using a multi relaxation time mrt scheme in d3q19 quadrature space wang et al 2020b in order to eliminate spurious parameter coupling between viscosity and permeability that occurs with single relaxation time srt and improve stability in high velocity pore throats problems outlined in detail in yang 2013 lbm reformulates the navier stokes equations nse by numerically estimating the resulting continuum mechanics from underlying kinetic theory because lbm solves the nse time stepping is required unlike finite methods solving nse that require iteration mostaghimi et al 2013 lbm is completely linear in its operations and as such is highly parallelisable and relatively simpler to implement on gpus ovaysi and piri 2012 mcclure et al 2014 nonetheless the resources required to compute lbm steady state solutions are an order of magnitude or more greater than pnms or laplace sass rabbani and babaei 2019 chung et al 2019 the kinetics of a bulk collection of particles within a control volume is estimated with a vector velocity space ξ q and velocity distributions f q for each velocity space vector ξ q the velocity component in the specified direction is given by f q the momentum transport equation at location x i over a timestep δ t takes the form in eq 2 that relies on a collision operation j which recovers the navier stokes equation and outlined in detail in mcclure et al 2014 2 f q x i ξ q δ t t δ t f q x i t j x i t single phase flow is simulated within the pore space of the segmented test samples until steady state conditions are reached this is measured by tracking changes to the sample permeability k by eq 3 3 k μ v l δ p x where μ is the kinematic viscosity v is the mean velocity within the bulk domain l is the length of the sample in the direction of flow and δ p is the pressure difference between the inlet and outlet the permeability of any given porous media is a constant value at steady state conditions when the velocity fields and the pressure fields become time static in this case simulations are run until the change in permeability over 1 000 lbm timesteps k t δ t k t k t δ t 1000 is less than 10 5 all samples are simulated with a constant pressure drop between the inlet and outlet and wall boundary conditions no slip are imposed along the other sides to avoid geometric inconsistencies associated with periodic boundary conditions these boundary conditions and fluid properties are also used for the pnm and laplace sas simulations by taking the pressure and velocity fields estimated from pnm and laplace sas methods outlined in the previous sections of this study lbm simulations can be initialised closer to steady state conditions compared to the typical initialisation of zero velocity pressure gradient which is what this study uses zero velocity uniform pressure is also a common initial condition since the pnm and laplace sas methods are projected directly onto the pore space there is a one to one spatial mapping though the pnm solution needs special preprocessing as outlined in section 2 1 3 results and discussion in this section the comparative accuracies of pnms laplace sass against lbm are first compared and then these methods are coupled together to accelerate lbm simulations to steady state conditions at a fraction of the compute time this speed up factor is measured over the 100 samples and the major influencing factors are investigated the laplace sas used in this comparison is the pfvs method outlined previously in section 2 2 and henceforth pfvs is used to refer to laplace sas results in the following sections 3 1 accuracy of pnms sass and coupling to lbm in terms of accuracy measurement both the permeability and the velocity probability density function pdf are calculated this is to identify both the overall accuracy represented by the permeability and the accuracy of the velocity field distribution itself the permeability is commonly the primary value of interest in digital petrophysics as it is used in larger scale flow equations featuring darcy s law lie et al 2016 aside from the single value of permeability one of the benefits of simulating flow in the pore space is the velocity fields themselves which can be used for modelling of other transport phenomena relating to advection dispersion diffusion reactions mostaghimi et al 2016 liu et al 2018 2017 liu and mostaghimi 2017a mostaghimi et al 2012 wang et al 2020c and as such the accuracy of the velocity fields themselves are an important feature to analyse when comparing pnm pfvs against direct simulation finally the proposed coupling process of using these pnm pfvs flow fields to initialise direct simulation is validated in terms of accuracy compared to only direct simulation for the 100 samples the permeability obtained from pnm and pfvs is compared to the lbm permeability and as validation of the preconditioning the pnm lbm and pnm pfvs results are also compared to lbm only seen in fig 4 comparison of the pnm and pfvs permeability predictions against lbm shown on the left and middle of the figure indicates that typical errors can reach up to 50 70 hovering usually around the 10 20 range pfvs shows a smaller spread of error compared to pnm indicating the improved accuracy achievable from solving for flow on the original domain with simplified physics based on geometric assumptions of cylindrical flow compared to the pnms that simplify the domain directly both techniques perform best at the intermediate permeability range of 100 md 1 micrometre voxel resolution and pnms tend to overpredict at higher permeabilities and underpredict at lower permeabilities while pfvs maintains consistent accuracy at lower permeabilities down to 1 md and tends to underpredict at higher permeabilities one reason for these trends is likely the geometric assumptions made in the pnm and pfvs methods and how these assumptions deviate from the actual geometry of the 100 samples at higher and lower permeabilities in the case of pfvs the pore space of tighter structures is characterised by only a few voxels in diameter in many pore channels and as such approximations of cylindrical flow incurs less error as velocities are mapped to only a few voxels on the other hand in more open samples with comparatively higher permeability flow channels tend to transition from cylindrical structures to networks of flow with many pores interconnected see fig 6 where the influence of the pore wall arises from multiple wide open pore junctions making the conductivity approximation of pfvs see eq 1 less valid over more pore voxels causing underestimation of velocity in these regions overprediction by pnms in high permeability samples may occur due to increased pore to pore connectivity and misrepresentation of throat permeability with respect to the geometry of adjacent chambers similarly at the low end of permeability pnms may struggle with capturing the geometry of tighter samples without some tuning and calibration these error sources from inadequate analytical characterisations of conductivity in pfvs to pnm calibration sensitivity are mitigated by coupling to lbm as a preconditioner since final achieved accuracy will always match that of lbm itself see figs 6 8 errors in the velocity fields of the projected pnm velocity fields and the pfvs velocity fields are measured by calculating the normalised velocity probability density functions pdfs of the normalised velocity distribution v 1 v v v d v this is shown in fig 5 for the same 5 example samples shown in fig 1 that range from low to high permeability the velocity pdfs show clearly that the pnm projection technique struggles to identify sparsely occurring high velocity regions which is expected given the simplified geometry in which the pnm is constructed furthermore the velocity pdfs of pnms also show higher variance at all magnitudes indicating that the projected pnm velocity values are more discretised than lbm and pfvs fields compared to the lbm velocity pdf pfvs and pnm pdfs tend to deviate lower than the lbm pdf indicating that these methods underestimate the overall influence of mid to higher velocity regions such as throats due to how pnm and pfvs will simplify these regions with geometry changes pnm and flow assumptions pfvs these large errors in velocity distribution are mostly eliminated by pnm pfvs lbm and as such indicate that both the permeability and velocity fields are adequately accurate compared to lbm only of note is that the chosen convergence criteria of k t δ t k t k t δ t 1000 10 5 does not appear to be adequate for samples with very low permeability using pnm lbm this is due to both the less spatially accurate projected pnm velocity field compared to the pfvs field see figs 5 and 6 as well as the tighter porous domain requiring more time to reach steady state conditions as such it is important to probe the extent of convergence and speed up to steady state in a robust manner which is explored in the next section permeability results of these 5 example samples from the dataset of 100 also follow the expected trends seen from fig 4 with pfvs giving generally accurate estimates from 1 md up to 1 d and underestimating permeability at higher values pnms are seen to underpredict in tight samples and overpredict in open samples performing best in the 10 1 000 md range these deviations in velocity fields between pnms pfvs and lbm caused by their geometric assumptions and simplifications cause a higher degree of local variation in velocity field compared to what would otherwise be a perhaps 10 deviation in overall permeability these local deviations in velocity field can be seen in fig 6 which show the pnm pfvs and lbm velocity fields for the 5 example samples shown in fig 1 it is clear from visual inspection of rendered velocity fields that first of all from fig 6 that projected pnm velocity fields obtained from projecting the pnm solution back into the pore space show significant differences to the lbm result the projected pnm velocity field shows signs of the pnm itself in the way that velocity regions are separated into clouds roughly in the shape of the pore chambers used to generate the pnm these visual findings are consistent with the higher variance and lack of high velocity signatures in the projected pnm velocity pdfs in fig 5 this projected pnm velocity field is unusable for further transport phenomena modelling but the permeability obtained from this model is within satisfactory error bounds see fig 4 and using these velocity fields as an initial preconditioner for lbm returns direct simulation level accuracy at a fraction of the compute time see next section 3 2 comparing the pfvs velocity fields with lbm shows a better visual match compared to pnm in fig 6 but clear differences can be identified throughout difference maps identify errors as occurring throughout the sample as small differences in velocity but main sources of error occur in the pore throats and high velocity flow paths this mid to high velocity deviation is again consistent with velocity pdf comparisons in fig 5 both pfvs and lbm velocity fields are mass conservative continuous and obey no slip wall conditions as such pfvs velocity fields can be used for further transport phenomena simulations albeit the errors in the throat regions of the underlying velocity field will result in error accumulation 3 2 speedup and influencing factors in the previous section the relative accuracy of pnm pfvs and lbm in terms of both permeability and velocity field shows that there is merit in minimising these errors with direct simulation fig 4 shows that coupling pnm and pfvs estimates to lbm as a preconditioner is stable and will achieve identical steady state results to lbm only in this section the speedup achieved is analysed and contributing factors are discussed firstly the lbm simulation time between lbm only and coupled pnm pfvs lbm is analysed then the real time speedup is analysed and discussed with respect to steady state convergence program optimisation and available hardware a plot of the permeability over simulation time in fig 7 shows that over the 5 example samples see fig 1 the pnm pfvs lbm simulations begin at a reasonable initial preconditioned estimate and remain stable over the simulation to convergence lbm only instead requires significant simulation time to reach the same level of accuracy as the initial pnm and pfvs estimates as such pnm lbm and especially pfvs lbm would only require a fraction of the time to reach acceptable permeability and velocity field estimates of steady state flow compared to lbm only the convergence criteria used in this case of k t δ t k t k t δ t 1000 10 5 appears to be excessive for pnm pfvs lbm which visually show earlier convergence reaching plateau at an earlier time than the convergence criteria would otherwise suggest analysis of simulation time and permeability in the left hand side plot in fig 8 shows a strong correlation between sample permeability and simulation time required to reach steady state tighter samples with low permeability in this dataset of 100 samples require up to 100 000 to 1 000 000 lbm timesteps to converge to steady state the speedup achieved between lbm only and pnm pfvs lbm hovers roughly between 2 to 3 for convergence defined as k t δ t k t k t δ t 1000 10 5 reaching up to 10 in some cases pfvs lbm shows slightly faster convergence compared to pnm lbm which is expected based on their respective initial velocity fields see previous section since pfvs initial estimates are significantly closer to the lbm final result than the pnm initial estimate given the rather poor and inaccurate velocity field estimate given by pnms see previous section the speedup of pnm lbm is compelling since the final result is as accurate as direct simulation due to the faster plateau achieved by pnm pfvs lbm seen in fig 7 it is prudent to investigate how these simulations behave when the convergence criteria is set to a higher value such as 0 1 instead of 10 5 the middle plot in fig 8 shows this with pnm pfvs lbm and lbm only set to report permeability at k t δ t k t k t δ t 1000 0 1 the plots show that pfvs lbm set to 0 1 convergence achieves near perfect accuracy for all 100 samples compared to lbm only set to 10 5 convergence with pnm lbm 0 1 posting similar albeit slightly lower accuracy lbm only 0 1 on the other hand compares poorly to lbm 10 5 in permeability accuracy a given considering the overall slower convergence shown in fig 7 the pnm pfvs lbm 0 1 results compares favourably to the initial accuracy of pnm pfvs fig 4 indicating that a small lbm simulation time is required to correct errors in estimation this is supported by the right hand side plot in fig 8 showing that only 2 000 lbm timesteps or less since the data is logged in intervals of 1 000 are required to reach the 0 1 convergence criteria for all 100 samples tested over the entire permeability spectrum as such the speedup achieved by pnm pfvs lbm 0 1 ranges from around 5 all the way up to 150 while preserving the permeability accuracy of lbm only 10 5 this speed up becomes more predominant the lower the permeability of the sample which becomes increasingly important the tighter the domain is 3 3 convergence criterion analysis it is important to explicitly investigate the velocity field accuracy and the local steady state conditions for the simulation routines in this study this is necessary as the convergence criteria chosen for this study of k t δ t k t k t δ t 1000 1 e 5 does not necessarily guarantee steady state conditions at the local velocity field level as such the mean and max absolute velocity change is tracked for the lbm only pnm lbm and pfvs lbm simulations 300 simulation runs over 100 samples without any convergence but instead for 10 000 000 lbm timesteps which is taken as the ground truth steady state velocity field over the 100 samples in this study using lbm only the mean achieved convergence criteria for these samples in terms of k t δ t k t k t δ t 1000 is 1 48 10 8 and the mean local relative velocity convergence error as calculated by v t δ t i v t i v t i δ t 1000 is 6 58 10 6 for pnm lbm solved to 10 000 000 timesteps the values are respectively 1 17 10 8 and 6 70 10 6 for pfvs lbm solved to 10 000 000 timesteps the values are respectively 1 19 10 8 and 4 43 10 6 based on these values it is reasonable to conclude that these 10 000 000 timestep simulations are representative of ground truth steady state conditions for different convergence criteria table 1 lists the mean local velocity convergence achieved for different permeability convergence criterion on average at a permeability convergence criteria of 10 5 the velocity convergence is 3 5 10 3 for lbm only 5 3 10 3 for pnm lbm and 5 4 10 3 for pfvs lbm and at a permeability convergence criteria of 0 1 the velocity convergence is is 1 98 for lbm only 0 148 for pnm lbm and 0 151 for pfvs lbm based on these results velocity fields tend to converge at a slower rate than permeability calculations due to smearing effects this difference is shown in table 1 which lists the mean local velocity convergence achieved for different permeability convergence criterion it is clear that a more accurate steady state velocity field requires more than the 2 000 lbm timesteps that pnm pfvs lbm 0 1 need to achieve a permeability calculation match to lbm only the speedup factor for steady state velocity field simulations is thus better represented by pnm pfvs lbm 10 5 which posts a speedup factor of between 2 3 over the entire spectrum of permeability convergences 0 1 to 10 14 fig 10 shows the simulation time vs convergence criteria of lbm only and pnm pfvs lbm important to note is that lbm only is inaccurate at low convergence criteria fig 8 and from 10 2 to 10 7 pnm lbm posts a speedup while from 10 2 to 10 12 pfvs lbm posts a speedup factor speedups disappear as the trailing digits converge at a similar rate this effect occurs earlier in pnm lbm due to the lower accuracy in initial estimate overall compared to the long timeframe lbm simulations to 10 000 000 timesteps shorter simulations that use the convergence criteria of k t δ t k t k t δ t 1000 1 e 5 0 1 show a good match in the spatial distribution of velocity shown in figs 5 9 and 11 this breaks down at the lowest permeability samples 1 10 md which report near identical permeability matches between pnm lbm 0 1 10 5 vs lbm only 10 5 10 000 000 timesteps but show overly smoothed velocity fields as expected while preconditioning with pnm pfvs can eliminate permeability deviation from lbm with minimal extra computing effort the speedup to steady state velocity fields is more sensitive to the heterogeneity tightness of the domain for very low perm samples a poorer initialisation pnm projected velocity fields can result in lingering smoothness in the flow field finally to support the steady state convergence analysis performed thus far with local velocity convergence criterion table 1 and probability density function analysis of selected samples fig 11 the mean median local relative velocity error is calculated and reported in fig 12 this metric is calculated between 2 velocity fields the estimated field v i and the ground truth field v g t as m e d i a n v i v g t v g t this is done to better represent the spatial velocity distribution which is heavily skewed to the left with very high velocity outliers results averaged over the 100 samples show consistent accuracy in line with previous figures with pnm showing highest errors lbm 0 1 showing insufficient time for simulation convergence pnm pfvs lbm 0 1 showing higher deviation from true steady state and finally the 10 5 results showing steady state level accuracy most deviations occur in very low permeability samples and especially to pnm lbm see fig 11 3 4 influence of hardware and software implementation while it is clear that on identical hardware and the same programming language and style pnm pfvs solves flow faster than direct simulation it should be noted that this may not always be the case if hardware and software implementations of pnm pfvs and lbm differ too much indeed this study has applied a pnm implementation written in matlab rabbani and babaei 2019 a laplace sas pfvs implementation written in matlab with a c accelerated multigrid solver chung et al 2019 wang et al 2019 chung et al 2020b 2020a and a mpi cuda c lbm mrt implementation that is cpu gpu parallelisable to hpc clusters mcclure et al 2014 wang et al 2020b pnm domains are highly simplified and as such do not require significant optimisation to achieve fast simulation times in the order of seconds rabbani and babaei 2019 on a single cpu core at 3 ghz for the 100 samples tested in this study and have minimal memory requirements in the order of 1gb though in this case extra cpu time overhead is required to smooth and project the velocity and pressure fields into the pore space which takes roughly 60 s which takes roughly 5 times longer than the actual pnm solution itself they can also be parallelised effectively with domain decomposition both for construction and simulation of the pnm rabbani et al 2019 sun et al 2012 for larger domains laplace sas methods such as pfvs ultimately need to invert a matrix of size n by n where n is the number of pore voxels to reach a solution and require workstation grade 8 16 cores cpu time in the order of minutes to solve the 100 samples one limitation of laplace sas methods is the poor memory scaling of the solution matrix 103 to 106 during unpacking which requires roughly 10 gb in memory for these tested samples but can quickly balloon past 100 gb in larger domains though domain decomposition and irregular meshing can alleviate these issues wang et al 2019 chung et al 2020b thus both pnm and pfvs as initial estimators of flow tend to be viable with use on cpu workloads on ordinary workstations with 4 to 16 cores implemented on relatively slow and inefficient programming languages on the other hand direct simulation methods such as lbm require peak optimisation and parallelisation to reach acceptable compute speeds the potential exists for further optimisations that may bring down the simulation time of pnm pfvs by 1 2 more orders of magnitude matlab to c migration mpi implementation etc lbm implementations can span from simple matlab code rabbani and babaei 2019 to parallel c latt et al 2020 to gpu accelerated parallel c mcclure et al 2014 wang et al 2020b in 3d porous media of reasonable size domains such as the samples in this study these implementations can range from hours days for a solution matlab to requiring 10 100 cpu cores to achieve minute hour level speed parallel c to requiring only a few gpus to reach minute level speeds parallel gpu c so far this study has used the lbm timesteps as a hardware software agnostic measurement of speed that only takes into account the discrete mathematics of the method itself translating the lbm timesteps to cpu time requires knowing the number of lattice updates per second lups whereby the cpu time is equal to the number of pore voxels times the number of timesteps divided by the lups value commonly measured in million lups mlups the implementations outlined above span orders of magnitude a basic matlab implementation of lbm mrt can usually achieve around 1 10 mlups while a c parallel implementation can reach 100 mlups over 16 cores a gpu accelerated implementation on the other hand can easily reach 1 000 mlups or more the cpu time required for the various solvers and configurations used in this study are shown in fig 13 and show that depending on the hardware and the implementation available the real speedup achieved between pnm pfvs pnm pfvs lbm and lbm only can range from being significant in the 10 mlups case around 10 to being relatively modest in the 1 000 mlups case around 50 this is due to the lbm implementations shifting from the timescale of days hours 10 mlups to minutes seconds 1 000 mlups which begins to reach the speed achieved by pfvs pnm and making the 2 000 timesteps required for pnm pfvs lbm 0 1 to become solvable within 3 s 4 conclusions and discussion in conclusion this study introduces a method for coupling together simplified estimates of steady state fluid flow in porous media with full direct simulation routines the simplified methods used for analysis in this study are the pore network model pnm and the pore scale finite volume solver pfvs which is a form of laplace semi analytical solvers sas the flow fields estimated from these simplified models are used to precondition a multi relaxation time lattice boltzmann method mrt lbm direct simulator to achieve steady state accuracy in a fraction of the time both the permeability accuracy and the velocity field accuracy of these methods are investigated as permeability is ubiquitous in upscaling from the pore scale and flow fields are critical in further pore scale transport phenomena analysis using 100 distinct samples ranging in permeability from 0 7 md to 3 d assuming a voxel resolution of 1 micrometre the initial permeability estimation errors present in pnm pfvs show a typical error of 10 20 with up to 50 70 error in some cases and pnm results showing higher variance and error due to the extra layer of geometric simplifications compared to pfvs which only makes flow based assumptions pnm pfvs lbm coupling instead returns perfect accuracy in permeability calculation compared with lbm only analysis of the velocity fields and their probability distribution functions pdf shows that pfvs estimates are similar to lbm and that errors are primarily localised to high velocity throat and channels pnms on the other hand are highly discretised compared to the continuous flow fields in lbm and errors in local velocity are significant despite overall permeability closely matching by coupling with lbm these errors large or small in velocity distribution are largely eliminated at a fraction of the lbm only compute cost analysis of the speedup and convergence achieved by pnm pfvs lbm over lbm only shows that less than 2 000 lbm timesteps are required to reach steady state conditions compared to lbm only representing a 5 to 150 speedup compared to lbm only over the entire workflow speedup depends on software implementation and hardware specification sensitivity analysis of the most intensive and variable direct simulation step reveals that speedup can range from 10 in serial cpu implementations to 50 in parallel gpu implementations given that speedup and convergence improves with lower permeability samples this method is especially applicable to tight low permeability porous domains such as tight sandstone heterogenous carbonate coal and shale this speedup of direct simulation which is especially prominent in the lower permeability tight samples see fig 8 essentially erases the errors in both permeability and velocity field for pnm pfvs in the case of pnms this is particularly effective given the significant quantitative and visual differences in projected velocity field and the direct simulation result see figs 5 and 6 for merely 2 000 lbm timesteps in these tested samples which equates to a few minutes of parallel lbm simulation on 16 workstation cores or a few seconds on a few gpus the errors in a pnm estimation are corrected for to reach direct simulation accuracy without the need for the significant computational requirements that direct simulation itself would need without the pnm pfvs estimate to act as preconditioner while permeability error correction to direct simulation accuracy is effective using this method it is important to understand also that the assumption that direct simulation is the ground truth presents a purely computational perspective on the problem of permeability measurement comparison to experimental results of permeability must pass through a few sources of error that are uncontrollable by the flow simulation method itself image quality resolution and segmentation of the pore space are factors that limit the accuracy of even direct simulation to experiments performed in reality mostaghimi et al 2013 though direct simulation holds the potential to completely match a core flooding experiment given the choice direct simulation most closely mirrors experimental results with its main barrier to more common use being the high computational cost especially in tight unconventional rocks chen et al 2015 the primary benefit of this technique is the relatively minor computation required on top of pnm pfvs required to obtain direct simulation level accuracy for permeability and velocity fields at steady state conditions this allows for more efficient further numerical analysis of reactive transport mostaghimi et al 2016 fines migration cheng et al 2018 and other transport phenomena list of acronyms pnm pore network model sas semi analytical solver pfvs pore scale finite volume solver nse navier stokes equation lbm lattice boltzmann method mrt multiple relaxation time srt single relaxation time mlups million lattice updates per second pdf probability density function credit authorship contribution statement ying da wang conceptualization methodology software validation formal analysis traiwit chung software resources writing original draft writing review editing arash rabbani software resources data curation writing original draft writing review editing ryan t armstrong supervision methodology writing review editing peyman mostaghimi supervision conceptualization methodology writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the samples used in this study are taken from the deepore dataset rabbani 2020 http doi org 10 5281 zenodo 3820900 aarnes gimse lie 2007 j e aarnes t gimse k a lie an introduction to the numerics of flow in porous media using matlab 2007 springer berlin heidelberg berlin heidelberg 265 306 aarnes j e gimse t lie k a 2007 an introduction to the numerics of flow in porous media using matlab springer berlin heidelberg berlin heidelberg pp 265 306 10 1007 978 3 540 68783 2 9 akanji matthai 2010 l akanji s matthai finite element based characterization of pore scale geometry and its impact on fluid flow transp porous media 81 2010 241 259 10 1007 s11242 009 9400 7 akanji l matthai s 2010 finite element based characterization of pore scale geometry and its impact on fluid flow transport in porous media 81 241 259 10 1007 s11242 009 9400 7 arns adler 2018 c arns p adler fast laplace solver approach to pore scale permeability phys rev e 97 2 2018 023303 arns c adler p 2018 fast laplace solver approach to pore scale permeability physical review e 97 2 023303 blunt 2017 m j blunt multiphase flow in permeable media a pore scale perspective 2017 cambridge university press blunt m j 2017 multiphase flow in permeable media a pore scale perspective cambridge university press blunt bijeljic dong gharbi iglauer mostaghimi paluszny pentland 2013 m j blunt b bijeljic h dong o gharbi s iglauer p mostaghimi a paluszny c pentland pore scale imaging and modelling advances in water resources 51 2013 197 216 10 1016 j advwatres 2012 03 003 blunt m j bijeljic b dong h gharbi o iglauer s mostaghimi p paluszny a pentland c 2013 pore scale imaging and modelling advances in water resources 51 197 216 35th year anniversary issue 10 1016 j advwatres 2012 03 003 35th year anniversary issue blunt jackson piri valvatne 2002 m j blunt m d jackson m piri p h valvatne detailed physics predictive capabilities and macroscopic consequences for pore network models of multiphase flow adv water resour 25 8 2002 1069 1089 10 1016 s0309 1708 02 00049 0 blunt m j jackson m d piri m valvatne p h 2002 detailed physics predictive capabilities and macroscopic consequences for pore network models of multiphase flow advances in water resources 25 8 1069 1089 10 1016 s0309 1708 02 00049 0 boek venturoli 2010 e s boek m venturoli lattice boltzmann studies of fluid flow in porous media with realistic rock geometries comput math appl 59 7 2010 2305 2314 boek e s venturoli m 2010 lattice boltzmann studies of fluid flow in porous media with realistic rock geometries computers mathematics with applications 59 7 2305 2314 chen zhang kang viswanathan yao tao 2015 l chen l zhang q kang h s viswanathan j yao w tao nanoscale simulation of shale transport properties using the lattice boltzmann method permeability and diffusivity sci rep 5 1 2015 1 8 chen l zhang l kang q viswanathan h s yao j tao w 2015 nanoscale simulation of shale transport properties using the lattice boltzmann method permeability and diffusivity scientific reports 5 1 1 8 cheng wang yang 2018 k cheng y wang q yang a semi resolved cfd dem model for seepage induced fine particle migration in gap graded soils comput geotech 100 2018 30 51 10 1016 j compgeo 2018 04 004 cheng k wang y yang q 2018 a semi resolved cfd dem model for seepage induced fine particle migration in gap graded soils computers and geotechnics 100 30 51 10 1016 j compgeo 2018 04 004 chung wang mostaghimi armstrong 2019 t chung y wang p mostaghimi r armstrong approximating permeability of micro ct images using elliptic flow equations spe j 2019 chung t wang y mostaghimi p armstrong r 2019 approximating permeability of micro ct images using elliptic flow equations spe journal chung wang armstrong mostaghimi 2020 t chung y d wang r t armstrong p mostaghimi cnn pfvs integrating neural networks and finite volume solvers to accelerate flow simulation on pore space images transp porous media 2020 chung t wang y d armstrong r t mostaghimi p 2020a cnn pfvs integrating neural networks and finite volume solvers to accelerate flow simulation on pore space images transport in porous media chung wang armstrong mostaghimi 2020 t chung y d wang r t armstrong p mostaghimi voxel agglomeration for accelerated estimation of permeability from micro ct images j pet sci eng 184 2020 106577 10 1016 j petrol 2019 106577 chung t wang y d armstrong r t mostaghimi p 2020b voxel agglomeration for accelerated estimation of permeability from micro ct images journal of petroleum science and engineering 184 106577 10 1016 j petrol 2019 106577 culligan wildenschild christensen gray rivers 2006 k culligan d wildenschild b christensen w gray m rivers pore scale characteristics of multiphase flow in porous media a comparison of air water and oil water experiments advances in water resources 29 2 2006 227 238 10 1016 j advwatres 2005 03 021 culligan k wildenschild d christensen b gray w rivers m 2006 pore scale characteristics of multiphase flow in porous media a comparison of airwater and oilwater experiments advances in water resources 29 2 227 238 experimental hydrology a bright future 10 1016 j advwatres 2005 03 021 experimental hydrology a bright future delerue lomov parnas verpoest wevers 2003 j f delerue s v lomov r parnas i verpoest m wevers pore network modeling of permeability for textile reinforcements polym compos 24 3 2003 344 357 delerue j f lomov s v parnas r verpoest i wevers m 2003 pore network modeling of permeability for textile reinforcements polymer composites 24 3 344 357 dong blunt 2009 h dong m j blunt pore network extraction from micro computerized tomography images phys rev e 80 3 2009 036307 dong h blunt m j 2009 pore network extraction from micro computerized tomography images physical review e 80 3 036307 dong fjeldstad alberts roth bakke øren et al 2008 h dong s fjeldstad l alberts s roth s bakke p e øren pore network modelling on carbonate a comparative study of different micro ct network extraction methods international symposium of the society of core analysts society of core analysts 2008 dong h fjeldstad s alberts l roth s bakke s øren p e et al 2008 pore network modelling on carbonate a comparative study of different micro ct network extraction methods in international symposium of the society of core analysts society of core analysts fenwick blunt 1998 d h fenwick m j blunt three dimensional modeling of three phase imbibition and drainage adv water resour 21 2 1998 121 143 10 1016 s0309 1708 96 00037 1 fenwick d h blunt m j 1998 three dimensional modeling of three phase imbibition and drainage advances in water resources 21 2 121 143 10 1016 s0309 1708 96 00037 1 geiger roberts matthäi zoppou burri 2004 s geiger s roberts s matthäi c zoppou a burri combining finite element and finite volume methods for efficient multiphase flow simulations in highly heterogeneous and structurally complex geologic media geofluids 4 4 2004 284 299 geiger s roberts s matthäi s zoppou c burri a 2004 combining finite element and finite volume methods for efficient multiphase flow simulations in highly heterogeneous and structurally complex geologic media geofluids 4 4 284 299 hao cheng 2009 l hao p cheng lattice boltzmann simulations of anisotropic permeabilities in carbon paper gas diffusion layers j power sources 186 1 2009 104 114 hao l cheng p 2009 lattice boltzmann simulations of anisotropic permeabilities in carbon paper gas diffusion layers journal of power sources 186 1 104 114 hilpert miller 2001 m hilpert c t miller pore morphology based simulation of drainage in totally wetting porous media advances in water resources 24 3 2001 243 255 10 1016 s0309 1708 00 00056 7 hilpert m miller c t 2001 pore morphology based simulation of drainage in totally wetting porous media advances in water resources 24 3 243 255 pore scale modeling 10 1016 s0309 1708 00 00056 7 pore scale modeling keehm mukerji nur 2004 y keehm t mukerji a nur permeability prediction from thin sections 3d reconstruction and lattice boltzmann flow simulation geophys res lett 31 4 2004 keehm y mukerji t nur a 2004 permeability prediction from thin sections 3d reconstruction and lattice boltzmann flow simulation geophysical research letters 31 4 keil rieckmann 1994 f j keil c rieckmann optimization of three dimensional catalyst pore structures chemical engineering science 49 24 part a 1994 4811 4822 10 1016 s0009 2509 05 80061 2 keil f j rieckmann c 1994 optimization of three dimensional catalyst pore structures chemical engineering science 49 24 part a 4811 4822 chemical reaction engineering science and technology 10 1016 s0009 2509 05 80061 2 chemical reaction engineering science and technology latt malaspinas kontaxakis parmigiani lagrava brogi belgacem thorimbert leclaire li marson lemus kotsalos conradin coreixas petkantchin raynaud beny chopard 2020 j latt o malaspinas d kontaxakis a parmigiani d lagrava f brogi m b belgacem y thorimbert s leclaire s li f marson j lemus c kotsalos r conradin c coreixas r petkantchin f raynaud j beny b chopard palabos parallel lattice boltzmann solver comput math appl 2020 10 1016 j camwa 2020 03 022 latt j malaspinas o kontaxakis d parmigiani a lagrava d brogi f belgacem m b thorimbert y leclaire s li s marson f lemus j kotsalos c conradin r coreixas c petkantchin r raynaud f beny j chopard b 2020 palabos parallel lattice boltzmann solver computers mathematics with applications 10 1016 j camwa 2020 03 022 lie krogstad ligaarden natvig nilsen skaflestad 2012 k a lie s krogstad i s ligaarden j r natvig h m nilsen b skaflestad open source matlab implementation of consistent discretisations on complex grids comput geosci 16 2 2012 297 322 lie k a krogstad s ligaarden i s natvig j r nilsen h m skaflestad b 2012 open source matlab implementation of consistent discretisations on complex grids computational geosciences 16 2 297 322 lie møyner natvig kozlova bratvedt watanabe li 2016 k a lie o møyner j r natvig a kozlova k bratvedt s watanabe z li successful application of multiscale methods in a real reservoir simulator environment ecmor xv 15th european conference on the mathematics of oil recovery 2016 european association of geoscientists engineers cp 494 lie k a møyner o natvig j r kozlova a bratvedt k watanabe s li z 2016 successful application of multiscale methods in a real reservoir simulator environment in ecmor xv 15th european conference on the mathematics of oil recovery european association of geoscientists engineers pp cp 494 liu mostaghimi 2017 m liu p mostaghimi characterisation of reactive transport in pore scale correlated porous media chem eng sci 173 2017 121 130 10 1016 j ces 2017 06 044 liu m mostaghimi p 2017a characterisation of reactive transport in pore scale correlated porous media chemical engineering science 173 121 130 10 1016 j ces 2017 06 044 liu mostaghimi 2017 m liu p mostaghimi pore scale simulation of dissolution induced variations in rock mechanical properties int j heat mass transf 111 2017 842 851 liu m mostaghimi p 2017b pore scale simulation of dissolution induced variations in rock mechanical properties international journal of heat and mass transfer 111 842 851 liu shabaninejad mostaghimi 2017 m liu m shabaninejad p mostaghimi impact of mineralogical heterogeneity on reactive transport modelling comput geosci 104 2017 12 19 10 1016 j cageo 2017 03 020 liu m shabaninejad m mostaghimi p 2017 impact of mineralogical heterogeneity on reactive transport modelling computers and geosciences 104 12 19 10 1016 j cageo 2017 03 020 liu shabaninejad mostaghimi 2018 m liu m shabaninejad p mostaghimi predictions of permeability surface area and average dissolution rate during reactive transport in multi mineral rocks j pet sci eng 170 2018 130 138 10 1016 j petrol 2018 06 010 liu m shabaninejad m mostaghimi p 2018 predictions of permeability surface area and average dissolution rate during reactive transport in multi mineral rocks journal of petroleum science and engineering 170 130 138 10 1016 j petrol 2018 06 010 mahbub shi nasu wang zheng 2020 m a a mahbub f shi n j nasu y wang h zheng mixed stabilized finite element method for the stationary stokes dual permeability fluid flow model comput methods appl mech eng 358 2020 112616 10 1016 j cma 2019 112616 mahbub m a a shi f nasu n j wang y zheng h 2020 mixed stabilized finite element method for the stationary stokes dual permeability fluid flow model computer methods in applied mechanics and engineering 358 112616 10 1016 j cma 2019 112616 manwart aaltosalmi koponen hilfer timonen 2002 c manwart u aaltosalmi a koponen r hilfer j timonen lattice boltzmann and finite difference simulations for the permeability for three dimensional porous media phys rev e 66 1 2002 016702 manwart c aaltosalmi u koponen a hilfer r timonen j 2002 lattice boltzmann and finite difference simulations for the permeability for three dimensional porous media physical review e 66 1 016702 mcclure prins miller 2014 j mcclure j prins c miller a novel heterogeneous algorithm to simulate multiphase flow in porous media on multicore cpu gpu systems comput phys commun 185 7 2014 1865 1874 10 1016 j cpc 2014 03 012 mcclure j prins j miller c 2014 a novel heterogeneous algorithm to simulate multiphase flow in porous media on multicore cpugpu systems computer physics communications 185 7 1865 1874 10 1016 j cpc 2014 03 012 mostaghimi bijeljic blunt et al 2012 p mostaghimi b bijeljic m blunt simulation of flow and dispersion on pore space images spe j 17 04 2012 1 131 mostaghimi p bijeljic b blunt m et al 2012 simulation of flow and dispersion on pore space images spe journal 17 04 1 131 mostaghimi blunt bijeljic 2013 p mostaghimi m j blunt b bijeljic computations of absolute permeability on micro ct images math geosci 45 1 2013 103 125 mostaghimi p blunt m j bijeljic b 2013 computations of absolute permeability on micro ct images mathematical geosciences 45 1 103 125 mostaghimi liu arns 2016 p mostaghimi m liu c h arns numerical simulation of reactive transport on micro ct images math geosci 48 8 2016 963 983 10 1007 s11004 016 9640 3 mostaghimi p liu m arns c h 2016 numerical simulation of reactive transport on micro ct images mathematical geosciences 48 8 963 983 10 1007 s11004 016 9640 3 mostaghimi mahani et al 2010 p mostaghimi h mahani a quantitative and qualitative comparison of coarse grid generation techniques for modeling fluid displacement in heterogeneous porous media spe reservoir eval eng 13 01 2010 24 36 mostaghimi p mahani h et al 2010 a quantitative and qualitative comparison of coarse grid generation techniques for modeling fluid displacement in heterogeneous porous media spe reservoir evaluation engineering 13 01 24 36 ovaysi piri 2012 s ovaysi m piri multi gpu acceleration of direct pore scale modeling of fluid flow in natural porous media comput phys commun 183 9 2012 1890 1898 ovaysi s piri m 2012 multi gpu acceleration of direct pore scale modeling of fluid flow in natural porous media computer physics communications 183 9 1890 1898 rabbani 2020 a rabbani deepore dataset 2020 10 5281 zenodo 3820900 rabbani a 2020 deepore dataset 10 5281 zenodo 3820900 rabbani babaei 2019 a rabbani m babaei hybrid pore network and lattice boltzmann permeability modelling accelerated by machine learning adv water resour 126 2019 116 128 rabbani a babaei m 2019 hybrid pore network and lattice boltzmann permeability modelling accelerated by machine learning advances in water resources 126 116 128 rabbani babaei shams wang chung 2020 a rabbani m babaei r shams y d wang t chung deepore a deep learning workflow for rapid and comprehensive characterization of porous materials adv water resour 146 2020 103787 10 1016 j advwatres 2020 103787 rabbani a babaei m shams r wang y d chung t 2020 deepore a deep learning workflow for rapid and comprehensive characterization of porous materials advances in water resources 146 103787 10 1016 j advwatres 2020 103787 rabbani mostaghimi armstrong 2019 a rabbani p mostaghimi r t armstrong pore network extraction using geometrical domain decomposition adv water resour 123 2019 70 83 rabbani a mostaghimi p armstrong r t 2019 pore network extraction using geometrical domain decomposition advances in water resources 123 70 83 raeini bijeljic blunt 2015 a q raeini b bijeljic m j blunt modelling capillary trapping using finite volume simulation of two phase flow directly on micro ct images adv water resour 83 2015 102 110 raeini a q bijeljic b blunt m j 2015 modelling capillary trapping using finite volume simulation of two phase flow directly on micro ct images advances in water resources 83 102 110 sandino kroliczek mcerlain boyd 2014 c sandino p kroliczek d d mcerlain s k boyd predicting the permeability of trabecular bone by micro computed tomography and finite element modeling j biomech 47 12 2014 3129 3134 sandino c kroliczek p mcerlain d d boyd s k 2014 predicting the permeability of trabecular bone by micro computed tomography and finite element modeling journal of biomechanics 47 12 3129 3134 saxena hofmann alpak berg dietderich agarwal tandon hunter freeman wilson 2017 n saxena r hofmann f o alpak s berg j dietderich u agarwal k tandon s hunter j freeman o b wilson and benchmarks for pore scale flow simulated using micro ct images of porous media and digital rocks adv water resour 109 2017 211 235 saxena n hofmann r alpak f o berg s dietderich j agarwal u tandon k hunter s freeman j wilson o b 2017 
334,how floods respond to changing climate is of great concern in research community and society but there is no consistent conclusion about whether floods are as sensitive to changes in temperature as precipitation extremes in this study the responses and connections of local floods to temperature and precipitation extremes over three hydroclimatically different regions across the united states were explored the regions include northeast coast humid coast central plains dry inland southeast plains humid subtropic varying in atmospheric moisture availability investigation was made at both hourly and daily timescales and the influences of watershed imperviousness on flood responses were highlighted by using small watersheds 600 km2 and categorizing watersheds based on watershed imperviousness correlation and co occurrence probability analysis shows that the connections between floods and precipitation extremes over the studied watersheds are relatively high with the majority showing a value of 0 6 and 0 5 for the two criteria respectively scaling analysis finds that hourly precipitation extremes generally scale with daily temperature according to the clausius clapeyron cc relationship but daily precipitation extremes reflect smaller scaling rates and even decrease with rising temperature at higher temperatures despite floods in the studied watersheds are highly related with precipitation extremes the scaling of flood temperature is always lower than that of extreme precipitation temperature increasing connections between floods and precipitation extremes resulted from higher watershed imperviousness or in summer months tend to increase the scaling of flood temperature even to a close cc relationship however the scaling of flood temperature still cannot surpass that of extreme precipitation temperature it is generally concluded that flood would change with rising temperature at a rate smaller than what is expected from the scaling of precipitation extremes to temperature and precipitation scaling analysis should better use finer timescale e g hourly precipitation records keywords climate change flood extreme precipitation urbanization sub daily scale 1 introduction considerable evidences have shown precipitation extremes are increasing in both magnitude and frequency due to rising temperature allan and soden 2008 donat et al 2013 martinez villalobos and neelin 2018 o gorman 2015 roxy et al 2017 further leading to changes in flood hazards do et al 2017 hall et al 2014 hannaford and marsh 2008 mediero et al 2014 on the other hand with the development of human society there are large increases in world population and urban areas which changes more natural lands to impervious covering such as asphalt and concrete zhang et al 2018 both factors make flood one of the most destructive natural hazards become more concerned by human beings it is initially intuitive that changes in extreme precipitation under warming climate would translate into similar changes in flood e g increases in extreme precipitation translate to increases in flood considering extreme precipitation is one of the main flood triggers ivancic and shaw 2015 smith and ward 1998 wasko and sharma 2017 thus many studies have focused on the relationship between precipitation extremes and temperature and used the precipitation temperature relationship to infer potential flood changes under warming climate westra et al 2014 wasko and sharma 2017 yin et al 2018 ghausi and ghosh 2020 fowler et al 2021 allen and ingram 2002 proposed the clausius clapeyron cc thermodynamics could be a dominant physical constraint for the relationship between precipitation extremes and temperature as atmospheric moisture tends to be precipitated out when forming extreme precipitation event the cc relationship theoretically describes the changes of atmospheric moisture holding capacity with temperature and estimates that atmospheric moisture holding capacity would increase at a rate of 6 7 c with rising temperature alduchov and eskridge 1996 1997 visser et al 2020 many studies have examined whether the cc theory is applicable to the actual changes of precipitation extremes to temperature using observations for example lenderink and van meijgaard 2008 analyzed the extreme precipitation temperature scaling using 99 year observed hourly precipitation and temperature records in de bilt netherlands hardwick jones et al 2010 examined the scaling between extreme sub hourly precipitation and surface temperature across the australia mishra et al 2012 evaluated the scaling relationship between hourly extreme precipitation and daily temperature over the contiguous united states conus miao et al 2016 analyzed the scaling relationship between hourly precipitation and temperature in warm seasons over china generally these studies found the relationship between extreme precipitation and temperature is in lie with the cc theory to some extent fowler et al 2021 but the actual relationship varies in different regions and seasons for the scaling between daily precipitation extremes and temperature many studies have found a peak like pattern e g utsumi et al 2011 wang et al 2017 yin et al 2018 which means precipitation extremes increase with rising temperature up to a temperature threshold and then decrease with continual temperature rise this peak like scaling pattern is believed to be largely caused by atmospheric moisture limitation at higher temperatures berg et al 2009 hardwick jones et al 2010 prein et al 2017 roderick et al 2019 using the scaling of extreme precipitation temperature to infer potential flood changes under warming climate has been questioned in recent decades do et al 2017 sharma et al 2018 wasko and nathan 2019 there are many observed evidences showing in some regions precipitation extremes have increased but floods generally show decreasing trend e g ishak et al 2013 westra et al 2013 zhang et al 2016 the transition from climate to flood is highly complex modulating by many issues including land properties climate variation and anthropogenic activities archfield et al 2016 viglione et al 2016 blöschl et al 2017 2019 for example some studies have found long term rainfall could play a dominant role in triggering floods blöschl et al 2017 do et al 2020a how to predict flood changes under warming climate becomes a difficult question the most significant and common feature of climate change is climate warming while the changes in other climatic and hydrological variables including flood could be considered as a direct consequence of climate warming or have some correlation with climate warming on the other hand there is no single variable which can serve as a strong predictor for flood even extreme precipitation and floods are usually modulated by a combination of more than one hydrological process brunner et al 2020 do et al 2020b thus some studies turned to examine the sensitivity of floods to temperature directly aiming to better understand how floods would change under warming climate wasko and sharma 2017 assessed the scaling of precipitation extremes and floods to temperature at a global scale they found positive extreme precipitation scaling pattern but negative flood scaling pattern for most regions yin et al 2018 implemented a global analysis similar to wasko and sharma 2017 but got opposite conclusions they found higher scaling rates of storm runoff extremes with baseflow removed to temperature than those of precipitation extremes for most regions one potential reason behind the opposite conclusions is wasko and sharma 2017 only used non urbanized catchments so the influence of anthropogenic activities on floods was excluded another possible reason is the two studies used different temperature ranges wasko et al 2019 wasko and sharma 2017 omitted the streamflow below 5 c during which streamflow extremes are mostly caused by snowmelt rather than extreme precipitation the opposite conclusions might suggest that the natural relationship of floods to temperature could be altered by anthropogenic activities especially urbanization which increases surface imperviousness and reduces precipitation loss in infiltration and depression smith et al 2005 villarini et al 2009a causing the sensitivity of floods to temperature being higher than that of precipitation extremes however this inference needs to be confirmed by further study in addition a higher scaling rate to temperature is always expected for hourly precipitation extremes than for daily precipitation extremes hardwick jones et al 2010 panthou et al 2014 but it is not clear whether this conclusion still holds for flood scaling previous studies exploring the relationship between floods and temperature were mostly implemented at global scale however floods are local events their occurrence is heavily determined by local characteristics archfield et al 2016 tramblay et al 2019 whitfield 2012 such as watershed imperviousness in order to better understand how floods would respond to changing climate locally the relationship between floods and temperature should be also explored at local scale which is rarely seen in current research literature this study focused on three regions in the united states with similar topography including northeast coast central plains and southeast plains these regions are distinct in hydrometeorological characteristics the northeast coast is a humid coastal region the central plains is dry inland and the southeast plains is humid subtropic varying in atmospheric moisture availability shaw et al 2011 annual average temperature in the us was reported to have increased rapidly since 1970 vose et al 2017 the annual average temperature in 1986 2016 is about 0 7 c higher relative to 1901 1960 extreme precipitation events have increased in both intensity and frequency since 1901 over most us regions easterling et al 2017 but the trends vary spatially largest increases were found to occur in the northeastern us flood trends over the us show large spatial variability and no monotonic trends were detected douglas et al 2000 villarini et al 2009b archfield et al 2016 for the central region it is generally shown flood occurrence has increased significantly due to higher frequencies of heavy precipitation event but flood magnitude does not show obvious trend mallakpour and villarini 2015 several studies have found increasing flood trends in the eastern region archfield et al 2016 do et al 2017 generally flood changing patterns in the us show weak geographic cohesion and are highly related to local climate and geophysical characteristics archfield et al 2016 thus smaller scale investigations are needed therefore this study investigated how floods respond to temperature locally investigations were made at both hourly and daily timescales watershed imperviousness was highlighted for its effects on modulating the responses of floods to temperature this study tried to answer the following questions 1 how do precipitation extremes and floods scale with temperature locally 2 how does flood temperature scaling relationship vary with timescale i e whether flood temperature scaling is higher at hourly timescale relative to that at daily timescale 3 how do the flood responses to temperature change with watershed imperviousness this paper is organized as follows the studied area and used data are introduced in section 2 the analysis methods are described in section 3 section 4 elaborates on the analysis results and makes relevant discussions the main conclusions from this study are summarized in section 5 2 studied area and data 2 1 studied area watersheds in the studied regions were chosen mainly based on three criteria drainage area sub daily discharge record length watershed imperviousness first only the watersheds smaller than 600 km2 were chosen as this study focused on one local watershed characteristic i e imperviousness only the imperviousness in small watersheds can reach relatively high degree about 50 in this study in addition a narrow range of watershed drainage area can eliminate the influences of drainage area on the study results the watersheds were further chosen based on sub daily discharge record length in 1981 2013 only the watersheds with more than 15 year sub daily discharge record and less than 10 missing data in each year were considered choosing watersheds based on discharge record length was also considered in scaling analysis see section 3 4 for the details finally as this study classified watersheds into three imperviousness categories watershed numbers of these categories were kept consistent to avoid the influence of different sample numbers excess watersheds with relatively short discharge records were omitted the majority of the chosen watersheds are independent i e un nested watersheds except for 6 watersheds distributed in the three regions the locations of the chosen watersheds are shown in fig 1 the mountainous western us region was not considered as the effect of topography on flood temperature relationship was not the focus of this study 2 2 watershed data fifteen minute discharge data of the studied watersheds were downloaded from the united states geological survey usgs database https waterdata usgs gov the discharge records at hourly time points e g 1 00 2 00 3 00 were extracted from the 15 min time series to form hourly counterparts while those at 00 00 of each daily were extracted to form daily time series the rationale is assuming discharge is measured and logged once an hour or a day watershed land use land cover information mainly imperviousness was obtained from the usgs gages ii product falcone 2017 the imperviousness of all studied watersheds is rather stable during the studied period soil moisture data from the global climate prediction center cpc dataset dool et al 2003 were used when analyzing the connections between watershed precipitation extremes and floods the list of the studied watersheds along with their drainage areas and imperviousness is provided in table s1 the hydrological stations were matched to the nearest meteorological stations ghcn daily network described in section 2 3 to obtain daily temperature for the watersheds considering the studied watersheds are small and surface air temperature shows low spatial variability the temperature recorded at the nearest meteorological station can represent the temperature condition over the watershed area the mean and maximum distances between the hydrological stations and the matched meteorological stations are around 8 9 km and 27 6 km respectively 2 3 climate data this study used gauged daily surface air temperature hourly precipitation hourly relative humidity and watershed averaged precipitation daily temperature data was obtained from the global historical climate network daily ghcn daily dataset menne et al 2020 tang et al 2020 hourly precipitation data was extracted from the national climatic data center ncdc https www ncdc noaa gov cdo web search datasetid precip hly relative humidity was obtained from the us national centers for environmental information ncei global summary of the day gsod dataset in each region the meteorological stations with long hourly precipitation records in 1981 2013 were preserved the studied period 1981 2013 was determined from the jointly covered period by observed hourly precipitation and 15 min discharge 15 min discharge record mostly begins in 1981 while hourly precipitation record mostly ends in 2013 the list of the used meteorological stations for hourly precipitation is shown in table s2 with 9 stations in each region relative humidity data was used for explaining the scaling patterns of precipitation extremes to temperature to identify whether precipitation extreme have a strong connection to flood occurrence the approach in ivancic and shaw 2015 do et al 2020b for identifying correlation and co occurrence probability between these two variables was used as raw gauged precipitation cannot fully represent the precipitation condition over a watershed watershed averaged daily precipitation from another dataset was used this dataset is the hydrometeorological sandbox école de technologie supérieure hysets which is a comprehensive dataset containing the watershed averaged daily precipitation temperature and streamflow data for nearly all watersheds across the north america arsenault et al 2020 the watershed averaged meteorological data in hysets were based on two sources ghcn daily and the station based serially complete dataset for north america scdna the two datasets have missing data in different time periods so the datasets were first combined to provide relatively complete meteorological time series for the 1950 2018 period averaging was then made to the combined dataset using the thiessen polygons method to get watershed averaged meteorological data arsenault et al 2020 however this dataset only has daily time series but scaling analysis of precipitation extremes and floods were made at both hourly and daily timescales thus watershed averaged daily precipitation from the hysets was only used for exploring the connections between watershed precipitation extremes and floods and scaling comparison at daily timescale the rationality of using two types of precipitation data for daily scaling analysis was demonstrated in figure s1 where the regional scaling rates of daily extreme precipitation to temperature estimated using the two data sets are shown to be similar in the following part unless otherwise stated the used precipitation data is gauged precipitation from the ncdc database 3 methods 3 1 imperviousness category determination in order to highlight the influences of watershed imperviousness on flood responses to climate and minimize the influences of others e g watershed slope and river damming the watersheds in each region were classified into three categories equally based on watershed imperviousness thus the watersheds in each category are similar in imperviousness but may vary significantly in other watershed characteristics the watersheds in each imperviousness category were treated as an ensemble and the analysis was mainly based on the ensemble medians so as to focus on the influences of watershed imperviousness on flood responses two imperviousness thresholds of 21 and 10 were used to classify all watersheds into three groups equally each has 15 catchments table s1 the three groups represent high 21 middle 10 21 and low 10 imperviousness degree respectively please note there is no standard imperviousness classification method the three categories in this study were determined mainly based on the watershed number distributions with imperviousness and to make sure the watershed numbers in these categories are equal 3 2 trend analysis of mean temperature precipitation extremes and floods the changing trends of historical mean temperature precipitation extremes and floods were first analyzed to generally show how floods have changed under changing climate annual mean temperature annual maximum precipitation and annual maximum streamflow at both hourly and daily timescales were analyzed the temporal changing trends were estimated using the theil sen slope estimator sen 1968 theil 1992 do et al 2020b and the mann kendall test kendall 1948 mann 1945 was further applied to examine the statistical significance of these trends the theil sen slope for a time series is the median slope of those calculated using all possible pairs of data in the time series described as 1 s m e d i a n y j y i j i 10 y e a r s where s is the estimated theil sen slope and yj and yi are the variable values in paired years j and i respectively for precipitation and streamflow the slopes were normalized by the mean of annual maximum time series expressed as percentage change per decade decade while temperature slope was not normalized and expressed as degree celsius per decade c decade 3 3 connection analysis between precipitation extremes and floods the connections between watershed precipitation extremes and floods were analyzed using watershed averaged daily precipitation data from the hysets and daily streamflow data the analysis methods are based on ivancic and shaw 2015 and do et al 2020b including pearson correlation coefficient benesty et al 2009 between annual maximum precipitation and streamflow and co occurrence probability between precipitation extremes and floods in analyzing co occurrence probability extreme precipitation events were defined as those greater than the 99th percentile of wet daily precipitation amounts flood events were also defined using the peak over threshold method with the 99th percentile of daily streamflow time series as the threshold the lag time between precipitation and streamflow events were determined from the correlation analysis of lagged precipitation and streamflow time series ivancic and shaw 2015 the lag time when the largest correlation between precipitation and streamflow time series was defined as the hydrological response time a threshold of 5 day was used when determining the lag time precipitation extreme event and flood event within the lag time were treated as related events monthly soil moisture data was used to separate extreme precipitation and flood events into two groups events in dry months when monthly soil moisture is below the median soil moisture of the whole time series in 1981 2013 and events in wet months otherwise the co occurrence probability between precipitation extremes and floods was also calculated for the two groups 3 4 scaling analysis of precipitation extremes and floods to temperature precipitation extreme and flood scaling analysis was event based at each timescale precipitation and streamflow events were first identified from the precipitation and streamflow time series baseflow was not removed from streamflow time series as it only accounts for a small part of the total flow a precipitation event was defined as one separated by a specific time period of zero precipitation on either side named as event separation time or interevent time visser et al 2020 a streamflow event was defined if it contains at least one local flow peak also separated by a particular time period the maxima from the identified precipitation and streamflow events were matched to daily temperature to form precipitation temperature and streamflow temperature pairs these pairs were further stratified into different bins of 2 c width and the 99th percentile of precipitation or streamflow and median temperature for each bin were calculated hardwick jones et al 2010 westra et al 2014 lenderink and attema 2015 the locally weighted scatterplot smoothing lowess method cleveland 1979 utsumi et al 2011 was fitted to the precipitation or streamflow percentiles and median temperatures to reflect the generally changing patterns of precipitation extremes or floods with temperature linear regression was further used to estimate the actual scaling rates of precipitation extremes or floods to temperature in the temperature range where roughly linear relationship was detected by the lowess method wasko and sharma 2017 which is to statistically compare the scaling rates of precipitation extremes and floods to temperature this study used 2 c bins overlapped by 1 c to stratify precipitation temperature and streamflow temperature pairs wasko and sharma 2017 and also ensured at least 100 data were preserved in each bin bin temperature width was enlarged if there were less than 100 data in a 2 c temperature range this binning method enables more bins were created to reflect the changing patterns of precipitation extremes and floods to temperature and also preserved enough samples in each bin for reflecting event extremes this study omitted the bins with median temperature below 5 c to remove the snowmelt effect wasko et al 2019 wasko and sharma 2017 the watersheds with less than 10 bins at hourly timescale and 8 bins at daily timescale excluding bins below 5 c were not considered scaling analysis was first implemented to all months to reflect changing patterns of precipitation extremes and floods to temperature throughout the year and was further made in summer june july and august during which floods are mostly caused by precipitation extremes and hence are more related to precipitation extremes this is to further show how the scaling patterns of precipitation extremes and floods would be when the two variables are highly correlated the changes of wet day relative humidity with temperature were analyzed for potentially explaining the scaling patterns of precipitation extremes to temperature hardwick jones et al 2010 yin et al 2018 some studies have reported different choices of interevent time and event paired temperature can cause scaling uncertainty visser et al 2020 ghausi and ghosh 2020 to account for this uncertainty this study first assessed multiple choices of interevent time and temperature the best choice was determined as the one that results in closest scaling rates to the theoretical cc rate 7 c used 3 5 best combination of interevent time and temperature for scaling analysis fig 2 show the scaling rates of hourly extreme precipitation and flood to temperature when different choices of interevent time and temperature were used the analysis used all sites from the three regions followed visser et al 2020 here quantile regression was used to estimate the scaling rates since the specific scaling patterns are unknown for precipitation scaling it is clearly shown that using the same day temperature as precipitation event results in scaling rates closest to the cc rate as reflected by the median 25th percentile and 75th percentile values from all sites but using different interevent time does not change the scaling rates obviously for flood scaling it is shown using the temperature 1 day or 2 day before the flood events results in scaling rates closest to the cc rate and using the interevent time longer than 72h also increase the scaling rates the same analysis was also made to the daily extreme precipitation and flood scaling and the results show similar conclusions thus this study used 24h interevent time and same day temperature for hourly and daily extreme precipitation scaling analysis and used 72h interevent time and 1 day prior temperature for hourly and daily flood scaling analysis 4 results and discussion 4 1 historical changes in temperature precipitation extremes and floods fig 3 shows the estimated theil sen slopes of annual mean temperature annual maximum precipitation and annual maximum streamflow for the three regions the slopes of precipitation and streamflow were estimated at both hourly and daily timescales the spatial distribution of these trends is shown in figure s2 the changing trends i e slopes in temperature of all stations in the three regions are positive the median temperature slopes in the northeast coast and central plains are similar being around 0 25 c decade while is smaller in the southeast plains around 0 13 c decade most stations in the northeast coast and southeast plains show positive trends in annual maximum precipitation but the stations in the central plains tend to show decreasing precipitation trends the median trends in the northeast coast and southeast plains are mostly around 2 decade at hourly and daily timescales all stations in the central plains show negative changing trend for daily precipitation maxima while the stations reflecting positive and negative trends for hourly precipitation maxima are nearly equal with the median trend close to 0 the annual maximum streamflow in the northeast coast and central plains tend to have increased during the studied period suggested by the positive changing trends of most watersheds for these two regions the median changing trends of watersheds in the three imperviousness categories are mostly around 16 decade at both hourly and daily timescales and the median trends do not show uniform differences among the three imperviousness categories in the southeast plains it is interesting to find that the trends for watersheds in the high imperviousness category tend to be the highest as indicated by the highest medians at both hourly and daily timescales around 10 decade and 0 respectively the trends for watersheds in the low imperviousness category tend to be the lowest the median values are around 15 decade and 25 decade for hourly and daily timescales respectively except for temperature trend the mann kendall test shows that the trends are not significant at the 0 05 significance level for precipitation and streamflow at most sites figure s2 the changing trends positive or negative of temperature precipitation and streamflow are not the same with each other except for in the northeast coast for example most stations in the central plain show negative precipitation trends but the watersheds in the central plains actually show positive streamflow trends although the temperature in the three regions has increased the three regions report both positive and negative trends in precipitation and streamflow maxima the trend analysis reflects the complex relationship between temperature precipitation and streamflow maxima 4 2 connections between precipitation extremes and floods fig 4 shows the connections between precipitation extremes and floods for the studied watersheds the spatial distribution of the connection values is shown in figure s3 the correlations between annual maximum precipitation and streamflow are rather high for the studied watersheds the correlation coefficients for most watersheds are above 0 5 and the median coefficients for the three imperviousness categories are nearly all above 0 6 in the three regions comparing to the results in ivancic and shaw 2015 do et al 2020b which shows about 30 flooding events in the us are highly correlated to precipitation extremes the correlations for the watersheds in this study are much higher this is expected to be because the studied watersheds are very small in which precipitation losses due to deficit soil moisture and depression are minor thus most water from extreme precipitation is translated to floods and results in high correlations between precipitation extremes and floods wasko and sharma 2017 hettiarachchi et al 2019 wasko et al 2020 in addition the correlations between precipitation and streamflow for watersheds in the high imperviousness categories tend to be the highest while tend to be the lowest for the low imperviousness categories for example in the northeast coast the 25th 50th and 75th percentiles of the correlation coefficients for watersheds in the high imperviousness category are around 0 65 0 80 and 0 82 respectively while the values for the low imperviousness category are around 0 60 0 61 and 0 74 respectively the higher correlations for the high imperviousness categories suggest that increasing watershed imperiousness can enhance the connections between watershed precipitation and streamflow this reason behind is also precipitation loss has decreased due to rising watershed imperviousness the co occurrence probabilities between extreme precipitation and flood events for the studied watersheds are also rather high the median co occurrence probabilities for all imperiousness categories are nearly above 0 5 after separating extreme precipitation and flood events using soil moisture the co occurrence probabilities for the high soil moisture cases increased the co occurrence probabilities for the studied watersheds are higher than those reported for the watersheds across the us ivancic and shaw 2015 the high co occurrence probabilities during higher soil moisture suggest that soil moisture conditions also modulate the relationship between precipitation extremes and floods which is consistent with the findings in some previous studies wasko et al 2019 wasko and nathan 2019 hettiarachchi et al 2019 cao et al 2020 in addition it is generally shown that the co occurrence probabilities for watersheds in the high imperviousness categories tend to be the highest no matter whether separating extreme events using soil moisture or not the results in this section reflect the connections between precipitation extremes and floods for the studied small watersheds are rather high considering the high connections between precipitation extremes and floods it could be interesting to reflect how they respond to temperature using scaling analysis 4 3 scaling relationships of precipitation extremes and floods to temperature 4 3 1 general scaling patterns for temperature above 5 c fig 5 shows the scaling patterns of hourly and daily precipitation extremes to daily temperature in the studied regions for hourly precipitation extremes the scaling patterns of individual stations and regional averages are highly linear for all the three regions the slopes of the scaling lines are close to the cc rate in the northeast coast while are slightly smaller in the central plains and southeast plains for daily precipitation scaling the stations in the same region show some variabilities for example in the northeast coast some stations show linear scaling patterns between precipitation extremes and temperature in the whole temperature range but the precipitation extremes in some stations increase linearly with rising temperature up to a temperature threshold peak point temperature and then decrease with continual temperature rise the regional average lines of daily scaling also reflect peak like scaling patterns especially in the northeast coast and southeast plains in addition the linear slopes before the peak point temperature are smaller than the cc rate in all the three regions fig 6 shows the scaling patterns of hourly and daily floods to daily temperature in the three imperviousness categories for the northeast coast as an example the scaling patterns vary among different watersheds in each imperviousness category some watersheds reflect positive scaling patterns while the scaling patterns in some watersheds are negative this might be because watershed floods are influenced and modulated by multiple processes especially various local watershed characteristics the ensemble smoothed lines in each imperviousness category reflect that averagely the changing patterns of floods to temperature tend to be linear however the change rates are smaller than the cc rate at both timescales the change rates also vary with different imperviousness degrees with the scaling rates in the high imperviousness categories being the highest only slightly smaller than the cc rate at hourly timescale and those in the low imperviousness categories being the lowest negative at both timescales the conclusions from the central plains and southeast plains are similar to those reported here in order to better evaluate and compare the sensitivities of precipitation extremes and floods to temperature the change rates of precipitation extremes and floods were estimated using linear regression at the temperature range where linear relationships were both found wasko and sharma 2017 which is 5 20 c in this study some studies used the lowess method to detect the peak point temperature for individual stations or region and estimate the scaling rates before the peak point temperature individually utsumi et al 2011 yin et al 2018 however this approach can lead to different temperature ranges were used for different stations or watersheds wasko et al 2019 4 3 2 scaling rates in the linear relationship temperature range fig 7 shows the scaling rates of precipitation extremes and floods to temperature in 5 20 c for the three regions the scaling rates were estimated from all binning data in a region or imperviousness category to reflect the average scaling rates and to obtain a stronger signal and robust analysis the scaling rates of hourly precipitation extremes to temperature are close to the cc rate for all the three regions in 5 20 c while those of daily precipitation extremes are smaller but positive forming a sub cc scaling pattern the smaller precipitation scaling rates at daily timescale might be because daily precipitation amounts actually contain many intermittencies visser et al 2020 while the influences of rainfall intermittencies become smaller when using finer timescale rainfall data e g hourly rainfall in this study for floods scaling all imperviousness categories and regions show rates smaller than the cc rate at both timescales the scaling rates of floods also vary with timescales with the scaling rates at hourly timescale being higher the scaling rates of floods tend to increase with rising watershed imperviousness as indicated by the highest scaling rates in the high imperviousness category in most cases however the scaling rates of floods are all smaller than those of precipitation extremes despite the increasing tendency of flood scaling rates with finer timescale and higher imperviousness fig 8 further shows the scatter plot of daily precipitation extreme and flood scaling rates for individual watersheds in 5 20 c to facilitate direct comparison of the scaling rates across individual watersheds the used daily precipitation data here was watershed averaged precipitation from the hysets dataset the watershed averaged precipitation is able to reflect similar regional precipitation scaling patterns compared with the gauged precipitation figure s1 the spatial distribution of the scaling rates is provided in figure s4 the daily precipitation scaling rates are mostly within 0 5 c but nearly half of the daily flood scaling rates are within 5 0 c and another half are within 0 5 c from the comparison in individual watersheds it is also shown that extreme precipitation scaling tends to be higher than that of flood to temperature when categorizing the precipitation and flood scaling rates accordingly to watershed imperviousness and regions it is shown that flood scaling rates at the high imperviousness category are mostly the largest or relatively larger among the three imperviousness categories however in the central plains the scaling rate in the higher imperviousness category is lower than that in the low imperviousness category which might be due to other watershed characteristics e g soil slope in addition precipitation scaling rates in the three imperviousness categories are similar for three regions which might reflect the influences and feedbacks of watershed imperviousness on precipitation formation could be neglected considering the small scales of these watersheds 4 3 3 scaling patterns of precipitation extremes and floods to temperature in summer fig 9 shows the changing patterns of precipitation extremes and floods to temperature in summer at hourly and daily timescales when using the gauged data change rates were not estimated here as the changing patterns in summer tend to be nonlinear in summer hourly precipitation extremes tend to change with rising temperature accordingly to the cc relationship but daily precipitation extremes tend to change negatively with temperature the contrasting scaling patterns highlight the importance of using finer timescale precipitation data for scaling analysis since daily precipitation amounts contain many rainfall intermittencies daily precipitation records might be inappropriate to reflect the inner relationship between precipitation extremes and temperature alexander et al 2019 lewis et al 2019 it is interesting to note that hourly floods in summer generally change with temperature roughly according to the cc relationship especially for the northeast coast and central plains and before 25 c for the southeast plains comparing to the sub cc and negative scaling patterns in 5 20 c fig 7 the scaling patterns in summer are much higher the scaling patterns of hourly precipitation extremes and floods for the high imperviousness category are highly close considering summer floods are mostly caused by precipitation extremes the similar scaling patterns between summer precipitation extremes and floods might suggest that with the increasing connections between precipitation extremes and floods the changing patterns of floods to temperature would replicate those of precipitation extremes to temperature despite the nonlinear process from precipitation to streamflow however although hourly flood temperature scaling high imperviousness is highly close to that of hourly precipitation extreme temperature flood scaling was not found to surpass the scaling of precipitation extremes this might suggest averagely speaking flood response to temperature would not surpass that of extreme precipitation to temperature 4 3 4 potential reasons behind the scaling relationships of precipitation extremes and floods to temperature fig 10 shows the changing patterns of wet day relative humidity with temperature at hourly and daily timescales the trend lines show that relative humidity is rather stable before a temperature threshold 20 25 c especially when considering all months after the temperature threshold relative humidity drops rapidly with increasing temperature this might explain why the changes of precipitation extremes to temperature are roughly linear before a peak point temperature and the change rates decrease at higher temperatures for flood scaling to temperature analyzing from the ensemble medians this scaling is also highly linear at a particular temperature range this linear relationship is also found in other studies wasko and sharma 2017 yin et al 2018 considering floods in the studied watersheds are highly related to precipitation extremes it could be expected that the linear changing patterns of precipitation extremes to temperature translate to linear changing patterns of floods to temperature one the other hand watersheds floods are also influenced by local watershed characteristics some precipitation falling on the watershed would be lost due to hydrological processes such as infiltration hettiarachchi et al 2019 wasko et al 2019 only part of precipitation is converted to streamflow which might explain why the sensitivity of floods to temperature tend not to surpass that of extreme precipitation extremes higher soil moisture or imperviousness condition can reduce precipitation loss but precipitation loss always exists and cannot be neglected 5 conclusions this study investigated the responses of floods to climate in watersheds with various degrees of imperviousness in three hydroclimatically different regions across the us the main conclusions drawn are summarized as 1 hourly precipitation extremes tend to scale with temperature according to the cc relationship but daily precipitation extremes change with temperature at rates smaller than the cc rate and even decrease at higher temperatures considering daily precipitation amounts actually contain many intermittencies it is recommended precipitation scaling analysis should use finer timescale e g hourly precipitation records 2 the connections between precipitation extremes and floods are relatively high for the studied watersheds given their small areas and increasing watershed imperviousness can enhance the connections between the two variables 3 despite the high connections between precipitation extremes and floods the scaling of floods to temperature is always lower than that of precipitation extremes to temperature higher connections between precipitation extremes and floods resulted from higher watershed imperviousness or in summer months can increase the scaling of floods to temperature even to a close cc relationship however flood scaling to temperature would unlikely surpass that of precipitation extremes in other words floods tend to change with rising temperature at a rate smaller than what is inferred from the scaling of precipitation extremes to temperature this study was implemented at particular regions and not with a large ensemble of watersheds due to data availability it could be interesting to extend such study to areas worldwide to further examine the conclusions the scaling of floods would also unlikely surpass that of precipitation extremes to temperature in other areas as the connections between precipitation extremes and floods are already very high in the studied watersheds this study also highlights that local watershed characteristics are dominant factors influencing flood changes and thus cannot be ignored when exploring the responses of floods to warming climate this study only used surface air temperature for scaling analysis the choice of dew point temperature was not evaluated but it is worth making such evaluation to determine which temperature is more related to precipitation extremes wasko et al 2018 visser et al 2020 in addition floods are affected by both climate and local watershed characteristics the influences of local watershed characteristics might lead to a weak relationship between floods and temperature thus in flood scaling analysis ensemble studies based on large number of watersheds are recommended credit authorship contribution statement mingxi shen conceptualization formal analysis investigation writing original draft writing review editing visualization ting fong may chui conceptualization investigation writing original draft writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments sincere acknowledgements are given to the us national climatic data center ncdc national centers from environmental information ncei the united states geological survey usgs for making the climate hydrology and land use land cover data open for research the climate prediction center cpc is acknowledged for providing the soil moisture data great thanks are given to dr richard arsenault for making the hysets dataset available we also thank the editor dr gabriele villarini and two anonymous reviewers for their constructive comments which help improve the manuscript significantly supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103885 appendix supplementary materials image application 1 
334,how floods respond to changing climate is of great concern in research community and society but there is no consistent conclusion about whether floods are as sensitive to changes in temperature as precipitation extremes in this study the responses and connections of local floods to temperature and precipitation extremes over three hydroclimatically different regions across the united states were explored the regions include northeast coast humid coast central plains dry inland southeast plains humid subtropic varying in atmospheric moisture availability investigation was made at both hourly and daily timescales and the influences of watershed imperviousness on flood responses were highlighted by using small watersheds 600 km2 and categorizing watersheds based on watershed imperviousness correlation and co occurrence probability analysis shows that the connections between floods and precipitation extremes over the studied watersheds are relatively high with the majority showing a value of 0 6 and 0 5 for the two criteria respectively scaling analysis finds that hourly precipitation extremes generally scale with daily temperature according to the clausius clapeyron cc relationship but daily precipitation extremes reflect smaller scaling rates and even decrease with rising temperature at higher temperatures despite floods in the studied watersheds are highly related with precipitation extremes the scaling of flood temperature is always lower than that of extreme precipitation temperature increasing connections between floods and precipitation extremes resulted from higher watershed imperviousness or in summer months tend to increase the scaling of flood temperature even to a close cc relationship however the scaling of flood temperature still cannot surpass that of extreme precipitation temperature it is generally concluded that flood would change with rising temperature at a rate smaller than what is expected from the scaling of precipitation extremes to temperature and precipitation scaling analysis should better use finer timescale e g hourly precipitation records keywords climate change flood extreme precipitation urbanization sub daily scale 1 introduction considerable evidences have shown precipitation extremes are increasing in both magnitude and frequency due to rising temperature allan and soden 2008 donat et al 2013 martinez villalobos and neelin 2018 o gorman 2015 roxy et al 2017 further leading to changes in flood hazards do et al 2017 hall et al 2014 hannaford and marsh 2008 mediero et al 2014 on the other hand with the development of human society there are large increases in world population and urban areas which changes more natural lands to impervious covering such as asphalt and concrete zhang et al 2018 both factors make flood one of the most destructive natural hazards become more concerned by human beings it is initially intuitive that changes in extreme precipitation under warming climate would translate into similar changes in flood e g increases in extreme precipitation translate to increases in flood considering extreme precipitation is one of the main flood triggers ivancic and shaw 2015 smith and ward 1998 wasko and sharma 2017 thus many studies have focused on the relationship between precipitation extremes and temperature and used the precipitation temperature relationship to infer potential flood changes under warming climate westra et al 2014 wasko and sharma 2017 yin et al 2018 ghausi and ghosh 2020 fowler et al 2021 allen and ingram 2002 proposed the clausius clapeyron cc thermodynamics could be a dominant physical constraint for the relationship between precipitation extremes and temperature as atmospheric moisture tends to be precipitated out when forming extreme precipitation event the cc relationship theoretically describes the changes of atmospheric moisture holding capacity with temperature and estimates that atmospheric moisture holding capacity would increase at a rate of 6 7 c with rising temperature alduchov and eskridge 1996 1997 visser et al 2020 many studies have examined whether the cc theory is applicable to the actual changes of precipitation extremes to temperature using observations for example lenderink and van meijgaard 2008 analyzed the extreme precipitation temperature scaling using 99 year observed hourly precipitation and temperature records in de bilt netherlands hardwick jones et al 2010 examined the scaling between extreme sub hourly precipitation and surface temperature across the australia mishra et al 2012 evaluated the scaling relationship between hourly extreme precipitation and daily temperature over the contiguous united states conus miao et al 2016 analyzed the scaling relationship between hourly precipitation and temperature in warm seasons over china generally these studies found the relationship between extreme precipitation and temperature is in lie with the cc theory to some extent fowler et al 2021 but the actual relationship varies in different regions and seasons for the scaling between daily precipitation extremes and temperature many studies have found a peak like pattern e g utsumi et al 2011 wang et al 2017 yin et al 2018 which means precipitation extremes increase with rising temperature up to a temperature threshold and then decrease with continual temperature rise this peak like scaling pattern is believed to be largely caused by atmospheric moisture limitation at higher temperatures berg et al 2009 hardwick jones et al 2010 prein et al 2017 roderick et al 2019 using the scaling of extreme precipitation temperature to infer potential flood changes under warming climate has been questioned in recent decades do et al 2017 sharma et al 2018 wasko and nathan 2019 there are many observed evidences showing in some regions precipitation extremes have increased but floods generally show decreasing trend e g ishak et al 2013 westra et al 2013 zhang et al 2016 the transition from climate to flood is highly complex modulating by many issues including land properties climate variation and anthropogenic activities archfield et al 2016 viglione et al 2016 blöschl et al 2017 2019 for example some studies have found long term rainfall could play a dominant role in triggering floods blöschl et al 2017 do et al 2020a how to predict flood changes under warming climate becomes a difficult question the most significant and common feature of climate change is climate warming while the changes in other climatic and hydrological variables including flood could be considered as a direct consequence of climate warming or have some correlation with climate warming on the other hand there is no single variable which can serve as a strong predictor for flood even extreme precipitation and floods are usually modulated by a combination of more than one hydrological process brunner et al 2020 do et al 2020b thus some studies turned to examine the sensitivity of floods to temperature directly aiming to better understand how floods would change under warming climate wasko and sharma 2017 assessed the scaling of precipitation extremes and floods to temperature at a global scale they found positive extreme precipitation scaling pattern but negative flood scaling pattern for most regions yin et al 2018 implemented a global analysis similar to wasko and sharma 2017 but got opposite conclusions they found higher scaling rates of storm runoff extremes with baseflow removed to temperature than those of precipitation extremes for most regions one potential reason behind the opposite conclusions is wasko and sharma 2017 only used non urbanized catchments so the influence of anthropogenic activities on floods was excluded another possible reason is the two studies used different temperature ranges wasko et al 2019 wasko and sharma 2017 omitted the streamflow below 5 c during which streamflow extremes are mostly caused by snowmelt rather than extreme precipitation the opposite conclusions might suggest that the natural relationship of floods to temperature could be altered by anthropogenic activities especially urbanization which increases surface imperviousness and reduces precipitation loss in infiltration and depression smith et al 2005 villarini et al 2009a causing the sensitivity of floods to temperature being higher than that of precipitation extremes however this inference needs to be confirmed by further study in addition a higher scaling rate to temperature is always expected for hourly precipitation extremes than for daily precipitation extremes hardwick jones et al 2010 panthou et al 2014 but it is not clear whether this conclusion still holds for flood scaling previous studies exploring the relationship between floods and temperature were mostly implemented at global scale however floods are local events their occurrence is heavily determined by local characteristics archfield et al 2016 tramblay et al 2019 whitfield 2012 such as watershed imperviousness in order to better understand how floods would respond to changing climate locally the relationship between floods and temperature should be also explored at local scale which is rarely seen in current research literature this study focused on three regions in the united states with similar topography including northeast coast central plains and southeast plains these regions are distinct in hydrometeorological characteristics the northeast coast is a humid coastal region the central plains is dry inland and the southeast plains is humid subtropic varying in atmospheric moisture availability shaw et al 2011 annual average temperature in the us was reported to have increased rapidly since 1970 vose et al 2017 the annual average temperature in 1986 2016 is about 0 7 c higher relative to 1901 1960 extreme precipitation events have increased in both intensity and frequency since 1901 over most us regions easterling et al 2017 but the trends vary spatially largest increases were found to occur in the northeastern us flood trends over the us show large spatial variability and no monotonic trends were detected douglas et al 2000 villarini et al 2009b archfield et al 2016 for the central region it is generally shown flood occurrence has increased significantly due to higher frequencies of heavy precipitation event but flood magnitude does not show obvious trend mallakpour and villarini 2015 several studies have found increasing flood trends in the eastern region archfield et al 2016 do et al 2017 generally flood changing patterns in the us show weak geographic cohesion and are highly related to local climate and geophysical characteristics archfield et al 2016 thus smaller scale investigations are needed therefore this study investigated how floods respond to temperature locally investigations were made at both hourly and daily timescales watershed imperviousness was highlighted for its effects on modulating the responses of floods to temperature this study tried to answer the following questions 1 how do precipitation extremes and floods scale with temperature locally 2 how does flood temperature scaling relationship vary with timescale i e whether flood temperature scaling is higher at hourly timescale relative to that at daily timescale 3 how do the flood responses to temperature change with watershed imperviousness this paper is organized as follows the studied area and used data are introduced in section 2 the analysis methods are described in section 3 section 4 elaborates on the analysis results and makes relevant discussions the main conclusions from this study are summarized in section 5 2 studied area and data 2 1 studied area watersheds in the studied regions were chosen mainly based on three criteria drainage area sub daily discharge record length watershed imperviousness first only the watersheds smaller than 600 km2 were chosen as this study focused on one local watershed characteristic i e imperviousness only the imperviousness in small watersheds can reach relatively high degree about 50 in this study in addition a narrow range of watershed drainage area can eliminate the influences of drainage area on the study results the watersheds were further chosen based on sub daily discharge record length in 1981 2013 only the watersheds with more than 15 year sub daily discharge record and less than 10 missing data in each year were considered choosing watersheds based on discharge record length was also considered in scaling analysis see section 3 4 for the details finally as this study classified watersheds into three imperviousness categories watershed numbers of these categories were kept consistent to avoid the influence of different sample numbers excess watersheds with relatively short discharge records were omitted the majority of the chosen watersheds are independent i e un nested watersheds except for 6 watersheds distributed in the three regions the locations of the chosen watersheds are shown in fig 1 the mountainous western us region was not considered as the effect of topography on flood temperature relationship was not the focus of this study 2 2 watershed data fifteen minute discharge data of the studied watersheds were downloaded from the united states geological survey usgs database https waterdata usgs gov the discharge records at hourly time points e g 1 00 2 00 3 00 were extracted from the 15 min time series to form hourly counterparts while those at 00 00 of each daily were extracted to form daily time series the rationale is assuming discharge is measured and logged once an hour or a day watershed land use land cover information mainly imperviousness was obtained from the usgs gages ii product falcone 2017 the imperviousness of all studied watersheds is rather stable during the studied period soil moisture data from the global climate prediction center cpc dataset dool et al 2003 were used when analyzing the connections between watershed precipitation extremes and floods the list of the studied watersheds along with their drainage areas and imperviousness is provided in table s1 the hydrological stations were matched to the nearest meteorological stations ghcn daily network described in section 2 3 to obtain daily temperature for the watersheds considering the studied watersheds are small and surface air temperature shows low spatial variability the temperature recorded at the nearest meteorological station can represent the temperature condition over the watershed area the mean and maximum distances between the hydrological stations and the matched meteorological stations are around 8 9 km and 27 6 km respectively 2 3 climate data this study used gauged daily surface air temperature hourly precipitation hourly relative humidity and watershed averaged precipitation daily temperature data was obtained from the global historical climate network daily ghcn daily dataset menne et al 2020 tang et al 2020 hourly precipitation data was extracted from the national climatic data center ncdc https www ncdc noaa gov cdo web search datasetid precip hly relative humidity was obtained from the us national centers for environmental information ncei global summary of the day gsod dataset in each region the meteorological stations with long hourly precipitation records in 1981 2013 were preserved the studied period 1981 2013 was determined from the jointly covered period by observed hourly precipitation and 15 min discharge 15 min discharge record mostly begins in 1981 while hourly precipitation record mostly ends in 2013 the list of the used meteorological stations for hourly precipitation is shown in table s2 with 9 stations in each region relative humidity data was used for explaining the scaling patterns of precipitation extremes to temperature to identify whether precipitation extreme have a strong connection to flood occurrence the approach in ivancic and shaw 2015 do et al 2020b for identifying correlation and co occurrence probability between these two variables was used as raw gauged precipitation cannot fully represent the precipitation condition over a watershed watershed averaged daily precipitation from another dataset was used this dataset is the hydrometeorological sandbox école de technologie supérieure hysets which is a comprehensive dataset containing the watershed averaged daily precipitation temperature and streamflow data for nearly all watersheds across the north america arsenault et al 2020 the watershed averaged meteorological data in hysets were based on two sources ghcn daily and the station based serially complete dataset for north america scdna the two datasets have missing data in different time periods so the datasets were first combined to provide relatively complete meteorological time series for the 1950 2018 period averaging was then made to the combined dataset using the thiessen polygons method to get watershed averaged meteorological data arsenault et al 2020 however this dataset only has daily time series but scaling analysis of precipitation extremes and floods were made at both hourly and daily timescales thus watershed averaged daily precipitation from the hysets was only used for exploring the connections between watershed precipitation extremes and floods and scaling comparison at daily timescale the rationality of using two types of precipitation data for daily scaling analysis was demonstrated in figure s1 where the regional scaling rates of daily extreme precipitation to temperature estimated using the two data sets are shown to be similar in the following part unless otherwise stated the used precipitation data is gauged precipitation from the ncdc database 3 methods 3 1 imperviousness category determination in order to highlight the influences of watershed imperviousness on flood responses to climate and minimize the influences of others e g watershed slope and river damming the watersheds in each region were classified into three categories equally based on watershed imperviousness thus the watersheds in each category are similar in imperviousness but may vary significantly in other watershed characteristics the watersheds in each imperviousness category were treated as an ensemble and the analysis was mainly based on the ensemble medians so as to focus on the influences of watershed imperviousness on flood responses two imperviousness thresholds of 21 and 10 were used to classify all watersheds into three groups equally each has 15 catchments table s1 the three groups represent high 21 middle 10 21 and low 10 imperviousness degree respectively please note there is no standard imperviousness classification method the three categories in this study were determined mainly based on the watershed number distributions with imperviousness and to make sure the watershed numbers in these categories are equal 3 2 trend analysis of mean temperature precipitation extremes and floods the changing trends of historical mean temperature precipitation extremes and floods were first analyzed to generally show how floods have changed under changing climate annual mean temperature annual maximum precipitation and annual maximum streamflow at both hourly and daily timescales were analyzed the temporal changing trends were estimated using the theil sen slope estimator sen 1968 theil 1992 do et al 2020b and the mann kendall test kendall 1948 mann 1945 was further applied to examine the statistical significance of these trends the theil sen slope for a time series is the median slope of those calculated using all possible pairs of data in the time series described as 1 s m e d i a n y j y i j i 10 y e a r s where s is the estimated theil sen slope and yj and yi are the variable values in paired years j and i respectively for precipitation and streamflow the slopes were normalized by the mean of annual maximum time series expressed as percentage change per decade decade while temperature slope was not normalized and expressed as degree celsius per decade c decade 3 3 connection analysis between precipitation extremes and floods the connections between watershed precipitation extremes and floods were analyzed using watershed averaged daily precipitation data from the hysets and daily streamflow data the analysis methods are based on ivancic and shaw 2015 and do et al 2020b including pearson correlation coefficient benesty et al 2009 between annual maximum precipitation and streamflow and co occurrence probability between precipitation extremes and floods in analyzing co occurrence probability extreme precipitation events were defined as those greater than the 99th percentile of wet daily precipitation amounts flood events were also defined using the peak over threshold method with the 99th percentile of daily streamflow time series as the threshold the lag time between precipitation and streamflow events were determined from the correlation analysis of lagged precipitation and streamflow time series ivancic and shaw 2015 the lag time when the largest correlation between precipitation and streamflow time series was defined as the hydrological response time a threshold of 5 day was used when determining the lag time precipitation extreme event and flood event within the lag time were treated as related events monthly soil moisture data was used to separate extreme precipitation and flood events into two groups events in dry months when monthly soil moisture is below the median soil moisture of the whole time series in 1981 2013 and events in wet months otherwise the co occurrence probability between precipitation extremes and floods was also calculated for the two groups 3 4 scaling analysis of precipitation extremes and floods to temperature precipitation extreme and flood scaling analysis was event based at each timescale precipitation and streamflow events were first identified from the precipitation and streamflow time series baseflow was not removed from streamflow time series as it only accounts for a small part of the total flow a precipitation event was defined as one separated by a specific time period of zero precipitation on either side named as event separation time or interevent time visser et al 2020 a streamflow event was defined if it contains at least one local flow peak also separated by a particular time period the maxima from the identified precipitation and streamflow events were matched to daily temperature to form precipitation temperature and streamflow temperature pairs these pairs were further stratified into different bins of 2 c width and the 99th percentile of precipitation or streamflow and median temperature for each bin were calculated hardwick jones et al 2010 westra et al 2014 lenderink and attema 2015 the locally weighted scatterplot smoothing lowess method cleveland 1979 utsumi et al 2011 was fitted to the precipitation or streamflow percentiles and median temperatures to reflect the generally changing patterns of precipitation extremes or floods with temperature linear regression was further used to estimate the actual scaling rates of precipitation extremes or floods to temperature in the temperature range where roughly linear relationship was detected by the lowess method wasko and sharma 2017 which is to statistically compare the scaling rates of precipitation extremes and floods to temperature this study used 2 c bins overlapped by 1 c to stratify precipitation temperature and streamflow temperature pairs wasko and sharma 2017 and also ensured at least 100 data were preserved in each bin bin temperature width was enlarged if there were less than 100 data in a 2 c temperature range this binning method enables more bins were created to reflect the changing patterns of precipitation extremes and floods to temperature and also preserved enough samples in each bin for reflecting event extremes this study omitted the bins with median temperature below 5 c to remove the snowmelt effect wasko et al 2019 wasko and sharma 2017 the watersheds with less than 10 bins at hourly timescale and 8 bins at daily timescale excluding bins below 5 c were not considered scaling analysis was first implemented to all months to reflect changing patterns of precipitation extremes and floods to temperature throughout the year and was further made in summer june july and august during which floods are mostly caused by precipitation extremes and hence are more related to precipitation extremes this is to further show how the scaling patterns of precipitation extremes and floods would be when the two variables are highly correlated the changes of wet day relative humidity with temperature were analyzed for potentially explaining the scaling patterns of precipitation extremes to temperature hardwick jones et al 2010 yin et al 2018 some studies have reported different choices of interevent time and event paired temperature can cause scaling uncertainty visser et al 2020 ghausi and ghosh 2020 to account for this uncertainty this study first assessed multiple choices of interevent time and temperature the best choice was determined as the one that results in closest scaling rates to the theoretical cc rate 7 c used 3 5 best combination of interevent time and temperature for scaling analysis fig 2 show the scaling rates of hourly extreme precipitation and flood to temperature when different choices of interevent time and temperature were used the analysis used all sites from the three regions followed visser et al 2020 here quantile regression was used to estimate the scaling rates since the specific scaling patterns are unknown for precipitation scaling it is clearly shown that using the same day temperature as precipitation event results in scaling rates closest to the cc rate as reflected by the median 25th percentile and 75th percentile values from all sites but using different interevent time does not change the scaling rates obviously for flood scaling it is shown using the temperature 1 day or 2 day before the flood events results in scaling rates closest to the cc rate and using the interevent time longer than 72h also increase the scaling rates the same analysis was also made to the daily extreme precipitation and flood scaling and the results show similar conclusions thus this study used 24h interevent time and same day temperature for hourly and daily extreme precipitation scaling analysis and used 72h interevent time and 1 day prior temperature for hourly and daily flood scaling analysis 4 results and discussion 4 1 historical changes in temperature precipitation extremes and floods fig 3 shows the estimated theil sen slopes of annual mean temperature annual maximum precipitation and annual maximum streamflow for the three regions the slopes of precipitation and streamflow were estimated at both hourly and daily timescales the spatial distribution of these trends is shown in figure s2 the changing trends i e slopes in temperature of all stations in the three regions are positive the median temperature slopes in the northeast coast and central plains are similar being around 0 25 c decade while is smaller in the southeast plains around 0 13 c decade most stations in the northeast coast and southeast plains show positive trends in annual maximum precipitation but the stations in the central plains tend to show decreasing precipitation trends the median trends in the northeast coast and southeast plains are mostly around 2 decade at hourly and daily timescales all stations in the central plains show negative changing trend for daily precipitation maxima while the stations reflecting positive and negative trends for hourly precipitation maxima are nearly equal with the median trend close to 0 the annual maximum streamflow in the northeast coast and central plains tend to have increased during the studied period suggested by the positive changing trends of most watersheds for these two regions the median changing trends of watersheds in the three imperviousness categories are mostly around 16 decade at both hourly and daily timescales and the median trends do not show uniform differences among the three imperviousness categories in the southeast plains it is interesting to find that the trends for watersheds in the high imperviousness category tend to be the highest as indicated by the highest medians at both hourly and daily timescales around 10 decade and 0 respectively the trends for watersheds in the low imperviousness category tend to be the lowest the median values are around 15 decade and 25 decade for hourly and daily timescales respectively except for temperature trend the mann kendall test shows that the trends are not significant at the 0 05 significance level for precipitation and streamflow at most sites figure s2 the changing trends positive or negative of temperature precipitation and streamflow are not the same with each other except for in the northeast coast for example most stations in the central plain show negative precipitation trends but the watersheds in the central plains actually show positive streamflow trends although the temperature in the three regions has increased the three regions report both positive and negative trends in precipitation and streamflow maxima the trend analysis reflects the complex relationship between temperature precipitation and streamflow maxima 4 2 connections between precipitation extremes and floods fig 4 shows the connections between precipitation extremes and floods for the studied watersheds the spatial distribution of the connection values is shown in figure s3 the correlations between annual maximum precipitation and streamflow are rather high for the studied watersheds the correlation coefficients for most watersheds are above 0 5 and the median coefficients for the three imperviousness categories are nearly all above 0 6 in the three regions comparing to the results in ivancic and shaw 2015 do et al 2020b which shows about 30 flooding events in the us are highly correlated to precipitation extremes the correlations for the watersheds in this study are much higher this is expected to be because the studied watersheds are very small in which precipitation losses due to deficit soil moisture and depression are minor thus most water from extreme precipitation is translated to floods and results in high correlations between precipitation extremes and floods wasko and sharma 2017 hettiarachchi et al 2019 wasko et al 2020 in addition the correlations between precipitation and streamflow for watersheds in the high imperviousness categories tend to be the highest while tend to be the lowest for the low imperviousness categories for example in the northeast coast the 25th 50th and 75th percentiles of the correlation coefficients for watersheds in the high imperviousness category are around 0 65 0 80 and 0 82 respectively while the values for the low imperviousness category are around 0 60 0 61 and 0 74 respectively the higher correlations for the high imperviousness categories suggest that increasing watershed imperiousness can enhance the connections between watershed precipitation and streamflow this reason behind is also precipitation loss has decreased due to rising watershed imperviousness the co occurrence probabilities between extreme precipitation and flood events for the studied watersheds are also rather high the median co occurrence probabilities for all imperiousness categories are nearly above 0 5 after separating extreme precipitation and flood events using soil moisture the co occurrence probabilities for the high soil moisture cases increased the co occurrence probabilities for the studied watersheds are higher than those reported for the watersheds across the us ivancic and shaw 2015 the high co occurrence probabilities during higher soil moisture suggest that soil moisture conditions also modulate the relationship between precipitation extremes and floods which is consistent with the findings in some previous studies wasko et al 2019 wasko and nathan 2019 hettiarachchi et al 2019 cao et al 2020 in addition it is generally shown that the co occurrence probabilities for watersheds in the high imperviousness categories tend to be the highest no matter whether separating extreme events using soil moisture or not the results in this section reflect the connections between precipitation extremes and floods for the studied small watersheds are rather high considering the high connections between precipitation extremes and floods it could be interesting to reflect how they respond to temperature using scaling analysis 4 3 scaling relationships of precipitation extremes and floods to temperature 4 3 1 general scaling patterns for temperature above 5 c fig 5 shows the scaling patterns of hourly and daily precipitation extremes to daily temperature in the studied regions for hourly precipitation extremes the scaling patterns of individual stations and regional averages are highly linear for all the three regions the slopes of the scaling lines are close to the cc rate in the northeast coast while are slightly smaller in the central plains and southeast plains for daily precipitation scaling the stations in the same region show some variabilities for example in the northeast coast some stations show linear scaling patterns between precipitation extremes and temperature in the whole temperature range but the precipitation extremes in some stations increase linearly with rising temperature up to a temperature threshold peak point temperature and then decrease with continual temperature rise the regional average lines of daily scaling also reflect peak like scaling patterns especially in the northeast coast and southeast plains in addition the linear slopes before the peak point temperature are smaller than the cc rate in all the three regions fig 6 shows the scaling patterns of hourly and daily floods to daily temperature in the three imperviousness categories for the northeast coast as an example the scaling patterns vary among different watersheds in each imperviousness category some watersheds reflect positive scaling patterns while the scaling patterns in some watersheds are negative this might be because watershed floods are influenced and modulated by multiple processes especially various local watershed characteristics the ensemble smoothed lines in each imperviousness category reflect that averagely the changing patterns of floods to temperature tend to be linear however the change rates are smaller than the cc rate at both timescales the change rates also vary with different imperviousness degrees with the scaling rates in the high imperviousness categories being the highest only slightly smaller than the cc rate at hourly timescale and those in the low imperviousness categories being the lowest negative at both timescales the conclusions from the central plains and southeast plains are similar to those reported here in order to better evaluate and compare the sensitivities of precipitation extremes and floods to temperature the change rates of precipitation extremes and floods were estimated using linear regression at the temperature range where linear relationships were both found wasko and sharma 2017 which is 5 20 c in this study some studies used the lowess method to detect the peak point temperature for individual stations or region and estimate the scaling rates before the peak point temperature individually utsumi et al 2011 yin et al 2018 however this approach can lead to different temperature ranges were used for different stations or watersheds wasko et al 2019 4 3 2 scaling rates in the linear relationship temperature range fig 7 shows the scaling rates of precipitation extremes and floods to temperature in 5 20 c for the three regions the scaling rates were estimated from all binning data in a region or imperviousness category to reflect the average scaling rates and to obtain a stronger signal and robust analysis the scaling rates of hourly precipitation extremes to temperature are close to the cc rate for all the three regions in 5 20 c while those of daily precipitation extremes are smaller but positive forming a sub cc scaling pattern the smaller precipitation scaling rates at daily timescale might be because daily precipitation amounts actually contain many intermittencies visser et al 2020 while the influences of rainfall intermittencies become smaller when using finer timescale rainfall data e g hourly rainfall in this study for floods scaling all imperviousness categories and regions show rates smaller than the cc rate at both timescales the scaling rates of floods also vary with timescales with the scaling rates at hourly timescale being higher the scaling rates of floods tend to increase with rising watershed imperviousness as indicated by the highest scaling rates in the high imperviousness category in most cases however the scaling rates of floods are all smaller than those of precipitation extremes despite the increasing tendency of flood scaling rates with finer timescale and higher imperviousness fig 8 further shows the scatter plot of daily precipitation extreme and flood scaling rates for individual watersheds in 5 20 c to facilitate direct comparison of the scaling rates across individual watersheds the used daily precipitation data here was watershed averaged precipitation from the hysets dataset the watershed averaged precipitation is able to reflect similar regional precipitation scaling patterns compared with the gauged precipitation figure s1 the spatial distribution of the scaling rates is provided in figure s4 the daily precipitation scaling rates are mostly within 0 5 c but nearly half of the daily flood scaling rates are within 5 0 c and another half are within 0 5 c from the comparison in individual watersheds it is also shown that extreme precipitation scaling tends to be higher than that of flood to temperature when categorizing the precipitation and flood scaling rates accordingly to watershed imperviousness and regions it is shown that flood scaling rates at the high imperviousness category are mostly the largest or relatively larger among the three imperviousness categories however in the central plains the scaling rate in the higher imperviousness category is lower than that in the low imperviousness category which might be due to other watershed characteristics e g soil slope in addition precipitation scaling rates in the three imperviousness categories are similar for three regions which might reflect the influences and feedbacks of watershed imperviousness on precipitation formation could be neglected considering the small scales of these watersheds 4 3 3 scaling patterns of precipitation extremes and floods to temperature in summer fig 9 shows the changing patterns of precipitation extremes and floods to temperature in summer at hourly and daily timescales when using the gauged data change rates were not estimated here as the changing patterns in summer tend to be nonlinear in summer hourly precipitation extremes tend to change with rising temperature accordingly to the cc relationship but daily precipitation extremes tend to change negatively with temperature the contrasting scaling patterns highlight the importance of using finer timescale precipitation data for scaling analysis since daily precipitation amounts contain many rainfall intermittencies daily precipitation records might be inappropriate to reflect the inner relationship between precipitation extremes and temperature alexander et al 2019 lewis et al 2019 it is interesting to note that hourly floods in summer generally change with temperature roughly according to the cc relationship especially for the northeast coast and central plains and before 25 c for the southeast plains comparing to the sub cc and negative scaling patterns in 5 20 c fig 7 the scaling patterns in summer are much higher the scaling patterns of hourly precipitation extremes and floods for the high imperviousness category are highly close considering summer floods are mostly caused by precipitation extremes the similar scaling patterns between summer precipitation extremes and floods might suggest that with the increasing connections between precipitation extremes and floods the changing patterns of floods to temperature would replicate those of precipitation extremes to temperature despite the nonlinear process from precipitation to streamflow however although hourly flood temperature scaling high imperviousness is highly close to that of hourly precipitation extreme temperature flood scaling was not found to surpass the scaling of precipitation extremes this might suggest averagely speaking flood response to temperature would not surpass that of extreme precipitation to temperature 4 3 4 potential reasons behind the scaling relationships of precipitation extremes and floods to temperature fig 10 shows the changing patterns of wet day relative humidity with temperature at hourly and daily timescales the trend lines show that relative humidity is rather stable before a temperature threshold 20 25 c especially when considering all months after the temperature threshold relative humidity drops rapidly with increasing temperature this might explain why the changes of precipitation extremes to temperature are roughly linear before a peak point temperature and the change rates decrease at higher temperatures for flood scaling to temperature analyzing from the ensemble medians this scaling is also highly linear at a particular temperature range this linear relationship is also found in other studies wasko and sharma 2017 yin et al 2018 considering floods in the studied watersheds are highly related to precipitation extremes it could be expected that the linear changing patterns of precipitation extremes to temperature translate to linear changing patterns of floods to temperature one the other hand watersheds floods are also influenced by local watershed characteristics some precipitation falling on the watershed would be lost due to hydrological processes such as infiltration hettiarachchi et al 2019 wasko et al 2019 only part of precipitation is converted to streamflow which might explain why the sensitivity of floods to temperature tend not to surpass that of extreme precipitation extremes higher soil moisture or imperviousness condition can reduce precipitation loss but precipitation loss always exists and cannot be neglected 5 conclusions this study investigated the responses of floods to climate in watersheds with various degrees of imperviousness in three hydroclimatically different regions across the us the main conclusions drawn are summarized as 1 hourly precipitation extremes tend to scale with temperature according to the cc relationship but daily precipitation extremes change with temperature at rates smaller than the cc rate and even decrease at higher temperatures considering daily precipitation amounts actually contain many intermittencies it is recommended precipitation scaling analysis should use finer timescale e g hourly precipitation records 2 the connections between precipitation extremes and floods are relatively high for the studied watersheds given their small areas and increasing watershed imperviousness can enhance the connections between the two variables 3 despite the high connections between precipitation extremes and floods the scaling of floods to temperature is always lower than that of precipitation extremes to temperature higher connections between precipitation extremes and floods resulted from higher watershed imperviousness or in summer months can increase the scaling of floods to temperature even to a close cc relationship however flood scaling to temperature would unlikely surpass that of precipitation extremes in other words floods tend to change with rising temperature at a rate smaller than what is inferred from the scaling of precipitation extremes to temperature this study was implemented at particular regions and not with a large ensemble of watersheds due to data availability it could be interesting to extend such study to areas worldwide to further examine the conclusions the scaling of floods would also unlikely surpass that of precipitation extremes to temperature in other areas as the connections between precipitation extremes and floods are already very high in the studied watersheds this study also highlights that local watershed characteristics are dominant factors influencing flood changes and thus cannot be ignored when exploring the responses of floods to warming climate this study only used surface air temperature for scaling analysis the choice of dew point temperature was not evaluated but it is worth making such evaluation to determine which temperature is more related to precipitation extremes wasko et al 2018 visser et al 2020 in addition floods are affected by both climate and local watershed characteristics the influences of local watershed characteristics might lead to a weak relationship between floods and temperature thus in flood scaling analysis ensemble studies based on large number of watersheds are recommended credit authorship contribution statement mingxi shen conceptualization formal analysis investigation writing original draft writing review editing visualization ting fong may chui conceptualization investigation writing original draft writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments sincere acknowledgements are given to the us national climatic data center ncdc national centers from environmental information ncei the united states geological survey usgs for making the climate hydrology and land use land cover data open for research the climate prediction center cpc is acknowledged for providing the soil moisture data great thanks are given to dr richard arsenault for making the hysets dataset available we also thank the editor dr gabriele villarini and two anonymous reviewers for their constructive comments which help improve the manuscript significantly supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103885 appendix supplementary materials image application 1 
