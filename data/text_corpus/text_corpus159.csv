index,text
795,solution for the fluid potential within a fractured porous medium is described this solution is derived numerically for the particular case of a pouseuille s elliptical fracture plane with uniform aperture a closed form solution of total flow integrated over a single fracture is obtained as a function of matrix permeability fracture permeability and fracture geometry parameters this solution allows firstly the comparison between two approaches poiseuille s fracture and darcy s flattened ellipsoidal inclusion this shows the difference of pressure and flow fields in the fractures and the equivalence of total flow transported by fractures then a semi analytical solution is used to establish an effective permeability model based on the self consistent scheme for a porous medium containing an anisotropic distribution of oriented elliptical plane fractures the proposed model is in good agreement with numerical solutions reported in the literature for a random distribution of oriented fractures the present model exhibits a percolation threshold for a three dimensional fractured network the percolation threshold is a critical value of fracture density beyond which the effective permeability is greater than zero for the case of an impermeable parent material keywords fractured porous media effective permeability self consistent percolation threshold poiseuille s flow 1 introduction the imperative of transport process analysis of fractured geological formations has become increasingly important in many environmental and industrial applications such as nuclear waste disposal geological storage of co2 petroleum reservoir engineering and geothermal energy production in practical engineering the assumption of an impermeable parent material i e the flow occurs only within the fracture network has been widely made for simplicity long et al 1985 cacas et al 1990 ubertosi and delay 2007 koudina et al 1998 lei et al 2017 however this approach is not applicable at low fracture densities when the background matrix has a non negligible permeability modelling fluid flow through a porous matrix containing a random distribution of oriented fractures with complex geometry needs the use of numerical methods in the following a porous matrix means a permeable parent material that is transmitting flow the use of finite element matthai and belayneh 2004 lang et al 2017 ebigbo et al 2016 pouya 2015 fracsima 2017 and or finite volume methods bogdanov et al 2007 mourzenko et al 2010 bogdanov et al 2003 requires a numerical tool to automatically generate an appropriate mesh for a domain containing numerous fractures this tool only exists in some numerical codes lang et al 2017 pouya 2015 bogdanov et al 2007 boundary integral equation methods bem are computationally efficient and accurate for modelling the fluid flow in porous media because of their ability of problem dimension reduction bonnet 1995 however the classical bem exhibits mathematical degeneration leading to numerical instabilities for domains containing discontinuities bonnet 1995 multi region bem is proposed for overcoming this difficulty this method has been widely used for modelling linear fracture mechanics when the solid contains a single fracture bonnet 1995 still this powerful technique requires an elaborated numerical implementation in comparison to standard bem and becomes inefficient for high fracture density situations based on singular integral equations a single equation of the fluid potential was firstly developed by liolios and exadaktylos 2006 for modelling fluid flow through a 2d infinite porous medium containing non intersecting fractures this study was then extended for intersecting fractures pouya and ghabezloo 2010 pouya and vu 2012 tran et al 2018 vu et al 2017 a 3d configuration pouya 2012 vu et al 2013 2015 pouya and vu 2012 unsaturated fluid flow pouya et al 2013 and finite porous media vu et al 2013 2015 seyedi et al 2011 2015 numerical modelling needs significant information on geometry and on the physical properties of rock fractures the collection of which is not a trivial task moreover the numerical modelling of fluid flow through a large scale geological structure with the presence of high fracture density necessarily consumes a lot of computational resources the homogeneisation approach is often used as an efficient approximation for predicting the effective permeability of a fractured porous medium in such models the effective properties of a fractured medium are evaluated based on a closed form solution of an individual defect eshelby 1957 coupled with approximation schemes to estimate effective properties for the whole medium homogenisation schemes include dilute scheme for weak fracture density in which the fracture interaction is negligible snow 1969 shafiro and kachanov 2000 self consistent scheme fokker 2001 dormieux and kondo 2004 barthélémy 2009 podzniakov and tsang 2004 differential scheme zimmerman 1996 and adaptive scheme nguyen et al 2016 taking into account implicitly the interaction between fractures saevic et al 2013 reviewed various effective media models and compared them with explicit numerical modelling to assess their accuracy for a large number of cases of fracture density and of fracture permeability within homogeneisation approaches the fracture is assumed to be a porous matrix obeying darcy s law whose permeability is different from that of the host rock nevertheless the experimental studies showed that poiseuille s law is more appropriate than darcy s law for modelling the fluid flow in a single fracture guéguen and palciauskas 1994 witherspoon et al 1980 additionally pouya and vu 2012 showed that analytical solutions of fluid flow for a particular case of a superconductive fracture of circular shape obtained by two hypotheses of darcy s law and poiseuille s law are not absolutely identical in the following a poiseuille fracture designates a flat fracture of elliptical shape with uniform aperture obeying poiseuille s law for fluid flow and a darcy inclusion indicates a fracture modelled by a flattened ellipsoid in which the fluid flow is represented by darcy s law this study focuses on deriving a solution of fluid flow through a poiseuille fracture and subsequently utilising it with a self consistent scheme to estimate the effective permeability of a porous medium containing an anisotropic distribution of oriented fracture the fracture is mathematically modelled by a 2d surface in the 3d space of the medium the solution of the fluid potential in the form of a singular integral equation is written for a single elliptical disc shaped fracture and then numerically resolved by using the collocation method a closed from solution of fluid flow within a poiseuille fracture was obtained the comparison of the flow solution of a poiseuille fracture with that of a darcy inclusion was made the current study considered a more general case of an elliptical fracture of finite conductivity in comparison to the particular case studied by pouya and vu 2012 based on a self consistent scheme a new model of effective permeability for a fractured porous medium is proposed a comparison of this new model with finite volume solutions of bogdanov et al 2003 is also made 2 generals equations and solutions 2 1 notations in the following light face greek or latin letters denote scalars underlined letters denote vectors bold face letters designate second rank tensors or double index matrices the scalar product of two vectors a and b is labelled as a b for second rank tensors the transposed tensor of a is denoted a t the matrix product is labelled as ab and the determinant as a the operation of a on a is labelled as a a the convention of summation on repeated indices is not used for latin indices i j k that number surfaces lines etc and are noted indifferently as subscript or superscript represents the gradient and δ the laplace operator for a scalar field and the divergence for a vector field let us consider an infinite three dimensional medium ω containing several fractures numbered by j and noted by γ j fig 1 embedded in a permeable matrix the matrix has a uniform permeability k m2 each fracture surface γ j is defined by a smooth function z j of the curvilinear parameters s α α 1 2 two or more fractures can intersect along an intersection line and three or more fractures can cross at an intersection point γ and s denote respectively the set of points on the fracture surface and on the intersection lines between fractures the matrix corresponds to ω γ a far field pressure field p x is prescribed for infinity the fluid flow in the matrix is governed by darcy s law 1 x ω γ v x k μ p x where v x m s and p x pa are local darcy velocity and reduced pressure respectively μ pa s the fluid dynamic viscosity the definition of the reduced pressure is batchelor 1967 zimmerman and bodvarsson 1996 p p ρ fgz where p is the pressure ρ f the fluid density g the gravity and z the elevation the main objectives of this study namely the comparison between two approaches darcy inclusion and poiseuille fracture and the proposition of a new effective permeability model are not affected by the use of the pressure or the reduced pressure thus the gravity is not taken into account in this work for simplification and p reduces to the pressure p p the fluid is assumed to be incompressible thus the mass conservation in the matrix with steady state condition in absence of point sources reads 2 x ω γ v x 0 in rock mechanics poiseuille s law is frequently used for modelling the fluid flow in a single fracture guéguen and palciauskas 1994 this law establishes a linear relation between the flow vector q s m2 s and the in plane pressure gradient sp s in the fracture as follows 3 s γ q s c s μ s p s where c m3 consists of a tensor related to hydraulic properties of the fracture which can vary on the fracture surface more details of the characters of the tensor c were discussed in pouya 2012 the flow vector q s is defined as the integral of the fluid velocity v in the thickness of the fracture at position s q s 0 e v s d z s pouya 2012 established two explicit expressions for mass exchange under steady state condition between the matrix and the fracture at a point on fractures and at a point on an intersection line between fractures 4 s γ v z n s s q s 0 5 z l j q j m j 0 where n is the normal vector to the fracture surface orienting from γ to γ v z v z v z designates the discontinuity or jump of darcy velocity across the fracture where v and v are the darcy velocity in the matrix at the point z of lower and upper fracture surface respectively s q s represents the surface divergence of fluid flow taking place within the fracture surface q j is the flow vector within fracture γ j and m j the vector tangent to the surface normal to the intersection line and pointing outward from the domain by assimilating the fractures to a distribution of sources or sinks pouya 2012 proposed a general solution of the fluid potential for the steady state fluid including the mass balances 4 and 5 as follows 6 p x p x 1 4 π k j γ j q j s k 1 x z j s x z j s k 1 x z j s 3 2 d s in this solution the pressure field in the whole domain ω p x is expressed as a function of the flow vectors q j s through the fractures introducing 3 into 6 yields a hyper singular integral equation for the pressure field on the fracture surfaces when the field point x is located on these surfaces 7 p x p x 1 4 π k j γ j s j p s c j s k 1 x z j s x z j s k 1 x z j s 3 2 d s the numerical derivation of this equation based on the collocation method was presented by vu 2012 once this is done the pressure field on the fractures is known thus the flow is also known by eq 3 eq 7 is used again to directly determine the pressure at an arbitrary point in the whole fractured porous medium this numerical solution is useful to model the fluid flow in an infinite porous medium containing fractures under a far field condition p x to show the capacity of the developed numerical procedure an example of modelling of fluid flow through several intersecting circular disc shaped fractures is presented in fig 2 this consists in the pressure field on the fracture network for a specific far field condition a 1 0 0 as observed the pressure is continuous on the intersection lines between fractures moreover eq 7 can be also used to derive an analytical solution of fluid flow through a single fracture as shown in the next section 3 flow solution on an elliptical disc shaped fracture consider an infinite isotropic medium ω containing an elliptical disc shaped fracture with uniform aperture prescribed by a constant gradient a at infinity i e p x a x fig 3 the matrix permeability is homogeneous and isotropic k k δ δ is the second order identity tensor we denote κ k 3 the fracture is characterised by a uniform aperture e therefore the tensor c reduces to a scalar c where c can be determined by witherspoon et al 1980 8 c 1 f e 3 12 in which f is an empirical factor to account for fracture roughness witherspoon et al 1980 the variable c m3 is the fracture permeability kfr e2 12f m2 time the fracture aperture e m let d 1 and d 2 designate the half diameters of the elliptical plane fracture e 1 and e 2 their principal directions and e 3 the normal unit vector of the fracture plane a local coordinate system is defined by the base e 1 e 2 e 3 and its origin located at the fracture centre fig 3 writing eq 7 for this particular problem in the local coordinates yields 9 p x a x c 4 π κ γ s p s x z s x z s 3 2 d s in order to analyse this equation we introduce the following dimensionless variables 10 x x d 1 d 2 λ c 4 π κ d 1 d 2 p λ x p x d 1 d 2 a using p x a p λ x eq 9 becomes 11 p λ x a a x λ γ p λ x x z x z 3 d z where γ designates the ellipse in the transformed space of the variable x the integral of the flow field over the fracture surface γ is determined by 12 q c μ γ p x d x c 0 a d 1 d 2 γ p λ x d x c 0 c μ then we define 13 q q a d 1 d 2 a 2 c 0 a a γ p λ x d x for the general case a a 1 a 2 a 3 the solution is obtained by the superposition of three elementary solutions corresponding to p x a 1 x 1 p x a 2 x 2 and p x a 3 x 3 respectively since the fracture has an infinite transversal permeability the fracture does not perturb the flow if the far field pressure gradient is perpendicular to the fracture plane i e the case p x a 3 x 3 consequently the general solution is obtained by adding a 3 x 3 to the solution corresponding to a a 1 a 2 0 in addition the geometry of the elliptical disc shaped fracture allows obtaining the solutions corresponding to a 0 a 2 0 from that of a a 2 0 0 therefore it is sufficient to consider eq 11 with p x a 1 x 1 to be able to build the solution for the general case p x a x numerical derivation described by vu 2012 is employed to derive eq 11 for different values of λ and different fracture geometries characterised by the ratio 14 ɛ d 1 d 2 figs 4 and 5 respectively show the flow field solution through the fracture for the parameter λ 10 far field condition a 1 0 0 and two ratios ε 2 0 and ε 0 5 it is interesting to note that the flow perpendicular to the direction of the far field gradient a e 1 does not vanish as a reminder this component of the flow vector is nil when using the approach of darcy flow in the ellipsoidal inclusion therefore this result shows that the flow field solution in the poiseuille fracture cannot be obtained by considering it as the limit case of the darcy flattened ellipsoidal inclusion according to eq 13 the numerical solution of the pressure field p λ x in the fracture allows us to determine q it is worth noting that q is q a a computed over an elliptical disc shaped fracture with d 1 d 2 1 or ɛ 1 d 2 2 in order to validate the numerical solution we recall the closed form solution for the integral of flow over an elliptical disc shaped superconductive fracture given by pouya and vu 2012 15 q γ q ξ d s 4 π k 3 μ d 1 d 2 φ a where 16 φ ϕ 1 1 e 1 e 1 ϕ 2 1 e 2 e 2 with 17 ϕ 1 λ 1 λ 2 θ 0 π 2 λ 1 cos 2 θ λ 1 cos 2 θ λ 2 sin 2 θ d θ ϕ 2 λ 1 λ 2 θ 0 π 2 λ 2 sin 2 θ λ 1 cos 2 θ λ 2 sin 2 θ d θ and 18 λ 1 1 d 1 2 λ 2 1 d 2 2 besides the superconductive fracture can be also numerically obtained by setting λ i e λ 1 during numerical programming in eq 11 the comparison between closed form solutions 15 and the numerical solution for different values of ε is presented in fig 6 as expected a perfect agreement between the numerical solution and the closed form solution is observed moreover ϕ1 and ϕ2 can be expressed as a function of the complete elliptic integrals of first and second order k η and e η such as 19 ϕ 1 d 2 k η e η d 1 2 d 2 2 ϕ 2 d 1 2 e η d 2 2 k η d 2 d 1 2 d 2 2 where d 2 d1 η 1 d 2 d 1 2 and 20 0 η 1 k η θ 0 π 2 d θ 1 η 2 sin 2 θ e η θ 0 π 2 1 η 2 sin 2 θ d θ as shown in fig 7 the relation between c 0 q and λ for each ratio ε can be fitted by a linear function with a great precision such as 21 c 0 q α d 1 d 2 λ β d 1 d 2 where the numerical solutions of α and β versus d 1 and d 2 will be obtained further down introducing q c 0 αλ β obtained from 21 and λ from 10 into 12 and rearranging yield 22 q c 0 4 π κ d 1 d 2 3 2 α c 4 π κ β d 1 d 2 1 2 a 1 e 1 in this relationship q is expressed as a function of the following parameters far field condition a determinant of permeability tensor k fracture variable c kfre fracture permeability time fracture aperture and fracture geometry d 1 d 2 it is interesting to note that the coefficient α d 1 d 2 can be deduced from the asymptotic behaviour of q when c thanks to its closed form solution for the case of a superconductive fracture described by eq 15 we have 23 lim c q 4 π κ d 1 d 2 3 2 μ α a 1 e 1 the comparison between eq 23 and analytical solution 15 corresponding to a a 1 e 1 leads to 24 α d 1 d 2 3 ϕ 1 λ 1 λ 2 d 1 d 2 1 2 this result can be numerically verified since α can be otherwise determined for each ε from fig 7 as expected a perfect agreement between expression 24 and the numerical solution of α is observed in fig 8 besides the numerical results show that β varies in the interval 0 46 to 0 49 corresponding to the considered range of ε d 1 d 2 this variation is negligible considering the variation of α therefore we can assume that all lines c 0 q in fig 8 cut the λ axis at a same point i e β is constant the numerical result of q corresponding to a a 2 e 2 can be obtained by a similar analysis 25 q c 0 4 π κ d 1 d 2 3 2 γ c 4 π κ β d 1 d 2 1 2 a 2 e 2 with 26 γ d 1 d 2 3 ϕ 2 λ 1 λ 2 d 1 d 2 1 2 where the function ϕ2 λ1 λ2 is defined by 17 4 comparison between the poiseuille fracture and the darcy ellipsoidal inclusion approaches in this section the results given in this work is compared to the solution obtained by shafiro and kachanov 2000 in order to exactly identify the term β in eqs 22 and 25 shafiro and kachanov 2000 considered the steady state flow through a three dimensional reference volume ω having an isotropic permeability k containing an ellipsoidal inclusion of permeability k occupying the volume ω due to a far field gradient pressure a we denote by d 1 d 2 d 3 the semi axes of the inclusion and e 1 e 2 e 3 unit vectors parallel to them the integral of flow field over the inclusion is derived as follows shafiro and kachanov 2000 27 q ω ω k k μ h 1 e 1 e 1 h 2 e 2 e 2 h 3 e 3 e 3 where ω 4πd 1 d 2 d 3 3 and the coefficients h i i 1 2 3 have the form 28 h i 1 k k k j i 1 i 1 2 3 with 29 j i 1 2 j 1 3 a j 0 d u a i 2 u j 1 3 a j 2 u i 1 2 3 the expression of factor ji in terms of elliptic integrals can be found in shafiro and kachanov 2000 we consider the case of a flattened ellipsoidal inclusion d 3 d 2 d 1 with d 3 d 1 0 and d 3 d 2 0 while d 3 0 and the permeability k but 30 2 d 3 k c with c is a constant the three coefficients hi for this case are simplified such as 31 h 1 1 c 2 k d 2 k λ e λ d 1 2 d 2 2 1 h 2 1 c 2 k d 1 2 e λ d 2 2 k λ d 1 2 d 2 2 1 h 3 0 substituting 19 into 31 and then introducing hi i 1 2 3 into 27 yield 32 q 4 π 3 k c μ d 1 d 2 1 ϕ 1 c 2 k e 1 e 1 1 ϕ 2 c 2 k e 2 e 2 besides the superposition of two elementary solutions 22 and 25 corresponding to far field conditions p x a 1 x 1 and p x a 2 x 2 allows obtaining the solution of the integral of flux field over a poisseuille elliptical disc shaped fracture in the general case a a 1 a 2 a 3 as follows 33 q 4 π κ c d 1 d 2 μ ψ a where 34 ψ ψ 1 1 e 1 e 1 ψ 2 1 e 2 e 2 35 ψ 1 3 ϕ 1 c 4 π κ β ψ 2 3 ϕ 2 c 4 π κ β if we take β 6 4π the expression of q for the poiseuille elliptical disc shaped fracture is identical to that for the darcy flattened ellipsoidal inclusion therefore two approaches the poiseuille elliptical disc shaped fracture and the darcy ellipsoidal inclusion yield a similar flow q through fracture this conclusion was also observed by pouya and vu 2012 for the case of a superconductive fracture however the pressure field is not linear in the poiseuille fracture figs 4 and 5 while the darcy ellipsoidal inclusion yields a constant pressure gradient field in the fracture in addition the flow through the poiseuille fracture has two components parallel and perpendicular to the far field pressure gradient a in comparison to only one parallel to a in the darcy inclusion as a conclusion when considering the fluid flow through a 3d infinite porous medium containing a fracture two constitutive equations poiseuille s law and darcy s law and two different geometries uniform aperture for poiseuille fracture and aperture varies across the nominal plane of the fracture for darcy inclusion yield different solutions of flow within the fracture 5 effective permeability model let us consider a porous medium ω surrounding several fractures γ j subjected to a pressure p x a x on its boundary ω the porous matrix is represented by a uniform permeability k the effective permeability of ω is globally defined by darcy s law 36 v k e f f μ p x where v g are respectively the average darcy velocity and the average pressure gradient in ω 37 v 1 ω ω v d ω j γ j q d s g 1 ω ω p d ω green s theorem for the pressure function p in the domain ω containing discontinuities γ reads 38 ω p d ω ω p n d s i 1 n γ i p n d s on the boundary ω p a x and on the fracture p 0 hence mathematical identity ω x n d s ω leads to 39 g 1 ω ω p d ω a introducing 1 into the first term of v in 37 yields 40 1 ω ω v d ω k μ a combination of 37 39 40 gives 41 v k μ a 1 ω j γ j q d s k e f f μ a this implies that there exists a tensor k f that verifies 42 1 ω j γ j q d s k f μ a thus the effective permeability k eff is obtained such as 43 k e f f k k f where k f is the contribution of the fractures to the effective permeability we assume that ω contains m fracture families each family is characterised by its average parameters namely density ρ i i e number of fracture centres per unit volume orientation n i normal to the fracture surface semi major axis d 1 i semi minor axis d 2 i fracture permeability kfri fracture aperture ei and variable ci eikfri by neglecting the fracture interaction the contribution of a single fracture to k eff is expressed by the integral of flow field over this fracture q as derived in 33 eq 43 becomes 44 k e f f k i 1 m 4 π ρ i κ c i d 1 i d 2 i ψ i the model 44 exhibits a linear relationship between k eff and the fracture density that is valid for the case of weak fracture density the self consistent scheme has been used to successfully estimate the effective permeability for a large fracture density dormieux and kondo 2004 barthélémy 2009 pouya and vu 2012 vu et al 2013 by noting ψ i 1 m 4 π ρ i κ c i d 1 i d 2 i ψ i the self consistent scheme consists in replacing the term relating the permeability of the porous matrix κ k 3 by a term relating to the effective permeability such as κ k e f f 3 this leads to the following equation 45 k e f f k ψ κ in such a model the tensor ψ only depends on the determinant of the effective permeability tensor k eff via the term κ as seen on the right hand side of 45 thus the determinant of the tensor k ψ is also a function of κ k ψ f κ as a result the determinant operator of k eff leads to a non linear equation for κ such as 46 κ 3 f κ once this equation is solved the solution κ is introduced into 45 to obtain the components of the effective permeability tensor 5 1 validation for the purpose of validation eq 44 is written for a randomly distribution of oriented fractures surrounded by a porous matrix of isotropic permeability k and then compared to the numerical solution obtained by bogdanov et al 2003 the fractures are assumed to have the circular discshape and to have the same geometric and hydraulic parameters namely radius r and variable c introducing d 1 d 2 r and κ k into eq 34 yields 47 ψ 4 r 3 π c 24 k r δ e 3 e 3 thus eq 44 becomes 48 k e f f δ k δ 16 π ρ k e f f c r 3 3 π c 24 k e f f r δ e 3 e 3 for the case of a random orientation of fractures overall isotropy the average value of e 3 e 3 is 1 3 δ that leads to 49 k e f f k 32 π ρ k e f f c r 3 9 π c 72 k e f f r to unify the results for other fracture shapes it is useful to use dimensionless variables we recall the definition of the excluded volume vex to define the dimensionless density the excluded volume for a fracture is defined as the volume into which the centre of another fractures may not enter if there is no fracture intersection therefore the dimensionless density ρ that is defined as the number of fractures per excluded volume reads adler and thovert 1999 50 ρ ρ v e x where vex π2 r 3 for a disc shaped fracture of radius r charlaix et al 1984 introducing the dimensionless variable c c k r into eq 49 leads to 51 k e f f k 1 32 π k e f f k ρ c 9 π c 72 k e f f k the model 51 is graphically represented in fig 9 which exhibits a percolation threshold ρ c 2 8 corresponding to a jump of effective permeability when the fracture is much more conductive than the host rock bogdanov et al 2003 performed a great number of simulations to determine the effective permeability of porous media containing a random distribution of oriented hexagonal fractures eleven dimensionless densities ρ were considered by these authors 0 487 0 974 1 46 1 95 2 44 2 92 3 41 3 90 4 99 5 97 and 7 92 their results showed that there is no percolation for configurations ρ 0 487 and 0 974 rarely percolation for configurations ρ 1 46 1 95 2 44 and the percentage of percolation is 40 to 60 for configurations ρ 2 92 3 41 3 90 some non percolation for the configuration ρ 4 99 and clear percolation for configurations ρ 5 97 7 92 for each density bogdanov et al 2003 calculated the overall statistical average keff the average for non percolating configurations keff np and the average for percolating configurations keff n to compare our proposed model 51 to bogdanov et al 2003 s results we take keff np of these authors for ρ ρ c 2 8 i e ρ 0 487 0 974 1 46 1 95 2 44 and keff for ρ ρ c i e ρ 2 92 3 41 3 90 4 99 5 97 and 7 92 as shown in fig 9 our proposed model is in good agreement with the finite volume solution of bogdanov et al 2003 5 2 numerical example for an anisotropic distribution of oriented fractures the newton raphson method is used to deal with the non linear eq 46 for a general case of n fracture families n is a finite number in order to show the capacity of the new model expressed by eq 45 a porous medium containing five fracture families is considered each fracture family is characterised by the same density ρ the same geometry parameters d 1 d 2 the same fracture permeability kfr the same fracture aperture e i e the same variable c kfre but by different orientations e 1 i e 2 i e 3 i as described in table 1 the effective permeability tensor k eff of this particular configuration has two non diagonal components that are zeros kxy kyz 0 to study the variation of the effective permeability versus the fracture density the dimensionless fracture density ρ and the dimensionless component of effective permeability tensor k ξ ζ ξ ζ x y z are introduced as follows 52 ρ 5 4 π 3 ρ d 1 d 2 3 2 k ξ ζ k ξ ζ e f f k it is interesting to note that model 45 can be also applied for an impermeable matrix containing fractures to show this possibility we consider the case with the parameters k 0 m2 c μ 10 5 m3 pas and d 1 d 2 d 1 m the evolution of the effective permeability tensor elements k ξ ζ e f f versus the dimensionless density ρ is presented in fig 10 a critical value of ρ is observed ρ c 1 2 beyond which the effective permeability is greater than zero therefore this critical value could be considered as the percolation threshold for the considered fracture network this value is very close to the value obtained by huseby et al 1997 for an isotropic distribution of oriented circular disc shaped fractures besides bogdanov et al 2003 used the numerical simulation to show that the percolating network of hexagonal fractures is found in the range of densities 0 42 ρ 1 70 this range covers the value of ρ c 1 2 obtained in the present work now three different cases of fracture geometries are considered namely d 1 d 2 d d 1 2d and d 2 0 5d d 1 0 5d and d 2 2d with the parameters d 1 m c μ 10 6 m3 pas and k μ 10 10 m2 pas to show the influence of fracture geometry fig 11 presents the evolution of dimensionless effective permeability as a function of the dimensionless density for these three cases the percolation threshold is also observed for these three cases furthermore the results show that the percolation threshold of the distribution for anisotropic objects i e elliptical disc shaped fractures is smaller than that of the isotropic ones i e circular disc shaped fractures indeed it is easier for an elongated object to overlap in comparison to the circular object along a same distance 6 conclusions this paper focuses on deriving an analytical solution of fluid flow through an elliptical disc shape fracture with uniform aperture as well as proposing an effective permeability model for a three dimensional porous medium containing a high fracture density fluid flow is modelled by darcy s law in the porous matrix and poiseuille s law in the fracture the solution of the fluid potential describing flow through a fractured porous medium was represented in the form of a hyper singular integral equation in which the pressure on fractures is the unknown this equation was solved numerically by using the collocation method the numerical solution is applied for a single elliptical disc shaped fracture having a finite permeability an analytical solution of the total flow transported by a single fracture within a 3d infinite porous matrix under far field condition was derived this solution is a function of the fracture permeability time fracture aperture the permeability of the host rock and the fracture geometry parameters the solution of fluid flow through a poiseuille fracture obtained in this work was firstly compared to that of a darcy flattened ellipsoidal inclusion the comparison shows the difference between fluid flow fields in the fracture obtained by these two approaches indeed the poiseuille fracture yields two flux components in the fracture parallel and perpendicular to the far field pressure gradient whereas only one component parallel to the far field pressure gradient is obtained in an ellipsoidal inclusion with darcy s law this difference is resulted from two constitutive equations using for modelling the fluid flow in the fracture in two approaches poisseuille s law and darcy s law as well as two different geometries however the two models give the same integral of flow over a fracture the solution of fluid flow through an elliptical plane fracture was secondly coupled to a self consistent scheme to estimate the effective permeability of a fractured porous medium this model can be used for a nonrandomly distribution of oriented fractures with high density the proposed model is in good agreement with the finite volume solution reported in the literature this new model also presents a critical fracture density considered as the percolation threshold for high fracture density this possibility opens a way to motivate further research on applications in the petroleum or geothermal industries as well as for geological co2 storage acknowledgments the authors wish to thank the editors and four anonymous reviewers for their constructive comments on earlier versions of this article supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 05 014 appendix supplementary materials image application 1 
795,solution for the fluid potential within a fractured porous medium is described this solution is derived numerically for the particular case of a pouseuille s elliptical fracture plane with uniform aperture a closed form solution of total flow integrated over a single fracture is obtained as a function of matrix permeability fracture permeability and fracture geometry parameters this solution allows firstly the comparison between two approaches poiseuille s fracture and darcy s flattened ellipsoidal inclusion this shows the difference of pressure and flow fields in the fractures and the equivalence of total flow transported by fractures then a semi analytical solution is used to establish an effective permeability model based on the self consistent scheme for a porous medium containing an anisotropic distribution of oriented elliptical plane fractures the proposed model is in good agreement with numerical solutions reported in the literature for a random distribution of oriented fractures the present model exhibits a percolation threshold for a three dimensional fractured network the percolation threshold is a critical value of fracture density beyond which the effective permeability is greater than zero for the case of an impermeable parent material keywords fractured porous media effective permeability self consistent percolation threshold poiseuille s flow 1 introduction the imperative of transport process analysis of fractured geological formations has become increasingly important in many environmental and industrial applications such as nuclear waste disposal geological storage of co2 petroleum reservoir engineering and geothermal energy production in practical engineering the assumption of an impermeable parent material i e the flow occurs only within the fracture network has been widely made for simplicity long et al 1985 cacas et al 1990 ubertosi and delay 2007 koudina et al 1998 lei et al 2017 however this approach is not applicable at low fracture densities when the background matrix has a non negligible permeability modelling fluid flow through a porous matrix containing a random distribution of oriented fractures with complex geometry needs the use of numerical methods in the following a porous matrix means a permeable parent material that is transmitting flow the use of finite element matthai and belayneh 2004 lang et al 2017 ebigbo et al 2016 pouya 2015 fracsima 2017 and or finite volume methods bogdanov et al 2007 mourzenko et al 2010 bogdanov et al 2003 requires a numerical tool to automatically generate an appropriate mesh for a domain containing numerous fractures this tool only exists in some numerical codes lang et al 2017 pouya 2015 bogdanov et al 2007 boundary integral equation methods bem are computationally efficient and accurate for modelling the fluid flow in porous media because of their ability of problem dimension reduction bonnet 1995 however the classical bem exhibits mathematical degeneration leading to numerical instabilities for domains containing discontinuities bonnet 1995 multi region bem is proposed for overcoming this difficulty this method has been widely used for modelling linear fracture mechanics when the solid contains a single fracture bonnet 1995 still this powerful technique requires an elaborated numerical implementation in comparison to standard bem and becomes inefficient for high fracture density situations based on singular integral equations a single equation of the fluid potential was firstly developed by liolios and exadaktylos 2006 for modelling fluid flow through a 2d infinite porous medium containing non intersecting fractures this study was then extended for intersecting fractures pouya and ghabezloo 2010 pouya and vu 2012 tran et al 2018 vu et al 2017 a 3d configuration pouya 2012 vu et al 2013 2015 pouya and vu 2012 unsaturated fluid flow pouya et al 2013 and finite porous media vu et al 2013 2015 seyedi et al 2011 2015 numerical modelling needs significant information on geometry and on the physical properties of rock fractures the collection of which is not a trivial task moreover the numerical modelling of fluid flow through a large scale geological structure with the presence of high fracture density necessarily consumes a lot of computational resources the homogeneisation approach is often used as an efficient approximation for predicting the effective permeability of a fractured porous medium in such models the effective properties of a fractured medium are evaluated based on a closed form solution of an individual defect eshelby 1957 coupled with approximation schemes to estimate effective properties for the whole medium homogenisation schemes include dilute scheme for weak fracture density in which the fracture interaction is negligible snow 1969 shafiro and kachanov 2000 self consistent scheme fokker 2001 dormieux and kondo 2004 barthélémy 2009 podzniakov and tsang 2004 differential scheme zimmerman 1996 and adaptive scheme nguyen et al 2016 taking into account implicitly the interaction between fractures saevic et al 2013 reviewed various effective media models and compared them with explicit numerical modelling to assess their accuracy for a large number of cases of fracture density and of fracture permeability within homogeneisation approaches the fracture is assumed to be a porous matrix obeying darcy s law whose permeability is different from that of the host rock nevertheless the experimental studies showed that poiseuille s law is more appropriate than darcy s law for modelling the fluid flow in a single fracture guéguen and palciauskas 1994 witherspoon et al 1980 additionally pouya and vu 2012 showed that analytical solutions of fluid flow for a particular case of a superconductive fracture of circular shape obtained by two hypotheses of darcy s law and poiseuille s law are not absolutely identical in the following a poiseuille fracture designates a flat fracture of elliptical shape with uniform aperture obeying poiseuille s law for fluid flow and a darcy inclusion indicates a fracture modelled by a flattened ellipsoid in which the fluid flow is represented by darcy s law this study focuses on deriving a solution of fluid flow through a poiseuille fracture and subsequently utilising it with a self consistent scheme to estimate the effective permeability of a porous medium containing an anisotropic distribution of oriented fracture the fracture is mathematically modelled by a 2d surface in the 3d space of the medium the solution of the fluid potential in the form of a singular integral equation is written for a single elliptical disc shaped fracture and then numerically resolved by using the collocation method a closed from solution of fluid flow within a poiseuille fracture was obtained the comparison of the flow solution of a poiseuille fracture with that of a darcy inclusion was made the current study considered a more general case of an elliptical fracture of finite conductivity in comparison to the particular case studied by pouya and vu 2012 based on a self consistent scheme a new model of effective permeability for a fractured porous medium is proposed a comparison of this new model with finite volume solutions of bogdanov et al 2003 is also made 2 generals equations and solutions 2 1 notations in the following light face greek or latin letters denote scalars underlined letters denote vectors bold face letters designate second rank tensors or double index matrices the scalar product of two vectors a and b is labelled as a b for second rank tensors the transposed tensor of a is denoted a t the matrix product is labelled as ab and the determinant as a the operation of a on a is labelled as a a the convention of summation on repeated indices is not used for latin indices i j k that number surfaces lines etc and are noted indifferently as subscript or superscript represents the gradient and δ the laplace operator for a scalar field and the divergence for a vector field let us consider an infinite three dimensional medium ω containing several fractures numbered by j and noted by γ j fig 1 embedded in a permeable matrix the matrix has a uniform permeability k m2 each fracture surface γ j is defined by a smooth function z j of the curvilinear parameters s α α 1 2 two or more fractures can intersect along an intersection line and three or more fractures can cross at an intersection point γ and s denote respectively the set of points on the fracture surface and on the intersection lines between fractures the matrix corresponds to ω γ a far field pressure field p x is prescribed for infinity the fluid flow in the matrix is governed by darcy s law 1 x ω γ v x k μ p x where v x m s and p x pa are local darcy velocity and reduced pressure respectively μ pa s the fluid dynamic viscosity the definition of the reduced pressure is batchelor 1967 zimmerman and bodvarsson 1996 p p ρ fgz where p is the pressure ρ f the fluid density g the gravity and z the elevation the main objectives of this study namely the comparison between two approaches darcy inclusion and poiseuille fracture and the proposition of a new effective permeability model are not affected by the use of the pressure or the reduced pressure thus the gravity is not taken into account in this work for simplification and p reduces to the pressure p p the fluid is assumed to be incompressible thus the mass conservation in the matrix with steady state condition in absence of point sources reads 2 x ω γ v x 0 in rock mechanics poiseuille s law is frequently used for modelling the fluid flow in a single fracture guéguen and palciauskas 1994 this law establishes a linear relation between the flow vector q s m2 s and the in plane pressure gradient sp s in the fracture as follows 3 s γ q s c s μ s p s where c m3 consists of a tensor related to hydraulic properties of the fracture which can vary on the fracture surface more details of the characters of the tensor c were discussed in pouya 2012 the flow vector q s is defined as the integral of the fluid velocity v in the thickness of the fracture at position s q s 0 e v s d z s pouya 2012 established two explicit expressions for mass exchange under steady state condition between the matrix and the fracture at a point on fractures and at a point on an intersection line between fractures 4 s γ v z n s s q s 0 5 z l j q j m j 0 where n is the normal vector to the fracture surface orienting from γ to γ v z v z v z designates the discontinuity or jump of darcy velocity across the fracture where v and v are the darcy velocity in the matrix at the point z of lower and upper fracture surface respectively s q s represents the surface divergence of fluid flow taking place within the fracture surface q j is the flow vector within fracture γ j and m j the vector tangent to the surface normal to the intersection line and pointing outward from the domain by assimilating the fractures to a distribution of sources or sinks pouya 2012 proposed a general solution of the fluid potential for the steady state fluid including the mass balances 4 and 5 as follows 6 p x p x 1 4 π k j γ j q j s k 1 x z j s x z j s k 1 x z j s 3 2 d s in this solution the pressure field in the whole domain ω p x is expressed as a function of the flow vectors q j s through the fractures introducing 3 into 6 yields a hyper singular integral equation for the pressure field on the fracture surfaces when the field point x is located on these surfaces 7 p x p x 1 4 π k j γ j s j p s c j s k 1 x z j s x z j s k 1 x z j s 3 2 d s the numerical derivation of this equation based on the collocation method was presented by vu 2012 once this is done the pressure field on the fractures is known thus the flow is also known by eq 3 eq 7 is used again to directly determine the pressure at an arbitrary point in the whole fractured porous medium this numerical solution is useful to model the fluid flow in an infinite porous medium containing fractures under a far field condition p x to show the capacity of the developed numerical procedure an example of modelling of fluid flow through several intersecting circular disc shaped fractures is presented in fig 2 this consists in the pressure field on the fracture network for a specific far field condition a 1 0 0 as observed the pressure is continuous on the intersection lines between fractures moreover eq 7 can be also used to derive an analytical solution of fluid flow through a single fracture as shown in the next section 3 flow solution on an elliptical disc shaped fracture consider an infinite isotropic medium ω containing an elliptical disc shaped fracture with uniform aperture prescribed by a constant gradient a at infinity i e p x a x fig 3 the matrix permeability is homogeneous and isotropic k k δ δ is the second order identity tensor we denote κ k 3 the fracture is characterised by a uniform aperture e therefore the tensor c reduces to a scalar c where c can be determined by witherspoon et al 1980 8 c 1 f e 3 12 in which f is an empirical factor to account for fracture roughness witherspoon et al 1980 the variable c m3 is the fracture permeability kfr e2 12f m2 time the fracture aperture e m let d 1 and d 2 designate the half diameters of the elliptical plane fracture e 1 and e 2 their principal directions and e 3 the normal unit vector of the fracture plane a local coordinate system is defined by the base e 1 e 2 e 3 and its origin located at the fracture centre fig 3 writing eq 7 for this particular problem in the local coordinates yields 9 p x a x c 4 π κ γ s p s x z s x z s 3 2 d s in order to analyse this equation we introduce the following dimensionless variables 10 x x d 1 d 2 λ c 4 π κ d 1 d 2 p λ x p x d 1 d 2 a using p x a p λ x eq 9 becomes 11 p λ x a a x λ γ p λ x x z x z 3 d z where γ designates the ellipse in the transformed space of the variable x the integral of the flow field over the fracture surface γ is determined by 12 q c μ γ p x d x c 0 a d 1 d 2 γ p λ x d x c 0 c μ then we define 13 q q a d 1 d 2 a 2 c 0 a a γ p λ x d x for the general case a a 1 a 2 a 3 the solution is obtained by the superposition of three elementary solutions corresponding to p x a 1 x 1 p x a 2 x 2 and p x a 3 x 3 respectively since the fracture has an infinite transversal permeability the fracture does not perturb the flow if the far field pressure gradient is perpendicular to the fracture plane i e the case p x a 3 x 3 consequently the general solution is obtained by adding a 3 x 3 to the solution corresponding to a a 1 a 2 0 in addition the geometry of the elliptical disc shaped fracture allows obtaining the solutions corresponding to a 0 a 2 0 from that of a a 2 0 0 therefore it is sufficient to consider eq 11 with p x a 1 x 1 to be able to build the solution for the general case p x a x numerical derivation described by vu 2012 is employed to derive eq 11 for different values of λ and different fracture geometries characterised by the ratio 14 ɛ d 1 d 2 figs 4 and 5 respectively show the flow field solution through the fracture for the parameter λ 10 far field condition a 1 0 0 and two ratios ε 2 0 and ε 0 5 it is interesting to note that the flow perpendicular to the direction of the far field gradient a e 1 does not vanish as a reminder this component of the flow vector is nil when using the approach of darcy flow in the ellipsoidal inclusion therefore this result shows that the flow field solution in the poiseuille fracture cannot be obtained by considering it as the limit case of the darcy flattened ellipsoidal inclusion according to eq 13 the numerical solution of the pressure field p λ x in the fracture allows us to determine q it is worth noting that q is q a a computed over an elliptical disc shaped fracture with d 1 d 2 1 or ɛ 1 d 2 2 in order to validate the numerical solution we recall the closed form solution for the integral of flow over an elliptical disc shaped superconductive fracture given by pouya and vu 2012 15 q γ q ξ d s 4 π k 3 μ d 1 d 2 φ a where 16 φ ϕ 1 1 e 1 e 1 ϕ 2 1 e 2 e 2 with 17 ϕ 1 λ 1 λ 2 θ 0 π 2 λ 1 cos 2 θ λ 1 cos 2 θ λ 2 sin 2 θ d θ ϕ 2 λ 1 λ 2 θ 0 π 2 λ 2 sin 2 θ λ 1 cos 2 θ λ 2 sin 2 θ d θ and 18 λ 1 1 d 1 2 λ 2 1 d 2 2 besides the superconductive fracture can be also numerically obtained by setting λ i e λ 1 during numerical programming in eq 11 the comparison between closed form solutions 15 and the numerical solution for different values of ε is presented in fig 6 as expected a perfect agreement between the numerical solution and the closed form solution is observed moreover ϕ1 and ϕ2 can be expressed as a function of the complete elliptic integrals of first and second order k η and e η such as 19 ϕ 1 d 2 k η e η d 1 2 d 2 2 ϕ 2 d 1 2 e η d 2 2 k η d 2 d 1 2 d 2 2 where d 2 d1 η 1 d 2 d 1 2 and 20 0 η 1 k η θ 0 π 2 d θ 1 η 2 sin 2 θ e η θ 0 π 2 1 η 2 sin 2 θ d θ as shown in fig 7 the relation between c 0 q and λ for each ratio ε can be fitted by a linear function with a great precision such as 21 c 0 q α d 1 d 2 λ β d 1 d 2 where the numerical solutions of α and β versus d 1 and d 2 will be obtained further down introducing q c 0 αλ β obtained from 21 and λ from 10 into 12 and rearranging yield 22 q c 0 4 π κ d 1 d 2 3 2 α c 4 π κ β d 1 d 2 1 2 a 1 e 1 in this relationship q is expressed as a function of the following parameters far field condition a determinant of permeability tensor k fracture variable c kfre fracture permeability time fracture aperture and fracture geometry d 1 d 2 it is interesting to note that the coefficient α d 1 d 2 can be deduced from the asymptotic behaviour of q when c thanks to its closed form solution for the case of a superconductive fracture described by eq 15 we have 23 lim c q 4 π κ d 1 d 2 3 2 μ α a 1 e 1 the comparison between eq 23 and analytical solution 15 corresponding to a a 1 e 1 leads to 24 α d 1 d 2 3 ϕ 1 λ 1 λ 2 d 1 d 2 1 2 this result can be numerically verified since α can be otherwise determined for each ε from fig 7 as expected a perfect agreement between expression 24 and the numerical solution of α is observed in fig 8 besides the numerical results show that β varies in the interval 0 46 to 0 49 corresponding to the considered range of ε d 1 d 2 this variation is negligible considering the variation of α therefore we can assume that all lines c 0 q in fig 8 cut the λ axis at a same point i e β is constant the numerical result of q corresponding to a a 2 e 2 can be obtained by a similar analysis 25 q c 0 4 π κ d 1 d 2 3 2 γ c 4 π κ β d 1 d 2 1 2 a 2 e 2 with 26 γ d 1 d 2 3 ϕ 2 λ 1 λ 2 d 1 d 2 1 2 where the function ϕ2 λ1 λ2 is defined by 17 4 comparison between the poiseuille fracture and the darcy ellipsoidal inclusion approaches in this section the results given in this work is compared to the solution obtained by shafiro and kachanov 2000 in order to exactly identify the term β in eqs 22 and 25 shafiro and kachanov 2000 considered the steady state flow through a three dimensional reference volume ω having an isotropic permeability k containing an ellipsoidal inclusion of permeability k occupying the volume ω due to a far field gradient pressure a we denote by d 1 d 2 d 3 the semi axes of the inclusion and e 1 e 2 e 3 unit vectors parallel to them the integral of flow field over the inclusion is derived as follows shafiro and kachanov 2000 27 q ω ω k k μ h 1 e 1 e 1 h 2 e 2 e 2 h 3 e 3 e 3 where ω 4πd 1 d 2 d 3 3 and the coefficients h i i 1 2 3 have the form 28 h i 1 k k k j i 1 i 1 2 3 with 29 j i 1 2 j 1 3 a j 0 d u a i 2 u j 1 3 a j 2 u i 1 2 3 the expression of factor ji in terms of elliptic integrals can be found in shafiro and kachanov 2000 we consider the case of a flattened ellipsoidal inclusion d 3 d 2 d 1 with d 3 d 1 0 and d 3 d 2 0 while d 3 0 and the permeability k but 30 2 d 3 k c with c is a constant the three coefficients hi for this case are simplified such as 31 h 1 1 c 2 k d 2 k λ e λ d 1 2 d 2 2 1 h 2 1 c 2 k d 1 2 e λ d 2 2 k λ d 1 2 d 2 2 1 h 3 0 substituting 19 into 31 and then introducing hi i 1 2 3 into 27 yield 32 q 4 π 3 k c μ d 1 d 2 1 ϕ 1 c 2 k e 1 e 1 1 ϕ 2 c 2 k e 2 e 2 besides the superposition of two elementary solutions 22 and 25 corresponding to far field conditions p x a 1 x 1 and p x a 2 x 2 allows obtaining the solution of the integral of flux field over a poisseuille elliptical disc shaped fracture in the general case a a 1 a 2 a 3 as follows 33 q 4 π κ c d 1 d 2 μ ψ a where 34 ψ ψ 1 1 e 1 e 1 ψ 2 1 e 2 e 2 35 ψ 1 3 ϕ 1 c 4 π κ β ψ 2 3 ϕ 2 c 4 π κ β if we take β 6 4π the expression of q for the poiseuille elliptical disc shaped fracture is identical to that for the darcy flattened ellipsoidal inclusion therefore two approaches the poiseuille elliptical disc shaped fracture and the darcy ellipsoidal inclusion yield a similar flow q through fracture this conclusion was also observed by pouya and vu 2012 for the case of a superconductive fracture however the pressure field is not linear in the poiseuille fracture figs 4 and 5 while the darcy ellipsoidal inclusion yields a constant pressure gradient field in the fracture in addition the flow through the poiseuille fracture has two components parallel and perpendicular to the far field pressure gradient a in comparison to only one parallel to a in the darcy inclusion as a conclusion when considering the fluid flow through a 3d infinite porous medium containing a fracture two constitutive equations poiseuille s law and darcy s law and two different geometries uniform aperture for poiseuille fracture and aperture varies across the nominal plane of the fracture for darcy inclusion yield different solutions of flow within the fracture 5 effective permeability model let us consider a porous medium ω surrounding several fractures γ j subjected to a pressure p x a x on its boundary ω the porous matrix is represented by a uniform permeability k the effective permeability of ω is globally defined by darcy s law 36 v k e f f μ p x where v g are respectively the average darcy velocity and the average pressure gradient in ω 37 v 1 ω ω v d ω j γ j q d s g 1 ω ω p d ω green s theorem for the pressure function p in the domain ω containing discontinuities γ reads 38 ω p d ω ω p n d s i 1 n γ i p n d s on the boundary ω p a x and on the fracture p 0 hence mathematical identity ω x n d s ω leads to 39 g 1 ω ω p d ω a introducing 1 into the first term of v in 37 yields 40 1 ω ω v d ω k μ a combination of 37 39 40 gives 41 v k μ a 1 ω j γ j q d s k e f f μ a this implies that there exists a tensor k f that verifies 42 1 ω j γ j q d s k f μ a thus the effective permeability k eff is obtained such as 43 k e f f k k f where k f is the contribution of the fractures to the effective permeability we assume that ω contains m fracture families each family is characterised by its average parameters namely density ρ i i e number of fracture centres per unit volume orientation n i normal to the fracture surface semi major axis d 1 i semi minor axis d 2 i fracture permeability kfri fracture aperture ei and variable ci eikfri by neglecting the fracture interaction the contribution of a single fracture to k eff is expressed by the integral of flow field over this fracture q as derived in 33 eq 43 becomes 44 k e f f k i 1 m 4 π ρ i κ c i d 1 i d 2 i ψ i the model 44 exhibits a linear relationship between k eff and the fracture density that is valid for the case of weak fracture density the self consistent scheme has been used to successfully estimate the effective permeability for a large fracture density dormieux and kondo 2004 barthélémy 2009 pouya and vu 2012 vu et al 2013 by noting ψ i 1 m 4 π ρ i κ c i d 1 i d 2 i ψ i the self consistent scheme consists in replacing the term relating the permeability of the porous matrix κ k 3 by a term relating to the effective permeability such as κ k e f f 3 this leads to the following equation 45 k e f f k ψ κ in such a model the tensor ψ only depends on the determinant of the effective permeability tensor k eff via the term κ as seen on the right hand side of 45 thus the determinant of the tensor k ψ is also a function of κ k ψ f κ as a result the determinant operator of k eff leads to a non linear equation for κ such as 46 κ 3 f κ once this equation is solved the solution κ is introduced into 45 to obtain the components of the effective permeability tensor 5 1 validation for the purpose of validation eq 44 is written for a randomly distribution of oriented fractures surrounded by a porous matrix of isotropic permeability k and then compared to the numerical solution obtained by bogdanov et al 2003 the fractures are assumed to have the circular discshape and to have the same geometric and hydraulic parameters namely radius r and variable c introducing d 1 d 2 r and κ k into eq 34 yields 47 ψ 4 r 3 π c 24 k r δ e 3 e 3 thus eq 44 becomes 48 k e f f δ k δ 16 π ρ k e f f c r 3 3 π c 24 k e f f r δ e 3 e 3 for the case of a random orientation of fractures overall isotropy the average value of e 3 e 3 is 1 3 δ that leads to 49 k e f f k 32 π ρ k e f f c r 3 9 π c 72 k e f f r to unify the results for other fracture shapes it is useful to use dimensionless variables we recall the definition of the excluded volume vex to define the dimensionless density the excluded volume for a fracture is defined as the volume into which the centre of another fractures may not enter if there is no fracture intersection therefore the dimensionless density ρ that is defined as the number of fractures per excluded volume reads adler and thovert 1999 50 ρ ρ v e x where vex π2 r 3 for a disc shaped fracture of radius r charlaix et al 1984 introducing the dimensionless variable c c k r into eq 49 leads to 51 k e f f k 1 32 π k e f f k ρ c 9 π c 72 k e f f k the model 51 is graphically represented in fig 9 which exhibits a percolation threshold ρ c 2 8 corresponding to a jump of effective permeability when the fracture is much more conductive than the host rock bogdanov et al 2003 performed a great number of simulations to determine the effective permeability of porous media containing a random distribution of oriented hexagonal fractures eleven dimensionless densities ρ were considered by these authors 0 487 0 974 1 46 1 95 2 44 2 92 3 41 3 90 4 99 5 97 and 7 92 their results showed that there is no percolation for configurations ρ 0 487 and 0 974 rarely percolation for configurations ρ 1 46 1 95 2 44 and the percentage of percolation is 40 to 60 for configurations ρ 2 92 3 41 3 90 some non percolation for the configuration ρ 4 99 and clear percolation for configurations ρ 5 97 7 92 for each density bogdanov et al 2003 calculated the overall statistical average keff the average for non percolating configurations keff np and the average for percolating configurations keff n to compare our proposed model 51 to bogdanov et al 2003 s results we take keff np of these authors for ρ ρ c 2 8 i e ρ 0 487 0 974 1 46 1 95 2 44 and keff for ρ ρ c i e ρ 2 92 3 41 3 90 4 99 5 97 and 7 92 as shown in fig 9 our proposed model is in good agreement with the finite volume solution of bogdanov et al 2003 5 2 numerical example for an anisotropic distribution of oriented fractures the newton raphson method is used to deal with the non linear eq 46 for a general case of n fracture families n is a finite number in order to show the capacity of the new model expressed by eq 45 a porous medium containing five fracture families is considered each fracture family is characterised by the same density ρ the same geometry parameters d 1 d 2 the same fracture permeability kfr the same fracture aperture e i e the same variable c kfre but by different orientations e 1 i e 2 i e 3 i as described in table 1 the effective permeability tensor k eff of this particular configuration has two non diagonal components that are zeros kxy kyz 0 to study the variation of the effective permeability versus the fracture density the dimensionless fracture density ρ and the dimensionless component of effective permeability tensor k ξ ζ ξ ζ x y z are introduced as follows 52 ρ 5 4 π 3 ρ d 1 d 2 3 2 k ξ ζ k ξ ζ e f f k it is interesting to note that model 45 can be also applied for an impermeable matrix containing fractures to show this possibility we consider the case with the parameters k 0 m2 c μ 10 5 m3 pas and d 1 d 2 d 1 m the evolution of the effective permeability tensor elements k ξ ζ e f f versus the dimensionless density ρ is presented in fig 10 a critical value of ρ is observed ρ c 1 2 beyond which the effective permeability is greater than zero therefore this critical value could be considered as the percolation threshold for the considered fracture network this value is very close to the value obtained by huseby et al 1997 for an isotropic distribution of oriented circular disc shaped fractures besides bogdanov et al 2003 used the numerical simulation to show that the percolating network of hexagonal fractures is found in the range of densities 0 42 ρ 1 70 this range covers the value of ρ c 1 2 obtained in the present work now three different cases of fracture geometries are considered namely d 1 d 2 d d 1 2d and d 2 0 5d d 1 0 5d and d 2 2d with the parameters d 1 m c μ 10 6 m3 pas and k μ 10 10 m2 pas to show the influence of fracture geometry fig 11 presents the evolution of dimensionless effective permeability as a function of the dimensionless density for these three cases the percolation threshold is also observed for these three cases furthermore the results show that the percolation threshold of the distribution for anisotropic objects i e elliptical disc shaped fractures is smaller than that of the isotropic ones i e circular disc shaped fractures indeed it is easier for an elongated object to overlap in comparison to the circular object along a same distance 6 conclusions this paper focuses on deriving an analytical solution of fluid flow through an elliptical disc shape fracture with uniform aperture as well as proposing an effective permeability model for a three dimensional porous medium containing a high fracture density fluid flow is modelled by darcy s law in the porous matrix and poiseuille s law in the fracture the solution of the fluid potential describing flow through a fractured porous medium was represented in the form of a hyper singular integral equation in which the pressure on fractures is the unknown this equation was solved numerically by using the collocation method the numerical solution is applied for a single elliptical disc shaped fracture having a finite permeability an analytical solution of the total flow transported by a single fracture within a 3d infinite porous matrix under far field condition was derived this solution is a function of the fracture permeability time fracture aperture the permeability of the host rock and the fracture geometry parameters the solution of fluid flow through a poiseuille fracture obtained in this work was firstly compared to that of a darcy flattened ellipsoidal inclusion the comparison shows the difference between fluid flow fields in the fracture obtained by these two approaches indeed the poiseuille fracture yields two flux components in the fracture parallel and perpendicular to the far field pressure gradient whereas only one component parallel to the far field pressure gradient is obtained in an ellipsoidal inclusion with darcy s law this difference is resulted from two constitutive equations using for modelling the fluid flow in the fracture in two approaches poisseuille s law and darcy s law as well as two different geometries however the two models give the same integral of flow over a fracture the solution of fluid flow through an elliptical plane fracture was secondly coupled to a self consistent scheme to estimate the effective permeability of a fractured porous medium this model can be used for a nonrandomly distribution of oriented fractures with high density the proposed model is in good agreement with the finite volume solution reported in the literature this new model also presents a critical fracture density considered as the percolation threshold for high fracture density this possibility opens a way to motivate further research on applications in the petroleum or geothermal industries as well as for geological co2 storage acknowledgments the authors wish to thank the editors and four anonymous reviewers for their constructive comments on earlier versions of this article supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 05 014 appendix supplementary materials image application 1 
796,immiscible fluid fluid displacement in rough fractures is important in many subsurface processes including enhanced oil recovery and geological carbon sequestration numerous previous works experimentally investigated the dynamics of multiphase flow in fractures but direct numerical simulation for fluid fluid displacement in 3d rough fractures and the validation with experiments were rarely reported here we perform 3d direct numerical simulations for drainage processes of water displacing oil in a real rough fracture with capillary number log10 ca ranging from 3 to 5 comparison between experiments and simulations shows that the simulated results can generally reproduce the dynamic invasion morphologies at the scale of fracture the discrepancy of the invasion morphologies however is observed at the local scale mainly because the mesh resolution is not small enough compared with the scale of the interface we then perform quantitative analysis of the simulated results to investigate the role of capillary and viscous forces we show that haines jump events in the flow passage of void neck connecting to a wider void occur in the capillary dominated flow regime statistical analysis of the velocity fields under various flow rate conditions shows that as the effect of viscous force becomes more important and eventually dominates that of capillarity void filling toward the outlet is continuously enhanced with the velocity vector angles being more probably localized in the zone around the bulk flow direction the direct evidence provided by the 3d numerical simulations improves our understanding of the competition of viscous and capillary forces controlling the immiscible displacement in rough fractures graphical abstract image graphical abstract we perform 3d direct numerical simulations for the displacement of oil by water in rough fracture the simulated results can generally reproduce the dynamic invasion morphology at the scale of fracture haines jump is observed in the capillary dominated flow regime further quantitative analysis reveals that as the effect of viscous force gradually becomes dominated over that of capillarity void filling toward the outlet is continuously enhanced in rough fracture keywords rough fracture immiscible displacement numerical simulation viscous pressure drop capillary force 1 introduction the flow of immiscible fluids through rock fractures is of great interest to many engineering applications including enhanced oil recovery in fractured reservoirs adibhatla and mohanty 2008 austad et al 2011 bikkina et al 2016 meng et al 2017 zhang et al 2017 geological co2 sequestration de dios et al 2017 ren et al 2017 and environmental contamination by non aqueous phase liquid ji et al 2008 detwiler et al 2009 lee et al 2010 faisal et al 2015 due to their much higher permeability compared with rock matrix preferential flow paths always occur in fractures when immiscible fluids are involved description of such flow behaviors of multiple phases with interfaces is much more complicated in geological co2 sequestration the presence of fractures in sealing formations may pose a threat of upward migration of co2 and brine from deep reservoirs miocic et al 2016 for enhanced oil recovery the non compact fluid fluid displacement during water flooding would significantly reduce the displacement efficiency therefore understanding and controlling the multiphase flow in rock fractures are important for optimizing subsurface fluid management the investigation of immiscible fluid fluid displacements in permeable media can be traced to hele shaw experiment performed over one hundred years ago hele shaw 1898 although it has long been studied characterization of multiphase flow remains a challenging issue due mainly to the complex interplay between the capillary and viscous forces homsy 1987 wong 1994 hu et al 2017b 2018 the pioneering study in 2d porous media provided a basic understanding that displacement patterns vary from capillary to viscous fingering as the role of viscous force becomes more important and eventually dominates that of capillarity lenormand et al 1988 this interplay of capillary and viscous forces impacting displacement patterns was also recognized for rough fractures but the crossover zone from capillary fingering to viscous fingering is much narrower than that in porous media due to the differences in the geometry of void spaces chen et al 2017 the light transmission experiments fourar and bories 1995 persoff and pruess 1995 amundsen et al 1999 babadagli et al 2015a b chen et al 2017 2018 and computed tomography ct experiments bertels et al 2001 karpyn et al 2007 provide evdiences and insights that how fracture wall geometry together with capillary and viscous forces impacts fluid occupancy and invasion morphology during immiscible displacement amundsen et al 1999 neuweiler et al 2004 karpyn et al 2007 babadagli et al 2015b yang et al 2016 the laboratory based ct experiment permits 3d visualization of the phase configuration in fractures but its time resolutions cannot match the actual occurrence of flow events consequently this method can be used only for quasi static conditions rather than dynamic cases bertels et al 2001 karpyn et al 2007 karpyn and piri 2007 unless the synchrotron based x ray ct is employed berg et al 2013 reynolds et al 2017 on the other hand the light transmission experiment can provide real time imaging of fluids displacement processes neuweiler et al 2004 bergslien and fountain 2006 chen et al 2017 but the image of fluid distribution is 2d hence failing to capture the 3d features of the fluid fluid interfaces more importantly since the experimental observations cannot access to the detailed information of flow behaviors including the velocity and pressure fields within the whole domain of fracture space quantitative analysis of fluids displacement only relies on the imaging of dynamic invasion morphology hence lacking a link to the evolutions of velocity and pressure direct numerical simulation permits access to information on interface advancement in three dimensions as well as on the velocity pressure fields linking to dynamic invasion morphology thus improving the understanding of multiphase flow in rough fractures numerical investigation of the immiscible flow has been conducted using pore network models joekar niasar et al 2009 raeesi and piri 2009 yuan et al 2015 computational fluid dynamics ferrari et al 2015 raeini et al 2015 hu et al 2017a lattice boltzmann methods jiang and tsuji 2015 liu et al 2015 and the smooth particle hydrodynamic methods bandara et al 2011 most of these numerical studies focused on multiphase flow in 3d porous media and 2d microfluidics and only a very few of emphases were given to rough fractures amundsen et al 1999 neuweiler et al 2004 yang et al 2012 dou et al 2013 amundsen et al 1999 developed an invasion percolation model for predicting the flow patterns of air displacing water in rough walled plates in the capillary dominated flow regime later on neuweiler et al 2004 verified the invasion percolation model via displacement experiment in a rough fracture and demonstrated the role of the in plane curvature that would stabilize the displacement front glass et al 1998 yang et al 2012 karpyn and piri 2007 extended the invasion percolation model to consider the dynamic effect dou et al 2013 employed the lattice boltzmann method to study the wettability effect on the fluid fluid interface area during immiscible displacement in a 3d self affine rough fracture despite the above efforts direct numerical simulation for fluids displacement in real 3d rough fractures and the corresponding validation by experiments were rarely reported here we perform direct numerical simulation of the full navier stokes equations with the volume of fluid vof method tracking the fluid fluid interface for modeling the two phase flow of water displacing oil in a 3d rough fracture we validate the numerical simulation via experimental results independently documented in our previous study chen et al 2017 with the aim to show that whether the direct numerical simulation can satisfactorily reproduce the fingering flow in rock fractures at various capillary numbers we then perform quantitative analysis on the role of viscous capillary forces in controlling displacement pattern by linking 3d displacement front advancement to the pressure variations and the detailed 3d velocity fields this study not only provides comparisons between experiments and direct numerical simulations for multiphase flow in a rough fracture but also improves our understanding of the effect of the competition between capillary and viscous forces on displacement processes 2 experiments and simulations 2 1 overview of experiments we carried out a series of drainage experiments of water displacing silicone oil in a transparent rough fracture and the details of the experiments were reported in chen et al 2017 the transparent rough fracture is 20 cm in length and 10 cm in width comprised of two resin replicas that were fabricated from a granite fracture we used a high resolution non contact 3d laser scanning method e g chen et al 2015 to measure the topography of the fracture surface fig 1 a with a resolution of 1 μm in the z direction after the scanned data were recorded automatically at every 200 μm interval in both the x and y directions we then reconstructed each square surface 200 μm 200 μm in an anticlockwise order and finally obtained the 3d surface of the full range of the rough fracture as shown in fig 1a the light transmission technique detwiler et al 1999 was employed to measure the aperture field of the duplicated fracture fig 1b with its mean being b 0 660 mm and the standard deviation being σ b 0 123 mm the static contact angle of water is θ 134 4 we first fully saturated the fracture with silicone oil and then dyed water was injected via an isco pump into the fracture to displace oil at constant flow rates the water invasion morphology during the drainage processes in the entire fracture was recorded at 10 frames s with a ccd camera until the invading fluid reached the outlet of the fracture experimental results with flow rates q 0 3 1 10 30 and 100 ml min and viscosity ratio μ μ i μ d 1 100 μ i and μ d are respectively the viscosity of the invading and defending fluids were adopted for comparison as reported in chen et al 2017 independent experiments were conducted and showed good reproducibility of the experimental observations we use the classic macroscopic capillary number ca μ i v i σ to represent the relative effect of viscous force to capillary force where σ is the interfacial tension σ 35 0 mn m peters and arabali 2013 and v i q a c a c is the cross sectional area of the inlet a c 23 2 mm2 the capillary number ca in the experiments spans three orders of magnitude log10 ca 5 59 5 07 4 07 3 59 and 3 07 the corresponding displacement patterns include both capillary and viscous fingerings 2 2 direct numerical simulation the water invasion processes in rough fractures can be described by the navier stokes equations eqs 1 and 2 together with the volume of fluid method vof that tracks the evolution of fluid fluid interface eq 3 1 ρ α u t ρ α uu p μ α u t u f s 2 u 0 3 α t α u α 1 α u r 0 where u is the fluid velocity p is the pressure μ is the viscosity and u r is an artificial compression velocity to limit numerical diffusion rusche 2003 greenshields 2015 the variable α represents the volume fraction of fluid within cells i e α 0 for non wetting phase α 1 for wetting phase and 0 α 1 for the fluid fluid interface consequently the density ρ α and the viscosity μ α can be written as ρ α ρ w α ρ nw 1 α and μ α μ w α μ nw 1 α respectively where the subscripts w and nw denote the wetting and non wetting phases respectively f s represents the contribution of momentum from the surface tension at the fluid fluid interface expressed as ferrari and lunati 2013 4 f s σ α α α we employ the multiphase flow solver interfoam included in the open source library openfoam greenshields 2015 to directly solve the governing equations eqs 1 3 for the drainage processes in the 3d rough fracture in simulations the initial time step is set as 2 0 10 5 s with automatic adjustment based on the courant friedrichs lewy cfl number the maximum courant number and the maximum alpha courant number are both set as 1 0 the wettability effect on the immiscible displacement is considered by imposing an additional constraint on α at the intersection between the fluid fluid interface and solid surface e g ferrari and lunati 2013 5 α α x wall n n s cos θ n t sin θ where n s is the unit normal pointing into the solid and n t is the unit tangent to solid points into the wetting phase comparing with other numerical methods for multiphase flow relatively few model parameters are required for the method of direct solutions of navier stokes equations we set up a 3d computational model of the 200 mm 100 mm rough fracture fig 1a the grid sizes in the x and y directions are the same as the resolutions provided by the non contact 3d laser scanning method e g chen et al 2015 with δx 200 μm and δy 200 μm four layers of grids are specified in the z direction fig 1a given the variation of aperture in the range of 0 28 mm b x y 1 26 mm the grid size in the z direction δz ranges from 70 μm to 315 μm the computational model is then comprised of 2 500 000 points and 1 994 004 hexahedral cells we used 72 processors to perform parallel computing in the supercomputing center of wuhan university for the invasion processes with q 0 3 1 10 30 and 100 ml min and m 1 100 the density and viscosity of the nonwetting invading and wetting defending fluids in simulations are μ nw 1 10 3 pa s μ w 0 1 pa s ρ nw 998 0 kg m3 and ρ w 960 0 kg m3 the values of the interface tension σ and the contact angle θ are also directly taken from the experiments for the boundary conditions the inlet is prescribed with constant velocity of v i q a c fig 1a zero gradient of pressure p x 0 and constant α value α 1 and the outlet is fixed with zero gradient of velocity ux x uy y uz z 0 constant zero pressure p 0 and zero gradient of α α 0 we also conduct mesh sensitive analysis for the drainage simulations in a subdomain of the rough fracture with four eight and twelve layers of grids in the z direction whereas the size of grids in the x and y directions are all set as 200 μm as shown in fig s2 s3 and table s1 in appendix a comparison of numerical results of different mesh sizes indicates that the mesh size used in our simulation is small enough to obtain reasonable results 3 results and discussion 3 1 comparison between experiments and simulations the comparison of invasion morphologies between experiments and simulations is presented in figs 2 and 3 the experimental numerical conditions are plotted in the phase diagram in the log10 m log10 ca plane fig s1 in appendix a showing that the corresponding pattern formation shifts from capillary fingering to viscous fingering as the capillary number varies from log10 ca 5 to log10 ca 3 chen et al 2017 2018 fig 2 compares the experimentally observed and numerically simulated invasion morphologies at the same locations of displacement front tip x tip for log10 ca 5 59 the displacement is controlled by capillarity characterized by capillary fingering at the beginning of water flooding since the aperture field is relatively uniform x 20 mm fig 1b water invades into fracture with a uniform front within this fracture space and later a finger forms and develops due to the heterogeneity of the aperture field fig 2a f at higher ca log10 ca 3 59 unlike the invasion processes in the capillary dominated flow regime multiple water fingers progressing toward the outlet are observed even at the inlet of the fracture with a relatively uniform aperture as shown in fig 2d f and j l these main features of the dynamic invasion morphologies observed in experiments for low and high capillary numbers can both be reproduced by the 3d direct numerical simulations fig 3 presents the observed and simulated water distributions at the time of breakthrough for various capillary numbers again we observe one water finger in the case of small ca fig 3g and i and multiple water fingers for large ca fig 3a and c demonstrating the transition of flow regime from capillary invasion to viscous fingering the 3d direct numerical simulations are generally consistent with the observations more importantly we can observe through simulations the interface in the third dimension convex to the oil phase fig 3h 1 and h 2 which cannot be captured by the imaging system however comparisons of the shapes of fingerings at the fracture scale show that wider fingers are obtained in numerical simulations especially for relatively larger ca compare fig 3c and d fig 3e and f for relatively smaller ca fig 3g j inspection of the fluid fluid interface at the local scale fig 3g and h indicates that the simulated interface is much smoother than the observed one the simulated wider fingers would cause the water saturation s w to be overestimated and the simulated smoother interface causes the fluid fluid interface area to be underestimated from fig 4 the measured water saturations are s w exp 0 413 0 361 0 189 0 209 and 0 260 for log10 ca 5 59 5 07 4 07 3 59 and 3 07 respectively the simulated results are s w sim 0 445 0 428 0 363 0 340 and 0 320 respectively larger than the measurements with the relative error s w sim s w exp s w exp 7 7 18 4 92 0 63 2 and 22 7 the maximum relative error occurs at the capillary number of log10 ca 4 07 corresponding to the crossover from capillary to viscous fingering given that the images recorded during experiments are two dimensional we can only determine the length of fluid fluid interface in the x y plane l nw to provide a direct comparison of fluid fluid interfaces between experiments and simulations we also determine the length of fluid fluid interfaces l nw in the x y plane we first determine the 3d curve i e the intersections of the simulated 3d fluid fluid interfaces and the mid plane in the z direction and then project the 3d curve to the x y plane whose length is the simulated l nw fig 4 shows the variation of the specific fluid fluid interface length l nw with ca where l nw l nw w w is the width of the fracture it can be concluded from fig 4 that l nw increases with ca in the range of log10 ca 5 07 from the dynamics of multiphase flow as ca gradually increases the break up events of the invading fluid gradually become a dominating mechanism for the interface morphology leading to the increase of l nw for larger ca ng and payatakes 1980 wardlaw and mckellar 1985 pak et al 2015 this trend of the variation in l nw with ca is captured by numerical simulations moreover for all capillary numbers except the condition of the largest ca l nw is underestimated with its relative error l nw sim l nw exp l nw exp varying from 25 9 to 53 9 this is because as noted earlier the tracked fluid fluid interface in simulation is smoother than the observed one but at the largest flow rate due to the larger number of water clusters reproduced by simulation the simulated interface length is larger than the measurement as discussed above the discrepancies in invasion morphology between experiments and simulations lead to the overestimated s w and underestimated a nw the discrepancies are mainly attributed to the difference of fracture space geometry at the scale of μm in simulations to limit the numerical diffusion of α eq 3 and track the interface accurately the mesh size should be smaller than the scale of the interface greenshields 2015 however as shown in fig 3g the mesh size used in the numerical simulations that provided by the non contact 3d laser scanning method is 200 μm 200 μm in the x and y directions and this resolution is not fine enough to capture the observed fluid fluid interface at the scale of μm fig 3g for the grid size in the z direction mesh sensitive analysis shown in figs s2 and s3 and table s1 in appendix a shows that there is no significant difference of fluid fluid interface at the small scale even twelve layers of grids are specified indicating the insensitive effect of grids size in the z direction on invasion morphology therefore the numerical simulation can roughly reproduce the invasion morphology at the scale of fracture but the information at the local scale is not well resolved due to the relatively low resolutions of the laser scanning technology in the x and y directions 3 2 quantitative analysis the previous section shows that the 3d numerical simulations generally reproduce the invasion morphology observed in the laboratory given that the simulations can also access to the information on the fields of pressure and velocity that cannot be recorded in experiments it enables us to further investigate the role of viscous and capillary forces in drainage processes in the rough fracture here we present the evolution of the area weighted average pressure drop δp t normalized by the drop at the beginning of water flooding δp 0 i e δp t 0 with the interface advancement as shown in fig 5a since the pressure p at the outlet is 0 the pressure drop δp can be calculated as ferrari and lunati 2013 basirat et al 2017 6 δ p 1 a c a int p d s where a int denotes the inlet boundary and a c is the area of the inlet we observe from fig 5 a that at slow flow rates log10 ca 5 59 and 5 07 the normalized pressure drop δp δp 0 increases at the initial stage of flooding and then decreases accompanied by unsteady fluctuations the fluctuations are attributed to haines jumps haines 1930 berg et al 2013 when water invades into a converging flow passage from t 1 to t 2 selected region c in fig 5b with the aperture decreasing from 0 67 mm to 0 53 mm fig 5c 2 pressure drop increases and a burst of interface occurs once the pressure drop exceeds the capillary entry pressure at the neck of the flow passage this increase in pressure drop from t 1 to t 2 is shown in fig 5a where the interface at t 2 corresponds to the peak of δp δp 0 after t 2 as the flow passage becomes wider with aperture increasing from 0 53 at t 2 to 0 60 mm at t 3 fig 5c 2 a significant drop of δp δp 0 is then observed in fig 5a note that the curvature in the fracture plane x y plane is much smaller than that in the x z plane hence we neglect the contribution of capillary pressure from the x z plane fig 5c 1 this pressure burst is associated with the local velocity jump from fig 5c 1 and c 2 the velocity of the displacement tip v tip from t 1 to t 3 is obtained as v tip 4 5 10 4 m s five times larger in magnitude than the velocity at the inlet 9 1 10 5 m s which results in rapid motion of the invading fluid and dissipates a large proportion of the total work of drainage ferrari and lunati 2014 this local velocity jump also highlights the significance of inertial effects in drainage which has been investigated extensively in porous media moebius and or 2012 armstrong and berg 2013 kazemifar et al 2016 fig 5a also shows that the evolution of the normalized pressure drop δp δp 0 at high flow rates log10 ca 4 07 3 59 and 3 07 steadily decreases during the whole drainage processes this is because the continuously injected water phase with lower viscosity reduces the overall viscous dissipation in the rough fracture as supported by other numerical and experimental results ferrari and lunati 2013 zhao et al 2016 as shown in fig 6 a multiple fingers form and develop in the viscous dominated flow regime to investigate the propagation of a specific finger we present the evolution of the average pressure drop δp avg that represents the difference between the intrinsic phase average of the non wetting and wetting pressures defined by 7 δ p avg ω p 1 α d ω ω 1 α d ω ω p α d ω ω α d ω where ω represents the region of the box labeled with c in fig 6a fig 6 presents the evolution of displacement front and the average pressure drop δp avg when 0 01 pv of water is injected from t 1 to t 3 although the aperture decreases from 0 73 mm at t 1 to 0 56 mm at t 3 fig 6c 2 the average pressure drop δp avg steadily decreases instead of increases as observed in the capillary dominated flow regime as shown in fig 6b indicating that the capillary force from the curvature interface has a very little contribution to the normalized pressure drop to further gain insights into the role of capillary and viscous forces in the immiscible displacements in the rough fracture we perform quantitative analysis of the simulated velocity fields at the breakthrough time figs 7 a and 8 a present the distributions of velocity magnitude and streamlines at two representative flow rates of 0 3 ml min log10 ca 5 59 and 100 ml min log10 ca 3 07 both in capillary fingering log10 ca 5 59 and in viscous fingering log10 ca 3 07 we observe that the preferential flow paths or fingerings are characterized by larger velocity magnitude whereas the regions with smaller velocity magnitude exist in the unswept zone at log10 ca 5 59 inspection of selected regions b and d in fig 7a shows that there exist multiple circulations occurring near the fluid fluid interface fig 7b d in which the directions of the flow pathways are independent of the bulk flow direction denoted by the arrow experimental and numerical studies show that the circulations would be induced by the roughness of rock fractures lee et al 2015 zou et al 2015 on the other hand previous investigations also show that the circulations may be caused by spurious velocity due to numerical error in the capillary dominated flow regime deshpande et al 2012 raeini et al 2012 to identify the reason for the circulations occurring in the rough fracture we performed a controlled trial of simulation in a hele shaw cell whose gap is 0 66 mm the same as the mean aperture of the rough fracture as shown in fig s5 in appendix a the capillary number is set as log10 ca 5 59 also the same as that in the rough fracture shown in fig 7 from the theory of immiscible displacement in hele shaw cell with smooth walls there are no circulations near the fluid fluid interface paterson 1981 homsy 1987 park and homsy 2006 however as presented in fig s5 the circulations near the fluid fluid interface area are obtained in simulations which is against the classic theory of two phase flow therefore we can conclude that the circulations in the rough fracture are attributed to spurious velocity from fig s4 in appendix a the occurrence of spurious velocity in the subdomain fracture with 8 and 12 layers of grids in the z direction demonstrates that the numerical error spurious velocity is insensitive to grid size consistent with the previous investigation deshpande et al 2012 the numerical error is due to inaccurate interface curvature and inaccurate balance of discrete forces in the widely used interface tracking methodologies including volume of fluid method and level set method deshpande et al 2012 roman et al 2015 this inaccuracy is amplified in the capillary dominated flow regime resulting in larger magnitude of these spurious velocities than real physical velocities near the fluid fluid interface fig 7 this issue remains challenging in numerical tracking of interface even though filtering techniques were suggested to suppress the spurious velocities raeini et al 2012 for the viscous dominated flow regime that corresponds to viscous fingering fig 8 inspection of the enlarged regions in the invading phase fig 8c the defending phase fig 8e and near the fluid fluid interfaces fig 8b and d shows that no circulation is observed under such high flow rate log10 ca 3 07 with the local flow pathways consistently along the bulk flow direction denoted by the arrow in fig 8b e thus the numerical error becomes negligible at higher flow rates the local flow pathways presented in fig 7b e for capillary fingering and in fig 8b e for viscous fingering affect the distribution of void filling direction at the scale of fracture fig 9 a presents the relative frequencies of the velocity vector angle of the invading fluid with respect to the bulk flow direction θ from fig 9b the average values of θ are θ avg 9 1 7 4 2 5 2 9 and 1 1 for log10 ca 5 59 5 07 4 07 3 59 and 3 07 respectively indicating no significant difference for various ca this is not surprising from the symmetric relative frequency curves with respect to θ 0 however for the standard deviation of θ θ std dramatically decreases with ca and the values for log10 ca 5 59 5 07 4 07 3 59 and 3 07 are respectively θ std 112 2 97 1 37 2 33 5 and 23 4 fig 9c a smaller θ std indicates more probable values of θ in the zone around θ 0 and hence more frequent void filling events along the bulk flow direction from the phase diagram shown in fig s1 in appendix a the smallest θ std occurs under the conditions of log10 ca 3 59 and 3 07 corresponding to viscous fingering indicating that void filling along the bulk flow direction is dominated in this flow regime for capillary fingering on the other hand due to capillary invasion in any directions controlled by capillarity the invading phase advances in any directions including the transverse and backward directions thus there is no preferential direction for the velocity vectors of the invading phase leading to higher θ std in the capillary dominated flow regime fig 9c since experiments are difficult to measure velocity within each phase but only on the fluid fluid interface chen et al 2017 full information on velocity fields from 3d numerical simulations provides direct evidence that how the role of capillary and viscous forces impacts the void filling during drainage as the viscous force gradually becomes important the void filling is continuously enhanced in the bulk flow direction but suppressed in the transverse or backward directions 4 conclusions we investigate the role of viscous and capillary forces in the drainage processes in a rough fracture by performing 3d direct numerical simulations we validate the simulated results with the experimental observations independently documented in our previous work chen et al 2017 the simulated results can reproduce qualitatively the observed dynamic invasion morphologies at the scale of fracture however we observe that the simulations cannot capture the details of invasion morphologies at the local scale mainly because the coarse mesh size of 200 μm 200 μm adopted in the simulations is much larger than the scale of the interface μm this discrepancy causes the invading fluid saturation to be overestimated and the specific interface area underestimated we further perform quantitative analysis of the dynamics of immiscible displacement showing that haines jump occurs in rough fractures in the capillary dominated flow regime the simulated velocity fields provide direct evidence that as capillary number gradually increases void filling toward the outlet is continuously enhanced with the velocity vector angles of the invading fluid being more probably localized in the zone around the bulk flow direction thus this work improves our understanding on how the interplay of the viscous and capillary forces controls displacements acknowledgments the work is supported by the national natural science foundation of china nos 51779188 51579188 the numerical calculations in this paper have been done on the supercomputing system in the supercomputing center of wuhan university supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 05 016 appendix supplementary materials image application 1 
796,immiscible fluid fluid displacement in rough fractures is important in many subsurface processes including enhanced oil recovery and geological carbon sequestration numerous previous works experimentally investigated the dynamics of multiphase flow in fractures but direct numerical simulation for fluid fluid displacement in 3d rough fractures and the validation with experiments were rarely reported here we perform 3d direct numerical simulations for drainage processes of water displacing oil in a real rough fracture with capillary number log10 ca ranging from 3 to 5 comparison between experiments and simulations shows that the simulated results can generally reproduce the dynamic invasion morphologies at the scale of fracture the discrepancy of the invasion morphologies however is observed at the local scale mainly because the mesh resolution is not small enough compared with the scale of the interface we then perform quantitative analysis of the simulated results to investigate the role of capillary and viscous forces we show that haines jump events in the flow passage of void neck connecting to a wider void occur in the capillary dominated flow regime statistical analysis of the velocity fields under various flow rate conditions shows that as the effect of viscous force becomes more important and eventually dominates that of capillarity void filling toward the outlet is continuously enhanced with the velocity vector angles being more probably localized in the zone around the bulk flow direction the direct evidence provided by the 3d numerical simulations improves our understanding of the competition of viscous and capillary forces controlling the immiscible displacement in rough fractures graphical abstract image graphical abstract we perform 3d direct numerical simulations for the displacement of oil by water in rough fracture the simulated results can generally reproduce the dynamic invasion morphology at the scale of fracture haines jump is observed in the capillary dominated flow regime further quantitative analysis reveals that as the effect of viscous force gradually becomes dominated over that of capillarity void filling toward the outlet is continuously enhanced in rough fracture keywords rough fracture immiscible displacement numerical simulation viscous pressure drop capillary force 1 introduction the flow of immiscible fluids through rock fractures is of great interest to many engineering applications including enhanced oil recovery in fractured reservoirs adibhatla and mohanty 2008 austad et al 2011 bikkina et al 2016 meng et al 2017 zhang et al 2017 geological co2 sequestration de dios et al 2017 ren et al 2017 and environmental contamination by non aqueous phase liquid ji et al 2008 detwiler et al 2009 lee et al 2010 faisal et al 2015 due to their much higher permeability compared with rock matrix preferential flow paths always occur in fractures when immiscible fluids are involved description of such flow behaviors of multiple phases with interfaces is much more complicated in geological co2 sequestration the presence of fractures in sealing formations may pose a threat of upward migration of co2 and brine from deep reservoirs miocic et al 2016 for enhanced oil recovery the non compact fluid fluid displacement during water flooding would significantly reduce the displacement efficiency therefore understanding and controlling the multiphase flow in rock fractures are important for optimizing subsurface fluid management the investigation of immiscible fluid fluid displacements in permeable media can be traced to hele shaw experiment performed over one hundred years ago hele shaw 1898 although it has long been studied characterization of multiphase flow remains a challenging issue due mainly to the complex interplay between the capillary and viscous forces homsy 1987 wong 1994 hu et al 2017b 2018 the pioneering study in 2d porous media provided a basic understanding that displacement patterns vary from capillary to viscous fingering as the role of viscous force becomes more important and eventually dominates that of capillarity lenormand et al 1988 this interplay of capillary and viscous forces impacting displacement patterns was also recognized for rough fractures but the crossover zone from capillary fingering to viscous fingering is much narrower than that in porous media due to the differences in the geometry of void spaces chen et al 2017 the light transmission experiments fourar and bories 1995 persoff and pruess 1995 amundsen et al 1999 babadagli et al 2015a b chen et al 2017 2018 and computed tomography ct experiments bertels et al 2001 karpyn et al 2007 provide evdiences and insights that how fracture wall geometry together with capillary and viscous forces impacts fluid occupancy and invasion morphology during immiscible displacement amundsen et al 1999 neuweiler et al 2004 karpyn et al 2007 babadagli et al 2015b yang et al 2016 the laboratory based ct experiment permits 3d visualization of the phase configuration in fractures but its time resolutions cannot match the actual occurrence of flow events consequently this method can be used only for quasi static conditions rather than dynamic cases bertels et al 2001 karpyn et al 2007 karpyn and piri 2007 unless the synchrotron based x ray ct is employed berg et al 2013 reynolds et al 2017 on the other hand the light transmission experiment can provide real time imaging of fluids displacement processes neuweiler et al 2004 bergslien and fountain 2006 chen et al 2017 but the image of fluid distribution is 2d hence failing to capture the 3d features of the fluid fluid interfaces more importantly since the experimental observations cannot access to the detailed information of flow behaviors including the velocity and pressure fields within the whole domain of fracture space quantitative analysis of fluids displacement only relies on the imaging of dynamic invasion morphology hence lacking a link to the evolutions of velocity and pressure direct numerical simulation permits access to information on interface advancement in three dimensions as well as on the velocity pressure fields linking to dynamic invasion morphology thus improving the understanding of multiphase flow in rough fractures numerical investigation of the immiscible flow has been conducted using pore network models joekar niasar et al 2009 raeesi and piri 2009 yuan et al 2015 computational fluid dynamics ferrari et al 2015 raeini et al 2015 hu et al 2017a lattice boltzmann methods jiang and tsuji 2015 liu et al 2015 and the smooth particle hydrodynamic methods bandara et al 2011 most of these numerical studies focused on multiphase flow in 3d porous media and 2d microfluidics and only a very few of emphases were given to rough fractures amundsen et al 1999 neuweiler et al 2004 yang et al 2012 dou et al 2013 amundsen et al 1999 developed an invasion percolation model for predicting the flow patterns of air displacing water in rough walled plates in the capillary dominated flow regime later on neuweiler et al 2004 verified the invasion percolation model via displacement experiment in a rough fracture and demonstrated the role of the in plane curvature that would stabilize the displacement front glass et al 1998 yang et al 2012 karpyn and piri 2007 extended the invasion percolation model to consider the dynamic effect dou et al 2013 employed the lattice boltzmann method to study the wettability effect on the fluid fluid interface area during immiscible displacement in a 3d self affine rough fracture despite the above efforts direct numerical simulation for fluids displacement in real 3d rough fractures and the corresponding validation by experiments were rarely reported here we perform direct numerical simulation of the full navier stokes equations with the volume of fluid vof method tracking the fluid fluid interface for modeling the two phase flow of water displacing oil in a 3d rough fracture we validate the numerical simulation via experimental results independently documented in our previous study chen et al 2017 with the aim to show that whether the direct numerical simulation can satisfactorily reproduce the fingering flow in rock fractures at various capillary numbers we then perform quantitative analysis on the role of viscous capillary forces in controlling displacement pattern by linking 3d displacement front advancement to the pressure variations and the detailed 3d velocity fields this study not only provides comparisons between experiments and direct numerical simulations for multiphase flow in a rough fracture but also improves our understanding of the effect of the competition between capillary and viscous forces on displacement processes 2 experiments and simulations 2 1 overview of experiments we carried out a series of drainage experiments of water displacing silicone oil in a transparent rough fracture and the details of the experiments were reported in chen et al 2017 the transparent rough fracture is 20 cm in length and 10 cm in width comprised of two resin replicas that were fabricated from a granite fracture we used a high resolution non contact 3d laser scanning method e g chen et al 2015 to measure the topography of the fracture surface fig 1 a with a resolution of 1 μm in the z direction after the scanned data were recorded automatically at every 200 μm interval in both the x and y directions we then reconstructed each square surface 200 μm 200 μm in an anticlockwise order and finally obtained the 3d surface of the full range of the rough fracture as shown in fig 1a the light transmission technique detwiler et al 1999 was employed to measure the aperture field of the duplicated fracture fig 1b with its mean being b 0 660 mm and the standard deviation being σ b 0 123 mm the static contact angle of water is θ 134 4 we first fully saturated the fracture with silicone oil and then dyed water was injected via an isco pump into the fracture to displace oil at constant flow rates the water invasion morphology during the drainage processes in the entire fracture was recorded at 10 frames s with a ccd camera until the invading fluid reached the outlet of the fracture experimental results with flow rates q 0 3 1 10 30 and 100 ml min and viscosity ratio μ μ i μ d 1 100 μ i and μ d are respectively the viscosity of the invading and defending fluids were adopted for comparison as reported in chen et al 2017 independent experiments were conducted and showed good reproducibility of the experimental observations we use the classic macroscopic capillary number ca μ i v i σ to represent the relative effect of viscous force to capillary force where σ is the interfacial tension σ 35 0 mn m peters and arabali 2013 and v i q a c a c is the cross sectional area of the inlet a c 23 2 mm2 the capillary number ca in the experiments spans three orders of magnitude log10 ca 5 59 5 07 4 07 3 59 and 3 07 the corresponding displacement patterns include both capillary and viscous fingerings 2 2 direct numerical simulation the water invasion processes in rough fractures can be described by the navier stokes equations eqs 1 and 2 together with the volume of fluid method vof that tracks the evolution of fluid fluid interface eq 3 1 ρ α u t ρ α uu p μ α u t u f s 2 u 0 3 α t α u α 1 α u r 0 where u is the fluid velocity p is the pressure μ is the viscosity and u r is an artificial compression velocity to limit numerical diffusion rusche 2003 greenshields 2015 the variable α represents the volume fraction of fluid within cells i e α 0 for non wetting phase α 1 for wetting phase and 0 α 1 for the fluid fluid interface consequently the density ρ α and the viscosity μ α can be written as ρ α ρ w α ρ nw 1 α and μ α μ w α μ nw 1 α respectively where the subscripts w and nw denote the wetting and non wetting phases respectively f s represents the contribution of momentum from the surface tension at the fluid fluid interface expressed as ferrari and lunati 2013 4 f s σ α α α we employ the multiphase flow solver interfoam included in the open source library openfoam greenshields 2015 to directly solve the governing equations eqs 1 3 for the drainage processes in the 3d rough fracture in simulations the initial time step is set as 2 0 10 5 s with automatic adjustment based on the courant friedrichs lewy cfl number the maximum courant number and the maximum alpha courant number are both set as 1 0 the wettability effect on the immiscible displacement is considered by imposing an additional constraint on α at the intersection between the fluid fluid interface and solid surface e g ferrari and lunati 2013 5 α α x wall n n s cos θ n t sin θ where n s is the unit normal pointing into the solid and n t is the unit tangent to solid points into the wetting phase comparing with other numerical methods for multiphase flow relatively few model parameters are required for the method of direct solutions of navier stokes equations we set up a 3d computational model of the 200 mm 100 mm rough fracture fig 1a the grid sizes in the x and y directions are the same as the resolutions provided by the non contact 3d laser scanning method e g chen et al 2015 with δx 200 μm and δy 200 μm four layers of grids are specified in the z direction fig 1a given the variation of aperture in the range of 0 28 mm b x y 1 26 mm the grid size in the z direction δz ranges from 70 μm to 315 μm the computational model is then comprised of 2 500 000 points and 1 994 004 hexahedral cells we used 72 processors to perform parallel computing in the supercomputing center of wuhan university for the invasion processes with q 0 3 1 10 30 and 100 ml min and m 1 100 the density and viscosity of the nonwetting invading and wetting defending fluids in simulations are μ nw 1 10 3 pa s μ w 0 1 pa s ρ nw 998 0 kg m3 and ρ w 960 0 kg m3 the values of the interface tension σ and the contact angle θ are also directly taken from the experiments for the boundary conditions the inlet is prescribed with constant velocity of v i q a c fig 1a zero gradient of pressure p x 0 and constant α value α 1 and the outlet is fixed with zero gradient of velocity ux x uy y uz z 0 constant zero pressure p 0 and zero gradient of α α 0 we also conduct mesh sensitive analysis for the drainage simulations in a subdomain of the rough fracture with four eight and twelve layers of grids in the z direction whereas the size of grids in the x and y directions are all set as 200 μm as shown in fig s2 s3 and table s1 in appendix a comparison of numerical results of different mesh sizes indicates that the mesh size used in our simulation is small enough to obtain reasonable results 3 results and discussion 3 1 comparison between experiments and simulations the comparison of invasion morphologies between experiments and simulations is presented in figs 2 and 3 the experimental numerical conditions are plotted in the phase diagram in the log10 m log10 ca plane fig s1 in appendix a showing that the corresponding pattern formation shifts from capillary fingering to viscous fingering as the capillary number varies from log10 ca 5 to log10 ca 3 chen et al 2017 2018 fig 2 compares the experimentally observed and numerically simulated invasion morphologies at the same locations of displacement front tip x tip for log10 ca 5 59 the displacement is controlled by capillarity characterized by capillary fingering at the beginning of water flooding since the aperture field is relatively uniform x 20 mm fig 1b water invades into fracture with a uniform front within this fracture space and later a finger forms and develops due to the heterogeneity of the aperture field fig 2a f at higher ca log10 ca 3 59 unlike the invasion processes in the capillary dominated flow regime multiple water fingers progressing toward the outlet are observed even at the inlet of the fracture with a relatively uniform aperture as shown in fig 2d f and j l these main features of the dynamic invasion morphologies observed in experiments for low and high capillary numbers can both be reproduced by the 3d direct numerical simulations fig 3 presents the observed and simulated water distributions at the time of breakthrough for various capillary numbers again we observe one water finger in the case of small ca fig 3g and i and multiple water fingers for large ca fig 3a and c demonstrating the transition of flow regime from capillary invasion to viscous fingering the 3d direct numerical simulations are generally consistent with the observations more importantly we can observe through simulations the interface in the third dimension convex to the oil phase fig 3h 1 and h 2 which cannot be captured by the imaging system however comparisons of the shapes of fingerings at the fracture scale show that wider fingers are obtained in numerical simulations especially for relatively larger ca compare fig 3c and d fig 3e and f for relatively smaller ca fig 3g j inspection of the fluid fluid interface at the local scale fig 3g and h indicates that the simulated interface is much smoother than the observed one the simulated wider fingers would cause the water saturation s w to be overestimated and the simulated smoother interface causes the fluid fluid interface area to be underestimated from fig 4 the measured water saturations are s w exp 0 413 0 361 0 189 0 209 and 0 260 for log10 ca 5 59 5 07 4 07 3 59 and 3 07 respectively the simulated results are s w sim 0 445 0 428 0 363 0 340 and 0 320 respectively larger than the measurements with the relative error s w sim s w exp s w exp 7 7 18 4 92 0 63 2 and 22 7 the maximum relative error occurs at the capillary number of log10 ca 4 07 corresponding to the crossover from capillary to viscous fingering given that the images recorded during experiments are two dimensional we can only determine the length of fluid fluid interface in the x y plane l nw to provide a direct comparison of fluid fluid interfaces between experiments and simulations we also determine the length of fluid fluid interfaces l nw in the x y plane we first determine the 3d curve i e the intersections of the simulated 3d fluid fluid interfaces and the mid plane in the z direction and then project the 3d curve to the x y plane whose length is the simulated l nw fig 4 shows the variation of the specific fluid fluid interface length l nw with ca where l nw l nw w w is the width of the fracture it can be concluded from fig 4 that l nw increases with ca in the range of log10 ca 5 07 from the dynamics of multiphase flow as ca gradually increases the break up events of the invading fluid gradually become a dominating mechanism for the interface morphology leading to the increase of l nw for larger ca ng and payatakes 1980 wardlaw and mckellar 1985 pak et al 2015 this trend of the variation in l nw with ca is captured by numerical simulations moreover for all capillary numbers except the condition of the largest ca l nw is underestimated with its relative error l nw sim l nw exp l nw exp varying from 25 9 to 53 9 this is because as noted earlier the tracked fluid fluid interface in simulation is smoother than the observed one but at the largest flow rate due to the larger number of water clusters reproduced by simulation the simulated interface length is larger than the measurement as discussed above the discrepancies in invasion morphology between experiments and simulations lead to the overestimated s w and underestimated a nw the discrepancies are mainly attributed to the difference of fracture space geometry at the scale of μm in simulations to limit the numerical diffusion of α eq 3 and track the interface accurately the mesh size should be smaller than the scale of the interface greenshields 2015 however as shown in fig 3g the mesh size used in the numerical simulations that provided by the non contact 3d laser scanning method is 200 μm 200 μm in the x and y directions and this resolution is not fine enough to capture the observed fluid fluid interface at the scale of μm fig 3g for the grid size in the z direction mesh sensitive analysis shown in figs s2 and s3 and table s1 in appendix a shows that there is no significant difference of fluid fluid interface at the small scale even twelve layers of grids are specified indicating the insensitive effect of grids size in the z direction on invasion morphology therefore the numerical simulation can roughly reproduce the invasion morphology at the scale of fracture but the information at the local scale is not well resolved due to the relatively low resolutions of the laser scanning technology in the x and y directions 3 2 quantitative analysis the previous section shows that the 3d numerical simulations generally reproduce the invasion morphology observed in the laboratory given that the simulations can also access to the information on the fields of pressure and velocity that cannot be recorded in experiments it enables us to further investigate the role of viscous and capillary forces in drainage processes in the rough fracture here we present the evolution of the area weighted average pressure drop δp t normalized by the drop at the beginning of water flooding δp 0 i e δp t 0 with the interface advancement as shown in fig 5a since the pressure p at the outlet is 0 the pressure drop δp can be calculated as ferrari and lunati 2013 basirat et al 2017 6 δ p 1 a c a int p d s where a int denotes the inlet boundary and a c is the area of the inlet we observe from fig 5 a that at slow flow rates log10 ca 5 59 and 5 07 the normalized pressure drop δp δp 0 increases at the initial stage of flooding and then decreases accompanied by unsteady fluctuations the fluctuations are attributed to haines jumps haines 1930 berg et al 2013 when water invades into a converging flow passage from t 1 to t 2 selected region c in fig 5b with the aperture decreasing from 0 67 mm to 0 53 mm fig 5c 2 pressure drop increases and a burst of interface occurs once the pressure drop exceeds the capillary entry pressure at the neck of the flow passage this increase in pressure drop from t 1 to t 2 is shown in fig 5a where the interface at t 2 corresponds to the peak of δp δp 0 after t 2 as the flow passage becomes wider with aperture increasing from 0 53 at t 2 to 0 60 mm at t 3 fig 5c 2 a significant drop of δp δp 0 is then observed in fig 5a note that the curvature in the fracture plane x y plane is much smaller than that in the x z plane hence we neglect the contribution of capillary pressure from the x z plane fig 5c 1 this pressure burst is associated with the local velocity jump from fig 5c 1 and c 2 the velocity of the displacement tip v tip from t 1 to t 3 is obtained as v tip 4 5 10 4 m s five times larger in magnitude than the velocity at the inlet 9 1 10 5 m s which results in rapid motion of the invading fluid and dissipates a large proportion of the total work of drainage ferrari and lunati 2014 this local velocity jump also highlights the significance of inertial effects in drainage which has been investigated extensively in porous media moebius and or 2012 armstrong and berg 2013 kazemifar et al 2016 fig 5a also shows that the evolution of the normalized pressure drop δp δp 0 at high flow rates log10 ca 4 07 3 59 and 3 07 steadily decreases during the whole drainage processes this is because the continuously injected water phase with lower viscosity reduces the overall viscous dissipation in the rough fracture as supported by other numerical and experimental results ferrari and lunati 2013 zhao et al 2016 as shown in fig 6 a multiple fingers form and develop in the viscous dominated flow regime to investigate the propagation of a specific finger we present the evolution of the average pressure drop δp avg that represents the difference between the intrinsic phase average of the non wetting and wetting pressures defined by 7 δ p avg ω p 1 α d ω ω 1 α d ω ω p α d ω ω α d ω where ω represents the region of the box labeled with c in fig 6a fig 6 presents the evolution of displacement front and the average pressure drop δp avg when 0 01 pv of water is injected from t 1 to t 3 although the aperture decreases from 0 73 mm at t 1 to 0 56 mm at t 3 fig 6c 2 the average pressure drop δp avg steadily decreases instead of increases as observed in the capillary dominated flow regime as shown in fig 6b indicating that the capillary force from the curvature interface has a very little contribution to the normalized pressure drop to further gain insights into the role of capillary and viscous forces in the immiscible displacements in the rough fracture we perform quantitative analysis of the simulated velocity fields at the breakthrough time figs 7 a and 8 a present the distributions of velocity magnitude and streamlines at two representative flow rates of 0 3 ml min log10 ca 5 59 and 100 ml min log10 ca 3 07 both in capillary fingering log10 ca 5 59 and in viscous fingering log10 ca 3 07 we observe that the preferential flow paths or fingerings are characterized by larger velocity magnitude whereas the regions with smaller velocity magnitude exist in the unswept zone at log10 ca 5 59 inspection of selected regions b and d in fig 7a shows that there exist multiple circulations occurring near the fluid fluid interface fig 7b d in which the directions of the flow pathways are independent of the bulk flow direction denoted by the arrow experimental and numerical studies show that the circulations would be induced by the roughness of rock fractures lee et al 2015 zou et al 2015 on the other hand previous investigations also show that the circulations may be caused by spurious velocity due to numerical error in the capillary dominated flow regime deshpande et al 2012 raeini et al 2012 to identify the reason for the circulations occurring in the rough fracture we performed a controlled trial of simulation in a hele shaw cell whose gap is 0 66 mm the same as the mean aperture of the rough fracture as shown in fig s5 in appendix a the capillary number is set as log10 ca 5 59 also the same as that in the rough fracture shown in fig 7 from the theory of immiscible displacement in hele shaw cell with smooth walls there are no circulations near the fluid fluid interface paterson 1981 homsy 1987 park and homsy 2006 however as presented in fig s5 the circulations near the fluid fluid interface area are obtained in simulations which is against the classic theory of two phase flow therefore we can conclude that the circulations in the rough fracture are attributed to spurious velocity from fig s4 in appendix a the occurrence of spurious velocity in the subdomain fracture with 8 and 12 layers of grids in the z direction demonstrates that the numerical error spurious velocity is insensitive to grid size consistent with the previous investigation deshpande et al 2012 the numerical error is due to inaccurate interface curvature and inaccurate balance of discrete forces in the widely used interface tracking methodologies including volume of fluid method and level set method deshpande et al 2012 roman et al 2015 this inaccuracy is amplified in the capillary dominated flow regime resulting in larger magnitude of these spurious velocities than real physical velocities near the fluid fluid interface fig 7 this issue remains challenging in numerical tracking of interface even though filtering techniques were suggested to suppress the spurious velocities raeini et al 2012 for the viscous dominated flow regime that corresponds to viscous fingering fig 8 inspection of the enlarged regions in the invading phase fig 8c the defending phase fig 8e and near the fluid fluid interfaces fig 8b and d shows that no circulation is observed under such high flow rate log10 ca 3 07 with the local flow pathways consistently along the bulk flow direction denoted by the arrow in fig 8b e thus the numerical error becomes negligible at higher flow rates the local flow pathways presented in fig 7b e for capillary fingering and in fig 8b e for viscous fingering affect the distribution of void filling direction at the scale of fracture fig 9 a presents the relative frequencies of the velocity vector angle of the invading fluid with respect to the bulk flow direction θ from fig 9b the average values of θ are θ avg 9 1 7 4 2 5 2 9 and 1 1 for log10 ca 5 59 5 07 4 07 3 59 and 3 07 respectively indicating no significant difference for various ca this is not surprising from the symmetric relative frequency curves with respect to θ 0 however for the standard deviation of θ θ std dramatically decreases with ca and the values for log10 ca 5 59 5 07 4 07 3 59 and 3 07 are respectively θ std 112 2 97 1 37 2 33 5 and 23 4 fig 9c a smaller θ std indicates more probable values of θ in the zone around θ 0 and hence more frequent void filling events along the bulk flow direction from the phase diagram shown in fig s1 in appendix a the smallest θ std occurs under the conditions of log10 ca 3 59 and 3 07 corresponding to viscous fingering indicating that void filling along the bulk flow direction is dominated in this flow regime for capillary fingering on the other hand due to capillary invasion in any directions controlled by capillarity the invading phase advances in any directions including the transverse and backward directions thus there is no preferential direction for the velocity vectors of the invading phase leading to higher θ std in the capillary dominated flow regime fig 9c since experiments are difficult to measure velocity within each phase but only on the fluid fluid interface chen et al 2017 full information on velocity fields from 3d numerical simulations provides direct evidence that how the role of capillary and viscous forces impacts the void filling during drainage as the viscous force gradually becomes important the void filling is continuously enhanced in the bulk flow direction but suppressed in the transverse or backward directions 4 conclusions we investigate the role of viscous and capillary forces in the drainage processes in a rough fracture by performing 3d direct numerical simulations we validate the simulated results with the experimental observations independently documented in our previous work chen et al 2017 the simulated results can reproduce qualitatively the observed dynamic invasion morphologies at the scale of fracture however we observe that the simulations cannot capture the details of invasion morphologies at the local scale mainly because the coarse mesh size of 200 μm 200 μm adopted in the simulations is much larger than the scale of the interface μm this discrepancy causes the invading fluid saturation to be overestimated and the specific interface area underestimated we further perform quantitative analysis of the dynamics of immiscible displacement showing that haines jump occurs in rough fractures in the capillary dominated flow regime the simulated velocity fields provide direct evidence that as capillary number gradually increases void filling toward the outlet is continuously enhanced with the velocity vector angles of the invading fluid being more probably localized in the zone around the bulk flow direction thus this work improves our understanding on how the interplay of the viscous and capillary forces controls displacements acknowledgments the work is supported by the national natural science foundation of china nos 51779188 51579188 the numerical calculations in this paper have been done on the supercomputing system in the supercomputing center of wuhan university supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 05 016 appendix supplementary materials image application 1 
797,a simple local two relaxation time lattice boltzmann numerical formulation trt emm of the extended method of moments emm is proposed for analysis of the spatial and temporal taylor dispersion in d dimensional streamwise periodic stationary mesoscopic velocity field resolved in a piecewise continuous porous media the method provides an effective diffusivity dispersion skewness and kurtosis of the mean concentration profile and residence time distribution the trt emm solves a chain of steady state heterogeneous advection diffusion equations with the pre computed space variable mass source and automatically undergoes diffusion flux jump on the abrupt porosity streamwise normal interface the temporal and spatial systems of moments are computed within the same run the symmetric dispersion tensor can be restored from independent computations performed for each periodic mean velocity axis the numerical algorithm recursively extends for any order moment we derive an exact form of the bulk equation and implicit closure relations construct symbolic trt emm solutions and determine specific relation between the equilibrium and the collision degrees of freedom viewing an exact parameterization by the physical non dimensional numbers in two alternate situations parallel fracture matrix flow and perpendicular darcy flow through porous blocks in series two dimensional simulations in linear brinkman flow around solid and through porous obstacles validate the method in comparison with the two heterogeneous direct lbm ade schemes with different anti numerical diffusion treatment which are proposed and examined in parallel on the coarse grid accuracy of the three moments is essentially determined by the free tunable collision rate in all schemes and especially trt emm however operated within a single periodic cell the trt emm is many orders of magnitude faster than the direct solvers numerical diffusion free more robust and much more capable for accuracy improving high péclet range and free parameter influence reduction with the mesh refinement the method is an efficient predicting tool for the taylor dispersion asymmetry and peakedness moreover it allows for an optimal analysis between the mutual effect of the flow regime péclet number porosity permeability and obstruction geometry keywords taylor dispersion skewness kurtosis spatial and temporal moments residence time distribution extended method of moments lattice boltzmann ade schemes interface jump numerical diffusion stokes brinkman darcy porous flow 1 introduction understanding of the structure and velocity influence on the mass transport prediction and optimization of the taylor and environmental dispersion elongated tails of the averaged upscaled solute distributions and their time rate the residence time distribution rtd is a task required in many engineering fields such as chemical polymer petrol agricultural ecological risk assessment and restoration wastewater treatment we propose a simple numerical method for prediction of the first four moments of the solute distribution from the steady state velocity field established in the streamwise periodic representative unit cell especially we keep in mind a direct application in x ray micro tomography images of the double porosity media like the carbonates where the proposed method allows for the rock identification and classification with respect to the dispersion and non gaussian properties of the breakthrough curves within the dispersion theory established in fundamental works by taylor 1953 aris 1956 and brenner 1980 the gaussian description applies to upscaled distributions with the longitudinal taylor dispersion correction aris 1956 taylor 1953 to molecular diffusion coefficient hereafter dt and d 0 respectively or more generally full dispersion tensor brenner 1980 due to the multi dimensional gradients in velocity field the classical approach is focused on the spatial solute evolution after an instantaneous point release when the distribution moments are computed via the spatial integration the rtd introduced by danckwerts 1953 is commonly monitored in the outlet of the chemical device cozewith and squire 2000 vegetation zone for pollutant remediation werner and kadlec 2000 or micro channel cantu perez et al 2008 and it can be characterized through the temporal moments integrated in time vikhansky 2011 the taylor regime is respectively characterized by a time and space linear growing of the variance like σ 2 2 d 0 d t t at a dimensionless time t t u 0 l pe or σ 2 2 u 0 3 d 0 d t x at a dimensionless distance x x l pe hereafter pe u 0 l d 0 is the characteristic péclet number however many natural systems exhibit asymmetry peakedness and heavy tails a long time or distance after release so far the taylor dispersion theory fails to explain the non fickian behavior of the molecular propagators in heterogeneous porous beds berkowitz et al 2008 bijeljic et al 2011 successfully reproduced by the numerical simulations in double porosity carbonates bijeljic et al 2013 yang et al 2013 recent studies suggest that considering the vegetation as a porous zone offers a promising prediction of the pollutant retention rtd observed in the experimental vegetated channels and pond systems see review golzar 2015 the open question lies in the optimal design su et al 2009 of the remediation zones through their permeability resistance porosity and geometric obstruction the high order moments quantify the deviations from the normal distribution the skewness sk third order moment and kurtosis ku fourth order moment are responsible for the asymmetry and peakedness respectively let us assume that a continuous velocity field u ϕ r is resolved in a heterogeneous piece wise continuous porosity distribution ϕ r we keep in mind a sketch in fig 1 a complete evolution history needs to solve the d dimensional advection diffusion equation ade for the continuous concentration c r t 1 t ϕ c u ϕ c ϕ d 0 c u ϕ 0 r v ϕ the taylor dispersion coefficient dt is the same in the two systems of moments spatial ϕ 1 x n c ϕ and temporal t n p x t d t p x t t c x t the brackets denote averaging over the fluid part of a single periodic cell vϕ v in fig 1 however the higher order moments differ in the two systems their computation requires specific initial boundary set up with the direct ade solvers of eq 1 and leads to a tedious numerical task combining the highly discontinuous diffusion coefficients in complex interface boundary geometry with the high péclet numbers in a periodic arrangement the solute evolution is run through a long series of duplicated cells v in fig 1 since their number increases with pe the computational time to the taylor regime grows as pe2 at least the brenner s b method of moments brenner 1980 circumvents the problem it restores the symmetric dispersion tensor d d d d 0 v ϕ b r t b r independently solving d steady state advection diffusion equations for space periodic vector variable b d inside a single cell the finite difference scheme salles et al 1993 validated the b method in microscopic three dimensional stokes flow through the regular fractal random and reconstructed porous media a similar dispersion boundary value problem was recently parameterized valdés parada et al 2016 with the reynolds number in slow inertial flow through an uniform soil porosity the extended method of moments emm extends the dispersion procedure to heterogeneous soil and any order spatial or temporal moments originated from the ideas vikhansky 2008 and substantial developments vikhansky and ginzburg 2014 the emm is elaborated ginzburg and vikhansky 2018 in the form of the recursive algorithm for prediction of i effective diffusion structure coefficient ii taylor dispersion dyadic and iii longitudinal coefficients of the high order moments differently from the brenner s averaging of the brownian particles moments or the volume averaging approach valdés parada et al 2016 the emm searches for the solution of eq 1 in the form of a product of the low frequency slow monochromatic wave and a streamwise periodic say along the x axis oscillating scalar field b ω γ r 2 c r t 1 2 π b ω γ r exp i γ x ω t a simultaneous perturbative expansion is performed either for b ω γ r and temporal frequency ω γ or for b γ ω r and wavenumber γ ω the mathematical algorithms based upon are referred to as ω form and γ form respectively 3a ω form b ω γ r n 0 b n r i γ n ω γ i n 1 ω n i γ n 3b γ form b ω γ r n 0 b n r i ω n γ ω i n 1 γ n i ω n in both formulations the b field variable b n r solves a chain of steady state ade with the recursively built mass sources the two sets ωn and γn are determined explicitly from the global mass conservation solvability condition they sequentially determine the dispersion skewness and kurtosis n 2 3 4 respectively in spatial and temporal respectively system of moments the solution procedure straight forwardly extends to any higher order moment since the coefficients of the two expansions are inter related through simple algebraic formulae the two sets of moments become determined within the same solution path in a streamwise uniform duct flow the emm moments correspond ginzburg and vikhansky 2018 to the upscaled mean concentration solution obeying the high order pde mercer and roberts 1990 ngo cong et al 2015 without need to resorting for its solving the emm allows for the symbolic moments prediction in continuous parameter space so far the taylor dispersion skewness and kurtosis were exemplified ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 in i parabolic poiseuille profile in a channel and cylindrical capillary ii non newtonian power law flow in a capillary iii shallow profile through different cross section shapes iv darcy brinkman flow in stratified fracture matrix layers and v a perpendicular darcy flow through porous blocks these solutions allow to estimate the role of the porosity contrast and geometry aspect in the first four moments also providing their asymptotic pe scaling the reference emm solutions give the valuable benchmarks for direct solvers of eq 1 and numerical emm formulations furthermore applying the emm decomposition to the effective fourth order accurate mass conservation equation of a numerical scheme the truncation interference with the physical moments may become quantified quasi exactly in simple flow ginzburg 2017b the emm copes with the stationary exact numerical or approximate incompressible velocity field of any nature a periodic mesoscopic velocity field in porous beds and random structures e g computed with the two relaxation times trt lattice boltzmann lbm flow schemes in newtonian flow ginzburg et al 2015b khirevich et al 2014 talon et al 2012 vogel et al 2015 non newtonian fluids talon and bauer 2013 or darcy flow in space distributed permeability röding et al 2016 is a natural input for emm numerical computations another promising application is the shallow flow within the rigid or flexible vegetation interactions buxton 2018 gac 2014 yang et al 2017 very different numerical approaches apply for the effective diffusivity of the composite or porous structure e g monte carlo simulations trinh et al 2000 numerical integration by random walks bolle et al 2000 finite element kim et al 1987 but also the direct solver ginzburg 2005a 2007 trt ade e g in regular arrays chai et al 2016a unsaturated genty and pot 2014 and saturated genty et al 2017 porous media or porous polymer films gebäck et al 2015 the emm provides not only the effective diffusivity but also the associated high order structure moments at zero velocity unit cell simulations in the ω form our purpose is to propose a operationally simple numerical emm algorithm and to verify the emm with its help in multi dimensional heterogeneous stokes brinkman darcy velocity field we propose trt emm formulation based on the trt ade model for heterogeneous soil vikhansky and ginzburg 2014 a subtle point is that the diffusive flux ϕ d 0 b n r should undergo the prescribed jump values on the streamline normal interfaces when ϕ r becomes discontinuous the trt emm benefits from main lbm advantages it locally prescribes the discontinuous diffusion values ϕ d 0 r via one of its two relaxation rates and couples the diffusive flux jump vector with the advective velocity in local equilibrium distribution the total advection diffusive flux then automatically obeys the interfacial and solid surface flux jump conditions using the mass conserving bounce back reflection on an impenetrable boundary it should be recognized that such an implicit interface tracking shares the bounce back deficiency concerning the inexact location of the closure continuity condition ginzburg 2007 2016 ginzburg et al 2015b an alternative second order accurate scheme guo et al 2015 has been recently introduced for location of the concentration and flux jumps on the arbitrarily placed straight and curved surface we will restrict ourselves to stair case midgrid wall description and examine the difference between the fully implicit node jump tracking and semi explicit link jump tracking only in pure diffusion through porous blocks analytically the trt emm assessment is performed by extending the exact taylor type analysis of the implicit closure relations and the symbolic solution construction ginzburg 2007 2016 ginzburg et al 2015b from the streamline invariant diffusion type interface problem to the darcy advection through a streamline heterogeneity in a series of porous blocks a special attention is put on the consistent parameterization of the trt emm solutions with the dimensionless governing numbers in the presence of a space variable mass source a decisive role of the free tunable equilibrium and collision degrees of freedom will be demonstrated in dispersion skewness and kurtosis this symbolic analysis is not restricted to trt emm and concerns any lbm ade steady problem the trt emm is applied in both ω form and γ form with the purpose to validate the equivalence of their moments solution and to examine their respective robustness it was predicted ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 that the interface flux jumps and the associated mass source terms become negligible when the moments grow with pe this property would further simplify the method we will evaluate all these features in creeping brinkman 1947 flow through a zigzag type solid and porous arrangements inspired from the micro channel design vikhansky 2011 and similar to one depicted in fig 1 the flow is solved with the local interface implicit resistance force based improved ibf scheme ginzburg et al 2015b the partial bounce back gray link based lbm brinkman models see review zhu and ma 2009 and the local bf ibf approaches are inter related with the help of the trt collision operator ginzburg 2016 ginzburg et al 2015b the advanced boundary treatment is developed in work silva et al 2017 the two dimensional simulations will illustrate the emm ability for device optimization through reduction of the taylor dispersion porosity and péclet number effect in moments once the moments are predicted the profiles can be restored from them with the entropy maximization procedure ginzburg 2017b vikhansky and ginzburg 2014 based on the idea bandyopadhyay et al 2004 in principle at least the larger is the set of the predicted moments the better is the reconstruction and the shorter is the time and length where it becomes valid the predicted moments and reconstructed profiles will be compared with their spatial and temporal counterparts by solving eq 1 directly the optimal in stability trt ade scheme ginzburg et al 2010 has been recently applied for uniform porosity dispersion coefficient measurement in herschel bulkley non newtonian profile batôt et al 2016 and duct flow ginzburg and roux 2015 yan et al 2017 reactive transport and bacterial chemotaxis yan et al 2017 see ginzburg and roux 2015 for earlier dispersion lbm the pore scale breakthrough curves simulations yan et al 2017 in a randomly packed bed column confirm the trt ade reliability in comparison with much more complicated lbm and alternative solution methods yang et al 2016 the lbm ade unlaboredly extends for non linear mass transport chai et al 2016b ginzburg 2006 hammou et al 2011 servan camas and tsai 2010 there exist several lbm approaches for mass transfer in space discontinuous porosity similarly as in mesoscopic flow the interface implicit schemes with the space variable collision rates run uniformly through the whole domain wassén et al 2014 the trt ade linear heterogeneous scheme for eq 1 was first employed for emm validation vikhansky and ginzburg 2014 in stratified flows where it confirmed the predicted deviations from the gaussian solution in moments and reconstructed shapes the trt ade is supported by the fourth order accurate truncation analysis and stability bounds in stratified darcy law vikhansky and ginzburg 2014 numerical dispersion skewness and kurtosis truncation estimates ginzburg 2017b in straight and radial poiseuille flow in alternative heterogeneous approach zhang et al 2016 the single relaxation time srt collision which is a particular trt subclass where the two relaxation rates are the same operates with the uniform rate and incorporates heterogeneity with the semi explicit partial bounce back mechanism the srt approach perko and patel 2014 couples the advective and diffusive non equilibrium fluxes through an equilibrium in uniform soil the trt overcomes srt for stable velocity range due to the optimized dependency between its free tunable rate and diffusion coefficient ginzburg 2012 ginzburg et al 2010 kuzmin et al 2011a the respective stability and accuracy of the different heterogeneous approaches has been not evaluated yet the trt ade and trt emm are very similar but while there is no specific sources and flux jumps in trt ade the trt emm does not need any anti numerical diffusion corrections required in transition and it can be accelerated for steady state the present works first compares the two approaches for the first four moments in a perpendicular flow configuration this study reveals that unlike in a parallel flow the trt ade modifies the constant advection velocity due to the heterogeneity in its anti numerical diffusion equilibrium correction it has been already recognized that the discontinuity of the concentration equilibrium weights results in discontinuous solute solution and different interface explicit strategies have been attempted for a remedy ginzburg 2006 ginzburg and d humières 2007 yoshida et al 2014 in this work an alternative anti numerical diffusion implicit mrt r approach ginzburg 2013 based on the idea of the non diagonal multiple relaxation times matrix collision rasin et al 2005 yoshida and nagaoka 2010 will be extended from the homogeneous to heterogeneous soil in contrast with the trt ade the mrt r copes with the continuous equilibrium and is able to remove the off diagonal numerical diffusion on the coordinate discrete velocity stencil on top of the accuracy study we support all schemes with the velocity bound estimates and evaluate their efficiency for pe range finally although all presented schemes may apply the full diagonal velocity sets like d2q9 d3q15 or d3q19 we limit this work to the minimal schemes ddq 2d 1 first because they are sufficient for trt emm in isotropic diffusion second because the numerical dispersion skewness and kurtosis are influenced by the diagonal weight stencil in direct solvers ginzburg 2017b third because the bounce back mass conserving no flux rule copes best with the coordinate stencil on the mesh aligned solid surface in fact the bounce back creates a spurious restriction of the tangential flux via the surface inclined velocity links their accommodation layers modify the effective velocity molecular diffusion and dispersion coefficients even in a straight channel ginzburg 2017a ginzburg et al 2015a the rest of the paper is organized as follows section 2 discuses the computation of moments and introduces the direct solvers lbm ade section 3 summarizes the emm and introduces its numerical formulation trt emm section 4 derives and analyses effective bulk equation and steady state trt emm interface conditions section 5 constructs apparent trt emm moments solution for blocks in series and compares the trt emm and lbm ade section 6 examines the trt emm symbolic solutions in channels poiseuille flow in section 6 1 a fracture matrix stratified bounded system in section 6 2 and two layered double periodic brinkman flow in section 6 3 section 7 compares the trt emm and lbm ade moments in heterogeneous flow around solid and through porous obstacles section 8 concludes the paper appendix a provides the mass source in ω form and γ form appendix b resumes the reference diffusion solution in series and formulates its semi explicit interface jump tracking sections 2 1 2 2 3 and 7 2 are self consistent for the trt emm implementation which is resumed in the algorithmic form in appendix a 4 2 a direct solving of the advection diffusion equation ade we introduce dimensionless transport coefficients in section 2 1 the trt framework in section 2 2 and the direct lbm ade solvers in section 2 3 2 1 the spatial and temporal moments in taylor regime consider a single cell volume v r in d dimensional periodic porous space let vϕ v be a set of penetrable volumes with smooth porosity distributions ϕ r inside vϕ where concentration distribution obeys eq 1 ϕ r is discontinuous on the penetrable interface aϕ between vϕ and its neighbours and on the solid surface as vϕ see fig 1 let ψ v ϕ v ϕ ψ d v denote the volume integration over a single cell in the frame of the classical aris 1956 taylor 1953 and generalized brenner 1980 dispersion theory extended to heterogeneous soil the cell averaged mean concentration c obeys the upscaled ade in the developed taylor regime 4 t c u c d c c c ϕ ϕ u u ϕ ϕ the averaged interstitial seepage velocity u is constant and it is argued brenner 1980 ginzburg and vikhansky 2018 that eq 4 copes with the symmetric constant dispersion tensor d we assume that ϕ r and u ϕ r are periodic over v at least for one of the coordinate axes say the x axis hereafter referred to as a streamwise direction molecular diffusion tensor in eq 1 is set isotropic d 0 d 0 i we aim to determine the longitudinal transport coefficients in spatial and temporal systems of moments the spatial dispersion characterizes the evolution of the point source c r t 0 δ x x 0 δ t through the spatial moments nth order raw moments μ n t x x 0 n c x t d x are measured for n 0 their central counterparts μ n t are built from them for n 2 with the centroid μ 1 t hereafter μn t are normalized with the zero moment μ 0 t the péclet number pe is measured with the characteristic seepage velocity u 0 and length l pe u 0 l d 0 at a long enough time after release t pe l u 0 the first four moments determine respectively the mean seepage velocity component u x longitudinal dispersion coefficient d skewness sk t and kurtosis ku t of the averaged distribution c x t 5 u x μ 1 t t d μ 2 t 2 t d d e f f d t d t k t d 0 sk t sk s t 1 2 μ 3 t μ 2 t 3 2 ku t ku s t 1 μ 4 t μ 2 t 2 3 the effective diffusion coefficient d e f f is measured at zero velocity the taylor dispersion coefficient dt becomes apparent in motion because of the solute gradients due to the structure heterogeneity or the transverse velocity gradient the variance central second moment μ 2 t grows linearly with time and the dispersion coefficient d sums d e f f and dt the higher order moments skewness sk t and kurtosis ku t characterize the distribution asymmetry and peakedness respectively and tend to zero as time increases as t 1 2 and t 1 an exact gaussian solution of eq 4 gives sk s ku s 0 however the high order averaging of eq 1 gives them non zero solution in the simplest configurations like the poiseuille duct flow or a constant parallel or perpendicular darcy flow through heterogeneous blocks ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 the temporal dispersion is quantified through the temporal moments of the residence time distribution rtd due to danckwerts 1953 the rtd p x t t c x t is monitored at a signed distance x from the inlet e g vikhansky 2011 the dimensionless distance x l to the taylor regime grows in proportion with pe the central moments μ n x 0 t t x n p x t d t are accumulated in time they are restored from the raw moments with the centroid t x μ 1 x 1 μ 0 x 0 t p x t d t hereafter the raw moments are normalized with the zero moment μ 0 x p x t d t in the taylor regime the mean seepage velocity u x x μ 1 x and dispersion coefficient d μ 2 x u 0 3 2 x have the same solution as in eq 5 skewness sk x and kurtosis ku x of the rtd are determined as 6 sk x sk t x 1 2 μ 3 x μ 2 x 3 2 ku x ku t x 1 μ 4 x μ 2 x 2 3 exact solution to eq 4 with the heaviside entry c 0 t 1 for t 0 and c x t 0 0 x 0 gives dimensionless values sk t sk x x l 3 2 1 k t pe 1 and ku t ku x x l 30 1 k t pe 1 however sk t and ku t generally differ from this solution indeed the spatial and temporal moments and hence their coefficients are interconnected via simple algebraic formulae established with the help of the extended method of moments emm see eqs 31 and 32 in vikhansky and ginzburg 2014 in this work these relations will be verified in multi dimensional porous flow 2 2 lattice boltzmann trt framework the lbm is operated on the cuboid computational grid within the penetrable fluid d dimensional domain r v ϕ an equidistant mesh size is set equal to one lattice unit the péclet number is kept the same in physical and numerical systems the neighboring nodes are interconnected by the d dimensional discrete velocity set ddqq it consists of a zero amplitude vector c 0 and q m q 1 vectors c q each vector c q has the opposite one c q c q q 1 q m 2 and the pair c q c q is called a link the local variable of the scheme is the set of q real numbers called populations f q r t q 0 q m the populations f q r t enter into the local collision sums with their post collision values g q r t and then propagate to the neighbor sites according to their discrete velocities the two populations with the opposite velocities are decomposed into their symmetric and anti symmetric components f q 1 2 f q f q and g q 1 2 g q g q q 1 q m in the present work the symmetric component f q is updated with the same relaxation rate s ϕ for all links the collision stream algorithm then reads adding a time independent mass source quantity m r to the outgoing immobile population f 0 r t 1 as follows 7a f q r c q t 1 f q r t g q r t g q r t q 1 q m 2 f q r c q t 1 f q r t g q r t g q r t c q c q q 1 q m 2 f 0 r t 1 f 0 r t m r 2 q 1 q m 2 g q r t 7b g q r t s ϕ f q r t e q r t q 1 q m 2 s ϕ 0 2 an exact mass conservation equation means that q 0 q m f q r c q t 1 q 0 q m f q r t m r for any equilibrium distribution e q r t e q e q the anti symmetric component g q r t will be computed either with the two relaxation times trt operator or multiple relaxation times mrt r operator the trt operator ginzburg 2005a 2007 vikhansky and ginzburg 2014 applies the same relaxation rate s ϕ for all links and copes with eq 7c 8 trt g q r t s ϕ f q r t e q r t q 1 q m 2 s ϕ 0 2 the relaxation rates are space dependent but time independent in this work the two relaxation rates in eq 8 are defined from the locally prescribed positive eigenfunctions λ ϕ r 9 s ϕ r λ ϕ 1 2 1 λ ϕ r λ ϕ r λ ϕ r λ ϕ 0 λ ϕ 0 it is convenient to parameterize λ ϕ in eq 9 through a positive free tunable parameter λ ϕ λ ϕ λ ϕ because λϕ controls the truncation accuracy ginzburg 2012 2017b ginzburg and roux 2015 stability ginzburg 2012 ginzburg et al 2010 kuzmin et al 2011a yan et al 2017 and interface boundary accuracy cui et al 2016 demuth et al 2016 ginzburg 2007 2017a remark 1 the same value s ϕ assigned for all the symmetric modes in eq 7c is the most natural and quite stable choice according to the von neumann exact analysis ginzburg 2013 the isotropic mrt models computed on the coordinate velocity sets ddq 2d 1 then all reduce to the trt operator 8 the regularized ddq 2d 1 isotropic schemes wang et al 2015 correspond to s ϕ 1 and hence λ ϕ 1 2 λ ϕ according to exact stability analysis ginzburg et al 2010 λ ϕ 1 4 or the so called optimal stability sub class otrt may assure the sufficiency of the necessary stability conditions the regularized choice is not optimal but perhaps more robust than the srt sub class where s ϕ s ϕ λ ϕ λ ϕ 2 and the non negativity of the equilibrium function e q e q e q 0 is proved kuzmin et al 2011a to become necessary in the limit λ ϕ 0 the otrt with λ ϕ 1 4 has larger velocity bounds in the isotropic and anisotropic schemes remark 2 another reason to keep λϕ independent from the transport eigenfunction λ ϕ is the consistent parameterization of the spatial truncation correction and steady state solutions by pe this property is guaranteed with the fixed value λϕ when the mass source is constant d humières and ginzburg 2009 and it will be examined for a space variable source in the present work e q r t has the form 10a e q r t t q c e k r t λ ϕ m r e q u r t q 1 q m 2 10b e q r t t q k r t α 1 d u ϕ α r c q α e q u r t q 1 q m 2 10c k r t k e q r t 1 2 m r k e q ρ r t ϕ r β e 10d ρ r t q 0 q m f q r t 10e ddq 2d 1 u ϕ 2 r α 1 d u ϕ α 2 c e ϕ r β e c e min r ϕ r d β e we note that eq 7a does not need to compute e 0 r t when the populations are initialized at the equilibrium one prescribes ρ r t 0 computes f q r t 0 e q e q and f q r t 0 e q e q q 1 q m 2 e g with m r 0 then f 0 r t 0 ρ r t 0 q 1 q m f q r t 0 in what follows we address the minimal discrete velocity sets ddq 2d 1 d1q3 d2q5 and d3q7 they are built on the coordinate discrete velocity vectors c q 1 α α 1 d these schemes yield the same weight t q 1 2 for a diffusion flux variable k r t in e q r t and an advective flux u ϕ k r t in e q r t because of the isotropic condition q 1 q m t q c q α c q β δ α β α β the macroscopic solution k r t is defined with the half mass source value in eq 10c for reduction of the truncation corrections kuzmin et al 2011b and correct parameterization of the modeled equation d humières and ginzburg 2009 because of this last objective the weight distribution tqce is also assigned for the mass term λ ϕ m r in eq 10a the two scale parameters ce and βe are set constant over the grid because of the leading order continuity condition prescribed for k r when a local mass quantity t q c e m is directly added to g q in eq 7c an equivalent scheme reads with e q r t t q c e k e q e q u in the transient modeling of eq 1 c r t is set equal to k r t and βe 1 since the transient term β e 1 t k vanishes at the steady state the stationary solutions are βe independent but their convergence becomes accelerated when βe 1 following ginzburg 2006 2 3 direct transient lbm ade solvers we extend the two classes of lbm ade isotropic schemes from the homogeneous to heterogeneous soil a further extension to full anisotropic diffusion tensors may adopt either anisotropic equilibrium chai et al 2016b ginzburg 2005a 2012 ginzburg and d humières 2007 ginzburg et al 2010 servan camas and tsai 2010 link wise collisions ginzburg 2005a ginzburg and d humières 2007 or non diagonal matrix collisions dubois et al 2016 huang and wu 2014 rasin et al 2005 yoshida and nagaoka 2010 different techniques are combined examined for numerical diffusion and supported with the corresponding necessary stability bounds in homogeneous soil ginzburg 2013 in a space variable velocity field numerical diffusion is expected ginzburg and roux 2015 huang and wu 2014 to be dominated by the physical and numerical dispersion already in the moderate péclet range the anti numerical diffusion treatment then becomes insignificant nevertheless let us start with two remarks on the numerical diffusion because its role is important in diffusion dominant processes through heterogeneous blocks in series remark 3 the second order chapman enskog expansion e g ginzburg 2005a servan camas and tsai 2008 chopard et al 2009 ginzburg 2013 and wang et al 2015 provides the numerical diffusion form fnum in heterogeneous soil fnum sums with the right hand side rhs of eq 1 f n u m λ ϕ α β 1 d β t u ϕ α c q 1 q m t q c q α c q β λ ϕ α 1 d α t u ϕ α c using k c and e q u 0 in eq 10b following ginzburg 2005a we replace t c by ϕ 1 u ϕ c o ϵ 2 according to the first order expansion and obtain for a time independent velocity field f n u m λ ϕ ϕ 1 α β 1 d α u ϕ α β u ϕ β c in a constant or streamline invariant duct flow an equivalent form reads f n u m f u 2 λ ϕ d u c with d u ϕ 1 u ϕ α u ϕ β we note that the forward time central finite difference lax wendroff schemes hindmarsch et al 1984 complement the diffusion tensor with a similar anti numerical diffusion form like λ ϕ d u δ x 2 δ t λ ϕ 1 2 see ginzburg et al 2010 in lbm ade by adopting anisotropic approaches f u 2 can be cancelled either with the help of the hydrodynamic type u ϕ α u ϕ β equilibrium correction on the full velocity sets chai et al 2016b ginzburg 2005a 2012 ginzburg et al 2010 or with the non diagonal collision matrix ginzburg 2013 rasin et al 2005 or else combining the two techniques ginzburg 2013 the alternative lbm techniques involve the pseudo velocities servan camas and tsai 2008 or body force strategy chai et al 2016b chopard et al 2009 servan camas and tsai 2008 wang et al 2015 following this approach one may set e q u λ ϕ t q α 1 d t u ϕ α c c q α in eq 10b without any velocity field approximation but with need to resorting for the backward finite difference approximate to compute t c u ϕ remark 4 the recurrence equations ginzburg and roux 2015 vikhansky and ginzburg 2014 produce numerical diffusion correction to the rhs of eq 1 in the exact form f n u m λ ϕ t 2 ϕ c the chapman enskog approximate is then matched applying twice t ϕ c u ϕ c and replacing the central differences by their differential counterparts this suggests that the removal of the entire numerical diffusion may require the time centered implicit anti correction we will consider two different anti numerical diffusion corrections to the approximate form f u 2 r λ ϕ d u c d u ϕ 1 u ϕ α u ϕ β in trt ade schemes they combine eq 8 with eq 10 on the coordinate stencil ddq 2d 1 in the three linear following forms using c r t k r t βe 1 and d ϕ ϕ d 0 11a ade c e q u 0 λ ϕ c e d ϕ d ϕ ϕ d 0 11b ade j e q u t q ϕ 1 c α 1 d u ϕ α u ϕ β c q α c q β e q u 0 λ ϕ c e d ϕ 11c ade 1d e q u 0 λ ϕ c e u ϕ x 2 ϕ d ϕ u ϕ x 2 c e ϕ the ade c operates with a continuous equilibrium but it models the diffusion tensor with the correction λ ϕ d u the ade j with e q u vanishes only the diagonal entries λ ϕ d u on the coordinate velocity sets we note that e q u is subject to the jumps when the velocity vector is perpendicular to the interface this is because of the discontinuity in coefficients λ ϕ although f u 2 r is space continuous together with the velocity field u ϕ r the ade 1d in eq 11c is only suitable for 1d where it removes f u 2 with the help of the velocity dependent relaxation function λ ϕ this scheme has been compared with ade j in homogeneous soil ginzburg 2013 and can be applied for darcy flow in series in multi dimensions the mrt r block matrix collision allows to remove f u 2 on the coordinate stencil cf ginzburg 2013 eq 44 we propose an extension to heterogeneous soil for g q r t in eq 7a as follows 12a mrt r g q r t β 1 d s α β r f β r t e β r t q α 1 q m 2 d 12b s α β 1 d 0 ϕ c e 1 2 δ α β d 0 ϕ c e c e ϕ u ϕ 2 u ϕ α u ϕ β α β 1 d 12c ade r β e 1 e q u 0 λ ϕ λ ϕ 1 d 0 ϕ 2 c e ϕ u ϕ 2 λ ϕ 2 λ ϕ 3 d ϕ c e u ϕ 2 c e ϕ the ade r operates with the continuous equilibrium distribution the matrix s α β 1 is the inverse of the collision matrix sαβ the d eigenfunctions λ ϕ 1 s ϕ 1 2 are built with the eigenvalues s ϕ of the collision matrix sαβ cf ginzburg 2013 eq 54 this collision operator is called rotated because its matrix becomes diagonal in the axes aligned with the velocity vector u ϕ ade r reduces to ade 1d in one dimensional flow an extension of eq 12 to full velocity sets and anisotropic diffusion tensor may follow ginzburg 2013 we note that the necessary stability line from eq 12c coincides with the ade c stability bound from eq 10e but λ ϕ 1 unboundly increases on the stability line degrading the truncation accuracy in this work we fix an uniform value λϕ and define λ ϕ λ ϕ max λ ϕ λ ϕ λ ϕ 1 in eq 9 the mrt r then intrinsically operates with two distinguished values λϕ and the smaller valued λ ϕ λ ϕ 2 λ ϕ 1 their disparity may degrade the accuracy and stability against the λϕ optimized trt schemes ginzburg 2013 remark 5 the two stability conditions in eq 10e present a formal extension to the necessary stability conditions established with the von neumann linear analysis ginzburg et al 2010 in the absence of the interface boundary and mass sources but comprising the worst possible scenario for the respective position of the wave and constant velocity vectors indeed the velocity bound from eq 10e assures the positive semi definiteness of the effective diffusion tensor λ ϕ i d u the ade j may exceed this bound by a factor d d 1 in d2q5 and d3q7 especially when λ ϕ 1 4 in eq 9 numerical computations confirm the principal stability bounds and trends in duct flow ginzburg and roux 2015 yan et al 2017 and multi dimensional porous scale velocity field yan et al 2017 finally we recall that the effective mean seepage velocity of the numerical scheme is detected by the first raw moment while the effective quantity of the numerical diffusion is detected by the variance the direct solvers compute the solute evolution through a long array of duplicated periodic unit cells cf v in fig 1 a very useful check is that in the spatial spread and taylor regime all minimal schemes should produce μ 1 t δ t μ 1 t u s u m δ t where an arithmetical mean value u s u m over the cross section replaces u x in a straight stratified flow the ade j ade 1d and ade r minimal schemes produce σ 2 t δ t σ 2 t 2 d ϕ δ t exactly in ϕ uniform constant darcy flow u ϕ x while the ade c gives σ 2 t δ t σ 2 t 2 d ϕ 1 u ϕ x 2 ϕ c e δ t we note that the taylor regime is difficult to reach at high pe because the number of cells grows linearly with pe and the computational time increases as pe2 at least the three schemes 11 will be examined for the quality of their profiles and the first four moments in a perpendicular one dimensional darcy flow through heterogeneous blocks against the analytical emm solution ginzburg and vikhansky 2018 the three schemes 11a 11b and 12a will be compared between them and with the steady state trt emm predictions for dispersion skewness and kurtosis in temporal and spatial moments in two dimensional flow around solid and through porous obstacles 3 extended method of moments emm and trt emm the emm provides an alternative way to compute the transport coefficients in eqs 5 and 6 section 3 1 formulates the corresponding steady state boundary value emm problems section 3 2 proposes their numerical formulation trt emm based on the trt operator 8 and equilibrium distribution 10 3 1 the emm solution for the spatial and temporal moments the extended method of moments ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 searches a solution to eq 1 in the decomposed form 2 either expanded into perturbative series in ω form 3a or in γ form 3b assume first that the coefficients of the two expansions ωn and γn are known and their dimensionless counterparts are defined giving the mean characteristic velocity u 0 and characteristic length l respectively 13 ω n ω n u 0 1 l n 1 and γ n γ n u 0 n l n 1 n 1 they determine the dimensionless transport coefficients in eqs 5 and 6 14a u x u 0 ω 1 and if u x 0 u x u 0 γ 1 14b d ω 2 d e f f ω 2 u ϕ 0 14c k t d 0 d d 0 1 ω 2 pe 1 u x 3 u 0 3 γ 2 pe 1 pe u 0 l d 0 14d sk s sk t u 0 t l 3 ω 3 2 ω 2 3 2 ku s ku t u 0 t l 6 ω 4 ω 2 2 14e sk t sk x x l 3 γ 3 x x 2 γ 2 x 3 2 ku t ku x x l 6 γ 4 γ 2 2 x x in pure diffusion ω 1 u ϕ 0 0 and the ω form allows to compute d e f f and the higher moments due to the structure the γ form becomes undefined in motion the two sets of the coefficients are inter related 15 γ 1 1 ω 1 γ 2 ω 2 ω 1 3 γ 3 2 ω 2 2 ω 1 ω 3 ω 1 5 γ 4 5 ω 2 3 5 ω 1 ω 2 ω 3 ω 1 2 ω 4 ω 1 7 the back transform ω n γ n has exactly the same form exchanging ω n and γ n in what follows we have u 0 u x with the x component mean u x of seepage velocity u from eq 4 then when u x 0 ω 1 γ n 1 in eqs 14a 15 in theory the two formulations are equivalent and produce identical transport coefficients with the help of eq 15 it is shown ginzburg and vikhansky 2018 that the two problems are tackled through the linear combinations of the boundary value problems we focus on the ω form because it is simpler and allows for pure diffusion in ω form the emm looks for the scalar distribution b n r called b field which sequentially solves the steady state ade given by eqs 16a 16e inside a penetrable region r v ϕ v of a single cell v streamwise periodic along the x axis 16a u ϕ r b n r j n r m n r d ϕ b n n 1 d ϕ ϕ r d 0 16b m n r m n r s n r ϕ r b 0 ω n n 1 b 0 1 16c m 1 r u ϕ x b 0 s 1 0 ω 1 u ϕ x ϕ u x 16d m n r ϕ k 1 n 1 ω k b n k r d ϕ b n 2 u ϕ x b n 1 n 2 16e s n r d ϕ x b n 1 n 2 j n r d ϕ b n 1 r 1 x n 1 16f ω n m n s n ϕ b 0 n 1 let n be a normal vector on the boundary or interface and ψ a ϕ ψ a ϕ ψ a ϕ denote the jump of a scalar variable ψ r on the interface aϕ along n solution b n r is constrained to the periodic interface boundary and normalization conditions respectively 17a b n r l x 1 x b n r 17b b n a ϕ 0 d ϕ n b n a ϕ n j n a ϕ 17c d ϕ n b n a s n j n a s 17d b n ϕ ϕ 0 eqs 16a 16e are linear with respect to b n r because m n r and j n r in eq 16a are built with the known solution b k r k n n 1 these terms are exemplified in eq a 1 the set ωn is built in eq 16f from the solvability condition m n 0 which implies global mass conservation since b n r u ϕ r and hence the advective flux u ϕ b n are continuous the normal component of the diffusion flux d ϕ b n is subject to the prescribed jump value ϕ n b n a ϕ ϕ b n 1 n x a ϕ according to eq 17b with eq 16e when ϕ r is discontinuous along the x axis at interface aϕ ϕ r n x a ϕ 0 eq 17b comprises the solid side r s a s with ϕ r s 0 j n r s 0 u ϕ x r s 0 and prescribes the jump of the diffusion flux normal component on the solid wall by eq 17c with eq 16e n b n a s b n 1 n x a s the flux jump term j n r and the mass term s n r vanish in x parallel stratified channels and ducts where the boundary value problem reduces to diffusion equation with the transversely variable mass source and continuous advection diffusion flux the b field is defined to a constant it is fixed without loss of generality by the normalization condition 17d using eq 17d for all orders k n in eq 16f the terms ϕ k 1 n 1 ω k b n k and d ϕ b n 2 vanish for n 2 and ωn can be computed as 18a ω 2 d 0 u ϕ x b 1 ϕ d ϕ x b 1 ϕ 18b ω n u ϕ x b n 1 ϕ d ϕ x b n 1 ϕ n 3 eqs 16f and 18 allow to predict n longitudinal moments the effective diffusivity d e f f in eq 14b and the associated higher order moments due to the structure alone are computed solving eqs 16 17 with zero velocity u ϕ 0 in order to obtain the three transport coefficients in eq 14 a symbolic or numerical procedure solves eqs 16 17 three times with respect to b n r n 1 2 3 the coefficients ω 2 ω 3 and ω 4 from eqs 16f and 18 then allow to compute respectively kt sk s and ku s in eq 14 with the help of eq 13 the temporal transport coefficients sk t and ku t from eq 14 are built with the help of eq 15 the boundary value problem reads similar in the γ form using eqs a 2 a 4 with the non zero mean seepage velocity u x the boundary problem 16 17 can be solved independently for each periodic direction of the unit cell v the full rank effective diffusion and dispersion tensors can be restored from d runs with the help of the formulation ginzburg and vikhansky 2018 it applies either with an isotropic or anisotropic tensor d 0 at the first order n 1 this procedure extends the b equation brenner 1980 salles et al 1993 from homogeneous to heterogeneous soil an extension to any order longitudinal coefficients is straightforward employing the recursive procedure vikhansky and ginzburg 2014 3 2 numerical formulation trt emm the trt emm solves eqs 16 17 inside a unit cell v with the trt collision operator from eq 8 and the equilibrium distribution in eq 11 where it substitutes m m n r k b n r t e q u 0 and e q u t q α 1 d j n α c q α e q u is set equal to zero because numerical diffusion vanishes at steady state e q u is introduced in order to couple the advective flux and diffusion flux correction j n and then to produce the diffusive flux jump in eq 17b implicitly eq 11 becomes 19a e q r t t q c e b n r t λ ϕ r m n r 19b e q r t t q α 1 d u ϕ α r b n r t j n α r c q α 19c b n r t b n e q r t 1 2 m n r b n e q ρ r t ϕ r β e 19d ρ r t q 0 q m f q r t r v ϕ the trt emm can be applied in the form 19 with the full discrete velocity sets and isotropic weights tq the minimal sets apply t q 1 2 an acceleration parameter βe 1 from eq 11 should respect the stability condition 10e the steady state solutions are independent from βe and initial distribution ρ r t 0 like the direct ade solvers the trt emm runs across the heterogeneous domains vϕ without any explicit interface conditions the diffusive flux jump condition on the solid surface is modeled implicitly with the bounce back boundary rule see eq 29b the effective interface boundary closure relations will be derived and compared to eqs 17b and 17c the obtained steady state solution b n r is normalized with eq 17d yielding 20 b n r b n r b n b n b n ϕ ϕ n 1 all the integral values ψ in eqs 16 18 and 20 are computed with the summation over the grid points hence by construction the mean seepage velocity is set equal to u s u m r u ϕ x r r ϕ r applying the summation procedure the global population mass r ρ r ρ r q 0 q m f q r t is conserved exactly due to the discrete solvability condition r m n r 0 the sum of all populations over the grid should remain the same during computations the terms m n r and j n r are precomputed with eqs 16b 16e exemplified in eq a 1 in that s n r is approximated with the help of the streamwise finite differences applied inside vϕ e g using eq a 6 we do not apply here the local gradient solution like c e x b n q 1 q m g q c q x because of its intrinsic correction due to the mass source and velocity variations the γ form computes eq 19 with eqs a 2 and a 3 for m n r and eq a 5 for j n r the set γn is constructed with eq a 4 the numerical recipe is formulated for trt emm in appendix a 4 at steady state f 0 r t 1 f 0 r t in eq 7a and an exact mass conservation equation reads 21 m r 2 q 1 q m 2 g q r the recurrence equations d humières and ginzburg 2009 ginzburg 2012 ginzburg and roux 2015 express both the transient and the steady state solution of g q exactly see ginzburg 2017a eq 20 we will make the use of the two steady state linear combinations 22 g q r δ q e q λ ϕ δ q 2 e q λ ϕ 1 4 δ q 2 g q r λ ϕ g q r λ ϕ δ q e q 1 4 δ q 2 e q λ ϕ 1 4 δ q g q r r v ϕ the central differences apply link wisely δ q ψ r t 1 2 ψ r c q t ψ r c q t and δ q 2 ψ r t ψ r c q t 2 ψ r t ψ r c q t ψ e q g q eq 22 are derived with the space uniform eigenfunctions λ ϕ in our context they apply inside piece wise continuous porous block vϕ plugging first eq 22 with 19 into eq 21 an exact form of the modeled mass conservation equation reads 23a u ϕ b n j n m n r n d ϕ b n d ϕ r λ ϕ r c e 23b r n r λ ϕ c e δ 2 m n r λ ϕ 1 4 q 1 q m δ q 2 g q r n 1 eq 23a presents the central difference approximate of eq 16a up to correction r n r the first component in r n r is non zero when m n r is a non linear function of the spatial coordinate the term λ ϕ 1 4 q 1 q m δ q 2 g q presents the generic trt truncation correction see ginzburg 2017b ginzburg and roux 2015 eq 23 is not specific for trt emm it describes the steady state equation modeled with the trt operator and linear equilibrium distribution 19 in that j n 0 when the advective diffusion flux is set continuous on the interface 4 bulk and interface analysis in a parallel and a perpendicular flow the analysis developed in this section applies exactly for any steady state solution of eq 23 provided that b n r varies along one lattice direction in particular the described situation takes place in a series of porous blocks and stratified channels as sketched in fig 2 4 1 parameterization property when solution bn x to eq 23 varies only along the x axis isotropic solution g q r to eq 21 reads 24a g q r t q m x c q x 2 then 24b q 1 q m g q r m x and q 1 q m δ q 2 g q r δ x 2 m x eq 23 then becomes 25 u ϕ b n j n m n α m δ x 2 m n d ϕ b n α m 1 4 λ ϕ 1 c e we expect eqs 24a and 25 to remain valid for any x axis rotation because of the isotropy of the term t q q 1 q m c q x 2 let us consider the following dependency between λϕ and ce 26a λ ϕ a 1 c e a 0 then α m 1 4 a 26b α m 0 if a 1 4 then λ ϕ 1 4 1 c e eq 26a allows to produce the same solution b n r for any individual values λ ϕ and ce when the diffusion coefficient d ϕ λ ϕ c e is fixed in motion eq 26a allows for a consistent control of eq 25 by péclet number and porosity contrast we say then that eq 26 allows for a proper parameterization of the modeled eq 25 however b n r becomes dependent upon a free tunable value a its specific solution a 1 4 vanishes the truncation correction since λ ϕ 1 4 as ce 0 this choice is expected to be robust remark 6 in principle the mass term in eq 19 can be applied with an individual free tunable scale parameter c e m 0 1 as 27 e q r t t q c e b n r t 1 2 m n r t q c e m s ϕ m n r then α m 1 4 1 2 λ ϕ c e c e m λ ϕ 1 c e m eq 27 reduces to eq 19 when c e m c e and αm then reduces to eq 26b however when c e m c e bn depends upon ce and λ ϕ separately even if their product is fixed 4 2 interface conditions in a parallel and a perpendicular flow assume a flat interface x x 0 midway the two grid nodes x 0 x 0 and without loss of generality fix the interface cut link c q such that x 0 1 2 c q x x 0 the two steady state exact interface conditions of the trt operator 8 read e q see ginzburg 2007 ginzburg and d humières 2007 28a s q x 0 0 with s q x 0 s q x 0 s q x 0 s q x 0 e q 1 2 g q λ ϕ g q x 0 s q x 0 e q 1 2 g q λ ϕ g q x 0 28b g q x 0 0 with g q x 0 g q x 0 g q x 0 g q x 0 e q 1 2 g q λ ϕ g q x 0 g q x 0 e q 1 2 g q λ ϕ g q x 0 applying eq 10 the effective continuity condition of the scalar variable k r is set by eq 28a the effective advective diffusion flux jump condition for u ϕ k r d ϕ k r is set by eq 28b the anti bounce back abb and bounce back bb rules ginzburg 2005b 2017a apply for the incoming population f q r b t 1 in the grid boundary node r b 29a abb f q r b t 1 f q g q g q r b t 2 e q r s 29b bb f q r b t 1 f q g q g q r b t r b r s 1 2 c q r s a s the bb applies for the no flux condition in the direct ade schemes and trt emm the abb applies for the heaviside input in the direct rtd computations we note that abb and bb steady state closure relations are comprised in eqs 28a and 28b respectively 30a abb e q 1 2 g q λ ϕ g q r b e q r s 30b bb e q 1 2 g q λ ϕ g q r b 0 in the series configuration along the x axis the darcy velocity u ϕ u 1 x and the flux jump term j n j n 1 x are both perpendicular with the interface x x 0 the jump value j n x 0 in eq 17b is non zero when the two blocks have distinguished porosity in a stratified channel along the y axis the velocity profile u ϕ u ϕ x x 1 y is parallel with the interface y replaces x in eq 16 for stratified flow in this section see fig 2 eq 23 reduces to the diffusion equation and the interface analysis applies in the transverse x direction with u 0 and j n 0 let us express eq 25 in terms of the phase dependent grid péclet number pe 31a p e x b n x j n m n α m δ x 2 m n δ x 2 b n r v ϕ 31b p e u d ϕ j n d ϕ 1 j n m n d ϕ 1 m n d ϕ λ ϕ c e we consider an interface cut link c q x 2 1 c q x 3 c q x e q from eq 19 g q from eq 22 and g q from eq 24a then read 32a e q t q c e b n λ ϕ c e m n 32b e q t q c e λ ϕ ϵ n c q x ϵ n p e b n j n 32c g q x t q c e λ ϕ m n x c q x 2 32d g q x t q c e c q x x b n 1 4 δ x 2 ϵ n c q x 2 α m x m n the central difference operators imply δ q ψ x ψ c q x 1 2 ψ x c q x ψ x c q x and δ q 2 ψ δ x 2 ψ c q x 2 ψ x c q x 2 ψ x ψ x c q x ψ 4 3 effective continuity condition plugging eqs 32a and 32c eq 28a reads with 33 s q x 0 t q c e b n λ ϕ 1 c e m n c q x 2 1 2 g q x 0 we substitute eq 32d for g q x factorize tqce and split s q t q c e 1 into the two components t q 2 x 0 the second order central difference taylor expansion from x 0 to x x 0 and the remaining component r q x 0 eq 33 yields 34a s q x 0 t q c e t q 2 x 0 r q x 0 with 34b t q 2 x 0 b n 1 2 x b n c q x 1 8 δ x 2 b n c q x 2 x 0 34c r q x 0 λ ϕ 1 c e m n c q x 2 1 8 δ x 2 b n c q x 2 1 8 δ x 2 ϵ n c q x 1 2 α m x m n c q x x 0 when λϕ and ce are inter related through eq 26a eq 34c becomes 35 r q x 0 a m n 1 8 δ x 2 b n c q x 2 1 8 δ x 2 ϵ n c q x 1 2 1 4 a x m n c q x x 0 since ce is set constant over the grid eq 28a as well as eqs 34 35 become tqce independent and parameterized by a a pure diffusion through a series of porous blocks is comprised with u 0 and j n x 0 0 the emm then predicts the effective diffusivity and kurtosis due to the porosity contrast see ginzburg and vikhansky 2018 in a semi explicit diffusion scheme formulated by eqs b 4 and b 5 for comparison with the implicit jump tracking via eq 19 e q 0 and the flux jump value j n x 0 is interpolated to the interface and prescribed explicitly then ϵ n 0 and m n becomes replaced by m n x j n in eq 32 this scheme is expected to behave similar to the interface configuration which takes place in the stratified channels example 1 stratified channels in that case p e 0 δ x 2 ϵ n 0 and m n δ x 2 b n α m δ x 2 m n is expressed from eq 31 the continuity condition 28a gives with the help of eqs 34 35 36a a b n 1 x 0 0 if m n x 0 36b a 1 8 b n 2 x 0 0 if m n x c o n s t n 36c a 1 8 b n 3 x 0 0 if m n x a n x b n with r q x 0 1 16 x m n c q x x 0 1 16 x 3 b n c q x x 0 1 2 x b n c q x 1 2 x b n 1 12 x 3 b n c q x then s q x 0 t q c e b n 1 2 x b n c q x 1 8 x 2 b n c q x 2 1 48 x 3 b n c q x x 0 36d a 1 4 b n 2 x 0 1 8 m n x 0 1 8 δ x 2 b n x 0 m n x eqs 36a 36c take into consideration that δ x 2 m n 0 b n k x means here the k th order central difference taylor expansion from the interface nodes to the interface eq 36a indicates that a piece wise linear function bn x is continuous on the interface this addresses a pure diffusion in series with n 1 in eq 25 either with the semi explicit or implicit interface since j 1 x is piece wise constant δ x 2 ϵ n 0 in the two cases eq 36b tells that the parabolic function bn x is continuous on the interface when m n x is a piece wise constant only provided that a 1 8 this condition supports an exact parabolic solution bn x to eq 25 either in a stratified darcy flow when n 1 or with the semi explicit jump tracking diffusion scheme in series when n 2 eq 36c extends the exact closure condition of a 1 8 to the third order polynomial solution bn x governed by the piece wise linear mass source this addresses n 3 kurtosis in eq 25 with the semi explicit jump tracking diffusion scheme in series eqs b 4 and b 5 it follows that a 1 8 is the most suitable choice for diffusion equilibrium ϵ n 0 when the mass source is either piece wise constant or linear eq 36d indicates that when the correction of αm vanishes due to a 1 4 the interface continuity condition is exact for parabolic distribution bn only if m n x 0 0 that is when m n scales with ϕ and m n is continuous the described situation takes place in the next example example 2 pure diffusion with the implicit jump tracking in series of porous blocks in pure diffusion through two heterogeneous blocks ω 2 n 1 0 jn x and m n x are respectively n 1 and n 2 order polynomials let us show that a 1 4 in eq 36d assures the continuous solution both for the parabolic function b 2 x and the third order polynomial b 3 x eq 19 matches the diffusion flux jump implicitly via e q t q j n c q x hence δ x 2 ϵ n becomes non zero for n 3 kurtosis the key point is that x j n s n m n m n ϕ ω n according to eq 16e when p e 0 α m 0 eqs 31 and 34 with eq 35 then become respectively 37a m n x 1 2 δ x 2 b n m n ω n m n m n d ϕ ω n ω n ϕ d ϕ ω n d 0 37b a 1 4 b n 2 x 0 1 8 m n ω n δ x 2 j n c q x x 0 then 37c a 1 4 b 2 2 x 0 0 b 3 3 x 0 0 eq 37b is obtained by substituting a 1 4 eq 37a and δ x 2 ϵ n δ x 2 j n into eq 35 when n 2 the rhs vanishes in eq 37b because ω n is constant n m 2 is constant and δ x 2 j 2 0 when n 3 the rhs vanishes in eq 37b because j 3 x is the parabolic function 2 x 2 j 3 x m 3 x 3 b 3 when α m a 0 0 using x j n s n and 1 8 δ x 2 j n c q x 1 8 x 2 j 3 c q x gives a continuation to the interface 1 16 x m 3 c q x for the piece wise linear function 1 8 m 3 x in the rhs of eq 37b and 1 16 x 3 b 3 x c q x in the lhs of eq 37b then b 3 3 x 0 0 for the third order polynomial solution b 3 x similarly as in eq 36c we conclude that the semi explicit and implicit interface jump tracking impose the continuous polynomial solutions to pure diffusion equation n 2 and n 3 with two distinguished values a 1 8 and a 1 4 respectively the choice a 1 8 is the same as in stratified channels example 3 darcy velocity in a series when n 1 in that case m n x and jn x are piece wise constant x m n 0 δ x 2 m n 0 and x j n 0 bn x is the discrete exponential function and the term 1 8 δ x 2 ϵ n c q x 1 8 p e δ x 2 b 1 c q x is non zero in eq 35 when m 1 x is expressed from eq 31 m 1 p e x b 1 δ x 2 b 1 the continuity condition given by eq 28a with eq 33 takes the form of the asymmetric taylor expansion from the two interface sides x 0 x 0 1 2 c q x 38a s q x 0 t q c e b 1 α x b 1 c q x α δ x 2 b 1 c q x 2 x 0 n 1 38b α x 0 1 2 λ ϕ 1 c e p e c q x α 1 2 if λ ϕ 0 38c α x 0 1 8 p e c q x λ ϕ 1 c e when pe 0 then α 1 2 λϕ and the analysis reduces to the pure diffusion problem discussed above however the perpendicular flow introduces the asymmetric not equal coefficients of pe in α for two neighbor nodes and the leading order coefficient α becomes accurate only in the asymptotic limit λϕ 0 this suggests that the midway continuity of the solution b 1 x and the measured dispersion coefficients will degrade with pe and that only very small values a in eq 26a will improve for this however such a choice is rather unstable ginzburg and roux 2015 kuzmin et al 2011a this continuity analysis extends straightforwardly for the next orders 4 4 effective flux jump condition plugging eq 32 into eq 28b an exact form of the interface continuity condition for the total flux component φ x u b n j n d ϕ x b n reads 39 g q x x 0 0 with g q x 0 t q c q x φ x 1 2 m n c q x α m x m n c q x 2 1 4 δ x 2 e q c q x 2 x 0 t q c q x φ x 1 2 x φ x c q x x 0 α m t q c q x x m n 1 2 δ x 2 m n c q x x 0 1 4 δ x 2 e q c q x 2 x 0 where x φ x m n α m δ x 2 m n when δ x 2 e q c q x 2 x 0 0 eq 39 gives 40 if x m n x 0 0 or m n if a 1 4 α m a 0 u b n d ϕ x b n 1 x x 0 j n 1 x x 0 with g q x 0 t q c q x φ x 1 2 x φ x c q x x 0 eq 40 presents second order accurate flux jump condition of the scheme it is exact with respect to the interface location only when all flux components are linear functions in space this is valid in the stratified darcy flow when n 1 a u j n 0 m 1 is a piece wise constant b 2 is parabolic otherwise eq 40 applies in a stratified flow with a 1 4 eq 40 applies in pure diffusion in a series when n 1 2 a because m n is piece wise constant when n 1 2 however δ x 2 e q c q x 2 x 0 is different from zero for all orders in the perpendicular darcy flow and it is expected to modify the coefficient of the second order correction in flux jump effective location in eq 40 when m n x is a linear function and bn x is the third order polynomial e g in pure diffusion problem an exact midway location of the flux jump condition is reached with the specific value a 5 24 41 m n a n x b n a 5 24 α m a 1 24 φ x 3 x 0 j n 2 x 0 with φ x d ϕ x b n φ x 1 6 d ϕ x 3 b n φ x d ϕ x b n and g q x 0 t q c q x φ x 1 2 x φ x c q x 1 8 x 2 φ x c q x 2 x 0 eq 41 is obtained using α m x m n α m d ϕ x 3 b n in pure diffusion with linear source x m n x m n δ x 2 m n 0 g q x 0 in eq 41 then gets an extra term α m 1 8 1 6 d ϕ x 3 b n which vanishes with α m 1 24 the modeled third order polynomial solution is exact with a 5 24 in a stratified either periodic or bounded by the bounce back channel governed by the linear mass source eq 41 also applies in a pure diffusion for n 3 kurtosis with the semi explicit jump tracking scheme where e q 0 flux jump value j n 2 x 0 is modeled exactly and the total linear mass source includes x jn x see eq b 5 however an implicit jump diffusion scheme 19 incorporates an additional non zero term 1 4 δ x 2 e q c q x 2 x 0 1 4 t q δ x 2 j n c q x x 0 2 8 t q x 2 j n c q x x 0 with the parabolic distribution jn x for n 3 kurtosis the difference with g q x 0 in eq 41 then reads r q x 0 t q c q x α m 1 8 x 2 j n α m 1 24 d ϕ x 3 b n x 0 using first α m x m n α m d ϕ x 3 b n x 2 j n and then 1 8 x 2 j n c q x x 0 for continuation of the parabolic solution jncqx in interface jump term j n 2 x 0 eq 41 a particular parameter dependent dependency a r ϕ r h from eq b 3 then solves r q x 0 0 4 5 summary the bulk and interface analysis was developed in a common framework for stratified channels and porous blocks in series a specific dependency between a and ce from eq 26a allows to parameterize properly the modeled equation and the effective closure relations in these two situations this analysis suggests that due to the linearity of the truncation correction and the interface conditions with respect to the mass source m n and the flux jump term j n the ω form and γ form are numerically equivalent in these configurations when the control parameter a from eq 26a takes the same value in both formulations three physical parameter independent solutions for a have been considered 42a a 1 4 λ ϕ 1 4 1 c e 42b a 1 8 λ ϕ 1 8 1 c e 42c a 5 24 λ ϕ 5 24 1 c e firstly eq 42a vanishes αm in eq 25 and provides continuous parabolic and third order polynomial pure diffusion solution for b 2 x and b 3 x respectively in a series of porous blocks in the case of the implicit interface tracking with eq 19 secondly eq 42b assures exact parabolic solution b 1 x and hence the dispersion coefficient in a stratified darcy flow it also assures continuous second and third order polynomial functions b 2 x and b 3 x in diffusion process in a series of the porous blocks when the semi explicit jump tracking from eqs b 4 and b 5 replaces eq 19 we note that eq 42b is known for the midway continuity of the parabolic solutions in the presence of the heterogeneous diffusion coefficients ginzburg 2007 2017b but also for an exact location of the straight dirichlet boundary with the anti bounce back rule in parabolic distributions governed by the constant mass source see particular solutions chai and zhao 2014 cui et al 2016 and general form ginzburg 2017b when c e 1 3 eqs 42a and 42b give respectively λ ϕ 3 8 and λ ϕ 3 16 the first solution is known for its annihilation of the truncation coefficient due to the resistance variation in the trt brinkman flow scheme ginzburg et al 2015b the second solution assures the midway location of the interface continuity and the bounce back no slip condition in the parabolic velocity profile ginzburg 2007 thirdly eq 42c assures a midway location of the flux continuity and no flux bounce back boundary in the stratified flow governed by a piece wise linear mass source it also assures the exact flux jump condition for the third order polynomial diffusion solution in a series modeled with the semi explicit jump tracking the implicit jump tracking from eq 19 needs however a parameter dependent solution a k u s u m from eq b 3 for the same objective these two distinguished solutions provide an exact solution for the kurtosis up to summation in the pure diffusion problem hence on the one hand the semi explicit jump tracking makes the diffusion problem in series equivalent with the stratified channels on the other hand it does not vanishes the a dependency in parabolic and higher order solutions bn x to be contrasted with the local node centered implicit tracking in eq 19 the semi explicit jump tracking is more involved numerically because it is link centered and requires an interpolation of the prescribed jump value to the interface besides the space variable mass sources a new point in this interface analysis is the presence of the non zero interface perpendicular velocity it is predicted that the darcy velocity u makes the continuity condition asymmetric from the two interface sides in series this specific deficiency only vanishes in the stability limit λϕ 0 an impact of this property on the moments will be examined in section 5 finally we note that the developed analysis procedure can be adopted for any linear equilibrium and collision operator in simple geometries with a possible extension for their rotation with respect to the lattice 5 series of porous blocks we consider a periodic series of two porous blocks along the x axis with the interface at x 0 0 see fig 2 the porosity is ϕ 1 when x h 1 0 and ϕ 2 when x 0 h 2 the characteristic length is set equal to h h 1 h 2 the system can be parameterized through the porosity contrast r ϕ ϕ 1 ϕ 2 and aspect ratio r h h 1 h 2 since the two blocks are interchangeable all results are invariant with respect to the simultaneous transformation r ϕ r ϕ 1 and r h r h 1 we consider rϕ 0 1 and rh 0 closed form expressions are provided ginzburg and vikhansky 2018 i the effective diffusivity d e f f skewness coefficients sk s and ku s they are gathered in eq b 1 and ii for ω 2 ω 3 and hence k t d e f f and sk s in the presence of the constant darcy flow see eqs 58 c 1 and c 2 in ginzburg and vikhansky 2018 we will measure the differences to the exact solution in the following forms 43a e k t d n u m d e f f 1 k t d e f f k t when k t 0 43b e d d n u m d 0 1 k t d 0 1 k t 43c e sk s sk s n u m sk s 1 e ku s ku s n u m ku s 1 eq 43a is only applied for darcy flow in series we will show that d e f f is the exact solution of the pure diffusion trt emm and hence e kt vanishes when kt 0 this is to be contrasted with the direct ade solvers in the presence of the numerical diffusion where e kt diverges when kt 0 the blocks in series are challenging for both numerical approaches trt emm and trt ade because the heterogeneity happens in the streamwise direction and the associated non gaussian effects are relatively weak but non zero section 5 1 constructs and examines the symbolic solutions of the trt emm in pure diffusion section 5 2 extends this analysis for a constant darcy flow section 5 3 compares numerical solutions for the three transport coefficients in the darcy flow between the trt emm and the three trt ade schemes from eq 11 the trt ade schemes are additionally examined on the continuity of their solutions 5 1 pure diffusion symbolic trt emm solutions in pure diffusion along the x axis eq 16a reduces to the one dimensional linear diffusion equation with respect to b n k x inside each block k 44 x j n k m n k x x ϕ k d 0 x b n k x j n k x d ϕ x b n 1 k n 1 mass source m n k obeys eqs 16b 16e with u ϕ x 0 at the interface b n x 0 0 and d ϕ x b n x 0 d ϕ b n 1 x 0 the periodic condition is applied at the unit cell ends b n 1 x h 1 b n 2 x h 2 the trt emm solves eq 25 with u ϕ x 0 45 x j n k m n k x α m δ x 2 m n k ϕ k d 0 δ x 2 b n k x n 1 b field solution bn x to eqs 44 45 is n order polynomial the j n k x and m n k x are respectively the polynomials of orders n 1 and n 2 hence when n 1 3 the central difference operators x j n k and δ x 2 b n k x are exact δ x 2 m n k 0 and αm correction vanishes interface conditions from eq 28 read e g with x 0 0 and c q x 1 as see fig 2 46a e q 1 2 g q λ ϕ g q 1 x 1 2 e q 1 2 g q λ ϕ g q 2 x 1 2 46b e q 1 2 g q λ ϕ g q 1 x 1 2 e q 1 2 g q λ ϕ g q 2 x 1 2 46c e q 1 2 g q λ ϕ g q 1 x h 1 1 2 e q 1 2 g q λ ϕ g q 2 x h 2 1 2 eqs 46a and 46c are continuity conditions 28a eq 46c is the flux condition 28b the flux condition on the periodic interface is satisfied automatically eq 46 read with eq 19 and 24a e q k t q c e b n k x λ ϕ k m n k x e q k t q j n k x c q x and g q k t q m n k x c q x 2 g q k x is expressed from them with eq 22 where δ q e q k and δ q g q k apply on the solution of the given block k solution b n 1 x b n 2 x is determined by eqs 45 46 to a constant fixed by eq 20 the continuity condition is elaborated in eqs 34 35 and discussed in example 2of section 4 3 the effective flux jump condition is developed in eq 39 the two conditions have the form of the central difference taylor expansion from the neighbor interface nodes x 0 1 2 to x 0 when n 1 then m 1 s 1 ω 1 m 1 0 j 1 d ϕ x j 1 x 0 b 1 x is piece wise linear and eq 46 are exact the superscript k is dropped hereafter hence b 1 x is exact and eq 16f or eq 18 produces d e f f ω 2 u ϕ x 0 d 0 d ϕ x b 1 ϕ exactly recall d e f f is the length weighted harmonic mean from eq b 1a when n 2 then m 2 d ϕ and s 2 d ϕ x b 1 are piece wise constant b 2 x is parabolic j 2 x d ϕ b 1 x and the diffusive flux d ϕ x b 2 x are piece wise linear eq 46b assures the flux jump condition midway the interface link with eq 40 and the solution of the system is exact λϕ ω 3 0 sk s 0 however according to eq 37 b 2 x is discontinuous at x x 0 except when λϕ obeys eq 42a when n 3 ω 1 ω 3 0 m 3 x ϕ ω 2 d ϕ b 1 x and s 3 x d ϕ x b 2 x are piece wise linear b 3 x is the third order polynomial j 3 x d ϕ b 2 x and the diffusive flux d ϕ x b 3 x are parabolic according to eq 37 b 3 x 0 b 3 x 0 is only valid provided that λϕ obeys eq 42a exact continuous solution b 3 x of the scheme is exemplified in fig 3 in fact when λϕ obeys eq 26a the dimensionless b field interface jump error is reduced with the second order accuracy 47a b 2 x x 0 h 2 b 2 x x 0 1 r h 1 r ϕ 1 4 a 4 r h r ϕ h 2 47b b 3 x x 0 h 3 b 3 x x 0 r h 1 r ϕ 2 1 4 a 8 r h r ϕ 1 r h r ϕ h 2 the two functions from eq 47 are displayed in fig 3 b 2 x and b 3 x are continuous at the midway position x x 0 only with a 1 4 in agreement with the interface analysis in eq 37 however according to the third order accurate taylor analysis in eq 39 the flux jump condition d ϕ x b 3 x x 0 d ϕ b 2 x x x 0 is exact only with the parameter dependent value a k u s u m r ϕ r h from eq b 3 a k u s u m r ϕ r h is illustrated in fig 3 we note that a k u s u m increases with the porosity contrast but remains confined to some suitable interval with realistic rϕ e g a k u s u m 0 29 0 35 when r ϕ 1 8 1 for any aspect ratio the coefficient ku s is estimated with eq 14d its reference solution is extended to the summation result ku s u m in eq b 2 ku s u m is the exact trt emm solution only if using a k u s u m from eq b 3 in combination with the third order accurate finite differences from eq a 6 for ω 4 d ϕ x b 3 ϕ in eqs 16f and 18 fig 4 shows that ku s is twice more accurate with eq 42a against eq 42b the relative error with eq 42a is rather small in very coarse resolution but its amplitude increases with the porosity contrast in resume the symbolic solutions exemplify the trt emm scheme and confirm the more generic interface taylor analysis the effective diffusivity and zero skewness are exact solutions of the scheme the flux jump condition and kurtosis are only exact up to summation with eq b 3 in turn the semi explicit jump tracking scheme from appendix b 2 matches the flux continuity and ku s u m with parameter independent solution from eq 42c all these zero velocity solutions allow for an efficient verification of the numerical implementation of eqs 16 17 at the first three orders n 1 2 3 5 2 darcy flow in series the constant darcy velocity u ϕ u 1 x u k d x p ν ρ 0 describes the flow in series with the length weighted harmonic mean permeability value kd and a piece wise linear continuous pressure distribution p x exact emm solution ginzburg and vikhansky 2018 shows that k t d e f f is asymptotically constant and all other transport coefficients decay with pe u x h d 0 48 pe ω 2 pe 1 ω 3 pe 2 ω n pe 1 n and γ n pe 1 n n 1 k t d e f f d d e f f 1 c o n s t sk pe 1 ku pe 1 this behavior is principally different from the stratified flow ginzburg 2017b where the dimensionless coefficients grow with pe cf eq 57 5 3 symbolic solutions with the trt emm the effective discrete equation 25 reads 49 u x b n k x j n k m n k x α m δ x 2 m n k ϕ k d 0 δ x 2 b n k x the discrete solution b n k x to eq 49 reads 50 b n k x p n k x p n 1 k x r k x r k 1 p e k 2 1 p e k 2 p e k u d 0 ϕ k the coefficients of the n order polynomials p n k x are determined by eq 49 by taking into account that x r x 1 2 r 2 1 r x 1 and δ x 2 r x r 1 2 r x 1 in equal porosity blocks all transport coefficients in eqs 14c 14e automatically reduce to zero with ω 2 d 0 and ω n 0 for n 3 in heterogeneous blocks m 1 k x u ϕ k ω 1 ω 1 u x u ϕ 1 s 1 k 0 eq 49 and b 1 k x read respectively 51a p e k x b 1 k p e k 1 ϕ k ϕ 1 δ x 2 b 1 k 51b b 1 k x x 1 ϕ k ϕ 1 b k a k r k x ϕ ϕ h the coefficients ak bk are determined with the three interface conditions 46 and eq 20 the effective continuity condition from eq 38 has the form of the asymmetric taylor expansion from the two interface sides this asymmetry of the leading order coefficient scales with p e k and vanishes only in the limit λϕ 0 the dispersion coefficient d ω 2 n u m is computed with eqs 16f and 18 52 d n u m d 0 d 0 ϕ k i ϕ k x b 1 k x i u ϕ k i b 1 k x i numerical result d num is reproduced exactly using eq a 6 for x b n k x i fig 5 displays the analytical solution kt rϕ pe and the symbolic prediction e kt from eq 43a versus space resolution per block h h 2 4 12 when pe 10 500 r ϕ 1 8 3 4 we observe that e kt increases with pe and the porosity contrast e kt is relatively large e g e kt 60 when r ϕ 1 8 with four nodes per block and the convergence is slower with the mesh refining when the porosity contrast is high since the modeled bulk equation is correct up to discretization the deficiency might be attributed to the leading order continuity condition in eq 38b and it should then reduce with a fig 6 confirms this prediction e kt reduces from 60 to 8 with a 1 4 10 1 and to 3 4 with a 1 4 10 2 here ϕk diminishes in one of the two blocks with porosity contrast and the leading order coefficient in continuity equation 38b degrades when the grid péclet number p e k increases interestingly the symbolic solutions reveal a very strong error variation between an even odd node number resolution per block e g the even node number is much more accurate when a 1 4 in fig 6 a similar situation is confirmed numerically the symbolic solutions also show that an additional scale parameter c e m c e from eq 27 may improve kt hence the discrete exponential symbolic solutions provide together with the summation and finite difference approximate trt emm numerical solution and allow to analyze it in the continuous parameter space however they become rather involved at the next orders and do not concern stability next section complements the trt emm symbolic analysis by numerical computations 5 4 the trt emm and trt ade in this section the trt emm and the three trt ade schemes 11 are examined on the base of their numerical solutions using the same parameter range the focus is put on the coarse resolution h 1 h 2 4 h 8 and high porosity contrast ϕ 1 1 12 1 ϕ 2 1 we set c e 1 30 λ 1 2 λ ϕ ϕ λ u 0 02 6 the reference emm solution is gathered in table 1 for kt sk s and ku s and illustrated in fig 8 bottom row whereas kt monotonously increases with the porosity contrast rϕ 0 sk s r ϕ and ku s r ϕ are not monotonous and their values are very small at the two limits r ϕ 10 1 and rϕ 1 this makes it very difficult to match them accurately the kt is asymptotically constant and its value slightly increases with pe the sk s and ku s decay with pe 5 4 1 numerical solutions by trt emm recall that trt emm is resumed in the algorithmic form in a 4 the trt emm sequentially solves eq 49 for n 1 2 3 in an unit periodic cell and computes the set ω 2 ω 3 ω 4 with eq 16f or eq 18 their dimensionless counterparts in eq 13 are obtained with l h and u 0 u x they are then employed for the three transport coefficients in eq 14 their relative corrections to the reference solution are gathered in table 2 using a 1 4 in eq 26a like in fig 6 a 1 4 results in very large errors at the high porosity contrast on the coarse grid and the amplitude of the relative corrections grow with the order n from e kt to e ku s table 3 shows that the three moments improve with λ ϕ 1 6 1 12 when r ϕ 1 4 high contrast this is especially true with e kt which diminishes with λ ϕ 1 12 up to the three orders of magnitude in agreement with fig 6 and the prediction from the interface taylor analysis in eq 38b the symbolic solutions allow for the search of the root a r ϕ r h h pe which solves e k t 0 as might be expected its value approaches to zero or becomes negative as one example λ ϕ 2 62 10 3 assures e k t 0 when r h 1 r ϕ 2 5 h 8 pe 18 29 in exact agreement with the numerical computations using this value e kt in table 3 reduces by two three orders of magnitude when r ϕ 1 4 1 2 furthermore this very small value λϕ improves drastically the kurtosis accuracy to conclude the trt emm three moments solution is very strongly impacted by the free tunable parameter a from eq 26a in the perpendicular darcy flow in series this situation is similar to a very sharp λϕ dependency in bounce back permeability measurements in dense solid arrays khirevich et al 2014 the optimal a value may differ in the three moments but their accuracy improves with the space resolution where their dependency upon λϕ diminishes 5 4 2 numerical solutions by trt ade we apply now the three trt ade d2q5 schemes 11 for the spatial dispersion in a series of porous blocks with the line release c x t 0 δ x x 0 the system is set periodic in the y direction the ade 1d from eq 11c and ade r from eq 12 produce the same solutions because the problem is one dimensional while trt emm was operated in one unit cell the direct solvers need a long array of the identical cells typically about 10 2 2 10 2 cells we measure the central spatial moments and derive ω 1 ω 4 from them see vikhansky and ginzburg 2014 53 ω 1 μ 1 t δ t μ 1 t δ t ω 2 μ 2 t δ t μ 2 t 2 δ t ω 3 μ 3 t δ t μ 3 t 6 δ t ω 4 μ 4 t δ t μ 4 t 24 δ t μ 4 t μ 4 t 12 μ 2 2 t 2 the obtained solution 53 is non dimensionalized with eq 13 and then employed in eq 14 unlike the trt emm the direct solvers do not reproduce exactly the gaussian result sk s ku s 0 when r ϕ 1 unless for very specific λϕ values which vanish the truncation corrections in particular they have been identified ginzburg 2017b with ade j in the uniform porosity constant velocity profile e sk s is predicted to vanish with λ ϕ 1 12 while the optimal kurtosis choice is λ ϕ 1 6 the present computations confirm these solutions with the three schemes 11 in identical blocks r ϕ 1 where these two particular choices reduce sk s and ku s by one order of the magnitude against λ ϕ 1 4 in two heterogeneous blocks the simulations are run using the trt emm numerical parameters given in the beginning of section 5 3 the highest porosity contrast r ϕ 1 25 complements these computations since these computations are conducted close to the stability line from eq 10e the ade c loses stability with λ ϕ 1 12 because of its negative numerical diffusion in agreement with the predictions ginzburg et al 2010 kuzmin et al 2011a mean velocity u x we observe that ade c and ade 1d both reproduce u x u h ϕ exactly but this is not the case of ade j its relative error e u u n u m u x 1 is displayed in table 4 we find that asymptotically e u 2 λ u h r ϕ r ϕ 1 2 in equal length blocks and it vanishes in homogeneous soil r ϕ 1 in agreement with the previous results e g ginzburg 2017a these and other results show that i e u scales in proportion to λ u ii e u is independent of ce and iii e u is independent of λϕ table 4 confirms that e u decays linearly with h and that the linear convergence is reached faster with the smoother porosity contrast hence e u pe c e λ 2 recall λ ϕ ϕ λ it reduces linearly when pe increases with 1 λ but remains the same when pe increases with 1 ce further inspection reveals that an observed alteration of the mean seepage velocity is caused by the discontinuity of the equilibrium term e q u in eq 11b indeed the effective continuity condition 28a predicts that the concentration will undergo an interface jump in the case of discontinuous weights when e q c x 0 0 concentration profiles in fig 7 confirm the presence of asymmetric interface jumps with ade j while ade c and ade 1d both produce very similar smooth profiles in highly heterogeneous blocks the dispersion coefficient kt the numerical solution kt rϕ and the relative error e kt from eq 43a are displayed in fig 8 for three schemes 11 their results are compared in table 5 we observe that k t d e f f and e kt increase together when the porosity contrast grows to r ϕ 1 25 nevertheless all schemes match kt within 10 15 in a small cell h 1 h 2 h 2 4 despite the mean velocity error the ade j is the most accurate among the three schemes using the stable choice λ ϕ 1 4 the accuracy of the direct solvers with λ ϕ 1 4 is similar to trt emm results obtained with very small value a see tables 2 and 3 and much better than those which trt emm produces with a 1 4 λ ϕ c e 1 30 0 259 the ade c and ade 1d have very similar results in highly heterogeneous blocks however while e kt converges to zero when rϕ 1 with ade j ade 1d e kt diverges with ade c because of the numerical diffusion d u x since the averaged coefficient d u sums with the numerical dispersion then 54 e k t ade c e k t ade j e u k t e u k t d u d e f f k t d u λ u 2 h ϕ λ ϕ ϕ λ this estimate fits well e kt ade c in fig 8 hence ade c is unsuitable for measurements of small valued kt but the three schemes produce similar dispersion values at high porosity contrast where the taylor and numerical dispersion dominate numerical diffusion skewness sk s and kurtosis ku s the ade j results for skewness and kurtosis are displayed in fig 8 with different λϕ values the ratio of ade j relative errors to ade c and ade 1d is compiled in table 5 for λ ϕ 1 4 in that case the ade c is the most accurate for the two high moments at the high porosity contrast where it is followed by the ade 1d but the ade j gains at relatively small contrast on the whole the distinctions between the three schemes are very small for skewness and their results are comparable with the trt emm in table 2 although the difference between three schemes increases up to a factor of two for kurtosis they remain much more accurate than trt emm let us compare now the results in series with the truncation prediction ginzburg 2017b in homogeneous soil like in that case λ ϕ 1 12 reduces e sk s by the one order of magnitude in small porosity contrast but only twice in highly heterogeneous blocks where e sk s is dominated by the implicit interface rather than bulk truncation in turn the computations with very small value λ ϕ 3 10 2 uniquely placed in the interface nodes show a drastic improvement of e sk s the ade j and ade 1d show very similar results reducing λϕ but ade c becomes unstable in this limit fig 8 displays e ku s with λ ϕ 1 12 1 6 1 4 λ ϕ 1 6 remains most accurate in highly heterogeneous blocks the three schemes show here similar results 5 5 summary construction of the exact steady state symbolic solutions is extended from the streamline invariant channel configurations ginzburg 2007 ginzburg et al 2015b to the streamwise heterogeneity in the presence of a space variable mass source and an interface flux jump the symbolic trt emm solutions validate the interface taylor analysis developed in a more general framework the numerical results confirm that the steady state solutions can be parameterized by the dimensionless group rϕ rh pe provided that the two free parameters λϕ and ce are inter related through eq 26a the transport coefficients then all become dependent on one free parameter a except the effective diffusivity d e f f and sk s 0 which are exact solutions of the trt emm pure diffusion scheme at the two first orders n 1 and n 2 respectively at order n 3 ku s 0 is exact in the homogeneous porosity otherwise the two distinguished solutions a produce the reference value ku s u m from eq b 2 with the implicit and the semi explicit interface jump trackings they are useful for implementation check it is confirmed numerically that the ω form and γ form produce identical moment solutions in the darcy flow in series using transform 15 provided that a takes the same value in both formulations in the darcy flow the inexactness of the closure relations penalizes the strong porosity contrast and the discrepancy typically increases with the order n from kt to ku s we find that only very small values a improve the transport coefficients on the coarse grid since this choice may cause instability we should conclude that the trt emm needs relatively fine grids in series at the same time the three direct trt ade schemes 11 are examined in heterogeneous series of porous blocks we note that ade j is exact for u x and d 0 but not for sk s and ku s in uniform porosity darcy flow with heterogeneous blocks in series ade j produces interface jumps in the concentration solution and they intrinsically modify the mean seepage velocity this effect is caused by the heterogeneity of the correction e q u in eq 11b indeed it plays the role of the discontinuous symmetric weights the relative ade j velocity error reduces linearly with the space resolution and diffusion eigenfunction λ but grows linearly with the velocity amplitude ade c and ade 1d reproduce the mean seepage velocity exactly nevertheless ade j remains here most accurate for the dispersion coefficient the ade c omits the discontinuous correction e q u consequently it produces much more continuous profiles but becomes relatively inaccurate when kt is small small porosity contrast and the numerical diffusion from eq 54 dominates the taylor and numerical dispersion the ade 1d from eq 11c manifests itself as a good compromise in the examined parameter range the three schemes are expected to have similar accuracy at high pe but differ for stability in the present computations the ade j is the most stable among the three schemes when λϕ takes small values and also improves the skewness coefficient to conclude the direct solvers behave more accurately with the stable choice λ ϕ 1 4 than the trt emm with a 1 4 λϕ 0 259 however they are restricted to the coarse resolution where their solutions especially skewness and kurtosis strongly depend on λϕ in compliance with the predicted ginzburg 2017b moments truncation impact in constant and parabolic profiles although the trt emm needs a finer resolution for the strong heterogeneity in series it is much more capable than the direct solvers for high pe and weak λϕ dependency with the help of the grid refining 6 stratified flow it has been demonstrated ginzburg and vikhansky 2018 that in the case of a constant darcy flow the non gaussian effects are much stronger in the heterogeneous stratified channels than in porous blocks in series the two systems are sketched in fig 2 in this section the stratified system is rotated and the velocity field is parallel with the x axis in compliance with eq 16 the emm and trt emm symbolic solutions will be compared in i poiseuille flow ii bounded system of open and diffusive layers and iii stratified double periodic brinkman flow respectively sketched in figs 9 10 and 14 in a stratified channel or duct flow u ϕ u ϕ x y z 1 x the b field solution bn y z is streamwise invariant u ϕ b n 0 and eqs 16b 16e read with j n 0 s n 0 thereby eq 16a reduces to the diffusion equation 55 m n y z d ϕ y 2 z 2 b n y z n 1 interface conditions 17b prescribe the continuity for bn y z and for the normal flux on the flat surface aϕ y z separating any two porous layers b n a ϕ y z 0 and d ϕ n b n a ϕ y z 0 eq 17c prescribes zero diffusion flux on the solid surface eq 18 becomes 56 ω 1 u x ω 2 d 0 u ϕ x b 1 ϕ ω n u ϕ x b n 1 ϕ n 3 the sets ω n γ n from eq 13 and the transport coefficients from eq 14 obey see ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 57 k t p e 2 pe ω n pe n 1 γ n pe n 1 pe sk s pe ku s pe sk t pe ku t pe the trt emm operates in the stratified geometry with j n 0 in eq 19 and s n 0 in eq 16e the system is closed with the continuity condition 28a and either a symmetric periodic or bounce back no flux condition 29b on the horizontal ends the effective interface continuity condition b n x x 0 0 is elaborated in eqs 34 36 it is exact with the midway interface position when bn y is linear λϕ and when bn y is parabolic with a 1 8 eq 42b the b field b 1 y is parabolic in a stratified darcy flow because the mass source m 1 y is a piece wise constant a recursive construction of the symbolic solution of the trt emm follows the emm exact procedure ginzburg and vikhansky 2018 but the averaging integration in eqs 16 and 20 becomes performed via summation of the grid values with ω 1 u ϕ x y ϕ y u s u m 6 1 straight poiseuille flow in poiseuille flow u ϕ x y 3 2 u x 1 4 y 2 h 2 ϕ y 1 the emm and trt emm solutions bn y to eq 25 are order 4n polynomials the reference emm solutions for ω n γ n and the transport coefficients from eq 14 are provided ginzburg and vikhansky 2018 see tables 2 and 3 the coefficients of bn y are set by eq 25 except the first and zeroth orders the coefficient of the linear term is set by the bounce back closure but its value does not affect the solution for ωn in eq 56 because u ϕ x y y 0 hence the transport coefficients are not affected by an exact location of the no flux boundary inside one mesh spacing when n 1 m 1 y u s u m u x y δ y 2 m 1 y 2 u ϕ x y b 1 y solves m 1 α m y 2 u ϕ x d 0 δ y 2 b 1 y and eq 56 produces the dispersion value d n u m ω 2 n u m the dispersion coefficient kt from eq 14c obtains solution 58a k t n u m pe 2 210 20 21 h 2 pe 2 210 h 6 α m 4 5 h 2 h 4 pe 2 5 h 6 pe u x h d 0 58b k t n u m pe 2 210 20 21 h 2 pe 2 210 h 6 if λ ϕ 1 4 1 c e α m 0 the second order correction α m pe 2 5 h 2 to the taylor value k t pe 2 210 has place because of the parabolic distribution m 1 y when a 1 4 and αm vanishes with eqs 26a and 42a the remaining correction in eq 58b decays with fourth order rate in fact eq 58b is the discrete counterpart of the taylor solution when the taylor ansatz taylor 1953 is solved with the discrete laplacian and integration is performed via summation see ginzburg and roux 2015 ginzburg and vikhansky 2018 using a 1 4 this property remains valid for all higher orders the difference with the exact solution is only due to the discrete laplacian and the summation effect using eq 42a fig 9 displays the corresponding relative errors versus channel resolution when pe 1 103 for e d e sk s and e ku s from eq 43 it is shown that e d is very small and it becomes pe independent as pe 102 at the same time e sk s and e ku s increase progressively with the order n but they decrease very rapidly with the grid refining and agree within 5 with the emm when h 10 the relative corrections are almost pe independent because kt sk s and ku s obey the pe scale from eq 57 on the numerical solution the effective transport coefficients of the ade j scheme 11 in a straight radial poiseuille flow have been derived ginzburg 2017b ginzburg and roux 2015 using a coordinate stencil in a straight channel the first moment produces mean velocity u s u m exactly the second moment reproduces eq 58b only provided that the numerical dispersion vanishes thanks to λ ϕ 1 4 1 c e λ 2 see eqs 72 76 in ginzburg and roux 2015 with this choice λ ϕ 1 4 when ce 0 pe and the trt emm with eq 42a shares the same property an advanced stability ginzburg et al 2010 of λ ϕ 1 4 was confirmed ginzburg and roux 2015 in poiseuille profile at high pe we have also compared the highly accurate truncation estimate ginzburg 2017b for sk s and ku s against the trt emm solutions with a 1 4 in the limit ce 0 the ade j with λ ϕ 1 4 shows very slightly more accurate results than the trt emm to conclude and to be contrasted with the darcy flow in series it is underlined that in poiseuille flow the direct solvers and trt emm produce very similar results around stable choice λ ϕ 1 4 6 2 a bounded stratified open diffusive system we consider a system of two parallel layers of the thickness h 1 and h 2 bounded at y 0 and y h h 1 h 2 the system is sketched in fig 10 the bottom layer has porosity ϕ and zero velocity u ϕ 0 the top layer mimics a fracture ϕ 1 and velocity profile u ϕ x y is parabolic there the transport coefficients in eq 14 are set by pe ϕ and an aspect ratio r h h 1 h 2 they obey pe scaling from eq 57 and reduce to the poiseuille solution when either r h 0 or ϕ 0 the set γ n from eq 13 is constructed vikhansky and ginzburg 2014 eqs 124 132 and extended for a radial capillary the reference solution ginzburg and vikhansky 2018 for ω 2 ω 4 is employed here ginzburg and vikhansky 2018 eqs c 10 c 12 with r b r h 1 the described here open diffusive two layered bounded system is similar but not identical with a fracture embedded into diffusive matrix also extended ginzburg and vikhansky 2018 to the porous brinkman flow in a fractured layer since the solute may diffuse into the impermeable layer the fracture diffusive matrix manifests strong deviations from the gaussian prediction fig 10 illustrates the porosity and aspect ratio effects in pe independent solutions kt pe 2 and the two asymptotes sk s pe 1 2 and ku s pe 1 it is shown that at fixed pe kt monotonously increases with rh and ϕ in contrast when the diffusive layer is not too much thick sk s and ku s manifest very sharp peaks where their amplitudes grow when ϕ diminishes unlike in poiseuille profile where sk s 0 the profiles are shifted right sk s may change its sign in the presence of the diffusive matrix the direct computations vikhansky and ginzburg 2014 with the ade j scheme 11b of the spatial release and rtd in temporal process demonstrate very sharp distribution profiles and agree with the emm prediction e g within 5 for all three moments at small porosity ϕ 10 1 and pe 14 in a channel of h 12 the trt emm solves eq 25 for n 1 b n k y is the 2n polynomial in a porous layer k 1 and 4 n polynomial in an open layer k 2 the symbolic system is closed by eq 28a at the interface and by the bounce back closure relation 28b in two boundary nodes y 1 2 and y h 1 2 a constant is fixed with eq 20 the closure relations are all prescribed with the use of eqs 19 22 and 24a similar as in eqs 32 35 the transverse central differences are all computed on the one layer solution eq 36d tells us that when λϕ obeys eq 42a then the continuity condition b n y y 0 0 is not located midway at y 0 h 1 as a result the dispersion coefficient kt obtains second order parameter dependent correction which vanishes for poiseuille flow in eq 58b the constructed symbolic solutions for the three transport coefficients agree exactly with the trt emm numerical solution and they are employed to explore the accuracy of the scheme within a continuous parameter space the symbolic solutions are formally defined for any rh and h 2 the numerical system has an integer number of cells per layer e g r h 1 implies numerically that h is even figs 11 13 display e d e sk s and e ku s at pe 10 2 towards h in fig 11 the two layers have the same thickness r h 1 but ϕ varies ϕ 10 2 1 2 in figs 12 and 13 ϕ 10 1 but the porous layer is thinner rh 1 and thicker rh 1 respectively than the open one fig 11 shows that kt is more accurate with the smaller ϕ however sk and ku become less accurate when ϕ diminishes the results displayed in fig 12 show that e d improves when rh reduces to zero and the system approaches the poiseuille flow e sk s and e ku s are not monotonous with rh r h 0 and r h 1 are more accurate than rh 0 1 fig 13 shows that when an open layer is not resolved sufficiently e g r h 4 h 2 1 when h 5 or h 2 2 when h 10 kt becomes very inaccurate at the same time sk s and ku s are much less affected by rh in resume because of an inexact interface continuity condition the trt emm is less accurate than in open flow but the errors decay rather rapidly with the space resolution when ϕ 10 1 the three transport coefficients agree with the reference result within 5 with 5 mesh spacings per layer using a 1 4 this is comparable with the measurements of the kurtosis in pure diffusion in series with porosity contrast r ϕ 10 1 and it is much more accurate than in a perpendicular darcy flow cf table 2 6 3 porous brinkman flow we construct the reference emm solutions in stratified brinkman flow in section 6 3 1 and compare them with the symbolic trt emm solutions using the exact and discrete velocity profiles in section 6 3 2 6 3 1 the emm is stratified porous flow consider a stratified system of two porous layers of porosity ϕi permeability ki and width hi i 1 2 separated by a flat interface at y y 0 h 2 h 1 h h 1 h 2 the velocity profile u ϕ u ϕ x y 1 x solves brinkman equation brinkman 1947 in the form ginzburg et al 2015b 59 ν ρ 0 k i u ϕ i x p ν ρ 0 f i ϕ y 2 u ϕ i fi ϕ 0 1 determines brinkman viscosity ν f i ϕ lim ϕ i 1 f i ϕ 1 and typically f i ϕ 1 or f i ϕ ϕ i velocity profile reads in the ith layer 60 u ϕ i y x p ν ρ 0 k i a i e ξ i y c i e ξ i y ξ i f i ϕ k i the velocity and shear stress are set continuous on the interface u ϕ x y y 0 0 and ν f i ϕ y u ϕ i y y 0 0 respectively we consider a double periodic system along the x and y axes which is sketched in fig 14 together with the profile u ϕ i y a bounded system can be addressed similarly with the limiting case of the open diffusive matrix from section 6 2 when permeability tends to zero in one layer and becomes infinite in the other in the double periodic system the four constants in eq 60 are derived from two interface conditions and two symmetry relations in the middle of each layer prescribing fi ϕ the velocity profile can be formulated in terms of the dimensionless darcy number d a k d h 2 with k d k 1 h 1 k 2 h 2 h the permeability contrast and the aspect ratio when the permeability has the same value in the two layers k i k d the double periodic system reduces to a constant parallel darcy flow u ϕ i y x p ν ρ 0 k d the brinkman profile 60 falls to the darcy regime at small da and to the stokes regime at very high da the interface effects become important at the intermediate brinkman regime e g see silva and ginzburg 2016 the emm exact solution for the transport coefficients in eq 14 has been constructed and analyzed in a parallel darcy flow ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 through stratified porosity and in a single bounded porous channel ginzburg and vikhansky 2018 the darcy system presents an interesting example where the complex dispersion behavior is solely due to the porosity contrast this system manifests much stronger non gaussian effects than the perpendicular darcy flow in series at the same porosity contrast and pe in a single porous channel the transport coefficients are set by two dimensionless parameters f ϕ da and pe the relative dispersivity k t pe 2 is predicted to decrease from the stokes to the darcy regime and to increase when f ϕ decreases with ϕ at fixed da exact solution for the transport coefficients in a fracture embedded into porous brinkman flow has been constructed and confirmed numerically ginzburg and vikhansky 2018 this system can be regarded as the limit system of the double periodic brinkman flow system all these stratified systems obey the pe scaling from eq 57 in brinkman flow b n i y solves eq 55 where the source term m n y is computed with eq 16b on the profile 60 solution b n i y reads in terms of the 2k order polynomials p i 2 k y and x i 2 k y as follows see also dimensionless form ginzburg and vikhansky 2018 61 b n i y k 0 n p i 2 k y e n k ξ i y k 0 n x i 2 k y e k n ξ i y n 1 when k 1 k 2 b n i y reduces to the 2n order polynomial in the darcy flow the coefficients in eq 61 except the zeroth and first order terms are set by eq 55 the three remaining coefficients are fixed through the interface continuity condition b n i y y 0 0 and the two symmetry conditions the remaining constant is fixed by eq 20 the final expressions are lengthy but they allow to explore the transport coefficients in the full continuous parameter space once the set ωn is constructed the set γn is derived from it with eqs 13 and 15 the two sets determine the transport coefficients in eq 14 they obey the pe scale in eq 57 let us exemplify the role of the brinkman viscosity in the two systems f i ϕ 1 and f i ϕ ϕ i fig 15 displays the relative effective permeability kb kd k b u ϕ x ν ρ 0 x p and the three transport coefficients versus d a 1 2 h k d in two equal thickness layers with r ϕ ϕ 1 ϕ 2 10 1 and r k k 1 k 2 10 3 it is shown that kb reduces with fi ϕ in the transition brinkman zone d a 1 2 10 50 the dispersion coefficient kt decays towards the darcy regime and it only weakly depends upon brinkman viscosity the difference between f i ϕ 1 and f i ϕ ϕ i monotonously increases in sk s and ku s towards the darcy regime together with their absolute values in the stokes zone sk s pe 1 2 and ku s pe 1 almost coincide for pe 10 2 and pe 10 3 meaning that the asymptotic regime 57 has been reached like in an open flow however the asymptotes need much higher pe in the darcy zone in resume like in the single porous channel ginzburg and vikhansky 2018 k t pe 2 decreases from the stokes to the brinkman darcy regime but the non gaussian effects are predicted to grow towards the darcy zone fig 14 illustrates the reconstructed mean concentration and the rtd profiles in spatial and temporal systems the two profiles are displayed together one in darcy s range d a 1 2 56 5 and another one in highly permeable zone d a 1 2 1 20 56 5 porosity and permeability contrasts correspond to fig 15 the reconstruction of the profiles is based on the entropy maximization bandyopadhyay et al 2004 respectively constrained to the predicted spatial or temporal system of the first four moments following vikhansky and ginzburg 2014 ginzburg and vikhansky 2018 the normalized dispersion independent distributions are displayed in a moving frame i σ c x t versus x x x 0 u x t σ σ μ 2 t 2 d t and ii the rtdσp x τ versus τ t t σ t x u x σ μ 2 x 2 d u x 3 x as has been expected from the predicted moments the profiles are more asymmetric and sharp in the darcy zone mean concentration profiles are skewed right since sk s 0 the rtd are typically skewed left sk s 0 because of the heaviside entry these profiles can be compared to their counterparts in poiseuille flow and in the limit case of a fracture embedded into diffusive matrix see results for pe 740 in figs 10 22 and 23 in ginzburg and vikhansky 2018 the profiles are clearly more asymmetric in the stratified brinkman system than in an open flow in the limit system their form depends on the porosity in the diffusive layer the constructed emm moments are employed now to verify the trt emm 6 3 2 the trt emm in stratified porous flow we construct symbolic trt emm solutions in brinkman velocity profile extending the known classes of the exact solutions the polynomials cui et al 2016 ginzburg 2007 2017a and the discrete exponents ginzburg et al 2015b the symbolic solutions allow to examine the response of the transport coefficients on the numerical formulation but also on the quality of the velocity field e g when brinkman flow is computed with the discrete numerical scheme let us assume that the velocity profile u ϕ i y solves the discretized brinkman equation ginzburg et al 2015b in the layer i 62 ν ρ 0 k i u ϕ i x p ν 1 δ i f i ϕ ρ 0 δ y 2 u ϕ i and reads 63 u ϕ i y x p ν ρ 0 k i a i r i y c i r i y r i 1 b i 1 b i b i ξ i 2 ξ i 2 4 1 δ i ξ i f i ϕ k i as seen the brinkman viscosity ν f i ϕ gets the relative correction δi with the different numerical approaches like the finite elements finite differences or lbm schemes because the truncation term δ x 2 ν ρ 0 k i u ϕ i y due to the laplacian of the resistance sums with the viscous term see ginzburg et al 2015b and ginzburg 2016 this correction is similar with the αm term in eq 25 the coefficients ai ci in eq 63 are set by the effective interface conditions of a given scheme in principle the symbolic solutions allow to examine an impact of the correction δi or the implicit interface flow conditions on the transport coefficients in this work we only verify for the discrete effect between an analytical velocity profile 60 and a model finite difference profile referred to as ideal ifd it solves eq 62 with δ i 0 and second order accurate taylor expansion in interface boundary conditions see ginzburg et al 2015b and silva et al 2017 note that eq 63 coincides with eq 60 in grid nodes provided that r i e ξ i this condition can be formally fulfilled prescribing eq 63 with a model value f i n u m 64 f i n u m 2 1 δ i k i cosh ξ i 1 thereby once the trt emm symbolic solution is built for the discrete profile 63 it describes the numerical solutions computed with the exact profile using eq 64 and exact coefficients ai ci from eq 60 solution bn y to eq 25 is searched in the form 65 b n i y k 0 n p i 2 k y r i n k y k 0 n x i 2 k y r i k n y similarly as in emm solution 61 the coefficients are determined by eq 25 except the zero and the first order term the three remaining coefficients are fixed through the continuity condition eq 28a with eqs 22 24a similar as in eqs 32 35 and the symmetry conditions in the middle of each layer the remaining constant is set with eq 20 the constructed solutions for ω 2 ω 4 and γ 2 γ 4 coincide with the trt emm numerical solutions for the different type numerical profiles 63 and analytical profile 60 as one example the four experiments in two equal thickness layers combine d a 10 2 10 4 and pe 10 10 2 the reference emm values are gathered in table 6 fig 16 displays the relative differences trt emm to emm together for eqs 60 and 63 in brinkman zone d a 10 2 and darcy zone d a 10 4 the first diagram shows that the relative velocity error u s u m to u x is most significant on the numerical profile in the brinkman zone and it reduces to about 5 only when we have h 2 10 nodes per layer the numerical profile then produces the most large corrections in the three transport coefficients this example suggests that an accurate description of the velocity gradients is essential for the accuracy in the first four moments these symbolic experiments were also run with pe 10 cases c and d from table 6 in these and other experiments the trt emm with pe 10 is more accurate for the dispersion coefficient against pe 10 2 but the situation is reversed for e sk s and e ku s on the coarse grid e g e sk s is larger by a factor of three and e ku s is twice larger with pe 10 against pe 10 2 the described behavior is similar to the truncation estimate ginzburg 2017b of the moments in ade j scheme 11b because when sk s and ku s are very small with small pe the numerical corrections may become relatively large fig 17 compares trt emm with λϕ from eqs 42a and 42b on the analytical velocity profile 60 with the parameter setting from table 6 on the one hand α m 0 in eq 25 using eq 42a the transport coefficients corrections are then solely due to the implicit interface tracking and the summation effect on the other hand kt is exact in the darcy flow using eq 42b see eq 36b fig 17 shows that effectively eq 42b is more accurate for the three coefficients on the coarse grid in the darcy regime d a 10 4 bottom row this is especially true with kt in the intermediate zone d a 10 2 top row the situation is reversed for all the three coefficients and eq 42a is one order more accurate on the coarse grid especially for sk s and ku s the results for pe 10 are similar in the two cases c and d from table 6 to conclude second order accurate brinkman numerical velocity profile causes additional corrections in the three transport coefficients of the same order magnitude as the trt emm with eq 42a has in the exact profile cf bottom row in figs 16 and 17 using the analytical velocity profile in the brinkman regime the trt emm retains its solution within 10 when having h 2 5 mesh spacings per layer such a precision is quite comparable with the limit case of an open layer adjacent to the diffusive matrix from section 6 2 and it is much better than what we have observed for the darcy flow in series the darcy regime may require to reduce λϕ towards eq 42b because when the velocity profile is relatively flat the interface effects dominate the truncation due to the velocity variation in the mass source we note that the non uniform and flow regime dependent λϕ distribution has been also suggested in trt brinkman flow modeling ginzburg et al 2015b 6 4 summary the trt emm numerical formulation 19 was examined on the base of its symbolic solutions in several stratified systems open fracture diffusive matrix and heterogeneous porous flow for the sake of their validation the emm exact solutions ginzburg and vikhansky 2018 were extended to the stratified brinkman flow the trt emm behaves similarly to the direct solvers and much more accurately in a parallel flow than in a perpendicular flow the trt emm transport coefficients are identical with the ω form and γ form using eq 15 in stratified channels provided that the free collision product λϕ and the truncation coefficient αm in eq 25 take the same values in the two formulations their solutions are entirely parameterized by pe when λϕ and ce are inter related through eq 26a the transport coefficients then obey the pe scale from eq 57 exactly for any individual value of the characteristic velocity ce λ and λϕ but they depend upon the free tunable parameter a from eq 26a in the stokes brinkman regime a 1 4 is efficient because it vanishes the principal truncation correction due to the mass source variation with velocity however in the darcy zone a 1 8 is preferable for its advanced interface accuracy in kt measurements it was shown that the bad quality of the velocity field may predominate over the truncation accuracy in the presence of the high velocity gradients and impair the prediction of moments as a reminder the direct solver 11b produces the first moment with the effective velocity u s u m in a straight bounded channel only if using the coordinate discrete velocity stencil otherwise the effective mean velocity becomes modified in proportion to the diagonal velocity weight tq in eq 10b see ginzburg 2017a in addition to the reported results we observe that the direct ade schemes extend this deficiency to stratified heterogeneous interfaces this property is to be contrasted with the trt emm although its symbolic solutions were built with the d2q5 discrete velocities the trt emm stratified flow solutions are identical for d2q5 and d2q9 because of the streamwise invariance of the steady state solutions bn y in straight channels thereby the weight independence of the transport coefficients in the basic configurations is another advantage of the steady state trt emm approach against the direct simulation of moments 7 heterogeneous porous flow we examine the trt emm and three direct ade schemes for temporal and spatial dispersions in brinkman flow around solid and porous obstacles section 7 1 describes geometry and flow sections 7 2 and 7 3 address the numerical aspects of trt emm and lbm ade respectively section 7 4 examines the physical insight on the obtained transport coefficients 7 1 geometry and flow we consider two dimensional steady state flow through a periodic porous system consisting of two equivalent rectangular obstacles depicted in fig 18 the two obstacles are either solid ϕ 0 or porous ϕ 1 8 1 4 1 2 3 4 19 20 the basic cell has the size x h 56 40 l u it is periodic along the x axis and bounded by two horizontal solid walls the two obstacles x y 8 32 are distanced by 8 mesh spacings their centers are located at x y 20 16 and x y 36 24 the linear brinkman velocity field u ϕ x y is governed by a constant body force f f x 1 x 66 ν ρ 0 k u ϕ p f ν ρ 0 f ϕ δ 2 u ϕ the velocity field is solved with the d2q9 ibf lbm interface implicit scheme ginzburg et al 2015b using the bounce back no slip rule on the solid surface the resistance is prescribed with the permeability value kf in a surrounding flow and km inside a porous obstacle the ratio k f k m 10 8 is the same in the two flow experiments hereafter referred to as exp i and exp ii with k f k m 4 10 7 10 1 l u d a 1 2 63 25 10 4 1 in exp i and k f k m 4 10 5 10 3 l u d a 1 2 63 25 10 3 10 in exp ii the two darcy numbers kf h l 2 km h l 2 are kept fixed in l times refined cell without obstacles the channel flow approaches the stokes poiseuille limit the streamlines in fig 18 allow to observe the flow effect due to the low permeable obstacles in exp ii table 7 compiles the ratio of the effective mean permeability k to its open flow value kp the case of the solid obstacle is very similar in the two experiments with k 7 57 10 3 k p otherwise the mean permeability contrast between the two experiments is about 2 53 the porosity ϕ impacts the velocity field only through the brinkman viscosity value ν b ν f ϕ the effective permeability depends very weakly on ϕ and the transport coefficients are practically the same for the flow computed with ν b ν ϕ and ν b ν 7 2 the trt emm numerical set up the trt emm applies algorithm from appendix a 4 and it solves eqs 16 17 using the trt collision 8 with the equilibrium 19 the mass source m n r and the flux jump j n r in eqs 16b 16e are computed in ω form with eq a 1 and in γ form with eqs a 2 a 5 we aim to verify the equivalence of the two formulations in this two dimensional field the velocity field is precomputed in the unit cell due to the linearity of the flow its arithmetical mean value u s u m u ϕ x ϕ is rescaled to the same value in all configurations prescribing ϕ r the velocity field and pe u s u m h d 0 the computations of eqs 16 17 are performed three times sequentially for n 1 2 3 their steady state solution b n r is then normalized with eq 20 and b n r is used to precompute m n r and j n r for the next orders namely n 2 3 4 one does not need to solve the system at n 4 because ωn is determined with eq 16f or eq 18 and γn is determined with eq a 4 from the previous level solution no flux condition is enforced with the bounce back rule the total mass in the system is conserved at each time step because of the solvability condition m n 0 while the exact global mass conservation provides a very valuable numerical test we find it more difficult to validate exactly with the γ form because of the round off summation effect due to very large increase of the values γn with n as one example the two sets ω n n u m and γ n n u m are illustrated in fig 19 in a given configuration the dimensionless coefficients in eq 13 ω n ω n u x h n 1 and γ n γ n u x n h n 1 should remain fixed by pe it has been confirmed that ω n n u m and γ n n u m follow this dimensionless scaling when u x and h vary further we confirm that the set ω n γ n n u m obtained with eq 15 practically coincides with the numerical solution ω n n u m obtained with the ω form the relative difference between the two sets is exemplified in the last diagram in fig 19 we note that eq 15 provides another very useful implementation check therefore the two numerical formulations ω form and γ form produce the same solution for the dispersion coefficient kt and any one of them can be run for the prediction of the four transport coefficients in eq 14 hereafter we will display the relative differences of the transport coefficients to their open flow counterparts at the same pe they are labeled as δd for d 1 k t d 0 δ sk s δ ku s for sk s ku s and δ sk t δ ku t for sk t ku t respectively the reference open poiseuille flow solutions is given in table 3 ginzburg and vikhansky 2018 the simulations are run at pe 7 4 74 740 in the basic cell and pe 7 4 10 102 103 in five times finer cell stability bound from eq 10e is adopted as an approximate although in several points this condition was not satisfied when pe 74 e g in basic cell flow around the solids and in exp ii using u x r e f u s u m 0 0355 c e 1 30 stable results have been most of the time achieved using λϕ from eq 42a λ ϕ r e f λ ϕ c e 1 30 0 259 as it might be expected eq 10e is not a necessary stability condition in a space variable velocity field in the rigorous sense but it provides a very reasonable estimate e g the smallest porosity value ϕ 1 8 becomes most unstable when λ ϕ reduces for higher pe the d2q5 scheme operates with four free parameters ce λ λϕ and βe recall that when ce and λϕ are linked through eq 26a the solution becomes independent of the two separated values ce and λ provided that their product d 0 c e λ is fixed either in a perpendicular or a parallel one dimensional flow this property remains valid in one dimensional flow when the obstacles have the same porosity and permeability as the surrounding flow for example if we employ the two sets c e λ λ ϕ 1 30 1 3 λ ϕ r e f and 1 3 1 3 10 3 8 with the same value d 0 c e λ the difference δ d δ sk s δ ku s with the open flow will be identical in the two cases and very small because the flow approaches the open regime as 0 07 2 21 10 7 0 13 in the basic cell at pe 74 exp ii however this exact parameterization property of eq 26a is not valid in a two dimensional flow e g in the presence of the solids the relative difference between the two sets is 8 7 0 58 0 15 in the basic cell but only 0 29 0 01 0 01 for a five times finer cell similarly in the absence of solids when ϕ 3 4 the relative difference between the two parameter sets is 1 48 4 15 0 46 in the basic cell and it reduces to 0 07 0 05 0 02 in the refined cell this loss of the exact parameterization is because eq 24a is not exact any more and eq 25 obtains a different truncation component the effect of λϕ decays here approximately as h 2 for all moments since the trt emm applies in a single cell the insensitivity to the free parameters can be achieved over fine grids it is important to stress that the transport coefficients are all exactly parameterized by pe and ce meaning that they remain the same when the velocity field and diffusion eigenfunction λ scale accordingly the steady state solution b n r is independent of the acceleration parameter βe in eq 10 when βe 1 ce and velocity amplitude should reduce approximately linearly with βe according to stability estimate in eq 10e the trt emm computations are stopped when the relative difference in δd δsk and δku is less than ϵ 10 11 over successive 5 102 steps fig 20 shows that the number of steps to steady state is nearly the same in the three equations n 1 2 3 the number of steps decreases linearly with the u x or βe increase that is nearly the same computational time is required with u x β e 10 u x r e f 1 or u x β e u x r e f 10 since the small velocity amplitudes are more accurate because of the truncation corrections βe is expected to be helpful the results in fig 20 correspond to exp ii in ω form the γ form typically requires a slightly larger number of steps we note that when pe increases linearly due to the mesh refining the number of steps to steady state increases slightly finally it has been suggested ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 that the mass source component sn and flux jump j n from eq 16e can be dropped at sufficiently high pe provided that the sets ω n and γ n grow with pe for n 2 e g like in eq 57 with stratified flow in fact these two terms originate from the diffusion term in eq 1 and they cannot be omitted in a diffusion dominated process like in series of heterogeneous porous blocks where ω 2 is asymptotically constant and decays with pe for n 3 see eq 48 fig 21 displays the relative differences in δd δ sk t and δ ku t between two emm solutions with and without s n j n in the two flow experiments in both of them the three relative differences diminish from the interval 20 40 at pe 7 4 to about 1 at pe 740 but they are still noticeable for δ sk t and δ ku t at pe 74 in exp i since the spatial and temporal moments are inter related through eq 15 a similar situation will take place with δ sk s and δ ku s these simulations confirm that in the presence of the fractured velocity path sn and j n can be omitted at sufficiently high pe making numerical implementation much more simple 7 3 the direct ade schemes numerical set up we model the spatial and temporal dispersion with the three d2q5 schemes ade c and ade j from eq 11 and ade r from eq 12 the bounce back is applied on the horizontal walls and solid obstacles for the spatial spread an evolution of the plume distribution c x x 0 y t 0 1 is run through 10 2 2 10 2 basic cells the raw moments μ n t x y ϕ x y c x y t x x 0 n d x d y are normalized with μ 0 t and employed to compute the central moments μ n t for n 2 3 4 the set ω n n u m is derived from the moments with eq 53 and normalized with eq 13 it determines u n u m k t d d 0 1 and sk s ku s with eq 14 as the reference example for ade j in open poiseuille flow through a basic cell h 40 we obtain u n u m u s u m and the relative errors 0 027 0 53 0 1 for d sk s and ku s respectively using the porous flow parameter set pe 74 c e 1 30 u x u x r e f λ ϕ 1 4 the trt emm convergence criteria is adopted but the stop value is much higher typically ϵ 10 6 we note that the ade schemes then only approximately reach the taylor regime with the same order of steps as the trt emm needs to converge to the steady state it follows that operating in a single cell the trt emm is hundreds time faster already in the small pe range further since the time to the taylor regime and accordingly the number of the unit cells increases linearly with pe the ade computational time increases as pe2 we also note that trt emm with λ ϕ c e 1 30 0 259 from eq 42a behaved much more robustly than the three direct solvers in spatial dispersion as one example the trt emm reaches pe 740 in the basic cell except ϕ 1 8 in exp i while ade r becomes undefined in exp ii with all examined porosity values when pe 74 because λ ϕ 1 becomes negative in several points cf eq 12c the temporal dispersion is modeled with the zero initial distribution c x y t 0 0 the dirichlet boundary condition c x 0 y t c b is prescribed with the anti bounce back rule 29a in boundary nodes r b x 1 2 y using c c b 1 in e q r s the rtd distribution p x i t 1 2 c x i t c t 1 x i is monitored at each time step in a pre selected set of the grid points xi the rtd central moments μ n x t t t x i n p x i t δ t t t 1 2 δ t 1 are accumulated in time using the effective centroid value t x i μ 1 x i the raw moments are all normalized with the actual value μ 0 xi since the dirichlet anti bounce back rule is not exact μ 0 xi may slightly deviate from the steady state exact solution μ 0 xi 1 the set γn is extracted from the central moments with the formulae ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 it determines u n u m x i 1 γ 1 x i μ 1 x i k t x i d d 0 1 sk t x i and ku t x i in eq 14 when the taylor regime is reached typically at xi h pe these values downstream remain approximately the same within the basic cell the rtd simulations are more robust than the spatial spread and the three schemes reach pe 740 in exp i ade c ade j most of the time achieved for this as well in exp ii since the downstream distance should increase linearly with pe the computational time grows as pe2 like in the spatial spread let us recall that the mean seepage velocity u s u m is set with the trt emm in any geometry by construction the direct ade schemes produce u n u m u s u m on the coordinate stencil in stratified channels but u n u m differs from the prescribed constant darcy value with ade j in porous blocks in series see section 5 3 2 fig 22 shows that the three ade schemes modify the prescribed mean velocity value in two dimensional flow both in the spatial and temporal systems when pe 7 4 velocity is small u s u m u x r e f 10 ade c ade r manifest quasi identical relative velocity error e u it slightly differs with ade j but it has the same dependency upon ϕ however when pe 74 u s u m u x r e f ade j produces relatively large velocity errors and it reproduces the ade c only with much smaller velocity as u s u m u x r e f 10 thus although ade j is often more stable than ade c close to the stability line thanks to the reduction of the negative numerical diffusion it needs to operate on a smaller velocity range in heterogeneous soil for the correct advection in the intermediate pe range table 8 shows that when pe 740 the velocity error becomes small with all schemes using the same velocity u s u m u x r e f as a reminder a reduction of the velocity error with λ d 0 c e was first observed with ade j in series of porous blocks remarkably this makes the advection process more accurate when pe grows decreasing λ fig 23 displays the three relative differences δd δ sk t and δ ku t between the direct schemes and trt emm the three direct schemes produce nearly identical results at pe 7 4 where their difference with trt emm is within 0 5 for all three moments and the largest discrepancy happens for kt at the smallest porosity value ϕ 1 8 the anti numerical diffusion mechanism does not play a role either because of the relatively smaller velocity u s u m u x r e f 10 or the predominant role of the taylor and numerical dispersions when pe 74 the three schemes produce similar results only provided that ade j operates with small velocity as u s u m u x r e f 10 according to fig 22 finally as it might be expected from the mean velocity results in table 8 the difference with the trt emm is very similar in the three schemes at pe 740 we note however that the difference between the trt emm and ade increases with pe this can be partly related to the fact that the steady state taylor regime is more difficult to reach with ade when pe grows on the whole in this and all other spatial and temporal dispersion experiments a similar difference within 5 between the trt emm and the direct schemes was mostly observed in the basic cell we conclude that the three ade schemes produce similar solutions when their advection process is accurate enough and then confirm the trt emm moments predictions 7 4 the transport coefficients now using the trt emm solutions we examine how the presence of the solid and porous obstacles impacts the transport coefficients fig 24 displays the relative differences with respect to open flow in exp i both in the spatial and temporal dispersions the dispersion coefficient d d 0 1 k t is the same in the two systems and δd is displayed together for pe 7 4 10 102 103 in the first diagram the four relative differences δ sk s δ ku s and δ sk t δ ku t are displayed together in the three next diagrams at fixed pe we observe that all moments are quite different for solid and highly permeable porous blocks remarkably all transport coefficients become porosity independent at pe 740 the relative difference to open flow also becomes pe independent that means that all transport coefficients obey the same stratified flow pe scaling from eq 57 in highly permeable porous flow a very interesting result in fig 24 is that the highly permeable porous system from exp i is very efficient in the suppression of the taylor dispersion independently of the porosity value indeed while δ d 0 1 when pe 7 4 not shown δd becomes 0 8 for pe 74 and this difference further decreases with pe towards δ d k t k t p 1 1 or kt 0 these results predict the dispersion coefficient to diminish by 80 at pe 74 and almost to vanish at pe 740 and pe 7400 towards k t 0 in porous flow the trt emm also predicts the relative degree of the asymmetry and peakedness in the mean concentration and rtd distributions against the open flow recall that sk s and ku s are both negative in the spatial spread in open poiseuille flow where the mean concentration profiles are hence skewed right and relatively flat see ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 fig 24 predicts that sk s remains negative in porous flow but its absolute value increases δ sk s 2 5 the kurtosis is predicted to change the sign meaning a larger peakedness the rtd profiles are typically skewed left because of the dirichlet inlet condition sk t and ku t are both positive in open flow fig 24 predicts them to hold approximately the same form in the presence of the highly permeable obstacles because δ sk t 0 and δ ku t 0 5 fig 25 displays the mean concentration distribution c x and rtd profiles p t in exp i at pe 74 they are produced by the direct solver ade c when ϕ 1 8 and compared with the reconstructed profiles see section 6 3 1 here the reconstruction is performed from the exact poiseuille moments and from the trt emm moments computed in porous flow the direct computations confirm the drastic reduction of the taylor dispersion with respect to an open flow they also confirm that the self similar dispersion independent distribution σ c x remains skewed right but it is much sharper than in open flow the reconstruction from the trt emm moments practically coincides with the rtd numerical profiles in self similar coordinates they look very alike to open flow in agreement with the moments predictions the direct computations also confirm that the profiles are almost ϕ independent fig 26 displays the trt emm predictions for the spatial and the temporal dispersion in exp ii as has been expected from the mean permeability values in table 7 the trt emm predictions for flow around the solids are nearly the same in the exp i and exp ii but this case is accommodated smoothly in exp ii because the porous obstacles are low permeable a striking difference with the exp i in fig 24 is that kt increases almost linearly with ϕ hence the less porous low permeable blocks reduce the taylor dispersion more efficiently the taylor dispersion reduction increases with pe but it remains weaker than in exp i fig 27 displays the rtd and the mean concentration profiles computed with the ade c at pe 74 according to the predictions in fig 26 for pe 74 δd 0 when ϕ 1 8 and the rtd profiles almost coincide with their open flow counterparts however δd 0 6 when ϕ 19 20 and both the rtd and the mean concentration profiles show that the porous system becomes more dispersive than the open flow in self similar coordinates the reconstructed and numerical profiles agree to each other and look very similar to the open flow profiles because δ sk t 0 and ku t keeps its sign we note that the concentration profiles look more irregular in the less permeable system exp ii they are more oscillating with the ade j scheme from eq 11b because of the interface jumps see perpendicular flow in series fig 7 at the same time the ade c and ade r produce very similar moments and profiles in both spatial and temporal systems finally fig 28 displays the normalized numerical rtd profiles at pe 740 they are monitored closer to the inlet when the taylor regime has not been yet reached we note that ade c and ade j produce very similar profiles at pe 740 in agreement with the moments prediction the asymmetry of the profiles reduces with the porosity following the taylor regime predictions in fig 26 sk t p 0 and δ sk t ϕ 1 0 7 monotonously increases with ϕ the reconstruction from the four moments is not accurate enough close to the inlet but it improves downstream and predicts rtd correctly already at x x 5 10 2 pe according to results vikhansky and ginzburg 2014 an accurate reconstruction of very sharp distributions needs more moments the positive aspect is that any order moments can be predicted with the trt emm applying eqs 16 17 sequentially 7 5 summary the trt emm and three direct ade d2q5 schemes have been examined in two dimensional brinkman flow around solid and porous obstacles the porosity contrast between the fracture and matrix was varied in the interval ϕ 1 8 19 20 their permeability contrast was fixed to 108 two flow scenarios with darcy numbers varying by a factor of 102 have been considered the péclet number was varied in the interval pe 7 4 740 in the basic cell 8 mesh spacings per obstacle and the gap and up to pe 7400 with the trt emm in five times finer cell whereas the trt emm was operated within a single periodic cell the direct simulations were run through one to two hundred of the duplicated cells the trt emm predictions were validated by the direct numerical simulations an agreement within 5 between the two approaches was found in basic cell computing the relative temporal rtd and spatial mean concentration moment differences with the open flow the relative accuracy of the two approaches agrees well with our error estimate in stratified channels but it is much better than it might be expected from the analysis in series for the same porosity contrast pe and discretization level despite the space variable mass source and interface flux jump the trt emm behaved more stably than the direct solvers in the spatial spread the trt emm solutions follow the dimensional analysis from eq 13 the ω form and γ form produced almost identical solutions for dispersion coefficient kt and with the help of eq 14 for the skewness and kurtosis in temporal and spatial dispersions in a given grid pe ce and λϕ fix the steady state solutions for any reference velocity u x r e f and diffusion eigenfunction λ however an exact ce independent parameterization with eq 26a is only valid asymptotically in multi dimensions the scale parameter βe from eq 10 accelerates the convergence to steady state and allows to operate efficiently at small velocity amplitudes it was shown that the non local mass term sn and the flux jump term j n can be omitted already at pe 740 in agreement with the dimensional analysis vikhansky and ginzburg 2014 for fractured type flow this property greatly simplifies the trt emm because on the one hand the diffusion flux becomes continuous on the porous and solid obstacles and on the other hand the finite differences can be avoided in precomputing sn the emm can be then handled by any standard linear ade solver based on the continuous flux condition and local mass source among the three ade schemes the ade c from eq 11a and ade r from eq 12 have shown very similar results within the ade r stability range u ϕ 2 r c e ϕ r using λ ϕ 1 4 the ade c and ade j could remain stable outside this interval but their effective stability is more difficult to estimate the ade j needs a smaller velocity amplitude to reproduce correctly the averaged seepage velocity in heterogeneous soil at the intermediate pe range however the three ade schemes produce very similar results at higher pe where ade j reduces its velocity correction reducing λ at fixed pe and grid the transport coefficients in direct simulations depend upon all numerical parameters u x r e f ce λ and λϕ separately because of the truncation corrections ginzburg 2017b a highly permeable micro channel type porous arrangement was found most efficient for dispersion reduction in creeping brinkman flow independently of the matrix porosity ϕ at the same mean seepage velocity value u x r e f when the pe behavior of moments becomes established e g fractured type pe scale from eq 57 the asymptotic solutions can be estimated from the trt emm computations performed at the intermediate pe range saving drastically computational resources the trt emm is especially suitable for mesh refining and clearly advantageous for the prediction of the dispersion and the higher moments in the taylor regime in transition to the taylor regime the emm approach allows to predict qualitatively an effect of different scenarios e g due to the flow regime and geometry aspects 8 concluding remarks the two relaxation times lattice boltzmann linear advection diffusion scheme trt emm has been proposed for the numerical formulation of the extended method of moments emm in d dimensional heterogeneous soil the trt emm incorporates locally the recursively precomputed space variable mass sources and automatically accounts for the diffusion flux interface jumps in the streamwise discontinuous porosity the scheme allows for an optional acceleration to steady state with relatively small velocity amplitudes a sequentially solved chain of the boundary value problems independent for each mean velocity direction provides three longitudinal taylor coefficients dispersion skewness and kurtosis the full dispersion tensor can be restored from d independent runs and a recursive extension to the next order longitudinal moments is straightforward although the whole evolution picture is not described by the taylor moments they might indicate qualitatively the relative role of the different factors for transition regimes provided that the moments amplitudes grow with pe the diffusion flux jump j n and the associated non local mass source sn become negligible and the method can be run by any heterogeneous ade solver based on the continuous diffusion flux it has been confirmed that the spatial ω form and the temporal γ form are numerically equivalent in providing the two systems of moments the ω form is preferable because of its ability to the fully diffusive problems its simplicity and higher numerical reliability the algebraic transforms between the temporal and spatial systems of moments are also applicable to direct ade computations for example the rtd simulations under the heaviside entry behaved more robustly than the spatial spread with the proposed lbm ade direct schemes it has been recognized that because of the truncation correction due to the non linear mass source space variation the fixed value of the eigenfunction product λϕ is not sufficient to parameterize the steady state trt solutions by pe exactly a specific dependency on the diffusion coefficient scale parameter ce λ ϕ c e a 1 c e guarantees this property in a parallel and a perpendicular flow for any mass source future analysis will attempt to extend this functionality to the multi dimensional flow a robust choice a 1 4 eliminates the mass source truncation correction and assures continuous bn solution for the three first orders with the pure diffusion implicit jump tracking in series however the perpendicular darcy flow through porous blocks presents an increasing difficulty benchmark for dispersion and higher order moments where the leading order midway location of the continuity condition requires a rather fragile unstable limit a 0 or λϕ 0 the choice of λϕ is therefore decisive for the high porosity contrast modeled on coarse grids where very small values λϕ are expected to improve implicit interface location in x ray tomography series block type geometry in stratified flow and fractured brinkman flow through permeable obstacles the trt emm and direct solvers behave much more accurately than in series and have shown much smaller dependency on λϕ a 1 4 is recommended for trt emm in fractured brinkman flow while a 1 8 is more suitable in heterogeneous darcy flow operated in a single cell the trt emm copes very well with the grid refining for a solution independence upon free numerical parameters and high péclet range in our parallel work we attempt to reduce λϕ impact on the unresolved continuity conditions with the help of the conjugate interface corrections in the direct schemes numerical diffusion becomes insignificant against the taylor dispersion at sufficiently high pe and heterogeneity contrast the two examined direct solvers with the equilibrium and collision anti numerical diffusion treatment and the scheme without any treatment then show similar results but different stability in compliance with the predictions in diffusion dominant heterogeneous problems the collision anti numerical diffusion collision treatment becomes preferable to the equilibrium approach because the discontinuous equilibrium weights cause concentration jumps and modify the mean seepage velocity this preference is expected to hold for the equilibrium and collision models with heterogeneous anisotropy ginzburg 2006 ginzburg and d humières 2007 in the presence of solid and porous obstacles the prescribed mean seepage velocity is not kept exact with all direct schemes to be contrasted the trt emm guarantees advection velocity by construction and its steady solutions are numerical diffusion free the proposed scheme applies with the stair wise geometry description it will be coupled with the more accurate interface and boundary tracking for a fine description of solid and porous objects in future work to conclude the proposed simple trt emm is readily applicable to tomographic rock images and reconstructed media for a systematic classification of their dispersion properties and for optimization design under desired moments constraints in composite material wetland or chemical device our artificial porous arrangement exemplified such kind of application it has been found that the porous highly permeable obstacles reduce very efficiently the taylor dispersion independently of their porosity and that the moments then asymptotically obey the same pe scale as in open flow however the péclet number and porosity dependencies both become more complicated with the weakly penetrable obstacles and they may even enhance the taylor dispersion against the open flow brinkman creeping flow in the two darcy regimes was simulated but further the numerical emm simulations in inertial flow may clarify the influence of the viscous and inertial resistance turbulence shear layers or wake effects as well as the role of heuristic flow model parameters such as the brinkman viscosity in the present study nonetheless the flow should be described quite accurately because it was demonstrated that the prediction of moments is quite sensitive to the quality of the heterogeneous velocity field acknowledgments the author is grateful to alexander vikhansky and gonçalo silva for their kind help appendix a the emm implementation details a 1 the ω form the three first orders n 1 2 3 in eqs 16b 16e read locally with superscript ω is employed in ω form a 1 m n ω m n ω s n ω ϕ ω n n 1 ω 1 u x m 1 ω u ϕ x b 0 ω b 0 ω 1 s 1 ω d ϕ x b 0 ω 0 j 1 ω d ϕ 1 x m 2 ω ϕ ω 1 b 1 ω d ϕ b 0 ω u ϕ x b 1 ω s 2 ω d ϕ x b 1 ω j 2 ω d ϕ b 1 ω 1 x m 3 ω ϕ ω 1 b 2 ω ω 2 b 1 ω d ϕ b 1 ω u ϕ x b 2 ω s 3 ω d ϕ x b 2 ω j 3 ω d ϕ b 2 ω 1 x s 4 ω d ϕ x b 3 ω eqs 16 17 with eq a 1 are sequentially solved for b 1 ω b 2 ω and b 3 ω ωn is computed recursively with eq 16f or eq 18 for n 2 3 4 a 2 the γ form the three first orders n 1 2 3 in eqs 16b 16e read with superscript γ applies in γ form a 2 m n γ m n γ s n γ γ n u ϕ x b 0 γ n 1 b 0 γ 1 m 1 γ ϕ m 2 γ ϕ γ 1 u ϕ x b 1 γ d ϕ γ 1 2 b 0 γ m 3 γ ϕ γ 1 u ϕ x b 2 γ γ 2 u ϕ x b 1 γ d ϕ 2 γ 1 γ 2 γ 1 2 b 1 γ and a 3 s n r d ϕ k 1 n γ k x b n k n 2 s 1 γ 0 s 2 γ d ϕ γ 1 x b 1 γ s 3 γ d ϕ γ 2 x b 1 γ γ 1 x b 2 γ s 4 γ d ϕ γ 3 x b 1 γ γ 2 x b 2 γ γ 1 x b 3 γ the solution for γn reads a 4a γ n m n γ s n γ u ϕ x b 0 γ n 1 b 0 γ 1 then a 4b γ 1 ϕ u ϕ x 1 u x and for n 2 a 4c γ n k 1 n 1 γ k u ϕ x b n k s n d ϕ m 1 n γ m γ n m u ϕ x the jump term j n r reads a 5 j n r d ϕ k 1 n γ k b n k 1 x n 1 j 1 γ γ 1 d ϕ 1 x j 2 γ d ϕ γ 2 γ 1 b 1 γ 1 x j 3 γ d ϕ γ 3 γ 2 b 1 γ γ 1 b 2 γ 1 x a 3 computation of the s n r the mass term s n r in eqs a 1 and a 3 requires to precompute d ϕ r x b k r for k n when the three to four grid neighbors are available at point x along the longitudinal x axis inside the continuous porosity block vϕ the third order accurate finite differences apply a 6a x f x 2 3 f x 1 f x 1 1 12 f x 2 f x 2 o ϵ 4 a 6b x f x 1 2 f x f x 1 1 3 f x 1 1 6 f x 2 o ϵ 4 a 6c x f x 11 6 f x 3 f x 1 3 2 f x 2 1 3 f x 3 o ϵ 4 these operators are exact on the third order polynomial solution in particular in a series of porous blocks of the minimal thickness of four nodes per block eq a 6b applies with all points except the corners where eq a 6c applies this allows to match pure diffusion solutions for kurtosis from eq b 2 when only one or two neighbors are available inside the same porosity block the standard two three points finite differences apply for x f x like a 7 x f x 1 2 3 f x 4 f x 1 f x 2 o ϵ 3 x f x 1 2 f x 1 f x 1 o ϵ 3 x f x f x f x 1 o ϵ 2 the two first operators a 7 are exact for parabolic distributions the last one is only exact for a linear function f x a 4 the trt emm algorithm we resume the principal trt emm steps following section 3 2 the trt emm computes sequentially the steady state numerical solution b n r to eqs 16 17 for n 1 2 3 this solution is used to compute the next order mass source terms m n 1 r and s n 1 r and then ω n 1 with eq 16f in ω form or γ n 1 with eq a 4a in γ form the two sets ωn and γn n 2 3 4 define the transport coefficients in eqs 14b 14e with the help of eqs 13 and 15 one computational run for n 1 2 3 consists from the following steps 1 pre initialization step this step is the same for n 1 2 3 a prescribe the formulation either ω form or γ form use ω form for pure diffusion in eq 1 note that ω form is simpler b prescribe a single cell v and its longitudinal periodic direction say 1 x c prescribe porosity field ϕ r 0 1 and steady state velocity field u ϕ r l u periodic along 1 x and resolved on the regular computational grid inside the penetrable region r v ϕ v see eq 1 2 initialization step a prescribe constant equilibrium parameters in eq 19 ce 0 and βe 1 such that c e min r ϕ r d β e d 1 2 3 with d1q3 d2q5 and d3q7 respectively see eq 10e b optionally rescale u ϕ l u in linear stokes brinkman darcy flow and or modify ce and βe to satisfy an approximate stability condition u ϕ 2 r α 1 d u ϕ α 2 c e ϕ r β e see eq 10e when ce and βe are fixed this condition is satisfied if u ϕ is multiplied by the scale value s 0 min r c e ϕ r β e u ϕ 2 u ϕ u ϕ s c precompute u s u m r v ϕ u ϕ x r r v ϕ ϕ r d prescribe pe in eq 1 and compute λ from condition pe u s u m l l u d 0 l u d 0 l u c e λ where l l u is the characteristic length e prescribe b 0 r b 0 r 1 and ω 1 with eq 16c or γ 1 with eq a 4b in γ form replacing u x by u s u m f if n 2 or n 3 input already computed solution b k 1 r and ωk in ω form or γk in γ form with k 2 n g precompute m n r with eq a 1 in ω form or eqs a 2 a 3 in γ form check that r v ϕ m n r 0 h precompute j n r with eq a 1 in ω form or eq a 5 in γ form i prescribe a positive distribution or a constant value exemplified in eq 42 for collision number λ ϕ r precompute λ ϕ r λ ϕ r λ ϕ r with λ ϕ r ϕ r λ j prescribe any initial local mass distribution ρ r t 0 precompute global mass m g l o b r v ϕ ρ r t 0 k prescribe initial population solution f q r t 0 q 0 q m e g using eq 19 with m n r 0 f q r t 0 e q r t 0 e q r t 0 q 1 q m 2 f q r t 0 e q r t 0 e q r t 0 q 1 q m 2 c q c q f 0 r t 0 ρ r t 0 2 q 1 q m 2 f q r t 0 3 computation step perform t run collision streaming steps 7a using trt operator 8 a compute s ϕ r with eq 9 from λ ϕ r b compute e q r t q 1 q m 2 with eq 19 c compute g q r t q 1 q m 2 with eq 8 d set m r m n r in eq 7a and compute f 0 r t 1 e compute f q r c q t 1 with eq 7a when r c q v ϕ q 1 q m f compute f q r b t 1 in boundary node r b with the bounce back rule using eq 29b when r b c q v ϕ 4 analysis step a compute ρ r t and check whether m g l o b r v ϕ ρ r t b compute n 1 th order moments a b n r with eq 19c b b n r with eq 20 c m n 1 r and s n 1 r with eq a 1 in ω form or eqs a 2 a 3 in γ form d ω n 1 with eq 16f or γ n 1 in γ form with eq a 4a e ω n 1 or γ n 1 with eq 13 using e g u 0 u s u m f in ω form γ n 1 ω n 1 is computed with eq 15 in γ form ω n 1 γ n 1 is computed with the inverse to eq 15 g if n 1 compute kt with eq 14c if n 2 compute sk s with eq 14d and or sk t with eq 14e if n 3 compute ku s with eq 14d and or ku t with eq 14e h check steady state criteria with the prescribed stop value ϵ e g k t t k t t t r u n k t t ϵ i repeat computation step if neither the steady state nor the maximum number of iterations has been reached go to output step otherwise 5 output step save b n r ω n 1 and or γ n 1 for the next pass if n 1 2 6 final step go to initialization step if n 1 2 stop computations if n 3 remark a 1 steady state fields m n r j n r and λ ϕ r are precomputed during initialization in the present algorithm however they can be recomputed at each time step for memory saving remark a 2 one pass n 1 is sufficient for the dispersion coefficient kt since s 1 0 in ω form and γ form the finite difference operators from eqs a 6 and a 7 are not needed and m 1 r is computed locally two runs n 1 2 are required for sk s and or sk t the three passes n 1 2 3 are needed for ku s and or ku t remark a 3 in principle the model parameters ce βe λ and λ ϕ r can differ in three separate runs provided that pe and the necessary stability condition c e min r ϕ r d β e are respected appendix b diffusion in a series of porous blocks b 1 reference solution in pure diffusion through a series of two porous blocks of length h h 1 h 2 with the porosity ratio rϕ and thickness ratio rh the effective diffusion coefficient d e f f from eq 14b and kurtosis coefficient ku s from eq 5 read see ginzburg and vikhansky 2018 b 1a d e f f ω 2 d r d 0 d r 1 r h 2 r ϕ r h r ϕ 1 r h r ϕ r ϕ ϕ 1 ϕ 2 r h h 1 h 2 b 1b d r 0 1 d r r ϕ 1 d r r h 0 1 b 1c sk s 0 b 1d ku s ku t t 6 ω 4 ω 2 2 h 2 d 0 r h 2 r ϕ 2 1 2 2 1 r h 2 r ϕ r h r ϕ 1 r h r ϕ when all the integrals are computed via summation in eq 16 ku s becomes b 2 ku s u m r ϕ 1 2 r h 2 h 2 1 r ϕ 2 r h r h r ϕ 1 r h r ϕ 2 1 r h 2 r ϕ r h r ϕ 1 r h r ϕ d 0 the d r should be the exact solution of any second order accurate numerical scheme the trt emm from eq 19 and the direct ade schemes 11 produce d e f f exactly for any physical and free parameter choice however the trt emm with the implicit flux jump tracking from eq 19 produces eq b 2 exactly only if λϕ from eq 26a is computed with a a k u s u m b 3 λ ϕ a k u s u m r ϕ r h 1 c e a k u s u m r ϕ r h 7 r ϕ r h 1 r ϕ 12 7 r h r ϕ 24 1 r h 2 r ϕ lim r ϕ 0 a k u s u m the parameter dependent solution b 3 locates an interface jump in eq 41 midway the grid nodes eqs b 1 b 3 are invariant with respect to a simultaneous transformation r ϕ r ϕ 1 and r h r h 1 b 2 semi explicit diffusion jump tracking assume the coordinate discrete velocity set to be applied in a pure diffusion process along the x axis and the jump values n j n x 1 2 c q a ϕ from eq 17b to be precomputed midway the grid nodes the modified trt update then reads b 4 g q x g q x δ g q x g q x g q x δ g q x δ g q x 1 2 j q x j q x j q x t q j n x 1 2 c q n j n d ϕ b n 1 1 x c q c q in contrast with eq 19 eq b 4 copes with the pure diffusion equilibrium function when the mass source incorporates x j n x s n x according to eq 16e b 5 e q 0 m n m n m n x s n x e q x t q c e b λ ϕ m n eqs b 4 and b 5 allow to verify numerically the symbolic analysis developed in section 4 we note that δ g q δ g q δ g q is non zero only for two opposite interface cut links which obtain the same prescribed flux jump quantity b 6 δ g q x 0 x 0 1 2 c q x t q j n n x 0 δ g q x 0 x 0 1 2 c q x t q j n n x 0 eq b 6 coincides with the flux jump scheme guo et al 2015 on the midway located straight interface when t q 1 2 minimal sets continuity relation in eq 28a remains the same but second order accurate eq 40 becomes in diffusion case replaced by eq b 7 with the exact flux jump j n x x 0 in the rhs b 7 if x m n x 0 0 or m n if a 1 4 d ϕ x b n 2 x x 0 j n x x 0 φ x d ϕ x b n in pure diffusion in series of two porous blocks at order n 3 m n x is piecewise linear and the semi explicit scheme locates flux jump condition midway provided that a 5 24 with eq 41 eq b 2 is then held using eq a 6 for s 4 x d ϕ x b 3 x in eq 18b second order accurate finite differences are sufficient at n 1 2 3 to precompute s n x d ϕ x b n 1 and to extrapolate j n x 0 from the neighbor blocks 
797,a simple local two relaxation time lattice boltzmann numerical formulation trt emm of the extended method of moments emm is proposed for analysis of the spatial and temporal taylor dispersion in d dimensional streamwise periodic stationary mesoscopic velocity field resolved in a piecewise continuous porous media the method provides an effective diffusivity dispersion skewness and kurtosis of the mean concentration profile and residence time distribution the trt emm solves a chain of steady state heterogeneous advection diffusion equations with the pre computed space variable mass source and automatically undergoes diffusion flux jump on the abrupt porosity streamwise normal interface the temporal and spatial systems of moments are computed within the same run the symmetric dispersion tensor can be restored from independent computations performed for each periodic mean velocity axis the numerical algorithm recursively extends for any order moment we derive an exact form of the bulk equation and implicit closure relations construct symbolic trt emm solutions and determine specific relation between the equilibrium and the collision degrees of freedom viewing an exact parameterization by the physical non dimensional numbers in two alternate situations parallel fracture matrix flow and perpendicular darcy flow through porous blocks in series two dimensional simulations in linear brinkman flow around solid and through porous obstacles validate the method in comparison with the two heterogeneous direct lbm ade schemes with different anti numerical diffusion treatment which are proposed and examined in parallel on the coarse grid accuracy of the three moments is essentially determined by the free tunable collision rate in all schemes and especially trt emm however operated within a single periodic cell the trt emm is many orders of magnitude faster than the direct solvers numerical diffusion free more robust and much more capable for accuracy improving high péclet range and free parameter influence reduction with the mesh refinement the method is an efficient predicting tool for the taylor dispersion asymmetry and peakedness moreover it allows for an optimal analysis between the mutual effect of the flow regime péclet number porosity permeability and obstruction geometry keywords taylor dispersion skewness kurtosis spatial and temporal moments residence time distribution extended method of moments lattice boltzmann ade schemes interface jump numerical diffusion stokes brinkman darcy porous flow 1 introduction understanding of the structure and velocity influence on the mass transport prediction and optimization of the taylor and environmental dispersion elongated tails of the averaged upscaled solute distributions and their time rate the residence time distribution rtd is a task required in many engineering fields such as chemical polymer petrol agricultural ecological risk assessment and restoration wastewater treatment we propose a simple numerical method for prediction of the first four moments of the solute distribution from the steady state velocity field established in the streamwise periodic representative unit cell especially we keep in mind a direct application in x ray micro tomography images of the double porosity media like the carbonates where the proposed method allows for the rock identification and classification with respect to the dispersion and non gaussian properties of the breakthrough curves within the dispersion theory established in fundamental works by taylor 1953 aris 1956 and brenner 1980 the gaussian description applies to upscaled distributions with the longitudinal taylor dispersion correction aris 1956 taylor 1953 to molecular diffusion coefficient hereafter dt and d 0 respectively or more generally full dispersion tensor brenner 1980 due to the multi dimensional gradients in velocity field the classical approach is focused on the spatial solute evolution after an instantaneous point release when the distribution moments are computed via the spatial integration the rtd introduced by danckwerts 1953 is commonly monitored in the outlet of the chemical device cozewith and squire 2000 vegetation zone for pollutant remediation werner and kadlec 2000 or micro channel cantu perez et al 2008 and it can be characterized through the temporal moments integrated in time vikhansky 2011 the taylor regime is respectively characterized by a time and space linear growing of the variance like σ 2 2 d 0 d t t at a dimensionless time t t u 0 l pe or σ 2 2 u 0 3 d 0 d t x at a dimensionless distance x x l pe hereafter pe u 0 l d 0 is the characteristic péclet number however many natural systems exhibit asymmetry peakedness and heavy tails a long time or distance after release so far the taylor dispersion theory fails to explain the non fickian behavior of the molecular propagators in heterogeneous porous beds berkowitz et al 2008 bijeljic et al 2011 successfully reproduced by the numerical simulations in double porosity carbonates bijeljic et al 2013 yang et al 2013 recent studies suggest that considering the vegetation as a porous zone offers a promising prediction of the pollutant retention rtd observed in the experimental vegetated channels and pond systems see review golzar 2015 the open question lies in the optimal design su et al 2009 of the remediation zones through their permeability resistance porosity and geometric obstruction the high order moments quantify the deviations from the normal distribution the skewness sk third order moment and kurtosis ku fourth order moment are responsible for the asymmetry and peakedness respectively let us assume that a continuous velocity field u ϕ r is resolved in a heterogeneous piece wise continuous porosity distribution ϕ r we keep in mind a sketch in fig 1 a complete evolution history needs to solve the d dimensional advection diffusion equation ade for the continuous concentration c r t 1 t ϕ c u ϕ c ϕ d 0 c u ϕ 0 r v ϕ the taylor dispersion coefficient dt is the same in the two systems of moments spatial ϕ 1 x n c ϕ and temporal t n p x t d t p x t t c x t the brackets denote averaging over the fluid part of a single periodic cell vϕ v in fig 1 however the higher order moments differ in the two systems their computation requires specific initial boundary set up with the direct ade solvers of eq 1 and leads to a tedious numerical task combining the highly discontinuous diffusion coefficients in complex interface boundary geometry with the high péclet numbers in a periodic arrangement the solute evolution is run through a long series of duplicated cells v in fig 1 since their number increases with pe the computational time to the taylor regime grows as pe2 at least the brenner s b method of moments brenner 1980 circumvents the problem it restores the symmetric dispersion tensor d d d d 0 v ϕ b r t b r independently solving d steady state advection diffusion equations for space periodic vector variable b d inside a single cell the finite difference scheme salles et al 1993 validated the b method in microscopic three dimensional stokes flow through the regular fractal random and reconstructed porous media a similar dispersion boundary value problem was recently parameterized valdés parada et al 2016 with the reynolds number in slow inertial flow through an uniform soil porosity the extended method of moments emm extends the dispersion procedure to heterogeneous soil and any order spatial or temporal moments originated from the ideas vikhansky 2008 and substantial developments vikhansky and ginzburg 2014 the emm is elaborated ginzburg and vikhansky 2018 in the form of the recursive algorithm for prediction of i effective diffusion structure coefficient ii taylor dispersion dyadic and iii longitudinal coefficients of the high order moments differently from the brenner s averaging of the brownian particles moments or the volume averaging approach valdés parada et al 2016 the emm searches for the solution of eq 1 in the form of a product of the low frequency slow monochromatic wave and a streamwise periodic say along the x axis oscillating scalar field b ω γ r 2 c r t 1 2 π b ω γ r exp i γ x ω t a simultaneous perturbative expansion is performed either for b ω γ r and temporal frequency ω γ or for b γ ω r and wavenumber γ ω the mathematical algorithms based upon are referred to as ω form and γ form respectively 3a ω form b ω γ r n 0 b n r i γ n ω γ i n 1 ω n i γ n 3b γ form b ω γ r n 0 b n r i ω n γ ω i n 1 γ n i ω n in both formulations the b field variable b n r solves a chain of steady state ade with the recursively built mass sources the two sets ωn and γn are determined explicitly from the global mass conservation solvability condition they sequentially determine the dispersion skewness and kurtosis n 2 3 4 respectively in spatial and temporal respectively system of moments the solution procedure straight forwardly extends to any higher order moment since the coefficients of the two expansions are inter related through simple algebraic formulae the two sets of moments become determined within the same solution path in a streamwise uniform duct flow the emm moments correspond ginzburg and vikhansky 2018 to the upscaled mean concentration solution obeying the high order pde mercer and roberts 1990 ngo cong et al 2015 without need to resorting for its solving the emm allows for the symbolic moments prediction in continuous parameter space so far the taylor dispersion skewness and kurtosis were exemplified ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 in i parabolic poiseuille profile in a channel and cylindrical capillary ii non newtonian power law flow in a capillary iii shallow profile through different cross section shapes iv darcy brinkman flow in stratified fracture matrix layers and v a perpendicular darcy flow through porous blocks these solutions allow to estimate the role of the porosity contrast and geometry aspect in the first four moments also providing their asymptotic pe scaling the reference emm solutions give the valuable benchmarks for direct solvers of eq 1 and numerical emm formulations furthermore applying the emm decomposition to the effective fourth order accurate mass conservation equation of a numerical scheme the truncation interference with the physical moments may become quantified quasi exactly in simple flow ginzburg 2017b the emm copes with the stationary exact numerical or approximate incompressible velocity field of any nature a periodic mesoscopic velocity field in porous beds and random structures e g computed with the two relaxation times trt lattice boltzmann lbm flow schemes in newtonian flow ginzburg et al 2015b khirevich et al 2014 talon et al 2012 vogel et al 2015 non newtonian fluids talon and bauer 2013 or darcy flow in space distributed permeability röding et al 2016 is a natural input for emm numerical computations another promising application is the shallow flow within the rigid or flexible vegetation interactions buxton 2018 gac 2014 yang et al 2017 very different numerical approaches apply for the effective diffusivity of the composite or porous structure e g monte carlo simulations trinh et al 2000 numerical integration by random walks bolle et al 2000 finite element kim et al 1987 but also the direct solver ginzburg 2005a 2007 trt ade e g in regular arrays chai et al 2016a unsaturated genty and pot 2014 and saturated genty et al 2017 porous media or porous polymer films gebäck et al 2015 the emm provides not only the effective diffusivity but also the associated high order structure moments at zero velocity unit cell simulations in the ω form our purpose is to propose a operationally simple numerical emm algorithm and to verify the emm with its help in multi dimensional heterogeneous stokes brinkman darcy velocity field we propose trt emm formulation based on the trt ade model for heterogeneous soil vikhansky and ginzburg 2014 a subtle point is that the diffusive flux ϕ d 0 b n r should undergo the prescribed jump values on the streamline normal interfaces when ϕ r becomes discontinuous the trt emm benefits from main lbm advantages it locally prescribes the discontinuous diffusion values ϕ d 0 r via one of its two relaxation rates and couples the diffusive flux jump vector with the advective velocity in local equilibrium distribution the total advection diffusive flux then automatically obeys the interfacial and solid surface flux jump conditions using the mass conserving bounce back reflection on an impenetrable boundary it should be recognized that such an implicit interface tracking shares the bounce back deficiency concerning the inexact location of the closure continuity condition ginzburg 2007 2016 ginzburg et al 2015b an alternative second order accurate scheme guo et al 2015 has been recently introduced for location of the concentration and flux jumps on the arbitrarily placed straight and curved surface we will restrict ourselves to stair case midgrid wall description and examine the difference between the fully implicit node jump tracking and semi explicit link jump tracking only in pure diffusion through porous blocks analytically the trt emm assessment is performed by extending the exact taylor type analysis of the implicit closure relations and the symbolic solution construction ginzburg 2007 2016 ginzburg et al 2015b from the streamline invariant diffusion type interface problem to the darcy advection through a streamline heterogeneity in a series of porous blocks a special attention is put on the consistent parameterization of the trt emm solutions with the dimensionless governing numbers in the presence of a space variable mass source a decisive role of the free tunable equilibrium and collision degrees of freedom will be demonstrated in dispersion skewness and kurtosis this symbolic analysis is not restricted to trt emm and concerns any lbm ade steady problem the trt emm is applied in both ω form and γ form with the purpose to validate the equivalence of their moments solution and to examine their respective robustness it was predicted ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 that the interface flux jumps and the associated mass source terms become negligible when the moments grow with pe this property would further simplify the method we will evaluate all these features in creeping brinkman 1947 flow through a zigzag type solid and porous arrangements inspired from the micro channel design vikhansky 2011 and similar to one depicted in fig 1 the flow is solved with the local interface implicit resistance force based improved ibf scheme ginzburg et al 2015b the partial bounce back gray link based lbm brinkman models see review zhu and ma 2009 and the local bf ibf approaches are inter related with the help of the trt collision operator ginzburg 2016 ginzburg et al 2015b the advanced boundary treatment is developed in work silva et al 2017 the two dimensional simulations will illustrate the emm ability for device optimization through reduction of the taylor dispersion porosity and péclet number effect in moments once the moments are predicted the profiles can be restored from them with the entropy maximization procedure ginzburg 2017b vikhansky and ginzburg 2014 based on the idea bandyopadhyay et al 2004 in principle at least the larger is the set of the predicted moments the better is the reconstruction and the shorter is the time and length where it becomes valid the predicted moments and reconstructed profiles will be compared with their spatial and temporal counterparts by solving eq 1 directly the optimal in stability trt ade scheme ginzburg et al 2010 has been recently applied for uniform porosity dispersion coefficient measurement in herschel bulkley non newtonian profile batôt et al 2016 and duct flow ginzburg and roux 2015 yan et al 2017 reactive transport and bacterial chemotaxis yan et al 2017 see ginzburg and roux 2015 for earlier dispersion lbm the pore scale breakthrough curves simulations yan et al 2017 in a randomly packed bed column confirm the trt ade reliability in comparison with much more complicated lbm and alternative solution methods yang et al 2016 the lbm ade unlaboredly extends for non linear mass transport chai et al 2016b ginzburg 2006 hammou et al 2011 servan camas and tsai 2010 there exist several lbm approaches for mass transfer in space discontinuous porosity similarly as in mesoscopic flow the interface implicit schemes with the space variable collision rates run uniformly through the whole domain wassén et al 2014 the trt ade linear heterogeneous scheme for eq 1 was first employed for emm validation vikhansky and ginzburg 2014 in stratified flows where it confirmed the predicted deviations from the gaussian solution in moments and reconstructed shapes the trt ade is supported by the fourth order accurate truncation analysis and stability bounds in stratified darcy law vikhansky and ginzburg 2014 numerical dispersion skewness and kurtosis truncation estimates ginzburg 2017b in straight and radial poiseuille flow in alternative heterogeneous approach zhang et al 2016 the single relaxation time srt collision which is a particular trt subclass where the two relaxation rates are the same operates with the uniform rate and incorporates heterogeneity with the semi explicit partial bounce back mechanism the srt approach perko and patel 2014 couples the advective and diffusive non equilibrium fluxes through an equilibrium in uniform soil the trt overcomes srt for stable velocity range due to the optimized dependency between its free tunable rate and diffusion coefficient ginzburg 2012 ginzburg et al 2010 kuzmin et al 2011a the respective stability and accuracy of the different heterogeneous approaches has been not evaluated yet the trt ade and trt emm are very similar but while there is no specific sources and flux jumps in trt ade the trt emm does not need any anti numerical diffusion corrections required in transition and it can be accelerated for steady state the present works first compares the two approaches for the first four moments in a perpendicular flow configuration this study reveals that unlike in a parallel flow the trt ade modifies the constant advection velocity due to the heterogeneity in its anti numerical diffusion equilibrium correction it has been already recognized that the discontinuity of the concentration equilibrium weights results in discontinuous solute solution and different interface explicit strategies have been attempted for a remedy ginzburg 2006 ginzburg and d humières 2007 yoshida et al 2014 in this work an alternative anti numerical diffusion implicit mrt r approach ginzburg 2013 based on the idea of the non diagonal multiple relaxation times matrix collision rasin et al 2005 yoshida and nagaoka 2010 will be extended from the homogeneous to heterogeneous soil in contrast with the trt ade the mrt r copes with the continuous equilibrium and is able to remove the off diagonal numerical diffusion on the coordinate discrete velocity stencil on top of the accuracy study we support all schemes with the velocity bound estimates and evaluate their efficiency for pe range finally although all presented schemes may apply the full diagonal velocity sets like d2q9 d3q15 or d3q19 we limit this work to the minimal schemes ddq 2d 1 first because they are sufficient for trt emm in isotropic diffusion second because the numerical dispersion skewness and kurtosis are influenced by the diagonal weight stencil in direct solvers ginzburg 2017b third because the bounce back mass conserving no flux rule copes best with the coordinate stencil on the mesh aligned solid surface in fact the bounce back creates a spurious restriction of the tangential flux via the surface inclined velocity links their accommodation layers modify the effective velocity molecular diffusion and dispersion coefficients even in a straight channel ginzburg 2017a ginzburg et al 2015a the rest of the paper is organized as follows section 2 discuses the computation of moments and introduces the direct solvers lbm ade section 3 summarizes the emm and introduces its numerical formulation trt emm section 4 derives and analyses effective bulk equation and steady state trt emm interface conditions section 5 constructs apparent trt emm moments solution for blocks in series and compares the trt emm and lbm ade section 6 examines the trt emm symbolic solutions in channels poiseuille flow in section 6 1 a fracture matrix stratified bounded system in section 6 2 and two layered double periodic brinkman flow in section 6 3 section 7 compares the trt emm and lbm ade moments in heterogeneous flow around solid and through porous obstacles section 8 concludes the paper appendix a provides the mass source in ω form and γ form appendix b resumes the reference diffusion solution in series and formulates its semi explicit interface jump tracking sections 2 1 2 2 3 and 7 2 are self consistent for the trt emm implementation which is resumed in the algorithmic form in appendix a 4 2 a direct solving of the advection diffusion equation ade we introduce dimensionless transport coefficients in section 2 1 the trt framework in section 2 2 and the direct lbm ade solvers in section 2 3 2 1 the spatial and temporal moments in taylor regime consider a single cell volume v r in d dimensional periodic porous space let vϕ v be a set of penetrable volumes with smooth porosity distributions ϕ r inside vϕ where concentration distribution obeys eq 1 ϕ r is discontinuous on the penetrable interface aϕ between vϕ and its neighbours and on the solid surface as vϕ see fig 1 let ψ v ϕ v ϕ ψ d v denote the volume integration over a single cell in the frame of the classical aris 1956 taylor 1953 and generalized brenner 1980 dispersion theory extended to heterogeneous soil the cell averaged mean concentration c obeys the upscaled ade in the developed taylor regime 4 t c u c d c c c ϕ ϕ u u ϕ ϕ the averaged interstitial seepage velocity u is constant and it is argued brenner 1980 ginzburg and vikhansky 2018 that eq 4 copes with the symmetric constant dispersion tensor d we assume that ϕ r and u ϕ r are periodic over v at least for one of the coordinate axes say the x axis hereafter referred to as a streamwise direction molecular diffusion tensor in eq 1 is set isotropic d 0 d 0 i we aim to determine the longitudinal transport coefficients in spatial and temporal systems of moments the spatial dispersion characterizes the evolution of the point source c r t 0 δ x x 0 δ t through the spatial moments nth order raw moments μ n t x x 0 n c x t d x are measured for n 0 their central counterparts μ n t are built from them for n 2 with the centroid μ 1 t hereafter μn t are normalized with the zero moment μ 0 t the péclet number pe is measured with the characteristic seepage velocity u 0 and length l pe u 0 l d 0 at a long enough time after release t pe l u 0 the first four moments determine respectively the mean seepage velocity component u x longitudinal dispersion coefficient d skewness sk t and kurtosis ku t of the averaged distribution c x t 5 u x μ 1 t t d μ 2 t 2 t d d e f f d t d t k t d 0 sk t sk s t 1 2 μ 3 t μ 2 t 3 2 ku t ku s t 1 μ 4 t μ 2 t 2 3 the effective diffusion coefficient d e f f is measured at zero velocity the taylor dispersion coefficient dt becomes apparent in motion because of the solute gradients due to the structure heterogeneity or the transverse velocity gradient the variance central second moment μ 2 t grows linearly with time and the dispersion coefficient d sums d e f f and dt the higher order moments skewness sk t and kurtosis ku t characterize the distribution asymmetry and peakedness respectively and tend to zero as time increases as t 1 2 and t 1 an exact gaussian solution of eq 4 gives sk s ku s 0 however the high order averaging of eq 1 gives them non zero solution in the simplest configurations like the poiseuille duct flow or a constant parallel or perpendicular darcy flow through heterogeneous blocks ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 the temporal dispersion is quantified through the temporal moments of the residence time distribution rtd due to danckwerts 1953 the rtd p x t t c x t is monitored at a signed distance x from the inlet e g vikhansky 2011 the dimensionless distance x l to the taylor regime grows in proportion with pe the central moments μ n x 0 t t x n p x t d t are accumulated in time they are restored from the raw moments with the centroid t x μ 1 x 1 μ 0 x 0 t p x t d t hereafter the raw moments are normalized with the zero moment μ 0 x p x t d t in the taylor regime the mean seepage velocity u x x μ 1 x and dispersion coefficient d μ 2 x u 0 3 2 x have the same solution as in eq 5 skewness sk x and kurtosis ku x of the rtd are determined as 6 sk x sk t x 1 2 μ 3 x μ 2 x 3 2 ku x ku t x 1 μ 4 x μ 2 x 2 3 exact solution to eq 4 with the heaviside entry c 0 t 1 for t 0 and c x t 0 0 x 0 gives dimensionless values sk t sk x x l 3 2 1 k t pe 1 and ku t ku x x l 30 1 k t pe 1 however sk t and ku t generally differ from this solution indeed the spatial and temporal moments and hence their coefficients are interconnected via simple algebraic formulae established with the help of the extended method of moments emm see eqs 31 and 32 in vikhansky and ginzburg 2014 in this work these relations will be verified in multi dimensional porous flow 2 2 lattice boltzmann trt framework the lbm is operated on the cuboid computational grid within the penetrable fluid d dimensional domain r v ϕ an equidistant mesh size is set equal to one lattice unit the péclet number is kept the same in physical and numerical systems the neighboring nodes are interconnected by the d dimensional discrete velocity set ddqq it consists of a zero amplitude vector c 0 and q m q 1 vectors c q each vector c q has the opposite one c q c q q 1 q m 2 and the pair c q c q is called a link the local variable of the scheme is the set of q real numbers called populations f q r t q 0 q m the populations f q r t enter into the local collision sums with their post collision values g q r t and then propagate to the neighbor sites according to their discrete velocities the two populations with the opposite velocities are decomposed into their symmetric and anti symmetric components f q 1 2 f q f q and g q 1 2 g q g q q 1 q m in the present work the symmetric component f q is updated with the same relaxation rate s ϕ for all links the collision stream algorithm then reads adding a time independent mass source quantity m r to the outgoing immobile population f 0 r t 1 as follows 7a f q r c q t 1 f q r t g q r t g q r t q 1 q m 2 f q r c q t 1 f q r t g q r t g q r t c q c q q 1 q m 2 f 0 r t 1 f 0 r t m r 2 q 1 q m 2 g q r t 7b g q r t s ϕ f q r t e q r t q 1 q m 2 s ϕ 0 2 an exact mass conservation equation means that q 0 q m f q r c q t 1 q 0 q m f q r t m r for any equilibrium distribution e q r t e q e q the anti symmetric component g q r t will be computed either with the two relaxation times trt operator or multiple relaxation times mrt r operator the trt operator ginzburg 2005a 2007 vikhansky and ginzburg 2014 applies the same relaxation rate s ϕ for all links and copes with eq 7c 8 trt g q r t s ϕ f q r t e q r t q 1 q m 2 s ϕ 0 2 the relaxation rates are space dependent but time independent in this work the two relaxation rates in eq 8 are defined from the locally prescribed positive eigenfunctions λ ϕ r 9 s ϕ r λ ϕ 1 2 1 λ ϕ r λ ϕ r λ ϕ r λ ϕ 0 λ ϕ 0 it is convenient to parameterize λ ϕ in eq 9 through a positive free tunable parameter λ ϕ λ ϕ λ ϕ because λϕ controls the truncation accuracy ginzburg 2012 2017b ginzburg and roux 2015 stability ginzburg 2012 ginzburg et al 2010 kuzmin et al 2011a yan et al 2017 and interface boundary accuracy cui et al 2016 demuth et al 2016 ginzburg 2007 2017a remark 1 the same value s ϕ assigned for all the symmetric modes in eq 7c is the most natural and quite stable choice according to the von neumann exact analysis ginzburg 2013 the isotropic mrt models computed on the coordinate velocity sets ddq 2d 1 then all reduce to the trt operator 8 the regularized ddq 2d 1 isotropic schemes wang et al 2015 correspond to s ϕ 1 and hence λ ϕ 1 2 λ ϕ according to exact stability analysis ginzburg et al 2010 λ ϕ 1 4 or the so called optimal stability sub class otrt may assure the sufficiency of the necessary stability conditions the regularized choice is not optimal but perhaps more robust than the srt sub class where s ϕ s ϕ λ ϕ λ ϕ 2 and the non negativity of the equilibrium function e q e q e q 0 is proved kuzmin et al 2011a to become necessary in the limit λ ϕ 0 the otrt with λ ϕ 1 4 has larger velocity bounds in the isotropic and anisotropic schemes remark 2 another reason to keep λϕ independent from the transport eigenfunction λ ϕ is the consistent parameterization of the spatial truncation correction and steady state solutions by pe this property is guaranteed with the fixed value λϕ when the mass source is constant d humières and ginzburg 2009 and it will be examined for a space variable source in the present work e q r t has the form 10a e q r t t q c e k r t λ ϕ m r e q u r t q 1 q m 2 10b e q r t t q k r t α 1 d u ϕ α r c q α e q u r t q 1 q m 2 10c k r t k e q r t 1 2 m r k e q ρ r t ϕ r β e 10d ρ r t q 0 q m f q r t 10e ddq 2d 1 u ϕ 2 r α 1 d u ϕ α 2 c e ϕ r β e c e min r ϕ r d β e we note that eq 7a does not need to compute e 0 r t when the populations are initialized at the equilibrium one prescribes ρ r t 0 computes f q r t 0 e q e q and f q r t 0 e q e q q 1 q m 2 e g with m r 0 then f 0 r t 0 ρ r t 0 q 1 q m f q r t 0 in what follows we address the minimal discrete velocity sets ddq 2d 1 d1q3 d2q5 and d3q7 they are built on the coordinate discrete velocity vectors c q 1 α α 1 d these schemes yield the same weight t q 1 2 for a diffusion flux variable k r t in e q r t and an advective flux u ϕ k r t in e q r t because of the isotropic condition q 1 q m t q c q α c q β δ α β α β the macroscopic solution k r t is defined with the half mass source value in eq 10c for reduction of the truncation corrections kuzmin et al 2011b and correct parameterization of the modeled equation d humières and ginzburg 2009 because of this last objective the weight distribution tqce is also assigned for the mass term λ ϕ m r in eq 10a the two scale parameters ce and βe are set constant over the grid because of the leading order continuity condition prescribed for k r when a local mass quantity t q c e m is directly added to g q in eq 7c an equivalent scheme reads with e q r t t q c e k e q e q u in the transient modeling of eq 1 c r t is set equal to k r t and βe 1 since the transient term β e 1 t k vanishes at the steady state the stationary solutions are βe independent but their convergence becomes accelerated when βe 1 following ginzburg 2006 2 3 direct transient lbm ade solvers we extend the two classes of lbm ade isotropic schemes from the homogeneous to heterogeneous soil a further extension to full anisotropic diffusion tensors may adopt either anisotropic equilibrium chai et al 2016b ginzburg 2005a 2012 ginzburg and d humières 2007 ginzburg et al 2010 servan camas and tsai 2010 link wise collisions ginzburg 2005a ginzburg and d humières 2007 or non diagonal matrix collisions dubois et al 2016 huang and wu 2014 rasin et al 2005 yoshida and nagaoka 2010 different techniques are combined examined for numerical diffusion and supported with the corresponding necessary stability bounds in homogeneous soil ginzburg 2013 in a space variable velocity field numerical diffusion is expected ginzburg and roux 2015 huang and wu 2014 to be dominated by the physical and numerical dispersion already in the moderate péclet range the anti numerical diffusion treatment then becomes insignificant nevertheless let us start with two remarks on the numerical diffusion because its role is important in diffusion dominant processes through heterogeneous blocks in series remark 3 the second order chapman enskog expansion e g ginzburg 2005a servan camas and tsai 2008 chopard et al 2009 ginzburg 2013 and wang et al 2015 provides the numerical diffusion form fnum in heterogeneous soil fnum sums with the right hand side rhs of eq 1 f n u m λ ϕ α β 1 d β t u ϕ α c q 1 q m t q c q α c q β λ ϕ α 1 d α t u ϕ α c using k c and e q u 0 in eq 10b following ginzburg 2005a we replace t c by ϕ 1 u ϕ c o ϵ 2 according to the first order expansion and obtain for a time independent velocity field f n u m λ ϕ ϕ 1 α β 1 d α u ϕ α β u ϕ β c in a constant or streamline invariant duct flow an equivalent form reads f n u m f u 2 λ ϕ d u c with d u ϕ 1 u ϕ α u ϕ β we note that the forward time central finite difference lax wendroff schemes hindmarsch et al 1984 complement the diffusion tensor with a similar anti numerical diffusion form like λ ϕ d u δ x 2 δ t λ ϕ 1 2 see ginzburg et al 2010 in lbm ade by adopting anisotropic approaches f u 2 can be cancelled either with the help of the hydrodynamic type u ϕ α u ϕ β equilibrium correction on the full velocity sets chai et al 2016b ginzburg 2005a 2012 ginzburg et al 2010 or with the non diagonal collision matrix ginzburg 2013 rasin et al 2005 or else combining the two techniques ginzburg 2013 the alternative lbm techniques involve the pseudo velocities servan camas and tsai 2008 or body force strategy chai et al 2016b chopard et al 2009 servan camas and tsai 2008 wang et al 2015 following this approach one may set e q u λ ϕ t q α 1 d t u ϕ α c c q α in eq 10b without any velocity field approximation but with need to resorting for the backward finite difference approximate to compute t c u ϕ remark 4 the recurrence equations ginzburg and roux 2015 vikhansky and ginzburg 2014 produce numerical diffusion correction to the rhs of eq 1 in the exact form f n u m λ ϕ t 2 ϕ c the chapman enskog approximate is then matched applying twice t ϕ c u ϕ c and replacing the central differences by their differential counterparts this suggests that the removal of the entire numerical diffusion may require the time centered implicit anti correction we will consider two different anti numerical diffusion corrections to the approximate form f u 2 r λ ϕ d u c d u ϕ 1 u ϕ α u ϕ β in trt ade schemes they combine eq 8 with eq 10 on the coordinate stencil ddq 2d 1 in the three linear following forms using c r t k r t βe 1 and d ϕ ϕ d 0 11a ade c e q u 0 λ ϕ c e d ϕ d ϕ ϕ d 0 11b ade j e q u t q ϕ 1 c α 1 d u ϕ α u ϕ β c q α c q β e q u 0 λ ϕ c e d ϕ 11c ade 1d e q u 0 λ ϕ c e u ϕ x 2 ϕ d ϕ u ϕ x 2 c e ϕ the ade c operates with a continuous equilibrium but it models the diffusion tensor with the correction λ ϕ d u the ade j with e q u vanishes only the diagonal entries λ ϕ d u on the coordinate velocity sets we note that e q u is subject to the jumps when the velocity vector is perpendicular to the interface this is because of the discontinuity in coefficients λ ϕ although f u 2 r is space continuous together with the velocity field u ϕ r the ade 1d in eq 11c is only suitable for 1d where it removes f u 2 with the help of the velocity dependent relaxation function λ ϕ this scheme has been compared with ade j in homogeneous soil ginzburg 2013 and can be applied for darcy flow in series in multi dimensions the mrt r block matrix collision allows to remove f u 2 on the coordinate stencil cf ginzburg 2013 eq 44 we propose an extension to heterogeneous soil for g q r t in eq 7a as follows 12a mrt r g q r t β 1 d s α β r f β r t e β r t q α 1 q m 2 d 12b s α β 1 d 0 ϕ c e 1 2 δ α β d 0 ϕ c e c e ϕ u ϕ 2 u ϕ α u ϕ β α β 1 d 12c ade r β e 1 e q u 0 λ ϕ λ ϕ 1 d 0 ϕ 2 c e ϕ u ϕ 2 λ ϕ 2 λ ϕ 3 d ϕ c e u ϕ 2 c e ϕ the ade r operates with the continuous equilibrium distribution the matrix s α β 1 is the inverse of the collision matrix sαβ the d eigenfunctions λ ϕ 1 s ϕ 1 2 are built with the eigenvalues s ϕ of the collision matrix sαβ cf ginzburg 2013 eq 54 this collision operator is called rotated because its matrix becomes diagonal in the axes aligned with the velocity vector u ϕ ade r reduces to ade 1d in one dimensional flow an extension of eq 12 to full velocity sets and anisotropic diffusion tensor may follow ginzburg 2013 we note that the necessary stability line from eq 12c coincides with the ade c stability bound from eq 10e but λ ϕ 1 unboundly increases on the stability line degrading the truncation accuracy in this work we fix an uniform value λϕ and define λ ϕ λ ϕ max λ ϕ λ ϕ λ ϕ 1 in eq 9 the mrt r then intrinsically operates with two distinguished values λϕ and the smaller valued λ ϕ λ ϕ 2 λ ϕ 1 their disparity may degrade the accuracy and stability against the λϕ optimized trt schemes ginzburg 2013 remark 5 the two stability conditions in eq 10e present a formal extension to the necessary stability conditions established with the von neumann linear analysis ginzburg et al 2010 in the absence of the interface boundary and mass sources but comprising the worst possible scenario for the respective position of the wave and constant velocity vectors indeed the velocity bound from eq 10e assures the positive semi definiteness of the effective diffusion tensor λ ϕ i d u the ade j may exceed this bound by a factor d d 1 in d2q5 and d3q7 especially when λ ϕ 1 4 in eq 9 numerical computations confirm the principal stability bounds and trends in duct flow ginzburg and roux 2015 yan et al 2017 and multi dimensional porous scale velocity field yan et al 2017 finally we recall that the effective mean seepage velocity of the numerical scheme is detected by the first raw moment while the effective quantity of the numerical diffusion is detected by the variance the direct solvers compute the solute evolution through a long array of duplicated periodic unit cells cf v in fig 1 a very useful check is that in the spatial spread and taylor regime all minimal schemes should produce μ 1 t δ t μ 1 t u s u m δ t where an arithmetical mean value u s u m over the cross section replaces u x in a straight stratified flow the ade j ade 1d and ade r minimal schemes produce σ 2 t δ t σ 2 t 2 d ϕ δ t exactly in ϕ uniform constant darcy flow u ϕ x while the ade c gives σ 2 t δ t σ 2 t 2 d ϕ 1 u ϕ x 2 ϕ c e δ t we note that the taylor regime is difficult to reach at high pe because the number of cells grows linearly with pe and the computational time increases as pe2 at least the three schemes 11 will be examined for the quality of their profiles and the first four moments in a perpendicular one dimensional darcy flow through heterogeneous blocks against the analytical emm solution ginzburg and vikhansky 2018 the three schemes 11a 11b and 12a will be compared between them and with the steady state trt emm predictions for dispersion skewness and kurtosis in temporal and spatial moments in two dimensional flow around solid and through porous obstacles 3 extended method of moments emm and trt emm the emm provides an alternative way to compute the transport coefficients in eqs 5 and 6 section 3 1 formulates the corresponding steady state boundary value emm problems section 3 2 proposes their numerical formulation trt emm based on the trt operator 8 and equilibrium distribution 10 3 1 the emm solution for the spatial and temporal moments the extended method of moments ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 searches a solution to eq 1 in the decomposed form 2 either expanded into perturbative series in ω form 3a or in γ form 3b assume first that the coefficients of the two expansions ωn and γn are known and their dimensionless counterparts are defined giving the mean characteristic velocity u 0 and characteristic length l respectively 13 ω n ω n u 0 1 l n 1 and γ n γ n u 0 n l n 1 n 1 they determine the dimensionless transport coefficients in eqs 5 and 6 14a u x u 0 ω 1 and if u x 0 u x u 0 γ 1 14b d ω 2 d e f f ω 2 u ϕ 0 14c k t d 0 d d 0 1 ω 2 pe 1 u x 3 u 0 3 γ 2 pe 1 pe u 0 l d 0 14d sk s sk t u 0 t l 3 ω 3 2 ω 2 3 2 ku s ku t u 0 t l 6 ω 4 ω 2 2 14e sk t sk x x l 3 γ 3 x x 2 γ 2 x 3 2 ku t ku x x l 6 γ 4 γ 2 2 x x in pure diffusion ω 1 u ϕ 0 0 and the ω form allows to compute d e f f and the higher moments due to the structure the γ form becomes undefined in motion the two sets of the coefficients are inter related 15 γ 1 1 ω 1 γ 2 ω 2 ω 1 3 γ 3 2 ω 2 2 ω 1 ω 3 ω 1 5 γ 4 5 ω 2 3 5 ω 1 ω 2 ω 3 ω 1 2 ω 4 ω 1 7 the back transform ω n γ n has exactly the same form exchanging ω n and γ n in what follows we have u 0 u x with the x component mean u x of seepage velocity u from eq 4 then when u x 0 ω 1 γ n 1 in eqs 14a 15 in theory the two formulations are equivalent and produce identical transport coefficients with the help of eq 15 it is shown ginzburg and vikhansky 2018 that the two problems are tackled through the linear combinations of the boundary value problems we focus on the ω form because it is simpler and allows for pure diffusion in ω form the emm looks for the scalar distribution b n r called b field which sequentially solves the steady state ade given by eqs 16a 16e inside a penetrable region r v ϕ v of a single cell v streamwise periodic along the x axis 16a u ϕ r b n r j n r m n r d ϕ b n n 1 d ϕ ϕ r d 0 16b m n r m n r s n r ϕ r b 0 ω n n 1 b 0 1 16c m 1 r u ϕ x b 0 s 1 0 ω 1 u ϕ x ϕ u x 16d m n r ϕ k 1 n 1 ω k b n k r d ϕ b n 2 u ϕ x b n 1 n 2 16e s n r d ϕ x b n 1 n 2 j n r d ϕ b n 1 r 1 x n 1 16f ω n m n s n ϕ b 0 n 1 let n be a normal vector on the boundary or interface and ψ a ϕ ψ a ϕ ψ a ϕ denote the jump of a scalar variable ψ r on the interface aϕ along n solution b n r is constrained to the periodic interface boundary and normalization conditions respectively 17a b n r l x 1 x b n r 17b b n a ϕ 0 d ϕ n b n a ϕ n j n a ϕ 17c d ϕ n b n a s n j n a s 17d b n ϕ ϕ 0 eqs 16a 16e are linear with respect to b n r because m n r and j n r in eq 16a are built with the known solution b k r k n n 1 these terms are exemplified in eq a 1 the set ωn is built in eq 16f from the solvability condition m n 0 which implies global mass conservation since b n r u ϕ r and hence the advective flux u ϕ b n are continuous the normal component of the diffusion flux d ϕ b n is subject to the prescribed jump value ϕ n b n a ϕ ϕ b n 1 n x a ϕ according to eq 17b with eq 16e when ϕ r is discontinuous along the x axis at interface aϕ ϕ r n x a ϕ 0 eq 17b comprises the solid side r s a s with ϕ r s 0 j n r s 0 u ϕ x r s 0 and prescribes the jump of the diffusion flux normal component on the solid wall by eq 17c with eq 16e n b n a s b n 1 n x a s the flux jump term j n r and the mass term s n r vanish in x parallel stratified channels and ducts where the boundary value problem reduces to diffusion equation with the transversely variable mass source and continuous advection diffusion flux the b field is defined to a constant it is fixed without loss of generality by the normalization condition 17d using eq 17d for all orders k n in eq 16f the terms ϕ k 1 n 1 ω k b n k and d ϕ b n 2 vanish for n 2 and ωn can be computed as 18a ω 2 d 0 u ϕ x b 1 ϕ d ϕ x b 1 ϕ 18b ω n u ϕ x b n 1 ϕ d ϕ x b n 1 ϕ n 3 eqs 16f and 18 allow to predict n longitudinal moments the effective diffusivity d e f f in eq 14b and the associated higher order moments due to the structure alone are computed solving eqs 16 17 with zero velocity u ϕ 0 in order to obtain the three transport coefficients in eq 14 a symbolic or numerical procedure solves eqs 16 17 three times with respect to b n r n 1 2 3 the coefficients ω 2 ω 3 and ω 4 from eqs 16f and 18 then allow to compute respectively kt sk s and ku s in eq 14 with the help of eq 13 the temporal transport coefficients sk t and ku t from eq 14 are built with the help of eq 15 the boundary value problem reads similar in the γ form using eqs a 2 a 4 with the non zero mean seepage velocity u x the boundary problem 16 17 can be solved independently for each periodic direction of the unit cell v the full rank effective diffusion and dispersion tensors can be restored from d runs with the help of the formulation ginzburg and vikhansky 2018 it applies either with an isotropic or anisotropic tensor d 0 at the first order n 1 this procedure extends the b equation brenner 1980 salles et al 1993 from homogeneous to heterogeneous soil an extension to any order longitudinal coefficients is straightforward employing the recursive procedure vikhansky and ginzburg 2014 3 2 numerical formulation trt emm the trt emm solves eqs 16 17 inside a unit cell v with the trt collision operator from eq 8 and the equilibrium distribution in eq 11 where it substitutes m m n r k b n r t e q u 0 and e q u t q α 1 d j n α c q α e q u is set equal to zero because numerical diffusion vanishes at steady state e q u is introduced in order to couple the advective flux and diffusion flux correction j n and then to produce the diffusive flux jump in eq 17b implicitly eq 11 becomes 19a e q r t t q c e b n r t λ ϕ r m n r 19b e q r t t q α 1 d u ϕ α r b n r t j n α r c q α 19c b n r t b n e q r t 1 2 m n r b n e q ρ r t ϕ r β e 19d ρ r t q 0 q m f q r t r v ϕ the trt emm can be applied in the form 19 with the full discrete velocity sets and isotropic weights tq the minimal sets apply t q 1 2 an acceleration parameter βe 1 from eq 11 should respect the stability condition 10e the steady state solutions are independent from βe and initial distribution ρ r t 0 like the direct ade solvers the trt emm runs across the heterogeneous domains vϕ without any explicit interface conditions the diffusive flux jump condition on the solid surface is modeled implicitly with the bounce back boundary rule see eq 29b the effective interface boundary closure relations will be derived and compared to eqs 17b and 17c the obtained steady state solution b n r is normalized with eq 17d yielding 20 b n r b n r b n b n b n ϕ ϕ n 1 all the integral values ψ in eqs 16 18 and 20 are computed with the summation over the grid points hence by construction the mean seepage velocity is set equal to u s u m r u ϕ x r r ϕ r applying the summation procedure the global population mass r ρ r ρ r q 0 q m f q r t is conserved exactly due to the discrete solvability condition r m n r 0 the sum of all populations over the grid should remain the same during computations the terms m n r and j n r are precomputed with eqs 16b 16e exemplified in eq a 1 in that s n r is approximated with the help of the streamwise finite differences applied inside vϕ e g using eq a 6 we do not apply here the local gradient solution like c e x b n q 1 q m g q c q x because of its intrinsic correction due to the mass source and velocity variations the γ form computes eq 19 with eqs a 2 and a 3 for m n r and eq a 5 for j n r the set γn is constructed with eq a 4 the numerical recipe is formulated for trt emm in appendix a 4 at steady state f 0 r t 1 f 0 r t in eq 7a and an exact mass conservation equation reads 21 m r 2 q 1 q m 2 g q r the recurrence equations d humières and ginzburg 2009 ginzburg 2012 ginzburg and roux 2015 express both the transient and the steady state solution of g q exactly see ginzburg 2017a eq 20 we will make the use of the two steady state linear combinations 22 g q r δ q e q λ ϕ δ q 2 e q λ ϕ 1 4 δ q 2 g q r λ ϕ g q r λ ϕ δ q e q 1 4 δ q 2 e q λ ϕ 1 4 δ q g q r r v ϕ the central differences apply link wisely δ q ψ r t 1 2 ψ r c q t ψ r c q t and δ q 2 ψ r t ψ r c q t 2 ψ r t ψ r c q t ψ e q g q eq 22 are derived with the space uniform eigenfunctions λ ϕ in our context they apply inside piece wise continuous porous block vϕ plugging first eq 22 with 19 into eq 21 an exact form of the modeled mass conservation equation reads 23a u ϕ b n j n m n r n d ϕ b n d ϕ r λ ϕ r c e 23b r n r λ ϕ c e δ 2 m n r λ ϕ 1 4 q 1 q m δ q 2 g q r n 1 eq 23a presents the central difference approximate of eq 16a up to correction r n r the first component in r n r is non zero when m n r is a non linear function of the spatial coordinate the term λ ϕ 1 4 q 1 q m δ q 2 g q presents the generic trt truncation correction see ginzburg 2017b ginzburg and roux 2015 eq 23 is not specific for trt emm it describes the steady state equation modeled with the trt operator and linear equilibrium distribution 19 in that j n 0 when the advective diffusion flux is set continuous on the interface 4 bulk and interface analysis in a parallel and a perpendicular flow the analysis developed in this section applies exactly for any steady state solution of eq 23 provided that b n r varies along one lattice direction in particular the described situation takes place in a series of porous blocks and stratified channels as sketched in fig 2 4 1 parameterization property when solution bn x to eq 23 varies only along the x axis isotropic solution g q r to eq 21 reads 24a g q r t q m x c q x 2 then 24b q 1 q m g q r m x and q 1 q m δ q 2 g q r δ x 2 m x eq 23 then becomes 25 u ϕ b n j n m n α m δ x 2 m n d ϕ b n α m 1 4 λ ϕ 1 c e we expect eqs 24a and 25 to remain valid for any x axis rotation because of the isotropy of the term t q q 1 q m c q x 2 let us consider the following dependency between λϕ and ce 26a λ ϕ a 1 c e a 0 then α m 1 4 a 26b α m 0 if a 1 4 then λ ϕ 1 4 1 c e eq 26a allows to produce the same solution b n r for any individual values λ ϕ and ce when the diffusion coefficient d ϕ λ ϕ c e is fixed in motion eq 26a allows for a consistent control of eq 25 by péclet number and porosity contrast we say then that eq 26 allows for a proper parameterization of the modeled eq 25 however b n r becomes dependent upon a free tunable value a its specific solution a 1 4 vanishes the truncation correction since λ ϕ 1 4 as ce 0 this choice is expected to be robust remark 6 in principle the mass term in eq 19 can be applied with an individual free tunable scale parameter c e m 0 1 as 27 e q r t t q c e b n r t 1 2 m n r t q c e m s ϕ m n r then α m 1 4 1 2 λ ϕ c e c e m λ ϕ 1 c e m eq 27 reduces to eq 19 when c e m c e and αm then reduces to eq 26b however when c e m c e bn depends upon ce and λ ϕ separately even if their product is fixed 4 2 interface conditions in a parallel and a perpendicular flow assume a flat interface x x 0 midway the two grid nodes x 0 x 0 and without loss of generality fix the interface cut link c q such that x 0 1 2 c q x x 0 the two steady state exact interface conditions of the trt operator 8 read e q see ginzburg 2007 ginzburg and d humières 2007 28a s q x 0 0 with s q x 0 s q x 0 s q x 0 s q x 0 e q 1 2 g q λ ϕ g q x 0 s q x 0 e q 1 2 g q λ ϕ g q x 0 28b g q x 0 0 with g q x 0 g q x 0 g q x 0 g q x 0 e q 1 2 g q λ ϕ g q x 0 g q x 0 e q 1 2 g q λ ϕ g q x 0 applying eq 10 the effective continuity condition of the scalar variable k r is set by eq 28a the effective advective diffusion flux jump condition for u ϕ k r d ϕ k r is set by eq 28b the anti bounce back abb and bounce back bb rules ginzburg 2005b 2017a apply for the incoming population f q r b t 1 in the grid boundary node r b 29a abb f q r b t 1 f q g q g q r b t 2 e q r s 29b bb f q r b t 1 f q g q g q r b t r b r s 1 2 c q r s a s the bb applies for the no flux condition in the direct ade schemes and trt emm the abb applies for the heaviside input in the direct rtd computations we note that abb and bb steady state closure relations are comprised in eqs 28a and 28b respectively 30a abb e q 1 2 g q λ ϕ g q r b e q r s 30b bb e q 1 2 g q λ ϕ g q r b 0 in the series configuration along the x axis the darcy velocity u ϕ u 1 x and the flux jump term j n j n 1 x are both perpendicular with the interface x x 0 the jump value j n x 0 in eq 17b is non zero when the two blocks have distinguished porosity in a stratified channel along the y axis the velocity profile u ϕ u ϕ x x 1 y is parallel with the interface y replaces x in eq 16 for stratified flow in this section see fig 2 eq 23 reduces to the diffusion equation and the interface analysis applies in the transverse x direction with u 0 and j n 0 let us express eq 25 in terms of the phase dependent grid péclet number pe 31a p e x b n x j n m n α m δ x 2 m n δ x 2 b n r v ϕ 31b p e u d ϕ j n d ϕ 1 j n m n d ϕ 1 m n d ϕ λ ϕ c e we consider an interface cut link c q x 2 1 c q x 3 c q x e q from eq 19 g q from eq 22 and g q from eq 24a then read 32a e q t q c e b n λ ϕ c e m n 32b e q t q c e λ ϕ ϵ n c q x ϵ n p e b n j n 32c g q x t q c e λ ϕ m n x c q x 2 32d g q x t q c e c q x x b n 1 4 δ x 2 ϵ n c q x 2 α m x m n the central difference operators imply δ q ψ x ψ c q x 1 2 ψ x c q x ψ x c q x and δ q 2 ψ δ x 2 ψ c q x 2 ψ x c q x 2 ψ x ψ x c q x ψ 4 3 effective continuity condition plugging eqs 32a and 32c eq 28a reads with 33 s q x 0 t q c e b n λ ϕ 1 c e m n c q x 2 1 2 g q x 0 we substitute eq 32d for g q x factorize tqce and split s q t q c e 1 into the two components t q 2 x 0 the second order central difference taylor expansion from x 0 to x x 0 and the remaining component r q x 0 eq 33 yields 34a s q x 0 t q c e t q 2 x 0 r q x 0 with 34b t q 2 x 0 b n 1 2 x b n c q x 1 8 δ x 2 b n c q x 2 x 0 34c r q x 0 λ ϕ 1 c e m n c q x 2 1 8 δ x 2 b n c q x 2 1 8 δ x 2 ϵ n c q x 1 2 α m x m n c q x x 0 when λϕ and ce are inter related through eq 26a eq 34c becomes 35 r q x 0 a m n 1 8 δ x 2 b n c q x 2 1 8 δ x 2 ϵ n c q x 1 2 1 4 a x m n c q x x 0 since ce is set constant over the grid eq 28a as well as eqs 34 35 become tqce independent and parameterized by a a pure diffusion through a series of porous blocks is comprised with u 0 and j n x 0 0 the emm then predicts the effective diffusivity and kurtosis due to the porosity contrast see ginzburg and vikhansky 2018 in a semi explicit diffusion scheme formulated by eqs b 4 and b 5 for comparison with the implicit jump tracking via eq 19 e q 0 and the flux jump value j n x 0 is interpolated to the interface and prescribed explicitly then ϵ n 0 and m n becomes replaced by m n x j n in eq 32 this scheme is expected to behave similar to the interface configuration which takes place in the stratified channels example 1 stratified channels in that case p e 0 δ x 2 ϵ n 0 and m n δ x 2 b n α m δ x 2 m n is expressed from eq 31 the continuity condition 28a gives with the help of eqs 34 35 36a a b n 1 x 0 0 if m n x 0 36b a 1 8 b n 2 x 0 0 if m n x c o n s t n 36c a 1 8 b n 3 x 0 0 if m n x a n x b n with r q x 0 1 16 x m n c q x x 0 1 16 x 3 b n c q x x 0 1 2 x b n c q x 1 2 x b n 1 12 x 3 b n c q x then s q x 0 t q c e b n 1 2 x b n c q x 1 8 x 2 b n c q x 2 1 48 x 3 b n c q x x 0 36d a 1 4 b n 2 x 0 1 8 m n x 0 1 8 δ x 2 b n x 0 m n x eqs 36a 36c take into consideration that δ x 2 m n 0 b n k x means here the k th order central difference taylor expansion from the interface nodes to the interface eq 36a indicates that a piece wise linear function bn x is continuous on the interface this addresses a pure diffusion in series with n 1 in eq 25 either with the semi explicit or implicit interface since j 1 x is piece wise constant δ x 2 ϵ n 0 in the two cases eq 36b tells that the parabolic function bn x is continuous on the interface when m n x is a piece wise constant only provided that a 1 8 this condition supports an exact parabolic solution bn x to eq 25 either in a stratified darcy flow when n 1 or with the semi explicit jump tracking diffusion scheme in series when n 2 eq 36c extends the exact closure condition of a 1 8 to the third order polynomial solution bn x governed by the piece wise linear mass source this addresses n 3 kurtosis in eq 25 with the semi explicit jump tracking diffusion scheme in series eqs b 4 and b 5 it follows that a 1 8 is the most suitable choice for diffusion equilibrium ϵ n 0 when the mass source is either piece wise constant or linear eq 36d indicates that when the correction of αm vanishes due to a 1 4 the interface continuity condition is exact for parabolic distribution bn only if m n x 0 0 that is when m n scales with ϕ and m n is continuous the described situation takes place in the next example example 2 pure diffusion with the implicit jump tracking in series of porous blocks in pure diffusion through two heterogeneous blocks ω 2 n 1 0 jn x and m n x are respectively n 1 and n 2 order polynomials let us show that a 1 4 in eq 36d assures the continuous solution both for the parabolic function b 2 x and the third order polynomial b 3 x eq 19 matches the diffusion flux jump implicitly via e q t q j n c q x hence δ x 2 ϵ n becomes non zero for n 3 kurtosis the key point is that x j n s n m n m n ϕ ω n according to eq 16e when p e 0 α m 0 eqs 31 and 34 with eq 35 then become respectively 37a m n x 1 2 δ x 2 b n m n ω n m n m n d ϕ ω n ω n ϕ d ϕ ω n d 0 37b a 1 4 b n 2 x 0 1 8 m n ω n δ x 2 j n c q x x 0 then 37c a 1 4 b 2 2 x 0 0 b 3 3 x 0 0 eq 37b is obtained by substituting a 1 4 eq 37a and δ x 2 ϵ n δ x 2 j n into eq 35 when n 2 the rhs vanishes in eq 37b because ω n is constant n m 2 is constant and δ x 2 j 2 0 when n 3 the rhs vanishes in eq 37b because j 3 x is the parabolic function 2 x 2 j 3 x m 3 x 3 b 3 when α m a 0 0 using x j n s n and 1 8 δ x 2 j n c q x 1 8 x 2 j 3 c q x gives a continuation to the interface 1 16 x m 3 c q x for the piece wise linear function 1 8 m 3 x in the rhs of eq 37b and 1 16 x 3 b 3 x c q x in the lhs of eq 37b then b 3 3 x 0 0 for the third order polynomial solution b 3 x similarly as in eq 36c we conclude that the semi explicit and implicit interface jump tracking impose the continuous polynomial solutions to pure diffusion equation n 2 and n 3 with two distinguished values a 1 8 and a 1 4 respectively the choice a 1 8 is the same as in stratified channels example 3 darcy velocity in a series when n 1 in that case m n x and jn x are piece wise constant x m n 0 δ x 2 m n 0 and x j n 0 bn x is the discrete exponential function and the term 1 8 δ x 2 ϵ n c q x 1 8 p e δ x 2 b 1 c q x is non zero in eq 35 when m 1 x is expressed from eq 31 m 1 p e x b 1 δ x 2 b 1 the continuity condition given by eq 28a with eq 33 takes the form of the asymmetric taylor expansion from the two interface sides x 0 x 0 1 2 c q x 38a s q x 0 t q c e b 1 α x b 1 c q x α δ x 2 b 1 c q x 2 x 0 n 1 38b α x 0 1 2 λ ϕ 1 c e p e c q x α 1 2 if λ ϕ 0 38c α x 0 1 8 p e c q x λ ϕ 1 c e when pe 0 then α 1 2 λϕ and the analysis reduces to the pure diffusion problem discussed above however the perpendicular flow introduces the asymmetric not equal coefficients of pe in α for two neighbor nodes and the leading order coefficient α becomes accurate only in the asymptotic limit λϕ 0 this suggests that the midway continuity of the solution b 1 x and the measured dispersion coefficients will degrade with pe and that only very small values a in eq 26a will improve for this however such a choice is rather unstable ginzburg and roux 2015 kuzmin et al 2011a this continuity analysis extends straightforwardly for the next orders 4 4 effective flux jump condition plugging eq 32 into eq 28b an exact form of the interface continuity condition for the total flux component φ x u b n j n d ϕ x b n reads 39 g q x x 0 0 with g q x 0 t q c q x φ x 1 2 m n c q x α m x m n c q x 2 1 4 δ x 2 e q c q x 2 x 0 t q c q x φ x 1 2 x φ x c q x x 0 α m t q c q x x m n 1 2 δ x 2 m n c q x x 0 1 4 δ x 2 e q c q x 2 x 0 where x φ x m n α m δ x 2 m n when δ x 2 e q c q x 2 x 0 0 eq 39 gives 40 if x m n x 0 0 or m n if a 1 4 α m a 0 u b n d ϕ x b n 1 x x 0 j n 1 x x 0 with g q x 0 t q c q x φ x 1 2 x φ x c q x x 0 eq 40 presents second order accurate flux jump condition of the scheme it is exact with respect to the interface location only when all flux components are linear functions in space this is valid in the stratified darcy flow when n 1 a u j n 0 m 1 is a piece wise constant b 2 is parabolic otherwise eq 40 applies in a stratified flow with a 1 4 eq 40 applies in pure diffusion in a series when n 1 2 a because m n is piece wise constant when n 1 2 however δ x 2 e q c q x 2 x 0 is different from zero for all orders in the perpendicular darcy flow and it is expected to modify the coefficient of the second order correction in flux jump effective location in eq 40 when m n x is a linear function and bn x is the third order polynomial e g in pure diffusion problem an exact midway location of the flux jump condition is reached with the specific value a 5 24 41 m n a n x b n a 5 24 α m a 1 24 φ x 3 x 0 j n 2 x 0 with φ x d ϕ x b n φ x 1 6 d ϕ x 3 b n φ x d ϕ x b n and g q x 0 t q c q x φ x 1 2 x φ x c q x 1 8 x 2 φ x c q x 2 x 0 eq 41 is obtained using α m x m n α m d ϕ x 3 b n in pure diffusion with linear source x m n x m n δ x 2 m n 0 g q x 0 in eq 41 then gets an extra term α m 1 8 1 6 d ϕ x 3 b n which vanishes with α m 1 24 the modeled third order polynomial solution is exact with a 5 24 in a stratified either periodic or bounded by the bounce back channel governed by the linear mass source eq 41 also applies in a pure diffusion for n 3 kurtosis with the semi explicit jump tracking scheme where e q 0 flux jump value j n 2 x 0 is modeled exactly and the total linear mass source includes x jn x see eq b 5 however an implicit jump diffusion scheme 19 incorporates an additional non zero term 1 4 δ x 2 e q c q x 2 x 0 1 4 t q δ x 2 j n c q x x 0 2 8 t q x 2 j n c q x x 0 with the parabolic distribution jn x for n 3 kurtosis the difference with g q x 0 in eq 41 then reads r q x 0 t q c q x α m 1 8 x 2 j n α m 1 24 d ϕ x 3 b n x 0 using first α m x m n α m d ϕ x 3 b n x 2 j n and then 1 8 x 2 j n c q x x 0 for continuation of the parabolic solution jncqx in interface jump term j n 2 x 0 eq 41 a particular parameter dependent dependency a r ϕ r h from eq b 3 then solves r q x 0 0 4 5 summary the bulk and interface analysis was developed in a common framework for stratified channels and porous blocks in series a specific dependency between a and ce from eq 26a allows to parameterize properly the modeled equation and the effective closure relations in these two situations this analysis suggests that due to the linearity of the truncation correction and the interface conditions with respect to the mass source m n and the flux jump term j n the ω form and γ form are numerically equivalent in these configurations when the control parameter a from eq 26a takes the same value in both formulations three physical parameter independent solutions for a have been considered 42a a 1 4 λ ϕ 1 4 1 c e 42b a 1 8 λ ϕ 1 8 1 c e 42c a 5 24 λ ϕ 5 24 1 c e firstly eq 42a vanishes αm in eq 25 and provides continuous parabolic and third order polynomial pure diffusion solution for b 2 x and b 3 x respectively in a series of porous blocks in the case of the implicit interface tracking with eq 19 secondly eq 42b assures exact parabolic solution b 1 x and hence the dispersion coefficient in a stratified darcy flow it also assures continuous second and third order polynomial functions b 2 x and b 3 x in diffusion process in a series of the porous blocks when the semi explicit jump tracking from eqs b 4 and b 5 replaces eq 19 we note that eq 42b is known for the midway continuity of the parabolic solutions in the presence of the heterogeneous diffusion coefficients ginzburg 2007 2017b but also for an exact location of the straight dirichlet boundary with the anti bounce back rule in parabolic distributions governed by the constant mass source see particular solutions chai and zhao 2014 cui et al 2016 and general form ginzburg 2017b when c e 1 3 eqs 42a and 42b give respectively λ ϕ 3 8 and λ ϕ 3 16 the first solution is known for its annihilation of the truncation coefficient due to the resistance variation in the trt brinkman flow scheme ginzburg et al 2015b the second solution assures the midway location of the interface continuity and the bounce back no slip condition in the parabolic velocity profile ginzburg 2007 thirdly eq 42c assures a midway location of the flux continuity and no flux bounce back boundary in the stratified flow governed by a piece wise linear mass source it also assures the exact flux jump condition for the third order polynomial diffusion solution in a series modeled with the semi explicit jump tracking the implicit jump tracking from eq 19 needs however a parameter dependent solution a k u s u m from eq b 3 for the same objective these two distinguished solutions provide an exact solution for the kurtosis up to summation in the pure diffusion problem hence on the one hand the semi explicit jump tracking makes the diffusion problem in series equivalent with the stratified channels on the other hand it does not vanishes the a dependency in parabolic and higher order solutions bn x to be contrasted with the local node centered implicit tracking in eq 19 the semi explicit jump tracking is more involved numerically because it is link centered and requires an interpolation of the prescribed jump value to the interface besides the space variable mass sources a new point in this interface analysis is the presence of the non zero interface perpendicular velocity it is predicted that the darcy velocity u makes the continuity condition asymmetric from the two interface sides in series this specific deficiency only vanishes in the stability limit λϕ 0 an impact of this property on the moments will be examined in section 5 finally we note that the developed analysis procedure can be adopted for any linear equilibrium and collision operator in simple geometries with a possible extension for their rotation with respect to the lattice 5 series of porous blocks we consider a periodic series of two porous blocks along the x axis with the interface at x 0 0 see fig 2 the porosity is ϕ 1 when x h 1 0 and ϕ 2 when x 0 h 2 the characteristic length is set equal to h h 1 h 2 the system can be parameterized through the porosity contrast r ϕ ϕ 1 ϕ 2 and aspect ratio r h h 1 h 2 since the two blocks are interchangeable all results are invariant with respect to the simultaneous transformation r ϕ r ϕ 1 and r h r h 1 we consider rϕ 0 1 and rh 0 closed form expressions are provided ginzburg and vikhansky 2018 i the effective diffusivity d e f f skewness coefficients sk s and ku s they are gathered in eq b 1 and ii for ω 2 ω 3 and hence k t d e f f and sk s in the presence of the constant darcy flow see eqs 58 c 1 and c 2 in ginzburg and vikhansky 2018 we will measure the differences to the exact solution in the following forms 43a e k t d n u m d e f f 1 k t d e f f k t when k t 0 43b e d d n u m d 0 1 k t d 0 1 k t 43c e sk s sk s n u m sk s 1 e ku s ku s n u m ku s 1 eq 43a is only applied for darcy flow in series we will show that d e f f is the exact solution of the pure diffusion trt emm and hence e kt vanishes when kt 0 this is to be contrasted with the direct ade solvers in the presence of the numerical diffusion where e kt diverges when kt 0 the blocks in series are challenging for both numerical approaches trt emm and trt ade because the heterogeneity happens in the streamwise direction and the associated non gaussian effects are relatively weak but non zero section 5 1 constructs and examines the symbolic solutions of the trt emm in pure diffusion section 5 2 extends this analysis for a constant darcy flow section 5 3 compares numerical solutions for the three transport coefficients in the darcy flow between the trt emm and the three trt ade schemes from eq 11 the trt ade schemes are additionally examined on the continuity of their solutions 5 1 pure diffusion symbolic trt emm solutions in pure diffusion along the x axis eq 16a reduces to the one dimensional linear diffusion equation with respect to b n k x inside each block k 44 x j n k m n k x x ϕ k d 0 x b n k x j n k x d ϕ x b n 1 k n 1 mass source m n k obeys eqs 16b 16e with u ϕ x 0 at the interface b n x 0 0 and d ϕ x b n x 0 d ϕ b n 1 x 0 the periodic condition is applied at the unit cell ends b n 1 x h 1 b n 2 x h 2 the trt emm solves eq 25 with u ϕ x 0 45 x j n k m n k x α m δ x 2 m n k ϕ k d 0 δ x 2 b n k x n 1 b field solution bn x to eqs 44 45 is n order polynomial the j n k x and m n k x are respectively the polynomials of orders n 1 and n 2 hence when n 1 3 the central difference operators x j n k and δ x 2 b n k x are exact δ x 2 m n k 0 and αm correction vanishes interface conditions from eq 28 read e g with x 0 0 and c q x 1 as see fig 2 46a e q 1 2 g q λ ϕ g q 1 x 1 2 e q 1 2 g q λ ϕ g q 2 x 1 2 46b e q 1 2 g q λ ϕ g q 1 x 1 2 e q 1 2 g q λ ϕ g q 2 x 1 2 46c e q 1 2 g q λ ϕ g q 1 x h 1 1 2 e q 1 2 g q λ ϕ g q 2 x h 2 1 2 eqs 46a and 46c are continuity conditions 28a eq 46c is the flux condition 28b the flux condition on the periodic interface is satisfied automatically eq 46 read with eq 19 and 24a e q k t q c e b n k x λ ϕ k m n k x e q k t q j n k x c q x and g q k t q m n k x c q x 2 g q k x is expressed from them with eq 22 where δ q e q k and δ q g q k apply on the solution of the given block k solution b n 1 x b n 2 x is determined by eqs 45 46 to a constant fixed by eq 20 the continuity condition is elaborated in eqs 34 35 and discussed in example 2of section 4 3 the effective flux jump condition is developed in eq 39 the two conditions have the form of the central difference taylor expansion from the neighbor interface nodes x 0 1 2 to x 0 when n 1 then m 1 s 1 ω 1 m 1 0 j 1 d ϕ x j 1 x 0 b 1 x is piece wise linear and eq 46 are exact the superscript k is dropped hereafter hence b 1 x is exact and eq 16f or eq 18 produces d e f f ω 2 u ϕ x 0 d 0 d ϕ x b 1 ϕ exactly recall d e f f is the length weighted harmonic mean from eq b 1a when n 2 then m 2 d ϕ and s 2 d ϕ x b 1 are piece wise constant b 2 x is parabolic j 2 x d ϕ b 1 x and the diffusive flux d ϕ x b 2 x are piece wise linear eq 46b assures the flux jump condition midway the interface link with eq 40 and the solution of the system is exact λϕ ω 3 0 sk s 0 however according to eq 37 b 2 x is discontinuous at x x 0 except when λϕ obeys eq 42a when n 3 ω 1 ω 3 0 m 3 x ϕ ω 2 d ϕ b 1 x and s 3 x d ϕ x b 2 x are piece wise linear b 3 x is the third order polynomial j 3 x d ϕ b 2 x and the diffusive flux d ϕ x b 3 x are parabolic according to eq 37 b 3 x 0 b 3 x 0 is only valid provided that λϕ obeys eq 42a exact continuous solution b 3 x of the scheme is exemplified in fig 3 in fact when λϕ obeys eq 26a the dimensionless b field interface jump error is reduced with the second order accuracy 47a b 2 x x 0 h 2 b 2 x x 0 1 r h 1 r ϕ 1 4 a 4 r h r ϕ h 2 47b b 3 x x 0 h 3 b 3 x x 0 r h 1 r ϕ 2 1 4 a 8 r h r ϕ 1 r h r ϕ h 2 the two functions from eq 47 are displayed in fig 3 b 2 x and b 3 x are continuous at the midway position x x 0 only with a 1 4 in agreement with the interface analysis in eq 37 however according to the third order accurate taylor analysis in eq 39 the flux jump condition d ϕ x b 3 x x 0 d ϕ b 2 x x x 0 is exact only with the parameter dependent value a k u s u m r ϕ r h from eq b 3 a k u s u m r ϕ r h is illustrated in fig 3 we note that a k u s u m increases with the porosity contrast but remains confined to some suitable interval with realistic rϕ e g a k u s u m 0 29 0 35 when r ϕ 1 8 1 for any aspect ratio the coefficient ku s is estimated with eq 14d its reference solution is extended to the summation result ku s u m in eq b 2 ku s u m is the exact trt emm solution only if using a k u s u m from eq b 3 in combination with the third order accurate finite differences from eq a 6 for ω 4 d ϕ x b 3 ϕ in eqs 16f and 18 fig 4 shows that ku s is twice more accurate with eq 42a against eq 42b the relative error with eq 42a is rather small in very coarse resolution but its amplitude increases with the porosity contrast in resume the symbolic solutions exemplify the trt emm scheme and confirm the more generic interface taylor analysis the effective diffusivity and zero skewness are exact solutions of the scheme the flux jump condition and kurtosis are only exact up to summation with eq b 3 in turn the semi explicit jump tracking scheme from appendix b 2 matches the flux continuity and ku s u m with parameter independent solution from eq 42c all these zero velocity solutions allow for an efficient verification of the numerical implementation of eqs 16 17 at the first three orders n 1 2 3 5 2 darcy flow in series the constant darcy velocity u ϕ u 1 x u k d x p ν ρ 0 describes the flow in series with the length weighted harmonic mean permeability value kd and a piece wise linear continuous pressure distribution p x exact emm solution ginzburg and vikhansky 2018 shows that k t d e f f is asymptotically constant and all other transport coefficients decay with pe u x h d 0 48 pe ω 2 pe 1 ω 3 pe 2 ω n pe 1 n and γ n pe 1 n n 1 k t d e f f d d e f f 1 c o n s t sk pe 1 ku pe 1 this behavior is principally different from the stratified flow ginzburg 2017b where the dimensionless coefficients grow with pe cf eq 57 5 3 symbolic solutions with the trt emm the effective discrete equation 25 reads 49 u x b n k x j n k m n k x α m δ x 2 m n k ϕ k d 0 δ x 2 b n k x the discrete solution b n k x to eq 49 reads 50 b n k x p n k x p n 1 k x r k x r k 1 p e k 2 1 p e k 2 p e k u d 0 ϕ k the coefficients of the n order polynomials p n k x are determined by eq 49 by taking into account that x r x 1 2 r 2 1 r x 1 and δ x 2 r x r 1 2 r x 1 in equal porosity blocks all transport coefficients in eqs 14c 14e automatically reduce to zero with ω 2 d 0 and ω n 0 for n 3 in heterogeneous blocks m 1 k x u ϕ k ω 1 ω 1 u x u ϕ 1 s 1 k 0 eq 49 and b 1 k x read respectively 51a p e k x b 1 k p e k 1 ϕ k ϕ 1 δ x 2 b 1 k 51b b 1 k x x 1 ϕ k ϕ 1 b k a k r k x ϕ ϕ h the coefficients ak bk are determined with the three interface conditions 46 and eq 20 the effective continuity condition from eq 38 has the form of the asymmetric taylor expansion from the two interface sides this asymmetry of the leading order coefficient scales with p e k and vanishes only in the limit λϕ 0 the dispersion coefficient d ω 2 n u m is computed with eqs 16f and 18 52 d n u m d 0 d 0 ϕ k i ϕ k x b 1 k x i u ϕ k i b 1 k x i numerical result d num is reproduced exactly using eq a 6 for x b n k x i fig 5 displays the analytical solution kt rϕ pe and the symbolic prediction e kt from eq 43a versus space resolution per block h h 2 4 12 when pe 10 500 r ϕ 1 8 3 4 we observe that e kt increases with pe and the porosity contrast e kt is relatively large e g e kt 60 when r ϕ 1 8 with four nodes per block and the convergence is slower with the mesh refining when the porosity contrast is high since the modeled bulk equation is correct up to discretization the deficiency might be attributed to the leading order continuity condition in eq 38b and it should then reduce with a fig 6 confirms this prediction e kt reduces from 60 to 8 with a 1 4 10 1 and to 3 4 with a 1 4 10 2 here ϕk diminishes in one of the two blocks with porosity contrast and the leading order coefficient in continuity equation 38b degrades when the grid péclet number p e k increases interestingly the symbolic solutions reveal a very strong error variation between an even odd node number resolution per block e g the even node number is much more accurate when a 1 4 in fig 6 a similar situation is confirmed numerically the symbolic solutions also show that an additional scale parameter c e m c e from eq 27 may improve kt hence the discrete exponential symbolic solutions provide together with the summation and finite difference approximate trt emm numerical solution and allow to analyze it in the continuous parameter space however they become rather involved at the next orders and do not concern stability next section complements the trt emm symbolic analysis by numerical computations 5 4 the trt emm and trt ade in this section the trt emm and the three trt ade schemes 11 are examined on the base of their numerical solutions using the same parameter range the focus is put on the coarse resolution h 1 h 2 4 h 8 and high porosity contrast ϕ 1 1 12 1 ϕ 2 1 we set c e 1 30 λ 1 2 λ ϕ ϕ λ u 0 02 6 the reference emm solution is gathered in table 1 for kt sk s and ku s and illustrated in fig 8 bottom row whereas kt monotonously increases with the porosity contrast rϕ 0 sk s r ϕ and ku s r ϕ are not monotonous and their values are very small at the two limits r ϕ 10 1 and rϕ 1 this makes it very difficult to match them accurately the kt is asymptotically constant and its value slightly increases with pe the sk s and ku s decay with pe 5 4 1 numerical solutions by trt emm recall that trt emm is resumed in the algorithmic form in a 4 the trt emm sequentially solves eq 49 for n 1 2 3 in an unit periodic cell and computes the set ω 2 ω 3 ω 4 with eq 16f or eq 18 their dimensionless counterparts in eq 13 are obtained with l h and u 0 u x they are then employed for the three transport coefficients in eq 14 their relative corrections to the reference solution are gathered in table 2 using a 1 4 in eq 26a like in fig 6 a 1 4 results in very large errors at the high porosity contrast on the coarse grid and the amplitude of the relative corrections grow with the order n from e kt to e ku s table 3 shows that the three moments improve with λ ϕ 1 6 1 12 when r ϕ 1 4 high contrast this is especially true with e kt which diminishes with λ ϕ 1 12 up to the three orders of magnitude in agreement with fig 6 and the prediction from the interface taylor analysis in eq 38b the symbolic solutions allow for the search of the root a r ϕ r h h pe which solves e k t 0 as might be expected its value approaches to zero or becomes negative as one example λ ϕ 2 62 10 3 assures e k t 0 when r h 1 r ϕ 2 5 h 8 pe 18 29 in exact agreement with the numerical computations using this value e kt in table 3 reduces by two three orders of magnitude when r ϕ 1 4 1 2 furthermore this very small value λϕ improves drastically the kurtosis accuracy to conclude the trt emm three moments solution is very strongly impacted by the free tunable parameter a from eq 26a in the perpendicular darcy flow in series this situation is similar to a very sharp λϕ dependency in bounce back permeability measurements in dense solid arrays khirevich et al 2014 the optimal a value may differ in the three moments but their accuracy improves with the space resolution where their dependency upon λϕ diminishes 5 4 2 numerical solutions by trt ade we apply now the three trt ade d2q5 schemes 11 for the spatial dispersion in a series of porous blocks with the line release c x t 0 δ x x 0 the system is set periodic in the y direction the ade 1d from eq 11c and ade r from eq 12 produce the same solutions because the problem is one dimensional while trt emm was operated in one unit cell the direct solvers need a long array of the identical cells typically about 10 2 2 10 2 cells we measure the central spatial moments and derive ω 1 ω 4 from them see vikhansky and ginzburg 2014 53 ω 1 μ 1 t δ t μ 1 t δ t ω 2 μ 2 t δ t μ 2 t 2 δ t ω 3 μ 3 t δ t μ 3 t 6 δ t ω 4 μ 4 t δ t μ 4 t 24 δ t μ 4 t μ 4 t 12 μ 2 2 t 2 the obtained solution 53 is non dimensionalized with eq 13 and then employed in eq 14 unlike the trt emm the direct solvers do not reproduce exactly the gaussian result sk s ku s 0 when r ϕ 1 unless for very specific λϕ values which vanish the truncation corrections in particular they have been identified ginzburg 2017b with ade j in the uniform porosity constant velocity profile e sk s is predicted to vanish with λ ϕ 1 12 while the optimal kurtosis choice is λ ϕ 1 6 the present computations confirm these solutions with the three schemes 11 in identical blocks r ϕ 1 where these two particular choices reduce sk s and ku s by one order of the magnitude against λ ϕ 1 4 in two heterogeneous blocks the simulations are run using the trt emm numerical parameters given in the beginning of section 5 3 the highest porosity contrast r ϕ 1 25 complements these computations since these computations are conducted close to the stability line from eq 10e the ade c loses stability with λ ϕ 1 12 because of its negative numerical diffusion in agreement with the predictions ginzburg et al 2010 kuzmin et al 2011a mean velocity u x we observe that ade c and ade 1d both reproduce u x u h ϕ exactly but this is not the case of ade j its relative error e u u n u m u x 1 is displayed in table 4 we find that asymptotically e u 2 λ u h r ϕ r ϕ 1 2 in equal length blocks and it vanishes in homogeneous soil r ϕ 1 in agreement with the previous results e g ginzburg 2017a these and other results show that i e u scales in proportion to λ u ii e u is independent of ce and iii e u is independent of λϕ table 4 confirms that e u decays linearly with h and that the linear convergence is reached faster with the smoother porosity contrast hence e u pe c e λ 2 recall λ ϕ ϕ λ it reduces linearly when pe increases with 1 λ but remains the same when pe increases with 1 ce further inspection reveals that an observed alteration of the mean seepage velocity is caused by the discontinuity of the equilibrium term e q u in eq 11b indeed the effective continuity condition 28a predicts that the concentration will undergo an interface jump in the case of discontinuous weights when e q c x 0 0 concentration profiles in fig 7 confirm the presence of asymmetric interface jumps with ade j while ade c and ade 1d both produce very similar smooth profiles in highly heterogeneous blocks the dispersion coefficient kt the numerical solution kt rϕ and the relative error e kt from eq 43a are displayed in fig 8 for three schemes 11 their results are compared in table 5 we observe that k t d e f f and e kt increase together when the porosity contrast grows to r ϕ 1 25 nevertheless all schemes match kt within 10 15 in a small cell h 1 h 2 h 2 4 despite the mean velocity error the ade j is the most accurate among the three schemes using the stable choice λ ϕ 1 4 the accuracy of the direct solvers with λ ϕ 1 4 is similar to trt emm results obtained with very small value a see tables 2 and 3 and much better than those which trt emm produces with a 1 4 λ ϕ c e 1 30 0 259 the ade c and ade 1d have very similar results in highly heterogeneous blocks however while e kt converges to zero when rϕ 1 with ade j ade 1d e kt diverges with ade c because of the numerical diffusion d u x since the averaged coefficient d u sums with the numerical dispersion then 54 e k t ade c e k t ade j e u k t e u k t d u d e f f k t d u λ u 2 h ϕ λ ϕ ϕ λ this estimate fits well e kt ade c in fig 8 hence ade c is unsuitable for measurements of small valued kt but the three schemes produce similar dispersion values at high porosity contrast where the taylor and numerical dispersion dominate numerical diffusion skewness sk s and kurtosis ku s the ade j results for skewness and kurtosis are displayed in fig 8 with different λϕ values the ratio of ade j relative errors to ade c and ade 1d is compiled in table 5 for λ ϕ 1 4 in that case the ade c is the most accurate for the two high moments at the high porosity contrast where it is followed by the ade 1d but the ade j gains at relatively small contrast on the whole the distinctions between the three schemes are very small for skewness and their results are comparable with the trt emm in table 2 although the difference between three schemes increases up to a factor of two for kurtosis they remain much more accurate than trt emm let us compare now the results in series with the truncation prediction ginzburg 2017b in homogeneous soil like in that case λ ϕ 1 12 reduces e sk s by the one order of magnitude in small porosity contrast but only twice in highly heterogeneous blocks where e sk s is dominated by the implicit interface rather than bulk truncation in turn the computations with very small value λ ϕ 3 10 2 uniquely placed in the interface nodes show a drastic improvement of e sk s the ade j and ade 1d show very similar results reducing λϕ but ade c becomes unstable in this limit fig 8 displays e ku s with λ ϕ 1 12 1 6 1 4 λ ϕ 1 6 remains most accurate in highly heterogeneous blocks the three schemes show here similar results 5 5 summary construction of the exact steady state symbolic solutions is extended from the streamline invariant channel configurations ginzburg 2007 ginzburg et al 2015b to the streamwise heterogeneity in the presence of a space variable mass source and an interface flux jump the symbolic trt emm solutions validate the interface taylor analysis developed in a more general framework the numerical results confirm that the steady state solutions can be parameterized by the dimensionless group rϕ rh pe provided that the two free parameters λϕ and ce are inter related through eq 26a the transport coefficients then all become dependent on one free parameter a except the effective diffusivity d e f f and sk s 0 which are exact solutions of the trt emm pure diffusion scheme at the two first orders n 1 and n 2 respectively at order n 3 ku s 0 is exact in the homogeneous porosity otherwise the two distinguished solutions a produce the reference value ku s u m from eq b 2 with the implicit and the semi explicit interface jump trackings they are useful for implementation check it is confirmed numerically that the ω form and γ form produce identical moment solutions in the darcy flow in series using transform 15 provided that a takes the same value in both formulations in the darcy flow the inexactness of the closure relations penalizes the strong porosity contrast and the discrepancy typically increases with the order n from kt to ku s we find that only very small values a improve the transport coefficients on the coarse grid since this choice may cause instability we should conclude that the trt emm needs relatively fine grids in series at the same time the three direct trt ade schemes 11 are examined in heterogeneous series of porous blocks we note that ade j is exact for u x and d 0 but not for sk s and ku s in uniform porosity darcy flow with heterogeneous blocks in series ade j produces interface jumps in the concentration solution and they intrinsically modify the mean seepage velocity this effect is caused by the heterogeneity of the correction e q u in eq 11b indeed it plays the role of the discontinuous symmetric weights the relative ade j velocity error reduces linearly with the space resolution and diffusion eigenfunction λ but grows linearly with the velocity amplitude ade c and ade 1d reproduce the mean seepage velocity exactly nevertheless ade j remains here most accurate for the dispersion coefficient the ade c omits the discontinuous correction e q u consequently it produces much more continuous profiles but becomes relatively inaccurate when kt is small small porosity contrast and the numerical diffusion from eq 54 dominates the taylor and numerical dispersion the ade 1d from eq 11c manifests itself as a good compromise in the examined parameter range the three schemes are expected to have similar accuracy at high pe but differ for stability in the present computations the ade j is the most stable among the three schemes when λϕ takes small values and also improves the skewness coefficient to conclude the direct solvers behave more accurately with the stable choice λ ϕ 1 4 than the trt emm with a 1 4 λϕ 0 259 however they are restricted to the coarse resolution where their solutions especially skewness and kurtosis strongly depend on λϕ in compliance with the predicted ginzburg 2017b moments truncation impact in constant and parabolic profiles although the trt emm needs a finer resolution for the strong heterogeneity in series it is much more capable than the direct solvers for high pe and weak λϕ dependency with the help of the grid refining 6 stratified flow it has been demonstrated ginzburg and vikhansky 2018 that in the case of a constant darcy flow the non gaussian effects are much stronger in the heterogeneous stratified channels than in porous blocks in series the two systems are sketched in fig 2 in this section the stratified system is rotated and the velocity field is parallel with the x axis in compliance with eq 16 the emm and trt emm symbolic solutions will be compared in i poiseuille flow ii bounded system of open and diffusive layers and iii stratified double periodic brinkman flow respectively sketched in figs 9 10 and 14 in a stratified channel or duct flow u ϕ u ϕ x y z 1 x the b field solution bn y z is streamwise invariant u ϕ b n 0 and eqs 16b 16e read with j n 0 s n 0 thereby eq 16a reduces to the diffusion equation 55 m n y z d ϕ y 2 z 2 b n y z n 1 interface conditions 17b prescribe the continuity for bn y z and for the normal flux on the flat surface aϕ y z separating any two porous layers b n a ϕ y z 0 and d ϕ n b n a ϕ y z 0 eq 17c prescribes zero diffusion flux on the solid surface eq 18 becomes 56 ω 1 u x ω 2 d 0 u ϕ x b 1 ϕ ω n u ϕ x b n 1 ϕ n 3 the sets ω n γ n from eq 13 and the transport coefficients from eq 14 obey see ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 57 k t p e 2 pe ω n pe n 1 γ n pe n 1 pe sk s pe ku s pe sk t pe ku t pe the trt emm operates in the stratified geometry with j n 0 in eq 19 and s n 0 in eq 16e the system is closed with the continuity condition 28a and either a symmetric periodic or bounce back no flux condition 29b on the horizontal ends the effective interface continuity condition b n x x 0 0 is elaborated in eqs 34 36 it is exact with the midway interface position when bn y is linear λϕ and when bn y is parabolic with a 1 8 eq 42b the b field b 1 y is parabolic in a stratified darcy flow because the mass source m 1 y is a piece wise constant a recursive construction of the symbolic solution of the trt emm follows the emm exact procedure ginzburg and vikhansky 2018 but the averaging integration in eqs 16 and 20 becomes performed via summation of the grid values with ω 1 u ϕ x y ϕ y u s u m 6 1 straight poiseuille flow in poiseuille flow u ϕ x y 3 2 u x 1 4 y 2 h 2 ϕ y 1 the emm and trt emm solutions bn y to eq 25 are order 4n polynomials the reference emm solutions for ω n γ n and the transport coefficients from eq 14 are provided ginzburg and vikhansky 2018 see tables 2 and 3 the coefficients of bn y are set by eq 25 except the first and zeroth orders the coefficient of the linear term is set by the bounce back closure but its value does not affect the solution for ωn in eq 56 because u ϕ x y y 0 hence the transport coefficients are not affected by an exact location of the no flux boundary inside one mesh spacing when n 1 m 1 y u s u m u x y δ y 2 m 1 y 2 u ϕ x y b 1 y solves m 1 α m y 2 u ϕ x d 0 δ y 2 b 1 y and eq 56 produces the dispersion value d n u m ω 2 n u m the dispersion coefficient kt from eq 14c obtains solution 58a k t n u m pe 2 210 20 21 h 2 pe 2 210 h 6 α m 4 5 h 2 h 4 pe 2 5 h 6 pe u x h d 0 58b k t n u m pe 2 210 20 21 h 2 pe 2 210 h 6 if λ ϕ 1 4 1 c e α m 0 the second order correction α m pe 2 5 h 2 to the taylor value k t pe 2 210 has place because of the parabolic distribution m 1 y when a 1 4 and αm vanishes with eqs 26a and 42a the remaining correction in eq 58b decays with fourth order rate in fact eq 58b is the discrete counterpart of the taylor solution when the taylor ansatz taylor 1953 is solved with the discrete laplacian and integration is performed via summation see ginzburg and roux 2015 ginzburg and vikhansky 2018 using a 1 4 this property remains valid for all higher orders the difference with the exact solution is only due to the discrete laplacian and the summation effect using eq 42a fig 9 displays the corresponding relative errors versus channel resolution when pe 1 103 for e d e sk s and e ku s from eq 43 it is shown that e d is very small and it becomes pe independent as pe 102 at the same time e sk s and e ku s increase progressively with the order n but they decrease very rapidly with the grid refining and agree within 5 with the emm when h 10 the relative corrections are almost pe independent because kt sk s and ku s obey the pe scale from eq 57 on the numerical solution the effective transport coefficients of the ade j scheme 11 in a straight radial poiseuille flow have been derived ginzburg 2017b ginzburg and roux 2015 using a coordinate stencil in a straight channel the first moment produces mean velocity u s u m exactly the second moment reproduces eq 58b only provided that the numerical dispersion vanishes thanks to λ ϕ 1 4 1 c e λ 2 see eqs 72 76 in ginzburg and roux 2015 with this choice λ ϕ 1 4 when ce 0 pe and the trt emm with eq 42a shares the same property an advanced stability ginzburg et al 2010 of λ ϕ 1 4 was confirmed ginzburg and roux 2015 in poiseuille profile at high pe we have also compared the highly accurate truncation estimate ginzburg 2017b for sk s and ku s against the trt emm solutions with a 1 4 in the limit ce 0 the ade j with λ ϕ 1 4 shows very slightly more accurate results than the trt emm to conclude and to be contrasted with the darcy flow in series it is underlined that in poiseuille flow the direct solvers and trt emm produce very similar results around stable choice λ ϕ 1 4 6 2 a bounded stratified open diffusive system we consider a system of two parallel layers of the thickness h 1 and h 2 bounded at y 0 and y h h 1 h 2 the system is sketched in fig 10 the bottom layer has porosity ϕ and zero velocity u ϕ 0 the top layer mimics a fracture ϕ 1 and velocity profile u ϕ x y is parabolic there the transport coefficients in eq 14 are set by pe ϕ and an aspect ratio r h h 1 h 2 they obey pe scaling from eq 57 and reduce to the poiseuille solution when either r h 0 or ϕ 0 the set γ n from eq 13 is constructed vikhansky and ginzburg 2014 eqs 124 132 and extended for a radial capillary the reference solution ginzburg and vikhansky 2018 for ω 2 ω 4 is employed here ginzburg and vikhansky 2018 eqs c 10 c 12 with r b r h 1 the described here open diffusive two layered bounded system is similar but not identical with a fracture embedded into diffusive matrix also extended ginzburg and vikhansky 2018 to the porous brinkman flow in a fractured layer since the solute may diffuse into the impermeable layer the fracture diffusive matrix manifests strong deviations from the gaussian prediction fig 10 illustrates the porosity and aspect ratio effects in pe independent solutions kt pe 2 and the two asymptotes sk s pe 1 2 and ku s pe 1 it is shown that at fixed pe kt monotonously increases with rh and ϕ in contrast when the diffusive layer is not too much thick sk s and ku s manifest very sharp peaks where their amplitudes grow when ϕ diminishes unlike in poiseuille profile where sk s 0 the profiles are shifted right sk s may change its sign in the presence of the diffusive matrix the direct computations vikhansky and ginzburg 2014 with the ade j scheme 11b of the spatial release and rtd in temporal process demonstrate very sharp distribution profiles and agree with the emm prediction e g within 5 for all three moments at small porosity ϕ 10 1 and pe 14 in a channel of h 12 the trt emm solves eq 25 for n 1 b n k y is the 2n polynomial in a porous layer k 1 and 4 n polynomial in an open layer k 2 the symbolic system is closed by eq 28a at the interface and by the bounce back closure relation 28b in two boundary nodes y 1 2 and y h 1 2 a constant is fixed with eq 20 the closure relations are all prescribed with the use of eqs 19 22 and 24a similar as in eqs 32 35 the transverse central differences are all computed on the one layer solution eq 36d tells us that when λϕ obeys eq 42a then the continuity condition b n y y 0 0 is not located midway at y 0 h 1 as a result the dispersion coefficient kt obtains second order parameter dependent correction which vanishes for poiseuille flow in eq 58b the constructed symbolic solutions for the three transport coefficients agree exactly with the trt emm numerical solution and they are employed to explore the accuracy of the scheme within a continuous parameter space the symbolic solutions are formally defined for any rh and h 2 the numerical system has an integer number of cells per layer e g r h 1 implies numerically that h is even figs 11 13 display e d e sk s and e ku s at pe 10 2 towards h in fig 11 the two layers have the same thickness r h 1 but ϕ varies ϕ 10 2 1 2 in figs 12 and 13 ϕ 10 1 but the porous layer is thinner rh 1 and thicker rh 1 respectively than the open one fig 11 shows that kt is more accurate with the smaller ϕ however sk and ku become less accurate when ϕ diminishes the results displayed in fig 12 show that e d improves when rh reduces to zero and the system approaches the poiseuille flow e sk s and e ku s are not monotonous with rh r h 0 and r h 1 are more accurate than rh 0 1 fig 13 shows that when an open layer is not resolved sufficiently e g r h 4 h 2 1 when h 5 or h 2 2 when h 10 kt becomes very inaccurate at the same time sk s and ku s are much less affected by rh in resume because of an inexact interface continuity condition the trt emm is less accurate than in open flow but the errors decay rather rapidly with the space resolution when ϕ 10 1 the three transport coefficients agree with the reference result within 5 with 5 mesh spacings per layer using a 1 4 this is comparable with the measurements of the kurtosis in pure diffusion in series with porosity contrast r ϕ 10 1 and it is much more accurate than in a perpendicular darcy flow cf table 2 6 3 porous brinkman flow we construct the reference emm solutions in stratified brinkman flow in section 6 3 1 and compare them with the symbolic trt emm solutions using the exact and discrete velocity profiles in section 6 3 2 6 3 1 the emm is stratified porous flow consider a stratified system of two porous layers of porosity ϕi permeability ki and width hi i 1 2 separated by a flat interface at y y 0 h 2 h 1 h h 1 h 2 the velocity profile u ϕ u ϕ x y 1 x solves brinkman equation brinkman 1947 in the form ginzburg et al 2015b 59 ν ρ 0 k i u ϕ i x p ν ρ 0 f i ϕ y 2 u ϕ i fi ϕ 0 1 determines brinkman viscosity ν f i ϕ lim ϕ i 1 f i ϕ 1 and typically f i ϕ 1 or f i ϕ ϕ i velocity profile reads in the ith layer 60 u ϕ i y x p ν ρ 0 k i a i e ξ i y c i e ξ i y ξ i f i ϕ k i the velocity and shear stress are set continuous on the interface u ϕ x y y 0 0 and ν f i ϕ y u ϕ i y y 0 0 respectively we consider a double periodic system along the x and y axes which is sketched in fig 14 together with the profile u ϕ i y a bounded system can be addressed similarly with the limiting case of the open diffusive matrix from section 6 2 when permeability tends to zero in one layer and becomes infinite in the other in the double periodic system the four constants in eq 60 are derived from two interface conditions and two symmetry relations in the middle of each layer prescribing fi ϕ the velocity profile can be formulated in terms of the dimensionless darcy number d a k d h 2 with k d k 1 h 1 k 2 h 2 h the permeability contrast and the aspect ratio when the permeability has the same value in the two layers k i k d the double periodic system reduces to a constant parallel darcy flow u ϕ i y x p ν ρ 0 k d the brinkman profile 60 falls to the darcy regime at small da and to the stokes regime at very high da the interface effects become important at the intermediate brinkman regime e g see silva and ginzburg 2016 the emm exact solution for the transport coefficients in eq 14 has been constructed and analyzed in a parallel darcy flow ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 through stratified porosity and in a single bounded porous channel ginzburg and vikhansky 2018 the darcy system presents an interesting example where the complex dispersion behavior is solely due to the porosity contrast this system manifests much stronger non gaussian effects than the perpendicular darcy flow in series at the same porosity contrast and pe in a single porous channel the transport coefficients are set by two dimensionless parameters f ϕ da and pe the relative dispersivity k t pe 2 is predicted to decrease from the stokes to the darcy regime and to increase when f ϕ decreases with ϕ at fixed da exact solution for the transport coefficients in a fracture embedded into porous brinkman flow has been constructed and confirmed numerically ginzburg and vikhansky 2018 this system can be regarded as the limit system of the double periodic brinkman flow system all these stratified systems obey the pe scaling from eq 57 in brinkman flow b n i y solves eq 55 where the source term m n y is computed with eq 16b on the profile 60 solution b n i y reads in terms of the 2k order polynomials p i 2 k y and x i 2 k y as follows see also dimensionless form ginzburg and vikhansky 2018 61 b n i y k 0 n p i 2 k y e n k ξ i y k 0 n x i 2 k y e k n ξ i y n 1 when k 1 k 2 b n i y reduces to the 2n order polynomial in the darcy flow the coefficients in eq 61 except the zeroth and first order terms are set by eq 55 the three remaining coefficients are fixed through the interface continuity condition b n i y y 0 0 and the two symmetry conditions the remaining constant is fixed by eq 20 the final expressions are lengthy but they allow to explore the transport coefficients in the full continuous parameter space once the set ωn is constructed the set γn is derived from it with eqs 13 and 15 the two sets determine the transport coefficients in eq 14 they obey the pe scale in eq 57 let us exemplify the role of the brinkman viscosity in the two systems f i ϕ 1 and f i ϕ ϕ i fig 15 displays the relative effective permeability kb kd k b u ϕ x ν ρ 0 x p and the three transport coefficients versus d a 1 2 h k d in two equal thickness layers with r ϕ ϕ 1 ϕ 2 10 1 and r k k 1 k 2 10 3 it is shown that kb reduces with fi ϕ in the transition brinkman zone d a 1 2 10 50 the dispersion coefficient kt decays towards the darcy regime and it only weakly depends upon brinkman viscosity the difference between f i ϕ 1 and f i ϕ ϕ i monotonously increases in sk s and ku s towards the darcy regime together with their absolute values in the stokes zone sk s pe 1 2 and ku s pe 1 almost coincide for pe 10 2 and pe 10 3 meaning that the asymptotic regime 57 has been reached like in an open flow however the asymptotes need much higher pe in the darcy zone in resume like in the single porous channel ginzburg and vikhansky 2018 k t pe 2 decreases from the stokes to the brinkman darcy regime but the non gaussian effects are predicted to grow towards the darcy zone fig 14 illustrates the reconstructed mean concentration and the rtd profiles in spatial and temporal systems the two profiles are displayed together one in darcy s range d a 1 2 56 5 and another one in highly permeable zone d a 1 2 1 20 56 5 porosity and permeability contrasts correspond to fig 15 the reconstruction of the profiles is based on the entropy maximization bandyopadhyay et al 2004 respectively constrained to the predicted spatial or temporal system of the first four moments following vikhansky and ginzburg 2014 ginzburg and vikhansky 2018 the normalized dispersion independent distributions are displayed in a moving frame i σ c x t versus x x x 0 u x t σ σ μ 2 t 2 d t and ii the rtdσp x τ versus τ t t σ t x u x σ μ 2 x 2 d u x 3 x as has been expected from the predicted moments the profiles are more asymmetric and sharp in the darcy zone mean concentration profiles are skewed right since sk s 0 the rtd are typically skewed left sk s 0 because of the heaviside entry these profiles can be compared to their counterparts in poiseuille flow and in the limit case of a fracture embedded into diffusive matrix see results for pe 740 in figs 10 22 and 23 in ginzburg and vikhansky 2018 the profiles are clearly more asymmetric in the stratified brinkman system than in an open flow in the limit system their form depends on the porosity in the diffusive layer the constructed emm moments are employed now to verify the trt emm 6 3 2 the trt emm in stratified porous flow we construct symbolic trt emm solutions in brinkman velocity profile extending the known classes of the exact solutions the polynomials cui et al 2016 ginzburg 2007 2017a and the discrete exponents ginzburg et al 2015b the symbolic solutions allow to examine the response of the transport coefficients on the numerical formulation but also on the quality of the velocity field e g when brinkman flow is computed with the discrete numerical scheme let us assume that the velocity profile u ϕ i y solves the discretized brinkman equation ginzburg et al 2015b in the layer i 62 ν ρ 0 k i u ϕ i x p ν 1 δ i f i ϕ ρ 0 δ y 2 u ϕ i and reads 63 u ϕ i y x p ν ρ 0 k i a i r i y c i r i y r i 1 b i 1 b i b i ξ i 2 ξ i 2 4 1 δ i ξ i f i ϕ k i as seen the brinkman viscosity ν f i ϕ gets the relative correction δi with the different numerical approaches like the finite elements finite differences or lbm schemes because the truncation term δ x 2 ν ρ 0 k i u ϕ i y due to the laplacian of the resistance sums with the viscous term see ginzburg et al 2015b and ginzburg 2016 this correction is similar with the αm term in eq 25 the coefficients ai ci in eq 63 are set by the effective interface conditions of a given scheme in principle the symbolic solutions allow to examine an impact of the correction δi or the implicit interface flow conditions on the transport coefficients in this work we only verify for the discrete effect between an analytical velocity profile 60 and a model finite difference profile referred to as ideal ifd it solves eq 62 with δ i 0 and second order accurate taylor expansion in interface boundary conditions see ginzburg et al 2015b and silva et al 2017 note that eq 63 coincides with eq 60 in grid nodes provided that r i e ξ i this condition can be formally fulfilled prescribing eq 63 with a model value f i n u m 64 f i n u m 2 1 δ i k i cosh ξ i 1 thereby once the trt emm symbolic solution is built for the discrete profile 63 it describes the numerical solutions computed with the exact profile using eq 64 and exact coefficients ai ci from eq 60 solution bn y to eq 25 is searched in the form 65 b n i y k 0 n p i 2 k y r i n k y k 0 n x i 2 k y r i k n y similarly as in emm solution 61 the coefficients are determined by eq 25 except the zero and the first order term the three remaining coefficients are fixed through the continuity condition eq 28a with eqs 22 24a similar as in eqs 32 35 and the symmetry conditions in the middle of each layer the remaining constant is set with eq 20 the constructed solutions for ω 2 ω 4 and γ 2 γ 4 coincide with the trt emm numerical solutions for the different type numerical profiles 63 and analytical profile 60 as one example the four experiments in two equal thickness layers combine d a 10 2 10 4 and pe 10 10 2 the reference emm values are gathered in table 6 fig 16 displays the relative differences trt emm to emm together for eqs 60 and 63 in brinkman zone d a 10 2 and darcy zone d a 10 4 the first diagram shows that the relative velocity error u s u m to u x is most significant on the numerical profile in the brinkman zone and it reduces to about 5 only when we have h 2 10 nodes per layer the numerical profile then produces the most large corrections in the three transport coefficients this example suggests that an accurate description of the velocity gradients is essential for the accuracy in the first four moments these symbolic experiments were also run with pe 10 cases c and d from table 6 in these and other experiments the trt emm with pe 10 is more accurate for the dispersion coefficient against pe 10 2 but the situation is reversed for e sk s and e ku s on the coarse grid e g e sk s is larger by a factor of three and e ku s is twice larger with pe 10 against pe 10 2 the described behavior is similar to the truncation estimate ginzburg 2017b of the moments in ade j scheme 11b because when sk s and ku s are very small with small pe the numerical corrections may become relatively large fig 17 compares trt emm with λϕ from eqs 42a and 42b on the analytical velocity profile 60 with the parameter setting from table 6 on the one hand α m 0 in eq 25 using eq 42a the transport coefficients corrections are then solely due to the implicit interface tracking and the summation effect on the other hand kt is exact in the darcy flow using eq 42b see eq 36b fig 17 shows that effectively eq 42b is more accurate for the three coefficients on the coarse grid in the darcy regime d a 10 4 bottom row this is especially true with kt in the intermediate zone d a 10 2 top row the situation is reversed for all the three coefficients and eq 42a is one order more accurate on the coarse grid especially for sk s and ku s the results for pe 10 are similar in the two cases c and d from table 6 to conclude second order accurate brinkman numerical velocity profile causes additional corrections in the three transport coefficients of the same order magnitude as the trt emm with eq 42a has in the exact profile cf bottom row in figs 16 and 17 using the analytical velocity profile in the brinkman regime the trt emm retains its solution within 10 when having h 2 5 mesh spacings per layer such a precision is quite comparable with the limit case of an open layer adjacent to the diffusive matrix from section 6 2 and it is much better than what we have observed for the darcy flow in series the darcy regime may require to reduce λϕ towards eq 42b because when the velocity profile is relatively flat the interface effects dominate the truncation due to the velocity variation in the mass source we note that the non uniform and flow regime dependent λϕ distribution has been also suggested in trt brinkman flow modeling ginzburg et al 2015b 6 4 summary the trt emm numerical formulation 19 was examined on the base of its symbolic solutions in several stratified systems open fracture diffusive matrix and heterogeneous porous flow for the sake of their validation the emm exact solutions ginzburg and vikhansky 2018 were extended to the stratified brinkman flow the trt emm behaves similarly to the direct solvers and much more accurately in a parallel flow than in a perpendicular flow the trt emm transport coefficients are identical with the ω form and γ form using eq 15 in stratified channels provided that the free collision product λϕ and the truncation coefficient αm in eq 25 take the same values in the two formulations their solutions are entirely parameterized by pe when λϕ and ce are inter related through eq 26a the transport coefficients then obey the pe scale from eq 57 exactly for any individual value of the characteristic velocity ce λ and λϕ but they depend upon the free tunable parameter a from eq 26a in the stokes brinkman regime a 1 4 is efficient because it vanishes the principal truncation correction due to the mass source variation with velocity however in the darcy zone a 1 8 is preferable for its advanced interface accuracy in kt measurements it was shown that the bad quality of the velocity field may predominate over the truncation accuracy in the presence of the high velocity gradients and impair the prediction of moments as a reminder the direct solver 11b produces the first moment with the effective velocity u s u m in a straight bounded channel only if using the coordinate discrete velocity stencil otherwise the effective mean velocity becomes modified in proportion to the diagonal velocity weight tq in eq 10b see ginzburg 2017a in addition to the reported results we observe that the direct ade schemes extend this deficiency to stratified heterogeneous interfaces this property is to be contrasted with the trt emm although its symbolic solutions were built with the d2q5 discrete velocities the trt emm stratified flow solutions are identical for d2q5 and d2q9 because of the streamwise invariance of the steady state solutions bn y in straight channels thereby the weight independence of the transport coefficients in the basic configurations is another advantage of the steady state trt emm approach against the direct simulation of moments 7 heterogeneous porous flow we examine the trt emm and three direct ade schemes for temporal and spatial dispersions in brinkman flow around solid and porous obstacles section 7 1 describes geometry and flow sections 7 2 and 7 3 address the numerical aspects of trt emm and lbm ade respectively section 7 4 examines the physical insight on the obtained transport coefficients 7 1 geometry and flow we consider two dimensional steady state flow through a periodic porous system consisting of two equivalent rectangular obstacles depicted in fig 18 the two obstacles are either solid ϕ 0 or porous ϕ 1 8 1 4 1 2 3 4 19 20 the basic cell has the size x h 56 40 l u it is periodic along the x axis and bounded by two horizontal solid walls the two obstacles x y 8 32 are distanced by 8 mesh spacings their centers are located at x y 20 16 and x y 36 24 the linear brinkman velocity field u ϕ x y is governed by a constant body force f f x 1 x 66 ν ρ 0 k u ϕ p f ν ρ 0 f ϕ δ 2 u ϕ the velocity field is solved with the d2q9 ibf lbm interface implicit scheme ginzburg et al 2015b using the bounce back no slip rule on the solid surface the resistance is prescribed with the permeability value kf in a surrounding flow and km inside a porous obstacle the ratio k f k m 10 8 is the same in the two flow experiments hereafter referred to as exp i and exp ii with k f k m 4 10 7 10 1 l u d a 1 2 63 25 10 4 1 in exp i and k f k m 4 10 5 10 3 l u d a 1 2 63 25 10 3 10 in exp ii the two darcy numbers kf h l 2 km h l 2 are kept fixed in l times refined cell without obstacles the channel flow approaches the stokes poiseuille limit the streamlines in fig 18 allow to observe the flow effect due to the low permeable obstacles in exp ii table 7 compiles the ratio of the effective mean permeability k to its open flow value kp the case of the solid obstacle is very similar in the two experiments with k 7 57 10 3 k p otherwise the mean permeability contrast between the two experiments is about 2 53 the porosity ϕ impacts the velocity field only through the brinkman viscosity value ν b ν f ϕ the effective permeability depends very weakly on ϕ and the transport coefficients are practically the same for the flow computed with ν b ν ϕ and ν b ν 7 2 the trt emm numerical set up the trt emm applies algorithm from appendix a 4 and it solves eqs 16 17 using the trt collision 8 with the equilibrium 19 the mass source m n r and the flux jump j n r in eqs 16b 16e are computed in ω form with eq a 1 and in γ form with eqs a 2 a 5 we aim to verify the equivalence of the two formulations in this two dimensional field the velocity field is precomputed in the unit cell due to the linearity of the flow its arithmetical mean value u s u m u ϕ x ϕ is rescaled to the same value in all configurations prescribing ϕ r the velocity field and pe u s u m h d 0 the computations of eqs 16 17 are performed three times sequentially for n 1 2 3 their steady state solution b n r is then normalized with eq 20 and b n r is used to precompute m n r and j n r for the next orders namely n 2 3 4 one does not need to solve the system at n 4 because ωn is determined with eq 16f or eq 18 and γn is determined with eq a 4 from the previous level solution no flux condition is enforced with the bounce back rule the total mass in the system is conserved at each time step because of the solvability condition m n 0 while the exact global mass conservation provides a very valuable numerical test we find it more difficult to validate exactly with the γ form because of the round off summation effect due to very large increase of the values γn with n as one example the two sets ω n n u m and γ n n u m are illustrated in fig 19 in a given configuration the dimensionless coefficients in eq 13 ω n ω n u x h n 1 and γ n γ n u x n h n 1 should remain fixed by pe it has been confirmed that ω n n u m and γ n n u m follow this dimensionless scaling when u x and h vary further we confirm that the set ω n γ n n u m obtained with eq 15 practically coincides with the numerical solution ω n n u m obtained with the ω form the relative difference between the two sets is exemplified in the last diagram in fig 19 we note that eq 15 provides another very useful implementation check therefore the two numerical formulations ω form and γ form produce the same solution for the dispersion coefficient kt and any one of them can be run for the prediction of the four transport coefficients in eq 14 hereafter we will display the relative differences of the transport coefficients to their open flow counterparts at the same pe they are labeled as δd for d 1 k t d 0 δ sk s δ ku s for sk s ku s and δ sk t δ ku t for sk t ku t respectively the reference open poiseuille flow solutions is given in table 3 ginzburg and vikhansky 2018 the simulations are run at pe 7 4 74 740 in the basic cell and pe 7 4 10 102 103 in five times finer cell stability bound from eq 10e is adopted as an approximate although in several points this condition was not satisfied when pe 74 e g in basic cell flow around the solids and in exp ii using u x r e f u s u m 0 0355 c e 1 30 stable results have been most of the time achieved using λϕ from eq 42a λ ϕ r e f λ ϕ c e 1 30 0 259 as it might be expected eq 10e is not a necessary stability condition in a space variable velocity field in the rigorous sense but it provides a very reasonable estimate e g the smallest porosity value ϕ 1 8 becomes most unstable when λ ϕ reduces for higher pe the d2q5 scheme operates with four free parameters ce λ λϕ and βe recall that when ce and λϕ are linked through eq 26a the solution becomes independent of the two separated values ce and λ provided that their product d 0 c e λ is fixed either in a perpendicular or a parallel one dimensional flow this property remains valid in one dimensional flow when the obstacles have the same porosity and permeability as the surrounding flow for example if we employ the two sets c e λ λ ϕ 1 30 1 3 λ ϕ r e f and 1 3 1 3 10 3 8 with the same value d 0 c e λ the difference δ d δ sk s δ ku s with the open flow will be identical in the two cases and very small because the flow approaches the open regime as 0 07 2 21 10 7 0 13 in the basic cell at pe 74 exp ii however this exact parameterization property of eq 26a is not valid in a two dimensional flow e g in the presence of the solids the relative difference between the two sets is 8 7 0 58 0 15 in the basic cell but only 0 29 0 01 0 01 for a five times finer cell similarly in the absence of solids when ϕ 3 4 the relative difference between the two parameter sets is 1 48 4 15 0 46 in the basic cell and it reduces to 0 07 0 05 0 02 in the refined cell this loss of the exact parameterization is because eq 24a is not exact any more and eq 25 obtains a different truncation component the effect of λϕ decays here approximately as h 2 for all moments since the trt emm applies in a single cell the insensitivity to the free parameters can be achieved over fine grids it is important to stress that the transport coefficients are all exactly parameterized by pe and ce meaning that they remain the same when the velocity field and diffusion eigenfunction λ scale accordingly the steady state solution b n r is independent of the acceleration parameter βe in eq 10 when βe 1 ce and velocity amplitude should reduce approximately linearly with βe according to stability estimate in eq 10e the trt emm computations are stopped when the relative difference in δd δsk and δku is less than ϵ 10 11 over successive 5 102 steps fig 20 shows that the number of steps to steady state is nearly the same in the three equations n 1 2 3 the number of steps decreases linearly with the u x or βe increase that is nearly the same computational time is required with u x β e 10 u x r e f 1 or u x β e u x r e f 10 since the small velocity amplitudes are more accurate because of the truncation corrections βe is expected to be helpful the results in fig 20 correspond to exp ii in ω form the γ form typically requires a slightly larger number of steps we note that when pe increases linearly due to the mesh refining the number of steps to steady state increases slightly finally it has been suggested ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 that the mass source component sn and flux jump j n from eq 16e can be dropped at sufficiently high pe provided that the sets ω n and γ n grow with pe for n 2 e g like in eq 57 with stratified flow in fact these two terms originate from the diffusion term in eq 1 and they cannot be omitted in a diffusion dominated process like in series of heterogeneous porous blocks where ω 2 is asymptotically constant and decays with pe for n 3 see eq 48 fig 21 displays the relative differences in δd δ sk t and δ ku t between two emm solutions with and without s n j n in the two flow experiments in both of them the three relative differences diminish from the interval 20 40 at pe 7 4 to about 1 at pe 740 but they are still noticeable for δ sk t and δ ku t at pe 74 in exp i since the spatial and temporal moments are inter related through eq 15 a similar situation will take place with δ sk s and δ ku s these simulations confirm that in the presence of the fractured velocity path sn and j n can be omitted at sufficiently high pe making numerical implementation much more simple 7 3 the direct ade schemes numerical set up we model the spatial and temporal dispersion with the three d2q5 schemes ade c and ade j from eq 11 and ade r from eq 12 the bounce back is applied on the horizontal walls and solid obstacles for the spatial spread an evolution of the plume distribution c x x 0 y t 0 1 is run through 10 2 2 10 2 basic cells the raw moments μ n t x y ϕ x y c x y t x x 0 n d x d y are normalized with μ 0 t and employed to compute the central moments μ n t for n 2 3 4 the set ω n n u m is derived from the moments with eq 53 and normalized with eq 13 it determines u n u m k t d d 0 1 and sk s ku s with eq 14 as the reference example for ade j in open poiseuille flow through a basic cell h 40 we obtain u n u m u s u m and the relative errors 0 027 0 53 0 1 for d sk s and ku s respectively using the porous flow parameter set pe 74 c e 1 30 u x u x r e f λ ϕ 1 4 the trt emm convergence criteria is adopted but the stop value is much higher typically ϵ 10 6 we note that the ade schemes then only approximately reach the taylor regime with the same order of steps as the trt emm needs to converge to the steady state it follows that operating in a single cell the trt emm is hundreds time faster already in the small pe range further since the time to the taylor regime and accordingly the number of the unit cells increases linearly with pe the ade computational time increases as pe2 we also note that trt emm with λ ϕ c e 1 30 0 259 from eq 42a behaved much more robustly than the three direct solvers in spatial dispersion as one example the trt emm reaches pe 740 in the basic cell except ϕ 1 8 in exp i while ade r becomes undefined in exp ii with all examined porosity values when pe 74 because λ ϕ 1 becomes negative in several points cf eq 12c the temporal dispersion is modeled with the zero initial distribution c x y t 0 0 the dirichlet boundary condition c x 0 y t c b is prescribed with the anti bounce back rule 29a in boundary nodes r b x 1 2 y using c c b 1 in e q r s the rtd distribution p x i t 1 2 c x i t c t 1 x i is monitored at each time step in a pre selected set of the grid points xi the rtd central moments μ n x t t t x i n p x i t δ t t t 1 2 δ t 1 are accumulated in time using the effective centroid value t x i μ 1 x i the raw moments are all normalized with the actual value μ 0 xi since the dirichlet anti bounce back rule is not exact μ 0 xi may slightly deviate from the steady state exact solution μ 0 xi 1 the set γn is extracted from the central moments with the formulae ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 it determines u n u m x i 1 γ 1 x i μ 1 x i k t x i d d 0 1 sk t x i and ku t x i in eq 14 when the taylor regime is reached typically at xi h pe these values downstream remain approximately the same within the basic cell the rtd simulations are more robust than the spatial spread and the three schemes reach pe 740 in exp i ade c ade j most of the time achieved for this as well in exp ii since the downstream distance should increase linearly with pe the computational time grows as pe2 like in the spatial spread let us recall that the mean seepage velocity u s u m is set with the trt emm in any geometry by construction the direct ade schemes produce u n u m u s u m on the coordinate stencil in stratified channels but u n u m differs from the prescribed constant darcy value with ade j in porous blocks in series see section 5 3 2 fig 22 shows that the three ade schemes modify the prescribed mean velocity value in two dimensional flow both in the spatial and temporal systems when pe 7 4 velocity is small u s u m u x r e f 10 ade c ade r manifest quasi identical relative velocity error e u it slightly differs with ade j but it has the same dependency upon ϕ however when pe 74 u s u m u x r e f ade j produces relatively large velocity errors and it reproduces the ade c only with much smaller velocity as u s u m u x r e f 10 thus although ade j is often more stable than ade c close to the stability line thanks to the reduction of the negative numerical diffusion it needs to operate on a smaller velocity range in heterogeneous soil for the correct advection in the intermediate pe range table 8 shows that when pe 740 the velocity error becomes small with all schemes using the same velocity u s u m u x r e f as a reminder a reduction of the velocity error with λ d 0 c e was first observed with ade j in series of porous blocks remarkably this makes the advection process more accurate when pe grows decreasing λ fig 23 displays the three relative differences δd δ sk t and δ ku t between the direct schemes and trt emm the three direct schemes produce nearly identical results at pe 7 4 where their difference with trt emm is within 0 5 for all three moments and the largest discrepancy happens for kt at the smallest porosity value ϕ 1 8 the anti numerical diffusion mechanism does not play a role either because of the relatively smaller velocity u s u m u x r e f 10 or the predominant role of the taylor and numerical dispersions when pe 74 the three schemes produce similar results only provided that ade j operates with small velocity as u s u m u x r e f 10 according to fig 22 finally as it might be expected from the mean velocity results in table 8 the difference with the trt emm is very similar in the three schemes at pe 740 we note however that the difference between the trt emm and ade increases with pe this can be partly related to the fact that the steady state taylor regime is more difficult to reach with ade when pe grows on the whole in this and all other spatial and temporal dispersion experiments a similar difference within 5 between the trt emm and the direct schemes was mostly observed in the basic cell we conclude that the three ade schemes produce similar solutions when their advection process is accurate enough and then confirm the trt emm moments predictions 7 4 the transport coefficients now using the trt emm solutions we examine how the presence of the solid and porous obstacles impacts the transport coefficients fig 24 displays the relative differences with respect to open flow in exp i both in the spatial and temporal dispersions the dispersion coefficient d d 0 1 k t is the same in the two systems and δd is displayed together for pe 7 4 10 102 103 in the first diagram the four relative differences δ sk s δ ku s and δ sk t δ ku t are displayed together in the three next diagrams at fixed pe we observe that all moments are quite different for solid and highly permeable porous blocks remarkably all transport coefficients become porosity independent at pe 740 the relative difference to open flow also becomes pe independent that means that all transport coefficients obey the same stratified flow pe scaling from eq 57 in highly permeable porous flow a very interesting result in fig 24 is that the highly permeable porous system from exp i is very efficient in the suppression of the taylor dispersion independently of the porosity value indeed while δ d 0 1 when pe 7 4 not shown δd becomes 0 8 for pe 74 and this difference further decreases with pe towards δ d k t k t p 1 1 or kt 0 these results predict the dispersion coefficient to diminish by 80 at pe 74 and almost to vanish at pe 740 and pe 7400 towards k t 0 in porous flow the trt emm also predicts the relative degree of the asymmetry and peakedness in the mean concentration and rtd distributions against the open flow recall that sk s and ku s are both negative in the spatial spread in open poiseuille flow where the mean concentration profiles are hence skewed right and relatively flat see ginzburg and vikhansky 2018 vikhansky and ginzburg 2014 fig 24 predicts that sk s remains negative in porous flow but its absolute value increases δ sk s 2 5 the kurtosis is predicted to change the sign meaning a larger peakedness the rtd profiles are typically skewed left because of the dirichlet inlet condition sk t and ku t are both positive in open flow fig 24 predicts them to hold approximately the same form in the presence of the highly permeable obstacles because δ sk t 0 and δ ku t 0 5 fig 25 displays the mean concentration distribution c x and rtd profiles p t in exp i at pe 74 they are produced by the direct solver ade c when ϕ 1 8 and compared with the reconstructed profiles see section 6 3 1 here the reconstruction is performed from the exact poiseuille moments and from the trt emm moments computed in porous flow the direct computations confirm the drastic reduction of the taylor dispersion with respect to an open flow they also confirm that the self similar dispersion independent distribution σ c x remains skewed right but it is much sharper than in open flow the reconstruction from the trt emm moments practically coincides with the rtd numerical profiles in self similar coordinates they look very alike to open flow in agreement with the moments predictions the direct computations also confirm that the profiles are almost ϕ independent fig 26 displays the trt emm predictions for the spatial and the temporal dispersion in exp ii as has been expected from the mean permeability values in table 7 the trt emm predictions for flow around the solids are nearly the same in the exp i and exp ii but this case is accommodated smoothly in exp ii because the porous obstacles are low permeable a striking difference with the exp i in fig 24 is that kt increases almost linearly with ϕ hence the less porous low permeable blocks reduce the taylor dispersion more efficiently the taylor dispersion reduction increases with pe but it remains weaker than in exp i fig 27 displays the rtd and the mean concentration profiles computed with the ade c at pe 74 according to the predictions in fig 26 for pe 74 δd 0 when ϕ 1 8 and the rtd profiles almost coincide with their open flow counterparts however δd 0 6 when ϕ 19 20 and both the rtd and the mean concentration profiles show that the porous system becomes more dispersive than the open flow in self similar coordinates the reconstructed and numerical profiles agree to each other and look very similar to the open flow profiles because δ sk t 0 and ku t keeps its sign we note that the concentration profiles look more irregular in the less permeable system exp ii they are more oscillating with the ade j scheme from eq 11b because of the interface jumps see perpendicular flow in series fig 7 at the same time the ade c and ade r produce very similar moments and profiles in both spatial and temporal systems finally fig 28 displays the normalized numerical rtd profiles at pe 740 they are monitored closer to the inlet when the taylor regime has not been yet reached we note that ade c and ade j produce very similar profiles at pe 740 in agreement with the moments prediction the asymmetry of the profiles reduces with the porosity following the taylor regime predictions in fig 26 sk t p 0 and δ sk t ϕ 1 0 7 monotonously increases with ϕ the reconstruction from the four moments is not accurate enough close to the inlet but it improves downstream and predicts rtd correctly already at x x 5 10 2 pe according to results vikhansky and ginzburg 2014 an accurate reconstruction of very sharp distributions needs more moments the positive aspect is that any order moments can be predicted with the trt emm applying eqs 16 17 sequentially 7 5 summary the trt emm and three direct ade d2q5 schemes have been examined in two dimensional brinkman flow around solid and porous obstacles the porosity contrast between the fracture and matrix was varied in the interval ϕ 1 8 19 20 their permeability contrast was fixed to 108 two flow scenarios with darcy numbers varying by a factor of 102 have been considered the péclet number was varied in the interval pe 7 4 740 in the basic cell 8 mesh spacings per obstacle and the gap and up to pe 7400 with the trt emm in five times finer cell whereas the trt emm was operated within a single periodic cell the direct simulations were run through one to two hundred of the duplicated cells the trt emm predictions were validated by the direct numerical simulations an agreement within 5 between the two approaches was found in basic cell computing the relative temporal rtd and spatial mean concentration moment differences with the open flow the relative accuracy of the two approaches agrees well with our error estimate in stratified channels but it is much better than it might be expected from the analysis in series for the same porosity contrast pe and discretization level despite the space variable mass source and interface flux jump the trt emm behaved more stably than the direct solvers in the spatial spread the trt emm solutions follow the dimensional analysis from eq 13 the ω form and γ form produced almost identical solutions for dispersion coefficient kt and with the help of eq 14 for the skewness and kurtosis in temporal and spatial dispersions in a given grid pe ce and λϕ fix the steady state solutions for any reference velocity u x r e f and diffusion eigenfunction λ however an exact ce independent parameterization with eq 26a is only valid asymptotically in multi dimensions the scale parameter βe from eq 10 accelerates the convergence to steady state and allows to operate efficiently at small velocity amplitudes it was shown that the non local mass term sn and the flux jump term j n can be omitted already at pe 740 in agreement with the dimensional analysis vikhansky and ginzburg 2014 for fractured type flow this property greatly simplifies the trt emm because on the one hand the diffusion flux becomes continuous on the porous and solid obstacles and on the other hand the finite differences can be avoided in precomputing sn the emm can be then handled by any standard linear ade solver based on the continuous flux condition and local mass source among the three ade schemes the ade c from eq 11a and ade r from eq 12 have shown very similar results within the ade r stability range u ϕ 2 r c e ϕ r using λ ϕ 1 4 the ade c and ade j could remain stable outside this interval but their effective stability is more difficult to estimate the ade j needs a smaller velocity amplitude to reproduce correctly the averaged seepage velocity in heterogeneous soil at the intermediate pe range however the three ade schemes produce very similar results at higher pe where ade j reduces its velocity correction reducing λ at fixed pe and grid the transport coefficients in direct simulations depend upon all numerical parameters u x r e f ce λ and λϕ separately because of the truncation corrections ginzburg 2017b a highly permeable micro channel type porous arrangement was found most efficient for dispersion reduction in creeping brinkman flow independently of the matrix porosity ϕ at the same mean seepage velocity value u x r e f when the pe behavior of moments becomes established e g fractured type pe scale from eq 57 the asymptotic solutions can be estimated from the trt emm computations performed at the intermediate pe range saving drastically computational resources the trt emm is especially suitable for mesh refining and clearly advantageous for the prediction of the dispersion and the higher moments in the taylor regime in transition to the taylor regime the emm approach allows to predict qualitatively an effect of different scenarios e g due to the flow regime and geometry aspects 8 concluding remarks the two relaxation times lattice boltzmann linear advection diffusion scheme trt emm has been proposed for the numerical formulation of the extended method of moments emm in d dimensional heterogeneous soil the trt emm incorporates locally the recursively precomputed space variable mass sources and automatically accounts for the diffusion flux interface jumps in the streamwise discontinuous porosity the scheme allows for an optional acceleration to steady state with relatively small velocity amplitudes a sequentially solved chain of the boundary value problems independent for each mean velocity direction provides three longitudinal taylor coefficients dispersion skewness and kurtosis the full dispersion tensor can be restored from d independent runs and a recursive extension to the next order longitudinal moments is straightforward although the whole evolution picture is not described by the taylor moments they might indicate qualitatively the relative role of the different factors for transition regimes provided that the moments amplitudes grow with pe the diffusion flux jump j n and the associated non local mass source sn become negligible and the method can be run by any heterogeneous ade solver based on the continuous diffusion flux it has been confirmed that the spatial ω form and the temporal γ form are numerically equivalent in providing the two systems of moments the ω form is preferable because of its ability to the fully diffusive problems its simplicity and higher numerical reliability the algebraic transforms between the temporal and spatial systems of moments are also applicable to direct ade computations for example the rtd simulations under the heaviside entry behaved more robustly than the spatial spread with the proposed lbm ade direct schemes it has been recognized that because of the truncation correction due to the non linear mass source space variation the fixed value of the eigenfunction product λϕ is not sufficient to parameterize the steady state trt solutions by pe exactly a specific dependency on the diffusion coefficient scale parameter ce λ ϕ c e a 1 c e guarantees this property in a parallel and a perpendicular flow for any mass source future analysis will attempt to extend this functionality to the multi dimensional flow a robust choice a 1 4 eliminates the mass source truncation correction and assures continuous bn solution for the three first orders with the pure diffusion implicit jump tracking in series however the perpendicular darcy flow through porous blocks presents an increasing difficulty benchmark for dispersion and higher order moments where the leading order midway location of the continuity condition requires a rather fragile unstable limit a 0 or λϕ 0 the choice of λϕ is therefore decisive for the high porosity contrast modeled on coarse grids where very small values λϕ are expected to improve implicit interface location in x ray tomography series block type geometry in stratified flow and fractured brinkman flow through permeable obstacles the trt emm and direct solvers behave much more accurately than in series and have shown much smaller dependency on λϕ a 1 4 is recommended for trt emm in fractured brinkman flow while a 1 8 is more suitable in heterogeneous darcy flow operated in a single cell the trt emm copes very well with the grid refining for a solution independence upon free numerical parameters and high péclet range in our parallel work we attempt to reduce λϕ impact on the unresolved continuity conditions with the help of the conjugate interface corrections in the direct schemes numerical diffusion becomes insignificant against the taylor dispersion at sufficiently high pe and heterogeneity contrast the two examined direct solvers with the equilibrium and collision anti numerical diffusion treatment and the scheme without any treatment then show similar results but different stability in compliance with the predictions in diffusion dominant heterogeneous problems the collision anti numerical diffusion collision treatment becomes preferable to the equilibrium approach because the discontinuous equilibrium weights cause concentration jumps and modify the mean seepage velocity this preference is expected to hold for the equilibrium and collision models with heterogeneous anisotropy ginzburg 2006 ginzburg and d humières 2007 in the presence of solid and porous obstacles the prescribed mean seepage velocity is not kept exact with all direct schemes to be contrasted the trt emm guarantees advection velocity by construction and its steady solutions are numerical diffusion free the proposed scheme applies with the stair wise geometry description it will be coupled with the more accurate interface and boundary tracking for a fine description of solid and porous objects in future work to conclude the proposed simple trt emm is readily applicable to tomographic rock images and reconstructed media for a systematic classification of their dispersion properties and for optimization design under desired moments constraints in composite material wetland or chemical device our artificial porous arrangement exemplified such kind of application it has been found that the porous highly permeable obstacles reduce very efficiently the taylor dispersion independently of their porosity and that the moments then asymptotically obey the same pe scale as in open flow however the péclet number and porosity dependencies both become more complicated with the weakly penetrable obstacles and they may even enhance the taylor dispersion against the open flow brinkman creeping flow in the two darcy regimes was simulated but further the numerical emm simulations in inertial flow may clarify the influence of the viscous and inertial resistance turbulence shear layers or wake effects as well as the role of heuristic flow model parameters such as the brinkman viscosity in the present study nonetheless the flow should be described quite accurately because it was demonstrated that the prediction of moments is quite sensitive to the quality of the heterogeneous velocity field acknowledgments the author is grateful to alexander vikhansky and gonçalo silva for their kind help appendix a the emm implementation details a 1 the ω form the three first orders n 1 2 3 in eqs 16b 16e read locally with superscript ω is employed in ω form a 1 m n ω m n ω s n ω ϕ ω n n 1 ω 1 u x m 1 ω u ϕ x b 0 ω b 0 ω 1 s 1 ω d ϕ x b 0 ω 0 j 1 ω d ϕ 1 x m 2 ω ϕ ω 1 b 1 ω d ϕ b 0 ω u ϕ x b 1 ω s 2 ω d ϕ x b 1 ω j 2 ω d ϕ b 1 ω 1 x m 3 ω ϕ ω 1 b 2 ω ω 2 b 1 ω d ϕ b 1 ω u ϕ x b 2 ω s 3 ω d ϕ x b 2 ω j 3 ω d ϕ b 2 ω 1 x s 4 ω d ϕ x b 3 ω eqs 16 17 with eq a 1 are sequentially solved for b 1 ω b 2 ω and b 3 ω ωn is computed recursively with eq 16f or eq 18 for n 2 3 4 a 2 the γ form the three first orders n 1 2 3 in eqs 16b 16e read with superscript γ applies in γ form a 2 m n γ m n γ s n γ γ n u ϕ x b 0 γ n 1 b 0 γ 1 m 1 γ ϕ m 2 γ ϕ γ 1 u ϕ x b 1 γ d ϕ γ 1 2 b 0 γ m 3 γ ϕ γ 1 u ϕ x b 2 γ γ 2 u ϕ x b 1 γ d ϕ 2 γ 1 γ 2 γ 1 2 b 1 γ and a 3 s n r d ϕ k 1 n γ k x b n k n 2 s 1 γ 0 s 2 γ d ϕ γ 1 x b 1 γ s 3 γ d ϕ γ 2 x b 1 γ γ 1 x b 2 γ s 4 γ d ϕ γ 3 x b 1 γ γ 2 x b 2 γ γ 1 x b 3 γ the solution for γn reads a 4a γ n m n γ s n γ u ϕ x b 0 γ n 1 b 0 γ 1 then a 4b γ 1 ϕ u ϕ x 1 u x and for n 2 a 4c γ n k 1 n 1 γ k u ϕ x b n k s n d ϕ m 1 n γ m γ n m u ϕ x the jump term j n r reads a 5 j n r d ϕ k 1 n γ k b n k 1 x n 1 j 1 γ γ 1 d ϕ 1 x j 2 γ d ϕ γ 2 γ 1 b 1 γ 1 x j 3 γ d ϕ γ 3 γ 2 b 1 γ γ 1 b 2 γ 1 x a 3 computation of the s n r the mass term s n r in eqs a 1 and a 3 requires to precompute d ϕ r x b k r for k n when the three to four grid neighbors are available at point x along the longitudinal x axis inside the continuous porosity block vϕ the third order accurate finite differences apply a 6a x f x 2 3 f x 1 f x 1 1 12 f x 2 f x 2 o ϵ 4 a 6b x f x 1 2 f x f x 1 1 3 f x 1 1 6 f x 2 o ϵ 4 a 6c x f x 11 6 f x 3 f x 1 3 2 f x 2 1 3 f x 3 o ϵ 4 these operators are exact on the third order polynomial solution in particular in a series of porous blocks of the minimal thickness of four nodes per block eq a 6b applies with all points except the corners where eq a 6c applies this allows to match pure diffusion solutions for kurtosis from eq b 2 when only one or two neighbors are available inside the same porosity block the standard two three points finite differences apply for x f x like a 7 x f x 1 2 3 f x 4 f x 1 f x 2 o ϵ 3 x f x 1 2 f x 1 f x 1 o ϵ 3 x f x f x f x 1 o ϵ 2 the two first operators a 7 are exact for parabolic distributions the last one is only exact for a linear function f x a 4 the trt emm algorithm we resume the principal trt emm steps following section 3 2 the trt emm computes sequentially the steady state numerical solution b n r to eqs 16 17 for n 1 2 3 this solution is used to compute the next order mass source terms m n 1 r and s n 1 r and then ω n 1 with eq 16f in ω form or γ n 1 with eq a 4a in γ form the two sets ωn and γn n 2 3 4 define the transport coefficients in eqs 14b 14e with the help of eqs 13 and 15 one computational run for n 1 2 3 consists from the following steps 1 pre initialization step this step is the same for n 1 2 3 a prescribe the formulation either ω form or γ form use ω form for pure diffusion in eq 1 note that ω form is simpler b prescribe a single cell v and its longitudinal periodic direction say 1 x c prescribe porosity field ϕ r 0 1 and steady state velocity field u ϕ r l u periodic along 1 x and resolved on the regular computational grid inside the penetrable region r v ϕ v see eq 1 2 initialization step a prescribe constant equilibrium parameters in eq 19 ce 0 and βe 1 such that c e min r ϕ r d β e d 1 2 3 with d1q3 d2q5 and d3q7 respectively see eq 10e b optionally rescale u ϕ l u in linear stokes brinkman darcy flow and or modify ce and βe to satisfy an approximate stability condition u ϕ 2 r α 1 d u ϕ α 2 c e ϕ r β e see eq 10e when ce and βe are fixed this condition is satisfied if u ϕ is multiplied by the scale value s 0 min r c e ϕ r β e u ϕ 2 u ϕ u ϕ s c precompute u s u m r v ϕ u ϕ x r r v ϕ ϕ r d prescribe pe in eq 1 and compute λ from condition pe u s u m l l u d 0 l u d 0 l u c e λ where l l u is the characteristic length e prescribe b 0 r b 0 r 1 and ω 1 with eq 16c or γ 1 with eq a 4b in γ form replacing u x by u s u m f if n 2 or n 3 input already computed solution b k 1 r and ωk in ω form or γk in γ form with k 2 n g precompute m n r with eq a 1 in ω form or eqs a 2 a 3 in γ form check that r v ϕ m n r 0 h precompute j n r with eq a 1 in ω form or eq a 5 in γ form i prescribe a positive distribution or a constant value exemplified in eq 42 for collision number λ ϕ r precompute λ ϕ r λ ϕ r λ ϕ r with λ ϕ r ϕ r λ j prescribe any initial local mass distribution ρ r t 0 precompute global mass m g l o b r v ϕ ρ r t 0 k prescribe initial population solution f q r t 0 q 0 q m e g using eq 19 with m n r 0 f q r t 0 e q r t 0 e q r t 0 q 1 q m 2 f q r t 0 e q r t 0 e q r t 0 q 1 q m 2 c q c q f 0 r t 0 ρ r t 0 2 q 1 q m 2 f q r t 0 3 computation step perform t run collision streaming steps 7a using trt operator 8 a compute s ϕ r with eq 9 from λ ϕ r b compute e q r t q 1 q m 2 with eq 19 c compute g q r t q 1 q m 2 with eq 8 d set m r m n r in eq 7a and compute f 0 r t 1 e compute f q r c q t 1 with eq 7a when r c q v ϕ q 1 q m f compute f q r b t 1 in boundary node r b with the bounce back rule using eq 29b when r b c q v ϕ 4 analysis step a compute ρ r t and check whether m g l o b r v ϕ ρ r t b compute n 1 th order moments a b n r with eq 19c b b n r with eq 20 c m n 1 r and s n 1 r with eq a 1 in ω form or eqs a 2 a 3 in γ form d ω n 1 with eq 16f or γ n 1 in γ form with eq a 4a e ω n 1 or γ n 1 with eq 13 using e g u 0 u s u m f in ω form γ n 1 ω n 1 is computed with eq 15 in γ form ω n 1 γ n 1 is computed with the inverse to eq 15 g if n 1 compute kt with eq 14c if n 2 compute sk s with eq 14d and or sk t with eq 14e if n 3 compute ku s with eq 14d and or ku t with eq 14e h check steady state criteria with the prescribed stop value ϵ e g k t t k t t t r u n k t t ϵ i repeat computation step if neither the steady state nor the maximum number of iterations has been reached go to output step otherwise 5 output step save b n r ω n 1 and or γ n 1 for the next pass if n 1 2 6 final step go to initialization step if n 1 2 stop computations if n 3 remark a 1 steady state fields m n r j n r and λ ϕ r are precomputed during initialization in the present algorithm however they can be recomputed at each time step for memory saving remark a 2 one pass n 1 is sufficient for the dispersion coefficient kt since s 1 0 in ω form and γ form the finite difference operators from eqs a 6 and a 7 are not needed and m 1 r is computed locally two runs n 1 2 are required for sk s and or sk t the three passes n 1 2 3 are needed for ku s and or ku t remark a 3 in principle the model parameters ce βe λ and λ ϕ r can differ in three separate runs provided that pe and the necessary stability condition c e min r ϕ r d β e are respected appendix b diffusion in a series of porous blocks b 1 reference solution in pure diffusion through a series of two porous blocks of length h h 1 h 2 with the porosity ratio rϕ and thickness ratio rh the effective diffusion coefficient d e f f from eq 14b and kurtosis coefficient ku s from eq 5 read see ginzburg and vikhansky 2018 b 1a d e f f ω 2 d r d 0 d r 1 r h 2 r ϕ r h r ϕ 1 r h r ϕ r ϕ ϕ 1 ϕ 2 r h h 1 h 2 b 1b d r 0 1 d r r ϕ 1 d r r h 0 1 b 1c sk s 0 b 1d ku s ku t t 6 ω 4 ω 2 2 h 2 d 0 r h 2 r ϕ 2 1 2 2 1 r h 2 r ϕ r h r ϕ 1 r h r ϕ when all the integrals are computed via summation in eq 16 ku s becomes b 2 ku s u m r ϕ 1 2 r h 2 h 2 1 r ϕ 2 r h r h r ϕ 1 r h r ϕ 2 1 r h 2 r ϕ r h r ϕ 1 r h r ϕ d 0 the d r should be the exact solution of any second order accurate numerical scheme the trt emm from eq 19 and the direct ade schemes 11 produce d e f f exactly for any physical and free parameter choice however the trt emm with the implicit flux jump tracking from eq 19 produces eq b 2 exactly only if λϕ from eq 26a is computed with a a k u s u m b 3 λ ϕ a k u s u m r ϕ r h 1 c e a k u s u m r ϕ r h 7 r ϕ r h 1 r ϕ 12 7 r h r ϕ 24 1 r h 2 r ϕ lim r ϕ 0 a k u s u m the parameter dependent solution b 3 locates an interface jump in eq 41 midway the grid nodes eqs b 1 b 3 are invariant with respect to a simultaneous transformation r ϕ r ϕ 1 and r h r h 1 b 2 semi explicit diffusion jump tracking assume the coordinate discrete velocity set to be applied in a pure diffusion process along the x axis and the jump values n j n x 1 2 c q a ϕ from eq 17b to be precomputed midway the grid nodes the modified trt update then reads b 4 g q x g q x δ g q x g q x g q x δ g q x δ g q x 1 2 j q x j q x j q x t q j n x 1 2 c q n j n d ϕ b n 1 1 x c q c q in contrast with eq 19 eq b 4 copes with the pure diffusion equilibrium function when the mass source incorporates x j n x s n x according to eq 16e b 5 e q 0 m n m n m n x s n x e q x t q c e b λ ϕ m n eqs b 4 and b 5 allow to verify numerically the symbolic analysis developed in section 4 we note that δ g q δ g q δ g q is non zero only for two opposite interface cut links which obtain the same prescribed flux jump quantity b 6 δ g q x 0 x 0 1 2 c q x t q j n n x 0 δ g q x 0 x 0 1 2 c q x t q j n n x 0 eq b 6 coincides with the flux jump scheme guo et al 2015 on the midway located straight interface when t q 1 2 minimal sets continuity relation in eq 28a remains the same but second order accurate eq 40 becomes in diffusion case replaced by eq b 7 with the exact flux jump j n x x 0 in the rhs b 7 if x m n x 0 0 or m n if a 1 4 d ϕ x b n 2 x x 0 j n x x 0 φ x d ϕ x b n in pure diffusion in series of two porous blocks at order n 3 m n x is piecewise linear and the semi explicit scheme locates flux jump condition midway provided that a 5 24 with eq 41 eq b 2 is then held using eq a 6 for s 4 x d ϕ x b 3 x in eq 18b second order accurate finite differences are sufficient at n 1 2 3 to precompute s n x d ϕ x b n 1 and to extrapolate j n x 0 from the neighbor blocks 
798,the uncertainty of a changing climate raises challenges for water infrastructure planning and design not accounting for nonstationarity may result in under designed structures that fail too frequently or over designed structures that are economically inefficient this concern is magnified by uncertainty in the long term frequency and magnitude of future extreme events planning strategies that allow adaptations over a structure s life could improve both reliability and economic efficiency this study develops a method to inform adaptive water infrastructure planning with uncertain hydrologic and other forms of nonstationarity applied to levee system planning a stochastic dynamic programming model including a markov process is developed for infrastructure planning with uncertain nonstationarity in flood frequency bayes theorem is used to update peak flow probabilities conditioned on observed past peak flows and to update expected residual flood damages over time a levee system planning problem with a numerical example from california illustrates the approach to derive optimal levee heights over time and economic values of adapting to uncertain nonstationary flood risk the projected range of probabilistic hydrology scenarios affects the optimal results particularly in later planning stages as hydrology scenarios diverge with time adaptive planning strategies allowing more levee upgrades over time slightly lowers the overall cost and provides better flood protection than one time construction under nonstationary hydrology for any climate in the example compared to a known future nonstationary hydrology incorporating uncertain nonstationary climate results in higher levees being planned for observed severe hydrology scenarios in later stages the overall present value cost with uncertain nonstationary climate depends on rates of change in peak flow distribution parameters in future hydrology scenarios keywords nonstationary hydrology uncertain nonstationarity water infrastructure planning stochastic dynamic programming risk based analysis 1 introduction we know the climate is changing but we aren t sure exactly how and how much water infrastructure planning traditionally requires a stationary assumption that the probability distribution of extreme events will not change significantly over time milly et al 2008 jakob 2013 however in a nonstationary hydrology the intensity duration and frequency of climatic extremes will change alexander et al 2006 field 2012 gregersen et al 2013 jakob 2013 cheng and aghakouchak 2014 a nonstationary hydrology would affect the reliability of existing water infrastructure and planning of new infrastructure particularly flood protection infrastructure such as dams and levees read and vogel 2015 dettinger et al 2016 the assumption of stationarity in planning is evolving to include climate change and other dynamic considerations e g zhu et al 2007 smith et al 2017 more severe droughts from climate warming increases the need for storage capacity while more severe floods encourage release of more stored water together creating a need to re balance infrastructure design and operation plans between conflicting purposes dettinger et al 2016 long term water infrastructure planning should not only achieve economic environmental and social goals but also be robust and adaptable to nonstationary hydrology infrastructure planning is driven by economic benefits and costs layard and glaister 1994 flood protection design from an economic perspective should consider benefits from reduced flood risk and costs of construction and maintenance over time loucks et al 2005 dwr 2016 economic flood risk is calculated by summing over all possible events the probability of each flood magnitude multiplied by its economic consequences van dantzig 1956 samuels et al 2008 eijgenraam et al 2014 hui et al 2016a b since flood protection infrastructure reduces but does not eliminate flood risk some residual flood damages always exist deverel et al 2016 hui et al 2016b in the united states bulletin 17c has updated the early guidelines for determining flood flow frequency to include consideration of nonstationary climate conditions subcommittee 1982 england et al 2015 to achieve economically rational flood protection risk based infrastructure planning usually aims to minimize the sum of expected construction maintenance and residual damage costs discounted over time in flood planning traditional flood frequency analysis assumes that the statistical properties of extreme events are stationary independent and identical stedinger and crainiceanu 2001 zhu et al 2007 under nonstationary conditions the statistical parameters of the peak flow distribution would vary with time cheng and aghakouchak 2014 cheng et al 2014 this challenge is further complicated by the fact that the long term changes in these statistical parameters are uncertain dynamic programming dp is often used to solve water planning problems with stationary hydrology yakowitz 1982 loucks et al 2005 to deal with climate changes and hydrologic variability many optimization models have been developed for flood protection systems using projected hydrology scenarios to represent nonstationarity loucks et al 2005 zhu et al 2007 teegavarapu 2010 culley et al 2016 optimization formulations to address uncertainties through the use of scenarios include scenario optimization robust optimization and stochastic programming dembo 1991 wagner et al 1992 mulvey et al 1995 for dynamic hydrologic changes over time few flood planning studies have examined the probability of each projected hydrology scenario being updated with ongoing hydrologic observations which incorporates uncertainty into nonstationary hydrology the design of sustainable long term water infrastructure plans should be robust and adaptable over time to changing future conditions adaptive plans are designed to be updated over time with new available information thus should better manage changing future circumstances with uncertainty and better guide future actions basic principles for sustainable adaptive plans include exploring a broader range of uncertainties considering long term goals while targeting short term objectives continued monitoring and including options that can be adjusted to respond to problems and opportunities walker et al 2013 several planning frameworks have been proposed in this area assumption based planning abp involves adaptive planning using signposts and triggers to detect actions needed to reduce vulnerability to uncertain future changes dewar et al 1993 the principles underlying abp guide the development of static or robust adaptive plans such as robust decision making grove and lempert 2007 fischbach 2010 adaptive policymaking walker et al 2001 rahman et al 2008 adaptation tipping points and adaptation pathways kwadijk et al 2010 haasnoot et al 2012 and dynamic adaptive policy pathways haasnoot et al 2013 kwakkel et al 2015 however these frameworks have not incorporated probabilistic nonstationarity in hydrological parameters to provide an adaptive plan that addresses changing probabilities of projected hydrology scenarios in flood management this study examines the effects of uncertain nonstationary hydrology on optimal adaptive water infrastructure plans using a stochastic dynamic programming sdp method with a markov process the conditional probabilities of projected hydrology scenarios are updated with observations over time using bayes theorem renard et al 2013 this case is compared to adaptive water infrastructure planning using a deterministic dynamic programming ddp model for known nonstationary the paper proceeds as follows section 2 describes the problem of hydro economic water infrastructure planning with uncertain nonstationary hydrology section 3 develops a general sdp model for the planning problem section 4 applies the model to risk based levee system planning particularly for adaptive planning over time section 5 discusses the example results and section 6 concludes this study 2 nonstationary hydrology and infrastructure planning problem flood protection planning typically assumes a stationary probability distribution of annual peak flows where maximum annual peak flows are independent identically distributed random variables with unchanging mean and standard deviation values over time stedinger and crainiceanu 2001 with a nonstationary hydrology the annual flood frequency distribution is likely to change over time with uncertain mean and standard deviation cheng and aghakouchak 2014 fig 1 a illustrates six hypothetical future hydrology scenarios with variations of the annual peak flood flow distribution over time following a log normal distribution fig 1 b shows the current annual peak flow distribution and fig 1 c shows the annual peak flow distributions in six hypothetical hydrology scenarios in the future where the mean and standard deviation change at different rates in each scenario explained further in section 4 2 future hydrology scenarios generally vary for different climate projections planning studies typically aggregate projected hydrologic data with the probability of each hydrology scenario however the probabilities of each scenario will also change given uncertain nonstationary hydrology the probabilities of different hydrology scenarios evolve as more hydrologic observations become available over time for long term infrastructure planning and capital investment reliability and economic costs are major concerns ignoring the uncertain nonstationary hydrology might cause infrastructure to be over or under designed in economic terms errors in a forecasted uncertain nonstationary hydrology can also cause under or over design to balance reliability and economic cost a risk based method can minimize the overall average long term cost reliability corresponds to the residual risk where risk is typically defined as the summed product of failure probability and economic or other consequences the economic costs of infrastructure include construction maintenance improvements and expected annual residual failure costs infrastructure should be maintained or improved after initial construction an adaptive planning strategy provides ability to adjust long lived infrastructure to changing natural and social conditions haasnoot et al 2013 kwakkel et al 2015 the benefit of adaptation over time from reduced annual failure cost and other aspects depends on the infrastructure s functionality estimated for local conditions for infrastructure planning let the overall planning horizon be n t nt where t is the incremental adaptive period for improving upgrading the infrastructure nt is the number of intervals over the infrastructure s lifetime nt 1 means there are no improvements over its planned lifetime a one time construction strategy with no adaptation at each time step t 1 n a vector x t defines the state of the infrastructure and a vector δ x t defines any changes to the infrastructure maintenance repair enhancement upgrade etc which together lead to the infrastructure s state at next time step t 1 x t 1 x t δ x t t 1 n given m forecasted hydrology scenarios a t s μ t s σ t s s 1 m t 1 n evolving over time t that are assumed to span over all possible hydrology scenarios each defines a potential nonstationary annual peak flood flow distribution with a changing mean μ t s and standard deviation σ t s of the annual peak flood flow although the distribution s functional form remains fixed the mean annual flood flow μ t s in each hydrology scenario a t s is assumed to be constant or vary linearly with time eq 1a given the initial mean μ0s time t and change rate of the mean μ1s similarly the standard deviation σ t s is assumed to also be constant or vary linearly with time eq 1b given the initial standard deviation σ0s and the standard deviation s change rate σ1s variation of the mean and standard deviation can take other forms but linear trends are used here for demonstration and simplicity 1 μ t s μ 1 s t μ 0 s a σ t s σ 1 s t σ 0 s b for computational purposes the peak flow qi i 1 nq is discretized into δq increments each hydrology scenario has a projected constant probability p t a t s p a s at any time t t 1 n at each stage t the sum of probabilities of all hydrology scenarios should equal one 2 s 1 m p t a t s 1 t 1 n with a deterministic nonstationary hydrology the probability of a hydrology scenario at any projected time is constant however given uncertainty in hydrologic nonstationarity the true probability of a projected hydrology scenario is likely to change with time referred to as uncertain nonstationary hydrology following the markov process assumption the future probability of a hydrology scenario would depend on available hydrologic observations loucks et al 2005 vicuna et al 2010 such conditional probabilities reflecting uncertain nonstationarity can be applied to risk based economic water infrastructure planning calculations 3 model formulation for infrastructure planning a basic dynamic programming formulation to deal with nonstationary hydrology includes elements of decision stage decision variables state variables and objective function the stage is time t 1 n where n t nt and infrastructure construction or improvement can only occur each t year interval and nt times over an infrastructure s lifetime in a deterministic dynamic programming ddp model state variables are the infrastructure s state vector x t of the current stage decision variables are the infrastructure s change vector δ x t at each time step t with the relation that x t 1 x t δ x t t 1 n the overall objective is to minimize the summed discounted costs over the planning horizon at an inflation adjusted discount rate rt the discount rate rt can vary with time such as a hyperbolic discounting in a societal context weitzman 1998 dasgupta 2008 but a simple constant discount rate is used here for illustration purposes e g zhu et al 2007 for a known nonstationary hydrology the probability of a scenario a t s is known exactly at any stage and constant at p as the backward recursive function for this dynamic programming model is zhu et al 2007 3 f t δ x t x t c n δ x n x n e r n e r n 1 t n c t δ x t x t s 1 m p a s f t 1 x t 1 x t δ x t t 1 n 1 where f t 1 x t 1 x t δ x t min δ x t 1 f t 1 δ x t 1 x t 1 x t δ x t e r t 1 and the overall objective is m i n f 1 δ x 1 x 1 the cost c t δ x t x t at time t depends on the flow frequency distributions assuming no more maintenance or improvement after the end of the planning period the present value cost at the last planning stage t n for an infinite horizon problem is 4 c n δ x n x n e r n e r n 1 the scenario based cost c t δ x t x t a t s in this ddp approach depends on the flow frequency distributions and the probability distribution of hydrology scenarios at each time step t and the cost c t δ x t x t at each time step t is the expected cost weighted by the hydrology scenario probabilities p as similar to the probabilistic recursive function the expected cost at each time t is 5 c t δ x t x t s 1 m p a s c t δ x t x t a t s t 1 n the ultimate probability of a hydrology scenario is not necessarily equal to the initially projected probability of that hydrology scenario uncertainty exists in the nonstationary hydrology a stochastic dynamic programming model with a markov process sdp is developed to solve such uncertain nonstationarity by including the conditional probability p t a t s a t 1 that a hydrology scenario a t s is true at current stage given an observed hydrology scenario state a t 1 at the previous stage vicuna et al 2010 the decision stage decision variables and objective function are the same as the ddp model state variables include in addition to the infrastructure s state vector x t at the current stage the observed hydrology scenario at the previous stage a t 1 μ t 1 σ t 1 represented by observed mean μ t 1 and standard deviation σ t 1 of annual peak flood flows the backward recursive function for this sdp model becomes 6 f t δ x t x t a t 1 c n δ x n x n e r n e r n 1 t n c t δ x t x t s 1 m p t a t s a t 1 f t 1 x t 1 x t δ x t a t s t 1 n 1 the markov uncertainty p t a t s a t 1 adds the state variable a t 1 to the formulation compared to the ddp with constant hydrology scenario probabilities because the present hydrology scenarios are conditioned on those of the immediate past each possible past hydrology scenario state must be represented in the recursive function 7 f t 1 x t 1 x t δ x t a t s m i n δ x t 1 f t 1 δ x t 1 x t 1 x t δ x t a t s e r t 1 the observed hydrology scenario state at previous stage a t 1 μ t 1 σ t 1 affects the conditional probability p t a t s a t 1 of each hydrology scenrio a t s at the current stage using bayes theorem the probability that hydrology scenario a t s is true at current stage t given the observed scenario a t 1 at time t 1 is 8 p t a t s a t 1 p a s p t 1 a t 1 a t s p a t 1 p a s p t 1 a t 1 a t s s 1 m p a s p t 1 a t 1 a t s the cost function c t δ x t x t in this sdp model involving the bayes conditional probability is 9 c t δ x t x t s 1 m p t a t s a t 1 c t δ x t x t a t s t 1 n assuming no upgrades after the end of the planning horizon the present value cost at the last planning stage t n for an infinite horizon problem is the same as in eq 5 the optimal infrastructure design decisions and the estimated investment and cost are conditioned on both infrastructure state and the most recent observed hydrology scenario state by comparing the optimal results from the sdp formula eq 6 with uncertain nonstationarity and from the ddp formula eq 3 with known nonstationarity we can analyze the influence of uncertainty in hydrologic nonstationarity on long term infrastructure planning 4 application to risk based levee system planning as a numerical example a levee system planning problem is used to illustrate the application of the proposed models for different hydrologic situations fig 2 h is levee height bc is levee crown width α is land side slope angle and β is water side slope angle b is channel width w is total channel width to the toe of the levee d is channel depth below the levee toe τ is floodplain slope y is water depth calculated from river flow using manning s equation 4 1 model formulation for levee system planning for this problem levee height is the only decision variable and the levee cannot be degraded decision variables δ x t are the levee height increment δht at each stage in this example stage is the year in planning period state variables in the ddp model are the existing levee height at the beginning of the current stage ht while in the sdp model also include the observed hydrology scenario a t 1 represented by log normal distributed annual flood flow at the previous stage levee height increment existing levee height and the observed hydrology scenario are all discretized the overall objective is to minimize the summed discounted costs over the lifetime of the levee system the state cost function c t δ x t x t differs in the two models eqs 5 and 9 for a known nonstationary hydrology the cost function in the ddp includes averaged expected annual residual flood damage costs eadt δht ht as and levee building or upgrade costs cct δht ht under different hydrology scenarios with probabilities of each hydrology scenario p as eq 10a for an uncertain nonstationary hydrology the cost function in the sdp includes e a d t δ h t h t a t s and cct δht ht averaged by the conditional probability p t a t s a t 1 eq 10b when the levee system is upgraded δht 0 a fixed levee alteration cost is added to cct δht ht representing costs for regulating design consulting and organizing construction etc 10 c t δ h t h t s 1 m p a s ea d t δ h t h t a s c c t δ h t h t e r t a s 1 m p t a t s a t 1 ea d t δ h t h t a t s c c t δ h t h t e r t b levee flood failure could occur by overtopping when peak flow overtops the levee or by intermediate geotechnical non overtopping failure when peak flow rises between the toe and top of the levee such as through seepage levee failure hui et al 2016a the expected annual residual flood damage cost considering both overtopping and geotechnical non overtopping failures for known and uncertain nonstationarity is 11 ea d t δ h t h t a s ea d t δ h t h t a t s p q t s d t q t s q c min q c max δ h t h t p q t s d t q t s q c max δ h t h t p q t s d t q t s levee quality and performance are assumed constant over its lifetime levee deterioration affects the levee fragility curve and therefore the intermediate geotechnical non overtopping failure probability which can be addressed in a future study we assume that the intermediate geotechnical levee failure probability is a linear function of channeled water height in this example failure probability increases linearly from 0 at the toe to 1 at the top wolff 1997 perlea and ketchum 2011 levee building or upgrade costs include the materials management and purchasing land at every construction or upgrade stage 12 c c t δ h t h t 2 v t c adju st c soil l c t for t 1 t 1 2 t 1 3 t 1 cadjust is the soft cost multiplier for construction management and csoil is construction cost per unit material the total volume trapezoidal of upgrading levees along the entire length l of the river reach is v t l b c δ h t 1 2 1 t a n α 1 t a n β h t δ h t 2 h t 2 the cost for purchasing land on floodplains to upgrade the levees with a unit land cost uc the additional area of land occupied by a levee base abase is l c b a s e u c a b a s e u c l b c 1 t a n α 1 t a n β δ h t assuming no more upgrades after the end of the planning period the present value cost at the last planning stage t n for an infinite horizon problem is c n δ h n h n e r n e r n 1 4 2 model input and examined cases the decision horizon of the illustrative levee system plan is assumed to be n 200 years two types of planning strategies are analyzed and compared one time building planning and adaptive building and improvement planning for the latter type we analyze cases with shorter or longer planned adaptation year interval more or fewer adaptations allowed during the lifetime of the levee system after initial construction table 1 with the one time building strategy where t 200yr and nt 1 the levee system is built to an economically optimal height at the beginning and retains this height over its lifetime the adaptive planning strategy allows the levee system to be upgraded every t years after its first construction the number of adaptations upgrades refers only to upgrades after initial construction the input parameters for the example are roughly based on the cosumnes river in california table 2 we use a constant discount rate for simplification and ignore the uncertainty in this time dependent variable which is more uncertain in the long term degradation of the levee system over time is not considered six illustrative hydrology scenarios m 6 are used here for modeling long term plans and are assumed to cover the full range of possible scenarios since climate projections vary significantly with different climate model and input parameters we examined four hypothetical projected climate cases with different annual changing rates of mean μ1s and standard deviation σ1s of flood flow in each hydrology scenario and in each uncertainty case eq 1 the annual change rates of mean and standard deviation of flood flow in a corresponding normal distribution in climate case 1 are μ1s 0 0 2 0 4 0 6 0 8 1 and σ1s 0 0 2 0 4 0 6 0 8 1 for each hydrology scenario respectively climate case 2 has the same μ1s as in case 1 but higher σ1s σ1s 0 0 5 1 0 1 5 2 0 2 5 climate case 3 has higher μ1s and σ1s that are μ1s 0 0 5 1 0 1 5 2 0 2 5 and σ1s 0 0 5 1 0 1 5 2 0 2 5 climate case 4 has the same μ1s as in case 3 but higher σ1s σ1s 0 1 0 2 0 3 0 4 0 5 0 fig 1 c illustrates the variations of annual peak flow distributions over 200 years for climate case 1 because the log values of annual flood flow follow a normal distribution the corresponding log normal distributions change slightly over time with the hypothetical changing means and standard deviations in the four climate cases fig 3 plots the annual peak flow distributions in 200 year for each forecasted hydrology scenario in each hypothetical climate case in climate case 1 and case 2 the mean of the annual flood flow s natural logarithm is increasing from hydrology scenario 1 to 6 and it increases more in climate case 3 and case 4 the standard deviation of the annual flood flow s natural logarithm is the same for each hydrology scenario in climate case 1 and case 3 as the annual changing rates of mean and standard deviation in the corresponding normal distribution are the same while it is increasing from hydrology scenario 1 to 6 in climate case 2 and case 4 as the changing rate of standard deviation in the normal distribution exceeds that of the mean the long term levee system plan is modeled and compared for the four hypothetical nonstationary climate cases the initial probabilities of the six hydrology scenarios are equally 1 6 such probabilities will be constant during the entire planning period in the assumed known nonstationary hydrology the bayes conditional true probability of each hydrology scenario in the assumed uncertain nonstationary hydrology is updated in each following stage based on the observed previous hydrology scenario represented by the mean and standard deviation of annual flood flow distribution the bayesian probabilities at stage 50 100 150 and 200 for the 6 hydrology scenarios in climate case 1 are plotted in fig 4 early stages have fewer variations of hydrology scenario probabilities for observed previous scenarios as time goes on the probability of a hydrology scenario when observing a similar scenario at previous stage is much higher than when the previous observed scenario is rather different at stage 200 the probability of a current hydrology scenario 1 when observing scenario 1 at previous stage is almost 30 times more than observing scenario 6 and is reciprocal for a current hydrology scenario 6 the probability of a current hydrology scenario 3 or 4 when observing scenario 1 or 6 is smaller than observing other scenarios over time observed hydrology improves estimation of future hydrology with nonstationarity given the assumption that long term hydrology conditions are probabilistic 5 results and discussion this section presents and discusses results insightful for three comparative situations 1 one time versus annual adaptive building planning for the four hypothetical climate cases with the ddp and the sdp model respectively 2 detailed discussion of results for climate case 1 including comparison of levee system planning with the ddp and the sdp models for annual adaptive building planning strategy the advantages of adaptive plan illustrated by various planning strategies with the ddp model and impacts from a fixed cost for levee upgrades 3 comparison of results from the ddp and the sdp models and applying the ddp results to the sdp model to show the advantage of planning for an uncertain nonstationary hydrology 5 1 optimal levee system planning summary different frequencies of planned levee upgrades adaptations with the four climate cases for a known nonstationary hydrology were modeled using the ddp and for an uncertain nonstationary hydrology using the sdp table 3 summarizes the main results from model runs with a one time building planning strategy and an annual adaptive building planning strategy that allows levee system upgrades every year during the 200 year planning horizon resulting levee heights from the sdp in later stage can differ for existing levee height and observed previous hydrology scenario so with adaptive building strategy there exists a range of possible final levee height at stage 200 the optimized present value cost for the sdp method m i n f 1 δ x 1 x 1 is the weighted average cost added up through the backward recursion which does not differ for varying possible levee heights at later stages with the one time building plan the levee is built to an optimized height at the first stage and remains at that height for the entire planning horizon with the annual adaptive building plan the levee is built slightly lower at the first stage compared to the one time building plan but is upgraded continuously to a much higher height at the ending 200 year stage allowing annual adaptation is always less costly than not allowing adaptation for every climate case and either method the ddp approach weights each projected hydrology scenario with a constant probability while the sdp approach weighs each scenario with an updated probability as more hydrologic observations are available since the expected cost weighted average cost of all possible hydrology scenarios of the sdp and the ddp depends on the time varying bayes conditional probability and scenario based cost the overall present value cost of the sdp solution differs slightly from using the ddp in each climate case with any planning strategy the sdp solution has slightly lower overall cost in climate case 2 and case 4 where both mean and standard deviation of the log transformed annual flood flow increase faster over time the ddp solution has slightly lower overall cost in climate case 1 and case 3 where standard deviation of the annual flood flow is constant and the mean is increasing lower overall cost for each comparison case is bolded in table 3 compared to planning in the assumed stationary climate case optimal present value cost and initial and final levee heights all increase for assumed nonstationary climate cases as climates possibly become severe later discussion shows the economic disadvantage of applying planning decisions from assumed known nonstationary ddp models to an actual uncertain nonstationary hydrology modeled by the sdp for this study example with any climate case model results show that annual adaptive building slightly reduces the overall present value cost but more substantially alters the planning decisions especially in future years table 3 and the results are similar for the other planning horizon intervals as well overall costs vary little with adaptation frequency adaptive planning has little advantage compared to one time building planning from an economic present value perspective but becomes more reliable given the similar economically optimal present value and much higher levees in the future the adaptive system levees are lower when flood events are less extreme and rise gradually with increased extreme floods 5 2 optimal levee system planning for climate case 1 5 2 1 ddp and sdp comparison for annual adaptive building strategy to illustrate the detailed levee system planning decisions fig 5 plots the optimal sdp model results in climate case 1 over a 200 year planning horizon for observed hydrology scenario 1 3 and 6 at previous stage t 1 given different existing levee heights with annual adaptation allowed the mean and standard deviation of annual flood flow in the stationary hydrology scenario 1 are constant over the planning horizon the small annual change in the rates of mean and standard deviation of flood flow in hydrology scenario 3 indicate an increasing chance of larger annual peak flood flows over time the more extreme hydrology scenario 6 has even higher annual change rates of mean and standard deviation of flood flow representing a significantly increasing chance of extremely larger annual peak flood flows compared to hydrology scenario 3 the blue line on each graph in fig 5 is the optimal levee system planning strategy from the ddp model results for comparison each marker point on the graphs represents a resulting upgraded height at a stage given the possible existing heights for an observed hydrology scenario at the previous stage for instance the upper graph in fig 5 presents all possible resulting upgraded levee heights at each stage t if observing hydrology scenario 1 at previous stage t 1 given possible existing heights different existing levee heights at a stage may correspond to a same upgraded height shown as one marker point on the graphs at early stages levee height upgrades are the same for any observed hydrology scenario at later stages upgraded levee heights often differ with observed hydrology scenarios the range of possible levee heights expands with time as more hydrologic observations are obtained the optimal levee system planning strategy from the ddp model results with known nonstationary hydrology is to build the levee system at 7 7 m at the beginning stage 1 and increase the levees to 8 6 m at stage 63 and again to 9 4 m at stage 153 blue line in fig 5 initial levee height at stage 1 with the sdp model is the same at 7 7 m while the first upgrade adaptation to 8 6 m occurs earlier at stage 60 when observing hydrology scenario 6 and a wide range of upgrade options become available later in later upgrade stages the sdp results with uncertain nonstationary hydrology have more levee height planning options given different hydrologic observations and different existing levee heights and the sdp results have higher levees than those averaged from the ddp by frequencies of upgraded heights fig 5 the maximum optimal levee heights with the sdp are driven by observation of the more severe hydrology scenarios and are much higher than that with the ddp at the ending stages observation of more extreme peak flow conditions brings higher levee upgrades for instance observing hydrology scenario 6 leads to higher levee upgrades than observing hydrology scenario 1 if the stationary hydrology scenario 1 continues to be observed levee heights remain at initial levels however levees are raised from existing heights in some stages if hydrology scenarios 3 or 6 are observed the range of differences among forecasted hydrology scenarios and the economic discount rate both affect optimal planning decisions given observed hydrology scenarios optimal levee height is usually the same across diverse observed scenarios in the early planning stages fig 5 especially when hydrology scenarios differ slightly and discounting homogenizes effects of future changes as time goes on the mean and standard deviation of annual flood flows diverge progressively leading optimal levee heights to diverge in later planning stages the optimal levee height for observed hydrology scenario 6 starts to differ from other hydrology scenarios at stage 60 and differences across hydrology scenarios grow in later stages the minimum optimal levee height with the observed hydrology scenario 1 is less than that with the observed more severe hydrology scenario 6 at any stage the optimal upgraded heights at later stages change with observed previous hydrology scenarios fig 5 economically optimal planning balances the cost from annual expected residual damage and construction at each stage and over the entire planning period in later upgrade stages the more frequent and severe floods increase the expected annual damage cost and then have less indirect impacts on construction cost due to balancing of costs overall differences in damage costs for various hydrology scenarios are partially offset by the discount rate 5 2 2 advantages of adaptive planning adaptive planning allows adjustments to a changing and uncertain climate as more hydrologic observations are available with any adaptive planning strategy the levee will be built and upgraded periodically to a greater height than the one time building plan here 7 8 m for example with one adaptation the levee system is built to 7 8 m at the first stage then raised to 9 0 m with observed hydrology scenarios 1 2 or 3 and to 9 1 m with the observed hydrology scenarios 4 5 or 6 at the upgrading stage 100 year variations of optimal levee system heights for different observed hydrology scenarios increase with the opportunities for adaptions as more adaptations are planned the maximum eventual upgraded height increases and the range of eventual upgraded heights widens fig 6 shows the adaptive levee system planning strategies assuming a known nonstationary hydrology for different adaption year intervals with the ddp model planning cases with more adaptions allowed having a lower initial levee height and a higher final levee height optimal levee height decisions cross for different planning cases over intermediate stages due to varying hydrology scenarios and discount rate with a changing climate levees are upgraded economically with every opportunity unless fixed costs are large fewer upgrading opportunities increases individual upgrade heights more frequent upgrades allow the levee system to adapt to the changing nonstationary hydrology gradually and economically as the planning cases with shorter upgrade intervals show 5 2 3 fixed levee upgrade cost effects the fixed cost for upgrading the levee also affects optimal levee planning decisions levee upgrades occur only when the expected reduced flood damage cost exceeds the upgrade cost which is the construction cost including a fixed levee upgrade cost for the annual adaptive plan levee can be upgraded every year optimal levee heights from the sdp model with a 0 5 million fixed levee alteration cost start to diverge from stage 60 given different observed hydrology scenarios if the fixed levee alteration cost is doubled to 1 million optimal levee heights are the same for different observed hydrology scenarios until stage 86 the overall present value cost increases slightly with doubled fixed levee alteration cost 110 35 million compared to 109 81 million the optimal initial levee height also rises slightly 7 8 m compared to 7 7 m and the final upgraded levee heights both end at 10 m 5 3 advantages of modeling for uncertain nonstationary hydrology the sdp considering uncertainty in a nonstationary hydrology has little overall cost advantage compared to the ddp as the cost in each hydrology scenario contributes to the averaged overall cost table 3 the overall present value cost with the sdp model is less than that with the ddp model when mean and standard deviation of the log transformed annual flood flow increase from hydrology scenario 1 to 6 over time the sdp uses an increasingly reliable projected climate updated over time with the available hydrologic observations the probability of future severe hydrology scenarios in the sdp model would increase based on the observed more severe hydrology scenarios leading to a higher expected annual residual damage cost the sdp model provides a different levee height trajectory for each observed hydrology scenario in the long term the ddp model provides only one levee height trajectory the final levee heights from the sdp model are no lower than the final levee height from the ddp model in all planning cases optimal levee plans made with a known nonstationary hydrology may not be economically efficient for the more likely uncertain nonstationary hydrology implementing the known nonstationary hydrology plan under the alternative uncertain nonstationary hydrology may under design or over design with additional regret costs kang and lansey 2012 table 4 compares the overall present costs from the sdp model the ddp model and applying the optimal levee heights plan from the ddp model assuming known nonstationary hydrology to the sdp model in an uncertain nonstationary hydrology for each climate case with different planning strategies when applying the ddp optimal levee heights to the sdp model for each case the optimal levee system planning decisions assuming known nonstationary hydrology has poorer economic performance in the uncertain nonstationary hydrology with updated conditional probabilities of hydrology scenarios table 4 for any climate case with each planning strategy the overall present value cost of applying the optimal levee planning decisions from the ddp model to the sdp model exceeds that of the ddp or the sdp by 11 13 table 4 similar to the overall cost from the sdp and the ddp models such an overall cost decreases slightly with the increase in adaption frequency and in some cases the differences of overall present values among various planning strategies are too insignificant to determine bolded numbers in table 4 particularly in climate case 2 and case 4 where both mean and standard deviation of the annual flood flow increase in the most severe hydrology scenario 6 applying the optimal ddp model plan to the sdp model results in a significantly higher overall cost plans from the sdp model have better performance for severe hydrology scenarios and overall better reflect the long term climate change projections 6 conclusions a risk based stochastic dynamic programming model with a markov process can incorporate uncertain nonstationary hydrology explicitly into long term water infrastructure planning this study developed an explicit risk based stochastic dynamic programming model with a markov process for long term water infrastructure planning affected by uncertainty in nonstationary hydrology uncertain nonstationary hydrology is represented by several projected hydrology scenarios with time varying statistical properties and the probability of each projected hydrology scenario is updated by bayes theorem based on ongoing hydrologic observations the approach can support adaptive planning to improve reliability and economic performance the sdp model that accounts for uncertainty in nonstationary hydrology shows little economic advantage compared to the ddp model with known nonstationarity however the sdp better represents reality and provides different height options especially in later years when the sdp performs better than the ddp for more severe hydrology scenarios for the studied numerical example of a levee system planning problem the economic advantage of the sdp model compared to the ddp model depends on the changing rates of peak flow distribution parameters in a projected climate the sdp model generally provides more flood protection reliability with little increase in the overall present cost the optimal levee planning strategy resulted from the ddp model assuming a known nonstationary hydrology has much poorer economic performance in the sdp model that assumes uncertain nonstationary hydrology with updated conditional probabilities of hydrology scenarios the changing climate extremes inflation adjusted discounting fixed levee upgrade cost and balances between expected annual residual damage cost and construction cost affect the differences in optimal levee heights for observed hydrology scenarios adaptive water infrastructure plans with nonstationary hydrology have advantages for long term planning in light of the various plausible future hydrology conditions a long term water infrastructure plan should be able to adapt to changes as new information becomes available adaptive planning with more upgrade opportunities is preferable to one time construction planning or adaptive planning with few upgrade opportunities in terms of cost and reliability under known or uncertain nonstationary hydrologies although adaptive plans have little advantage with respect to the net present overall economic cost the strategies are valuable for financial planning especially in the long term when severe hydrology scenarios could require additional investments lower levee heights at early stages result in less construction and total annualized cost that alleviate the near term financial burden higher levee heights at later stages add little to the overall present value costs but provide better protection for severe floods the importance of considering nonstationarity and the uncertainty of nonstationarity depends on the magnitude of uncertainty in the nonstationary hydrology with less variation and uncertainty in the future climate projections long term infrastructure planning for uncertain nonstationary hydrology may not be worthwhile for capital investment assuming deterministic nonstationarity might be sufficient if future climate conditions remain close to historical conditions discount rate damage potential uncertainty and hydraulic uncertainty such as manning s coefficient could have larger impacts yet it is substantially better to model uncertain nonstationarity for capital investment and infrastructure planning when the future climate has great uncertainty the reliability of infrastructure can be heavily affected by uncertainty in nonstationary hydrology this study has limitations in the simplified hydrology scenarios represented by varying mean and standard deviation of annual flow distribution and the linear changing trends in the mean and standard deviation streamflow ensembles generated by a general circulation model combined with a representative concentration pathway van vuuren et al 2011 stocker 2014 could be used to refine plausible ranges of future hydrology scenarios future work can examine changes in the levee system levee setback decisions zhu and lund 2009 and levee deterioration in the long term a theoretical study can examine how the changing rates of peak flow distribution parameters in a projected climate affect the ddp and the sdp model results as guidance for choosing between these models the proposed model in this study only analyzes uncertainty in hydrology while economic uncertainty also has large impacts for planning zhu et al 2007 uncertainty in the development of the adjacent floodplain such as urbanization can also be analyzed in future studies 
798,the uncertainty of a changing climate raises challenges for water infrastructure planning and design not accounting for nonstationarity may result in under designed structures that fail too frequently or over designed structures that are economically inefficient this concern is magnified by uncertainty in the long term frequency and magnitude of future extreme events planning strategies that allow adaptations over a structure s life could improve both reliability and economic efficiency this study develops a method to inform adaptive water infrastructure planning with uncertain hydrologic and other forms of nonstationarity applied to levee system planning a stochastic dynamic programming model including a markov process is developed for infrastructure planning with uncertain nonstationarity in flood frequency bayes theorem is used to update peak flow probabilities conditioned on observed past peak flows and to update expected residual flood damages over time a levee system planning problem with a numerical example from california illustrates the approach to derive optimal levee heights over time and economic values of adapting to uncertain nonstationary flood risk the projected range of probabilistic hydrology scenarios affects the optimal results particularly in later planning stages as hydrology scenarios diverge with time adaptive planning strategies allowing more levee upgrades over time slightly lowers the overall cost and provides better flood protection than one time construction under nonstationary hydrology for any climate in the example compared to a known future nonstationary hydrology incorporating uncertain nonstationary climate results in higher levees being planned for observed severe hydrology scenarios in later stages the overall present value cost with uncertain nonstationary climate depends on rates of change in peak flow distribution parameters in future hydrology scenarios keywords nonstationary hydrology uncertain nonstationarity water infrastructure planning stochastic dynamic programming risk based analysis 1 introduction we know the climate is changing but we aren t sure exactly how and how much water infrastructure planning traditionally requires a stationary assumption that the probability distribution of extreme events will not change significantly over time milly et al 2008 jakob 2013 however in a nonstationary hydrology the intensity duration and frequency of climatic extremes will change alexander et al 2006 field 2012 gregersen et al 2013 jakob 2013 cheng and aghakouchak 2014 a nonstationary hydrology would affect the reliability of existing water infrastructure and planning of new infrastructure particularly flood protection infrastructure such as dams and levees read and vogel 2015 dettinger et al 2016 the assumption of stationarity in planning is evolving to include climate change and other dynamic considerations e g zhu et al 2007 smith et al 2017 more severe droughts from climate warming increases the need for storage capacity while more severe floods encourage release of more stored water together creating a need to re balance infrastructure design and operation plans between conflicting purposes dettinger et al 2016 long term water infrastructure planning should not only achieve economic environmental and social goals but also be robust and adaptable to nonstationary hydrology infrastructure planning is driven by economic benefits and costs layard and glaister 1994 flood protection design from an economic perspective should consider benefits from reduced flood risk and costs of construction and maintenance over time loucks et al 2005 dwr 2016 economic flood risk is calculated by summing over all possible events the probability of each flood magnitude multiplied by its economic consequences van dantzig 1956 samuels et al 2008 eijgenraam et al 2014 hui et al 2016a b since flood protection infrastructure reduces but does not eliminate flood risk some residual flood damages always exist deverel et al 2016 hui et al 2016b in the united states bulletin 17c has updated the early guidelines for determining flood flow frequency to include consideration of nonstationary climate conditions subcommittee 1982 england et al 2015 to achieve economically rational flood protection risk based infrastructure planning usually aims to minimize the sum of expected construction maintenance and residual damage costs discounted over time in flood planning traditional flood frequency analysis assumes that the statistical properties of extreme events are stationary independent and identical stedinger and crainiceanu 2001 zhu et al 2007 under nonstationary conditions the statistical parameters of the peak flow distribution would vary with time cheng and aghakouchak 2014 cheng et al 2014 this challenge is further complicated by the fact that the long term changes in these statistical parameters are uncertain dynamic programming dp is often used to solve water planning problems with stationary hydrology yakowitz 1982 loucks et al 2005 to deal with climate changes and hydrologic variability many optimization models have been developed for flood protection systems using projected hydrology scenarios to represent nonstationarity loucks et al 2005 zhu et al 2007 teegavarapu 2010 culley et al 2016 optimization formulations to address uncertainties through the use of scenarios include scenario optimization robust optimization and stochastic programming dembo 1991 wagner et al 1992 mulvey et al 1995 for dynamic hydrologic changes over time few flood planning studies have examined the probability of each projected hydrology scenario being updated with ongoing hydrologic observations which incorporates uncertainty into nonstationary hydrology the design of sustainable long term water infrastructure plans should be robust and adaptable over time to changing future conditions adaptive plans are designed to be updated over time with new available information thus should better manage changing future circumstances with uncertainty and better guide future actions basic principles for sustainable adaptive plans include exploring a broader range of uncertainties considering long term goals while targeting short term objectives continued monitoring and including options that can be adjusted to respond to problems and opportunities walker et al 2013 several planning frameworks have been proposed in this area assumption based planning abp involves adaptive planning using signposts and triggers to detect actions needed to reduce vulnerability to uncertain future changes dewar et al 1993 the principles underlying abp guide the development of static or robust adaptive plans such as robust decision making grove and lempert 2007 fischbach 2010 adaptive policymaking walker et al 2001 rahman et al 2008 adaptation tipping points and adaptation pathways kwadijk et al 2010 haasnoot et al 2012 and dynamic adaptive policy pathways haasnoot et al 2013 kwakkel et al 2015 however these frameworks have not incorporated probabilistic nonstationarity in hydrological parameters to provide an adaptive plan that addresses changing probabilities of projected hydrology scenarios in flood management this study examines the effects of uncertain nonstationary hydrology on optimal adaptive water infrastructure plans using a stochastic dynamic programming sdp method with a markov process the conditional probabilities of projected hydrology scenarios are updated with observations over time using bayes theorem renard et al 2013 this case is compared to adaptive water infrastructure planning using a deterministic dynamic programming ddp model for known nonstationary the paper proceeds as follows section 2 describes the problem of hydro economic water infrastructure planning with uncertain nonstationary hydrology section 3 develops a general sdp model for the planning problem section 4 applies the model to risk based levee system planning particularly for adaptive planning over time section 5 discusses the example results and section 6 concludes this study 2 nonstationary hydrology and infrastructure planning problem flood protection planning typically assumes a stationary probability distribution of annual peak flows where maximum annual peak flows are independent identically distributed random variables with unchanging mean and standard deviation values over time stedinger and crainiceanu 2001 with a nonstationary hydrology the annual flood frequency distribution is likely to change over time with uncertain mean and standard deviation cheng and aghakouchak 2014 fig 1 a illustrates six hypothetical future hydrology scenarios with variations of the annual peak flood flow distribution over time following a log normal distribution fig 1 b shows the current annual peak flow distribution and fig 1 c shows the annual peak flow distributions in six hypothetical hydrology scenarios in the future where the mean and standard deviation change at different rates in each scenario explained further in section 4 2 future hydrology scenarios generally vary for different climate projections planning studies typically aggregate projected hydrologic data with the probability of each hydrology scenario however the probabilities of each scenario will also change given uncertain nonstationary hydrology the probabilities of different hydrology scenarios evolve as more hydrologic observations become available over time for long term infrastructure planning and capital investment reliability and economic costs are major concerns ignoring the uncertain nonstationary hydrology might cause infrastructure to be over or under designed in economic terms errors in a forecasted uncertain nonstationary hydrology can also cause under or over design to balance reliability and economic cost a risk based method can minimize the overall average long term cost reliability corresponds to the residual risk where risk is typically defined as the summed product of failure probability and economic or other consequences the economic costs of infrastructure include construction maintenance improvements and expected annual residual failure costs infrastructure should be maintained or improved after initial construction an adaptive planning strategy provides ability to adjust long lived infrastructure to changing natural and social conditions haasnoot et al 2013 kwakkel et al 2015 the benefit of adaptation over time from reduced annual failure cost and other aspects depends on the infrastructure s functionality estimated for local conditions for infrastructure planning let the overall planning horizon be n t nt where t is the incremental adaptive period for improving upgrading the infrastructure nt is the number of intervals over the infrastructure s lifetime nt 1 means there are no improvements over its planned lifetime a one time construction strategy with no adaptation at each time step t 1 n a vector x t defines the state of the infrastructure and a vector δ x t defines any changes to the infrastructure maintenance repair enhancement upgrade etc which together lead to the infrastructure s state at next time step t 1 x t 1 x t δ x t t 1 n given m forecasted hydrology scenarios a t s μ t s σ t s s 1 m t 1 n evolving over time t that are assumed to span over all possible hydrology scenarios each defines a potential nonstationary annual peak flood flow distribution with a changing mean μ t s and standard deviation σ t s of the annual peak flood flow although the distribution s functional form remains fixed the mean annual flood flow μ t s in each hydrology scenario a t s is assumed to be constant or vary linearly with time eq 1a given the initial mean μ0s time t and change rate of the mean μ1s similarly the standard deviation σ t s is assumed to also be constant or vary linearly with time eq 1b given the initial standard deviation σ0s and the standard deviation s change rate σ1s variation of the mean and standard deviation can take other forms but linear trends are used here for demonstration and simplicity 1 μ t s μ 1 s t μ 0 s a σ t s σ 1 s t σ 0 s b for computational purposes the peak flow qi i 1 nq is discretized into δq increments each hydrology scenario has a projected constant probability p t a t s p a s at any time t t 1 n at each stage t the sum of probabilities of all hydrology scenarios should equal one 2 s 1 m p t a t s 1 t 1 n with a deterministic nonstationary hydrology the probability of a hydrology scenario at any projected time is constant however given uncertainty in hydrologic nonstationarity the true probability of a projected hydrology scenario is likely to change with time referred to as uncertain nonstationary hydrology following the markov process assumption the future probability of a hydrology scenario would depend on available hydrologic observations loucks et al 2005 vicuna et al 2010 such conditional probabilities reflecting uncertain nonstationarity can be applied to risk based economic water infrastructure planning calculations 3 model formulation for infrastructure planning a basic dynamic programming formulation to deal with nonstationary hydrology includes elements of decision stage decision variables state variables and objective function the stage is time t 1 n where n t nt and infrastructure construction or improvement can only occur each t year interval and nt times over an infrastructure s lifetime in a deterministic dynamic programming ddp model state variables are the infrastructure s state vector x t of the current stage decision variables are the infrastructure s change vector δ x t at each time step t with the relation that x t 1 x t δ x t t 1 n the overall objective is to minimize the summed discounted costs over the planning horizon at an inflation adjusted discount rate rt the discount rate rt can vary with time such as a hyperbolic discounting in a societal context weitzman 1998 dasgupta 2008 but a simple constant discount rate is used here for illustration purposes e g zhu et al 2007 for a known nonstationary hydrology the probability of a scenario a t s is known exactly at any stage and constant at p as the backward recursive function for this dynamic programming model is zhu et al 2007 3 f t δ x t x t c n δ x n x n e r n e r n 1 t n c t δ x t x t s 1 m p a s f t 1 x t 1 x t δ x t t 1 n 1 where f t 1 x t 1 x t δ x t min δ x t 1 f t 1 δ x t 1 x t 1 x t δ x t e r t 1 and the overall objective is m i n f 1 δ x 1 x 1 the cost c t δ x t x t at time t depends on the flow frequency distributions assuming no more maintenance or improvement after the end of the planning period the present value cost at the last planning stage t n for an infinite horizon problem is 4 c n δ x n x n e r n e r n 1 the scenario based cost c t δ x t x t a t s in this ddp approach depends on the flow frequency distributions and the probability distribution of hydrology scenarios at each time step t and the cost c t δ x t x t at each time step t is the expected cost weighted by the hydrology scenario probabilities p as similar to the probabilistic recursive function the expected cost at each time t is 5 c t δ x t x t s 1 m p a s c t δ x t x t a t s t 1 n the ultimate probability of a hydrology scenario is not necessarily equal to the initially projected probability of that hydrology scenario uncertainty exists in the nonstationary hydrology a stochastic dynamic programming model with a markov process sdp is developed to solve such uncertain nonstationarity by including the conditional probability p t a t s a t 1 that a hydrology scenario a t s is true at current stage given an observed hydrology scenario state a t 1 at the previous stage vicuna et al 2010 the decision stage decision variables and objective function are the same as the ddp model state variables include in addition to the infrastructure s state vector x t at the current stage the observed hydrology scenario at the previous stage a t 1 μ t 1 σ t 1 represented by observed mean μ t 1 and standard deviation σ t 1 of annual peak flood flows the backward recursive function for this sdp model becomes 6 f t δ x t x t a t 1 c n δ x n x n e r n e r n 1 t n c t δ x t x t s 1 m p t a t s a t 1 f t 1 x t 1 x t δ x t a t s t 1 n 1 the markov uncertainty p t a t s a t 1 adds the state variable a t 1 to the formulation compared to the ddp with constant hydrology scenario probabilities because the present hydrology scenarios are conditioned on those of the immediate past each possible past hydrology scenario state must be represented in the recursive function 7 f t 1 x t 1 x t δ x t a t s m i n δ x t 1 f t 1 δ x t 1 x t 1 x t δ x t a t s e r t 1 the observed hydrology scenario state at previous stage a t 1 μ t 1 σ t 1 affects the conditional probability p t a t s a t 1 of each hydrology scenrio a t s at the current stage using bayes theorem the probability that hydrology scenario a t s is true at current stage t given the observed scenario a t 1 at time t 1 is 8 p t a t s a t 1 p a s p t 1 a t 1 a t s p a t 1 p a s p t 1 a t 1 a t s s 1 m p a s p t 1 a t 1 a t s the cost function c t δ x t x t in this sdp model involving the bayes conditional probability is 9 c t δ x t x t s 1 m p t a t s a t 1 c t δ x t x t a t s t 1 n assuming no upgrades after the end of the planning horizon the present value cost at the last planning stage t n for an infinite horizon problem is the same as in eq 5 the optimal infrastructure design decisions and the estimated investment and cost are conditioned on both infrastructure state and the most recent observed hydrology scenario state by comparing the optimal results from the sdp formula eq 6 with uncertain nonstationarity and from the ddp formula eq 3 with known nonstationarity we can analyze the influence of uncertainty in hydrologic nonstationarity on long term infrastructure planning 4 application to risk based levee system planning as a numerical example a levee system planning problem is used to illustrate the application of the proposed models for different hydrologic situations fig 2 h is levee height bc is levee crown width α is land side slope angle and β is water side slope angle b is channel width w is total channel width to the toe of the levee d is channel depth below the levee toe τ is floodplain slope y is water depth calculated from river flow using manning s equation 4 1 model formulation for levee system planning for this problem levee height is the only decision variable and the levee cannot be degraded decision variables δ x t are the levee height increment δht at each stage in this example stage is the year in planning period state variables in the ddp model are the existing levee height at the beginning of the current stage ht while in the sdp model also include the observed hydrology scenario a t 1 represented by log normal distributed annual flood flow at the previous stage levee height increment existing levee height and the observed hydrology scenario are all discretized the overall objective is to minimize the summed discounted costs over the lifetime of the levee system the state cost function c t δ x t x t differs in the two models eqs 5 and 9 for a known nonstationary hydrology the cost function in the ddp includes averaged expected annual residual flood damage costs eadt δht ht as and levee building or upgrade costs cct δht ht under different hydrology scenarios with probabilities of each hydrology scenario p as eq 10a for an uncertain nonstationary hydrology the cost function in the sdp includes e a d t δ h t h t a t s and cct δht ht averaged by the conditional probability p t a t s a t 1 eq 10b when the levee system is upgraded δht 0 a fixed levee alteration cost is added to cct δht ht representing costs for regulating design consulting and organizing construction etc 10 c t δ h t h t s 1 m p a s ea d t δ h t h t a s c c t δ h t h t e r t a s 1 m p t a t s a t 1 ea d t δ h t h t a t s c c t δ h t h t e r t b levee flood failure could occur by overtopping when peak flow overtops the levee or by intermediate geotechnical non overtopping failure when peak flow rises between the toe and top of the levee such as through seepage levee failure hui et al 2016a the expected annual residual flood damage cost considering both overtopping and geotechnical non overtopping failures for known and uncertain nonstationarity is 11 ea d t δ h t h t a s ea d t δ h t h t a t s p q t s d t q t s q c min q c max δ h t h t p q t s d t q t s q c max δ h t h t p q t s d t q t s levee quality and performance are assumed constant over its lifetime levee deterioration affects the levee fragility curve and therefore the intermediate geotechnical non overtopping failure probability which can be addressed in a future study we assume that the intermediate geotechnical levee failure probability is a linear function of channeled water height in this example failure probability increases linearly from 0 at the toe to 1 at the top wolff 1997 perlea and ketchum 2011 levee building or upgrade costs include the materials management and purchasing land at every construction or upgrade stage 12 c c t δ h t h t 2 v t c adju st c soil l c t for t 1 t 1 2 t 1 3 t 1 cadjust is the soft cost multiplier for construction management and csoil is construction cost per unit material the total volume trapezoidal of upgrading levees along the entire length l of the river reach is v t l b c δ h t 1 2 1 t a n α 1 t a n β h t δ h t 2 h t 2 the cost for purchasing land on floodplains to upgrade the levees with a unit land cost uc the additional area of land occupied by a levee base abase is l c b a s e u c a b a s e u c l b c 1 t a n α 1 t a n β δ h t assuming no more upgrades after the end of the planning period the present value cost at the last planning stage t n for an infinite horizon problem is c n δ h n h n e r n e r n 1 4 2 model input and examined cases the decision horizon of the illustrative levee system plan is assumed to be n 200 years two types of planning strategies are analyzed and compared one time building planning and adaptive building and improvement planning for the latter type we analyze cases with shorter or longer planned adaptation year interval more or fewer adaptations allowed during the lifetime of the levee system after initial construction table 1 with the one time building strategy where t 200yr and nt 1 the levee system is built to an economically optimal height at the beginning and retains this height over its lifetime the adaptive planning strategy allows the levee system to be upgraded every t years after its first construction the number of adaptations upgrades refers only to upgrades after initial construction the input parameters for the example are roughly based on the cosumnes river in california table 2 we use a constant discount rate for simplification and ignore the uncertainty in this time dependent variable which is more uncertain in the long term degradation of the levee system over time is not considered six illustrative hydrology scenarios m 6 are used here for modeling long term plans and are assumed to cover the full range of possible scenarios since climate projections vary significantly with different climate model and input parameters we examined four hypothetical projected climate cases with different annual changing rates of mean μ1s and standard deviation σ1s of flood flow in each hydrology scenario and in each uncertainty case eq 1 the annual change rates of mean and standard deviation of flood flow in a corresponding normal distribution in climate case 1 are μ1s 0 0 2 0 4 0 6 0 8 1 and σ1s 0 0 2 0 4 0 6 0 8 1 for each hydrology scenario respectively climate case 2 has the same μ1s as in case 1 but higher σ1s σ1s 0 0 5 1 0 1 5 2 0 2 5 climate case 3 has higher μ1s and σ1s that are μ1s 0 0 5 1 0 1 5 2 0 2 5 and σ1s 0 0 5 1 0 1 5 2 0 2 5 climate case 4 has the same μ1s as in case 3 but higher σ1s σ1s 0 1 0 2 0 3 0 4 0 5 0 fig 1 c illustrates the variations of annual peak flow distributions over 200 years for climate case 1 because the log values of annual flood flow follow a normal distribution the corresponding log normal distributions change slightly over time with the hypothetical changing means and standard deviations in the four climate cases fig 3 plots the annual peak flow distributions in 200 year for each forecasted hydrology scenario in each hypothetical climate case in climate case 1 and case 2 the mean of the annual flood flow s natural logarithm is increasing from hydrology scenario 1 to 6 and it increases more in climate case 3 and case 4 the standard deviation of the annual flood flow s natural logarithm is the same for each hydrology scenario in climate case 1 and case 3 as the annual changing rates of mean and standard deviation in the corresponding normal distribution are the same while it is increasing from hydrology scenario 1 to 6 in climate case 2 and case 4 as the changing rate of standard deviation in the normal distribution exceeds that of the mean the long term levee system plan is modeled and compared for the four hypothetical nonstationary climate cases the initial probabilities of the six hydrology scenarios are equally 1 6 such probabilities will be constant during the entire planning period in the assumed known nonstationary hydrology the bayes conditional true probability of each hydrology scenario in the assumed uncertain nonstationary hydrology is updated in each following stage based on the observed previous hydrology scenario represented by the mean and standard deviation of annual flood flow distribution the bayesian probabilities at stage 50 100 150 and 200 for the 6 hydrology scenarios in climate case 1 are plotted in fig 4 early stages have fewer variations of hydrology scenario probabilities for observed previous scenarios as time goes on the probability of a hydrology scenario when observing a similar scenario at previous stage is much higher than when the previous observed scenario is rather different at stage 200 the probability of a current hydrology scenario 1 when observing scenario 1 at previous stage is almost 30 times more than observing scenario 6 and is reciprocal for a current hydrology scenario 6 the probability of a current hydrology scenario 3 or 4 when observing scenario 1 or 6 is smaller than observing other scenarios over time observed hydrology improves estimation of future hydrology with nonstationarity given the assumption that long term hydrology conditions are probabilistic 5 results and discussion this section presents and discusses results insightful for three comparative situations 1 one time versus annual adaptive building planning for the four hypothetical climate cases with the ddp and the sdp model respectively 2 detailed discussion of results for climate case 1 including comparison of levee system planning with the ddp and the sdp models for annual adaptive building planning strategy the advantages of adaptive plan illustrated by various planning strategies with the ddp model and impacts from a fixed cost for levee upgrades 3 comparison of results from the ddp and the sdp models and applying the ddp results to the sdp model to show the advantage of planning for an uncertain nonstationary hydrology 5 1 optimal levee system planning summary different frequencies of planned levee upgrades adaptations with the four climate cases for a known nonstationary hydrology were modeled using the ddp and for an uncertain nonstationary hydrology using the sdp table 3 summarizes the main results from model runs with a one time building planning strategy and an annual adaptive building planning strategy that allows levee system upgrades every year during the 200 year planning horizon resulting levee heights from the sdp in later stage can differ for existing levee height and observed previous hydrology scenario so with adaptive building strategy there exists a range of possible final levee height at stage 200 the optimized present value cost for the sdp method m i n f 1 δ x 1 x 1 is the weighted average cost added up through the backward recursion which does not differ for varying possible levee heights at later stages with the one time building plan the levee is built to an optimized height at the first stage and remains at that height for the entire planning horizon with the annual adaptive building plan the levee is built slightly lower at the first stage compared to the one time building plan but is upgraded continuously to a much higher height at the ending 200 year stage allowing annual adaptation is always less costly than not allowing adaptation for every climate case and either method the ddp approach weights each projected hydrology scenario with a constant probability while the sdp approach weighs each scenario with an updated probability as more hydrologic observations are available since the expected cost weighted average cost of all possible hydrology scenarios of the sdp and the ddp depends on the time varying bayes conditional probability and scenario based cost the overall present value cost of the sdp solution differs slightly from using the ddp in each climate case with any planning strategy the sdp solution has slightly lower overall cost in climate case 2 and case 4 where both mean and standard deviation of the log transformed annual flood flow increase faster over time the ddp solution has slightly lower overall cost in climate case 1 and case 3 where standard deviation of the annual flood flow is constant and the mean is increasing lower overall cost for each comparison case is bolded in table 3 compared to planning in the assumed stationary climate case optimal present value cost and initial and final levee heights all increase for assumed nonstationary climate cases as climates possibly become severe later discussion shows the economic disadvantage of applying planning decisions from assumed known nonstationary ddp models to an actual uncertain nonstationary hydrology modeled by the sdp for this study example with any climate case model results show that annual adaptive building slightly reduces the overall present value cost but more substantially alters the planning decisions especially in future years table 3 and the results are similar for the other planning horizon intervals as well overall costs vary little with adaptation frequency adaptive planning has little advantage compared to one time building planning from an economic present value perspective but becomes more reliable given the similar economically optimal present value and much higher levees in the future the adaptive system levees are lower when flood events are less extreme and rise gradually with increased extreme floods 5 2 optimal levee system planning for climate case 1 5 2 1 ddp and sdp comparison for annual adaptive building strategy to illustrate the detailed levee system planning decisions fig 5 plots the optimal sdp model results in climate case 1 over a 200 year planning horizon for observed hydrology scenario 1 3 and 6 at previous stage t 1 given different existing levee heights with annual adaptation allowed the mean and standard deviation of annual flood flow in the stationary hydrology scenario 1 are constant over the planning horizon the small annual change in the rates of mean and standard deviation of flood flow in hydrology scenario 3 indicate an increasing chance of larger annual peak flood flows over time the more extreme hydrology scenario 6 has even higher annual change rates of mean and standard deviation of flood flow representing a significantly increasing chance of extremely larger annual peak flood flows compared to hydrology scenario 3 the blue line on each graph in fig 5 is the optimal levee system planning strategy from the ddp model results for comparison each marker point on the graphs represents a resulting upgraded height at a stage given the possible existing heights for an observed hydrology scenario at the previous stage for instance the upper graph in fig 5 presents all possible resulting upgraded levee heights at each stage t if observing hydrology scenario 1 at previous stage t 1 given possible existing heights different existing levee heights at a stage may correspond to a same upgraded height shown as one marker point on the graphs at early stages levee height upgrades are the same for any observed hydrology scenario at later stages upgraded levee heights often differ with observed hydrology scenarios the range of possible levee heights expands with time as more hydrologic observations are obtained the optimal levee system planning strategy from the ddp model results with known nonstationary hydrology is to build the levee system at 7 7 m at the beginning stage 1 and increase the levees to 8 6 m at stage 63 and again to 9 4 m at stage 153 blue line in fig 5 initial levee height at stage 1 with the sdp model is the same at 7 7 m while the first upgrade adaptation to 8 6 m occurs earlier at stage 60 when observing hydrology scenario 6 and a wide range of upgrade options become available later in later upgrade stages the sdp results with uncertain nonstationary hydrology have more levee height planning options given different hydrologic observations and different existing levee heights and the sdp results have higher levees than those averaged from the ddp by frequencies of upgraded heights fig 5 the maximum optimal levee heights with the sdp are driven by observation of the more severe hydrology scenarios and are much higher than that with the ddp at the ending stages observation of more extreme peak flow conditions brings higher levee upgrades for instance observing hydrology scenario 6 leads to higher levee upgrades than observing hydrology scenario 1 if the stationary hydrology scenario 1 continues to be observed levee heights remain at initial levels however levees are raised from existing heights in some stages if hydrology scenarios 3 or 6 are observed the range of differences among forecasted hydrology scenarios and the economic discount rate both affect optimal planning decisions given observed hydrology scenarios optimal levee height is usually the same across diverse observed scenarios in the early planning stages fig 5 especially when hydrology scenarios differ slightly and discounting homogenizes effects of future changes as time goes on the mean and standard deviation of annual flood flows diverge progressively leading optimal levee heights to diverge in later planning stages the optimal levee height for observed hydrology scenario 6 starts to differ from other hydrology scenarios at stage 60 and differences across hydrology scenarios grow in later stages the minimum optimal levee height with the observed hydrology scenario 1 is less than that with the observed more severe hydrology scenario 6 at any stage the optimal upgraded heights at later stages change with observed previous hydrology scenarios fig 5 economically optimal planning balances the cost from annual expected residual damage and construction at each stage and over the entire planning period in later upgrade stages the more frequent and severe floods increase the expected annual damage cost and then have less indirect impacts on construction cost due to balancing of costs overall differences in damage costs for various hydrology scenarios are partially offset by the discount rate 5 2 2 advantages of adaptive planning adaptive planning allows adjustments to a changing and uncertain climate as more hydrologic observations are available with any adaptive planning strategy the levee will be built and upgraded periodically to a greater height than the one time building plan here 7 8 m for example with one adaptation the levee system is built to 7 8 m at the first stage then raised to 9 0 m with observed hydrology scenarios 1 2 or 3 and to 9 1 m with the observed hydrology scenarios 4 5 or 6 at the upgrading stage 100 year variations of optimal levee system heights for different observed hydrology scenarios increase with the opportunities for adaptions as more adaptations are planned the maximum eventual upgraded height increases and the range of eventual upgraded heights widens fig 6 shows the adaptive levee system planning strategies assuming a known nonstationary hydrology for different adaption year intervals with the ddp model planning cases with more adaptions allowed having a lower initial levee height and a higher final levee height optimal levee height decisions cross for different planning cases over intermediate stages due to varying hydrology scenarios and discount rate with a changing climate levees are upgraded economically with every opportunity unless fixed costs are large fewer upgrading opportunities increases individual upgrade heights more frequent upgrades allow the levee system to adapt to the changing nonstationary hydrology gradually and economically as the planning cases with shorter upgrade intervals show 5 2 3 fixed levee upgrade cost effects the fixed cost for upgrading the levee also affects optimal levee planning decisions levee upgrades occur only when the expected reduced flood damage cost exceeds the upgrade cost which is the construction cost including a fixed levee upgrade cost for the annual adaptive plan levee can be upgraded every year optimal levee heights from the sdp model with a 0 5 million fixed levee alteration cost start to diverge from stage 60 given different observed hydrology scenarios if the fixed levee alteration cost is doubled to 1 million optimal levee heights are the same for different observed hydrology scenarios until stage 86 the overall present value cost increases slightly with doubled fixed levee alteration cost 110 35 million compared to 109 81 million the optimal initial levee height also rises slightly 7 8 m compared to 7 7 m and the final upgraded levee heights both end at 10 m 5 3 advantages of modeling for uncertain nonstationary hydrology the sdp considering uncertainty in a nonstationary hydrology has little overall cost advantage compared to the ddp as the cost in each hydrology scenario contributes to the averaged overall cost table 3 the overall present value cost with the sdp model is less than that with the ddp model when mean and standard deviation of the log transformed annual flood flow increase from hydrology scenario 1 to 6 over time the sdp uses an increasingly reliable projected climate updated over time with the available hydrologic observations the probability of future severe hydrology scenarios in the sdp model would increase based on the observed more severe hydrology scenarios leading to a higher expected annual residual damage cost the sdp model provides a different levee height trajectory for each observed hydrology scenario in the long term the ddp model provides only one levee height trajectory the final levee heights from the sdp model are no lower than the final levee height from the ddp model in all planning cases optimal levee plans made with a known nonstationary hydrology may not be economically efficient for the more likely uncertain nonstationary hydrology implementing the known nonstationary hydrology plan under the alternative uncertain nonstationary hydrology may under design or over design with additional regret costs kang and lansey 2012 table 4 compares the overall present costs from the sdp model the ddp model and applying the optimal levee heights plan from the ddp model assuming known nonstationary hydrology to the sdp model in an uncertain nonstationary hydrology for each climate case with different planning strategies when applying the ddp optimal levee heights to the sdp model for each case the optimal levee system planning decisions assuming known nonstationary hydrology has poorer economic performance in the uncertain nonstationary hydrology with updated conditional probabilities of hydrology scenarios table 4 for any climate case with each planning strategy the overall present value cost of applying the optimal levee planning decisions from the ddp model to the sdp model exceeds that of the ddp or the sdp by 11 13 table 4 similar to the overall cost from the sdp and the ddp models such an overall cost decreases slightly with the increase in adaption frequency and in some cases the differences of overall present values among various planning strategies are too insignificant to determine bolded numbers in table 4 particularly in climate case 2 and case 4 where both mean and standard deviation of the annual flood flow increase in the most severe hydrology scenario 6 applying the optimal ddp model plan to the sdp model results in a significantly higher overall cost plans from the sdp model have better performance for severe hydrology scenarios and overall better reflect the long term climate change projections 6 conclusions a risk based stochastic dynamic programming model with a markov process can incorporate uncertain nonstationary hydrology explicitly into long term water infrastructure planning this study developed an explicit risk based stochastic dynamic programming model with a markov process for long term water infrastructure planning affected by uncertainty in nonstationary hydrology uncertain nonstationary hydrology is represented by several projected hydrology scenarios with time varying statistical properties and the probability of each projected hydrology scenario is updated by bayes theorem based on ongoing hydrologic observations the approach can support adaptive planning to improve reliability and economic performance the sdp model that accounts for uncertainty in nonstationary hydrology shows little economic advantage compared to the ddp model with known nonstationarity however the sdp better represents reality and provides different height options especially in later years when the sdp performs better than the ddp for more severe hydrology scenarios for the studied numerical example of a levee system planning problem the economic advantage of the sdp model compared to the ddp model depends on the changing rates of peak flow distribution parameters in a projected climate the sdp model generally provides more flood protection reliability with little increase in the overall present cost the optimal levee planning strategy resulted from the ddp model assuming a known nonstationary hydrology has much poorer economic performance in the sdp model that assumes uncertain nonstationary hydrology with updated conditional probabilities of hydrology scenarios the changing climate extremes inflation adjusted discounting fixed levee upgrade cost and balances between expected annual residual damage cost and construction cost affect the differences in optimal levee heights for observed hydrology scenarios adaptive water infrastructure plans with nonstationary hydrology have advantages for long term planning in light of the various plausible future hydrology conditions a long term water infrastructure plan should be able to adapt to changes as new information becomes available adaptive planning with more upgrade opportunities is preferable to one time construction planning or adaptive planning with few upgrade opportunities in terms of cost and reliability under known or uncertain nonstationary hydrologies although adaptive plans have little advantage with respect to the net present overall economic cost the strategies are valuable for financial planning especially in the long term when severe hydrology scenarios could require additional investments lower levee heights at early stages result in less construction and total annualized cost that alleviate the near term financial burden higher levee heights at later stages add little to the overall present value costs but provide better protection for severe floods the importance of considering nonstationarity and the uncertainty of nonstationarity depends on the magnitude of uncertainty in the nonstationary hydrology with less variation and uncertainty in the future climate projections long term infrastructure planning for uncertain nonstationary hydrology may not be worthwhile for capital investment assuming deterministic nonstationarity might be sufficient if future climate conditions remain close to historical conditions discount rate damage potential uncertainty and hydraulic uncertainty such as manning s coefficient could have larger impacts yet it is substantially better to model uncertain nonstationarity for capital investment and infrastructure planning when the future climate has great uncertainty the reliability of infrastructure can be heavily affected by uncertainty in nonstationary hydrology this study has limitations in the simplified hydrology scenarios represented by varying mean and standard deviation of annual flow distribution and the linear changing trends in the mean and standard deviation streamflow ensembles generated by a general circulation model combined with a representative concentration pathway van vuuren et al 2011 stocker 2014 could be used to refine plausible ranges of future hydrology scenarios future work can examine changes in the levee system levee setback decisions zhu and lund 2009 and levee deterioration in the long term a theoretical study can examine how the changing rates of peak flow distribution parameters in a projected climate affect the ddp and the sdp model results as guidance for choosing between these models the proposed model in this study only analyzes uncertainty in hydrology while economic uncertainty also has large impacts for planning zhu et al 2007 uncertainty in the development of the adjacent floodplain such as urbanization can also be analyzed in future studies 
799,quantification of the predictive uncertainty of subsurface models has long been investigated the traditional workflow is to calibrate prior models to match observed data and then use the posterior models to simulate future system performance not only are these procedures computationally expensive but they also have issues in maintaining geological model constraints during the calibration step data space inversion dsi was introduced recently to predict future system performance without the iterative history matching or model calibration step in general dsi approaches seek to establish a statistical relationship between the observed and forecast variables as well as to quantify the predictive uncertainty of the forecast variables by using an ensemble of uncalibrated prior models existing dsi approaches all require a number of complex transformation and mapping operations which may deter their widespread use in this study we introduce a new and simpler dsi approach the learning based data driven forecast approach ldfa by combining dimension reduction and machine learning techniques to quickly provide accurate forecast results and reliably quantify corresponding uncertainty in the results our ldfa framework is demonstrated using two supervised learning algorithms artificial neural network ann and support vector regression svr on two representative examples from reservoir engineering and geological carbon storage results suggest that our approach provides accurate forecast results e g future oil production rate or cumulative injected co2 and reasonable predictive uncertainty intervals our framework is generic and may be applied to other surface and subsurface problems keywords machine learning artificial neural network support vector regression data space inversion future reservoir performance data driven forecast nomenclature d in matrix of data vectors of all prior models for τ 1 τ 2 τ n τ d out matrix of data vectors of all prior models for t 1 t 2 t n t d in ensemble mean vector of d in d out ensemble mean vector of d out ε measurement error vector d obs observed data vector d t i l data vector at ti for the lth prior model g forward simulation operator for m h operator matrix for extraction of the simulation results corresponding to the observation time steps from d out l learning model λ eigenvalue m matrix of prior model parameters m l vector of the lth prior model s parameters nd size of d l ne number of prior models nin number of chosen principal directions of d in nobs size of d obs nout number of chosen principal directions of d out nt number of times of interest n τ number of observation times s singular value t 1 t 2 t n t forecast times τ 1 τ 2 τ n τ observation times w in matrix of chosen principal directions of d in w out matrix of chosen principal directions of d out x in score matrix corresponding to nin principal directions x out score matrix corresponding to nout principal directions 1 introduction prediction of the long term performance of subsurface systems e g geological carbon sequestration repositories waste water disposal aquifers nuclear waste repositories and oil and gas reservoirs is a perpetual research theme in the fields of energy exploration groundwater management and contaminant risk assessment to obtain reliable predictions of a system s future performance the conventional workflow is to first calibrate the system model to match historical data by using either deterministic or statistical inversion approaches oliver et al 2008 oliver and chen 2011 sun and sun 2015 zhou et al 2014 depending on the dimension of parameter space and the actual inversion approach used such history matching process may require a large number of forward simulation runs to minimize the discrepancy between simulated and observed data note in the remainder of the text we shall use the terms history matching inversion and model calibration interchangeably additional forward simulation runs are then needed to propagate uncertainty of system inputs to arrive at predictions of the system s future performance this model space based history matching and uncertainty quantification workflow is computationally expensive for large scale systems even with the use of dimension reduction and model reduction techniques antoulas 2005 frangos et al 2010 recently several approaches originated from the weather forecast literature krishnamurti et al 2000 mallet et al 2009 pagowski et al 2005 were applied to enable the direct forecast of future reservoir performance in observable data space without using the aforementioned workflow satija and caers 2015 scheidt et al 2015 sun and durlofsky 2017 this emerging area of research focusing more on data space inversion dsi using data and ensemble simulation techniques represents a departure from the aforementioned conventional workflow scheidt et al 2015 proposed a prediction focused analysis pfa that assesses the uncertainty of future reservoir performance in the feature space i e dimension reduction space of historical and forecast data which is obtained by using nonlinear principal component analysis however in pfa a kernel smoothing algorithm that is used to generate the distributions of historical and forecast data in the feature space is only appropriate for low dimensional feature spaces sun and durlofsky 2017 satija et al 2017 introduced a generalized least squares approach that forecasts future reservoir performance by maximizing the gaussian likelihood between historical and forecast data in the feature space however this approach may give unsatisfactory results unless the relationship between dimension reduced forecast and observed data is sufficiently linear so that linear regression is appropriate sun and durlofsky 2017 to circumvent this issue satija et al 2017 proposed a linearizing operation using canonical correlation analysis so that the transformed components are maximally correlated sun and durlofsky 2017 suggested a new dsi procedure in which the full data space is defined as the space of all possible types of well production data variables that are collected not only during the history matching period but also during the forecast period the observed data thus represent a subset of the full data space the authors then used a bayesian framework to derive the posterior probability distribution of the full data space conditional to the observed data in essence the problem becomes estimating an underlying generative model for the data space however in their formulation non gaussian data variables need to be converted to gaussian variables using complicated mapping operations before forecasting besides in order to obtain satisfactory forecast results they only selected prior models whose simulated responses are close to observed ones thus enabling a better representation of the region of interest in data space the patterns of the responses that the excluded prior models exhibit are ignored in forecasting in this work we propose a learning based data driven forecast approach ldfa which further simplifies the dsi process by leveraging established machine learning methods in ldfa machine learning algorithms are used to build a learning model that forecasts future reservoir performance given historical and forecast data in particular two well established machine learning algorithms artificial neural network ann and support vector regression svr are adopted unlike the aforementioned approaches our method can be applied to data that have nonlinear patterns in high dimensional feature space and it does not require selective sampling of prior data namely the preselection step in existing dsi approaches because ann and svr are already available in many open source and commercial software packages implementation of ldfa using either ann or svr i e ldfa ann and ldfa svr is relatively straightforward compared to the previous works done by scheidt et al 2015 satija et al 2017 satija and caers 2015 and sun and durlofsky 2017 who all used custom mapping and transformation techniques ann is a biologically inspired computational network model that has been developed to create artificial intelligence zurada 1992 ann has gained tremendous success since its introduction improvements in ann algorithms e g mitigation of overfitting issue and introduction of newer activation functions in the recent decade have led to the arrival of the deep learning era with the appearance of many deep neural network model structures involving a large number of hidden layers and unknowns hinton et al 2006 because of the nature of this work all of our ann models have relatively shallow structures svr is based on support vector machine svm which is widely used in various pattern recognition and regression problems vapnik 1995 svr gives the nonparametric regression function that reproduces observations within a specified margin and other constraints such as flatness in the nonlinear feature space smola and schölkopf 2004 we emphasize that dsi methods are different from many traditional surrogate modeling applications that use machine learning methods for example sun et al 2015 used ann to develop a surrogate watershed pollutant loading model recently xu et al 2017 presented an error explicit bayesian method for developing surrogate groundwater models using random forests and svr and for quantifying predictive uncertainty these previous studies typically sought to link the model input parameters and model outputs at a small number of observation points rather than forecasting the entire model space the paper is organized as follows in the next section we introduce the methodologies behind ldfa ann and ldfa svr then the performance of ldfa ann and ldfa svr is demonstrated in forecasting future reservoir performance using a the brugge model which is a well known benchmark problem in reservoir engineering peters et al 2010 and b a synthetic geological carbon storage gcs model in the examples we investigate how the forecast performance of ldfa ann and ldfa svr is affected by the design of the neural network such as the number of neural layers activation function types and the choice of different kernel functions 2 methodology the traditional work flow of forecasting future reservoir performance can be summarized as follows 1 build prior models stochastically honoring given static data such as well log data core data and geological constraints 2 conduct forward simulations in the prior models 3 calibrate the prior models so that the simulated responses of the prior models are matched to observed ones 4 forecast the future reservoir performance by conducting forward simulations in the calibrated models up to the future time thousands of forward simulation runs may be required in step 3 of the above to find models that reproduce the observed data however ldfa does not need the computationally expensive calibration step step 3 in the traditional work flow for predicting the future reservoir performance ldfa predicts the future reservoir performance after the observation time using the data driven relation between the reservoir performance before and after the observation time of the prior models therefore once the data driven relation is constructed ldfa can forecast the future reservoir performance quickly without requiring the change of reservoir model parameters as shown in fig 1 ldfa consists of four main steps i e generation of training data reparameterization learning forecasting and ten substeps first of all training data are generated by conducting flow simulations using an ensemble of prior models the training data are reparameterized using principal component analysis pca to reduce the data dimension because training becomes faster and easier as the data dimension is lowered ann and svr are used to build a learning model that reproduces the dimension reduced training data once observed data become available the future reservoir performance i e after the last observation time is forecast using the learning model the details of the substeps in each main step are given in the following sections 2 1 generation of training data an ensemble of prior models honoring prior data such as geological data core data and well logging data are built to generate training data that are used to forecast future reservoir performance let us denote the ensemble and an individual model of the ensemble as m and m respectively 1 m m 1 m 2 m n e where ne is the number of prior models in m then flow simulation runs are conducted in the ensemble models 2 g m l d l d t 1 l t d t 2 l t d t n t l t t l 1 2 n e where t represent a forecast time and nt is the total number of forecast times g returns a vector of forward simulation results for the forecast times t 1 t 2 t n t d t i l is a vector of data variables such as flow rates bottom hole pressure and fluid saturation at ti for the lth ensemble model the simulation results corresponding to observation and forecast times are used as input and output data for training see fig 1 where the set of observation times is a subset of forecast times 3 d o b s d τ 1 o b s t d τ 2 o b s t d τ n τ o b s t t τ 1 τ 2 τ n τ t 1 t 2 t n t 4 d o u t g m 1 g m 2 g m n e 5 d i n h d o u t d τ 1 1 d τ 1 2 d τ 1 n e d τ 2 1 d τ 2 2 d τ 2 n e d τ n τ 1 d τ n τ 2 d τ n τ n e where τ and n τ represent the observation time and the total number of observation times d τ i o b s is an observation vector of the data variables at τ i where d t i l and d τ i o b s have the same dimension h is a matrix for extracting the simulation results corresponding to the observation times from d out which is the matrix of the simulation results for all the prior models d in and d out are used as input and output data for training a learning model 2 2 reparameterization using pca computational costs associated with ann and svr depend on various factors such as the dimension of the input and output data the size of available training data sets the number of validation groups and so on in 5 if the dimensions of d in and d out are large it is hard to optimize a learning model for d in and d out thus the dimensions of d i n r n o b s n e and d o u t r n d n e are first reduced where nobs and nd represent the dimensions of d obs and d l respectively among numerous dimension reduction techniques cunningham 2008 fodor 2002 maaten et al 2009 pca is chosen in this study for its optimal compression power in l2 norm jolliffe 2002 pca uses an orthogonal transformation to transform the original input space with possibly correlated structure into a new space i e feature space of no linear correlation by doing so the basis in the new space becomes orthogonal to each other and variables are ordered in terms of their variances in the original space because only a few variables latent variables in the new space account for the most variability in the input data in many cases pca can reduce the number of variables in the training data greatly without much loss of accuracy resulting low dimensional data sets that can be trained effectively in ldfa in pca principal directions are eigenvectors of the covariance matrix of data the data dimension can be reduced by choosing eigenvectors corresponding to dominant eigenvalues we compute eigenvectors and eigenvalues of a covariance matrix using singular value decomposition svd 6 d i n d i n u i n i n v i n t 7 d i n 1 n e j 1 n e h g m j 8 d o u t d o u t u o u t o u t v o u t t 9 d o u t 1 n e j 1 n e g m j where u in and u out are nobs nobs and nd nd unitary matrixes respectively d i n and d o u t are ensemble mean vectors of d i n and d o u t for detrending respectively the columns of u in and u out are principal directions of d in and d out in and out are nobs ne and nd ne diagonal matrices where the diagonal elements are the descending nonnegative singular values s i in and s i out of d i n d i n and d o u t d o u t the maximum number of nonnegative singular values in d i n d i n and d o u t d o u t are min nobs ne 1 and min nd ne 1 respectively the eigenvalues λ i of the covariance matrixes of d in and d out are given by 10 λ i i n s i i n 2 min n o b s n e 1 11 λ i o u t s i o u t 2 min n d n e 1 v in and v out are ne ne unitary matrixes the rows of i n v i n t and o u t v o u t t are the principal component scores for the corresponding principal directions only nin and nout principal directions are retained to reduce the dimensions of d in and d out nin and nout are determined using an energy criterion of eigenvalues cardoso et al 2009 sun and durlofsky 2017 the energies for the largest nin and nout eigenvalues are given by 12 e n i n i 1 n i n λ i i n i 1 min n o b s n e 1 λ i i n 13 e n o u t i 1 n o u t λ i o u t i 1 min n d n e 1 λ i o u t where nin and nout principal directions are chosen using predetermined e n i n and e n o u t nin and nout principal directions in u in and u out are denoted as w in and w out the score matrixes corresponding to nin and nout principal directions are denoted as x in and x out i e d i n d i n w i n x i n and d o u t d o u t w o u t x o u t the dimensions of d in and d out are reduced to nin and nout by projecting d in and d out onto the feature space formed by the nin and nout principal directions x in and x out are used as input and output data for training a learning model l the reparameterization is useful to save the computational cost of the ann and svr model construction but d in and d out do not need to be reparameterized if the dimensions of d in and d out are already low enough for example lower than five by rule of thumb 2 3 machine learning 2 3 1 artificial neural network ann builds a black box model that replicates given training data by optimizing weights and biases of a neural network the multi layer feedforward network shown in fig 2 has d 1 neural layers network depth and the d th neural layer has nd neurons network width where the superscript indicates the index of a neural layer as a neural network becomes deeper and wider the neural network can replicate more complicated functions however appropriate numbers of neural layers and neurons on each neural layer should be chosen carefully because of the computational cost and underfitting or overfitting problems heaton 2008 a neuron consists of three parameters weights a bias term and an activation function which are denoted as w b and f in fig 2 respectively the basic function of a neuron is to receive input signals from the previous neural layer make an output signal using the three neuron parameters and send the output signal to the next neural layer in fig 2 x in i represents the ith element of input signal or data nin and nd are the dimension of input signal and the number of neurons in the dth neural layer the zeroth and the dth layer represent the input and output layers respectively w d i j represents the weight for the ith neuron of the d 1 th neural layer and the jth neuron of the dth neural layer b d j represents the bias of the jth neuron in the dth neural layer v d j b d j i 1 n d 1 w d i j y d 1 i where y d 1 i represents the output signal of the ith neuron on the d 1 th neural layer and y 0 i equals to x in i in fig 2 f d represents the activation function of the dth neural layer y d j f d v d j a neural network model cannot reproduce the nonlinear relation between input and output data using only linear operators with weights and biases activation functions such as the symmetric saturating linear function rectified linear units relu sigmoid hyperbolic tangent radial basis functions are necessary to make the neural network model learn the nonlinearity between input and output data fig 3 shows typical activation functions for neurons an appropriate activation function or a set of different activation functions should be used on the basis of the relation between input and output data the activation function of an output neural layer for regression is commonly a linear function the first input data and final output data xin and yd correspond to column vectors of x in and x out in the reparameterization step respectively the weight w and bias b of each neuron are optimized to minimize the mean squared error between target output x out and the learning model s prediction l x i n there are various optimization algorithms for finding weights and biases in a neural model such as levenberg marquardt algorithm gradient descent method stochastic gradient descent method newton s method quasi newton method and conjugate gradient method yu and wilamowski 2011 once observed data become available the reparameterized observed data are provided as inputs to the learning model l to obtain reparameterized output data a final prediction is obtained by back transforming the reparameterized output data using eq 17 which is given in section 2 4 below 2 3 2 support vector regression svr can also be used to build a learning model to forecast future reservoir performance however unlike ldfa ann that handles multiple outputs multiple svr models are established to forecast output data variables separately a linear support vector regression problem is given as 14 f i x i n x i n t w i b i i 1 2 n o u t 15 w i b i arg min w i 1 2 w i 2 2 s t x o u t i f i x i n ɛ f o r i i 1 2 n o u t where i is the index of a dimension reduced output data variable w and b are a coefficient vector and a bias vector for the support vector regression model respectively w and b corresponding each output variable should be obtained through training the constraints in eq 15 require that the deviation of f i x i n from x out i be less than ε however f i x i n satisfying the constraints for all the input data may not exist cortes and vapnik 1995 introduced the primal formula to avoid the infeasible constraint in this study we use the lagrange dual formulation vapnik 1995 to solve the simplified primal problem efficiently with kernel functions such as linear polynomial and radial basis function kernels smola and schölkopf 2004 2 4 forecasting once a learning model is constructed observed data can be incorporated to predict future reservoir performance observed data should be projected onto the input space of a learning model 16 x o b s w i n t d o b s d i n 17 d e s t w o u t l x o b s d o u t where as discussed in the reparameterization step w in and w out are the chosen principal directions of the centered d in and d out respectively in eq 16 x obs is a projection of d obs onto the dimension reduced space for d in formed by w in l is a learning model function of a data vector in the dimension reduced space for d in because l returns a data vector in the dimension reduced space for d out l x o b s is back transformed to d est which is the forecast result for d obs using eq 17 2 5 quantification of uncertainty in forecast results in practice observed data are contaminated by measurement errors the uncertainty incurred by measurement errors can be quantified using the randomized maximum likelihood method i e parametric bootstrapping kitanidis 1986 oliver 1996 in the flow chart of ldfa shown in fig 1 we quantify the predictive uncertainty in d est by adding gaussian random errors to d obs in the step 8 as given in eq 18 and repeating the steps 8 through 10 sun and durlofsky 2017 18 x o b s w i n t d o b s ɛ d i n where ε represents the measurement error vector related to d obs for example if 500 forecasts are repeated for quantification of uncertainty different d est is obtained in every forecast because different errors are added to d obs in eq 18 the uncertainty of the forecasting result can then be quantified using the ensemble of 500 sets of d est 3 numerical examples 3 1 brugge benchmark model in the first example we apply ldfa to the brugge benchmark model peters et al 2010 the brugge benchmark model was developed to test different waterflooding optimization and history matching methods by the netherlands organization for applied scientific research tno the size of the brugge model is approximately 17 km 9 km 60 m which is discretized into 139 48 9 grid blocks fig 4 shows the top depth and locations of 10 injectors and 20 producers where p9 is operated at a constant pressure of 725 5 psi and the other producers and injectors are operated at liquid flow rates about 2000 bbl day and a constant water injection rate 4000 bbl day the wells are opened at different dates the brugge model has four formations namely schelde maas waal and schie from the top to bottom the four formations have different distributions of rock facies porosity permeability and net to gross ntg the injection and production histories of 10 injectors and 20 producers during 10 years are included in the brugge model tno provides 104 realizations of geological models with the same fault topology and grid geometry but different rock facies porosity permeability net to gross ntg and water saturation fig 5 shows three typical realizations among the 104 ones that are generated using different geological features and geostatistical techniques realization 1 shown in fig 5 a is a gaussian random field generated without rock facies simulation the rock facies of realizations 28 and 66 shown in fig 5 b and 5 c are generated using fluvial channel object modeling and sequential indicator simulation respectively the 104 realizations are then simulated using a black oil reservoir simulator cmg imex cmg 2015a ldfa is tested by choosing one realization from the set of 104 realizations as a true model well responses at each well including bottom hole pressure oil production rate water production rate and field responses including total oil production and total water production are observed at eight dates τ1 τ2 τ8 16 151 301 451 580 703 852 1004 days during 10 years from the simulation results of the true model gaussian random noises having a standard deviation 1 of the true responses are added to the true responses to generate observed data the simulation results of the remaining 103 realizations are used as training data to build a learning model the input data for training are well responses at the eight dates τ1 τ2 τ8 the output data for training are well responses at the 498 dates during the 10 years including the observation times τ1 τ2 τ8 where t 10 τ1 t 30 τ2 t 50 τ3 t 70 τ4 t 90 τ5 t 110 τ6 t 130 τ7 and t 150 τ8 before training learning models the dimension of the training data is reduced by choosing principal directions or eigenvectors with e n i n and e n o u t 0 999 as in eqs 12 and 13 the chosen principal directions are used to reduce the dimension of the observed data and back transform the dimension reduced output data five sets of activation functions are tested and their names are listed in table 1 the width of a single hidden layer except ann radbas tansig is max nin nout ann radbas tansig has two hidden layers and they have hyperbolic tangent and radial basis activation functions respectively ann radbas tansig had an overfitting problem when the width of the two hidden layers is max nin nout we determined the width of the hidden layers for ann radbas tansig according to heaton 2008 who suggested that the number of hidden neurons should be 2 3 n i n n o u t we use bayesian regularization backpropagation implemented in matlab for optimization of a neural network that finds optimal regularization parameters of the levenberg marquardt algorithm beale et al 2017 foresee and hagan 1997 mackay 1992 pan et al 2013 we use the ls svm matlab toolbox brabanter et al 2011 for svr as discussed in the methodology section the svr models are built separately for each dimension of the dimension reduced output data for training nout in other words each svr model is used to forecast each variable of the dimension reduced output data the results of three different kernel functions linear polynomial and radial basis kernel functions are compared and their names are provided in table 1 we compare the performance of ann and svr models listed in table 1 by choosing each geological model as a true model among the 104 ones which is essentially a leave one out cross validation test ldfa ann and ldfa svr take a few seconds to finish forecasting for each true model thus ldfa can avoid the high computational cost required by the conventional forecasting methods for simulating future reservoir performance using posterior reservoir models the forecast performance is measured using the median relative error defined by 19 median relative error medi an 1 n t i 1 n t d i j d i true d i true for j 1 n e which is the median of the average of the relative errors over all times the median relative errors for different ann and svr models are given in table 2 several production well responses are excluded in table 2 because the prior models have almost the same production well responses over the observation times considering the noise level 1 of the observed data the accuracies of the ann and svr models having on average 3 7 of median relative error are acceptable however the neural network models using nonlinear activation functions and svr models using nonlinear kernel functions provide more accurate forecasts than those using linear activation and kernel functions although overall ann tansig and ann radbas give the most accurate and the most stable forecasts the differences between the accuracies of ann tansig ann radbas ann radbas tansig svr pol svr rbf are insignificant we discuss the nonlinearity of simulation results and the choice of activation functions and kernel functions in the next section even though ann radbas tansig uses more hidden layers the performance of ann radbas tansig is slightly worse than those of ann tansig and ann radbas because the dimension of the input and output data are sufficiently reduced there is no significant gap between the performance of the shallower and deeper neural network models however the optimal structural design of neural network models can be different in other reservoir cases 3 1 1 activation and kernel functions as discussed in the previous section nonlinear activation and kernel functions outperform linear ones in this section we show the forecast results for a true model chosen among the 104 models to demonstrate when linear activation and kernel functions are inappropriate fig 6 shows the forecast results obtained using linear activation and kernel functions both ann purelin and svr lin provide accurate forecast results except for the water production rate at p15 ann purelin and svr lin underestimate the water production rate at p15 for the future time the underperformance of ann purelin and svr lin for the the water production rate at p15 results from the nonlinear relation between the intput and output data fig 7 a and 7 b show the feature space of the bottom hole pressure at p6 and the water production rate at p15 respectively in the feature space the x and y axes represent the 1st principal directions of the input and output training data corresponding to the largest eigenvalues respectively the true response and the forecast results obtained using ann purelin and svr lin are projected onto the feature space shown in fig 7 where the input data for the true response corresponds to the observed data because the largest eigenvalues corresponding to the 1st principal directions are significantly larger than the remaining eigenvalues the 1st principal directions can describe the input and output data without much loss of accuracy the input and output data for training show a linear relation on the feature space as shown in fig 7 a and the true response can be modeled using a linear function the forecast results of ann purelin and svr lin are close to the true response in fig 7 a however the forecast results of ann purelin and svr lin are far from the true response for the water production rate at p15 as shown in figs 6 and 7 b this is because linear activation and kernel functions are not suitable for representing the nonlinear relationship between the input and output data as shown in fig 7 b fig 8 shows the forecast results of ann tansig and svr rbf for the same true model used in fig 6 ann tansig and svr rbf provide better forecast results than ann purelin and svr lin for the water production rate at p15 because ann tansig and svr rbf can reproduce the nonlinear relationship between the input and output data for this reason the nonlinear activation and kernel functions outperform the linear ones as given in table 2 before forecasting activation and kernel functions should be determined on the basis of the relation between input and output data for training the linearity between input and output data for training can be estimated by visualizing input and output data as shown in fig 7 however it is hard to visualize and estimate the relation between input and output data because the effective dimension of the dimension reduced training data is likely to be higher than two in practice the suitability of chosen activiation and kernel functions can be checked through cross validation tests devijver and kittler 1982 that measure the performance of optimized neural network models and svr models using a set of test data excluded from the training data 3 1 2 quantification of uncertainty in this section we use the randomized likelihood method to quantify the confidence interval of future reservoir performance gaussian random noises are added to the observed data as described in eq 18 the standard deviation of the gaussian random noises ε in eq 18 is chosen as 2 and 4 of the observed data to account for the errors in the observations as well as the learning model the uncertainty in the forecast results is quantified by repeating the forecasting process 300 times as discussed in section 2 5 fig 9 shows p10 and p90 of the forecast results obtained using ann tansig and svr rbf where p10 and p90 represent the 10th and 90th percentiles respectively in fig 9 the true well responses are close to or within the interval between p10 and p90 of the forecast results fig 10 shows p10 and p90 of the forecast results for the oil production rate at p10 and a higher ε 4 as expected the interval between p10 and p90 for ε 4 is larger than that for ε 2 because the perturbed data become farther away from the true data in fig 11 we investigate whether the proposed approach can update the uncertainty interval reliability with additional observations up to 1500 days the interval between p10 and p90 of the forecast results shown in fig 11 is smaller than that shown in fig 9 this is because more oil production rates are observed and thus the future oil production rates have lower uncertainty 3 1 3 outlier patterns satija and caers 2015 emphasized that their data driven forecast approach is likely to be unsuccessful when observed data lie near the edge of training data here we test whether ldfa can provide accurate forecasts when observed data is not within the range of training data fig 12 shows p10 and p90 of the forecast results for the bottom hole pressure at p5 that is located on the upper edge of the training data as shown in fig 12 even though the true data lie near the edge of the training data envelope ldfa does not suffer from the issue that satija and caers 2015 pointed out however ldfa gives unsatisfactory results when the true future data cannot be described by the existing training data set one of the premises of ann and other machine learning methods is that the training data must include all patterns in order to give meaningful forecasts as an example the true data given in fig 13 are significantly outside of the ensemble of training data gray hairlines in this case the forecast results do not reproduce the true oil production rate after the last observation time this is because the existing training data do not have enough information on the true data in the future thus the learning models constructed from the existing training data cannot provide correct reservoir responses nevertheless the production rates given by ldfa dashed and dotted lines are much closer to the true data than the ensemble mean of training data suggesting the attempt by ldfa to match observed data in practice once a large deviation of the future observations from the forecast results is observed we need to inspect the prior models and forward simulation model thoroughly and create alternative training data that are consistent with future reservoir behavior this implies that application of ldfa is more appropriate when uncertainty in the prior models is dominated by parametric uncertainty but not significant conceptual uncertainty that tends to introduce systematic biases in the prior models 3 2 cumulative injected co2 mass in geological co2 storage in a geological co2 storage gcs project it is critical to estimate the cumulative injected co2 mass under given operation conditions not only from safe operation perspective and also for economic reasons in this use case we apply ldfa to forecast the cumulative injected co2 mass in a synthetic reservoir model shown in fig 14 the lateral grid resolution is 100 m by 100 m and the layer thickness is 10 20 m the entire size of the reservoir model is 10 1 km x axis by 15 1 km by 120 m and the reservoir has open boundary conditions co2 is injected at a single location shown in fig 14 during 20 years in this problem setting the bottom hole pressure at the co2 injector is operated under 35 000 kpa to prevent unwanted formation damage and potential induced seismicity alternatively in lieu of maintaining the bottom hole pressure brine extraction can be a more effective way for reservoir pressure management arena et al 2017 bergmo et al 2011 birkholzer et al 2012 buscheck et al 2012 2011 cihan et al 2015 jeong et al 2018 forecasting cumulative injected co2 mass during brine extraction and co2 injection will also be an interesting use case of ldfa two hundred sets of porosity and log10 horizontal permeability fields are stochastically generated using the sequential gaussian simulation and the sequential gaussian co simulation modules of sgems remy et al 2011 the corresponding stochastic simulation parameters are listed in table 3 as an example fig 15 shows three realizations of horizontal permeability the 20 year co2 injection is simulated for the 200 realizations using the compositional multiphase reservoir simulator cmg gem cmg 2015b the cumulative injected co2 mass of a realization is chosen as true data and the others are used as training data the cumulative injected co2 mass is observed at the co2 injector at six dates 10 200 400 600 800 1000 days in the true model the observed data contain gaussian random noises of standard deviation 2 5 of the true responses the parameters for neural network models and svr models are identical to those used in the brugge benchmark model case ε 5 is used to quantify the uncertainty of the cumulative injected co2 mass fig 16 shows p10 and p90 of the forecast results for three different true models the true responses are within the interval between p10 and p90 of the forecast results the cumulative injected co2 mass after 20 years is accurately estimated from the observed data for the first 1 000 days using ldfa thus ldfa provides an efficient way for estimating the cumulative injected co2 mass with limited operation data and in the presence uncertainty 4 discussion forward simulation runs are the most computationally demanding part in forecasting future reservoir performance ldfa needs to run the forward simulation runs as many times as the number of prior models ne forecast of future reservoir performance using ensemble kalman filter enkf or ensemble smoother ens needs 2ne aanonsen et al 2009 jeong et al 2010 lee et al 2013 shin et al 2010 where ne and ne forward simulation runs are used to predict well responses of prior and calibrated models respectively forecast of future reservoir performance using the iterative enkf or ens requires ne na 1 if na assimilations are repeated krymskaya et al 2009 the number of forward simulation runs that other history matching methods need for predicting future reservoir performance cannot be given as a simple formula but the history matching process may require tens or hundreds of times of ne in practice for example the gradient based methods need to calculate the jacobian and even hessian matrix in each iteration to calculate the jacobian using numerical differentiation the number of forward model runs is at least the number of unknown parameters plus one for the primary model which may be significantly greater than ne for the problems considered in this work similarly the number of forward model runs needed by the adjoint state method to calculate jacobian is equal to the number of observations which needs to be greater than the number of unknowns for well posed inverse problems sun and sun 2015 if the user s main interest is future reservoir performance not calibrated models honoring the observed data ldfa can be a computationally advantageous alternative to history matching methods as shown in the outlier case ldfa does not provide satisfactory forecast results if observed data are quite different from the training data pattern therefore before applying ldfa it is important to examine whether the pattern of observed data is covered by the training data if not additional training data that encapsulate the pattern of observed data should be appended we obtain satisfactory forecast performances for all the well responses in the two examples considered in this work nevertheless the forecast performances may be somewhat optimistic because the prior models are generated from the same sample space where the true model exists and other reservoir model parameters except rock facies porosity and permeability are identical in the true and prior models from this sense ldfa and many other ensemble based techniques may share the same limitations as the traditional history matching methods which all assume the existence of a reliable prior model as the starting point in predictive uncertainty analyses modelers then mainly focus on aspects of a model that are easy to vary with the tools at hand e g permeability realizations and tend to ignore the aspects which are hard to vary e g seismic depth conversion and structure as a result the estimates of predictive uncertainty are often over confident our future work will test how ldfa performs when other model uncertainties such as boundary conditions reservoir structure and relative permeability curves are also taken into consideration 5 conclusion in this work we have presented a new data space inversion method the learning based data driven forecast approach ldfa that forecasts future reservoir performance without history matching by using machine learning techniques ldfa is combined with two commonly used supervised machine learning algorithms ann and svr the performance of ldfa ann and ldfa svr was compared using two examples both ldfa ann and ldfa svr were satisfactory in forecasting future reservoir performance and quantifying the predictive uncertainty in the two examples ann can handle more multiple outputs but svr requires a separate model for each dimension of the output variables in general nonlinear activation and kernel functions outperformed linear ones for most of well responses the hyperbolic tangent activation function for ann and the radial basis kernel function for svr give the best results but the difference between the performances of nonlinear functions is insignificant appropriate activation and kernel functions can be chosen by validating ann models and svr models using a set of test data ldfa assumes the availability of a satisfactory albeit uncertain prior model it may give unsatisfactory prediction results when training data do not cover the pattern of observed data well when such phenomenon occurs additional training data should be collected or generated in the examples only the uncertainties in rock facies absolute permeability porosity and ntg are accounted other types of model uncertainties such as boundary conditions reservoir structure and relative permeability curves will need to be considered in future work acknowledgments this work was supported by research resettlement fund for the new faculty of seoul national university the institute of engineering research at seoul national university provided research facilities for this work this work was also supported by the u s department of energy national energy technology laboratory netl under grant number de fe0026515 publication authorized by the director bureau of economic geology jonghyun lee was supported by the army high performance computing research center ahpcrc sponsored by the u s army research laboratory under contract no w911nf 07 2 0027 at stanford university and hawai i experimental program to stimulate competitive research epscor provided by the national science foundation research infrastructure improvement rii track 1 ike wai securing hawai i s water future award oia 1557349 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 05 015 appendix supplementary materials image application 1 
799,quantification of the predictive uncertainty of subsurface models has long been investigated the traditional workflow is to calibrate prior models to match observed data and then use the posterior models to simulate future system performance not only are these procedures computationally expensive but they also have issues in maintaining geological model constraints during the calibration step data space inversion dsi was introduced recently to predict future system performance without the iterative history matching or model calibration step in general dsi approaches seek to establish a statistical relationship between the observed and forecast variables as well as to quantify the predictive uncertainty of the forecast variables by using an ensemble of uncalibrated prior models existing dsi approaches all require a number of complex transformation and mapping operations which may deter their widespread use in this study we introduce a new and simpler dsi approach the learning based data driven forecast approach ldfa by combining dimension reduction and machine learning techniques to quickly provide accurate forecast results and reliably quantify corresponding uncertainty in the results our ldfa framework is demonstrated using two supervised learning algorithms artificial neural network ann and support vector regression svr on two representative examples from reservoir engineering and geological carbon storage results suggest that our approach provides accurate forecast results e g future oil production rate or cumulative injected co2 and reasonable predictive uncertainty intervals our framework is generic and may be applied to other surface and subsurface problems keywords machine learning artificial neural network support vector regression data space inversion future reservoir performance data driven forecast nomenclature d in matrix of data vectors of all prior models for τ 1 τ 2 τ n τ d out matrix of data vectors of all prior models for t 1 t 2 t n t d in ensemble mean vector of d in d out ensemble mean vector of d out ε measurement error vector d obs observed data vector d t i l data vector at ti for the lth prior model g forward simulation operator for m h operator matrix for extraction of the simulation results corresponding to the observation time steps from d out l learning model λ eigenvalue m matrix of prior model parameters m l vector of the lth prior model s parameters nd size of d l ne number of prior models nin number of chosen principal directions of d in nobs size of d obs nout number of chosen principal directions of d out nt number of times of interest n τ number of observation times s singular value t 1 t 2 t n t forecast times τ 1 τ 2 τ n τ observation times w in matrix of chosen principal directions of d in w out matrix of chosen principal directions of d out x in score matrix corresponding to nin principal directions x out score matrix corresponding to nout principal directions 1 introduction prediction of the long term performance of subsurface systems e g geological carbon sequestration repositories waste water disposal aquifers nuclear waste repositories and oil and gas reservoirs is a perpetual research theme in the fields of energy exploration groundwater management and contaminant risk assessment to obtain reliable predictions of a system s future performance the conventional workflow is to first calibrate the system model to match historical data by using either deterministic or statistical inversion approaches oliver et al 2008 oliver and chen 2011 sun and sun 2015 zhou et al 2014 depending on the dimension of parameter space and the actual inversion approach used such history matching process may require a large number of forward simulation runs to minimize the discrepancy between simulated and observed data note in the remainder of the text we shall use the terms history matching inversion and model calibration interchangeably additional forward simulation runs are then needed to propagate uncertainty of system inputs to arrive at predictions of the system s future performance this model space based history matching and uncertainty quantification workflow is computationally expensive for large scale systems even with the use of dimension reduction and model reduction techniques antoulas 2005 frangos et al 2010 recently several approaches originated from the weather forecast literature krishnamurti et al 2000 mallet et al 2009 pagowski et al 2005 were applied to enable the direct forecast of future reservoir performance in observable data space without using the aforementioned workflow satija and caers 2015 scheidt et al 2015 sun and durlofsky 2017 this emerging area of research focusing more on data space inversion dsi using data and ensemble simulation techniques represents a departure from the aforementioned conventional workflow scheidt et al 2015 proposed a prediction focused analysis pfa that assesses the uncertainty of future reservoir performance in the feature space i e dimension reduction space of historical and forecast data which is obtained by using nonlinear principal component analysis however in pfa a kernel smoothing algorithm that is used to generate the distributions of historical and forecast data in the feature space is only appropriate for low dimensional feature spaces sun and durlofsky 2017 satija et al 2017 introduced a generalized least squares approach that forecasts future reservoir performance by maximizing the gaussian likelihood between historical and forecast data in the feature space however this approach may give unsatisfactory results unless the relationship between dimension reduced forecast and observed data is sufficiently linear so that linear regression is appropriate sun and durlofsky 2017 to circumvent this issue satija et al 2017 proposed a linearizing operation using canonical correlation analysis so that the transformed components are maximally correlated sun and durlofsky 2017 suggested a new dsi procedure in which the full data space is defined as the space of all possible types of well production data variables that are collected not only during the history matching period but also during the forecast period the observed data thus represent a subset of the full data space the authors then used a bayesian framework to derive the posterior probability distribution of the full data space conditional to the observed data in essence the problem becomes estimating an underlying generative model for the data space however in their formulation non gaussian data variables need to be converted to gaussian variables using complicated mapping operations before forecasting besides in order to obtain satisfactory forecast results they only selected prior models whose simulated responses are close to observed ones thus enabling a better representation of the region of interest in data space the patterns of the responses that the excluded prior models exhibit are ignored in forecasting in this work we propose a learning based data driven forecast approach ldfa which further simplifies the dsi process by leveraging established machine learning methods in ldfa machine learning algorithms are used to build a learning model that forecasts future reservoir performance given historical and forecast data in particular two well established machine learning algorithms artificial neural network ann and support vector regression svr are adopted unlike the aforementioned approaches our method can be applied to data that have nonlinear patterns in high dimensional feature space and it does not require selective sampling of prior data namely the preselection step in existing dsi approaches because ann and svr are already available in many open source and commercial software packages implementation of ldfa using either ann or svr i e ldfa ann and ldfa svr is relatively straightforward compared to the previous works done by scheidt et al 2015 satija et al 2017 satija and caers 2015 and sun and durlofsky 2017 who all used custom mapping and transformation techniques ann is a biologically inspired computational network model that has been developed to create artificial intelligence zurada 1992 ann has gained tremendous success since its introduction improvements in ann algorithms e g mitigation of overfitting issue and introduction of newer activation functions in the recent decade have led to the arrival of the deep learning era with the appearance of many deep neural network model structures involving a large number of hidden layers and unknowns hinton et al 2006 because of the nature of this work all of our ann models have relatively shallow structures svr is based on support vector machine svm which is widely used in various pattern recognition and regression problems vapnik 1995 svr gives the nonparametric regression function that reproduces observations within a specified margin and other constraints such as flatness in the nonlinear feature space smola and schölkopf 2004 we emphasize that dsi methods are different from many traditional surrogate modeling applications that use machine learning methods for example sun et al 2015 used ann to develop a surrogate watershed pollutant loading model recently xu et al 2017 presented an error explicit bayesian method for developing surrogate groundwater models using random forests and svr and for quantifying predictive uncertainty these previous studies typically sought to link the model input parameters and model outputs at a small number of observation points rather than forecasting the entire model space the paper is organized as follows in the next section we introduce the methodologies behind ldfa ann and ldfa svr then the performance of ldfa ann and ldfa svr is demonstrated in forecasting future reservoir performance using a the brugge model which is a well known benchmark problem in reservoir engineering peters et al 2010 and b a synthetic geological carbon storage gcs model in the examples we investigate how the forecast performance of ldfa ann and ldfa svr is affected by the design of the neural network such as the number of neural layers activation function types and the choice of different kernel functions 2 methodology the traditional work flow of forecasting future reservoir performance can be summarized as follows 1 build prior models stochastically honoring given static data such as well log data core data and geological constraints 2 conduct forward simulations in the prior models 3 calibrate the prior models so that the simulated responses of the prior models are matched to observed ones 4 forecast the future reservoir performance by conducting forward simulations in the calibrated models up to the future time thousands of forward simulation runs may be required in step 3 of the above to find models that reproduce the observed data however ldfa does not need the computationally expensive calibration step step 3 in the traditional work flow for predicting the future reservoir performance ldfa predicts the future reservoir performance after the observation time using the data driven relation between the reservoir performance before and after the observation time of the prior models therefore once the data driven relation is constructed ldfa can forecast the future reservoir performance quickly without requiring the change of reservoir model parameters as shown in fig 1 ldfa consists of four main steps i e generation of training data reparameterization learning forecasting and ten substeps first of all training data are generated by conducting flow simulations using an ensemble of prior models the training data are reparameterized using principal component analysis pca to reduce the data dimension because training becomes faster and easier as the data dimension is lowered ann and svr are used to build a learning model that reproduces the dimension reduced training data once observed data become available the future reservoir performance i e after the last observation time is forecast using the learning model the details of the substeps in each main step are given in the following sections 2 1 generation of training data an ensemble of prior models honoring prior data such as geological data core data and well logging data are built to generate training data that are used to forecast future reservoir performance let us denote the ensemble and an individual model of the ensemble as m and m respectively 1 m m 1 m 2 m n e where ne is the number of prior models in m then flow simulation runs are conducted in the ensemble models 2 g m l d l d t 1 l t d t 2 l t d t n t l t t l 1 2 n e where t represent a forecast time and nt is the total number of forecast times g returns a vector of forward simulation results for the forecast times t 1 t 2 t n t d t i l is a vector of data variables such as flow rates bottom hole pressure and fluid saturation at ti for the lth ensemble model the simulation results corresponding to observation and forecast times are used as input and output data for training see fig 1 where the set of observation times is a subset of forecast times 3 d o b s d τ 1 o b s t d τ 2 o b s t d τ n τ o b s t t τ 1 τ 2 τ n τ t 1 t 2 t n t 4 d o u t g m 1 g m 2 g m n e 5 d i n h d o u t d τ 1 1 d τ 1 2 d τ 1 n e d τ 2 1 d τ 2 2 d τ 2 n e d τ n τ 1 d τ n τ 2 d τ n τ n e where τ and n τ represent the observation time and the total number of observation times d τ i o b s is an observation vector of the data variables at τ i where d t i l and d τ i o b s have the same dimension h is a matrix for extracting the simulation results corresponding to the observation times from d out which is the matrix of the simulation results for all the prior models d in and d out are used as input and output data for training a learning model 2 2 reparameterization using pca computational costs associated with ann and svr depend on various factors such as the dimension of the input and output data the size of available training data sets the number of validation groups and so on in 5 if the dimensions of d in and d out are large it is hard to optimize a learning model for d in and d out thus the dimensions of d i n r n o b s n e and d o u t r n d n e are first reduced where nobs and nd represent the dimensions of d obs and d l respectively among numerous dimension reduction techniques cunningham 2008 fodor 2002 maaten et al 2009 pca is chosen in this study for its optimal compression power in l2 norm jolliffe 2002 pca uses an orthogonal transformation to transform the original input space with possibly correlated structure into a new space i e feature space of no linear correlation by doing so the basis in the new space becomes orthogonal to each other and variables are ordered in terms of their variances in the original space because only a few variables latent variables in the new space account for the most variability in the input data in many cases pca can reduce the number of variables in the training data greatly without much loss of accuracy resulting low dimensional data sets that can be trained effectively in ldfa in pca principal directions are eigenvectors of the covariance matrix of data the data dimension can be reduced by choosing eigenvectors corresponding to dominant eigenvalues we compute eigenvectors and eigenvalues of a covariance matrix using singular value decomposition svd 6 d i n d i n u i n i n v i n t 7 d i n 1 n e j 1 n e h g m j 8 d o u t d o u t u o u t o u t v o u t t 9 d o u t 1 n e j 1 n e g m j where u in and u out are nobs nobs and nd nd unitary matrixes respectively d i n and d o u t are ensemble mean vectors of d i n and d o u t for detrending respectively the columns of u in and u out are principal directions of d in and d out in and out are nobs ne and nd ne diagonal matrices where the diagonal elements are the descending nonnegative singular values s i in and s i out of d i n d i n and d o u t d o u t the maximum number of nonnegative singular values in d i n d i n and d o u t d o u t are min nobs ne 1 and min nd ne 1 respectively the eigenvalues λ i of the covariance matrixes of d in and d out are given by 10 λ i i n s i i n 2 min n o b s n e 1 11 λ i o u t s i o u t 2 min n d n e 1 v in and v out are ne ne unitary matrixes the rows of i n v i n t and o u t v o u t t are the principal component scores for the corresponding principal directions only nin and nout principal directions are retained to reduce the dimensions of d in and d out nin and nout are determined using an energy criterion of eigenvalues cardoso et al 2009 sun and durlofsky 2017 the energies for the largest nin and nout eigenvalues are given by 12 e n i n i 1 n i n λ i i n i 1 min n o b s n e 1 λ i i n 13 e n o u t i 1 n o u t λ i o u t i 1 min n d n e 1 λ i o u t where nin and nout principal directions are chosen using predetermined e n i n and e n o u t nin and nout principal directions in u in and u out are denoted as w in and w out the score matrixes corresponding to nin and nout principal directions are denoted as x in and x out i e d i n d i n w i n x i n and d o u t d o u t w o u t x o u t the dimensions of d in and d out are reduced to nin and nout by projecting d in and d out onto the feature space formed by the nin and nout principal directions x in and x out are used as input and output data for training a learning model l the reparameterization is useful to save the computational cost of the ann and svr model construction but d in and d out do not need to be reparameterized if the dimensions of d in and d out are already low enough for example lower than five by rule of thumb 2 3 machine learning 2 3 1 artificial neural network ann builds a black box model that replicates given training data by optimizing weights and biases of a neural network the multi layer feedforward network shown in fig 2 has d 1 neural layers network depth and the d th neural layer has nd neurons network width where the superscript indicates the index of a neural layer as a neural network becomes deeper and wider the neural network can replicate more complicated functions however appropriate numbers of neural layers and neurons on each neural layer should be chosen carefully because of the computational cost and underfitting or overfitting problems heaton 2008 a neuron consists of three parameters weights a bias term and an activation function which are denoted as w b and f in fig 2 respectively the basic function of a neuron is to receive input signals from the previous neural layer make an output signal using the three neuron parameters and send the output signal to the next neural layer in fig 2 x in i represents the ith element of input signal or data nin and nd are the dimension of input signal and the number of neurons in the dth neural layer the zeroth and the dth layer represent the input and output layers respectively w d i j represents the weight for the ith neuron of the d 1 th neural layer and the jth neuron of the dth neural layer b d j represents the bias of the jth neuron in the dth neural layer v d j b d j i 1 n d 1 w d i j y d 1 i where y d 1 i represents the output signal of the ith neuron on the d 1 th neural layer and y 0 i equals to x in i in fig 2 f d represents the activation function of the dth neural layer y d j f d v d j a neural network model cannot reproduce the nonlinear relation between input and output data using only linear operators with weights and biases activation functions such as the symmetric saturating linear function rectified linear units relu sigmoid hyperbolic tangent radial basis functions are necessary to make the neural network model learn the nonlinearity between input and output data fig 3 shows typical activation functions for neurons an appropriate activation function or a set of different activation functions should be used on the basis of the relation between input and output data the activation function of an output neural layer for regression is commonly a linear function the first input data and final output data xin and yd correspond to column vectors of x in and x out in the reparameterization step respectively the weight w and bias b of each neuron are optimized to minimize the mean squared error between target output x out and the learning model s prediction l x i n there are various optimization algorithms for finding weights and biases in a neural model such as levenberg marquardt algorithm gradient descent method stochastic gradient descent method newton s method quasi newton method and conjugate gradient method yu and wilamowski 2011 once observed data become available the reparameterized observed data are provided as inputs to the learning model l to obtain reparameterized output data a final prediction is obtained by back transforming the reparameterized output data using eq 17 which is given in section 2 4 below 2 3 2 support vector regression svr can also be used to build a learning model to forecast future reservoir performance however unlike ldfa ann that handles multiple outputs multiple svr models are established to forecast output data variables separately a linear support vector regression problem is given as 14 f i x i n x i n t w i b i i 1 2 n o u t 15 w i b i arg min w i 1 2 w i 2 2 s t x o u t i f i x i n ɛ f o r i i 1 2 n o u t where i is the index of a dimension reduced output data variable w and b are a coefficient vector and a bias vector for the support vector regression model respectively w and b corresponding each output variable should be obtained through training the constraints in eq 15 require that the deviation of f i x i n from x out i be less than ε however f i x i n satisfying the constraints for all the input data may not exist cortes and vapnik 1995 introduced the primal formula to avoid the infeasible constraint in this study we use the lagrange dual formulation vapnik 1995 to solve the simplified primal problem efficiently with kernel functions such as linear polynomial and radial basis function kernels smola and schölkopf 2004 2 4 forecasting once a learning model is constructed observed data can be incorporated to predict future reservoir performance observed data should be projected onto the input space of a learning model 16 x o b s w i n t d o b s d i n 17 d e s t w o u t l x o b s d o u t where as discussed in the reparameterization step w in and w out are the chosen principal directions of the centered d in and d out respectively in eq 16 x obs is a projection of d obs onto the dimension reduced space for d in formed by w in l is a learning model function of a data vector in the dimension reduced space for d in because l returns a data vector in the dimension reduced space for d out l x o b s is back transformed to d est which is the forecast result for d obs using eq 17 2 5 quantification of uncertainty in forecast results in practice observed data are contaminated by measurement errors the uncertainty incurred by measurement errors can be quantified using the randomized maximum likelihood method i e parametric bootstrapping kitanidis 1986 oliver 1996 in the flow chart of ldfa shown in fig 1 we quantify the predictive uncertainty in d est by adding gaussian random errors to d obs in the step 8 as given in eq 18 and repeating the steps 8 through 10 sun and durlofsky 2017 18 x o b s w i n t d o b s ɛ d i n where ε represents the measurement error vector related to d obs for example if 500 forecasts are repeated for quantification of uncertainty different d est is obtained in every forecast because different errors are added to d obs in eq 18 the uncertainty of the forecasting result can then be quantified using the ensemble of 500 sets of d est 3 numerical examples 3 1 brugge benchmark model in the first example we apply ldfa to the brugge benchmark model peters et al 2010 the brugge benchmark model was developed to test different waterflooding optimization and history matching methods by the netherlands organization for applied scientific research tno the size of the brugge model is approximately 17 km 9 km 60 m which is discretized into 139 48 9 grid blocks fig 4 shows the top depth and locations of 10 injectors and 20 producers where p9 is operated at a constant pressure of 725 5 psi and the other producers and injectors are operated at liquid flow rates about 2000 bbl day and a constant water injection rate 4000 bbl day the wells are opened at different dates the brugge model has four formations namely schelde maas waal and schie from the top to bottom the four formations have different distributions of rock facies porosity permeability and net to gross ntg the injection and production histories of 10 injectors and 20 producers during 10 years are included in the brugge model tno provides 104 realizations of geological models with the same fault topology and grid geometry but different rock facies porosity permeability net to gross ntg and water saturation fig 5 shows three typical realizations among the 104 ones that are generated using different geological features and geostatistical techniques realization 1 shown in fig 5 a is a gaussian random field generated without rock facies simulation the rock facies of realizations 28 and 66 shown in fig 5 b and 5 c are generated using fluvial channel object modeling and sequential indicator simulation respectively the 104 realizations are then simulated using a black oil reservoir simulator cmg imex cmg 2015a ldfa is tested by choosing one realization from the set of 104 realizations as a true model well responses at each well including bottom hole pressure oil production rate water production rate and field responses including total oil production and total water production are observed at eight dates τ1 τ2 τ8 16 151 301 451 580 703 852 1004 days during 10 years from the simulation results of the true model gaussian random noises having a standard deviation 1 of the true responses are added to the true responses to generate observed data the simulation results of the remaining 103 realizations are used as training data to build a learning model the input data for training are well responses at the eight dates τ1 τ2 τ8 the output data for training are well responses at the 498 dates during the 10 years including the observation times τ1 τ2 τ8 where t 10 τ1 t 30 τ2 t 50 τ3 t 70 τ4 t 90 τ5 t 110 τ6 t 130 τ7 and t 150 τ8 before training learning models the dimension of the training data is reduced by choosing principal directions or eigenvectors with e n i n and e n o u t 0 999 as in eqs 12 and 13 the chosen principal directions are used to reduce the dimension of the observed data and back transform the dimension reduced output data five sets of activation functions are tested and their names are listed in table 1 the width of a single hidden layer except ann radbas tansig is max nin nout ann radbas tansig has two hidden layers and they have hyperbolic tangent and radial basis activation functions respectively ann radbas tansig had an overfitting problem when the width of the two hidden layers is max nin nout we determined the width of the hidden layers for ann radbas tansig according to heaton 2008 who suggested that the number of hidden neurons should be 2 3 n i n n o u t we use bayesian regularization backpropagation implemented in matlab for optimization of a neural network that finds optimal regularization parameters of the levenberg marquardt algorithm beale et al 2017 foresee and hagan 1997 mackay 1992 pan et al 2013 we use the ls svm matlab toolbox brabanter et al 2011 for svr as discussed in the methodology section the svr models are built separately for each dimension of the dimension reduced output data for training nout in other words each svr model is used to forecast each variable of the dimension reduced output data the results of three different kernel functions linear polynomial and radial basis kernel functions are compared and their names are provided in table 1 we compare the performance of ann and svr models listed in table 1 by choosing each geological model as a true model among the 104 ones which is essentially a leave one out cross validation test ldfa ann and ldfa svr take a few seconds to finish forecasting for each true model thus ldfa can avoid the high computational cost required by the conventional forecasting methods for simulating future reservoir performance using posterior reservoir models the forecast performance is measured using the median relative error defined by 19 median relative error medi an 1 n t i 1 n t d i j d i true d i true for j 1 n e which is the median of the average of the relative errors over all times the median relative errors for different ann and svr models are given in table 2 several production well responses are excluded in table 2 because the prior models have almost the same production well responses over the observation times considering the noise level 1 of the observed data the accuracies of the ann and svr models having on average 3 7 of median relative error are acceptable however the neural network models using nonlinear activation functions and svr models using nonlinear kernel functions provide more accurate forecasts than those using linear activation and kernel functions although overall ann tansig and ann radbas give the most accurate and the most stable forecasts the differences between the accuracies of ann tansig ann radbas ann radbas tansig svr pol svr rbf are insignificant we discuss the nonlinearity of simulation results and the choice of activation functions and kernel functions in the next section even though ann radbas tansig uses more hidden layers the performance of ann radbas tansig is slightly worse than those of ann tansig and ann radbas because the dimension of the input and output data are sufficiently reduced there is no significant gap between the performance of the shallower and deeper neural network models however the optimal structural design of neural network models can be different in other reservoir cases 3 1 1 activation and kernel functions as discussed in the previous section nonlinear activation and kernel functions outperform linear ones in this section we show the forecast results for a true model chosen among the 104 models to demonstrate when linear activation and kernel functions are inappropriate fig 6 shows the forecast results obtained using linear activation and kernel functions both ann purelin and svr lin provide accurate forecast results except for the water production rate at p15 ann purelin and svr lin underestimate the water production rate at p15 for the future time the underperformance of ann purelin and svr lin for the the water production rate at p15 results from the nonlinear relation between the intput and output data fig 7 a and 7 b show the feature space of the bottom hole pressure at p6 and the water production rate at p15 respectively in the feature space the x and y axes represent the 1st principal directions of the input and output training data corresponding to the largest eigenvalues respectively the true response and the forecast results obtained using ann purelin and svr lin are projected onto the feature space shown in fig 7 where the input data for the true response corresponds to the observed data because the largest eigenvalues corresponding to the 1st principal directions are significantly larger than the remaining eigenvalues the 1st principal directions can describe the input and output data without much loss of accuracy the input and output data for training show a linear relation on the feature space as shown in fig 7 a and the true response can be modeled using a linear function the forecast results of ann purelin and svr lin are close to the true response in fig 7 a however the forecast results of ann purelin and svr lin are far from the true response for the water production rate at p15 as shown in figs 6 and 7 b this is because linear activation and kernel functions are not suitable for representing the nonlinear relationship between the input and output data as shown in fig 7 b fig 8 shows the forecast results of ann tansig and svr rbf for the same true model used in fig 6 ann tansig and svr rbf provide better forecast results than ann purelin and svr lin for the water production rate at p15 because ann tansig and svr rbf can reproduce the nonlinear relationship between the input and output data for this reason the nonlinear activation and kernel functions outperform the linear ones as given in table 2 before forecasting activation and kernel functions should be determined on the basis of the relation between input and output data for training the linearity between input and output data for training can be estimated by visualizing input and output data as shown in fig 7 however it is hard to visualize and estimate the relation between input and output data because the effective dimension of the dimension reduced training data is likely to be higher than two in practice the suitability of chosen activiation and kernel functions can be checked through cross validation tests devijver and kittler 1982 that measure the performance of optimized neural network models and svr models using a set of test data excluded from the training data 3 1 2 quantification of uncertainty in this section we use the randomized likelihood method to quantify the confidence interval of future reservoir performance gaussian random noises are added to the observed data as described in eq 18 the standard deviation of the gaussian random noises ε in eq 18 is chosen as 2 and 4 of the observed data to account for the errors in the observations as well as the learning model the uncertainty in the forecast results is quantified by repeating the forecasting process 300 times as discussed in section 2 5 fig 9 shows p10 and p90 of the forecast results obtained using ann tansig and svr rbf where p10 and p90 represent the 10th and 90th percentiles respectively in fig 9 the true well responses are close to or within the interval between p10 and p90 of the forecast results fig 10 shows p10 and p90 of the forecast results for the oil production rate at p10 and a higher ε 4 as expected the interval between p10 and p90 for ε 4 is larger than that for ε 2 because the perturbed data become farther away from the true data in fig 11 we investigate whether the proposed approach can update the uncertainty interval reliability with additional observations up to 1500 days the interval between p10 and p90 of the forecast results shown in fig 11 is smaller than that shown in fig 9 this is because more oil production rates are observed and thus the future oil production rates have lower uncertainty 3 1 3 outlier patterns satija and caers 2015 emphasized that their data driven forecast approach is likely to be unsuccessful when observed data lie near the edge of training data here we test whether ldfa can provide accurate forecasts when observed data is not within the range of training data fig 12 shows p10 and p90 of the forecast results for the bottom hole pressure at p5 that is located on the upper edge of the training data as shown in fig 12 even though the true data lie near the edge of the training data envelope ldfa does not suffer from the issue that satija and caers 2015 pointed out however ldfa gives unsatisfactory results when the true future data cannot be described by the existing training data set one of the premises of ann and other machine learning methods is that the training data must include all patterns in order to give meaningful forecasts as an example the true data given in fig 13 are significantly outside of the ensemble of training data gray hairlines in this case the forecast results do not reproduce the true oil production rate after the last observation time this is because the existing training data do not have enough information on the true data in the future thus the learning models constructed from the existing training data cannot provide correct reservoir responses nevertheless the production rates given by ldfa dashed and dotted lines are much closer to the true data than the ensemble mean of training data suggesting the attempt by ldfa to match observed data in practice once a large deviation of the future observations from the forecast results is observed we need to inspect the prior models and forward simulation model thoroughly and create alternative training data that are consistent with future reservoir behavior this implies that application of ldfa is more appropriate when uncertainty in the prior models is dominated by parametric uncertainty but not significant conceptual uncertainty that tends to introduce systematic biases in the prior models 3 2 cumulative injected co2 mass in geological co2 storage in a geological co2 storage gcs project it is critical to estimate the cumulative injected co2 mass under given operation conditions not only from safe operation perspective and also for economic reasons in this use case we apply ldfa to forecast the cumulative injected co2 mass in a synthetic reservoir model shown in fig 14 the lateral grid resolution is 100 m by 100 m and the layer thickness is 10 20 m the entire size of the reservoir model is 10 1 km x axis by 15 1 km by 120 m and the reservoir has open boundary conditions co2 is injected at a single location shown in fig 14 during 20 years in this problem setting the bottom hole pressure at the co2 injector is operated under 35 000 kpa to prevent unwanted formation damage and potential induced seismicity alternatively in lieu of maintaining the bottom hole pressure brine extraction can be a more effective way for reservoir pressure management arena et al 2017 bergmo et al 2011 birkholzer et al 2012 buscheck et al 2012 2011 cihan et al 2015 jeong et al 2018 forecasting cumulative injected co2 mass during brine extraction and co2 injection will also be an interesting use case of ldfa two hundred sets of porosity and log10 horizontal permeability fields are stochastically generated using the sequential gaussian simulation and the sequential gaussian co simulation modules of sgems remy et al 2011 the corresponding stochastic simulation parameters are listed in table 3 as an example fig 15 shows three realizations of horizontal permeability the 20 year co2 injection is simulated for the 200 realizations using the compositional multiphase reservoir simulator cmg gem cmg 2015b the cumulative injected co2 mass of a realization is chosen as true data and the others are used as training data the cumulative injected co2 mass is observed at the co2 injector at six dates 10 200 400 600 800 1000 days in the true model the observed data contain gaussian random noises of standard deviation 2 5 of the true responses the parameters for neural network models and svr models are identical to those used in the brugge benchmark model case ε 5 is used to quantify the uncertainty of the cumulative injected co2 mass fig 16 shows p10 and p90 of the forecast results for three different true models the true responses are within the interval between p10 and p90 of the forecast results the cumulative injected co2 mass after 20 years is accurately estimated from the observed data for the first 1 000 days using ldfa thus ldfa provides an efficient way for estimating the cumulative injected co2 mass with limited operation data and in the presence uncertainty 4 discussion forward simulation runs are the most computationally demanding part in forecasting future reservoir performance ldfa needs to run the forward simulation runs as many times as the number of prior models ne forecast of future reservoir performance using ensemble kalman filter enkf or ensemble smoother ens needs 2ne aanonsen et al 2009 jeong et al 2010 lee et al 2013 shin et al 2010 where ne and ne forward simulation runs are used to predict well responses of prior and calibrated models respectively forecast of future reservoir performance using the iterative enkf or ens requires ne na 1 if na assimilations are repeated krymskaya et al 2009 the number of forward simulation runs that other history matching methods need for predicting future reservoir performance cannot be given as a simple formula but the history matching process may require tens or hundreds of times of ne in practice for example the gradient based methods need to calculate the jacobian and even hessian matrix in each iteration to calculate the jacobian using numerical differentiation the number of forward model runs is at least the number of unknown parameters plus one for the primary model which may be significantly greater than ne for the problems considered in this work similarly the number of forward model runs needed by the adjoint state method to calculate jacobian is equal to the number of observations which needs to be greater than the number of unknowns for well posed inverse problems sun and sun 2015 if the user s main interest is future reservoir performance not calibrated models honoring the observed data ldfa can be a computationally advantageous alternative to history matching methods as shown in the outlier case ldfa does not provide satisfactory forecast results if observed data are quite different from the training data pattern therefore before applying ldfa it is important to examine whether the pattern of observed data is covered by the training data if not additional training data that encapsulate the pattern of observed data should be appended we obtain satisfactory forecast performances for all the well responses in the two examples considered in this work nevertheless the forecast performances may be somewhat optimistic because the prior models are generated from the same sample space where the true model exists and other reservoir model parameters except rock facies porosity and permeability are identical in the true and prior models from this sense ldfa and many other ensemble based techniques may share the same limitations as the traditional history matching methods which all assume the existence of a reliable prior model as the starting point in predictive uncertainty analyses modelers then mainly focus on aspects of a model that are easy to vary with the tools at hand e g permeability realizations and tend to ignore the aspects which are hard to vary e g seismic depth conversion and structure as a result the estimates of predictive uncertainty are often over confident our future work will test how ldfa performs when other model uncertainties such as boundary conditions reservoir structure and relative permeability curves are also taken into consideration 5 conclusion in this work we have presented a new data space inversion method the learning based data driven forecast approach ldfa that forecasts future reservoir performance without history matching by using machine learning techniques ldfa is combined with two commonly used supervised machine learning algorithms ann and svr the performance of ldfa ann and ldfa svr was compared using two examples both ldfa ann and ldfa svr were satisfactory in forecasting future reservoir performance and quantifying the predictive uncertainty in the two examples ann can handle more multiple outputs but svr requires a separate model for each dimension of the output variables in general nonlinear activation and kernel functions outperformed linear ones for most of well responses the hyperbolic tangent activation function for ann and the radial basis kernel function for svr give the best results but the difference between the performances of nonlinear functions is insignificant appropriate activation and kernel functions can be chosen by validating ann models and svr models using a set of test data ldfa assumes the availability of a satisfactory albeit uncertain prior model it may give unsatisfactory prediction results when training data do not cover the pattern of observed data well when such phenomenon occurs additional training data should be collected or generated in the examples only the uncertainties in rock facies absolute permeability porosity and ntg are accounted other types of model uncertainties such as boundary conditions reservoir structure and relative permeability curves will need to be considered in future work acknowledgments this work was supported by research resettlement fund for the new faculty of seoul national university the institute of engineering research at seoul national university provided research facilities for this work this work was also supported by the u s department of energy national energy technology laboratory netl under grant number de fe0026515 publication authorized by the director bureau of economic geology jonghyun lee was supported by the army high performance computing research center ahpcrc sponsored by the u s army research laboratory under contract no w911nf 07 2 0027 at stanford university and hawai i experimental program to stimulate competitive research epscor provided by the national science foundation research infrastructure improvement rii track 1 ike wai securing hawai i s water future award oia 1557349 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 05 015 appendix supplementary materials image application 1 
