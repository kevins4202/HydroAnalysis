index,text
6320,groundwater resources are increasingly exploited for industrial and agricultural purposes in many arid semi arid regions globally in order to gain a harmonious development among groundwater resources and economic benefits urgent investigation of the impacts of anthropogenic activities on the groundwater chemistry is required understanding hydrochemical mechanism of groundwater in yinchuan plain arid and semi arid area in northwestern china plays a significant role in water resources planning in this ecologically sensitive area in this paper a total of 460 phreatic water samples were collected including 58 water samples containing isotopic data d and 2h results demonstrate that water chemistry type and isotopic data of phreatic water presents a zonation characteristic from west to east and from south to north in the eastern part of the helan mountain a1 zone the type of hydrochemistry is mainly hco3 so4 ca mg so4 hco3 ca mg which is mainly recharged by the bedrock fissure water of helan mountain however in the southern qingtongxia a2 zone are hco3 na hco3 ca mg which receives irrigation and spring water recharge phreatic aquifer in multi layered structure zone a3 zone reflect multiple recharge sources to the aquifer the water chemistry demonstrates diverse variations the anion was dominated by the hco3 while the cation is dominated by sodium the predominant controlling factors of phreatic water hydrochemistry are divided into anthropogenic activities and natural conditions natural conditions mainly include the existence form and lithology of the aquifer sources of groundwater recharge soil salinity and evaporation mineral dissolution ion exchange and adsorption and mixing effect meanwhile among natural factors minerals dissolution in groundwater is the main process dominating the hydrochemical evolution of the groundwater the other is anthropogenic activities which can be classified as groundwater pollution excessive exploitation or excretion of groundwater and excessive groundwater recharge keywords hydrochemical mechanism anthropogenic activities hydrochemistry isotope groundwater 1 introduction water chemistry can be used to assist in understanding the effects of natural and anthropogenic activities skrzypek et al 2013 liu et al 2015 selvakumar et al 2017 the study of hydrochemical processes and the factors affecting water quality can all help us have a better understanding of the governing mechanism of the groundwater hydrochemistry mohanty et al 2019 stable isotopes of 18o 2h and 3h and hydrogeochemical indicators usually are considered to be robust in identifying the hydrochemical processes mohammed et al 2018 martinez et al 2015 especially in semi arid and arid region zang et al 2018 yang et al 2016a 2016b h and o stable isotopes are ideal tracers of water sources and movement because they are constituents of the water molecules akiti 1986 at different phrases of the hydrological environment the content of these components are will vary due to the fractionation of isotopes hydrogeochemical indicators in different water bodies can provide information on the geochemical reaction within the aquifer and the possible evolutionary pathways of groundwater cook and herczeg 1999 yinchuan plain is located in the arid to semi arid area of northwest china it is one of the oldest irrigation areas supplied by yellow river with the population growth and increasing agricultural activities there is an ever growing demand for fresh water zhou et al 2016 however long term and large scale discharge of industrial waste water and domestic sewage excessive use of pesticides and fertilizers have given rise to a certain degree of groundwater pollution in the yinchuan plain chen et al 2017 zhang 2015a meanwhile unreasonable exploitation and utilization of groundwater has resulted in a series of water related environmental geological problems li and wu 2010 fang and chen 2001 it is well known that many important ecological processes can be disrupted by changes in groundwater chemistry amalfitano et al 2014 lorenzo et al 2015 therefore a sustainable utilization groundwater resources strategy requires a deeper understanding of hydrochemical formation mechanism of groundwater in order to guarantee reliable supply for the various purposes various studies on groundwater hydrochemistry in yinchuan plain have been conducted sun et al 2008 qian et al 2013 jing et al 2014 zhang 2015b yang et al 2018 based on the hydrochemical data wang 2005 found that the changes in the chemical compositions of groundwater in yinchuan plain are predominantly controlled by the chemical properties of groundwater recharge source water rock interactions mixing effects evaporation and condensation and the soil salinization in the region qian and li 2011 investigated the natural factors of controlling the groundwater compositions zhang 2015b found that the factors determining groundwater hydrochemical components mainly include natural processes and anthropogenic activities however the impacts of anthropogenic activities on the groundwater hydrochemistry were not addressed in depth the yinchuan plain is a good illustration of such areas where groundwater hydrochemistry is affected by the combined process of natural and anthropogenic activities zhou et al 2016 wu et al 2016 chen et al 2018 however previous researches mainly focus on investigating the natural processes without in depth study of anthropogenic activities and some key processes were not emphasized properly which involves 1 the possible differences among the different recharge sources within the study area were not considered 2 as the dominant natural controlling processes mineral dissolution and evaporative condensation actions was not well interpreted therefore in order to obtain a comprehensive understanding of groundwater hydrochemistry evolution in yinchuan plain it is a prerequisite to identify the impacts of natural factors and anthropogenic activities on the groundwater hydrochemistry the main objectives are 1 to interpret the hydrochemical formation mechanism 2 to distinguish the major anthropogenic activities and natural factors and 3 to quantify the contribution of mineral dissolution evaporation and transpiration factors under the context of a large number of anthropogenic activities the results of the present study will be valuable in obtaining a deeper insight into groundwater chemistry and accordingly water resources management strategy 2 study area yinchuan plain is located in the nw china between 105 45 106 56 and 37 46 39 23 n the western margin of the plain is the helan mountain connecting a series of normal slip faults the eastern margin of the plain connects with the yellow river and adjacents with the ordos platform the south of the plain is bordered by the en fault of the niushou mountain the plain covers yinchuan city shizuishan city and wuzhong city fig 1 the climate of study area has a typical continental arid to semi arid climate characterized by less rain strong evaporation and dry climate qian et al 2011 the average monthly temperature varies from 7 73 c in january to 23 63 c in july and the average annual temperature is 8 92 c in addition the annual mean precipitation amount is 186 7 mm and is mainly concentrated in june september which accounts for more than 68 1 of the total annual precipitation amount the potential annual evaporation amount is 1838 44 mm ningxia geological engineering survey institute 1995 wang 2005 jing et al 2010 which is about 10 times as much as the rainfall the water resource in yinchuan plain is mainly supplied by yellow river which is located in the east of the plain with a total length of about 191 km and has a significant influence on the development of the topography and geomorphology in the plain fig 1 in addition the yellow river in yinchuan plain is a perennial river with large sediment concentration and an average salinity of 0 4 g l qian and li 2011 zhou et al 2016 at the same time by the innate superiority of irrigation many irrigation channels and discharge ditches stretch all over the plain and large numbers of lakes and swamps can be seen in study area fig 1 meanwhile yinchuan plain has been intensively irrigated for over 2000 years and supports traditional farming activities there is no doubt that without anthropogenic activities over the past 2000 years yinchuan plain would never be as prosperous as it is now chen et al 2018 yinchuan plain is formed by river lake and flood deposition over a cenozoic fault basin qian et al 2013 mainly including alluvial and diluvial deposition formed in the east and west of the basin close to the two blocks containing 7000 m of cenozoic sediments overlain by about 2000 m of weakly consolidated quaternary material wu et al 2008 qian and li 2011 zhang 2015b geological mapping reveals a zonal distribution of landforms extending from the foot of helan mountain in the northwest to the yellow river in the southeast fig 1 the general topography is a leaning pluvial plain a pluvial alluvial plain and subsequently to an alluvial lacustrine plain as the river is approached the groundwater in the study area is porous water stored in the unconsolidated sediments which can be divided into two areas a single phreatic water area and a multilayer structure area based on the geological geomorphologic and hydrogeological conditions and drilling data fig 2 a it is found that the single phreatic water area mainly distributes in the western and southern parts of the plain composed of pluvial deposits from helan mountain and alluvial sand gravel in qingtongxia and others areas are mostly characterized by a multilayer structure which can be divided into shallow groundwater 0 50 m top deep groundwater 50 150 m and bottom deep groundwater 150 300 m according to the depth of aquifer groundwater as the primary source of domestic and industrial purposes is mainly supplied by irrigation infiltration water in the plain fig 1 and the recharge from return flow of irrigation water amounts for over 80 of the total recharge to the phreatic aquifer ningxia geological engineering survey institute 1995 lu 2010 qian et al 2013 jing et al 2014 the runoff is influenced by topography lithology of soils and other natural and human factors and the phreatic water flows from southwest to northeast controlled by terrain the groundwater from precipitation infiltration supply near the basin still runs off towards the basin and is finally drained to lakes or yellow river the main discharge of shallow water is evaporation due to the arid climate accounting for more than 45 of the total discharge lu 2010 chen et al 2018 3 data collection a total of 460 phreatic water samples were collected for hydrochemical analysis fig 2a which was grouped into three classes based on the hydrogeological conditions namely a1 zone the eastern part of the helan mountain 70 samples a2 zone the southern qingtongxia 37 samples and a3 zone phreatic aquifer in multi layered structure zone 353 samples fig 2b among them 12 samples in a1 zone 9 samples in a2 zone and 37 samples in a3 zone were selected for stable isotope analysis 3 samples of diversion canal water contained conventional components which are located in tanglai channel xigan channel and huinong channel from east to west 30 groups of precipitation data which were downloaded from the global atmospheric precipitation monitoring data and materials of international atomic energy agency iaea are included in this paper the weighted means of isotopes weight is the proportion of each monitoring station to the study area δd and δ18o in atmospheric precipitation in yinchuan area are 45 59 and 6 93 besides precipitation isotopic data and hydrochemical analysis of other water bodies are also collected including 11 yellow river water samples 17 lake water samples and 37 upper confined water samples fig 1 4 data analysis 4 1 hydrochemical characteristics 4 1 1 precipitation and surface water atmospheric precipitation is the original input of groundwater and surface water meanwhile surface water also directly or indirectly recharge groundwater therefore understanding of hydrochemical characteristics of precipitation and surface water in yinchuan plain is the prerequisites of investigating the groundwater hydrochemisty in this paper a descriptive statistical analysis of precipitation and surface water chemical composition in yinchuan plain were summarized in table 1 and piper diagram was illustrated in fig 3 it can be seen from fig 3 that the main anion in the local precipitation mean precipitation is hco3 while the cation is dominated by mg2 followed by ca2 and the hydrochemistry type is hco3 mg ca with low tds wang 2005 the yellow river water samples can be divided into two groups southern yinchuan plain sy the southern area of yinchuan s lower boundary and middle part of yinchuan plain my the area surrounded by upper and lower boundaries of yinchuan city from the south to the middle of the yinchuan plain the main hydrochemistry type changed from hco3 so4 ca na mg to so4 hco3 na ca mg and the tds changed from 0 428 g l to 0 472 g l indicating that there exists a certain degree of evaporation the water from the diversion canal comes from the yellow river and is mainly used for farmland irrigation which has larger ions than those of the yellow river indicating that evaporation and condensation have occurred during the irrigation of yellow river the hydrochemical types of the three groups of samples from west to east were hco3 mg ca na hco3 so4 cl ca na and so4 hco3 cl mg na ca tds from 0 444 g l to 0 776 g l some differences in the main ions in the diversion canal have been found which probably caused by the relatively large influences of the human activity in the eastern part of the study area the dominant cation of drainage ditch water samples is na with so4 cl na mg and so4 cl hco3 na mg as main hydrochemical type which may be caused by the different source of the drainage ditch water in yinchuan plain li 2007 it can be seen that tds of lake water samples range between 0 542 and 9 924 g l with an average of 1 94 g l na is the dominant ion and the main hydrochemical type is so4 cl na mg 29 4 so4 hco3 cl na mg 23 5 and hco3 cl so4 na mg 23 5 in arid areas the stable isotope compositions of lake water will be subjected to evaporation kebede et al 2009 qian et al 2013 which in turn resulted in increase of the of ions concentration 4 1 2 groundwater 1 single phreatic water aquifer the single phreatic aquifer mainly includes two parts a1 zone and a2 zone ph value of groundwater varies from 7 02 to 8 37 namely neutral alkaline water tds value of most samples in a1 zone and a2 zone is less than 1 g l which belongs to fresh groundwater the variation range of the total cation milligram equivalent concentration in the a1 region is 3 87 34 4 meq l the cation is dominated by ca2 and mg2 and the anion is dominated by hco3 followed by so4 2 because a1 region is characterized by good permeability high porosity a large hydraulic gradient and less anthropogenic activities the groundwater hydrochemistry type is mainly hco3 so4 ca mg and so4 hco3 ca mg fig 4 a while the total cation concentration in a2 zone ranges from 9 89 to 81 32 meq l which is larger than that of a1 zone in this area na is slightly dominant in the water samples accounting for 6 8 80 8 of total cation and followed by ca2 with percentage 4 48 1 the anion is also dominated by hco3 the main types of hydrochemistry are hco3 na and hco3 ca mg fig 4b it can be seen in fig 5 that the variation coefficient of na in a2 zone is 124 8 indicating that it is significantly affected by human activities 2 multi layered structure zone 1 phreatic aquifer in multi layered structure zone a3 zone compared to a single phreatic area groundwater runoff from a3 zone is weak and the groundwater hydrochemistry is dominated by evaporation which results in the increase of tds and poor water quality most areas have a salinity of 1 3 g l and the highest value reaches up to 5 55 g l a3 zone is moderately affected by anthropogenic activities and the characteristics of water chemistry are complex and diverse this conclusion can also be drawn from the coefficient of variation cv of conventional indicators in the a3 zone in fig 5 the cation concentration ranges from 4 14 to 260 57 meq l from the piper diagram presented fig 6 a the water samples for a3 zone is located in the lower right center of the left cation triangle while the water samples in the cation triangle is mainly concentrated in the lower left indicating the anion is dominated by the bicarbonate followed by the sulfate and chloride while the cation is dominated by sodium followed by magnesium and calcium there are 12 hydrochemical types hco3 so4 mg ca 8 1 hco3 so4 mg na 7 6 hco3 so4 ca na 7 3 hco3 so4 na mg 5 7 hco3 so4 ca mg 4 6 cl so4 na mg 4 1 hco3 so4 na mg 3 8 so4 cl na mg 3 5 hco3 so4 na ca 4 3 cl so4 na 3 0 so4 hco3 na mg 2 7 and hco3 cl na mg 2 4 respectively 2 upper confined aquifer the upper confined aquifer is the main supply of living and industrial water in yinchuan plain since there are few monitoring points on the conventional data collected in upper confined aquifer which is buried deeply compared with the phreatic water so human activities will exert less impacts on it so we can refer to the previous studies zhang 2015b qian and li 2011 wang 2005 it can be seen in fig 6b that the water samples of upper confined water in the cationic triangle presents approximately 135 which is biased toward the side of the sodium ion and is relatively deficient in calcium and magnesium ions although the anionic triangles are sparsely distributed on the whole bicarbonate is the dominant anion the main anion combination are mainly hco3 so4 hco3 cl and cl so4 and the cation combination is na mg mg na and na ca type some of the samples in study area opened to both the confined and semiconfined parts of the aquifer system and wells with corroded casings allowed for the groundwater mixing from distinct aquifers during extraction when this happens the water in the upper confined aquifer presents the same type as that in the phreatic aquifer 4 2 stable isotopic characteristics stable water isotopes of hydrogen δ2h and oxygen δ18o provide a useful and increasingly applied tool for integrating hydrological process information across various scales mcdonnell and beven 2014 4 2 1 δ18o and δ2h 1 precipitation and surface water δ18o and δ2h of 11 yellow river samples and other surface samples are plotted in fig 7 a it can be seen from fig 7a that the slope of the atmospheric water line k 7 21 and the intercept of the yinchuan area su et al 2003 is significantly different from global meteoric water gmwl it is due to the arid and semi arid climate with low humidity small rainfall and intensive evaporation wang 1991 meanwhile local meteoric water line lmwl is controlled by other local hydrometeorological factors such as the origin of the vapor mass although the local precipitation line does not coincide with the gmwl the weighted average of hydrogen and oxygen stable isotope is aligned with gmwl the samples collected in the yellow river all lie below the lmwl compared with the lmwl the yellow river water isotopes are enriched in heavy isotopes and are located near the local atmospheric precipitation lines indicating that the water of the yellow river is recharged by atmospheric precipitation and has undergone an intensive evaporation and condensation the weighted averages of atmospheric precipitation is isotopically enricher than that of yellow river water indicating that the recharge source of the yellow river water is located at a high latitude area which is in accordance with the fact that the yellow river water is originated from the qinghai tibet plateau the lake water samples lie below the local precipitation line with a slope of the trend line 5 24 r2 0 6931 indicating it has undergone evaporation and enrichment process the water samples of lake water are scattered in the study area because of different recharge sources infiltration from drainage ditches to the groundwater accounts for nearly 30 85 of the total recharge the distribution of drainage ditches water samples is relatively dispersed which is also related to the main recharge source qian et al 2013 2 groundwater single phreatic zone as it was addressed in previous section the single phreatic aquifer mainly includes two parts a1 zone and a2 zone generally speaking the phreatic water samples deviate from the lmwl fig 7b indicating the multiple recharge sources besides precipitation the isotope compositions of δ18o and δ2h in the a1 zone range 10 72 to 8 6 and 79 6 to 68 73 with average of 9 85 and 75 49 respectively while those in the a2 zone are 9 45 to 8 6 79 0 to 69 5 with average 10 23 and 78 72 respectively multilayer structure zone the samples in phreatic aquifers in multilayer structure zone a3 zone are more scattered than those in a1 and a2 zone the δ18o values vary from 7 20 to 11 43 with an average of 9 30 and δ2h values vary from 61 5 to 93 9 with averages of 77 2 in general most water samples in a3 zone is close to the lmwl and the yellow river water samples indicating that it is recharged by atmospheric precipitation and yellow river water leakage of irrigation channel and percolation of irrigation water however some water samples in a3 zone are deviated from the lmwl and the yellow river water samples indicating that there exists an intensive evaporation and condensation processes in a3 zone meanwhile there are three water samples with relatively low concentrations due to the leakage of upper confined aquifer into the phreatic aquifer the upper confined water is the main source for domestic and industrial purposes in the yinchuan plain δ2h and δ18o contents in the upper confined water are lower than those of the phreatic water in a1 a2 and a3 zone the isotope compositions of the existing water recharge sources cannot explain well the source of the upper confined water so the upper confined water probably was recharged by paleowater in a geological historical period with different climatic conditions 4 2 2 tritium the 2h and 3h diagrams of water body fig 8 illustrates that the water content in the yellow river is the highest and the minimum value is also greater than 22tu indicating that it was closely related with the exchange of atmospheric moisture moreover some samples have lower 3h than the detection limit indicating that the two surface water bodies mainly receive groundwater discharge especially the drainage ditch water has the lowest tritium 3h the 2h and 3h content in groundwater follows the order of a3 zone a2 zone a1 zone upper confined water and shows a decrease tendency with the increase of groundwater buried depth on the one hand the modern water irrigated by yellow river mainly participates in the shallow cycle the less modern water is found in deep circulation on the other hand the possible reason is the groundwater recharged by deep groundwater for the historical period yin et al 2010 lower global temperature less isotope value or the fractured water in the bedrock of the mountain area the difference of 3h also indicates that there are variations in their recharge sources 5 results and discussion 5 1 effects of anthropogenic activities yinchuan plain has a long history of agricultural development and is also the center of economic and political culture in ningxia hui autonomous region however with the socio economic development human activities impose intensive impacts on groundwater environment which can be reflected in three aspects groundwater pollution excessive exploitation or excretion of groundwater and excessive groundwater replenishment li 2014 5 1 1 groundwater pollution the phenomenon of groundwater pollution caused by anthropogenic activities is very universal all over the world according to the monitoring results of 195 cities in china 97 of the urban groundwater has been polluted with different degrees zhang 2015a according to their spatial distribution the sources of groundwater pollution can be classified into point pollution sources line pollution sources and non point arearal pollution sources compared with point pollution sources non point source pollution has a large spatio temporal range remarkable uncertainty and the complexity of the composition and mechanism process therefore this article focuses on the non point source pollutant nitrogen mainly including nh4 n no3 n and no2 n in agricultural area the conversion relationship among the three components follow a chemical reaction rule which is expressed as 1 nh 4 1 5 o 2 no 2 h 2 o 2 h 2 2 no 2 0 5 o 2 no 3 it should be noted in table 2 that no2 of 3 water samples exceeded the limits of the iii quality standard of groundwater 0 1 mg l therefore nh4 and nitrate are selected as the representative pollutants for the samples from the phreatic aquifer 50 10 9 and 90 19 6 water samples exceeded the limits of the iii quality standard of groundwater in the no3 20 mg l and nh4 0 5 mg l with mean values of 6 8 mg l and 0 38 mg l respectively nh4 n pollution in the phreatic water is more serious mainly distributed in the central and northern parts of the multi layer structural area fig 9 b in these areas the content of nitrate is relatively small which may derived from the direct supply of nh4 n and denitrification in agricultural areas urea co nh2 2 ammonium bicarbonate nh4hco3 et al are widely used in order to increase the crop yield the average nitrogen fertilizer application rate per ha of cultivated land reached to 832 81 kg which was far beyond the average rate in high fertilizer input region of china 339 kg ha chen et al 2016 meanwhile broad irrigation approach makes n nutrients in the form of nh4 n prone to leaching into the phreatic water where the buried depth is relatively small it can be seen in fig 9c that the samples exceeding the nitrate limits of the iii quality standard are mainly distributed in the southern and northern regions of a single phreatic aquifer and the content of nh4 n was relatively small the main reason is that nh4 n is rapidly transformed into no3 n by nitration under the suitable oxidation conditions according to the isotope data of δ15n and δ18o it is known that the main source of no3 n is a mixture of synthetic fertilizer and manure sewage in groundwater and hydrological conditions are the primary controlled factors in the nitrogen species nh4 n and no3 n at the same time there exists a certain denitrification occurring in the yinchuan plain chen et al 2017 consequently inappropriate use of fertilizer flood irrigation approach manure sewage and vulnerable environment have resulted in increasing the risk of nitrogen pollution posing great pressure on the environment 5 1 2 excessive groundwater recharge in yinchuan plain the yellow river water has been the primary irrigation source for farmland thus a large amount of irrigation return flow is produced which in turn will result in rising of the phreatic water level according to the previous research because people lack of awareness of environmental protection backwardness of irrigation equipment and imperfect scientific management system the salinity of canal leakage system supply and the recharge of agricultural irrigation and infiltration accounted for 81 69 of the recharge of groundwater ningxia geological engineering survey institute 1995 lu 2010 qian et al 2013 and the phreatic evaporation accounted for 55 37 of the total discharge fig 10 5 1 3 excessive groundwater exploitation the upper confined aquifer in the study area is the main groundwater supplier for domestic and production purposes in yinchuan plain due to the lack of reasonable planning for a long period of water exploitation a large amount of extraction without a timely recharge has resulted in the depression cone in some areas especially in the xincheng area of yinchuan city where the content of 3h is high 45 49 2 33 tu indicating that it has been recharged by modern water meanwhile the concentration of the conventional ions in the depression zone is between the phreatic water samples and the upper confined water samples fig 11 indicating that the mixing of the phreatic water and upper confined water occurred this mixture process causeed the water quality deterioration of the upper confined water 5 2 natural factors of hydrochemical formation 5 2 1 formation mechanism of groundwater to interpret the hydrochemistry formation mechanism the qualitative analysis is carried out based on the widely used method gibbs diagram 1970 which reflect the dominant processes of precipitation rock weathering or evaporation in dry regions it can be observed in fig 12 b that the ratios of cl cl hco3 were mostly less than 0 5 with low tds in a1 and a2 zone of upper confined water indicating that rock weathering was the dominant mechanism which reflects the natural factors however samples in a3 zone was mainly located on the upper right of the diagram with cl cl hco3 ratio greater than 0 5 and tds between 267 and 7616 mg l which showed that the groundwater chemistry was not only controlled by rock weathering and or precipitation but also by evaporation crystallization xing et al 2013 however for the sample of both phreatic aquifer and upper confined aquifer fig 12a the weight ratio of na na ca2 shows a wide variation range without obvious change of tds which indicated that the cation exchange also played an important role by increasing na and decreasing ca2 under the background of rock dominance liu et al 2015 5 2 2 natural factors affecting groundwater hydrochemistry 5 2 2 1 geological and hydrogeological conditions geological and hydrogeological conditions such as the differences of groundwater depth topography and the lithology of rock strata play a key role in determining groundwater chemical components compared with the multilayer structural area the single phreatic area has larger porosity better permeability faster runoff and stronger alternation of water cycle therefore in such situation the content of ca2 and mg2 in groundwater is higher than that phreatic aquifer in the multilayer structural zone while the content of na so4 2 and tds is lower than that of multilayer structural zone meanwhile the groundwater residence time increases and the depth of along phreatic aquifer decrease along the flow direction and groundwater is more likely to suffer an intensive evaporation and condensation thereby promoting the accumulation of salinity 5 2 2 2 groundwater recharge as it was mentioned in previous section there are many recharge sources of phreatic aquifer in the multilayer structural zone a3 zone in yinchuan plain such as channel leakage irrigation seepage and precipitation et al meanwhile fissure water from bedrock of helan mountain can be another recharge source in a1 zone significant differences can be detected in the chemical compositions of water from different recharge sources table 1 it can be seen that the main anions in the local precipitation mean precipitation is hco3 while the cation is dominated by mg2 the chemical types of yellow river are mainly hco3 so4 and so4 hco3 with an average of tds 0 444 mg l the groundwater in the helan mountain is recharged by precipitation and the aquifer is mainly composed of metamorphic and carbonate rocks with low solubility so the tds of groundwater is low which means fissure water in bedrock is fresh water generally speaking the phreatic water samples deviate from the lmwl fig 7b indicating its multiple recharge sources besides precipitation further the average value of δ18o and δ2h follows the order a3 a2 a1 a1 zone is usually recharged by precipitation and bedrock fissure water of the helan mountain spring water and its recharge volume accounts for 66 5 and 33 5 respectively according to linear end member mixing model qian et al 2013 a2 zone mainly receives spring and the irrigation return flow accounting for 25 6 and 74 4 respectively a3 zone is mainly distributed in the pluvial alluvial plain and alluvial lack depositional plain where farmland can be seen everywhere and infiltration from irrigation water is the most important groundwater recharge source precipitation is also an important source of recharge compared to other sources of recharge therefore the ratio of the two main sources of supply in the a3 area is about 12 1 5 2 2 3 evaporation condensation and the dissolution of minerals the qualitative analysis of the groundwater formation gibbs diagram indicates that the samples of phreatic aquifer are mainly controlled by two natural processes rock weathering and evaporation in the following part deuterium surplus and tds in water are used to quantitatively calculate the contribution rates of two factors to salinity of groundwater 1 salinity and deuterium surplus d value the study area is situated in the continental arid and semi arid climate which is favorable to evaporation condensation of groundwater the essence of evaporation condensation is to drain the water without changing the amount of salt in the groundwater on the contrary the dissolution of minerals will increase the hydrochemical composition of groundwater but the water content does not decrease therefore tds was used as the x axis to study the effects of condensation and mineral dissolution fig 13 deuterium surplus d proposed by dansgaard 1964 is one of the most important indicators characterizing atmospheric precipitation in comprehensive environmental factors it can reflect directly the imbalance degree in the evaporation and condensation of atmospheric precipitation and when a water body undergoes evaporation the d excess will decrease and the salinity will increase with a negative correlation since the d excess in the process of evaporation is not related to the initial isotope composition of the original water it is often employed to evaluate the evaporation effect on groundwater meanwhile rock weathering include leaching does not change the isotope value in groundwater so d excess is used as y axis for this study fig 13 which can be calculated by the following formula 3 d δ 2 h 8 δ 18 o it is observed in fig 13 that the evaporation of lake water samples is stronger than phreatic samples and the d excess of the lake water is not densely distributed it may be the difference in the recharge source of the lake water in different geographical locations tds of phreatic samples a1 a2 and a3 zone demonstrates the opposite relationship to order of d excess in a1 zone there are four samples of groundwater s 6 s 7 s 16 and s 27 with smaller tds and bigger d excess due to the fact that the buried depth is large nearly without evaporation process and other samples were subjected to different degrees of evaporation in a2 zone s 1 and s 2 have smaller d excess value probably because the samples are closer to the yellow river where the water table is small however tds of s 13 sample is greater than most of the water samples in the phreatic aquifer the reason is that the sample is located near the industrial chemical plant where a large amount of sewage containing sulfuric acid was produced which results in a large tds in the groundwater 2 salinization mechanism under natural conditions the salinity of groundwater mainly comes from the source of recharge the mineral dissolution and or transpiration and the evaporation condensation therefore when a given water body with a salinity of s0 undergoes evaporation and the remaining fraction of the water body is f the evaporation condensation makes the salinity increase to s0 f and evaporation contributes a salinity of s0 f s0 the contribution of mineral dissolution and or transpiration d contributes the total salinity s the contribution ratio of evaporation concentration to the total salinity is s0 f s0 s and the contribution of the mineral dissolution and or transpiration to the total salinity is 1 s0 sf respectively huang and pang 2012 in this paper the process of calculating f uses the average temperature of 8 92 c and the relative humidity of 55 the percentage of each recharge to the total recharge is set as the weight and the total tds and d excess can be obtained according to the d excess and tds of each recharge source the total d excess and tds in a1 zone a2 zone and a3 zone are 7 64 0 14 g l and 8 8 0 38 g l and 9 6 0 38 g l respectively and the calculation results are listed in table 3 the contribution rate of mineral dissolution in a1 zone a2 zone and a3 zone are 72 87 25 55 6 and 32 36 90 49 while the contribution rate of evaporation is 0 9 6 5 and 4 82 a1 zone mainly receives the atmospheric precipitation and the bedrock fissure water recharge while the groundwater depth is relatively large constituting a relatively closed system which is favorable for the accumulation of the dissolved minerals there are still water samples that were not influenced by evaporation which is consistent with the actual situation in the study area however a2 zone is closely related to the yellow river such open system is not favorable for accumulation of minerals dissolution in a3 zone the particle size of sediments permeability and groundwater flow velocity generally decrease from southwest to northeast with the increase of groundwater residence time along flow path some interactions with surrounding environment will result in an increase in salinity meanwhile the depth of water table becomes smaller which is beneficial to the evaporation although the contribution of evaporative enrichment to groundwater salinity is less than that of a2 zone the f mean value of o a2 zone is 0 88 indicating that the overall evaporative intensity of a3 zone is greater than that of a2 zone which is consistent with previous studies qian and li 2011 the share of the remaining water f in a3 zone is generally proportional to the vertical distance from the sample to the yellow river fig 14 that is the farther away from the yellow river water the greater the value of the remaining water share f but due to its topography and land cover the differences in conditions such as lithology groundwater depth and surface vegetation affect the evaporation process of the groundwater so the variation of f is less obvious 5 2 2 4 ion exchange and adsorption cation exchange and adsorption denotes the process of particle release of a certain media into groundwater and its inverse process the cations in groundwater will be absorbed by media this phenomenon is a common reaction in the geochemical evolution of groundwater which influences the major ion composition of groundwater it is essential to know and identify the various changes under the influence of anthropogenic activities schoeller proposed using the chloral alkali index cai to analyze cation exchange and adsorption between the groundwater and its host environment during residence or travel which is expressed as 4 cai 1 c l n a k c l 5 cai 2 c l n a k hc o 3 s o 4 2 c o 3 n o 3 if ion exchange between ca2 or mg2 in the groundwater and na or k occurs in the alluvium or in weathered materials both indices are negative and vice versa meanwhile formula 3 is also commonly used to study the analysis of cation exchange reactions in which the molecule represents the increased or decreased amount of na apart from na produced by the dissolution of halite minerals the denominator means that in addition to ca2 and mg2 produced by the dissolution of gypsum calcite and dolomite minerals other factors affect the increase or decrease of both farid et al 2013 if the cation exchange reaction plays a major role in the chemical composition of the water in the groundwater system then a linear relationship expressed with eq 6 with the slope close to 1 0 is present 6 n n a k c l c a 2 m g 2 h c o 3 s o 4 2 it can be seen from fig 15 a that the positive ion exchange reaction in the a1 zone may be caused by precipitation and spring recharge and the cations in the groundwater are dominated by ca2 and mg2 and after passing through the na containing rocks which led to exchange reactions increased na in groundwater however in the a2 zone the negative ion exchange reaction is dominant which may be due to the large na content displacing part of ca2 in the rock there are both positive and negative ion exchange reactions in the a3 zone which can be written in formulas 4 and 5 for a3 zone positive cation alternating adsorption slightly dominated accounting for 73 7 of the total samples the main reason is that the lithology of the phreatic aquifer is gradually tapering and the content of silt is increasing from the edge of the basin to the center of the basin and from south to north making the ion exchange reaction become intense but there is a certain difference in the intensity of the exchange the slopes and correlation coefficients of the fitting curves of the water samples in the a1 zone a2 zone and a3 zone were 0 78 r2 0 8535 0 95 r2 0 9627 and 0 81 r2 0 9135 indicating that the element na ca2 and mg2 essentially participate in the ion exchange reaction fig 15b the difference between the actual and theoretical values also implies that the cation exchange reaction is not the sole process affecting the content of the three ions other factors affecting the ion content can exist such as the discharge of sewage in anthropogenic activities the large scale mining of groundwater and the recharge runoff and discharge etc 7 c a 2 m g 2 n a 2 x c a 2 m g 2 x 2 n a 8 c a 2 m g 2 x 2 n a c a 2 m g 2 n a 2 x 6 conclusions a combined application of hydrchemical indicators and stable isotope characterization are performed to interpret the geochemcial evolution mechanism of groundwater under the influences of anthropogenic activities in the yinchuan plain the conclusive remark are summarized as follows groundwater chemistry type of phreatic water demonstrates a zonational characteristics from west to east and from south to north in a1 zone and a2 zone the type of hydrochemistry is mainly hco3 so4 ca mg so4 hco3 ca mg and hco3 na hco3 ca mg respectively in a3 zone the characteristics of water chemistry are complex and diverse due to the anthropogenic activities the anion is dominated by the hco3 followed by the so4 and cl while the cation is dominated by sodium followed by magnesium and calcium the isotope compositions of the phreatic water a1 zone a2 zone and a3 zone suggest that there exist some differences in the recharge sources a1 zone is predominantly recharged by the bedrock fissure water of helan mountain and the precipitation contributes less to the total recharge a2 zone receives irrigation return flow and spring recharge the irregular isotopic characteristics of a3 zone water reflect multiple recharge sources the 3h contents of phreatic water follow the order a3 zone a2 zone a1 zone hydrochemical and isotopic interpretation shows that the hydrochemical compositions of the groundwater are controlled by anthropogenic activities and natural conditions anthropogenic activities responsible for the deterioration of groundwater quality can be classified as groundwater pollution excessive exploitation of groundwater and excessive groundwater recharge natural factors mainly include geological and hydrogeological conditions of study area sources of groundwater recharge soil salinity and evaporation effect mineral dissolution cation exchange and mixing effect meanwhile among natural factors minerals dissolution is the main process responsible for the hydrochemical evolution of the groundwater under the context of a large number of anthropogenic activities the results of the present study can provide some practical implications for water resources management strategy in terms of groundwater exploitation an appropriate extraction increase of phreatic water could be beneficial to the accelerate groundwater circulation and control salinization and swampiness in the study area however the confined aquifer has a relatively low renewal ability more attention should be given in alleviating negative environmental effects by decreasing the extraction quantity therein declaration of competing interest the authors declare no conflict of interest acknowledgement this work is financially supported by the open fund from the key lab of eco restoration of regional contaminated environment shenyang university ministry of education the financial support from comprehensive geological survey of economic zones along huang river in ningxia province no 121201011000150017 scientific and technological development program of jilin province china 20180520092jh and national priority research project pollution mechanism and treatment technology of field soil no 2018yfc1800404 are also acknowledged we want to thank editor marco borga and anthony kiem also three anonymous reviewers for their valuable comments which help to improve greatly the paper quality 
6320,groundwater resources are increasingly exploited for industrial and agricultural purposes in many arid semi arid regions globally in order to gain a harmonious development among groundwater resources and economic benefits urgent investigation of the impacts of anthropogenic activities on the groundwater chemistry is required understanding hydrochemical mechanism of groundwater in yinchuan plain arid and semi arid area in northwestern china plays a significant role in water resources planning in this ecologically sensitive area in this paper a total of 460 phreatic water samples were collected including 58 water samples containing isotopic data d and 2h results demonstrate that water chemistry type and isotopic data of phreatic water presents a zonation characteristic from west to east and from south to north in the eastern part of the helan mountain a1 zone the type of hydrochemistry is mainly hco3 so4 ca mg so4 hco3 ca mg which is mainly recharged by the bedrock fissure water of helan mountain however in the southern qingtongxia a2 zone are hco3 na hco3 ca mg which receives irrigation and spring water recharge phreatic aquifer in multi layered structure zone a3 zone reflect multiple recharge sources to the aquifer the water chemistry demonstrates diverse variations the anion was dominated by the hco3 while the cation is dominated by sodium the predominant controlling factors of phreatic water hydrochemistry are divided into anthropogenic activities and natural conditions natural conditions mainly include the existence form and lithology of the aquifer sources of groundwater recharge soil salinity and evaporation mineral dissolution ion exchange and adsorption and mixing effect meanwhile among natural factors minerals dissolution in groundwater is the main process dominating the hydrochemical evolution of the groundwater the other is anthropogenic activities which can be classified as groundwater pollution excessive exploitation or excretion of groundwater and excessive groundwater recharge keywords hydrochemical mechanism anthropogenic activities hydrochemistry isotope groundwater 1 introduction water chemistry can be used to assist in understanding the effects of natural and anthropogenic activities skrzypek et al 2013 liu et al 2015 selvakumar et al 2017 the study of hydrochemical processes and the factors affecting water quality can all help us have a better understanding of the governing mechanism of the groundwater hydrochemistry mohanty et al 2019 stable isotopes of 18o 2h and 3h and hydrogeochemical indicators usually are considered to be robust in identifying the hydrochemical processes mohammed et al 2018 martinez et al 2015 especially in semi arid and arid region zang et al 2018 yang et al 2016a 2016b h and o stable isotopes are ideal tracers of water sources and movement because they are constituents of the water molecules akiti 1986 at different phrases of the hydrological environment the content of these components are will vary due to the fractionation of isotopes hydrogeochemical indicators in different water bodies can provide information on the geochemical reaction within the aquifer and the possible evolutionary pathways of groundwater cook and herczeg 1999 yinchuan plain is located in the arid to semi arid area of northwest china it is one of the oldest irrigation areas supplied by yellow river with the population growth and increasing agricultural activities there is an ever growing demand for fresh water zhou et al 2016 however long term and large scale discharge of industrial waste water and domestic sewage excessive use of pesticides and fertilizers have given rise to a certain degree of groundwater pollution in the yinchuan plain chen et al 2017 zhang 2015a meanwhile unreasonable exploitation and utilization of groundwater has resulted in a series of water related environmental geological problems li and wu 2010 fang and chen 2001 it is well known that many important ecological processes can be disrupted by changes in groundwater chemistry amalfitano et al 2014 lorenzo et al 2015 therefore a sustainable utilization groundwater resources strategy requires a deeper understanding of hydrochemical formation mechanism of groundwater in order to guarantee reliable supply for the various purposes various studies on groundwater hydrochemistry in yinchuan plain have been conducted sun et al 2008 qian et al 2013 jing et al 2014 zhang 2015b yang et al 2018 based on the hydrochemical data wang 2005 found that the changes in the chemical compositions of groundwater in yinchuan plain are predominantly controlled by the chemical properties of groundwater recharge source water rock interactions mixing effects evaporation and condensation and the soil salinization in the region qian and li 2011 investigated the natural factors of controlling the groundwater compositions zhang 2015b found that the factors determining groundwater hydrochemical components mainly include natural processes and anthropogenic activities however the impacts of anthropogenic activities on the groundwater hydrochemistry were not addressed in depth the yinchuan plain is a good illustration of such areas where groundwater hydrochemistry is affected by the combined process of natural and anthropogenic activities zhou et al 2016 wu et al 2016 chen et al 2018 however previous researches mainly focus on investigating the natural processes without in depth study of anthropogenic activities and some key processes were not emphasized properly which involves 1 the possible differences among the different recharge sources within the study area were not considered 2 as the dominant natural controlling processes mineral dissolution and evaporative condensation actions was not well interpreted therefore in order to obtain a comprehensive understanding of groundwater hydrochemistry evolution in yinchuan plain it is a prerequisite to identify the impacts of natural factors and anthropogenic activities on the groundwater hydrochemistry the main objectives are 1 to interpret the hydrochemical formation mechanism 2 to distinguish the major anthropogenic activities and natural factors and 3 to quantify the contribution of mineral dissolution evaporation and transpiration factors under the context of a large number of anthropogenic activities the results of the present study will be valuable in obtaining a deeper insight into groundwater chemistry and accordingly water resources management strategy 2 study area yinchuan plain is located in the nw china between 105 45 106 56 and 37 46 39 23 n the western margin of the plain is the helan mountain connecting a series of normal slip faults the eastern margin of the plain connects with the yellow river and adjacents with the ordos platform the south of the plain is bordered by the en fault of the niushou mountain the plain covers yinchuan city shizuishan city and wuzhong city fig 1 the climate of study area has a typical continental arid to semi arid climate characterized by less rain strong evaporation and dry climate qian et al 2011 the average monthly temperature varies from 7 73 c in january to 23 63 c in july and the average annual temperature is 8 92 c in addition the annual mean precipitation amount is 186 7 mm and is mainly concentrated in june september which accounts for more than 68 1 of the total annual precipitation amount the potential annual evaporation amount is 1838 44 mm ningxia geological engineering survey institute 1995 wang 2005 jing et al 2010 which is about 10 times as much as the rainfall the water resource in yinchuan plain is mainly supplied by yellow river which is located in the east of the plain with a total length of about 191 km and has a significant influence on the development of the topography and geomorphology in the plain fig 1 in addition the yellow river in yinchuan plain is a perennial river with large sediment concentration and an average salinity of 0 4 g l qian and li 2011 zhou et al 2016 at the same time by the innate superiority of irrigation many irrigation channels and discharge ditches stretch all over the plain and large numbers of lakes and swamps can be seen in study area fig 1 meanwhile yinchuan plain has been intensively irrigated for over 2000 years and supports traditional farming activities there is no doubt that without anthropogenic activities over the past 2000 years yinchuan plain would never be as prosperous as it is now chen et al 2018 yinchuan plain is formed by river lake and flood deposition over a cenozoic fault basin qian et al 2013 mainly including alluvial and diluvial deposition formed in the east and west of the basin close to the two blocks containing 7000 m of cenozoic sediments overlain by about 2000 m of weakly consolidated quaternary material wu et al 2008 qian and li 2011 zhang 2015b geological mapping reveals a zonal distribution of landforms extending from the foot of helan mountain in the northwest to the yellow river in the southeast fig 1 the general topography is a leaning pluvial plain a pluvial alluvial plain and subsequently to an alluvial lacustrine plain as the river is approached the groundwater in the study area is porous water stored in the unconsolidated sediments which can be divided into two areas a single phreatic water area and a multilayer structure area based on the geological geomorphologic and hydrogeological conditions and drilling data fig 2 a it is found that the single phreatic water area mainly distributes in the western and southern parts of the plain composed of pluvial deposits from helan mountain and alluvial sand gravel in qingtongxia and others areas are mostly characterized by a multilayer structure which can be divided into shallow groundwater 0 50 m top deep groundwater 50 150 m and bottom deep groundwater 150 300 m according to the depth of aquifer groundwater as the primary source of domestic and industrial purposes is mainly supplied by irrigation infiltration water in the plain fig 1 and the recharge from return flow of irrigation water amounts for over 80 of the total recharge to the phreatic aquifer ningxia geological engineering survey institute 1995 lu 2010 qian et al 2013 jing et al 2014 the runoff is influenced by topography lithology of soils and other natural and human factors and the phreatic water flows from southwest to northeast controlled by terrain the groundwater from precipitation infiltration supply near the basin still runs off towards the basin and is finally drained to lakes or yellow river the main discharge of shallow water is evaporation due to the arid climate accounting for more than 45 of the total discharge lu 2010 chen et al 2018 3 data collection a total of 460 phreatic water samples were collected for hydrochemical analysis fig 2a which was grouped into three classes based on the hydrogeological conditions namely a1 zone the eastern part of the helan mountain 70 samples a2 zone the southern qingtongxia 37 samples and a3 zone phreatic aquifer in multi layered structure zone 353 samples fig 2b among them 12 samples in a1 zone 9 samples in a2 zone and 37 samples in a3 zone were selected for stable isotope analysis 3 samples of diversion canal water contained conventional components which are located in tanglai channel xigan channel and huinong channel from east to west 30 groups of precipitation data which were downloaded from the global atmospheric precipitation monitoring data and materials of international atomic energy agency iaea are included in this paper the weighted means of isotopes weight is the proportion of each monitoring station to the study area δd and δ18o in atmospheric precipitation in yinchuan area are 45 59 and 6 93 besides precipitation isotopic data and hydrochemical analysis of other water bodies are also collected including 11 yellow river water samples 17 lake water samples and 37 upper confined water samples fig 1 4 data analysis 4 1 hydrochemical characteristics 4 1 1 precipitation and surface water atmospheric precipitation is the original input of groundwater and surface water meanwhile surface water also directly or indirectly recharge groundwater therefore understanding of hydrochemical characteristics of precipitation and surface water in yinchuan plain is the prerequisites of investigating the groundwater hydrochemisty in this paper a descriptive statistical analysis of precipitation and surface water chemical composition in yinchuan plain were summarized in table 1 and piper diagram was illustrated in fig 3 it can be seen from fig 3 that the main anion in the local precipitation mean precipitation is hco3 while the cation is dominated by mg2 followed by ca2 and the hydrochemistry type is hco3 mg ca with low tds wang 2005 the yellow river water samples can be divided into two groups southern yinchuan plain sy the southern area of yinchuan s lower boundary and middle part of yinchuan plain my the area surrounded by upper and lower boundaries of yinchuan city from the south to the middle of the yinchuan plain the main hydrochemistry type changed from hco3 so4 ca na mg to so4 hco3 na ca mg and the tds changed from 0 428 g l to 0 472 g l indicating that there exists a certain degree of evaporation the water from the diversion canal comes from the yellow river and is mainly used for farmland irrigation which has larger ions than those of the yellow river indicating that evaporation and condensation have occurred during the irrigation of yellow river the hydrochemical types of the three groups of samples from west to east were hco3 mg ca na hco3 so4 cl ca na and so4 hco3 cl mg na ca tds from 0 444 g l to 0 776 g l some differences in the main ions in the diversion canal have been found which probably caused by the relatively large influences of the human activity in the eastern part of the study area the dominant cation of drainage ditch water samples is na with so4 cl na mg and so4 cl hco3 na mg as main hydrochemical type which may be caused by the different source of the drainage ditch water in yinchuan plain li 2007 it can be seen that tds of lake water samples range between 0 542 and 9 924 g l with an average of 1 94 g l na is the dominant ion and the main hydrochemical type is so4 cl na mg 29 4 so4 hco3 cl na mg 23 5 and hco3 cl so4 na mg 23 5 in arid areas the stable isotope compositions of lake water will be subjected to evaporation kebede et al 2009 qian et al 2013 which in turn resulted in increase of the of ions concentration 4 1 2 groundwater 1 single phreatic water aquifer the single phreatic aquifer mainly includes two parts a1 zone and a2 zone ph value of groundwater varies from 7 02 to 8 37 namely neutral alkaline water tds value of most samples in a1 zone and a2 zone is less than 1 g l which belongs to fresh groundwater the variation range of the total cation milligram equivalent concentration in the a1 region is 3 87 34 4 meq l the cation is dominated by ca2 and mg2 and the anion is dominated by hco3 followed by so4 2 because a1 region is characterized by good permeability high porosity a large hydraulic gradient and less anthropogenic activities the groundwater hydrochemistry type is mainly hco3 so4 ca mg and so4 hco3 ca mg fig 4 a while the total cation concentration in a2 zone ranges from 9 89 to 81 32 meq l which is larger than that of a1 zone in this area na is slightly dominant in the water samples accounting for 6 8 80 8 of total cation and followed by ca2 with percentage 4 48 1 the anion is also dominated by hco3 the main types of hydrochemistry are hco3 na and hco3 ca mg fig 4b it can be seen in fig 5 that the variation coefficient of na in a2 zone is 124 8 indicating that it is significantly affected by human activities 2 multi layered structure zone 1 phreatic aquifer in multi layered structure zone a3 zone compared to a single phreatic area groundwater runoff from a3 zone is weak and the groundwater hydrochemistry is dominated by evaporation which results in the increase of tds and poor water quality most areas have a salinity of 1 3 g l and the highest value reaches up to 5 55 g l a3 zone is moderately affected by anthropogenic activities and the characteristics of water chemistry are complex and diverse this conclusion can also be drawn from the coefficient of variation cv of conventional indicators in the a3 zone in fig 5 the cation concentration ranges from 4 14 to 260 57 meq l from the piper diagram presented fig 6 a the water samples for a3 zone is located in the lower right center of the left cation triangle while the water samples in the cation triangle is mainly concentrated in the lower left indicating the anion is dominated by the bicarbonate followed by the sulfate and chloride while the cation is dominated by sodium followed by magnesium and calcium there are 12 hydrochemical types hco3 so4 mg ca 8 1 hco3 so4 mg na 7 6 hco3 so4 ca na 7 3 hco3 so4 na mg 5 7 hco3 so4 ca mg 4 6 cl so4 na mg 4 1 hco3 so4 na mg 3 8 so4 cl na mg 3 5 hco3 so4 na ca 4 3 cl so4 na 3 0 so4 hco3 na mg 2 7 and hco3 cl na mg 2 4 respectively 2 upper confined aquifer the upper confined aquifer is the main supply of living and industrial water in yinchuan plain since there are few monitoring points on the conventional data collected in upper confined aquifer which is buried deeply compared with the phreatic water so human activities will exert less impacts on it so we can refer to the previous studies zhang 2015b qian and li 2011 wang 2005 it can be seen in fig 6b that the water samples of upper confined water in the cationic triangle presents approximately 135 which is biased toward the side of the sodium ion and is relatively deficient in calcium and magnesium ions although the anionic triangles are sparsely distributed on the whole bicarbonate is the dominant anion the main anion combination are mainly hco3 so4 hco3 cl and cl so4 and the cation combination is na mg mg na and na ca type some of the samples in study area opened to both the confined and semiconfined parts of the aquifer system and wells with corroded casings allowed for the groundwater mixing from distinct aquifers during extraction when this happens the water in the upper confined aquifer presents the same type as that in the phreatic aquifer 4 2 stable isotopic characteristics stable water isotopes of hydrogen δ2h and oxygen δ18o provide a useful and increasingly applied tool for integrating hydrological process information across various scales mcdonnell and beven 2014 4 2 1 δ18o and δ2h 1 precipitation and surface water δ18o and δ2h of 11 yellow river samples and other surface samples are plotted in fig 7 a it can be seen from fig 7a that the slope of the atmospheric water line k 7 21 and the intercept of the yinchuan area su et al 2003 is significantly different from global meteoric water gmwl it is due to the arid and semi arid climate with low humidity small rainfall and intensive evaporation wang 1991 meanwhile local meteoric water line lmwl is controlled by other local hydrometeorological factors such as the origin of the vapor mass although the local precipitation line does not coincide with the gmwl the weighted average of hydrogen and oxygen stable isotope is aligned with gmwl the samples collected in the yellow river all lie below the lmwl compared with the lmwl the yellow river water isotopes are enriched in heavy isotopes and are located near the local atmospheric precipitation lines indicating that the water of the yellow river is recharged by atmospheric precipitation and has undergone an intensive evaporation and condensation the weighted averages of atmospheric precipitation is isotopically enricher than that of yellow river water indicating that the recharge source of the yellow river water is located at a high latitude area which is in accordance with the fact that the yellow river water is originated from the qinghai tibet plateau the lake water samples lie below the local precipitation line with a slope of the trend line 5 24 r2 0 6931 indicating it has undergone evaporation and enrichment process the water samples of lake water are scattered in the study area because of different recharge sources infiltration from drainage ditches to the groundwater accounts for nearly 30 85 of the total recharge the distribution of drainage ditches water samples is relatively dispersed which is also related to the main recharge source qian et al 2013 2 groundwater single phreatic zone as it was addressed in previous section the single phreatic aquifer mainly includes two parts a1 zone and a2 zone generally speaking the phreatic water samples deviate from the lmwl fig 7b indicating the multiple recharge sources besides precipitation the isotope compositions of δ18o and δ2h in the a1 zone range 10 72 to 8 6 and 79 6 to 68 73 with average of 9 85 and 75 49 respectively while those in the a2 zone are 9 45 to 8 6 79 0 to 69 5 with average 10 23 and 78 72 respectively multilayer structure zone the samples in phreatic aquifers in multilayer structure zone a3 zone are more scattered than those in a1 and a2 zone the δ18o values vary from 7 20 to 11 43 with an average of 9 30 and δ2h values vary from 61 5 to 93 9 with averages of 77 2 in general most water samples in a3 zone is close to the lmwl and the yellow river water samples indicating that it is recharged by atmospheric precipitation and yellow river water leakage of irrigation channel and percolation of irrigation water however some water samples in a3 zone are deviated from the lmwl and the yellow river water samples indicating that there exists an intensive evaporation and condensation processes in a3 zone meanwhile there are three water samples with relatively low concentrations due to the leakage of upper confined aquifer into the phreatic aquifer the upper confined water is the main source for domestic and industrial purposes in the yinchuan plain δ2h and δ18o contents in the upper confined water are lower than those of the phreatic water in a1 a2 and a3 zone the isotope compositions of the existing water recharge sources cannot explain well the source of the upper confined water so the upper confined water probably was recharged by paleowater in a geological historical period with different climatic conditions 4 2 2 tritium the 2h and 3h diagrams of water body fig 8 illustrates that the water content in the yellow river is the highest and the minimum value is also greater than 22tu indicating that it was closely related with the exchange of atmospheric moisture moreover some samples have lower 3h than the detection limit indicating that the two surface water bodies mainly receive groundwater discharge especially the drainage ditch water has the lowest tritium 3h the 2h and 3h content in groundwater follows the order of a3 zone a2 zone a1 zone upper confined water and shows a decrease tendency with the increase of groundwater buried depth on the one hand the modern water irrigated by yellow river mainly participates in the shallow cycle the less modern water is found in deep circulation on the other hand the possible reason is the groundwater recharged by deep groundwater for the historical period yin et al 2010 lower global temperature less isotope value or the fractured water in the bedrock of the mountain area the difference of 3h also indicates that there are variations in their recharge sources 5 results and discussion 5 1 effects of anthropogenic activities yinchuan plain has a long history of agricultural development and is also the center of economic and political culture in ningxia hui autonomous region however with the socio economic development human activities impose intensive impacts on groundwater environment which can be reflected in three aspects groundwater pollution excessive exploitation or excretion of groundwater and excessive groundwater replenishment li 2014 5 1 1 groundwater pollution the phenomenon of groundwater pollution caused by anthropogenic activities is very universal all over the world according to the monitoring results of 195 cities in china 97 of the urban groundwater has been polluted with different degrees zhang 2015a according to their spatial distribution the sources of groundwater pollution can be classified into point pollution sources line pollution sources and non point arearal pollution sources compared with point pollution sources non point source pollution has a large spatio temporal range remarkable uncertainty and the complexity of the composition and mechanism process therefore this article focuses on the non point source pollutant nitrogen mainly including nh4 n no3 n and no2 n in agricultural area the conversion relationship among the three components follow a chemical reaction rule which is expressed as 1 nh 4 1 5 o 2 no 2 h 2 o 2 h 2 2 no 2 0 5 o 2 no 3 it should be noted in table 2 that no2 of 3 water samples exceeded the limits of the iii quality standard of groundwater 0 1 mg l therefore nh4 and nitrate are selected as the representative pollutants for the samples from the phreatic aquifer 50 10 9 and 90 19 6 water samples exceeded the limits of the iii quality standard of groundwater in the no3 20 mg l and nh4 0 5 mg l with mean values of 6 8 mg l and 0 38 mg l respectively nh4 n pollution in the phreatic water is more serious mainly distributed in the central and northern parts of the multi layer structural area fig 9 b in these areas the content of nitrate is relatively small which may derived from the direct supply of nh4 n and denitrification in agricultural areas urea co nh2 2 ammonium bicarbonate nh4hco3 et al are widely used in order to increase the crop yield the average nitrogen fertilizer application rate per ha of cultivated land reached to 832 81 kg which was far beyond the average rate in high fertilizer input region of china 339 kg ha chen et al 2016 meanwhile broad irrigation approach makes n nutrients in the form of nh4 n prone to leaching into the phreatic water where the buried depth is relatively small it can be seen in fig 9c that the samples exceeding the nitrate limits of the iii quality standard are mainly distributed in the southern and northern regions of a single phreatic aquifer and the content of nh4 n was relatively small the main reason is that nh4 n is rapidly transformed into no3 n by nitration under the suitable oxidation conditions according to the isotope data of δ15n and δ18o it is known that the main source of no3 n is a mixture of synthetic fertilizer and manure sewage in groundwater and hydrological conditions are the primary controlled factors in the nitrogen species nh4 n and no3 n at the same time there exists a certain denitrification occurring in the yinchuan plain chen et al 2017 consequently inappropriate use of fertilizer flood irrigation approach manure sewage and vulnerable environment have resulted in increasing the risk of nitrogen pollution posing great pressure on the environment 5 1 2 excessive groundwater recharge in yinchuan plain the yellow river water has been the primary irrigation source for farmland thus a large amount of irrigation return flow is produced which in turn will result in rising of the phreatic water level according to the previous research because people lack of awareness of environmental protection backwardness of irrigation equipment and imperfect scientific management system the salinity of canal leakage system supply and the recharge of agricultural irrigation and infiltration accounted for 81 69 of the recharge of groundwater ningxia geological engineering survey institute 1995 lu 2010 qian et al 2013 and the phreatic evaporation accounted for 55 37 of the total discharge fig 10 5 1 3 excessive groundwater exploitation the upper confined aquifer in the study area is the main groundwater supplier for domestic and production purposes in yinchuan plain due to the lack of reasonable planning for a long period of water exploitation a large amount of extraction without a timely recharge has resulted in the depression cone in some areas especially in the xincheng area of yinchuan city where the content of 3h is high 45 49 2 33 tu indicating that it has been recharged by modern water meanwhile the concentration of the conventional ions in the depression zone is between the phreatic water samples and the upper confined water samples fig 11 indicating that the mixing of the phreatic water and upper confined water occurred this mixture process causeed the water quality deterioration of the upper confined water 5 2 natural factors of hydrochemical formation 5 2 1 formation mechanism of groundwater to interpret the hydrochemistry formation mechanism the qualitative analysis is carried out based on the widely used method gibbs diagram 1970 which reflect the dominant processes of precipitation rock weathering or evaporation in dry regions it can be observed in fig 12 b that the ratios of cl cl hco3 were mostly less than 0 5 with low tds in a1 and a2 zone of upper confined water indicating that rock weathering was the dominant mechanism which reflects the natural factors however samples in a3 zone was mainly located on the upper right of the diagram with cl cl hco3 ratio greater than 0 5 and tds between 267 and 7616 mg l which showed that the groundwater chemistry was not only controlled by rock weathering and or precipitation but also by evaporation crystallization xing et al 2013 however for the sample of both phreatic aquifer and upper confined aquifer fig 12a the weight ratio of na na ca2 shows a wide variation range without obvious change of tds which indicated that the cation exchange also played an important role by increasing na and decreasing ca2 under the background of rock dominance liu et al 2015 5 2 2 natural factors affecting groundwater hydrochemistry 5 2 2 1 geological and hydrogeological conditions geological and hydrogeological conditions such as the differences of groundwater depth topography and the lithology of rock strata play a key role in determining groundwater chemical components compared with the multilayer structural area the single phreatic area has larger porosity better permeability faster runoff and stronger alternation of water cycle therefore in such situation the content of ca2 and mg2 in groundwater is higher than that phreatic aquifer in the multilayer structural zone while the content of na so4 2 and tds is lower than that of multilayer structural zone meanwhile the groundwater residence time increases and the depth of along phreatic aquifer decrease along the flow direction and groundwater is more likely to suffer an intensive evaporation and condensation thereby promoting the accumulation of salinity 5 2 2 2 groundwater recharge as it was mentioned in previous section there are many recharge sources of phreatic aquifer in the multilayer structural zone a3 zone in yinchuan plain such as channel leakage irrigation seepage and precipitation et al meanwhile fissure water from bedrock of helan mountain can be another recharge source in a1 zone significant differences can be detected in the chemical compositions of water from different recharge sources table 1 it can be seen that the main anions in the local precipitation mean precipitation is hco3 while the cation is dominated by mg2 the chemical types of yellow river are mainly hco3 so4 and so4 hco3 with an average of tds 0 444 mg l the groundwater in the helan mountain is recharged by precipitation and the aquifer is mainly composed of metamorphic and carbonate rocks with low solubility so the tds of groundwater is low which means fissure water in bedrock is fresh water generally speaking the phreatic water samples deviate from the lmwl fig 7b indicating its multiple recharge sources besides precipitation further the average value of δ18o and δ2h follows the order a3 a2 a1 a1 zone is usually recharged by precipitation and bedrock fissure water of the helan mountain spring water and its recharge volume accounts for 66 5 and 33 5 respectively according to linear end member mixing model qian et al 2013 a2 zone mainly receives spring and the irrigation return flow accounting for 25 6 and 74 4 respectively a3 zone is mainly distributed in the pluvial alluvial plain and alluvial lack depositional plain where farmland can be seen everywhere and infiltration from irrigation water is the most important groundwater recharge source precipitation is also an important source of recharge compared to other sources of recharge therefore the ratio of the two main sources of supply in the a3 area is about 12 1 5 2 2 3 evaporation condensation and the dissolution of minerals the qualitative analysis of the groundwater formation gibbs diagram indicates that the samples of phreatic aquifer are mainly controlled by two natural processes rock weathering and evaporation in the following part deuterium surplus and tds in water are used to quantitatively calculate the contribution rates of two factors to salinity of groundwater 1 salinity and deuterium surplus d value the study area is situated in the continental arid and semi arid climate which is favorable to evaporation condensation of groundwater the essence of evaporation condensation is to drain the water without changing the amount of salt in the groundwater on the contrary the dissolution of minerals will increase the hydrochemical composition of groundwater but the water content does not decrease therefore tds was used as the x axis to study the effects of condensation and mineral dissolution fig 13 deuterium surplus d proposed by dansgaard 1964 is one of the most important indicators characterizing atmospheric precipitation in comprehensive environmental factors it can reflect directly the imbalance degree in the evaporation and condensation of atmospheric precipitation and when a water body undergoes evaporation the d excess will decrease and the salinity will increase with a negative correlation since the d excess in the process of evaporation is not related to the initial isotope composition of the original water it is often employed to evaluate the evaporation effect on groundwater meanwhile rock weathering include leaching does not change the isotope value in groundwater so d excess is used as y axis for this study fig 13 which can be calculated by the following formula 3 d δ 2 h 8 δ 18 o it is observed in fig 13 that the evaporation of lake water samples is stronger than phreatic samples and the d excess of the lake water is not densely distributed it may be the difference in the recharge source of the lake water in different geographical locations tds of phreatic samples a1 a2 and a3 zone demonstrates the opposite relationship to order of d excess in a1 zone there are four samples of groundwater s 6 s 7 s 16 and s 27 with smaller tds and bigger d excess due to the fact that the buried depth is large nearly without evaporation process and other samples were subjected to different degrees of evaporation in a2 zone s 1 and s 2 have smaller d excess value probably because the samples are closer to the yellow river where the water table is small however tds of s 13 sample is greater than most of the water samples in the phreatic aquifer the reason is that the sample is located near the industrial chemical plant where a large amount of sewage containing sulfuric acid was produced which results in a large tds in the groundwater 2 salinization mechanism under natural conditions the salinity of groundwater mainly comes from the source of recharge the mineral dissolution and or transpiration and the evaporation condensation therefore when a given water body with a salinity of s0 undergoes evaporation and the remaining fraction of the water body is f the evaporation condensation makes the salinity increase to s0 f and evaporation contributes a salinity of s0 f s0 the contribution of mineral dissolution and or transpiration d contributes the total salinity s the contribution ratio of evaporation concentration to the total salinity is s0 f s0 s and the contribution of the mineral dissolution and or transpiration to the total salinity is 1 s0 sf respectively huang and pang 2012 in this paper the process of calculating f uses the average temperature of 8 92 c and the relative humidity of 55 the percentage of each recharge to the total recharge is set as the weight and the total tds and d excess can be obtained according to the d excess and tds of each recharge source the total d excess and tds in a1 zone a2 zone and a3 zone are 7 64 0 14 g l and 8 8 0 38 g l and 9 6 0 38 g l respectively and the calculation results are listed in table 3 the contribution rate of mineral dissolution in a1 zone a2 zone and a3 zone are 72 87 25 55 6 and 32 36 90 49 while the contribution rate of evaporation is 0 9 6 5 and 4 82 a1 zone mainly receives the atmospheric precipitation and the bedrock fissure water recharge while the groundwater depth is relatively large constituting a relatively closed system which is favorable for the accumulation of the dissolved minerals there are still water samples that were not influenced by evaporation which is consistent with the actual situation in the study area however a2 zone is closely related to the yellow river such open system is not favorable for accumulation of minerals dissolution in a3 zone the particle size of sediments permeability and groundwater flow velocity generally decrease from southwest to northeast with the increase of groundwater residence time along flow path some interactions with surrounding environment will result in an increase in salinity meanwhile the depth of water table becomes smaller which is beneficial to the evaporation although the contribution of evaporative enrichment to groundwater salinity is less than that of a2 zone the f mean value of o a2 zone is 0 88 indicating that the overall evaporative intensity of a3 zone is greater than that of a2 zone which is consistent with previous studies qian and li 2011 the share of the remaining water f in a3 zone is generally proportional to the vertical distance from the sample to the yellow river fig 14 that is the farther away from the yellow river water the greater the value of the remaining water share f but due to its topography and land cover the differences in conditions such as lithology groundwater depth and surface vegetation affect the evaporation process of the groundwater so the variation of f is less obvious 5 2 2 4 ion exchange and adsorption cation exchange and adsorption denotes the process of particle release of a certain media into groundwater and its inverse process the cations in groundwater will be absorbed by media this phenomenon is a common reaction in the geochemical evolution of groundwater which influences the major ion composition of groundwater it is essential to know and identify the various changes under the influence of anthropogenic activities schoeller proposed using the chloral alkali index cai to analyze cation exchange and adsorption between the groundwater and its host environment during residence or travel which is expressed as 4 cai 1 c l n a k c l 5 cai 2 c l n a k hc o 3 s o 4 2 c o 3 n o 3 if ion exchange between ca2 or mg2 in the groundwater and na or k occurs in the alluvium or in weathered materials both indices are negative and vice versa meanwhile formula 3 is also commonly used to study the analysis of cation exchange reactions in which the molecule represents the increased or decreased amount of na apart from na produced by the dissolution of halite minerals the denominator means that in addition to ca2 and mg2 produced by the dissolution of gypsum calcite and dolomite minerals other factors affect the increase or decrease of both farid et al 2013 if the cation exchange reaction plays a major role in the chemical composition of the water in the groundwater system then a linear relationship expressed with eq 6 with the slope close to 1 0 is present 6 n n a k c l c a 2 m g 2 h c o 3 s o 4 2 it can be seen from fig 15 a that the positive ion exchange reaction in the a1 zone may be caused by precipitation and spring recharge and the cations in the groundwater are dominated by ca2 and mg2 and after passing through the na containing rocks which led to exchange reactions increased na in groundwater however in the a2 zone the negative ion exchange reaction is dominant which may be due to the large na content displacing part of ca2 in the rock there are both positive and negative ion exchange reactions in the a3 zone which can be written in formulas 4 and 5 for a3 zone positive cation alternating adsorption slightly dominated accounting for 73 7 of the total samples the main reason is that the lithology of the phreatic aquifer is gradually tapering and the content of silt is increasing from the edge of the basin to the center of the basin and from south to north making the ion exchange reaction become intense but there is a certain difference in the intensity of the exchange the slopes and correlation coefficients of the fitting curves of the water samples in the a1 zone a2 zone and a3 zone were 0 78 r2 0 8535 0 95 r2 0 9627 and 0 81 r2 0 9135 indicating that the element na ca2 and mg2 essentially participate in the ion exchange reaction fig 15b the difference between the actual and theoretical values also implies that the cation exchange reaction is not the sole process affecting the content of the three ions other factors affecting the ion content can exist such as the discharge of sewage in anthropogenic activities the large scale mining of groundwater and the recharge runoff and discharge etc 7 c a 2 m g 2 n a 2 x c a 2 m g 2 x 2 n a 8 c a 2 m g 2 x 2 n a c a 2 m g 2 n a 2 x 6 conclusions a combined application of hydrchemical indicators and stable isotope characterization are performed to interpret the geochemcial evolution mechanism of groundwater under the influences of anthropogenic activities in the yinchuan plain the conclusive remark are summarized as follows groundwater chemistry type of phreatic water demonstrates a zonational characteristics from west to east and from south to north in a1 zone and a2 zone the type of hydrochemistry is mainly hco3 so4 ca mg so4 hco3 ca mg and hco3 na hco3 ca mg respectively in a3 zone the characteristics of water chemistry are complex and diverse due to the anthropogenic activities the anion is dominated by the hco3 followed by the so4 and cl while the cation is dominated by sodium followed by magnesium and calcium the isotope compositions of the phreatic water a1 zone a2 zone and a3 zone suggest that there exist some differences in the recharge sources a1 zone is predominantly recharged by the bedrock fissure water of helan mountain and the precipitation contributes less to the total recharge a2 zone receives irrigation return flow and spring recharge the irregular isotopic characteristics of a3 zone water reflect multiple recharge sources the 3h contents of phreatic water follow the order a3 zone a2 zone a1 zone hydrochemical and isotopic interpretation shows that the hydrochemical compositions of the groundwater are controlled by anthropogenic activities and natural conditions anthropogenic activities responsible for the deterioration of groundwater quality can be classified as groundwater pollution excessive exploitation of groundwater and excessive groundwater recharge natural factors mainly include geological and hydrogeological conditions of study area sources of groundwater recharge soil salinity and evaporation effect mineral dissolution cation exchange and mixing effect meanwhile among natural factors minerals dissolution is the main process responsible for the hydrochemical evolution of the groundwater under the context of a large number of anthropogenic activities the results of the present study can provide some practical implications for water resources management strategy in terms of groundwater exploitation an appropriate extraction increase of phreatic water could be beneficial to the accelerate groundwater circulation and control salinization and swampiness in the study area however the confined aquifer has a relatively low renewal ability more attention should be given in alleviating negative environmental effects by decreasing the extraction quantity therein declaration of competing interest the authors declare no conflict of interest acknowledgement this work is financially supported by the open fund from the key lab of eco restoration of regional contaminated environment shenyang university ministry of education the financial support from comprehensive geological survey of economic zones along huang river in ningxia province no 121201011000150017 scientific and technological development program of jilin province china 20180520092jh and national priority research project pollution mechanism and treatment technology of field soil no 2018yfc1800404 are also acknowledged we want to thank editor marco borga and anthony kiem also three anonymous reviewers for their valuable comments which help to improve greatly the paper quality 
6321,accurate influent flow forecasting plays a significant role in management operation scheduling and utilization of the sewage treatment plants in design and operate such plants it is essential to measure and forecast the influent flow rate in wastewater plants in this paper the very immediate short term to long term influent flow rate are modeled and forecasted by a new developed hybrid model of anfis and grey wolf optimizer gwo the objective of this study is the integration of gwo with anfis in forecasting multi ahead influent flow rate the forecast horizon of the model is from 5 min up to 10 days bases on gamma test gt feature selection of input combinations as the parameters of anfis have effect on the forecasting accuracy these parameters are adjusted and optimized by using grey wolf optimizer gwo then the choice of appropriate input parameters at different prediction horizons from very immediate short term 5 min ahead to long term 10 days ahead was discussed for influent forecasting the statistical indices of rmse nse mae rae r2 d ci and graphical evaluations such as scatter plots with confidence bounds error distributions taylor diagrams box plots and empirical cumulative distribution function ecdf were implemented for assessing the performance of all models in prediction horizons furthermore as another novelty in the present paper recursive forecasting models based on previous forecasted values is used to improve the accuracy and applicability of anfis gwo in recursive predictions our results showed that 1 the hybrid of anfis gwo significantly improved the prediction accuracy 2 anfis gwo performs more efficiently than the anfis in almost all of the prediction horizons anfis gwo1 5 min ahead anfis gwo11 1 2 days ahead anfis gwo8 one week ahead 3 the performance of models in influent flow forecasting is significantly influenced by the prediction horizon the computational results confirmed that the anfis gwo performs well in all of prediction horizons equally the true values and the trends are precisely forecasted by the anfis gwo results of this novel study demonstrate that reliable estimates of influent flow rate from 5 min up to 10 days in advance can be achieved using the developed direct and recursive hybrid gwo models keywords influent flow rate anfis grey wolf optimizer gamma test very immediate short term long term prediction horizon recursive anfis gwo forecasting 1 introduction the determination of the influent flow rate to the wastewater treatment plant wwtp is necessary for providing stable qualitative effluent properties to the wwtps accurate and certain wwtp operation is crucial to guarantee the pollution reduction and treatment functionality wei et al 2012 this is a stochastic phenomenon due to the different sewage inflow and temporal variability of sewage inflow that necessitates the complex planning treatment furthermore influent inflow forecasting is an essential component in designing the treatment plants planning operational schedules optimizing pumping plans and wwtp management zeng et al 2016 forecasting the influent flow rate is useful in the optimum operation policy of wastewater devices and pumps vesilind 2003 the sewage inflow phenomenon is same as the stream flow with an hourly or daily oscillation and trend but is affected by the dynamic population therefore the forecasting procedure is somehow the same linear and non linear models were widely used for stream flow forecasting sattari et al 2013 saghafian et al 2013 taheri shahraiyni et al 2013 dehghani et al 2014 al juboori and guven 2016 yaseen et al 2017 also there are several studies in the field of sewage inflow forecasting using fuzzy logic bartkiewicz and studziński 2010 support vector machines szeląg and gawdzik 2016 wei and kusiak 2015 and neural networks wei and kusiak 2015 szeląg et al 2017 most of these studies were carried out in daily and monthly time scales while in some cases of wwtps shorter time scale for operation management and in some cases longer time scale for wastewater reuse planning is necessary the recycled water from the waste water treatment plant is used for different purposes with a regular amount of water demand so it is necessary to predict the inflow to the treatment plant accurately some of the treatment plants work 24 hr and the recycled water is consumed permanently while the sewage inflow to the treatment plant because of dynamic nature of population is periodic and varies considerably during the day the recycled water consumption which is used mostly for irrigating the urban green space and farms is constant during the day in this case an instantaneous or short term time scale forecasting of sewage into the treatment plant is crucial to reliable supply the recycled water demand in the past two decades artificial intelligence ai models were widely used in different fields of environmental forecasting in the case of sewage inflow forecasting it seems that ai models are capable to outperform comparing to the other models due to the stochastic and nonlinearity of the phenomenon based on this fact recent studies in this field are carried out using the ai models bartkiewicz and studziński 2010 wei and kusiak 2015 szeląg and gawdzik 2016 szelag et al 2017 arlos et al 2018 adaptive neuro fuzzy inference system anfis is one of ai model which is rarely used for influent inflow forecasting to the treatment plant nadiri et al 2018 introduce a supervised committee fuzzy logic scfl model for predicting effluent water quality the fuzzy systems suffer from the lack of a systematic procedure for determination of membership function and adjusting parameters chang and chang 2006 firat and güngör 2008 to solve this problem anfis is an appropriate selection allawi et al 2017 anfis uses the training capability of ann to adjust the membership function riahi madvar et al 2009 the main problem in almost all of the ai models is the estimation of the optimal parameters in such a way that the model reaches the best performance to remedy this problem different optimization algorithms like as the particle swarm optimization pso genetic algorithm ga and differential evolution de are developed and coupled with the ai models for different environmental and water resources forecasting mehr et al 2013 zhang et al 2014 guo et al 2014 yaseen et al 2017 prasad et al 2017 recently a new category of optimization algorithms so called natured inspired optimization was developed one of the newest meta heuristic optimization algorithms in this category is grey wolf optimization gwo which was introduced by mirjalili et al 2014 gwo is a nature inspired optimization algorithm based on grey wolves hunting process there are few applications of gwo in environmental researches and it seems that it is in the infancy period and has not yet used in anfis hybrid model developments the first application of gwo reported by mirjalili et al 2014 for learning a multi layer perceptron network which showed a better performance in comparison with the pso ga ant colony optimization aco and evolution strategy ea sulaiman et al 2015 compared the gwo application with several other optimization algorithms and reported better performance of gwo than the others in solving optimal reactive power dispatch problem previous researches have demonstrated the effectiveness of artificial intelligence predictive tools in time series modeling conversely most of these studies have been carried out on time series of river flow there are not adequate studies on the prediction of time series of influent inflow to the sewer systems because of the importance of wastewater as a renewable water resource in arid regions further investigation is required in this area furthermore operation instructions of wastewater plants depend on the influent flow rate accurate forecasting models are needed to simulate the oscillation and complex behavior of influent inflow time series to overcome these challenges and to extend the applicability of gwo in anfis training innovatively in this study gwo was utilized to adjust the membership function parameters of anfis model for influent inflow forecasting considering the non linear and dynamic behavior of population in generating influent flows and its periodical processes it is evident that a precise model for influent flow would provide useful wastewater plant treatment operation information this study contributed an innovative methodology to influent flow prediction by using the hybrid of anfis with gwo model in different time scale horizons the present paper is focused at first on the improvement of fast and accurate anfis gwo based models for influent flow prediction as opposed to using conventional anfis based methods and secondly on prediction time horizon from minute to weekly predictions with different input vectors in 12 models for this purpose a time series of 5 min interval influent flow to the isfahan waste water treatment plant was used several time delays of the time series were utilized as the input of the model to evaluate model performance in very immediate short term to long term influent flow predictions based on the authors knowledge it is the first research which carried out instantaneous influent inflow forecasting using the coupled anfis gwo model in direct and recursive procedure twelve models with different lag time are developed and the anfis gwo model results are compared with the anfis models the comparisons are carried out using several statistical indices and graphical representation of models the reminder of the present paper is organized as follows section 2 provides materials and methods of the study containing data collection anfis gwo and hybrid model implemented in this paper and evaluation criteria sections 3 represents the results and discussions of the hybrid anfis gwo model and comparative analysis with traditional anfis model in different prediction horizons finally in section 4 the conclusion of this study are presented 2 material and methods in this paper the hybrid forecasting influent flow models at a local sewer network station based on recorded influent discharges are developed different time lags from very immediate short term 5 min to long term up to 10 days forecasting horizons using the following methodologies are investigated 2 1 study area and influent data influent time series data was collected from a local wastewater treatment plant which is located in isfahan city center of iran as a case study to evaluate the developed new hybrid optimization prediction technique portable cross correlation ultrasonic flow meter is used to measure and store influent flow rate in data logger in this study 5 min interval records of influent flow data were investigated and modeled the location of measuring device and time series of influent flow rate records are presented in fig 1 it is notable that the time series of observed influent data were allocated in training 70 and testing 30 stages by temporal sampling with specified lags the minimum maximum skewness kurtosis and the quartile values of observed influent data are provided in fig 1 these values reveal that there is nearly similar values in the testing and training sets of time series data in lag time of five minutes 2 2 forecasting horizon in this paper a hybrid of gwo and anfis was developed with different future time horizon scenarios and coded in the matlab software at first the collected influent inflow time series length was assessed by hurst equation the hurst equation was used to examine that if the time series contain high flow and low flow points and its length size is adequate for model development therefore the hurst coefficient was calculated by this equation hurst et al 1965 h coeff log δ s s x log n 2 1 s s min max s 1 s 2 s n δ s s max s min in which the sx is the standard deviation of the original time series data n is the total number of the data smin and smax are the maximum and minimum values of the cumulative differencing series s i 1 n q i q if the h value is 0 5 the time series length is sufficient for model developments and indeed it has extreme events and covers low to high flows in addition when h is 0 5 the length of time series is enough to measure the long term memory of the desired time series the calculated hurst coefficient for the influent inflow time series in this study is hcoeff 0 783 and proves that the length of influent time series is enough for model development after the hurst test the next step is the determination of appropriate time lags based on physical behavior of influent data and autocorrelation function acf suppose a sequence of real influent observations of q0 q1 qi qn that measured at the equal time intervals of t0 t0 δt t0 2δt t0 iδt wei 2005 where qi present the values of independent output variable and dependent m additional variable m 0 variables which measured or observed at t0 iδt time the estimation of q value at several future times of t s is called time series forecasting that written as 2 q t s g q t q q t 1 q t where qt s is predicted value at any t s time g is the predicting model or function qt i is the ith lag of qt and q is the lag range of prediction if s 1 the values are estimated in several times ahead and the time series prediction is generally called multi step ahead prediction also if s 1 the values are estimated in one time step ahead and the time series prediction is called one step prediction the predictions are classified in two categories based on m value if m 0 the time series is called univariate prediction and if m 0 it is called multivariate prediction simply the sequence of time series can be written as eq 3 that is called the query for estimating qt s wu and lee 2015 3 q q t q q t 1 q t 2 3 structure of models lag time analysis and input variable selection proper determination of input variables will support the predicting model capabilities to inference the fluctuating behavior of influent flow time series there are several indices and methods for feature selection of artificial intelligence model developments but there is no general specified regulation for input selection wei et al 2012 bowden et al 2005 fernando et al 2009 galelli et al 2014 in this study the input output combination of influent flow rates at different lag times are selected by the correlation analysis acf gamma test gt analysis physical dependences of different lags and trial and error method seifi and riahi 2018 in detecting the proper influent vector that characterizes the involved process in the wastewater influent series in artificial intelligence models choosing the optimum inputs seriously affects the reliability and ability to develop accurate forecasting models in a database of n possible inputs for a corresponding output y this is necessary to choose the best inputs that will render the optimum model to forecast y given the available data this is termed as feature selection a knowledge of the noise level existing in each combination provides an index for decision the structure with lowest noise provides the optimum model for y forecasts the gamma test gt addresses these drawbacks by calculating an estimate of the noise or error variance present in a dataset directly from the database koncar 1997 chang et al 2014 the gt is a non linear modeling and analysis tool which allows us to examine the input output relationship in a numerical data set in the present study the gt is used to distinguish effective influent lag and delays from possible input configuration of lags the gt provides an approximation of the model forecast s variance that cannot be accounted by a smooth data model gt is a quick method that determines the noise γvalue for each subset of input parameters and in the case that the associated γ value is closest to zero it can be considered as the best combination of input variables the gt is used in several studies for time series forecasting and determining nontrivial input variables and reducing the input dimensions moghaddamnia et al 2009 noori et al 2011 seifi and riahi 2018 therefore in the present study the gt is used as a pre processor technique to derive the optimum and representative lags affecting the real time influent flow in the present study the gt is done through wingamma software durrant 2001 at first the time series of influent is normalized 1 1 then a total of 1000 γ values corresponding to successive 1000 lags of input combinations are calculated fig 2 shows the result of the gt for 1000 lags where red line represent the γ value and blue one represents the gradients in 1000 lags this figure shows that there is a rapid decrees in γ value at initial lags and shows that in immediate and short term horizons the lags are very important lags 55 i e antecedent values up to previous 6 h also in lags from 430 to 800 and from 930 to 1000 lags that correspond to the previous 1 3 day delays short term horizon there is a reduction in γ value and describes the short term dependencies of influent flow based on the results of gt in this figure and in order to evaluate the import parameters of different horizon forecasts 20 combination of most important lags are selected as presented in table 1 to derive an insight of effective lags at different horizons the results of gt for immediate short term and long term forecasts of influent flow rates are presented in table 1 in this table 20 lags are used as the input combinations of gt gt results as gamma gradient standard error and v ratio indices are used to find the best combination in different horizons different input configurations are used in the first configuration all input lags are used 20 lags and gt indices are calculated and results are provided in the first row of table 1 then in the next configuration one of the lags is removed 19 lags and gt parameters are calculated again and presented in the next rows of table 1 again the removed parameter is returned and the next one is removed and gt is performed this method is continued for all selected lags in table 1 one by one and in each step the γ value is calculated in this method the masking of important lags is associated with increasing in the γ value in regard with the case that include all lags first row in table 1 this table shows that the most important lags are 55 min 60 min 12 hr 35 min 25 min 10 day 15 min 5 min 50 min and etc respectively in this study by taking into account the gt results relevant lags for three forecast horizons are selected and presented in table 2 so twelve different input output combinations were considered to develop suitable forecasting models for influent flow table 2 provides the comprehensive information of selected input output combinations in this study the combinations in table 2 were designated for future influent prediction the input variable of the first two models m1 m2 are considered only antecedent influent in very short time duration of 5 and 10 min immediate prediction horizon while the next five models m3 m4 m5 m6 m7 implemented antecedent influent of one hour to 24 h and these models are hourly predictive models the remind models used one day to 10 day lags and are classified as long term models and finally mixed models because of the differences in the dependences of influents from short to long terms the m8 m9 m10 and m12 models in table 1 are forecasting models that predicts influent flow up to next 10 days and had different performance in the influent prediction than immediate and short term models as illustrated in this table three scales of prediction horizon of models are immediate short term models m1 m6 with applications in real time wwtp operations and regulation actions short term models m7 m10 m11 with applications in treatment reasonable decisions and operational adequacy in water market long term models m8 m9 m12 with applications in maintenance planning irrigation water reuse management and optimal operation cost of wwtps the three classes of horizon predictions that are investigated in this study are immediate short term short term and long term models as described above 2 4 recursive modeling procedure reliable and accurate multi step ahead influent flow rate forecasts are important and useful to decision makers for managing wwtps and water reuse consumers in order to evaluate that the forecasts for smaller forecasting horizons could be used as inputs for larger time horizons to improve forecasting accuracy in this section recursive models are established in the previous section the direct multi step forecast strategy is used to predict several forecasting horizons and different models are developed for each forecasting horizon in this section recursive strategies for multi step forecasting are proposed based on the hybrid anfiw gwo best models to investigate forecasts reliability and effectiveness the anfis gwo recursive model was implemented to provide multi step ahead forecasts from horizons t 5 min up to t 10 days the innovative nature of this study invigorate by application of the recursive for the first time in multi step ahead influent flow forecasting at different horizons by hybrid anfis gwo models the recurrent procedure in the anfis gwo aims to forecast future influent flows by using the inter feedback forecasted value of the model when the external feedback observed value is not available the combinations between input and output forecast for the recursive models in a general form are as follows rm1 horizon t 5 min q t 5 f q t q t 5 q t k rm2 horizon t 10 min q t 10 f q t 5 q t q t 5 q t k rm3 horizon t 60 min q t 60 f q t 10 q t 5 q t q t 5 q t k rm4 horizon t 2 hr q t 2hr f q t 60 q t 10 q t 5 q t q t 5 q t k rm5 horizon t 3 hr q t 3hr f q t 2hr q t 60 q t 10 q t 5 q t q t 5 q t k rm6 horizon t 12 hr q t 12hr f q t 3hr q t 2hr q t 60 q t 10 q t 5 q t q t 5 q t k rm7 horizon t 24 hr q t 24hr f q t 24hr q t 3hr q t 2hr q t 60 q t 10 q t 5 q t q t 5 q t k rm8 horizon t 7 day q t 7 day f q t 24hr q t 24hr q t 3hr q t 2hr q t 60 q t 10 q t 5 q t q t 5 q t k rm9 horizon t 10 day q t 10 day f q t 7 day q t 24hr q t 24hr q t 3hr q t 2hr q t 60 q t 10 q t 5 q t q t 5 q t k in which q is the function of the pattern between input and output combinations q t 5 q t 10 q t 60 q t 10 day show the forecasted values of horizons 5 10 60 min up to 10 day q t q t 5 q t k denote the k 1 antecedent measured values in autoregressive input variables it is noticeable that the best combination of forecasted values as input vector of recursive models are determined and used in the final comparisons with direct models 2 5 adaptive neuro fuzzy inference system the fuzzy logic proposed by zadeh 1965 is based on linguistic uncertainty fuzzy inference system has three conceptual components including if then rules a database that defines the membership function and an inference system firat and güngör 2008 to acquire the fuzzy rules and determine the membership function an artificial neural network ann is combined with a fuzzy system shabri 2014 and is called adaptive neuro fuzzy system anfis quej et al 2017 there are three types of anfis models tsumoto mamdani and sugeno the sugeno is the most popular and is used in the present study for framework development of adaptive system anfis generates a set of j fuzzy rules rj 1 j j that each fuzzy rule has the following form wu and lee 2015 if q 1 i s μ j 1 a n d q 2 i s μ j 2 a n d a n d q i i s μ j i a n d a n d q n i s μ j n t h e n 4 q t 1 b j 0 b j 1 q 1 b j 2 q 2 b j i q i b j n q n where µj 0 is a gaussian function and written as 5 μ j i x i e x p x i m j i σ j i 2 where mj i is the mean and σj i is the standard deviation that are unknown parameters of j rule a five layer network with different inputs and one output is constructed based on j fuzzy rules fig 3 the structure of the anfis model for n inputs of q0 q1 qi qn is as follows wu and lee 2015 khosravi et al 2018 layer 1 there are n nodes in each rule and then nj nodes in this layer this layer is the fuzzification layer and received signal from each node is transferred to the next layer the qi in node i of rule j is mapped by the following membership function 6 o j i 1 μ j i q i e x p q i m j i σ j i 2 f o r 1 i n a n d 1 j j layer 2 this layer is the rule layer the output node is the product of input signals to the node and named as the firing strength of rule rj there are one node for each rule and then j node for the layer in this layer the membership functions in each rule are multiplied as follows 7 o j i 2 i 1 n o j i 1 f o r 1 j j layer 3 this layer is the normalization layer there are one node for each rule and then j node for the layer the output of this layer is the ratio of strength of ith rule to the sum strength of all rules 8 o j 3 o j 2 j 1 j o j 2 f o r 1 j j layer 4 this layer is called the defuzzification layer there are one node for each rule and then j node for the layer in this layer the output value is a conclusion from the output of previous layer for each rule 9 o j 4 o j 3 b j 0 b j 1 q 1 b j 2 q 2 b j i q i b j n q n f o r 1 j j layer 5 this is the last layer that calculates the network output and is called the sum layer there is only one node in this layer which obtained by the following summation 10 o 5 j 1 j o j 4 the mj i σj i bj 0 bj i 1 i n and 1 j j must be determined to obtain the best performance of the network using previously trial and error method for achieving optimal values of these parameters is very time consuming which is the main problem of this system to solve this problem in this research a novel optimization algorithm so called grey wolf was hybridized with the anfis model to find the best parameters and finally predict the wastewater discharge 2 6 grey wolf optimizer as previously mentioned determination of the best parameters for the anfis model is time consuming to overcome this problem optimization could be a proper solution for this purpose the grey wolf optimizer was utilized in this paper gwo algorithm was introduced by mirjalili et al 2014 that performs optimization based on hunting method of wolves and inspired from the social hierarchy of grey wolves for mathematical modeling the mathematical model of gwo includes social hierarchy tracking encircling and attacking prey processes by grey wolves in social hierarchy step step 1 the best solution is considered as alpha wolves α that are the leaders of pack the second and third solutions are considered as beta β and delta δ wolves respectively the betas are subservient wolves that assist the alpha in decision making and the delta wolves include the sentinels scouts elders caretakers and hunters in the grey wolves pack finally the remaining solutions are named as omega ω omegas are considered as the scapegoat wolves in the pack and have the lowest rank of grey wolf in this step of gwo algorithm the optimization is guided by α β and δ where the ω follow these three solutions in encircling prey step step 2 grey wolves encircle prey before hunting for mathematical modeling of this step suppose 11 d c q p t x t 12 q t 1 q t a d 13 a 2 a r 1 a 14 c 2 r 2 where a and d are coefficient vectors q p is the prey location vector t is the current iteration q is the location vector of a grey wolf a is a coefficient vectors that linearly declined from 2 to 0 over the iteration cycle and r 1 and r 2 are random vectors in range of 0 1 therefore a grey wolf can change its location around the prey in any arbitrary position by eqs 11 and 12 in hunting step step 3 it is supposed that the alpha beta and delta wolves have more knowledge about the possible position of prey and then estimate the location of prey so the other search agents update the location around the prey according to the three main wolves as the following formulas 15 d α c 1 q α q d β c 2 q β q d δ c 3 q δ q 16 q 1 q α a 1 d α q 2 q β a 2 d β q 3 q δ a 3 d δ 17 q t 1 q 1 q 2 q 3 3 in attacking prey or exploration step step 4 when the prey stops the grey wolves ending their hunting via attacking to it if random value of a vector be in range of 2 a 2 a and a declined from 2 to 0 over the iteration cycle when a be in the 1 1 the search agents can change their location to a new place among their current location and the position of the prey then the wolves attack towards the prey if a 1 the gwo algorithm has only two main components of c and a to be adjusted based on these proposed operations the gwo algorithm is prone to search the local solutions therefore to solve this problem utilizing the ranges of a 1 or a 1 permits the gwo algorithm to search and find the global solutions another parameter of gwo that help to explore the local optimal solution is c the c involves random values in interval of 0 2 based on eq 14 also this parameter assists the gwo algorithm to display randomly behavior of optimization and favoring exploration 2 7 proposed hybrid methodology anfis gwo anfis has several unknown premise and consequent parameters that should be determined with traditional trial and error method or by using optimization algorithms the premise parameters of anfis are mj i and σj i for 1 i n and 1 j j in the gaussian membership function eq 5 also consequent parameters are used in layer 4 defuzzification layer eq 9 as bj 0 and bj i for 1 i n and 1 j j khosravi et al 2018 gwo is an efficient procedure to solve the problem parameters of anfis in this study anfis parameters are determined with the novel hybridization of anfis training procedure with gwo algorithm the flowchart of hybridized gwo with anfis modeling is given in fig 4 indeed in the field of anfis gwo anfis is used as one wolf that characterize and constants that impact the anfis procedure are considered dimensions of the wolves in the structure of anfis procedure in fig 3 three training parameters exist the linguistic factors mj i and σj i that influence the membership function value the result parameter bj i that improves the efficiency and the o that characterizes the best rule in the anfis configuration parameters that determine μi j are antecedent parameters rini et al 2016 by setting x as a grey wolf and p the size of linguistic border factors of each wolf then the size of dimension modeled by p is demonstrated below 18 x p ji i i j j in which i is a group of fuzzy sets and j is a group of contributions of each wolf also taking k be as the result parameters of each particle then a formulae that illustrates the size of dimension modeled by k is as 19 x k ji i j r r in which r is a set of rules that create anfis gwo moreover let o be as the optimum rule in the anfis configuration then or parameter is written as 20 x o r r r since the dimension of one wolf in the anfis gwo has three parameters one wolf of the anfis gwo is shown as 21 x p ji k rj i i j j r r finally an algebraic demonstration of the dimension of each grey wolf in the anfis gwo optimization problem is written as 22 x n p nji k nrj o nr i i j j r r in which i 1 2 n and n are the number of grey wolves if xn be wolves in the search space then anfis gwo assesses the objective functions until the preferred values are derived the objective functions is optimized using gwo to find more accuracy with minimum root mean squared error rmse the initial parameters of algorithm are a linearly decreased from 2 to 0 population size is 100 maximum number of generations is 200 anfis gwo will run in the search space to hunt optimal xn for fitness f1 rmse xn anfis gwo initiates with initializing the influent flow time series i e applying desired lag time dividing train test sets followed by setting the size of population of wolves fig 3 presents the flow chart of anfis gwo in this figure gwo is considered to optimize the parameters of anfis based on figs 3 and 4 the process of anfis gwo is presented below rini et al 2016 step 1 create initial position of wolves p population size n in a possible space as search agents and initialize alpha beta and delta positions the components of a constraint that define the membership are acquired from minimal and maximal points in the dataset results parameters of anfis and linguistic limits are considered by random numbers step 2 implement local hunt of anfis for all wolves based on eqs 3 9 in order to calculate the objective function for each search agent the initial objective function is calculated by rmse equation step 3 reset the special fitness fitness for each wolf and save as the possible results step 4 assess the fitness results and the best solution are identified as the global best and save as the desired solution and update alpha beta and delta step 5 evaluate the fitness function if the condition is derived then save the solution else to repeat the loop to the next step step 6 update the position of search agents including omegas based on best value of fitness function change each possible solutions parameters linguistic hedge consequent parameter parameters of anfis using the gwo respectively based on eqs 14 16 step 7 based on the updated position of wolves of each possible solution parameter new local search is used for anfis procedure to discover new objective function values step 8 evaluate the fitness function if the condition is derived then use the solution else loop to iterate the procedure until a stopping condition is gotten 2 8 evaluating the accuracy of proposed models in order to quantify the prediction capability of different models used in influent inflow prediction with observed data statistical indices including coefficient of determination r2 mean absolute error mae root mean squared error rmse relative absolute error rae index of agreement d confidence index ci and nash sutcliffe coefficient nse are used the equations and explanation of all these criteria widely discussed elsewhere dehghani et al 2014 zeynoddin et al 2018 furthermore several graphical evaluation of results such as scatter plot taylor diagram box plot of errors and error frequency distribution are used to evaluate qualitatively the model results the performance of 12 predictive models with different input vectors during training and testing stages were assessed by these performance indices the preference is assumed to statistical indices of r2 followed by rmse and rae for validation of the models performance during testing stage the evaluation of model is probably the most important stage in the model development sequence the effectiveness of the artificial intelligence model is discovered by its capability to estimate accurately the unseen data not on the training dataset 3 results and discussions in this section the performance of simple anfis and hybrid of anfis gwo models for predicting the influent flow rate at different prediction horizon are presented and discussed 3 1 comparison the new anfis gwo with conventional anfis results the quantitative results of the anfis and anfis gwo for 12 predictive models are presented in table 3 also observed and forecasted influent flows with anfis gwo and anfis for 12 input combinations in the training and testing phases and over all of the data are presented in figs 5 16 according to the table 3 the anfis gwo performed well in 9 scenarios 1 2 3 7 8 9 10 11 12 while in models 4 5 and 6 results are not suitable in train test and all data among well performed models the first and second models are superior based on the statistical indices based on r2 d and nse the anfis gwo performed nearly perfect while the other statistical values show an excellent performance for these two models rmse and mae in all scenarios excluding models number 4 5 and 6 reached low values based on previous researches rmse value less than half of the standard deviation of observed data may consider low the standard deviation of observed data is 36 28 lit s and the rmse is less than the half of standard deviation of observed data in train test and all of data for 9 scenarios while in models 4 5 and 6 the rmse value reaches the standard deviation of observed data in general the anfis gwo performed better than anfis in almost all scenarios scatter plots in figs 5 16 apparently demonstrate that the forecasts of the anfis gwo model closely follow the corresponding measured discharge values in this study the importance of different influent lags were explored and the most relevant features were identified using a physically based variable selection the lag times are considered according with temporal behavior inherent inside the producing population of wastewater wei et al 2012 it can be concluded that 1 2 and 6 hr lag is not suitable for instantaneous influent time series forecasting while the lower and higher lag times leads to an appropriate modeling especially 5 and 10 min lags population dynamics essentially produce temporal variations in influent flows and time dependences of population behaviors population life style periodical trends of water consumptions have a dominant effect on the lag predictions the observed and forecasted time series error mean and standard deviation and the 95 confidence intervals are plotted for models 1 2 8 9 10 and 11 in figs 5 16 as the best ones in model 1 both anfis and anfis gwo performed nearly perfect while the error mean in anfis gwo is less than one fortieth of the anfis model which verifies the superiority of gwo anfis this superiority is obvious in all other models also most of the forecasted values lay within the confidence intervals again it is noticeable to say that the models 1 and 2 performed better than the others with less error and narrower confidence intervals and a suitable match between observed and forecasted time series is provided the frequency distributions of the prediction errors in various error brackets for each model as calculated over the test period are shown in these figures however changes in the mean and maximum sewer flow rates are found to be higher compared to the variation in population and this is clear in the accuracy of model predictions with different lags in table 3 and figs 5 16 in regard with the train and test stages and all of the data the proposed anfis gwo1 model showed a relatively perfect forecast for influent flow rate with rmse value of 5 61 6 37 and 5 85 lit s in train test and all data respectively when compared with the anfis rmse 6 63 6 91 and 6 7 lit s in three data sets respectively in addition in terms of mae r2 and nse the anfis gwo has proved somewhat more accurate forecasts than the anfis in m2 m4 m6 m8 m11 and m12 input combinations in the m4 m5 and m6 all of them failed to provide accurate estimation of the influent flow overall the statistical indices values in table 3 proved that the anfis gwo had better performance compared with the anfis models it is obvious that the r2 values confirm a high level of accuracy for the proposed hybrid models it is usually anticipated that the superiority of model performances decrease from the training to the testing steps and the results in table 3 show only a negligible and rational reduction in all of the 12 anfis gwo models for all of evaluation indices 3 2 comparison of simple anfis and hybrid anfis gwo models in this section a detailed comparison of anfis with anfis gwo results is discussed using taylor diagram in fig 17 from the results in table 3 it is clear that using the gwo for improving the anfis models resulted in significantly higher accuracy taylor diagram graphically provides an insight about how close model estimations match to the observations taylor 2001 taylor diagram taylor 2001 summarizes the standard deviation sd centered mean squared difference rmsd and r2 in a single graph which is capable to graphically show the efficiency of predictor tools based on a polar diagram the azimuth angle represents the r2 while the radial location from the beginning shows the proportion of sd the observed points are plotted along the horizontal axis and the distance of each model to this reference point represents the accuracy of that model hence the closer point to the reference point has the best performance in this study the taylor diagram is used to evaluate the overall comparative accuracy of anfis and anfis gwo models in prediction of the influent time series figs 5 8 demonstrate that the predicted values are generally in a satisfying agreement with the observed values in both the training and testing stages however the results of some models such as m3 m4 m5 m9 and m10 in table 3 show that in these cases both anfis gwo and anfis have not accurate predictions for example figs 8 and 14 specifies that these models caused higher over under prediction values for the influent flow these result shown that the models suffers greatly from evident under estimation or over estimation based on these figures the developed models resulted in a large error of over predictions for the testing stage although the trend of measured influent flows predicted appropriately by the models another appropriate visual tool for comparing the results is the taylor diagram which drawn by three statistical criteria of r2 rmsd and standard deviation between any prediction and observation data sets in different scenarios fig 17 shows taylor diagram for anfis and anfis gwo with different combinations of input parameters for training testing and all data sets respectively in the training phase it shows that anfis gwo 1 and anfis gwo 2 are grouped into the smallest rmsd line 5 and have the largest correlation coefficient r 0 99 although the standard deviation of anfis gwo 1 model is smaller than the anfis gwo 2 but the anfis gwo 2 is closer to the reference point in the testing phase anfis gwo 1 anfis gwo 2 anfis 1 anfis 2 anfis 9 anfis gwo 8 anfis 8 and anfis 7 are grouped between rmsd lines of 5 and 10 and between r lines of 0 95 and 0 99 the anfis gwo 8 and anfis 2 have the lower standard deviation than the anfis gwo 2 but the anfis gwo 2 is closer to reference value with a standard deviation of 35 52 lit s compared to the observed value of 35 82 lit s the anfis gwo 2 has higher correlation r 0 99 and lower rmsd 4 72 lit s than the other models this represents that anfis gwo 2 with two input vector of q t 5 and q t 10 can estimate the fluctuations in observed data set satisfactorily however this model needs the influent time series data of previous 5 and 10 min that may not be available in the treatment plant therefore the anfis gwo 8 with input vector of q t 7 day has the best results r 0 97 rmsd 8 lit s standard deviation 34 3 lit s for predicting influent time series the anfis 5 anfis gwo 5 anfis 6 and anfis gwo 6 have the worst performance for predicting influent time series which are located in the farthest positions from the reference point it is clear that the performance of most anfis models have improved when those are hybridized with gwo algorithm for all data the nearest models to the reference point are anfis gwo 2 anfis gwo 1 anfis 2 anfis 1 anfis gwo 8 and anfis 8 similar to testing phase the models of anfis 5 anfis gwo 5 anfis 6 and anfis gwo 6 are located in the farthest position to the reference point and have the worst performance totally the taylor diagram for training testing and all of the data set show that the anfis gwo 2 model with two input vector of q t 5 and q t 10 t 1 day is closer to the observed values than the other models if the influent data for previous 24 h t 1 day is available the anfis 7 with r 0 965 rmsd 9 83 lit s and standard deviation of 38 4 lit s in test stage has slightly better results than the anfis gwo 7 for predicting daily influent time series also for predicting time series of influent using t 1 day data the performance of anfis gwo 8 with r 0 96 rmsd 8 13 lit s and standard deviation of 34 lit s is better than the anfis 8 anfis 9 anfis gwo 9 anfis gwo 11 anfis 10 anfis gwo 10 anfis 11 anfis 12 anfis gwo 12 respectively 3 3 comparing the forecasting horizons this section presents the performance of anfis and anfis gwo utilized for modeling the influent time series based on the forecasting horizon also more detailed discussion and evaluations are presented the influent flow rates at different time lags are used to predict influent discharge based on the statistical comparisons the time lags of best selected models in minute scale are m1 5 min ahead q t 5 m2 5 and 10 min ahead q t 5 and q t 10 m3 60 min ahead q t 60 m4 2 h ahead q t 120 m5 6 h ahead q t 360 and m6 12 h ahead q t 720 the m1 to m6 models have lags smaller than one day which so called short term forecasting models as discussed in previous section the best model for short time predictions are m1 and m2 models the lags of best selected models in daily scale are m7 24 h ahead q t 24 hr m10 6 12 24 h ahead q t 360 q t 720 and q t 24 hr and m11 1 2 days ahead q t 24 hr and q t 48 hr in daily prediction horizon the m11 model has the best results and it is selected as the best model for daily time lags finally for prediction horizon up to 10 days three models were superiors than the others including m8 7 days ahead q t 7 day m9 10 days ahead q t 10 day and m12 1 2 7 days ahead q t 24 hr q t 48 hr and q t 7 day the m8 model is selected as the best model for long term prediction horizon the best performing model for the three basic prediction horizons minute daily weekly are compared by box plot of error and empirical cumulative frequency distribution in figs 18 and 19 to evaluate the models stability in predictions the spread of the error of prediction is visualized by box plots in fig 18 these box plots illustrate the degree of spreading in the absolute errors of prediction with their corresponding quartiles and consequently distinguishing the range of prediction errors the lowest limit of the box plot lies among the lower quartile p25 25th percentile and upper quartile p75 75th percentile and the 50 quartile p50 50th percentile displayed as the median of absolute errors of predictions the horizontal lines that are named as whiskers are drawn from the top and bottom of the box where the bottom whisker extends from p25 to the smallest non outlier in the dataset whereas the top whisker one goes from p75 to the largest non outlier of the simulated absolute error according to the fig 18 the extent of the simulation errors is dramatically larger for the conventional anfis model for all of 12 models in agreement with aforementioned results figs 5 17 and table 3 the anfis gwo is more accurate than anfis where the magnitude of errors median and the upper quartile is relatively small among all models the distribution of prediction error produced by the gwo model in anfis gwo1 and anfis gwo2 spans across a smaller range as its upper quartile value is smaller than the anfis model to acquire additional insight into the performance of the prediction models over different prediction horizons we can divide the prediction horizon into short term up to two days and greater than two days up to 10 days as influent flow time series have different fluctuations because of dynamic behavior of associated population box plots are applied to assess whether the models are capable to forecast these variations and corresponding simulation errors fig 18 shows the box plot of predicted absolute error of influent flow values in anfis and anfis gwo models at different prediction horizons comparison of anfis methods with anfis gwo error values in fig 18 shows that none of these methods can estimate high influent values and shows some errors this figure illustrates that most of simulation errors of anfis gwo models are lay nearby zero which indicates the effectiveness of the optimization the results specify that among all the developed models in the present study the anfis gwo2 is the most accurate model in testing stage and the best prediction horizon for influent flow prediction are 5 and 10 min lags also the anfis11 and anfis gwo11 box area covers the largest extent among all models that approves the lower accuracy of this model compared to other prediction horizons the cross comparisons of anfis with anfis gwo models in fig 18 reveals that in short time prediction horizons m2 5 10 min daily horizon m11 1 2 days and long prediction horizon m8 7 days the anfis gwo is superior to the anfis the extent of absolute error of box area for anfis gwo1 and anfis gwo2 is smaller than the anfis1 and anfis2 respectively generally the box area of the anfis gwo models has the smallest box area of the absolute error values fig 19 a c demonstrates the percentage of the absolute value of predicted error pe occurred over the empirical cumulative distribution function ecdf for predictive models at different prediction horizons in regard with the percentage of errors placed in the lowest error range i e 0 to 10 l s the ecdf confirmed that the anfis gwo models outperformed the anfis model in all prediction horizons based on this error range the anfis gwo performed somewhat better than the anfis model for short time prediction horizons i e about 91 6 vs 86 6 for 5 min prediction horizon 92 4 vs 78 for 5 10 min prediction horizon 46 vs 45 6 for 60 min prediction horizon 31 5 vs 31 6 for 120 min prediction horizon 18 6 vs 13 for 360 min prediction horizon 20 5 vs 10 for 720 min prediction horizon respectively in anfis gwo and anfis models respectively within the error bracket of 0 to 10 lit s for the horizon 12 h to 10 days the anfis gwo model achieved better results than the anfis model in some cases within the 0 to 10 lit s bracket i e about 68 vs 71 of errors for m7 71 6 vs 70 5 of errors for m8 61 6 vs 41 5 of errors for m9 61 vs 53 5 of errors for m10 46 5 vs 47 6 of errors for m11 and finally 39 5 vs 45 2 of errors for m12 in anfis gwo and anfis models respectively however in the most accurate model for the long prediction horizon the anfis gwo8 with 71 6 of errors performed better than the anfis8 with 70 5 of errors even though this paper was the first to assess the anfis gwo and anfis models for different prediction horizons from very short time horizon of 5 min influent flows to long horizon of 10 days and shown improvements provided by the gwo method few aspects should be investigated in forthcoming study in this study the only predictor data was time lagged historical influent flow rate other input combinations for prediction horizons can also include climate variables e g temperature precipitation relative humidity and solar radiation that temper the water demand influenced by consumer needs under different conditions and result in influent flow production 3 4 comparing the recursive with direct models the results of recursive anfis gwo models in different horizons are presented in table 4 and fig 20 based on the results in this table the recurrent anfis gwo model could accurately configure the complex non stationary fluctuation nature of influent flows and successfully combine the observed influent data series with the up to date forecasts of the anfis gwo model so that the time shift problem could be acquired and model consistency as well as forecast precision for future horizons could be significantly enhanced by comparing the results of recurrent anfis gwo in table 4 with direct anfis gwo results in table 3 it is obvious that the recursive model performs much better than the direct model and implementation of previous forecasts values improves the mode accuracy this comparison reveals that the recurrent configuration of the anfis gwo model can effectively recognize the dynamic and non stationary nature of influent flow time series and therefore increases the forecasting accuracy in situations with lack of measured values the results of recursive models depicted that the recurrent delayed outputs of the developed hybrid model do provide valuable data to increase multi step ahead influent flow rate forecast precision the results specify that the accuracy of predictions gradually increases as the forecasting horizon increases i e from t 5 min to t 10 day in comparison with the direct model and nearly in all of forecasting horizons the recurrent model have less errors than the direct one furthermore comparing the scatter plot and trends of recursive forecasts with measured influent flows show that the recurrent model effectively captured the temporal pattern of influent flow production and have valuable applications in real time management of wwtps in 10 day prediction horizon m9 the anfis gwo model have r2 0 96 and rmse 16 49 in testing datasets whereas the recurrent anfis gwo rm9 model have r2 0 96 and rmse 16 53 and shows 12 reduction in rmse by recurrent model for 10 day ahead forecasts and this indicates the superiority of recursive model in long term prediction for future decision makings these results show that the recursive hybrid modeling prevented the model from trapping in local optima and over fitting problems and increase the applicability and generality of model forecasts on the other side the recursive hybrid models had an appropriate proficiency in forecasting the low and high values of influents it is remarkable that the suddenly variations in influent flows causes operations shocks in wwtps so the developed models capability in forecasting maximum and minimum values can be very crucial for wastewater treatment studies the results achieved by this paper coincide with other studies of recursive forecasts of artificial intelligence models in hydrological time series 4 conclusions influent flow forecasting have essential significance in waste water treatment plant management decision making and water reuse considerations the aim of this study was to develop a novel soft computing method based on the hybrid optimization of anfis with gwo to predict influent flow in different prediction horizons by direct and recursive model configurations this study develops a novel hybrid framework innovatively integrates grey wolf optimizer with anfis resulting in significantly improved accuracy of wastewater influent flow prediction three different prediction horizons including minute hourly daily and weekly were employed based on the results of gamma test gt the results of all 12 input output combinations were compared to each other using statistical and visual assessments evaluation of the findings in this paper indicated that the accuracy of the anfis gwo with little difference was superior to the anfis models in influent flow forecasting for all prediction horizons up to 10 days the recursive results show that the rm2 and rm1 were ranked as the first and second most accurate recursive models for immediate short term forecast and the rm9 and rm8 were ranked as the first and second accurate models for long term horizon one remarkable point in the findings of this paper is that the performance of developed models are different in prediction horizons thus the good performance of a hybrid model in a specified time ahead generally cannot reflect the same performance for all of the prediction horizons apart from that the anfis gwo have better results than the anfis model first horizon very immediate short time minute and hourly predictions the models established in the present paper perform satisfactorily results for forecasting 5 and 10 min ahead of influent flow time series anfis and anfis gwo performed well enough in influent flow forecasting although anfis gwo outperforms better in very immediate short time forecasting also up to 12 h forecasting horizon the anfis gwo model shows acceptable predictions and has the potential to clarify instantaneous fluctuations in influent flow time series for treatment management and support decision makers than the anfis second horizon daily short time in daily horizon the best results were achieved for lag time of 1 2 days therefore in total both anfis and anfis gwo have appropriate forecasting accuracy in daily predictions and the anfis gwo is superior to the anfis third horizon long time 2 days up to 10 days and weekly these are combination of the different time lags to provide models for predicting next week influent discharge based on the results the best input for long time influent flow prediction is using 7 days lag time by anfis gwo generally the forecasted influent flow rate was close to the observed values and the trend of simulation and measurements are the same forecasting of the influent flow rate one week and 10 day ahead might provide satisfactory time for wwtps to organize operators irrigation management and schedule the pump station the employment of developed model in this paper can be applied in other hydrological time series predictions in addition the prediction horizons applied in current study can present a support for managers engineers and decision makers for impressive design operation scheduling and decision making of wwtps the results of the present paper confirmed that the established recurrent hybrid models anfis gwo could provide reliable and accurate multi step ahead influent flow rate forecasts by using two fundamental tactics the hybridization of the antecedent measured values of influent flows and model outputs with developed gwo training algorithm which is significant in the final objective needs for real time forecast accuracy the recursive model infer the dependency of input output variables and dynamic nature of recursive time series our future study will focus on the recursive nature of external variables such as population behavior weather parameters and rainfall to reduce the uncertainty of forecasts declaration of competing interest none 
6321,accurate influent flow forecasting plays a significant role in management operation scheduling and utilization of the sewage treatment plants in design and operate such plants it is essential to measure and forecast the influent flow rate in wastewater plants in this paper the very immediate short term to long term influent flow rate are modeled and forecasted by a new developed hybrid model of anfis and grey wolf optimizer gwo the objective of this study is the integration of gwo with anfis in forecasting multi ahead influent flow rate the forecast horizon of the model is from 5 min up to 10 days bases on gamma test gt feature selection of input combinations as the parameters of anfis have effect on the forecasting accuracy these parameters are adjusted and optimized by using grey wolf optimizer gwo then the choice of appropriate input parameters at different prediction horizons from very immediate short term 5 min ahead to long term 10 days ahead was discussed for influent forecasting the statistical indices of rmse nse mae rae r2 d ci and graphical evaluations such as scatter plots with confidence bounds error distributions taylor diagrams box plots and empirical cumulative distribution function ecdf were implemented for assessing the performance of all models in prediction horizons furthermore as another novelty in the present paper recursive forecasting models based on previous forecasted values is used to improve the accuracy and applicability of anfis gwo in recursive predictions our results showed that 1 the hybrid of anfis gwo significantly improved the prediction accuracy 2 anfis gwo performs more efficiently than the anfis in almost all of the prediction horizons anfis gwo1 5 min ahead anfis gwo11 1 2 days ahead anfis gwo8 one week ahead 3 the performance of models in influent flow forecasting is significantly influenced by the prediction horizon the computational results confirmed that the anfis gwo performs well in all of prediction horizons equally the true values and the trends are precisely forecasted by the anfis gwo results of this novel study demonstrate that reliable estimates of influent flow rate from 5 min up to 10 days in advance can be achieved using the developed direct and recursive hybrid gwo models keywords influent flow rate anfis grey wolf optimizer gamma test very immediate short term long term prediction horizon recursive anfis gwo forecasting 1 introduction the determination of the influent flow rate to the wastewater treatment plant wwtp is necessary for providing stable qualitative effluent properties to the wwtps accurate and certain wwtp operation is crucial to guarantee the pollution reduction and treatment functionality wei et al 2012 this is a stochastic phenomenon due to the different sewage inflow and temporal variability of sewage inflow that necessitates the complex planning treatment furthermore influent inflow forecasting is an essential component in designing the treatment plants planning operational schedules optimizing pumping plans and wwtp management zeng et al 2016 forecasting the influent flow rate is useful in the optimum operation policy of wastewater devices and pumps vesilind 2003 the sewage inflow phenomenon is same as the stream flow with an hourly or daily oscillation and trend but is affected by the dynamic population therefore the forecasting procedure is somehow the same linear and non linear models were widely used for stream flow forecasting sattari et al 2013 saghafian et al 2013 taheri shahraiyni et al 2013 dehghani et al 2014 al juboori and guven 2016 yaseen et al 2017 also there are several studies in the field of sewage inflow forecasting using fuzzy logic bartkiewicz and studziński 2010 support vector machines szeląg and gawdzik 2016 wei and kusiak 2015 and neural networks wei and kusiak 2015 szeląg et al 2017 most of these studies were carried out in daily and monthly time scales while in some cases of wwtps shorter time scale for operation management and in some cases longer time scale for wastewater reuse planning is necessary the recycled water from the waste water treatment plant is used for different purposes with a regular amount of water demand so it is necessary to predict the inflow to the treatment plant accurately some of the treatment plants work 24 hr and the recycled water is consumed permanently while the sewage inflow to the treatment plant because of dynamic nature of population is periodic and varies considerably during the day the recycled water consumption which is used mostly for irrigating the urban green space and farms is constant during the day in this case an instantaneous or short term time scale forecasting of sewage into the treatment plant is crucial to reliable supply the recycled water demand in the past two decades artificial intelligence ai models were widely used in different fields of environmental forecasting in the case of sewage inflow forecasting it seems that ai models are capable to outperform comparing to the other models due to the stochastic and nonlinearity of the phenomenon based on this fact recent studies in this field are carried out using the ai models bartkiewicz and studziński 2010 wei and kusiak 2015 szeląg and gawdzik 2016 szelag et al 2017 arlos et al 2018 adaptive neuro fuzzy inference system anfis is one of ai model which is rarely used for influent inflow forecasting to the treatment plant nadiri et al 2018 introduce a supervised committee fuzzy logic scfl model for predicting effluent water quality the fuzzy systems suffer from the lack of a systematic procedure for determination of membership function and adjusting parameters chang and chang 2006 firat and güngör 2008 to solve this problem anfis is an appropriate selection allawi et al 2017 anfis uses the training capability of ann to adjust the membership function riahi madvar et al 2009 the main problem in almost all of the ai models is the estimation of the optimal parameters in such a way that the model reaches the best performance to remedy this problem different optimization algorithms like as the particle swarm optimization pso genetic algorithm ga and differential evolution de are developed and coupled with the ai models for different environmental and water resources forecasting mehr et al 2013 zhang et al 2014 guo et al 2014 yaseen et al 2017 prasad et al 2017 recently a new category of optimization algorithms so called natured inspired optimization was developed one of the newest meta heuristic optimization algorithms in this category is grey wolf optimization gwo which was introduced by mirjalili et al 2014 gwo is a nature inspired optimization algorithm based on grey wolves hunting process there are few applications of gwo in environmental researches and it seems that it is in the infancy period and has not yet used in anfis hybrid model developments the first application of gwo reported by mirjalili et al 2014 for learning a multi layer perceptron network which showed a better performance in comparison with the pso ga ant colony optimization aco and evolution strategy ea sulaiman et al 2015 compared the gwo application with several other optimization algorithms and reported better performance of gwo than the others in solving optimal reactive power dispatch problem previous researches have demonstrated the effectiveness of artificial intelligence predictive tools in time series modeling conversely most of these studies have been carried out on time series of river flow there are not adequate studies on the prediction of time series of influent inflow to the sewer systems because of the importance of wastewater as a renewable water resource in arid regions further investigation is required in this area furthermore operation instructions of wastewater plants depend on the influent flow rate accurate forecasting models are needed to simulate the oscillation and complex behavior of influent inflow time series to overcome these challenges and to extend the applicability of gwo in anfis training innovatively in this study gwo was utilized to adjust the membership function parameters of anfis model for influent inflow forecasting considering the non linear and dynamic behavior of population in generating influent flows and its periodical processes it is evident that a precise model for influent flow would provide useful wastewater plant treatment operation information this study contributed an innovative methodology to influent flow prediction by using the hybrid of anfis with gwo model in different time scale horizons the present paper is focused at first on the improvement of fast and accurate anfis gwo based models for influent flow prediction as opposed to using conventional anfis based methods and secondly on prediction time horizon from minute to weekly predictions with different input vectors in 12 models for this purpose a time series of 5 min interval influent flow to the isfahan waste water treatment plant was used several time delays of the time series were utilized as the input of the model to evaluate model performance in very immediate short term to long term influent flow predictions based on the authors knowledge it is the first research which carried out instantaneous influent inflow forecasting using the coupled anfis gwo model in direct and recursive procedure twelve models with different lag time are developed and the anfis gwo model results are compared with the anfis models the comparisons are carried out using several statistical indices and graphical representation of models the reminder of the present paper is organized as follows section 2 provides materials and methods of the study containing data collection anfis gwo and hybrid model implemented in this paper and evaluation criteria sections 3 represents the results and discussions of the hybrid anfis gwo model and comparative analysis with traditional anfis model in different prediction horizons finally in section 4 the conclusion of this study are presented 2 material and methods in this paper the hybrid forecasting influent flow models at a local sewer network station based on recorded influent discharges are developed different time lags from very immediate short term 5 min to long term up to 10 days forecasting horizons using the following methodologies are investigated 2 1 study area and influent data influent time series data was collected from a local wastewater treatment plant which is located in isfahan city center of iran as a case study to evaluate the developed new hybrid optimization prediction technique portable cross correlation ultrasonic flow meter is used to measure and store influent flow rate in data logger in this study 5 min interval records of influent flow data were investigated and modeled the location of measuring device and time series of influent flow rate records are presented in fig 1 it is notable that the time series of observed influent data were allocated in training 70 and testing 30 stages by temporal sampling with specified lags the minimum maximum skewness kurtosis and the quartile values of observed influent data are provided in fig 1 these values reveal that there is nearly similar values in the testing and training sets of time series data in lag time of five minutes 2 2 forecasting horizon in this paper a hybrid of gwo and anfis was developed with different future time horizon scenarios and coded in the matlab software at first the collected influent inflow time series length was assessed by hurst equation the hurst equation was used to examine that if the time series contain high flow and low flow points and its length size is adequate for model development therefore the hurst coefficient was calculated by this equation hurst et al 1965 h coeff log δ s s x log n 2 1 s s min max s 1 s 2 s n δ s s max s min in which the sx is the standard deviation of the original time series data n is the total number of the data smin and smax are the maximum and minimum values of the cumulative differencing series s i 1 n q i q if the h value is 0 5 the time series length is sufficient for model developments and indeed it has extreme events and covers low to high flows in addition when h is 0 5 the length of time series is enough to measure the long term memory of the desired time series the calculated hurst coefficient for the influent inflow time series in this study is hcoeff 0 783 and proves that the length of influent time series is enough for model development after the hurst test the next step is the determination of appropriate time lags based on physical behavior of influent data and autocorrelation function acf suppose a sequence of real influent observations of q0 q1 qi qn that measured at the equal time intervals of t0 t0 δt t0 2δt t0 iδt wei 2005 where qi present the values of independent output variable and dependent m additional variable m 0 variables which measured or observed at t0 iδt time the estimation of q value at several future times of t s is called time series forecasting that written as 2 q t s g q t q q t 1 q t where qt s is predicted value at any t s time g is the predicting model or function qt i is the ith lag of qt and q is the lag range of prediction if s 1 the values are estimated in several times ahead and the time series prediction is generally called multi step ahead prediction also if s 1 the values are estimated in one time step ahead and the time series prediction is called one step prediction the predictions are classified in two categories based on m value if m 0 the time series is called univariate prediction and if m 0 it is called multivariate prediction simply the sequence of time series can be written as eq 3 that is called the query for estimating qt s wu and lee 2015 3 q q t q q t 1 q t 2 3 structure of models lag time analysis and input variable selection proper determination of input variables will support the predicting model capabilities to inference the fluctuating behavior of influent flow time series there are several indices and methods for feature selection of artificial intelligence model developments but there is no general specified regulation for input selection wei et al 2012 bowden et al 2005 fernando et al 2009 galelli et al 2014 in this study the input output combination of influent flow rates at different lag times are selected by the correlation analysis acf gamma test gt analysis physical dependences of different lags and trial and error method seifi and riahi 2018 in detecting the proper influent vector that characterizes the involved process in the wastewater influent series in artificial intelligence models choosing the optimum inputs seriously affects the reliability and ability to develop accurate forecasting models in a database of n possible inputs for a corresponding output y this is necessary to choose the best inputs that will render the optimum model to forecast y given the available data this is termed as feature selection a knowledge of the noise level existing in each combination provides an index for decision the structure with lowest noise provides the optimum model for y forecasts the gamma test gt addresses these drawbacks by calculating an estimate of the noise or error variance present in a dataset directly from the database koncar 1997 chang et al 2014 the gt is a non linear modeling and analysis tool which allows us to examine the input output relationship in a numerical data set in the present study the gt is used to distinguish effective influent lag and delays from possible input configuration of lags the gt provides an approximation of the model forecast s variance that cannot be accounted by a smooth data model gt is a quick method that determines the noise γvalue for each subset of input parameters and in the case that the associated γ value is closest to zero it can be considered as the best combination of input variables the gt is used in several studies for time series forecasting and determining nontrivial input variables and reducing the input dimensions moghaddamnia et al 2009 noori et al 2011 seifi and riahi 2018 therefore in the present study the gt is used as a pre processor technique to derive the optimum and representative lags affecting the real time influent flow in the present study the gt is done through wingamma software durrant 2001 at first the time series of influent is normalized 1 1 then a total of 1000 γ values corresponding to successive 1000 lags of input combinations are calculated fig 2 shows the result of the gt for 1000 lags where red line represent the γ value and blue one represents the gradients in 1000 lags this figure shows that there is a rapid decrees in γ value at initial lags and shows that in immediate and short term horizons the lags are very important lags 55 i e antecedent values up to previous 6 h also in lags from 430 to 800 and from 930 to 1000 lags that correspond to the previous 1 3 day delays short term horizon there is a reduction in γ value and describes the short term dependencies of influent flow based on the results of gt in this figure and in order to evaluate the import parameters of different horizon forecasts 20 combination of most important lags are selected as presented in table 1 to derive an insight of effective lags at different horizons the results of gt for immediate short term and long term forecasts of influent flow rates are presented in table 1 in this table 20 lags are used as the input combinations of gt gt results as gamma gradient standard error and v ratio indices are used to find the best combination in different horizons different input configurations are used in the first configuration all input lags are used 20 lags and gt indices are calculated and results are provided in the first row of table 1 then in the next configuration one of the lags is removed 19 lags and gt parameters are calculated again and presented in the next rows of table 1 again the removed parameter is returned and the next one is removed and gt is performed this method is continued for all selected lags in table 1 one by one and in each step the γ value is calculated in this method the masking of important lags is associated with increasing in the γ value in regard with the case that include all lags first row in table 1 this table shows that the most important lags are 55 min 60 min 12 hr 35 min 25 min 10 day 15 min 5 min 50 min and etc respectively in this study by taking into account the gt results relevant lags for three forecast horizons are selected and presented in table 2 so twelve different input output combinations were considered to develop suitable forecasting models for influent flow table 2 provides the comprehensive information of selected input output combinations in this study the combinations in table 2 were designated for future influent prediction the input variable of the first two models m1 m2 are considered only antecedent influent in very short time duration of 5 and 10 min immediate prediction horizon while the next five models m3 m4 m5 m6 m7 implemented antecedent influent of one hour to 24 h and these models are hourly predictive models the remind models used one day to 10 day lags and are classified as long term models and finally mixed models because of the differences in the dependences of influents from short to long terms the m8 m9 m10 and m12 models in table 1 are forecasting models that predicts influent flow up to next 10 days and had different performance in the influent prediction than immediate and short term models as illustrated in this table three scales of prediction horizon of models are immediate short term models m1 m6 with applications in real time wwtp operations and regulation actions short term models m7 m10 m11 with applications in treatment reasonable decisions and operational adequacy in water market long term models m8 m9 m12 with applications in maintenance planning irrigation water reuse management and optimal operation cost of wwtps the three classes of horizon predictions that are investigated in this study are immediate short term short term and long term models as described above 2 4 recursive modeling procedure reliable and accurate multi step ahead influent flow rate forecasts are important and useful to decision makers for managing wwtps and water reuse consumers in order to evaluate that the forecasts for smaller forecasting horizons could be used as inputs for larger time horizons to improve forecasting accuracy in this section recursive models are established in the previous section the direct multi step forecast strategy is used to predict several forecasting horizons and different models are developed for each forecasting horizon in this section recursive strategies for multi step forecasting are proposed based on the hybrid anfiw gwo best models to investigate forecasts reliability and effectiveness the anfis gwo recursive model was implemented to provide multi step ahead forecasts from horizons t 5 min up to t 10 days the innovative nature of this study invigorate by application of the recursive for the first time in multi step ahead influent flow forecasting at different horizons by hybrid anfis gwo models the recurrent procedure in the anfis gwo aims to forecast future influent flows by using the inter feedback forecasted value of the model when the external feedback observed value is not available the combinations between input and output forecast for the recursive models in a general form are as follows rm1 horizon t 5 min q t 5 f q t q t 5 q t k rm2 horizon t 10 min q t 10 f q t 5 q t q t 5 q t k rm3 horizon t 60 min q t 60 f q t 10 q t 5 q t q t 5 q t k rm4 horizon t 2 hr q t 2hr f q t 60 q t 10 q t 5 q t q t 5 q t k rm5 horizon t 3 hr q t 3hr f q t 2hr q t 60 q t 10 q t 5 q t q t 5 q t k rm6 horizon t 12 hr q t 12hr f q t 3hr q t 2hr q t 60 q t 10 q t 5 q t q t 5 q t k rm7 horizon t 24 hr q t 24hr f q t 24hr q t 3hr q t 2hr q t 60 q t 10 q t 5 q t q t 5 q t k rm8 horizon t 7 day q t 7 day f q t 24hr q t 24hr q t 3hr q t 2hr q t 60 q t 10 q t 5 q t q t 5 q t k rm9 horizon t 10 day q t 10 day f q t 7 day q t 24hr q t 24hr q t 3hr q t 2hr q t 60 q t 10 q t 5 q t q t 5 q t k in which q is the function of the pattern between input and output combinations q t 5 q t 10 q t 60 q t 10 day show the forecasted values of horizons 5 10 60 min up to 10 day q t q t 5 q t k denote the k 1 antecedent measured values in autoregressive input variables it is noticeable that the best combination of forecasted values as input vector of recursive models are determined and used in the final comparisons with direct models 2 5 adaptive neuro fuzzy inference system the fuzzy logic proposed by zadeh 1965 is based on linguistic uncertainty fuzzy inference system has three conceptual components including if then rules a database that defines the membership function and an inference system firat and güngör 2008 to acquire the fuzzy rules and determine the membership function an artificial neural network ann is combined with a fuzzy system shabri 2014 and is called adaptive neuro fuzzy system anfis quej et al 2017 there are three types of anfis models tsumoto mamdani and sugeno the sugeno is the most popular and is used in the present study for framework development of adaptive system anfis generates a set of j fuzzy rules rj 1 j j that each fuzzy rule has the following form wu and lee 2015 if q 1 i s μ j 1 a n d q 2 i s μ j 2 a n d a n d q i i s μ j i a n d a n d q n i s μ j n t h e n 4 q t 1 b j 0 b j 1 q 1 b j 2 q 2 b j i q i b j n q n where µj 0 is a gaussian function and written as 5 μ j i x i e x p x i m j i σ j i 2 where mj i is the mean and σj i is the standard deviation that are unknown parameters of j rule a five layer network with different inputs and one output is constructed based on j fuzzy rules fig 3 the structure of the anfis model for n inputs of q0 q1 qi qn is as follows wu and lee 2015 khosravi et al 2018 layer 1 there are n nodes in each rule and then nj nodes in this layer this layer is the fuzzification layer and received signal from each node is transferred to the next layer the qi in node i of rule j is mapped by the following membership function 6 o j i 1 μ j i q i e x p q i m j i σ j i 2 f o r 1 i n a n d 1 j j layer 2 this layer is the rule layer the output node is the product of input signals to the node and named as the firing strength of rule rj there are one node for each rule and then j node for the layer in this layer the membership functions in each rule are multiplied as follows 7 o j i 2 i 1 n o j i 1 f o r 1 j j layer 3 this layer is the normalization layer there are one node for each rule and then j node for the layer the output of this layer is the ratio of strength of ith rule to the sum strength of all rules 8 o j 3 o j 2 j 1 j o j 2 f o r 1 j j layer 4 this layer is called the defuzzification layer there are one node for each rule and then j node for the layer in this layer the output value is a conclusion from the output of previous layer for each rule 9 o j 4 o j 3 b j 0 b j 1 q 1 b j 2 q 2 b j i q i b j n q n f o r 1 j j layer 5 this is the last layer that calculates the network output and is called the sum layer there is only one node in this layer which obtained by the following summation 10 o 5 j 1 j o j 4 the mj i σj i bj 0 bj i 1 i n and 1 j j must be determined to obtain the best performance of the network using previously trial and error method for achieving optimal values of these parameters is very time consuming which is the main problem of this system to solve this problem in this research a novel optimization algorithm so called grey wolf was hybridized with the anfis model to find the best parameters and finally predict the wastewater discharge 2 6 grey wolf optimizer as previously mentioned determination of the best parameters for the anfis model is time consuming to overcome this problem optimization could be a proper solution for this purpose the grey wolf optimizer was utilized in this paper gwo algorithm was introduced by mirjalili et al 2014 that performs optimization based on hunting method of wolves and inspired from the social hierarchy of grey wolves for mathematical modeling the mathematical model of gwo includes social hierarchy tracking encircling and attacking prey processes by grey wolves in social hierarchy step step 1 the best solution is considered as alpha wolves α that are the leaders of pack the second and third solutions are considered as beta β and delta δ wolves respectively the betas are subservient wolves that assist the alpha in decision making and the delta wolves include the sentinels scouts elders caretakers and hunters in the grey wolves pack finally the remaining solutions are named as omega ω omegas are considered as the scapegoat wolves in the pack and have the lowest rank of grey wolf in this step of gwo algorithm the optimization is guided by α β and δ where the ω follow these three solutions in encircling prey step step 2 grey wolves encircle prey before hunting for mathematical modeling of this step suppose 11 d c q p t x t 12 q t 1 q t a d 13 a 2 a r 1 a 14 c 2 r 2 where a and d are coefficient vectors q p is the prey location vector t is the current iteration q is the location vector of a grey wolf a is a coefficient vectors that linearly declined from 2 to 0 over the iteration cycle and r 1 and r 2 are random vectors in range of 0 1 therefore a grey wolf can change its location around the prey in any arbitrary position by eqs 11 and 12 in hunting step step 3 it is supposed that the alpha beta and delta wolves have more knowledge about the possible position of prey and then estimate the location of prey so the other search agents update the location around the prey according to the three main wolves as the following formulas 15 d α c 1 q α q d β c 2 q β q d δ c 3 q δ q 16 q 1 q α a 1 d α q 2 q β a 2 d β q 3 q δ a 3 d δ 17 q t 1 q 1 q 2 q 3 3 in attacking prey or exploration step step 4 when the prey stops the grey wolves ending their hunting via attacking to it if random value of a vector be in range of 2 a 2 a and a declined from 2 to 0 over the iteration cycle when a be in the 1 1 the search agents can change their location to a new place among their current location and the position of the prey then the wolves attack towards the prey if a 1 the gwo algorithm has only two main components of c and a to be adjusted based on these proposed operations the gwo algorithm is prone to search the local solutions therefore to solve this problem utilizing the ranges of a 1 or a 1 permits the gwo algorithm to search and find the global solutions another parameter of gwo that help to explore the local optimal solution is c the c involves random values in interval of 0 2 based on eq 14 also this parameter assists the gwo algorithm to display randomly behavior of optimization and favoring exploration 2 7 proposed hybrid methodology anfis gwo anfis has several unknown premise and consequent parameters that should be determined with traditional trial and error method or by using optimization algorithms the premise parameters of anfis are mj i and σj i for 1 i n and 1 j j in the gaussian membership function eq 5 also consequent parameters are used in layer 4 defuzzification layer eq 9 as bj 0 and bj i for 1 i n and 1 j j khosravi et al 2018 gwo is an efficient procedure to solve the problem parameters of anfis in this study anfis parameters are determined with the novel hybridization of anfis training procedure with gwo algorithm the flowchart of hybridized gwo with anfis modeling is given in fig 4 indeed in the field of anfis gwo anfis is used as one wolf that characterize and constants that impact the anfis procedure are considered dimensions of the wolves in the structure of anfis procedure in fig 3 three training parameters exist the linguistic factors mj i and σj i that influence the membership function value the result parameter bj i that improves the efficiency and the o that characterizes the best rule in the anfis configuration parameters that determine μi j are antecedent parameters rini et al 2016 by setting x as a grey wolf and p the size of linguistic border factors of each wolf then the size of dimension modeled by p is demonstrated below 18 x p ji i i j j in which i is a group of fuzzy sets and j is a group of contributions of each wolf also taking k be as the result parameters of each particle then a formulae that illustrates the size of dimension modeled by k is as 19 x k ji i j r r in which r is a set of rules that create anfis gwo moreover let o be as the optimum rule in the anfis configuration then or parameter is written as 20 x o r r r since the dimension of one wolf in the anfis gwo has three parameters one wolf of the anfis gwo is shown as 21 x p ji k rj i i j j r r finally an algebraic demonstration of the dimension of each grey wolf in the anfis gwo optimization problem is written as 22 x n p nji k nrj o nr i i j j r r in which i 1 2 n and n are the number of grey wolves if xn be wolves in the search space then anfis gwo assesses the objective functions until the preferred values are derived the objective functions is optimized using gwo to find more accuracy with minimum root mean squared error rmse the initial parameters of algorithm are a linearly decreased from 2 to 0 population size is 100 maximum number of generations is 200 anfis gwo will run in the search space to hunt optimal xn for fitness f1 rmse xn anfis gwo initiates with initializing the influent flow time series i e applying desired lag time dividing train test sets followed by setting the size of population of wolves fig 3 presents the flow chart of anfis gwo in this figure gwo is considered to optimize the parameters of anfis based on figs 3 and 4 the process of anfis gwo is presented below rini et al 2016 step 1 create initial position of wolves p population size n in a possible space as search agents and initialize alpha beta and delta positions the components of a constraint that define the membership are acquired from minimal and maximal points in the dataset results parameters of anfis and linguistic limits are considered by random numbers step 2 implement local hunt of anfis for all wolves based on eqs 3 9 in order to calculate the objective function for each search agent the initial objective function is calculated by rmse equation step 3 reset the special fitness fitness for each wolf and save as the possible results step 4 assess the fitness results and the best solution are identified as the global best and save as the desired solution and update alpha beta and delta step 5 evaluate the fitness function if the condition is derived then save the solution else to repeat the loop to the next step step 6 update the position of search agents including omegas based on best value of fitness function change each possible solutions parameters linguistic hedge consequent parameter parameters of anfis using the gwo respectively based on eqs 14 16 step 7 based on the updated position of wolves of each possible solution parameter new local search is used for anfis procedure to discover new objective function values step 8 evaluate the fitness function if the condition is derived then use the solution else loop to iterate the procedure until a stopping condition is gotten 2 8 evaluating the accuracy of proposed models in order to quantify the prediction capability of different models used in influent inflow prediction with observed data statistical indices including coefficient of determination r2 mean absolute error mae root mean squared error rmse relative absolute error rae index of agreement d confidence index ci and nash sutcliffe coefficient nse are used the equations and explanation of all these criteria widely discussed elsewhere dehghani et al 2014 zeynoddin et al 2018 furthermore several graphical evaluation of results such as scatter plot taylor diagram box plot of errors and error frequency distribution are used to evaluate qualitatively the model results the performance of 12 predictive models with different input vectors during training and testing stages were assessed by these performance indices the preference is assumed to statistical indices of r2 followed by rmse and rae for validation of the models performance during testing stage the evaluation of model is probably the most important stage in the model development sequence the effectiveness of the artificial intelligence model is discovered by its capability to estimate accurately the unseen data not on the training dataset 3 results and discussions in this section the performance of simple anfis and hybrid of anfis gwo models for predicting the influent flow rate at different prediction horizon are presented and discussed 3 1 comparison the new anfis gwo with conventional anfis results the quantitative results of the anfis and anfis gwo for 12 predictive models are presented in table 3 also observed and forecasted influent flows with anfis gwo and anfis for 12 input combinations in the training and testing phases and over all of the data are presented in figs 5 16 according to the table 3 the anfis gwo performed well in 9 scenarios 1 2 3 7 8 9 10 11 12 while in models 4 5 and 6 results are not suitable in train test and all data among well performed models the first and second models are superior based on the statistical indices based on r2 d and nse the anfis gwo performed nearly perfect while the other statistical values show an excellent performance for these two models rmse and mae in all scenarios excluding models number 4 5 and 6 reached low values based on previous researches rmse value less than half of the standard deviation of observed data may consider low the standard deviation of observed data is 36 28 lit s and the rmse is less than the half of standard deviation of observed data in train test and all of data for 9 scenarios while in models 4 5 and 6 the rmse value reaches the standard deviation of observed data in general the anfis gwo performed better than anfis in almost all scenarios scatter plots in figs 5 16 apparently demonstrate that the forecasts of the anfis gwo model closely follow the corresponding measured discharge values in this study the importance of different influent lags were explored and the most relevant features were identified using a physically based variable selection the lag times are considered according with temporal behavior inherent inside the producing population of wastewater wei et al 2012 it can be concluded that 1 2 and 6 hr lag is not suitable for instantaneous influent time series forecasting while the lower and higher lag times leads to an appropriate modeling especially 5 and 10 min lags population dynamics essentially produce temporal variations in influent flows and time dependences of population behaviors population life style periodical trends of water consumptions have a dominant effect on the lag predictions the observed and forecasted time series error mean and standard deviation and the 95 confidence intervals are plotted for models 1 2 8 9 10 and 11 in figs 5 16 as the best ones in model 1 both anfis and anfis gwo performed nearly perfect while the error mean in anfis gwo is less than one fortieth of the anfis model which verifies the superiority of gwo anfis this superiority is obvious in all other models also most of the forecasted values lay within the confidence intervals again it is noticeable to say that the models 1 and 2 performed better than the others with less error and narrower confidence intervals and a suitable match between observed and forecasted time series is provided the frequency distributions of the prediction errors in various error brackets for each model as calculated over the test period are shown in these figures however changes in the mean and maximum sewer flow rates are found to be higher compared to the variation in population and this is clear in the accuracy of model predictions with different lags in table 3 and figs 5 16 in regard with the train and test stages and all of the data the proposed anfis gwo1 model showed a relatively perfect forecast for influent flow rate with rmse value of 5 61 6 37 and 5 85 lit s in train test and all data respectively when compared with the anfis rmse 6 63 6 91 and 6 7 lit s in three data sets respectively in addition in terms of mae r2 and nse the anfis gwo has proved somewhat more accurate forecasts than the anfis in m2 m4 m6 m8 m11 and m12 input combinations in the m4 m5 and m6 all of them failed to provide accurate estimation of the influent flow overall the statistical indices values in table 3 proved that the anfis gwo had better performance compared with the anfis models it is obvious that the r2 values confirm a high level of accuracy for the proposed hybrid models it is usually anticipated that the superiority of model performances decrease from the training to the testing steps and the results in table 3 show only a negligible and rational reduction in all of the 12 anfis gwo models for all of evaluation indices 3 2 comparison of simple anfis and hybrid anfis gwo models in this section a detailed comparison of anfis with anfis gwo results is discussed using taylor diagram in fig 17 from the results in table 3 it is clear that using the gwo for improving the anfis models resulted in significantly higher accuracy taylor diagram graphically provides an insight about how close model estimations match to the observations taylor 2001 taylor diagram taylor 2001 summarizes the standard deviation sd centered mean squared difference rmsd and r2 in a single graph which is capable to graphically show the efficiency of predictor tools based on a polar diagram the azimuth angle represents the r2 while the radial location from the beginning shows the proportion of sd the observed points are plotted along the horizontal axis and the distance of each model to this reference point represents the accuracy of that model hence the closer point to the reference point has the best performance in this study the taylor diagram is used to evaluate the overall comparative accuracy of anfis and anfis gwo models in prediction of the influent time series figs 5 8 demonstrate that the predicted values are generally in a satisfying agreement with the observed values in both the training and testing stages however the results of some models such as m3 m4 m5 m9 and m10 in table 3 show that in these cases both anfis gwo and anfis have not accurate predictions for example figs 8 and 14 specifies that these models caused higher over under prediction values for the influent flow these result shown that the models suffers greatly from evident under estimation or over estimation based on these figures the developed models resulted in a large error of over predictions for the testing stage although the trend of measured influent flows predicted appropriately by the models another appropriate visual tool for comparing the results is the taylor diagram which drawn by three statistical criteria of r2 rmsd and standard deviation between any prediction and observation data sets in different scenarios fig 17 shows taylor diagram for anfis and anfis gwo with different combinations of input parameters for training testing and all data sets respectively in the training phase it shows that anfis gwo 1 and anfis gwo 2 are grouped into the smallest rmsd line 5 and have the largest correlation coefficient r 0 99 although the standard deviation of anfis gwo 1 model is smaller than the anfis gwo 2 but the anfis gwo 2 is closer to the reference point in the testing phase anfis gwo 1 anfis gwo 2 anfis 1 anfis 2 anfis 9 anfis gwo 8 anfis 8 and anfis 7 are grouped between rmsd lines of 5 and 10 and between r lines of 0 95 and 0 99 the anfis gwo 8 and anfis 2 have the lower standard deviation than the anfis gwo 2 but the anfis gwo 2 is closer to reference value with a standard deviation of 35 52 lit s compared to the observed value of 35 82 lit s the anfis gwo 2 has higher correlation r 0 99 and lower rmsd 4 72 lit s than the other models this represents that anfis gwo 2 with two input vector of q t 5 and q t 10 can estimate the fluctuations in observed data set satisfactorily however this model needs the influent time series data of previous 5 and 10 min that may not be available in the treatment plant therefore the anfis gwo 8 with input vector of q t 7 day has the best results r 0 97 rmsd 8 lit s standard deviation 34 3 lit s for predicting influent time series the anfis 5 anfis gwo 5 anfis 6 and anfis gwo 6 have the worst performance for predicting influent time series which are located in the farthest positions from the reference point it is clear that the performance of most anfis models have improved when those are hybridized with gwo algorithm for all data the nearest models to the reference point are anfis gwo 2 anfis gwo 1 anfis 2 anfis 1 anfis gwo 8 and anfis 8 similar to testing phase the models of anfis 5 anfis gwo 5 anfis 6 and anfis gwo 6 are located in the farthest position to the reference point and have the worst performance totally the taylor diagram for training testing and all of the data set show that the anfis gwo 2 model with two input vector of q t 5 and q t 10 t 1 day is closer to the observed values than the other models if the influent data for previous 24 h t 1 day is available the anfis 7 with r 0 965 rmsd 9 83 lit s and standard deviation of 38 4 lit s in test stage has slightly better results than the anfis gwo 7 for predicting daily influent time series also for predicting time series of influent using t 1 day data the performance of anfis gwo 8 with r 0 96 rmsd 8 13 lit s and standard deviation of 34 lit s is better than the anfis 8 anfis 9 anfis gwo 9 anfis gwo 11 anfis 10 anfis gwo 10 anfis 11 anfis 12 anfis gwo 12 respectively 3 3 comparing the forecasting horizons this section presents the performance of anfis and anfis gwo utilized for modeling the influent time series based on the forecasting horizon also more detailed discussion and evaluations are presented the influent flow rates at different time lags are used to predict influent discharge based on the statistical comparisons the time lags of best selected models in minute scale are m1 5 min ahead q t 5 m2 5 and 10 min ahead q t 5 and q t 10 m3 60 min ahead q t 60 m4 2 h ahead q t 120 m5 6 h ahead q t 360 and m6 12 h ahead q t 720 the m1 to m6 models have lags smaller than one day which so called short term forecasting models as discussed in previous section the best model for short time predictions are m1 and m2 models the lags of best selected models in daily scale are m7 24 h ahead q t 24 hr m10 6 12 24 h ahead q t 360 q t 720 and q t 24 hr and m11 1 2 days ahead q t 24 hr and q t 48 hr in daily prediction horizon the m11 model has the best results and it is selected as the best model for daily time lags finally for prediction horizon up to 10 days three models were superiors than the others including m8 7 days ahead q t 7 day m9 10 days ahead q t 10 day and m12 1 2 7 days ahead q t 24 hr q t 48 hr and q t 7 day the m8 model is selected as the best model for long term prediction horizon the best performing model for the three basic prediction horizons minute daily weekly are compared by box plot of error and empirical cumulative frequency distribution in figs 18 and 19 to evaluate the models stability in predictions the spread of the error of prediction is visualized by box plots in fig 18 these box plots illustrate the degree of spreading in the absolute errors of prediction with their corresponding quartiles and consequently distinguishing the range of prediction errors the lowest limit of the box plot lies among the lower quartile p25 25th percentile and upper quartile p75 75th percentile and the 50 quartile p50 50th percentile displayed as the median of absolute errors of predictions the horizontal lines that are named as whiskers are drawn from the top and bottom of the box where the bottom whisker extends from p25 to the smallest non outlier in the dataset whereas the top whisker one goes from p75 to the largest non outlier of the simulated absolute error according to the fig 18 the extent of the simulation errors is dramatically larger for the conventional anfis model for all of 12 models in agreement with aforementioned results figs 5 17 and table 3 the anfis gwo is more accurate than anfis where the magnitude of errors median and the upper quartile is relatively small among all models the distribution of prediction error produced by the gwo model in anfis gwo1 and anfis gwo2 spans across a smaller range as its upper quartile value is smaller than the anfis model to acquire additional insight into the performance of the prediction models over different prediction horizons we can divide the prediction horizon into short term up to two days and greater than two days up to 10 days as influent flow time series have different fluctuations because of dynamic behavior of associated population box plots are applied to assess whether the models are capable to forecast these variations and corresponding simulation errors fig 18 shows the box plot of predicted absolute error of influent flow values in anfis and anfis gwo models at different prediction horizons comparison of anfis methods with anfis gwo error values in fig 18 shows that none of these methods can estimate high influent values and shows some errors this figure illustrates that most of simulation errors of anfis gwo models are lay nearby zero which indicates the effectiveness of the optimization the results specify that among all the developed models in the present study the anfis gwo2 is the most accurate model in testing stage and the best prediction horizon for influent flow prediction are 5 and 10 min lags also the anfis11 and anfis gwo11 box area covers the largest extent among all models that approves the lower accuracy of this model compared to other prediction horizons the cross comparisons of anfis with anfis gwo models in fig 18 reveals that in short time prediction horizons m2 5 10 min daily horizon m11 1 2 days and long prediction horizon m8 7 days the anfis gwo is superior to the anfis the extent of absolute error of box area for anfis gwo1 and anfis gwo2 is smaller than the anfis1 and anfis2 respectively generally the box area of the anfis gwo models has the smallest box area of the absolute error values fig 19 a c demonstrates the percentage of the absolute value of predicted error pe occurred over the empirical cumulative distribution function ecdf for predictive models at different prediction horizons in regard with the percentage of errors placed in the lowest error range i e 0 to 10 l s the ecdf confirmed that the anfis gwo models outperformed the anfis model in all prediction horizons based on this error range the anfis gwo performed somewhat better than the anfis model for short time prediction horizons i e about 91 6 vs 86 6 for 5 min prediction horizon 92 4 vs 78 for 5 10 min prediction horizon 46 vs 45 6 for 60 min prediction horizon 31 5 vs 31 6 for 120 min prediction horizon 18 6 vs 13 for 360 min prediction horizon 20 5 vs 10 for 720 min prediction horizon respectively in anfis gwo and anfis models respectively within the error bracket of 0 to 10 lit s for the horizon 12 h to 10 days the anfis gwo model achieved better results than the anfis model in some cases within the 0 to 10 lit s bracket i e about 68 vs 71 of errors for m7 71 6 vs 70 5 of errors for m8 61 6 vs 41 5 of errors for m9 61 vs 53 5 of errors for m10 46 5 vs 47 6 of errors for m11 and finally 39 5 vs 45 2 of errors for m12 in anfis gwo and anfis models respectively however in the most accurate model for the long prediction horizon the anfis gwo8 with 71 6 of errors performed better than the anfis8 with 70 5 of errors even though this paper was the first to assess the anfis gwo and anfis models for different prediction horizons from very short time horizon of 5 min influent flows to long horizon of 10 days and shown improvements provided by the gwo method few aspects should be investigated in forthcoming study in this study the only predictor data was time lagged historical influent flow rate other input combinations for prediction horizons can also include climate variables e g temperature precipitation relative humidity and solar radiation that temper the water demand influenced by consumer needs under different conditions and result in influent flow production 3 4 comparing the recursive with direct models the results of recursive anfis gwo models in different horizons are presented in table 4 and fig 20 based on the results in this table the recurrent anfis gwo model could accurately configure the complex non stationary fluctuation nature of influent flows and successfully combine the observed influent data series with the up to date forecasts of the anfis gwo model so that the time shift problem could be acquired and model consistency as well as forecast precision for future horizons could be significantly enhanced by comparing the results of recurrent anfis gwo in table 4 with direct anfis gwo results in table 3 it is obvious that the recursive model performs much better than the direct model and implementation of previous forecasts values improves the mode accuracy this comparison reveals that the recurrent configuration of the anfis gwo model can effectively recognize the dynamic and non stationary nature of influent flow time series and therefore increases the forecasting accuracy in situations with lack of measured values the results of recursive models depicted that the recurrent delayed outputs of the developed hybrid model do provide valuable data to increase multi step ahead influent flow rate forecast precision the results specify that the accuracy of predictions gradually increases as the forecasting horizon increases i e from t 5 min to t 10 day in comparison with the direct model and nearly in all of forecasting horizons the recurrent model have less errors than the direct one furthermore comparing the scatter plot and trends of recursive forecasts with measured influent flows show that the recurrent model effectively captured the temporal pattern of influent flow production and have valuable applications in real time management of wwtps in 10 day prediction horizon m9 the anfis gwo model have r2 0 96 and rmse 16 49 in testing datasets whereas the recurrent anfis gwo rm9 model have r2 0 96 and rmse 16 53 and shows 12 reduction in rmse by recurrent model for 10 day ahead forecasts and this indicates the superiority of recursive model in long term prediction for future decision makings these results show that the recursive hybrid modeling prevented the model from trapping in local optima and over fitting problems and increase the applicability and generality of model forecasts on the other side the recursive hybrid models had an appropriate proficiency in forecasting the low and high values of influents it is remarkable that the suddenly variations in influent flows causes operations shocks in wwtps so the developed models capability in forecasting maximum and minimum values can be very crucial for wastewater treatment studies the results achieved by this paper coincide with other studies of recursive forecasts of artificial intelligence models in hydrological time series 4 conclusions influent flow forecasting have essential significance in waste water treatment plant management decision making and water reuse considerations the aim of this study was to develop a novel soft computing method based on the hybrid optimization of anfis with gwo to predict influent flow in different prediction horizons by direct and recursive model configurations this study develops a novel hybrid framework innovatively integrates grey wolf optimizer with anfis resulting in significantly improved accuracy of wastewater influent flow prediction three different prediction horizons including minute hourly daily and weekly were employed based on the results of gamma test gt the results of all 12 input output combinations were compared to each other using statistical and visual assessments evaluation of the findings in this paper indicated that the accuracy of the anfis gwo with little difference was superior to the anfis models in influent flow forecasting for all prediction horizons up to 10 days the recursive results show that the rm2 and rm1 were ranked as the first and second most accurate recursive models for immediate short term forecast and the rm9 and rm8 were ranked as the first and second accurate models for long term horizon one remarkable point in the findings of this paper is that the performance of developed models are different in prediction horizons thus the good performance of a hybrid model in a specified time ahead generally cannot reflect the same performance for all of the prediction horizons apart from that the anfis gwo have better results than the anfis model first horizon very immediate short time minute and hourly predictions the models established in the present paper perform satisfactorily results for forecasting 5 and 10 min ahead of influent flow time series anfis and anfis gwo performed well enough in influent flow forecasting although anfis gwo outperforms better in very immediate short time forecasting also up to 12 h forecasting horizon the anfis gwo model shows acceptable predictions and has the potential to clarify instantaneous fluctuations in influent flow time series for treatment management and support decision makers than the anfis second horizon daily short time in daily horizon the best results were achieved for lag time of 1 2 days therefore in total both anfis and anfis gwo have appropriate forecasting accuracy in daily predictions and the anfis gwo is superior to the anfis third horizon long time 2 days up to 10 days and weekly these are combination of the different time lags to provide models for predicting next week influent discharge based on the results the best input for long time influent flow prediction is using 7 days lag time by anfis gwo generally the forecasted influent flow rate was close to the observed values and the trend of simulation and measurements are the same forecasting of the influent flow rate one week and 10 day ahead might provide satisfactory time for wwtps to organize operators irrigation management and schedule the pump station the employment of developed model in this paper can be applied in other hydrological time series predictions in addition the prediction horizons applied in current study can present a support for managers engineers and decision makers for impressive design operation scheduling and decision making of wwtps the results of the present paper confirmed that the established recurrent hybrid models anfis gwo could provide reliable and accurate multi step ahead influent flow rate forecasts by using two fundamental tactics the hybridization of the antecedent measured values of influent flows and model outputs with developed gwo training algorithm which is significant in the final objective needs for real time forecast accuracy the recursive model infer the dependency of input output variables and dynamic nature of recursive time series our future study will focus on the recursive nature of external variables such as population behavior weather parameters and rainfall to reduce the uncertainty of forecasts declaration of competing interest none 
6322,catchment classification results 4 2 application of network metrics 4 2 1 network density 4 2 2 centrality 4 2 3 k core nucleus 5 discussion 5 1 features of the community detection method 5 2 implications of network metrics in hydrological applications 6 conclusions acknowledgments agarwal 2018 802 810 a berghuijs 2016 4382 4390 w berghuijs 2019 1423 1428 w blondel 2008 p10008 v bloschl 2017 588 590 g boers 2014 n botta 2016 123402 f carmi 2007 11150 11154 s clauset 2004 a collins 2019 687 698 m conticello 2018 1421 1437 f coopersmith 2014 1960 1983 e coopersmith 2012 4467 4482 e cunderlik 2004 j duan 2006 3 17 q fang 2017 478 493 k fortunato 2010 75 174 s gudmundsson 2011 1034 1045 l hall 2018 3883 3901 j halverson 2015 3301 3318 m hannaford 2013 2717 2733 j hodgkins 2017 704 717 g hubert 1985 193 218 l jha 2015 13 19 s konrad 2017 c kuentz 2016 2863 2879 a landherr 2010 371 385 a lang 1999 103 117 m liu 2017 744 759 j lloyd 1982 129 137 s matti 2017 4354 4370 b mediero 2015 341 360 l merz 2014 1921 1942 b merz 2018 813 826 b molloy 1995 161 180 m naufan 2018 1232 1243 i nobre 2017 084012 g parajka 2010 78 89 j quianquiroga 2002 041904 r saharia 2017 524 535 m scarsoglio 2013 e71129 s sivakumar 2015 761 771 b sivakumar 2015 55 62 b smith 2011 294 309 j sun 2018 203 213 a villarini 2016 80 91 g ward 1963 236 244 h wasko 2017 c wilby 2013 109 121 r ye 2017 1997 2009 s yangx2019x726 yangx2019x726x735 yangx2019x726xw yangx2019x726x735xw 2020 07 08t00 00 00z https vtw elsevier com content oragreement 10206 chu noaa publishacceptedmanuscriptindexable http www elsevier com open access userlicense 1 0 2020 07 08t00 00 00z http creativecommons org licenses by nc nd 4 0 2019 elsevier b v all rights reserved 2019 07 03t23 17 18 602z http vtw elsevier com data voc addontypes 50 7 eoas nsfc national natural science foundation of china http data elsevier com vocabulary scivalfunders 501100001809 http sws geonames org 1814991 item s0022 1694 19 30630 4 s0022169419306304 1 s2 0 s0022169419306304 10 1016 j jhydrol 2019 06 082 271842 2020 11 01t03 40 31 898663z 2019 09 01 2019 09 30 1 s2 0 s0022169419306304 main pdf https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 main application pdf 8b2a8c9571ee628d2d468dc829ec4dc8 main pdf main pdf pdf true 3458048 main 10 1 s2 0 s0022169419306304 main 1 png https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 preview image png 9c317b266bc718bf611c258a1689633e main 1 png main 1 png png 56488 849 656 image web pdf 1 1 s2 0 s0022169419306304 gr6 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr6 downsampled image jpeg 53ef0d21b5cb0f9d37baffbe6de4444c gr6 jpg gr6 gr6 jpg jpg 106861 520 774 image downsampled 1 s2 0 s0022169419306304 gr7 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr7 downsampled image jpeg ea0ace5260f74f7d9c67e70f21484e1f gr7 jpg gr7 gr7 jpg jpg 52918 338 712 image downsampled 1 s2 0 s0022169419306304 gr4 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr4 downsampled image jpeg c607ca6231291b57fff3bdcb91ebb30b gr4 jpg gr4 gr4 jpg jpg 83858 371 774 image downsampled 1 s2 0 s0022169419306304 gr5 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr5 downsampled image jpeg 9ddb3775a58c891378256c75b5aed17d gr5 jpg gr5 gr5 jpg jpg 88033 371 774 image downsampled 1 s2 0 s0022169419306304 gr8 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr8 downsampled image jpeg c23eeac9b625efa7608ac600a04bf116 gr8 jpg gr8 gr8 jpg jpg 106379 523 774 image downsampled 1 s2 0 s0022169419306304 gr2 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr2 downsampled image jpeg a1a00cfa75e3cae717daa0a670343bd9 gr2 jpg gr2 gr2 jpg jpg 16917 245 373 image downsampled 1 s2 0 s0022169419306304 gr3 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr3 downsampled image jpeg 44b27e8de2c672e51f939cc8cf896cb5 gr3 jpg gr3 gr3 jpg jpg 51029 395 711 image downsampled 1 s2 0 s0022169419306304 gr1 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr1 downsampled image jpeg 28b7de5817d432b47111cf520182989c gr1 jpg gr1 gr1 jpg jpg 49534 519 712 image downsampled 1 s2 0 s0022169419306304 gr6 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr6 thumbnail image gif abb0671c7a40dddc89a064512c81d763 gr6 sml gr6 gr6 sml sml 12129 147 219 image thumbnail 1 s2 0 s0022169419306304 gr7 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr7 thumbnail image gif 2530910808c80454a7eb9f2f5020b933 gr7 sml gr7 gr7 sml sml 7405 104 219 image thumbnail 1 s2 0 s0022169419306304 gr4 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr4 thumbnail image gif 27937e94940d15c65880f2ec720dcfc5 gr4 sml gr4 gr4 sml sml 12477 105 219 image thumbnail 1 s2 0 s0022169419306304 gr5 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr5 thumbnail image gif d267f834b0e80d7017ac79568aaf3195 gr5 sml gr5 gr5 sml sml 12602 105 219 image thumbnail 1 s2 0 s0022169419306304 gr8 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr8 thumbnail image gif 7993c947d8e9a7e5bb240d10785be693 gr8 sml gr8 gr8 sml sml 12110 148 219 image thumbnail 1 s2 0 s0022169419306304 gr2 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr2 thumbnail image gif a02aa0255f9c4c3c2a1f64bf94a4488e gr2 sml gr2 gr2 sml sml 6570 144 219 image thumbnail 1 s2 0 s0022169419306304 gr3 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr3 thumbnail image gif c885c0a170ca9fc1b96523219ef44e4d gr3 sml gr3 gr3 sml sml 6346 122 219 image thumbnail 1 s2 0 s0022169419306304 gr1 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr1 thumbnail image gif 7af7650775a7416b3739cc6700ebebe6 gr1 sml gr1 gr1 sml sml 7882 160 219 image thumbnail 1 s2 0 s0022169419306304 gr6 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr6 highres image jpeg 7e030a1deb71463b72563e36dae7a073 gr6 lrg jpg gr6 gr6 lrg jpg jpg 695503 2302 3427 image high res 1 s2 0 s0022169419306304 gr7 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr7 highres image jpeg abf681c590fdd6386f8b5360b9e92702 gr7 lrg jpg gr7 gr7 lrg jpg jpg 350528 1495 3151 image high res 1 s2 0 s0022169419306304 gr4 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr4 highres image jpeg a7ae859fa90d3a6c9291b57fe077f9d7 gr4 lrg jpg gr4 gr4 lrg jpg jpg 696641 1640 3425 image high res 1 s2 0 s0022169419306304 gr5 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr5 highres image jpeg 0a6ddc35c425c356b9144e794220ddd1 gr5 lrg jpg gr5 gr5 lrg jpg jpg 607473 1640 3425 image high res 1 s2 0 s0022169419306304 gr8 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr8 highres image jpeg 78d2203063b6f29596d21750b8b98da6 gr8 lrg jpg gr8 gr8 lrg jpg jpg 700278 2314 3427 image high res 1 s2 0 s0022169419306304 gr2 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr2 highres image jpeg 060332ab6b3e20feaee5249d1abe9f14 gr2 lrg jpg gr2 gr2 lrg jpg jpg 92935 1086 1654 image high res 1 s2 0 s0022169419306304 gr3 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr3 highres image jpeg 5ed48861ca599773638de411d107778d gr3 lrg jpg gr3 gr3 lrg jpg jpg 256114 1750 3150 image high res 1 s2 0 s0022169419306304 gr1 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr1 highres image jpeg 217059b315286f434bd95890cec959a1 gr1 lrg jpg gr1 gr1 lrg jpg jpg 260285 2297 3151 image high res 1 s2 0 s0022169419306304 si5 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml f5f420395925f5dc6d5bf0edbdae2015 si5 svg si5 si5 svg svg 2380 altimg 1 s2 0 s0022169419306304 si2 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 3cafe74760ad6580040f31005ac58e40 si2 svg si2 si2 svg svg 2398 altimg 1 s2 0 s0022169419306304 si15 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 50bdd8a61495ad050c4fa927e1c4b50f si15 svg si15 si15 svg svg 9671 altimg 1 s2 0 s0022169419306304 si12 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 37e52f2417468fbfd8f395889efeb931 si12 svg si12 si12 svg svg 9484 altimg 1 s2 0 s0022169419306304 si27 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 9d60543e84a411fcb56e04eed07d632b si27 svg si27 si27 svg svg 1412 altimg 1 s2 0 s0022169419306304 si20 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 19768891d60f90b99b6fd990bcf91610 si20 svg si20 si20 svg svg 1627 altimg 1 s2 0 s0022169419306304 si52 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml bb2c051c2d418d2bf38dd90efd8c7d59 si52 svg si52 si52 svg svg 10548 altimg 1 s2 0 s0022169419306304 si55 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 85033afe860b9d57033b5856cc58ae42 si55 svg si55 si55 svg svg 5252 altimg 1 s2 0 s0022169419306304 si29 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml d1198c190f34a3dcc9c1050b495a961b si29 svg si29 si29 svg svg 2994 altimg 1 s2 0 s0022169419306304 si44 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 10288d80aa9c5a756b7eb51e70251cde si44 svg si44 si44 svg svg 5682 altimg 1 s2 0 s0022169419306304 si38 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 26e7e13b648df848c68e2b40ffe0afc4 si38 svg si38 si38 svg svg 3472 altimg 1 s2 0 s0022169419306304 si43 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml dbc1d3537c45346c1eba0181a2c52a42 si43 svg si43 si43 svg svg 4062 altimg 1 s2 0 s0022169419306304 si31 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 4a76ffcf7c95100a504edd256aac523f si31 svg si31 si31 svg svg 11706 altimg 1 s2 0 s0022169419306304 si36 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 076bfaed1fb8ffe92e60d49363a6992a si36 svg si36 si36 svg svg 2400 altimg 1 s2 0 s0022169419306304 si54 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml c6f4e94e7c2360ee8a50ea721ce12e39 si54 svg si54 si54 svg svg 7403 altimg 1 s2 0 s0022169419306304 si28 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 7a44c7b9bfec6c9fb15abbd8bad1b34c si28 svg si28 si28 svg svg 2887 altimg 1 s2 0 s0022169419306304 si53 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml d69e2c1301387b84199c4ce466d72279 si53 svg si53 si53 svg svg 6990 altimg 1 s2 0 s0022169419306304 si21 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml a1071ebc5e4fb93e75796bf620ddc589 si21 svg si21 si21 svg svg 1569 altimg 1 s2 0 s0022169419306304 si26 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml fbc6d802421f84741e254aa357411ea8 si26 svg si26 si26 svg svg 31389 altimg 1 s2 0 s0022169419306304 si13 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 58fbdd3cfa921b85de9e1f312267f81e si13 svg si13 si13 svg svg 3264 altimg 1 s2 0 s0022169419306304 si14 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 526a01c15d46421fa3e17929f6ad6f58 si14 svg si14 si14 svg svg 2575 altimg 1 s2 0 s0022169419306304 si3 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 76723afd7790f311b260a5c3931c3056 si3 svg si3 si3 svg svg 1635 altimg 1 s2 0 s0022169419306304 si4 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 8a2908b0afcd9dbe583f454bb39822b6 si4 svg si4 si4 svg svg 16019 altimg 1 s2 0 s0022169419306304 si37 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml f781ca699beb6bed8c74660f9973bb7a si37 svg si37 si37 svg svg 15414 altimg 1 s2 0 s0022169419306304 si30 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 0ccbdd442c50bc1417c9a26bb70b70b5 si30 svg si30 si30 svg svg 6154 altimg 1 s2 0 s0022169419306304 si42 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 020baf8780104f6d633201469c3d8802 si42 svg si42 si42 svg svg 3710 altimg 1 s2 0 s0022169419306304 si45 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 39cb8f189c21bb7eb799c59291defc3c si45 svg si45 si45 svg svg 3349 altimg 1 s2 0 s0022169419306304 si39 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 0e8a91664b93112c4e449a38d129462f si39 svg si39 si39 svg svg 6856 altimg 1 s2 0 s0022169419306304 si33 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 8ba7dd8887e7741b7eb9182c0e4e1ca8 si33 svg si33 si33 svg svg 2642 altimg 1 s2 0 s0022169419306304 si48 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 32928f8393130b77bf05fd960029cb51 si48 svg si48 si48 svg svg 2647 altimg 1 s2 0 s0022169419306304 si34 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 58847460cc142ea8c2857061a3725931 si34 svg si34 si34 svg svg 2678 altimg 1 s2 0 s0022169419306304 si46 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 15b54769af18124d1bfa30957edf7bc1 si46 svg si46 si46 svg svg 3297 altimg 1 s2 0 s0022169419306304 si41 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 31f17d5133632ef2aa919e8b49887df0 si41 svg si41 si41 svg svg 2765 altimg 1 s2 0 s0022169419306304 si50 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml de9ad37f01a3ca9344a67a406433347f si50 svg si50 si50 svg svg 28392 altimg 1 s2 0 s0022169419306304 si25 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml bb45a8fb43892d1aca3b617e3eff9d49 si25 svg si25 si25 svg svg 4267 altimg 1 s2 0 s0022169419306304 si22 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml f89ed4a1a3ebe2853b8cd22f9f8d7eb5 si22 svg si22 si22 svg svg 7820 altimg 1 s2 0 s0022169419306304 si17 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 6be55cabacf1f91cf577e47664113935 si17 svg si17 si17 svg svg 4487 altimg 1 s2 0 s0022169419306304 si9 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 0726370aa8d0833a1272eefb5eb3a432 si9 svg si9 si9 svg svg 2251 altimg 1 s2 0 s0022169419306304 si10 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 10c2bc7fd40af6ed536bc582128c6b9a si10 svg si10 si10 svg svg 4301 altimg 1 s2 0 s0022169419306304 si7 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml ff6418351786887f27bd54866908015a si7 svg si7 si7 svg svg 2786 altimg 1 s2 0 s0022169419306304 si19 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml ca3905f893b4ec5ec7d1bfc3c27cfbf8 si19 svg si19 si19 svg svg 7440 altimg 1 s2 0 s0022169419306304 si40 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 9b777ff5dce7c6fa848965eb6d9dd32f si40 svg si40 si40 svg svg 2928 altimg 1 s2 0 s0022169419306304 si47 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml c669d15b64e0684b30cf1aba70c7f2b3 si47 svg si47 si47 svg svg 19892 altimg 1 s2 0 s0022169419306304 si49 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 870c696df82108ccd353731201447914 si49 svg si49 si49 svg svg 3009 altimg 1 s2 0 s0022169419306304 si35 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 339e166028eacac442bd670dc954dab9 si35 svg si35 si35 svg svg 3771 altimg 1 s2 0 s0022169419306304 si32 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 3a5a49f57245dfc1c9ae7bc89803d22b si32 svg si32 si32 svg svg 4610 altimg 1 s2 0 s0022169419306304 si18 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 904b1ecd8ea1e4da2eb8c19ce0d81324 si18 svg si18 si18 svg svg 17567 altimg 1 s2 0 s0022169419306304 si1 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml e5fb643a05811e65c96ab195d3c2e5ae si1 svg si1 si1 svg svg 1628 altimg 1 s2 0 s0022169419306304 si6 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 9a23c5a7544d5a6640b4d3d6fdd7f32e si6 svg si6 si6 svg svg 1421 altimg 1 s2 0 s0022169419306304 si8 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 319cce77daf2ea8f66873368757499fe si8 svg si8 si8 svg svg 2716 altimg 1 s2 0 s0022169419306304 si11 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml dc7cb6ca6effe43b59c2ee8eb05f1485 si11 svg si11 si11 svg svg 1425 altimg 1 s2 0 s0022169419306304 si16 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 9de5a317388b4968bbcdfa913bd53b4e si16 svg si16 si16 svg svg 2979 altimg 1 s2 0 s0022169419306304 si23 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 04651a2d9b8f07274ffd9a92f122465d si23 svg si23 si23 svg svg 4840 altimg 1 s2 0 s0022169419306304 si24 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml bceb5986f58eb0f40598dbdf3efa73b3 si24 svg si24 si24 svg svg 1750 altimg 1 s2 0 s0022169419306304 si56 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 893ae156a20c78064ab43b3a9e159581 si56 svg si56 si56 svg svg 6640 altimg 1 s2 0 s0022169419306304 si51 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 140291864439385479da542a7764709d si51 svg si51 si51 svg svg 10137 altimg 1 s2 0 s0022169419306304 am pdf am am pdf pdf 2167019 aam pdf https s3 eu west 1 amazonaws com prod ucs content store eu west content egi 10zz8rnw0fd main application pdf fca4a490d67291597d6ed93c9e5c18d8 am pdf hydrol 23910 s0022 1694 19 30630 4 10 1016 j jhydrol 2019 06 082 elsevier b v fig 1 concepts in the complex network a concept of a complex network each gray circle represents a node and each line represents a link in this study we regard catchments as nodes b community structure illustration the nodes within the same ellipse constitute a community c an example of nodes with the highest degree centrality and betweenness centrality in a network d an example of i shells and a k core nucleus fig 2 definition of concurrent floods the flood peak days of two catchments lie within a 7 day window fig 3 cumulative mean of modularity derived from the community detection in 1000 random networks for different linking threshold c θ values of the network fig 4 spatial structure of the catchment network the dots represent the catchments and the lines represent the network links fig 5 spatial structure of the communities polygons with the same color come from the same community according to the community detection method the circled numbers label the large communities fig 6 subnetwork of each large community and catchments with the highest centrality the dots represent the catchments and the lines represent the network links red dots are the catchments with the highest betweenness centrality blue dots are the catchments with the highest degree centrality and green dots are the catchments with the highest betweenness and degree centrality at the same time for interpretation of the references to color in this figure legend the reader is referred to the web version of this article fig 7 monthly frequency of flood occurrences in six large communities gray lines are the monthly frequencies of each catchment red lines are the flood frequencies of catchments with the highest betweenness centrality blue lines are the flood frequencies of catchments with the highest degree centrality and green lines are the flood frequencies of catchments with the highest betweenness and degree centrality at the same time the sum of all frequencies equals 1 the horizontal lines are the upper and lower boundaries of the 95 confidence interval flood rich and normal months are labeled by different point shapes for interpretation of the references to color in this figure legend the reader is referred to the web version of this article fig 8 k core nucleus of each large community the dots represent the catchments and the lines represent the network links green dots are the catchments that belong to the k core nucleus for interpretation of the references to color in this figure legend the reader is referred to the web version of this article table 1 values of the adjusted rank index in the robustness test of the community detection method to different catchment subsets quantiles min 1st qu median mean 3rd qu max ari 0 59 0 83 0 86 0 85 0 90 0 99 table 2 density of the subnetworks induced from each large community community 1 2 3 4 5 6 community network density 0 18 0 28 0 40 0 45 0 30 0 92 table 3 density of the subnetworks induced from the k core nucleus in each large community community 1 2 3 4 5 6 k core nucleus network density 0 46 0 72 0 91 0 98 0 81 1 00 research papers identification of homogeneous regions in terms of flood seasonality using a complex network approach wencong yang a b hanbo yang a b dawen yang a b a department of hydraulic engineering tsinghua university beijing 100084 china department of hydraulic engineering tsinghua university beijing 100084 china department of hydraulic engineering tsinghua university beijing 100084 china b state key laboratory of hydro science and engineering tsinghua university beijing 100084 china state key laboratory of hydro science and engineering tsinghua university beijing 100084 china state key laboratory of hydro science and engineering tsinghua university beijing 100084 china corresponding author at department of hydraulic engineering tsinghua university beijing 100084 china department of hydraulic engineering tsinghua university beijing 100084 china this manuscript was handled by g syme editor in chief with the assistance of shuo wang associate editor catchment classification aids in the identification of homogeneous regions in which catchments have similar flood timing and corresponding climatic drivers as a new classification scheme from complex network theory the community detection method is introduced to classify 242 catchments in the united states based on flood seasonality the robustness of this method is tested by calculating the adjusted rank index between the classification results from different random subsets of the 242 catchments and different flood sampling methods in addition three network metrics network density centrality and k core nucleus are used to further unravel the hydrological connections within each community of catchments catchments with similar flood seasonality cluster into six large communities while catchments in sparsely gauged areas or with unique physiographic properties are isolated from large communities high values of the adjusted rank index show the robustness of the community detection method for catchment classification the results indicate that the complex network is valid for use in classifying catchments based on flood seasonality moreover for each community the network metrics are potential descriptors of a the degree of homogeneity b the representativeness of any catchment and c the spatial scale of synchronized floods therefore the complex network is able to characterize the interconnections between catchments within the community keywords catchment classification floods seasonality complex network 1 introduction in the context of climate change there is growing interest in examining flood climate relationships on large spatial scales e g hodgkins et al 2017 nobre et al 2017 wasko and sharma 2017 merz et al 2014 reported that floods occur within the spatial framework of large scale circulation as a result the predominant drivers e g tropical cyclones monsoons convective systems thunderstorms and snowmelt of floods exhibit similarities among different catchments in many regions furthermore multiple catchments show similar hydrological responses due to common climatic and landscape features coopersmith et al 2012 therefore flood characteristics e g magnitude and timing should be analyzed at the regional scale catchment classification is effective in identifying homogeneous regions in terms of flood characteristics catchment classification has provided the following functions in previous studies related to floods a conducting a robust assessment of regional flood trends hannaford et al 2013 mediero et al 2015 b assessing the spatial coherence of flood seasonality and thus interpreting the predominant flood generation mechanisms mediero et al 2015 berghuijs et al 2016 hall and blöschl 2018 and c linking large scale flood patterns to ocean atmosphere circulations parajka et al 2010 gudmundsson et al 2011 wilby and quinn 2013 liu and zhang 2017 this study focuses on flood seasonality which depicts the main flood occurrence time of the year and provides insight into the generation mechanisms of floods villarini 2016 ye et al 2017 hall and blöschl 2018 due to the strong seasonality of regional climates catchments with similar flood seasonality are spatially coherent blöschl et al 2017 ye et al 2017 clustering algorithms based on flood seasonality have been used for catchment classification in many studies for example hierarchical clustering ward 1963 has been widely used based on the monthly frequency of flood occurrence mediero et al 2015 collins 2019 and the circular statistics of flood timing matti et al 2017 k means clustering lloyd 1982 has also been used based on the circular statistics of flood timing parajka et al 2010 hall and blöschl 2018 merz et al 2018 however studies using clustering algorithms have the following limitations a they do not provide information about the hydrological interdependence and connections of all pairs of catchments b they do not evaluate the degree of homogeneity of each cluster and c they do not quantify the role of each catchment in the cluster e g whether the flood characteristics of a catchment contain sufficient information about the floods in a cluster recently the complex network which models many types of interconnections between objects in a complex system has been introduced in hydrological studies sivakumar 2015 community detection fortunato 2010 as a classification method used in the complex network theory has been used to classify hydrological objects such as precipitation raster grids agarwal et al 2018 sun et al 2018 rainfall gauges conticello et al 2018 and streamflow gauges halverson and fleming 2015 fang et al 2017 to the best of our knowledge no research has classified catchments by combining the community detection method and flood similarities although halverson and fleming 2015 and fang et al 2017 used community detection to classify catchments based on intra annual hydrographs they did not focus on high flows and thus might not necessarily have derived classes of catchments with high flood similarity in addition to the classification purpose a complex network provides detailed information about the relationships between hydrological objects through several network metrics e g the centrality clustering coefficient z score and participation coefficient for example streamflow gauges with high values of betweenness centrality represented the transition positions between station groups with different annual regime types halverson and fleming 2015 adjacent precipitation grids with high values of degree centrality tended to synchronize during extreme rainfall events sun et al 2018 the clustering coefficient reflected the strength of connections of rainfall events between different locations naufan et al 2018 and the z score and participation coefficient characterized the connections within and between different communities of gridded rainfall agarwal et al 2018 however there is still a gap in applying network metrics to characterize the relationship between catchments regarding flood characteristics this study aims to test the community detection method in identifying homogeneous regions in terms of flood seasonality furthermore we use the network metrics to answer the following questions a what is the degree of homogeneity in each community b how can the flood seasonality of each community be characterized by selecting the representative catchment and c what is the spatial scale of synchronized floods the paper is organized as follows section 2 introduces the concepts of the complex network community detection and network metrics used in this study we present data and the method of classifying catchments in section 3 section 4 displays the results of catchment classification based on flood seasonality and the hydrological meanings of the network metrics in section 5 we summarize the features of community detection in classification problems and discuss the potential value of network metrics in real world applications finally conclusions are presented in section 6 2 complex networks 2 1 concepts of a complex network as fig 1 a shows a complex network is a collection of nodes and links some of the nodes are connected by links the nodes can be used to represent real world objects and the relationship between each pair of nodes can be generalized as a link here a node represents a catchment and a link represents some kind of relationship between two catchments e g similarity in certain hydrological properties previous studies employed two similarity metrics between nodes to construct a complex network some used pearson s correlation i e a link connects two nodes if the correlation coefficient between the hydrological variable series at the locations of the pair of nodes exceeds a given threshold these hydrological variables included rainfall at different time scales scarsoglio et al 2013 jha et al 2015 sivakumar and woldemeskel 2015 naufan et al 2018 and daily streamflow halverson and fleming 2015 fang et al 2017 others used event synchronization es quian quiroga et al 2002 i e an es value was calculated based on the synchronization frequency of hydrological events for two locations and then the locations with an es value exceeding a given threshold were assigned a link these hydrological events included high quantiles of rainfall and soil moisture values in raster grids boers et al 2014 agarwal et al 2018 sun et al 2018 we focus on a metric measuring the similarity of flood seasonality in this study 2 2 community detection method community detection is a network partitioning method that creates communities of nodes with strong interconnections fig 1 b illustrates the partitions i e the nodes in the same ellipse comprise a community within a community nodes share a large number of links however between different communities there are far fewer links the linking criterion ensures that nodes within a community have a close relationship with each other and thus have similar features clauset et al 2004 the concept of community is equivalent to cluster in classification problems agarwal et al 2018 a popular way to partition a complex network is to optimize the modularity m clauset et al 2004 which is calculated as follows 1 m c 1 n c l c m d c 2 m 2 where l c is the number of links in community c d c is the number of total links of the nodes in community c n c is the number of communities and m is the total number of links in the complex network for any complex network 0 m 1 the larger is the value of m the more correct is the partition which means that there are many links within communities but few links between communities sun et al 2018 we implement the louvain method blondel et al 2008 to optimize the value of m 2 3 network metrics 2 3 1 network density the density ρ of a network characterizes the counts of connections within the network we calculate the density metric in the subnetwork of each community by including only the within community links therefore for a community c the density is 2 ρ c l c m c m c 1 2 where l c is the number of links in community c and m c is the number of nodes in community c ρ c ranges from 0 to 1 and a high value of ρ c means a high similarity among nodes within the community therefore we regard ρ c as the degree of homogeneity for the catchments in each community 2 3 2 centrality centrality describes the role of a node in a network landherr et al 2010 in this study we are interested in whether nodes with high centrality capture the holistic characteristics of a community therefore the centrality of nodes is assessed in the subnetwork of each community two centrality metrics are shown in fig 1 c and are introduced as follows for a node i in community c the degree centrality is landherr et al 2010 3 d c c i k i m c 1 where k i is the number of links that connect node i to other nodes in community c and m c is the number of nodes in community c the degree centrality illustrates that a node i with a high dc c i value has common characteristics with many nodes in the same community the second centrality metric is the betweenness centrality which is calculated as landherr et al 2010 4 b c c i s i t n c i s t g c s t where g c s t is the number of the shortest paths from node s to t in community c and n c i s t is the number of g c s t paths that pass through the node i a high value of bc c i means that node i bridges nodes from different parts of the network halverson and fleming 2015 2 3 3 k core nucleus a k core nucleus is a group of nodes that are densely connected carmi et al 2007 a k core nucleus is determined as follows carmi et al 2007 a recursively remove all nodes along with their links with only 1 link until no more such nodes exist and assign the removed nodes to the 1 shell b recursively remove all nodes along with their links with i links until no more such nodes exist and assign the removed nodes to the i shell c continue until all nodes have been assigned to a shell and then d all nodes in the k shell k is the maximum of i form a k core nucleus fig 1 d illustrates the structures of a k core nucleus and the i shells since the subnetwork induced from the k core nucleus is densely connected we infer that these nodes show common behaviors in terms of hydrological characteristics 3 data and methods 3 1 study area and data meteorology and streamflow data were obtained from the model parameter estimation experiment mopex duan et al 2006 there were 431 catchments in the data set containing the daily mean streamflow areal precipitation potential evaporation and temperature data from 1948 to 2001 across the united states the daily streamflow data were observed by usgs gauges these catchments experienced limited anthropogenic influence except for agricultural impacts in some catchments berghuijs et al 2016 we selected 242 nonnested catchments with continuous daily data from 1970 to 2000 the areas of these catchments range from 67 to 10 328 k m 2 3 2 construction of a complex network 3 2 1 flood sampling we sampled flood peaks from the time series of daily runoff depths using the peaks over threshold pot method lang et al 1999 the threshold was set for each catchment so that on average two flood peaks per year were selected which was termed pot2 sampling the independence of the flood peaks was guaranteed according to uswrc 1976 5 θ 5 d a y s log a q min 3 4 min q 1 q 2 where θ is the time interval between two threshold excess peaks q 1 and q 2 measured in days and q min is the minimum runoff between q 1 and q 2 for each catchment in the study period of 1970 2000 the 60 largest independent daily runoff depths were selected as flood peaks in 30 complete hydrologic years from oct 1 to sep 30 to demonstrate the insensitivity of the results to the flood sampling strategies we compared the results with those based on 1 sampling the annual maximum daily runoff which was termed am sampling and 2 sampling pot floods so that an average of three flood peaks were selected per year which was termed pot3 sampling 3 2 2 similarity metric between catchments according to berghuijs et al 2019 for two flood peaks from two corresponding catchments if they occurred with a time lag of no more than 7 days they were considered to be concurrent floods as shown in fig 2 a 7 day window allowed two flood peaks from different catchments to concur with lags caused by the propagation of rainstorms and the travel of river flow berghuijs et al 2019 concurrent floods in two catchments do not necessarily indicate that the peaks were triggered by the same weather pattern instead they only indicate similar flood timing of these two peaks the proportion of concurrent floods between two catchments can be expressed as 6 c ij m ij n i n j 2 where m ij is the number of concurrent flood peaks between catchment i and catchment j n i and n j are numbers of total flood peaks of catchment i and catchment j respectively both of which equal 60 in this study since an average of 2 peaks is selected for each catchment in a 30 year period in this study we assumed that two catchments with similar flood seasonality tended to have a large number of concurrent flood peaks therefore we regarded the proportion of concurrent floods as the similarity metric of flood seasonality between the two catchments 3 2 3 the criterion for adding a link between catchments in the complex network of catchments a link was added between two nodes only when the similarity metric i e the proportion of concurrent floods c ij between two catchments exceeded a linking threshold c θ which was determined according to the percentiles of all values of pairwise similarity 7 c θ θ th o f c ij i j for any other similarity metric in previous studies θ t h was 95th agarwal et al 2018 or 98th boers et al 2014 sun et al 2018 which means that a link was added between two nodes only when they had the top 5 or 2 pairwise similarity among those of all pairs of nodes in this study we selected the optimal linking threshold to ensure the best classification although the highest value of modularity corresponded to the best classification in a given network the values of modularity from different networks could not be used to make a comparison because the modularity increased with the decrease of the number of links in the network botta and del genio 2016 specifically a high linking threshold produced a small number of links and further resulted in a high value of modularity to compare the classifications derived from networks with different linking thresholds we calculated the difference between the actual modularity and the typical value of modularity for the given linking threshold which was termed the incremental modularity the typical value of modularity was determined by constructing a random network molloy and reed 1995 with the same degree distribution as that of the actual network the procedure for calculating the incremental modularity is as follows a let θ 90 91 99 b construct a network g θ with the linking threshold c θ c classify all catchments by the community detection method and calculate the modularity of g θ m θ d construct a network g 0 θ by randomly assigning links to nodes ensuring that g 0 θ has the same degree distribution as that of g θ and repeat 1000 times e classify all catchments by the community detection method for those 1000 networks and calculate the mean modularity of 1000 g 0 θ m 0 θ which reduces the uncertainty of the typical modularity under the specific linking threshold f calculate the incremental modularity δ m θ m θ m 0 θ and g select the c θ among all θ when δ m θ is the maximum as shown in fig 3 for each θ the mean modularity m 0 θ reaches a stable value after creating 1000 random networks therefore the incremental modularity has low uncertainty for each linking threshold 3 3 robustness test to assess the robustness of the community detection method we repeatedly sampled a random subset of catchments to construct a complex network and applied community detection the classification method was robust if the classifications of those random subsets were similar to the classification of the actual network the similarity between two classifications was assessed using the adjusted rank index ari hubert and arabie 1985 the procedure of the robustness test is as follows a randomly choose a subset of catchments 80 of total catchments b choose an optimal linking threshold and construct a network c classify the catchments by the community detection method d use the ari to compare the classification with the original classification of the actual network with only the selected subset of catchments included in the comparison and e repeat 100 times and summarize the aris to demonstrate the insensitivity of the classification to flood sampling strategies we also used the ari to evaluate the similarity between the classifications derived from the different flood sampling strategies described in section 3 2 1 3 4 identification of the flood seasonality in each community we assessed the flood seasonality by detecting flood rich months using a significance test method proposed by cunderlik et al 2004 in this method the monthly frequency of flood occurrences is compared to a uniform distribution in which 1 12 of flood peaks are expected to occur in each month the details of the method are given as follows first we calculate the adjusted monthly flood frequency l i for each catchment by modifying the days of each month to equal 30 cunderlik et al 2004 8 c i c i 30 d i l i c i j 1 12 c j 100 where c i is the number of peaks in month i and d i is the number of days in month i the 95 upper and lower confidence intervals are given as cunderlik et al 2004 9 l upper n n 11 491 0 048 n 1 131 l lower n n 27 832 0 199 n 0 964 where n is the total number of flood peaks for one catchment if l i l upper n month i is considered as a flood rich month analogously if l i l lower n month i is considered as a flood scarce month since we sample an identical number of flood peaks for all catchments as stated in section 3 2 1 the l upper n and l lower n are the same for all catchments 4 results 4 1 catchment classification results when the linking threshold c θ c 95 the incremental modularity reaches its maximum i e δ m θ 0 50 under this linking threshold the complex network consists of 242 nodes catchments and 1600 links cases in which the linking threshold is exceeded table 1 summarizes the aris in the robustness test the overall high values of the ari prove that the community detection method is robust under the random sampling of catchments in the sensitivity test of flood sampling strategies the ari between the classifications using pot2 sampling and pot3 sampling is 0 82 the ari between the classifications using am sampling and pot2 sampling is 0 72 and the ari between the classifications using am sampling and pot3 sampling is 0 78 the classifications using 3 flood sampling strategies show similarity in light of the corresponding high aris therefore we only present the results obtained from pot2 sampling in the following parts of the paper as presented in fig 4 links tend to connect catchments that are close to each other in space all catchments are divided into 15 communities as shown in fig 5 catchments in the same community are spatially coherent because catchments whose locations are close to each other experience more concurrent floods six large communities community 1 6 account for 226 out of 242 catchments the remaining catchments in 9 small communities are located in the central inland region southern texas and the florida peninsula two possible factors cause the isolation of these catchments from large communities the first is that there is a lack of catchments in proximity to these 9 small communities in this data set and the other is that these catchments may have unique physiographic properties such as vegetation cover land use and soil properties which lead to different flood responses to climatic drivers kuentz et al 2016 the result shows that the community detection method is able to discover significant spatial clustering patterns large communities and filter weak patterns small communities at the same time since the objective of this study is to identify homogeneous regions in terms of flood seasonality we focus on six large communities as shown in fig 5 community 1 is located in the midwestern us most of the catchments in community 1 experience floods from february to april while 4 catchments in the northwestern part of this community have floods in summer months coopersmith et al 2012 2014 community 2 extends from the east central to the south central us with floods caused by snowmelt or intense precipitation in spring and late winter coopersmith et al 2012 2014 saharia et al 2017 community 3 is located in the southeastern us where floods occur in the cold season and are affected by winter spring extratropical systems coopersmith et al 2012 2014 smith et al 2011 community 4 is located in the northeastern us floods in community 4 occur in early spring due to snowmelt coopersmith et al 2012 2014 saharia et al 2017 community 5 is located on the west coast and coastal mountain ranges where storms bring floods from december to march coopersmith et al 2012 2014 konrad and dettinger 2017 community 6 covers a large extent of mountainous areas including the rocky mountains and the sierra nevada mountains where snowmelt is the predominant cause of the flooding months from april to june coopersmith et al 2012 2014 4 2 application of network metrics 4 2 1 network density table 2 presents the density of the subnetwork induced from each large community community 1 has the lowest network density of 0 18 indicating a low homogeneity of flood seasonality among catchments floods in community 1 include a mixture of summer runoff peaks and cold runoff peaks which produces the low homogeneity community 6 has an extremely high network density of 0 92 which means that in this community nearly all pairs of catchments have similar flood seasonality the possible cause of the high homogeneity of flood seasonality in community 6 is that snowmelt controls flood peaks and since the melting time is much shorter than a rainy season floods caused by snowmelt concur more frequently between different catchments 4 2 2 centrality fig 6 shows the subnetwork and the catchments with the highest centrality of each large community catchments with the highest degree centrality tend to be located in the center of the central regions where catchments are spatially concentrated and the network links are dense due to the abundance of catchments the flood seasonality in such central regions accounts for the overall flood seasonality in the corresponding communities therefore for each community the main characteristics of flood seasonality can be derived from the flood seasonality of the catchments with the highest degree centrality catchments with the highest betweenness centrality show different behaviors from those with the highest degree centrality these catchments are located in the transition zone between different parts of the community for example for community 2 3 and 4 the central catchments in terms of betweenness lie approximately at the midpoint in space of all catchments splitting the spatial distribution of the catchments into two parts the northeastern part and southwestern part of the community according to fig 6 for community 5 in fig 6 the central catchment in terms of betweenness connects catchments from the west coast and three catchments in the southeast of this community fig 7 shows the monthly frequencies of flood occurrences in six large communities for the two catchments with the highest betweenness and degree centrality respectively their monthly flood frequencies show no significant difference and represent the main characteristics of flood seasonality in each community however as an exception in community 1 the monthly flood frequencies are different for the central catchments in terms of the two centrality metrics respectively the reason is that catchments in community 1 are less homogeneous in terms of flood seasonality as discussed in section 4 2 1 since flood rich months occur from march to june in community 1 as shown in fig 7 such a long flood season enables a long propagation time of floods along different catchments the catchment with the highest betweenness centrality is located in the transition zone which can be interpreted as the key position in the propagation path of flood timing therefore as the approximate midpoint of the long flood season in community 1 may is the most significant flood rich month for such a central catchment in community 1 as shown in fig 7 4 2 3 k core nucleus fig 8 presents the k core nucleus of each large community for each community catchments belonging to the k core nucleus cluster in space table 3 shows the density of the subnetwork induced from the k core nucleus in each large community all density values are high indicating that a majority of catchment pairs in the k core nucleus have a link between them therefore floods tend to concur among all catchments in the k core nucleus whose location represents a region with a high risk of synchronized floods 5 discussion 5 1 features of the community detection method the community detection method is different from simple partitioning which divides catchments into a few large groups e g parajka et al 2010 gudmundsson et al 2011 hannaford et al 2013 mediero et al 2015 hall and blöschl 2018 instead the method detects the commonality and uniqueness among a large sample of catchments at the same time therefore the sizes of the communities are not evenly distributed but are either extremely large or small commonality is exhibited in the large communities whose flood seasonalities show strong regional patterns while uniqueness is exhibited in catchments not belonging to any large communities the uniqueness of flood seasonality is exhibited in the isolated catchments which may have different local physiographic properties compared with those of catchments nearby however too many isolated small communities may hamper the interpretation of the hydrological characteristics in each community and the generalization of strategies for flood risk management therefore the selection of classification methods should be determined case by case as section 4 1 shows catchments with similar flood seasonality belong to the same community therefore the community detection method is valid for use in catchment classification based on homogeneous flood seasonality moreover the community detection method has 2 major advantages first a complex network directly depicts the pairwise relationship between catchments via a topologic structure of connections therefore this pairwise relationship can be explicitly visualized as shown in fig 4 second the pairwise relationship is determined by a linking threshold which filters out weak relationships and clarifies clustering structures as presented in figs 4 and 5 5 2 implications of network metrics in hydrological applications unlike previous studies that only classified catchments without further assessing the internal relationships among catchments behind the classification results this study unravels the hydrological connections within the community and between catchments based on network metrics specifically we linked the network density centrality and k core nucleus to hydrological meanings the network density reflects the degree of homogeneity in a community high seasonality homogeneity helps reveal the generation mechanisms of floods in a community of catchments therefore similar strategies for flood risk management can be applied within such a region with less requirement of time consuming local catchment investigations the central catchment in terms of betweenness or degree provides information about the overall characteristics of flood seasonality in a community for flood risk management policymakers can choose the central catchment as a typical catchment in a region to determine management strategies the spatial coverage of the k core nucleus reflects the spatial scale of synchronized floods therefore detecting the k core nucleus is helpful in assessing the flood risk induced by the same extreme weather event 6 conclusions catchment classification is an effective tool for identifying homogeneous regions regarding flood seasonality parajka et al 2010 mediero et al 2015 matti et al 2017 hall and blöschl 2018 merz et al 2018 collins 2019 in the present study we use the community detection method in the complex network theory to classify catchments based on flood seasonality in the united states we further explore the hydrological meanings of three network metrics the network density centrality and k core nucleus according to the high values of the adjusted rank index the community detection is insensitive to different catchment subsets and flood sampling methods six large communities are detected from 242 catchments across the united states catchments in nine small communities show high uniqueness the network metrics capture the characteristics of the communities and the roles of the catchments within each community we draw the main conclusions as follows a the catchments in each large community are spatially coherent flood months of different communities are well distinguished therefore the method can be used to identify homogeneous regions in terms of flood seasonality b the network density metric well captures the degree homogeneity of catchments in the same community the centrality metric helps to select representative catchments for characterizing the overall flood seasonality in each community the k core nucleus metric helps to discover the spatial coverage of synchronized floods in a community further studies can focus on whether the community detection method provides additional discoveries in regional flood patterns compared with traditional clustering methods furthermore more network metrics can be applied to quantify the roles of catchments in the communities and the hydrological similarity among catchments declaration of competing interest none acknowledgments this research was partially supported by funding from the national natural science foundation of china grant nos 51622903 and 41661144031 the national program for support of top notch young professionals of china and the program from the state key laboratory of hydro science and engineering of china grant no 2017 ky 01 mopex data were obtained via ftp hydrology nws noaa gov pub gcip mopex us data the authors thank editors drs geoff syme and shuo wang and three anonymous reviewers for their constructive comments 
6322,catchment classification results 4 2 application of network metrics 4 2 1 network density 4 2 2 centrality 4 2 3 k core nucleus 5 discussion 5 1 features of the community detection method 5 2 implications of network metrics in hydrological applications 6 conclusions acknowledgments agarwal 2018 802 810 a berghuijs 2016 4382 4390 w berghuijs 2019 1423 1428 w blondel 2008 p10008 v bloschl 2017 588 590 g boers 2014 n botta 2016 123402 f carmi 2007 11150 11154 s clauset 2004 a collins 2019 687 698 m conticello 2018 1421 1437 f coopersmith 2014 1960 1983 e coopersmith 2012 4467 4482 e cunderlik 2004 j duan 2006 3 17 q fang 2017 478 493 k fortunato 2010 75 174 s gudmundsson 2011 1034 1045 l hall 2018 3883 3901 j halverson 2015 3301 3318 m hannaford 2013 2717 2733 j hodgkins 2017 704 717 g hubert 1985 193 218 l jha 2015 13 19 s konrad 2017 c kuentz 2016 2863 2879 a landherr 2010 371 385 a lang 1999 103 117 m liu 2017 744 759 j lloyd 1982 129 137 s matti 2017 4354 4370 b mediero 2015 341 360 l merz 2014 1921 1942 b merz 2018 813 826 b molloy 1995 161 180 m naufan 2018 1232 1243 i nobre 2017 084012 g parajka 2010 78 89 j quianquiroga 2002 041904 r saharia 2017 524 535 m scarsoglio 2013 e71129 s sivakumar 2015 761 771 b sivakumar 2015 55 62 b smith 2011 294 309 j sun 2018 203 213 a villarini 2016 80 91 g ward 1963 236 244 h wasko 2017 c wilby 2013 109 121 r ye 2017 1997 2009 s yangx2019x726 yangx2019x726x735 yangx2019x726xw yangx2019x726x735xw 2020 07 08t00 00 00z https vtw elsevier com content oragreement 10206 chu noaa publishacceptedmanuscriptindexable http www elsevier com open access userlicense 1 0 2020 07 08t00 00 00z http creativecommons org licenses by nc nd 4 0 2019 elsevier b v all rights reserved 2019 07 03t23 17 18 602z http vtw elsevier com data voc addontypes 50 7 eoas nsfc national natural science foundation of china http data elsevier com vocabulary scivalfunders 501100001809 http sws geonames org 1814991 item s0022 1694 19 30630 4 s0022169419306304 1 s2 0 s0022169419306304 10 1016 j jhydrol 2019 06 082 271842 2020 11 01t03 40 31 898663z 2019 09 01 2019 09 30 1 s2 0 s0022169419306304 main pdf https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 main application pdf 8b2a8c9571ee628d2d468dc829ec4dc8 main pdf main pdf pdf true 3458048 main 10 1 s2 0 s0022169419306304 main 1 png https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 preview image png 9c317b266bc718bf611c258a1689633e main 1 png main 1 png png 56488 849 656 image web pdf 1 1 s2 0 s0022169419306304 gr6 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr6 downsampled image jpeg 53ef0d21b5cb0f9d37baffbe6de4444c gr6 jpg gr6 gr6 jpg jpg 106861 520 774 image downsampled 1 s2 0 s0022169419306304 gr7 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr7 downsampled image jpeg ea0ace5260f74f7d9c67e70f21484e1f gr7 jpg gr7 gr7 jpg jpg 52918 338 712 image downsampled 1 s2 0 s0022169419306304 gr4 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr4 downsampled image jpeg c607ca6231291b57fff3bdcb91ebb30b gr4 jpg gr4 gr4 jpg jpg 83858 371 774 image downsampled 1 s2 0 s0022169419306304 gr5 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr5 downsampled image jpeg 9ddb3775a58c891378256c75b5aed17d gr5 jpg gr5 gr5 jpg jpg 88033 371 774 image downsampled 1 s2 0 s0022169419306304 gr8 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr8 downsampled image jpeg c23eeac9b625efa7608ac600a04bf116 gr8 jpg gr8 gr8 jpg jpg 106379 523 774 image downsampled 1 s2 0 s0022169419306304 gr2 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr2 downsampled image jpeg a1a00cfa75e3cae717daa0a670343bd9 gr2 jpg gr2 gr2 jpg jpg 16917 245 373 image downsampled 1 s2 0 s0022169419306304 gr3 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr3 downsampled image jpeg 44b27e8de2c672e51f939cc8cf896cb5 gr3 jpg gr3 gr3 jpg jpg 51029 395 711 image downsampled 1 s2 0 s0022169419306304 gr1 jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr1 downsampled image jpeg 28b7de5817d432b47111cf520182989c gr1 jpg gr1 gr1 jpg jpg 49534 519 712 image downsampled 1 s2 0 s0022169419306304 gr6 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr6 thumbnail image gif abb0671c7a40dddc89a064512c81d763 gr6 sml gr6 gr6 sml sml 12129 147 219 image thumbnail 1 s2 0 s0022169419306304 gr7 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr7 thumbnail image gif 2530910808c80454a7eb9f2f5020b933 gr7 sml gr7 gr7 sml sml 7405 104 219 image thumbnail 1 s2 0 s0022169419306304 gr4 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr4 thumbnail image gif 27937e94940d15c65880f2ec720dcfc5 gr4 sml gr4 gr4 sml sml 12477 105 219 image thumbnail 1 s2 0 s0022169419306304 gr5 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr5 thumbnail image gif d267f834b0e80d7017ac79568aaf3195 gr5 sml gr5 gr5 sml sml 12602 105 219 image thumbnail 1 s2 0 s0022169419306304 gr8 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr8 thumbnail image gif 7993c947d8e9a7e5bb240d10785be693 gr8 sml gr8 gr8 sml sml 12110 148 219 image thumbnail 1 s2 0 s0022169419306304 gr2 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr2 thumbnail image gif a02aa0255f9c4c3c2a1f64bf94a4488e gr2 sml gr2 gr2 sml sml 6570 144 219 image thumbnail 1 s2 0 s0022169419306304 gr3 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr3 thumbnail image gif c885c0a170ca9fc1b96523219ef44e4d gr3 sml gr3 gr3 sml sml 6346 122 219 image thumbnail 1 s2 0 s0022169419306304 gr1 sml https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr1 thumbnail image gif 7af7650775a7416b3739cc6700ebebe6 gr1 sml gr1 gr1 sml sml 7882 160 219 image thumbnail 1 s2 0 s0022169419306304 gr6 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr6 highres image jpeg 7e030a1deb71463b72563e36dae7a073 gr6 lrg jpg gr6 gr6 lrg jpg jpg 695503 2302 3427 image high res 1 s2 0 s0022169419306304 gr7 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr7 highres image jpeg abf681c590fdd6386f8b5360b9e92702 gr7 lrg jpg gr7 gr7 lrg jpg jpg 350528 1495 3151 image high res 1 s2 0 s0022169419306304 gr4 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr4 highres image jpeg a7ae859fa90d3a6c9291b57fe077f9d7 gr4 lrg jpg gr4 gr4 lrg jpg jpg 696641 1640 3425 image high res 1 s2 0 s0022169419306304 gr5 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr5 highres image jpeg 0a6ddc35c425c356b9144e794220ddd1 gr5 lrg jpg gr5 gr5 lrg jpg jpg 607473 1640 3425 image high res 1 s2 0 s0022169419306304 gr8 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr8 highres image jpeg 78d2203063b6f29596d21750b8b98da6 gr8 lrg jpg gr8 gr8 lrg jpg jpg 700278 2314 3427 image high res 1 s2 0 s0022169419306304 gr2 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr2 highres image jpeg 060332ab6b3e20feaee5249d1abe9f14 gr2 lrg jpg gr2 gr2 lrg jpg jpg 92935 1086 1654 image high res 1 s2 0 s0022169419306304 gr3 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr3 highres image jpeg 5ed48861ca599773638de411d107778d gr3 lrg jpg gr3 gr3 lrg jpg jpg 256114 1750 3150 image high res 1 s2 0 s0022169419306304 gr1 lrg jpg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 gr1 highres image jpeg 217059b315286f434bd95890cec959a1 gr1 lrg jpg gr1 gr1 lrg jpg jpg 260285 2297 3151 image high res 1 s2 0 s0022169419306304 si5 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml f5f420395925f5dc6d5bf0edbdae2015 si5 svg si5 si5 svg svg 2380 altimg 1 s2 0 s0022169419306304 si2 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 3cafe74760ad6580040f31005ac58e40 si2 svg si2 si2 svg svg 2398 altimg 1 s2 0 s0022169419306304 si15 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 50bdd8a61495ad050c4fa927e1c4b50f si15 svg si15 si15 svg svg 9671 altimg 1 s2 0 s0022169419306304 si12 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 37e52f2417468fbfd8f395889efeb931 si12 svg si12 si12 svg svg 9484 altimg 1 s2 0 s0022169419306304 si27 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 9d60543e84a411fcb56e04eed07d632b si27 svg si27 si27 svg svg 1412 altimg 1 s2 0 s0022169419306304 si20 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 19768891d60f90b99b6fd990bcf91610 si20 svg si20 si20 svg svg 1627 altimg 1 s2 0 s0022169419306304 si52 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml bb2c051c2d418d2bf38dd90efd8c7d59 si52 svg si52 si52 svg svg 10548 altimg 1 s2 0 s0022169419306304 si55 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 85033afe860b9d57033b5856cc58ae42 si55 svg si55 si55 svg svg 5252 altimg 1 s2 0 s0022169419306304 si29 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml d1198c190f34a3dcc9c1050b495a961b si29 svg si29 si29 svg svg 2994 altimg 1 s2 0 s0022169419306304 si44 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 10288d80aa9c5a756b7eb51e70251cde si44 svg si44 si44 svg svg 5682 altimg 1 s2 0 s0022169419306304 si38 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 26e7e13b648df848c68e2b40ffe0afc4 si38 svg si38 si38 svg svg 3472 altimg 1 s2 0 s0022169419306304 si43 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml dbc1d3537c45346c1eba0181a2c52a42 si43 svg si43 si43 svg svg 4062 altimg 1 s2 0 s0022169419306304 si31 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 4a76ffcf7c95100a504edd256aac523f si31 svg si31 si31 svg svg 11706 altimg 1 s2 0 s0022169419306304 si36 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 076bfaed1fb8ffe92e60d49363a6992a si36 svg si36 si36 svg svg 2400 altimg 1 s2 0 s0022169419306304 si54 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml c6f4e94e7c2360ee8a50ea721ce12e39 si54 svg si54 si54 svg svg 7403 altimg 1 s2 0 s0022169419306304 si28 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 7a44c7b9bfec6c9fb15abbd8bad1b34c si28 svg si28 si28 svg svg 2887 altimg 1 s2 0 s0022169419306304 si53 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml d69e2c1301387b84199c4ce466d72279 si53 svg si53 si53 svg svg 6990 altimg 1 s2 0 s0022169419306304 si21 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml a1071ebc5e4fb93e75796bf620ddc589 si21 svg si21 si21 svg svg 1569 altimg 1 s2 0 s0022169419306304 si26 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml fbc6d802421f84741e254aa357411ea8 si26 svg si26 si26 svg svg 31389 altimg 1 s2 0 s0022169419306304 si13 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 58fbdd3cfa921b85de9e1f312267f81e si13 svg si13 si13 svg svg 3264 altimg 1 s2 0 s0022169419306304 si14 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 526a01c15d46421fa3e17929f6ad6f58 si14 svg si14 si14 svg svg 2575 altimg 1 s2 0 s0022169419306304 si3 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 76723afd7790f311b260a5c3931c3056 si3 svg si3 si3 svg svg 1635 altimg 1 s2 0 s0022169419306304 si4 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 8a2908b0afcd9dbe583f454bb39822b6 si4 svg si4 si4 svg svg 16019 altimg 1 s2 0 s0022169419306304 si37 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml f781ca699beb6bed8c74660f9973bb7a si37 svg si37 si37 svg svg 15414 altimg 1 s2 0 s0022169419306304 si30 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 0ccbdd442c50bc1417c9a26bb70b70b5 si30 svg si30 si30 svg svg 6154 altimg 1 s2 0 s0022169419306304 si42 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 020baf8780104f6d633201469c3d8802 si42 svg si42 si42 svg svg 3710 altimg 1 s2 0 s0022169419306304 si45 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 39cb8f189c21bb7eb799c59291defc3c si45 svg si45 si45 svg svg 3349 altimg 1 s2 0 s0022169419306304 si39 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 0e8a91664b93112c4e449a38d129462f si39 svg si39 si39 svg svg 6856 altimg 1 s2 0 s0022169419306304 si33 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 8ba7dd8887e7741b7eb9182c0e4e1ca8 si33 svg si33 si33 svg svg 2642 altimg 1 s2 0 s0022169419306304 si48 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 32928f8393130b77bf05fd960029cb51 si48 svg si48 si48 svg svg 2647 altimg 1 s2 0 s0022169419306304 si34 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 58847460cc142ea8c2857061a3725931 si34 svg si34 si34 svg svg 2678 altimg 1 s2 0 s0022169419306304 si46 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 15b54769af18124d1bfa30957edf7bc1 si46 svg si46 si46 svg svg 3297 altimg 1 s2 0 s0022169419306304 si41 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 31f17d5133632ef2aa919e8b49887df0 si41 svg si41 si41 svg svg 2765 altimg 1 s2 0 s0022169419306304 si50 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml de9ad37f01a3ca9344a67a406433347f si50 svg si50 si50 svg svg 28392 altimg 1 s2 0 s0022169419306304 si25 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml bb45a8fb43892d1aca3b617e3eff9d49 si25 svg si25 si25 svg svg 4267 altimg 1 s2 0 s0022169419306304 si22 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml f89ed4a1a3ebe2853b8cd22f9f8d7eb5 si22 svg si22 si22 svg svg 7820 altimg 1 s2 0 s0022169419306304 si17 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 6be55cabacf1f91cf577e47664113935 si17 svg si17 si17 svg svg 4487 altimg 1 s2 0 s0022169419306304 si9 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 0726370aa8d0833a1272eefb5eb3a432 si9 svg si9 si9 svg svg 2251 altimg 1 s2 0 s0022169419306304 si10 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 10c2bc7fd40af6ed536bc582128c6b9a si10 svg si10 si10 svg svg 4301 altimg 1 s2 0 s0022169419306304 si7 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml ff6418351786887f27bd54866908015a si7 svg si7 si7 svg svg 2786 altimg 1 s2 0 s0022169419306304 si19 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml ca3905f893b4ec5ec7d1bfc3c27cfbf8 si19 svg si19 si19 svg svg 7440 altimg 1 s2 0 s0022169419306304 si40 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 9b777ff5dce7c6fa848965eb6d9dd32f si40 svg si40 si40 svg svg 2928 altimg 1 s2 0 s0022169419306304 si47 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml c669d15b64e0684b30cf1aba70c7f2b3 si47 svg si47 si47 svg svg 19892 altimg 1 s2 0 s0022169419306304 si49 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 870c696df82108ccd353731201447914 si49 svg si49 si49 svg svg 3009 altimg 1 s2 0 s0022169419306304 si35 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 339e166028eacac442bd670dc954dab9 si35 svg si35 si35 svg svg 3771 altimg 1 s2 0 s0022169419306304 si32 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 3a5a49f57245dfc1c9ae7bc89803d22b si32 svg si32 si32 svg svg 4610 altimg 1 s2 0 s0022169419306304 si18 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 904b1ecd8ea1e4da2eb8c19ce0d81324 si18 svg si18 si18 svg svg 17567 altimg 1 s2 0 s0022169419306304 si1 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml e5fb643a05811e65c96ab195d3c2e5ae si1 svg si1 si1 svg svg 1628 altimg 1 s2 0 s0022169419306304 si6 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 9a23c5a7544d5a6640b4d3d6fdd7f32e si6 svg si6 si6 svg svg 1421 altimg 1 s2 0 s0022169419306304 si8 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 319cce77daf2ea8f66873368757499fe si8 svg si8 si8 svg svg 2716 altimg 1 s2 0 s0022169419306304 si11 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml dc7cb6ca6effe43b59c2ee8eb05f1485 si11 svg si11 si11 svg svg 1425 altimg 1 s2 0 s0022169419306304 si16 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 9de5a317388b4968bbcdfa913bd53b4e si16 svg si16 si16 svg svg 2979 altimg 1 s2 0 s0022169419306304 si23 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 04651a2d9b8f07274ffd9a92f122465d si23 svg si23 si23 svg svg 4840 altimg 1 s2 0 s0022169419306304 si24 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml bceb5986f58eb0f40598dbdf3efa73b3 si24 svg si24 si24 svg svg 1750 altimg 1 s2 0 s0022169419306304 si56 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 893ae156a20c78064ab43b3a9e159581 si56 svg si56 si56 svg svg 6640 altimg 1 s2 0 s0022169419306304 si51 svg https s3 eu west 1 amazonaws com prod ucs content store eu west content pii s0022169419306304 stripin image svg xml 140291864439385479da542a7764709d si51 svg si51 si51 svg svg 10137 altimg 1 s2 0 s0022169419306304 am pdf am am pdf pdf 2167019 aam pdf https s3 eu west 1 amazonaws com prod ucs content store eu west content egi 10zz8rnw0fd main application pdf fca4a490d67291597d6ed93c9e5c18d8 am pdf hydrol 23910 s0022 1694 19 30630 4 10 1016 j jhydrol 2019 06 082 elsevier b v fig 1 concepts in the complex network a concept of a complex network each gray circle represents a node and each line represents a link in this study we regard catchments as nodes b community structure illustration the nodes within the same ellipse constitute a community c an example of nodes with the highest degree centrality and betweenness centrality in a network d an example of i shells and a k core nucleus fig 2 definition of concurrent floods the flood peak days of two catchments lie within a 7 day window fig 3 cumulative mean of modularity derived from the community detection in 1000 random networks for different linking threshold c θ values of the network fig 4 spatial structure of the catchment network the dots represent the catchments and the lines represent the network links fig 5 spatial structure of the communities polygons with the same color come from the same community according to the community detection method the circled numbers label the large communities fig 6 subnetwork of each large community and catchments with the highest centrality the dots represent the catchments and the lines represent the network links red dots are the catchments with the highest betweenness centrality blue dots are the catchments with the highest degree centrality and green dots are the catchments with the highest betweenness and degree centrality at the same time for interpretation of the references to color in this figure legend the reader is referred to the web version of this article fig 7 monthly frequency of flood occurrences in six large communities gray lines are the monthly frequencies of each catchment red lines are the flood frequencies of catchments with the highest betweenness centrality blue lines are the flood frequencies of catchments with the highest degree centrality and green lines are the flood frequencies of catchments with the highest betweenness and degree centrality at the same time the sum of all frequencies equals 1 the horizontal lines are the upper and lower boundaries of the 95 confidence interval flood rich and normal months are labeled by different point shapes for interpretation of the references to color in this figure legend the reader is referred to the web version of this article fig 8 k core nucleus of each large community the dots represent the catchments and the lines represent the network links green dots are the catchments that belong to the k core nucleus for interpretation of the references to color in this figure legend the reader is referred to the web version of this article table 1 values of the adjusted rank index in the robustness test of the community detection method to different catchment subsets quantiles min 1st qu median mean 3rd qu max ari 0 59 0 83 0 86 0 85 0 90 0 99 table 2 density of the subnetworks induced from each large community community 1 2 3 4 5 6 community network density 0 18 0 28 0 40 0 45 0 30 0 92 table 3 density of the subnetworks induced from the k core nucleus in each large community community 1 2 3 4 5 6 k core nucleus network density 0 46 0 72 0 91 0 98 0 81 1 00 research papers identification of homogeneous regions in terms of flood seasonality using a complex network approach wencong yang a b hanbo yang a b dawen yang a b a department of hydraulic engineering tsinghua university beijing 100084 china department of hydraulic engineering tsinghua university beijing 100084 china department of hydraulic engineering tsinghua university beijing 100084 china b state key laboratory of hydro science and engineering tsinghua university beijing 100084 china state key laboratory of hydro science and engineering tsinghua university beijing 100084 china state key laboratory of hydro science and engineering tsinghua university beijing 100084 china corresponding author at department of hydraulic engineering tsinghua university beijing 100084 china department of hydraulic engineering tsinghua university beijing 100084 china this manuscript was handled by g syme editor in chief with the assistance of shuo wang associate editor catchment classification aids in the identification of homogeneous regions in which catchments have similar flood timing and corresponding climatic drivers as a new classification scheme from complex network theory the community detection method is introduced to classify 242 catchments in the united states based on flood seasonality the robustness of this method is tested by calculating the adjusted rank index between the classification results from different random subsets of the 242 catchments and different flood sampling methods in addition three network metrics network density centrality and k core nucleus are used to further unravel the hydrological connections within each community of catchments catchments with similar flood seasonality cluster into six large communities while catchments in sparsely gauged areas or with unique physiographic properties are isolated from large communities high values of the adjusted rank index show the robustness of the community detection method for catchment classification the results indicate that the complex network is valid for use in classifying catchments based on flood seasonality moreover for each community the network metrics are potential descriptors of a the degree of homogeneity b the representativeness of any catchment and c the spatial scale of synchronized floods therefore the complex network is able to characterize the interconnections between catchments within the community keywords catchment classification floods seasonality complex network 1 introduction in the context of climate change there is growing interest in examining flood climate relationships on large spatial scales e g hodgkins et al 2017 nobre et al 2017 wasko and sharma 2017 merz et al 2014 reported that floods occur within the spatial framework of large scale circulation as a result the predominant drivers e g tropical cyclones monsoons convective systems thunderstorms and snowmelt of floods exhibit similarities among different catchments in many regions furthermore multiple catchments show similar hydrological responses due to common climatic and landscape features coopersmith et al 2012 therefore flood characteristics e g magnitude and timing should be analyzed at the regional scale catchment classification is effective in identifying homogeneous regions in terms of flood characteristics catchment classification has provided the following functions in previous studies related to floods a conducting a robust assessment of regional flood trends hannaford et al 2013 mediero et al 2015 b assessing the spatial coherence of flood seasonality and thus interpreting the predominant flood generation mechanisms mediero et al 2015 berghuijs et al 2016 hall and blöschl 2018 and c linking large scale flood patterns to ocean atmosphere circulations parajka et al 2010 gudmundsson et al 2011 wilby and quinn 2013 liu and zhang 2017 this study focuses on flood seasonality which depicts the main flood occurrence time of the year and provides insight into the generation mechanisms of floods villarini 2016 ye et al 2017 hall and blöschl 2018 due to the strong seasonality of regional climates catchments with similar flood seasonality are spatially coherent blöschl et al 2017 ye et al 2017 clustering algorithms based on flood seasonality have been used for catchment classification in many studies for example hierarchical clustering ward 1963 has been widely used based on the monthly frequency of flood occurrence mediero et al 2015 collins 2019 and the circular statistics of flood timing matti et al 2017 k means clustering lloyd 1982 has also been used based on the circular statistics of flood timing parajka et al 2010 hall and blöschl 2018 merz et al 2018 however studies using clustering algorithms have the following limitations a they do not provide information about the hydrological interdependence and connections of all pairs of catchments b they do not evaluate the degree of homogeneity of each cluster and c they do not quantify the role of each catchment in the cluster e g whether the flood characteristics of a catchment contain sufficient information about the floods in a cluster recently the complex network which models many types of interconnections between objects in a complex system has been introduced in hydrological studies sivakumar 2015 community detection fortunato 2010 as a classification method used in the complex network theory has been used to classify hydrological objects such as precipitation raster grids agarwal et al 2018 sun et al 2018 rainfall gauges conticello et al 2018 and streamflow gauges halverson and fleming 2015 fang et al 2017 to the best of our knowledge no research has classified catchments by combining the community detection method and flood similarities although halverson and fleming 2015 and fang et al 2017 used community detection to classify catchments based on intra annual hydrographs they did not focus on high flows and thus might not necessarily have derived classes of catchments with high flood similarity in addition to the classification purpose a complex network provides detailed information about the relationships between hydrological objects through several network metrics e g the centrality clustering coefficient z score and participation coefficient for example streamflow gauges with high values of betweenness centrality represented the transition positions between station groups with different annual regime types halverson and fleming 2015 adjacent precipitation grids with high values of degree centrality tended to synchronize during extreme rainfall events sun et al 2018 the clustering coefficient reflected the strength of connections of rainfall events between different locations naufan et al 2018 and the z score and participation coefficient characterized the connections within and between different communities of gridded rainfall agarwal et al 2018 however there is still a gap in applying network metrics to characterize the relationship between catchments regarding flood characteristics this study aims to test the community detection method in identifying homogeneous regions in terms of flood seasonality furthermore we use the network metrics to answer the following questions a what is the degree of homogeneity in each community b how can the flood seasonality of each community be characterized by selecting the representative catchment and c what is the spatial scale of synchronized floods the paper is organized as follows section 2 introduces the concepts of the complex network community detection and network metrics used in this study we present data and the method of classifying catchments in section 3 section 4 displays the results of catchment classification based on flood seasonality and the hydrological meanings of the network metrics in section 5 we summarize the features of community detection in classification problems and discuss the potential value of network metrics in real world applications finally conclusions are presented in section 6 2 complex networks 2 1 concepts of a complex network as fig 1 a shows a complex network is a collection of nodes and links some of the nodes are connected by links the nodes can be used to represent real world objects and the relationship between each pair of nodes can be generalized as a link here a node represents a catchment and a link represents some kind of relationship between two catchments e g similarity in certain hydrological properties previous studies employed two similarity metrics between nodes to construct a complex network some used pearson s correlation i e a link connects two nodes if the correlation coefficient between the hydrological variable series at the locations of the pair of nodes exceeds a given threshold these hydrological variables included rainfall at different time scales scarsoglio et al 2013 jha et al 2015 sivakumar and woldemeskel 2015 naufan et al 2018 and daily streamflow halverson and fleming 2015 fang et al 2017 others used event synchronization es quian quiroga et al 2002 i e an es value was calculated based on the synchronization frequency of hydrological events for two locations and then the locations with an es value exceeding a given threshold were assigned a link these hydrological events included high quantiles of rainfall and soil moisture values in raster grids boers et al 2014 agarwal et al 2018 sun et al 2018 we focus on a metric measuring the similarity of flood seasonality in this study 2 2 community detection method community detection is a network partitioning method that creates communities of nodes with strong interconnections fig 1 b illustrates the partitions i e the nodes in the same ellipse comprise a community within a community nodes share a large number of links however between different communities there are far fewer links the linking criterion ensures that nodes within a community have a close relationship with each other and thus have similar features clauset et al 2004 the concept of community is equivalent to cluster in classification problems agarwal et al 2018 a popular way to partition a complex network is to optimize the modularity m clauset et al 2004 which is calculated as follows 1 m c 1 n c l c m d c 2 m 2 where l c is the number of links in community c d c is the number of total links of the nodes in community c n c is the number of communities and m is the total number of links in the complex network for any complex network 0 m 1 the larger is the value of m the more correct is the partition which means that there are many links within communities but few links between communities sun et al 2018 we implement the louvain method blondel et al 2008 to optimize the value of m 2 3 network metrics 2 3 1 network density the density ρ of a network characterizes the counts of connections within the network we calculate the density metric in the subnetwork of each community by including only the within community links therefore for a community c the density is 2 ρ c l c m c m c 1 2 where l c is the number of links in community c and m c is the number of nodes in community c ρ c ranges from 0 to 1 and a high value of ρ c means a high similarity among nodes within the community therefore we regard ρ c as the degree of homogeneity for the catchments in each community 2 3 2 centrality centrality describes the role of a node in a network landherr et al 2010 in this study we are interested in whether nodes with high centrality capture the holistic characteristics of a community therefore the centrality of nodes is assessed in the subnetwork of each community two centrality metrics are shown in fig 1 c and are introduced as follows for a node i in community c the degree centrality is landherr et al 2010 3 d c c i k i m c 1 where k i is the number of links that connect node i to other nodes in community c and m c is the number of nodes in community c the degree centrality illustrates that a node i with a high dc c i value has common characteristics with many nodes in the same community the second centrality metric is the betweenness centrality which is calculated as landherr et al 2010 4 b c c i s i t n c i s t g c s t where g c s t is the number of the shortest paths from node s to t in community c and n c i s t is the number of g c s t paths that pass through the node i a high value of bc c i means that node i bridges nodes from different parts of the network halverson and fleming 2015 2 3 3 k core nucleus a k core nucleus is a group of nodes that are densely connected carmi et al 2007 a k core nucleus is determined as follows carmi et al 2007 a recursively remove all nodes along with their links with only 1 link until no more such nodes exist and assign the removed nodes to the 1 shell b recursively remove all nodes along with their links with i links until no more such nodes exist and assign the removed nodes to the i shell c continue until all nodes have been assigned to a shell and then d all nodes in the k shell k is the maximum of i form a k core nucleus fig 1 d illustrates the structures of a k core nucleus and the i shells since the subnetwork induced from the k core nucleus is densely connected we infer that these nodes show common behaviors in terms of hydrological characteristics 3 data and methods 3 1 study area and data meteorology and streamflow data were obtained from the model parameter estimation experiment mopex duan et al 2006 there were 431 catchments in the data set containing the daily mean streamflow areal precipitation potential evaporation and temperature data from 1948 to 2001 across the united states the daily streamflow data were observed by usgs gauges these catchments experienced limited anthropogenic influence except for agricultural impacts in some catchments berghuijs et al 2016 we selected 242 nonnested catchments with continuous daily data from 1970 to 2000 the areas of these catchments range from 67 to 10 328 k m 2 3 2 construction of a complex network 3 2 1 flood sampling we sampled flood peaks from the time series of daily runoff depths using the peaks over threshold pot method lang et al 1999 the threshold was set for each catchment so that on average two flood peaks per year were selected which was termed pot2 sampling the independence of the flood peaks was guaranteed according to uswrc 1976 5 θ 5 d a y s log a q min 3 4 min q 1 q 2 where θ is the time interval between two threshold excess peaks q 1 and q 2 measured in days and q min is the minimum runoff between q 1 and q 2 for each catchment in the study period of 1970 2000 the 60 largest independent daily runoff depths were selected as flood peaks in 30 complete hydrologic years from oct 1 to sep 30 to demonstrate the insensitivity of the results to the flood sampling strategies we compared the results with those based on 1 sampling the annual maximum daily runoff which was termed am sampling and 2 sampling pot floods so that an average of three flood peaks were selected per year which was termed pot3 sampling 3 2 2 similarity metric between catchments according to berghuijs et al 2019 for two flood peaks from two corresponding catchments if they occurred with a time lag of no more than 7 days they were considered to be concurrent floods as shown in fig 2 a 7 day window allowed two flood peaks from different catchments to concur with lags caused by the propagation of rainstorms and the travel of river flow berghuijs et al 2019 concurrent floods in two catchments do not necessarily indicate that the peaks were triggered by the same weather pattern instead they only indicate similar flood timing of these two peaks the proportion of concurrent floods between two catchments can be expressed as 6 c ij m ij n i n j 2 where m ij is the number of concurrent flood peaks between catchment i and catchment j n i and n j are numbers of total flood peaks of catchment i and catchment j respectively both of which equal 60 in this study since an average of 2 peaks is selected for each catchment in a 30 year period in this study we assumed that two catchments with similar flood seasonality tended to have a large number of concurrent flood peaks therefore we regarded the proportion of concurrent floods as the similarity metric of flood seasonality between the two catchments 3 2 3 the criterion for adding a link between catchments in the complex network of catchments a link was added between two nodes only when the similarity metric i e the proportion of concurrent floods c ij between two catchments exceeded a linking threshold c θ which was determined according to the percentiles of all values of pairwise similarity 7 c θ θ th o f c ij i j for any other similarity metric in previous studies θ t h was 95th agarwal et al 2018 or 98th boers et al 2014 sun et al 2018 which means that a link was added between two nodes only when they had the top 5 or 2 pairwise similarity among those of all pairs of nodes in this study we selected the optimal linking threshold to ensure the best classification although the highest value of modularity corresponded to the best classification in a given network the values of modularity from different networks could not be used to make a comparison because the modularity increased with the decrease of the number of links in the network botta and del genio 2016 specifically a high linking threshold produced a small number of links and further resulted in a high value of modularity to compare the classifications derived from networks with different linking thresholds we calculated the difference between the actual modularity and the typical value of modularity for the given linking threshold which was termed the incremental modularity the typical value of modularity was determined by constructing a random network molloy and reed 1995 with the same degree distribution as that of the actual network the procedure for calculating the incremental modularity is as follows a let θ 90 91 99 b construct a network g θ with the linking threshold c θ c classify all catchments by the community detection method and calculate the modularity of g θ m θ d construct a network g 0 θ by randomly assigning links to nodes ensuring that g 0 θ has the same degree distribution as that of g θ and repeat 1000 times e classify all catchments by the community detection method for those 1000 networks and calculate the mean modularity of 1000 g 0 θ m 0 θ which reduces the uncertainty of the typical modularity under the specific linking threshold f calculate the incremental modularity δ m θ m θ m 0 θ and g select the c θ among all θ when δ m θ is the maximum as shown in fig 3 for each θ the mean modularity m 0 θ reaches a stable value after creating 1000 random networks therefore the incremental modularity has low uncertainty for each linking threshold 3 3 robustness test to assess the robustness of the community detection method we repeatedly sampled a random subset of catchments to construct a complex network and applied community detection the classification method was robust if the classifications of those random subsets were similar to the classification of the actual network the similarity between two classifications was assessed using the adjusted rank index ari hubert and arabie 1985 the procedure of the robustness test is as follows a randomly choose a subset of catchments 80 of total catchments b choose an optimal linking threshold and construct a network c classify the catchments by the community detection method d use the ari to compare the classification with the original classification of the actual network with only the selected subset of catchments included in the comparison and e repeat 100 times and summarize the aris to demonstrate the insensitivity of the classification to flood sampling strategies we also used the ari to evaluate the similarity between the classifications derived from the different flood sampling strategies described in section 3 2 1 3 4 identification of the flood seasonality in each community we assessed the flood seasonality by detecting flood rich months using a significance test method proposed by cunderlik et al 2004 in this method the monthly frequency of flood occurrences is compared to a uniform distribution in which 1 12 of flood peaks are expected to occur in each month the details of the method are given as follows first we calculate the adjusted monthly flood frequency l i for each catchment by modifying the days of each month to equal 30 cunderlik et al 2004 8 c i c i 30 d i l i c i j 1 12 c j 100 where c i is the number of peaks in month i and d i is the number of days in month i the 95 upper and lower confidence intervals are given as cunderlik et al 2004 9 l upper n n 11 491 0 048 n 1 131 l lower n n 27 832 0 199 n 0 964 where n is the total number of flood peaks for one catchment if l i l upper n month i is considered as a flood rich month analogously if l i l lower n month i is considered as a flood scarce month since we sample an identical number of flood peaks for all catchments as stated in section 3 2 1 the l upper n and l lower n are the same for all catchments 4 results 4 1 catchment classification results when the linking threshold c θ c 95 the incremental modularity reaches its maximum i e δ m θ 0 50 under this linking threshold the complex network consists of 242 nodes catchments and 1600 links cases in which the linking threshold is exceeded table 1 summarizes the aris in the robustness test the overall high values of the ari prove that the community detection method is robust under the random sampling of catchments in the sensitivity test of flood sampling strategies the ari between the classifications using pot2 sampling and pot3 sampling is 0 82 the ari between the classifications using am sampling and pot2 sampling is 0 72 and the ari between the classifications using am sampling and pot3 sampling is 0 78 the classifications using 3 flood sampling strategies show similarity in light of the corresponding high aris therefore we only present the results obtained from pot2 sampling in the following parts of the paper as presented in fig 4 links tend to connect catchments that are close to each other in space all catchments are divided into 15 communities as shown in fig 5 catchments in the same community are spatially coherent because catchments whose locations are close to each other experience more concurrent floods six large communities community 1 6 account for 226 out of 242 catchments the remaining catchments in 9 small communities are located in the central inland region southern texas and the florida peninsula two possible factors cause the isolation of these catchments from large communities the first is that there is a lack of catchments in proximity to these 9 small communities in this data set and the other is that these catchments may have unique physiographic properties such as vegetation cover land use and soil properties which lead to different flood responses to climatic drivers kuentz et al 2016 the result shows that the community detection method is able to discover significant spatial clustering patterns large communities and filter weak patterns small communities at the same time since the objective of this study is to identify homogeneous regions in terms of flood seasonality we focus on six large communities as shown in fig 5 community 1 is located in the midwestern us most of the catchments in community 1 experience floods from february to april while 4 catchments in the northwestern part of this community have floods in summer months coopersmith et al 2012 2014 community 2 extends from the east central to the south central us with floods caused by snowmelt or intense precipitation in spring and late winter coopersmith et al 2012 2014 saharia et al 2017 community 3 is located in the southeastern us where floods occur in the cold season and are affected by winter spring extratropical systems coopersmith et al 2012 2014 smith et al 2011 community 4 is located in the northeastern us floods in community 4 occur in early spring due to snowmelt coopersmith et al 2012 2014 saharia et al 2017 community 5 is located on the west coast and coastal mountain ranges where storms bring floods from december to march coopersmith et al 2012 2014 konrad and dettinger 2017 community 6 covers a large extent of mountainous areas including the rocky mountains and the sierra nevada mountains where snowmelt is the predominant cause of the flooding months from april to june coopersmith et al 2012 2014 4 2 application of network metrics 4 2 1 network density table 2 presents the density of the subnetwork induced from each large community community 1 has the lowest network density of 0 18 indicating a low homogeneity of flood seasonality among catchments floods in community 1 include a mixture of summer runoff peaks and cold runoff peaks which produces the low homogeneity community 6 has an extremely high network density of 0 92 which means that in this community nearly all pairs of catchments have similar flood seasonality the possible cause of the high homogeneity of flood seasonality in community 6 is that snowmelt controls flood peaks and since the melting time is much shorter than a rainy season floods caused by snowmelt concur more frequently between different catchments 4 2 2 centrality fig 6 shows the subnetwork and the catchments with the highest centrality of each large community catchments with the highest degree centrality tend to be located in the center of the central regions where catchments are spatially concentrated and the network links are dense due to the abundance of catchments the flood seasonality in such central regions accounts for the overall flood seasonality in the corresponding communities therefore for each community the main characteristics of flood seasonality can be derived from the flood seasonality of the catchments with the highest degree centrality catchments with the highest betweenness centrality show different behaviors from those with the highest degree centrality these catchments are located in the transition zone between different parts of the community for example for community 2 3 and 4 the central catchments in terms of betweenness lie approximately at the midpoint in space of all catchments splitting the spatial distribution of the catchments into two parts the northeastern part and southwestern part of the community according to fig 6 for community 5 in fig 6 the central catchment in terms of betweenness connects catchments from the west coast and three catchments in the southeast of this community fig 7 shows the monthly frequencies of flood occurrences in six large communities for the two catchments with the highest betweenness and degree centrality respectively their monthly flood frequencies show no significant difference and represent the main characteristics of flood seasonality in each community however as an exception in community 1 the monthly flood frequencies are different for the central catchments in terms of the two centrality metrics respectively the reason is that catchments in community 1 are less homogeneous in terms of flood seasonality as discussed in section 4 2 1 since flood rich months occur from march to june in community 1 as shown in fig 7 such a long flood season enables a long propagation time of floods along different catchments the catchment with the highest betweenness centrality is located in the transition zone which can be interpreted as the key position in the propagation path of flood timing therefore as the approximate midpoint of the long flood season in community 1 may is the most significant flood rich month for such a central catchment in community 1 as shown in fig 7 4 2 3 k core nucleus fig 8 presents the k core nucleus of each large community for each community catchments belonging to the k core nucleus cluster in space table 3 shows the density of the subnetwork induced from the k core nucleus in each large community all density values are high indicating that a majority of catchment pairs in the k core nucleus have a link between them therefore floods tend to concur among all catchments in the k core nucleus whose location represents a region with a high risk of synchronized floods 5 discussion 5 1 features of the community detection method the community detection method is different from simple partitioning which divides catchments into a few large groups e g parajka et al 2010 gudmundsson et al 2011 hannaford et al 2013 mediero et al 2015 hall and blöschl 2018 instead the method detects the commonality and uniqueness among a large sample of catchments at the same time therefore the sizes of the communities are not evenly distributed but are either extremely large or small commonality is exhibited in the large communities whose flood seasonalities show strong regional patterns while uniqueness is exhibited in catchments not belonging to any large communities the uniqueness of flood seasonality is exhibited in the isolated catchments which may have different local physiographic properties compared with those of catchments nearby however too many isolated small communities may hamper the interpretation of the hydrological characteristics in each community and the generalization of strategies for flood risk management therefore the selection of classification methods should be determined case by case as section 4 1 shows catchments with similar flood seasonality belong to the same community therefore the community detection method is valid for use in catchment classification based on homogeneous flood seasonality moreover the community detection method has 2 major advantages first a complex network directly depicts the pairwise relationship between catchments via a topologic structure of connections therefore this pairwise relationship can be explicitly visualized as shown in fig 4 second the pairwise relationship is determined by a linking threshold which filters out weak relationships and clarifies clustering structures as presented in figs 4 and 5 5 2 implications of network metrics in hydrological applications unlike previous studies that only classified catchments without further assessing the internal relationships among catchments behind the classification results this study unravels the hydrological connections within the community and between catchments based on network metrics specifically we linked the network density centrality and k core nucleus to hydrological meanings the network density reflects the degree of homogeneity in a community high seasonality homogeneity helps reveal the generation mechanisms of floods in a community of catchments therefore similar strategies for flood risk management can be applied within such a region with less requirement of time consuming local catchment investigations the central catchment in terms of betweenness or degree provides information about the overall characteristics of flood seasonality in a community for flood risk management policymakers can choose the central catchment as a typical catchment in a region to determine management strategies the spatial coverage of the k core nucleus reflects the spatial scale of synchronized floods therefore detecting the k core nucleus is helpful in assessing the flood risk induced by the same extreme weather event 6 conclusions catchment classification is an effective tool for identifying homogeneous regions regarding flood seasonality parajka et al 2010 mediero et al 2015 matti et al 2017 hall and blöschl 2018 merz et al 2018 collins 2019 in the present study we use the community detection method in the complex network theory to classify catchments based on flood seasonality in the united states we further explore the hydrological meanings of three network metrics the network density centrality and k core nucleus according to the high values of the adjusted rank index the community detection is insensitive to different catchment subsets and flood sampling methods six large communities are detected from 242 catchments across the united states catchments in nine small communities show high uniqueness the network metrics capture the characteristics of the communities and the roles of the catchments within each community we draw the main conclusions as follows a the catchments in each large community are spatially coherent flood months of different communities are well distinguished therefore the method can be used to identify homogeneous regions in terms of flood seasonality b the network density metric well captures the degree homogeneity of catchments in the same community the centrality metric helps to select representative catchments for characterizing the overall flood seasonality in each community the k core nucleus metric helps to discover the spatial coverage of synchronized floods in a community further studies can focus on whether the community detection method provides additional discoveries in regional flood patterns compared with traditional clustering methods furthermore more network metrics can be applied to quantify the roles of catchments in the communities and the hydrological similarity among catchments declaration of competing interest none acknowledgments this research was partially supported by funding from the national natural science foundation of china grant nos 51622903 and 41661144031 the national program for support of top notch young professionals of china and the program from the state key laboratory of hydro science and engineering of china grant no 2017 ky 01 mopex data were obtained via ftp hydrology nws noaa gov pub gcip mopex us data the authors thank editors drs geoff syme and shuo wang and three anonymous reviewers for their constructive comments 
6323,this study proposes a novel socio hydrological modeling framework for assessing the performance of complex water resources systems it employs and integrates agent based modeling abm and the theory of planned behavior tpb into the socio hydrological modeling framework to account for agents behaviors due to farmers major role in anthropogenic droughts this paper mainly focuses on farmers behavior the tpb framework and the agents behavioral rules in abm are structured based on the data obtained from field questionnaires and interviews by the farmers in the zarrineh river basin as the main river feeding the urmia lake the proposed modeling framework including the tpb and abm structures and rules are validated by comparing the results of the proposed socio hydrological simulation model with the actual data on the simulation period to assess the ability of the proposed framework root mean square error rmse and the determination coefficient dc were computed the results show the acceptable performance of the proposed model by rmse 0 18 and dc 0 92 analysis of the results indicates that financial conditions farmland size farmers age and farmers education are among the major factors in farmers decision making process respectively keywords socio hydrology agent based model abm theory of planned behavior tpb decision making process urmia lake 1 introduction anthropogenic developments have resulted in ever increasing exploitation of freshwater resources leading to severe water stress situation in many regions around the world it has been estimated that due to anthropogenic impacts on the environment at the global scale most of the humans potentially will be exposed to complete water scarcity crisis by 2025 fao 2007 it has been argued that agricultural activities play the most important role in altering hydrologic condition and water scarcity mirchi et al 2014 aghakouchak et al 2015 the lands and water resources have continuously been deteriorated in many parts of the world due to ever increasing water extraction for irrigation kandasamy et al 2014 as hydrological dynamics vary over time water users may change their behavior or plans by developing new interactions with water resources troy et al 2015 the co evolving relationships of hydrological and human systems are capable of creating unforeseen patterns which can induce critical environmental and social challenges sivapalan and bloschl 2015 zehe and sivapalan 2009 therefore in light of increasing anthropogenic impacts alleviation of the emerged water stress conditions requires the assessments based on a profound comprehension of efficient factors which shape the farmers new water consumption behaviors o keeffe et al 2018 hydrological modeling has a significant role in providing insights into the hydrological processes and assessing the possible outcomes of water management strategies for decision makers nourani et al 2018 however while environmental problems originated from anthropogenic activities are widely known to date the two way feedbacks of hydrological dynamics and the adaptive behaviors of humans were generally neglected in hydrological models and assessment processes nazemi and wheater 2015 bierkens 2015 consequently disregarding the dynamic behaviors of humans by assuming their response to changing the environment as static constituents in hydrological assessments can lead to severe shortcoming and possible failure of water resources management strategies in achieving the desired goals sivapalan 2015 in recent years many studies have conducted for compensating the lack of knowledge about the complicated interrelationships and co evolution of combined human and water systems elshafei et al 2015 viglione et al 2014 sivapalan et al 2012 sanderson et al 2017 sivapalan et al 2012 introduced the multidisciplinary field of socio hydrology as a solution approach to predict the co evolution path of societies and hydrological systems they emphasized that by unraveling the complex interdependent dynamics of these systems the socio hydrological approaches can help to build reliable strategies for water resources management and planning following their introduction many researchers and scientists showed that socio hydrological models can incorporate dynamic behaviors of targeted water users inside hydrological systems to demonstrate the relevance of different factors and their cross influences jaramillo et al 2018 di baldassarre et al 2015 srinivasan et al 2017 lei et al 2018 wurl et al 2018 hund et al 2018 it is shown that the outcomes of socio hydrological models can improve the assessments of policy makers for identifying the proper management strategies to cope with water resources challenges especially water scarcity montanari et al 2013 the challenging point in water recourses management is that people try to adapt themselves to the deteriorative environmental problems to satisfy their needs at any cost instead of attempting to revive the environment they live in sivapalan 2015 for identifying the reasons behind this social paradox understanding the indigenous and psychological factors i e attitudes beliefs social norms desires etc of farmers behavior are necessary in recent years through top down approaches which are capable of formulating an overview of a system several socio hydrological models have developed to investigate the complex co evolution of hydrological systems and dynamic behaviors of farmers van emmerik et al 2014 pande and savenije 2016 kuil et al 2016 although the top down approaches used in the previous studies can represent the overall functions of the systems the fundamental background processes may be overlooked o keeffe et al 2018 contrarily the bottom up approaches focus on the underlying linkages of the sub systems which form larger complex systems thus bottom up approaches could deliver more accurate results in investigations of socio hydrological processes especially when sub systems include complex dynamic elements such as humans troy et al 2015 lu et al 2018 one of the most known bottom up approaches which have been used in many branches of science is agent based modeling abm abm is an appropriate method for simulating and modeling large complicated systems composed of individual dynamic components known as agents koutiva and makropoulos 2016 al amin et al 2018 however addressing the interactions between the agents and their environment is a challenging issue this paper presents a novel socio hydrology simulation model based on the bottom up approach to investigate how various psychological factors of farmers can shape the co evolving path of the integrated social hydrological systems and their influence on the restoration of the environment this study is focused on urmia lake one of the largest lakes in the world which is likely to experience a catastrophic drought in the near future the abm approach has been employed for addressing the two way feedbacks of social hydrological systems in this study the agents are defined as farmers and their interactive environment contains the agricultural lands and water resources this paper benefits from the theory of planned behavior tpb to address the farmers interactions with hydrological dynamics in developing agents behavioral rules to form an accurate individual based socio hydrology model 2 proposed socio hydrological model the classic hydrological models assuming humans as boundary conditions or agents with fixed actions are not completely capable of representing the adaptive nature of the human responses srinivasan et al 2017 additionally the information created by scientists from the classic hydrological models could have been followed by shifts in beliefs values and norms which can cause the emergence of new adaptive behaviors in the integrated water and human systems lane 2014 however as demonstrated in fig 1 the socio hydrological models by focusing on two way feedback loops of social and hydrological parameters try to reveal the evolutionary trajectories of these systems therefore by enlightening the set of actors and their actions which permit the system to stay in the desired condition the socio hydrological models are able to provide decision makers high level adaptive management strategies srinivasan et al 2017 as shown in fig 1 social processes and hydrological processes are the two main components of the socio hydrological framework which have two way dynamic interactions with each other and the considered water resources for developing the socio hydrological model in details social and hydrological systems need to be modeled separately while they co evolve throughout linked dynamic changes or activities of each other in the following section the modeling process of social and hydrological systems have been described 2 1 social system modeling ssm integration of tpb and abm in socio hydrological assessments forms the core of the proposed methodology as stated earlier the abm has been used for mimicking the agricultural behaviors of farmers and tpb has been employed for addressing the way that their behaviors originate under different conditions based on the field studies the underlying processes of originating the farmers behaviors have been identified and represented in fig 2 as shown in fig 2 in the first step the farmer agent assesses the financial situation based on the agricultural profit from the last year it is assumed that non desirable financial condition may force the farmers towards more profitable crop patterns with the least expenditures or even least environmental conservative modes of practice consequently the farmers may overexploit natural resources especially surface water and groundwater resources in highly restricted conditions with limited available water the farmers may even tend to withdraw their water need through illegal wells or illegal water connections however a suitable financial situation provides farmers with diverse choices in crop and land allocation depending on other factors such as agricultural knowledge targeted market irrigation techniques machinery etc in the second step if the farmers have a suitable financial condition the water availability plays the most important role in the determination of the cropping pattern in the absence of sufficient education and environmental knowledge the farmers may ignore the water resources condition and aim at maximizing their profit otherwise with awareness about water scarcity and the environmental consequences of overexploitation they may tend to contribute for enhancing the environment and water conservation in the last step of decision making where the agents should decide about the conservation of water resources their intention and behavior will be determined through the tpb agents weak intention through tpb processing is interpreted as farmers ignorance about water resources condition therefore farmers with zero or weak intention on water conservation may try to maximize their profits by extracting as much water as they need if the farmer agents have a strong intention to conserve water and the environment they will have a tendency to reduce their irrigation water need on the other hand farmers with medium strength of intention try to balance the agricultural profit and conservation of the environment in the following sections the main components of the proposed socio hydrological modeling abm and tpb are briefly described 2 1 1 agent based modeling abm abm is a category of computational models for simulating and modeling the large complicated systems composed of individual dynamic components known as agents in many cases by providing models which are close to reality abm is capable of giving a natural description of the processes within the considered adaptive system darbandsari et al 2017 recently abm has been used in many fields of science such as psychology sociology politics economics and environmental management macal and north 2005 williams 2018 an agent based simulation model contains three main components agents environment and time the agents are autonomous decision makers or independent units which are capable of responding dynamically to alterations of their environment or activities of the other agents the environment described as a virtual world simulating a complex system with all of its constitutive components excluding agents rachid et al 2018 and the time component represents the time steps that the agent based model will have through the simulation the main framework of abm is demonstrated in fig 3 as shown in fig 3 an agent could be a single entity with its particular attributes or a group of individuals with similar main attributes the attributes of involving agents can include skills memories knowledge freedom adaption and the ability to interface with other parts of the system in abm the interaction of an agent with other agents or the environment conducted through the behavioral rules ohab yazdi and ahmadi 2018 the agents interact with other parts of the model by sending and receiving messages or diversifying their characteristics and parameters in response to particular messages behavioral rules define how agents will react to the variations of the environmental conditions and the information which they receive as messages marcon et al 2017 the subsequent effects of variations in properties of an agent or the environment are different for diverse types of agents in the given system therefore a change in a particular part of the system may be followed by different behavioral responses from each type of agents in the upcoming feedback loop in the simulation of water resources systems by abm agents can represent diverse stakeholders interacting with groundwater and surface water resources as their environment becu et al 2003 the agent based model of coupled water human systems can capture the processes originated from dynamic interrelations of the integrated systems thus for complex socio hydrological problems abm approach is suitable to provide more explicit predictions and assessments of possible emergent patterns troy et al 2015 2 1 2 theory of planned behavior tpb in 1991 icek ajzen proposed tpb as a framework for predicting the behavioral acts of humans ajzen 1991 tpb has been developed based on the former framework known as the theory of reasoned action to improve its prediction ability ajzen and fishbein 1980 tpb focuses on intention as the main determinant of implementing a certain behavior ajzen 2005 it has been argued that the likelihood of an action to be performed by a person highly depends on the strength of his her behavioral intention ajzen 1991 the tpb offers an approved framework for questionnaire design and presents detailed classifications of attitudes at subjective norms sn and the perceived control pbc which shape the intention toward a certain behavior andrews et al 2011 the suggested equation for intention by tpb has been shown in eq 1 1 i w 1 a t w 2 s n w 3 p b c in eq 1 the term i represents the intention and the terms w refers to the empirically derived weight or coefficient for each parameter attitude represents the degree of positivity or negativity which a person perceives about the considered behavior ajzen 1991 the attitude of a person shaped by the evaluations about what might be correct about a specific subject therefore the attitude may be based on imagination facts or even emotions subjective norm represents the amount of social pressure a person perceives toward performing the considered behavior ajzen 1991 pbc indicates the hardship or easiness a person perceives about performing the considered behavior ajzen 1991 for understanding the anthropogenic behaviors influencing water resources tpb has been used in studies related to preventing waste of water gilg and barr 2006 water conservation yazdanpanah et al 2014 behaviors of farmers in relation to different irrigation methods and behavioral alterations in water consumption koutiva and makropoulos 2016 to the best of our knowledge it is the first research using tpb to build a socio hydrology model 2 2 hydrological system modeling the main components and parameters of hydrological processes include water release from the reservoir s mountain streams precipitation effective precipitation precipitation infiltration rate irrigation return flow irrigation water consumption from surface and groundwater resources industrial water demand and urban water demand the general equation for the hydrological processes can be described as 2 q out q in p r m s r i iw s w i w u e i r where the qout represents the river inflow m3 month qin represents the river outflow m3 month pr is the precipitation of the study region m3 month ms is the mountain streams m3 month ri is irrigation return flow m3 month iws is the irrigation water withdrawal from surface water resources m3 month wi is the industrial water withdrawal m3 month wu is the urban water withdrawal m3 month e is the evaporation m3 month ir is the infiltration rate m3 month due to the absence of urban and industrial return flow in the given study area they are not considered in the eq 2 as it is known the farmers provide some portion of their irrigation water need from groundwater resources in the proposed model based on the surface water withdrawal the following simplified equation for groundwater resources has been used 3 iw gw iw d iw s in which iw gw represents the irrigation water withdrawal legal and illegal from groundwater resources m3 month iw d is the irrigation water demand m3 month and iws is the irrigation water withdrawal from surface water resources m3 month in this study the hydrological processes influencing the given socio hydrological system were modeled using system dynamics sd modeling approach for modeling complex dynamic systems sd approach is able to perform multi attribute and multi scenario analyses which can be used for assessment of alternative management strategies for diverse timescales sehlke and jacobson 2005 the hydrological sd model changes dynamically in response to the behaviors of the agents in abm in other words the environment of the agent based model in which the agents have activities has created by sd hydrological model for integrating the abm and sd as an interactive model the anylogic software has been used by employing a desirable graphical interface the anylogic provides a platform which is able to be used in a wide variety of fields grigoryev 2015 in the anylogic software the modeling process consists of generating the single agents or the population agents defining the environment of the simulation developing layouts for demonstrating the state of each agent defining the behavioral rules and reactions for the agents creating linkages between the agents and their environment and implementing the developed models ohab yazdi and ahmadi 2018 3 results and discussion the proposed socio hydrology model has been applied to investigate a real world environmental challenge after the complete collapse of aral sea because of anthropogenic developments urmia lake one of the largest lakes in the world is likely to end up with the same destiny aghakouchak et al 2015 in the past decade due to agricultural developments the water level of urmia lake has been lessening significantly without any restoration many studies suggested that there is a necessity for an effective framework in order to investigate the anthropogenic causes which have led to drying up the urmia lake sivapalan 2015 roobavannan et al 2017 this study attempts to apply the proposed socio hydrological framework which described in section 2 1 for zarrineh river which is the most vital surface water inflow feeding the urmia lake among all rivers reaching to urmia lake zarrineh river provides more than 49 percent of the water stored in the lake the zarrineh river basin is located at the south of urmia lake in the northwest of iran between 35 41 s to 37 44 n and 45 46 e to 47 23 w the main channel of zarrineh river is 300 km long and most parts of the river run through mountainous areas see fig 4 the coverage area of the river basin is around 12 000 km2 includes both plain and mountainous areas the total area covered by farmlands within the given catchment is 74 318 ha and the growing season for crops in the given basin mostly starts from the middle of the spring until the middle of the autumn during this time irrigation water need of farmlands will be extracted from groundwater and surface water resources the efficiency of the conventional irrigation method in the basin is about 38 for farmlands which are being irrigated using surface water resources in comparison to the average percentage of irrigation efficiency in most developing countries which is 45 the mentioned number for zarrineh river basin represents the ineffectual and outdated system that has been employed for irrigation which led to water loss through seepage and evaporation emami and koch 2018 notwithstanding the calamitous 88 shrinkage of urmia lake which has entailed by severe environmental stresses the expansion of agricultural areas has almost reached its maximum limit ulrp 2017 the seven major crops which cover more than 92 of the farmlands in the zarrineh river basin are wheat barley corn tomato onion sugar beet and alfalfa the comparison between the selling prices of the mentioned crops in the study area has been demonstrated in fig 5 for the study period 2009 2017 required data for socio hydrological modeling of zarrineh river basin compiled from field studies and various official sources the agricultural data of the catchment provided by the ministry of agriculture of iran the agricultural data include the dates of planting and harvesting the crops water need of the crops in the given region the yearly costs of agricultural activities and the selling price for each type of the crops in the study period the data of the crop types and locations of the farmlands irrigation systems water availability flow release of the dam the amount of extractions from surface water and groundwater resources and the percentage of the return flow for each area along the zarrineh river have been obtained from urmia lake restoration program ulrp also the hydrological data including monthly precipitation during the study period and potential evapotranspiration have been provided by the meteorological organization of iran as mentioned in section 2 1 in the first step the determinative factor affecting the decisions of the considered farmers is the financial condition the field studies revealed that for most of the farmers at the given area especially small holders the financial condition falls under the poverty threshold it is evident that the farmers with poor financial condition try to make up for unfavorable poverty situation it should be mentioned the imposed sanctions against iran induced collapse in revenues of the country a major decline in the value of the national currency and an increase of unemployment rate in addition to the economic inflation kokabisaghi 2018 the aforementioned effects of sanctions caused the overall welfare of people to deteriorate in this situation people with poor financial situation are subjected to more deterioration in their lifestyles since the intensifying of sanctions against iran in 2012 that targeted all economic sectors the national currency the rial has been devaluated significantly subsequently every economic sector of iran undergoes the high rate of economic inflation the variation of the economic inflation rate and consumer price index cpi for the study period have been demonstrated in fig 6 available at the central bank of iran s website in the decision making process of the agent based model at the end of every agricultural year 12 time steps in the model each farmer agent evaluates his her net income by considering all farming expenditures in the previous year and the profit of selling the products in this phase the farmer agent compares his her saving for the next 12 months with the poverty threshold of the year if the savings of the farmer falls below the poverty threshold the agent will choose randomly from the cropping patterns with the maximum profit for the next farming year in the given case study the most profitable crops consist of sugar beet and alfalfa which are high water consuming plants it should be noted although a high water consuming plant such as alfalfa has lower selling price than sugar beet the field studies indicated that its ability to be harvested several times a year makes it one of the most profitable crops in the given area also for the agents with big farms the wheat crop could be profitable due to assured selling price under pre set contracts therefore the agents with big farms may consider wheat as an exceptional choice for farming in addition to sugar beet and alfalfa although it has a lower profit in this situation if the surface water of the irrigation network does not satisfy the irrigation water demand the farmers may extract their unmet needs from groundwater resources through legal or illegal wells also if the saving of the agent manifests acceptable financial condition in comparison with the poverty threshold the decision making process of the agent will move to the second step otherwise the decision making process terminates in the second step of the decision making process the farmer agent considers the memory of the precipitation in the previous year as an indicator for demonstrating the perception of farmers about the last year precipitation and their assumption for the possible weather condition in the upcoming year the reconnaissance drought index rdi has been used the rdi has been utilized as the index for the agents memory bank because it can be efficiently connected with agricultural drought calculated for any timescale and having a direct linkage to the weather conditions of the region tsakiris et al 2007 in the agent based model at the end of every 12 time steps the rdi index is calculated for the last year and the result of rdi will update the memory bank of the agent for calculating the rdi at first the initial value α b for the given timescale must be computed by the following equation tsakiris et al 2007 4 α b x y 1 b p xy y 1 b pet xy x 1 t o t in which pet xy and p xy are the potential evapotranspiration and precipitation within the yth time of xth hydrological timescale in this study monthly timescale has considered for y and x represents the agricultural year which starts from october in the given region thus for october b 1 and t represents the number of considered hydrological years after the calculation of α b the standardized rdi rdi st is calculated using eq 5 tsakiris et al 2007 5 rdi st x u b x u b σ ub where u b is the ln α b x u b is the arithmetic mean of u b and σ ub is the standard deviation of u b since the r d i s t acts similar to standardized precipitation index spi the results of r d i s t can be interpreted in terms of the thresholds of spi zarei et al 2016 therefore the memory bank of the agents will be updated by drought class according to table 1 according to table 1 as the second step in ssm if the farmer agent remembers the wet climatic condition higher than normal it will affect his her decision by worrying less about water resources therefore the farmer agent chooses the most profitable crops similar to the previous step at the same time the memory of the dry climatic condition normal or lower than normal makes the farmer agent worry about the water resources and possible agricultural drought in the upcoming year thus the farmer agents should adapt themselves to the drought condition and choose whether they want to conserve water resources or satisfy their financial desires in this situation farmer agent moves to the next step of the decision making process in which the agent decides how much he she wants to participate in decreasing of the irrigation water consumption for adapting or conservating the environment as it can be seen in ssm framework in the third step where the farmer should decide about the conservation of water resources the behavioral rules of the agent is defined through the tpb structure the farmer s intention will be evaluated by the tpb following yazdanpanah et al 2014 tpb questionnaire was designed for determination of the relationships between the parameters of tpb at sn and pbc to form a structural behavioral equation about the act of water conservation see table 3 in this study 274 farmers have been interviewed and asked to fill the questionnaires the respondents were comprised of 11 3 female most of the women also work on household chores and 88 7 male most of the respondents 83 6 work full time on the farm 93 4 of the respondents relied on agriculture as their only source of income other characteristics of the respondents have been presented in table 2 in order to verify the reliability of the tpb structural items the cronbach s alpha has been used as it is demonstrated in table 3 the cronbach s alpha of all variables has been in the range of 0 638 0 864 which are higher than the suggested minimum of 0 60 sas nowosielski 2008 yazdanpanah et al 2014 2015 in the presented questionnaire table 3 seven option for attitude three option for the subjective norm six option for pbc and three option for behavioral intention were offered to the farmers according to the results of the questionnaire the attitude and subjective norm of farmers indicated an inclination to avoid water conservation activities the mean value of pbc represents that most of the respondents especially small holders of zarrineh river basin are experiencing constraints to reduce their irrigation water demand or participate in water conservation activities using tpb structure during the interviews when the farmers asked about the motives for believing that the crop production is more important than water conservation the attitude of the majority of farmers they mentioned several reasons such as economic problems religious beliefs and corruption of some local authorities who want the farmers to consume less water for irrigation while farmers can observe those authorities do not follow water conservation measures in their farming lands further investigation on subjective norm has revealed that the educational programs conducted by some organizations such as local schools and ulrp have had positive impacts on the norms about water conservation in farming however a noteworthy matter stated by some farmers is that while some of their important relatives especially children encourage them to engage in water conservation activities the ethnic conflicts among farmers and the air of competition for having more water for irrigation made the majority of people to have contradicted norms about cooperating and contribution and in water conservation activities ultimately the investigations on the states made by farmers in the category of perceived behavioral control have revealed that even if the economic condition allows them to contribute in water conservation activities some of them do not have the required skills or agricultural knowledge to plant unfamiliar products therefore the farmers may need to be trained and aided when they asked for planting new products with lower water need in this situation the farmers may believe engaging in water conservation activities is beyond their ability to do so afterward for understanding the correspondence among the tpb parameters the bivariate correlations have been obtained and demonstrated in table 4 as it was anticipated there was a positive correlation among all of the constituents of intention in water conservation behavior and related behaviors as it is demonstrated in fig 7 a hypothetical tpb model was built based on the mentioned relationships among structural parameters of tpb the path analysis for the presented tpb model was conducted using spss tools the proposed tpb model indicated good fitness with χ 2 2 124 the root mean square error of approximation rmsea 0 019 nfi 0 937 and cfi 0 972 the standardized regression weights β of path analysis are presented in fig 7 for the farmers of the considered study region all of the tpb parameters have a positive effect on the intention among all of the parameters attitude has the most effect on the behavioral intention with the path coefficient of 0 398 it means that a unit rise in the attitude of the respondent will increase their intention to engage in water conservation activities by 0 398 unit for the dependent parameter behavior both pbc and intention parameters have significant positive affection with the path coefficient of 0 493 and 0 619 respectively based on the standardized regression weights results the tpb equation for behavioral prediction are 6 i 0 398 at 0 301 sn 0 194 pbc 7 b 0 493 pbc 0 619 i in which i and b denotes intention and behavior respectively the behavioral equations of tpb have been used in decision making modeling of the 3rd step of the social system framework the agents have been classified into distinct groups according to the statistical data gathered through field studies see table 2 in this way the agent groups have been distinguished by age education and the farmland size for defining the agent types at first farmer agents were divided regarding their farmland size then the agents have been categorized by their age group and each of the age group has been classified by the education level fig 8 therefore there are 27 types of agents resembling the farmers of the zarrineh river basin all agents are able to decide through the psychological construct of tpb based on their own characteristics although the same formula is used for estimating the intention of different farmers the values of the controlling parameters are derived from the questionnaires and analysis of the interviews thus different values of the psychological factors attitude subjective norm and perceived behavioral control would result in different behavioral rules for each group of the farmer agents in the abm in this study there are three qualitative values considered for the psychological parameters including high medium and low based on the interviews with the farmers and the data obtained from questionnaires each agent group has been ascribed with the qualitative values according to their characteristics for example among the farmers of the study area the ones with higher education claimed that they have a good attitude about engaging in water conservation activities therefore the grade of attitude for the group of agents with higher education has been defined as high on the other hand farmers with no or weak education have had a weaker attitude toward conservational activities therefore the agent group with low educational level have been given low grade for their attitude it should be noted in the anylogic software the mentioned grades have been defined by numerical values among the defined psychological parameters in the abm only the sn has been assumed to be constant for the study period 2009 2017 according to the statements made by the farmers during the interviews their income has a significant effect on their attitude and perceived behavioral control consequently variations of the financial condition during the modeling process when the agents information is updated affects the value of at and pbc for each agent type therefore based on the eqs 6 and 7 the variations of the at and pbc will affect the intention of the agents and subsequently they may alter the behavior of the agent in the upcoming socio hydrological loop in this way for updating these parameters in the agent based model at the end of every agricultural year the agents which have been reached the 3rd step of the ssm see fig 2 of the manuscript compare the amount of their profit in the current year with the amount of the profit of the previous agricultural year provided that the comparison indicates the improvement of the financial condition the at and pbc of that particular agent type will get higher values for the next agricultural year on the other hand if the comparison shows the deterioration of the financial condition the values of the mentioned parameters will get lower values for the next agricultural year otherwise the values will be unchanged it worth mentioning that the stated equations and the assumption about sn are only applied to the farmers of the zarrineh river basin therefore the assumption for the consistency of the sn may not be acceptable for different basins and study periods as it is demonstrated in fig 2 in the 3rd step of the ssm farmer agents have three behavioral choices in relation to water conservation the rules for decision making about water conservation which have been designed based on the characteristics of the respondents observed behaviors and the results of questionnaires are presented in table 5 in this way the b values of eq 7 have been categorized into three categories high medium low all of the crop types in the agent based model have an identical probability to be selected randomly however the crop types that the agents can choose from are different in each behavioral category it should be noted the agents are dynamic and they may change their behavioral category during the modeling period therefore their choices will be varied according to behavioral rules as it can be seen in table 5 for instance if b category is high the agent will select high conservational behavior rules about water resources therefore the agent with conservative behavior will disregard the high profit crops and choose from the low water need crop types including wheat corn or barley which are common in the study area as mentioned earlier in the zarrineh river basin due to assured selling price under pre set contracts for wheat planting the wheat crop has been considered as an exceptional choice by all types of the farmers although it has a lower selling price in comparison to sugar beet and alfalfa see fig 5 according to fig 9 in the modeling process after the decision making section the farmer agent defines the crop type for planting according to table 5 then the farmer agent begins the agricultural processes phase 2 in fig 9 for each agent the amount of irrigation water demand for the upcoming agricultural year will be estimated based on the area of the farmland and the water need of the selected crop in this way the farmers can provide their irrigation water demand from three main sources i surface water ii groundwater and iii precipitation the amount of surface and groundwater withdrawals were calculated through the eq 3 as described in section 2 2 iws and iwg the amount of effective precipitation which provides part of the irrigation water demand was determined using the usda soil conservation service method smith 1992 8 p eff p 125 0 2 p 125 f o r p 250 m m m 9 p eff 125 0 1 p f o r p 250 m m m in which p eff and p indicate effective precipitation and gross monthly precipitation respectively for each part of the agricultural activities depend on the chosen crop type and the size of farmland the agricultural expenditures will be diversified dynamically and it will decrease the savings of the farmer agent at the end of the phase 2 fig 9 the crop yield will be calculated as a function of supplied water for per hectare of farmland area using the eq 10 10 1 y a y m k y 1 et a et m in which y m y a k y et a and et m represent the maximum yield kg ha the actual yield kg ha the yield response factor the actual crop evapotranspiration mm period the maximum crop evapotranspiration mm period respectively doorenbos and kassam 1979 at the end of the agricultural year the farmer agent will sell all of the products phase 3 in fig 9 and deposit the profit in the saving variable in this state the agent will repeat the decision making process for the upcoming agricultural year and the socio hydrological loop will iterate until the end of the given period in the abm fig 10 illustrated the area under cultivation in percentage for each of the considered crops in the given period 2009 2017 as shown in fig 10 the sugar beet alfalfa and wheat were the most planted crops in the considered period of the simulation the results indicated that almost all of the small holder agents did not reach the 2nd step in the decision making process of ssm fig 2 in other words the small holder agents mostly selected their crops for planting from sugar beet and alfalfa because their deposited money in the saving variable was lower than the poverty threshold in the given period it represents the impacts of continues competition between the increase of economic inflation which have a direct effect on increasing the cost of living and the income of farmers especially smallholders it should be mentioned that the average area of smallholders farmlands in the zarrineh river basin is 0 6 ha or lower with the minimum of 0 05 ha for the 2nd step of the ssm the results showed that for most of the years within the given period agents were moving to the 3rd step for decision making about water conservation in the 3rd step of ssm the results of the agent based simulation have demonstrated that approximately 34 of the agents have reached the 3rd step decision making process among these agents averagely 44 have chosen to maximize their profit 31 have chosen to make a balance between profit and water conservation and 25 have chosen to conserve the water resources from this perspective it can be referred although profit maximization is undoubtedly important however it is one among many possible factors affecting the decisions and the behaviors of the farmers by comparing the results of the abm it has shown that the farmer agents which have classified in the age group of old farmers with age more than 50 years old with no university degree mostly chose low conservation level behavioral rule at the same time the results showed that the farmer agents which classified in the group of young farmers with age lower than 35 years old with university degree mostly chose high conservation level behavioral rule as the last step of the modeling the performance of the proposed socio hydrological model should be evaluated in this way by calculating the amount of remaining water the discharge of the zarrineh river qout to urmia lake can be estimated for evaluating the model s performance the estimated values have been compared with the observed time series see fig 11 for this purpose two main efficiency criteria root mean square error rmse and determination coefficient dc have been used sharghi et al 2018 and 2019 11 rmse i 1 n s o i e i 2 n s 12 dc 1 i 1 n s o i e i 2 i 1 n s o i o i 2 where e i o i o i and n s respectively refer to estimated values observed values the mean of observed values and the number of samples fig 11 shows the high performance of the proposed socio hydrological model in which the obtained values for rmse and dc were 0 18 and 0 92 respectively furthermore in order to investigate the efficiency of the proposed socio hydrological model the behavioral rules of the agents which have been written based on the tpb structure have been replaced by economic oriented behavioral rules in the economic oriented abm agents are assumed to have perfect foresight and full knowledge and they are self interested rational maximizer in this way the agents only attempt to gain as much profit as possible regarding their farmland size and their deposited money for the agricultural expenditures of the next year as mentioned earlier among the major crop types of the zarrineh river basin alfalfa and sugar beet are the most profitable crops also due to assured selling price under pre set contracts for wheat the wheat crop has been considered as a profitable choice too therefore the agents with the aim of maximizing the profit will only choose their agricultural products from the three mentioned crop types for evaluating the performance of the economic oriented socio hydrological model the discharge of the zarrineh river qout to urmia lake was estimated and compared with the results of the proposed model the determination coefficient dc of the resulted hydrological time series for economic model approached to 0 80 compared to 0 92 for the proposed model hence it can be inferred that the proposed socio hydrological model based on tpb have the ability to simulate the conservational behavior of the farmers at higher accuracy 4 conclusion while it is known that farmers have different behaviors about their agricultural activities and water resources it remains challenging to capture these complexities in a framework which provide future insights for policy makers to assess the possible outcomes of different management strategies the current study integrates agent based modeling abm and theory of planned behavior tpb to form a novel socio hydrological framework for exploring the effects of psychological economic and environmental factors on the decision making process of the farmers in relation with crop choice and water conservation strategies due to the strategic importance of the urmia lake this socio hydrological framework is structured and applied to the zarrineh river basin which is the major basin feeding urmia lake based on the interviews with local farmers filled questionnaires and observations through field studies the factors affecting the farmers intention for reducing irrigation water consumption were identified for the construction of the tpb framework the farmers were classified into different groups based on their age education and the size of their farmlands the grades of the tpb parameters have been determined through interviews and observed behaviors for each group of the farmers and then in the abm the agents have trained to act dynamically in response to diverse psychological factors defined in tpb structure the results indicated that the proposed socio hydrological approach could effectively be used to simulate the farmers general behavior on their agricultural decision making process which has historically led to the drastic drop of the urmia lake level also the results of the simulation demonstrated that the increase in the costs of living forces the smallholder farmers to stay in a state that they intend to maximize their profits by planting the crops with high water consumption the root mean squared error rmse of 0 18 and determination coefficient dc of 0 92 between the simulated and observed discharge of the zarrineh river supported the performance of the proposed approach the outcomes of this study may be used for future policy making considering the possible changes in farmers economic and psychological parameters for the restoration of urmia lake due to the lack of sufficient economic hydrological and demographic data the current study has been conducted for the period of 2009 2017 further researches may expand this framework for larger time scale using the proposed framework on other basins with sufficient available data the reliable results of the proposed framework may enlighten important insights for the policy makers about the future socio hydrological trajectories therefore it is suggested that the possible changes of socio economic conditions in the future which may diversify the behavioral patterns of the farmers and subsequently the condition of the water resources to be predicted as different scenarios in addition to the tpb there are other viable frameworks for understanding and modeling the decision making process of humans including belief desire intention bdi and values beliefs norms vbn the bdi offers a suitable framework for abm to mimic the practical reasoning processes of the humans based on the structure of their personal values and social norms andrews et al 2011 the vbn is a theoretical framework based on social psychological theory which offers a flexible analytical method for investigating how cultural factors form environmental decision making and behaviors in a wide variety of contexts sanderson et al 2017 the focus of vbn is on the values and ideas deeply held by the humans about actions and thoughts which have been shaped through the process of socialization sanderson et al 2016 roobavannan et al 2018 the mentioned frameworks may be applied for abm in the future socio hydrological researches declaration of competing interest none 
6323,this study proposes a novel socio hydrological modeling framework for assessing the performance of complex water resources systems it employs and integrates agent based modeling abm and the theory of planned behavior tpb into the socio hydrological modeling framework to account for agents behaviors due to farmers major role in anthropogenic droughts this paper mainly focuses on farmers behavior the tpb framework and the agents behavioral rules in abm are structured based on the data obtained from field questionnaires and interviews by the farmers in the zarrineh river basin as the main river feeding the urmia lake the proposed modeling framework including the tpb and abm structures and rules are validated by comparing the results of the proposed socio hydrological simulation model with the actual data on the simulation period to assess the ability of the proposed framework root mean square error rmse and the determination coefficient dc were computed the results show the acceptable performance of the proposed model by rmse 0 18 and dc 0 92 analysis of the results indicates that financial conditions farmland size farmers age and farmers education are among the major factors in farmers decision making process respectively keywords socio hydrology agent based model abm theory of planned behavior tpb decision making process urmia lake 1 introduction anthropogenic developments have resulted in ever increasing exploitation of freshwater resources leading to severe water stress situation in many regions around the world it has been estimated that due to anthropogenic impacts on the environment at the global scale most of the humans potentially will be exposed to complete water scarcity crisis by 2025 fao 2007 it has been argued that agricultural activities play the most important role in altering hydrologic condition and water scarcity mirchi et al 2014 aghakouchak et al 2015 the lands and water resources have continuously been deteriorated in many parts of the world due to ever increasing water extraction for irrigation kandasamy et al 2014 as hydrological dynamics vary over time water users may change their behavior or plans by developing new interactions with water resources troy et al 2015 the co evolving relationships of hydrological and human systems are capable of creating unforeseen patterns which can induce critical environmental and social challenges sivapalan and bloschl 2015 zehe and sivapalan 2009 therefore in light of increasing anthropogenic impacts alleviation of the emerged water stress conditions requires the assessments based on a profound comprehension of efficient factors which shape the farmers new water consumption behaviors o keeffe et al 2018 hydrological modeling has a significant role in providing insights into the hydrological processes and assessing the possible outcomes of water management strategies for decision makers nourani et al 2018 however while environmental problems originated from anthropogenic activities are widely known to date the two way feedbacks of hydrological dynamics and the adaptive behaviors of humans were generally neglected in hydrological models and assessment processes nazemi and wheater 2015 bierkens 2015 consequently disregarding the dynamic behaviors of humans by assuming their response to changing the environment as static constituents in hydrological assessments can lead to severe shortcoming and possible failure of water resources management strategies in achieving the desired goals sivapalan 2015 in recent years many studies have conducted for compensating the lack of knowledge about the complicated interrelationships and co evolution of combined human and water systems elshafei et al 2015 viglione et al 2014 sivapalan et al 2012 sanderson et al 2017 sivapalan et al 2012 introduced the multidisciplinary field of socio hydrology as a solution approach to predict the co evolution path of societies and hydrological systems they emphasized that by unraveling the complex interdependent dynamics of these systems the socio hydrological approaches can help to build reliable strategies for water resources management and planning following their introduction many researchers and scientists showed that socio hydrological models can incorporate dynamic behaviors of targeted water users inside hydrological systems to demonstrate the relevance of different factors and their cross influences jaramillo et al 2018 di baldassarre et al 2015 srinivasan et al 2017 lei et al 2018 wurl et al 2018 hund et al 2018 it is shown that the outcomes of socio hydrological models can improve the assessments of policy makers for identifying the proper management strategies to cope with water resources challenges especially water scarcity montanari et al 2013 the challenging point in water recourses management is that people try to adapt themselves to the deteriorative environmental problems to satisfy their needs at any cost instead of attempting to revive the environment they live in sivapalan 2015 for identifying the reasons behind this social paradox understanding the indigenous and psychological factors i e attitudes beliefs social norms desires etc of farmers behavior are necessary in recent years through top down approaches which are capable of formulating an overview of a system several socio hydrological models have developed to investigate the complex co evolution of hydrological systems and dynamic behaviors of farmers van emmerik et al 2014 pande and savenije 2016 kuil et al 2016 although the top down approaches used in the previous studies can represent the overall functions of the systems the fundamental background processes may be overlooked o keeffe et al 2018 contrarily the bottom up approaches focus on the underlying linkages of the sub systems which form larger complex systems thus bottom up approaches could deliver more accurate results in investigations of socio hydrological processes especially when sub systems include complex dynamic elements such as humans troy et al 2015 lu et al 2018 one of the most known bottom up approaches which have been used in many branches of science is agent based modeling abm abm is an appropriate method for simulating and modeling large complicated systems composed of individual dynamic components known as agents koutiva and makropoulos 2016 al amin et al 2018 however addressing the interactions between the agents and their environment is a challenging issue this paper presents a novel socio hydrology simulation model based on the bottom up approach to investigate how various psychological factors of farmers can shape the co evolving path of the integrated social hydrological systems and their influence on the restoration of the environment this study is focused on urmia lake one of the largest lakes in the world which is likely to experience a catastrophic drought in the near future the abm approach has been employed for addressing the two way feedbacks of social hydrological systems in this study the agents are defined as farmers and their interactive environment contains the agricultural lands and water resources this paper benefits from the theory of planned behavior tpb to address the farmers interactions with hydrological dynamics in developing agents behavioral rules to form an accurate individual based socio hydrology model 2 proposed socio hydrological model the classic hydrological models assuming humans as boundary conditions or agents with fixed actions are not completely capable of representing the adaptive nature of the human responses srinivasan et al 2017 additionally the information created by scientists from the classic hydrological models could have been followed by shifts in beliefs values and norms which can cause the emergence of new adaptive behaviors in the integrated water and human systems lane 2014 however as demonstrated in fig 1 the socio hydrological models by focusing on two way feedback loops of social and hydrological parameters try to reveal the evolutionary trajectories of these systems therefore by enlightening the set of actors and their actions which permit the system to stay in the desired condition the socio hydrological models are able to provide decision makers high level adaptive management strategies srinivasan et al 2017 as shown in fig 1 social processes and hydrological processes are the two main components of the socio hydrological framework which have two way dynamic interactions with each other and the considered water resources for developing the socio hydrological model in details social and hydrological systems need to be modeled separately while they co evolve throughout linked dynamic changes or activities of each other in the following section the modeling process of social and hydrological systems have been described 2 1 social system modeling ssm integration of tpb and abm in socio hydrological assessments forms the core of the proposed methodology as stated earlier the abm has been used for mimicking the agricultural behaviors of farmers and tpb has been employed for addressing the way that their behaviors originate under different conditions based on the field studies the underlying processes of originating the farmers behaviors have been identified and represented in fig 2 as shown in fig 2 in the first step the farmer agent assesses the financial situation based on the agricultural profit from the last year it is assumed that non desirable financial condition may force the farmers towards more profitable crop patterns with the least expenditures or even least environmental conservative modes of practice consequently the farmers may overexploit natural resources especially surface water and groundwater resources in highly restricted conditions with limited available water the farmers may even tend to withdraw their water need through illegal wells or illegal water connections however a suitable financial situation provides farmers with diverse choices in crop and land allocation depending on other factors such as agricultural knowledge targeted market irrigation techniques machinery etc in the second step if the farmers have a suitable financial condition the water availability plays the most important role in the determination of the cropping pattern in the absence of sufficient education and environmental knowledge the farmers may ignore the water resources condition and aim at maximizing their profit otherwise with awareness about water scarcity and the environmental consequences of overexploitation they may tend to contribute for enhancing the environment and water conservation in the last step of decision making where the agents should decide about the conservation of water resources their intention and behavior will be determined through the tpb agents weak intention through tpb processing is interpreted as farmers ignorance about water resources condition therefore farmers with zero or weak intention on water conservation may try to maximize their profits by extracting as much water as they need if the farmer agents have a strong intention to conserve water and the environment they will have a tendency to reduce their irrigation water need on the other hand farmers with medium strength of intention try to balance the agricultural profit and conservation of the environment in the following sections the main components of the proposed socio hydrological modeling abm and tpb are briefly described 2 1 1 agent based modeling abm abm is a category of computational models for simulating and modeling the large complicated systems composed of individual dynamic components known as agents in many cases by providing models which are close to reality abm is capable of giving a natural description of the processes within the considered adaptive system darbandsari et al 2017 recently abm has been used in many fields of science such as psychology sociology politics economics and environmental management macal and north 2005 williams 2018 an agent based simulation model contains three main components agents environment and time the agents are autonomous decision makers or independent units which are capable of responding dynamically to alterations of their environment or activities of the other agents the environment described as a virtual world simulating a complex system with all of its constitutive components excluding agents rachid et al 2018 and the time component represents the time steps that the agent based model will have through the simulation the main framework of abm is demonstrated in fig 3 as shown in fig 3 an agent could be a single entity with its particular attributes or a group of individuals with similar main attributes the attributes of involving agents can include skills memories knowledge freedom adaption and the ability to interface with other parts of the system in abm the interaction of an agent with other agents or the environment conducted through the behavioral rules ohab yazdi and ahmadi 2018 the agents interact with other parts of the model by sending and receiving messages or diversifying their characteristics and parameters in response to particular messages behavioral rules define how agents will react to the variations of the environmental conditions and the information which they receive as messages marcon et al 2017 the subsequent effects of variations in properties of an agent or the environment are different for diverse types of agents in the given system therefore a change in a particular part of the system may be followed by different behavioral responses from each type of agents in the upcoming feedback loop in the simulation of water resources systems by abm agents can represent diverse stakeholders interacting with groundwater and surface water resources as their environment becu et al 2003 the agent based model of coupled water human systems can capture the processes originated from dynamic interrelations of the integrated systems thus for complex socio hydrological problems abm approach is suitable to provide more explicit predictions and assessments of possible emergent patterns troy et al 2015 2 1 2 theory of planned behavior tpb in 1991 icek ajzen proposed tpb as a framework for predicting the behavioral acts of humans ajzen 1991 tpb has been developed based on the former framework known as the theory of reasoned action to improve its prediction ability ajzen and fishbein 1980 tpb focuses on intention as the main determinant of implementing a certain behavior ajzen 2005 it has been argued that the likelihood of an action to be performed by a person highly depends on the strength of his her behavioral intention ajzen 1991 the tpb offers an approved framework for questionnaire design and presents detailed classifications of attitudes at subjective norms sn and the perceived control pbc which shape the intention toward a certain behavior andrews et al 2011 the suggested equation for intention by tpb has been shown in eq 1 1 i w 1 a t w 2 s n w 3 p b c in eq 1 the term i represents the intention and the terms w refers to the empirically derived weight or coefficient for each parameter attitude represents the degree of positivity or negativity which a person perceives about the considered behavior ajzen 1991 the attitude of a person shaped by the evaluations about what might be correct about a specific subject therefore the attitude may be based on imagination facts or even emotions subjective norm represents the amount of social pressure a person perceives toward performing the considered behavior ajzen 1991 pbc indicates the hardship or easiness a person perceives about performing the considered behavior ajzen 1991 for understanding the anthropogenic behaviors influencing water resources tpb has been used in studies related to preventing waste of water gilg and barr 2006 water conservation yazdanpanah et al 2014 behaviors of farmers in relation to different irrigation methods and behavioral alterations in water consumption koutiva and makropoulos 2016 to the best of our knowledge it is the first research using tpb to build a socio hydrology model 2 2 hydrological system modeling the main components and parameters of hydrological processes include water release from the reservoir s mountain streams precipitation effective precipitation precipitation infiltration rate irrigation return flow irrigation water consumption from surface and groundwater resources industrial water demand and urban water demand the general equation for the hydrological processes can be described as 2 q out q in p r m s r i iw s w i w u e i r where the qout represents the river inflow m3 month qin represents the river outflow m3 month pr is the precipitation of the study region m3 month ms is the mountain streams m3 month ri is irrigation return flow m3 month iws is the irrigation water withdrawal from surface water resources m3 month wi is the industrial water withdrawal m3 month wu is the urban water withdrawal m3 month e is the evaporation m3 month ir is the infiltration rate m3 month due to the absence of urban and industrial return flow in the given study area they are not considered in the eq 2 as it is known the farmers provide some portion of their irrigation water need from groundwater resources in the proposed model based on the surface water withdrawal the following simplified equation for groundwater resources has been used 3 iw gw iw d iw s in which iw gw represents the irrigation water withdrawal legal and illegal from groundwater resources m3 month iw d is the irrigation water demand m3 month and iws is the irrigation water withdrawal from surface water resources m3 month in this study the hydrological processes influencing the given socio hydrological system were modeled using system dynamics sd modeling approach for modeling complex dynamic systems sd approach is able to perform multi attribute and multi scenario analyses which can be used for assessment of alternative management strategies for diverse timescales sehlke and jacobson 2005 the hydrological sd model changes dynamically in response to the behaviors of the agents in abm in other words the environment of the agent based model in which the agents have activities has created by sd hydrological model for integrating the abm and sd as an interactive model the anylogic software has been used by employing a desirable graphical interface the anylogic provides a platform which is able to be used in a wide variety of fields grigoryev 2015 in the anylogic software the modeling process consists of generating the single agents or the population agents defining the environment of the simulation developing layouts for demonstrating the state of each agent defining the behavioral rules and reactions for the agents creating linkages between the agents and their environment and implementing the developed models ohab yazdi and ahmadi 2018 3 results and discussion the proposed socio hydrology model has been applied to investigate a real world environmental challenge after the complete collapse of aral sea because of anthropogenic developments urmia lake one of the largest lakes in the world is likely to end up with the same destiny aghakouchak et al 2015 in the past decade due to agricultural developments the water level of urmia lake has been lessening significantly without any restoration many studies suggested that there is a necessity for an effective framework in order to investigate the anthropogenic causes which have led to drying up the urmia lake sivapalan 2015 roobavannan et al 2017 this study attempts to apply the proposed socio hydrological framework which described in section 2 1 for zarrineh river which is the most vital surface water inflow feeding the urmia lake among all rivers reaching to urmia lake zarrineh river provides more than 49 percent of the water stored in the lake the zarrineh river basin is located at the south of urmia lake in the northwest of iran between 35 41 s to 37 44 n and 45 46 e to 47 23 w the main channel of zarrineh river is 300 km long and most parts of the river run through mountainous areas see fig 4 the coverage area of the river basin is around 12 000 km2 includes both plain and mountainous areas the total area covered by farmlands within the given catchment is 74 318 ha and the growing season for crops in the given basin mostly starts from the middle of the spring until the middle of the autumn during this time irrigation water need of farmlands will be extracted from groundwater and surface water resources the efficiency of the conventional irrigation method in the basin is about 38 for farmlands which are being irrigated using surface water resources in comparison to the average percentage of irrigation efficiency in most developing countries which is 45 the mentioned number for zarrineh river basin represents the ineffectual and outdated system that has been employed for irrigation which led to water loss through seepage and evaporation emami and koch 2018 notwithstanding the calamitous 88 shrinkage of urmia lake which has entailed by severe environmental stresses the expansion of agricultural areas has almost reached its maximum limit ulrp 2017 the seven major crops which cover more than 92 of the farmlands in the zarrineh river basin are wheat barley corn tomato onion sugar beet and alfalfa the comparison between the selling prices of the mentioned crops in the study area has been demonstrated in fig 5 for the study period 2009 2017 required data for socio hydrological modeling of zarrineh river basin compiled from field studies and various official sources the agricultural data of the catchment provided by the ministry of agriculture of iran the agricultural data include the dates of planting and harvesting the crops water need of the crops in the given region the yearly costs of agricultural activities and the selling price for each type of the crops in the study period the data of the crop types and locations of the farmlands irrigation systems water availability flow release of the dam the amount of extractions from surface water and groundwater resources and the percentage of the return flow for each area along the zarrineh river have been obtained from urmia lake restoration program ulrp also the hydrological data including monthly precipitation during the study period and potential evapotranspiration have been provided by the meteorological organization of iran as mentioned in section 2 1 in the first step the determinative factor affecting the decisions of the considered farmers is the financial condition the field studies revealed that for most of the farmers at the given area especially small holders the financial condition falls under the poverty threshold it is evident that the farmers with poor financial condition try to make up for unfavorable poverty situation it should be mentioned the imposed sanctions against iran induced collapse in revenues of the country a major decline in the value of the national currency and an increase of unemployment rate in addition to the economic inflation kokabisaghi 2018 the aforementioned effects of sanctions caused the overall welfare of people to deteriorate in this situation people with poor financial situation are subjected to more deterioration in their lifestyles since the intensifying of sanctions against iran in 2012 that targeted all economic sectors the national currency the rial has been devaluated significantly subsequently every economic sector of iran undergoes the high rate of economic inflation the variation of the economic inflation rate and consumer price index cpi for the study period have been demonstrated in fig 6 available at the central bank of iran s website in the decision making process of the agent based model at the end of every agricultural year 12 time steps in the model each farmer agent evaluates his her net income by considering all farming expenditures in the previous year and the profit of selling the products in this phase the farmer agent compares his her saving for the next 12 months with the poverty threshold of the year if the savings of the farmer falls below the poverty threshold the agent will choose randomly from the cropping patterns with the maximum profit for the next farming year in the given case study the most profitable crops consist of sugar beet and alfalfa which are high water consuming plants it should be noted although a high water consuming plant such as alfalfa has lower selling price than sugar beet the field studies indicated that its ability to be harvested several times a year makes it one of the most profitable crops in the given area also for the agents with big farms the wheat crop could be profitable due to assured selling price under pre set contracts therefore the agents with big farms may consider wheat as an exceptional choice for farming in addition to sugar beet and alfalfa although it has a lower profit in this situation if the surface water of the irrigation network does not satisfy the irrigation water demand the farmers may extract their unmet needs from groundwater resources through legal or illegal wells also if the saving of the agent manifests acceptable financial condition in comparison with the poverty threshold the decision making process of the agent will move to the second step otherwise the decision making process terminates in the second step of the decision making process the farmer agent considers the memory of the precipitation in the previous year as an indicator for demonstrating the perception of farmers about the last year precipitation and their assumption for the possible weather condition in the upcoming year the reconnaissance drought index rdi has been used the rdi has been utilized as the index for the agents memory bank because it can be efficiently connected with agricultural drought calculated for any timescale and having a direct linkage to the weather conditions of the region tsakiris et al 2007 in the agent based model at the end of every 12 time steps the rdi index is calculated for the last year and the result of rdi will update the memory bank of the agent for calculating the rdi at first the initial value α b for the given timescale must be computed by the following equation tsakiris et al 2007 4 α b x y 1 b p xy y 1 b pet xy x 1 t o t in which pet xy and p xy are the potential evapotranspiration and precipitation within the yth time of xth hydrological timescale in this study monthly timescale has considered for y and x represents the agricultural year which starts from october in the given region thus for october b 1 and t represents the number of considered hydrological years after the calculation of α b the standardized rdi rdi st is calculated using eq 5 tsakiris et al 2007 5 rdi st x u b x u b σ ub where u b is the ln α b x u b is the arithmetic mean of u b and σ ub is the standard deviation of u b since the r d i s t acts similar to standardized precipitation index spi the results of r d i s t can be interpreted in terms of the thresholds of spi zarei et al 2016 therefore the memory bank of the agents will be updated by drought class according to table 1 according to table 1 as the second step in ssm if the farmer agent remembers the wet climatic condition higher than normal it will affect his her decision by worrying less about water resources therefore the farmer agent chooses the most profitable crops similar to the previous step at the same time the memory of the dry climatic condition normal or lower than normal makes the farmer agent worry about the water resources and possible agricultural drought in the upcoming year thus the farmer agents should adapt themselves to the drought condition and choose whether they want to conserve water resources or satisfy their financial desires in this situation farmer agent moves to the next step of the decision making process in which the agent decides how much he she wants to participate in decreasing of the irrigation water consumption for adapting or conservating the environment as it can be seen in ssm framework in the third step where the farmer should decide about the conservation of water resources the behavioral rules of the agent is defined through the tpb structure the farmer s intention will be evaluated by the tpb following yazdanpanah et al 2014 tpb questionnaire was designed for determination of the relationships between the parameters of tpb at sn and pbc to form a structural behavioral equation about the act of water conservation see table 3 in this study 274 farmers have been interviewed and asked to fill the questionnaires the respondents were comprised of 11 3 female most of the women also work on household chores and 88 7 male most of the respondents 83 6 work full time on the farm 93 4 of the respondents relied on agriculture as their only source of income other characteristics of the respondents have been presented in table 2 in order to verify the reliability of the tpb structural items the cronbach s alpha has been used as it is demonstrated in table 3 the cronbach s alpha of all variables has been in the range of 0 638 0 864 which are higher than the suggested minimum of 0 60 sas nowosielski 2008 yazdanpanah et al 2014 2015 in the presented questionnaire table 3 seven option for attitude three option for the subjective norm six option for pbc and three option for behavioral intention were offered to the farmers according to the results of the questionnaire the attitude and subjective norm of farmers indicated an inclination to avoid water conservation activities the mean value of pbc represents that most of the respondents especially small holders of zarrineh river basin are experiencing constraints to reduce their irrigation water demand or participate in water conservation activities using tpb structure during the interviews when the farmers asked about the motives for believing that the crop production is more important than water conservation the attitude of the majority of farmers they mentioned several reasons such as economic problems religious beliefs and corruption of some local authorities who want the farmers to consume less water for irrigation while farmers can observe those authorities do not follow water conservation measures in their farming lands further investigation on subjective norm has revealed that the educational programs conducted by some organizations such as local schools and ulrp have had positive impacts on the norms about water conservation in farming however a noteworthy matter stated by some farmers is that while some of their important relatives especially children encourage them to engage in water conservation activities the ethnic conflicts among farmers and the air of competition for having more water for irrigation made the majority of people to have contradicted norms about cooperating and contribution and in water conservation activities ultimately the investigations on the states made by farmers in the category of perceived behavioral control have revealed that even if the economic condition allows them to contribute in water conservation activities some of them do not have the required skills or agricultural knowledge to plant unfamiliar products therefore the farmers may need to be trained and aided when they asked for planting new products with lower water need in this situation the farmers may believe engaging in water conservation activities is beyond their ability to do so afterward for understanding the correspondence among the tpb parameters the bivariate correlations have been obtained and demonstrated in table 4 as it was anticipated there was a positive correlation among all of the constituents of intention in water conservation behavior and related behaviors as it is demonstrated in fig 7 a hypothetical tpb model was built based on the mentioned relationships among structural parameters of tpb the path analysis for the presented tpb model was conducted using spss tools the proposed tpb model indicated good fitness with χ 2 2 124 the root mean square error of approximation rmsea 0 019 nfi 0 937 and cfi 0 972 the standardized regression weights β of path analysis are presented in fig 7 for the farmers of the considered study region all of the tpb parameters have a positive effect on the intention among all of the parameters attitude has the most effect on the behavioral intention with the path coefficient of 0 398 it means that a unit rise in the attitude of the respondent will increase their intention to engage in water conservation activities by 0 398 unit for the dependent parameter behavior both pbc and intention parameters have significant positive affection with the path coefficient of 0 493 and 0 619 respectively based on the standardized regression weights results the tpb equation for behavioral prediction are 6 i 0 398 at 0 301 sn 0 194 pbc 7 b 0 493 pbc 0 619 i in which i and b denotes intention and behavior respectively the behavioral equations of tpb have been used in decision making modeling of the 3rd step of the social system framework the agents have been classified into distinct groups according to the statistical data gathered through field studies see table 2 in this way the agent groups have been distinguished by age education and the farmland size for defining the agent types at first farmer agents were divided regarding their farmland size then the agents have been categorized by their age group and each of the age group has been classified by the education level fig 8 therefore there are 27 types of agents resembling the farmers of the zarrineh river basin all agents are able to decide through the psychological construct of tpb based on their own characteristics although the same formula is used for estimating the intention of different farmers the values of the controlling parameters are derived from the questionnaires and analysis of the interviews thus different values of the psychological factors attitude subjective norm and perceived behavioral control would result in different behavioral rules for each group of the farmer agents in the abm in this study there are three qualitative values considered for the psychological parameters including high medium and low based on the interviews with the farmers and the data obtained from questionnaires each agent group has been ascribed with the qualitative values according to their characteristics for example among the farmers of the study area the ones with higher education claimed that they have a good attitude about engaging in water conservation activities therefore the grade of attitude for the group of agents with higher education has been defined as high on the other hand farmers with no or weak education have had a weaker attitude toward conservational activities therefore the agent group with low educational level have been given low grade for their attitude it should be noted in the anylogic software the mentioned grades have been defined by numerical values among the defined psychological parameters in the abm only the sn has been assumed to be constant for the study period 2009 2017 according to the statements made by the farmers during the interviews their income has a significant effect on their attitude and perceived behavioral control consequently variations of the financial condition during the modeling process when the agents information is updated affects the value of at and pbc for each agent type therefore based on the eqs 6 and 7 the variations of the at and pbc will affect the intention of the agents and subsequently they may alter the behavior of the agent in the upcoming socio hydrological loop in this way for updating these parameters in the agent based model at the end of every agricultural year the agents which have been reached the 3rd step of the ssm see fig 2 of the manuscript compare the amount of their profit in the current year with the amount of the profit of the previous agricultural year provided that the comparison indicates the improvement of the financial condition the at and pbc of that particular agent type will get higher values for the next agricultural year on the other hand if the comparison shows the deterioration of the financial condition the values of the mentioned parameters will get lower values for the next agricultural year otherwise the values will be unchanged it worth mentioning that the stated equations and the assumption about sn are only applied to the farmers of the zarrineh river basin therefore the assumption for the consistency of the sn may not be acceptable for different basins and study periods as it is demonstrated in fig 2 in the 3rd step of the ssm farmer agents have three behavioral choices in relation to water conservation the rules for decision making about water conservation which have been designed based on the characteristics of the respondents observed behaviors and the results of questionnaires are presented in table 5 in this way the b values of eq 7 have been categorized into three categories high medium low all of the crop types in the agent based model have an identical probability to be selected randomly however the crop types that the agents can choose from are different in each behavioral category it should be noted the agents are dynamic and they may change their behavioral category during the modeling period therefore their choices will be varied according to behavioral rules as it can be seen in table 5 for instance if b category is high the agent will select high conservational behavior rules about water resources therefore the agent with conservative behavior will disregard the high profit crops and choose from the low water need crop types including wheat corn or barley which are common in the study area as mentioned earlier in the zarrineh river basin due to assured selling price under pre set contracts for wheat planting the wheat crop has been considered as an exceptional choice by all types of the farmers although it has a lower selling price in comparison to sugar beet and alfalfa see fig 5 according to fig 9 in the modeling process after the decision making section the farmer agent defines the crop type for planting according to table 5 then the farmer agent begins the agricultural processes phase 2 in fig 9 for each agent the amount of irrigation water demand for the upcoming agricultural year will be estimated based on the area of the farmland and the water need of the selected crop in this way the farmers can provide their irrigation water demand from three main sources i surface water ii groundwater and iii precipitation the amount of surface and groundwater withdrawals were calculated through the eq 3 as described in section 2 2 iws and iwg the amount of effective precipitation which provides part of the irrigation water demand was determined using the usda soil conservation service method smith 1992 8 p eff p 125 0 2 p 125 f o r p 250 m m m 9 p eff 125 0 1 p f o r p 250 m m m in which p eff and p indicate effective precipitation and gross monthly precipitation respectively for each part of the agricultural activities depend on the chosen crop type and the size of farmland the agricultural expenditures will be diversified dynamically and it will decrease the savings of the farmer agent at the end of the phase 2 fig 9 the crop yield will be calculated as a function of supplied water for per hectare of farmland area using the eq 10 10 1 y a y m k y 1 et a et m in which y m y a k y et a and et m represent the maximum yield kg ha the actual yield kg ha the yield response factor the actual crop evapotranspiration mm period the maximum crop evapotranspiration mm period respectively doorenbos and kassam 1979 at the end of the agricultural year the farmer agent will sell all of the products phase 3 in fig 9 and deposit the profit in the saving variable in this state the agent will repeat the decision making process for the upcoming agricultural year and the socio hydrological loop will iterate until the end of the given period in the abm fig 10 illustrated the area under cultivation in percentage for each of the considered crops in the given period 2009 2017 as shown in fig 10 the sugar beet alfalfa and wheat were the most planted crops in the considered period of the simulation the results indicated that almost all of the small holder agents did not reach the 2nd step in the decision making process of ssm fig 2 in other words the small holder agents mostly selected their crops for planting from sugar beet and alfalfa because their deposited money in the saving variable was lower than the poverty threshold in the given period it represents the impacts of continues competition between the increase of economic inflation which have a direct effect on increasing the cost of living and the income of farmers especially smallholders it should be mentioned that the average area of smallholders farmlands in the zarrineh river basin is 0 6 ha or lower with the minimum of 0 05 ha for the 2nd step of the ssm the results showed that for most of the years within the given period agents were moving to the 3rd step for decision making about water conservation in the 3rd step of ssm the results of the agent based simulation have demonstrated that approximately 34 of the agents have reached the 3rd step decision making process among these agents averagely 44 have chosen to maximize their profit 31 have chosen to make a balance between profit and water conservation and 25 have chosen to conserve the water resources from this perspective it can be referred although profit maximization is undoubtedly important however it is one among many possible factors affecting the decisions and the behaviors of the farmers by comparing the results of the abm it has shown that the farmer agents which have classified in the age group of old farmers with age more than 50 years old with no university degree mostly chose low conservation level behavioral rule at the same time the results showed that the farmer agents which classified in the group of young farmers with age lower than 35 years old with university degree mostly chose high conservation level behavioral rule as the last step of the modeling the performance of the proposed socio hydrological model should be evaluated in this way by calculating the amount of remaining water the discharge of the zarrineh river qout to urmia lake can be estimated for evaluating the model s performance the estimated values have been compared with the observed time series see fig 11 for this purpose two main efficiency criteria root mean square error rmse and determination coefficient dc have been used sharghi et al 2018 and 2019 11 rmse i 1 n s o i e i 2 n s 12 dc 1 i 1 n s o i e i 2 i 1 n s o i o i 2 where e i o i o i and n s respectively refer to estimated values observed values the mean of observed values and the number of samples fig 11 shows the high performance of the proposed socio hydrological model in which the obtained values for rmse and dc were 0 18 and 0 92 respectively furthermore in order to investigate the efficiency of the proposed socio hydrological model the behavioral rules of the agents which have been written based on the tpb structure have been replaced by economic oriented behavioral rules in the economic oriented abm agents are assumed to have perfect foresight and full knowledge and they are self interested rational maximizer in this way the agents only attempt to gain as much profit as possible regarding their farmland size and their deposited money for the agricultural expenditures of the next year as mentioned earlier among the major crop types of the zarrineh river basin alfalfa and sugar beet are the most profitable crops also due to assured selling price under pre set contracts for wheat the wheat crop has been considered as a profitable choice too therefore the agents with the aim of maximizing the profit will only choose their agricultural products from the three mentioned crop types for evaluating the performance of the economic oriented socio hydrological model the discharge of the zarrineh river qout to urmia lake was estimated and compared with the results of the proposed model the determination coefficient dc of the resulted hydrological time series for economic model approached to 0 80 compared to 0 92 for the proposed model hence it can be inferred that the proposed socio hydrological model based on tpb have the ability to simulate the conservational behavior of the farmers at higher accuracy 4 conclusion while it is known that farmers have different behaviors about their agricultural activities and water resources it remains challenging to capture these complexities in a framework which provide future insights for policy makers to assess the possible outcomes of different management strategies the current study integrates agent based modeling abm and theory of planned behavior tpb to form a novel socio hydrological framework for exploring the effects of psychological economic and environmental factors on the decision making process of the farmers in relation with crop choice and water conservation strategies due to the strategic importance of the urmia lake this socio hydrological framework is structured and applied to the zarrineh river basin which is the major basin feeding urmia lake based on the interviews with local farmers filled questionnaires and observations through field studies the factors affecting the farmers intention for reducing irrigation water consumption were identified for the construction of the tpb framework the farmers were classified into different groups based on their age education and the size of their farmlands the grades of the tpb parameters have been determined through interviews and observed behaviors for each group of the farmers and then in the abm the agents have trained to act dynamically in response to diverse psychological factors defined in tpb structure the results indicated that the proposed socio hydrological approach could effectively be used to simulate the farmers general behavior on their agricultural decision making process which has historically led to the drastic drop of the urmia lake level also the results of the simulation demonstrated that the increase in the costs of living forces the smallholder farmers to stay in a state that they intend to maximize their profits by planting the crops with high water consumption the root mean squared error rmse of 0 18 and determination coefficient dc of 0 92 between the simulated and observed discharge of the zarrineh river supported the performance of the proposed approach the outcomes of this study may be used for future policy making considering the possible changes in farmers economic and psychological parameters for the restoration of urmia lake due to the lack of sufficient economic hydrological and demographic data the current study has been conducted for the period of 2009 2017 further researches may expand this framework for larger time scale using the proposed framework on other basins with sufficient available data the reliable results of the proposed framework may enlighten important insights for the policy makers about the future socio hydrological trajectories therefore it is suggested that the possible changes of socio economic conditions in the future which may diversify the behavioral patterns of the farmers and subsequently the condition of the water resources to be predicted as different scenarios in addition to the tpb there are other viable frameworks for understanding and modeling the decision making process of humans including belief desire intention bdi and values beliefs norms vbn the bdi offers a suitable framework for abm to mimic the practical reasoning processes of the humans based on the structure of their personal values and social norms andrews et al 2011 the vbn is a theoretical framework based on social psychological theory which offers a flexible analytical method for investigating how cultural factors form environmental decision making and behaviors in a wide variety of contexts sanderson et al 2017 the focus of vbn is on the values and ideas deeply held by the humans about actions and thoughts which have been shaped through the process of socialization sanderson et al 2016 roobavannan et al 2018 the mentioned frameworks may be applied for abm in the future socio hydrological researches declaration of competing interest none 
6324,river discharges flood forecasting is a complex task with multiple sources of uncertainty bayesian methods can incorporate multiple types of uncertainties by inferring the probability density function of ensemble forecasts based on past events however such methods lead to forecasts with large uncertainty bands in order to reduce the uncertainty in the forecasts we focus solely on the prediction of the upper and lower range of the uncertainty bands therefore we develop three forecast methods in which we search for the indexes of the upper and lower forecast members of an ensemble termed best pairs which provide the highest predictive skill the results show for four distinct hindcasts of historical events in a case study in bavaria germany that the new methods have a higher predictive skill of the observations than probabilistic methods at least for the first 4 out of 12 h forecasts moreover the new methods are computational efficient because they considerably reduce the number of members of the ensembles required to produce a flood discharge forecast with high predictive skill keywords river discharge flood forecast uncertainty predictive skill 1 introduction hydrological flood forecasting involves the prediction of complex processes both at the surface and sub surface level which occur at a wide range of scales blöschl and sivapalan 1995 the limitations of water balance models or rainfall runoff models in capturing these processes have led to extensive research on the estimation of predictive uncertainty particularly for the assessment of forecasting uncertainty various methods based on bayesian inference approaches or quantile regressions have been developed ensemble prediction systems generally have a better skill than deterministic systems dietrich et al 2009 thorndahl et al 2017 however these approaches have also revealed the wide uncertainty found in hydrological flood forecasts coccia and todini 2011 which in turn has prevented its wide adoption by forecast practitioners the wide uncertainty bounds could be indicative of high uncertainty in the model inputs structure or hydrological parameters but it could also be caused by an improper deterministic hydrological model or uncertainty derivation methods regardless of the case decision making is simply more difficult under large uncertainty wetterhall et al 2013 this paper focuses therefore on the development of alternative approaches for obtaining discharge forecasts with high predictive skill high predictive skill is here defined as the highest percentage of the observed data bracketed by the uncertainty band with the smallest possible band width next three paragraphs discuss the sources and methods of estimating uncertainty strategies to reduce the size of ensembles and methods to include spatial rainfall uncertainty even though rainfall is often the sole source of uncertainty considered thorndahl et al 2017 germann et al 2009 uncertainty arises from different sources in flood forecasting these include input structural and parameter calibration uncertainty refsgaard et al 2007 warmink et al 2010 bayesian and informal bayesian methods are quite significant advances because they allow different sources of uncertainty to be inherently quantified by considering both observation and model outputs beven and binley 1992 krzysztofowicz 1999 in practice however the bayesian inference method poses the problem of estimation of a posterior density of the models parameters this is overcome by the bayesian model averaging bma method by estimating weights via constrained optimisation raftery et al 2005 applying univariate or multivariate distributions hemri et al 2013 or embedding copula functions madadgar and moradkhan 2014 informal bayesian approaches such as the generalized likelihood uncertainty estimation glue overcome this issue via the definition of likelihood weights for comparing observations and predictions beven and binley 1992 jin et al 2010 which can be updated in real time xu et al 2017 the attractiveness of glue is that uncertainties from different sources are handled implicitly beven and freer 2001 however the predictive skill of glue may need to be improved by empirical methods xiong and o connor 2008 the difference or similarity of the uncertainty estimates made by bayesian and informal bayesian methods have been shown to be case study specific thi et al 2018 vrugt et al 2009 alternatively quantile regression can be used for estimating forecast errors conditional on a single forecast this approach has proven robust in estimating predictive uncertainty weerts et al 2011 lópez et al 2014 hydrological parameter ensembles have been researched intensively one difficulty is to obtain the posterior distribution of the model parameters monte carlo methods are often used to sample possible parameters assuming some probability distribution function with a less e g glue as discussed before or more formal likelihood function e g bayesian methods to obtain the posterior parameter distribution jin et al 2010 showed that both were comparable but the latter provide somehow sharper ranges than the former nonetheless the conclusions of the latter study must be bounded on the informal likelihoods selected another alternative is to use a markov chain monte carlo to construct a markov chain based on formal likelihood measures zhang et al 2016 which can be seen as an extension of a formal bayesian method given that the required size of the ensemble can become quite large some authors have researched on applying sub sets of an ensemble to reduce its size dietrich et al 2009 obtained a subset of the super ensemble selected based on a priori model weights which are obtained from ensemble calibration the major difficulty was the limited availability of hindcasts which prevented a more reliable weighting of the members of the sub set velazquez et al 2010 used a genetic algorithm to identify model subsets by optimising the continuous ranked probability score they concluded that the gain in performance of optimised sub sets is often accompanied by improvements in ensemble reliability although rain gauge observations are often considered to be the ground truth for radar uncertainty analysis codo and rico ramirez 2018 it is well known that they cannot accurately represent spatial rainfall variability well city 1999 and are prone to interpolation errors wagner et al 2012 kitchen and blackall 1992 showed evidence that that measured rainfall can significantly deviate from the true mean areal rainfall leandro et al 2017 applied the classical turning band method mantoglou and wilson 1982 for assessing the spatial uncertainty of rainfall and found that at least 15 bands were necessary for producing random fields without artificial patterns vischel et al 2009 and cecinati et al 2017 applied conditional simulation schemes smiatek et al 2012 applied inverse distance weighting to interpolate all monitoring stations to hindcast historical events the two studies showed that point conditional simulations outperformed kriging based methods on producing more reliable rainfall fields in this work we develop and compare three alternative methods for uncertain flood discharge forecasting with two existing uncertainty quantification methods the aim is to derive narrower uncertainty bands with the purpose of issuing flood forecasts therefore we assess the quality of methods based on forecast performance statistics narsimlu et al 2015 rather than on the ability of forecasting the probability of occurrence of future values i e predictive uncertainty assessment as defined in coccia and todini 2011 2 methodology this section is organized into two subsections the first subsection presents two existing methods the informal bayesian method glue named ensemble and a single model probabilistic forecast method named relative error together with three developed flood forecast methods named discharge intervals rising and receding and slope interval see fig 1 the former two are termed probability forecast pf the latter three are termed upper and lower range forecast ulf methods the pf methods are selected for the comparison of the flood forecasting performance with three ulf methods the second subsection for completion provides a short description of the conceptual hydrological model 2 1 forecast methods 2 1 1 ensemble the ensemble method produces discharge forecasts based on forecast models f k combining precipitation and hydrological model parameters uncertainty this method follows the glue approach which represents an extension of bayesian averaging procedures with a less formal likelihood nse jin et al 2010 thereby different forecast members f k are used to infer the prediction of the ensemble which is given by 1 p y f 1 f 2 f k k 1 k w k f y f k where p y f 1 f 2 f k is the average discharge ensemble predicted based on k forecast members w k are the weights of each forecast with k 1 k w k 1 which condition the forecasts f y f k the discharge ensemble is obtained by applying an empirical distribution to the k ensemble members which have a nash sutcliffe efficiency nse larger than 0 30 for the training data franz and hogue 2011 the posteriori parameters distributions are based on a previous calibration validation study of the existing hydrological model in use by the flood forecast center at the bavarian water authorities bayrisches landesamt für umwelt lfu bayern haag et al 2016 beta type probability distribution functions are adopted to account for the skewness in the parameters distribution parameter uncertainty is obtained by sampling from the posterior distributions using a monte carlo approach harlin and kung 1992 combined uncertainty is considered by generating m data sets of rainfall uncertainty p m which are randomly assigned to k sub data sets of rainfall runoff model parameter r r k uncertainty to produce the ensemble fig 1 a although rainfall is usually the most important source of uncertainty zappa et al 2011 leandro et al 2013 herein we focus on the hydrological parameter uncertainty nonetheless rainfall spatial interpolation uncertainty is accounted for by considering conditional geospatial simulation for distributing the rainfall data within the whole catchment this is necessary because we apply the rainfall observed at the rain gauges for hindcasting historical events similarly to smiatek et al 2012 frequent appearance of zeros and the right skewness of the distribution of nonzeros muthusamy et al 2017 are considered herein by implementing the following procedure fitting a mixed discrete non normal continuous distribution to the data transferring the fitted distribution to normal applying conditional geospatial simulation and finally applying a back transformation of the result to the original mixed distribution this procedure is implemented using two different r packages namely gstat gomez hernandez and journal 1993 pebesma 2004 and randomfields schalather et al 2015 2 1 2 relative error method this method considers a single calibrated deterministic forecast member uncertainty is stochastically added to the deterministic flood forecast based on the relative error of historical flood events fig 1 b uncertainty to the single forecast can then be easily expressed in terms of quantiles ludwig and bremicker 2006 while the former two pf methods focus on inferring the probability density function of the forecasts based on past events the next three ulf methods use a different approach the focus is to forecast the upper and lower range of the forecasts with the highest predictive skill and lowest uncertainty band forecast members f k this is an optimisation problem first we search for the indexes of the upper f m and lower forecast member f m within the k members of the ensemble with the highest predictive skill i e max p factor f m f m and in case of a tie the smallest uncertainty band m i n r factor f m f m is chosen where 2 p factor f a f b t 1 d f obs t y t f a y t f b d f 3 r factor f a f b y t f a y t f b t d f σ obs p factor is the percentage of the observed data o b s t bracketed by the uncertainty band and ranges from 0 to 100 abbaspour et al 2007 the r factor is the width of the uncertainty band at the end of every 12 h forecast divided by the standard deviation of the observed data σ obs and ranges from 0 to infinity abbaspour et al 2009 d f is the number of hours predicted in each forecast the goodness of the forecasts is judged base on a p factor close to 100 all observations are bracketed by the uncertainty band and the r factor close to 0 i e small uncertainty band the major difference between the three methods developed falls on the criteria for the selection of the pair of members of the ensemble f m f m termed herein as best pairs which will be explained next 2 1 3 discharge intervals the discharge intervals method selects the best pairs per pre defined discharge intervals δ q fig 1 c first discharges are categorized in classes according to its magnitude using δ q after the best pair of k members are selected which maximise the performance index p factor and in case of a tie the one with the smallest r factor 2 1 4 rising and receding the rising and receding method forecasts discharges based on the best pairs per δ q and depending on the slope trend either positive or negative of the observed discharges at the time of issuing a forecast fig 1 d the trend slope t is estimated based on the slope of discharge based on the hourly observed discharge previous to each forecast being positive rising or negative receding 4 slope t obs t obs t 1 1 h slope t 0 f m f m slope t 0 f m f m 2 1 5 slope intervals the difference to the 3rd method is that the best pairs are selected based on a pre defined slope interval of observed discharges δ s fig 1 e the selection of the best pairs is done for one selection event for validation the various methods are tested in other events without changing the selected best pairs in both selection and validation phases the rainfall uncertainty data sets are always recalculated such that its uncertainty remains inherently accounted for furthermore it should be noted that we intentionally name selection phase instead of calibration phase as such we avoid confusion with the traditional model calibration which aims at selecting the best parameter set capturing the behaviour of the observations the aim herein is not to select the pairs which best fit the simulation results to the observations but rather the ones that best bracket the observations the latter does not necessarily select the pairs which follow the behaviour of the observations first results have shown that wrong discharge forecasts were being signalled although the forecast was missed for a very small margin in order to overcome this issue a small tolerance ts is added to the forecast methods this tolerance is given as a percentage of the observed discharge at the start of the forecast above and below the discharge forecast band 2 2 hydrological model and flood forecast tool the hydrological model used is larsim large area runoff simulation model ludwig and bremicker 2006 larsim is in operational use in several german flood forecast centres it is a deterministic model which calculates discharge rates as a response to meteorological input data and can be applied as a continuous water balance model or as a rainfall runoff model for event based simulations the catchment parameters are sub divided in gridded sub catchments in each grid the relevant runoff processes are calculated snowmelt effective precipitation base flow interflow or surface flow herein larsim is applied as an event based model at the start of every forecast larsim is run for one year warm up such that the initial conditions e g soil moisture base flow interflow direct discharge snow cover etc are as close as possible to the existing conditions at the start of the forecast this is similar to the procedure in coccia and todini 2011 the flood forecast tool floodevac is a real time fully automated flood model chain which can forecast both discharges and flood inundation extents the hydrological component larsim is connected to a 2d hydrodynamic model hec ras validated using computer vision bhola et al 2018b to forecast the flood inundation extents using an offline database bhola et al 2018a like other similar tools torres matallana et al 2018 it can be applied to produce ensemble based predictions including rainfall and parameter uncertainty the new forecast methods developed herein are implemented in this tool using matlab 3 case study the case study of the white main weißer main is selected for demonstrating the differences in the flood forecast methods presented in section 2 the catchment is located in the river main in bavaria germany fig 2 a the calibrated larsim model is currently in use by the flood forecast center lfu bayern in the upper main catchment the upper catchment of the white main covers an area of 313 6 km2 the furthest downstream gauge of white main is located just upstream of the city of kulmbach where the ködnitz river gauge is located the high discharge hq at this gauge is equal to 123 m3 s and the mean high discharge mhq is equal to 49 6 m3 s in this work we are hindcasting the 4 flood events with higher peak discharge on record namely those of december 2012 selection event and december 2007 january 2011 and may 2013 validation fig 2 c by using the uncertainty rainfall fields see section on forecast methods derived from observed rainfall from the german weather centre deutscher wetterdienst dwd altogether there are 50 rain gauges available for this catchment fig 2 b the events selected have either seasonal characteristics of advective or convective precipitations the event of december 2012 is an advective rainfall with a second peak corresponding to a 10 year return period the event of may 2013 is a convective rainfall which produced higher peak discharges with shorter duration the maximum discharge magnitude corresponds to a 100 year return period january 2011 corresponds to a winter flood event with a long duration advective precipitation the maximum discharge corresponds to a 10 year return period flooding was reported to be caused by intense rainfall and snow melting from the fichtel mountains wasserwirtschaftsamt hof 2011 december 2007 is a winter convective rainfall with discharges of relatively smaller magnitude corresponding to a 5 year return period 4 experimental setup prior to this work a sensitivity analysis narsimlu et al 2015 was performed in this case study which reduced the total number of model parameters from 34 to 8 beg et al 2018 among the 8 parameters we can find the calibration variable for the retaining constant of the slow runoff storage eqd calibration variable for the retaining constant of the fast runoff storage eqd2 threshold value of the fast and slow direct runoff a2 coefficient for the retention of liquid water in the snow pack sret and mean temperature of the transition zone from snowfall to rain tgr those parameters regulate the contribution of rainfall and snowfall to runoff hence larsim is sensitive to both rainfall snowfall or a combination of both types of events the methodology developed herein is in any case applicable regardless of the type of event or hydrological model as long as the underlying hydrological model can consider those processes the resulting best pairs will be sensitive to them to reduce the computational cost an ensemble of 50 members is set by assigning m 10 data sets of rainfall uncertainty to k 50 sub data sets of the hydrological model parameter uncertainty the number of hours predicted in each forecast d f is set to 12 h for each hourly forecast window the ensemble and the new methods for the selection of best pairs sections 2 1 3 2 1 4 and 2 1 5 are applied to the flood event of 2012 event selected for finding the best pairs and validated using the remaining three events in ascending order by date december 2007 january 2011 and may 2013 see fig 2 c the event of 2012 is used as a selection event following the praxis of avoiding the selection of the maximum flood event for the purpose of calibration of hydrological models laurent et al 2010 the pre defined discharge interval δ q is set equal to 10 m3 s for the discharge intervals and the rising and receding methods the latter has a final larger δ q in order to keep the total number of pairs similar between the three methods see table 1 the pre defined slope discharge interval δ s is set equal to 0 5 for the last method the tolerance parameter ts is selected by gradually increasing it until the performance of the forecasts p factor reaches a value larger than 0 75 for the flood event of 2012 this is done in order not to penalise the r factor in methods which already have a large uncertainty band width namely the ensemble and the relative error methods 5 results in this section the results from five different flood forecast methods are presented with the aim of improving the predictive performance i e maximizing the p factor and in case of a tie with the smallest r factor of flood forecasting of river discharges fig 3 shows the members of the ensemble for all four events for all forecasts since forecasts are issued hourly sudden jumps appear because every time a new forecast is issued the uncertainty is reset to zero fig 4 shows the actual forecast windows between 17 12 2012 and 18 12 2012 for all five forecast methods applied to the flood event of 2012 as seen in fig 3 a fig 4 allows the sequence of 12 h hourly forecasts to be visualized by superimposing each single forecast with transparent colours it transmits a first impression of the effect of each method on the hourly forecasts in addition the percentages obtained by the relative error based on the historical events can be seen next to the uncertainty bands of the highlighted forecast also for each ulf the corresponding best pairs responsible for each specific hourly forecast has been displayed next to their upper and lower uncertainty bands fig 5 shows the variability with time of the model performance using p factor and r factor for all five forecast methods for the sake of readability p factor is aggregated in intervals slope or discharge the figure shows that the model performance changes with time particularly closer to the higher peaks where there is an overall instantaneous loss of performance table 2 and fig 6 show the variability of the model performance for each hourly forecast lead times tables 3 6 show the summary of the model performance for selected hourly forecast lead times for the three validation flood events by highlighting the best p factor and r factor with light gray the tables convey quickly which methods perform better figs 7 9 show the variability of the model performance for each hourly forecast leads figs 6 9 are of extreme importance because they summarize and support the comparison application of all forecast methods unlike fig 5 aggregation is now done in terms of forecast lead time for the whole forecast event as such an instantaneous loss of performance is no longer visible but instead a gradual loss of performance with the increase of forecast lead times for the sake of clarity pf methods are plotted with a shaded area unlike the ulf which are plotted with a single line also vertical dashed lines are plotted for identifying a shift on the best performing method table 2 complements fig 6 since they allow us to interpret the sensitivity of the methods to the tolerance parameter and the identification of the actual members of the ensemble selected as the best pairs 6 discussion before we can discuss the improvement in the forecast predictive performance of the developed upper and lower range forecast ulf methods it is important to demonstrate that the generation of the k 50 forecast members was effective in describing the uncertainty of the outputs for the calibrated rainfall runoff model this can be done by visual inspection of fig 3 which shows that the ensemble is successful in bracketing the observed results for the selection and validation events this is particularly true for the higher discharge ranges for which warnings are more critical also by using a relaxed less formal likelihood nse function with a low limit of 0 3 jin et al 2010 more members can be accepted which not necessarily follow the observed discharges but may over or underestimate the observed discharge values those members become ideal candidates to become the best pairs it should be mentioned that the ensembles generated originate from a well calibrated model using posteriori parameter distribution functions as described in leandro et al 2017 and disse et al 2017 fig 3 provides therefore a visual representation of the quality of the ensemble generation in the next paragraphs the performance of the various methods is discussed in detail for both calibration and validation events 6 1 forecast parameters regarding the forecast parameters earlier tests have shown that the methods are more sensitive to the tolerance parameter ts than to the pre defined intervals δ q and δ s increasing ts has a positive impact on the method performance table 1 for example the average p factor from the discharge intervals method increases from 0 72 to 0 82 by increasing ts from 2 5 to 5 0 the r factor becomes slightly larger from 0 23 to 0 28 but sill outperforming the ensemble method with a r factor of almost double 0 49 the main reason for the p factor increase is the narrow misses for the very low range of discharges indeed for such cases there are no best pairs that could bracket the observations increasing the ensemble size could counteract this effect but only to a limited extent since this is a general behaviour observed in all generated members which in this study steam from the same hydrological model the lesser sensitiveness to the number of pre defined intervals can be explained based on the behaviour of the forecast members there are typically members of the ensemble that either under predict e g f m equal to 4 14 or 45 or over predict e g f m equal to 10 or 26 the observations table 1 these members are then more often picked up by the ulf methods because of that behaviour therefore increasing the number of intervals not necessarily increases the number of forecast members being selected for the best pairs f m f m however there are a few members that depending on the method will be selected for one or the other task e g 36 and 1 in which case the increasing division of intervals may produce small shifts in the forecasts for the same reason chancing the selection event provides a similar set of best pairs because those selected tend to consistently under or over predict the observations in all events as supported by the good results one would expect the probabilistic forecast pf methods namely the relative error and the ensemble methods to have the best p factor but the worst r factor this is suggested by the example windows in fig 4 however analysing a whole event fig 5 it is clear that the assumption for the p factor does not always hold while the pf methods are based on probabilistic confidence intervals the ulf preserve the shape of the best pair runs which are dependent on the selection of specific members of the ensemble since those best pairs tend to under or over predict the observations the p factor often shows small improvements when compared with the pf methods fig 5 regarding the r factor and except for some exceptions the results obtained with the pf methods are often outperformed by the ulf methods therefore the ts is only applied to pf methods once a threshold of 75 for the p factor is not obtained in order not to penalise even further their r factor performance 6 2 forecast lead performance selection and validation events forecasted predictive performance p factor of the selection event decreases with the lead time for almost all methods fig 6 this is much in line with other authorś findings xu et al 2017 the relative error method is the exception because of the rapid increase of the uncertainty bands r factor obtained with lead time fig 6 b a similar steady performance behaviour was also found by weerts et al 2011 at some forecast locations for the selection event all ulf methods outperform the pf methods this is true up to 10 5 h discharge and slope intervals methods and 11 5 h rising and residing method out of 12 h forecast in terms of predictive performance p factor in terms of r factor after only 4 h the ulf already surpassed the pf methods it is nonetheless noteworthy the excellent performance values obtained by most of the methods table 2 the three validation events show similar results as the selection event in terms of performance but with smaller lead times the may 2013 event fig 7 shows the ulf to outperform the pf methods up to roughly 6 h p factor and from 3 h r factor the ensemble method shows in any case a much similar performance to the ulf methods than to the relative error method table 3 the january 2011 event fig 8 shows the ulf to outperform the pf methods up to roughly 4 h p factor and from 3 5 h r factor the relative error method outperforms the other ulf methods after 4 h at a cost of larger uncertainty interval bands table 4 the december 2007 event fig 9 shows the ulf to outperform the pf methods up to roughly 5 5 h p factor and from 2 5 h r factor it should be noted that larsim often could not accurately simulate high flood peaks ludwig and bremicker 2006 stated that the cause could be the lack of high temporal resolutions or quality of input data rainfall measurements in any case the predictive skills of all methods may be affected this could explain that for example the p factor of the relative error may for the four extreme events move away from the expected significance limit of 0 95 for the high flood peaks nevertheless all methods show a very good performance in terms of p factor with all values above 75 table 5 even though the events selected include rainfall and or rainfall and snowmelt events it is plausible to conclude from the good results obtained that the main contributor to runoff is rainfall had snowmelt played a decisive role then the ulf would have shown a sharp decrease in predictive skill however even the event from 2011 shows at least a modest improvement in this case it can be argued that it is coming from the reported contribution from snowmelt nevertheless the response of the selected best pairs keep a good performance across all events supporting that undermining role of snowmelt it thus expectable that another catchment having a larger databank of significant flood events that different selection events with different hydrological conditions could lead to a different set of best pairs unfortunately and similarly to laurent et al 2010 we do not possess enough flood events with different hydrological conditions necessary to justify and validate this investigation for example it is likely that in the case study from zappa et al 2011 for which the discharge regime is governed by snowmelt in spring and early summer and by heavy rainfall events in fall that a best set of pairs should be found for spring and another set for the fall 6 3 computational times each single rainfall runoff model run requires 0 66 min to complete a full forecast of 12 h therefore the ensemble method takes 34 min for each forecast and the relative error method only 0 66 min indeed the relative error is the simplest method to issue forecasts it is computationally the most efficient in line with the findings of weerts et al 2011 however at the cost of large uncertainty band as discussed earlier the computational times of the new methods depend on the number of different best pairs obtained during selection similarly to the studies of dietrich et al 2009 and velazquez et al 2010 the reduction in computational time comes from the fewer number of members of the ensemble kept by each method table 1 herein the discharge intervals method takes 6 66 min 10 different runs the rising and receding 7 92 min 12 different runs and the slope method 7 26 min 11 different runs to complete each 12 h forecast in real time forecasting systems it is of advantage to work with simple models and methodologies which are easy to update and maintain henonin et al 2013 this is indeed one of the advantages of the proposed methodologies developed herein which do not require the use of large computational resources e g cloud computing or clusters in our case study the 50 forecast members were enough to describe the uncertainty of the outputs this is in line with other authors which also used a small number of ensemble members of up to 100 raftery et al 2005 hemri et al 2013 cecinati et al 2017 as such a more complex parallelization of the code would still allow the ensemble to run in typical workstations with 12 or more cpu kernels however it is usual to find reports of catchments requiring in excess of 1000 runs to fully describe the uncertainty velazquez et al 2010 gabellani et al 2007 franz and hogue 2011 up to 100 000 jin et al 2010 in those cases the advantage of the current methodology becomes even more visible it would no longer be possible to compute the ensemble for forecasting purposes with typical workstations whereas the computational effort of any of the ulf methods developed herein would remain unchanged i e less or equal to two four runs per the number of the discharge or slope intervals 6 4 considerations for forecast practitioners practitioners in charge of flood forecast are often interested in the ability of the model in predicting given thresholds or warning levels in ködnitz river gauge the highest warning level warning level 4 is equal to 69 1 m3 s landesamt bayerisches für umwelt 2018 it is easy to plot the forecasts side by side for example using the flood event of 2012 fig 10 this is a paradigmatic example of the advantage of narrower uncertainty bounds and self corrective ability of the ulf as the discharge intervals are crossed herein the critical discharge corresponding to the warning level 4 is never reached between hour 8 00 of the 23rd of december until hour 2 00 of the following day however all methods except the relative error lead the forecast practitioner to issue warnings the rising and receding method s forecasts exceed the threshold for the first time at 10 00 am the ensemble method shows a low probability of the warning level being exceeded already 3 h earlier at 7 00 am by using the ensemble method the forecasting centre would likely issue warnings for a total forecast duration of 8 2 h although the discharge level of 69 1 m3 s is never reached the rising and receding method however corrects its forecast to no warning after it predicted the exceedance of warning level 4 for only 3 4 h this can be explained by the generally narrower uncertainty bands of this method and the change of best pairs when the discharge crosses 20 m3 s 2 h after the first warning the discharge method and the slope method correct their forecast only after 5 9 and 7 4 h respectively in this example ulf methods were better than the ensemble method but not better than the relative error method it should be mentioned that the relative error method makes an assumption on the statistical properties of the error this is based on the derived uncertainty band and the observed data as new data is made available the uncertainty bounds need to be updated in order to keep the same level of significance similarly the selected best pairs found by ulf methods should be re validated and updated if necessary obviously fig 10 is just an example the ulf and the ensemble methods could have been wright had the q level been reached as in all real forecasts there are many uncertainties playing a role which were not considered herein future work will therefore see the inclusion of real rainfall forecasts to further compare the performance of all methods finally it should be noted that the advantage of the ensemble method over the new methods is that it provides a confidence interval for each prediction such that the practitioner can take a decision based on a probability estimation the rising and receding on the contrary provides a factor p factor that vary with the lead time as a function of its historical performance in this case the four events analysed which was always greater than 70 in any case the new methods with a smaller uncertainty band and equally good predictive skill overall forecast better both the magnitude and timing of these events as discussed in the forecast lead performance section 7 conclusion in the present work we developed and compared three alternative methods for forecasting river discharges with two existing probabilistic forecast methods a generalized likelihood uncertainty estimation termed ensemble and a single model probabilistic forecast method termed relative error the three new methods were termed discharge intervals rising and receding and slope interval methods the three methods provide alternatives for selecting a best pair of members of an ensemble for predicting the upper and lower ranges of a forecast that maximise bracketing of observations with smaller uncertainty bands existing methods were grouped as probability forecast methods pf and the three new methods upper and lower range forecast ulf methods the ulf methods were shown to derive narrower uncertainty bands for the purpose of issuing flood forecasting it was demonstrated that reducing the ensemble to a best pair of members could replace the whole ensemble without compromising the forecast using forecast performance statistics it was shown for four high flood events ulf methods to outperform pf methods at least for the first 4 h of the forecast in addition ulf methods were only outperformed by pf at a cost of providing larger uncertainty bands the advantage of pf methods is that forecast practitioners can take a decision based on probability estimations however the uncertainty range can be very large the ulf methods on the other hand provide lead times as a function of its historical performance of observations bracketed by the forecast which was shown to lead to lower uncertainties bands in the forecasts with a higher predictive skill in terms of computational time ulf methods have a clear advantage over the ensemble method nonetheless ulf shares this advantage with relative error methods because both do not require supercomputers or cloud services to be applied in the operational forecast however relative error methods provide the largest uncertainty ranges from all methods future work should see the hybridisation of some of the above methods in order to further improve the predictive skill of the forecasts while keeping their computational advantage in our case hydrological parameter uncertainty dominated the rainfall uncertainty the reason was that only spatial rainfall interpolation uncertainty was considered since rainfall input uncertainty was generated from historical data measured at rain gauges and not from actual meteorological forecasts which is a caveat of our study the latter would necessarily increase the contribution of rainfall to the combined uncertainty and necessarily require the inclusion of meteorological ensemble predictions dietrich et al 2009 in that case the application of ulf methods would need to be further investigated one possible suggestion would be to additionally identify the corresponding best pairs of the members of the meteorological ensemble or one could search for the combined best pairs from both forecast and hydrological models which produced the higher predictive skill declaration of competing interest none acknowledgments the authors would like to acknowledge the support of the german federal ministry of education and research bmbf bundesministeriums für bildung und forschung through project floodevac with grant number fkz 13n13196 the authors acknowledge also the support from the flood forecast center from the bavarian water authorities bayrisches landesamt für umwelt lfu who provided the hydrological model used herein carvalho and beg acknowledge fct portuguese foundation for science and technology through the project uid mar 04292 2019 which was financed by mec portuguese ministry of education and science and the fse european social fund under the programs poph qren human potential operational programme from national strategic reference framework and poch human capital operational programme from portugal 2020 appendix see tables 1 5 
6324,river discharges flood forecasting is a complex task with multiple sources of uncertainty bayesian methods can incorporate multiple types of uncertainties by inferring the probability density function of ensemble forecasts based on past events however such methods lead to forecasts with large uncertainty bands in order to reduce the uncertainty in the forecasts we focus solely on the prediction of the upper and lower range of the uncertainty bands therefore we develop three forecast methods in which we search for the indexes of the upper and lower forecast members of an ensemble termed best pairs which provide the highest predictive skill the results show for four distinct hindcasts of historical events in a case study in bavaria germany that the new methods have a higher predictive skill of the observations than probabilistic methods at least for the first 4 out of 12 h forecasts moreover the new methods are computational efficient because they considerably reduce the number of members of the ensembles required to produce a flood discharge forecast with high predictive skill keywords river discharge flood forecast uncertainty predictive skill 1 introduction hydrological flood forecasting involves the prediction of complex processes both at the surface and sub surface level which occur at a wide range of scales blöschl and sivapalan 1995 the limitations of water balance models or rainfall runoff models in capturing these processes have led to extensive research on the estimation of predictive uncertainty particularly for the assessment of forecasting uncertainty various methods based on bayesian inference approaches or quantile regressions have been developed ensemble prediction systems generally have a better skill than deterministic systems dietrich et al 2009 thorndahl et al 2017 however these approaches have also revealed the wide uncertainty found in hydrological flood forecasts coccia and todini 2011 which in turn has prevented its wide adoption by forecast practitioners the wide uncertainty bounds could be indicative of high uncertainty in the model inputs structure or hydrological parameters but it could also be caused by an improper deterministic hydrological model or uncertainty derivation methods regardless of the case decision making is simply more difficult under large uncertainty wetterhall et al 2013 this paper focuses therefore on the development of alternative approaches for obtaining discharge forecasts with high predictive skill high predictive skill is here defined as the highest percentage of the observed data bracketed by the uncertainty band with the smallest possible band width next three paragraphs discuss the sources and methods of estimating uncertainty strategies to reduce the size of ensembles and methods to include spatial rainfall uncertainty even though rainfall is often the sole source of uncertainty considered thorndahl et al 2017 germann et al 2009 uncertainty arises from different sources in flood forecasting these include input structural and parameter calibration uncertainty refsgaard et al 2007 warmink et al 2010 bayesian and informal bayesian methods are quite significant advances because they allow different sources of uncertainty to be inherently quantified by considering both observation and model outputs beven and binley 1992 krzysztofowicz 1999 in practice however the bayesian inference method poses the problem of estimation of a posterior density of the models parameters this is overcome by the bayesian model averaging bma method by estimating weights via constrained optimisation raftery et al 2005 applying univariate or multivariate distributions hemri et al 2013 or embedding copula functions madadgar and moradkhan 2014 informal bayesian approaches such as the generalized likelihood uncertainty estimation glue overcome this issue via the definition of likelihood weights for comparing observations and predictions beven and binley 1992 jin et al 2010 which can be updated in real time xu et al 2017 the attractiveness of glue is that uncertainties from different sources are handled implicitly beven and freer 2001 however the predictive skill of glue may need to be improved by empirical methods xiong and o connor 2008 the difference or similarity of the uncertainty estimates made by bayesian and informal bayesian methods have been shown to be case study specific thi et al 2018 vrugt et al 2009 alternatively quantile regression can be used for estimating forecast errors conditional on a single forecast this approach has proven robust in estimating predictive uncertainty weerts et al 2011 lópez et al 2014 hydrological parameter ensembles have been researched intensively one difficulty is to obtain the posterior distribution of the model parameters monte carlo methods are often used to sample possible parameters assuming some probability distribution function with a less e g glue as discussed before or more formal likelihood function e g bayesian methods to obtain the posterior parameter distribution jin et al 2010 showed that both were comparable but the latter provide somehow sharper ranges than the former nonetheless the conclusions of the latter study must be bounded on the informal likelihoods selected another alternative is to use a markov chain monte carlo to construct a markov chain based on formal likelihood measures zhang et al 2016 which can be seen as an extension of a formal bayesian method given that the required size of the ensemble can become quite large some authors have researched on applying sub sets of an ensemble to reduce its size dietrich et al 2009 obtained a subset of the super ensemble selected based on a priori model weights which are obtained from ensemble calibration the major difficulty was the limited availability of hindcasts which prevented a more reliable weighting of the members of the sub set velazquez et al 2010 used a genetic algorithm to identify model subsets by optimising the continuous ranked probability score they concluded that the gain in performance of optimised sub sets is often accompanied by improvements in ensemble reliability although rain gauge observations are often considered to be the ground truth for radar uncertainty analysis codo and rico ramirez 2018 it is well known that they cannot accurately represent spatial rainfall variability well city 1999 and are prone to interpolation errors wagner et al 2012 kitchen and blackall 1992 showed evidence that that measured rainfall can significantly deviate from the true mean areal rainfall leandro et al 2017 applied the classical turning band method mantoglou and wilson 1982 for assessing the spatial uncertainty of rainfall and found that at least 15 bands were necessary for producing random fields without artificial patterns vischel et al 2009 and cecinati et al 2017 applied conditional simulation schemes smiatek et al 2012 applied inverse distance weighting to interpolate all monitoring stations to hindcast historical events the two studies showed that point conditional simulations outperformed kriging based methods on producing more reliable rainfall fields in this work we develop and compare three alternative methods for uncertain flood discharge forecasting with two existing uncertainty quantification methods the aim is to derive narrower uncertainty bands with the purpose of issuing flood forecasts therefore we assess the quality of methods based on forecast performance statistics narsimlu et al 2015 rather than on the ability of forecasting the probability of occurrence of future values i e predictive uncertainty assessment as defined in coccia and todini 2011 2 methodology this section is organized into two subsections the first subsection presents two existing methods the informal bayesian method glue named ensemble and a single model probabilistic forecast method named relative error together with three developed flood forecast methods named discharge intervals rising and receding and slope interval see fig 1 the former two are termed probability forecast pf the latter three are termed upper and lower range forecast ulf methods the pf methods are selected for the comparison of the flood forecasting performance with three ulf methods the second subsection for completion provides a short description of the conceptual hydrological model 2 1 forecast methods 2 1 1 ensemble the ensemble method produces discharge forecasts based on forecast models f k combining precipitation and hydrological model parameters uncertainty this method follows the glue approach which represents an extension of bayesian averaging procedures with a less formal likelihood nse jin et al 2010 thereby different forecast members f k are used to infer the prediction of the ensemble which is given by 1 p y f 1 f 2 f k k 1 k w k f y f k where p y f 1 f 2 f k is the average discharge ensemble predicted based on k forecast members w k are the weights of each forecast with k 1 k w k 1 which condition the forecasts f y f k the discharge ensemble is obtained by applying an empirical distribution to the k ensemble members which have a nash sutcliffe efficiency nse larger than 0 30 for the training data franz and hogue 2011 the posteriori parameters distributions are based on a previous calibration validation study of the existing hydrological model in use by the flood forecast center at the bavarian water authorities bayrisches landesamt für umwelt lfu bayern haag et al 2016 beta type probability distribution functions are adopted to account for the skewness in the parameters distribution parameter uncertainty is obtained by sampling from the posterior distributions using a monte carlo approach harlin and kung 1992 combined uncertainty is considered by generating m data sets of rainfall uncertainty p m which are randomly assigned to k sub data sets of rainfall runoff model parameter r r k uncertainty to produce the ensemble fig 1 a although rainfall is usually the most important source of uncertainty zappa et al 2011 leandro et al 2013 herein we focus on the hydrological parameter uncertainty nonetheless rainfall spatial interpolation uncertainty is accounted for by considering conditional geospatial simulation for distributing the rainfall data within the whole catchment this is necessary because we apply the rainfall observed at the rain gauges for hindcasting historical events similarly to smiatek et al 2012 frequent appearance of zeros and the right skewness of the distribution of nonzeros muthusamy et al 2017 are considered herein by implementing the following procedure fitting a mixed discrete non normal continuous distribution to the data transferring the fitted distribution to normal applying conditional geospatial simulation and finally applying a back transformation of the result to the original mixed distribution this procedure is implemented using two different r packages namely gstat gomez hernandez and journal 1993 pebesma 2004 and randomfields schalather et al 2015 2 1 2 relative error method this method considers a single calibrated deterministic forecast member uncertainty is stochastically added to the deterministic flood forecast based on the relative error of historical flood events fig 1 b uncertainty to the single forecast can then be easily expressed in terms of quantiles ludwig and bremicker 2006 while the former two pf methods focus on inferring the probability density function of the forecasts based on past events the next three ulf methods use a different approach the focus is to forecast the upper and lower range of the forecasts with the highest predictive skill and lowest uncertainty band forecast members f k this is an optimisation problem first we search for the indexes of the upper f m and lower forecast member f m within the k members of the ensemble with the highest predictive skill i e max p factor f m f m and in case of a tie the smallest uncertainty band m i n r factor f m f m is chosen where 2 p factor f a f b t 1 d f obs t y t f a y t f b d f 3 r factor f a f b y t f a y t f b t d f σ obs p factor is the percentage of the observed data o b s t bracketed by the uncertainty band and ranges from 0 to 100 abbaspour et al 2007 the r factor is the width of the uncertainty band at the end of every 12 h forecast divided by the standard deviation of the observed data σ obs and ranges from 0 to infinity abbaspour et al 2009 d f is the number of hours predicted in each forecast the goodness of the forecasts is judged base on a p factor close to 100 all observations are bracketed by the uncertainty band and the r factor close to 0 i e small uncertainty band the major difference between the three methods developed falls on the criteria for the selection of the pair of members of the ensemble f m f m termed herein as best pairs which will be explained next 2 1 3 discharge intervals the discharge intervals method selects the best pairs per pre defined discharge intervals δ q fig 1 c first discharges are categorized in classes according to its magnitude using δ q after the best pair of k members are selected which maximise the performance index p factor and in case of a tie the one with the smallest r factor 2 1 4 rising and receding the rising and receding method forecasts discharges based on the best pairs per δ q and depending on the slope trend either positive or negative of the observed discharges at the time of issuing a forecast fig 1 d the trend slope t is estimated based on the slope of discharge based on the hourly observed discharge previous to each forecast being positive rising or negative receding 4 slope t obs t obs t 1 1 h slope t 0 f m f m slope t 0 f m f m 2 1 5 slope intervals the difference to the 3rd method is that the best pairs are selected based on a pre defined slope interval of observed discharges δ s fig 1 e the selection of the best pairs is done for one selection event for validation the various methods are tested in other events without changing the selected best pairs in both selection and validation phases the rainfall uncertainty data sets are always recalculated such that its uncertainty remains inherently accounted for furthermore it should be noted that we intentionally name selection phase instead of calibration phase as such we avoid confusion with the traditional model calibration which aims at selecting the best parameter set capturing the behaviour of the observations the aim herein is not to select the pairs which best fit the simulation results to the observations but rather the ones that best bracket the observations the latter does not necessarily select the pairs which follow the behaviour of the observations first results have shown that wrong discharge forecasts were being signalled although the forecast was missed for a very small margin in order to overcome this issue a small tolerance ts is added to the forecast methods this tolerance is given as a percentage of the observed discharge at the start of the forecast above and below the discharge forecast band 2 2 hydrological model and flood forecast tool the hydrological model used is larsim large area runoff simulation model ludwig and bremicker 2006 larsim is in operational use in several german flood forecast centres it is a deterministic model which calculates discharge rates as a response to meteorological input data and can be applied as a continuous water balance model or as a rainfall runoff model for event based simulations the catchment parameters are sub divided in gridded sub catchments in each grid the relevant runoff processes are calculated snowmelt effective precipitation base flow interflow or surface flow herein larsim is applied as an event based model at the start of every forecast larsim is run for one year warm up such that the initial conditions e g soil moisture base flow interflow direct discharge snow cover etc are as close as possible to the existing conditions at the start of the forecast this is similar to the procedure in coccia and todini 2011 the flood forecast tool floodevac is a real time fully automated flood model chain which can forecast both discharges and flood inundation extents the hydrological component larsim is connected to a 2d hydrodynamic model hec ras validated using computer vision bhola et al 2018b to forecast the flood inundation extents using an offline database bhola et al 2018a like other similar tools torres matallana et al 2018 it can be applied to produce ensemble based predictions including rainfall and parameter uncertainty the new forecast methods developed herein are implemented in this tool using matlab 3 case study the case study of the white main weißer main is selected for demonstrating the differences in the flood forecast methods presented in section 2 the catchment is located in the river main in bavaria germany fig 2 a the calibrated larsim model is currently in use by the flood forecast center lfu bayern in the upper main catchment the upper catchment of the white main covers an area of 313 6 km2 the furthest downstream gauge of white main is located just upstream of the city of kulmbach where the ködnitz river gauge is located the high discharge hq at this gauge is equal to 123 m3 s and the mean high discharge mhq is equal to 49 6 m3 s in this work we are hindcasting the 4 flood events with higher peak discharge on record namely those of december 2012 selection event and december 2007 january 2011 and may 2013 validation fig 2 c by using the uncertainty rainfall fields see section on forecast methods derived from observed rainfall from the german weather centre deutscher wetterdienst dwd altogether there are 50 rain gauges available for this catchment fig 2 b the events selected have either seasonal characteristics of advective or convective precipitations the event of december 2012 is an advective rainfall with a second peak corresponding to a 10 year return period the event of may 2013 is a convective rainfall which produced higher peak discharges with shorter duration the maximum discharge magnitude corresponds to a 100 year return period january 2011 corresponds to a winter flood event with a long duration advective precipitation the maximum discharge corresponds to a 10 year return period flooding was reported to be caused by intense rainfall and snow melting from the fichtel mountains wasserwirtschaftsamt hof 2011 december 2007 is a winter convective rainfall with discharges of relatively smaller magnitude corresponding to a 5 year return period 4 experimental setup prior to this work a sensitivity analysis narsimlu et al 2015 was performed in this case study which reduced the total number of model parameters from 34 to 8 beg et al 2018 among the 8 parameters we can find the calibration variable for the retaining constant of the slow runoff storage eqd calibration variable for the retaining constant of the fast runoff storage eqd2 threshold value of the fast and slow direct runoff a2 coefficient for the retention of liquid water in the snow pack sret and mean temperature of the transition zone from snowfall to rain tgr those parameters regulate the contribution of rainfall and snowfall to runoff hence larsim is sensitive to both rainfall snowfall or a combination of both types of events the methodology developed herein is in any case applicable regardless of the type of event or hydrological model as long as the underlying hydrological model can consider those processes the resulting best pairs will be sensitive to them to reduce the computational cost an ensemble of 50 members is set by assigning m 10 data sets of rainfall uncertainty to k 50 sub data sets of the hydrological model parameter uncertainty the number of hours predicted in each forecast d f is set to 12 h for each hourly forecast window the ensemble and the new methods for the selection of best pairs sections 2 1 3 2 1 4 and 2 1 5 are applied to the flood event of 2012 event selected for finding the best pairs and validated using the remaining three events in ascending order by date december 2007 january 2011 and may 2013 see fig 2 c the event of 2012 is used as a selection event following the praxis of avoiding the selection of the maximum flood event for the purpose of calibration of hydrological models laurent et al 2010 the pre defined discharge interval δ q is set equal to 10 m3 s for the discharge intervals and the rising and receding methods the latter has a final larger δ q in order to keep the total number of pairs similar between the three methods see table 1 the pre defined slope discharge interval δ s is set equal to 0 5 for the last method the tolerance parameter ts is selected by gradually increasing it until the performance of the forecasts p factor reaches a value larger than 0 75 for the flood event of 2012 this is done in order not to penalise the r factor in methods which already have a large uncertainty band width namely the ensemble and the relative error methods 5 results in this section the results from five different flood forecast methods are presented with the aim of improving the predictive performance i e maximizing the p factor and in case of a tie with the smallest r factor of flood forecasting of river discharges fig 3 shows the members of the ensemble for all four events for all forecasts since forecasts are issued hourly sudden jumps appear because every time a new forecast is issued the uncertainty is reset to zero fig 4 shows the actual forecast windows between 17 12 2012 and 18 12 2012 for all five forecast methods applied to the flood event of 2012 as seen in fig 3 a fig 4 allows the sequence of 12 h hourly forecasts to be visualized by superimposing each single forecast with transparent colours it transmits a first impression of the effect of each method on the hourly forecasts in addition the percentages obtained by the relative error based on the historical events can be seen next to the uncertainty bands of the highlighted forecast also for each ulf the corresponding best pairs responsible for each specific hourly forecast has been displayed next to their upper and lower uncertainty bands fig 5 shows the variability with time of the model performance using p factor and r factor for all five forecast methods for the sake of readability p factor is aggregated in intervals slope or discharge the figure shows that the model performance changes with time particularly closer to the higher peaks where there is an overall instantaneous loss of performance table 2 and fig 6 show the variability of the model performance for each hourly forecast lead times tables 3 6 show the summary of the model performance for selected hourly forecast lead times for the three validation flood events by highlighting the best p factor and r factor with light gray the tables convey quickly which methods perform better figs 7 9 show the variability of the model performance for each hourly forecast leads figs 6 9 are of extreme importance because they summarize and support the comparison application of all forecast methods unlike fig 5 aggregation is now done in terms of forecast lead time for the whole forecast event as such an instantaneous loss of performance is no longer visible but instead a gradual loss of performance with the increase of forecast lead times for the sake of clarity pf methods are plotted with a shaded area unlike the ulf which are plotted with a single line also vertical dashed lines are plotted for identifying a shift on the best performing method table 2 complements fig 6 since they allow us to interpret the sensitivity of the methods to the tolerance parameter and the identification of the actual members of the ensemble selected as the best pairs 6 discussion before we can discuss the improvement in the forecast predictive performance of the developed upper and lower range forecast ulf methods it is important to demonstrate that the generation of the k 50 forecast members was effective in describing the uncertainty of the outputs for the calibrated rainfall runoff model this can be done by visual inspection of fig 3 which shows that the ensemble is successful in bracketing the observed results for the selection and validation events this is particularly true for the higher discharge ranges for which warnings are more critical also by using a relaxed less formal likelihood nse function with a low limit of 0 3 jin et al 2010 more members can be accepted which not necessarily follow the observed discharges but may over or underestimate the observed discharge values those members become ideal candidates to become the best pairs it should be mentioned that the ensembles generated originate from a well calibrated model using posteriori parameter distribution functions as described in leandro et al 2017 and disse et al 2017 fig 3 provides therefore a visual representation of the quality of the ensemble generation in the next paragraphs the performance of the various methods is discussed in detail for both calibration and validation events 6 1 forecast parameters regarding the forecast parameters earlier tests have shown that the methods are more sensitive to the tolerance parameter ts than to the pre defined intervals δ q and δ s increasing ts has a positive impact on the method performance table 1 for example the average p factor from the discharge intervals method increases from 0 72 to 0 82 by increasing ts from 2 5 to 5 0 the r factor becomes slightly larger from 0 23 to 0 28 but sill outperforming the ensemble method with a r factor of almost double 0 49 the main reason for the p factor increase is the narrow misses for the very low range of discharges indeed for such cases there are no best pairs that could bracket the observations increasing the ensemble size could counteract this effect but only to a limited extent since this is a general behaviour observed in all generated members which in this study steam from the same hydrological model the lesser sensitiveness to the number of pre defined intervals can be explained based on the behaviour of the forecast members there are typically members of the ensemble that either under predict e g f m equal to 4 14 or 45 or over predict e g f m equal to 10 or 26 the observations table 1 these members are then more often picked up by the ulf methods because of that behaviour therefore increasing the number of intervals not necessarily increases the number of forecast members being selected for the best pairs f m f m however there are a few members that depending on the method will be selected for one or the other task e g 36 and 1 in which case the increasing division of intervals may produce small shifts in the forecasts for the same reason chancing the selection event provides a similar set of best pairs because those selected tend to consistently under or over predict the observations in all events as supported by the good results one would expect the probabilistic forecast pf methods namely the relative error and the ensemble methods to have the best p factor but the worst r factor this is suggested by the example windows in fig 4 however analysing a whole event fig 5 it is clear that the assumption for the p factor does not always hold while the pf methods are based on probabilistic confidence intervals the ulf preserve the shape of the best pair runs which are dependent on the selection of specific members of the ensemble since those best pairs tend to under or over predict the observations the p factor often shows small improvements when compared with the pf methods fig 5 regarding the r factor and except for some exceptions the results obtained with the pf methods are often outperformed by the ulf methods therefore the ts is only applied to pf methods once a threshold of 75 for the p factor is not obtained in order not to penalise even further their r factor performance 6 2 forecast lead performance selection and validation events forecasted predictive performance p factor of the selection event decreases with the lead time for almost all methods fig 6 this is much in line with other authorś findings xu et al 2017 the relative error method is the exception because of the rapid increase of the uncertainty bands r factor obtained with lead time fig 6 b a similar steady performance behaviour was also found by weerts et al 2011 at some forecast locations for the selection event all ulf methods outperform the pf methods this is true up to 10 5 h discharge and slope intervals methods and 11 5 h rising and residing method out of 12 h forecast in terms of predictive performance p factor in terms of r factor after only 4 h the ulf already surpassed the pf methods it is nonetheless noteworthy the excellent performance values obtained by most of the methods table 2 the three validation events show similar results as the selection event in terms of performance but with smaller lead times the may 2013 event fig 7 shows the ulf to outperform the pf methods up to roughly 6 h p factor and from 3 h r factor the ensemble method shows in any case a much similar performance to the ulf methods than to the relative error method table 3 the january 2011 event fig 8 shows the ulf to outperform the pf methods up to roughly 4 h p factor and from 3 5 h r factor the relative error method outperforms the other ulf methods after 4 h at a cost of larger uncertainty interval bands table 4 the december 2007 event fig 9 shows the ulf to outperform the pf methods up to roughly 5 5 h p factor and from 2 5 h r factor it should be noted that larsim often could not accurately simulate high flood peaks ludwig and bremicker 2006 stated that the cause could be the lack of high temporal resolutions or quality of input data rainfall measurements in any case the predictive skills of all methods may be affected this could explain that for example the p factor of the relative error may for the four extreme events move away from the expected significance limit of 0 95 for the high flood peaks nevertheless all methods show a very good performance in terms of p factor with all values above 75 table 5 even though the events selected include rainfall and or rainfall and snowmelt events it is plausible to conclude from the good results obtained that the main contributor to runoff is rainfall had snowmelt played a decisive role then the ulf would have shown a sharp decrease in predictive skill however even the event from 2011 shows at least a modest improvement in this case it can be argued that it is coming from the reported contribution from snowmelt nevertheless the response of the selected best pairs keep a good performance across all events supporting that undermining role of snowmelt it thus expectable that another catchment having a larger databank of significant flood events that different selection events with different hydrological conditions could lead to a different set of best pairs unfortunately and similarly to laurent et al 2010 we do not possess enough flood events with different hydrological conditions necessary to justify and validate this investigation for example it is likely that in the case study from zappa et al 2011 for which the discharge regime is governed by snowmelt in spring and early summer and by heavy rainfall events in fall that a best set of pairs should be found for spring and another set for the fall 6 3 computational times each single rainfall runoff model run requires 0 66 min to complete a full forecast of 12 h therefore the ensemble method takes 34 min for each forecast and the relative error method only 0 66 min indeed the relative error is the simplest method to issue forecasts it is computationally the most efficient in line with the findings of weerts et al 2011 however at the cost of large uncertainty band as discussed earlier the computational times of the new methods depend on the number of different best pairs obtained during selection similarly to the studies of dietrich et al 2009 and velazquez et al 2010 the reduction in computational time comes from the fewer number of members of the ensemble kept by each method table 1 herein the discharge intervals method takes 6 66 min 10 different runs the rising and receding 7 92 min 12 different runs and the slope method 7 26 min 11 different runs to complete each 12 h forecast in real time forecasting systems it is of advantage to work with simple models and methodologies which are easy to update and maintain henonin et al 2013 this is indeed one of the advantages of the proposed methodologies developed herein which do not require the use of large computational resources e g cloud computing or clusters in our case study the 50 forecast members were enough to describe the uncertainty of the outputs this is in line with other authors which also used a small number of ensemble members of up to 100 raftery et al 2005 hemri et al 2013 cecinati et al 2017 as such a more complex parallelization of the code would still allow the ensemble to run in typical workstations with 12 or more cpu kernels however it is usual to find reports of catchments requiring in excess of 1000 runs to fully describe the uncertainty velazquez et al 2010 gabellani et al 2007 franz and hogue 2011 up to 100 000 jin et al 2010 in those cases the advantage of the current methodology becomes even more visible it would no longer be possible to compute the ensemble for forecasting purposes with typical workstations whereas the computational effort of any of the ulf methods developed herein would remain unchanged i e less or equal to two four runs per the number of the discharge or slope intervals 6 4 considerations for forecast practitioners practitioners in charge of flood forecast are often interested in the ability of the model in predicting given thresholds or warning levels in ködnitz river gauge the highest warning level warning level 4 is equal to 69 1 m3 s landesamt bayerisches für umwelt 2018 it is easy to plot the forecasts side by side for example using the flood event of 2012 fig 10 this is a paradigmatic example of the advantage of narrower uncertainty bounds and self corrective ability of the ulf as the discharge intervals are crossed herein the critical discharge corresponding to the warning level 4 is never reached between hour 8 00 of the 23rd of december until hour 2 00 of the following day however all methods except the relative error lead the forecast practitioner to issue warnings the rising and receding method s forecasts exceed the threshold for the first time at 10 00 am the ensemble method shows a low probability of the warning level being exceeded already 3 h earlier at 7 00 am by using the ensemble method the forecasting centre would likely issue warnings for a total forecast duration of 8 2 h although the discharge level of 69 1 m3 s is never reached the rising and receding method however corrects its forecast to no warning after it predicted the exceedance of warning level 4 for only 3 4 h this can be explained by the generally narrower uncertainty bands of this method and the change of best pairs when the discharge crosses 20 m3 s 2 h after the first warning the discharge method and the slope method correct their forecast only after 5 9 and 7 4 h respectively in this example ulf methods were better than the ensemble method but not better than the relative error method it should be mentioned that the relative error method makes an assumption on the statistical properties of the error this is based on the derived uncertainty band and the observed data as new data is made available the uncertainty bounds need to be updated in order to keep the same level of significance similarly the selected best pairs found by ulf methods should be re validated and updated if necessary obviously fig 10 is just an example the ulf and the ensemble methods could have been wright had the q level been reached as in all real forecasts there are many uncertainties playing a role which were not considered herein future work will therefore see the inclusion of real rainfall forecasts to further compare the performance of all methods finally it should be noted that the advantage of the ensemble method over the new methods is that it provides a confidence interval for each prediction such that the practitioner can take a decision based on a probability estimation the rising and receding on the contrary provides a factor p factor that vary with the lead time as a function of its historical performance in this case the four events analysed which was always greater than 70 in any case the new methods with a smaller uncertainty band and equally good predictive skill overall forecast better both the magnitude and timing of these events as discussed in the forecast lead performance section 7 conclusion in the present work we developed and compared three alternative methods for forecasting river discharges with two existing probabilistic forecast methods a generalized likelihood uncertainty estimation termed ensemble and a single model probabilistic forecast method termed relative error the three new methods were termed discharge intervals rising and receding and slope interval methods the three methods provide alternatives for selecting a best pair of members of an ensemble for predicting the upper and lower ranges of a forecast that maximise bracketing of observations with smaller uncertainty bands existing methods were grouped as probability forecast methods pf and the three new methods upper and lower range forecast ulf methods the ulf methods were shown to derive narrower uncertainty bands for the purpose of issuing flood forecasting it was demonstrated that reducing the ensemble to a best pair of members could replace the whole ensemble without compromising the forecast using forecast performance statistics it was shown for four high flood events ulf methods to outperform pf methods at least for the first 4 h of the forecast in addition ulf methods were only outperformed by pf at a cost of providing larger uncertainty bands the advantage of pf methods is that forecast practitioners can take a decision based on probability estimations however the uncertainty range can be very large the ulf methods on the other hand provide lead times as a function of its historical performance of observations bracketed by the forecast which was shown to lead to lower uncertainties bands in the forecasts with a higher predictive skill in terms of computational time ulf methods have a clear advantage over the ensemble method nonetheless ulf shares this advantage with relative error methods because both do not require supercomputers or cloud services to be applied in the operational forecast however relative error methods provide the largest uncertainty ranges from all methods future work should see the hybridisation of some of the above methods in order to further improve the predictive skill of the forecasts while keeping their computational advantage in our case hydrological parameter uncertainty dominated the rainfall uncertainty the reason was that only spatial rainfall interpolation uncertainty was considered since rainfall input uncertainty was generated from historical data measured at rain gauges and not from actual meteorological forecasts which is a caveat of our study the latter would necessarily increase the contribution of rainfall to the combined uncertainty and necessarily require the inclusion of meteorological ensemble predictions dietrich et al 2009 in that case the application of ulf methods would need to be further investigated one possible suggestion would be to additionally identify the corresponding best pairs of the members of the meteorological ensemble or one could search for the combined best pairs from both forecast and hydrological models which produced the higher predictive skill declaration of competing interest none acknowledgments the authors would like to acknowledge the support of the german federal ministry of education and research bmbf bundesministeriums für bildung und forschung through project floodevac with grant number fkz 13n13196 the authors acknowledge also the support from the flood forecast center from the bavarian water authorities bayrisches landesamt für umwelt lfu who provided the hydrological model used herein carvalho and beg acknowledge fct portuguese foundation for science and technology through the project uid mar 04292 2019 which was financed by mec portuguese ministry of education and science and the fse european social fund under the programs poph qren human potential operational programme from national strategic reference framework and poch human capital operational programme from portugal 2020 appendix see tables 1 5 
