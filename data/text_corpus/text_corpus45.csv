index,text
225,we present the projection based embedded discrete fracture model pedfm for hexahedral corner point grid cpg geometries for the simulation of hydrothermal processes in fractured porous media unlike the previously developed pedfm for structured box grids our new development allows for the modeling of complex geometries defined with hexahedral cpg cells it also advances the pedfm method to include coupled flow and heat transfer systems mass and energy conservation equations are simulated in a fully coupled manner using a fully implicit fim integration scheme this allows for stable simulations specially when large time steps are taken independent corner point grids are imposed on the rock matrix and all fractures with conductivities ranging from highly permeable to flow barriers the connectivities between the non neighboring grid cells are described such that a consistent discrete representation of the embedded fractures occurs within the corner point grid geometry specially as the quadrilateral interfaces are allowed to be fully flexible various numerical tests including geologically relevant and real field models which are established in the literature are conducted to demonstrate the applicability of the developed method it is shown that pedfm can accurately capture the physical influence of both highly conductive fractures and flow barriers on the flow and heat transfer fields in complex reservoir geometries this development is promising for flow simulations of real field geo models increasing the discretization flexibility and enhancing the computational performance for capturing explicit fractures accurately keywords flow in porous media fractured porous media corner point grid geological formations embedded discrete fracture model heterogeneous geological properties 1 introduction for successful development of a variety of geo engineering applications related to geo energy e g hydrocarbon and geothermal production and storage e g co2 storage and hydrogen storage a detailed understanding of fluid mass and heat transport in porous rocks is essential to achieve this accurate and efficient simulation of mass and heat transfer in the subsurface geological formation plays a crucial role computer models and their resulting estimation of the dynamic processes contribute to efficient and safe operations in the production or storage facilities for any of the above listed applications simulation results provide valuable insights into the optimization of hydrocarbon extractions jansen et al 2005 the energy production outlines and the life time of geothermal systems osullivan et al 2001 axelsson et al 2003 burnell et al 2012 2015 the practical capacities that can be offered by the underground formations to store co 2 eiken et al 2011 class et al 2009 harris et al 2021 wang et al 2021 ruprecht et al 2014 or hydrogen anon 2021 heinemann et al 2021 and many more however while modeling subsurface flow the geo engineering community faces a number of key challenges the geological formations are often large scales in nature while they are located only a few kilometers deep in the subsurface crust and have a thickness of hundreds if not tens of meters their areal extents can easily be in orders of kilometers in order to reflect the geological and geometrical properties of the subsurface accurately high resolution computational grids are often imposed on the domain this results in significant computational complexity which makes it impossible to run the computer models using conventional methods moreover strong spatial heterogeneity contrasts are observed between various physical and chemical properties in the formations these heterogeneities affect the flow and transport properties of the rock i e storage capacity and conductivity across several orders of magnitude the discretization of the governing partial differential equations or pdes results in ill conditioned linear systems of equations creating challenges for the numerical solution schemes applied to solve such heterogeneous systems in addition the measurement of the heterogeneous properties several kilometers beneath the subsurface involves a great deal of uncertainty in order to minimize the impact of such uncertainties instead of one realization hundreds if not thousands of realizations are created in the context of uncertainty quantification uq and a large number of simulations have to be run thus the complexity of the system can have a huge impact on providing predictions on a reasonable time scale furthermore geological formations are often defined with complex geometry and stratigraphy using cartesian grid geometry even though it allows for simpler conceptual modeling analyses can result in oversimplified and inaccurate predictions in addition the presence of faults and fractures has significant effects on fluid and heat flow patterns through the subsurface formations the heterogeneity contrasts in the length scales and conductivities caused by these complex networks of fractures and faults can cause extreme challenges in solving the linear systems using numerical methods gan and elsworth 2016 gholizadeh doonechaly et al 2016b salimzadeh et al 2019 moreover the strong coupling of mass and heat transport results in severe non linearity which negatively impacts the stability and convergence in the system in case of multi phase flow e g high enthalpy geothermal systems these issues become more drastic wong et al 2018 the elastic and plastic deformations in the geo mechanical interactions rossi et al 2018 garipov et al 2016 gholizadeh doonechaly et al 2016a reactive transport e g geo chemical interaction between the substances morel and morgan 1972 leal et al 2017 salimzadeh and nick 2019 and compositional alterations in the fluid and rock are among the list of other noteworthy challenges therefore there is a high demand for developing advanced simulation methods that are computationally efficient and scalable yet accurate at the desired level consequently the development of a reliable computer model for simulation of subsurface flow and transport in fractured porous media is critical to address the challenges in practical applications as a result many advanced numerical methods have been developed to represent the real field geological formations accurately instead of using cartesian grids more complex and flexible gridding structures are needed as these formations are more conveniently represented by flexible grids lie et al 2020 reichenberger et al 2006 the grid geometry should create a set of discrete cell volumes that approximate the reservoir volume yet fit the transport process physics and avoid over complications as much as possible ahmed et al 2015 unstructured grids allow for many flexibilities which need to be carefully applied to a computational domain so that the discrete systems do not become over complex karimi fard et al 2004 jiang and younis 2016 without introducing the full flexibility and at the same time complexity of the fully unstructured grids the corner point grid cpg geometry allows for many possibilities with better representation of the geological structures this has made cpg attractive in the geoscience industry grade simulations ponting 1989 ding and lemonnier 1995 geoquest 2014 lie 2019 fractures have often small apertures size of millimeters but pose a serious impact on flow patterns due to large contrast of permeability between fractures and their neighboring rock matrix berkowitz 2002 kumar et al 2020 therefore consistent representation of these geological features is important in predicting the flow behavior using numerical simulations berkowitz 2002 different approaches have been proposed to model the effect of fractures on flow patterns to avoid direct numerical simulation dns and thereby imposing extremely high resolution grids on the length scales of fracture apertures it is possible to upscale fractures by obtaining averaged and effective properties e g permeability between fractures or faults and the hosting rock also known as the rock matrix this introduces a porous media representation without fractures but with approximated conductivities however such models raise concerns about the inaccuracy of the simulation results due to the employed excessively upscaled parameters especially in presence of high conductivity contrasts between the matrix and fractures therefore two distinct methods have been introduced in fracture modeling approaches the so called dual continuum models also known as dual porosity or dual porosity dual permeability warren and root 1963 barenblatt et al 1983 kazemi et al 1996 and the discrete fracture model dfm dietrich et al 2005 in the dual porosity method the matrix plays the role of fluid storage and the fluid only flows inside the fractures as it is assumed that there is no direct connection between the matrix cells in the dual porosity dual permeability method both matrix and fracture have connections both dual porosity and dual porosity dual permeability models homogenize the fracture domain in a computing block and neglect specific fracture features such as orientation and size dfm on the other hand considers fractures as a separate system in a lower dimensional domain than that of the rock matrix and couples them through a flux transfer function in 2 d domains the fractures are represented by 1 d line segments and in 3 d domains each fracture is modeled by a 2 d plane segment dfm methods have been developed and evolved quite significantly during the past several years see e g karimi fard et al 2004 lee et al 1999 2001 li and lee 2008 ahmed et al 2015 geiger boschung et al 2009 karvounis 2013 reichenberger et al 2006 moinfar et al 2014 fumagalli et al 2016 and the references therein two different dfm approaches have been presented in the literature the embedded dfm edfm and the conforming dfm cdfm flemisch et al 2018 li and voskov 2021 moinfar et al 2013 the main difference between these two techniques resides in the flexibility to the grid geometry shah et al 2016 in cdfm the fracture elements are located at the interfaces between the unstructured matrix grid cells sandve et al 2012 the effect of the fractures is represented by modifying transmissibilities at those interfaces therefore there is an accurate consideration of flux transfer between the matrix and the fractures karimi fard et al 2004 reichenberger et al 2006 ahmed et al 2015 however for highly dense fracture networks the number of matrix grid cells should be very high with very fine grid cells close to the fracture intersections to account for the fractures in addition in case of fracture generation and propagation the matrix grid has to be redefined at various steps of the simulation which reduces the efficiency of such an approach all of these complexities can limit the application of cdfm in real field applications in edfm fractures are discretized separately and independently from the matrix on a lower dimensional domain by using non conforming grids lee et al 1999 li and lee 2008 once the grid cells are created and the discretization is finished the fractures and matrix are coupled together using conservative flux transfer terms that calculate the flow between each fracture element and its overlapping neighbors hajibeygi et al 2011 hosseinimehr et al 2018 xu and sepehrnoori 2019 having two independent grids allows for the modeling of complex fracture networks with simpler grids for the matrix while edfm can provide acceptable results for highly conductive fractures it cannot accurately represent flow barriers such as non conductive fractures and sealing faults to resolve this limitation projection based edfm pedfm was introduced for the first time by tene et al 2017 and extended to multilevel multiscale framework in a fully 3d cartesian geometry hosseinimehr et al 2020 pedfm provides consistent connectivity values between the rock matrix and the fractures and thus can be applied to fractured porous media with any range of conductivity contrasts between the rock and the fractures either highly conductive or impermeable the original pedfm concept tene et al 2017 has been applied to more geoscientific applications e g in jiang and younis 2017 in this work the projection based embedded discrete fracture model pedfm on the corner point grid cpg geometry is presented to cover a more general application criteria different flow environments are considered i e multiphase fluid flow model isothermal in fractured porous media and single phase coupled mass heat flow in low enthalpy fractured geothermal reservoirs the finite volume method fvm is used for discretization of the continuum domain to represent realistic and geologically relevant domains the corner point grid geometry is used the sets of nonlinear equations are coupled using fully implicit fim coupling strategy the flux terms in the mass and energy conservation equations are discretized with an upwind two point flux approximation tpfa in space and with a backward implicit euler scheme in time the pedfm is employed in order to explicitly and consistently represent fractures and to provide computational grids for the rock matrix and the fractures independently regardless of the complex geometrical shape of domain here the applicability of the pedfm implementation tene et al 2017 hosseinimehr et al 2020 has been extended to include fractures with generic conductivity contrasts either highly conductive or impermeable with any positioning and orientation on the corner point grid geometry this matter is paramount for practical field scale applications in addition to geometrical flexibility of edfm the matrix matrix and fracture matrix connectivities are altered to consider the projection of fractures on the interfaces of matrix grid cells using various synthetic and geologically relevant real field models the performance of the pedfm on the corner point grid geometry is shown this article is structured as follows first the governing equations are described in section 2 the discretization and simulation strategy are explained in appendix a 3 in section 4 the corner point grid geometry and calculation of the transmissibilities are briefly covered the pedfm approach for the corner point grid geometry is presented in section 5 the test cases and the numerical results are shown in section 6 at last the paper is concluded in section 7 2 governing equations in this section the governing equations of the isothermal multiphase flow is revisited in order to improve the readability the governing equations for single component water two phase vapor liquid coupled mass heat transport in geothermal systems are presented in the appendix mass conservation in porous media for phase α in the absence of mass exchange between the phases capillary and gravitational effects with n frac explicit fractures is given as 1 t ϕ ρ α s α m ρ α λ α p m ρ α q α m w i 1 n frac ρ α q α m f i on ω m r n for the rock matrix m and 2 t a ϕ ρ α s α f i a ρ α λ α p f i ρ α q α f i w ρ α q α f i m j 1 n frac ρ α q α f i f j j i on ω f i r n 1 i 1 n frac for the lower dimensional fracture f i with aperture a there exist n α phases moreover the superscripts m f and w in eqs 1 2 indicate respectively the rock matrix the fractures and the wells here ϕ is the porosity of the medium ρ α s α λ α are the density saturation and mobility of phase α respectively in addition λ k r α μ α k holds where k r μ and k are phase relative permeability viscosity and rock absolute permeability tensor respectively also q α is the phase source term i e wells finally q α m f i and q α f i m are the phase flux exchanges between matrix and the i th fracture whereas q α f i f j represents the influx of phase α from j th fracture to the i th fracture note that the mass conservation law enforces v q α m f i d v a f i q α f i m d a and a f i q α f i f j d a a f j q α f j f i d a the peaceman well model peaceman 1978 is used to obtain the well source terms of each phase for the rock matrix as 3 q α m w w i λ α p w p m δ v and for the fractures as 4 q α f i w w i λ α p w p f i δ a here w i denotes the well productivity index and λ α is the effective mobility of each phase λ k r α μ α k between the well and the grid cell penetrated by the well in each medium in the discrete system for the rock matrix the control volume is defined as δ v and in the discrete system for the fracture the control area is written as δ a the flux exchange terms q α m f i q α f i m matrix fracture connectivities and q α f i f j fracture fracture connectivities are written as q α m f i c i m f i λ α p f i p m 5 q α m f i c i f i m λ α p m p f i q α f i f j c i f i f j λ α p f j p f i where c i indicates the connectivity index between each two non neighboring elements see eq 49 eqs 1 2 subject to proper initial and boundary conditions form a well posed system for n α unknowns once the α 1 n α s α 1 constraint is employed to eliminate one of the phase saturation unknowns here this system of equations is solved for a two phase flow fluid model with the primary unknowns of p and s 1 from now on indicated as s please note that the effects of both capillarity in case of a multiphase flow and gravity are neglected in all the equations 3 discretization of the equations and the simulation strategy the discretization of the nonlinear equations is done using the finite volume method fvm the equations are discretized with a two point flux approximation tpfa finite volume scheme in space and a backward implicit euler scheme in time independent structured grids are generated for a three dimensional 3d porous rock and 2d fracture planes the discretization is done for each medium for a corner point grid geometry an illustration is presented in fig 4 the coupled system of non linear equations 1 2 is discretized by calculating the fluxes the advective tpfa flux of phase α between control volumes i and j reads 6 f α i j ρ α k r α μ α t i j p i p j here t i j a i j d i j k i j h denotes the transmissibility between the neighboring cells i and j a i j and d i j are the interface area and the distance between these two cells centers respectively the term k i j h is the harmonic average of the two permeabilities the superscript indicates that the corresponding terms are evaluated using a phase potential upwind scheme following the edfm and pedfm paradigms hajibeygi et al 2011 tene et al 2017 hosseinimehr et al 2018 the fluxes between a matrix cell i and a fracture cell j are modeled as 7 f α i j m f f α i j f m ρ α k r α μ α t i j m f p i m p j f in this equation t i j m f is the geometrical transmissibility in the mass flux between cell i belonging to the rock matrix m and the element j belonging to the fracture f i and it reads 8 t i j m f k i j h c i i j in the equation above k i j h denotes the harmonically averaged permeability between the rock matrix and the overlapping fracture elements moreover c i i j m f is the connectivity index between the two overlapping elements the edfm and pedfm model the matrix fracture connectivity index as 9 c i i j m f a i j m f d i j with a i j m f being the area fraction of fracture cell j overlapping with matrix cell i see fig 1 on the left and d i j being the average distance between these two cells hajibeygi et al 2011 similarly the flux exchange between intersecting fracture elements i belonging to fracture f i and j belonging to fracture f j is modeled as 10 f α i j f i f j f α i j f j f i ρ α k r α μ α t i j f i f j p i f i p j f j here t i j f i f j is the geometrical transmissibility in the mass flux between element i in the fracture f i and the element j in the fracture f j which reads 11 t i j f i f j k i j h c i i i i j f i c i j i i j f j c i i i i j f i c i j i i j f j please note that the geometrical transmissibility t i j f i f j between the two non neighboring intersecting fracture cells is obtained on a lower dimensional formulation this is needed due to the fact that the intersection between two 2d fracture plates forms a line segment and the intersection between two 1d fracture line segments results in a point fig 1 on the right visualizes an example of an intersection between two non neighboring 2d fracture elements the result of the intersection is a line segment i i j colored in red with the average distances from the intersection segment written as d i i i j f i d j i i j f j this is the reason why these transmissibilities are computed using a harmonic average formulation as shown above thus at each time step the following system of equations is solved 12 ϕ ρ α s α i n 1 ϕ ρ α s α i n δ t m j 1 n n f α i j m k 1 n frac j 1 n f k f α i j m f k ρ α q α i m w i 1 n m in the matrix and 13 a ϕ ρ α s α i n 1 a ϕ ρ α s α i n δ t f h j 1 n n f α i j f h j 1 n m f α i j f h m k 1 n frac j 1 n f k f α i j f h f k ρ α q α i f h w i 1 n f h in each fracture f h here n m and n f k are the number of cells in the matrix and number of the cells in fracture f k respectively n n indicates the number of neighboring cells 2 in 1d 4 in 2d 6 in 3d eqs 12 13 can be written in residual form as 14 r α i n 1 m ρ α q α i m w ϕ ρ α s α i n 1 ϕ ρ α s α i n δ t m j 1 n n f α i j m k 1 n frac j 1 n f k f α i j m f k i 1 n m for the rock matrix and 15 r α i n 1 f h ρ α q α i f h w a ϕ ρ α s α i n 1 a ϕ ρ α s α i n δ t f h j 1 n n f α i j f h j 1 n m f α i j f h m k 1 n frac j 1 n f k f α i j f h f k i 1 n f h for fracture f h let us define r n r m n r f 1 n r f n frac n t where r k n is the residual vector of medium k at time step n similarly p n and s n indicate the vectors of pressure and saturation unknowns of all media the residual r n 1 is a non linear function of the primary unknowns p n 1 and s n 1 thus at each time step a newton raphson method is employed to solve the non linear system iteratively i e 16 r α ν 1 r α ν r α p ν δ p ν 1 r α s ν δ s ν 1 where the superscript ν is the iteration index consequently at each newton s iteration the linearized system j ν δ x ν 1 r ν is solved here j ν is the jacobian matrix with δ x ν 1 δ p δ s t therefore assuming two phases the indices 1 and 2 representing the equations of the first and the second phases respectively the linear system of equations can be written as 17 j 1 p m m j 1 p m f j 1 p f m j 1 p f f j 1 s m m j 1 s m f j 1 s f m j 1 s f f j 2 p m m j 2 p m f j 2 p f m j 2 p f f j 2 s m m j 2 s m f j 2 s f m j 2 s f f ν j ν δ p m δ p f δ s m δ s f ν 1 δ x ν 1 r 1 m r 1 f r 2 m r 2 f ν r ν in this formulation non linear convergence is reached when the following conditions are satisfied 18 r 1 ν 1 2 r 1 0 2 ε r 1 r 1 ν 1 2 r h s 1 2 ε r 1 r 2 ν 1 2 r 2 0 2 ε r 2 r 2 ν 1 2 r h s 2 2 ε r 2 δ p 2 p 2 ε p δ s 2 s 2 ε s here ε r 1 ε r 2 ε p and ε s are the user defined tolerances that are set initially as input at the beginning of the simulation the notation x 2 is the second norm of the vector x the superscript 0 denotes the value of its corresponding vector at the initial state of the iteration step please note that in some systems the condition r ν 1 2 r h s 2 ε r can result in a better convergence when compared to r ν 1 2 r 0 2 ε r and vice versa therefore both conditions are checked and either of them can implicate the convergence signal 4 corner point grid geometry a corner point grid cpg is defined with a set of straight pillars outlined by their endpoints over a cartesian mesh in the lateral direction lie 2019 on every pillar a constant number of nodes corner points is set and each cell in the grid is set between 4 neighboring pillars and two neighboring points on each pillar every cell can be identified by integer coordinates i j k where the k coordinate runs along the pillars and i and j coordinates span along each layer the cells are ordered naturally with the i index x axis cycling fastest then the j index y axis and finally the k index negative of z direction for establishing vertical and inclined faulting more accurately it is advantageous to define the position of the grid cell by its corner point locations and displace them along the pillars that have been aligned with faults surfaces similarly for modeling the erosion surfaces and pinch outs of geological layers the corner point format allows points to collapse along coordinate lines the corner points can collapse along all four lines of a pillar so that a cell completely disappears in the presence of erosion surfaces if the collapse is present in some pillars the degenerate hexahedral cells may have less than six faces this procedure creates non matching geometries and non neighboring connections in the underlying i j k topology lie 2019 fig 2 illustrates the steps in the construction of the corner point grids as explained above 4 1 two point flux approximation in the corner point grid geometry in order to only highlight the calculation of the two point flux approximation in the corner point grid geometry and avoid complexities in presenting fully detailed governing equations a simplified linear elliptic equation is used which serves as a model pressure equation for incompressible fluids i e 19 u f where f is the source sink term wells and u is the darcy velocity defined as 20 u k p finite volume discrete systems can be obtained by rewriting the equation in integral form on discrete cell ω i as 21 ω i u n d s ω i q d x the flux between the two neighboring cells i and k can be then written as 22 u i k γ i k u n d s the faces γ i k are denominated half face as they are linked with a grid cell ω i and a normal vector n i k it is assumed that the grid matches with another one so that each interior half face will have a twin half face γ k i that has an identical area a i k a k i but an opposite normal vector n i k n k i the integral over the cell face is approximated by the midpoint rule and darcy s law i e 23 u i k a i k k p x i k n i k where x i k indicates the centroid of γ i k the one sided finite difference is used to determine the pressure gradient as the difference between the pressure π i k at the face centroid and the pressure at some point inside the cell the reconstructed pressure value at the cell center is equal to the average pressure p i inside the cell thus 24 u i k a i k k i p i π i k c k i c k i 2 n i k u i k t i k p i π i k the vectors c k i are defined from cell centroids to face centroids as shown in fig 3 face normals are assumed to have a length equal to the corresponding face areas a i k n i k i e 25 t i k a i k k i c k i n i k c k i 2 the one sided transmissibilities t i k are related to a single cell and provide a two point relation between the flux across a cell face and the pressure difference between the cell and face centroids the proper name for these one sided transmissibilities is half transmissibilities as they are associated with a half face karimi fard et al 2004 bosma et al 2017 finally the continuity of fluxes across all faces u i k u k i as well as the continuity of face pressures π i k π k i π i k are set this leads to 26 t i k 1 u i k p i π i k 27 t k i 1 u i k p k π i k the interface pressure π i k is then eliminated and the two point flux approximation tpfa scheme is defined as 28 u i k t i k 1 t k i 1 1 p i p k t i k p i p k t i k is the transmissibility associated with the connection between the two cells the tpfa scheme uses two points the cell averages p i and p k to approximate the flux across the interface γ i k between cells ω i and ω k the tpfa scheme in a compact form obtains a set of cell averages that meet the following system of equations 29 k t i k p i p k q i ω i ω 5 pedfm for the corner point grid geometry in this section pedfm for the corner point grid cpg geometry is described note that this development considers only convex hexahedral cpg geometries with planar faces however in some field relevant geo models some interfaces may not be planar for example the model illustrated in fig 4 and the grid cells illustrated in fig 5 have some non planar faces to obtain the matrix fracture intersections in the presence of non planar matrix grid interfaces the pedfm procedure approximates the non planar interface with a planar interface this approximation is explained further in this section note that the planar fractures can have any orientation in 3d with arbitrary crossing lines with other fractures as stated in the section for the discretization of the governing equations sets of flux exchange terms are defined between the matrix and the explicit fractures inside each term the connectivity index c i i j a i j d i j is considered in the corner point grid geometry to calculate the area fraction a i j of each overlapping fracture element inside the corresponding matrix grid cell various geometrical functions are defined which can obtain the intersection between a quadrilateral the 2d planar fracture grid cell in 3d geometry and a hexahedron the matrix grid cell in the corner point grid geometry at first the matrix grid cells that are overlapped by each element of each fracture need to be detected to achieve this the matrix cell with the shortest distance to the fracture element is detected the distance is calculated between the matrix cell center point and the corners of the fracture element in a loop it is checked whether the quadrilateral fracture element intersects with any of the quadrilateral faces of that hexahedral matrix cell the fracture matrix intersection points are then ordered counter clockwise and a polygon is formed from the intersection points various geometrical possibilities exist with regards to the intersection points and the polygons generated by them more precisely if only one or two intersection points are obtained there is no polygon generated as such no area can be defined by the points i e the intersection is a line or a single point thus zero surface area alternatively if between three to six intersection points are detected one can form a polygon with them either a triangle a quadrilateral a pentagon or a hexagon the area of the polygon i e a i j is then calculated by triangulation procedure once the area is calculated the average distance between the fracture plate and the overlapped matrix grid cell i e d i j is computed for this purpose since complex geometries are considered a numerical approach is developed this numerical approach imposes a set of equidistant points within the hexahedral matrix grid cell the distance of each point to the fracture plate is then calculated finally the distances for all numerical points are then averaged and assigned to d i j value having the area of the polygon and this average distance the connectivity index is then calculated afterwards using a flood fill search algorithm newman 1979 all the matrix grid cells that are overlapped by the mentioned fracture elements are detected and their connectivity indices are calculated this procedure is done for each fracture element of each fracture plate the flood fill search algorithm ensures computational efficiency by avoiding unnecessary checks on the matrix grids that are not in the vicinity of the fracture element the algorithm above is performed on the computational cpg geo model assuming all matrix grid interfaces are planar however as mentioned before field relevant models could entail some non planar interfaces to employ our pedfm cpg in these scenarios the developed algorithm applies approximate pedfm connectivities for those non planar interfaces more precisely prior to obtaining the intersection points between matrix and fracture elements the non planar interfaces are approximated into planar interfaces to achieve this the middle point of the non planar interface is acquired via arithmetic averaging of the coordination of the four corners this middle point together with the normal vector of the corresponding interface are used to formulate the equation of a planar quadrilateral that best fits this interface this planar interface is then used to detect and realize the intersection points within the pedfm algorithm it is also worth mentioning that the approximation of non planar interfaces into planar quadrilateral plane segments results in slight in many cases negligible volume shifts of the hexahedral grid cells between neighboring cells of the interface note that as any volume shift in one grid cell is followed by identical volume shift with opposite sign in the other neighboring grid cell hence this approximation remains strictly mass conservative moreover such approximation is primarily local for each non planar interface and as such remains much smaller than the fine scale grid cell size in each direction however it allows for the major flexibility of having the developed pedfm also applicable to non planar matrix interfaces the first step in the development of the pedfm for the corner point grid geometry is to flag all the interfaces between the matrix cells that a fracture plate interrupts the connection between their cell centers to detect the affected interfaces first the list of all the matrix grid cells that are overlapped by a fracture element is considered in a loop for each overlapped matrix grid cell a line segment that connects the cell center of the mentioned matrix grid cell and the cell center of each of its neighboring cells is defined if the fracture plate intersects the line segment the interface between the two neighboring matrix grid cells is affected by the crossing fracture therefore a projection of the fracture element is obtained on the affected interface in fig 6 the fracture element f is assumed to overlap with the matrix grid cell ω i with an area fraction of a i f a set of projections is defined on the interfaces between the overlapped matrix grid cell ω i and its neighboring grid cells that are affected by the crossing i e ω j and ω k for the interface between grid cells ω i and ω j denoted as γ i j the projection area fraction a i f γ i j is obtained via 30 a i f γ i j a i f cos γ here γ is the angle between the fracture element f and the interface γ i j connecting the matrix grid cell ω i and the neighboring grid cell in this example ω j on the zoomed in section of fig 6 this projection area fraction is highlighted in red similarly the projection area fractions on the interfaces between all the neighboring matrix grid cells that are intersected by fracture elements are calculated based on the same formulation thereafter a continuous projection path shown in fig 6 as solid lines in light blue color is obtained on the interfaces this projection path disconnects the connections between the neighboring cells on both sides of this path thus allowing a non parallel and consistent flux exchange i e through matrix fracture matrix after obtaining the projection areas a set of new transmissibilities are defined to provide connection between the fracture element f and each non neighboring matrix grid cell i e j and k in the example shown in figure 6 31 t i e f a i f γ i j d i e f λ i e f with d i e f defined as the average distance between the fracture element f and matrix grid cell i e and λ i e f being the effective fluid mobility between these two cells therefore the transmissibility between the matrix grid cell i and its corresponding neighboring cells is re adjusted as 32 t i i e a i i e a i f γ i j δ x e λ i e f these transmissibilities are modified via multiplication of a factor denoted as α and defined as a fraction of the projection area divided by the total area of that interface as the following 33 α a i f γ i j a i i e as an example if half of an interface area between two cells is covered by the projection of a fracture cell the alpha factor for that interface will be α 0 5 the transmissibilities are modified via 34 t i i e t i i e 1 α one should consider that due to the continuation of a fracture plate for all the overlapping fracture elements except for the boundaries of the fractures the projections will cover the entire area of the affected interfaces this means that α is 1 0 for most of the cases therefore to simplify the implementation all the non zero α factors are modified to be 1 0 forcing full projections from the boundaries of the fractures on the affected interfaces algorithm 1 describes the pedfm procedure for the corner point grid geometry where the steps explained above are pointed step by step 6 simulation results numerical results of various test cases are presented in this section the first two test cases compare the pedfm model on the cartesian grid geometry with the pedfm on the corner point grid geometry the third test case demonstrates the pedfm result on a non orthogonal grid model thereafter we move towards a series of geologically relevant fields using the pedfm on the corner point grid geometry a number of synthetic highly conductive fractures and impermeable flow barriers are added to the geologically relevant models the computational performance of this method will not be benchmarked as the purpose of these simulation results is to demonstrate the pedfm on the corner point grid geometry as a proof of concept tables 1 and 2 show the mutual input parameters that are used for the test cases with the isothermal multiphase and the geothermal single phase flow models respectively 6 1 test case 1 2d heterogeneous fractured reservoir square in this test case the pedfm on the cartesian grid is compared with the corner point grid geometry for this reason a box shaped heterogeneous 100 m 100 m domain containing 30 fractures with mixed conductivities is considered the length of each fracture is different but the size of their aperture is identical and set to a f 5 1 0 3 m a 136 136 grid is imposed on the rock matrix and the fracture network consists of 1024 grid cells in total 19520 cells the permeability of the matrix ranges from k m m i n 1 2 1 0 15 m 2 to k m m a x 1 2 1 0 12 m 2 and the permeability of the fracture network has the range of k f m i n 1 0 22 m 2 and k f m a x 1 0 6 m 2 two injection wells are located at the bottom left and top left corners with an injection pressure of p inj 2 1 0 7 pa additionally there are two production wells at the bottom right and the top right corners with a pressure of p prod 1 1 0 7 pa table 2 demonstrates the input parameters of this test case fig 7 shows the results of the simulation using both cartesian grid and corner point geometry note that in this test case and the test case 2 the x y z coordinates of the grids of the cartesian geometry and the corner point grid geometry are identical however the grids are generated with different geometrical approaches in one scenario the grid cells are discretized using the cartesian grid geometry and the grid cells are indexed in every of the x y z directions i 1 n x j 1 n y k 1 n z for this scenario the pedfm for the cartesian grid is used which has already been developed tene et al 2017 in the other scenario the grid cells are generated using the corner point grid geometry where a list of nodes and a list of all the interfaces and transmissibilities are generated the pedfm for the corner point grid geometry that is developed in this work is used for this scenario therefore the size and positioning of the grid cells in the two scenarios are identical though have been generated with different geometrical approaches the results of the both scenarios show a match visually in order to quantify the difference between the results of the two different geometrical approach for the pedfm a average relative error in second norm is calculated for the pressure and the saturation distributions over the entire simulation time this relative error for each variable x is calculated as 35 e x x cart x cpg 2 x cart 2 where x is a solution vector of either of the main unknowns and the subscripts cart and cpg indicate cartesian grid and the corner point grid geometry the errors calculated for this test case are e p 1 55 1 0 5 and e s 1 60 1 0 4 6 2 test case 2 3d homogeneous fractured reservoir box these test cases similar to the test case 1 show a comparison for the pedfm on the cartesian grid versus the corner point grid geometry a 3d 100 m 100 m 40 m domain containing 15 lower dimensional fractures with different geometrical properties is considered a 50 50 20 grid is imposed on a rock matrix the fracture network contains 1005 grid cells total of 51005 grid cells the rock matrix has a permeability of k m 1 0 14 m 2 the fracture network consists of both highly conductive fractures with a permeability of k f 1 0 6 m 2 and flow barriers with a permeability of k f 1 0 22 m 2 two injection wells exist on the bottom left and top left boundaries with a pressure of p inj 2 1 0 7 pa similarly two production wells are located at the bottom right and top right boundaries with a pressure of p prod 1 1 0 7 pa all wells are vertical and perforate the entire thickness of the reservoir two different grids are considered using the cpg geometry one with orthogonal grids where the coordinates of all the grid cells are identical with those in the cartesian grid geometry and one with non orthogonal grids where the pillars of the grids are slightly tilted to provide a better insight the non orthogonal grid mesh is shown in fig 8 as shown the domain remains a cartesian box but the cpg grid is tilted to verify its consistency fig 9 illustrates the simulation results for he cartesian grid and the two sets of cpg models fig 10 shows the errors between the results of the cartesian grid geometry as the reference solution and the two cpg cases orthogonal and non orthogonal similar to the previous test case a match is visible between the results of the cartesian grid and the orthogonal corner point grid with errors calculated via eq 35 of e p 1 71 1 0 9 and e s 2 47 1 0 8 the difference between the solutions of the cartesian grid and the non orthogonal corner point grids are greater as the different grid geometry results in different connectivities e p 1 03 1 0 2 and e s 4 44 1 0 2 6 3 test case 3 3d reservoir with non orthogonal grids the third test case fig 11 demonstrates the capability of the pedfm method on the reservoir model based on corner point grids the grid cells in test case 2 were deformed to create a distorted version of that model the model allows for the testing of the pedfm implementation in a non orthogonal grid system the same dimensions and gridding from test case 2 are used in this test case the fracture network consisting of 15 fractures is discretized in 876 grids and a total of 50876 grid cells are imposed on the entire domain two different scenarios are considered in this test case in the first scenario some fractures are considered as highly conductive while the others are given a very low permeability and are considered to be flow barriers shown in fig 11 a with yellow color for high permeability and blue color for low permeability in the second scenario the permeability of the fractures is chosen as the inverse of scenario 1 11 b i e the low conductive fractures are now highly conductive and vice versa the values of permeability for the matrix and low and high conductive fractures are identical to the ones in test case 2 the well pattern and pressure restrictions are also the same as in the previous test case the pressure and saturation results of scenario 1 are shown in figs 12 a and 12 c respectively at the left side of fig 12 as the grid geometry and the gridding system of this test case are not similar to the previous test case it is not possible to compare the two test cases the pressure and saturation distribution of the second scenario at the same simulation time can be observed at right side of fig 12 in the first scenario the flow barriers are close to the injection wells thus restricting the displacement of the injecting phase towards the center of the domain fig 12 c therefore a high pressure gradient is visible near the injection wells fig 12 a as the low permeability fractures limit the flux through the domain in the second scenario the highly conductive fractures are near the injection wells and the saturation profile increases through the whole thickness of the domain fig 12 d the pressure profile is uniformly distributed in the reservoir as there is no flux restriction near the wells fig 12 b additionally to perform a grid resolution sensitivity analysis of the developed model this test case was used with three different grid resolutions while keeping all the input parameters identical as the ones that were mentioned above three different computational grids using corner point grid geometry were imposed on this domain namely 80 80 32 40 40 16 and 20 20 8 for the rock matrix and 2852 757 and 173 for the fracture network respectively fig 13 shows the saturation distribution of these three different gird resolutions at a simulation time of t 100 d a y s the results of the two lower grid resolutions i e 20 20 8 and 40 40 16 were compared against the results of the highest grid resolution i e 80 80 32 meaning that the results of the 80 80 32 grid resolution is used as reference in the calculation of the error the relative error for pressure and saturation results are given in fig 14 these errors are calculated as 36 e x x highres x lowres 2 x highres 2 x p s w 6 4 test case 4 the johansen formation the water bearing johansen formation was a potential candidate for co2 storage in a project promoted by the norwegian government the norwegian continental margin has excellent potential for co2 storage options in saline aquifers the johansen formation eigestad et al 2009 is located in the deeper part of the sognefjord delta offshore mongstad on norway s southwestern coast see fig 15 it belongs to the lower jurassic dunlin group and is interpreted as a laterally extensive sandstone and it is overlaid by the dunlin shale and below by the amundsen shale a saline aquifer exists in the depth levels ranging from 2200 m to 3100 m below the sea level the depth range makes the formation ideal for co2 storage due to the pressure regimes existent in the field providing a thermodynamical situation where co2 is in its supercritical phase these formations have uniquely different permeabilities and perform very different roles in the co2 sequestration process the johansen sandstone has relatively high porosity and permeability and it is suitable to store co2 the low permeability overlaying dunlin shale acts as a seal that avoids the co2 from leaking to the sea bottom layers the johansen formation has an average thickness of nearly 100 m and the water bearing region extends laterally up to 60 km in the east west direction and 100 km in the north south direction the aquifer has good sand quality with average porosities of roughly 25 this implies that the johansen formation s theoretical storage capacity can exceed one gigaton of co2 providing the assumption of residual brine saturation of about 20 the northwestern parts of the johansen formation are located some 500 m below the operating troll field one of the north sea s largest hydrocarbon fields 6 4 1 data set the matmora project has created five models of the johansen formation one full field model 149 189 16 grids three homogeneous sector models 100 100 n for n 11 16 21 and one heterogeneous sector model 100 100 11 also known as the npd5 sector eigestad et al 2009 in this work the last data set npd5 has been used the npd5 sector can be seen in fig 16 in the left side of this figure the npd5 sector is highlighted with blue color in the discretized computational grids the johansen formation is represented by five layers of grid cells the amundsen shale below the johansen formation and the low permeable dunlin shale above are characterized by one and five cell layers respectively the johansen formation consists of approximately 80 sandstone and 20 claystone whereas the amundsen formation consists of siltstones and shales and the dunlin group has high clay and silt content 6 4 2 rock properties the johansen sandstone is a structure with a wedge shape pinched out in the front part of the model and divided into two sections at the back fig 17 shows two different selections i e the entire formation figs 17 a and 17 c and the npd5 sector of the formation figs 17 b and 17 d the porosity map of the entire model is visible in fig 17 a and fig 17 b shows the cells with porosity values larger than 0 1 that belong to johansen formation similarly the permeability map of the entire formation is shown in figs 17 c and fig 17 d illustrates the permeability of the npd5 sector where the dunlin shale above the johansen and the amundsen shale below the johansen formation are excluded the permeability tensor is diagonal with the vertical permeability equivalent to one tenth of the horizontal permeability in both graphs the permeability is represented by a logarithmic color scale 6 4 3 simulation results the npd5 sector of the johansen formation model lie 2019 is used in the following test case it is a corner point grid reservoir model that consists of 100 100 11 grid cells from which 88775 grid cells are active the rock properties of the johansen formation available as public data were given as input in the simulation a network of 121 fractures is embedded in the reservoir geological data set that contains both highly conductive fractures and flow barriers with permeability of k f m a x 1 0 8 m 2 and k f m i n 1 0 20 m 2 respectively the model is bounded by two shale formations therefore the fractures were placed inside the johansen formation layers 6 to 10 in total 150 fractures are embedded in the model and the fracture network consists of 3494 grid cells in total 92269 grid cells for matrix and fractures five injection wells with pressure of p inj 5 1 0 7 pa and four production wells with pressure of p inj 1 1 0 7 pa were placed in the model wells are vertical and drilled through the entire thickness of the model fig 19 d illustrates the location of the injection and production wells in this test case moreover fig 18 shows a histogram of the number of the neighboring connections between the matrix grid cells of this field while the majority of the grid cells have 5 or 6 neighbors there are grid cells that have more than 6 neighbors due to non matching grid topology in the npd5 computational model of the johansen formation 29 percent of the interfaces are non planar approximating these interfaces with planar quadrilateral interfaces results in 1 57 percent of volume shift in each grid cell by average however as mentioned previously mass conservation is guaranteed and no inconsistency is generated two scenarios are considered with two different fracture networks of mixed conductivities while the geometries of both fracture networks are identical the permeability values of the fractures from scenario 1 are inverted for the scenario 2 this implies that the highly conductive fractures in the fractures network of scenario 1 act as flow barriers in the 2nd scenario and the flow barriers of scenario 1 are modified to be highly conductive fractures in the scenario 2 figs 19 a and 19 b display the fractures networks of scenario 1 and scenario 2 respectively the matrix grid cells overlapped by the fractures are visible in fig 19 c see fig 19 the simulation results of the first scenario are shown in figs 20 and 21 the injection wells are surrounded by highly conductive fractures that facilitate the flow since the model s dimensions are considerably large approximately 50 km 50 km the pressure distribution in the reservoir is shown in fig 20 high pressure values are observed in a large section of the reservoir as there is no restriction for flow from the wells and two shale formations bound the johansen sandstone one can interpret that the high pressure drops observed in some regions are caused by presence of low permeable fractures or flow barriers in those regions the saturation displacement is considerably enhanced by the highly conductive fractures fig 21 located near the injection wells for the second scenario the results are presented in figs 22 and 23 the injection wells are surrounded by low conductive fractures which restrict the flow from the injection wells towards the production wells the pressure distribution differs considerably when compared to the first scenario the flow barriers near the wells result in high pressure drops in the vicinity of the injection wells the saturation displacement fig 23 is lower than that of scenario 1 due to presence of low conductive fractures near the injection wells 6 5 test case 5 the brugge model the brugge model is an spe benchmark study conceived as a reference platform to assess different closed loop reservoir management methods peters et al 2010 it is the largest and most complex test case on closed loop optimization to represent real field management scenarios the active brugge field model has 44550 corner point grid cells and the main geological features present in the model are a boundary fault and an internal fault seven different rock regions with their particular petrophysical properties are distributed throughout the whole model thirty wells are included in the field model s well production pattern 20 producers and 10 injectors see fig 24 6 5 1 geological model the geological structure of the brugge field contains an east west elongated half dome with a boundary fault at its northern edge and an internal fault with a throw at an angle of nearly 20 degrees to the northern fault edge the dimensions of the field are approximately 10 km 3 km the original high resolution model consists of 20 million grid cells with average cell dimensions of 50 m 50 m 0 25 m in addition to the essential petrophysical properties for reservoir simulation sedimentary facies porosity permeability net to gross and water saturation the grid model includes properties measured in real fields gamma ray sonic bulk density and neutron porosity the data were generated at a detailed scale to produce reliable well log data in the thirty wells drilled in the field the original high resolution model was upscaled to a 450000 grid cells model which established the foundation for all additional reservoir simulations of the reference case a set of 104 realizations each containing 60000 grid cells was created from the data extracted from the reference case all the realizations used the same geological structure of the field the north sea brent type field was the reference to generate the reservoir zones rock properties and thicknesses an alteration of the formations vertical sequence for the general brent stratigraphy column comprising the broom rannoch etive ness tarbert formations was made and resulted in that the highly permeable reservoir zone switched locations with the underlying area less permeable and heterogeneous 6 5 2 rock properties a reservoir model with 60000 grid cells was the reference to create 104 upscaled realizations for the reservoir properties the properties that contain the realizations are facies porosity a diagonal permeability tensor net to gross ratio and water saturation see figs 25 27 6 5 3 simulation results the following test case from the brugge model is used to show the pedfm model s capability in fracture modeling in a synthetic geologically relevant model with the corner point grid geometry the reservoir model consists of 138 48 9 grid cells from which 43474 grid cells are active rock properties of the realization available from public data were used in the simulation a network of 60 fractures is defined in the reservoir domain containing both highly conductive fractures and flow barriers with permeability of k f m a x 1 0 8 m 2 and k f m i n 1 0 20 m 2 respectively the fracture network consists of 5384 grid cells in total 48858 grid cells the well pattern used in this test case was a modified version of the original well pattern with 30 wells peters et al 2010 four injection wells with p inj 5 1 0 7 pa and three production wells with a pressure of p prod 1 1 0 7 pa were defined in the model wells are drilled vertically and through the entire thickness of the reservoir a histogram is available in fig 29 which shows an illustration of the range of the neighboring connections between the matrix grid cells in this model it can be seen that there are a number of grid cells with more than 6 neighbors due to the non matching grid topology this computational model has 66 5 percent of its interfaces as non planar and the approximation of the these interfaces into planar quadrilateral interfaces causes 1 23 percent of volume shift in each grid cell on average see fig 28 two scenarios are created with two different fracture networks including mixed conductivities the geometries of both fracture networks are identical but the permeability values of the fractures from scenario 1 are inverted for the scenario 2 namely the highly conductive fractures in the fractures network of scenario 1 act as flow barriers in the 2nd scenario and the flow barriers of scenario 1 are modified to be highly conductive fractures in the scenario 2 figs 29 a and 29 b show the fracture networks of scenario 1 and scenario 2 respectively the matrix grid cells overlapped by the fractures are visible in fig 19 c the pressure and saturation results of the scenario 1 are shown in figs 30 and 31 respectively the pressure results are only shown for the simulation time 5000 days but the saturation profiles are presented for three time intervals of 2000 5000 and 10000 days the injection wells are surrounded by highly conductive fractures that act as flow channels as a result the saturation of the injecting phase is considerably increased in larger distances from the injection phases and the pressure drop around the injection wells is not high the results of the 2 nd scenario can be seen in figs 32 and 33 respectively the pressure results are only shown for the simulation time 5000 days but the saturation profiles are presented for three time intervals of 2000 5000 and 10000 days the injection wells are surrounded by flow barriers that restrict the flow as a result a high pressure zone is formed near the wells since the central area of the reservoir is isolated with low permeability fractures this is followed by a sharp pressure gradient the saturation displacement is small due to the reservoir s low permeability values and the absence of highly conductive fractures near the wells the saturation displacement is restricted to the area near the injection wells 6 6 test case 6 and 7 norne field norne verlo and hetland 2008 is an oil and gas field situated in the norwegian sea around 80 kilometers north of the heidrun oil field the field dimensions are approximately 9 km 3 km and the seawater depth in the area is 9 m the field is located in a license awarded region in 1986 and incorporates blocks 6608 10 and 6608 11 see fig 34 equinor is the current field operator the expected oil recovery factor is more than 60 which is very high for an offshore sub sea oil reservoir subsurface data from the norne field have been published for research and education purposes thanks to ntnu equinor and partners initiative the full simulation model can be obtained through the open porous media opm project opm project org anon 2020 the norne field simulation model was the first benchmark case based on real field data available to the public the model is based on the 2004 geological model and consists of 46 112 22 corner point grid cells 6 6 1 reservoir the oil and gas production of norne is obtained from a jurassic sandstone which lies at a depth of 2500 meters below sea level the original estimation of recoverable resources was 95 2 million cubic meters for oil mainly in the ile and tofte formations and 13 01 billion cubic meters for gas in the garn formation 6 6 2 field development the alve field finding preceded the norne field s discovery in 1992 the plan for development and operation pdo was approved in 1995 and the production started in 1997 the field development infrastructure consists of a production storage and offloading vessel fpso attached to sub sea templates water injection is the drive mechanism to produce from the field in 2019 norne fpso was granted a lifetime extension to increase value creation from the norne field and its satellite fields and also the blow down of the gas cap in the not formation started in 2020 two production wells were planned to be drilled in the ile formation see fig 35 6 6 3 petrophysical data the field simulation model s petrophysical data consist of porosity permeability net to gross and transmissibility multiplier data permeability is anisotropic and heterogeneous with a clear layered structure as expected for a real reservoir field model the vertical communication is decreased in significant regions of the model by the transmissibility multiplier data that is available resulting in intermediate layers of the reservoir with permeability values close to zero the porosity values of the field are in the interval between 0 094 and 0 347 see fig 36 a considerable percentage of impermeable shale is present in some regions in the model see figs 37 39 6 6 4 simulation results of test case 6 norne with highly conductive fractures this test case demonstrates the performance of the pedfm model on the norne field the corner point grid data for this and the following test cases were extracted from the input files of matlab reservoir simulation toolbox mrst lie 2019 as explained above norne is an oil field located around 80 kilometers north of the heidrun oil field in the norwegian sea lie 2019 as described in the mrst lie 2019 the extent of this oil field is 10 km 2 km 100 m the corner point grid skeleton consists of 46 112 22 grid cells from which 44915 grid cells are active forming the complex geometrical shape of this oil field a synthetic network of 15 fractures designed by the author as a realization is considered inside this domain the permeability of the norne rock matrix in this test case is assumed to be constant at k m 1 0 14 m 2 and the permeability data from the field was not used in this test case all fractures are highly conductive with a permeability of k f 1 0 8 m 2 two injection wells with pressure of p inj 5 1 0 7 pa and two production wells with pressure of p prod 1 1 0 7 pa are located in the outer skirts of the reservoir as it can be seen on fig 39 a all wells are vertical and perforate the entire thickness of the reservoir for this test case the low enthalpy single phase geothermal fluid model was used the input parameters used in this test case are listed in table 2 6 6 5 simulation results of test case 7 norne with mix conductive fractures in this test case the norne field model with a skeleton of 46 112 22 grid cells and a total of 44915 active matrix grid cells is considered unlike in test case 6 the real rock properties of the norne field were used in this test case a set of 56 synthetic fractures are created and embedded in the reservoir domain which comprises highly conductive fractures and flow barriers with permeability of k f m a x 1 0 8 m 2 and k f m i n 1 0 20 m 2 respectively the fracture network consists of 2165 grid cells in total there are 48705 grid cells in this test case four injection wells with a p inj 5 1 0 7 pa and three production wells with a p prod 1 1 0 7 pa were placed in the model wells are vertical and drilled through the entire thickness of the model fig 40 demonstrates a histogram with the number of occurrences for a specific number of neighboring connections between the grid cells of this computational domain the distribution of the counts of the neighboring connections shows that a considerably large number of grid cells have more than 6 neighbors some with up to 20 neighboring connections which is a result of the non matching grids correct computation of the matrix fracture connectivities on this domain with such a topological complexity is crucial for the accurate capture of the effect of the embedded fractures and faults on the flow patterns in this computational model 56 5 percent of the interfaces are non planar and the approximation of the these interfaces into planar quadrilateral interfaces results in a volume shift of 4 45 percent in each grid cell in average like the test cases in johansen 6 4 and brugge 6 5 models two scenarios are considered for the fracture network used in this test case in both scenarios the geometrical properties of the fracture networks are identical however the permeability values of the highly conductive fractures and flow barriers from the scenario 1 are inverted in the scenario 2 see fig 41 the pressure and saturation results of scenario 1 simulation are presented in figs 42 and 43 respectively the pressure results are only shown for simulation time 5000 days but the saturation profiles are presented for three time intervals of 2000 5000 and 10000 days the injection wells are surrounded by flow barriers that restrict the saturation displacement in the reservoir the pressure is high in the areas near the wells these high pressure areas are an indication that the pedfm implementation in the corner point grid geometry is successful in the modeling of the fractures with low conductivities high pressure drops can be seen at the location of the flow barriers the increase in saturation is mainly carried out in two parts of the model these two areas are not isolated from the rest of the model which allows a distribution of the injecting phase through the flow paths the results of scenario 2 are shown in figs 44 and 45 respectively in the same manner as for the previous scenario the pressure results are only shown for the simulation time 5000 days while the saturation profiles are shown for time intervals of 2000 5000 and 10000 days the injection wells are surrounded by highly conductive fractures that act as flow channels the pressure is more uniformly distributed as a result the effect of high permeable fractures near the injector wells has increased the saturation displacement across larger distances in the domain 7 conclusions and future work in this paper a projection based embedded discrete fracture model pedfm for corner point grid cpg geometry was developed and presented this method was used with different fluid models i e for fully implicit simulation of isothermal multiphase fluid flow and low enthalpy single phase coupled mass heat flow in fractured heterogeneous porous media first the corner point grid geometry and its discretization approach were briefly described afterwards the pedfm model tene et al 2017 hosseinimehr et al 2020 was extended to account for fully 3d fracture geometries in a generic corner point grid discrete system through a few box shaped 2d and 3d homogeneous and heterogeneous test cases the accuracy of the pedfm on the corner point grid geometry was briefly compared against the cartesian grid geometry the new method presented similar results of satisfactory accuracy in the corner point grid geometry when compared to a cartesian grid geometry the 3d box shaped reservoir was then converted into a non orthogonal gridding system to assess the pedfm method further moreover numerical results were obtained on a number of geologically relevant test cases different scenarios with various synthetic fracture networks were considered for these test cases these fine scale simulations allowed for mix conductivity fractures it was shown that pedfm can accurately capture the physical influence of both highly conductive fractures and flow barriers on the flow patterns the pedfm in the corner point grid geometry is found to be a promising technique for increasing the discretization flexibility and enhancing the computational performance while honoring the accuracy many geo models including ones used in the test cases above contain millions of grid cells that have complex geometrical alignments to match the positioning of fractures and faults causing significant computational complexity and lack of flexibility especially when taking geomechanical deformation into account the pedfm model provides the possibility to avoid the complexity of gridding in such models by explicitly representing the discontinuities such as fractures and faults in the presence of elastic and more importantly plastic deformations one could only modify the gridding structure of the affected region in the rock matrix fully independent of the fractures and faults this advantage results in significant computational gains especially in the realm of poromechanics the developments of the pedfm in the corner point grid geometry and all the related software implementations of this work are made open source and accessible on https gitlab com darsim credit authorship contribution statement mousa hosseinimehr conceptualization methodology software formal analysis writing original draft janio piguave tomala methodology software cornelis vuik writing review editing supervision mohammed al kobaisi writing review editing hadi hajibeygi conceptualization methodology writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments many thanks are due towards the members of the darsim delft advanced reservoir simulation research group of tu delft for the useful discussions during the development of the pedfm on corner point grid geometry authors also thank dr barnaby fryer of epfl for proofreading the final version of the manuscript appendix mass and heat conservation for high enthalpy geothermal systems in this section the governing equations of the single component water two phase vapor liquid flow in high enthalpy geothermal systems are described due to the thermodynamic conditions the single component water can exist in either liquid and vapor steam phases in high enthalpy systems two sets of equations are considered i e the mass balance and the energy conservation equations each set of equations have two subsets for the two phases but are added together and form one set of equations for the entire system meaning one mass balance equation and one energy balance equation for all the phases expectedly in low enthalpy systems these equations are reduced to single phase a 1 mass balance equation mass balance for phase α for a system with n α phases reads 37 t ϕ α 1 n α ρ α s α m α 1 n α ρ α λ α p m i 1 n frac ρ α q α m w α 1 n α i 1 n frac ρ α q α m f i on ω m r n for the rock matrix m and 38 t a ϕ α 1 n α ρ α s α f i a α 1 n α ρ α λ α p f i i 1 n frac ρ α q α f i w α 1 n α ρ α q α f i m α 1 n α j 1 n frac ρ α q α f i f j j i on ω f i r n 1 for the discrete fracture f i with aperture a the superscripts m f i and w indicate the rock matrix the i th fracture and the wells respectively moreover ϕ is the medium porosity and λ α is the phase mobility i e λ α k r α μ α k where k r α and μ α are the phase α relative permeability and viscosity the term k is the rock absolute permeability which can be a full tensor in this work we only consider scalar permeability values i e k k i with i being the identity matrix moreover ρ α denotes the fluid density and s α refers to the saturation of phase α the fluid pressure p is one of the two primary unknowns and q α is the source term e g injection and production wells the saturation constraint requires summation of all phases to be equal to the unity i e α 1 n α s α 1 the terms q α m f i and q α f i m are the phase flux exchanges between the rock matrix m and the fracture f i and q α f i f j is the influx of phase α from the j th fracture to the i th fracture the mass conservation ensures that v q α m f i d v a f i q α f i m d a and a f i q α f i f j d a a f j q α f j f i d a hajibeygi et al 2011 the volumetric well fluxes are obtained via peaceman model peaceman 1978 both for matrix and fractures i e 39 q α m w w i λ α p w p m δ v 40 q α f i w w i λ α p w p f i δ a here w i denotes the well productivity index and λ is the effective mobility of each phase between the well and the perforating compartment in each medium and is obtained using upwind scheme in the discrete system for the rock matrix the control volume is defined as δ v and for the lower dimensional fracture the control area is defined as δ a the volumetric flux exchanges between the rock matrix and the fractures are similarly calculated as q α m f i c i m f i λ α p f i p m q α m f i c i f i m λ α p m p f i q α f i f j c i f i f j λ α p f j p f i where c i is the connectivity index and explained in the next section a 2 energy balance the energy balance equation for a high enthalpy multi phase flow system with the assumption of local equilibrium on the domain reads 41 t ρ u e f f m α 1 n α ρ α h α λ α p m λ e f f t m i 1 n frac ρ α h α q α m w α 1 n α i 1 n frac ρ α h α q α m f i i 1 n frac r m f i on ω m r n on the rock matrix m and 42 t a ρ u e f f f i a α 1 n α ρ α h α λ α p f i λ e f f t f i i 1 n frac ρ α h α q α f i w α 1 n α ρ α h α q α f i m α 1 n α i 1 n frac ρ α h α q α f i f j j i r f i m i 1 n frac r f i f j j i on ω f i r n 1 on the lower dimensional fracture f i in these of equations in addition to the previously defined parameters h α is the fluid enthalpy of phase α the term ρ u e f f indicates the effective internal energy per unit of mass and is calculated as 43 ρ u e f f ϕ α 1 n α ρ α s α u α 1 ϕ ρ r u r with u α and u r being the specific internal energy in fluid for each phase and rock respectively the dependent terms are nonlinear functions of the primary unknowns and are calculated using constitutive relations coats et al 1980 faust et al 1979 additionally λ e f f is the effective thermal conductivity written as 44 λ e f f m ϕ m α 1 n α s α λ α 1 ϕ m λ r λ e f f f i ϕ f i α 1 n α s α λ α 1 ϕ f i λ r here λ α and λ r are the thermal conductivities of phase α and rock respectively the conductive heat flux exchanges i e r m f i r f i m matrix fracture connectivities and r f i f j fracture fracture connectivities are calculated as r m f i c i m f i λ e f f t f i t m 45 r m f i c i f i m λ e f f t m t f i r f i f j c i f i f j λ e f f t f j t f i here λ e f f is the harmonic average between the two non neighboring compartments in the energy balance equation above two approaches exist for the choice of the primary unknowns on one hand the natural formulation employs pressure p and temperature t as the primary unknowns called as the p t formulation as well on the other hand the molar formulation can be used where the pressure p and the total fluid enthalpy h are considered as the primary unknowns also known as p h formulation the details for the choice of the primary unknown is available in the literature coats et al 1980 faust et al 1979 please note that the effects of both capillarity in case of a multiphase flow and gravity are neglected in all the equations a 3 discretization of the equations and the simulation strategy the discretization of the nonlinear equations is done using the finite volume method fvm the equations are discretized with a two point flux approximation tpfa finite volume scheme in space and a backward implicit euler scheme in time independent structured grids are generated for a three dimensional 3d porous rock and 2d fracture plates the discretization is done for each medium for a corner point grid geometry an illustration is presented in fig 4 a 3 1 mass and heat fluxes the coupled system of non linear equations eqs 37 38 and 41 42 is discretized by calculating the fluxes first the discrete mass fluxes need to be calculated the mass flux of the phase α between each two neighboring control volumes i and j inside one medium using the tpfa scheme can be written as 46 f α i j ρ α k r α μ α t i j p i p j here t i j a i j d i j k i j h denotes the transmissibility between the neighboring cells i and j a i j and d i j are the interface area and the distance between these two cell centers respectively the term k i j h is the harmonic average of the two permeabilities the superscript indicates that the corresponding terms are evaluated using a phase potential upwind scheme following the edfm and pedfm paradigms hajibeygi et al 2011 tene et al 2017 hosseinimehr et al 2018 the fluxes between a rock matrix cell i and a fracture cell j are modeled as 47 f α i j m f f α i j f m ρ α k r α μ α t i j m f p i m p j f in this equation t i j m f is the geometrical transmissibility in the mass flux between cell i belonging to the rock matrix m and the element j belonging to the fracture f and it reads 48 t i j m f k i j h c i i j m f in the equation above k i j h denotes the harmonically averaged permeability between the rock matrix and the overlapping fracture elements moreover c i i j m f is the connectivity index between the two mentioned overlapping elements the edfm and pedfm model the matrix fracture connectivity index as 49 c i i j m f a i j m f d i j with a i j m f being the area fraction of fracture cell j overlapping with the rock matrix cell i see fig 1 and d i j being the average distance between these two cells hajibeygi et al 2011 the computation of the connectivity index is identical for bot types of fractures either conductive or impermeable similarly the flux exchange between intersecting fracture elements i belonging to fracture f h and j belonging to fracture f k is modeled as 50 f α i j f h f k f α i j f k f h ρ α k r α μ α t i j f h f k p i f h p j f k here t i j f h f k is the geometrical transmissibility in the mass flux between element i in the fracture f h and the element j in the fracture f k which reads 51 t i j f h f k a k i j h c i i i i j f h c i j i i j f k c i i i i j f h c i j i i j f k please note that the geometrical transmissibility t i j f h f k between the two non neighboring intersecting fracture cells is obtained on a lower dimensional formulation this is needed due to the fact that the intersection between two 2d fracture plates forms a line segment and the intersection between two 1d fracture line segments results in a point fig 1 on the right visualizes an example of an intersection between two non neighboring 2d fracture elements the result of the intersection is a line segment i i j colored in red with the average distances from the intersection segment written as d i i i j f h d j i i j f k this is the reason why these transmissibilities are computed using a harmonic average formulation as shown above at next the convective and conductive heat fluxes are calculated the convective heat flux exchange between the neighboring control volumes i and j for each phase α reads 52 f α i j ρ α h α μ α t i j p i p j here h α is the enthalpy of phase α in fluid determined at the interface between grid cells i and j conclusively f α i j h α f α i j the convective heat flux exchange between non neighboring elements can be obtained via multiplication of their mass flux exchange f α i j by the effective phase enthalpy h α determined at the intersection of two overlapping elements i e f α i j h α f α i j the conductive heat flux between two neighboring cells i and j belonging to one medium is written as 53 g i j t c o n d i j t i t j where t c o n d i j a i j d i j λ e f f i j h is the transmissibility between grid cells i and j a i j d i j and λ e f f i j h are the interface area the distance from the cell centers and the harmonic average of the effective conductivity set at the interface between grid cells i and j respectively please note that the effective conductivity is calculated via eq 44 the conductive heat flux exchange between non neighboring elements i and j is obtained as 54 g i j m f g i j f m t c o n d i j m f t i m t j f for matrix fracture connectivities and 55 g i j f h f k g i j f h f k t c o n d i j f h f k t i f h t j f k for fracture fracture connectivities the conductive heat transmissibilities for matrix fracture t c o n d i j m f and fracture fracture t c o n d i j f h f k connectivities are explained later in this section a 3 2 coupling and linearization of the nonlinear equations taking the calculated fluxes above into account the discrete mass balance equations can be written in their residual form as 56 r m b i n 1 m α 1 n p h ρ α q α m w i ϕ α 1 n p h ρ α s α i n 1 ϕ α 1 n p h ρ α s α i n δ t m α 1 n p h j 1 n n f α i j m α 1 n p h k 1 n frac j 1 n f k f α i j m f k i 1 n m for element i in matrix m and 57 r m b i n 1 f h α 1 n p h ρ α q α f h w i a ϕ α 1 n p h ρ α s α i n 1 a ϕ α 1 n p h ρ α s α i n δ t f h α 1 n p h j 1 n n f α i j f h α 1 n p h j 1 n f k f α i j f h m α 1 n p h k 1 n frac j 1 n f k f α i j f h f k i 1 n f h for element i in fracture f h additionally the discrete energy balance equations are also rewritten as 58 r e b i n 1 m α 1 n p h ρ α h α q α m w i ρ u e f f i n 1 ρ u e f f i n δ t m α 1 n p h j 1 n n f α i j m α 1 n p h k 1 n frac j 1 n f k f α i j m f k j 1 n n g i j m k 1 n frac j 1 n f k g i j m f k i 1 n m for element i in matrix m and 59 r e b i n 1 f h α 1 n p h ρ α h α q α f h w i ρ u e f f i n 1 ρ u e f f i n δ t f h α 1 n p h j 1 n n f α i j f h α 1 n p h j 1 n m f α i j f h m α 1 n p h k 1 n frac j 1 n f k f α i j f h f k j 1 n n g i j f h j 1 n m g i j f h m k 1 n frac j 1 n f k g i j f h f k i 1 n m for element i in fracture f h the full residual vector for each of the mass balance and energy balance equations can be written as r n r m n r f 1 n r f n frac n t and where r k n is the residual vector of medium k at time step n p n is the vector of the pressure unknowns depending on the flow model i e the number of the phases and the thermal conditions the second primary unknown is either the saturation of the injecting phase s the temperature t or the total fluid enthalpy h for a multi phase flow model in high enthalpy systems the second primary unknown is the total fluid enthalpy with the term h n indicating the vector of the total fluid enthalpy unknowns at time step n the residual at time step n 1 namely r n 1 is a non linear function of the primary unknowns p n 1 and h n 1 therefore at every time step a newton raphson method is used to solve the non linear system iteratively i e 60 r m b ν 1 r m b ν r m b p ν δ p ν 1 r m b h ν δ h ν 1 0 r e b ν 1 r e b ν r e b p ν δ p ν 1 r e b h ν δ h ν 1 0 where ν and ν 1 superscripts denote the current and the next iteration indices at every newton s iteration step the linear system j ν δ x ν 1 r ν is solved in this notation j ν is the jacobian matrix with δ x ν 1 δ p δ h t therefore the linear system of the equations can be re illustrated as 61 j m b p m m j m b p m f j m b p f m j m b p f f j m b h m m j m b h m f j m b h f m j m b h f f j e b p m m j e b p m f j e b p f m j e b p f f j e b h m m j e b h m f j e b h f m j e b h f f ν j ν δ p m δ p f δ h m δ h f ν 1 δ x ν 1 r m b m r m b f r e b m r e b f ν r ν the convergence at each iteration loop is reached by satisfying the following conditions i e 62 r m b ν 1 2 r m b 0 2 ε r m b r m b ν 1 2 r h s m b 2 ε r m b r e b ν 1 2 r e b 0 2 ε r e b r e b ν 1 2 r h s e b 2 ε r e b δ p 2 p 2 ε p δ h 2 h 2 ε t here each threshold ε x is a user defined tolerance set initially as input at the beginning of the simulation notations r 2 and x 2 are the second norm of the vectors of the residuals and the update of the unknowns the superscript 0 denotes the value of its corresponding vector at the initial state of the iteration step please note that in some systems the condition r ν 1 2 r h s 2 ε r can result in a better convergence when compared to r ν 1 2 r 0 2 ε r and vice versa therefore both conditions are checked and either of them can implicate the convergence signal 
225,we present the projection based embedded discrete fracture model pedfm for hexahedral corner point grid cpg geometries for the simulation of hydrothermal processes in fractured porous media unlike the previously developed pedfm for structured box grids our new development allows for the modeling of complex geometries defined with hexahedral cpg cells it also advances the pedfm method to include coupled flow and heat transfer systems mass and energy conservation equations are simulated in a fully coupled manner using a fully implicit fim integration scheme this allows for stable simulations specially when large time steps are taken independent corner point grids are imposed on the rock matrix and all fractures with conductivities ranging from highly permeable to flow barriers the connectivities between the non neighboring grid cells are described such that a consistent discrete representation of the embedded fractures occurs within the corner point grid geometry specially as the quadrilateral interfaces are allowed to be fully flexible various numerical tests including geologically relevant and real field models which are established in the literature are conducted to demonstrate the applicability of the developed method it is shown that pedfm can accurately capture the physical influence of both highly conductive fractures and flow barriers on the flow and heat transfer fields in complex reservoir geometries this development is promising for flow simulations of real field geo models increasing the discretization flexibility and enhancing the computational performance for capturing explicit fractures accurately keywords flow in porous media fractured porous media corner point grid geological formations embedded discrete fracture model heterogeneous geological properties 1 introduction for successful development of a variety of geo engineering applications related to geo energy e g hydrocarbon and geothermal production and storage e g co2 storage and hydrogen storage a detailed understanding of fluid mass and heat transport in porous rocks is essential to achieve this accurate and efficient simulation of mass and heat transfer in the subsurface geological formation plays a crucial role computer models and their resulting estimation of the dynamic processes contribute to efficient and safe operations in the production or storage facilities for any of the above listed applications simulation results provide valuable insights into the optimization of hydrocarbon extractions jansen et al 2005 the energy production outlines and the life time of geothermal systems osullivan et al 2001 axelsson et al 2003 burnell et al 2012 2015 the practical capacities that can be offered by the underground formations to store co 2 eiken et al 2011 class et al 2009 harris et al 2021 wang et al 2021 ruprecht et al 2014 or hydrogen anon 2021 heinemann et al 2021 and many more however while modeling subsurface flow the geo engineering community faces a number of key challenges the geological formations are often large scales in nature while they are located only a few kilometers deep in the subsurface crust and have a thickness of hundreds if not tens of meters their areal extents can easily be in orders of kilometers in order to reflect the geological and geometrical properties of the subsurface accurately high resolution computational grids are often imposed on the domain this results in significant computational complexity which makes it impossible to run the computer models using conventional methods moreover strong spatial heterogeneity contrasts are observed between various physical and chemical properties in the formations these heterogeneities affect the flow and transport properties of the rock i e storage capacity and conductivity across several orders of magnitude the discretization of the governing partial differential equations or pdes results in ill conditioned linear systems of equations creating challenges for the numerical solution schemes applied to solve such heterogeneous systems in addition the measurement of the heterogeneous properties several kilometers beneath the subsurface involves a great deal of uncertainty in order to minimize the impact of such uncertainties instead of one realization hundreds if not thousands of realizations are created in the context of uncertainty quantification uq and a large number of simulations have to be run thus the complexity of the system can have a huge impact on providing predictions on a reasonable time scale furthermore geological formations are often defined with complex geometry and stratigraphy using cartesian grid geometry even though it allows for simpler conceptual modeling analyses can result in oversimplified and inaccurate predictions in addition the presence of faults and fractures has significant effects on fluid and heat flow patterns through the subsurface formations the heterogeneity contrasts in the length scales and conductivities caused by these complex networks of fractures and faults can cause extreme challenges in solving the linear systems using numerical methods gan and elsworth 2016 gholizadeh doonechaly et al 2016b salimzadeh et al 2019 moreover the strong coupling of mass and heat transport results in severe non linearity which negatively impacts the stability and convergence in the system in case of multi phase flow e g high enthalpy geothermal systems these issues become more drastic wong et al 2018 the elastic and plastic deformations in the geo mechanical interactions rossi et al 2018 garipov et al 2016 gholizadeh doonechaly et al 2016a reactive transport e g geo chemical interaction between the substances morel and morgan 1972 leal et al 2017 salimzadeh and nick 2019 and compositional alterations in the fluid and rock are among the list of other noteworthy challenges therefore there is a high demand for developing advanced simulation methods that are computationally efficient and scalable yet accurate at the desired level consequently the development of a reliable computer model for simulation of subsurface flow and transport in fractured porous media is critical to address the challenges in practical applications as a result many advanced numerical methods have been developed to represent the real field geological formations accurately instead of using cartesian grids more complex and flexible gridding structures are needed as these formations are more conveniently represented by flexible grids lie et al 2020 reichenberger et al 2006 the grid geometry should create a set of discrete cell volumes that approximate the reservoir volume yet fit the transport process physics and avoid over complications as much as possible ahmed et al 2015 unstructured grids allow for many flexibilities which need to be carefully applied to a computational domain so that the discrete systems do not become over complex karimi fard et al 2004 jiang and younis 2016 without introducing the full flexibility and at the same time complexity of the fully unstructured grids the corner point grid cpg geometry allows for many possibilities with better representation of the geological structures this has made cpg attractive in the geoscience industry grade simulations ponting 1989 ding and lemonnier 1995 geoquest 2014 lie 2019 fractures have often small apertures size of millimeters but pose a serious impact on flow patterns due to large contrast of permeability between fractures and their neighboring rock matrix berkowitz 2002 kumar et al 2020 therefore consistent representation of these geological features is important in predicting the flow behavior using numerical simulations berkowitz 2002 different approaches have been proposed to model the effect of fractures on flow patterns to avoid direct numerical simulation dns and thereby imposing extremely high resolution grids on the length scales of fracture apertures it is possible to upscale fractures by obtaining averaged and effective properties e g permeability between fractures or faults and the hosting rock also known as the rock matrix this introduces a porous media representation without fractures but with approximated conductivities however such models raise concerns about the inaccuracy of the simulation results due to the employed excessively upscaled parameters especially in presence of high conductivity contrasts between the matrix and fractures therefore two distinct methods have been introduced in fracture modeling approaches the so called dual continuum models also known as dual porosity or dual porosity dual permeability warren and root 1963 barenblatt et al 1983 kazemi et al 1996 and the discrete fracture model dfm dietrich et al 2005 in the dual porosity method the matrix plays the role of fluid storage and the fluid only flows inside the fractures as it is assumed that there is no direct connection between the matrix cells in the dual porosity dual permeability method both matrix and fracture have connections both dual porosity and dual porosity dual permeability models homogenize the fracture domain in a computing block and neglect specific fracture features such as orientation and size dfm on the other hand considers fractures as a separate system in a lower dimensional domain than that of the rock matrix and couples them through a flux transfer function in 2 d domains the fractures are represented by 1 d line segments and in 3 d domains each fracture is modeled by a 2 d plane segment dfm methods have been developed and evolved quite significantly during the past several years see e g karimi fard et al 2004 lee et al 1999 2001 li and lee 2008 ahmed et al 2015 geiger boschung et al 2009 karvounis 2013 reichenberger et al 2006 moinfar et al 2014 fumagalli et al 2016 and the references therein two different dfm approaches have been presented in the literature the embedded dfm edfm and the conforming dfm cdfm flemisch et al 2018 li and voskov 2021 moinfar et al 2013 the main difference between these two techniques resides in the flexibility to the grid geometry shah et al 2016 in cdfm the fracture elements are located at the interfaces between the unstructured matrix grid cells sandve et al 2012 the effect of the fractures is represented by modifying transmissibilities at those interfaces therefore there is an accurate consideration of flux transfer between the matrix and the fractures karimi fard et al 2004 reichenberger et al 2006 ahmed et al 2015 however for highly dense fracture networks the number of matrix grid cells should be very high with very fine grid cells close to the fracture intersections to account for the fractures in addition in case of fracture generation and propagation the matrix grid has to be redefined at various steps of the simulation which reduces the efficiency of such an approach all of these complexities can limit the application of cdfm in real field applications in edfm fractures are discretized separately and independently from the matrix on a lower dimensional domain by using non conforming grids lee et al 1999 li and lee 2008 once the grid cells are created and the discretization is finished the fractures and matrix are coupled together using conservative flux transfer terms that calculate the flow between each fracture element and its overlapping neighbors hajibeygi et al 2011 hosseinimehr et al 2018 xu and sepehrnoori 2019 having two independent grids allows for the modeling of complex fracture networks with simpler grids for the matrix while edfm can provide acceptable results for highly conductive fractures it cannot accurately represent flow barriers such as non conductive fractures and sealing faults to resolve this limitation projection based edfm pedfm was introduced for the first time by tene et al 2017 and extended to multilevel multiscale framework in a fully 3d cartesian geometry hosseinimehr et al 2020 pedfm provides consistent connectivity values between the rock matrix and the fractures and thus can be applied to fractured porous media with any range of conductivity contrasts between the rock and the fractures either highly conductive or impermeable the original pedfm concept tene et al 2017 has been applied to more geoscientific applications e g in jiang and younis 2017 in this work the projection based embedded discrete fracture model pedfm on the corner point grid cpg geometry is presented to cover a more general application criteria different flow environments are considered i e multiphase fluid flow model isothermal in fractured porous media and single phase coupled mass heat flow in low enthalpy fractured geothermal reservoirs the finite volume method fvm is used for discretization of the continuum domain to represent realistic and geologically relevant domains the corner point grid geometry is used the sets of nonlinear equations are coupled using fully implicit fim coupling strategy the flux terms in the mass and energy conservation equations are discretized with an upwind two point flux approximation tpfa in space and with a backward implicit euler scheme in time the pedfm is employed in order to explicitly and consistently represent fractures and to provide computational grids for the rock matrix and the fractures independently regardless of the complex geometrical shape of domain here the applicability of the pedfm implementation tene et al 2017 hosseinimehr et al 2020 has been extended to include fractures with generic conductivity contrasts either highly conductive or impermeable with any positioning and orientation on the corner point grid geometry this matter is paramount for practical field scale applications in addition to geometrical flexibility of edfm the matrix matrix and fracture matrix connectivities are altered to consider the projection of fractures on the interfaces of matrix grid cells using various synthetic and geologically relevant real field models the performance of the pedfm on the corner point grid geometry is shown this article is structured as follows first the governing equations are described in section 2 the discretization and simulation strategy are explained in appendix a 3 in section 4 the corner point grid geometry and calculation of the transmissibilities are briefly covered the pedfm approach for the corner point grid geometry is presented in section 5 the test cases and the numerical results are shown in section 6 at last the paper is concluded in section 7 2 governing equations in this section the governing equations of the isothermal multiphase flow is revisited in order to improve the readability the governing equations for single component water two phase vapor liquid coupled mass heat transport in geothermal systems are presented in the appendix mass conservation in porous media for phase α in the absence of mass exchange between the phases capillary and gravitational effects with n frac explicit fractures is given as 1 t ϕ ρ α s α m ρ α λ α p m ρ α q α m w i 1 n frac ρ α q α m f i on ω m r n for the rock matrix m and 2 t a ϕ ρ α s α f i a ρ α λ α p f i ρ α q α f i w ρ α q α f i m j 1 n frac ρ α q α f i f j j i on ω f i r n 1 i 1 n frac for the lower dimensional fracture f i with aperture a there exist n α phases moreover the superscripts m f and w in eqs 1 2 indicate respectively the rock matrix the fractures and the wells here ϕ is the porosity of the medium ρ α s α λ α are the density saturation and mobility of phase α respectively in addition λ k r α μ α k holds where k r μ and k are phase relative permeability viscosity and rock absolute permeability tensor respectively also q α is the phase source term i e wells finally q α m f i and q α f i m are the phase flux exchanges between matrix and the i th fracture whereas q α f i f j represents the influx of phase α from j th fracture to the i th fracture note that the mass conservation law enforces v q α m f i d v a f i q α f i m d a and a f i q α f i f j d a a f j q α f j f i d a the peaceman well model peaceman 1978 is used to obtain the well source terms of each phase for the rock matrix as 3 q α m w w i λ α p w p m δ v and for the fractures as 4 q α f i w w i λ α p w p f i δ a here w i denotes the well productivity index and λ α is the effective mobility of each phase λ k r α μ α k between the well and the grid cell penetrated by the well in each medium in the discrete system for the rock matrix the control volume is defined as δ v and in the discrete system for the fracture the control area is written as δ a the flux exchange terms q α m f i q α f i m matrix fracture connectivities and q α f i f j fracture fracture connectivities are written as q α m f i c i m f i λ α p f i p m 5 q α m f i c i f i m λ α p m p f i q α f i f j c i f i f j λ α p f j p f i where c i indicates the connectivity index between each two non neighboring elements see eq 49 eqs 1 2 subject to proper initial and boundary conditions form a well posed system for n α unknowns once the α 1 n α s α 1 constraint is employed to eliminate one of the phase saturation unknowns here this system of equations is solved for a two phase flow fluid model with the primary unknowns of p and s 1 from now on indicated as s please note that the effects of both capillarity in case of a multiphase flow and gravity are neglected in all the equations 3 discretization of the equations and the simulation strategy the discretization of the nonlinear equations is done using the finite volume method fvm the equations are discretized with a two point flux approximation tpfa finite volume scheme in space and a backward implicit euler scheme in time independent structured grids are generated for a three dimensional 3d porous rock and 2d fracture planes the discretization is done for each medium for a corner point grid geometry an illustration is presented in fig 4 the coupled system of non linear equations 1 2 is discretized by calculating the fluxes the advective tpfa flux of phase α between control volumes i and j reads 6 f α i j ρ α k r α μ α t i j p i p j here t i j a i j d i j k i j h denotes the transmissibility between the neighboring cells i and j a i j and d i j are the interface area and the distance between these two cells centers respectively the term k i j h is the harmonic average of the two permeabilities the superscript indicates that the corresponding terms are evaluated using a phase potential upwind scheme following the edfm and pedfm paradigms hajibeygi et al 2011 tene et al 2017 hosseinimehr et al 2018 the fluxes between a matrix cell i and a fracture cell j are modeled as 7 f α i j m f f α i j f m ρ α k r α μ α t i j m f p i m p j f in this equation t i j m f is the geometrical transmissibility in the mass flux between cell i belonging to the rock matrix m and the element j belonging to the fracture f i and it reads 8 t i j m f k i j h c i i j in the equation above k i j h denotes the harmonically averaged permeability between the rock matrix and the overlapping fracture elements moreover c i i j m f is the connectivity index between the two overlapping elements the edfm and pedfm model the matrix fracture connectivity index as 9 c i i j m f a i j m f d i j with a i j m f being the area fraction of fracture cell j overlapping with matrix cell i see fig 1 on the left and d i j being the average distance between these two cells hajibeygi et al 2011 similarly the flux exchange between intersecting fracture elements i belonging to fracture f i and j belonging to fracture f j is modeled as 10 f α i j f i f j f α i j f j f i ρ α k r α μ α t i j f i f j p i f i p j f j here t i j f i f j is the geometrical transmissibility in the mass flux between element i in the fracture f i and the element j in the fracture f j which reads 11 t i j f i f j k i j h c i i i i j f i c i j i i j f j c i i i i j f i c i j i i j f j please note that the geometrical transmissibility t i j f i f j between the two non neighboring intersecting fracture cells is obtained on a lower dimensional formulation this is needed due to the fact that the intersection between two 2d fracture plates forms a line segment and the intersection between two 1d fracture line segments results in a point fig 1 on the right visualizes an example of an intersection between two non neighboring 2d fracture elements the result of the intersection is a line segment i i j colored in red with the average distances from the intersection segment written as d i i i j f i d j i i j f j this is the reason why these transmissibilities are computed using a harmonic average formulation as shown above thus at each time step the following system of equations is solved 12 ϕ ρ α s α i n 1 ϕ ρ α s α i n δ t m j 1 n n f α i j m k 1 n frac j 1 n f k f α i j m f k ρ α q α i m w i 1 n m in the matrix and 13 a ϕ ρ α s α i n 1 a ϕ ρ α s α i n δ t f h j 1 n n f α i j f h j 1 n m f α i j f h m k 1 n frac j 1 n f k f α i j f h f k ρ α q α i f h w i 1 n f h in each fracture f h here n m and n f k are the number of cells in the matrix and number of the cells in fracture f k respectively n n indicates the number of neighboring cells 2 in 1d 4 in 2d 6 in 3d eqs 12 13 can be written in residual form as 14 r α i n 1 m ρ α q α i m w ϕ ρ α s α i n 1 ϕ ρ α s α i n δ t m j 1 n n f α i j m k 1 n frac j 1 n f k f α i j m f k i 1 n m for the rock matrix and 15 r α i n 1 f h ρ α q α i f h w a ϕ ρ α s α i n 1 a ϕ ρ α s α i n δ t f h j 1 n n f α i j f h j 1 n m f α i j f h m k 1 n frac j 1 n f k f α i j f h f k i 1 n f h for fracture f h let us define r n r m n r f 1 n r f n frac n t where r k n is the residual vector of medium k at time step n similarly p n and s n indicate the vectors of pressure and saturation unknowns of all media the residual r n 1 is a non linear function of the primary unknowns p n 1 and s n 1 thus at each time step a newton raphson method is employed to solve the non linear system iteratively i e 16 r α ν 1 r α ν r α p ν δ p ν 1 r α s ν δ s ν 1 where the superscript ν is the iteration index consequently at each newton s iteration the linearized system j ν δ x ν 1 r ν is solved here j ν is the jacobian matrix with δ x ν 1 δ p δ s t therefore assuming two phases the indices 1 and 2 representing the equations of the first and the second phases respectively the linear system of equations can be written as 17 j 1 p m m j 1 p m f j 1 p f m j 1 p f f j 1 s m m j 1 s m f j 1 s f m j 1 s f f j 2 p m m j 2 p m f j 2 p f m j 2 p f f j 2 s m m j 2 s m f j 2 s f m j 2 s f f ν j ν δ p m δ p f δ s m δ s f ν 1 δ x ν 1 r 1 m r 1 f r 2 m r 2 f ν r ν in this formulation non linear convergence is reached when the following conditions are satisfied 18 r 1 ν 1 2 r 1 0 2 ε r 1 r 1 ν 1 2 r h s 1 2 ε r 1 r 2 ν 1 2 r 2 0 2 ε r 2 r 2 ν 1 2 r h s 2 2 ε r 2 δ p 2 p 2 ε p δ s 2 s 2 ε s here ε r 1 ε r 2 ε p and ε s are the user defined tolerances that are set initially as input at the beginning of the simulation the notation x 2 is the second norm of the vector x the superscript 0 denotes the value of its corresponding vector at the initial state of the iteration step please note that in some systems the condition r ν 1 2 r h s 2 ε r can result in a better convergence when compared to r ν 1 2 r 0 2 ε r and vice versa therefore both conditions are checked and either of them can implicate the convergence signal 4 corner point grid geometry a corner point grid cpg is defined with a set of straight pillars outlined by their endpoints over a cartesian mesh in the lateral direction lie 2019 on every pillar a constant number of nodes corner points is set and each cell in the grid is set between 4 neighboring pillars and two neighboring points on each pillar every cell can be identified by integer coordinates i j k where the k coordinate runs along the pillars and i and j coordinates span along each layer the cells are ordered naturally with the i index x axis cycling fastest then the j index y axis and finally the k index negative of z direction for establishing vertical and inclined faulting more accurately it is advantageous to define the position of the grid cell by its corner point locations and displace them along the pillars that have been aligned with faults surfaces similarly for modeling the erosion surfaces and pinch outs of geological layers the corner point format allows points to collapse along coordinate lines the corner points can collapse along all four lines of a pillar so that a cell completely disappears in the presence of erosion surfaces if the collapse is present in some pillars the degenerate hexahedral cells may have less than six faces this procedure creates non matching geometries and non neighboring connections in the underlying i j k topology lie 2019 fig 2 illustrates the steps in the construction of the corner point grids as explained above 4 1 two point flux approximation in the corner point grid geometry in order to only highlight the calculation of the two point flux approximation in the corner point grid geometry and avoid complexities in presenting fully detailed governing equations a simplified linear elliptic equation is used which serves as a model pressure equation for incompressible fluids i e 19 u f where f is the source sink term wells and u is the darcy velocity defined as 20 u k p finite volume discrete systems can be obtained by rewriting the equation in integral form on discrete cell ω i as 21 ω i u n d s ω i q d x the flux between the two neighboring cells i and k can be then written as 22 u i k γ i k u n d s the faces γ i k are denominated half face as they are linked with a grid cell ω i and a normal vector n i k it is assumed that the grid matches with another one so that each interior half face will have a twin half face γ k i that has an identical area a i k a k i but an opposite normal vector n i k n k i the integral over the cell face is approximated by the midpoint rule and darcy s law i e 23 u i k a i k k p x i k n i k where x i k indicates the centroid of γ i k the one sided finite difference is used to determine the pressure gradient as the difference between the pressure π i k at the face centroid and the pressure at some point inside the cell the reconstructed pressure value at the cell center is equal to the average pressure p i inside the cell thus 24 u i k a i k k i p i π i k c k i c k i 2 n i k u i k t i k p i π i k the vectors c k i are defined from cell centroids to face centroids as shown in fig 3 face normals are assumed to have a length equal to the corresponding face areas a i k n i k i e 25 t i k a i k k i c k i n i k c k i 2 the one sided transmissibilities t i k are related to a single cell and provide a two point relation between the flux across a cell face and the pressure difference between the cell and face centroids the proper name for these one sided transmissibilities is half transmissibilities as they are associated with a half face karimi fard et al 2004 bosma et al 2017 finally the continuity of fluxes across all faces u i k u k i as well as the continuity of face pressures π i k π k i π i k are set this leads to 26 t i k 1 u i k p i π i k 27 t k i 1 u i k p k π i k the interface pressure π i k is then eliminated and the two point flux approximation tpfa scheme is defined as 28 u i k t i k 1 t k i 1 1 p i p k t i k p i p k t i k is the transmissibility associated with the connection between the two cells the tpfa scheme uses two points the cell averages p i and p k to approximate the flux across the interface γ i k between cells ω i and ω k the tpfa scheme in a compact form obtains a set of cell averages that meet the following system of equations 29 k t i k p i p k q i ω i ω 5 pedfm for the corner point grid geometry in this section pedfm for the corner point grid cpg geometry is described note that this development considers only convex hexahedral cpg geometries with planar faces however in some field relevant geo models some interfaces may not be planar for example the model illustrated in fig 4 and the grid cells illustrated in fig 5 have some non planar faces to obtain the matrix fracture intersections in the presence of non planar matrix grid interfaces the pedfm procedure approximates the non planar interface with a planar interface this approximation is explained further in this section note that the planar fractures can have any orientation in 3d with arbitrary crossing lines with other fractures as stated in the section for the discretization of the governing equations sets of flux exchange terms are defined between the matrix and the explicit fractures inside each term the connectivity index c i i j a i j d i j is considered in the corner point grid geometry to calculate the area fraction a i j of each overlapping fracture element inside the corresponding matrix grid cell various geometrical functions are defined which can obtain the intersection between a quadrilateral the 2d planar fracture grid cell in 3d geometry and a hexahedron the matrix grid cell in the corner point grid geometry at first the matrix grid cells that are overlapped by each element of each fracture need to be detected to achieve this the matrix cell with the shortest distance to the fracture element is detected the distance is calculated between the matrix cell center point and the corners of the fracture element in a loop it is checked whether the quadrilateral fracture element intersects with any of the quadrilateral faces of that hexahedral matrix cell the fracture matrix intersection points are then ordered counter clockwise and a polygon is formed from the intersection points various geometrical possibilities exist with regards to the intersection points and the polygons generated by them more precisely if only one or two intersection points are obtained there is no polygon generated as such no area can be defined by the points i e the intersection is a line or a single point thus zero surface area alternatively if between three to six intersection points are detected one can form a polygon with them either a triangle a quadrilateral a pentagon or a hexagon the area of the polygon i e a i j is then calculated by triangulation procedure once the area is calculated the average distance between the fracture plate and the overlapped matrix grid cell i e d i j is computed for this purpose since complex geometries are considered a numerical approach is developed this numerical approach imposes a set of equidistant points within the hexahedral matrix grid cell the distance of each point to the fracture plate is then calculated finally the distances for all numerical points are then averaged and assigned to d i j value having the area of the polygon and this average distance the connectivity index is then calculated afterwards using a flood fill search algorithm newman 1979 all the matrix grid cells that are overlapped by the mentioned fracture elements are detected and their connectivity indices are calculated this procedure is done for each fracture element of each fracture plate the flood fill search algorithm ensures computational efficiency by avoiding unnecessary checks on the matrix grids that are not in the vicinity of the fracture element the algorithm above is performed on the computational cpg geo model assuming all matrix grid interfaces are planar however as mentioned before field relevant models could entail some non planar interfaces to employ our pedfm cpg in these scenarios the developed algorithm applies approximate pedfm connectivities for those non planar interfaces more precisely prior to obtaining the intersection points between matrix and fracture elements the non planar interfaces are approximated into planar interfaces to achieve this the middle point of the non planar interface is acquired via arithmetic averaging of the coordination of the four corners this middle point together with the normal vector of the corresponding interface are used to formulate the equation of a planar quadrilateral that best fits this interface this planar interface is then used to detect and realize the intersection points within the pedfm algorithm it is also worth mentioning that the approximation of non planar interfaces into planar quadrilateral plane segments results in slight in many cases negligible volume shifts of the hexahedral grid cells between neighboring cells of the interface note that as any volume shift in one grid cell is followed by identical volume shift with opposite sign in the other neighboring grid cell hence this approximation remains strictly mass conservative moreover such approximation is primarily local for each non planar interface and as such remains much smaller than the fine scale grid cell size in each direction however it allows for the major flexibility of having the developed pedfm also applicable to non planar matrix interfaces the first step in the development of the pedfm for the corner point grid geometry is to flag all the interfaces between the matrix cells that a fracture plate interrupts the connection between their cell centers to detect the affected interfaces first the list of all the matrix grid cells that are overlapped by a fracture element is considered in a loop for each overlapped matrix grid cell a line segment that connects the cell center of the mentioned matrix grid cell and the cell center of each of its neighboring cells is defined if the fracture plate intersects the line segment the interface between the two neighboring matrix grid cells is affected by the crossing fracture therefore a projection of the fracture element is obtained on the affected interface in fig 6 the fracture element f is assumed to overlap with the matrix grid cell ω i with an area fraction of a i f a set of projections is defined on the interfaces between the overlapped matrix grid cell ω i and its neighboring grid cells that are affected by the crossing i e ω j and ω k for the interface between grid cells ω i and ω j denoted as γ i j the projection area fraction a i f γ i j is obtained via 30 a i f γ i j a i f cos γ here γ is the angle between the fracture element f and the interface γ i j connecting the matrix grid cell ω i and the neighboring grid cell in this example ω j on the zoomed in section of fig 6 this projection area fraction is highlighted in red similarly the projection area fractions on the interfaces between all the neighboring matrix grid cells that are intersected by fracture elements are calculated based on the same formulation thereafter a continuous projection path shown in fig 6 as solid lines in light blue color is obtained on the interfaces this projection path disconnects the connections between the neighboring cells on both sides of this path thus allowing a non parallel and consistent flux exchange i e through matrix fracture matrix after obtaining the projection areas a set of new transmissibilities are defined to provide connection between the fracture element f and each non neighboring matrix grid cell i e j and k in the example shown in figure 6 31 t i e f a i f γ i j d i e f λ i e f with d i e f defined as the average distance between the fracture element f and matrix grid cell i e and λ i e f being the effective fluid mobility between these two cells therefore the transmissibility between the matrix grid cell i and its corresponding neighboring cells is re adjusted as 32 t i i e a i i e a i f γ i j δ x e λ i e f these transmissibilities are modified via multiplication of a factor denoted as α and defined as a fraction of the projection area divided by the total area of that interface as the following 33 α a i f γ i j a i i e as an example if half of an interface area between two cells is covered by the projection of a fracture cell the alpha factor for that interface will be α 0 5 the transmissibilities are modified via 34 t i i e t i i e 1 α one should consider that due to the continuation of a fracture plate for all the overlapping fracture elements except for the boundaries of the fractures the projections will cover the entire area of the affected interfaces this means that α is 1 0 for most of the cases therefore to simplify the implementation all the non zero α factors are modified to be 1 0 forcing full projections from the boundaries of the fractures on the affected interfaces algorithm 1 describes the pedfm procedure for the corner point grid geometry where the steps explained above are pointed step by step 6 simulation results numerical results of various test cases are presented in this section the first two test cases compare the pedfm model on the cartesian grid geometry with the pedfm on the corner point grid geometry the third test case demonstrates the pedfm result on a non orthogonal grid model thereafter we move towards a series of geologically relevant fields using the pedfm on the corner point grid geometry a number of synthetic highly conductive fractures and impermeable flow barriers are added to the geologically relevant models the computational performance of this method will not be benchmarked as the purpose of these simulation results is to demonstrate the pedfm on the corner point grid geometry as a proof of concept tables 1 and 2 show the mutual input parameters that are used for the test cases with the isothermal multiphase and the geothermal single phase flow models respectively 6 1 test case 1 2d heterogeneous fractured reservoir square in this test case the pedfm on the cartesian grid is compared with the corner point grid geometry for this reason a box shaped heterogeneous 100 m 100 m domain containing 30 fractures with mixed conductivities is considered the length of each fracture is different but the size of their aperture is identical and set to a f 5 1 0 3 m a 136 136 grid is imposed on the rock matrix and the fracture network consists of 1024 grid cells in total 19520 cells the permeability of the matrix ranges from k m m i n 1 2 1 0 15 m 2 to k m m a x 1 2 1 0 12 m 2 and the permeability of the fracture network has the range of k f m i n 1 0 22 m 2 and k f m a x 1 0 6 m 2 two injection wells are located at the bottom left and top left corners with an injection pressure of p inj 2 1 0 7 pa additionally there are two production wells at the bottom right and the top right corners with a pressure of p prod 1 1 0 7 pa table 2 demonstrates the input parameters of this test case fig 7 shows the results of the simulation using both cartesian grid and corner point geometry note that in this test case and the test case 2 the x y z coordinates of the grids of the cartesian geometry and the corner point grid geometry are identical however the grids are generated with different geometrical approaches in one scenario the grid cells are discretized using the cartesian grid geometry and the grid cells are indexed in every of the x y z directions i 1 n x j 1 n y k 1 n z for this scenario the pedfm for the cartesian grid is used which has already been developed tene et al 2017 in the other scenario the grid cells are generated using the corner point grid geometry where a list of nodes and a list of all the interfaces and transmissibilities are generated the pedfm for the corner point grid geometry that is developed in this work is used for this scenario therefore the size and positioning of the grid cells in the two scenarios are identical though have been generated with different geometrical approaches the results of the both scenarios show a match visually in order to quantify the difference between the results of the two different geometrical approach for the pedfm a average relative error in second norm is calculated for the pressure and the saturation distributions over the entire simulation time this relative error for each variable x is calculated as 35 e x x cart x cpg 2 x cart 2 where x is a solution vector of either of the main unknowns and the subscripts cart and cpg indicate cartesian grid and the corner point grid geometry the errors calculated for this test case are e p 1 55 1 0 5 and e s 1 60 1 0 4 6 2 test case 2 3d homogeneous fractured reservoir box these test cases similar to the test case 1 show a comparison for the pedfm on the cartesian grid versus the corner point grid geometry a 3d 100 m 100 m 40 m domain containing 15 lower dimensional fractures with different geometrical properties is considered a 50 50 20 grid is imposed on a rock matrix the fracture network contains 1005 grid cells total of 51005 grid cells the rock matrix has a permeability of k m 1 0 14 m 2 the fracture network consists of both highly conductive fractures with a permeability of k f 1 0 6 m 2 and flow barriers with a permeability of k f 1 0 22 m 2 two injection wells exist on the bottom left and top left boundaries with a pressure of p inj 2 1 0 7 pa similarly two production wells are located at the bottom right and top right boundaries with a pressure of p prod 1 1 0 7 pa all wells are vertical and perforate the entire thickness of the reservoir two different grids are considered using the cpg geometry one with orthogonal grids where the coordinates of all the grid cells are identical with those in the cartesian grid geometry and one with non orthogonal grids where the pillars of the grids are slightly tilted to provide a better insight the non orthogonal grid mesh is shown in fig 8 as shown the domain remains a cartesian box but the cpg grid is tilted to verify its consistency fig 9 illustrates the simulation results for he cartesian grid and the two sets of cpg models fig 10 shows the errors between the results of the cartesian grid geometry as the reference solution and the two cpg cases orthogonal and non orthogonal similar to the previous test case a match is visible between the results of the cartesian grid and the orthogonal corner point grid with errors calculated via eq 35 of e p 1 71 1 0 9 and e s 2 47 1 0 8 the difference between the solutions of the cartesian grid and the non orthogonal corner point grids are greater as the different grid geometry results in different connectivities e p 1 03 1 0 2 and e s 4 44 1 0 2 6 3 test case 3 3d reservoir with non orthogonal grids the third test case fig 11 demonstrates the capability of the pedfm method on the reservoir model based on corner point grids the grid cells in test case 2 were deformed to create a distorted version of that model the model allows for the testing of the pedfm implementation in a non orthogonal grid system the same dimensions and gridding from test case 2 are used in this test case the fracture network consisting of 15 fractures is discretized in 876 grids and a total of 50876 grid cells are imposed on the entire domain two different scenarios are considered in this test case in the first scenario some fractures are considered as highly conductive while the others are given a very low permeability and are considered to be flow barriers shown in fig 11 a with yellow color for high permeability and blue color for low permeability in the second scenario the permeability of the fractures is chosen as the inverse of scenario 1 11 b i e the low conductive fractures are now highly conductive and vice versa the values of permeability for the matrix and low and high conductive fractures are identical to the ones in test case 2 the well pattern and pressure restrictions are also the same as in the previous test case the pressure and saturation results of scenario 1 are shown in figs 12 a and 12 c respectively at the left side of fig 12 as the grid geometry and the gridding system of this test case are not similar to the previous test case it is not possible to compare the two test cases the pressure and saturation distribution of the second scenario at the same simulation time can be observed at right side of fig 12 in the first scenario the flow barriers are close to the injection wells thus restricting the displacement of the injecting phase towards the center of the domain fig 12 c therefore a high pressure gradient is visible near the injection wells fig 12 a as the low permeability fractures limit the flux through the domain in the second scenario the highly conductive fractures are near the injection wells and the saturation profile increases through the whole thickness of the domain fig 12 d the pressure profile is uniformly distributed in the reservoir as there is no flux restriction near the wells fig 12 b additionally to perform a grid resolution sensitivity analysis of the developed model this test case was used with three different grid resolutions while keeping all the input parameters identical as the ones that were mentioned above three different computational grids using corner point grid geometry were imposed on this domain namely 80 80 32 40 40 16 and 20 20 8 for the rock matrix and 2852 757 and 173 for the fracture network respectively fig 13 shows the saturation distribution of these three different gird resolutions at a simulation time of t 100 d a y s the results of the two lower grid resolutions i e 20 20 8 and 40 40 16 were compared against the results of the highest grid resolution i e 80 80 32 meaning that the results of the 80 80 32 grid resolution is used as reference in the calculation of the error the relative error for pressure and saturation results are given in fig 14 these errors are calculated as 36 e x x highres x lowres 2 x highres 2 x p s w 6 4 test case 4 the johansen formation the water bearing johansen formation was a potential candidate for co2 storage in a project promoted by the norwegian government the norwegian continental margin has excellent potential for co2 storage options in saline aquifers the johansen formation eigestad et al 2009 is located in the deeper part of the sognefjord delta offshore mongstad on norway s southwestern coast see fig 15 it belongs to the lower jurassic dunlin group and is interpreted as a laterally extensive sandstone and it is overlaid by the dunlin shale and below by the amundsen shale a saline aquifer exists in the depth levels ranging from 2200 m to 3100 m below the sea level the depth range makes the formation ideal for co2 storage due to the pressure regimes existent in the field providing a thermodynamical situation where co2 is in its supercritical phase these formations have uniquely different permeabilities and perform very different roles in the co2 sequestration process the johansen sandstone has relatively high porosity and permeability and it is suitable to store co2 the low permeability overlaying dunlin shale acts as a seal that avoids the co2 from leaking to the sea bottom layers the johansen formation has an average thickness of nearly 100 m and the water bearing region extends laterally up to 60 km in the east west direction and 100 km in the north south direction the aquifer has good sand quality with average porosities of roughly 25 this implies that the johansen formation s theoretical storage capacity can exceed one gigaton of co2 providing the assumption of residual brine saturation of about 20 the northwestern parts of the johansen formation are located some 500 m below the operating troll field one of the north sea s largest hydrocarbon fields 6 4 1 data set the matmora project has created five models of the johansen formation one full field model 149 189 16 grids three homogeneous sector models 100 100 n for n 11 16 21 and one heterogeneous sector model 100 100 11 also known as the npd5 sector eigestad et al 2009 in this work the last data set npd5 has been used the npd5 sector can be seen in fig 16 in the left side of this figure the npd5 sector is highlighted with blue color in the discretized computational grids the johansen formation is represented by five layers of grid cells the amundsen shale below the johansen formation and the low permeable dunlin shale above are characterized by one and five cell layers respectively the johansen formation consists of approximately 80 sandstone and 20 claystone whereas the amundsen formation consists of siltstones and shales and the dunlin group has high clay and silt content 6 4 2 rock properties the johansen sandstone is a structure with a wedge shape pinched out in the front part of the model and divided into two sections at the back fig 17 shows two different selections i e the entire formation figs 17 a and 17 c and the npd5 sector of the formation figs 17 b and 17 d the porosity map of the entire model is visible in fig 17 a and fig 17 b shows the cells with porosity values larger than 0 1 that belong to johansen formation similarly the permeability map of the entire formation is shown in figs 17 c and fig 17 d illustrates the permeability of the npd5 sector where the dunlin shale above the johansen and the amundsen shale below the johansen formation are excluded the permeability tensor is diagonal with the vertical permeability equivalent to one tenth of the horizontal permeability in both graphs the permeability is represented by a logarithmic color scale 6 4 3 simulation results the npd5 sector of the johansen formation model lie 2019 is used in the following test case it is a corner point grid reservoir model that consists of 100 100 11 grid cells from which 88775 grid cells are active the rock properties of the johansen formation available as public data were given as input in the simulation a network of 121 fractures is embedded in the reservoir geological data set that contains both highly conductive fractures and flow barriers with permeability of k f m a x 1 0 8 m 2 and k f m i n 1 0 20 m 2 respectively the model is bounded by two shale formations therefore the fractures were placed inside the johansen formation layers 6 to 10 in total 150 fractures are embedded in the model and the fracture network consists of 3494 grid cells in total 92269 grid cells for matrix and fractures five injection wells with pressure of p inj 5 1 0 7 pa and four production wells with pressure of p inj 1 1 0 7 pa were placed in the model wells are vertical and drilled through the entire thickness of the model fig 19 d illustrates the location of the injection and production wells in this test case moreover fig 18 shows a histogram of the number of the neighboring connections between the matrix grid cells of this field while the majority of the grid cells have 5 or 6 neighbors there are grid cells that have more than 6 neighbors due to non matching grid topology in the npd5 computational model of the johansen formation 29 percent of the interfaces are non planar approximating these interfaces with planar quadrilateral interfaces results in 1 57 percent of volume shift in each grid cell by average however as mentioned previously mass conservation is guaranteed and no inconsistency is generated two scenarios are considered with two different fracture networks of mixed conductivities while the geometries of both fracture networks are identical the permeability values of the fractures from scenario 1 are inverted for the scenario 2 this implies that the highly conductive fractures in the fractures network of scenario 1 act as flow barriers in the 2nd scenario and the flow barriers of scenario 1 are modified to be highly conductive fractures in the scenario 2 figs 19 a and 19 b display the fractures networks of scenario 1 and scenario 2 respectively the matrix grid cells overlapped by the fractures are visible in fig 19 c see fig 19 the simulation results of the first scenario are shown in figs 20 and 21 the injection wells are surrounded by highly conductive fractures that facilitate the flow since the model s dimensions are considerably large approximately 50 km 50 km the pressure distribution in the reservoir is shown in fig 20 high pressure values are observed in a large section of the reservoir as there is no restriction for flow from the wells and two shale formations bound the johansen sandstone one can interpret that the high pressure drops observed in some regions are caused by presence of low permeable fractures or flow barriers in those regions the saturation displacement is considerably enhanced by the highly conductive fractures fig 21 located near the injection wells for the second scenario the results are presented in figs 22 and 23 the injection wells are surrounded by low conductive fractures which restrict the flow from the injection wells towards the production wells the pressure distribution differs considerably when compared to the first scenario the flow barriers near the wells result in high pressure drops in the vicinity of the injection wells the saturation displacement fig 23 is lower than that of scenario 1 due to presence of low conductive fractures near the injection wells 6 5 test case 5 the brugge model the brugge model is an spe benchmark study conceived as a reference platform to assess different closed loop reservoir management methods peters et al 2010 it is the largest and most complex test case on closed loop optimization to represent real field management scenarios the active brugge field model has 44550 corner point grid cells and the main geological features present in the model are a boundary fault and an internal fault seven different rock regions with their particular petrophysical properties are distributed throughout the whole model thirty wells are included in the field model s well production pattern 20 producers and 10 injectors see fig 24 6 5 1 geological model the geological structure of the brugge field contains an east west elongated half dome with a boundary fault at its northern edge and an internal fault with a throw at an angle of nearly 20 degrees to the northern fault edge the dimensions of the field are approximately 10 km 3 km the original high resolution model consists of 20 million grid cells with average cell dimensions of 50 m 50 m 0 25 m in addition to the essential petrophysical properties for reservoir simulation sedimentary facies porosity permeability net to gross and water saturation the grid model includes properties measured in real fields gamma ray sonic bulk density and neutron porosity the data were generated at a detailed scale to produce reliable well log data in the thirty wells drilled in the field the original high resolution model was upscaled to a 450000 grid cells model which established the foundation for all additional reservoir simulations of the reference case a set of 104 realizations each containing 60000 grid cells was created from the data extracted from the reference case all the realizations used the same geological structure of the field the north sea brent type field was the reference to generate the reservoir zones rock properties and thicknesses an alteration of the formations vertical sequence for the general brent stratigraphy column comprising the broom rannoch etive ness tarbert formations was made and resulted in that the highly permeable reservoir zone switched locations with the underlying area less permeable and heterogeneous 6 5 2 rock properties a reservoir model with 60000 grid cells was the reference to create 104 upscaled realizations for the reservoir properties the properties that contain the realizations are facies porosity a diagonal permeability tensor net to gross ratio and water saturation see figs 25 27 6 5 3 simulation results the following test case from the brugge model is used to show the pedfm model s capability in fracture modeling in a synthetic geologically relevant model with the corner point grid geometry the reservoir model consists of 138 48 9 grid cells from which 43474 grid cells are active rock properties of the realization available from public data were used in the simulation a network of 60 fractures is defined in the reservoir domain containing both highly conductive fractures and flow barriers with permeability of k f m a x 1 0 8 m 2 and k f m i n 1 0 20 m 2 respectively the fracture network consists of 5384 grid cells in total 48858 grid cells the well pattern used in this test case was a modified version of the original well pattern with 30 wells peters et al 2010 four injection wells with p inj 5 1 0 7 pa and three production wells with a pressure of p prod 1 1 0 7 pa were defined in the model wells are drilled vertically and through the entire thickness of the reservoir a histogram is available in fig 29 which shows an illustration of the range of the neighboring connections between the matrix grid cells in this model it can be seen that there are a number of grid cells with more than 6 neighbors due to the non matching grid topology this computational model has 66 5 percent of its interfaces as non planar and the approximation of the these interfaces into planar quadrilateral interfaces causes 1 23 percent of volume shift in each grid cell on average see fig 28 two scenarios are created with two different fracture networks including mixed conductivities the geometries of both fracture networks are identical but the permeability values of the fractures from scenario 1 are inverted for the scenario 2 namely the highly conductive fractures in the fractures network of scenario 1 act as flow barriers in the 2nd scenario and the flow barriers of scenario 1 are modified to be highly conductive fractures in the scenario 2 figs 29 a and 29 b show the fracture networks of scenario 1 and scenario 2 respectively the matrix grid cells overlapped by the fractures are visible in fig 19 c the pressure and saturation results of the scenario 1 are shown in figs 30 and 31 respectively the pressure results are only shown for the simulation time 5000 days but the saturation profiles are presented for three time intervals of 2000 5000 and 10000 days the injection wells are surrounded by highly conductive fractures that act as flow channels as a result the saturation of the injecting phase is considerably increased in larger distances from the injection phases and the pressure drop around the injection wells is not high the results of the 2 nd scenario can be seen in figs 32 and 33 respectively the pressure results are only shown for the simulation time 5000 days but the saturation profiles are presented for three time intervals of 2000 5000 and 10000 days the injection wells are surrounded by flow barriers that restrict the flow as a result a high pressure zone is formed near the wells since the central area of the reservoir is isolated with low permeability fractures this is followed by a sharp pressure gradient the saturation displacement is small due to the reservoir s low permeability values and the absence of highly conductive fractures near the wells the saturation displacement is restricted to the area near the injection wells 6 6 test case 6 and 7 norne field norne verlo and hetland 2008 is an oil and gas field situated in the norwegian sea around 80 kilometers north of the heidrun oil field the field dimensions are approximately 9 km 3 km and the seawater depth in the area is 9 m the field is located in a license awarded region in 1986 and incorporates blocks 6608 10 and 6608 11 see fig 34 equinor is the current field operator the expected oil recovery factor is more than 60 which is very high for an offshore sub sea oil reservoir subsurface data from the norne field have been published for research and education purposes thanks to ntnu equinor and partners initiative the full simulation model can be obtained through the open porous media opm project opm project org anon 2020 the norne field simulation model was the first benchmark case based on real field data available to the public the model is based on the 2004 geological model and consists of 46 112 22 corner point grid cells 6 6 1 reservoir the oil and gas production of norne is obtained from a jurassic sandstone which lies at a depth of 2500 meters below sea level the original estimation of recoverable resources was 95 2 million cubic meters for oil mainly in the ile and tofte formations and 13 01 billion cubic meters for gas in the garn formation 6 6 2 field development the alve field finding preceded the norne field s discovery in 1992 the plan for development and operation pdo was approved in 1995 and the production started in 1997 the field development infrastructure consists of a production storage and offloading vessel fpso attached to sub sea templates water injection is the drive mechanism to produce from the field in 2019 norne fpso was granted a lifetime extension to increase value creation from the norne field and its satellite fields and also the blow down of the gas cap in the not formation started in 2020 two production wells were planned to be drilled in the ile formation see fig 35 6 6 3 petrophysical data the field simulation model s petrophysical data consist of porosity permeability net to gross and transmissibility multiplier data permeability is anisotropic and heterogeneous with a clear layered structure as expected for a real reservoir field model the vertical communication is decreased in significant regions of the model by the transmissibility multiplier data that is available resulting in intermediate layers of the reservoir with permeability values close to zero the porosity values of the field are in the interval between 0 094 and 0 347 see fig 36 a considerable percentage of impermeable shale is present in some regions in the model see figs 37 39 6 6 4 simulation results of test case 6 norne with highly conductive fractures this test case demonstrates the performance of the pedfm model on the norne field the corner point grid data for this and the following test cases were extracted from the input files of matlab reservoir simulation toolbox mrst lie 2019 as explained above norne is an oil field located around 80 kilometers north of the heidrun oil field in the norwegian sea lie 2019 as described in the mrst lie 2019 the extent of this oil field is 10 km 2 km 100 m the corner point grid skeleton consists of 46 112 22 grid cells from which 44915 grid cells are active forming the complex geometrical shape of this oil field a synthetic network of 15 fractures designed by the author as a realization is considered inside this domain the permeability of the norne rock matrix in this test case is assumed to be constant at k m 1 0 14 m 2 and the permeability data from the field was not used in this test case all fractures are highly conductive with a permeability of k f 1 0 8 m 2 two injection wells with pressure of p inj 5 1 0 7 pa and two production wells with pressure of p prod 1 1 0 7 pa are located in the outer skirts of the reservoir as it can be seen on fig 39 a all wells are vertical and perforate the entire thickness of the reservoir for this test case the low enthalpy single phase geothermal fluid model was used the input parameters used in this test case are listed in table 2 6 6 5 simulation results of test case 7 norne with mix conductive fractures in this test case the norne field model with a skeleton of 46 112 22 grid cells and a total of 44915 active matrix grid cells is considered unlike in test case 6 the real rock properties of the norne field were used in this test case a set of 56 synthetic fractures are created and embedded in the reservoir domain which comprises highly conductive fractures and flow barriers with permeability of k f m a x 1 0 8 m 2 and k f m i n 1 0 20 m 2 respectively the fracture network consists of 2165 grid cells in total there are 48705 grid cells in this test case four injection wells with a p inj 5 1 0 7 pa and three production wells with a p prod 1 1 0 7 pa were placed in the model wells are vertical and drilled through the entire thickness of the model fig 40 demonstrates a histogram with the number of occurrences for a specific number of neighboring connections between the grid cells of this computational domain the distribution of the counts of the neighboring connections shows that a considerably large number of grid cells have more than 6 neighbors some with up to 20 neighboring connections which is a result of the non matching grids correct computation of the matrix fracture connectivities on this domain with such a topological complexity is crucial for the accurate capture of the effect of the embedded fractures and faults on the flow patterns in this computational model 56 5 percent of the interfaces are non planar and the approximation of the these interfaces into planar quadrilateral interfaces results in a volume shift of 4 45 percent in each grid cell in average like the test cases in johansen 6 4 and brugge 6 5 models two scenarios are considered for the fracture network used in this test case in both scenarios the geometrical properties of the fracture networks are identical however the permeability values of the highly conductive fractures and flow barriers from the scenario 1 are inverted in the scenario 2 see fig 41 the pressure and saturation results of scenario 1 simulation are presented in figs 42 and 43 respectively the pressure results are only shown for simulation time 5000 days but the saturation profiles are presented for three time intervals of 2000 5000 and 10000 days the injection wells are surrounded by flow barriers that restrict the saturation displacement in the reservoir the pressure is high in the areas near the wells these high pressure areas are an indication that the pedfm implementation in the corner point grid geometry is successful in the modeling of the fractures with low conductivities high pressure drops can be seen at the location of the flow barriers the increase in saturation is mainly carried out in two parts of the model these two areas are not isolated from the rest of the model which allows a distribution of the injecting phase through the flow paths the results of scenario 2 are shown in figs 44 and 45 respectively in the same manner as for the previous scenario the pressure results are only shown for the simulation time 5000 days while the saturation profiles are shown for time intervals of 2000 5000 and 10000 days the injection wells are surrounded by highly conductive fractures that act as flow channels the pressure is more uniformly distributed as a result the effect of high permeable fractures near the injector wells has increased the saturation displacement across larger distances in the domain 7 conclusions and future work in this paper a projection based embedded discrete fracture model pedfm for corner point grid cpg geometry was developed and presented this method was used with different fluid models i e for fully implicit simulation of isothermal multiphase fluid flow and low enthalpy single phase coupled mass heat flow in fractured heterogeneous porous media first the corner point grid geometry and its discretization approach were briefly described afterwards the pedfm model tene et al 2017 hosseinimehr et al 2020 was extended to account for fully 3d fracture geometries in a generic corner point grid discrete system through a few box shaped 2d and 3d homogeneous and heterogeneous test cases the accuracy of the pedfm on the corner point grid geometry was briefly compared against the cartesian grid geometry the new method presented similar results of satisfactory accuracy in the corner point grid geometry when compared to a cartesian grid geometry the 3d box shaped reservoir was then converted into a non orthogonal gridding system to assess the pedfm method further moreover numerical results were obtained on a number of geologically relevant test cases different scenarios with various synthetic fracture networks were considered for these test cases these fine scale simulations allowed for mix conductivity fractures it was shown that pedfm can accurately capture the physical influence of both highly conductive fractures and flow barriers on the flow patterns the pedfm in the corner point grid geometry is found to be a promising technique for increasing the discretization flexibility and enhancing the computational performance while honoring the accuracy many geo models including ones used in the test cases above contain millions of grid cells that have complex geometrical alignments to match the positioning of fractures and faults causing significant computational complexity and lack of flexibility especially when taking geomechanical deformation into account the pedfm model provides the possibility to avoid the complexity of gridding in such models by explicitly representing the discontinuities such as fractures and faults in the presence of elastic and more importantly plastic deformations one could only modify the gridding structure of the affected region in the rock matrix fully independent of the fractures and faults this advantage results in significant computational gains especially in the realm of poromechanics the developments of the pedfm in the corner point grid geometry and all the related software implementations of this work are made open source and accessible on https gitlab com darsim credit authorship contribution statement mousa hosseinimehr conceptualization methodology software formal analysis writing original draft janio piguave tomala methodology software cornelis vuik writing review editing supervision mohammed al kobaisi writing review editing hadi hajibeygi conceptualization methodology writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments many thanks are due towards the members of the darsim delft advanced reservoir simulation research group of tu delft for the useful discussions during the development of the pedfm on corner point grid geometry authors also thank dr barnaby fryer of epfl for proofreading the final version of the manuscript appendix mass and heat conservation for high enthalpy geothermal systems in this section the governing equations of the single component water two phase vapor liquid flow in high enthalpy geothermal systems are described due to the thermodynamic conditions the single component water can exist in either liquid and vapor steam phases in high enthalpy systems two sets of equations are considered i e the mass balance and the energy conservation equations each set of equations have two subsets for the two phases but are added together and form one set of equations for the entire system meaning one mass balance equation and one energy balance equation for all the phases expectedly in low enthalpy systems these equations are reduced to single phase a 1 mass balance equation mass balance for phase α for a system with n α phases reads 37 t ϕ α 1 n α ρ α s α m α 1 n α ρ α λ α p m i 1 n frac ρ α q α m w α 1 n α i 1 n frac ρ α q α m f i on ω m r n for the rock matrix m and 38 t a ϕ α 1 n α ρ α s α f i a α 1 n α ρ α λ α p f i i 1 n frac ρ α q α f i w α 1 n α ρ α q α f i m α 1 n α j 1 n frac ρ α q α f i f j j i on ω f i r n 1 for the discrete fracture f i with aperture a the superscripts m f i and w indicate the rock matrix the i th fracture and the wells respectively moreover ϕ is the medium porosity and λ α is the phase mobility i e λ α k r α μ α k where k r α and μ α are the phase α relative permeability and viscosity the term k is the rock absolute permeability which can be a full tensor in this work we only consider scalar permeability values i e k k i with i being the identity matrix moreover ρ α denotes the fluid density and s α refers to the saturation of phase α the fluid pressure p is one of the two primary unknowns and q α is the source term e g injection and production wells the saturation constraint requires summation of all phases to be equal to the unity i e α 1 n α s α 1 the terms q α m f i and q α f i m are the phase flux exchanges between the rock matrix m and the fracture f i and q α f i f j is the influx of phase α from the j th fracture to the i th fracture the mass conservation ensures that v q α m f i d v a f i q α f i m d a and a f i q α f i f j d a a f j q α f j f i d a hajibeygi et al 2011 the volumetric well fluxes are obtained via peaceman model peaceman 1978 both for matrix and fractures i e 39 q α m w w i λ α p w p m δ v 40 q α f i w w i λ α p w p f i δ a here w i denotes the well productivity index and λ is the effective mobility of each phase between the well and the perforating compartment in each medium and is obtained using upwind scheme in the discrete system for the rock matrix the control volume is defined as δ v and for the lower dimensional fracture the control area is defined as δ a the volumetric flux exchanges between the rock matrix and the fractures are similarly calculated as q α m f i c i m f i λ α p f i p m q α m f i c i f i m λ α p m p f i q α f i f j c i f i f j λ α p f j p f i where c i is the connectivity index and explained in the next section a 2 energy balance the energy balance equation for a high enthalpy multi phase flow system with the assumption of local equilibrium on the domain reads 41 t ρ u e f f m α 1 n α ρ α h α λ α p m λ e f f t m i 1 n frac ρ α h α q α m w α 1 n α i 1 n frac ρ α h α q α m f i i 1 n frac r m f i on ω m r n on the rock matrix m and 42 t a ρ u e f f f i a α 1 n α ρ α h α λ α p f i λ e f f t f i i 1 n frac ρ α h α q α f i w α 1 n α ρ α h α q α f i m α 1 n α i 1 n frac ρ α h α q α f i f j j i r f i m i 1 n frac r f i f j j i on ω f i r n 1 on the lower dimensional fracture f i in these of equations in addition to the previously defined parameters h α is the fluid enthalpy of phase α the term ρ u e f f indicates the effective internal energy per unit of mass and is calculated as 43 ρ u e f f ϕ α 1 n α ρ α s α u α 1 ϕ ρ r u r with u α and u r being the specific internal energy in fluid for each phase and rock respectively the dependent terms are nonlinear functions of the primary unknowns and are calculated using constitutive relations coats et al 1980 faust et al 1979 additionally λ e f f is the effective thermal conductivity written as 44 λ e f f m ϕ m α 1 n α s α λ α 1 ϕ m λ r λ e f f f i ϕ f i α 1 n α s α λ α 1 ϕ f i λ r here λ α and λ r are the thermal conductivities of phase α and rock respectively the conductive heat flux exchanges i e r m f i r f i m matrix fracture connectivities and r f i f j fracture fracture connectivities are calculated as r m f i c i m f i λ e f f t f i t m 45 r m f i c i f i m λ e f f t m t f i r f i f j c i f i f j λ e f f t f j t f i here λ e f f is the harmonic average between the two non neighboring compartments in the energy balance equation above two approaches exist for the choice of the primary unknowns on one hand the natural formulation employs pressure p and temperature t as the primary unknowns called as the p t formulation as well on the other hand the molar formulation can be used where the pressure p and the total fluid enthalpy h are considered as the primary unknowns also known as p h formulation the details for the choice of the primary unknown is available in the literature coats et al 1980 faust et al 1979 please note that the effects of both capillarity in case of a multiphase flow and gravity are neglected in all the equations a 3 discretization of the equations and the simulation strategy the discretization of the nonlinear equations is done using the finite volume method fvm the equations are discretized with a two point flux approximation tpfa finite volume scheme in space and a backward implicit euler scheme in time independent structured grids are generated for a three dimensional 3d porous rock and 2d fracture plates the discretization is done for each medium for a corner point grid geometry an illustration is presented in fig 4 a 3 1 mass and heat fluxes the coupled system of non linear equations eqs 37 38 and 41 42 is discretized by calculating the fluxes first the discrete mass fluxes need to be calculated the mass flux of the phase α between each two neighboring control volumes i and j inside one medium using the tpfa scheme can be written as 46 f α i j ρ α k r α μ α t i j p i p j here t i j a i j d i j k i j h denotes the transmissibility between the neighboring cells i and j a i j and d i j are the interface area and the distance between these two cell centers respectively the term k i j h is the harmonic average of the two permeabilities the superscript indicates that the corresponding terms are evaluated using a phase potential upwind scheme following the edfm and pedfm paradigms hajibeygi et al 2011 tene et al 2017 hosseinimehr et al 2018 the fluxes between a rock matrix cell i and a fracture cell j are modeled as 47 f α i j m f f α i j f m ρ α k r α μ α t i j m f p i m p j f in this equation t i j m f is the geometrical transmissibility in the mass flux between cell i belonging to the rock matrix m and the element j belonging to the fracture f and it reads 48 t i j m f k i j h c i i j m f in the equation above k i j h denotes the harmonically averaged permeability between the rock matrix and the overlapping fracture elements moreover c i i j m f is the connectivity index between the two mentioned overlapping elements the edfm and pedfm model the matrix fracture connectivity index as 49 c i i j m f a i j m f d i j with a i j m f being the area fraction of fracture cell j overlapping with the rock matrix cell i see fig 1 and d i j being the average distance between these two cells hajibeygi et al 2011 the computation of the connectivity index is identical for bot types of fractures either conductive or impermeable similarly the flux exchange between intersecting fracture elements i belonging to fracture f h and j belonging to fracture f k is modeled as 50 f α i j f h f k f α i j f k f h ρ α k r α μ α t i j f h f k p i f h p j f k here t i j f h f k is the geometrical transmissibility in the mass flux between element i in the fracture f h and the element j in the fracture f k which reads 51 t i j f h f k a k i j h c i i i i j f h c i j i i j f k c i i i i j f h c i j i i j f k please note that the geometrical transmissibility t i j f h f k between the two non neighboring intersecting fracture cells is obtained on a lower dimensional formulation this is needed due to the fact that the intersection between two 2d fracture plates forms a line segment and the intersection between two 1d fracture line segments results in a point fig 1 on the right visualizes an example of an intersection between two non neighboring 2d fracture elements the result of the intersection is a line segment i i j colored in red with the average distances from the intersection segment written as d i i i j f h d j i i j f k this is the reason why these transmissibilities are computed using a harmonic average formulation as shown above at next the convective and conductive heat fluxes are calculated the convective heat flux exchange between the neighboring control volumes i and j for each phase α reads 52 f α i j ρ α h α μ α t i j p i p j here h α is the enthalpy of phase α in fluid determined at the interface between grid cells i and j conclusively f α i j h α f α i j the convective heat flux exchange between non neighboring elements can be obtained via multiplication of their mass flux exchange f α i j by the effective phase enthalpy h α determined at the intersection of two overlapping elements i e f α i j h α f α i j the conductive heat flux between two neighboring cells i and j belonging to one medium is written as 53 g i j t c o n d i j t i t j where t c o n d i j a i j d i j λ e f f i j h is the transmissibility between grid cells i and j a i j d i j and λ e f f i j h are the interface area the distance from the cell centers and the harmonic average of the effective conductivity set at the interface between grid cells i and j respectively please note that the effective conductivity is calculated via eq 44 the conductive heat flux exchange between non neighboring elements i and j is obtained as 54 g i j m f g i j f m t c o n d i j m f t i m t j f for matrix fracture connectivities and 55 g i j f h f k g i j f h f k t c o n d i j f h f k t i f h t j f k for fracture fracture connectivities the conductive heat transmissibilities for matrix fracture t c o n d i j m f and fracture fracture t c o n d i j f h f k connectivities are explained later in this section a 3 2 coupling and linearization of the nonlinear equations taking the calculated fluxes above into account the discrete mass balance equations can be written in their residual form as 56 r m b i n 1 m α 1 n p h ρ α q α m w i ϕ α 1 n p h ρ α s α i n 1 ϕ α 1 n p h ρ α s α i n δ t m α 1 n p h j 1 n n f α i j m α 1 n p h k 1 n frac j 1 n f k f α i j m f k i 1 n m for element i in matrix m and 57 r m b i n 1 f h α 1 n p h ρ α q α f h w i a ϕ α 1 n p h ρ α s α i n 1 a ϕ α 1 n p h ρ α s α i n δ t f h α 1 n p h j 1 n n f α i j f h α 1 n p h j 1 n f k f α i j f h m α 1 n p h k 1 n frac j 1 n f k f α i j f h f k i 1 n f h for element i in fracture f h additionally the discrete energy balance equations are also rewritten as 58 r e b i n 1 m α 1 n p h ρ α h α q α m w i ρ u e f f i n 1 ρ u e f f i n δ t m α 1 n p h j 1 n n f α i j m α 1 n p h k 1 n frac j 1 n f k f α i j m f k j 1 n n g i j m k 1 n frac j 1 n f k g i j m f k i 1 n m for element i in matrix m and 59 r e b i n 1 f h α 1 n p h ρ α h α q α f h w i ρ u e f f i n 1 ρ u e f f i n δ t f h α 1 n p h j 1 n n f α i j f h α 1 n p h j 1 n m f α i j f h m α 1 n p h k 1 n frac j 1 n f k f α i j f h f k j 1 n n g i j f h j 1 n m g i j f h m k 1 n frac j 1 n f k g i j f h f k i 1 n m for element i in fracture f h the full residual vector for each of the mass balance and energy balance equations can be written as r n r m n r f 1 n r f n frac n t and where r k n is the residual vector of medium k at time step n p n is the vector of the pressure unknowns depending on the flow model i e the number of the phases and the thermal conditions the second primary unknown is either the saturation of the injecting phase s the temperature t or the total fluid enthalpy h for a multi phase flow model in high enthalpy systems the second primary unknown is the total fluid enthalpy with the term h n indicating the vector of the total fluid enthalpy unknowns at time step n the residual at time step n 1 namely r n 1 is a non linear function of the primary unknowns p n 1 and h n 1 therefore at every time step a newton raphson method is used to solve the non linear system iteratively i e 60 r m b ν 1 r m b ν r m b p ν δ p ν 1 r m b h ν δ h ν 1 0 r e b ν 1 r e b ν r e b p ν δ p ν 1 r e b h ν δ h ν 1 0 where ν and ν 1 superscripts denote the current and the next iteration indices at every newton s iteration step the linear system j ν δ x ν 1 r ν is solved in this notation j ν is the jacobian matrix with δ x ν 1 δ p δ h t therefore the linear system of the equations can be re illustrated as 61 j m b p m m j m b p m f j m b p f m j m b p f f j m b h m m j m b h m f j m b h f m j m b h f f j e b p m m j e b p m f j e b p f m j e b p f f j e b h m m j e b h m f j e b h f m j e b h f f ν j ν δ p m δ p f δ h m δ h f ν 1 δ x ν 1 r m b m r m b f r e b m r e b f ν r ν the convergence at each iteration loop is reached by satisfying the following conditions i e 62 r m b ν 1 2 r m b 0 2 ε r m b r m b ν 1 2 r h s m b 2 ε r m b r e b ν 1 2 r e b 0 2 ε r e b r e b ν 1 2 r h s e b 2 ε r e b δ p 2 p 2 ε p δ h 2 h 2 ε t here each threshold ε x is a user defined tolerance set initially as input at the beginning of the simulation notations r 2 and x 2 are the second norm of the vectors of the residuals and the update of the unknowns the superscript 0 denotes the value of its corresponding vector at the initial state of the iteration step please note that in some systems the condition r ν 1 2 r h s 2 ε r can result in a better convergence when compared to r ν 1 2 r 0 2 ε r and vice versa therefore both conditions are checked and either of them can implicate the convergence signal 
226,hydrodynamic modeling is a common approach for flood inundation mapping these models use conservation of mass and momentum to simulate the river hydrodynamics during flood events to simulate floods and estimate the spatio temporal distribution of extreme water levels the upstream and downstream flows are used as the minimum required boundary conditions bcs in a hydrodynamic model in this study we show that such approach does not provide a realistic estimate of fluxes at boundaries and so poses uncertainty to estimated flood inundation especially during extreme floods to overcome these limitations we propose a new bc approach that demonstrates the significance of two additional bc components namely lateral flows and vertical fluxes applied to the channel and incorporates hydrologic bias impacts into the hydrodynamic model setup the basis for applying these bc modifications is to conserve the water mass flux into the river systems during extreme flood events we utilize two well known hydrodynamic flood inundation models lisflood fp and hec ras 2d to simulate a flash flood in 2016 as well as an extreme flood during hurricane harvey in fully gauged and semi gauged river systems respectively results from both case studies confirm that modeling with only upstream and downstream bcs underestimates the flood hydrographs and inundation areas while using the proposed bc approach can significantly improve the modeling performance keywords flood inundation maps 2d hydrodynamic models river boundary conditions hurricane harvey extreme floods 1 introduction floods are one of the most devastating and frequent natural disasters that involve a wide range of complex hydroclimatic hydrologic and hydrodynamic processes typically hydrologic and hydrodynamic models are used to simulate these complex processes and predict the flood characteristics teng et al 2017 despite advances in model improvements alfieri et al 2014 almeida et al 2018 dottori et al 2016 neal et al 2018 sanders and schubert 2019 the simulation results are still erroneous due to the highly non linear nature of these processes and the significant uncertainties involved in these systems beven et al 2005 merwade et al 2008 jafarzadegan et al 2021 these uncertainties and errors rise during extreme flood events due to the increase in the complexity of hydrologic and hydrodynamic processes during extreme floods the historical data does not fully represent the flood characteristics hence the extrapolations become inevitable kuchment and gelfan 2002 paquet et al 2013 additionally the nonlinearity of mass and energy equations dominates the system and the assumptions commonly used for simplifying model simulations e g using homogenous soil and land cover in the hydrologic system or neglecting acceleration components for routing the overland flows lose their validity leander and buishand 2007 to simulate the fluvial floods within a river system a hydrodynamic model is usually set up with a digital elevation model dem channel and floodplain roughness parameters river geometry information and boundary conditions one of the primary steps to set up a hydrodynamic flood inundation model is to define the boundary conditions which typically include information on upstream and downstream flows or water stage in an earlier study conducted on the impact of boundary conditions pappenberger et al 2006 demonstrated that the uncertainty of upstream boundary conditions can significantly affect model results exceeding the importance of model parameter uncertainty in some areas later pappenberger et al 2008 and savage et al 2016b performed two comprehensive global sensitivity analyses on the impacts of different factors on 1d and 2d hydrodynamic model performance they demonstrated that the upstream boundary condition and the channel roughness are the most important factors that affect the inundation results unlike the significant role of boundary conditions in flood inundation modeling it has received far less attention compared to the model parameters in the literature bermúdez et al 2017 the upstream and downstream boundary conditions are the minimum requirements to set up a hydrodynamic model however using only these two components may not be sufficient if the system is heavily influenced by lateral flows lateral flows represent a combination of flow seeping vertically downward below the channel and the surface runoff from the adjacent landscapes scharffenberg and kavvas 2011 this includes 1 point source flows added by tributaries to the main channel and 2 distributed flows that account for the areas that are not covered by the drainage area of tributaries there are a few studies conducted on the numerical solution of flood routing equations when lateral flows are added to the system fan and li 2006 tommaso et al 1999 moussa 1996 o donnell 1985 in order to estimate the lateral flows typically a hydrologic model needs to be coupled with the hydrodynamic model in this regard lerat et al 2012 coupled a lumped hydrologic model with a flood routing model to address two key research questions about the incorporation of lateral flows into a hydrodynamic river system they compared the hydrodynamic model performance using pointwise and uniformly distributed lateral flow boundary conditions and then tested the optimum number of river tributaries for improving the flood modeling performance the uncertainty of lateral flows estimated from a hydrologic model in the overall performance of hydrodynamic modeling has been also studied recently bermúdez et al 2017 however many studies have neglected the role of lateral flows and simulate floods with only upstream downstream boundary conditioning liu et al 2019 pappenberger et al 2006 patel et al 2017 yin et al 2013 in this study we highlight the significant role of lateral flows for boundary conditioning of 2d hydrodynamic models during extreme floods lateral flows are typically estimated from the hydrologic simulation of precipitation data falling over a watershed in addition to upstream downstream and lateral flows a flooded system can be highly affected by vertical fluxes applied to the channel this includes three hydrologic components i e precipitation evaporation and surface groundwater discharge interactions that change the volume of water in the channel during a flood event precipitation the primary source of the flooding along with other vertical fluxes are typically accounted for in hydrologic models then the hydrologic model outputs namely lateral flows are used as inputs to hydrodynamic models this external coupling loose coupling refers to the separate simulation of hydrologic and hydrodynamic models where the results of the former are used as input to the latter lian et al 2007 the loose coupling of hydrologic and hydrodynamic models provides an opportunity to set up calibrate and validate each model separately resulting in a more efficient framework with less complexity in practice ahmadisharaf et al 2018 biancamaria et al 2009 bonnifait et al 2009 felder et al 2017 huang and hattermann 2018 kim et al 2012 komi et al 2017 schumann et al 2013 another approach is to replace the lateral flows with direct precipitation and evaporation and use a fully coupled hydrologic hydrodynamic model where major hydrologic processes e g surface groundwater interactions and infiltration as well as the flood routing step are simultaneously carried out in a single modeling framework saksena et al 2020 viero et al 2014 the use of a fully coupled model is advantageous because the precipitation is directly used as forcing data and there is no need to estimate all lateral flows in river tributaries the fully coupled models however are data intensive and computationally expensive in addition to the computational complexity of these models their setup and use require training furthermore the fully coupled model may not always result in better model accuracy owing to the higher uncertainty that exists in the calibration of these models and the estimation of detailed hydrologic data also the fully coupled modeling approach is still at the early stage of development and no benchmark study has compared its accuracy with commonly used hydrodynamic models the us army corps of engineers usace team has developed an option named rain on grid r o g for the hec ras 2d model where the precipitation data is uniformly applied to the domain as a new boundary condition similarly the r o g option has been activated for the lisflood fp model by sampson et al 2013 the r o g option provided in these two well known hydrodynamic models is a unique opportunity allowing to directly apply precipitation over domain within a hydrodynamic model setup the less complexity of this approach compared to fully coupled models is advantageous because it leads to a less computational burden less training effort and more efficient modeling however the r o g option only accounts for one component of vertical fluxes precipitation and its performance for simulation of extreme floods needs to be further investigated furthermore the r o g option uses rainfall on top of the whole domain catchment as a substitution for lateral flows this study proposes a new bc approach where precipitation and other vertical fluxes as well as lateral flows are simultaneously applied to the channel in a section of this study we specifically compare the r o g option with our proposed bc approach and demonstrate how considering all vertical fluxes based on mass balance equation can enhance the performance of hydrodynamic modeling with these in mind the main contribution of this paper is to propose a method that improves the accuracy of flood simulations without sacrificing efficiency by adjusting boundary condition data such that it conserves water mass flux and spatially distributes flows across the catchment therefore we follow the well received efficient modeling approaches use loose coupling and then add new components or apply adjustments to better characterize the physics of the complex system more specifically we propose a modified river boundary conditioning approach by adjusting adding lateral flows and vertical fluxes over channels and incorporating hydrologic bias into the hydrodynamic model setup since the proposed approach relies on observational data to adjust the bcs the method is mainly applied for hindcast simulations of historic floods it can be still used for real time flood inundation mapping if the forecasted flow hydrographs are used at gage stations owing to the free access to long records of river flow observations at the us gage stations applying the proposed bc approach is beneficial for reconstructing historic floods in the united states bomers et al 2019 fantin cruz et al 2011 masoero et al 2013 the new bcs modified with observations improve the model physics and result in a more accurate representation of river dynamics for historic flood reconstructions as mentioned before the incorporation of lateral flows into hydrodynamic models is fully or partially ignored in large scale problems as they may not add a considerable amount of inflow to the system however here we highlight the significant role of this component during an extreme flood event and elaborate on how to estimate lateral flows based on maintaining conservation of mass in river systems vertical fluxes explain direct rainfall falling over the river channel evaporation and surface groundwater interactions and to the best of our knowledge this is the first study that investigates the role of all these hydrological fluxes as a new boundary condition component of hydrodynamic models lastly the hydrologic bias potentially due to model structural error and model parameterization is used to rectify the inflow to the hydrodynamic model here hydrologic bias refers to the bias in streamflow simulated in river networks by a hydrologic model knowing the hydrologic bias component bias correction is applied to the upstream and lateral flows to update their values before running the hydrodynamic model overall to better represent the physical processes we investigate and highlight the main limitations of upstream downstream boundary conditioning in flood inundation modeling during an extreme flood event and provide guidelines to improve the overall modeling performance in such extreme cases 2 methodology a common approach to flood inundation mapping is to set up a hydrodynamic model for the simulation of river dynamics during flood events these models use conservation of mass and momentum eqs 1 3 used for 2d hydrodynamic modeling to simulate the water movement in the river 1 h t h u x h v y q 0 2 u t u u x v u y g h x v t 2 u x 2 2 u y 2 c f u f v 3 v t u v x v v y g h y v t 2 v x 2 2 v y 2 c f v f u where h and h denote water surface elevation and water depth t is time u and v are the velocity components in the x and y direction and q is a source sink flux term in the conservation of mass equation eq 1 in the conservation of momentum equations eqs 2 and 3 g vt cf and f represent the gravitational acceleration the horizontal eddy viscosity the bottom friction coefficient and the coriolis parameters respectively the vector form of the conservation of mass equation can be written as 4 h t h v q 0 where v u v is the velocity vector and the operator denote the vector of the partial derivative operators x y integrating eq 4 over the horizontal surface of the whole channel with boundary normal vector n and using gauss s divergence theorem the conservation of mass over the whole control volume is demonstrated as 5 ω t s v n d s q 0 where ω denote the total volume of water in the channel s is the side boundary surface and q is the source sink term representing all vertical fluxes crosses the channel bottom surface groundwater interactions and the water surface precipitation and evaporation the second term in eq 5 s v n d s represents all flows that cross the boundary of the channel including upstream downstream and lateral flows taking another integral over the entire period of the flood model simulation starting from pre flood t t to a few days after the end of the flood t t and estimating the integral with the sum of the discretized time at a daily scale the constrained form of the conservation of mass over the whole domain and period can be simplified by 6 ω t ω 1 t 1 t q u t t 1 t q l t t 1 t q d t t 1 t q v t 0 where q u t q l t q d t denote daily values of upstream lateral and downstream flows and q v t is all vertical fluxes applied to the channel at day t the core of this study is based on a new assumption that the total volume of water before starting the flood is almost equal to the volume of water after finishing the flood event ω 1 ω t it is worth mentioning that the water depth and volume vary with time during the flood and the dynamics of the river is fully considered during the 2d hydrodynamic modeling h t 0 a n d ω t 0 in other words our new assumption is only related to the initial and ending time of the flooded system from a physical perspective the system is perturbed with an external forcing flood and it finally gets back to its original condition therefore we simplify eq 6 as 7 d e f i c i t t 1 t q d t t 1 t q u t t 1 t q l t t 1 t q v t knowing the total downstream flow that exits from the channel and the total upstream flow that enters the channel the deficit can be calculated for a flooding river then the deficit can be distributed between lateral flows and vertical fluxes the boundary conditions are typically defined as a set of forcing data flow or water stage applied to the most upstream and downstream cross sections of the river system together with the partial insertion of point source lateral flows estimated from hydrologic models or statistical techniques here we show that using this boundary conditioning approach cannot completely represent the physics of the river hydrodynamics especially during extreme floods a schematic of the proposed bc components applied to a hydrodynamic model is shown in fig 1 a in this approach the total lateral flows are adjusted t 1 t q l t and the net vertical flux is uniformly added over the channel t 1 t q l t in a way that the total flows are conserved in the system eq 7 fig 1 b shows that the net vertical flux consists of precipitation qp evaporation qe and surface groundwater interactions groundwater seepage and infiltration qg it is worth mentioning the hydrologic bias component is not a physical item shown in this figure however it is used to update the upstream and lateral flows before modeling we should also highlight that vertical fluxes are treated as source sink in mathematical calculations with analytical solutions in a 2d space however to incorporate the impacts of these fluxes into 2d hydrodynamic models we propose adding them as bcs into the hydrodynamic model setup furthermore in a real world system with three dimensions vertical fluxes must be treated as bc therefore for the sake of clarity and generality vertical fluxes are referred to as bc throughout the manuscript in this study we divide the river systems into three categories of fully gauged semi gauged and ungauged systems in the next sections first we describe the new bc components for hydrodynamic modeling then we provide detailed guidelines for distributing the deficit between lateral flows and vertical fluxes and correcting the boundary conditions with these new components finally focusing on hurricane harvey and a flash flood event as appropriate examples of a complex extreme flood we demonstrate the efficacy of the proposed bc correction approach in two different case studies in one study the lisflood fp model is used in a fully gauged river system and in the other study the hec ras 2d model is coupled with a hydrologic model here the wrf hydro weather research and forecasting hydrological modeling system to simulate the flood characteristics in a semi gauged system we implement two different hydrodynamic models in different river systems to show that our bc correction approach is not dependent on a specific model structure or river system 2 1 lateral flows lateral flows are a combination of pointwise and distributed flows added from the sides to the main channel 8 s v n d s d v n d s i 1 k t 1 t q l i t where d denote a portion of side surface s that the distributed lateral flows are applied to q l i t represents the i th pointwise lateral flow tributary and k is the total number of tributaries lerat et al 2012 set up two different configurations for simulating lateral flows in hydrodynamic models in case 1 they used a combination of pointwise tributaries and distributed lateral flows to simulate the actual physics of the system in the second case they simplified the problem by removing the distributed component and multiplied tributaries by an inflated factor β as follows eq 9 9 β d a d d a u 1 k d a i where dad and dau refers to the drainage area of the downstream and upstream of the river system respectively and their subtraction represents the drainage area of the whole river system dai denotes the drainage area corresponding to the ith tributary out of k available tributaries used in the study area lerat et al 2012 demonstrated that the simplified approach using only tributaries with an inflated factor β can approximate the case with both pointwise and distributed lateral flows since the focus of this study is on efficient modeling we follow their procedure using tributaries with inflated factors to account for both sources of pointwise and distributed lateral flows generally a portion of tributaries are neglected in the hydrodynamic model setup as they do not transfer a considerable amount of water also adding all tiny tributaries to the system gives an impression of conducting trivial and tedious tasks to the modelers furthermore a portion of tributaries fed into the hydrodynamic model are raw flows provided from hydrologic models or statistical techniques these tributaries are usually located in ungauged rural areas where an accurate prediction of flow has its own challenges and uncertainties in this study we demonstrate that adjusting lateral flows based on conservation of mass is necessary especially during extreme floods where tributaries act as an important source of flood path that might bring a significant amount of water to main rivers 2 2 vertical fluxes in an extreme flood the mass balance in the channel can be highly affected by the vertical fluxes at the water surface e g precipitation and evaporation and the channel bed e g surface groundwater interactions due to groundwater seepage and infiltration fig 1b the precipitation component of vertical fluxes is the major driver of an extreme flood that can raise the water level during the flood period and inundate the land directly in extreme floods this process referred to as flash flood impacts is usually integrated with overbank fluvial flooding however the hydrodynamic modeling is typically limited to the simulation of overbank floods which results in an underestimation of flood inundation areas in addition rising the groundwater level underneath the channel increases the chance of groundwater seepage into the channel the infiltration and evaporation are two other components of vertical fluxes that reduce the volume of water in the channel but their impacts are expected to be less significant than the first two components to improve the model physicality and accuracy this study demonstrates the significance of flash flood impacts and other vertical hydrologic processes by highlighting the role of a source sink term used in the conservation of mass equation q in eq 5 to set up the 2d hydrodynamic model this source sink term that includes a combination of vertical fluxes is uniformly applied to the channel as a new boundary condition it is worth mentioning that flash flood impacts defined as a new driver of fluvial flood inundation areas should be distinguished from the pluvial flash floods commonly used for urban flooding in the literature 2 3 hydrologic bias one of the challenges in hydrodynamic modeling is the accurate estimation of flow boundary conditions here we define three types of fully gauged semi gauged and ungauged river systems in a fully gauged system both upstream and downstream of the system are gauged so that the actual flow observations at gauges are directly used as boundary conditions a semi gauged system refers to a river system that is only gauged downstream to estimate the flow boundary conditions at the ungauged side of a semi gauged or both sides of an ungauged system hydrologic modeling is required however the estimated boundary conditions by a hydrologic model are biased as compared to actual flows at those locations to calculate the hydrologic bias the following equation is used 10 b t 1 t q o b s t t 1 t q s i m t where q o b s t is the observed flow at the downstream gage q s i m t represents the flow simulated by a hydrologic model at time step t and t is the total simulation period of the hydrodynamic model the value of bias depends on the performance of the hydrologic model and it can be high enough to significantly affect the hydrodynamic modeling results in this study we consider the hydrologic bias as a new component of hydrodynamic boundary conditions to improve the flood inundation modeling results it is worth noting that the observed flow term in eq 10 is not available for ungauged cases for such cases the sum of downstream flows over the flood period should be estimated from the nearest gauges located on the same river implementing regionalization techniques to find those gauges that represent the flow at the downstream side of the channel can be another solution for estimating the total flows in ungauged cases however due to the lack of data in ungauged cases similar to other hydrologic problems we should expect much more uncertainty in the results 2 4 hydrodynamic model setup with new boundary condition components the required steps for estimating the bcs depend on the type of the case fully gauged semi gauged ungauged cases fig 2 illustrates two flowcharts that distinguish procedures used for estimating three bcs green colors upstream flow lateral flows and vertical fluxes in a fully gauged case compared to a semi gauged ungauged case according to the manual of hydrodynamic models the downstream bc can be used in a variety of types e g a time series of flows or water stage normal depth or rating curves as mentioned before unlike semi gauged systems estimating the total bias in an ungauged system is difficult due to the lack of observed flows at the downstream side of the channel however once the bias is estimated the overall steps used to estimate the bcs are identical for both semi gauged and ungauged cases according to eq 7 the total deficit of a flooded system should be distributed between lateral flows and vertical fluxes an important point is to properly choose the simulation period t 1 to t t that starts from a dry day far before beginning the flood event and similarly ends far after the event to make sure the system is back to its normal condition we first calculate the deficit based on the total upstream and downstream flows the upstream and downstream flows used in eq 7 should be from the same source therefore if the system is fully gauged the observed flows at gauges are used on the other hand for semi gauged and ungauged systems the simulated flows are used for both sides fig 2 the amount of deficit variable explains the weakness of boundary conditioning with only upstream and downstream flows in an ideal case the deficit is expected to be zero and a model setup with these two boundary conditions is valid however the deficit can be high especially for extreme flooding cases to overcome this issue this study proposes three correction steps as explained in the following sections 2 4 1 distribution of deficit between lateral flows and vertical fluxes in cases that a hydrologic model is linked to a hydrodynamic model e g semi gauged and ungauged cases the lateral flows are simulated by the hydrologic model then using eq 7 the vertical flux component is derived by subtracting the lateral flows from the deficit however the estimation of these two components is more challenging in a fully gauged system where no hydrologic model is used for estimating the lateral flows in this case we distribute these two components based on parameter c that should be tuned during the analyses 11 i 1 k t 1 t q l i t c d e f i c i t 12 t 1 t q v t 1 c d e f i c i t the second challenge is to distribute the total lateral flows into tributaries and then convert them into a daily time series the ratio of the drainage area of a tributary dai to the subtraction of downstream and upstream drainage areas dad dau can be used to estimate the share of each tributary to consider the impacts of distributed lateral flows we multiply it by the inflated factor e q 9 another advantage of using the inflated factor is that it minimizes the dependency of the model results on the number of tributaries a denser river network with a higher number of tributaries can increase the accuracy of inundation mapping at certain local points however the overall improvement should not be noticeable because regardless of the number of tributaries the total deficit is proportionally distributed among them eq 13 linear interpolation is then performed between the daily time series of closest gauges to estimate the ratio of daily flow to the total flow for each tributary knowing these ratios the daily time series of lateral flows are generated 13 t 1 t q l t β d a i d a d d a u i 1 k t 1 t q l i t d a i i 1 k d a i i 1 k t 1 t q l i t 2 4 2 updating upstream downstream and lateral flows using bias correction bias correction is needed where the flows lateral flows and upstream flows using as bc to a hydrodynamic model are the results of a hydrologic model simulation rather than gauged observations therefore it is not required to perform a bias correction in a fully gauged system if we don t use hydrologic modeling using eq 10 we can only estimate the bias downstream of the system because it is the only location that we have an observation in this section we provide guidelines for estimating the hydrologic bias of upstream and lateral flows based on the bias available at the downstream gage in order to update the flows first the total bias in the system calculated by eq 10 should be broken into k biases corresponding to tributaries and one bias corresponding to the upstream here the main assumption is that the total hydrologic bias at the downstream gage equals the summation of biases in the lateral and upstream flows eqs 14 and 15 are used to calculate the relative bias components of each tributary upstream based on the ratio of simulated flows by the hydrologic model at each location to the total flow the bias at the downstream side bd is zero unless the case study is an ungauged system eq 16 14 b l i t 1 t q l i t i 1 k t 1 t q l i t t 1 t q u t b 15 b u t 1 t q u t i 1 k t 1 t q l i t t 1 t q u t b 16 b d 0 s e m i g a u g e d s y s t e m b u n g a u g e d s y s t e m where b l i denotes the bias at the ith tributary and bu is the bias at the upstream side knowing the broken bias at tributaries upstream and downstream the bias correction operator ω shown by eq 17 is applied to disaggregate flows at time step t and update the flows eqs 18 20 17 ω q t b q t q t t 1 t q t b 18 q l i t ω q l i t b l i 19 q u t ω q u t b u 20 q d t ω q d t b d where q l i t q u t and q d t denote the updated lateral upstream and downstream flows at time step t respectively 2 4 3 disaggregation of vertical fluxes for modeling the total amount of vertical fluxes over the simulation period t 1 t q v t was already estimated from step 1 explained in section 2 4 1 in this step we disaggregate this value to estimate a time series of vertical fluxes q v t before disaggregation we uniformly distribute the total vertical fluxes over the river system by dividing the total value by the number of river cells n this generates n vertical flux components where each one corresponds to a given cell on the river since precipitation is the dominant component of vertical fluxes compared to evaporation and surface groundwater interactions we assume that the distribution of vertical fluxes over time follows the same pattern of precipitation component to disaggregate each component over time the observed precipitation freely accessible from satellite data is used to find the contribution of each time step over the entire simulation period 21 q v j t 1 t q v t n 22 q v j t p o b s t t 1 t p o b s t q v j where q v j is the total vertical fluxes over the simulation period applied to cell j q v j t represents the disaggregated vertical fluxes at time t applied to cell j and p o b s t is the spatial average of remotely sensed precipitation over the river system at time t 3 experiments this study focuses on the simulation of two flood events hurricane harvey in 2017 and a flash flood in 2016 that occurred in the san jacinto watershed a large basin that covers houston and its north neighborhood fig 3 a and b show the geographic location of this watershed in the eastern part of texas and two case studies within the watershed respectively case study 1 includes the cypress creek one of the most affected river tributaries during harvey that flows from west to east of the watershed this case study is a fully gauged river system due to the existence of four upstream gauges and one downstream gage fig 3c the second case study focuses on the east fork san jacinto river the major river in this watershed that flows from north to the south of the watershed since the upstream cross sections of this river system are ungauged this case study is categorized as a semi gauged river system fig 3d hurricane harvey is the second costliest natural disaster in the history of the united states that caused 125 billion in damage and over 100 fatalities according to the national hurricane center https www nhc noaa gov data tcr al092017 harvey pdf harvey hit texas on august 25 2017 as a category 4 storm and caused extensive flooding over houston and the surrounding area on august 26 28 the unprecedented precipitation in this area caused an extreme flooding condition that exceeded the 1000 year flood in many locations which is partially attributed to anthropogenic effects committee on urban flooding in the united states et al 2019 gori et al 2020 2019 jonkman et al 2018 juan et al 2020 mobley et al 2019 sebastian et al 2019 van oldenborgh et al 2017 in addition to hurricane harvey we simulate the river hydrodynamics for another flood event that inundated cypress creek case study 1 in late may and early june of 2016 fig 4 illustrates the hourly hyetographs and hydrographs of both flood events the total precipitation during the flood 2016 was around 460 mm which was less than 760 mm rainfall fallen over the watershed during the harvey 2017 as a result harvey 2017 caused a massive flood with a peak flow of over 800 cm compared to flood 2016 that generated two peak flows of around 300 cm however the flash flood impacts resulting from instantaneous precipitation of 32 mm h for flood 2016 were significantly higher compared to harvey 2017 that experienced less than 20 mm h rainfall over a longer duration of time fig 4 these two different flood mechanisms provide a unique opportunity to separately investigate the impacts of vertical flux and lateral flow bc components for each type of flooding in the first case study the hydrologic bias component is zero because the system is fully gauged and no hydrologic model is used the main challenge in this system is to divide the total deficit between lateral flows and vertical fluxes therefore parameter c is tuned to find the contribution of these two components in the second case study we couple wrf hydro to the hec ras 2d the hydrologic bias is an important component that should be considered during the boundary conditioning in this system the lateral flows are directly estimated by the hydrologic model and there is no need to cope with tuning the parameter c in order to validate the flood model results the simulated water stage and discharge are compared with observations at internal usgs gauges and two commonly used performance measures namely kling gupta efficiency kge and root mean square error rmse are reported moreover the maximum simulated flood extent map of hurricane harvey generated by taking the union of flood inundation maps over the simulation period is validated via reference maps these reference maps were generated in the immediate aftermath of the harvey flood events using geospatial analyses on the available high water marks and usgs gauges observations in the region watson et al 2018 to validate the simulated flood extent areas we use the fit measure defined as the ratio of the intersection to the union of reference and simulated inundation areas alfieri et al 2014 jafarzadegan and merwade 2017 3 1 case study 1 lisflood fp model in a fully gauged river system lisflood fp is a commonly used hydrodynamic model for flood inundation mapping due to its acceptable performance in past studies altenau et al 2017 aronica et al 2002a bates and de roo 2000 néelz and pender 2013 savage et al 2016a wood et al 2016 in this study we use the subgrid solver the most advanced option in lisflood fp used for simulating the propagation of flow along the channel neal et al 2012 the subgrid solver has the potential to simulate floods with coarse resolution dems while the resolution of channel width is finer than dem this feature is advantageous when fast and efficient flood inundation mapping is desirable to set up the model a 30 m dem together with the river information including the channel and floodplain roughness average channel width cross section shape and channel bed elevation are used as inputs to estimate the channel bed elevations we lower the dem cells underneath rivers with a constant offset parameter until the base flow of simulated hydrograph matches with the observed flows since floodplain roughness is not that sensitive to lisflood model results we set it to 0 06 with no calibration di baldassarre et al 2009a average channel widths are estimated from the satellite images capturing the rivers on a dry day and rectangular shapes are assumed for the cross sections the channel roughness values mostly lie within the range of 0 035 0 055 for flood inundation modeling hall et al 2005 horritt and bates 2002 wood et al 2016 we set up 30 model configurations corresponding to 6 different bc scenarios and 5 channel roughness parameters 0 035 0 04 0 045 0 05 and 0 055 the first bc scenario is the original case referring to the use of upstream and downstream flows as the only bc components in the model in the next five scenarios we apply new bcs to investigate the potential improvements using eq 7 the deficit for the original scenario standard bc is found to be 37 1400 out of 3700 cm and 49 930 out of 1920 cm of the downstream flows for harvey 2017 and flood 2016 respectively the high values of deficit for both flood events show that the system needs bc corrections since there is no hydrologic model to estimate the lateral flows parameter c is defined to test the contribution of lateral flows and vertical fluxes in the new bc set the second scenario assigns the total deficit to the vertical flux component c 0 the third fourth and fifth scenarios assign 0 25 0 5 and 0 75 of the deficit to lateral flows and the remaining to the vertical fluxes respectively finally the last scenario assumes that the total deficit belongs to lateral flows c 1 using a one month warm up period the model is run for a simulation period of 30 days starting from august 13 to september 12 fig 5 presents the calibration results of the 30 model simulations that include different combinations of channel roughness parameters and bc scenarios in an rmse kge space the first row fig 5a and b investigates the model performance for simulating harvey 2017 while the second row fig 5c and d focuses on the flood 2016 the first fig 5a and c and second fig 5b and d columns also report the performance of simulated water surface elevation and discharge at the internal gage respectively for harvey 2017 the correction scenarios significantly improve the model performance for both wse and discharges however finding an optimum configuration point is slightly challenging due to the conflicts that exist between kge and rmse as well as wse and discharge performances the rmse measure is highly sensitive to the existence of time lag between simulation and observations while kge focuses on capturing the peak regardless of the time lags that may exist considering kge as the main priority the discharge performance in fig 5b shows that assigning the major portion of the deficit to the lateral flow c 0 75 and c 1 provides better performance fig 5a also confirms that c 0 75 or c 1 with a higher channel roughness of 0 05 or 0 055 provides the highest kge among all configurations we finally pick c 0 75 with channel roughness of 0 055 as the optimum point c 1 and roughness of 0 055 is another acceptable choice that provide kge 0 9 for both wse and discharge performances the performance of lisflood fp for simulating the flood 2016 is completely different fig 5c shows that the original scenario with a 49 deficit performs better than some scenarios with no deficit c 0 75 and c 1 this shows that assigning a huge amount of deficit to the lateral flows can exacerbate the results on the other hand using c 0 and assigning all the deficit to the vertical fluxes is shown to be the best scenario for this event fig 5c and d therefore here we pick c 0 and channel roughness of 0 055 as the optimum point that generates kge 0 9 for the wse performance to test the impacts of applying the new bc set we run the model with three model configurations the first one uses the original bc with upstream and downstream flows while the second configuration takes advantage of adding lateral flows and vertical fluxes with c 0 75 the optimum point picked from fig 5 the third model configuration is a build in option of the lisflood fp model where the distributed rainfall is added over the entire domain this option uses precipitation data directly into the model and estimates the lateral flows during the routing process using this option there is no need to separately add lateral flows and precipitation components so that the model is set up with the original upstream downstream bcs and a distributed grid of rainfall data over the watershed fig 6 illustrates the direct comparison of these three configurations referred to as original corrected and rain on grid for both events of harvey 2017 fig 6a and b and flood 2016 fig 6c and d in both flood events the original configuration underestimates the peak of wse and discharge while the rain on grid option slightly outperforms the corrected configuration in terms of capturing the peak of wse fig 6a it highly overestimates the peak of discharge fig 6b for flood 2016 the rain on grid option poorly overestimates both wse and discharges while the corrected configuration compensates for the existing underestimations in the original configuration and performs far better than the rain on grid option overall the comparison of results for these two different flood events demonstrates that the rain on grid option is only beneficial for those floods that lateral flows are dominant in the system e g harvey 2017 with c 0 75 on the other hand when the flash flood impacts dominate the system e g flood 2016 with c 0 and lateral flows are not a critical item this option performs poorly another disadvantage of the rain on grid is its inefficiency as the computational run time for this option was around ten times longer than original and corrected configurations comparing to this option our proposed approach corrected is more generic robust and efficient unlike the rain on grid option that is only available for a few hydrodynamic models e g lisflood fp and hec ras 2d our proposed approach can be applied to a wide range of hydrodynamic models generality the computational time i e efficiency of our approach is identical with the original case and finally it is a robust approach because we try to maintain the conservation of mass in the system and the type of flood event does not significantly affect the modeling performance lastly we display the maximum flood inundation extents provided by both original and the proposed bc approach in fig 7 as can be seen adding lateral flows and vertical fluxes c 0 75 components to the original bc improves the fit measure of inundation mapping by 10 percent which is a significant improvement looking into the middle parts of the river also shows how the flooded regions underestimated by the original bcs in the top panel original case have been corrected when the additional bcs were included in the lower panel 3 2 case study 2 hec ras 2d model in a semi gauged river system in this case study there is no gage to provide the upstream flows for the river flow analysis thus it is required to perform coupled hydrologic hydrodynamic modeling here we use wrf hydro model outputs available from the study conducted by abbaszadeh et al 2020 they performed a multi gage calibration of the wrf hydro model for hurricane harvey in the san jacinto watershed the model was simultaneously calibrated over 4 usgs gauges 08 070 500 08 071 000 08 072 000 and 08 071 280 including the downstream gage in our case study 08 070 200 in order to properly link this model with hec ras 2d the performance of calibrated wrf hydro on the downstream gage of this river system is evaluated fig 8 the kge value and the simulated hydrograph after the calibration in fig 8 indicate that the model is biased and it underestimates the peak flow during harvey using eq 10 the wrf hydro bias over 30 days simulation period is found to be around 36 of the downstream flow 2500 out of 6800 cm this is a considerable bias that shows the importance of incorporating the hydrologic bias component into the bc set and updating the flows before running the hec ras 2d model hec ras 2d is the product of the united states army corps of engineers hydrologic engineering center brunner 2002 usace 2015 developed for two dimensional simulation of flows in the river system this model uses the 2d mesh as the unit of computations assuming that the flow characteristics can vary across the channel therefore the model solves 2d saint venant equations which require more computational resources to set up the model a 10 m dem obtained from the national elevation dataset ned is used https catalog data gov dataset usgs national elevation dataset ned as the terrain data and the 2d flow area that includes 2d meshes are delineated over the river system to calibrate the model we run 100 simulations considering a feasible range of 0 02 0 1 and 0 025 0 2 for the channel and floodplain roughness parameters respectively aronica et al 2002b 1998 di baldassarre et al 2009b we avoid using distributed parametrization over the domain as it may not improve the modeling performance liu et al 2019 and it also increases the complexity and the degree of freedom in modeling which is in contrast to our efficient modeling approach according to the calibration results we finally set the channel and floodplain roughness values to 0 03 and 0 1 respectively similar to the first case study the impact of channel bathymetry is considered by defining an offset parameter that equally lowers the cell values of dem at river locations we manually fine tune the offset parameter until the simulated water stage fit with the base flow of observations fig 9 illustrates the contribution of different boundary condition components before and after bias correction fig 9a shows that adding the lateral flows and vertical fluxes creates a new hydrograph that removes the deficit compared to the simulated downstream hydrograph the lateral flows and vertical fluxes show an almost equal contribution of 20 which results in a deficit of 40 in this case study 2750 out of 6800 cm fig 9b as mentioned before there is approximately 36 hydrologic bias in the system and it should be removed through the bias correction step using eqs 14 20 the upstream and lateral flows are updated with bias correction the vertical fluxes are also added to the bcs using eqs 21 and 22 fig 9c and d show the time series and the overall contribution of bc components after the bias correction respectively the final bc set total inflow that includes the bias corrected upstream bias corrected lateral flows and vertical fluxes provides appropriate forcing data for the river system as expected the updated inflow has some lags to explain the flood wave propagation from upstream to downstream of the system in this case study we set up 6 model configurations corresponding to different bcs the first scenario namely o refers to the original setup where only the upstream and downstream flows are used in the second scenario referred to as o b the bias component is also added so that the upstream flows are first bias corrected and then used in the modeling setup the third scenario referred to as o l considers the lateral flows and the upstream flows as the bc components in the next scenario referred to as o v the bcs include vertical fluxes and upstream flows the fifth scenario uses the r o g an additional boundary conditioning option in the hec ras 2d model that allows the modeler to avoid adding lateral flows and directly input the gridded rainfall data over the entire watershed similar to case study 1 we consider r o g as an appropriate bc option in the hec ras 2d model which helps us investigate how our proposed bc approach stands in relation to this scenario the last scenario namely o l b v includes all three new bc components of hydrologic bias lateral flow and vertical flux which represents our proposed bc approach corrected fig 10 a f compare the performance of simulated water stage hydrographs when a new bc component bias lateral or vertical is added to the original bc at both upstream fig 10a c and downstream fig 10d f gauges results at both gauges confirm that the bias component only raises the peak of the hydrograph without changing its shape on the other hand the vertical component has the highest contribution in widening the hydrograph and removing the time lag the lateral component stands in the middle as it partially raises the peak and slightly widens the hydrograph the comparison of kge and rmse values also demonstrates the key role of the vertical flux component that provides the highest improvement in performance measures compared to bias and lateral flow components fig 10g h illustrate the performance of simulated water stage hydrographs using the r o g option in hec ras 2d and the proposed approach corrected that includes all three bc components of bias lateral and vertical at upstream fig 10g and downstream fig 10h gauges both bc approaches generate acceptable results with high accuracy of kge 0 88 0 89 at the first gage and kge 0 93 at the second gage the r o g option replicates the shape of the hydrograph slightly better than corrected while our proposed approach estimates a higher peak in fig 10i we compare the performance of all 6 model configurations for floodplain mapping the fit measure represents the accuracy of simulated floodplain maps compared to the reference map the results show that the proposed approach following with the o b and r o g options provide the highest performance with 86 82 5 and 76 respectively for floodplain mapping the accurate estimation of the peak is more important than replicating the shape of the hydrograph therefore despite the weak performance of o b due to high time lag this option performs well in simulating the maximum flood extent as it predicts the peak of the hydrograph accurately similarly our proposed approach performs better than the r o g option as it makes a more accurate estimation of the peak hydrograph overall to select the best model configuration both criteria namely an accurate simulation of peak and shape of the hydrograph is required capturing the peak helps to improve the estimation of maximum flood extent areas which is critical for emergency response managers during extreme cases like harvey in addition a proper simulation of the river hydrodynamics for correct estimation of flood inundation areas which vary over time is crucial for devising reliable and on time evacuation strategies considering these facts we pick our proposed approach as the best model configuration as it provides a robust and reliable estimation of both water stage hydrograph fig 10a h and maximum flood extent areas fig 10i fig 11 illustrates three maximum flood extent maps generated by the original original bias and corrected bcs the comparison of flood extent maps in fig 11a c demonstrates the fundamental role of applying the proposed bc approach as it increases the fit measure by 20 however fig 11b shows that the majority of underestimations can be corrected by bias correction and the lateral and vertical components only improve the fit measure by 3 this is consistent with the results of fig 10 where the bias correction significantly improves the accuracy of the peak of stage hydrographs the pivotal role of vertical and lateral components will be in the correct simulation of river hydrodynamics and the estimation of the temporal variation of flood inundation areas can be highly erroneous without considering these two components 4 discussion 4 1 contribution of lateral flow vertical fluxes and bias correction from the joint calibration of the lisflood fp model in the first case study we found that the lateral flows are more effective than the vertical fluxes component for harvey flood c 0 75 or c 1 on the other hand the flash flood in 2016 shows the dominant role of vertical fluxes c 0 where assigning major deficit to lateral flows can exacerbate the results these results demonstrate the critical role of parameter c for finding the best contribution of lateral flows and vertical fluxes therefore it is highly recommended to tune this parameter for future flood events as it helps better understand the mechanism of an upcoming flood if it is dominated by flash flood impacts or lateral flows and improves the simulation of river hydrodynamics looking into the performance measures estimated before and after bc corrections revealed significant improvements in the accuracy of flood model simulations for both case studies in the first case study the kge improved by 0 1 and 0 4 for the stage and discharge hydrographs respectively and the fit measure improved by 10 in the second case study the bias correction improved the kge by around 0 1 for both gauges and the fit measure increased by 17 then adding the lateral and vertical components the kge improved by around 0 2 and 0 3 at upstream and downstream gauges respectively while the fit measure had a small improvement of 3 these results highlight the crucial role of lateral and vertical components in correcting the shape of hydrographs and removing the time lags for better simulation of inundation dynamics over time on the other hand the bias correction highly improves the prediction of hydrograph peak and maximum flood extents 4 2 robustness and efficiency of the proposed bc approach to investigate the robustness of the proposed bc approach we selected two hydrodynamic models lisflood fp and hec ras 2d two study areas and two flood events and evaluated the model performances for both fully gauged and semi gauged river systems in our experimental design efforts were made to demonstrate that the proposed bc approach can be generalized for various cases and is independent of the model structure the geographic location and the type of flood event it should be noted that we did not specifically focus on an ungauged system in this manuscript because the overall guidelines for applying the proposed bcs to an ungauged system are similar to semi gauged systems the only difference is related to hydrologic bias estimation where observed flow in eq 10 is not available in this case one solution is to apply a regionalization technique clustering gauges based on their climatic physiographic characteristics and find hydrologically similar gauges estimate the total flow over the entire period of the flood using those gauged areas that are hydrologically similar to the river system of interest jafarzadegan et al 2020 jafarzadegan and moradkhani 2020 and then use eq 10 to determine the total bias after estimating the bias component the downstream flows should also be bias corrected eqs 16 and 20 in general the lack of data in ungauged areas is a common hydrological issue that downgrades the accuracy of analysis and poses significant uncertainty thus the reliability of the proposed bc approach for an ungauged case is completely dependent on the quality of statistical analysis and regionalization techniques used to estimate the total flows at the downstream side of the channel once the bias is estimated at the downstream side in an ungauged case we follow the same procedure used to correct the bcs in the semi gauged cases in another investigation we compared the performance of the r o g option with the proposed bc approach for both harvey and flood 2016 the r o g option performs well for the simulation of harvey 2017 but it highly overestimates the water stage for flood 2016 this shows that the r o g option is a reliable option only for those floods that are dominated by lateral flows while our proposed approach is more robust as it can provide accurate simulation for different types of floods the significantly higher run time of the r o g option around ten times and the fact that it is only available for two specific hydrodynamic models lisflood fp and hec ras 2d are other disadvantages of this option compared to our proposed bc approach which is more efficient and generic finally while the r o g option only accounts for the precipitation our proposed approach considers precipitation together with other vertical fluxes including evaporation groundwater seepage and infiltration which results in a more comprehensive representation of the hydrological and physical processes in the channel 4 3 potential errors limitations and future work the fit measure values in the second case study were higher than the first one mostly due to the use of a finer dem resolution of 10 m compared to the 30 m dem used in the first case study another reason could be due to neglecting several bridges that exist along the cyprus creek in case study 1 that cause backwater effects and increase the wse in the channel recent studies demonstrate that during extreme floods the overbank flows in the upstream portion of cypress creek spills into the neighboring catchment addicks reservoir basin gori et al 2019 sebastian et al 2019 this inter basin overflow is a complex hydraulic phenomenon that can change the mass balance in the system and neglecting it can pose additional errors during the modeling despite significant improvements both models still underestimate the discharge water stage and flood extent areas for the harvey flood event especially in the first case study the assumptions made for simplifying the estimation of river geometry e g bathymetry and rectangular shape of channels and the medium resolution dem 10 30 m used in this study are potential reasons for underestimation in the r o g option sometimes a loss function is applied as a reduction on the spatial precipitation before running the hydrodynamic model here we chose to ignore this function as the selection of the loss function poses additional uncertainty and adds more complexity to the problem adding this function is expected to reduce the errors for flash flood 2016 while deteriorates the results for harvey 2017 finally this article limits the scale of the study area to a single main channel and ignores the dynamics of other river tributaries while the reference flood map captures the inundated tributaries before entering the main channel therefore a high percentage of the underestimation can be seen near the intersection of tributaries and the main channel to better replicate the reference floodplain map a larger scale modeling is required where all river tributaries are included in the study area it is also worth mentioning that the reference flood map is not a perfect observation and is prone to uncertainties as it is created from the interpolation of hwms thus it is normal to see some discrepancies between the simulated and reference flood maps due to their difference in type and scales it should be noted that although all these solutions can improve model accuracy they negatively affect model efficiency conducting a detailed analysis of the system by using fine resolution data e g lidar and advanced physically based models to reach the maximum accuracy is not within the scope of this study on the other hand this study was motivated to propose a solution that maintains model efficiency using the minimum amount of available data while increasing the model accuracy finally the deficit calculated from the subtraction of upstream and downstream flows represents the degree to which adding lateral flows and vertical fluxes are important for a flood event with a negligible deficit accounting for proposed bcs may not be necessary while the larger deficit demonstrates the higher importance of including lateral flows and vertical fluxes intuitively it is hypothesized that the size of the domain has a positive relationship with the value of deficit as for a larger scale problem with longer rivers we expect more deficit this highlights the key role of the proposed approach for large scale problems where lateral flows and vertical fluxes have more impacts on the mass balance in the system however to validate this hypothesis it is recommended to test the sensitivity of the proposed approach to different river sizes domain scales in future studies 5 conclusion this study highlighted one of the main limitations associated with the boundary conditioning of hydrodynamic models and proposed a new bc approach to improve the overall performance of flood inundation modeling during extreme events the proposed approach adjusted added lateral flows and vertical fluxes as boundary conditions of the channel and incorporated hydrologic bias impacts into the hydrodynamic model setup first a river system was categorized into three groups of fully gauged semi gauged and ungauged systems then detailed steps for the calculation of these three bc components were provided to test the importance and impacts of these bc components two case studies were defined for simulation of hurricane harvey flood in 2017 and a flash flood in 2016 the first case study was a fully gauged system where the lisflood fp model simulated both harvey and flood 2016 events and the second case study was a semi gauged system with one downstream gage where the hec ras 2d model simulated the harvey flood the main message of this manuscript is that before running the hydrodynamic model with upstream downstream boundary conditions it is judicious to estimate the water deficit between upstream downstream flows over the whole period of flooding distribute the deficit between lateral flows and vertical fluxes eq 7 and finally use the calculated lateral flows and vertical fluxes as additional boundary conditions of 2d hydrodynamic models these simple tasks are commonly ignored in practice so that the modeler uses the raw data as upstream and downstream bcs and then plays with model parameters to fit the simulated results to reference data because parameters of hydrodynamic models namely channel and floodplain roughness or river geometry information are physically meaningful numbers the best strategy is to avoid using unrealistic model parameters with a poor model setup instead the main effort should go into improving the model s physicality by updating the boundary conditions before performing any model parametrization additionally our case studies demonstrated that poor boundary conditioning cannot be compensated for any unrealistic parametrization in extreme cases such as harvey and it is required to first check the mass balance over the whole period of flooding correct the bcs and then tune the model parameters accordingly keypoints a new boundary conditioning approach is proposed to improve the accuracy of flood inundation modeling mass balance is conserved in river systems by adjusting adding lateral flows and vertical fluxes as well as incorporating hydrologic bias into the hydrodynamic model setup the maximum flood extents of hurricane harvey simulated by the lisflood fp and hec ras2d models are improved by 10 and 20 respectively credit authorship contribution statement keighobad jafarzadegan conceptualization methodology software validation writing original draft visualization atieh alipour methodology software validation keyhan gavahi validation visualization hamed moftakhari validation writing review editing hamid moradkhani conceptualization writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement partial financial support for this study was provided by the usace award a20 0545 001 all the data used in this study including the gage streamflow and water stage data and the dems are publicly available from the usgs website and national elevation dataset ned the reference flood maps provided for hurricane harvey are available from the usgs report at https pubs usgs gov sir 2018 5070 sir20185070 pdf 
226,hydrodynamic modeling is a common approach for flood inundation mapping these models use conservation of mass and momentum to simulate the river hydrodynamics during flood events to simulate floods and estimate the spatio temporal distribution of extreme water levels the upstream and downstream flows are used as the minimum required boundary conditions bcs in a hydrodynamic model in this study we show that such approach does not provide a realistic estimate of fluxes at boundaries and so poses uncertainty to estimated flood inundation especially during extreme floods to overcome these limitations we propose a new bc approach that demonstrates the significance of two additional bc components namely lateral flows and vertical fluxes applied to the channel and incorporates hydrologic bias impacts into the hydrodynamic model setup the basis for applying these bc modifications is to conserve the water mass flux into the river systems during extreme flood events we utilize two well known hydrodynamic flood inundation models lisflood fp and hec ras 2d to simulate a flash flood in 2016 as well as an extreme flood during hurricane harvey in fully gauged and semi gauged river systems respectively results from both case studies confirm that modeling with only upstream and downstream bcs underestimates the flood hydrographs and inundation areas while using the proposed bc approach can significantly improve the modeling performance keywords flood inundation maps 2d hydrodynamic models river boundary conditions hurricane harvey extreme floods 1 introduction floods are one of the most devastating and frequent natural disasters that involve a wide range of complex hydroclimatic hydrologic and hydrodynamic processes typically hydrologic and hydrodynamic models are used to simulate these complex processes and predict the flood characteristics teng et al 2017 despite advances in model improvements alfieri et al 2014 almeida et al 2018 dottori et al 2016 neal et al 2018 sanders and schubert 2019 the simulation results are still erroneous due to the highly non linear nature of these processes and the significant uncertainties involved in these systems beven et al 2005 merwade et al 2008 jafarzadegan et al 2021 these uncertainties and errors rise during extreme flood events due to the increase in the complexity of hydrologic and hydrodynamic processes during extreme floods the historical data does not fully represent the flood characteristics hence the extrapolations become inevitable kuchment and gelfan 2002 paquet et al 2013 additionally the nonlinearity of mass and energy equations dominates the system and the assumptions commonly used for simplifying model simulations e g using homogenous soil and land cover in the hydrologic system or neglecting acceleration components for routing the overland flows lose their validity leander and buishand 2007 to simulate the fluvial floods within a river system a hydrodynamic model is usually set up with a digital elevation model dem channel and floodplain roughness parameters river geometry information and boundary conditions one of the primary steps to set up a hydrodynamic flood inundation model is to define the boundary conditions which typically include information on upstream and downstream flows or water stage in an earlier study conducted on the impact of boundary conditions pappenberger et al 2006 demonstrated that the uncertainty of upstream boundary conditions can significantly affect model results exceeding the importance of model parameter uncertainty in some areas later pappenberger et al 2008 and savage et al 2016b performed two comprehensive global sensitivity analyses on the impacts of different factors on 1d and 2d hydrodynamic model performance they demonstrated that the upstream boundary condition and the channel roughness are the most important factors that affect the inundation results unlike the significant role of boundary conditions in flood inundation modeling it has received far less attention compared to the model parameters in the literature bermúdez et al 2017 the upstream and downstream boundary conditions are the minimum requirements to set up a hydrodynamic model however using only these two components may not be sufficient if the system is heavily influenced by lateral flows lateral flows represent a combination of flow seeping vertically downward below the channel and the surface runoff from the adjacent landscapes scharffenberg and kavvas 2011 this includes 1 point source flows added by tributaries to the main channel and 2 distributed flows that account for the areas that are not covered by the drainage area of tributaries there are a few studies conducted on the numerical solution of flood routing equations when lateral flows are added to the system fan and li 2006 tommaso et al 1999 moussa 1996 o donnell 1985 in order to estimate the lateral flows typically a hydrologic model needs to be coupled with the hydrodynamic model in this regard lerat et al 2012 coupled a lumped hydrologic model with a flood routing model to address two key research questions about the incorporation of lateral flows into a hydrodynamic river system they compared the hydrodynamic model performance using pointwise and uniformly distributed lateral flow boundary conditions and then tested the optimum number of river tributaries for improving the flood modeling performance the uncertainty of lateral flows estimated from a hydrologic model in the overall performance of hydrodynamic modeling has been also studied recently bermúdez et al 2017 however many studies have neglected the role of lateral flows and simulate floods with only upstream downstream boundary conditioning liu et al 2019 pappenberger et al 2006 patel et al 2017 yin et al 2013 in this study we highlight the significant role of lateral flows for boundary conditioning of 2d hydrodynamic models during extreme floods lateral flows are typically estimated from the hydrologic simulation of precipitation data falling over a watershed in addition to upstream downstream and lateral flows a flooded system can be highly affected by vertical fluxes applied to the channel this includes three hydrologic components i e precipitation evaporation and surface groundwater discharge interactions that change the volume of water in the channel during a flood event precipitation the primary source of the flooding along with other vertical fluxes are typically accounted for in hydrologic models then the hydrologic model outputs namely lateral flows are used as inputs to hydrodynamic models this external coupling loose coupling refers to the separate simulation of hydrologic and hydrodynamic models where the results of the former are used as input to the latter lian et al 2007 the loose coupling of hydrologic and hydrodynamic models provides an opportunity to set up calibrate and validate each model separately resulting in a more efficient framework with less complexity in practice ahmadisharaf et al 2018 biancamaria et al 2009 bonnifait et al 2009 felder et al 2017 huang and hattermann 2018 kim et al 2012 komi et al 2017 schumann et al 2013 another approach is to replace the lateral flows with direct precipitation and evaporation and use a fully coupled hydrologic hydrodynamic model where major hydrologic processes e g surface groundwater interactions and infiltration as well as the flood routing step are simultaneously carried out in a single modeling framework saksena et al 2020 viero et al 2014 the use of a fully coupled model is advantageous because the precipitation is directly used as forcing data and there is no need to estimate all lateral flows in river tributaries the fully coupled models however are data intensive and computationally expensive in addition to the computational complexity of these models their setup and use require training furthermore the fully coupled model may not always result in better model accuracy owing to the higher uncertainty that exists in the calibration of these models and the estimation of detailed hydrologic data also the fully coupled modeling approach is still at the early stage of development and no benchmark study has compared its accuracy with commonly used hydrodynamic models the us army corps of engineers usace team has developed an option named rain on grid r o g for the hec ras 2d model where the precipitation data is uniformly applied to the domain as a new boundary condition similarly the r o g option has been activated for the lisflood fp model by sampson et al 2013 the r o g option provided in these two well known hydrodynamic models is a unique opportunity allowing to directly apply precipitation over domain within a hydrodynamic model setup the less complexity of this approach compared to fully coupled models is advantageous because it leads to a less computational burden less training effort and more efficient modeling however the r o g option only accounts for one component of vertical fluxes precipitation and its performance for simulation of extreme floods needs to be further investigated furthermore the r o g option uses rainfall on top of the whole domain catchment as a substitution for lateral flows this study proposes a new bc approach where precipitation and other vertical fluxes as well as lateral flows are simultaneously applied to the channel in a section of this study we specifically compare the r o g option with our proposed bc approach and demonstrate how considering all vertical fluxes based on mass balance equation can enhance the performance of hydrodynamic modeling with these in mind the main contribution of this paper is to propose a method that improves the accuracy of flood simulations without sacrificing efficiency by adjusting boundary condition data such that it conserves water mass flux and spatially distributes flows across the catchment therefore we follow the well received efficient modeling approaches use loose coupling and then add new components or apply adjustments to better characterize the physics of the complex system more specifically we propose a modified river boundary conditioning approach by adjusting adding lateral flows and vertical fluxes over channels and incorporating hydrologic bias into the hydrodynamic model setup since the proposed approach relies on observational data to adjust the bcs the method is mainly applied for hindcast simulations of historic floods it can be still used for real time flood inundation mapping if the forecasted flow hydrographs are used at gage stations owing to the free access to long records of river flow observations at the us gage stations applying the proposed bc approach is beneficial for reconstructing historic floods in the united states bomers et al 2019 fantin cruz et al 2011 masoero et al 2013 the new bcs modified with observations improve the model physics and result in a more accurate representation of river dynamics for historic flood reconstructions as mentioned before the incorporation of lateral flows into hydrodynamic models is fully or partially ignored in large scale problems as they may not add a considerable amount of inflow to the system however here we highlight the significant role of this component during an extreme flood event and elaborate on how to estimate lateral flows based on maintaining conservation of mass in river systems vertical fluxes explain direct rainfall falling over the river channel evaporation and surface groundwater interactions and to the best of our knowledge this is the first study that investigates the role of all these hydrological fluxes as a new boundary condition component of hydrodynamic models lastly the hydrologic bias potentially due to model structural error and model parameterization is used to rectify the inflow to the hydrodynamic model here hydrologic bias refers to the bias in streamflow simulated in river networks by a hydrologic model knowing the hydrologic bias component bias correction is applied to the upstream and lateral flows to update their values before running the hydrodynamic model overall to better represent the physical processes we investigate and highlight the main limitations of upstream downstream boundary conditioning in flood inundation modeling during an extreme flood event and provide guidelines to improve the overall modeling performance in such extreme cases 2 methodology a common approach to flood inundation mapping is to set up a hydrodynamic model for the simulation of river dynamics during flood events these models use conservation of mass and momentum eqs 1 3 used for 2d hydrodynamic modeling to simulate the water movement in the river 1 h t h u x h v y q 0 2 u t u u x v u y g h x v t 2 u x 2 2 u y 2 c f u f v 3 v t u v x v v y g h y v t 2 v x 2 2 v y 2 c f v f u where h and h denote water surface elevation and water depth t is time u and v are the velocity components in the x and y direction and q is a source sink flux term in the conservation of mass equation eq 1 in the conservation of momentum equations eqs 2 and 3 g vt cf and f represent the gravitational acceleration the horizontal eddy viscosity the bottom friction coefficient and the coriolis parameters respectively the vector form of the conservation of mass equation can be written as 4 h t h v q 0 where v u v is the velocity vector and the operator denote the vector of the partial derivative operators x y integrating eq 4 over the horizontal surface of the whole channel with boundary normal vector n and using gauss s divergence theorem the conservation of mass over the whole control volume is demonstrated as 5 ω t s v n d s q 0 where ω denote the total volume of water in the channel s is the side boundary surface and q is the source sink term representing all vertical fluxes crosses the channel bottom surface groundwater interactions and the water surface precipitation and evaporation the second term in eq 5 s v n d s represents all flows that cross the boundary of the channel including upstream downstream and lateral flows taking another integral over the entire period of the flood model simulation starting from pre flood t t to a few days after the end of the flood t t and estimating the integral with the sum of the discretized time at a daily scale the constrained form of the conservation of mass over the whole domain and period can be simplified by 6 ω t ω 1 t 1 t q u t t 1 t q l t t 1 t q d t t 1 t q v t 0 where q u t q l t q d t denote daily values of upstream lateral and downstream flows and q v t is all vertical fluxes applied to the channel at day t the core of this study is based on a new assumption that the total volume of water before starting the flood is almost equal to the volume of water after finishing the flood event ω 1 ω t it is worth mentioning that the water depth and volume vary with time during the flood and the dynamics of the river is fully considered during the 2d hydrodynamic modeling h t 0 a n d ω t 0 in other words our new assumption is only related to the initial and ending time of the flooded system from a physical perspective the system is perturbed with an external forcing flood and it finally gets back to its original condition therefore we simplify eq 6 as 7 d e f i c i t t 1 t q d t t 1 t q u t t 1 t q l t t 1 t q v t knowing the total downstream flow that exits from the channel and the total upstream flow that enters the channel the deficit can be calculated for a flooding river then the deficit can be distributed between lateral flows and vertical fluxes the boundary conditions are typically defined as a set of forcing data flow or water stage applied to the most upstream and downstream cross sections of the river system together with the partial insertion of point source lateral flows estimated from hydrologic models or statistical techniques here we show that using this boundary conditioning approach cannot completely represent the physics of the river hydrodynamics especially during extreme floods a schematic of the proposed bc components applied to a hydrodynamic model is shown in fig 1 a in this approach the total lateral flows are adjusted t 1 t q l t and the net vertical flux is uniformly added over the channel t 1 t q l t in a way that the total flows are conserved in the system eq 7 fig 1 b shows that the net vertical flux consists of precipitation qp evaporation qe and surface groundwater interactions groundwater seepage and infiltration qg it is worth mentioning the hydrologic bias component is not a physical item shown in this figure however it is used to update the upstream and lateral flows before modeling we should also highlight that vertical fluxes are treated as source sink in mathematical calculations with analytical solutions in a 2d space however to incorporate the impacts of these fluxes into 2d hydrodynamic models we propose adding them as bcs into the hydrodynamic model setup furthermore in a real world system with three dimensions vertical fluxes must be treated as bc therefore for the sake of clarity and generality vertical fluxes are referred to as bc throughout the manuscript in this study we divide the river systems into three categories of fully gauged semi gauged and ungauged systems in the next sections first we describe the new bc components for hydrodynamic modeling then we provide detailed guidelines for distributing the deficit between lateral flows and vertical fluxes and correcting the boundary conditions with these new components finally focusing on hurricane harvey and a flash flood event as appropriate examples of a complex extreme flood we demonstrate the efficacy of the proposed bc correction approach in two different case studies in one study the lisflood fp model is used in a fully gauged river system and in the other study the hec ras 2d model is coupled with a hydrologic model here the wrf hydro weather research and forecasting hydrological modeling system to simulate the flood characteristics in a semi gauged system we implement two different hydrodynamic models in different river systems to show that our bc correction approach is not dependent on a specific model structure or river system 2 1 lateral flows lateral flows are a combination of pointwise and distributed flows added from the sides to the main channel 8 s v n d s d v n d s i 1 k t 1 t q l i t where d denote a portion of side surface s that the distributed lateral flows are applied to q l i t represents the i th pointwise lateral flow tributary and k is the total number of tributaries lerat et al 2012 set up two different configurations for simulating lateral flows in hydrodynamic models in case 1 they used a combination of pointwise tributaries and distributed lateral flows to simulate the actual physics of the system in the second case they simplified the problem by removing the distributed component and multiplied tributaries by an inflated factor β as follows eq 9 9 β d a d d a u 1 k d a i where dad and dau refers to the drainage area of the downstream and upstream of the river system respectively and their subtraction represents the drainage area of the whole river system dai denotes the drainage area corresponding to the ith tributary out of k available tributaries used in the study area lerat et al 2012 demonstrated that the simplified approach using only tributaries with an inflated factor β can approximate the case with both pointwise and distributed lateral flows since the focus of this study is on efficient modeling we follow their procedure using tributaries with inflated factors to account for both sources of pointwise and distributed lateral flows generally a portion of tributaries are neglected in the hydrodynamic model setup as they do not transfer a considerable amount of water also adding all tiny tributaries to the system gives an impression of conducting trivial and tedious tasks to the modelers furthermore a portion of tributaries fed into the hydrodynamic model are raw flows provided from hydrologic models or statistical techniques these tributaries are usually located in ungauged rural areas where an accurate prediction of flow has its own challenges and uncertainties in this study we demonstrate that adjusting lateral flows based on conservation of mass is necessary especially during extreme floods where tributaries act as an important source of flood path that might bring a significant amount of water to main rivers 2 2 vertical fluxes in an extreme flood the mass balance in the channel can be highly affected by the vertical fluxes at the water surface e g precipitation and evaporation and the channel bed e g surface groundwater interactions due to groundwater seepage and infiltration fig 1b the precipitation component of vertical fluxes is the major driver of an extreme flood that can raise the water level during the flood period and inundate the land directly in extreme floods this process referred to as flash flood impacts is usually integrated with overbank fluvial flooding however the hydrodynamic modeling is typically limited to the simulation of overbank floods which results in an underestimation of flood inundation areas in addition rising the groundwater level underneath the channel increases the chance of groundwater seepage into the channel the infiltration and evaporation are two other components of vertical fluxes that reduce the volume of water in the channel but their impacts are expected to be less significant than the first two components to improve the model physicality and accuracy this study demonstrates the significance of flash flood impacts and other vertical hydrologic processes by highlighting the role of a source sink term used in the conservation of mass equation q in eq 5 to set up the 2d hydrodynamic model this source sink term that includes a combination of vertical fluxes is uniformly applied to the channel as a new boundary condition it is worth mentioning that flash flood impacts defined as a new driver of fluvial flood inundation areas should be distinguished from the pluvial flash floods commonly used for urban flooding in the literature 2 3 hydrologic bias one of the challenges in hydrodynamic modeling is the accurate estimation of flow boundary conditions here we define three types of fully gauged semi gauged and ungauged river systems in a fully gauged system both upstream and downstream of the system are gauged so that the actual flow observations at gauges are directly used as boundary conditions a semi gauged system refers to a river system that is only gauged downstream to estimate the flow boundary conditions at the ungauged side of a semi gauged or both sides of an ungauged system hydrologic modeling is required however the estimated boundary conditions by a hydrologic model are biased as compared to actual flows at those locations to calculate the hydrologic bias the following equation is used 10 b t 1 t q o b s t t 1 t q s i m t where q o b s t is the observed flow at the downstream gage q s i m t represents the flow simulated by a hydrologic model at time step t and t is the total simulation period of the hydrodynamic model the value of bias depends on the performance of the hydrologic model and it can be high enough to significantly affect the hydrodynamic modeling results in this study we consider the hydrologic bias as a new component of hydrodynamic boundary conditions to improve the flood inundation modeling results it is worth noting that the observed flow term in eq 10 is not available for ungauged cases for such cases the sum of downstream flows over the flood period should be estimated from the nearest gauges located on the same river implementing regionalization techniques to find those gauges that represent the flow at the downstream side of the channel can be another solution for estimating the total flows in ungauged cases however due to the lack of data in ungauged cases similar to other hydrologic problems we should expect much more uncertainty in the results 2 4 hydrodynamic model setup with new boundary condition components the required steps for estimating the bcs depend on the type of the case fully gauged semi gauged ungauged cases fig 2 illustrates two flowcharts that distinguish procedures used for estimating three bcs green colors upstream flow lateral flows and vertical fluxes in a fully gauged case compared to a semi gauged ungauged case according to the manual of hydrodynamic models the downstream bc can be used in a variety of types e g a time series of flows or water stage normal depth or rating curves as mentioned before unlike semi gauged systems estimating the total bias in an ungauged system is difficult due to the lack of observed flows at the downstream side of the channel however once the bias is estimated the overall steps used to estimate the bcs are identical for both semi gauged and ungauged cases according to eq 7 the total deficit of a flooded system should be distributed between lateral flows and vertical fluxes an important point is to properly choose the simulation period t 1 to t t that starts from a dry day far before beginning the flood event and similarly ends far after the event to make sure the system is back to its normal condition we first calculate the deficit based on the total upstream and downstream flows the upstream and downstream flows used in eq 7 should be from the same source therefore if the system is fully gauged the observed flows at gauges are used on the other hand for semi gauged and ungauged systems the simulated flows are used for both sides fig 2 the amount of deficit variable explains the weakness of boundary conditioning with only upstream and downstream flows in an ideal case the deficit is expected to be zero and a model setup with these two boundary conditions is valid however the deficit can be high especially for extreme flooding cases to overcome this issue this study proposes three correction steps as explained in the following sections 2 4 1 distribution of deficit between lateral flows and vertical fluxes in cases that a hydrologic model is linked to a hydrodynamic model e g semi gauged and ungauged cases the lateral flows are simulated by the hydrologic model then using eq 7 the vertical flux component is derived by subtracting the lateral flows from the deficit however the estimation of these two components is more challenging in a fully gauged system where no hydrologic model is used for estimating the lateral flows in this case we distribute these two components based on parameter c that should be tuned during the analyses 11 i 1 k t 1 t q l i t c d e f i c i t 12 t 1 t q v t 1 c d e f i c i t the second challenge is to distribute the total lateral flows into tributaries and then convert them into a daily time series the ratio of the drainage area of a tributary dai to the subtraction of downstream and upstream drainage areas dad dau can be used to estimate the share of each tributary to consider the impacts of distributed lateral flows we multiply it by the inflated factor e q 9 another advantage of using the inflated factor is that it minimizes the dependency of the model results on the number of tributaries a denser river network with a higher number of tributaries can increase the accuracy of inundation mapping at certain local points however the overall improvement should not be noticeable because regardless of the number of tributaries the total deficit is proportionally distributed among them eq 13 linear interpolation is then performed between the daily time series of closest gauges to estimate the ratio of daily flow to the total flow for each tributary knowing these ratios the daily time series of lateral flows are generated 13 t 1 t q l t β d a i d a d d a u i 1 k t 1 t q l i t d a i i 1 k d a i i 1 k t 1 t q l i t 2 4 2 updating upstream downstream and lateral flows using bias correction bias correction is needed where the flows lateral flows and upstream flows using as bc to a hydrodynamic model are the results of a hydrologic model simulation rather than gauged observations therefore it is not required to perform a bias correction in a fully gauged system if we don t use hydrologic modeling using eq 10 we can only estimate the bias downstream of the system because it is the only location that we have an observation in this section we provide guidelines for estimating the hydrologic bias of upstream and lateral flows based on the bias available at the downstream gage in order to update the flows first the total bias in the system calculated by eq 10 should be broken into k biases corresponding to tributaries and one bias corresponding to the upstream here the main assumption is that the total hydrologic bias at the downstream gage equals the summation of biases in the lateral and upstream flows eqs 14 and 15 are used to calculate the relative bias components of each tributary upstream based on the ratio of simulated flows by the hydrologic model at each location to the total flow the bias at the downstream side bd is zero unless the case study is an ungauged system eq 16 14 b l i t 1 t q l i t i 1 k t 1 t q l i t t 1 t q u t b 15 b u t 1 t q u t i 1 k t 1 t q l i t t 1 t q u t b 16 b d 0 s e m i g a u g e d s y s t e m b u n g a u g e d s y s t e m where b l i denotes the bias at the ith tributary and bu is the bias at the upstream side knowing the broken bias at tributaries upstream and downstream the bias correction operator ω shown by eq 17 is applied to disaggregate flows at time step t and update the flows eqs 18 20 17 ω q t b q t q t t 1 t q t b 18 q l i t ω q l i t b l i 19 q u t ω q u t b u 20 q d t ω q d t b d where q l i t q u t and q d t denote the updated lateral upstream and downstream flows at time step t respectively 2 4 3 disaggregation of vertical fluxes for modeling the total amount of vertical fluxes over the simulation period t 1 t q v t was already estimated from step 1 explained in section 2 4 1 in this step we disaggregate this value to estimate a time series of vertical fluxes q v t before disaggregation we uniformly distribute the total vertical fluxes over the river system by dividing the total value by the number of river cells n this generates n vertical flux components where each one corresponds to a given cell on the river since precipitation is the dominant component of vertical fluxes compared to evaporation and surface groundwater interactions we assume that the distribution of vertical fluxes over time follows the same pattern of precipitation component to disaggregate each component over time the observed precipitation freely accessible from satellite data is used to find the contribution of each time step over the entire simulation period 21 q v j t 1 t q v t n 22 q v j t p o b s t t 1 t p o b s t q v j where q v j is the total vertical fluxes over the simulation period applied to cell j q v j t represents the disaggregated vertical fluxes at time t applied to cell j and p o b s t is the spatial average of remotely sensed precipitation over the river system at time t 3 experiments this study focuses on the simulation of two flood events hurricane harvey in 2017 and a flash flood in 2016 that occurred in the san jacinto watershed a large basin that covers houston and its north neighborhood fig 3 a and b show the geographic location of this watershed in the eastern part of texas and two case studies within the watershed respectively case study 1 includes the cypress creek one of the most affected river tributaries during harvey that flows from west to east of the watershed this case study is a fully gauged river system due to the existence of four upstream gauges and one downstream gage fig 3c the second case study focuses on the east fork san jacinto river the major river in this watershed that flows from north to the south of the watershed since the upstream cross sections of this river system are ungauged this case study is categorized as a semi gauged river system fig 3d hurricane harvey is the second costliest natural disaster in the history of the united states that caused 125 billion in damage and over 100 fatalities according to the national hurricane center https www nhc noaa gov data tcr al092017 harvey pdf harvey hit texas on august 25 2017 as a category 4 storm and caused extensive flooding over houston and the surrounding area on august 26 28 the unprecedented precipitation in this area caused an extreme flooding condition that exceeded the 1000 year flood in many locations which is partially attributed to anthropogenic effects committee on urban flooding in the united states et al 2019 gori et al 2020 2019 jonkman et al 2018 juan et al 2020 mobley et al 2019 sebastian et al 2019 van oldenborgh et al 2017 in addition to hurricane harvey we simulate the river hydrodynamics for another flood event that inundated cypress creek case study 1 in late may and early june of 2016 fig 4 illustrates the hourly hyetographs and hydrographs of both flood events the total precipitation during the flood 2016 was around 460 mm which was less than 760 mm rainfall fallen over the watershed during the harvey 2017 as a result harvey 2017 caused a massive flood with a peak flow of over 800 cm compared to flood 2016 that generated two peak flows of around 300 cm however the flash flood impacts resulting from instantaneous precipitation of 32 mm h for flood 2016 were significantly higher compared to harvey 2017 that experienced less than 20 mm h rainfall over a longer duration of time fig 4 these two different flood mechanisms provide a unique opportunity to separately investigate the impacts of vertical flux and lateral flow bc components for each type of flooding in the first case study the hydrologic bias component is zero because the system is fully gauged and no hydrologic model is used the main challenge in this system is to divide the total deficit between lateral flows and vertical fluxes therefore parameter c is tuned to find the contribution of these two components in the second case study we couple wrf hydro to the hec ras 2d the hydrologic bias is an important component that should be considered during the boundary conditioning in this system the lateral flows are directly estimated by the hydrologic model and there is no need to cope with tuning the parameter c in order to validate the flood model results the simulated water stage and discharge are compared with observations at internal usgs gauges and two commonly used performance measures namely kling gupta efficiency kge and root mean square error rmse are reported moreover the maximum simulated flood extent map of hurricane harvey generated by taking the union of flood inundation maps over the simulation period is validated via reference maps these reference maps were generated in the immediate aftermath of the harvey flood events using geospatial analyses on the available high water marks and usgs gauges observations in the region watson et al 2018 to validate the simulated flood extent areas we use the fit measure defined as the ratio of the intersection to the union of reference and simulated inundation areas alfieri et al 2014 jafarzadegan and merwade 2017 3 1 case study 1 lisflood fp model in a fully gauged river system lisflood fp is a commonly used hydrodynamic model for flood inundation mapping due to its acceptable performance in past studies altenau et al 2017 aronica et al 2002a bates and de roo 2000 néelz and pender 2013 savage et al 2016a wood et al 2016 in this study we use the subgrid solver the most advanced option in lisflood fp used for simulating the propagation of flow along the channel neal et al 2012 the subgrid solver has the potential to simulate floods with coarse resolution dems while the resolution of channel width is finer than dem this feature is advantageous when fast and efficient flood inundation mapping is desirable to set up the model a 30 m dem together with the river information including the channel and floodplain roughness average channel width cross section shape and channel bed elevation are used as inputs to estimate the channel bed elevations we lower the dem cells underneath rivers with a constant offset parameter until the base flow of simulated hydrograph matches with the observed flows since floodplain roughness is not that sensitive to lisflood model results we set it to 0 06 with no calibration di baldassarre et al 2009a average channel widths are estimated from the satellite images capturing the rivers on a dry day and rectangular shapes are assumed for the cross sections the channel roughness values mostly lie within the range of 0 035 0 055 for flood inundation modeling hall et al 2005 horritt and bates 2002 wood et al 2016 we set up 30 model configurations corresponding to 6 different bc scenarios and 5 channel roughness parameters 0 035 0 04 0 045 0 05 and 0 055 the first bc scenario is the original case referring to the use of upstream and downstream flows as the only bc components in the model in the next five scenarios we apply new bcs to investigate the potential improvements using eq 7 the deficit for the original scenario standard bc is found to be 37 1400 out of 3700 cm and 49 930 out of 1920 cm of the downstream flows for harvey 2017 and flood 2016 respectively the high values of deficit for both flood events show that the system needs bc corrections since there is no hydrologic model to estimate the lateral flows parameter c is defined to test the contribution of lateral flows and vertical fluxes in the new bc set the second scenario assigns the total deficit to the vertical flux component c 0 the third fourth and fifth scenarios assign 0 25 0 5 and 0 75 of the deficit to lateral flows and the remaining to the vertical fluxes respectively finally the last scenario assumes that the total deficit belongs to lateral flows c 1 using a one month warm up period the model is run for a simulation period of 30 days starting from august 13 to september 12 fig 5 presents the calibration results of the 30 model simulations that include different combinations of channel roughness parameters and bc scenarios in an rmse kge space the first row fig 5a and b investigates the model performance for simulating harvey 2017 while the second row fig 5c and d focuses on the flood 2016 the first fig 5a and c and second fig 5b and d columns also report the performance of simulated water surface elevation and discharge at the internal gage respectively for harvey 2017 the correction scenarios significantly improve the model performance for both wse and discharges however finding an optimum configuration point is slightly challenging due to the conflicts that exist between kge and rmse as well as wse and discharge performances the rmse measure is highly sensitive to the existence of time lag between simulation and observations while kge focuses on capturing the peak regardless of the time lags that may exist considering kge as the main priority the discharge performance in fig 5b shows that assigning the major portion of the deficit to the lateral flow c 0 75 and c 1 provides better performance fig 5a also confirms that c 0 75 or c 1 with a higher channel roughness of 0 05 or 0 055 provides the highest kge among all configurations we finally pick c 0 75 with channel roughness of 0 055 as the optimum point c 1 and roughness of 0 055 is another acceptable choice that provide kge 0 9 for both wse and discharge performances the performance of lisflood fp for simulating the flood 2016 is completely different fig 5c shows that the original scenario with a 49 deficit performs better than some scenarios with no deficit c 0 75 and c 1 this shows that assigning a huge amount of deficit to the lateral flows can exacerbate the results on the other hand using c 0 and assigning all the deficit to the vertical fluxes is shown to be the best scenario for this event fig 5c and d therefore here we pick c 0 and channel roughness of 0 055 as the optimum point that generates kge 0 9 for the wse performance to test the impacts of applying the new bc set we run the model with three model configurations the first one uses the original bc with upstream and downstream flows while the second configuration takes advantage of adding lateral flows and vertical fluxes with c 0 75 the optimum point picked from fig 5 the third model configuration is a build in option of the lisflood fp model where the distributed rainfall is added over the entire domain this option uses precipitation data directly into the model and estimates the lateral flows during the routing process using this option there is no need to separately add lateral flows and precipitation components so that the model is set up with the original upstream downstream bcs and a distributed grid of rainfall data over the watershed fig 6 illustrates the direct comparison of these three configurations referred to as original corrected and rain on grid for both events of harvey 2017 fig 6a and b and flood 2016 fig 6c and d in both flood events the original configuration underestimates the peak of wse and discharge while the rain on grid option slightly outperforms the corrected configuration in terms of capturing the peak of wse fig 6a it highly overestimates the peak of discharge fig 6b for flood 2016 the rain on grid option poorly overestimates both wse and discharges while the corrected configuration compensates for the existing underestimations in the original configuration and performs far better than the rain on grid option overall the comparison of results for these two different flood events demonstrates that the rain on grid option is only beneficial for those floods that lateral flows are dominant in the system e g harvey 2017 with c 0 75 on the other hand when the flash flood impacts dominate the system e g flood 2016 with c 0 and lateral flows are not a critical item this option performs poorly another disadvantage of the rain on grid is its inefficiency as the computational run time for this option was around ten times longer than original and corrected configurations comparing to this option our proposed approach corrected is more generic robust and efficient unlike the rain on grid option that is only available for a few hydrodynamic models e g lisflood fp and hec ras 2d our proposed approach can be applied to a wide range of hydrodynamic models generality the computational time i e efficiency of our approach is identical with the original case and finally it is a robust approach because we try to maintain the conservation of mass in the system and the type of flood event does not significantly affect the modeling performance lastly we display the maximum flood inundation extents provided by both original and the proposed bc approach in fig 7 as can be seen adding lateral flows and vertical fluxes c 0 75 components to the original bc improves the fit measure of inundation mapping by 10 percent which is a significant improvement looking into the middle parts of the river also shows how the flooded regions underestimated by the original bcs in the top panel original case have been corrected when the additional bcs were included in the lower panel 3 2 case study 2 hec ras 2d model in a semi gauged river system in this case study there is no gage to provide the upstream flows for the river flow analysis thus it is required to perform coupled hydrologic hydrodynamic modeling here we use wrf hydro model outputs available from the study conducted by abbaszadeh et al 2020 they performed a multi gage calibration of the wrf hydro model for hurricane harvey in the san jacinto watershed the model was simultaneously calibrated over 4 usgs gauges 08 070 500 08 071 000 08 072 000 and 08 071 280 including the downstream gage in our case study 08 070 200 in order to properly link this model with hec ras 2d the performance of calibrated wrf hydro on the downstream gage of this river system is evaluated fig 8 the kge value and the simulated hydrograph after the calibration in fig 8 indicate that the model is biased and it underestimates the peak flow during harvey using eq 10 the wrf hydro bias over 30 days simulation period is found to be around 36 of the downstream flow 2500 out of 6800 cm this is a considerable bias that shows the importance of incorporating the hydrologic bias component into the bc set and updating the flows before running the hec ras 2d model hec ras 2d is the product of the united states army corps of engineers hydrologic engineering center brunner 2002 usace 2015 developed for two dimensional simulation of flows in the river system this model uses the 2d mesh as the unit of computations assuming that the flow characteristics can vary across the channel therefore the model solves 2d saint venant equations which require more computational resources to set up the model a 10 m dem obtained from the national elevation dataset ned is used https catalog data gov dataset usgs national elevation dataset ned as the terrain data and the 2d flow area that includes 2d meshes are delineated over the river system to calibrate the model we run 100 simulations considering a feasible range of 0 02 0 1 and 0 025 0 2 for the channel and floodplain roughness parameters respectively aronica et al 2002b 1998 di baldassarre et al 2009b we avoid using distributed parametrization over the domain as it may not improve the modeling performance liu et al 2019 and it also increases the complexity and the degree of freedom in modeling which is in contrast to our efficient modeling approach according to the calibration results we finally set the channel and floodplain roughness values to 0 03 and 0 1 respectively similar to the first case study the impact of channel bathymetry is considered by defining an offset parameter that equally lowers the cell values of dem at river locations we manually fine tune the offset parameter until the simulated water stage fit with the base flow of observations fig 9 illustrates the contribution of different boundary condition components before and after bias correction fig 9a shows that adding the lateral flows and vertical fluxes creates a new hydrograph that removes the deficit compared to the simulated downstream hydrograph the lateral flows and vertical fluxes show an almost equal contribution of 20 which results in a deficit of 40 in this case study 2750 out of 6800 cm fig 9b as mentioned before there is approximately 36 hydrologic bias in the system and it should be removed through the bias correction step using eqs 14 20 the upstream and lateral flows are updated with bias correction the vertical fluxes are also added to the bcs using eqs 21 and 22 fig 9c and d show the time series and the overall contribution of bc components after the bias correction respectively the final bc set total inflow that includes the bias corrected upstream bias corrected lateral flows and vertical fluxes provides appropriate forcing data for the river system as expected the updated inflow has some lags to explain the flood wave propagation from upstream to downstream of the system in this case study we set up 6 model configurations corresponding to different bcs the first scenario namely o refers to the original setup where only the upstream and downstream flows are used in the second scenario referred to as o b the bias component is also added so that the upstream flows are first bias corrected and then used in the modeling setup the third scenario referred to as o l considers the lateral flows and the upstream flows as the bc components in the next scenario referred to as o v the bcs include vertical fluxes and upstream flows the fifth scenario uses the r o g an additional boundary conditioning option in the hec ras 2d model that allows the modeler to avoid adding lateral flows and directly input the gridded rainfall data over the entire watershed similar to case study 1 we consider r o g as an appropriate bc option in the hec ras 2d model which helps us investigate how our proposed bc approach stands in relation to this scenario the last scenario namely o l b v includes all three new bc components of hydrologic bias lateral flow and vertical flux which represents our proposed bc approach corrected fig 10 a f compare the performance of simulated water stage hydrographs when a new bc component bias lateral or vertical is added to the original bc at both upstream fig 10a c and downstream fig 10d f gauges results at both gauges confirm that the bias component only raises the peak of the hydrograph without changing its shape on the other hand the vertical component has the highest contribution in widening the hydrograph and removing the time lag the lateral component stands in the middle as it partially raises the peak and slightly widens the hydrograph the comparison of kge and rmse values also demonstrates the key role of the vertical flux component that provides the highest improvement in performance measures compared to bias and lateral flow components fig 10g h illustrate the performance of simulated water stage hydrographs using the r o g option in hec ras 2d and the proposed approach corrected that includes all three bc components of bias lateral and vertical at upstream fig 10g and downstream fig 10h gauges both bc approaches generate acceptable results with high accuracy of kge 0 88 0 89 at the first gage and kge 0 93 at the second gage the r o g option replicates the shape of the hydrograph slightly better than corrected while our proposed approach estimates a higher peak in fig 10i we compare the performance of all 6 model configurations for floodplain mapping the fit measure represents the accuracy of simulated floodplain maps compared to the reference map the results show that the proposed approach following with the o b and r o g options provide the highest performance with 86 82 5 and 76 respectively for floodplain mapping the accurate estimation of the peak is more important than replicating the shape of the hydrograph therefore despite the weak performance of o b due to high time lag this option performs well in simulating the maximum flood extent as it predicts the peak of the hydrograph accurately similarly our proposed approach performs better than the r o g option as it makes a more accurate estimation of the peak hydrograph overall to select the best model configuration both criteria namely an accurate simulation of peak and shape of the hydrograph is required capturing the peak helps to improve the estimation of maximum flood extent areas which is critical for emergency response managers during extreme cases like harvey in addition a proper simulation of the river hydrodynamics for correct estimation of flood inundation areas which vary over time is crucial for devising reliable and on time evacuation strategies considering these facts we pick our proposed approach as the best model configuration as it provides a robust and reliable estimation of both water stage hydrograph fig 10a h and maximum flood extent areas fig 10i fig 11 illustrates three maximum flood extent maps generated by the original original bias and corrected bcs the comparison of flood extent maps in fig 11a c demonstrates the fundamental role of applying the proposed bc approach as it increases the fit measure by 20 however fig 11b shows that the majority of underestimations can be corrected by bias correction and the lateral and vertical components only improve the fit measure by 3 this is consistent with the results of fig 10 where the bias correction significantly improves the accuracy of the peak of stage hydrographs the pivotal role of vertical and lateral components will be in the correct simulation of river hydrodynamics and the estimation of the temporal variation of flood inundation areas can be highly erroneous without considering these two components 4 discussion 4 1 contribution of lateral flow vertical fluxes and bias correction from the joint calibration of the lisflood fp model in the first case study we found that the lateral flows are more effective than the vertical fluxes component for harvey flood c 0 75 or c 1 on the other hand the flash flood in 2016 shows the dominant role of vertical fluxes c 0 where assigning major deficit to lateral flows can exacerbate the results these results demonstrate the critical role of parameter c for finding the best contribution of lateral flows and vertical fluxes therefore it is highly recommended to tune this parameter for future flood events as it helps better understand the mechanism of an upcoming flood if it is dominated by flash flood impacts or lateral flows and improves the simulation of river hydrodynamics looking into the performance measures estimated before and after bc corrections revealed significant improvements in the accuracy of flood model simulations for both case studies in the first case study the kge improved by 0 1 and 0 4 for the stage and discharge hydrographs respectively and the fit measure improved by 10 in the second case study the bias correction improved the kge by around 0 1 for both gauges and the fit measure increased by 17 then adding the lateral and vertical components the kge improved by around 0 2 and 0 3 at upstream and downstream gauges respectively while the fit measure had a small improvement of 3 these results highlight the crucial role of lateral and vertical components in correcting the shape of hydrographs and removing the time lags for better simulation of inundation dynamics over time on the other hand the bias correction highly improves the prediction of hydrograph peak and maximum flood extents 4 2 robustness and efficiency of the proposed bc approach to investigate the robustness of the proposed bc approach we selected two hydrodynamic models lisflood fp and hec ras 2d two study areas and two flood events and evaluated the model performances for both fully gauged and semi gauged river systems in our experimental design efforts were made to demonstrate that the proposed bc approach can be generalized for various cases and is independent of the model structure the geographic location and the type of flood event it should be noted that we did not specifically focus on an ungauged system in this manuscript because the overall guidelines for applying the proposed bcs to an ungauged system are similar to semi gauged systems the only difference is related to hydrologic bias estimation where observed flow in eq 10 is not available in this case one solution is to apply a regionalization technique clustering gauges based on their climatic physiographic characteristics and find hydrologically similar gauges estimate the total flow over the entire period of the flood using those gauged areas that are hydrologically similar to the river system of interest jafarzadegan et al 2020 jafarzadegan and moradkhani 2020 and then use eq 10 to determine the total bias after estimating the bias component the downstream flows should also be bias corrected eqs 16 and 20 in general the lack of data in ungauged areas is a common hydrological issue that downgrades the accuracy of analysis and poses significant uncertainty thus the reliability of the proposed bc approach for an ungauged case is completely dependent on the quality of statistical analysis and regionalization techniques used to estimate the total flows at the downstream side of the channel once the bias is estimated at the downstream side in an ungauged case we follow the same procedure used to correct the bcs in the semi gauged cases in another investigation we compared the performance of the r o g option with the proposed bc approach for both harvey and flood 2016 the r o g option performs well for the simulation of harvey 2017 but it highly overestimates the water stage for flood 2016 this shows that the r o g option is a reliable option only for those floods that are dominated by lateral flows while our proposed approach is more robust as it can provide accurate simulation for different types of floods the significantly higher run time of the r o g option around ten times and the fact that it is only available for two specific hydrodynamic models lisflood fp and hec ras 2d are other disadvantages of this option compared to our proposed bc approach which is more efficient and generic finally while the r o g option only accounts for the precipitation our proposed approach considers precipitation together with other vertical fluxes including evaporation groundwater seepage and infiltration which results in a more comprehensive representation of the hydrological and physical processes in the channel 4 3 potential errors limitations and future work the fit measure values in the second case study were higher than the first one mostly due to the use of a finer dem resolution of 10 m compared to the 30 m dem used in the first case study another reason could be due to neglecting several bridges that exist along the cyprus creek in case study 1 that cause backwater effects and increase the wse in the channel recent studies demonstrate that during extreme floods the overbank flows in the upstream portion of cypress creek spills into the neighboring catchment addicks reservoir basin gori et al 2019 sebastian et al 2019 this inter basin overflow is a complex hydraulic phenomenon that can change the mass balance in the system and neglecting it can pose additional errors during the modeling despite significant improvements both models still underestimate the discharge water stage and flood extent areas for the harvey flood event especially in the first case study the assumptions made for simplifying the estimation of river geometry e g bathymetry and rectangular shape of channels and the medium resolution dem 10 30 m used in this study are potential reasons for underestimation in the r o g option sometimes a loss function is applied as a reduction on the spatial precipitation before running the hydrodynamic model here we chose to ignore this function as the selection of the loss function poses additional uncertainty and adds more complexity to the problem adding this function is expected to reduce the errors for flash flood 2016 while deteriorates the results for harvey 2017 finally this article limits the scale of the study area to a single main channel and ignores the dynamics of other river tributaries while the reference flood map captures the inundated tributaries before entering the main channel therefore a high percentage of the underestimation can be seen near the intersection of tributaries and the main channel to better replicate the reference floodplain map a larger scale modeling is required where all river tributaries are included in the study area it is also worth mentioning that the reference flood map is not a perfect observation and is prone to uncertainties as it is created from the interpolation of hwms thus it is normal to see some discrepancies between the simulated and reference flood maps due to their difference in type and scales it should be noted that although all these solutions can improve model accuracy they negatively affect model efficiency conducting a detailed analysis of the system by using fine resolution data e g lidar and advanced physically based models to reach the maximum accuracy is not within the scope of this study on the other hand this study was motivated to propose a solution that maintains model efficiency using the minimum amount of available data while increasing the model accuracy finally the deficit calculated from the subtraction of upstream and downstream flows represents the degree to which adding lateral flows and vertical fluxes are important for a flood event with a negligible deficit accounting for proposed bcs may not be necessary while the larger deficit demonstrates the higher importance of including lateral flows and vertical fluxes intuitively it is hypothesized that the size of the domain has a positive relationship with the value of deficit as for a larger scale problem with longer rivers we expect more deficit this highlights the key role of the proposed approach for large scale problems where lateral flows and vertical fluxes have more impacts on the mass balance in the system however to validate this hypothesis it is recommended to test the sensitivity of the proposed approach to different river sizes domain scales in future studies 5 conclusion this study highlighted one of the main limitations associated with the boundary conditioning of hydrodynamic models and proposed a new bc approach to improve the overall performance of flood inundation modeling during extreme events the proposed approach adjusted added lateral flows and vertical fluxes as boundary conditions of the channel and incorporated hydrologic bias impacts into the hydrodynamic model setup first a river system was categorized into three groups of fully gauged semi gauged and ungauged systems then detailed steps for the calculation of these three bc components were provided to test the importance and impacts of these bc components two case studies were defined for simulation of hurricane harvey flood in 2017 and a flash flood in 2016 the first case study was a fully gauged system where the lisflood fp model simulated both harvey and flood 2016 events and the second case study was a semi gauged system with one downstream gage where the hec ras 2d model simulated the harvey flood the main message of this manuscript is that before running the hydrodynamic model with upstream downstream boundary conditions it is judicious to estimate the water deficit between upstream downstream flows over the whole period of flooding distribute the deficit between lateral flows and vertical fluxes eq 7 and finally use the calculated lateral flows and vertical fluxes as additional boundary conditions of 2d hydrodynamic models these simple tasks are commonly ignored in practice so that the modeler uses the raw data as upstream and downstream bcs and then plays with model parameters to fit the simulated results to reference data because parameters of hydrodynamic models namely channel and floodplain roughness or river geometry information are physically meaningful numbers the best strategy is to avoid using unrealistic model parameters with a poor model setup instead the main effort should go into improving the model s physicality by updating the boundary conditions before performing any model parametrization additionally our case studies demonstrated that poor boundary conditioning cannot be compensated for any unrealistic parametrization in extreme cases such as harvey and it is required to first check the mass balance over the whole period of flooding correct the bcs and then tune the model parameters accordingly keypoints a new boundary conditioning approach is proposed to improve the accuracy of flood inundation modeling mass balance is conserved in river systems by adjusting adding lateral flows and vertical fluxes as well as incorporating hydrologic bias into the hydrodynamic model setup the maximum flood extents of hurricane harvey simulated by the lisflood fp and hec ras2d models are improved by 10 and 20 respectively credit authorship contribution statement keighobad jafarzadegan conceptualization methodology software validation writing original draft visualization atieh alipour methodology software validation keyhan gavahi validation visualization hamed moftakhari validation writing review editing hamid moradkhani conceptualization writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement partial financial support for this study was provided by the usace award a20 0545 001 all the data used in this study including the gage streamflow and water stage data and the dems are publicly available from the usgs website and national elevation dataset ned the reference flood maps provided for hurricane harvey are available from the usgs report at https pubs usgs gov sir 2018 5070 sir20185070 pdf 
227,integrated surface subsurface hydrological models isshms are increasingly being used for the assessment of contaminant transport in the environment in addition to their more common use in water flow applications however the subsurface solute transport solvers in these models are prone to numerical dispersion errors numerical dispersion is a well known issue in groundwater modeling but its impacts on the results of isshm simulations are still poorly understood in this study the catchment hydrology cathy model is used to assess the potential impacts of numerical dispersion on the simulation of coupled surface subsurface solute transport we first simulate the subsurface transport of a nonreactive tracer in two soil column test cases 1d and 3d with known analytical solutions the subsurface solute transport solver in cathy adopts a computationally efficient time splitting technique whereby the advection component of the governing equation is solved on elements and the hydrodynamic dispersion component is solved on nodes comparison between simulation results and analytical solutions with different mesh discretizations and different values for the hydrodynamic dispersion coefficients allows for accurate quantification of the numerical dispersion error and yields insights into the parameters and other factors that control it it is shown that taken alone the advection and dispersion solvers are very robust but their combination can result in significant numerical dispersion stemming from the exchange of concentration information from elements to nodes and vice versa in the time splitting procedure the tests also show that these errors can be kept under control by ensuring that the grid péclet number is in the range 0 5 1 0 or smaller we then apply cathy in a third test case involving two synthetic hillslopes concave and convex in fully coupled surface subsurface mode in order to examine the impact of this subsurface numerical dispersion on simulated streamflow hydrographs in particular with reference to pre event water contributions to runoff here as well the results show that the effect of numerical dispersion can be controlled by keeping the grid péclet number sufficiently small this work provides a new set of benchmark test cases for integrated surface subsurface hydrological models extending to solute transport the flow only suite of benchmarks recently published in two intercomparison studies keywords numerical modeling solute transport numerical dispersion cathy model 1 introduction contaminant transport in aquifers is a relevant environmental issue given that most of the earth s readily available freshwater is found in the subsurface poeter et al 2020 numerical models of groundwater flow and solute transport are thus fundamental tools for sustainable water resources management thanks to their ability to simulate the spatiotemporal evolution of contaminant plumes in a broad range of scenarios with variable external forcing including climate change and land use change however numerical models can be affected by significant uncertainties typically due to an imperfect knowledge of model parameters and initial and boundary conditions as well as errors due to their inherent spatiotemporal approximations one type of numerical error that can have a large impact on the accuracy of a model is numerical dispersion this is a well known problem e g noye and hayman 1985 gresho and sani 1998 woods et al 2003 that potentially leads to erroneous transport equation solutions that are characterized by a degree of solute spreading greater than that ascribable to the hydrodynamic dispersion coefficients in the case of reactive contaminants numerical dispersion can also lead to an overprediction of the degradation process because of artificial mixing of the considered pollutants bause and schwegler 2013 numerical dispersion is generally introduced into a model through stabilization techniques such as upwind schemes whose aim is to reduce sharp front oscillations in the solution at the expense however of added mass spreading this issue has been investigated in detail in several studies that assess the numerical dispersion arising from different discretization methods e g radu et al 2011 or that propose techniques to alleviate this error e g suciu et al 2013 wu et al 2019 pathania et al 2020 despite its recognized importance however numerical dispersion in groundwater solute transport modeling has received little attention in the water resources literature and it is seldom discussed as a potential source of error in modeling applications watson and barry 2001 woods et al 2003 recently developed integrated surface subsurface hydrological models isshms such as catchment hydrology cathy camporese et al 2010 hydrogeosphere hgs brunner and simmons 2012 and mike she long et al 2015 are being increasingly used not only for catchment scale flow applications but also for coupled simulations of solute transport in the surface subsurface continuum e g liggett et al 2015 scudeler et al 2016b daneshmand et al 2019 gatel et al 2019 isshms typically simulate subsurface flow by means of the 3d richards equation or a combination of 1d richards and 3d saturated groundwater flow equations coupled with some approximation of the shallow water equations for surface runoff and channel flow the computed subsurface and surface velocity fields are then applied to solve the advection dispersion and sometimes reaction equations in the corresponding domains thereby providing a holistic approach to flow and solute transport modeling at the catchment or hillslope scale mike she for instance was recently applied to a semi arid catchment in southwestern victoria australia for studying salinity issues and their possible future evolution due to climate change daneshmand et al 2019 hgs was applied to the wetlands of the lehstenbach catchment in southeast germany characterized by high concentrations of dissolved organic carbon liggett et al 2015 and cathy was applied to reproduce and interpret a laboratory experiment involving the transport of both reactive solutes and conservative tracers gatel et al 2019 and an experiment conducted at the landscape evolution observatory leo in arizona usa using deuterium as a tracer scudeler et al 2016b these applications demonstrate the great potential of isshms as powerful tools for the simulation and analysis of real world solute transport processes in the surface and subsurface however none of these studies has addressed the possible impacts that numerical dispersion may have on solute transport simulated by isshms in cathy for example numerical dispersion is created not only by the model discretization but also by the use of a time splitting technique for the solution of solute transport in the subsurface whereby advection is solved on the elements and dispersion on the nodes mazzia and putti 2005 this scheme makes the solver numerically robust and computationally efficient but passing the computed concentration distribution back and forth between elements and nodes causes a numerical artifact that as we will demonstrate manifests as a particular form of numerical dispersion for this reason with the exception of scudeler et al 2016b in all previous studies of solute transport with cathy weill et al 2011 scudeler et al 2016a gatel et al 2019 2020 either the dispersion coefficients were assigned negligible values or the dispersion module was switched off the goals of this study are i to accurately quantify the numerical dispersion affecting the solute transport subsurface solver of cathy and relate this dispersion to grid and flow characteristics ii to evaluate how the numerical dispersion may affect the simulation of coupled solute transport in the surface subsurface continuum first the cathy model is used to simulate two soil column test cases with known analytical solutions the first test case represents a one dimensional solute transport process while the second takes into account fully three dimensional solute plume dynamics the comparison between numerical results and analytical solutions in a number of runs with different grid resolutions and coefficients of hydrodynamic dispersion provides a comprehensive range of conditions for the evaluation of the possible impacts of numerical dispersion in cathy which can by extension be applicable to other isshms in a third test case cathy is used to simulate the two idealized hillslopes presented in liggett et al 2014 one with a concave profile and the other convex in a series of coupled surface subsurface solute transport runs these simulations are used to compute the amount of pre event water at the discharge outlet and to assess the impact of numerical dispersion on this runoff the simulations are run for a scenario of no surface subsurface mixing i e with advection only exchange of solute between the surface and subsurface and for a scenario of perfect mixing in which diffusive surface subsurface solute exchange is also activated in both scenarios different combinations of subsurface transport parameters are analyzed 2 methods 2 1 the cathy model the cathy model camporese et al 2010 weill et al 2011 scudeler et al 2016b is a physically based model for the simulation of coupled surface and subsurface water flow and solute transport the model solves the three dimensional richards equation for variably saturated porous media and the one dimensional diffusive wave approximation of the saint venant equations 1 s w s s ψ t ϕ s w t k s k r ψ η z q s s 2 q t c k q s d h 2 q s 2 c k q s in equation 1 sw θ θ s is the water saturation θ being the volumetric moisture content and θ s the saturated moisture content generally equal to the porosity φ ss is the aquifer specific storage l 1 ψ is the pressure head l t is time t is the gradient operator l 1 k s is the tensor of saturated hydraulic conductivity lt 1 kr ψ is the relative hydraulic conductivity η z 0 0 1 t z being the vertical coordinate directed upward l and qss is a source positive or sink negative term l3l 3t 1 that generally represents exchange fluxes from the surface to the subsurface in equation 2 s is the longitudinal coordinate system used to describe the overland channel network l q is the surface discharge l3t 1 ck is the kinematic celerity lt 1 dh is the hydraulic diffusivity l2t 1 and qs is the inflow positive or outflow negative exchange rate from the subsurface to the surface l3l 1t 1 consistent with the flow module solute transport in cathy is modeled with a three dimensional advection dispersion equation and a one dimensional advection diffusion equation for the subsurface and the surface respectively 3 θ c t u c d c q t s s 4 q m t c t q m s d c 2 q m s 2 c t q t s where c ml 3 is the solute concentration u lt 1 is the darcy velocity vector d l2t 1 is the tensor that accounts for mechanical dispersion and molecular diffusion qtss ml 3t 1 is a solute mass source positive or sink negative term qm mt 1 is the solute mass discharge ct lt 1 is the kinematic solute celerity dc l2t 1 is the surface solute diffusivity and qts ml 1t is the solute mass inflow positive or outflow negative exchange rate from the subsurface to the surface the subsurface transport equation 3 is solved using a computationally efficient time splitting technique mazzia et al 2000 whereby the advection part is solved with an explicit finite volume scheme and the obtained concentration field is used as the initial condition for the dispersion part solved with an implicit finite element scheme weill et al 2011 therefore simulated concentration values are transferred back and forth from elements tetrahedra in cathy to nodes at every time step 2 2 model setup 2 2 1 soil column test cases the first two test cases involve water flow and solute transport in the subsurface only the computational domain is meant to represent darcy s experiment i e a column packed with a saturated homogeneous granular medium two types of simulation are run in the first test case a one dimensional process of advection dispersion is reproduced while the second test case is focused on a fully three dimensional process different domain discretizations are used in the runs a fine discretization mesh 0 an intermediate one mesh 1 and a coarse one mesh 2 in the 1d analyses table 1 the size of the column domain is kept fixed and equal to 0 2 l 0 2 l for the square base and 1 0 l for the height in the 3d analyses table 2 the height of the colum domain is kept fixed together with the mesh resolutions while the size of the square base is increased to avoid the solute plume reaching the lateral boundaries the surface of mesh 0 consists of square cells of size 0 01 l in the x and y directions each subdivided into two triangles and then replicated vertically into 100 layers of constant thickness equal to 0 01 l to generate three dimensional tetrahedral grids such as the one shown in fig 1 similarly mesh 1 consists of square cells of size 0 02 l in the x and y directions with triangles replicated vertically into 50 layers of constant thickness equal to 0 02 l and mesh 2 is formed by cells of 0 04 l in the x and y directions with triangles replicated vertically into 25 layers of constant thickness equal to 0 04 l dimensionless units are used throughout these simulations for the sake of generality the time step size for the dispersion solver is kept fixed for all the simulations with a value of 0 001 t while the time step size for the explicit advection solver changes according to the courant friedrichs lewy condition whereby a courant number not exceeding 0 3 is prescribed mazzia and putti 2005 this is a core feature of the time splitting technique implemented in cathy to ensure numerical stability the courant number is expressed as u δ t δ x where u is the darcy flux δt is the advective time step size and δx is the characteristic element spatial scale equal to the element volume divided by its surface area 2 2 1 1 1d simulations in this test case a conservative tracer with concentration c 0 1 is introduced continuously over the entire top surface of the domain the initial concentration is zero everywhere and a steady state saturated flow from the top to the bottom is enforced through appropriate boundary conditions spatially uniform inflow on the top constant pressure head at the bottom and no flow across the lateral sides the resulting breakthrough curve concentration vs time at the column outflow is compared with the following analytical solution freeze and cherry 1979 5 c c 0 1 2 erfc l v t 2 d l t exp v l d l erfc l v t 2 d l t where erfc is the complementary error function l is the height of the column v is the average linear velocity i e darcy s flux divided by the porosity of the porous medium here equal to 0 58 and dl is the coefficient of hydrodynamic dispersion along the flow path in a first series of 1d simulations only the advective part of the cathy solver is activated in theory the solution in this case would be represented by a step function plug flow in reality some spreading of the breakthrough curve is expected due to numerical dispersion in order to quantify this error the best fit between equation 5 and the output concentration of cathy is used to obtain the model estimated or apparent dispersion coefficient dl radu et al 2011 this is done with the three meshes and for each mesh for three values of the darcy flux equal to 0 5 1 0 and 2 0 lt 1 in this series of runs since there is no hydrodynamic physical dispersion the apparent coefficient dl is entirely attributable to numerical dispersion in a second series of 1d simulations the dispersion part of the cathy subsurface transport equation is activated for each mesh four simulations are performed with a unitary input flow and different values of the hydrodynamic dispersion coefficient dl equal to 0 001 0 05 0 1 and 0 2 l2t 1 corresponding to grid péclet numbers p e v λ d l that range from 68 97 to 0 09 where λ is the element size high values of pe generally lead to high numerical dispersion simulations with pe 2 are purposefully considered here to test and quantify the numerical dispersion in cathy once again equation 5 is fitted with the output concentration of cathy in order to estimate the apparent dispersion coefficient dl 2 2 1 2 3d simulations in this test case a slug of tracer mass equal to 0 01 m is introduced over a single time step 0 001 t at the central node of the surface layer to approximate an instantaneous pulse injection compared with the 1d simulations the 3d analyses require a modification of the computational domain because for an accurate assessment of the transverse dispersion it is necessary to keep the solute far from the lateral boundaries for this reason the height of the soil column is kept fixed at 1 0 l while the square base is increased as reported in table 2 the cell resolution 0 01 l 0 02 l and 0 04 l for mesh 0 1 and 2 respectively as well as the vertical discretization are the same as in the first test case as in the 1d test case the mass of solute is carried away from the point of injection by transport in a steady state uniform flow field moving in the z direction however the concentration distribution is now fully 3d and can be expressed analytically by the following equation freeze and cherry 1979 6 c x y z t m 8 π t 3 2 d x d y d z exp x 2 4 d x t y 2 4 d y t z 2 4 d z t where m is the mass of the tracer introduced at the central node of the surface and dx dy and dz are the coefficients of hydrodynamic dispersion in the x y and z directions respectively the center of gravity of the tracer cloud lies at x 0 y 0 and z 0 where x x x 0 and y y y 0 with x 0 and y 0 being the x and y coordinates of the node at which the mass is introduced and z z v t with v the average linear velocity as defined for the 1d test case in the 3d test case the darcy flux is 10 times larger than in the 1d case in order to achieve a significant spreading of the solute plume within a short simulation of duration 0 025 t the apparent dispersion coefficients dl are again estimated by fitting the analytical solution to the numerical results to estimate these dispersion coefficients in the three directions it is sufficient to quantify the concentration distribution standard deviations σ x σ y and σ z as these are related to generic dispersion coefficients dx dy and dz according to σ x 2 d x t σ y 2 d y t σ z 2 d z t freeze and cherry 1979 the first series of 3d simulations is carried out with the dispersion solver activated but using a negligible value for the coefficients of hydrodynamic dispersion 1 0 10 9 l2t 1 equal in the three directions this is done in order to highlight the particular influence of the element to node and node to element exchange of information which only takes place when the dispersion module is switched on for each mesh three values of darcy flux are investigated equal to 5 0 10 0 and 20 0 lt 1 in the second series of 3d simulations the input longitudinal z direction hydrodynamic dispersion values are 0 05 0 1 0 2 and 0 5 l2t 1 with a fixed anisotropy ratio dz d x y equal to 5 the darcy flux for these simulations is 10 lt 1 2 3 hillslope simulations the third test case aims to simulate fully coupled surface subsurface processes in the two idealized hillslopes of liggett et al 2014 the first with a concave surface and the second convex fig 2 the length of the domain is 20 m the width is equal to 1 m and the height ranges from 8 m to approximately 10 m in both hillslopes the surface is discretized into 5 100 grid cells i e cells of size 0 2 m in the horizontal directions while the subsurface is discretized vertically into 40 layers with thicknesses ranging from 0 04 m at the top to about 2 m at the bottom the layers are parallel to the surface except for the last one which has a flat base fig 2 in these simulations we use real metric units in order to be consistent with liggett et al 2014 moreover we intentionally use a coarser grid to keep the computation time small and highlight the high cpu efficiency of the time splitting technique implemented in cathy no flow boundary conditions are applied for both hillslopes at the bottom and sides of the domain while the initial hydraulic head distributions were determined by running each hillslope model to steady state under a constant precipitation rate of 1 mm year 1 then a 1 h long rainfall event with precipitation rate equal to 20 8 mm h 1 is applied over the hillslopes followed by a 1 4 h long recession phase the soil is homogeneous and isotropic with hydraulic properties as reported in table 3 the main scope of this test case is to assess the impact of numerical dispersion on the simulated contribution of pre event water to the streamflow hydrograph for different combinations of subsurface transport parameters table 3 to this aim the rainfall water concentration is set to 1 kg m 3 while the initial solute concentration in the soil is 0 kg m 3 under these conditions the solute mass discharge at the outlet represents the contribution of event water while the pre event water fraction is simply assumed as its complement to the total discharge as in weill et al 2011 two series of simulations are run for both hillslopes wherein two different solute exchange mechanisms between the surface and subsurface are considered in the first series that of no surface subsurface mixing solute exchange between the surface and subsurface can only occur via advection in the second series perfect surface subsurface mixing it is assumed that at every time step there is complete mixing between solute mass in the surface water and in the first computational layer of the subsurface as described in gatel et al 2020 theoretically this corresponds to an instantaneous i e occurring at a time scale on the order of the time step size diffusive transport between the surface and subsurface 3 results 3 1 1d simulations 3 1 1 advection only fig 3 shows the analytical and model simulated breakthrough curves for the three meshes for the runs where darcy s flux is equal to one and the dispersion module is not activated since no dispersion is introduced as a model input any spreading out of the simulated breakthrough curves is entirely attributable to numerical dispersion which as expected is larger for the coarse mesh mesh 2 and decreases as the grid is refined it can be noted as well that the finite volume advection solver does not cause numerical oscillations at the solution front fig 4 shows the apparent dispersion coefficients dl obtained through the best fit of equation 5 to the simulated data as a function of the darcy flux and the element surface area the latter is a more suitable measure of grid size than a characteristic length since for the advection solver implemented in cathy the element faces are the fundamental support for the computation of fluxes mazzia and putti 2005 numerical dispersion in this case entirely captured by dl increases linearly with element size and it also increases with flow rate the corresponding apparent dispersivities computed as α l d l v l i e the longitudinal dispersivities that would be required to obtain an equivalent physical dispersion are always about two orders of magnitude smaller than the grid resolution indicating that advection only simulations in cathy are affected by a very small numerical dispersion 3 1 2 advection and dispersion the second series of 1d simulations involves activation of the subsurface transport dispersion module in cathy fig 5 shows the breakthrough curves simulated with the three meshes and four values of the physical dispersion coefficient compared with the corresponding analytical solutions similar to the advection only simulations the finest grid exhibits the breakthrough curve that best matches the analytical solution for all the dispersion coefficients however as the physical dispersion coefficient increases the simulated curves tend to be closer to each other indicating an increasingly marginal effect of numerical dispersion with respect to the physical dispersion introduced as model input the best fit coefficients of apparent dispersion dl are reported in table 4 for comparison with the physical input values the decreasing impact of numerical dispersion with increasing values of the hydrodynamic dispersion coefficients is especially apparent for mesh 1 as shown by the analysis of the average absolute error aae of the simulated concentrations with respect to the analytical solution table 4 in particular mesh 1 gives an aae that is more than three times larger than in mesh 0 for dl 0 05 l2t 1 but less than twice for dl 0 2 l2t 1 analyzing how the errors change with the theoretical grid péclet numbers i e computed with the physical dispersion coefficient dl associated to the three meshes in table 4 it can be noted that the numerical dispersion in this case remains at an acceptable level i e best fit dl close to input dl and low aae values for pe values smaller than approximately 0 5 3 2 simulations 3 2 1 negligible physical dispersion the 3d simulations with negligible input dispersion exhibit a significant spreading out of the solute plume larger than we could expect with such a small dispersion coefficient due to the time splitting numerical scheme which continuously transfers concentration information from elements to nodes and vice versa through a simple linear interpolation consistent with the finite element basis functions a first analysis of the concentration profiles along the three cartesian axes at the end of the simulation 0 025 t reveals that they well approach a gaussian function fig 6 the standard deviations of the fitted gaussian functions provide the best estimate of the apparent dispersion coefficients whose values averaged over the three directions x y and z are shown in fig 7 as a function of the element size as expected the apparent dispersion coefficient is much lower in the finer mesh 0 and increases with element size fig 7 also shows the impact of flow velocity on the numerical dispersion as in the 1d simulations the apparent dispersion coefficients increase with flux the corresponding apparent dispersivities result in values that are approximately equal to 0 1 0 2 and 0 3 times the grid resolution for mesh 0 mesh 1 and mesh 2 respectively i e about one order of magnitude larger than in the 1d advection only simulations highlighting the stronger numerical dispersion resulting from the use of the node based dispersion module in combination with the element based advection solver 3 3 advection and dispersion the second series of simulations for the 3d column test case is designed to assess at which point the numerical dispersion is no longer dominant compared to the physical dispersion fig 8 shows the relation between the grid péclet numbers evaluated using the theoretical dispersion coefficient and those computed with the apparent dispersion coefficient along the z direction using the simulated solute plume at time equal to 0 025 t the 45 degree dashed line represents the ideal case in which theoretical and apparent dispersion coefficients coincide i e zero numerical dispersion the closer the dots are to this line the more accurate the results of the simulations are examining the figure we see that the simulation results remain accurate as long as pe theoretical 1 in particular while model runs with mesh 0 exhibit a slight deviation from the dashed line starting from about pe theoretical 2 both mesh 1 and mesh 2 show more significant deviations from the analytical solution suggesting that numerical experiments should be designed to keep the grid péclet number smaller than one in order to keep numerical dispersion under control similar to the 1d dispersion model runs the 3d simulations show that the errors between the modeled concentrations and the analytical solution decrease as the input dispersion coefficient increases fig 9 also in line with the 1d simulations the error difference between the three meshes tends to decrease as the dispersion coefficient increases with dz 0 5 l2t 1 the three meshes converge to the same low value of concentration error to further assess the robustness of our analyses we carried out a brief sensitivity analysis on the time step size in order to verify whether the numerical dispersion arising from the transfer of concentration information between nodes and elements is affected by the number of times such transfer occurs taking as a reference the model run with mesh 0 and dz 0 05 l2t 1 we first decreased the dispersion solver time step to 0 0005 t 50 of the original time step and then increased it to 0 005 t five times the original time step in the former case the concentration aae increases by 33 with respect to the reference run while in the latter the aae decreases by 10 this would indeed suggest that the more times a transfer of information between nodes and elements occurs the more numerical dispersion affects the results however the very same sensitivity analysis carried out with mesh 0 and dz 0 5 l2t 1 i e a run where the grid péclet number is smaller than one results in negligible error changes with respect to the reference run this suggests that if the grid péclet number is small enough not only can numerical dispersion caused by the time splitting technique be kept under control but the simulation results are also robust with respect to the time stepping 3 4 hillslope simulations having determined a threshold on the grid péclet number that ensures reasonably accurate results in the subsurface domain we now analyze in the third test case how numerical dispersion affects coupled surface subsurface solute transport processes the simulations in the two hillslopes highlight how the contribution of pre event water to the total streamflow hydrograph varies with the transport parameters fig 10 a shows the total outflow and its pre event water fractions in the cases where no surface subsurface mixing is considered i e solute mass can be exchanged between the surface and the subsurface via advective fluxes only the black curve represents the total discharge while the fraction of pre event water is indicated by the colored lines unsurprisingly given the short time scale of the event when no mixing is considered the curves overlap each other i e the fraction of pre event water does not depend on the dispersion in the subsurface but only on the way the surface is partitioned between saturated and unsaturated areas such partitioning is only controlled by the flow parameters fig 10 b shows the results in the case of perfect solute mixing between the surface and subsurface in this case the mass discharge strongly depends on whether the subsurface hydrodynamic dispersion is activated or not in the advection only case cyan curve the dispersion module of cathy is switched off and the amount of pre event water in the total discharge is higher than in the corresponding scenario without surface subsurface mixing when very low dispersion see table 3 is introduced the dispersion module of cathy is switched on and the modeled fraction of pre event water jumps to very high levels at that point increasing the subsurface dispersion coefficient does not affect the solute mass discharge magenta green and yellow lines overlap each other except for the high dispersion run red line which exhibits a slightly higher pre event water fraction the simulation results for the convex hillslope are reported in fig 11 compared with the concave hillslope the main difference is that total discharge is smaller due to the smaller fraction of surface saturated area similar to the concave hillslope the pre event water fraction is basically independent of the subsurface transport parameters in the case of no mixing but strongly affected by the activation of the dispersion module in the case of perfect mixing the maximum grid péclet numbers attained in both the concave and convex hillslopes calculated from the input parameter values and the computed velocity field are about 16 16 1 6 and 0 16 for the very low low intermediate and high dispersion runs respectively comparing these pe numbers with the graph of fig 8 we note that the only simulations that are not expected to be dominated by numerical dispersion are those with intermediate and high dispersion the latter being the most accurate fig 12 shows the tracer concentration distributions at the end of the rainfall event in a portion of the hillslopes close to the outlet and for some selected scenarios figs 12 a and b representing the scenarios with advection only and mixing highlight how the solute remains confined within a shallow layer of soil leading to the highest fraction of event water i e smallest fraction of pre event water among all the mixing scenarios consistent with the hydrographs in figs 10 b and 11b the differences between the concave and convex hillslopes and mixing and no mixing scenarios are better appreciated when the dispersion module is switched on and a high input dispersion coefficient is used figs 12 c and e representing the concave hillslope high dispersion with mixing and no mixing scenarios respectively highlight the enhanced capability of the tracer to transfer from the surface to the subsurface when mixing is activated a similar effect although less evident due to the geometry can be seen for the convex hillslope in figs 12 d and f whereby the tracer is able to penetrate underneath the riverbed only when mixing is activated note that the color scale for panels a and b is different from the one for panels c d e and f in fig 13 we show the time series of solute mass balance terms for the same scenarios as fig 12 the cumulative total mass tot in introduced into the system 0 416 kg corresponds to the input concentration 1 kg m 3 applied via rainfall 0 0208 m h 1 for a duration of 1 h over a domain of surface area 20 m2 note that this is the mass into the whole system surface plus subsurface domains while the mass exiting the system tot out in these runs occurs only via the designated surface outlet cell fig 13 shows an excellent mass balance for all the scenarios indeed the solute mass balance error over the whole surface subsurface domain remains smaller than 0 5 from a process point of view panels c and d compared with panels a and b highlight how activation of dispersion with mixing increases the solute stored in the system thereby decreasing the amount of tracer that reaches the outlet whereas the deactivation of mixing as seen by comparing panels e and f with panels c and d results in a dramatic decrease in surface storage which translates to a corresponding increase of the solute tracer mass in the outflow 4 discussion integrated surface subsurface hydrological models paniconi and putti 2015 fatichi et al 2016 including cathy camporese et al 2010 are physics based numerical models increasingly used not only for water flow simulations in hillslopes and catchments but also for contaminant transport e g weill et al 2011 ligget et al 2015 scudeler et al 2016b daneshmand et al 2019 gatel et al 2019 for this reason it is important to understand and quantify how the numerical dispersion of solute transport in the subsurface modules of isshms can affect simulation results numerical dispersion depends mainly on the scheme used to solve the advection dispersion equation in the case of cathy a time splitting algorithm solves advection on elements by an explicit numerical scheme and dispersion on nodes with an implicit scheme this makes the solver numerically robust and computationally efficient but the continuous transfer of concentration information from nodes to elements and vice versa is known to lead to enhanced mass spreading weill et al 2011 gatel et al 2019 however this has never been quantified so far the first part of this study provides a useful quantification of the numerical dispersion in cathy by comparing well known analytical solutions with results from two soil column test cases 1d and 3d in a number of scenarios first with advection only or negligible physical dispersion and then including advection and dispersion the 1d simulations with advection only show the robustness of the advection numerical scheme implemented in cathy an explicit finite volume solver with numerical stability ensured by enforcing the courant friedrichs lewy condition mazzia et al 2000 the numerical dispersion in the 1d simulations remains very small for a range of grid resolutions and flow velocities with apparent dispersivity values that are at least two orders of magnitude smaller than the element size it should be noted that these advection only scenarios are useful in the analyses performed but are not intended as realistic test cases the 1d simulations with longitudinal dispersion show that activating the dispersion module potentially leads to significant numerical dispersion however this can be controlled by adjusting the mesh resolution to the input value of the longitudinal dispersion coefficient in order to maintain a grid péclet number smaller than 1 0 ideally 0 5 or less this condition on pe is a new criterion based on an experimental analysis of the time splitting solver in cathy which is more restrictive than the common limit of 2 0 e g diersch 2014 derived from the theoretical analysis of linear convective diffusive problems solved by standard fd or fem schemes the 3d simulations with the dispersion module activated but with negligible values of the dispersion coefficients reveal the strong numerical dispersion related to the transfer of concentration information from elements to nodes and vice versa in this case the numerical dispersion is characterized by apparent dispersivities of almost the same order of magnitude as the element size additional 3d simulations with longitudinal coefficients of dispersion as in the 1d case highlight that also in this case it is necessary to maintain the grid péclet number smaller than 1 0 in order to prevent the numerical dispersion from becoming dominant as a final remark on the soil column test cases we note that the solute mass balance error remains lower than 0 3 in all the model runs furthermore the concentration errors related to the dispersion module alone calculated in a number of simulations with flow equal to zero not shown here are three to five orders of magnitudes smaller than the corresponding simulations with advection and dispersion this combined with the fact that the numerical dispersion affecting the advection solver is also very small confirms that the main source of numerical dispersion in cathy is a particular numerical artifact arising from the time splitting scheme and its related exchange of information between nodes and elements in the third test case of this study the cathy model is applied to simulate the contribution of pre event water to the total streamflow hydrograph of two synthetic hillslopes in response to a rainfall event interesting insights can be gained by comparing our results with those reported by liggett et al 2014 who applied the hgs model to the same synthetic hillslopes for solute exchange between the surface and the subsurface hgs relies on a dual node approach whereby the mass flux is computed as the sum of advective and dispersive components liggett et al 2014 studied three different conditions i advection only in which the solute exchange across the surface subsurface interface occurs solely via advection ii advection diffusion in which molecular diffusion is also introduced and iii advection dispersion where mechanical dispersion is considered as well for each of these three conditions across the surface subsurface interface liggett et al 2014 simulated the different subsurface dispersion scenarios reported in table 3 our cathy simulations with no surface subsurface mixing broadly correspond to the advection only scenarios with hgs which in this case also shows that the pre event water contribution to the hydrograph does not depend on the subsurface dispersion parameters over the course of a single rainfall event the pre event water fractions simulated by cathy in the case of perfect surface subsurface mixing fall within the range spanned by the hgs simulations with advection dispersion in particular the subsurface advection only scenarios simulated by cathy closely mimic the results of hgs with very low or low dispersion while the numerical dispersion arising from the cathy time splitting technique makes the very low and low dispersions scenarios collapse onto the intermediate dispersion scenario this occurs because the order of magnitude of the numerical dispersion introduced when switching on the dispersion module is higher than the one related to the physical dispersion coefficient to the point that any modification of this coefficient does not influence the solute concentration until a threshold on the péclet number is reached this threshold here corresponds to a pe equal to 1 or less consistent with the criterion developed in the soil column runs this issue does not seem to affect the hgs model however the mesh resolution used here 0 20 m horizontally with 40 vertical layers is much coarser than the one used by liggett et al 2014 0 04 m horizontally with 400 vertical layers despite the much smaller number of computational nodes our simulations give similar results when numerical dispersion is not dominating thanks to the high cpu efficiency of the time splitting technique in summary this series of hillslope simulations shows that if the numerical dispersion related to time splitting is kept under control using the grid péclet number criterion discussed above the cathy model can provide robust solute transport predictions without the need for additional parameters such as a longitudinal dispersivity across the surface subsurface interface and with a relatively parsimonious grid discretization 5 conclusions we applied the cathy model to examine the main sources of numerical dispersion in the simulation of subsurface solute transport and how such dispersion might affect solute transport predictions in integrated surface subsurface hydrological models to this aim we first carried out a series of subsurface only simulations in two soil column test cases using known analytical solutions to accurately quantify the numerical dispersion affecting the model these simulations allowed us to define a more restrictive threshold value for the grid péclet number compared to typical values in standard fem codes to ensure a satisfactory solution accuracy pe should not exceed 1 or even better 0 5 then cathy was applied to two synthetic hillslopes in a series of fully coupled surface subsurface simulations to show the possible impacts of subsurface numerical dispersion on the prediction of the pre event water contribution to the total streamflow hydrograph overall this study provides quantitative recommendations for setting up integrated surface subsurface hydrological models that can control the effects of numerical dispersion on coupled solute transport simulations indeed based on the grid péclet number threshold and the expected range of dispersion coefficient the model user can define a proper grid size that will meet the criterion of pe smaller than 0 5 1 0 although the results presented here are strictly valid for the cathy model only the methodology proposed for the evaluation of numerical dispersion is general and therefore may be used in assessing any other isshm moreover the column test cases with 1d and 3d analytical solutions and the hillslope test case that has now been used in assessing two widely used isshms may have appeal as new benchmark problems for integrated surface subsurface hydrological models extending to solute transport the flow only suite of benchmarks reported in model intercomparison studies e g maxwell et al 2014 kollet et al 2017 credit authorship contribution statement beatrice gatto investigation writing original draft claudio paniconi conceptualization writing review editing paolo salandin writing review editing matteo camporese investigation conceptualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments b g acknowledges the support of her phd scholarship by unismart fondazione università degli studi di padova and alto trevigiano servizi s r l we also thank three anonymous reviewers for their useful and constructive comments which helped us to improve the manuscript supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 104060 appendix supplementary materials image application 1 image application 2 image application 3 image application 4 image application 5 image application 6 image application 7 image application 8 image application 9 image application 10 image application 11 image application 12 
227,integrated surface subsurface hydrological models isshms are increasingly being used for the assessment of contaminant transport in the environment in addition to their more common use in water flow applications however the subsurface solute transport solvers in these models are prone to numerical dispersion errors numerical dispersion is a well known issue in groundwater modeling but its impacts on the results of isshm simulations are still poorly understood in this study the catchment hydrology cathy model is used to assess the potential impacts of numerical dispersion on the simulation of coupled surface subsurface solute transport we first simulate the subsurface transport of a nonreactive tracer in two soil column test cases 1d and 3d with known analytical solutions the subsurface solute transport solver in cathy adopts a computationally efficient time splitting technique whereby the advection component of the governing equation is solved on elements and the hydrodynamic dispersion component is solved on nodes comparison between simulation results and analytical solutions with different mesh discretizations and different values for the hydrodynamic dispersion coefficients allows for accurate quantification of the numerical dispersion error and yields insights into the parameters and other factors that control it it is shown that taken alone the advection and dispersion solvers are very robust but their combination can result in significant numerical dispersion stemming from the exchange of concentration information from elements to nodes and vice versa in the time splitting procedure the tests also show that these errors can be kept under control by ensuring that the grid péclet number is in the range 0 5 1 0 or smaller we then apply cathy in a third test case involving two synthetic hillslopes concave and convex in fully coupled surface subsurface mode in order to examine the impact of this subsurface numerical dispersion on simulated streamflow hydrographs in particular with reference to pre event water contributions to runoff here as well the results show that the effect of numerical dispersion can be controlled by keeping the grid péclet number sufficiently small this work provides a new set of benchmark test cases for integrated surface subsurface hydrological models extending to solute transport the flow only suite of benchmarks recently published in two intercomparison studies keywords numerical modeling solute transport numerical dispersion cathy model 1 introduction contaminant transport in aquifers is a relevant environmental issue given that most of the earth s readily available freshwater is found in the subsurface poeter et al 2020 numerical models of groundwater flow and solute transport are thus fundamental tools for sustainable water resources management thanks to their ability to simulate the spatiotemporal evolution of contaminant plumes in a broad range of scenarios with variable external forcing including climate change and land use change however numerical models can be affected by significant uncertainties typically due to an imperfect knowledge of model parameters and initial and boundary conditions as well as errors due to their inherent spatiotemporal approximations one type of numerical error that can have a large impact on the accuracy of a model is numerical dispersion this is a well known problem e g noye and hayman 1985 gresho and sani 1998 woods et al 2003 that potentially leads to erroneous transport equation solutions that are characterized by a degree of solute spreading greater than that ascribable to the hydrodynamic dispersion coefficients in the case of reactive contaminants numerical dispersion can also lead to an overprediction of the degradation process because of artificial mixing of the considered pollutants bause and schwegler 2013 numerical dispersion is generally introduced into a model through stabilization techniques such as upwind schemes whose aim is to reduce sharp front oscillations in the solution at the expense however of added mass spreading this issue has been investigated in detail in several studies that assess the numerical dispersion arising from different discretization methods e g radu et al 2011 or that propose techniques to alleviate this error e g suciu et al 2013 wu et al 2019 pathania et al 2020 despite its recognized importance however numerical dispersion in groundwater solute transport modeling has received little attention in the water resources literature and it is seldom discussed as a potential source of error in modeling applications watson and barry 2001 woods et al 2003 recently developed integrated surface subsurface hydrological models isshms such as catchment hydrology cathy camporese et al 2010 hydrogeosphere hgs brunner and simmons 2012 and mike she long et al 2015 are being increasingly used not only for catchment scale flow applications but also for coupled simulations of solute transport in the surface subsurface continuum e g liggett et al 2015 scudeler et al 2016b daneshmand et al 2019 gatel et al 2019 isshms typically simulate subsurface flow by means of the 3d richards equation or a combination of 1d richards and 3d saturated groundwater flow equations coupled with some approximation of the shallow water equations for surface runoff and channel flow the computed subsurface and surface velocity fields are then applied to solve the advection dispersion and sometimes reaction equations in the corresponding domains thereby providing a holistic approach to flow and solute transport modeling at the catchment or hillslope scale mike she for instance was recently applied to a semi arid catchment in southwestern victoria australia for studying salinity issues and their possible future evolution due to climate change daneshmand et al 2019 hgs was applied to the wetlands of the lehstenbach catchment in southeast germany characterized by high concentrations of dissolved organic carbon liggett et al 2015 and cathy was applied to reproduce and interpret a laboratory experiment involving the transport of both reactive solutes and conservative tracers gatel et al 2019 and an experiment conducted at the landscape evolution observatory leo in arizona usa using deuterium as a tracer scudeler et al 2016b these applications demonstrate the great potential of isshms as powerful tools for the simulation and analysis of real world solute transport processes in the surface and subsurface however none of these studies has addressed the possible impacts that numerical dispersion may have on solute transport simulated by isshms in cathy for example numerical dispersion is created not only by the model discretization but also by the use of a time splitting technique for the solution of solute transport in the subsurface whereby advection is solved on the elements and dispersion on the nodes mazzia and putti 2005 this scheme makes the solver numerically robust and computationally efficient but passing the computed concentration distribution back and forth between elements and nodes causes a numerical artifact that as we will demonstrate manifests as a particular form of numerical dispersion for this reason with the exception of scudeler et al 2016b in all previous studies of solute transport with cathy weill et al 2011 scudeler et al 2016a gatel et al 2019 2020 either the dispersion coefficients were assigned negligible values or the dispersion module was switched off the goals of this study are i to accurately quantify the numerical dispersion affecting the solute transport subsurface solver of cathy and relate this dispersion to grid and flow characteristics ii to evaluate how the numerical dispersion may affect the simulation of coupled solute transport in the surface subsurface continuum first the cathy model is used to simulate two soil column test cases with known analytical solutions the first test case represents a one dimensional solute transport process while the second takes into account fully three dimensional solute plume dynamics the comparison between numerical results and analytical solutions in a number of runs with different grid resolutions and coefficients of hydrodynamic dispersion provides a comprehensive range of conditions for the evaluation of the possible impacts of numerical dispersion in cathy which can by extension be applicable to other isshms in a third test case cathy is used to simulate the two idealized hillslopes presented in liggett et al 2014 one with a concave profile and the other convex in a series of coupled surface subsurface solute transport runs these simulations are used to compute the amount of pre event water at the discharge outlet and to assess the impact of numerical dispersion on this runoff the simulations are run for a scenario of no surface subsurface mixing i e with advection only exchange of solute between the surface and subsurface and for a scenario of perfect mixing in which diffusive surface subsurface solute exchange is also activated in both scenarios different combinations of subsurface transport parameters are analyzed 2 methods 2 1 the cathy model the cathy model camporese et al 2010 weill et al 2011 scudeler et al 2016b is a physically based model for the simulation of coupled surface and subsurface water flow and solute transport the model solves the three dimensional richards equation for variably saturated porous media and the one dimensional diffusive wave approximation of the saint venant equations 1 s w s s ψ t ϕ s w t k s k r ψ η z q s s 2 q t c k q s d h 2 q s 2 c k q s in equation 1 sw θ θ s is the water saturation θ being the volumetric moisture content and θ s the saturated moisture content generally equal to the porosity φ ss is the aquifer specific storage l 1 ψ is the pressure head l t is time t is the gradient operator l 1 k s is the tensor of saturated hydraulic conductivity lt 1 kr ψ is the relative hydraulic conductivity η z 0 0 1 t z being the vertical coordinate directed upward l and qss is a source positive or sink negative term l3l 3t 1 that generally represents exchange fluxes from the surface to the subsurface in equation 2 s is the longitudinal coordinate system used to describe the overland channel network l q is the surface discharge l3t 1 ck is the kinematic celerity lt 1 dh is the hydraulic diffusivity l2t 1 and qs is the inflow positive or outflow negative exchange rate from the subsurface to the surface l3l 1t 1 consistent with the flow module solute transport in cathy is modeled with a three dimensional advection dispersion equation and a one dimensional advection diffusion equation for the subsurface and the surface respectively 3 θ c t u c d c q t s s 4 q m t c t q m s d c 2 q m s 2 c t q t s where c ml 3 is the solute concentration u lt 1 is the darcy velocity vector d l2t 1 is the tensor that accounts for mechanical dispersion and molecular diffusion qtss ml 3t 1 is a solute mass source positive or sink negative term qm mt 1 is the solute mass discharge ct lt 1 is the kinematic solute celerity dc l2t 1 is the surface solute diffusivity and qts ml 1t is the solute mass inflow positive or outflow negative exchange rate from the subsurface to the surface the subsurface transport equation 3 is solved using a computationally efficient time splitting technique mazzia et al 2000 whereby the advection part is solved with an explicit finite volume scheme and the obtained concentration field is used as the initial condition for the dispersion part solved with an implicit finite element scheme weill et al 2011 therefore simulated concentration values are transferred back and forth from elements tetrahedra in cathy to nodes at every time step 2 2 model setup 2 2 1 soil column test cases the first two test cases involve water flow and solute transport in the subsurface only the computational domain is meant to represent darcy s experiment i e a column packed with a saturated homogeneous granular medium two types of simulation are run in the first test case a one dimensional process of advection dispersion is reproduced while the second test case is focused on a fully three dimensional process different domain discretizations are used in the runs a fine discretization mesh 0 an intermediate one mesh 1 and a coarse one mesh 2 in the 1d analyses table 1 the size of the column domain is kept fixed and equal to 0 2 l 0 2 l for the square base and 1 0 l for the height in the 3d analyses table 2 the height of the colum domain is kept fixed together with the mesh resolutions while the size of the square base is increased to avoid the solute plume reaching the lateral boundaries the surface of mesh 0 consists of square cells of size 0 01 l in the x and y directions each subdivided into two triangles and then replicated vertically into 100 layers of constant thickness equal to 0 01 l to generate three dimensional tetrahedral grids such as the one shown in fig 1 similarly mesh 1 consists of square cells of size 0 02 l in the x and y directions with triangles replicated vertically into 50 layers of constant thickness equal to 0 02 l and mesh 2 is formed by cells of 0 04 l in the x and y directions with triangles replicated vertically into 25 layers of constant thickness equal to 0 04 l dimensionless units are used throughout these simulations for the sake of generality the time step size for the dispersion solver is kept fixed for all the simulations with a value of 0 001 t while the time step size for the explicit advection solver changes according to the courant friedrichs lewy condition whereby a courant number not exceeding 0 3 is prescribed mazzia and putti 2005 this is a core feature of the time splitting technique implemented in cathy to ensure numerical stability the courant number is expressed as u δ t δ x where u is the darcy flux δt is the advective time step size and δx is the characteristic element spatial scale equal to the element volume divided by its surface area 2 2 1 1 1d simulations in this test case a conservative tracer with concentration c 0 1 is introduced continuously over the entire top surface of the domain the initial concentration is zero everywhere and a steady state saturated flow from the top to the bottom is enforced through appropriate boundary conditions spatially uniform inflow on the top constant pressure head at the bottom and no flow across the lateral sides the resulting breakthrough curve concentration vs time at the column outflow is compared with the following analytical solution freeze and cherry 1979 5 c c 0 1 2 erfc l v t 2 d l t exp v l d l erfc l v t 2 d l t where erfc is the complementary error function l is the height of the column v is the average linear velocity i e darcy s flux divided by the porosity of the porous medium here equal to 0 58 and dl is the coefficient of hydrodynamic dispersion along the flow path in a first series of 1d simulations only the advective part of the cathy solver is activated in theory the solution in this case would be represented by a step function plug flow in reality some spreading of the breakthrough curve is expected due to numerical dispersion in order to quantify this error the best fit between equation 5 and the output concentration of cathy is used to obtain the model estimated or apparent dispersion coefficient dl radu et al 2011 this is done with the three meshes and for each mesh for three values of the darcy flux equal to 0 5 1 0 and 2 0 lt 1 in this series of runs since there is no hydrodynamic physical dispersion the apparent coefficient dl is entirely attributable to numerical dispersion in a second series of 1d simulations the dispersion part of the cathy subsurface transport equation is activated for each mesh four simulations are performed with a unitary input flow and different values of the hydrodynamic dispersion coefficient dl equal to 0 001 0 05 0 1 and 0 2 l2t 1 corresponding to grid péclet numbers p e v λ d l that range from 68 97 to 0 09 where λ is the element size high values of pe generally lead to high numerical dispersion simulations with pe 2 are purposefully considered here to test and quantify the numerical dispersion in cathy once again equation 5 is fitted with the output concentration of cathy in order to estimate the apparent dispersion coefficient dl 2 2 1 2 3d simulations in this test case a slug of tracer mass equal to 0 01 m is introduced over a single time step 0 001 t at the central node of the surface layer to approximate an instantaneous pulse injection compared with the 1d simulations the 3d analyses require a modification of the computational domain because for an accurate assessment of the transverse dispersion it is necessary to keep the solute far from the lateral boundaries for this reason the height of the soil column is kept fixed at 1 0 l while the square base is increased as reported in table 2 the cell resolution 0 01 l 0 02 l and 0 04 l for mesh 0 1 and 2 respectively as well as the vertical discretization are the same as in the first test case as in the 1d test case the mass of solute is carried away from the point of injection by transport in a steady state uniform flow field moving in the z direction however the concentration distribution is now fully 3d and can be expressed analytically by the following equation freeze and cherry 1979 6 c x y z t m 8 π t 3 2 d x d y d z exp x 2 4 d x t y 2 4 d y t z 2 4 d z t where m is the mass of the tracer introduced at the central node of the surface and dx dy and dz are the coefficients of hydrodynamic dispersion in the x y and z directions respectively the center of gravity of the tracer cloud lies at x 0 y 0 and z 0 where x x x 0 and y y y 0 with x 0 and y 0 being the x and y coordinates of the node at which the mass is introduced and z z v t with v the average linear velocity as defined for the 1d test case in the 3d test case the darcy flux is 10 times larger than in the 1d case in order to achieve a significant spreading of the solute plume within a short simulation of duration 0 025 t the apparent dispersion coefficients dl are again estimated by fitting the analytical solution to the numerical results to estimate these dispersion coefficients in the three directions it is sufficient to quantify the concentration distribution standard deviations σ x σ y and σ z as these are related to generic dispersion coefficients dx dy and dz according to σ x 2 d x t σ y 2 d y t σ z 2 d z t freeze and cherry 1979 the first series of 3d simulations is carried out with the dispersion solver activated but using a negligible value for the coefficients of hydrodynamic dispersion 1 0 10 9 l2t 1 equal in the three directions this is done in order to highlight the particular influence of the element to node and node to element exchange of information which only takes place when the dispersion module is switched on for each mesh three values of darcy flux are investigated equal to 5 0 10 0 and 20 0 lt 1 in the second series of 3d simulations the input longitudinal z direction hydrodynamic dispersion values are 0 05 0 1 0 2 and 0 5 l2t 1 with a fixed anisotropy ratio dz d x y equal to 5 the darcy flux for these simulations is 10 lt 1 2 3 hillslope simulations the third test case aims to simulate fully coupled surface subsurface processes in the two idealized hillslopes of liggett et al 2014 the first with a concave surface and the second convex fig 2 the length of the domain is 20 m the width is equal to 1 m and the height ranges from 8 m to approximately 10 m in both hillslopes the surface is discretized into 5 100 grid cells i e cells of size 0 2 m in the horizontal directions while the subsurface is discretized vertically into 40 layers with thicknesses ranging from 0 04 m at the top to about 2 m at the bottom the layers are parallel to the surface except for the last one which has a flat base fig 2 in these simulations we use real metric units in order to be consistent with liggett et al 2014 moreover we intentionally use a coarser grid to keep the computation time small and highlight the high cpu efficiency of the time splitting technique implemented in cathy no flow boundary conditions are applied for both hillslopes at the bottom and sides of the domain while the initial hydraulic head distributions were determined by running each hillslope model to steady state under a constant precipitation rate of 1 mm year 1 then a 1 h long rainfall event with precipitation rate equal to 20 8 mm h 1 is applied over the hillslopes followed by a 1 4 h long recession phase the soil is homogeneous and isotropic with hydraulic properties as reported in table 3 the main scope of this test case is to assess the impact of numerical dispersion on the simulated contribution of pre event water to the streamflow hydrograph for different combinations of subsurface transport parameters table 3 to this aim the rainfall water concentration is set to 1 kg m 3 while the initial solute concentration in the soil is 0 kg m 3 under these conditions the solute mass discharge at the outlet represents the contribution of event water while the pre event water fraction is simply assumed as its complement to the total discharge as in weill et al 2011 two series of simulations are run for both hillslopes wherein two different solute exchange mechanisms between the surface and subsurface are considered in the first series that of no surface subsurface mixing solute exchange between the surface and subsurface can only occur via advection in the second series perfect surface subsurface mixing it is assumed that at every time step there is complete mixing between solute mass in the surface water and in the first computational layer of the subsurface as described in gatel et al 2020 theoretically this corresponds to an instantaneous i e occurring at a time scale on the order of the time step size diffusive transport between the surface and subsurface 3 results 3 1 1d simulations 3 1 1 advection only fig 3 shows the analytical and model simulated breakthrough curves for the three meshes for the runs where darcy s flux is equal to one and the dispersion module is not activated since no dispersion is introduced as a model input any spreading out of the simulated breakthrough curves is entirely attributable to numerical dispersion which as expected is larger for the coarse mesh mesh 2 and decreases as the grid is refined it can be noted as well that the finite volume advection solver does not cause numerical oscillations at the solution front fig 4 shows the apparent dispersion coefficients dl obtained through the best fit of equation 5 to the simulated data as a function of the darcy flux and the element surface area the latter is a more suitable measure of grid size than a characteristic length since for the advection solver implemented in cathy the element faces are the fundamental support for the computation of fluxes mazzia and putti 2005 numerical dispersion in this case entirely captured by dl increases linearly with element size and it also increases with flow rate the corresponding apparent dispersivities computed as α l d l v l i e the longitudinal dispersivities that would be required to obtain an equivalent physical dispersion are always about two orders of magnitude smaller than the grid resolution indicating that advection only simulations in cathy are affected by a very small numerical dispersion 3 1 2 advection and dispersion the second series of 1d simulations involves activation of the subsurface transport dispersion module in cathy fig 5 shows the breakthrough curves simulated with the three meshes and four values of the physical dispersion coefficient compared with the corresponding analytical solutions similar to the advection only simulations the finest grid exhibits the breakthrough curve that best matches the analytical solution for all the dispersion coefficients however as the physical dispersion coefficient increases the simulated curves tend to be closer to each other indicating an increasingly marginal effect of numerical dispersion with respect to the physical dispersion introduced as model input the best fit coefficients of apparent dispersion dl are reported in table 4 for comparison with the physical input values the decreasing impact of numerical dispersion with increasing values of the hydrodynamic dispersion coefficients is especially apparent for mesh 1 as shown by the analysis of the average absolute error aae of the simulated concentrations with respect to the analytical solution table 4 in particular mesh 1 gives an aae that is more than three times larger than in mesh 0 for dl 0 05 l2t 1 but less than twice for dl 0 2 l2t 1 analyzing how the errors change with the theoretical grid péclet numbers i e computed with the physical dispersion coefficient dl associated to the three meshes in table 4 it can be noted that the numerical dispersion in this case remains at an acceptable level i e best fit dl close to input dl and low aae values for pe values smaller than approximately 0 5 3 2 simulations 3 2 1 negligible physical dispersion the 3d simulations with negligible input dispersion exhibit a significant spreading out of the solute plume larger than we could expect with such a small dispersion coefficient due to the time splitting numerical scheme which continuously transfers concentration information from elements to nodes and vice versa through a simple linear interpolation consistent with the finite element basis functions a first analysis of the concentration profiles along the three cartesian axes at the end of the simulation 0 025 t reveals that they well approach a gaussian function fig 6 the standard deviations of the fitted gaussian functions provide the best estimate of the apparent dispersion coefficients whose values averaged over the three directions x y and z are shown in fig 7 as a function of the element size as expected the apparent dispersion coefficient is much lower in the finer mesh 0 and increases with element size fig 7 also shows the impact of flow velocity on the numerical dispersion as in the 1d simulations the apparent dispersion coefficients increase with flux the corresponding apparent dispersivities result in values that are approximately equal to 0 1 0 2 and 0 3 times the grid resolution for mesh 0 mesh 1 and mesh 2 respectively i e about one order of magnitude larger than in the 1d advection only simulations highlighting the stronger numerical dispersion resulting from the use of the node based dispersion module in combination with the element based advection solver 3 3 advection and dispersion the second series of simulations for the 3d column test case is designed to assess at which point the numerical dispersion is no longer dominant compared to the physical dispersion fig 8 shows the relation between the grid péclet numbers evaluated using the theoretical dispersion coefficient and those computed with the apparent dispersion coefficient along the z direction using the simulated solute plume at time equal to 0 025 t the 45 degree dashed line represents the ideal case in which theoretical and apparent dispersion coefficients coincide i e zero numerical dispersion the closer the dots are to this line the more accurate the results of the simulations are examining the figure we see that the simulation results remain accurate as long as pe theoretical 1 in particular while model runs with mesh 0 exhibit a slight deviation from the dashed line starting from about pe theoretical 2 both mesh 1 and mesh 2 show more significant deviations from the analytical solution suggesting that numerical experiments should be designed to keep the grid péclet number smaller than one in order to keep numerical dispersion under control similar to the 1d dispersion model runs the 3d simulations show that the errors between the modeled concentrations and the analytical solution decrease as the input dispersion coefficient increases fig 9 also in line with the 1d simulations the error difference between the three meshes tends to decrease as the dispersion coefficient increases with dz 0 5 l2t 1 the three meshes converge to the same low value of concentration error to further assess the robustness of our analyses we carried out a brief sensitivity analysis on the time step size in order to verify whether the numerical dispersion arising from the transfer of concentration information between nodes and elements is affected by the number of times such transfer occurs taking as a reference the model run with mesh 0 and dz 0 05 l2t 1 we first decreased the dispersion solver time step to 0 0005 t 50 of the original time step and then increased it to 0 005 t five times the original time step in the former case the concentration aae increases by 33 with respect to the reference run while in the latter the aae decreases by 10 this would indeed suggest that the more times a transfer of information between nodes and elements occurs the more numerical dispersion affects the results however the very same sensitivity analysis carried out with mesh 0 and dz 0 5 l2t 1 i e a run where the grid péclet number is smaller than one results in negligible error changes with respect to the reference run this suggests that if the grid péclet number is small enough not only can numerical dispersion caused by the time splitting technique be kept under control but the simulation results are also robust with respect to the time stepping 3 4 hillslope simulations having determined a threshold on the grid péclet number that ensures reasonably accurate results in the subsurface domain we now analyze in the third test case how numerical dispersion affects coupled surface subsurface solute transport processes the simulations in the two hillslopes highlight how the contribution of pre event water to the total streamflow hydrograph varies with the transport parameters fig 10 a shows the total outflow and its pre event water fractions in the cases where no surface subsurface mixing is considered i e solute mass can be exchanged between the surface and the subsurface via advective fluxes only the black curve represents the total discharge while the fraction of pre event water is indicated by the colored lines unsurprisingly given the short time scale of the event when no mixing is considered the curves overlap each other i e the fraction of pre event water does not depend on the dispersion in the subsurface but only on the way the surface is partitioned between saturated and unsaturated areas such partitioning is only controlled by the flow parameters fig 10 b shows the results in the case of perfect solute mixing between the surface and subsurface in this case the mass discharge strongly depends on whether the subsurface hydrodynamic dispersion is activated or not in the advection only case cyan curve the dispersion module of cathy is switched off and the amount of pre event water in the total discharge is higher than in the corresponding scenario without surface subsurface mixing when very low dispersion see table 3 is introduced the dispersion module of cathy is switched on and the modeled fraction of pre event water jumps to very high levels at that point increasing the subsurface dispersion coefficient does not affect the solute mass discharge magenta green and yellow lines overlap each other except for the high dispersion run red line which exhibits a slightly higher pre event water fraction the simulation results for the convex hillslope are reported in fig 11 compared with the concave hillslope the main difference is that total discharge is smaller due to the smaller fraction of surface saturated area similar to the concave hillslope the pre event water fraction is basically independent of the subsurface transport parameters in the case of no mixing but strongly affected by the activation of the dispersion module in the case of perfect mixing the maximum grid péclet numbers attained in both the concave and convex hillslopes calculated from the input parameter values and the computed velocity field are about 16 16 1 6 and 0 16 for the very low low intermediate and high dispersion runs respectively comparing these pe numbers with the graph of fig 8 we note that the only simulations that are not expected to be dominated by numerical dispersion are those with intermediate and high dispersion the latter being the most accurate fig 12 shows the tracer concentration distributions at the end of the rainfall event in a portion of the hillslopes close to the outlet and for some selected scenarios figs 12 a and b representing the scenarios with advection only and mixing highlight how the solute remains confined within a shallow layer of soil leading to the highest fraction of event water i e smallest fraction of pre event water among all the mixing scenarios consistent with the hydrographs in figs 10 b and 11b the differences between the concave and convex hillslopes and mixing and no mixing scenarios are better appreciated when the dispersion module is switched on and a high input dispersion coefficient is used figs 12 c and e representing the concave hillslope high dispersion with mixing and no mixing scenarios respectively highlight the enhanced capability of the tracer to transfer from the surface to the subsurface when mixing is activated a similar effect although less evident due to the geometry can be seen for the convex hillslope in figs 12 d and f whereby the tracer is able to penetrate underneath the riverbed only when mixing is activated note that the color scale for panels a and b is different from the one for panels c d e and f in fig 13 we show the time series of solute mass balance terms for the same scenarios as fig 12 the cumulative total mass tot in introduced into the system 0 416 kg corresponds to the input concentration 1 kg m 3 applied via rainfall 0 0208 m h 1 for a duration of 1 h over a domain of surface area 20 m2 note that this is the mass into the whole system surface plus subsurface domains while the mass exiting the system tot out in these runs occurs only via the designated surface outlet cell fig 13 shows an excellent mass balance for all the scenarios indeed the solute mass balance error over the whole surface subsurface domain remains smaller than 0 5 from a process point of view panels c and d compared with panels a and b highlight how activation of dispersion with mixing increases the solute stored in the system thereby decreasing the amount of tracer that reaches the outlet whereas the deactivation of mixing as seen by comparing panels e and f with panels c and d results in a dramatic decrease in surface storage which translates to a corresponding increase of the solute tracer mass in the outflow 4 discussion integrated surface subsurface hydrological models paniconi and putti 2015 fatichi et al 2016 including cathy camporese et al 2010 are physics based numerical models increasingly used not only for water flow simulations in hillslopes and catchments but also for contaminant transport e g weill et al 2011 ligget et al 2015 scudeler et al 2016b daneshmand et al 2019 gatel et al 2019 for this reason it is important to understand and quantify how the numerical dispersion of solute transport in the subsurface modules of isshms can affect simulation results numerical dispersion depends mainly on the scheme used to solve the advection dispersion equation in the case of cathy a time splitting algorithm solves advection on elements by an explicit numerical scheme and dispersion on nodes with an implicit scheme this makes the solver numerically robust and computationally efficient but the continuous transfer of concentration information from nodes to elements and vice versa is known to lead to enhanced mass spreading weill et al 2011 gatel et al 2019 however this has never been quantified so far the first part of this study provides a useful quantification of the numerical dispersion in cathy by comparing well known analytical solutions with results from two soil column test cases 1d and 3d in a number of scenarios first with advection only or negligible physical dispersion and then including advection and dispersion the 1d simulations with advection only show the robustness of the advection numerical scheme implemented in cathy an explicit finite volume solver with numerical stability ensured by enforcing the courant friedrichs lewy condition mazzia et al 2000 the numerical dispersion in the 1d simulations remains very small for a range of grid resolutions and flow velocities with apparent dispersivity values that are at least two orders of magnitude smaller than the element size it should be noted that these advection only scenarios are useful in the analyses performed but are not intended as realistic test cases the 1d simulations with longitudinal dispersion show that activating the dispersion module potentially leads to significant numerical dispersion however this can be controlled by adjusting the mesh resolution to the input value of the longitudinal dispersion coefficient in order to maintain a grid péclet number smaller than 1 0 ideally 0 5 or less this condition on pe is a new criterion based on an experimental analysis of the time splitting solver in cathy which is more restrictive than the common limit of 2 0 e g diersch 2014 derived from the theoretical analysis of linear convective diffusive problems solved by standard fd or fem schemes the 3d simulations with the dispersion module activated but with negligible values of the dispersion coefficients reveal the strong numerical dispersion related to the transfer of concentration information from elements to nodes and vice versa in this case the numerical dispersion is characterized by apparent dispersivities of almost the same order of magnitude as the element size additional 3d simulations with longitudinal coefficients of dispersion as in the 1d case highlight that also in this case it is necessary to maintain the grid péclet number smaller than 1 0 in order to prevent the numerical dispersion from becoming dominant as a final remark on the soil column test cases we note that the solute mass balance error remains lower than 0 3 in all the model runs furthermore the concentration errors related to the dispersion module alone calculated in a number of simulations with flow equal to zero not shown here are three to five orders of magnitudes smaller than the corresponding simulations with advection and dispersion this combined with the fact that the numerical dispersion affecting the advection solver is also very small confirms that the main source of numerical dispersion in cathy is a particular numerical artifact arising from the time splitting scheme and its related exchange of information between nodes and elements in the third test case of this study the cathy model is applied to simulate the contribution of pre event water to the total streamflow hydrograph of two synthetic hillslopes in response to a rainfall event interesting insights can be gained by comparing our results with those reported by liggett et al 2014 who applied the hgs model to the same synthetic hillslopes for solute exchange between the surface and the subsurface hgs relies on a dual node approach whereby the mass flux is computed as the sum of advective and dispersive components liggett et al 2014 studied three different conditions i advection only in which the solute exchange across the surface subsurface interface occurs solely via advection ii advection diffusion in which molecular diffusion is also introduced and iii advection dispersion where mechanical dispersion is considered as well for each of these three conditions across the surface subsurface interface liggett et al 2014 simulated the different subsurface dispersion scenarios reported in table 3 our cathy simulations with no surface subsurface mixing broadly correspond to the advection only scenarios with hgs which in this case also shows that the pre event water contribution to the hydrograph does not depend on the subsurface dispersion parameters over the course of a single rainfall event the pre event water fractions simulated by cathy in the case of perfect surface subsurface mixing fall within the range spanned by the hgs simulations with advection dispersion in particular the subsurface advection only scenarios simulated by cathy closely mimic the results of hgs with very low or low dispersion while the numerical dispersion arising from the cathy time splitting technique makes the very low and low dispersions scenarios collapse onto the intermediate dispersion scenario this occurs because the order of magnitude of the numerical dispersion introduced when switching on the dispersion module is higher than the one related to the physical dispersion coefficient to the point that any modification of this coefficient does not influence the solute concentration until a threshold on the péclet number is reached this threshold here corresponds to a pe equal to 1 or less consistent with the criterion developed in the soil column runs this issue does not seem to affect the hgs model however the mesh resolution used here 0 20 m horizontally with 40 vertical layers is much coarser than the one used by liggett et al 2014 0 04 m horizontally with 400 vertical layers despite the much smaller number of computational nodes our simulations give similar results when numerical dispersion is not dominating thanks to the high cpu efficiency of the time splitting technique in summary this series of hillslope simulations shows that if the numerical dispersion related to time splitting is kept under control using the grid péclet number criterion discussed above the cathy model can provide robust solute transport predictions without the need for additional parameters such as a longitudinal dispersivity across the surface subsurface interface and with a relatively parsimonious grid discretization 5 conclusions we applied the cathy model to examine the main sources of numerical dispersion in the simulation of subsurface solute transport and how such dispersion might affect solute transport predictions in integrated surface subsurface hydrological models to this aim we first carried out a series of subsurface only simulations in two soil column test cases using known analytical solutions to accurately quantify the numerical dispersion affecting the model these simulations allowed us to define a more restrictive threshold value for the grid péclet number compared to typical values in standard fem codes to ensure a satisfactory solution accuracy pe should not exceed 1 or even better 0 5 then cathy was applied to two synthetic hillslopes in a series of fully coupled surface subsurface simulations to show the possible impacts of subsurface numerical dispersion on the prediction of the pre event water contribution to the total streamflow hydrograph overall this study provides quantitative recommendations for setting up integrated surface subsurface hydrological models that can control the effects of numerical dispersion on coupled solute transport simulations indeed based on the grid péclet number threshold and the expected range of dispersion coefficient the model user can define a proper grid size that will meet the criterion of pe smaller than 0 5 1 0 although the results presented here are strictly valid for the cathy model only the methodology proposed for the evaluation of numerical dispersion is general and therefore may be used in assessing any other isshm moreover the column test cases with 1d and 3d analytical solutions and the hillslope test case that has now been used in assessing two widely used isshms may have appeal as new benchmark problems for integrated surface subsurface hydrological models extending to solute transport the flow only suite of benchmarks reported in model intercomparison studies e g maxwell et al 2014 kollet et al 2017 credit authorship contribution statement beatrice gatto investigation writing original draft claudio paniconi conceptualization writing review editing paolo salandin writing review editing matteo camporese investigation conceptualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments b g acknowledges the support of her phd scholarship by unismart fondazione università degli studi di padova and alto trevigiano servizi s r l we also thank three anonymous reviewers for their useful and constructive comments which helped us to improve the manuscript supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 104060 appendix supplementary materials image application 1 image application 2 image application 3 image application 4 image application 5 image application 6 image application 7 image application 8 image application 9 image application 10 image application 11 image application 12 
228,near miscible supercritical co 2 injection in oil wet carbonate a pore scale experimental investigation of wettability state and three phase flow behavior ziqiang qin conceptualization methodology validation formal analysis investigation writing original draft writing review editing maziar arshadi conceptualization validation supervision writing review editing mohammad piri conceptualization methodology validation writing review editing supervision project administration funding acquisition center of innovation for flow through porous media department of petroleum engineering university of wyoming laramie wy 82071 usa center of innovation for flow through porous media department of petroleum engineering university of wyoming laramie wy 82071 usa center of innovation for flow through porous media department of petroleum engineering university of wyoming laramie wy 82071 usa corresponding author near miscible supercritical co 2 scco 2 injection and its underlying pore scale physics were experimentally investigated in an oil wet carbonate rock at elevated temperature and pressure conditions using x ray microtomography the results of in situ contact angle measurements yielded direct evidence showing that the scco 2 injection triggered a wettability reversal process resulting in reduced oil wetness as the scco 2 injection progressed we observed a distinct wettability state where the wetting preference of the solid to the scco 2 oil and brine phases was similar due to the wettability reversal consequently pore sizes neither dictated any preferential invasion order nor restricted the displacement efficiency of the injection process furthermore we identified a type of spreading system where spreading oil layers formed but did not exist globally across the pore space between the scco 2 and brine phases gaussian curvature analysis showed that the scco 2 and oil phases were well connected at the early stage of the scco 2 injection whereas brine connectivity was relatively poor as the injection continued brine connectivity was improved due to the wettability reversal effect moreover displacement events including double and multiple displacements were identified and discussed they included a variety of events that had scco 2 as the first phase and oil and brine as the subsequent phases the diversity and affordability of such displacements were much higher than those previously observed during n2 injection in oil wet systems where mostly gas to oil to brine double displacements took place the interplay of scco 2 oil miscibility the distinctive wettability state favorable fluid connectivity and frequent double multiple displacements resulted in an exceptional displacement efficiency during near miscible scco 2 injection keywords near miscible supercritical co2 injection in situ wettability pore scale displacement physics x ray microtomography three phase flow porous media 1 introduction three phase flow through porous media is a complicated displacement process encountered in many natural and anthropogenic systems sabti et al 2019 scanziani et al 2020 examples include the removal of non aqueous phase liquid napl contaminants from aquifers sequestration of greenhouse gases in geological formations and enhanced oil recovery eor from hydrocarbon reservoirs for instance miscible co 2 injection in the reservoirs is favorable due to its remarkably high displacement efficiency as well as its potential to enable storage of a significant amount of co 2 in geological formations nevertheless this scheme needs to be applied at pressures higher than minimum miscibility pressure mmp of co 2 ren et al 2011 and therefore requires high injection pressures and or enriched gases which are both economically expensive and operationally challenging alhosani et al 2019 to overcome these practical challenges the idea of injecting co 2 at pressures slightly below the minimum miscibility pressure i e at near miscible conditions was proposed although co 2 injection under these conditions results in non negligible interfacial tension between the injectant and oil the scheme sufficiently lowers it such that the displacement efficiency can still be comparable to that of miscible gas injection grigg and schechter 1997 schechter et al 1998 chen et al 2017 furthermore near miscible injection similar to miscible process enables sequestration of substantial amounts of co 2 in the target geologic formations it is also more cost effective and less challenging to implement making it a more preferable choice for field scale commercial applications ren et al 2011 near miscible co 2 injection involves coexistence of three fluid phases namely brine oil and co 2 in the pore space although some research studies have been dedicated to investigating three phase flow in permeable media with different wetting conditions piri and blunt 2005a qin et al 2019b scanziani et al 2020 the flow behavior of three phases involving co 2 under near miscible conditions particularly in oil wet carbonates and at the pore scale has not received much attention shyeh yung 1991 investigated the performance of both miscible and near miscible co 2 injection in carbonate rocks through macroscopic core flooding experiments and reported that the displacement efficiencies under both schemes were similar the author attributed the high displacement efficiency under the near miscible condition to low gas oil interfacial tension alkhazmi et al 2018 conducted near miscible water alternating gas wag injection experiments in water wet carbonate rocks and found that in the gas injection steps the displacements were maintained after gas breakthrough due to the near miscibility effect between the gas and oil phases which allowed the two fluids to flow simultaneously within the pore space toward the core outlet the majority of pore scale experimental studies investigating the governing displacement physics of near miscible gas injection have been conducted in micromodels despite the fact that they do not adequately represent complexities of the wettability and pore structure of naturally occurring rocks qin et al 2019b sohrabi et al 2008b a studied near miscible gas injection in a water wet micromodel and concluded that the crossflow of oil into the main gas flow stream was responsible for the oil mobilization they also observed that near miscible gas flooding led to more oil displacements in secondary mode i e prior to waterflooding compared to that of tertiary mode i e after waterflooding seyyedi and sohrabi 2020 further probed the displacement physics of tertiary near miscible co 2 flooding in water wet micromodels the formation of spreading oil layers and capillary crossflow of co 2 i e the invasion of co 2 into the bypassed oil were proposed as the main mechanisms that facilitated oil mobilization they also showed that a significant amount of co 2 was stored in the porous media under near miscible conditions over the past decade the advancements in in situ imaging technologies specifically x ray micro computed tomography micro ct have provided remarkable opportunities for researchers to investigate complex multiphase flow processes including near miscible co 2 flooding in natural porous media at the micro scale wildenschild and sheppard 2013 blunt et al 2013 armstrong et al 2019 qin et al 2019a alhosani et al 2019 recently examined secondary near miscible co 2 injection in a water wet carbonate using a micro ct scanner a high displacement efficiency up to 80 of the original oil in place was reported in their experiments using pore fluid occupancy maps they observed that co 2 tended to reside in large pores oil presented in medium and small sized pores while water occupied pores of varying sizes small medium and large during near miscible co 2 injection this was different than the occupancy in an immiscible system under water wet condition where water occupied only the smallest pores scanziani et al 2018 furthermore no spreading oil layer was observed between the gas and brine phases in their experiments in other words oil flowed in the center of pores rather than through layers when displaced by gas while this work has been conducted on carbonate rocks at the pore level the wettability condition of the rock fluid system was water wet which is not typical of most carbonate reservoirs the trends in oil wet carbonate rocks could be different as wettability significantly impacts the fluid occupancy and flow behavior in porous media qin et al 2019a arshadi et al 2020 to date a very limited number of research studies have been dedicated to systematically probe the displacement physics of three phase co 2 oil brine flow during near miscible co 2 injection in oil wet carbonates highlighting the need for more studies to help improve the design of this enhanced oil recovery and co 2 sequestration process at the field scale alhosani et al 2020b in this study we investigated near miscible supercritical co 2 scco 2 injection process and its associated pore scale displacement physics in an oil wet carbonate rock at elevated pressure and temperature conditions flow experiment consisting of multiple displacement stages were designed and performed using a miniature core flooding setup integrated with a high resolution x ray micro ct scanner qin et al 2021a pore scale images were utilized to systematically examine the scco 2 oil miscibility in situ wettability spreading phenomenon fluid occupancy and connectivity and displacement events during near miscible scco 2 injection process the new insights developed in this study significantly improve the current understanding of near miscible three phase flow in porous media 2 materials and methods 2 1 rock and fluid properties a miniature core sample 8 9 mm in diameter and 47 mm in length was drilled from a block of fond du lac carbonate outcrop from wisconsin usa this rock was selected because it contained less micro porosity than most carbonates zinszner and pellerin 2007 fullmer et al 2014 thereby minimizing uncertainties in porosity and in situ fluid saturation calculations using x ray micro ct images a detailed mineral map of the rock generated using the qemscan quantitative evaluation of minerals by scanning electron microscopy imaging technique indicated that the rock was mainly composed of dolomite see figure s1 in the supplementary materials detailed measurement procedures are explained elsewhere qin et al 2021b barsotti et al 2021 the average porosity of the sample calculated from micro ct images using a histogram thresholding technique was 11 2 and its absolute permeability to brine was 36 md the x ray porosity value was similar to the porosity determined with a helium porosimeter on a companion 38 1 mm core plug i e 11 8 drilled from the same block of rock this further verified the insignificant amount of micro porosity present in the rock figure s2 in the supplementary materials shows the three dimensional pore size distribution of the sample obtained from the micro ct images and its calculation techniques table 1 tabulates geometrical and petrophysical properties of the miniature core sample brine was synthesized using 19 wt nai 0 5 wt cacl 2 and distilled water in this study the connate brine and the brine used for waterflooding shared the same composition to minimize mineral dissolution during the flow experiment a sacrificial core plug was immersed in the prepared brine solution for ionic equilibration prior to injection qin et al 2021a the oil phase was a crude oil collected from a reservoir located in the permian basin texas usa the oil was filtered through a 0 5 μ m filter to remove possible residue and debris and then doped with 12 5 vol 1 iodooctane supercritical co 2 scco 2 was used as the third phase optimum concentrations of dopants in oil and brine were determined by conducting a series of x ray compatibility tests to optimize the image quality and minimize segmentation errors table 1 lists the properties of the fluids densities and viscosities of the brine and crude oil were measured at 50 c and ambient pressure those of supercritical co 2 were obtained from the literature lemmon 2013 at the experimental conditions 50 c and 1500 psig i e 10 34 mpa the interfacial tensions were measured at the experimental conditions when three phases co 2 doped oil brine are in equilibrium interfacial tension ift between the co 2 and doped oil was measured using the pendant drop method and axisymmetric drop shape analysis adas technique details of the experimental setup and procedure used can be found elsewhere saraji et al 2013 at the experimental temperature condition 50 c equilibrium ift was measured at ten different pressures ranging from 200 to 1100 psig i e 1 39 to 7 58 mpa and then minimum miscibility pressure mmp between the co 2 and doped oil was determined using a vanishing interfacial tension vit technique fig 1 as shown in the figure the mmp was found to be 1644 psig 11 33 mpa at 50 c thus the flow experiment was conducted at 1500 psig 10 34 mpa and 50 c to achieve a near miscible condition at these pressure and temperature conditions the co 2 was in a supercritical state 2 2 experimental apparatus the experiments were performed using a core flooding setup integrated with an x ray micro ct scanner the core flooding setup consisted of five quizix 5000 series pumps a isco 260d pump a custom built miniature carbon fiber core holder a high pressure cell heating and isolation systems and a set of rosemount differential pressure transducers the high pressure cell was used to pre equilibrate scco 2 with brine at the experimental conditions 50 c and 1500 psig i e 10 34 mpa prior to injection this was done to mitigate possible mass transfer between the brine and scco 2 and thereby prevent potential salt participation in the pore space to minimize scco 2 diffusion from the pore space into the confining fluid chamber of the core holder during the experiments an aflas sleeve was used in the core holder and the core sample was wrapped with teflon tape and aluminum foil before being inserted into the sleeve the core holder was wrapped with special heating hardware to maintain its temperature during the experiment furthermore fluids were heated up to the experimental temperature in an oven before being injected into the core holder highly flexible peek tubing was connected to the core holder to minimize vibration and torque during the scanning process the peek tubing was insulated to maintain the temperature of fluids the x ray imaging system was a heliscan micro ct scanner manufactured by fei now thermo fisher scientific the scanner provided helical scanning mode and an iterative reconstruction technology to produce high signal to noise ratio images figure s3 in the supplementary materials shows a schematic illustration of the experimental setup used in this study additional details of the experimental apparatus can be found elsewhere qin et al 2019a 2 3 experimental procedure and data analysis to start the experiments the miniature core sample was placed in the core holder put under an initial confining pressure of 200 psig 1 38 mpa and imaged with the micro ct scanner to collect a set of reference scans imaging parameters are listed in table 2 subsequently the sample was flooded with gaseous co 2 to remove bulk air from the pore space and then vacuum saturated with the formation brine at this point the pore and confining pressures were simultaneously increased to 1500 and 1700 psig i e 10 34 and 11 72 mpa respectively and the temperature of the system was set at 50 c primary drainage was conducted by injecting the oil into the sample at a flow rate of 0 02 cc min to establish an initial water saturation s wi after the differential pressure across the sample reached steady state oil injection was stopped and the pore space was scanned to determine s wi the sample was then dynamically aged at s wi by continually injecting the oil at 0 0006 cc min the core was scanned periodically during the aging process and the micro ct images were utilized to monitor changes in oil brine contact angle the aging process was considered to be complete when the oil brine contact angle reached an equilibrium value and did not change further this was achieved after 17 days after completion of the aging process the core sample was subjected to a waterflood at a flow rate of 0 004 cc min under a capillary dominated flow regime a capillary number of 2 1 1 0 7 in the final step the sample was subjected to near miscible scco 2 injection at a flow rate of 0 03 cc min the scco 2 was injected from the top of the core the pore space was repeatedly imaged during all injection sequences of the experiment an injection process was terminated when in situ fluid occupancies within the field of view remained unchanged during various stages of the experiments the middle section of the core sample was scanned to avoid any adverse impact of the end effects on the acquired images the imaging resolution and the volume of the field of view fov were 3 04 μ m and 8 9 8 9 6 4 mm 3 respectively this resolution was selected to ensure that the entire cross section of the sample was captured in the fov the resolution was sufficient to accurately characterize the in situ wettability of the medium qin et al 2021a due to the high image quality and the relatively large pore size of the fond du lac rock fig 2 the raw grayscale images were processed using avizo 9 4 0 and pergeos 1 7 0 software packages after applying the non local means filter each image set acquired during each flow step was aligned and registered with the dry reference image the registered wet image sets were then multiplied by the pore map obtained from the reference image to eliminate the solid phase the multiplied images were segmented to the brine oil and scco 2 phases using a watershed technique next the segmented images were subjected to a quantitative image analysis to measure the in situ contact angles a sub volume of the segmented images was extracted the fluid fluid solid contact line was then traced and a plane perpendicular to the three phase contact line was visualized in this plane the contact angle was measured at the intersection of the fluid solid and fluid fluid tangents through the denser phase the flow was stopped and the system was allowed to reach equilibration before imaging therefore the measured contact angles were considered equilibrium values for each fluid pair at a flooding stage 30 contact angles were measured at randomly selected locations to obtain the distribution of in situ wettability as shown in previous studies khishvand et al 2016 the in situ contact angle measurement method implemented here has an absolute error value within 2 degrees due to uncertainties associated with identifying fluid fluid and rock fluid interfaces which was considered insignificant for the gaussian and mean curvature analysis the fluid fluid interfaces were first extracted from the three dimensional sub volume of the segmented images subsequently the extracted interfaces were smoothed using the generalized marching cubes algorithm the curvature was then obtained by approximating the surface locally as a quadratic form the eigenvalues and eigenvectors of the quadratic form were referred to as the principal curvature values and the directions of the principal curvature respectively lin et al 2018 finally the gaussian and mean curvatures were calculated as the product and the average of the two principal curvatures respectively additional details on the data acquisition and image analysis techniques are provided elsewhere qin et al 2019a 3 results and discussion in the following subsections we mainly present our observations and findings of the scco 2 injection stage of the experiments to explore the pore scale physics of three phase scco 2 oil brine flow under near miscible conditions in the aged carbonate rock sample we first probe the miscibility between scco 2 and crude oil and calculate fluid saturations at various stages of the tests subsequently the pore scale physics governing the evolution of in situ fluid saturations are discussed specifically we investigate in situ wettability and its impact on pore fluid occupancies during the near miscible scco 2 injection furthermore the connectivity of fluid clusters is probed as it is one of the key factors that govern the mobilization of the fluids in the pore space displacement events including double and multiple displacements are identified and discussed finally the interfacial areas between scco 2 oil scco 2 brine and oil brine phases are examined to verify the pore scale physics discussed through the above mentioned analyses 3 1 multiple contact partial miscibility miscibility between scco 2 and crude oil is beneficial because the dissolution of the former in the crude oil results in oil swelling and viscosity reduction arshad et al 2009 ren et al 2011 which facilitate oil mobilization for instance several researchers simon and graue 1965 huang and tracht 1974 have measured the volume of the co 2 saturated crude oil at controlled pressure and temperature conditions and compared it with that of the dead crude oil at the same condition they found that the co 2 saturated oil volume increased as the pressure was increased i e more co 2 was dissolved into the crude oil furthermore sun et al 2017 reported that the viscosity of crude oil in their study is reduced exponentially with the increasing pressure of co 2 in their bulk experiments the viscosity reduction rate could reach 96 at a saturation pressure of 8 mpa in this study as the scco 2 invades the pore space and contacts the waterflood remaining oil multiple contact miscibility between the two fluids can partially be achieved fatemi and sohrabi 2013 the process of scco 2 dissolution may be captured in micro ct images as grayscale intensities of phases reflect the extent of x ray attenuation during the imaging process fig 2 shows grayscale x ray images of the pore space during near miscible scco 2 injection at different pore volumes pvs as observed in fig 2a the grayscale intensities of different oil clusters were relatively homogeneous across the fov for the first 5 pore volumes of the injection however as the injection continued the intensity of the oil phase became somewhat uneven in different clusters fig 2b and c primarily due to the dissolution of the scco 2 in the crude oil upon contact during the injection process the miscibility between these two fluids is expected to occur through multiple contacts rather than first contact process arshad et al 2009 furthermore the dissolution of scco 2 in crude oil is a gradual process and its rate depends on several factors such as temperature and pressure conditions crude oil properties the purity of scco 2 topology of the pore space and interfacial contact areas li et al 2018 zhang et al 2018 fatemi and sohrabi 2013 gong and piri 2020 therefore it was expected that after a period of scco 2 injection and depending on fluid fluid contact areas different oil globules residing in the medium would contain different amounts of dissolved scco 2 and consequently exhibit different x ray intensities in the micro ct images as mentioned earlier the dissolved scco 2 could swell the oil and reduce its viscosity these along with other mechanisms that are elaborated on in the following subsections promoted the local displacements of the crude oil by scco 2 at the end of the injection the majority of the oil clusters that had sufficient contact with scco 2 were produced from the medium see fig 2d the residual oil globules left stranded in the pore space at this stage typically had limited contact with scco 2 it should be noted that local variations in the oil phase intensity did not impose any challenges to accurately segment the scco 2 oil and brine phases in the micro ct images because the x ray attenuation contrasts between scco 2 oil and oil brine phases remained adequate figure s4 in the supplementary materials 3 2 in situ saturations during the various stages of the experiments saturations of fluids were determined from the segmented pore fluid occupancy maps as shown in figure s5 in the supplementary materials the imaging fov was much larger than the porosity and saturation based representative elementary volumes revs of the sample meaning that the saturation values obtained in this study faithfully represent the average saturations of the entire sample an initial oil saturation of 0 78 i e s wi 0 22 was established after the dynamic aging process in the subsequent waterflood the oil saturation reduced to only 0 62 after injecting 5 pvs of the brine which was expected from an oil wet system qin et al 2019a alhosani et al 2020a the oil saturation ultimately reached 0 48 after 14 pvs of brine injection and did not change further therefore this saturation was considered as the waterflood remaining oil saturation s orw during the near miscible scco 2 injection process the scco 2 and oil saturations reached 0 15 and 0 39 respectively after injecting 5 pvs of the fluid the oil saturation further decreased to 0 30 after 15 pvs of the injection while the scco 2 saturation increased to 0 33 this process achieved an exceptional displacement efficiency with oil and scco 2 saturations of 0 04 and 0 89 respectively after 50 pvs of the injection fig 3 summarizes the fluid saturations during various stages of the experiment 3 3 in situ wettability wettability of the medium was characterized during the experiments by measuring fluid fluid contact angles on the surface of pore walls the average oil brine contact angle established at the end of the aging process was 114 fig 4a i which falls in the weakly oil wet range after waterflooding the contact angle was measured to be 113 see fig 4a ii indicating that no apparent wettability alteration occurred due to the waterflood however after 5 pvs of scco 2 injection the average oil brine contact angle decreased to 107 fig 4a iii this value further dropped to 97 after 50 pvs of scco 2 injection fig 4a iv a vi and b the average values of the equilibrium contact angle distributions were reported in order to mitigate the human errors and the effects of hysteresis on contact angle measurements thus the variation of the average contact angle values clearly indicated that the near miscible scco 2 injection process triggered a wettability reversal in the medium toward reduced oil wetness fig 5 shows a local visualization of the wettability reversal during the scco 2 injection two mechanisms may cause wettability alteration during co 2 injection the dissolution of co 2 into the oil phase may destabilize heavy polar components of crude oil and cause their precipitation and adsorption onto rock surfaces sohrabi et al 2015 this can result in wettability alteration toward increased oil wetness especially in heavy oil systems with high asphaltene contents on the other hand co 2 can also dissolve in the brine phase and increase the concentration of ca 2 in the fluid according to the following reaction 1 caco 3 h 2 o co 2 2 hco 3 ca 2 the ca 2 cations in the brine can form ion pairs with the adsorbed negatively charged oil polar components and release some of them from carbonate surfaces resulting in a wettability reversal toward reduced oil wetness seyyedi et al 2015 qin et al 2021a as shown in fig 4b the average in situ oil brine contact angle continued to decrease during scco 2 injection this highlights that scco 2 brine rock interactions i e the second mechanism described above dominated the wettability alteration process in our study this is supported by the relatively low asphaltene content of the permian crude oil used in this study nonetheless scco 2 deployment in heavier oil reservoirs warrants careful thermodynamics and phase behavior studies of the fluids to avoid possible asphaltene precipitation and formation damage the wetting preference of the porous medium to scco 2 and brine was also investigated by measuring in situ scco 2 brine contact angles at where direct contact of these two fluids were observed as shown in fig 6 brine was slightly more wetting compared to scco 2 while the differences in the wetting preference of the rock to scco 2 and brine were small the average in situ scco 2 brine contact angles were 86 87 86 and 89 after 5 15 35 and 50 pvs of the scco 2 injection respectively the contact angle values showed negligible variation during this process average values of the mean curvature between the scco 2 and brine phases were also measured to be positive but near zero see fig 7b and c which confirmed the above mentioned wetting preference this is probably due to the abundance of mass transfer between the scco 2 and brine sabirzyanov et al 2002 steel et al 2016 generally there are wetting intermediate wetting and non wetting phases in a porous medium containing three fluids øren and pinczewski 1995 piri and blunt 2005a alhosani et al 2019 qin et al 2019b 2021a in this particular study based on the in situ contact angle measurements we observed a wetting state where both the scco 2 and brine phases served as almost equally non wetting phases compared to the crude oil at the early stages of scco 2 injection average scco 2 brine contact angles were close to 90 in other words no apparent intermediate wetting phase was identified in the system as the scco 2 injection process continued the wetting preference of the rock surface to all three phases present in the medium i e scco 2 brine and crude oil became similar due to the observed wettability reversal toward reduced oil wetness the average values of scco 2 brine and oil brine mean curvatures confirmed the proposed wetting state see fig 7c as it is discussed in detail in the following subsections this distinct wettability state directly impacts the fluid occupancies and displacement events in the medium it is worth noting that the observed wetting state had not been seen in our previous three phase flow studies conducted with n 2 and gaseous co 2 under oil wet conditions qin et al 2019b 2021a where oil brine and gas phases were the wetting intermediate wetting and non wetting phases respectively furthermore the observed wetting state was also different from that during near miscible co 2 injection in a water wet carbonate reported by alhosani et al 2019 in their experiment water was the wetting phase while gas and oil served as the non wetting phases in addition we examined the bartell osterhoff constraint in our system bartell osterhoff equation relates contact angles and interfacial tensions in a three phase system in equilibrium condition bartell and osterhof 1927 2 σ g b e q c o s θ g b σ g o e q c o s θ g o σ o b e q c o s θ o b where σ g b e q σ g o e q and σ o b e q are the equilibrium interfacial tensions and θ g b θ g o and θ o b are the equilibrium contact angles between gas brine gas oil and oil brine phases respectively using the interfacial tension values reported in table 1 as well as the average oil brine and scco 2 brine contact angles presented in table 3 we compared the predicted scco 2 oil contact angle from equation 2 and its measured value in the ct images at the end of the scco 2 injection table 3 shows that there is a significant difference between the two values the observed deviation is consistent with the recent study by scanziani et al 2020 as discussed by scanziani et al the bartell osterhoff equation is defined for three phases in equilibrium at the same location in a system with constant wettability which is not the case for the naturally occurring rocks with complex pore structure and heterogeneous wettability furthermore the slope of the cosine function is large in the vicinity of 90 meaning the uncertainty of the estimation is amplified in the neutral wet regime i e the wettability condition of this system therefore one needs to consider the uncertainty of employing bartell osterhoff constraint in a natural porous medium at neutral wet conditions 3 4 in situ pore fluid occupancy during waterflooding brine mainly displaced oil from large pore elements in the medium fig 8a while a significant amount of oil was left stranded in the medium and small sized pores because they were bypassed by the brine this was expected due to the weakly oil wet condition of the medium qin et al 2021a at the early stages of the scco 2 injection e g after 5 pvs the invading fluid preferably occupied the large pores fig 8b which were mostly occupied by brine previously fig 8a a closer look at fig 8b reveals that scco 2 and brine co occupied considerable portions of the large pores e g diameter 600 μ m at this stage this is consistent with the previous findings of the in situ contact angle measurements indicating that both scco 2 and brine phases served as the non wetting phase compared to oil on the other hand oil saturation was higher in smaller pore sizes this was because oil was still the wetting phase at this stage it is worth noting that the oil saturation in the pores with diameters larger than 800 μ m slightly increased after 5 pvs of the scco 2 injection see fig 8a and b this is attributed to the wettability reversal as well as double and multiple displacement events during scco 2 injection such a fluid redistribution was expected to facilitate oil production as the injected scco 2 preferably flowed through the large sized pores as the injection continued e g after 15 pvs the increase in scco 2 saturation in the pores with diameters larger than 800 μ m was insignificant because the saturation of scco 2 in these pores was already high and the remaining brine in them could have lost its connectivity to the main flow path in order to leave the sites the scco 2 saturation increased mainly in the medium and small sized pores at this stage fig 8c due to the wettability reversal and the low interfacial tensions between the scco 2 and oil as well as the scco 2 and brine alhosani et al 2019 some of the brine that was displaced by the scco 2 was diverted back into pore elements previously filled with the scco 2 e g see pores with diameters of approximately 1200 μ m in fig 8b and c such observations verify the dynamic fluid redistribution within the medium due to pore scale displacement events we provide further details on this topic in the following subsections after 35 pvs of scco 2 injection almost all the pore elements with diameters larger than 550 μ m were occupied by this fluid fig 8d furthermore the scco 2 saturation continuously increased in pores with diameters smaller than 550 μ m in contrast brine resided mainly in medium and small pores fig 8d shows that the brine saturation was higher in smaller pore size categories at this stage which demonstrates an increased water wet tendency compared to the previous flooding steps see fig 8a c this is a direct consequence of the scco 2 induced wettability reversal process as discussed in the previous subsection the average oil brine contact angle reached 98 at this stage which is a neutrally wet condition similarly the contact angle between the scco 2 and brine phases was 86 hence there were no obvious wetting and non wetting phases in the medium i e the wetting preferences of the solid surface to the scco 2 oil and brine phases were similar this unique wettability state resulted in a high displacement efficiency during the near miscible scco 2 injection process because the displacements that occurred in the system were either an imbibition or a drainage process with a low absolute threshold pressure value p c t h c o s θ r where p c t h is the threshold capillary pressure θ is the fluid fluid contact angle and r is the effective radius of the pore element consequently oil and brine saturations were reduced in all pore size categories fig 8c and d as pore sizes did not dictate the invasion order under this distinct wettability condition after 50 pvs of scco 2 injection most of the pore elements were occupied by this fluid fig 8e and only trace amounts of oil and brine remained in the medium 3 5 connectivity of the fluids hydraulic connectivity is one of the key factors that regulate the mobilization of fluids in porous media to further investigate the pore scale physics that govern displacements due to near miscible scco 2 injection the connectivities of the fluids were systematically examined using shape factor euler number layer characterization and gaussian curvature methods 3 5 1 shape factor and euler number the wetting phase globules i e oil ganglia remained in the medium during the waterflooding and the subsequent scco 2 injection were statistically classified using shape factor and euler number prodanović et al 2007 andersson et al 2018 shape factor characterizes the sphericity of a fluid globule 3 g 6 π v s 1 5 where g is the shape factor and v and s are the volume and surface area of a fluid globule the value of g becomes greater as the sphericity of a globule increases and it reaches 1 when the globule has a perfect spherical shape euler number is an indicator of the connectivity of a complex three dimensional structure 4 χ β 0 β 1 β 2 where χ is the euler number β 0 is the number of connected components β 1 is the number of loops and β 2 is the number of enclosed cavities utilizing the shape factor g and euler number χ remaining oil globules were categorized into four pattern groups namely network cluster multiple and isolated see fig 9 the characteristics and the criteria used to classify the various pattern groups are 1 network the network pattern group includes remaining oil globules that have large volumes and complex structures with good inner connectivities they usually exist in the enrichment area of the remaining oil after the non wetting phase injection in general the globules in the network pattern group have shape factors lower than 0 1 and euler numbers smaller than 38 2 cluster the cluster pattern group contains globules with relatively large volumes but smaller than those in the network pattern set similarly their structures are less complex compared to those in the previous category typically this group of globules has shape factors in the range of 0 1 to 0 25 and euler numbers between 38 and 3 3 multiple the globules in the multiple pattern category have relatively small volumes and fairly simple structures they commonly reside in a few pores and throats this pattern group has shape factors in the range of 0 25 to 0 5 and euler numbers between 3 and 0 4 isolated the isolated pattern family represents globules that have small volumes and simple structures they occupy small pores crevices and the sharp corners of the pore elements the isolated globules have shape factors larger than 0 5 and euler numbers greater than 0 as the scco 2 injection progressed the volume contributions of the network pattern group to the remaining oil decreased while those of the cluster multiple and isolated pattern categories generally increased fig 10 in other words the network pattern family of remaining oil i e oil globules with large volumes and complex structures was the primary contributor to oil mobilization and production during the scco 2 injection as shown in fig 9 the euler numbers of the network pattern group are smaller than those of the other pattern categories a lower euler number indicates better local connectivity of a three dimensional structure andersson et al 2018 this means that the superior local connectivities of the oil globules with large volumes and complex structures left stranded after waterflooding facilitated their mobilization during the three phase flow process as the scco 2 injection continued the contributions of multiple and isolated pattern families to the remaining oil increased due to the production and or segmentation of the network and cluster pattern groups the remaining oil globules with such undesirable pattern classifications were more difficult to produce 3 5 2 local spreading layers layers play a crucial role in maintaining the local connectivity of fluids during displacements in the pore space alizadeh and piri 2014 sabti et al 2019 in this study two types of layers were identified for the oil phase wetting and spreading oil layers wetting oil layers formed in oil wet pore elements and as shown in fig 11 they were either sandwiched between the brine in the center and the corner of a pore or located in the corner of a pore it should be noted that in the latter situation a thin water film might have existed in the pore corner but its thickness was below the imaging resolution of the micro ct scanner three fluid phase systems are generally categorized into non spreading partially spreading and spreading systems depending on the initial and equilibrium values of spreading coefficients fenwick and blunt 1998 alizadeh and piri 2014 in general stable spreading layers form in spreading systems i e having an equilibrium spreading coefficient c s e q 0 whereas in partially spreading systems thin spreading films with negligible hydraulic conductivity exist i e having an initial spreading coefficient c s i 0 while a c s e q 0 nevertheless in this study we identified a type of spreading system that does not exactly fall under any of the aforementioned categories as shown in fig 12 spreading oil layers formed between scco 2 and brine in some pores whereas in others scco 2 was directly in contact with brine in other words spreading oil layers formed but did not globally exist although the equilibrium spreading coefficient of oil in the system was close to zero c s o e q σ g w e q σ g o e q σ o w e q 0 1 we name this configuration local spreading the observed pattern indicates that the spreading coefficient is not the only parameter that governs spreading phenomena in porous media otherwise spreading oil layers would form globally in the system in fact such phenomena depend on the interplay of several factors such as spreading coefficient pore geometry wettability and capillary pressure piri and blunt 2005a b qin et al 2019b due to the combined effects of these factors the stability and thickness of the spreading oil layers were not globally uniform consequently they collapsed in some pores resulting in direct contact between scco 2 and brine this is supported by the simulation studies conducted by zolfaghari and piri 2017a b their model used helmholtz free energy balance and mayer stowe princen msp method computing the thermodynamically consistent threshold capillary pressure for different displacements including the formations and collapses of spreading oil layers the results showed spreading oil layers could collapse locally in a traditionally defined spreading system in this situation there might have been thin sub resolution spreading oil films between the scco 2 and brine phases qin et al 2019b however as discussed by øren and pinczewski 1995 the connectivity of phases for the condition that a thin spreading film forms is similar to where three phases meet in a contact line i e non spreading condition the synergistic effects of the wetting and the newly defined local spreading layers contributed to the coalescence of isolated oil globules during the scco 2 injection process and enhanced the local connectivity of the oil phase to be specific an oil globule displaced by the scco 2 could mobilize in the porous media and subsequently merge with another oil cluster through the main terminal meniscus mtm interface khishvand et al 2016 qin et al 2021a besides this the mobilized oil globules could also reconnect with each other through the wetting and local spreading oil layers fig 13 illustrates the in situ thickness measurement for both types of oil layers 3 5 3 gaussian curvature the gaussian curvature of fluid fluid interfaces quantifies the connectivity of the fluids scanziani et al 2020 in general negative values of the gaussian curvature indicate well connected objects while positive values correspond to trapped globules armstrong et al 2019 at the early stage of scco 2 injection i e after 5 pvs the average value of the scco 2 oil gaussian curvature was negative indicating good connectivity of the two fluids within the pore space fig 14a the scco 2 was well connected since it was the injected phase as evident in the previous subsections the oil phase maintained acceptable connectivity due to the combined effects of wetting and local spreading oil layers and the abundance of oil globules from the network pattern group on the other hand the average value of the oil brine gaussian curvature was close to zero but positive fig 14a this revealed that brine had comparatively poor connectivity at this stage since oil was relatively well connected this verified that brine was segmented by oil and scco 2 due to snap off and bypassing mechanisms respectively during various double and multiple displacement events triggered by scco 2 injection which are further discussed in the next subsection after 35 pvs of scco 2 injection the average of the gaussian curvature between scco 2 and oil phases remained negative but shifted toward zero fig 14b in other words these two fluids were still mainly connected while oil connectivity was inferior to that at the early stage of the injection this resulted from the production of the oil globules from the network pattern family fig 10 the shrinkage of some local spreading oil layers during displacements and the collapse of some wetting oil layers due to the wettability reversal process in contrast the oil brine gaussian curvature did not change substantially even shifted slightly to the left of the curvature axis fig 14b this was attributed to the improvement in the brine connectivity as a result of the wettability reversal toward neutrally wet condition in summary all three fluid phases maintained relatively good connectivity at the later stages of the scco 2 injection which along with other mechanisms resulted in high displacement efficiency during this injection process 3 6 double and multiple displacements to investigate the displacement mechanisms during the near miscible scco 2 injection process fluid fluid displacement events were probed using in situ pore fluid occupancy maps comparing figs 15a with 15b and figs 15c with 15d reveals that both scco 2 to oil to brine and scco 2 to brine to oil double displacements took place during the scco 2 injection process while during tertiary n 2 injection in oil wet systems we observed mostly gas to oil to brine double displacements qin et al 2019b as discussed by qin et al 2019b the main reason for the lack of gas to brine to oil double displacements during the tertiary n 2 injection is that the pressure of the brine displaced by gas is not sufficiently high to further displace oil as the threshold brine pressure required for this event had became very high after the preceding waterflooding step in contrast the wettability reversal process during the near miscible scco 2 injection reduces the threshold brine pressures required for the brine to oil displacements p c t h c o s θ and this facilitates the occurrence of scco 2 to brine to oil double displacements similarly during the tertiary n 2 injection almost no multiple displacements exist due to the high threshold brine pressure required for the chain of brine to oil displacements qin et al 2019b however as shown in fig 16 scco 2 to oil to brine to oil scco 2 to brine to oil to brine scco 2 to oil to brine to oil to brine and scco 2 to brine to oil to brine to oil multiple displacements were identified as scco 2 injection progressed these displacements also benefited from the reduction of the threshold brine pressure of the displacements due to the wettability reversal process it is challenging to probe a variety of long chain multiple displacements in static x ray images nevertheless as discussed in section 3 4 the wetting preference of the solid surface to the scco 2 oil and brine phases became similar as the scco 2 injection continued i e the displacements that occurred in the system were either an imbibition process or a drainage process with low threshold pressure therefore one can conclude that various types of multiple displacements having scco 2 as the first phase and oil and brine as the subsequent phases could be afforded by the near miscible scco 2 injection the diversity and affordability of double and multiple displacements indicate that displacements could occur in various pore sizes resulting in an exceptional displacement efficiency during the near miscible scco 2 injection process this is evidenced by the low remaining oil saturation of 0 04 achieved at the end of this experiment compared to the value of 0 284 established in our previous tertiary n 2 injection study qin et al 2019b 3 7 interfacial areas finally to further verify the pore scale physics proposed in the previous subsections interfacial areas between the scco 2 oil scco 2 brine and oil brine fluid pairs were systematically analyzed as shown in fig 17 the interfacial area between scco 2 and oil was significantly larger than that between scco 2 and brine this is because the formation of scco 2 oil interfaces is energetically more favorable than the scco 2 brine counterpart due to low interfacial tension of the former under near miscible conditions furthermore the local spreading oil layers prompted more scco 2 oil contacts while reducing direct contacts between scco 2 and brine the improved interfacial contact between the former pair which continued to increase considerably at the early stages of the scco 2 injection is one of the key pre requisites for substantial oil mobilization through displacements as expected the scco 2 oil interfacial area decreased at the end of the scco 2 injection process due to the production of the majority of remaining oil the non zero values of scco 2 brine interfacial areas indicate the absence or collapse of spreading oil layers in some pore elements and verify the concept of the local spreading defined earlier interfacial area of this fluid pair gradually increased as scco 2 injection continued see fig 17 this is due to the synergistic effects of several factors i saturation of scco 2 increased in the medium ii some of the spreading oil layers collapsed during the displacement process due to the interplay of the local pore geometry local wettability and local capillary pressure and iii the wettability reversal process increased the water wetness of the solid surfaces which promoted the contacts between scco 2 and brine the oil brine interfacial area continuously decreased during the scco 2 injection due to the production of the two fluids the area was reduced to a very low value at the end of the injection 4 summary and conclusions in this study the pore scale physics of three phase flow under near miscible conditions was investigated experimentally in an oil wet porous medium tertiary near miscible supercritical co 2 injection was conducted in an oil wet carbonate at elevated temperature and pressure conditions using a miniature core flooding apparatus integrated with an x ray micro ct scanner several new attributes of the three phase flow behavior were identified from in situ pore fluid occupancy maps acquired during the flow experiments here we summarize the main findings the dissolution of scco 2 in crude oil resulting from a multiple contact partial miscibility process was directly identified using grayscale x ray images tertiary near miscible scco 2 injection achieved exceptional displacement efficiency brine and oil saturations of 0 52 and 0 48 established after secondary waterflooding were reduced to 0 07 and 0 04 respectively after 50 pvs of scco 2 injection in situ contact angle measurements provided direct experimental evidence that near miscible scco 2 injection triggered a wettability reversal process toward reduced oil wetness our observation indicated that when a light crude oil oil with low asphaltene content is used scco 2 brine carbonate interactions i e ion pairs between adsorbed negatively charged oil components and excessive ca 2 produced during scco 2 injection had a more profound impact on the wettability alteration compared to the effect of precipitation of oil polar components due to scco 2 dissolution two types of distinct wettability states were identified during the three phase scco 2 oil brine flow process under near miscible conditions at the early stages of the scco 2 injection both scco 2 and brine served as the non wetting phase while oil was the wetting fluid in other words no apparent intermediate wetting phase was observed in the system as the scco 2 injection was continued the wetting preference of the rock surface to all three phases became similar due to the wettability reversal effect in situ pore fluid occupancies showed that at the early stage of near miscible scco 2 injection scco 2 and brine co occupied the majority of the large pores whereas oil was present in pores with smaller sizes as the injection progressed pore sizes did not significantly restrict the displacement efficiency due to the wettability reversal and its consequence that pore scale displacement events were either an imbibition or a drainage process with a low threshold pressure the remaining oil globules during the scco 2 injection process were categorized into four pattern groups using shape factors and euler numbers the network pattern family i e oil globules with large volumes and complex structures was the primary contributor to oil mobilization and production due to their superior local connectivity a new type of spreading phenomena named local spreading was identified in the three phase scco 2 oil brine system in which spreading oil layers formed but did not exist globally between scco 2 and brine across the medium the synergistic effects of the wetting layers and the newly defined local spreading layers enhanced the connectivity of the oil phase in the rock pore space based on the gaussian curvature analysis after 5 pvs of scco 2 injection oil was relatively well connected across the medium due to its wetting and local spreading layers as well as the contribution of globules from the network pattern group brine connectivity however diminished due to snap off and bypassing by oil and scco 2 respectively as the scco 2 injection progressed all three phases maintained relatively good connectivity due to the wettability reversal effect which promoted more displacements with the injection of additional scco 2 the scco 2 to oil to brine and scco 2 to brine to oil double displacements as well as a variety of multiple displacement events having scco 2 as the first phase and oil and brine as the subsequent phases in the chain were observed during the near miscible scco 2 injection process this is different from tertiary n 2 injection in oil wet porous media where mainly gas to oil to brine double displacements could take place the diversity and favorable threshold pressures of the double and multiple displacement events contributed significantly to the remarkable displacement efficiency of the near miscible scco 2 injection process observed in this study credit authorship contribution statement ziqiang qin conceptualization methodology validation formal analysis investigation writing original draft writing review editing maziar arshadi conceptualization validation supervision writing review editing mohammad piri conceptualization methodology validation writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors gratefully acknowledge the financial support of thermo fisher scientific hess corporation and the university of wyoming the data presented in this paper may be obtained from the corresponding author appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j advwatres 2021 104057 appendix a supplementary data the following is the supplementary material related to this article mmc s1 supplementary materials 
228,near miscible supercritical co 2 injection in oil wet carbonate a pore scale experimental investigation of wettability state and three phase flow behavior ziqiang qin conceptualization methodology validation formal analysis investigation writing original draft writing review editing maziar arshadi conceptualization validation supervision writing review editing mohammad piri conceptualization methodology validation writing review editing supervision project administration funding acquisition center of innovation for flow through porous media department of petroleum engineering university of wyoming laramie wy 82071 usa center of innovation for flow through porous media department of petroleum engineering university of wyoming laramie wy 82071 usa center of innovation for flow through porous media department of petroleum engineering university of wyoming laramie wy 82071 usa corresponding author near miscible supercritical co 2 scco 2 injection and its underlying pore scale physics were experimentally investigated in an oil wet carbonate rock at elevated temperature and pressure conditions using x ray microtomography the results of in situ contact angle measurements yielded direct evidence showing that the scco 2 injection triggered a wettability reversal process resulting in reduced oil wetness as the scco 2 injection progressed we observed a distinct wettability state where the wetting preference of the solid to the scco 2 oil and brine phases was similar due to the wettability reversal consequently pore sizes neither dictated any preferential invasion order nor restricted the displacement efficiency of the injection process furthermore we identified a type of spreading system where spreading oil layers formed but did not exist globally across the pore space between the scco 2 and brine phases gaussian curvature analysis showed that the scco 2 and oil phases were well connected at the early stage of the scco 2 injection whereas brine connectivity was relatively poor as the injection continued brine connectivity was improved due to the wettability reversal effect moreover displacement events including double and multiple displacements were identified and discussed they included a variety of events that had scco 2 as the first phase and oil and brine as the subsequent phases the diversity and affordability of such displacements were much higher than those previously observed during n2 injection in oil wet systems where mostly gas to oil to brine double displacements took place the interplay of scco 2 oil miscibility the distinctive wettability state favorable fluid connectivity and frequent double multiple displacements resulted in an exceptional displacement efficiency during near miscible scco 2 injection keywords near miscible supercritical co2 injection in situ wettability pore scale displacement physics x ray microtomography three phase flow porous media 1 introduction three phase flow through porous media is a complicated displacement process encountered in many natural and anthropogenic systems sabti et al 2019 scanziani et al 2020 examples include the removal of non aqueous phase liquid napl contaminants from aquifers sequestration of greenhouse gases in geological formations and enhanced oil recovery eor from hydrocarbon reservoirs for instance miscible co 2 injection in the reservoirs is favorable due to its remarkably high displacement efficiency as well as its potential to enable storage of a significant amount of co 2 in geological formations nevertheless this scheme needs to be applied at pressures higher than minimum miscibility pressure mmp of co 2 ren et al 2011 and therefore requires high injection pressures and or enriched gases which are both economically expensive and operationally challenging alhosani et al 2019 to overcome these practical challenges the idea of injecting co 2 at pressures slightly below the minimum miscibility pressure i e at near miscible conditions was proposed although co 2 injection under these conditions results in non negligible interfacial tension between the injectant and oil the scheme sufficiently lowers it such that the displacement efficiency can still be comparable to that of miscible gas injection grigg and schechter 1997 schechter et al 1998 chen et al 2017 furthermore near miscible injection similar to miscible process enables sequestration of substantial amounts of co 2 in the target geologic formations it is also more cost effective and less challenging to implement making it a more preferable choice for field scale commercial applications ren et al 2011 near miscible co 2 injection involves coexistence of three fluid phases namely brine oil and co 2 in the pore space although some research studies have been dedicated to investigating three phase flow in permeable media with different wetting conditions piri and blunt 2005a qin et al 2019b scanziani et al 2020 the flow behavior of three phases involving co 2 under near miscible conditions particularly in oil wet carbonates and at the pore scale has not received much attention shyeh yung 1991 investigated the performance of both miscible and near miscible co 2 injection in carbonate rocks through macroscopic core flooding experiments and reported that the displacement efficiencies under both schemes were similar the author attributed the high displacement efficiency under the near miscible condition to low gas oil interfacial tension alkhazmi et al 2018 conducted near miscible water alternating gas wag injection experiments in water wet carbonate rocks and found that in the gas injection steps the displacements were maintained after gas breakthrough due to the near miscibility effect between the gas and oil phases which allowed the two fluids to flow simultaneously within the pore space toward the core outlet the majority of pore scale experimental studies investigating the governing displacement physics of near miscible gas injection have been conducted in micromodels despite the fact that they do not adequately represent complexities of the wettability and pore structure of naturally occurring rocks qin et al 2019b sohrabi et al 2008b a studied near miscible gas injection in a water wet micromodel and concluded that the crossflow of oil into the main gas flow stream was responsible for the oil mobilization they also observed that near miscible gas flooding led to more oil displacements in secondary mode i e prior to waterflooding compared to that of tertiary mode i e after waterflooding seyyedi and sohrabi 2020 further probed the displacement physics of tertiary near miscible co 2 flooding in water wet micromodels the formation of spreading oil layers and capillary crossflow of co 2 i e the invasion of co 2 into the bypassed oil were proposed as the main mechanisms that facilitated oil mobilization they also showed that a significant amount of co 2 was stored in the porous media under near miscible conditions over the past decade the advancements in in situ imaging technologies specifically x ray micro computed tomography micro ct have provided remarkable opportunities for researchers to investigate complex multiphase flow processes including near miscible co 2 flooding in natural porous media at the micro scale wildenschild and sheppard 2013 blunt et al 2013 armstrong et al 2019 qin et al 2019a alhosani et al 2019 recently examined secondary near miscible co 2 injection in a water wet carbonate using a micro ct scanner a high displacement efficiency up to 80 of the original oil in place was reported in their experiments using pore fluid occupancy maps they observed that co 2 tended to reside in large pores oil presented in medium and small sized pores while water occupied pores of varying sizes small medium and large during near miscible co 2 injection this was different than the occupancy in an immiscible system under water wet condition where water occupied only the smallest pores scanziani et al 2018 furthermore no spreading oil layer was observed between the gas and brine phases in their experiments in other words oil flowed in the center of pores rather than through layers when displaced by gas while this work has been conducted on carbonate rocks at the pore level the wettability condition of the rock fluid system was water wet which is not typical of most carbonate reservoirs the trends in oil wet carbonate rocks could be different as wettability significantly impacts the fluid occupancy and flow behavior in porous media qin et al 2019a arshadi et al 2020 to date a very limited number of research studies have been dedicated to systematically probe the displacement physics of three phase co 2 oil brine flow during near miscible co 2 injection in oil wet carbonates highlighting the need for more studies to help improve the design of this enhanced oil recovery and co 2 sequestration process at the field scale alhosani et al 2020b in this study we investigated near miscible supercritical co 2 scco 2 injection process and its associated pore scale displacement physics in an oil wet carbonate rock at elevated pressure and temperature conditions flow experiment consisting of multiple displacement stages were designed and performed using a miniature core flooding setup integrated with a high resolution x ray micro ct scanner qin et al 2021a pore scale images were utilized to systematically examine the scco 2 oil miscibility in situ wettability spreading phenomenon fluid occupancy and connectivity and displacement events during near miscible scco 2 injection process the new insights developed in this study significantly improve the current understanding of near miscible three phase flow in porous media 2 materials and methods 2 1 rock and fluid properties a miniature core sample 8 9 mm in diameter and 47 mm in length was drilled from a block of fond du lac carbonate outcrop from wisconsin usa this rock was selected because it contained less micro porosity than most carbonates zinszner and pellerin 2007 fullmer et al 2014 thereby minimizing uncertainties in porosity and in situ fluid saturation calculations using x ray micro ct images a detailed mineral map of the rock generated using the qemscan quantitative evaluation of minerals by scanning electron microscopy imaging technique indicated that the rock was mainly composed of dolomite see figure s1 in the supplementary materials detailed measurement procedures are explained elsewhere qin et al 2021b barsotti et al 2021 the average porosity of the sample calculated from micro ct images using a histogram thresholding technique was 11 2 and its absolute permeability to brine was 36 md the x ray porosity value was similar to the porosity determined with a helium porosimeter on a companion 38 1 mm core plug i e 11 8 drilled from the same block of rock this further verified the insignificant amount of micro porosity present in the rock figure s2 in the supplementary materials shows the three dimensional pore size distribution of the sample obtained from the micro ct images and its calculation techniques table 1 tabulates geometrical and petrophysical properties of the miniature core sample brine was synthesized using 19 wt nai 0 5 wt cacl 2 and distilled water in this study the connate brine and the brine used for waterflooding shared the same composition to minimize mineral dissolution during the flow experiment a sacrificial core plug was immersed in the prepared brine solution for ionic equilibration prior to injection qin et al 2021a the oil phase was a crude oil collected from a reservoir located in the permian basin texas usa the oil was filtered through a 0 5 μ m filter to remove possible residue and debris and then doped with 12 5 vol 1 iodooctane supercritical co 2 scco 2 was used as the third phase optimum concentrations of dopants in oil and brine were determined by conducting a series of x ray compatibility tests to optimize the image quality and minimize segmentation errors table 1 lists the properties of the fluids densities and viscosities of the brine and crude oil were measured at 50 c and ambient pressure those of supercritical co 2 were obtained from the literature lemmon 2013 at the experimental conditions 50 c and 1500 psig i e 10 34 mpa the interfacial tensions were measured at the experimental conditions when three phases co 2 doped oil brine are in equilibrium interfacial tension ift between the co 2 and doped oil was measured using the pendant drop method and axisymmetric drop shape analysis adas technique details of the experimental setup and procedure used can be found elsewhere saraji et al 2013 at the experimental temperature condition 50 c equilibrium ift was measured at ten different pressures ranging from 200 to 1100 psig i e 1 39 to 7 58 mpa and then minimum miscibility pressure mmp between the co 2 and doped oil was determined using a vanishing interfacial tension vit technique fig 1 as shown in the figure the mmp was found to be 1644 psig 11 33 mpa at 50 c thus the flow experiment was conducted at 1500 psig 10 34 mpa and 50 c to achieve a near miscible condition at these pressure and temperature conditions the co 2 was in a supercritical state 2 2 experimental apparatus the experiments were performed using a core flooding setup integrated with an x ray micro ct scanner the core flooding setup consisted of five quizix 5000 series pumps a isco 260d pump a custom built miniature carbon fiber core holder a high pressure cell heating and isolation systems and a set of rosemount differential pressure transducers the high pressure cell was used to pre equilibrate scco 2 with brine at the experimental conditions 50 c and 1500 psig i e 10 34 mpa prior to injection this was done to mitigate possible mass transfer between the brine and scco 2 and thereby prevent potential salt participation in the pore space to minimize scco 2 diffusion from the pore space into the confining fluid chamber of the core holder during the experiments an aflas sleeve was used in the core holder and the core sample was wrapped with teflon tape and aluminum foil before being inserted into the sleeve the core holder was wrapped with special heating hardware to maintain its temperature during the experiment furthermore fluids were heated up to the experimental temperature in an oven before being injected into the core holder highly flexible peek tubing was connected to the core holder to minimize vibration and torque during the scanning process the peek tubing was insulated to maintain the temperature of fluids the x ray imaging system was a heliscan micro ct scanner manufactured by fei now thermo fisher scientific the scanner provided helical scanning mode and an iterative reconstruction technology to produce high signal to noise ratio images figure s3 in the supplementary materials shows a schematic illustration of the experimental setup used in this study additional details of the experimental apparatus can be found elsewhere qin et al 2019a 2 3 experimental procedure and data analysis to start the experiments the miniature core sample was placed in the core holder put under an initial confining pressure of 200 psig 1 38 mpa and imaged with the micro ct scanner to collect a set of reference scans imaging parameters are listed in table 2 subsequently the sample was flooded with gaseous co 2 to remove bulk air from the pore space and then vacuum saturated with the formation brine at this point the pore and confining pressures were simultaneously increased to 1500 and 1700 psig i e 10 34 and 11 72 mpa respectively and the temperature of the system was set at 50 c primary drainage was conducted by injecting the oil into the sample at a flow rate of 0 02 cc min to establish an initial water saturation s wi after the differential pressure across the sample reached steady state oil injection was stopped and the pore space was scanned to determine s wi the sample was then dynamically aged at s wi by continually injecting the oil at 0 0006 cc min the core was scanned periodically during the aging process and the micro ct images were utilized to monitor changes in oil brine contact angle the aging process was considered to be complete when the oil brine contact angle reached an equilibrium value and did not change further this was achieved after 17 days after completion of the aging process the core sample was subjected to a waterflood at a flow rate of 0 004 cc min under a capillary dominated flow regime a capillary number of 2 1 1 0 7 in the final step the sample was subjected to near miscible scco 2 injection at a flow rate of 0 03 cc min the scco 2 was injected from the top of the core the pore space was repeatedly imaged during all injection sequences of the experiment an injection process was terminated when in situ fluid occupancies within the field of view remained unchanged during various stages of the experiments the middle section of the core sample was scanned to avoid any adverse impact of the end effects on the acquired images the imaging resolution and the volume of the field of view fov were 3 04 μ m and 8 9 8 9 6 4 mm 3 respectively this resolution was selected to ensure that the entire cross section of the sample was captured in the fov the resolution was sufficient to accurately characterize the in situ wettability of the medium qin et al 2021a due to the high image quality and the relatively large pore size of the fond du lac rock fig 2 the raw grayscale images were processed using avizo 9 4 0 and pergeos 1 7 0 software packages after applying the non local means filter each image set acquired during each flow step was aligned and registered with the dry reference image the registered wet image sets were then multiplied by the pore map obtained from the reference image to eliminate the solid phase the multiplied images were segmented to the brine oil and scco 2 phases using a watershed technique next the segmented images were subjected to a quantitative image analysis to measure the in situ contact angles a sub volume of the segmented images was extracted the fluid fluid solid contact line was then traced and a plane perpendicular to the three phase contact line was visualized in this plane the contact angle was measured at the intersection of the fluid solid and fluid fluid tangents through the denser phase the flow was stopped and the system was allowed to reach equilibration before imaging therefore the measured contact angles were considered equilibrium values for each fluid pair at a flooding stage 30 contact angles were measured at randomly selected locations to obtain the distribution of in situ wettability as shown in previous studies khishvand et al 2016 the in situ contact angle measurement method implemented here has an absolute error value within 2 degrees due to uncertainties associated with identifying fluid fluid and rock fluid interfaces which was considered insignificant for the gaussian and mean curvature analysis the fluid fluid interfaces were first extracted from the three dimensional sub volume of the segmented images subsequently the extracted interfaces were smoothed using the generalized marching cubes algorithm the curvature was then obtained by approximating the surface locally as a quadratic form the eigenvalues and eigenvectors of the quadratic form were referred to as the principal curvature values and the directions of the principal curvature respectively lin et al 2018 finally the gaussian and mean curvatures were calculated as the product and the average of the two principal curvatures respectively additional details on the data acquisition and image analysis techniques are provided elsewhere qin et al 2019a 3 results and discussion in the following subsections we mainly present our observations and findings of the scco 2 injection stage of the experiments to explore the pore scale physics of three phase scco 2 oil brine flow under near miscible conditions in the aged carbonate rock sample we first probe the miscibility between scco 2 and crude oil and calculate fluid saturations at various stages of the tests subsequently the pore scale physics governing the evolution of in situ fluid saturations are discussed specifically we investigate in situ wettability and its impact on pore fluid occupancies during the near miscible scco 2 injection furthermore the connectivity of fluid clusters is probed as it is one of the key factors that govern the mobilization of the fluids in the pore space displacement events including double and multiple displacements are identified and discussed finally the interfacial areas between scco 2 oil scco 2 brine and oil brine phases are examined to verify the pore scale physics discussed through the above mentioned analyses 3 1 multiple contact partial miscibility miscibility between scco 2 and crude oil is beneficial because the dissolution of the former in the crude oil results in oil swelling and viscosity reduction arshad et al 2009 ren et al 2011 which facilitate oil mobilization for instance several researchers simon and graue 1965 huang and tracht 1974 have measured the volume of the co 2 saturated crude oil at controlled pressure and temperature conditions and compared it with that of the dead crude oil at the same condition they found that the co 2 saturated oil volume increased as the pressure was increased i e more co 2 was dissolved into the crude oil furthermore sun et al 2017 reported that the viscosity of crude oil in their study is reduced exponentially with the increasing pressure of co 2 in their bulk experiments the viscosity reduction rate could reach 96 at a saturation pressure of 8 mpa in this study as the scco 2 invades the pore space and contacts the waterflood remaining oil multiple contact miscibility between the two fluids can partially be achieved fatemi and sohrabi 2013 the process of scco 2 dissolution may be captured in micro ct images as grayscale intensities of phases reflect the extent of x ray attenuation during the imaging process fig 2 shows grayscale x ray images of the pore space during near miscible scco 2 injection at different pore volumes pvs as observed in fig 2a the grayscale intensities of different oil clusters were relatively homogeneous across the fov for the first 5 pore volumes of the injection however as the injection continued the intensity of the oil phase became somewhat uneven in different clusters fig 2b and c primarily due to the dissolution of the scco 2 in the crude oil upon contact during the injection process the miscibility between these two fluids is expected to occur through multiple contacts rather than first contact process arshad et al 2009 furthermore the dissolution of scco 2 in crude oil is a gradual process and its rate depends on several factors such as temperature and pressure conditions crude oil properties the purity of scco 2 topology of the pore space and interfacial contact areas li et al 2018 zhang et al 2018 fatemi and sohrabi 2013 gong and piri 2020 therefore it was expected that after a period of scco 2 injection and depending on fluid fluid contact areas different oil globules residing in the medium would contain different amounts of dissolved scco 2 and consequently exhibit different x ray intensities in the micro ct images as mentioned earlier the dissolved scco 2 could swell the oil and reduce its viscosity these along with other mechanisms that are elaborated on in the following subsections promoted the local displacements of the crude oil by scco 2 at the end of the injection the majority of the oil clusters that had sufficient contact with scco 2 were produced from the medium see fig 2d the residual oil globules left stranded in the pore space at this stage typically had limited contact with scco 2 it should be noted that local variations in the oil phase intensity did not impose any challenges to accurately segment the scco 2 oil and brine phases in the micro ct images because the x ray attenuation contrasts between scco 2 oil and oil brine phases remained adequate figure s4 in the supplementary materials 3 2 in situ saturations during the various stages of the experiments saturations of fluids were determined from the segmented pore fluid occupancy maps as shown in figure s5 in the supplementary materials the imaging fov was much larger than the porosity and saturation based representative elementary volumes revs of the sample meaning that the saturation values obtained in this study faithfully represent the average saturations of the entire sample an initial oil saturation of 0 78 i e s wi 0 22 was established after the dynamic aging process in the subsequent waterflood the oil saturation reduced to only 0 62 after injecting 5 pvs of the brine which was expected from an oil wet system qin et al 2019a alhosani et al 2020a the oil saturation ultimately reached 0 48 after 14 pvs of brine injection and did not change further therefore this saturation was considered as the waterflood remaining oil saturation s orw during the near miscible scco 2 injection process the scco 2 and oil saturations reached 0 15 and 0 39 respectively after injecting 5 pvs of the fluid the oil saturation further decreased to 0 30 after 15 pvs of the injection while the scco 2 saturation increased to 0 33 this process achieved an exceptional displacement efficiency with oil and scco 2 saturations of 0 04 and 0 89 respectively after 50 pvs of the injection fig 3 summarizes the fluid saturations during various stages of the experiment 3 3 in situ wettability wettability of the medium was characterized during the experiments by measuring fluid fluid contact angles on the surface of pore walls the average oil brine contact angle established at the end of the aging process was 114 fig 4a i which falls in the weakly oil wet range after waterflooding the contact angle was measured to be 113 see fig 4a ii indicating that no apparent wettability alteration occurred due to the waterflood however after 5 pvs of scco 2 injection the average oil brine contact angle decreased to 107 fig 4a iii this value further dropped to 97 after 50 pvs of scco 2 injection fig 4a iv a vi and b the average values of the equilibrium contact angle distributions were reported in order to mitigate the human errors and the effects of hysteresis on contact angle measurements thus the variation of the average contact angle values clearly indicated that the near miscible scco 2 injection process triggered a wettability reversal in the medium toward reduced oil wetness fig 5 shows a local visualization of the wettability reversal during the scco 2 injection two mechanisms may cause wettability alteration during co 2 injection the dissolution of co 2 into the oil phase may destabilize heavy polar components of crude oil and cause their precipitation and adsorption onto rock surfaces sohrabi et al 2015 this can result in wettability alteration toward increased oil wetness especially in heavy oil systems with high asphaltene contents on the other hand co 2 can also dissolve in the brine phase and increase the concentration of ca 2 in the fluid according to the following reaction 1 caco 3 h 2 o co 2 2 hco 3 ca 2 the ca 2 cations in the brine can form ion pairs with the adsorbed negatively charged oil polar components and release some of them from carbonate surfaces resulting in a wettability reversal toward reduced oil wetness seyyedi et al 2015 qin et al 2021a as shown in fig 4b the average in situ oil brine contact angle continued to decrease during scco 2 injection this highlights that scco 2 brine rock interactions i e the second mechanism described above dominated the wettability alteration process in our study this is supported by the relatively low asphaltene content of the permian crude oil used in this study nonetheless scco 2 deployment in heavier oil reservoirs warrants careful thermodynamics and phase behavior studies of the fluids to avoid possible asphaltene precipitation and formation damage the wetting preference of the porous medium to scco 2 and brine was also investigated by measuring in situ scco 2 brine contact angles at where direct contact of these two fluids were observed as shown in fig 6 brine was slightly more wetting compared to scco 2 while the differences in the wetting preference of the rock to scco 2 and brine were small the average in situ scco 2 brine contact angles were 86 87 86 and 89 after 5 15 35 and 50 pvs of the scco 2 injection respectively the contact angle values showed negligible variation during this process average values of the mean curvature between the scco 2 and brine phases were also measured to be positive but near zero see fig 7b and c which confirmed the above mentioned wetting preference this is probably due to the abundance of mass transfer between the scco 2 and brine sabirzyanov et al 2002 steel et al 2016 generally there are wetting intermediate wetting and non wetting phases in a porous medium containing three fluids øren and pinczewski 1995 piri and blunt 2005a alhosani et al 2019 qin et al 2019b 2021a in this particular study based on the in situ contact angle measurements we observed a wetting state where both the scco 2 and brine phases served as almost equally non wetting phases compared to the crude oil at the early stages of scco 2 injection average scco 2 brine contact angles were close to 90 in other words no apparent intermediate wetting phase was identified in the system as the scco 2 injection process continued the wetting preference of the rock surface to all three phases present in the medium i e scco 2 brine and crude oil became similar due to the observed wettability reversal toward reduced oil wetness the average values of scco 2 brine and oil brine mean curvatures confirmed the proposed wetting state see fig 7c as it is discussed in detail in the following subsections this distinct wettability state directly impacts the fluid occupancies and displacement events in the medium it is worth noting that the observed wetting state had not been seen in our previous three phase flow studies conducted with n 2 and gaseous co 2 under oil wet conditions qin et al 2019b 2021a where oil brine and gas phases were the wetting intermediate wetting and non wetting phases respectively furthermore the observed wetting state was also different from that during near miscible co 2 injection in a water wet carbonate reported by alhosani et al 2019 in their experiment water was the wetting phase while gas and oil served as the non wetting phases in addition we examined the bartell osterhoff constraint in our system bartell osterhoff equation relates contact angles and interfacial tensions in a three phase system in equilibrium condition bartell and osterhof 1927 2 σ g b e q c o s θ g b σ g o e q c o s θ g o σ o b e q c o s θ o b where σ g b e q σ g o e q and σ o b e q are the equilibrium interfacial tensions and θ g b θ g o and θ o b are the equilibrium contact angles between gas brine gas oil and oil brine phases respectively using the interfacial tension values reported in table 1 as well as the average oil brine and scco 2 brine contact angles presented in table 3 we compared the predicted scco 2 oil contact angle from equation 2 and its measured value in the ct images at the end of the scco 2 injection table 3 shows that there is a significant difference between the two values the observed deviation is consistent with the recent study by scanziani et al 2020 as discussed by scanziani et al the bartell osterhoff equation is defined for three phases in equilibrium at the same location in a system with constant wettability which is not the case for the naturally occurring rocks with complex pore structure and heterogeneous wettability furthermore the slope of the cosine function is large in the vicinity of 90 meaning the uncertainty of the estimation is amplified in the neutral wet regime i e the wettability condition of this system therefore one needs to consider the uncertainty of employing bartell osterhoff constraint in a natural porous medium at neutral wet conditions 3 4 in situ pore fluid occupancy during waterflooding brine mainly displaced oil from large pore elements in the medium fig 8a while a significant amount of oil was left stranded in the medium and small sized pores because they were bypassed by the brine this was expected due to the weakly oil wet condition of the medium qin et al 2021a at the early stages of the scco 2 injection e g after 5 pvs the invading fluid preferably occupied the large pores fig 8b which were mostly occupied by brine previously fig 8a a closer look at fig 8b reveals that scco 2 and brine co occupied considerable portions of the large pores e g diameter 600 μ m at this stage this is consistent with the previous findings of the in situ contact angle measurements indicating that both scco 2 and brine phases served as the non wetting phase compared to oil on the other hand oil saturation was higher in smaller pore sizes this was because oil was still the wetting phase at this stage it is worth noting that the oil saturation in the pores with diameters larger than 800 μ m slightly increased after 5 pvs of the scco 2 injection see fig 8a and b this is attributed to the wettability reversal as well as double and multiple displacement events during scco 2 injection such a fluid redistribution was expected to facilitate oil production as the injected scco 2 preferably flowed through the large sized pores as the injection continued e g after 15 pvs the increase in scco 2 saturation in the pores with diameters larger than 800 μ m was insignificant because the saturation of scco 2 in these pores was already high and the remaining brine in them could have lost its connectivity to the main flow path in order to leave the sites the scco 2 saturation increased mainly in the medium and small sized pores at this stage fig 8c due to the wettability reversal and the low interfacial tensions between the scco 2 and oil as well as the scco 2 and brine alhosani et al 2019 some of the brine that was displaced by the scco 2 was diverted back into pore elements previously filled with the scco 2 e g see pores with diameters of approximately 1200 μ m in fig 8b and c such observations verify the dynamic fluid redistribution within the medium due to pore scale displacement events we provide further details on this topic in the following subsections after 35 pvs of scco 2 injection almost all the pore elements with diameters larger than 550 μ m were occupied by this fluid fig 8d furthermore the scco 2 saturation continuously increased in pores with diameters smaller than 550 μ m in contrast brine resided mainly in medium and small pores fig 8d shows that the brine saturation was higher in smaller pore size categories at this stage which demonstrates an increased water wet tendency compared to the previous flooding steps see fig 8a c this is a direct consequence of the scco 2 induced wettability reversal process as discussed in the previous subsection the average oil brine contact angle reached 98 at this stage which is a neutrally wet condition similarly the contact angle between the scco 2 and brine phases was 86 hence there were no obvious wetting and non wetting phases in the medium i e the wetting preferences of the solid surface to the scco 2 oil and brine phases were similar this unique wettability state resulted in a high displacement efficiency during the near miscible scco 2 injection process because the displacements that occurred in the system were either an imbibition or a drainage process with a low absolute threshold pressure value p c t h c o s θ r where p c t h is the threshold capillary pressure θ is the fluid fluid contact angle and r is the effective radius of the pore element consequently oil and brine saturations were reduced in all pore size categories fig 8c and d as pore sizes did not dictate the invasion order under this distinct wettability condition after 50 pvs of scco 2 injection most of the pore elements were occupied by this fluid fig 8e and only trace amounts of oil and brine remained in the medium 3 5 connectivity of the fluids hydraulic connectivity is one of the key factors that regulate the mobilization of fluids in porous media to further investigate the pore scale physics that govern displacements due to near miscible scco 2 injection the connectivities of the fluids were systematically examined using shape factor euler number layer characterization and gaussian curvature methods 3 5 1 shape factor and euler number the wetting phase globules i e oil ganglia remained in the medium during the waterflooding and the subsequent scco 2 injection were statistically classified using shape factor and euler number prodanović et al 2007 andersson et al 2018 shape factor characterizes the sphericity of a fluid globule 3 g 6 π v s 1 5 where g is the shape factor and v and s are the volume and surface area of a fluid globule the value of g becomes greater as the sphericity of a globule increases and it reaches 1 when the globule has a perfect spherical shape euler number is an indicator of the connectivity of a complex three dimensional structure 4 χ β 0 β 1 β 2 where χ is the euler number β 0 is the number of connected components β 1 is the number of loops and β 2 is the number of enclosed cavities utilizing the shape factor g and euler number χ remaining oil globules were categorized into four pattern groups namely network cluster multiple and isolated see fig 9 the characteristics and the criteria used to classify the various pattern groups are 1 network the network pattern group includes remaining oil globules that have large volumes and complex structures with good inner connectivities they usually exist in the enrichment area of the remaining oil after the non wetting phase injection in general the globules in the network pattern group have shape factors lower than 0 1 and euler numbers smaller than 38 2 cluster the cluster pattern group contains globules with relatively large volumes but smaller than those in the network pattern set similarly their structures are less complex compared to those in the previous category typically this group of globules has shape factors in the range of 0 1 to 0 25 and euler numbers between 38 and 3 3 multiple the globules in the multiple pattern category have relatively small volumes and fairly simple structures they commonly reside in a few pores and throats this pattern group has shape factors in the range of 0 25 to 0 5 and euler numbers between 3 and 0 4 isolated the isolated pattern family represents globules that have small volumes and simple structures they occupy small pores crevices and the sharp corners of the pore elements the isolated globules have shape factors larger than 0 5 and euler numbers greater than 0 as the scco 2 injection progressed the volume contributions of the network pattern group to the remaining oil decreased while those of the cluster multiple and isolated pattern categories generally increased fig 10 in other words the network pattern family of remaining oil i e oil globules with large volumes and complex structures was the primary contributor to oil mobilization and production during the scco 2 injection as shown in fig 9 the euler numbers of the network pattern group are smaller than those of the other pattern categories a lower euler number indicates better local connectivity of a three dimensional structure andersson et al 2018 this means that the superior local connectivities of the oil globules with large volumes and complex structures left stranded after waterflooding facilitated their mobilization during the three phase flow process as the scco 2 injection continued the contributions of multiple and isolated pattern families to the remaining oil increased due to the production and or segmentation of the network and cluster pattern groups the remaining oil globules with such undesirable pattern classifications were more difficult to produce 3 5 2 local spreading layers layers play a crucial role in maintaining the local connectivity of fluids during displacements in the pore space alizadeh and piri 2014 sabti et al 2019 in this study two types of layers were identified for the oil phase wetting and spreading oil layers wetting oil layers formed in oil wet pore elements and as shown in fig 11 they were either sandwiched between the brine in the center and the corner of a pore or located in the corner of a pore it should be noted that in the latter situation a thin water film might have existed in the pore corner but its thickness was below the imaging resolution of the micro ct scanner three fluid phase systems are generally categorized into non spreading partially spreading and spreading systems depending on the initial and equilibrium values of spreading coefficients fenwick and blunt 1998 alizadeh and piri 2014 in general stable spreading layers form in spreading systems i e having an equilibrium spreading coefficient c s e q 0 whereas in partially spreading systems thin spreading films with negligible hydraulic conductivity exist i e having an initial spreading coefficient c s i 0 while a c s e q 0 nevertheless in this study we identified a type of spreading system that does not exactly fall under any of the aforementioned categories as shown in fig 12 spreading oil layers formed between scco 2 and brine in some pores whereas in others scco 2 was directly in contact with brine in other words spreading oil layers formed but did not globally exist although the equilibrium spreading coefficient of oil in the system was close to zero c s o e q σ g w e q σ g o e q σ o w e q 0 1 we name this configuration local spreading the observed pattern indicates that the spreading coefficient is not the only parameter that governs spreading phenomena in porous media otherwise spreading oil layers would form globally in the system in fact such phenomena depend on the interplay of several factors such as spreading coefficient pore geometry wettability and capillary pressure piri and blunt 2005a b qin et al 2019b due to the combined effects of these factors the stability and thickness of the spreading oil layers were not globally uniform consequently they collapsed in some pores resulting in direct contact between scco 2 and brine this is supported by the simulation studies conducted by zolfaghari and piri 2017a b their model used helmholtz free energy balance and mayer stowe princen msp method computing the thermodynamically consistent threshold capillary pressure for different displacements including the formations and collapses of spreading oil layers the results showed spreading oil layers could collapse locally in a traditionally defined spreading system in this situation there might have been thin sub resolution spreading oil films between the scco 2 and brine phases qin et al 2019b however as discussed by øren and pinczewski 1995 the connectivity of phases for the condition that a thin spreading film forms is similar to where three phases meet in a contact line i e non spreading condition the synergistic effects of the wetting and the newly defined local spreading layers contributed to the coalescence of isolated oil globules during the scco 2 injection process and enhanced the local connectivity of the oil phase to be specific an oil globule displaced by the scco 2 could mobilize in the porous media and subsequently merge with another oil cluster through the main terminal meniscus mtm interface khishvand et al 2016 qin et al 2021a besides this the mobilized oil globules could also reconnect with each other through the wetting and local spreading oil layers fig 13 illustrates the in situ thickness measurement for both types of oil layers 3 5 3 gaussian curvature the gaussian curvature of fluid fluid interfaces quantifies the connectivity of the fluids scanziani et al 2020 in general negative values of the gaussian curvature indicate well connected objects while positive values correspond to trapped globules armstrong et al 2019 at the early stage of scco 2 injection i e after 5 pvs the average value of the scco 2 oil gaussian curvature was negative indicating good connectivity of the two fluids within the pore space fig 14a the scco 2 was well connected since it was the injected phase as evident in the previous subsections the oil phase maintained acceptable connectivity due to the combined effects of wetting and local spreading oil layers and the abundance of oil globules from the network pattern group on the other hand the average value of the oil brine gaussian curvature was close to zero but positive fig 14a this revealed that brine had comparatively poor connectivity at this stage since oil was relatively well connected this verified that brine was segmented by oil and scco 2 due to snap off and bypassing mechanisms respectively during various double and multiple displacement events triggered by scco 2 injection which are further discussed in the next subsection after 35 pvs of scco 2 injection the average of the gaussian curvature between scco 2 and oil phases remained negative but shifted toward zero fig 14b in other words these two fluids were still mainly connected while oil connectivity was inferior to that at the early stage of the injection this resulted from the production of the oil globules from the network pattern family fig 10 the shrinkage of some local spreading oil layers during displacements and the collapse of some wetting oil layers due to the wettability reversal process in contrast the oil brine gaussian curvature did not change substantially even shifted slightly to the left of the curvature axis fig 14b this was attributed to the improvement in the brine connectivity as a result of the wettability reversal toward neutrally wet condition in summary all three fluid phases maintained relatively good connectivity at the later stages of the scco 2 injection which along with other mechanisms resulted in high displacement efficiency during this injection process 3 6 double and multiple displacements to investigate the displacement mechanisms during the near miscible scco 2 injection process fluid fluid displacement events were probed using in situ pore fluid occupancy maps comparing figs 15a with 15b and figs 15c with 15d reveals that both scco 2 to oil to brine and scco 2 to brine to oil double displacements took place during the scco 2 injection process while during tertiary n 2 injection in oil wet systems we observed mostly gas to oil to brine double displacements qin et al 2019b as discussed by qin et al 2019b the main reason for the lack of gas to brine to oil double displacements during the tertiary n 2 injection is that the pressure of the brine displaced by gas is not sufficiently high to further displace oil as the threshold brine pressure required for this event had became very high after the preceding waterflooding step in contrast the wettability reversal process during the near miscible scco 2 injection reduces the threshold brine pressures required for the brine to oil displacements p c t h c o s θ and this facilitates the occurrence of scco 2 to brine to oil double displacements similarly during the tertiary n 2 injection almost no multiple displacements exist due to the high threshold brine pressure required for the chain of brine to oil displacements qin et al 2019b however as shown in fig 16 scco 2 to oil to brine to oil scco 2 to brine to oil to brine scco 2 to oil to brine to oil to brine and scco 2 to brine to oil to brine to oil multiple displacements were identified as scco 2 injection progressed these displacements also benefited from the reduction of the threshold brine pressure of the displacements due to the wettability reversal process it is challenging to probe a variety of long chain multiple displacements in static x ray images nevertheless as discussed in section 3 4 the wetting preference of the solid surface to the scco 2 oil and brine phases became similar as the scco 2 injection continued i e the displacements that occurred in the system were either an imbibition process or a drainage process with low threshold pressure therefore one can conclude that various types of multiple displacements having scco 2 as the first phase and oil and brine as the subsequent phases could be afforded by the near miscible scco 2 injection the diversity and affordability of double and multiple displacements indicate that displacements could occur in various pore sizes resulting in an exceptional displacement efficiency during the near miscible scco 2 injection process this is evidenced by the low remaining oil saturation of 0 04 achieved at the end of this experiment compared to the value of 0 284 established in our previous tertiary n 2 injection study qin et al 2019b 3 7 interfacial areas finally to further verify the pore scale physics proposed in the previous subsections interfacial areas between the scco 2 oil scco 2 brine and oil brine fluid pairs were systematically analyzed as shown in fig 17 the interfacial area between scco 2 and oil was significantly larger than that between scco 2 and brine this is because the formation of scco 2 oil interfaces is energetically more favorable than the scco 2 brine counterpart due to low interfacial tension of the former under near miscible conditions furthermore the local spreading oil layers prompted more scco 2 oil contacts while reducing direct contacts between scco 2 and brine the improved interfacial contact between the former pair which continued to increase considerably at the early stages of the scco 2 injection is one of the key pre requisites for substantial oil mobilization through displacements as expected the scco 2 oil interfacial area decreased at the end of the scco 2 injection process due to the production of the majority of remaining oil the non zero values of scco 2 brine interfacial areas indicate the absence or collapse of spreading oil layers in some pore elements and verify the concept of the local spreading defined earlier interfacial area of this fluid pair gradually increased as scco 2 injection continued see fig 17 this is due to the synergistic effects of several factors i saturation of scco 2 increased in the medium ii some of the spreading oil layers collapsed during the displacement process due to the interplay of the local pore geometry local wettability and local capillary pressure and iii the wettability reversal process increased the water wetness of the solid surfaces which promoted the contacts between scco 2 and brine the oil brine interfacial area continuously decreased during the scco 2 injection due to the production of the two fluids the area was reduced to a very low value at the end of the injection 4 summary and conclusions in this study the pore scale physics of three phase flow under near miscible conditions was investigated experimentally in an oil wet porous medium tertiary near miscible supercritical co 2 injection was conducted in an oil wet carbonate at elevated temperature and pressure conditions using a miniature core flooding apparatus integrated with an x ray micro ct scanner several new attributes of the three phase flow behavior were identified from in situ pore fluid occupancy maps acquired during the flow experiments here we summarize the main findings the dissolution of scco 2 in crude oil resulting from a multiple contact partial miscibility process was directly identified using grayscale x ray images tertiary near miscible scco 2 injection achieved exceptional displacement efficiency brine and oil saturations of 0 52 and 0 48 established after secondary waterflooding were reduced to 0 07 and 0 04 respectively after 50 pvs of scco 2 injection in situ contact angle measurements provided direct experimental evidence that near miscible scco 2 injection triggered a wettability reversal process toward reduced oil wetness our observation indicated that when a light crude oil oil with low asphaltene content is used scco 2 brine carbonate interactions i e ion pairs between adsorbed negatively charged oil components and excessive ca 2 produced during scco 2 injection had a more profound impact on the wettability alteration compared to the effect of precipitation of oil polar components due to scco 2 dissolution two types of distinct wettability states were identified during the three phase scco 2 oil brine flow process under near miscible conditions at the early stages of the scco 2 injection both scco 2 and brine served as the non wetting phase while oil was the wetting fluid in other words no apparent intermediate wetting phase was observed in the system as the scco 2 injection was continued the wetting preference of the rock surface to all three phases became similar due to the wettability reversal effect in situ pore fluid occupancies showed that at the early stage of near miscible scco 2 injection scco 2 and brine co occupied the majority of the large pores whereas oil was present in pores with smaller sizes as the injection progressed pore sizes did not significantly restrict the displacement efficiency due to the wettability reversal and its consequence that pore scale displacement events were either an imbibition or a drainage process with a low threshold pressure the remaining oil globules during the scco 2 injection process were categorized into four pattern groups using shape factors and euler numbers the network pattern family i e oil globules with large volumes and complex structures was the primary contributor to oil mobilization and production due to their superior local connectivity a new type of spreading phenomena named local spreading was identified in the three phase scco 2 oil brine system in which spreading oil layers formed but did not exist globally between scco 2 and brine across the medium the synergistic effects of the wetting layers and the newly defined local spreading layers enhanced the connectivity of the oil phase in the rock pore space based on the gaussian curvature analysis after 5 pvs of scco 2 injection oil was relatively well connected across the medium due to its wetting and local spreading layers as well as the contribution of globules from the network pattern group brine connectivity however diminished due to snap off and bypassing by oil and scco 2 respectively as the scco 2 injection progressed all three phases maintained relatively good connectivity due to the wettability reversal effect which promoted more displacements with the injection of additional scco 2 the scco 2 to oil to brine and scco 2 to brine to oil double displacements as well as a variety of multiple displacement events having scco 2 as the first phase and oil and brine as the subsequent phases in the chain were observed during the near miscible scco 2 injection process this is different from tertiary n 2 injection in oil wet porous media where mainly gas to oil to brine double displacements could take place the diversity and favorable threshold pressures of the double and multiple displacement events contributed significantly to the remarkable displacement efficiency of the near miscible scco 2 injection process observed in this study credit authorship contribution statement ziqiang qin conceptualization methodology validation formal analysis investigation writing original draft writing review editing maziar arshadi conceptualization validation supervision writing review editing mohammad piri conceptualization methodology validation writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors gratefully acknowledge the financial support of thermo fisher scientific hess corporation and the university of wyoming the data presented in this paper may be obtained from the corresponding author appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j advwatres 2021 104057 appendix a supplementary data the following is the supplementary material related to this article mmc s1 supplementary materials 
229,management and planning of water resource systems face great challenges under climate change because the magnitude of climate change is highly uncertain the robustness i e ability to perform satisfactorily over a wide range of possible climate conditions should be evaluated for water resource systems however for climate informed robustness based methods the effects of climate model credibility on water resource system robustness have rarely been explored and are important for the development of climate change adaptation the objective of this study was to evaluate the impacts of general circulation model gcm credibility for projecting of future climate forcing on water resource system robustness by stepwise culling of gcm with the lowest credibility we reduced the number of gcms from 13 to the three with the highest credibility in order to calculate robustness in general 176 numerical modelling experiments were designed using 11 operations of culling gcms according to credibility developing two reservoir operation models and assuming two probability distribution functions pdfs under four time periods the third largest power plant in the world i e the xiluodu reservoir xld was selected as a case study results showed that excluding gcms with lower credibility resulted in higher robustness for xld because gcms with higher credibility used to calculate robustness tended to be located in the acceptable subregion of the climate change space the results of this study demonstrated the significance of gcm credibility on water resource system robustness and decision making ignorance regarding gcm credibility may lead to over or under estimation of water resource system robustness leading to biased climate change adaptation decisions additionally the number of gcms should be large enough to prevent almost all gcms from being located in a single subregion of the climate change space to account for uncertainty in projected future climate forcing keywords robustness credibility general circulation model climate change adaptation decision scaling 1 introduction climate change brings challenges to long term planning of local water resource systems especially those that are considered to be capital intensive and part of long lived infrastructure block and strzepek 2010 oecd 2013 assessing the performance of water resource systems and making adaptation decisions under climate change are therefore of interest to water managers and policy makers kundzewicz et al 2008 however deep uncertainty regarding the magnitude and distribution of climate change has further complicated the management and planning of water resource systems block and strzepek 2010 owing to this deep uncertainty regarding climate change water resource systems should be robust in addition there are differences in gcm credibility which may lead to biased robustness evaluation and robust decision making brekke et al 2008 therefore integrating gcm credibility into robustness evaluation is an important issue that has not been explored in the following we investigated effect of gcm credibility on robustness of a large reservoir under climate change based on decision scaling 1 1 adaptation decision making under uncertainty regarding climate change traditionally top down scenario based methods have been employed to make adaptation decisions these studies use gcm projections as the diver of analysis hydrological models and impact models are forced by downscaled and bias corrected climate series to assess the impact of climate change on system performance christensen and lettenmaier 2007 wiley and palmer 2008 brekke et al 2009 manning et al 2009 vano et al 2010 wilby and dessai 2010 however the information provided by gcm projections is ill for representing extremes and full of uncertainty that expands at each step of top down scenario based methods making it less useful for making adaptation decisions stainforth et al 2005 stainforth et al 2007 dessai et al 2009 wilby and dessai 2010 deser et al 2012 accordingly bottom up robustness based methods have been designed to evaluate water resource system robustness and to identify decisions that perform satisfactorily over a wide range of possible climate conditions these methods include decision scaling brown et al 2012 robust decision making lempert et al 2003 lempert and groves 2010 info gap ben haim 2006 and robust adaptive planning lempert et al 2002 robustness based methods assume that the future climate is unknowable and explore unbiased and fuller climate conditions stochastically or systematically that does not rely on gcm projections lempert et al 2004 decision scaling assesses water resource system robustness and identifies robust decisions based on two steps it begins with generating many possible climate conditions stochastically or systematically and dividing the climate conditions into acceptable and unacceptable conditions for a given decision next it explicitly assigns the probabilities of the divided climate conditions based on a pdf determined by available climate information e g gcm projections brown et al 2011 brown et al 2012 when emphasizing climate change related risks robustness based methods need to determine pdf of future climate conditions from gcm projections which is used to sample future climate states of the world this is the basis of robustness evaluation and robust decision making for example decision makers need to choose a uniform range of parameters e g mean temperature and precipitation to sample possible climate conditions determination of a uniform range that is assured to contain feasible climate values is based on a range of gcm projections lempert et al 2006 bryant and lempert 2010 herman et al 2014 given that gcm projections represent the lower bound of the uncertainty range stainforth et al 2007 the range is sometimes selected to extend beyond the range of gcm projections whateley et al 2014 shortridge et al 2017 reis and shortridge 2019 in addition some previous research has sampled possible climate conditions directly based on the output of large ensembles of gcm projections groves and bloom 2013 matrosov et al 2013 fischbach et al 2015 fischbach et al 2017 however it is questionable whether climate models are valued equally in climate informed robustness based methods because of differences in the credibility of climate models tebaldi and knutti 2007 brekke et al 2008 1 2 gcm credibility evaluation gcm credibility is defined by the ability to capture the historical observed records rather than predict the future a key assumption of the definition is that those gcms that perform better during the past are those that perform better in the future the assumption is questionable frame et al 2007 haughton et al 2015 however this assumption is still commonly used for lack of better alternatives al and paasche 2007 gcm credibility has been evaluated following three steps brekke et al 2008 rupp et al 2013 1 choosing climate variables of interests the choice of climate variables is related to the geographic region of interest research goals and objectives for example brekke et al 2008 used three types of variables local variables distant variables and teleconnection variables that describe the relation between global and regional climatology 2 establishing a system of metrics to measure model to observation similarities for example common metrics were employed to characterize features of the climatological mean state and temporal variability perkins et al 2007 brekke et al 2008 gleckler et al 2008 the metrics that describe inter decadal variability of a climate system such as the north atlantic oscillation and enso and their teleconnection have been proposed in previous studies joseph and nigam 2006 brekke et al 2008 pierce et al 2009 mo et al 2012 moreover some other metrics are the characteristics of inter annual and long term trend brekke et al 2008 pierce et al 2009 mote and salathé 2010 3 calculating credibility of model performance the methodologies include but are not limited to the following m score watterson 1996 normalized error matrix rupp et al 2013 and multi criteria decision ranking estévez and gelcich 2015 in addition to representative problem of the in sample period as described above gcm credibility evaluation is a complex issue for example gcm credibility expressing is sensitive to the selection of variables and metrics and the weight given to each variable and metric unfortunately there is no consensus regarding how to select and weight variables and metrics moreover a gcm agrees well with observations does not mean that the model can capture important processes in climate system knutti et al 2002 observations are also uncertain and the dependence of observations and simulations may lead to question of circular reasoning furthermore biased credibility evaluation could be caused by unpredictable noise internal variability which will be aggravated by small spatial and temporal aggregations small sample size for verification and lack of ensemble members to sample the uncertainty weigel et al 2010 finally weighting gcm projection ensembles based on credibility does not account for the potential dependence in the ensembles these illustrate the complexities and uncertainty for gcm credibility evaluation and also define clear prerequisites for the experimental setup of any meaningful application of credibility evaluation haughton et al 2015 1 3 motivation and objectives ignoring climate model credibility could result in biased probability distributions that could be used to sample different future climate states of the world when applying climate informed robustness based methods herman et al 2015 as a result the robustness that is determined by running a trusted simulation model under these different sampled climate states of the world may be inaccurate in particular failure to consider the credibility of climate models when making decisions based on climate informed robustness based methods could constrain the development of climate change adaptation in capital intensive and long lived water resources system management such as unnecessary and premature infrastructure upgrades mastrandrea et al 2010 therefore whether and how climate model credibility affects water resource system robustness is a valuable question that needs to be answered however to date there have been no studies exploring the effect of climate model credibility on water resource system robustness when making decisions associated with the deep uncertainty regarding future climate in addition assumptions related to the processing of climate models or to probability distribution selection for climate variables can affect the possible climate condition sampling leading to different robust decision making outcomes moody and brown 2013 li et al 2014 whateley et al 2014 reis and shortridge 2019 for example reis and shortridge 2019 found that extended parameter distributions resulted in lower robustness and distribution selection can impact vulnerabilities through the robustness decision framework therefore it is valuable to explore the joint influence of probability distribution selection and climate model credibility on water resource system robustness which has not yet been addressed in the literature finally for long planning horizons climate change adaptation is uncertain because almost all specifics regarding the future are unknown whateley et al 2014 found that the status quo and optimal operation of a water resource system could result in different or similar robustness under different distribution selection in such a context several management options for water resource systems should be considered whateley et al 2014 culley et al 2016 therefore this paper aims to understand the effect of gcm credibility on robustness evaluation of water resource systems under climate change the third largest hydropower plant in the world xld was selected as a case study the robustness of xld power generation was evaluated based on a decision scaling approach gcm credibility was calculated based on how well selected metrics of historically observed climate variables were modeled by gcm projections 176 numerical modelling experiments were designed using 11 operations of culling gcms according to credibility developing two reservoir operation models and assuming two pdfs under four time periods the objectives of this paper were to determine 1 whether and how climate model credibility affects water resource system robustness 2 what impact climate model credibility has on robust decision making outcomes and 3 what effect climate model credibility has on robustness of power generation for the case of xld 2 study area and methodology 2 1 study area xld is located in the lower reaches of the jinsha river basin fig 1 this is the largest hydropower energy basin in china and accounts for 42 of the hydropower resources in the yangtze river basin chang et al 2010 the hydropower plant is the second largest plant in china and the third largest plant in the world it is the main power source for the west to east power transmission that sends power to central and east china and maintains an important strategic position in china the jinsha river basin is located on the eastern side of the tibetan plateau where climate change has caused significant changes in the regional water cycle wang and zhang 2012 therefore it is very important to study whether the power generation performance of xld is robust or not under climate change actually the effect of climate change on power generation performance is different under conventional and optimal operation models accordingly we consider these two operation models in following modelling experiments the conventional operation model comprehensively reflects the operation rules that meet the requirements of various aspects under various hydrological conditions it can be used for real time operation with inflow changes making it easy to make decisions it is assumed to be cyclo stationary throughout the modelling of different climate states in climate change space the optimal operation model evaluates the potential power generation performance under known inflow it assumes perfect inflow with respect to each climate state so it will change with different climate states 2 2 proposed framework the proposed framework on which the research was based includes three parts the framework first identified climate change space that caused risk using climate stress test pdfs were then fit by culled gcms according to credibility ranking to represent probability of climate change space finally climate informed robustness was evaluated and 176 numerical modelling experiments were designed to explore the effect of gcm credibility on water resource system robustness the proposed framework is summarized in fig 2 and detailed descriptions of each part of the proposed framework are presented in the following sections 2 2 1 robustness evaluation based on decision scaling approach 2 2 1 1 stakeholder driven decision framing a stakeholder driven decision framing is used to describe the characteristics of the project this framing includes the climate variables that the performance of the system is sensitive to the performance indicators and the threshold that parses climate change space into the acceptable region and the unacceptable region which is beyond the scope of this study in this study precipitation and temperature were selected to represent climate variables that the system is sensitive to given that the main function of xld was power generation we set the system performance indicator to average annual power generation and determined the threshold as the historical average annual power generation 2 2 1 2 climate stress test the goal of a climate stress test is to assess water resource system response within a climate change space and to identify the climate change space under which the performance of water resource systems is unsatisfactory climate change space is an n dimensional space in which each dimension is an attribute e g variability mean of climate variables the climate change space is generated by disturbing the time series of temperature and precipitation to make incremental changes to each dimension the disturbing methods include delta method prudhomme et al 2010 culley et al 2016 taner et al 2017 ray et al 2018 zhang et al 2018 puspitarini et al 2020 that uses a uniform scaling of historical data and stochastically perturbing climate data such as the use of stochastic weather generators moursi et al 2017 kim et al 2019 in this study a two dimensional climate change space was selected the two dimensions were the mean annual temperature and the mean annual precipitation delta method was used to disturb time series this meant that perturbations were made uniformly across a year so that there was no disturbance to the temporal structure of the time series therefore climate variability was ignored in this study however vormoor et al 2017 pointed out that different temporal structures of a time series can considerably affect low flows and floods but the impact on the mean flow that is closely related to power generation can be ignored therefore delta method was reasonable for this study specially the temperature was perturbed additively from 0 c to 10 c of historical values with a step size of 1 c while precipitation was perturbed as a change percentage of historical precipitation i e from 12 to 52 with a step size of 4 therefore the climate change space was composed of 187 climate states we had two reasons for choosing this range of the climate change 1 the selected range should expand the climate change space beyond the range of gcm projections because the range of gcm projections is the lower bound of the uncertainty range of future climate stainforth et al 2007 2 the selected range should be wide enough to ensure vulnerability of the system so that the climate states that will cause the system to fail will be revealed once the climate change space has been generated the next step is simulating sensitivity of water resource systems to each climate state in the climate change space a water system model that included a hydrological model section 2 3 and a reservoir operation model section 2 4 forced by the climate states described above translated a climate state xi to a performance indicator of water resource systems yi the progress was repeated over the climate change space x x1 x2 xn to get a set of performance indicators y y1 y2 yn corresponding to each xi the final step is parsing the climate change space into acceptable subregions and subregions that cause risk the parsed climate change space can be represented by a binary performance function λ xi d 1 λ x i d 1 i f y i y t 0 i f y i y t where λ xi d equals one when the system performance yi given a decision d is greater than a pre defined threshold yt meaning that the subregion of the climate change space is acceptable λ xi d equals to zero indicates unacceptable performance 2 2 1 3 climate informed robustness assessment the robustness of water resource systems was evaluated based on a robustness indicator proposed by moody and brown 2013 that is a measure of the probabilities of an acceptable subregion of the climate change space conditioned on an assumed pdf and distribution range the robustness indicator was calculated by equation 2 2 cri d x 1 x n λ x i d pr x i dx where cri is a climate informed robustness indicator conditioned on an assumed pdf the probabilities of a vector of attributes of selected climate variables can be represented by pr xi the climate informed robustness indicator cri is a measure of system robustness resulting in fraction between zero or never meet the satisfactory standard and one or acceptable performance over the entire range considered λ xi d as described in equation 1 determines the range in the climate change space that leads to acceptable performance given a decision d pr x i determines the probabilities of the climate change space over which acceptable performance is achieved therefore the greater the value of this indicator the performance of the system will meet the satisfactory standard over a wider range and a greater probability of climate change space and the more robust the system will be to calculate the robustness indicator the following steps were followed 1 the vectors of attributes of selected climate variables were calculated from a multi model ensemble of available gcms 2 a pdf was fit by the vectors of attributes of selected climate variables to represent pr xi a major challenge in evaluating robustness is that an appropriate type of pdf to represent pr xi is unknown and unknowable due to the deep uncertainty regarding the future climate in fact decision makers cannot agree on a pdf of future climate however a strength of the indicator is that it changes the focus from an attempt to agree on which pdf is correct to a focus on assessing the implications of such disagreement moody and brown 2013 that is different assumed pdfs can be used to simulate pr xi and to explore the sensitivity of the robustness indicator and decision making to different assumptions without considering which assumption is correct many pdfs such as uniform distribution normal distribution and cauchy distribution have been selected to simulate pr xi in this paper a normal distribution and a uniform distribution two commonly used pdfs to simulate pr xi whateley et al 2014 were chosen to explore the implications of different assumptions regarding future climate change 2 2 2 climate model credibility evaluation in this study temperature and precipitation were selected as climate variables of interests because the power generation performance of xld is more sensitive to changes in temperature and precipitation in sum 11 metrics were used to evaluate climate models accounting for the basis of being representative of the characteristics of the climate system especially the properties of the regional time series and the spatial variance table 1 the first three statistical moments of monthly conditions mean coefficient of variation and normalized root mean square error and the pearson correlation coefficient describing the phase of the monthly time series and spatial correlation of climate variables the changing trend and the change amplitude of the time series were measured by the mann kendall test z and the mann kendall test β respectively the first and second empirical orthogonal function eof modes were used to reflect space time variability of meteorological fields two statistics of the pdf brier score and skill score were used to evaluate the simulation effect of gcms on the pdf in this paper we assumed equal weighting of all variables and metrics although there may be differences in confidence in the reliability of metrics and redundant information among metrics rupp et al 2013 equal weighting still provides a valuable assessment of climate model credibility hemer and trenham 2016 the score based method was used to measure credibility of model performance the detailed description of this method is given as follows the model error ei j for a given model i and metric j was defined as 3 e i j x reference j x i j where x reference j and x i j are the reference and simulated metric respectively from the gcms the reference data over the period of 1979 2014 was acquired from the china meteorological forcing dataset provided by the data assimilation and modeling center for tibetan multi spheres dam institute of tibetan plateau research itp and the chinese academy of sciences cas we defined a multi criteria rank score rs value as 4 r s i j max i e i j e i j max i e i j min i e i j 10 where the minimum and maximum operators indicate min max across all considered models for a given metric finally the total rank score for each gcm was obtained by summing all metrics used to indicate the credibility of model performance high rs values indicate high credibility of model performance 2 2 3 numerical modelling experiments a total of 176 numerical modelling experiments were designed to demonstrate the effect of gcm credibility on water resource system robustness the details of the experiments are as follows there are two common methods to integrate gcm credibility into robustness evaluation 1 weighting all models based on credibility 2 culling models according to the credibility ranking i e giving one weight to retained models and giving zero weight to culled models in this paper the model culling method was adopted and implemented as follows 1 the credibility of 13 gcms used in this study was calculated section 2 2 2 2 by stepwise culling gcm with the lowest credibility and the number of gcms with the higher credibility used to calculate robustness n was reduced from 13 to three therefore 11 operations were used to cull models n equals 13 means that there are no models to be culled i e all models are used without considering credibility two reservoir operation schemes were used to simulate the power generation performance of xld under climate change a conventional operation scheme simulated the actual operation of the reservoir using rule curves while an optimal operation model derived the operation policy that maximizes power generation using an optimization algorithm as mentioned previously two pdfs normal distribution and uniform distribution were selected to explore the implications of the different assumptions about future climate on robustness evaluation finally we calculated robustness over the 21st century and divided the full period into four time periods 2021 2040 2030s 2041 2060 2050s 2061 2080 2070s and 2081 2100 2090s in general 176 numerical modelling experiments were calculated using 11 operations to cull gcms developing two reservoir operation models to simulate performance and assuming two pdfs to represent pr x i under four time periods i e a total of 11 operations to cull models 2 operation models 2 pdfs 4 periods 176 experiments 2 3 hydrological modelling a hydrological model the soil and water assessment tool swat was used to translate each climate state in climate change space into inflow to xld swat is a distributed hydrological model of watershed scale with daily time step developed by the usda agricultural research service arnold et al 1998 the effectiveness of the model in studying the influence of climate change on hydrology has been demonstrated in research studies over multiple watersheds guo et al 2008 li et al 2009 the data required by swat for hydrological process simulation included a digital elevation model dem land use data soil data and hydro meteorological data the details of the input data are provided in the appendix the swat model was set up for the period between 1985 and 2006 the warm up period was set to three years 1985 1987 the model was calibrated with data from a 13 year period 1988 2000 using sufi 2 as an optimization algorithm and validated with a six year period 2001 2006 in total 13 parameters in the model that are more sensitive and can have a significant impact on the swat model runoff simulation kim 2017 were calibrated table s1 three statistical metrics were used to assess model performance nash sutcliffe efficiency coefficient nse equation 5 the ratio of the root mean square error rsr equation 6 and the percent bias pbias equation 7 the expressions of which are 5 nse 1 i 1 n q m i q s i 2 i 1 n q m i q m 2 6 rsr i 1 n q m q s i 2 i 1 n q m i q m 2 7 pbias i 1 n q m i q s i i 1 n q m i 100 where q m i and q s i are the measured and simulated flow series m3 s q m is the average value of the measured flow series m3 s n is the length of the data series 2 4 reservoir operation model 2 4 1 conventional operation scheme simulated inflows were used as the input of reservoir operation and the power outputs of the reservoir were calculated by a conventional operation scheme the operation scheme was based on designed operating rule curves for xld obtained from research report refill and flood control plans for xiluodu reservoir in jinsha river provided by the hydro china chengdu engineering corporation hccec hydro china chengdu engineering corporation 2013 zhou et al 2015 in this study two water level thresholds were specified and power generation was determined by output regions that were determined by rule curves we assumed that the operation scheme could adequately simulate the past operation of xld a detailed description of the scheme is in the appendix 2 4 2 optimal operation model an optimal operation model was developed to represent the best operation under climate change because the optimization model used the full record of inflows to choose reservoir release schedule it implicitly assumed perfect inflow forecasts this also meant the optimal operation model identified the best performance that could be achieved without physical changes to reservoir as the optimal operation model was separately run for each climate state in climate change space the best operation solutions for all climate states in climate change space were identified consequently the optimal operation model could find the extent of climate change space that a reservoir could not adapt to through adaptive operation beyond the upper limit infrastructure upgrades were required a dynamic programming algorithm bellman 1956 was employed to optimize the average annual power generation and the decision variables were the discharges of the reservoir on a 10 day interval the model is as follows equation 8 8 f max t 1 t p t g p t δ t 9 g p t k p min p t α i f p t p min 0 i f p t p min 10 p t k q power t h t subject to 11 v t 1 v t q in t q power t q surp l u s t δ t 12 z u p t 1 f z v v t 1 13 z d o w n t f z q q out t 14 p expected t f ph h t 15 z up min t 1 z up t 1 z up max t 1 where f objective function pt output g penalty function δt time step 10 days k and α penalty coefficients whose values were set as 20 and 0 4 respectively pmin firm output whose value was 3395 mw k output coefficient whose value was 8 5 qpower the discharge passing through the hydraulic turbines h water head v reservoir storage qin inflow qsurplus water spillage zup upstream water level fzv stage discharge relation zdown downstream water level fzq water level discharge relation on the downstream pexpected expected output fph the relation between expected output and head difference z up min lower limit of water level i e dead water level z up max upper limit of water level i e flood limit water level during flood season and normal water level during non flood season 2 5 projected climate information the probabilities of climate change space pr xi as described above section 2 2 1 3 were generated from a multi model ensemble of gcm projections two pdfs bivariate normal and bivariate uniform distribution of temperature change and precipitation change were fit using an ensemble of 13 climate models and four shared socio economic pathways i e ssp1 2 6 ssp2 4 5 ssp3 7 0 ssp5 8 5 table 2 data and detailed descriptions of the models are available at the cmip6 archive https esgf node llnl gov search cmip6 gridded simulated data were obtained directly from the gcms at 2 spatial resolution over the jinsha river basin mean annual temperature and precipitation were extracted from the gcms for the historical period 1986 2005 and for four prediction periods 2021 2040 2041 2060 2061 2080 and 2081 2100 absolute differences and percent differences between historical and future temperature and precipitation for the four prediction periods were calculated by the mean annual temperature and precipitation respectively finally the two pdfs were fit by these absolute differences and percent differences 3 results 3 1 hydrological model calibration and validation in order to assess the performance of the swat model in the river basin three statistical metrics nes rsr pbias were selected to evaluate the results of monthly runoff simulation at six hydrological stations zhimenda shigu jinjiangjie panzhihua huadan and pingshan the evaluated results were nse 0 81 rsr 0 41 and pbias 14 1 for the calibration dataset nes 0 83 rsr 0 40 and pbias 14 3 for the validation on the watershed average table 3 moriasi 2007 recommended that if nse 0 50 rsr 0 70 and pbias within 25 for streamflow the model performance can be considered acceptable therefore the proposed model can be used to simulate the hydrological process in the jinsha river basin fig 3 shows the observed and simulated monthly streamflow for calibration and validation datasets at six hydrological stations the results showed that the overall performance of the simulation results was satisfactory compared with the observed streamflow the model better captured dry season discharge than occurrences of high discharge the selected parameters and their final calibrated values generating the highest nse are shown in table s1 the parameter values in the swat model were used for the following research 3 2 climate stress on the power generation of xld fig 4 a and fig 4b show the performance of the reservoir under conventional and optimal operation respectively under climate change conditions the climate change space above the threshold dashed line represents the acceptable climate change conditions while the other part indicates the climate change space that is at risk the sensitivity analysis results showed that the sensitivity of power generation to change in precipitation was greater than the sensitivity to change in temperature for example when temperature rose by 7 5 c or above from the historical value the influence of temperature change on the average annual power generation was negligible in addition when the operation of xld changed from conventional operation to optimal operation the black dashed line moved down resulting in the climate change space of acceptable performance covering a greater region of the climate change space and indicating that optimal operation improved the power generation performance of the reservoir for example the average annual power generation of optimal operation was still equal to the historical value i e the average annual power generation of conventional operation under no change in climate at a 2 5 reduction in precipitation or a mean temperature increase of 0 55 c this suggested that the power generation performance of the hydropower station could adapt to drier conditions by the optimization operation scheme i e the robustness of the reservoir has been improved by optimal operation under climate change as expected fig 4c shows both the identified failure boundaries of conventional and optimal operations the blue region corresponded to the region above the threshold in fig 4a indicating that xld could achieve successful performance of power generation maintaining the conventional operation the orange region corresponded to the region below the threshold in fig 4b indicating the power generation performance was unacceptable or failed even though xld had been optimized the peach colored region corresponded to the region that was below the threshold in fig 4a and above the threshold in fig 4b this region was an adaptation region meaning we could re operate reservoirs by adapting to climate change the identified failure boundaries were used to calculate robustness 3 3 projected future climate and gcm credibility 3 3 1 gcm projections of temperature and precipitation in the jinsha river basin fig 5 shows scatter plots of mean annual temperature and mean annual precipitation from the cmip6 ensemble of gcm output as expected from prior studies brown and wilby 2012 the gcm projections showed that the direction and magnitude of changes in temperature and precipitation diverged among the 13 climate models and the range of uncertainty was large and expanding with time for example by the 2090s the range of outcomes in mean temperature was from 4 6 c to 7 8 c and mean precipitation was from 908 mm to 1894 mm fig 6 shows the changes in temperature and precipitation for four time periods under four ssps projected by 13 gcms in general the four ssps predicted increasing mean annual temperature and precipitation the temperature and precipitation were likely to increase the most rapidly under ssp5 8 5 followed by ssp3 7 0 and ssp2 4 5 and temperature and precipitation increased the slowest under ssp1 2 6 in addition the uncertainty range was large as shown by the upper and lower limits or outliers in the box plots ipsl cm6a lr expressed as an outlier projected a lower temperature than other gcms 3 3 2 credibility of cmip6 projections in the jinsha river basin fig 7 shows the credibility of model performance indicated by total rank score values of the 13 gcms there were significant differences in the credibility of the simulation effects from the 13 gcms the total rank score values ranged from 4 18 to 7 49 the gcm with the best simulation effects for temperature and precipitation was ec earth3 veg with a score of 7 49 following by models cesm2 waccm 7 06 cmcc cm2 sr5 6 52 and noresm2 mm 6 42 the poorest three models in this region were ipsl cm6a lr 4 18 canesm5 4 42 and bcc csm2 mr 5 70 in general these differences in gcm credibility for this case study cannot be ignored 3 4 impacts of gcm credibility on xld robustness fig 8 shows the change of robustness of xld with n under conventional operation rule for four time periods focusing initially on robustness for four time periods the robustness increased with time when n equaled 13 the robustness calculated conditional on normal distribution uniform distribution increased from 0 43 0 27 in period one to 0 87 0 89 in period four this would be expected because the climate in the jinsha river basin will become wetter in the future as shown in fig 6 although the temperature will increase in the future resulting in reduced inflow the increase in precipitation will cause augmented flow and play a more significant role than the increase in temperature in this basin therefore power generation performance of xld will become more robust under wetter conditions the relationship between robustness and n was more complicated as shown in fig 8 n equaled 13 indicated that all of the gcms were used so the values indicated by red horizontal lines represented the robustness calculated without considering credibility the black dotted lines were almost always above the red horizontal lines therefore robustness tended to be higher when considering credibility than when not considering credibility in this case study by reducing n from 13 to three we can observe some interesting rules between n and robustness regardless of the time periods or the selected distributions robustness had a consistent upward trend as n decreased and when n was reduced from six to five robustness had a sudden change from low to high however an upward trend was observed as a whole with each step of culling the models there was no guarantee that the robustness will always increase indicating that robustness was increasing in volatility as n decreased the increase or decrease in robustness conditional on the normal distribution and the uniform distribution was generally consistent as n decreased except that the robustness conditional on the normal distribution decreased while the robustness conditional on the uniform distribution increased when n was reduced from 12 to 11 in the first three periods the uncertainty set became smaller as n decreased however by comparing the red line and the red dotted line it can be seen that the uncertain set size had little effect on the robustness evaluation fig 8 also shows that the choice of pdfs had a significant impact on robustness but the extent of the impact was related to the periods in the first three periods the choice of pdfs significantly affected robustness and robustness conditional on the normal distribution was higher than robustness conditional on the uniform distribution for example before the sudden change of robustness that is before reducing n to five the ranges of robustness conditional on the normal distribution in the first three periods were 0 43 0 51 0 71 0 76 and 0 82 0 86 respectively while the ranges of robustness conditional on the uniform distribution in the first three periods were 0 27 0 39 0 57 0 61 and 0 71 0 78 respectively however in the last period the impact of selection of pdfs on robustness was relatively small fig 9 shows the relationship between robustness of xld and n under optimal operation optimal operation improved the robustness of xld by comparing the robustness indicators in fig 8 and fig 9 and this was consistent with the results of section 3 2 in accordance with the results of the conventional operation the black dotted lines were generally above the red horizontal lines indicating that robustness was higher when considering credibility than when not considering credibility under optimal operation in addition robustness of xld under optimal operation increased in volatility as n decreased and exhibited a sudden ascending change when n was reduced from six to five finally the choice of pdfs significantly affected the robustness in the first three periods but had a relatively small effect on robustness in the last period these results further verified the conclusions obtained from fig 8 it should be noted that the robustness increased with time which is counterintuitive because later periods exhibit more uncertainty and uncertainty has a tradeoff with robustness in general however whether a system will be more robust in the future depends on the performance to be measured and the future state related to that performance of course the future state will become more and more uncertain which is detrimental to the robustness of system in general for example if we consider both power generation and flood control performance of xld the robustness will be lower with time due to increasing uncertainty the results of this study provide evidence for this we can see from fig 10 that the range of uncertainty indicated by gcm projections is expanding with time which means the future becomes more uncertain wetter climate is not conducive to flood control performance while drier climate is not conducive to power generation performance therefore the success subregion of climate change space is a trade off region that indicates moderate climate condition the ever expanding range of uncertainty has resulted in more gcms located outside the trade off region consequently xld robustness will be lower with time due to increasing uncertainty however the increasing uncertainty would not always be detrimental to robustness as described above the performance to be measured and the future state related to that performance determine the change of robustness if we only focus on power generation performance of xld a wetter climate in the future is conducive to the xld robustness even if the future climate becomes uncertain the widening range of uncertainty of gcm projections does not extend into the failure subregion the probabilities of the failure subregion are reduced and cri will rise 4 discussion 4 1 influence of gcm credibility on robustness in the case study area taking the xld as a case study the results from this study illustrated the effect of gcm credibility on the robustness of xld power generation under climate change by culling the lowest credible gcms step by step the results showed that the robustness of xld was increasing in volatility as n decreased and had an ascending sudden change when n was reduced from six to five indicating that considering gcm credibility had a significant effect on robustness of xld power generation however why robustness increased in volatility and had a sudden change as n decreased was a more meaningful issue that needed to be resolved exploring the reason for this change rule of robustness as n decreased in the case study may reveal the general rule of the impact of gcm credibility on robustness this would point the way for decision makers to integrate gcm credibility into robustness evaluation in place based assessments fig 10 and fig 11 explained why robustness was volatile as n decreased as fig 10 shows when n equaled 12 the green points representing the culled gcms were in the subregion that caused risk or were below the point group so pdfs fit by 12 gcms will move up relative to pdfs fit by 13 gcms therefore pdfs fit by 12 gcms will give higher probabilities of being in the acceptable subregion of the climate change space resulting in increased robustness when n was reduced from 13 to 12 however when n equaled 11 as fig 11 shows the green points were in the acceptable subregion or above the point group so the pdfs fit by 11 gcms will move down relative to pdfs fit by 12 gcms and gave lower probabilities of being in the acceptable subregion therefore the robustness generally decreased when n was reduced from 12 to 11 except for period four and that result was due to the decrease of pdf range leading to a decrease in the probabilities of being in the subregion that caused risk we can conclude that the location of the green points determines whether the robustness increases or decreases as n decreases however we can observe that the location of the green points was uncertain figure s3 figure s10 therefore robustness was volatile as n decreased as described above the location of the green points that were culled in turn according to the credibility rank was uncertain the location of green points indicated future predictions of mean annual temperature and precipitation and the credibility was represented by the degree to which gcms can capture the past therefore gcms that had similar ability to capture the past diverged substantially for their future predictions this means that even though some models agree well with observations of the past climate it is difficult to guarantee that their predictions about the future climate are consistent tebaldi and knutti 2007 although it is difficult to guarantee that gcms that have similar ability to capture the past climate have a consistent future prediction as described above those models that have been better captured in the past have a certain consistency in future predictions for example fig 12 shows that the black points tended to be at the upper left of the point group meaning that the gcms that had been better captured in the past consistently predicted the lower temperature and higher precipitation in the future in this case study the black points in fig 12 tended to be at the upper left of the point group and were in the acceptable subregion this also explained why robustness had an upward trend and ascending sudden change when n was reduced from six to five in the case study as fig 12 shows after the green points that were retained when n equaled six but culled when n equaled five had been culled almost all gcms were located in the acceptable subregion giving much higher probabilities for the acceptable subregion the large proportion of pdfs fit by the six gcms extended into the unacceptable subregion while just a small proportion of tails of those fit by five gcms was located in the unacceptable subregion fig 13 therefore when n was reduced from six to five the robustness of xld will have a sudden change from low to high and the robustness increased in general as n decreased 4 2 joint influences of pdf selection and climate model credibility on robustness evaluation one of the merits of the robustness indicators used in this paper is the ability to using different assumed pdfs to simulate pr xi and to explore the effect of the assumed pdf selection on robustness evaluation without considering which assumption is correct some previous research has examined this effect on robustness evaluation and decision making li et al 2014 whateley et al 2014 however when gcm credibility and selection of pdfs are considered simultaneously how they together influence robustness has not been explored as described in section 3 4 the selection of pdfs had a significant effect on robustness and robustness conditioned on the normal distribution was higher than robustness conditioned on the uniform distribution in the first three periods that was because uniform distribution gave more weight to the tail of the distribution that extended to the unacceptable subregion therefore robustness conditioned on the uniform distribution was lower than robustness conditioned on the normal distribution however in the last period almost all gcms were in the acceptable subregion and both normal distribution and uniform distribution will give the unacceptable subregion very low probabilities therefore in period four when the robustness of xld was very high the selection of pdfs had little effect on robustness we can find similar conclusions about the impact of model credibility on robustness in the first three periods when robustness was low considering the credibility of climate models affected the robustness while the effect was negligible in the last periods when robustness was high fig 8 fig 9 the reason for this result was that when robustness of xld was high almost all gcms were in the acceptable subregion and this meant the distribution range in the acceptable subregion will not change much even if some gcms were culled we can conclude that when the robustness of the system is very high or low meaning that almost all of the gcms are located in the acceptable or unacceptable subregion whether credibility is considered or not and what type of pdfs is chosen has little influence on robustness evaluation 4 3 implications for integrating credibility of climate models into robustness evaluation robustness based frameworks have been employed by the world bank the research and development company and water utilities to make decisions under deep climate change uncertainty lempert and groves 2010 kasprzyk et al 2013 however integrating the prediction of climate models into decision making is suitable only if the credibility of the predictions of climate models has been evaluated otto et al 2015 this paper illustrated integration of gcm credibility into water resource system robustness to make decisions at a local scale although the robustness evaluation is based on a decision scaling approach multiple climate informed robustness based frameworks need to use gcms to sample future states of the world regarding climate these results show accounting for gcm credibility can alter the perception of climate related robustness for local systems considering adaption in this case study although the robustness was sensitive to sample size variable n robustness tended to be higher when considering credibility than when not considering credibility in general as shown in fig 8 the reason was the higher credible gcms tended to project wetter climate that was favorable to robustness of xld power generation in most cases the robustness of xld power generation will be higher when higher credible gcms are preferred accordingly considering gcm credibility prevents us from underestimating robustness thus avoiding unnecessary and premature infrastructure upgrades that have high economic and environmental cost mastrandrea et al 2010 however the effect of gcm credibility on water resource system robustness will vary depending on unique condition of each local system and only a single case was demonstrated here when the proposed framework is applied to other water resource systems there may be a situation where the robustness will be overestimated without considering the credibility because higher credible gcms project an unfavorable climate therefore there will be an increase in decision relevant climate related risk facing power generation when failing to account for credibility a further interesting information from the case study for decision makers was the robustness calculated by five or less gcms may be overestimated this may lead to the risk that decision makers may overestimate xld power generation the reason was the gcms were all located in a single subregion of climate change space and cannot describe the deep uncertainty of future climate lempert et al 2003 walker et al 2013 as shown in fig 12 due to the uncertainty and limitation in the modeling progress this paper focused on exploring whether and how the climate model credibility affected water resource system robustness via a case of xld but not for detail engineering purposes this paper selected temperature and precipitation as variables of interest and 11 metrics used to define model performance however the credibility given to each model will always depend on the selected variables and metrics there is no consensus regarding which variables and metrics should be chosen to quantify the performance of credibility tebaldi and knutti 2007 it may depend on the application future work could explore which metrics are suitable for credibility quantification and this may also be a further work for current climate science furthermore it should be noted that it is important to evaluate the skill of climate models to capture the inter annual and inter decadal variability of the climate system however only metrics that were used to assess inter annual variability were selected because of the data length limitation 36 yr and this was a shortcoming of our research further studies could also quantify robustness using other robustness based methods in addition the implementation of the decision scaling framework relies on model development thus any limitations and uncertainties associated with the swat model that translate the climate data into inflow of xld can have a great effect on the robustness evaluation results the inflow of xld was assumed to be a natural runoff and this meant that the human activities in the jinsha river sub basin were ignored in this study this assumption was a limitation for assessing the robustness of power generation for the actual xld finally xld provides great benefits in flood control sediment ejection and navigation in addition to power generation the methods employed in this paper could be extended to incorporate the robustness evaluation of other aspects of xld 5 conclusions 176 numerical modeling experiments were designed to fill the knowledge gap about the effect of climate model credibility on water resource system robustness under climate change the third largest hydropower plant in the world xld was selected as a case study it was found that gcm credibility had a significant effect on robustness and robustness tended to fluctuate upward as n decreased and had a sudden change from low to high when n was reduced from six to five robustness was volatile as n decreased indicating that it is difficult to ensure that gcms that have similar ability to capture the past climate can consistently predict future conditions however robustness had an upward trend and a sudden change as n decreased and this means that those gcms that have been better captured in the past have a certain consistency in future predictions for example in this case study the gcms that captured the past well consistently predicted lower temperature and higher precipitation in the future and thus tended to be located in the acceptable subregion of the climate change space therefore the robustness of xld power generation tended to fluctuate upwards as n decreased the results of this study illustrate the significance of considering gcm credibility on decision making robustness could be over or under estimated if gcm credibility is ignored resulting in biased climate change adaptation decisions however when the gcms with lower credibility are culled n should be large enough to prevent almost all gcms from being located in a single subregion of the climate change space to account for uncertainty in projected future climate forcing 6 credit author statement all authors contributed to the interpretation of the results and to the text credit authorship contribution statement ruikang zhang conceptualization formal analysis methodology writing original draft visualization lei cheng conceptualization data curation formal analysis funding acquisition methodology supervision writing review editing pan liu funding acquisition project administration supervision kangdi huang methodology writing review editing yu gong validation writing review editing supervision shujing qin validation writing review editing dedi liu validation supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was supported by the national key research and development program of china 2018yfc0407202 the national natural science foundation of china 51961145104 41890822 51879193 and the overseas expertise introduction project for discipline innovation 111 project funded by the ministry of education and affairs p r china b18037 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 104063 appendix supplementary materials image application 1 image application 2 
229,management and planning of water resource systems face great challenges under climate change because the magnitude of climate change is highly uncertain the robustness i e ability to perform satisfactorily over a wide range of possible climate conditions should be evaluated for water resource systems however for climate informed robustness based methods the effects of climate model credibility on water resource system robustness have rarely been explored and are important for the development of climate change adaptation the objective of this study was to evaluate the impacts of general circulation model gcm credibility for projecting of future climate forcing on water resource system robustness by stepwise culling of gcm with the lowest credibility we reduced the number of gcms from 13 to the three with the highest credibility in order to calculate robustness in general 176 numerical modelling experiments were designed using 11 operations of culling gcms according to credibility developing two reservoir operation models and assuming two probability distribution functions pdfs under four time periods the third largest power plant in the world i e the xiluodu reservoir xld was selected as a case study results showed that excluding gcms with lower credibility resulted in higher robustness for xld because gcms with higher credibility used to calculate robustness tended to be located in the acceptable subregion of the climate change space the results of this study demonstrated the significance of gcm credibility on water resource system robustness and decision making ignorance regarding gcm credibility may lead to over or under estimation of water resource system robustness leading to biased climate change adaptation decisions additionally the number of gcms should be large enough to prevent almost all gcms from being located in a single subregion of the climate change space to account for uncertainty in projected future climate forcing keywords robustness credibility general circulation model climate change adaptation decision scaling 1 introduction climate change brings challenges to long term planning of local water resource systems especially those that are considered to be capital intensive and part of long lived infrastructure block and strzepek 2010 oecd 2013 assessing the performance of water resource systems and making adaptation decisions under climate change are therefore of interest to water managers and policy makers kundzewicz et al 2008 however deep uncertainty regarding the magnitude and distribution of climate change has further complicated the management and planning of water resource systems block and strzepek 2010 owing to this deep uncertainty regarding climate change water resource systems should be robust in addition there are differences in gcm credibility which may lead to biased robustness evaluation and robust decision making brekke et al 2008 therefore integrating gcm credibility into robustness evaluation is an important issue that has not been explored in the following we investigated effect of gcm credibility on robustness of a large reservoir under climate change based on decision scaling 1 1 adaptation decision making under uncertainty regarding climate change traditionally top down scenario based methods have been employed to make adaptation decisions these studies use gcm projections as the diver of analysis hydrological models and impact models are forced by downscaled and bias corrected climate series to assess the impact of climate change on system performance christensen and lettenmaier 2007 wiley and palmer 2008 brekke et al 2009 manning et al 2009 vano et al 2010 wilby and dessai 2010 however the information provided by gcm projections is ill for representing extremes and full of uncertainty that expands at each step of top down scenario based methods making it less useful for making adaptation decisions stainforth et al 2005 stainforth et al 2007 dessai et al 2009 wilby and dessai 2010 deser et al 2012 accordingly bottom up robustness based methods have been designed to evaluate water resource system robustness and to identify decisions that perform satisfactorily over a wide range of possible climate conditions these methods include decision scaling brown et al 2012 robust decision making lempert et al 2003 lempert and groves 2010 info gap ben haim 2006 and robust adaptive planning lempert et al 2002 robustness based methods assume that the future climate is unknowable and explore unbiased and fuller climate conditions stochastically or systematically that does not rely on gcm projections lempert et al 2004 decision scaling assesses water resource system robustness and identifies robust decisions based on two steps it begins with generating many possible climate conditions stochastically or systematically and dividing the climate conditions into acceptable and unacceptable conditions for a given decision next it explicitly assigns the probabilities of the divided climate conditions based on a pdf determined by available climate information e g gcm projections brown et al 2011 brown et al 2012 when emphasizing climate change related risks robustness based methods need to determine pdf of future climate conditions from gcm projections which is used to sample future climate states of the world this is the basis of robustness evaluation and robust decision making for example decision makers need to choose a uniform range of parameters e g mean temperature and precipitation to sample possible climate conditions determination of a uniform range that is assured to contain feasible climate values is based on a range of gcm projections lempert et al 2006 bryant and lempert 2010 herman et al 2014 given that gcm projections represent the lower bound of the uncertainty range stainforth et al 2007 the range is sometimes selected to extend beyond the range of gcm projections whateley et al 2014 shortridge et al 2017 reis and shortridge 2019 in addition some previous research has sampled possible climate conditions directly based on the output of large ensembles of gcm projections groves and bloom 2013 matrosov et al 2013 fischbach et al 2015 fischbach et al 2017 however it is questionable whether climate models are valued equally in climate informed robustness based methods because of differences in the credibility of climate models tebaldi and knutti 2007 brekke et al 2008 1 2 gcm credibility evaluation gcm credibility is defined by the ability to capture the historical observed records rather than predict the future a key assumption of the definition is that those gcms that perform better during the past are those that perform better in the future the assumption is questionable frame et al 2007 haughton et al 2015 however this assumption is still commonly used for lack of better alternatives al and paasche 2007 gcm credibility has been evaluated following three steps brekke et al 2008 rupp et al 2013 1 choosing climate variables of interests the choice of climate variables is related to the geographic region of interest research goals and objectives for example brekke et al 2008 used three types of variables local variables distant variables and teleconnection variables that describe the relation between global and regional climatology 2 establishing a system of metrics to measure model to observation similarities for example common metrics were employed to characterize features of the climatological mean state and temporal variability perkins et al 2007 brekke et al 2008 gleckler et al 2008 the metrics that describe inter decadal variability of a climate system such as the north atlantic oscillation and enso and their teleconnection have been proposed in previous studies joseph and nigam 2006 brekke et al 2008 pierce et al 2009 mo et al 2012 moreover some other metrics are the characteristics of inter annual and long term trend brekke et al 2008 pierce et al 2009 mote and salathé 2010 3 calculating credibility of model performance the methodologies include but are not limited to the following m score watterson 1996 normalized error matrix rupp et al 2013 and multi criteria decision ranking estévez and gelcich 2015 in addition to representative problem of the in sample period as described above gcm credibility evaluation is a complex issue for example gcm credibility expressing is sensitive to the selection of variables and metrics and the weight given to each variable and metric unfortunately there is no consensus regarding how to select and weight variables and metrics moreover a gcm agrees well with observations does not mean that the model can capture important processes in climate system knutti et al 2002 observations are also uncertain and the dependence of observations and simulations may lead to question of circular reasoning furthermore biased credibility evaluation could be caused by unpredictable noise internal variability which will be aggravated by small spatial and temporal aggregations small sample size for verification and lack of ensemble members to sample the uncertainty weigel et al 2010 finally weighting gcm projection ensembles based on credibility does not account for the potential dependence in the ensembles these illustrate the complexities and uncertainty for gcm credibility evaluation and also define clear prerequisites for the experimental setup of any meaningful application of credibility evaluation haughton et al 2015 1 3 motivation and objectives ignoring climate model credibility could result in biased probability distributions that could be used to sample different future climate states of the world when applying climate informed robustness based methods herman et al 2015 as a result the robustness that is determined by running a trusted simulation model under these different sampled climate states of the world may be inaccurate in particular failure to consider the credibility of climate models when making decisions based on climate informed robustness based methods could constrain the development of climate change adaptation in capital intensive and long lived water resources system management such as unnecessary and premature infrastructure upgrades mastrandrea et al 2010 therefore whether and how climate model credibility affects water resource system robustness is a valuable question that needs to be answered however to date there have been no studies exploring the effect of climate model credibility on water resource system robustness when making decisions associated with the deep uncertainty regarding future climate in addition assumptions related to the processing of climate models or to probability distribution selection for climate variables can affect the possible climate condition sampling leading to different robust decision making outcomes moody and brown 2013 li et al 2014 whateley et al 2014 reis and shortridge 2019 for example reis and shortridge 2019 found that extended parameter distributions resulted in lower robustness and distribution selection can impact vulnerabilities through the robustness decision framework therefore it is valuable to explore the joint influence of probability distribution selection and climate model credibility on water resource system robustness which has not yet been addressed in the literature finally for long planning horizons climate change adaptation is uncertain because almost all specifics regarding the future are unknown whateley et al 2014 found that the status quo and optimal operation of a water resource system could result in different or similar robustness under different distribution selection in such a context several management options for water resource systems should be considered whateley et al 2014 culley et al 2016 therefore this paper aims to understand the effect of gcm credibility on robustness evaluation of water resource systems under climate change the third largest hydropower plant in the world xld was selected as a case study the robustness of xld power generation was evaluated based on a decision scaling approach gcm credibility was calculated based on how well selected metrics of historically observed climate variables were modeled by gcm projections 176 numerical modelling experiments were designed using 11 operations of culling gcms according to credibility developing two reservoir operation models and assuming two pdfs under four time periods the objectives of this paper were to determine 1 whether and how climate model credibility affects water resource system robustness 2 what impact climate model credibility has on robust decision making outcomes and 3 what effect climate model credibility has on robustness of power generation for the case of xld 2 study area and methodology 2 1 study area xld is located in the lower reaches of the jinsha river basin fig 1 this is the largest hydropower energy basin in china and accounts for 42 of the hydropower resources in the yangtze river basin chang et al 2010 the hydropower plant is the second largest plant in china and the third largest plant in the world it is the main power source for the west to east power transmission that sends power to central and east china and maintains an important strategic position in china the jinsha river basin is located on the eastern side of the tibetan plateau where climate change has caused significant changes in the regional water cycle wang and zhang 2012 therefore it is very important to study whether the power generation performance of xld is robust or not under climate change actually the effect of climate change on power generation performance is different under conventional and optimal operation models accordingly we consider these two operation models in following modelling experiments the conventional operation model comprehensively reflects the operation rules that meet the requirements of various aspects under various hydrological conditions it can be used for real time operation with inflow changes making it easy to make decisions it is assumed to be cyclo stationary throughout the modelling of different climate states in climate change space the optimal operation model evaluates the potential power generation performance under known inflow it assumes perfect inflow with respect to each climate state so it will change with different climate states 2 2 proposed framework the proposed framework on which the research was based includes three parts the framework first identified climate change space that caused risk using climate stress test pdfs were then fit by culled gcms according to credibility ranking to represent probability of climate change space finally climate informed robustness was evaluated and 176 numerical modelling experiments were designed to explore the effect of gcm credibility on water resource system robustness the proposed framework is summarized in fig 2 and detailed descriptions of each part of the proposed framework are presented in the following sections 2 2 1 robustness evaluation based on decision scaling approach 2 2 1 1 stakeholder driven decision framing a stakeholder driven decision framing is used to describe the characteristics of the project this framing includes the climate variables that the performance of the system is sensitive to the performance indicators and the threshold that parses climate change space into the acceptable region and the unacceptable region which is beyond the scope of this study in this study precipitation and temperature were selected to represent climate variables that the system is sensitive to given that the main function of xld was power generation we set the system performance indicator to average annual power generation and determined the threshold as the historical average annual power generation 2 2 1 2 climate stress test the goal of a climate stress test is to assess water resource system response within a climate change space and to identify the climate change space under which the performance of water resource systems is unsatisfactory climate change space is an n dimensional space in which each dimension is an attribute e g variability mean of climate variables the climate change space is generated by disturbing the time series of temperature and precipitation to make incremental changes to each dimension the disturbing methods include delta method prudhomme et al 2010 culley et al 2016 taner et al 2017 ray et al 2018 zhang et al 2018 puspitarini et al 2020 that uses a uniform scaling of historical data and stochastically perturbing climate data such as the use of stochastic weather generators moursi et al 2017 kim et al 2019 in this study a two dimensional climate change space was selected the two dimensions were the mean annual temperature and the mean annual precipitation delta method was used to disturb time series this meant that perturbations were made uniformly across a year so that there was no disturbance to the temporal structure of the time series therefore climate variability was ignored in this study however vormoor et al 2017 pointed out that different temporal structures of a time series can considerably affect low flows and floods but the impact on the mean flow that is closely related to power generation can be ignored therefore delta method was reasonable for this study specially the temperature was perturbed additively from 0 c to 10 c of historical values with a step size of 1 c while precipitation was perturbed as a change percentage of historical precipitation i e from 12 to 52 with a step size of 4 therefore the climate change space was composed of 187 climate states we had two reasons for choosing this range of the climate change 1 the selected range should expand the climate change space beyond the range of gcm projections because the range of gcm projections is the lower bound of the uncertainty range of future climate stainforth et al 2007 2 the selected range should be wide enough to ensure vulnerability of the system so that the climate states that will cause the system to fail will be revealed once the climate change space has been generated the next step is simulating sensitivity of water resource systems to each climate state in the climate change space a water system model that included a hydrological model section 2 3 and a reservoir operation model section 2 4 forced by the climate states described above translated a climate state xi to a performance indicator of water resource systems yi the progress was repeated over the climate change space x x1 x2 xn to get a set of performance indicators y y1 y2 yn corresponding to each xi the final step is parsing the climate change space into acceptable subregions and subregions that cause risk the parsed climate change space can be represented by a binary performance function λ xi d 1 λ x i d 1 i f y i y t 0 i f y i y t where λ xi d equals one when the system performance yi given a decision d is greater than a pre defined threshold yt meaning that the subregion of the climate change space is acceptable λ xi d equals to zero indicates unacceptable performance 2 2 1 3 climate informed robustness assessment the robustness of water resource systems was evaluated based on a robustness indicator proposed by moody and brown 2013 that is a measure of the probabilities of an acceptable subregion of the climate change space conditioned on an assumed pdf and distribution range the robustness indicator was calculated by equation 2 2 cri d x 1 x n λ x i d pr x i dx where cri is a climate informed robustness indicator conditioned on an assumed pdf the probabilities of a vector of attributes of selected climate variables can be represented by pr xi the climate informed robustness indicator cri is a measure of system robustness resulting in fraction between zero or never meet the satisfactory standard and one or acceptable performance over the entire range considered λ xi d as described in equation 1 determines the range in the climate change space that leads to acceptable performance given a decision d pr x i determines the probabilities of the climate change space over which acceptable performance is achieved therefore the greater the value of this indicator the performance of the system will meet the satisfactory standard over a wider range and a greater probability of climate change space and the more robust the system will be to calculate the robustness indicator the following steps were followed 1 the vectors of attributes of selected climate variables were calculated from a multi model ensemble of available gcms 2 a pdf was fit by the vectors of attributes of selected climate variables to represent pr xi a major challenge in evaluating robustness is that an appropriate type of pdf to represent pr xi is unknown and unknowable due to the deep uncertainty regarding the future climate in fact decision makers cannot agree on a pdf of future climate however a strength of the indicator is that it changes the focus from an attempt to agree on which pdf is correct to a focus on assessing the implications of such disagreement moody and brown 2013 that is different assumed pdfs can be used to simulate pr xi and to explore the sensitivity of the robustness indicator and decision making to different assumptions without considering which assumption is correct many pdfs such as uniform distribution normal distribution and cauchy distribution have been selected to simulate pr xi in this paper a normal distribution and a uniform distribution two commonly used pdfs to simulate pr xi whateley et al 2014 were chosen to explore the implications of different assumptions regarding future climate change 2 2 2 climate model credibility evaluation in this study temperature and precipitation were selected as climate variables of interests because the power generation performance of xld is more sensitive to changes in temperature and precipitation in sum 11 metrics were used to evaluate climate models accounting for the basis of being representative of the characteristics of the climate system especially the properties of the regional time series and the spatial variance table 1 the first three statistical moments of monthly conditions mean coefficient of variation and normalized root mean square error and the pearson correlation coefficient describing the phase of the monthly time series and spatial correlation of climate variables the changing trend and the change amplitude of the time series were measured by the mann kendall test z and the mann kendall test β respectively the first and second empirical orthogonal function eof modes were used to reflect space time variability of meteorological fields two statistics of the pdf brier score and skill score were used to evaluate the simulation effect of gcms on the pdf in this paper we assumed equal weighting of all variables and metrics although there may be differences in confidence in the reliability of metrics and redundant information among metrics rupp et al 2013 equal weighting still provides a valuable assessment of climate model credibility hemer and trenham 2016 the score based method was used to measure credibility of model performance the detailed description of this method is given as follows the model error ei j for a given model i and metric j was defined as 3 e i j x reference j x i j where x reference j and x i j are the reference and simulated metric respectively from the gcms the reference data over the period of 1979 2014 was acquired from the china meteorological forcing dataset provided by the data assimilation and modeling center for tibetan multi spheres dam institute of tibetan plateau research itp and the chinese academy of sciences cas we defined a multi criteria rank score rs value as 4 r s i j max i e i j e i j max i e i j min i e i j 10 where the minimum and maximum operators indicate min max across all considered models for a given metric finally the total rank score for each gcm was obtained by summing all metrics used to indicate the credibility of model performance high rs values indicate high credibility of model performance 2 2 3 numerical modelling experiments a total of 176 numerical modelling experiments were designed to demonstrate the effect of gcm credibility on water resource system robustness the details of the experiments are as follows there are two common methods to integrate gcm credibility into robustness evaluation 1 weighting all models based on credibility 2 culling models according to the credibility ranking i e giving one weight to retained models and giving zero weight to culled models in this paper the model culling method was adopted and implemented as follows 1 the credibility of 13 gcms used in this study was calculated section 2 2 2 2 by stepwise culling gcm with the lowest credibility and the number of gcms with the higher credibility used to calculate robustness n was reduced from 13 to three therefore 11 operations were used to cull models n equals 13 means that there are no models to be culled i e all models are used without considering credibility two reservoir operation schemes were used to simulate the power generation performance of xld under climate change a conventional operation scheme simulated the actual operation of the reservoir using rule curves while an optimal operation model derived the operation policy that maximizes power generation using an optimization algorithm as mentioned previously two pdfs normal distribution and uniform distribution were selected to explore the implications of the different assumptions about future climate on robustness evaluation finally we calculated robustness over the 21st century and divided the full period into four time periods 2021 2040 2030s 2041 2060 2050s 2061 2080 2070s and 2081 2100 2090s in general 176 numerical modelling experiments were calculated using 11 operations to cull gcms developing two reservoir operation models to simulate performance and assuming two pdfs to represent pr x i under four time periods i e a total of 11 operations to cull models 2 operation models 2 pdfs 4 periods 176 experiments 2 3 hydrological modelling a hydrological model the soil and water assessment tool swat was used to translate each climate state in climate change space into inflow to xld swat is a distributed hydrological model of watershed scale with daily time step developed by the usda agricultural research service arnold et al 1998 the effectiveness of the model in studying the influence of climate change on hydrology has been demonstrated in research studies over multiple watersheds guo et al 2008 li et al 2009 the data required by swat for hydrological process simulation included a digital elevation model dem land use data soil data and hydro meteorological data the details of the input data are provided in the appendix the swat model was set up for the period between 1985 and 2006 the warm up period was set to three years 1985 1987 the model was calibrated with data from a 13 year period 1988 2000 using sufi 2 as an optimization algorithm and validated with a six year period 2001 2006 in total 13 parameters in the model that are more sensitive and can have a significant impact on the swat model runoff simulation kim 2017 were calibrated table s1 three statistical metrics were used to assess model performance nash sutcliffe efficiency coefficient nse equation 5 the ratio of the root mean square error rsr equation 6 and the percent bias pbias equation 7 the expressions of which are 5 nse 1 i 1 n q m i q s i 2 i 1 n q m i q m 2 6 rsr i 1 n q m q s i 2 i 1 n q m i q m 2 7 pbias i 1 n q m i q s i i 1 n q m i 100 where q m i and q s i are the measured and simulated flow series m3 s q m is the average value of the measured flow series m3 s n is the length of the data series 2 4 reservoir operation model 2 4 1 conventional operation scheme simulated inflows were used as the input of reservoir operation and the power outputs of the reservoir were calculated by a conventional operation scheme the operation scheme was based on designed operating rule curves for xld obtained from research report refill and flood control plans for xiluodu reservoir in jinsha river provided by the hydro china chengdu engineering corporation hccec hydro china chengdu engineering corporation 2013 zhou et al 2015 in this study two water level thresholds were specified and power generation was determined by output regions that were determined by rule curves we assumed that the operation scheme could adequately simulate the past operation of xld a detailed description of the scheme is in the appendix 2 4 2 optimal operation model an optimal operation model was developed to represent the best operation under climate change because the optimization model used the full record of inflows to choose reservoir release schedule it implicitly assumed perfect inflow forecasts this also meant the optimal operation model identified the best performance that could be achieved without physical changes to reservoir as the optimal operation model was separately run for each climate state in climate change space the best operation solutions for all climate states in climate change space were identified consequently the optimal operation model could find the extent of climate change space that a reservoir could not adapt to through adaptive operation beyond the upper limit infrastructure upgrades were required a dynamic programming algorithm bellman 1956 was employed to optimize the average annual power generation and the decision variables were the discharges of the reservoir on a 10 day interval the model is as follows equation 8 8 f max t 1 t p t g p t δ t 9 g p t k p min p t α i f p t p min 0 i f p t p min 10 p t k q power t h t subject to 11 v t 1 v t q in t q power t q surp l u s t δ t 12 z u p t 1 f z v v t 1 13 z d o w n t f z q q out t 14 p expected t f ph h t 15 z up min t 1 z up t 1 z up max t 1 where f objective function pt output g penalty function δt time step 10 days k and α penalty coefficients whose values were set as 20 and 0 4 respectively pmin firm output whose value was 3395 mw k output coefficient whose value was 8 5 qpower the discharge passing through the hydraulic turbines h water head v reservoir storage qin inflow qsurplus water spillage zup upstream water level fzv stage discharge relation zdown downstream water level fzq water level discharge relation on the downstream pexpected expected output fph the relation between expected output and head difference z up min lower limit of water level i e dead water level z up max upper limit of water level i e flood limit water level during flood season and normal water level during non flood season 2 5 projected climate information the probabilities of climate change space pr xi as described above section 2 2 1 3 were generated from a multi model ensemble of gcm projections two pdfs bivariate normal and bivariate uniform distribution of temperature change and precipitation change were fit using an ensemble of 13 climate models and four shared socio economic pathways i e ssp1 2 6 ssp2 4 5 ssp3 7 0 ssp5 8 5 table 2 data and detailed descriptions of the models are available at the cmip6 archive https esgf node llnl gov search cmip6 gridded simulated data were obtained directly from the gcms at 2 spatial resolution over the jinsha river basin mean annual temperature and precipitation were extracted from the gcms for the historical period 1986 2005 and for four prediction periods 2021 2040 2041 2060 2061 2080 and 2081 2100 absolute differences and percent differences between historical and future temperature and precipitation for the four prediction periods were calculated by the mean annual temperature and precipitation respectively finally the two pdfs were fit by these absolute differences and percent differences 3 results 3 1 hydrological model calibration and validation in order to assess the performance of the swat model in the river basin three statistical metrics nes rsr pbias were selected to evaluate the results of monthly runoff simulation at six hydrological stations zhimenda shigu jinjiangjie panzhihua huadan and pingshan the evaluated results were nse 0 81 rsr 0 41 and pbias 14 1 for the calibration dataset nes 0 83 rsr 0 40 and pbias 14 3 for the validation on the watershed average table 3 moriasi 2007 recommended that if nse 0 50 rsr 0 70 and pbias within 25 for streamflow the model performance can be considered acceptable therefore the proposed model can be used to simulate the hydrological process in the jinsha river basin fig 3 shows the observed and simulated monthly streamflow for calibration and validation datasets at six hydrological stations the results showed that the overall performance of the simulation results was satisfactory compared with the observed streamflow the model better captured dry season discharge than occurrences of high discharge the selected parameters and their final calibrated values generating the highest nse are shown in table s1 the parameter values in the swat model were used for the following research 3 2 climate stress on the power generation of xld fig 4 a and fig 4b show the performance of the reservoir under conventional and optimal operation respectively under climate change conditions the climate change space above the threshold dashed line represents the acceptable climate change conditions while the other part indicates the climate change space that is at risk the sensitivity analysis results showed that the sensitivity of power generation to change in precipitation was greater than the sensitivity to change in temperature for example when temperature rose by 7 5 c or above from the historical value the influence of temperature change on the average annual power generation was negligible in addition when the operation of xld changed from conventional operation to optimal operation the black dashed line moved down resulting in the climate change space of acceptable performance covering a greater region of the climate change space and indicating that optimal operation improved the power generation performance of the reservoir for example the average annual power generation of optimal operation was still equal to the historical value i e the average annual power generation of conventional operation under no change in climate at a 2 5 reduction in precipitation or a mean temperature increase of 0 55 c this suggested that the power generation performance of the hydropower station could adapt to drier conditions by the optimization operation scheme i e the robustness of the reservoir has been improved by optimal operation under climate change as expected fig 4c shows both the identified failure boundaries of conventional and optimal operations the blue region corresponded to the region above the threshold in fig 4a indicating that xld could achieve successful performance of power generation maintaining the conventional operation the orange region corresponded to the region below the threshold in fig 4b indicating the power generation performance was unacceptable or failed even though xld had been optimized the peach colored region corresponded to the region that was below the threshold in fig 4a and above the threshold in fig 4b this region was an adaptation region meaning we could re operate reservoirs by adapting to climate change the identified failure boundaries were used to calculate robustness 3 3 projected future climate and gcm credibility 3 3 1 gcm projections of temperature and precipitation in the jinsha river basin fig 5 shows scatter plots of mean annual temperature and mean annual precipitation from the cmip6 ensemble of gcm output as expected from prior studies brown and wilby 2012 the gcm projections showed that the direction and magnitude of changes in temperature and precipitation diverged among the 13 climate models and the range of uncertainty was large and expanding with time for example by the 2090s the range of outcomes in mean temperature was from 4 6 c to 7 8 c and mean precipitation was from 908 mm to 1894 mm fig 6 shows the changes in temperature and precipitation for four time periods under four ssps projected by 13 gcms in general the four ssps predicted increasing mean annual temperature and precipitation the temperature and precipitation were likely to increase the most rapidly under ssp5 8 5 followed by ssp3 7 0 and ssp2 4 5 and temperature and precipitation increased the slowest under ssp1 2 6 in addition the uncertainty range was large as shown by the upper and lower limits or outliers in the box plots ipsl cm6a lr expressed as an outlier projected a lower temperature than other gcms 3 3 2 credibility of cmip6 projections in the jinsha river basin fig 7 shows the credibility of model performance indicated by total rank score values of the 13 gcms there were significant differences in the credibility of the simulation effects from the 13 gcms the total rank score values ranged from 4 18 to 7 49 the gcm with the best simulation effects for temperature and precipitation was ec earth3 veg with a score of 7 49 following by models cesm2 waccm 7 06 cmcc cm2 sr5 6 52 and noresm2 mm 6 42 the poorest three models in this region were ipsl cm6a lr 4 18 canesm5 4 42 and bcc csm2 mr 5 70 in general these differences in gcm credibility for this case study cannot be ignored 3 4 impacts of gcm credibility on xld robustness fig 8 shows the change of robustness of xld with n under conventional operation rule for four time periods focusing initially on robustness for four time periods the robustness increased with time when n equaled 13 the robustness calculated conditional on normal distribution uniform distribution increased from 0 43 0 27 in period one to 0 87 0 89 in period four this would be expected because the climate in the jinsha river basin will become wetter in the future as shown in fig 6 although the temperature will increase in the future resulting in reduced inflow the increase in precipitation will cause augmented flow and play a more significant role than the increase in temperature in this basin therefore power generation performance of xld will become more robust under wetter conditions the relationship between robustness and n was more complicated as shown in fig 8 n equaled 13 indicated that all of the gcms were used so the values indicated by red horizontal lines represented the robustness calculated without considering credibility the black dotted lines were almost always above the red horizontal lines therefore robustness tended to be higher when considering credibility than when not considering credibility in this case study by reducing n from 13 to three we can observe some interesting rules between n and robustness regardless of the time periods or the selected distributions robustness had a consistent upward trend as n decreased and when n was reduced from six to five robustness had a sudden change from low to high however an upward trend was observed as a whole with each step of culling the models there was no guarantee that the robustness will always increase indicating that robustness was increasing in volatility as n decreased the increase or decrease in robustness conditional on the normal distribution and the uniform distribution was generally consistent as n decreased except that the robustness conditional on the normal distribution decreased while the robustness conditional on the uniform distribution increased when n was reduced from 12 to 11 in the first three periods the uncertainty set became smaller as n decreased however by comparing the red line and the red dotted line it can be seen that the uncertain set size had little effect on the robustness evaluation fig 8 also shows that the choice of pdfs had a significant impact on robustness but the extent of the impact was related to the periods in the first three periods the choice of pdfs significantly affected robustness and robustness conditional on the normal distribution was higher than robustness conditional on the uniform distribution for example before the sudden change of robustness that is before reducing n to five the ranges of robustness conditional on the normal distribution in the first three periods were 0 43 0 51 0 71 0 76 and 0 82 0 86 respectively while the ranges of robustness conditional on the uniform distribution in the first three periods were 0 27 0 39 0 57 0 61 and 0 71 0 78 respectively however in the last period the impact of selection of pdfs on robustness was relatively small fig 9 shows the relationship between robustness of xld and n under optimal operation optimal operation improved the robustness of xld by comparing the robustness indicators in fig 8 and fig 9 and this was consistent with the results of section 3 2 in accordance with the results of the conventional operation the black dotted lines were generally above the red horizontal lines indicating that robustness was higher when considering credibility than when not considering credibility under optimal operation in addition robustness of xld under optimal operation increased in volatility as n decreased and exhibited a sudden ascending change when n was reduced from six to five finally the choice of pdfs significantly affected the robustness in the first three periods but had a relatively small effect on robustness in the last period these results further verified the conclusions obtained from fig 8 it should be noted that the robustness increased with time which is counterintuitive because later periods exhibit more uncertainty and uncertainty has a tradeoff with robustness in general however whether a system will be more robust in the future depends on the performance to be measured and the future state related to that performance of course the future state will become more and more uncertain which is detrimental to the robustness of system in general for example if we consider both power generation and flood control performance of xld the robustness will be lower with time due to increasing uncertainty the results of this study provide evidence for this we can see from fig 10 that the range of uncertainty indicated by gcm projections is expanding with time which means the future becomes more uncertain wetter climate is not conducive to flood control performance while drier climate is not conducive to power generation performance therefore the success subregion of climate change space is a trade off region that indicates moderate climate condition the ever expanding range of uncertainty has resulted in more gcms located outside the trade off region consequently xld robustness will be lower with time due to increasing uncertainty however the increasing uncertainty would not always be detrimental to robustness as described above the performance to be measured and the future state related to that performance determine the change of robustness if we only focus on power generation performance of xld a wetter climate in the future is conducive to the xld robustness even if the future climate becomes uncertain the widening range of uncertainty of gcm projections does not extend into the failure subregion the probabilities of the failure subregion are reduced and cri will rise 4 discussion 4 1 influence of gcm credibility on robustness in the case study area taking the xld as a case study the results from this study illustrated the effect of gcm credibility on the robustness of xld power generation under climate change by culling the lowest credible gcms step by step the results showed that the robustness of xld was increasing in volatility as n decreased and had an ascending sudden change when n was reduced from six to five indicating that considering gcm credibility had a significant effect on robustness of xld power generation however why robustness increased in volatility and had a sudden change as n decreased was a more meaningful issue that needed to be resolved exploring the reason for this change rule of robustness as n decreased in the case study may reveal the general rule of the impact of gcm credibility on robustness this would point the way for decision makers to integrate gcm credibility into robustness evaluation in place based assessments fig 10 and fig 11 explained why robustness was volatile as n decreased as fig 10 shows when n equaled 12 the green points representing the culled gcms were in the subregion that caused risk or were below the point group so pdfs fit by 12 gcms will move up relative to pdfs fit by 13 gcms therefore pdfs fit by 12 gcms will give higher probabilities of being in the acceptable subregion of the climate change space resulting in increased robustness when n was reduced from 13 to 12 however when n equaled 11 as fig 11 shows the green points were in the acceptable subregion or above the point group so the pdfs fit by 11 gcms will move down relative to pdfs fit by 12 gcms and gave lower probabilities of being in the acceptable subregion therefore the robustness generally decreased when n was reduced from 12 to 11 except for period four and that result was due to the decrease of pdf range leading to a decrease in the probabilities of being in the subregion that caused risk we can conclude that the location of the green points determines whether the robustness increases or decreases as n decreases however we can observe that the location of the green points was uncertain figure s3 figure s10 therefore robustness was volatile as n decreased as described above the location of the green points that were culled in turn according to the credibility rank was uncertain the location of green points indicated future predictions of mean annual temperature and precipitation and the credibility was represented by the degree to which gcms can capture the past therefore gcms that had similar ability to capture the past diverged substantially for their future predictions this means that even though some models agree well with observations of the past climate it is difficult to guarantee that their predictions about the future climate are consistent tebaldi and knutti 2007 although it is difficult to guarantee that gcms that have similar ability to capture the past climate have a consistent future prediction as described above those models that have been better captured in the past have a certain consistency in future predictions for example fig 12 shows that the black points tended to be at the upper left of the point group meaning that the gcms that had been better captured in the past consistently predicted the lower temperature and higher precipitation in the future in this case study the black points in fig 12 tended to be at the upper left of the point group and were in the acceptable subregion this also explained why robustness had an upward trend and ascending sudden change when n was reduced from six to five in the case study as fig 12 shows after the green points that were retained when n equaled six but culled when n equaled five had been culled almost all gcms were located in the acceptable subregion giving much higher probabilities for the acceptable subregion the large proportion of pdfs fit by the six gcms extended into the unacceptable subregion while just a small proportion of tails of those fit by five gcms was located in the unacceptable subregion fig 13 therefore when n was reduced from six to five the robustness of xld will have a sudden change from low to high and the robustness increased in general as n decreased 4 2 joint influences of pdf selection and climate model credibility on robustness evaluation one of the merits of the robustness indicators used in this paper is the ability to using different assumed pdfs to simulate pr xi and to explore the effect of the assumed pdf selection on robustness evaluation without considering which assumption is correct some previous research has examined this effect on robustness evaluation and decision making li et al 2014 whateley et al 2014 however when gcm credibility and selection of pdfs are considered simultaneously how they together influence robustness has not been explored as described in section 3 4 the selection of pdfs had a significant effect on robustness and robustness conditioned on the normal distribution was higher than robustness conditioned on the uniform distribution in the first three periods that was because uniform distribution gave more weight to the tail of the distribution that extended to the unacceptable subregion therefore robustness conditioned on the uniform distribution was lower than robustness conditioned on the normal distribution however in the last period almost all gcms were in the acceptable subregion and both normal distribution and uniform distribution will give the unacceptable subregion very low probabilities therefore in period four when the robustness of xld was very high the selection of pdfs had little effect on robustness we can find similar conclusions about the impact of model credibility on robustness in the first three periods when robustness was low considering the credibility of climate models affected the robustness while the effect was negligible in the last periods when robustness was high fig 8 fig 9 the reason for this result was that when robustness of xld was high almost all gcms were in the acceptable subregion and this meant the distribution range in the acceptable subregion will not change much even if some gcms were culled we can conclude that when the robustness of the system is very high or low meaning that almost all of the gcms are located in the acceptable or unacceptable subregion whether credibility is considered or not and what type of pdfs is chosen has little influence on robustness evaluation 4 3 implications for integrating credibility of climate models into robustness evaluation robustness based frameworks have been employed by the world bank the research and development company and water utilities to make decisions under deep climate change uncertainty lempert and groves 2010 kasprzyk et al 2013 however integrating the prediction of climate models into decision making is suitable only if the credibility of the predictions of climate models has been evaluated otto et al 2015 this paper illustrated integration of gcm credibility into water resource system robustness to make decisions at a local scale although the robustness evaluation is based on a decision scaling approach multiple climate informed robustness based frameworks need to use gcms to sample future states of the world regarding climate these results show accounting for gcm credibility can alter the perception of climate related robustness for local systems considering adaption in this case study although the robustness was sensitive to sample size variable n robustness tended to be higher when considering credibility than when not considering credibility in general as shown in fig 8 the reason was the higher credible gcms tended to project wetter climate that was favorable to robustness of xld power generation in most cases the robustness of xld power generation will be higher when higher credible gcms are preferred accordingly considering gcm credibility prevents us from underestimating robustness thus avoiding unnecessary and premature infrastructure upgrades that have high economic and environmental cost mastrandrea et al 2010 however the effect of gcm credibility on water resource system robustness will vary depending on unique condition of each local system and only a single case was demonstrated here when the proposed framework is applied to other water resource systems there may be a situation where the robustness will be overestimated without considering the credibility because higher credible gcms project an unfavorable climate therefore there will be an increase in decision relevant climate related risk facing power generation when failing to account for credibility a further interesting information from the case study for decision makers was the robustness calculated by five or less gcms may be overestimated this may lead to the risk that decision makers may overestimate xld power generation the reason was the gcms were all located in a single subregion of climate change space and cannot describe the deep uncertainty of future climate lempert et al 2003 walker et al 2013 as shown in fig 12 due to the uncertainty and limitation in the modeling progress this paper focused on exploring whether and how the climate model credibility affected water resource system robustness via a case of xld but not for detail engineering purposes this paper selected temperature and precipitation as variables of interest and 11 metrics used to define model performance however the credibility given to each model will always depend on the selected variables and metrics there is no consensus regarding which variables and metrics should be chosen to quantify the performance of credibility tebaldi and knutti 2007 it may depend on the application future work could explore which metrics are suitable for credibility quantification and this may also be a further work for current climate science furthermore it should be noted that it is important to evaluate the skill of climate models to capture the inter annual and inter decadal variability of the climate system however only metrics that were used to assess inter annual variability were selected because of the data length limitation 36 yr and this was a shortcoming of our research further studies could also quantify robustness using other robustness based methods in addition the implementation of the decision scaling framework relies on model development thus any limitations and uncertainties associated with the swat model that translate the climate data into inflow of xld can have a great effect on the robustness evaluation results the inflow of xld was assumed to be a natural runoff and this meant that the human activities in the jinsha river sub basin were ignored in this study this assumption was a limitation for assessing the robustness of power generation for the actual xld finally xld provides great benefits in flood control sediment ejection and navigation in addition to power generation the methods employed in this paper could be extended to incorporate the robustness evaluation of other aspects of xld 5 conclusions 176 numerical modeling experiments were designed to fill the knowledge gap about the effect of climate model credibility on water resource system robustness under climate change the third largest hydropower plant in the world xld was selected as a case study it was found that gcm credibility had a significant effect on robustness and robustness tended to fluctuate upward as n decreased and had a sudden change from low to high when n was reduced from six to five robustness was volatile as n decreased indicating that it is difficult to ensure that gcms that have similar ability to capture the past climate can consistently predict future conditions however robustness had an upward trend and a sudden change as n decreased and this means that those gcms that have been better captured in the past have a certain consistency in future predictions for example in this case study the gcms that captured the past well consistently predicted lower temperature and higher precipitation in the future and thus tended to be located in the acceptable subregion of the climate change space therefore the robustness of xld power generation tended to fluctuate upwards as n decreased the results of this study illustrate the significance of considering gcm credibility on decision making robustness could be over or under estimated if gcm credibility is ignored resulting in biased climate change adaptation decisions however when the gcms with lower credibility are culled n should be large enough to prevent almost all gcms from being located in a single subregion of the climate change space to account for uncertainty in projected future climate forcing 6 credit author statement all authors contributed to the interpretation of the results and to the text credit authorship contribution statement ruikang zhang conceptualization formal analysis methodology writing original draft visualization lei cheng conceptualization data curation formal analysis funding acquisition methodology supervision writing review editing pan liu funding acquisition project administration supervision kangdi huang methodology writing review editing yu gong validation writing review editing supervision shujing qin validation writing review editing dedi liu validation supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was supported by the national key research and development program of china 2018yfc0407202 the national natural science foundation of china 51961145104 41890822 51879193 and the overseas expertise introduction project for discipline innovation 111 project funded by the ministry of education and affairs p r china b18037 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 104063 appendix supplementary materials image application 1 image application 2 
