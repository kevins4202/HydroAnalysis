index,text
26105,input data acquisition and preprocessing is time consuming and difficult to handle and can have major implications on environmental modeling results us epa s hydrological micro services precipitation comparison and analysis tool hms pcat provides a publicly available tool to accomplish this critical task we present hms pcat s software design and its use in gathering preprocessing and evaluating precipitation data through web services this tool simplifies catchment and point based data retrieval by automating temporal and spatial aggregations in a demonstration of the tool four gridded precipitation datasets nldas gldas daymet prism and one set of gauge data ncei were retrieved for 17 regions in the united states and evaluated on 1 how well each dataset captured extreme events and 2 how datasets varied by region hms pcat facilitates data visualizations comparisons and statistics by showing the variability between datasets and allows users to explore the data when selecting precipitation datasets for an environmental modeling application keywords precipitation web services comparison preprocessing data 1 introduction precipitation data are critical inputs required in environmental modeling including hydrologic water quality climate atmospheric deposition erosion and agricultural models precipitation is governed by complicated nonlinear and extremely sensitive atmospheric physical processes b ardossy plate 1992 and has significant variability over space and time krajewski et al 2003 inability to represent spatial rainfall produces uncertainties with streamflow and non point source pollution modeling shen et al 2012 studies have reported precipitation input as the main source of uncertainty in calibrating a watershed hydrology model swat cao et al 2018 chaplot et al 2005 hernandez et al 2000 tuo et al 2016 it is therefore both crucial and challenging to have an accurate representation of precipitation for environmental modeling traditionally three mechanisms provided precipitation data for environmental modeling rain gauges weather radar and satellite based sensors sikorska and seibert 2018 each has its strengths and weaknesses rain gauge data are often referred to as the most accurate representation of precipitation at a precise location kim et al 2014 price et al 2014 observational rain gauge data may have missing values due to station maintenance or equipment malfunctions as well as inaccuracies from sampling errors calibration uncertainty or random errors due to low spatial uniformity an assumption is made that rainfall amounts over an area are represented by a single gauge station radar data provide spatially distributed precipitation data on a much finer scale gao et al 2017 bias in radar datasets stems from signal blockage by topographic effects bright band contaminations range dependency and radar calibration errors satellites are the only way to retrieve globally homogenous estimations of precipitation tapiador et al 2012 gauge data tend to underestimate precipitation events while radar and satellites can misinterpret hail as heavy rainfall awange et al 2016 kidd and huffman 2011 tapiador et al 2012 precipitation data types mentioned above vary in degree of temporal and spatial resolution underlying assumptions and methods e g sampling frame how data are interpolated data quality units timespan of record data dissemination methods data formats ways missing data are handled standard versus local time and temporal aggregations the inherent tradeoffs of individual datasets are often overlooked bishop and beier 2013 daly et al 2007 furthermore deviations of up to 300 mm have been reported in estimated annual precipitation between multiple datasets sun et al 2017 these deviations can impact the output of hydrologic climate agricultural and other types of models used to influence best management practices regulations and decision making since selection of precipitation data has crucial effects on model performance the choice of precipitation data needs to come from an intentional and informed decision modelers currently spend significant time retrieving precipitation data directly from source websites and preprocessing the data before model input barriers in data retrieval can include difficulty collecting input data from different sources incompatibility of data formats lack of available data products and limitations of computing resources c zhang et al 2019 these can cause multiple data requests time consuming downloads and preprocessing procedures for one source which must be repeated for every dataset used in a modeling project when multiple precipitation datasets are used in calibration and validation the performance of hydrological models is improved finger et al 2015 process based models requiring large amounts of data are used less often due to data restrictions and data processing limitations fatichi et al 2016 spatial and temporal resolutions of current datasets limit modeling efforts due to the level of detail in available data and computing resources regan et al 2019 in addition each dataset has its own format resolutions units and timespan making it difficult to compare them quickly to simplify data gathering web services provide raw water quality data through online script requests and programming packages like the water quality data portal https www waterqualitydata us portal unfortunately there is still a need to process and format the data once downloaded most existing models lack built in data provisioning services and it is difficult for users without expert knowledge to obtain data due to the complexity of some web service interfaces and protocols huang et al 2011 data provisioning is not usually a seamless part of environmental models and exists as external components or services phuong et al 2019 presented an open source python library to help ease gridded dataset availability and preprocessing use of web services however make it possible to integrate data provisioning programmatically as part of the modeling process or workflow most data acquisitioning projects involve interaction between data services model services and an application that integrates the services carlson et al 2014 interaction of services may require a strong background in computer science or customized programming language scripts that cannot be widely accessed or reused hindering the reproducibility of a scientific study samourkasidis et al 2019 a primary constraint on efficient use of models is provisioning data from disparate data sources and services carlson et al 2014 discovering preprocessing and evaluating precipitation data often constitute a necessary and significant part of environmental modeling obtaining multiple precipitation datasets is costly in time and resources and the problem is amplified when decisions need to be made on the selection of a data source the goal of this study is to introduce and demonstrate the united states environmental protection agency s us epa hydrologic micro services precipitation comparison and analysis tool hms pcat for precipitation data provisioning and analysis we present 1 the design available precipitation data sources data processing operations and strengths and limitations of the precipitation tool as a data web service and 2 how the tool can gather and compare different precipitation sources across the conterminous us this online tool automatically retrieves processes compares and visualizes precipitation time series data at point or catchment locations using methods that eliminate the need for interaction between user and computer code many studies have compared gridded precipitation datasets to gauge data for use in modeling projects behnke et al 2016 gao et al 2017 muche et al 2019 sun et al 2017 oftentimes one chooses a gridded dataset that best matches local station data hms pcat provides visual and statistical comparisons of precipitation sources to inform modelers about datasets to use in environmental modeling projects in a demonstration of the tool we showcase its ease of use by downloading data and performing additional comparisons we used the tool to investigate the differences and variability between datasets and regions in the us threshold values indicating light wet heavy and very heavy precipitation intensities as well as the differences in maximum values were explored to analyze the ability to capture extreme events across multiple datasets this data retrieval and evaluation tool will aid in gathering and preprocessing precipitation input data for environmental modeling projects 2 hydrologic micro services description historically legacy models have worked independently to solve specific questions most do not have efficient automated input data provisioning services resulting in modelers having to spend more time on input data gathering and preprocessing rather than analyzing outputs environmental modeling is moving forward to meet the needs of multimedia platforms and interoperability between new data and models to understand why results differ between models transparency of the methodology and reproducibility of data are needed we developed a hydro informatics platform called hydrologic micro services hms to address the importance of interoperability transparency reproducibility and efficiency in environmental modeling parmar et al 2018 hms was created to break down barriers of old models and datasets that are constrained by legacy formats and connect them to newer formats advanced models and workflows the motivation was to address problems of the hydrology and water quality modeling community we developed hms for users in private public and academic sectors at the local state and federal levels the hms platform is a collection of hydrology and water quality data provisioning web services and modeling components data provisioning web services purvey raw data through online script requests for hydrologic parameters including precipitation air temperature solar radiation soil moisture evapotranspiration surface and subsurface flow and runoff a component is a distinct software module that users can incorporate and link into existing models for example components that have been incorporated and compiled into hms include normalized difference vegetation index ndvi sediment diagenesis eutrophication and kinetic transformation of nutrients and chemicals hms enables users to rapidly characterize the hydrology of a watershed reducing their time on data gathering and preprocessing and easily parameterize model workflows a web service of the hms platform is the precipitation comparison and analysis tool hms pcat which is the focus of this paper hms pcat provides an intuitive online interface for precipitation data source exploration and data download irrespective of computing platforms or coding languages parmar et al 2018 hms pcat facilitates precipitation data access retrieval preprocessing and comparison statistics computations for environmental modeling so more time can be spent analyzing model results the tool is a workflow composed of web services provided by hms that automates accessing and downloading precipitation time series data from their original sources and compiles comprehensive statistics and metadata we developed hms pcat to harmonize precipitation data from multiple sources with different data retrieval protocols formats spatial and temporal resolutions and time references the following sections introduce the software design precipitation data sources that were implemented how the data is processed automatically and challenges we faced while creating the tool hms pcat provides precipitation information to fill knowledge gaps for effective water resource management 2 1 software design we designed and developed hms pcat as an assembly of data provisioning web services that provide a consistent way to access precipitation data across disparate sources with different formats resolutions and access protocols hms pcat is accessible by browser and integrates internal and external web services to provide data processing geospatial and statistical computations that create an accessible database fig 1 the underlying web services have been implemented as representational state transfer application programming interface restful api over hyper text transfer protocol http this approach allows components to communicate over standard internet protocols by removing obstacles associated with heterogenous programming languages and operating systems the tool s browser based user interface was built with standard programming languages html javascript css the user interface implements several cases for pulling and comparing precipitation data each case requires three types of inputs location temporal extent and aggregation level and gridded data source for comparison upon receiving this input from the browser based website each aspect of the input object is validated for accuracy by the hms server and a task is created the hms server distributes the information to appropriate internal services to pull data from external cloud services fig 1 the internal services perform a series of operations on the data including unit and time zone conversions aggregation of data into the requested time interval management of missing data calculations of relevant statistics and compiling of metadata a database temporarily stores the data until retrieval is finished final numerical analysis and comparisons are performed before the time series dataset is returned to the web browser the interoperable and readable time series output file can be downloaded as javascript object notation json or a comma separated value csv file or viewed through the user interface as an interactive line graph downloading time series data allows users to transfer data across multiple models and infrastructures as well as edit and perform additional statistical analyses or interpretations 2 2 precipitation data sources data from federal agencies such as nasa noaa and usda are frequently cited as sources of precipitation data used in environmental modeling behnke et al 2016 gao et al 2017 golden et al 2010 muche et al 2019 five precipitation datasets four interpolated and gridded and one set of collected data of the conterminous us are implemented in hms pcat table 1 additional datasets will be added in later development of the tool spatial coverage and grid resolutions of the precipitation data sources are shown in fig 2 a brief description of each precipitation source implemented in hms pcat is presented below 2 2 1 nldas and gldas the north american land data assimilation system nldas combines north american radar data climate prediction center gauge data and satellite data from the climate prediction center morphing technique cmorph nldas has an hourly time step with data across north america available from 1981 to the present with a maximum time lag of four days rodell 2019 the global land data assimilation system gldas combines satellite data and ground based observational data covering earth between 90 north and 60 south rodell 2019 gldas data are given every 3 h and take at least a month to process gldas data exist in two different time ranges version 1 0 contains data from 1948 to 2010 and version 2 0 containing data from 2010 to the present if a data request covers both ranges hms pcat will gather both versions and combine the data both nldas and gldas data are provided in the greenwich mean time gmt zone which is then converted to local time in the hms pcat algorithm nldas is provided in kg m 2 h 1 which hms pcat converts to mm h 1 given the conversion that 1 kg m 2 is equivalent to 1 mm of water thickness units for gldas are provided in kg m 2 s 1 which is aggregated into three hourly data both nldas and gldas data are summed to provide daily output in mm d 1 both sources are publicly available on the nasa web service via hydrology data rods which are large volumes of organized time series data in an american standard code for information and interchange ascii text format https disc gsfc nasa gov information tools title hydrology 20data 20rods data can be obtained from both nldas and gldas by querying data rod access endpoints with a designated request using location time span and the desired dataset variable as parameters 2 2 2 prism the parameter elevation regressions on independent slopes model prism provides climatology information by combining ground gauge stations from multiple sources and radar products based on digital elevation models data cover the contiguous us from 1981 to 2017 the database is updated yearly by adding data for the complete year the data are provided in json format with default units of mm d 1 in the local time zone daly et al 2008 prism data are dispensed as a layer containing all data within user specified spatial extents making data download and extraction slow hms pcat calls a web service hosted by colorado state university for downloading prism precipitation data as a data rod at a specific location for a faster process http csip engr colostate edu 8083 csip climate m prism 1 0 2 2 3 daymet the daily surface weather and climatological summaries daymet is a dataset of rain gauge data interpolated and extrapolated by the daymet algorithm thornton et al 2017 the interpolation provides data over canada mexico the united states of america and puerto rico daily rainfall is rounded to the nearest whole number provided in mm d 1 and is available from 1980 to the latest full year the extra day in leap years are omitted data are obtained as a csv file from a nasa hosted web service by querying a web service with the desired dataset location and timespan https daymet ornl gov single pixel api data 2 2 4 ncei this dataset from the national center for environmental information ncei provides precipitation data collected and recorded at land based rain gauge stations from the global historical climate network daily ghcn d and the cooperative observer network coop ncei has access to about 53 000 stations worldwide some with data going back as far as 1901 noaa 2017 start and end years for ncei stations depend upon the specific station the temporal resolution is hourly with units in mm and data are provided by the station latitude and longitude point as part of quality control a flag is placed where there is a missing measurement or data quality inconsistency ncei data are obtained in json format using the climate data online web service by issuing a request along with an access token parameter unique to the user https www ncdc noaa gov cdo web webservices v2 gettingstarted tokens are required by ncei to access any datasets which can be specified in the request along with the station id and time span 2 3 data processing data processing steps in hms pcat are important for ensuring an accurate comparison of datasets location temporal resolution and time series format for each dataset must be consistent to relate precipitation data the processing workflow within hms pcat involves minimal user input with automated discovery retrieval and evaluation of precipitation data on the software side the user inputs a location and date range then chooses a temporal aggregation method and desired gridded data sources fig 3 additional details on input combinations are discussed later the tool lets users save time on data retrieval and data processing by automating the procedure as follows 1 validates user input and sends requests to source websites 2 pulls data for location and specified time period 3 aggregates data into specified temporal aggregation algorithms daily monthly annual extreme event in local time zone and flags missing data 4 merges all individual datasets into one data file 5 computes statistics and metadata 6 provides data visualizations on web page 7 formats data for export or incorporation into other modeling components location input can be retrieved by 1 national hydrography dataset nhdplus v2 catchment identifier comid or 2 ncei gauge station identifier station id if station id or comids are unknown a hyperlink is provided to a nationwide map where this information can be obtained fig 3 different combinations of inputs determine how hms pcat processes data the combinations for location inputs are i comid is provided and the nearest to catchment centroid ncei station is used along with gridded data at catchment centroid location ii comid is provided with nearest ncei station used with spatially aggregated gridded data for the catchment iii comid and specific ncei station are provided with gridded data at the catchment centroid or iv comid and specific ncei station are provided with spatially aggregated gridded data for the catchment for spatial aggregation of gridded data an external service call is made to the epa waters cloud service https www epa gov waterdata waters web services to obtain a polygon shapefile for the catchment corresponding to the provided comid the polygon shapefile is overlaid on the respective grid of the data source and a calculation to provide area averaged data is made for options i and ii the search range is expanded until a station with data are found if the closest ncei station does not have precipitation data for the specified time period the system gives an error if no suitable station is found within one latitude longitude degree temporal resolution varies from one data source to another as shown in table 1 thus a temporal aggregation algorithm is necessary to compare data sources one to one the temporal aggregations automatically format the data to cover complete years within the specified start and end year and include daily monthly annual or extreme precipitation event fig 3 if the extreme precipitation event is chosen two user specified threshold values are required one for rainfall accumulation for the previous five days and one for the sixth day amount in all temporal aggregations data covers january 1st of the start year to december 31st of the end year to format the data hms pcat software builds a request to external web services using unique access tokens to identify and pull data using the location and start end dates the request is processed and a time series is produced by shifting time data to the local time zone if required time series from other data sources are unified with the ncei time series missing or invalid data are flagged and given a 9999 value and formatted into a data structure statistical calculations are automated using the math net library flagged missing data points are excluded from all datasets in the comparison statistics these calculations and missing or invalid data flags are documented in the tool metadata for transparency to create a time series output a column was generated for each dataset and a row for each temporal aggregation specified metadata is at the end of the time series which includes the summary statistics performed on the time series the time series is exportable as json or csv 2 4 challenges hms pcat addresses many difficulties modelers face in recovering and handling precipitation data we were confronted with a series of challenges in the creation of this tool the us epa firewall prohibits certain external website domains from being accessed fig 1 this required a firewall exception to be made by our it services so that data source websites could be accessed hms pcat has a limited number of precipitation data sources table 1 each data source has its own limitations and challenges associated with its integration into hms pcat some are not publicly available are not formatted as web services or do not have the necessary metadata information another challenge we encountered was source websites that limit the number of data requests that can be completed within a given time range delay functions and unique access tokens were used to meet website conditions examples are the large requests for ghcn d data covering multiple years which are broken up into smaller delayed requests and combined programmatically in hms pcat the data processing workflow in hms pcat is affected by inconsistency in how precipitation sources handle leap years and missing data for leap years data obtained from nldas prism and ncei provide all 366 days while gldas requests contain data for february 29th and eliminate december 31st to maintain 365 days daymet simply ignores the leap day and treats the leap year as having only 365 days to maintain 366 days per leap year for each data source hms must adjust the leap year data to include february 29th and append a zero value day to december 31st by addressing this data aggregation becomes more streamlined and datasets can be compared more accurately dealing with missing values and how they are represented in each data source is challenging because users want a seamless time series adding a 9999 value to every missing or invalid data point in each dataset addresses discrepancies among precipitation sources 3 pcat demonstration hms pcat can be used to download data for a time series analysis data visualization and comparison for initial observations and as decision support when choosing a precipitation dataset the tool accesses precipitation data from external websites performs temporal aggregations computes statistics produces tables and graphs for data visualization and prepares data files for user download or integration with other existing services one example of using hms pcat for a dataset retrieval and comparison tool across the conterminous us is described in the following sections 3 1 study area we investigated precipitation data over the conterminous us and divided the study area by climatic regions according to bukovsky 2011 fig 4 these regions are simplified from ricketts et al 1999 ecoregions and capture important features in regional climate and topography bukovsky 2011 they have been used previously to evaluate precipitation and temperature data sources over the conterminous us behnke et al 2016 kampe et al 2010 seventeen ncei gauge stations closest to the bukovsky region s centroid are used in our demonstration selected stations are global historical climate network daily ghcn d gauges with more than 100 years of precipitation data except for one station usc00057656 silverton co in the south rockies which had 11 27 missing days all had a minimum of 90 daily records of precipitation data for the reference period table 2 the reference period chosen is from january 1981 to december 2017 37 years given constraints of the gridded datasets 3 2 results results of using hms pcat to retrieve compare and evaluate data from multiple sources are presented as well as examples of downloading the processed data hms pcat gathered all five precipitation sources for each location in table 2 data from each region was downloaded as a csv and combined in a database for additional analysis to demonstrate the ease of working with preprocessed data comparison statistics calculated by hms pcat were extracted from the metadata and validated with external code and data visualizations for a regional analysis the large amounts of data retrieved and downloaded were also investigated for variations in regions and datasets on their ability to capture a range of precipitation intensity events 3 2 1 hms pcat data visualization data was retrieved using hms pcat by the ncei station id and the start and end date for our reference period with a daily aggregation and choosing all sources for comparison as a result of the hms pcat web service fig 5 is a screenshot of the output provided including the metadata an interactive time series graph a table of summary statistics and the pearson s correlation matrix for data visualization and comparison metadata includes the location where the data was pulled and the number of missing data points the time series graph shows values recorded by each dataset on a given day statistics on the datasets include standard deviation mean median and percentile values 75th 95th and 99th the pearson s correlation coefficient matrix demonstrates the linear comparison of the precipitation datasets and does not put weight on a reference dataset the heat map of correlation coefficients shows the degree of correlation between any two datasets from these results we can evaluate variation among datasets and start to make decisions on appropriateness of each dataset for a project 3 2 2 regional variation using the hms pcat data download capability we compared different regions and distinguished the variability of precipitation datasets in diverse environments of the 17 regions 11 showed prism and ncei having the highest pearson s correlation coefficient above 0 8 from 1981 to 2017 figure a1 in appendix three regions showed ncei and daymet with the highest correlation in some regions all datasets showed a similar relationship with a correlation of over 0 5 fig 6 a the pacific nw region other regions indicated that some datasets were vastly different from others in their ability to record values e g fig 6b shows the correlation between ncei and nldas is 0 19 in the mid atlantic region the mid atlantic and appalachian regions had a similar relationship with the lowest dataset correlations other regions showed higher correlations between two gridded datasets daymet and gldas an example is the south rockies region shown in fig 6c the southern rockies ncei gauge station had the highest elevation at 2830 1 m and the largest number of missing days 1524 out of 13 514 3 2 3 extreme events to check how well the precipitation datasets capture extreme weather conditions five climate indices climdex described by x zhang et al 2011 were used the single day maximum value recorded and the number of days precipitation p is considered light p 1 mm wet p 1 mm heavy p 10 mm and very heavy p 20 mm these climate indices are commonly used to analyze climate variability alexander et al 2006 behnke et al 2016 donat et al 2013 muche et al 2019 sillmann et al 2013 the number of days precipitation classified as light wet heavy very heavy and the maximum value recorded is shown in fig 7 by showing each dataset one can see variability in days recorded across the us daymet recorded no days 1 mm while other datasets show more data in this range prism nldas and gldas had a higher percentage of data recorded in this range than ncei in all regions nldas has slightly more days recorded as wet while daymet recorded more heavy days compared to the other datasets the deep south and the southeast region recorded the most days with very heavy precipitation events the maximum value recorded is also an indicator of extreme events fig 7e shows the maximum daily value recorded by each data source for each region the same shade of red across each row indicates the ability of each dataset to capture the maximum value the great lakes region had the greatest variation in maximum recorded event ncei recorded 178 mm as the maximum daymet 126 mm nldas 62 4 mm gldas 102 mm and prism 172 mm this is a difference of 115 6 mm between greatest and lowest maximum recorded for the region the great basin and pacific nw regions showed the least difference between the dataset s maximum recorded value 4 discussion hms pcat provides easy access to multiple precipitation datasets both gauge station and gridded in one location this tool is both powerful and efficient for users acquiring data hms pcat software finds the location of gauge stations or catchment identifiers and pinpoints its grid for each gridded dataset the tool pulls the precipitation data from a web service then aggregates the datasets into one file quick data comparison on the webpage can determine which datasets closely match using a summary statistics table pearson s correlation matrix and an interactive times series plot data visualizations and dataset statistics are provided on the output page with an option to download the data for further analysis one can use this tool to decide the most appropriate dataset to use to quickly compare datasets and to gather data for environmental modeling hms speeds up data gathering by automating tedious discovery retrieval and processing procedures one major advantage of hms pcat is that users do not have to maintain and update each resource using this tool can significantly benefit scientists dealing with data acquisition who are not skilled programmers we evaluated hms pcat by showing the amount of data it can handle as well as an analysis on the data it produces we took a closer look into variations of 17 different regions within the us and evaluations of precipitation intensity events recorded by each dataset 4 1 regional variation as one would expect there are regional differences in rainfall amounts orographic and topographic effects complicate climatic processes in mountainous regions high elevations can be quite different from low elevations and the differences cannot be captured in coarse spatial resolutions guan et al 2005 the mid atlantic and appalachian regions had the lowest correlation coefficients which could be caused by the appalachian mountains affecting weather patterns gridded datasets with fine spatial resolution prism and daymet in these regions showed a higher correlation than coarser datasets nldas and gldas spatial resolution may also play a role in the ability to correlate with other datasets prism and daymet were the highest resolution datasets and showed high correlation with ncei in the pearson s matrix refer to appendix figure a1 similar results were shown in muche et al 2019 nldas showed low correlations across each region even though it does not have the coarsest resolution results of nldas bias were shared by behnke et al 2016 the pacific nw was the only region with all datasets above a correlation coefficient of 0 5 for the reference period interpolation methods of gridded datasets involving gauge data can skew data toward gauge records daymet and prism were originated using station data daly et al 2002 thornton et al 1997 2017 similar observations have been made between station data and prism data golden et al 2010 muche et al 2019 having gridded data align with station records can benefit users wanting to fill missing data points datasets that are not independent may introduce unwanted bias in the comparison which is why we also showed general trends in evaluating threshold values and maximum values 4 2 extreme events variability between datasets in recording rainfall intensity can have major impacts on model results for streamflow and erosion calculations the maximum daily rainfall amount is useful in engineering applications and can show long term changes in extreme events when analyzed on an annual basis x zhang et al 2011 the great lakes region had the greatest inconsistency between datasets in maximum recorded amount how well extreme events are captured differs by dataset estimation techniques and methodology days with p 0 and p 1 mm differ dramatically by dataset daymet is unable to account for these low rainfall events because the internal algorithm either assumes the day was dry or was rounded to 1 mm ncei had a low percentage of data in this range which is likely due to estimation of rainfall amounts by observer bias as described by daly et al 2007 the forcing generation technique for radar rainfall estimations used in nldas and gldas can contribute to the high number of days recorded with p 1 mm luo 2003 miscalculations by rain gauges during heavy precipitation events may be due to water loss from wind and erratic behavior of mechanical aspects of the gauge lanza and stagi 2008 molini et al 2005 rain gauges frequently underestimate rainfall during large storms price et al 2014 radcliffe and mukundan 2017 gauge stations often include observer bias in recorded values through favoring or avoiding some precipitation quantities daly et al 2007 the south rockies had the most missing days in the ncei dataset which could account for low correlations regions with low rainfall have gridded datasets that closely match the observed dataset while regions with high rainfall do not agree with the observed dataset which can be due to datasets misinterpreting heavy rainfall events the pacific nw is a wet region and has more heavy days than the southwest region which is more arid the pacific nw had more days considered light wet and heavy than the southeast and deep south regions fig 7 but the overall cumulative sum for those regions is higher than the pacific nw figure a2 in appendix this results from the amount and magnitude of very heavy days the single day maximum for the pacific nw is expressively lower than the southern regions magnitude fig 7 heavy daily rainfall is a common occurrence in the eastern half of the us behnke et al 2016 5 conclusion hms pcat offers a standardized interface for simple access to multiple precipitation datasets to save time and resources and to increase the efficiency and quality of modeling projects the tool is publicly available at https qed epacdx net hms workflow precip compare and provide an email address to request a user id we will continue to update the hms platform to provide additional services and components as research and development continues hms pcat can be used as a data evaluation tool for data source selection by showing comparison statistics between datasets on a web interface being able to quickly view multiple precipitation datasets and their summary statistics can enable users to make well informed decisions on selecting their data source for research or modeling projects further applications of the tool and its use in environmental modeling will be investigated hms pcat overcomes challenges faced when retrieving and processing precipitation data it aids in improving environmental modeling efforts related to water resource research by providing public access to multiple precipitation datasets in an interoperable format and automates data processing and calculations disclaimer this paper has been reviewed in accordance with us environmental protection agency s peer and administrative review policies and approved for publication the views expressed in this article are those of the authors and do not necessarily represent the views or policies of the us environmental protection agency software availability name hydrological micro services precipitation comparison and analysis tool developed by us epa office of research and development national exposure research laboratory athens ga contact https www epa gov ceam forms contact hms helpdesk website https qed epacdx net hms workflow precip compare a new user can request a user id and password by clicking the provided link on the login page github https github com quanted hms blob dev web services models wsprecipcompare cs declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements funding this work was funded through the us epa s office of research and development s safe and sustainable water resources research program this research did not receive any specific grant from funding agencies in the commercial or not for profit sectors appendix supporting material for regional variation hms pcat gathered five precipitation sources ncei nldas gldas daymet prism in 17 locations for the 1981 to 2017 reference period data were evaluated through external code data visualizations on variations between precipitation datasets for regions of the united states were performed in support of results in section 3 2 2 the variation analyses for all regions are presented fig a1 a pearson s correlation matrix for each of the 17 regions studied pearson s correlation coefficient matrix demonstrates the linear comparison of the precipitation datasets darker red indicates a high correlation between two datasets while darker blue shows low correlations fig a1 fig a2 cumulative sum graphs of precipitation in each region starting at year 1981 and going to the end of 2017 ncei is shown in blue daymet is green nldas is red gldas is purple and prism is yellow fig a2 
26105,input data acquisition and preprocessing is time consuming and difficult to handle and can have major implications on environmental modeling results us epa s hydrological micro services precipitation comparison and analysis tool hms pcat provides a publicly available tool to accomplish this critical task we present hms pcat s software design and its use in gathering preprocessing and evaluating precipitation data through web services this tool simplifies catchment and point based data retrieval by automating temporal and spatial aggregations in a demonstration of the tool four gridded precipitation datasets nldas gldas daymet prism and one set of gauge data ncei were retrieved for 17 regions in the united states and evaluated on 1 how well each dataset captured extreme events and 2 how datasets varied by region hms pcat facilitates data visualizations comparisons and statistics by showing the variability between datasets and allows users to explore the data when selecting precipitation datasets for an environmental modeling application keywords precipitation web services comparison preprocessing data 1 introduction precipitation data are critical inputs required in environmental modeling including hydrologic water quality climate atmospheric deposition erosion and agricultural models precipitation is governed by complicated nonlinear and extremely sensitive atmospheric physical processes b ardossy plate 1992 and has significant variability over space and time krajewski et al 2003 inability to represent spatial rainfall produces uncertainties with streamflow and non point source pollution modeling shen et al 2012 studies have reported precipitation input as the main source of uncertainty in calibrating a watershed hydrology model swat cao et al 2018 chaplot et al 2005 hernandez et al 2000 tuo et al 2016 it is therefore both crucial and challenging to have an accurate representation of precipitation for environmental modeling traditionally three mechanisms provided precipitation data for environmental modeling rain gauges weather radar and satellite based sensors sikorska and seibert 2018 each has its strengths and weaknesses rain gauge data are often referred to as the most accurate representation of precipitation at a precise location kim et al 2014 price et al 2014 observational rain gauge data may have missing values due to station maintenance or equipment malfunctions as well as inaccuracies from sampling errors calibration uncertainty or random errors due to low spatial uniformity an assumption is made that rainfall amounts over an area are represented by a single gauge station radar data provide spatially distributed precipitation data on a much finer scale gao et al 2017 bias in radar datasets stems from signal blockage by topographic effects bright band contaminations range dependency and radar calibration errors satellites are the only way to retrieve globally homogenous estimations of precipitation tapiador et al 2012 gauge data tend to underestimate precipitation events while radar and satellites can misinterpret hail as heavy rainfall awange et al 2016 kidd and huffman 2011 tapiador et al 2012 precipitation data types mentioned above vary in degree of temporal and spatial resolution underlying assumptions and methods e g sampling frame how data are interpolated data quality units timespan of record data dissemination methods data formats ways missing data are handled standard versus local time and temporal aggregations the inherent tradeoffs of individual datasets are often overlooked bishop and beier 2013 daly et al 2007 furthermore deviations of up to 300 mm have been reported in estimated annual precipitation between multiple datasets sun et al 2017 these deviations can impact the output of hydrologic climate agricultural and other types of models used to influence best management practices regulations and decision making since selection of precipitation data has crucial effects on model performance the choice of precipitation data needs to come from an intentional and informed decision modelers currently spend significant time retrieving precipitation data directly from source websites and preprocessing the data before model input barriers in data retrieval can include difficulty collecting input data from different sources incompatibility of data formats lack of available data products and limitations of computing resources c zhang et al 2019 these can cause multiple data requests time consuming downloads and preprocessing procedures for one source which must be repeated for every dataset used in a modeling project when multiple precipitation datasets are used in calibration and validation the performance of hydrological models is improved finger et al 2015 process based models requiring large amounts of data are used less often due to data restrictions and data processing limitations fatichi et al 2016 spatial and temporal resolutions of current datasets limit modeling efforts due to the level of detail in available data and computing resources regan et al 2019 in addition each dataset has its own format resolutions units and timespan making it difficult to compare them quickly to simplify data gathering web services provide raw water quality data through online script requests and programming packages like the water quality data portal https www waterqualitydata us portal unfortunately there is still a need to process and format the data once downloaded most existing models lack built in data provisioning services and it is difficult for users without expert knowledge to obtain data due to the complexity of some web service interfaces and protocols huang et al 2011 data provisioning is not usually a seamless part of environmental models and exists as external components or services phuong et al 2019 presented an open source python library to help ease gridded dataset availability and preprocessing use of web services however make it possible to integrate data provisioning programmatically as part of the modeling process or workflow most data acquisitioning projects involve interaction between data services model services and an application that integrates the services carlson et al 2014 interaction of services may require a strong background in computer science or customized programming language scripts that cannot be widely accessed or reused hindering the reproducibility of a scientific study samourkasidis et al 2019 a primary constraint on efficient use of models is provisioning data from disparate data sources and services carlson et al 2014 discovering preprocessing and evaluating precipitation data often constitute a necessary and significant part of environmental modeling obtaining multiple precipitation datasets is costly in time and resources and the problem is amplified when decisions need to be made on the selection of a data source the goal of this study is to introduce and demonstrate the united states environmental protection agency s us epa hydrologic micro services precipitation comparison and analysis tool hms pcat for precipitation data provisioning and analysis we present 1 the design available precipitation data sources data processing operations and strengths and limitations of the precipitation tool as a data web service and 2 how the tool can gather and compare different precipitation sources across the conterminous us this online tool automatically retrieves processes compares and visualizes precipitation time series data at point or catchment locations using methods that eliminate the need for interaction between user and computer code many studies have compared gridded precipitation datasets to gauge data for use in modeling projects behnke et al 2016 gao et al 2017 muche et al 2019 sun et al 2017 oftentimes one chooses a gridded dataset that best matches local station data hms pcat provides visual and statistical comparisons of precipitation sources to inform modelers about datasets to use in environmental modeling projects in a demonstration of the tool we showcase its ease of use by downloading data and performing additional comparisons we used the tool to investigate the differences and variability between datasets and regions in the us threshold values indicating light wet heavy and very heavy precipitation intensities as well as the differences in maximum values were explored to analyze the ability to capture extreme events across multiple datasets this data retrieval and evaluation tool will aid in gathering and preprocessing precipitation input data for environmental modeling projects 2 hydrologic micro services description historically legacy models have worked independently to solve specific questions most do not have efficient automated input data provisioning services resulting in modelers having to spend more time on input data gathering and preprocessing rather than analyzing outputs environmental modeling is moving forward to meet the needs of multimedia platforms and interoperability between new data and models to understand why results differ between models transparency of the methodology and reproducibility of data are needed we developed a hydro informatics platform called hydrologic micro services hms to address the importance of interoperability transparency reproducibility and efficiency in environmental modeling parmar et al 2018 hms was created to break down barriers of old models and datasets that are constrained by legacy formats and connect them to newer formats advanced models and workflows the motivation was to address problems of the hydrology and water quality modeling community we developed hms for users in private public and academic sectors at the local state and federal levels the hms platform is a collection of hydrology and water quality data provisioning web services and modeling components data provisioning web services purvey raw data through online script requests for hydrologic parameters including precipitation air temperature solar radiation soil moisture evapotranspiration surface and subsurface flow and runoff a component is a distinct software module that users can incorporate and link into existing models for example components that have been incorporated and compiled into hms include normalized difference vegetation index ndvi sediment diagenesis eutrophication and kinetic transformation of nutrients and chemicals hms enables users to rapidly characterize the hydrology of a watershed reducing their time on data gathering and preprocessing and easily parameterize model workflows a web service of the hms platform is the precipitation comparison and analysis tool hms pcat which is the focus of this paper hms pcat provides an intuitive online interface for precipitation data source exploration and data download irrespective of computing platforms or coding languages parmar et al 2018 hms pcat facilitates precipitation data access retrieval preprocessing and comparison statistics computations for environmental modeling so more time can be spent analyzing model results the tool is a workflow composed of web services provided by hms that automates accessing and downloading precipitation time series data from their original sources and compiles comprehensive statistics and metadata we developed hms pcat to harmonize precipitation data from multiple sources with different data retrieval protocols formats spatial and temporal resolutions and time references the following sections introduce the software design precipitation data sources that were implemented how the data is processed automatically and challenges we faced while creating the tool hms pcat provides precipitation information to fill knowledge gaps for effective water resource management 2 1 software design we designed and developed hms pcat as an assembly of data provisioning web services that provide a consistent way to access precipitation data across disparate sources with different formats resolutions and access protocols hms pcat is accessible by browser and integrates internal and external web services to provide data processing geospatial and statistical computations that create an accessible database fig 1 the underlying web services have been implemented as representational state transfer application programming interface restful api over hyper text transfer protocol http this approach allows components to communicate over standard internet protocols by removing obstacles associated with heterogenous programming languages and operating systems the tool s browser based user interface was built with standard programming languages html javascript css the user interface implements several cases for pulling and comparing precipitation data each case requires three types of inputs location temporal extent and aggregation level and gridded data source for comparison upon receiving this input from the browser based website each aspect of the input object is validated for accuracy by the hms server and a task is created the hms server distributes the information to appropriate internal services to pull data from external cloud services fig 1 the internal services perform a series of operations on the data including unit and time zone conversions aggregation of data into the requested time interval management of missing data calculations of relevant statistics and compiling of metadata a database temporarily stores the data until retrieval is finished final numerical analysis and comparisons are performed before the time series dataset is returned to the web browser the interoperable and readable time series output file can be downloaded as javascript object notation json or a comma separated value csv file or viewed through the user interface as an interactive line graph downloading time series data allows users to transfer data across multiple models and infrastructures as well as edit and perform additional statistical analyses or interpretations 2 2 precipitation data sources data from federal agencies such as nasa noaa and usda are frequently cited as sources of precipitation data used in environmental modeling behnke et al 2016 gao et al 2017 golden et al 2010 muche et al 2019 five precipitation datasets four interpolated and gridded and one set of collected data of the conterminous us are implemented in hms pcat table 1 additional datasets will be added in later development of the tool spatial coverage and grid resolutions of the precipitation data sources are shown in fig 2 a brief description of each precipitation source implemented in hms pcat is presented below 2 2 1 nldas and gldas the north american land data assimilation system nldas combines north american radar data climate prediction center gauge data and satellite data from the climate prediction center morphing technique cmorph nldas has an hourly time step with data across north america available from 1981 to the present with a maximum time lag of four days rodell 2019 the global land data assimilation system gldas combines satellite data and ground based observational data covering earth between 90 north and 60 south rodell 2019 gldas data are given every 3 h and take at least a month to process gldas data exist in two different time ranges version 1 0 contains data from 1948 to 2010 and version 2 0 containing data from 2010 to the present if a data request covers both ranges hms pcat will gather both versions and combine the data both nldas and gldas data are provided in the greenwich mean time gmt zone which is then converted to local time in the hms pcat algorithm nldas is provided in kg m 2 h 1 which hms pcat converts to mm h 1 given the conversion that 1 kg m 2 is equivalent to 1 mm of water thickness units for gldas are provided in kg m 2 s 1 which is aggregated into three hourly data both nldas and gldas data are summed to provide daily output in mm d 1 both sources are publicly available on the nasa web service via hydrology data rods which are large volumes of organized time series data in an american standard code for information and interchange ascii text format https disc gsfc nasa gov information tools title hydrology 20data 20rods data can be obtained from both nldas and gldas by querying data rod access endpoints with a designated request using location time span and the desired dataset variable as parameters 2 2 2 prism the parameter elevation regressions on independent slopes model prism provides climatology information by combining ground gauge stations from multiple sources and radar products based on digital elevation models data cover the contiguous us from 1981 to 2017 the database is updated yearly by adding data for the complete year the data are provided in json format with default units of mm d 1 in the local time zone daly et al 2008 prism data are dispensed as a layer containing all data within user specified spatial extents making data download and extraction slow hms pcat calls a web service hosted by colorado state university for downloading prism precipitation data as a data rod at a specific location for a faster process http csip engr colostate edu 8083 csip climate m prism 1 0 2 2 3 daymet the daily surface weather and climatological summaries daymet is a dataset of rain gauge data interpolated and extrapolated by the daymet algorithm thornton et al 2017 the interpolation provides data over canada mexico the united states of america and puerto rico daily rainfall is rounded to the nearest whole number provided in mm d 1 and is available from 1980 to the latest full year the extra day in leap years are omitted data are obtained as a csv file from a nasa hosted web service by querying a web service with the desired dataset location and timespan https daymet ornl gov single pixel api data 2 2 4 ncei this dataset from the national center for environmental information ncei provides precipitation data collected and recorded at land based rain gauge stations from the global historical climate network daily ghcn d and the cooperative observer network coop ncei has access to about 53 000 stations worldwide some with data going back as far as 1901 noaa 2017 start and end years for ncei stations depend upon the specific station the temporal resolution is hourly with units in mm and data are provided by the station latitude and longitude point as part of quality control a flag is placed where there is a missing measurement or data quality inconsistency ncei data are obtained in json format using the climate data online web service by issuing a request along with an access token parameter unique to the user https www ncdc noaa gov cdo web webservices v2 gettingstarted tokens are required by ncei to access any datasets which can be specified in the request along with the station id and time span 2 3 data processing data processing steps in hms pcat are important for ensuring an accurate comparison of datasets location temporal resolution and time series format for each dataset must be consistent to relate precipitation data the processing workflow within hms pcat involves minimal user input with automated discovery retrieval and evaluation of precipitation data on the software side the user inputs a location and date range then chooses a temporal aggregation method and desired gridded data sources fig 3 additional details on input combinations are discussed later the tool lets users save time on data retrieval and data processing by automating the procedure as follows 1 validates user input and sends requests to source websites 2 pulls data for location and specified time period 3 aggregates data into specified temporal aggregation algorithms daily monthly annual extreme event in local time zone and flags missing data 4 merges all individual datasets into one data file 5 computes statistics and metadata 6 provides data visualizations on web page 7 formats data for export or incorporation into other modeling components location input can be retrieved by 1 national hydrography dataset nhdplus v2 catchment identifier comid or 2 ncei gauge station identifier station id if station id or comids are unknown a hyperlink is provided to a nationwide map where this information can be obtained fig 3 different combinations of inputs determine how hms pcat processes data the combinations for location inputs are i comid is provided and the nearest to catchment centroid ncei station is used along with gridded data at catchment centroid location ii comid is provided with nearest ncei station used with spatially aggregated gridded data for the catchment iii comid and specific ncei station are provided with gridded data at the catchment centroid or iv comid and specific ncei station are provided with spatially aggregated gridded data for the catchment for spatial aggregation of gridded data an external service call is made to the epa waters cloud service https www epa gov waterdata waters web services to obtain a polygon shapefile for the catchment corresponding to the provided comid the polygon shapefile is overlaid on the respective grid of the data source and a calculation to provide area averaged data is made for options i and ii the search range is expanded until a station with data are found if the closest ncei station does not have precipitation data for the specified time period the system gives an error if no suitable station is found within one latitude longitude degree temporal resolution varies from one data source to another as shown in table 1 thus a temporal aggregation algorithm is necessary to compare data sources one to one the temporal aggregations automatically format the data to cover complete years within the specified start and end year and include daily monthly annual or extreme precipitation event fig 3 if the extreme precipitation event is chosen two user specified threshold values are required one for rainfall accumulation for the previous five days and one for the sixth day amount in all temporal aggregations data covers january 1st of the start year to december 31st of the end year to format the data hms pcat software builds a request to external web services using unique access tokens to identify and pull data using the location and start end dates the request is processed and a time series is produced by shifting time data to the local time zone if required time series from other data sources are unified with the ncei time series missing or invalid data are flagged and given a 9999 value and formatted into a data structure statistical calculations are automated using the math net library flagged missing data points are excluded from all datasets in the comparison statistics these calculations and missing or invalid data flags are documented in the tool metadata for transparency to create a time series output a column was generated for each dataset and a row for each temporal aggregation specified metadata is at the end of the time series which includes the summary statistics performed on the time series the time series is exportable as json or csv 2 4 challenges hms pcat addresses many difficulties modelers face in recovering and handling precipitation data we were confronted with a series of challenges in the creation of this tool the us epa firewall prohibits certain external website domains from being accessed fig 1 this required a firewall exception to be made by our it services so that data source websites could be accessed hms pcat has a limited number of precipitation data sources table 1 each data source has its own limitations and challenges associated with its integration into hms pcat some are not publicly available are not formatted as web services or do not have the necessary metadata information another challenge we encountered was source websites that limit the number of data requests that can be completed within a given time range delay functions and unique access tokens were used to meet website conditions examples are the large requests for ghcn d data covering multiple years which are broken up into smaller delayed requests and combined programmatically in hms pcat the data processing workflow in hms pcat is affected by inconsistency in how precipitation sources handle leap years and missing data for leap years data obtained from nldas prism and ncei provide all 366 days while gldas requests contain data for february 29th and eliminate december 31st to maintain 365 days daymet simply ignores the leap day and treats the leap year as having only 365 days to maintain 366 days per leap year for each data source hms must adjust the leap year data to include february 29th and append a zero value day to december 31st by addressing this data aggregation becomes more streamlined and datasets can be compared more accurately dealing with missing values and how they are represented in each data source is challenging because users want a seamless time series adding a 9999 value to every missing or invalid data point in each dataset addresses discrepancies among precipitation sources 3 pcat demonstration hms pcat can be used to download data for a time series analysis data visualization and comparison for initial observations and as decision support when choosing a precipitation dataset the tool accesses precipitation data from external websites performs temporal aggregations computes statistics produces tables and graphs for data visualization and prepares data files for user download or integration with other existing services one example of using hms pcat for a dataset retrieval and comparison tool across the conterminous us is described in the following sections 3 1 study area we investigated precipitation data over the conterminous us and divided the study area by climatic regions according to bukovsky 2011 fig 4 these regions are simplified from ricketts et al 1999 ecoregions and capture important features in regional climate and topography bukovsky 2011 they have been used previously to evaluate precipitation and temperature data sources over the conterminous us behnke et al 2016 kampe et al 2010 seventeen ncei gauge stations closest to the bukovsky region s centroid are used in our demonstration selected stations are global historical climate network daily ghcn d gauges with more than 100 years of precipitation data except for one station usc00057656 silverton co in the south rockies which had 11 27 missing days all had a minimum of 90 daily records of precipitation data for the reference period table 2 the reference period chosen is from january 1981 to december 2017 37 years given constraints of the gridded datasets 3 2 results results of using hms pcat to retrieve compare and evaluate data from multiple sources are presented as well as examples of downloading the processed data hms pcat gathered all five precipitation sources for each location in table 2 data from each region was downloaded as a csv and combined in a database for additional analysis to demonstrate the ease of working with preprocessed data comparison statistics calculated by hms pcat were extracted from the metadata and validated with external code and data visualizations for a regional analysis the large amounts of data retrieved and downloaded were also investigated for variations in regions and datasets on their ability to capture a range of precipitation intensity events 3 2 1 hms pcat data visualization data was retrieved using hms pcat by the ncei station id and the start and end date for our reference period with a daily aggregation and choosing all sources for comparison as a result of the hms pcat web service fig 5 is a screenshot of the output provided including the metadata an interactive time series graph a table of summary statistics and the pearson s correlation matrix for data visualization and comparison metadata includes the location where the data was pulled and the number of missing data points the time series graph shows values recorded by each dataset on a given day statistics on the datasets include standard deviation mean median and percentile values 75th 95th and 99th the pearson s correlation coefficient matrix demonstrates the linear comparison of the precipitation datasets and does not put weight on a reference dataset the heat map of correlation coefficients shows the degree of correlation between any two datasets from these results we can evaluate variation among datasets and start to make decisions on appropriateness of each dataset for a project 3 2 2 regional variation using the hms pcat data download capability we compared different regions and distinguished the variability of precipitation datasets in diverse environments of the 17 regions 11 showed prism and ncei having the highest pearson s correlation coefficient above 0 8 from 1981 to 2017 figure a1 in appendix three regions showed ncei and daymet with the highest correlation in some regions all datasets showed a similar relationship with a correlation of over 0 5 fig 6 a the pacific nw region other regions indicated that some datasets were vastly different from others in their ability to record values e g fig 6b shows the correlation between ncei and nldas is 0 19 in the mid atlantic region the mid atlantic and appalachian regions had a similar relationship with the lowest dataset correlations other regions showed higher correlations between two gridded datasets daymet and gldas an example is the south rockies region shown in fig 6c the southern rockies ncei gauge station had the highest elevation at 2830 1 m and the largest number of missing days 1524 out of 13 514 3 2 3 extreme events to check how well the precipitation datasets capture extreme weather conditions five climate indices climdex described by x zhang et al 2011 were used the single day maximum value recorded and the number of days precipitation p is considered light p 1 mm wet p 1 mm heavy p 10 mm and very heavy p 20 mm these climate indices are commonly used to analyze climate variability alexander et al 2006 behnke et al 2016 donat et al 2013 muche et al 2019 sillmann et al 2013 the number of days precipitation classified as light wet heavy very heavy and the maximum value recorded is shown in fig 7 by showing each dataset one can see variability in days recorded across the us daymet recorded no days 1 mm while other datasets show more data in this range prism nldas and gldas had a higher percentage of data recorded in this range than ncei in all regions nldas has slightly more days recorded as wet while daymet recorded more heavy days compared to the other datasets the deep south and the southeast region recorded the most days with very heavy precipitation events the maximum value recorded is also an indicator of extreme events fig 7e shows the maximum daily value recorded by each data source for each region the same shade of red across each row indicates the ability of each dataset to capture the maximum value the great lakes region had the greatest variation in maximum recorded event ncei recorded 178 mm as the maximum daymet 126 mm nldas 62 4 mm gldas 102 mm and prism 172 mm this is a difference of 115 6 mm between greatest and lowest maximum recorded for the region the great basin and pacific nw regions showed the least difference between the dataset s maximum recorded value 4 discussion hms pcat provides easy access to multiple precipitation datasets both gauge station and gridded in one location this tool is both powerful and efficient for users acquiring data hms pcat software finds the location of gauge stations or catchment identifiers and pinpoints its grid for each gridded dataset the tool pulls the precipitation data from a web service then aggregates the datasets into one file quick data comparison on the webpage can determine which datasets closely match using a summary statistics table pearson s correlation matrix and an interactive times series plot data visualizations and dataset statistics are provided on the output page with an option to download the data for further analysis one can use this tool to decide the most appropriate dataset to use to quickly compare datasets and to gather data for environmental modeling hms speeds up data gathering by automating tedious discovery retrieval and processing procedures one major advantage of hms pcat is that users do not have to maintain and update each resource using this tool can significantly benefit scientists dealing with data acquisition who are not skilled programmers we evaluated hms pcat by showing the amount of data it can handle as well as an analysis on the data it produces we took a closer look into variations of 17 different regions within the us and evaluations of precipitation intensity events recorded by each dataset 4 1 regional variation as one would expect there are regional differences in rainfall amounts orographic and topographic effects complicate climatic processes in mountainous regions high elevations can be quite different from low elevations and the differences cannot be captured in coarse spatial resolutions guan et al 2005 the mid atlantic and appalachian regions had the lowest correlation coefficients which could be caused by the appalachian mountains affecting weather patterns gridded datasets with fine spatial resolution prism and daymet in these regions showed a higher correlation than coarser datasets nldas and gldas spatial resolution may also play a role in the ability to correlate with other datasets prism and daymet were the highest resolution datasets and showed high correlation with ncei in the pearson s matrix refer to appendix figure a1 similar results were shown in muche et al 2019 nldas showed low correlations across each region even though it does not have the coarsest resolution results of nldas bias were shared by behnke et al 2016 the pacific nw was the only region with all datasets above a correlation coefficient of 0 5 for the reference period interpolation methods of gridded datasets involving gauge data can skew data toward gauge records daymet and prism were originated using station data daly et al 2002 thornton et al 1997 2017 similar observations have been made between station data and prism data golden et al 2010 muche et al 2019 having gridded data align with station records can benefit users wanting to fill missing data points datasets that are not independent may introduce unwanted bias in the comparison which is why we also showed general trends in evaluating threshold values and maximum values 4 2 extreme events variability between datasets in recording rainfall intensity can have major impacts on model results for streamflow and erosion calculations the maximum daily rainfall amount is useful in engineering applications and can show long term changes in extreme events when analyzed on an annual basis x zhang et al 2011 the great lakes region had the greatest inconsistency between datasets in maximum recorded amount how well extreme events are captured differs by dataset estimation techniques and methodology days with p 0 and p 1 mm differ dramatically by dataset daymet is unable to account for these low rainfall events because the internal algorithm either assumes the day was dry or was rounded to 1 mm ncei had a low percentage of data in this range which is likely due to estimation of rainfall amounts by observer bias as described by daly et al 2007 the forcing generation technique for radar rainfall estimations used in nldas and gldas can contribute to the high number of days recorded with p 1 mm luo 2003 miscalculations by rain gauges during heavy precipitation events may be due to water loss from wind and erratic behavior of mechanical aspects of the gauge lanza and stagi 2008 molini et al 2005 rain gauges frequently underestimate rainfall during large storms price et al 2014 radcliffe and mukundan 2017 gauge stations often include observer bias in recorded values through favoring or avoiding some precipitation quantities daly et al 2007 the south rockies had the most missing days in the ncei dataset which could account for low correlations regions with low rainfall have gridded datasets that closely match the observed dataset while regions with high rainfall do not agree with the observed dataset which can be due to datasets misinterpreting heavy rainfall events the pacific nw is a wet region and has more heavy days than the southwest region which is more arid the pacific nw had more days considered light wet and heavy than the southeast and deep south regions fig 7 but the overall cumulative sum for those regions is higher than the pacific nw figure a2 in appendix this results from the amount and magnitude of very heavy days the single day maximum for the pacific nw is expressively lower than the southern regions magnitude fig 7 heavy daily rainfall is a common occurrence in the eastern half of the us behnke et al 2016 5 conclusion hms pcat offers a standardized interface for simple access to multiple precipitation datasets to save time and resources and to increase the efficiency and quality of modeling projects the tool is publicly available at https qed epacdx net hms workflow precip compare and provide an email address to request a user id we will continue to update the hms platform to provide additional services and components as research and development continues hms pcat can be used as a data evaluation tool for data source selection by showing comparison statistics between datasets on a web interface being able to quickly view multiple precipitation datasets and their summary statistics can enable users to make well informed decisions on selecting their data source for research or modeling projects further applications of the tool and its use in environmental modeling will be investigated hms pcat overcomes challenges faced when retrieving and processing precipitation data it aids in improving environmental modeling efforts related to water resource research by providing public access to multiple precipitation datasets in an interoperable format and automates data processing and calculations disclaimer this paper has been reviewed in accordance with us environmental protection agency s peer and administrative review policies and approved for publication the views expressed in this article are those of the authors and do not necessarily represent the views or policies of the us environmental protection agency software availability name hydrological micro services precipitation comparison and analysis tool developed by us epa office of research and development national exposure research laboratory athens ga contact https www epa gov ceam forms contact hms helpdesk website https qed epacdx net hms workflow precip compare a new user can request a user id and password by clicking the provided link on the login page github https github com quanted hms blob dev web services models wsprecipcompare cs declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements funding this work was funded through the us epa s office of research and development s safe and sustainable water resources research program this research did not receive any specific grant from funding agencies in the commercial or not for profit sectors appendix supporting material for regional variation hms pcat gathered five precipitation sources ncei nldas gldas daymet prism in 17 locations for the 1981 to 2017 reference period data were evaluated through external code data visualizations on variations between precipitation datasets for regions of the united states were performed in support of results in section 3 2 2 the variation analyses for all regions are presented fig a1 a pearson s correlation matrix for each of the 17 regions studied pearson s correlation coefficient matrix demonstrates the linear comparison of the precipitation datasets darker red indicates a high correlation between two datasets while darker blue shows low correlations fig a1 fig a2 cumulative sum graphs of precipitation in each region starting at year 1981 and going to the end of 2017 ncei is shown in blue daymet is green nldas is red gldas is purple and prism is yellow fig a2 
26106,rainwater harvesting rwh is the practice of capturing and storing stormwater for later use in addition to being an alternative source of water for non potable applications rwh is also used to effectively reduce stormwater runoff volumes and pollutant loads dropped into sewage systems rwh is typically carried out by placing a variety of sustainable urban drainage systems suds in different locations of the urban landscape however because of the staggering number of potential combinations of suds typologies and spatial configurations that can be used identifying a strategy that optimally selects and allocates suds to maximize the benefits of rwh is a complex endeavor one of the challenges that emerges during the optimal design and location of these systems is incorporating the inherent uncertainty of the rainfall in this paper we develop a flexible computational framework that couples a geographic information system gis with a two stage stochastic mixed integer linear program ts milp to select and locate suds in order to minimize the use of potable water for irrigation and reduce the water runoff at a minimum cost this framework incorporates an iterative participatory approach to engage stakeholders in the decision making process we tested the proposed methodology on a case study for the central campus at universidad de los andes bogot colombia our results showed that the expected value of the total runoff volume and the consumption of potable water can be reduced up to 67 and 50 respectively keywords mixed integer program participatory approach rainwater harvesting stormwater recycling sustainable urban drainage systems two stage stochastic programming 1 introduction rainwater harvesting rwh is the practice of capturing and storing stormwater for later use for non potable purposes jones and hunt 2010 although rwh has been practiced for centuries abdelkhaleq and ahmed 2007 chocat and schilling 2001 united states environmental protection agency 2013 its use has grown remarkably over the last few decades sparked by the benefits that rwh brings for the environment as well as for the growing number of new potential applications that have stemmed from this practice boers and ben asher 1982 in particular rwh has recently re emerged as a solution for regional water scarcity e g drought mitigation and increased demand satisfaction campisano et al 2017 and as a low cost and environmentally friendly practice to reduce stormwater runoff volumes and its pollutant loads aladenola and adeboye 2010 united states environmental protection agency 2013 jones and hunt 2010 while the earliest rwh techniques were commonly limited to rural environments on suitable natural surfaces the development of new technologies based on simple inducement and collection methods boers and ben asher 1982 have substantially expanded the possibilities of carrying out rwh in more complex and dense urban environments modern implementations have experimented with novel systems to fulfill the goal of rwh in urban areas i e the concentration collection storage and treatment of rainwater from rooftops terraces courtyards and other impervious building surfaces for on site use campisano et al 2017 recent studies have shown that rwh is a promising practice for surface runoff control steffen et al 2013 zhang and hu 2014 vaes and berlamont 1999 herrmann and schmida 2000 and more importantly to reduce the consumption of fresh water e g aladenola and adeboye 2010 rahman et al 2012 herrmann and schmida 2000 appan 2000 handia et al 2003 indeed some researchers have theorized that the total consumption of potable water that could be substituted by rwh accounts for up to 80 of the total water consumption of an average household ward et al 2012 other more conservative reports have shown some variability in the expected reduction but nevertheless a notable reduction in general for example for a household in germany or australia the reported potable water saving potential is up to 60 coombes et al 2000 herrmann and schmida 2000 while in brazil it ranges from 34 to 92 depending on the type of rwh used ghisi et al 2006 in addition to its potential to save potable water rwh is known for its capability of reducing runoff in fact the increased attention and expanding global implementation of sustainable urban drainage systems suds throughout the last 20 years have boosted the research on the effectiveness of rwh systems to control runoff campisano et al 2017 recent studies have systematically reported the success of rwh and other suds as complementary measures to mitigate the increment of both runoff peaks and runoff volumes caused by urbanization burns et al 2015 chocat et al 2007 kozak et al 2012 for example in a study conducted by selbig and bannerman 2008 pre development hydrological and near complete build out conditions were achieved in a basin with suds other studies have reported suds s high effectiveness in both volume and peak flow attenuation e g wild and davis 2009 and palla and gnecco 2015 the introduction of suds did much more than merely propelling rwh it has also broadened the options of using multiple structures to capture and store stormwater for example some green roofs include additional drainage compartments that can be used as rainwater storage qin et al 2016 vila et al 2012 allowing excess water to be used for other purposes after appropriate treatment woods ballard et al 2015 permeable pavements detention basins ponds or swales have the capacity of temporarily storing stormwater that can be later used for irrigation purposes such structures often have storage compartments beneath the overlying surfaces woods ballard et al 2015 or vegetated depressions to accommodate large volumes of water and thus attenuate excessive runoff lawson et al 2012 a notable characteristic of suds is that they are diverse and flexible which gives them the adaptability to be placed in several components of the urban landscape e g sidewalks highways roofs parking lots green areas the empiric widespread adoption of suds has raised the question of whether there is an efficient methodology to identify an optimal configuration that maximize their benefits this research question has spurred the development of optimization methodologies that take into consideration physical social and economical constraints to spatially allocate suds in complex urban environments zhang and chui 2018 the spatial allocation of suds has proven to play an important role when maximizing the benefits of rwh since particular locations and configurations may have characteristics that favor different objectives for example a downstream location will be more suitable for regional control treating larger runoff volumes locations with high imperviousness favor infiltration based suds to reduce runoff efficiently and promote groundwater recharge or hot spots for a particular pollutant may be of special interest in terms of improving water quality in the receiving water bodies zhang and chui 2018 the problem of selecting and allocating suds has been tackled by previous researchers using a wide variety of methodologies in particular a notable contribution to the field has been the use of geographic information systems gis to perform spatial feasibility analyses by means of gis researchers have been able to propose a variety of applications regarding suds planning for example dearden and price 2012 and cooper and calvert 2011 developed suitability maps for infiltration based suds jato espino et al 2016 applied geometric and hydrologic criteria to find areas to install permeable pavements shoemaker et al 2009 developed a framework and tool sustain to identify feasible locations for 14 types of suds and tiwari et al 2018 identified suitable locations for rainwater harvesting structures using remote sensing data the main contribution of most of these works is to determine feasible locations for certain suds however no further conclusions have been drawn in terms of the preferred optimal locations and configurations of the selected suds to be installed the first approaches to tackle this problem applied the traditional benefit cost analysis andoh and declerck 1997 latter applications used exact optimization methodologies such as linear and dynamic programming doyle et al 1976 mays and bedient 1982 alaya et al 2003 while most recent endeavors have focused on the development of metaheuristics like genetic algorithms simulated annealing or tabu search methods metaheuristics are generic random search procedures able to identify good solutions of complex optimization problems e g gendreau et al 2008 fontecha et al 2019 the flexibility of metaheuristics allows them to be coupled with other algorithms like simulations to efficiently explore a large number of potential solutions albeit at the expense of not having a guarantee of the quality of the solution found glover and kochenberger 2006 maier et al 2014 zufferey 2012 in order to simulate the processes of surface runoff infiltration evapotranspiration and other physical and biological processes the metaheuristics are generally coupled with a calculation engine lee et al 2005 zhang and chui 2018 common calculation engines recently used for this purpose are the stormwater management model swmm e g macro et al 2018 cunha et al 2016 ghodsi et al 2016 and the soil and water assessment tool swat e g kaini et al 2012 zhang et al 2013 although other works use other non point source pollution models such as the wqm tmdl n and the agnps e g srivastava et al 2003 yang and best 2015 parallel to the consideration on which optimization techniques are appropriate to tackle the suds allocation problem a compulsory aspect is the integration of stakeholders in the decision making process wynne 1996 evans and plows 2007 an effective stakeholder engagement results in an increased likelihood of success carmona et al 2013 voinov et al 2016 especially when a strong science and policy making relationship is crucial to effectively address the environmental challenge argent et al 2016 in fact widely adopted guidance such as ciria suds design manual woods ballard et al 2007 and epa guidelines united states environmental protection agency 2017 stress the need to engage stakeholders with the decision making process from early stages for this reason we propose an iterative participatory approach in which the stakeholders provide insights to i the prioritized order of the objectives ii the feasibility of potential solutions and iii the satisfactoriness of the proposed result this work stems from previous contributions in participatory literature gis applications and optimization techniques applied to the spatial allocation of suds we propose the use of a two stage stochastic mixed integer linear program ts milp to find the optimal spatial configuration that adapts best to the set of potential outcomes according to their probability of occurrence one of the two stages evaluates the performance of the set of possible solutions over the different scenarios under consideration delage et al 2014 ahmed 2010 birge and louveaux 2011 the proposed methodology is tailored to identify exact solutions for the complex spatial allocation of suds our methodology considers includes i the stochasticity of rainfall on the basis of its probability of occurrence instead of optimizing for the average or the worst case scenario ii the identification of optimal solutions by means of linear programming which permits the application of efficient optimization methodologies to reduce the solution search space iii multiple objectives allowing the stakeholders to identify an importance hierarchy of preference among them and iv adaptability to incorporate a wide variety of stakeholder requirements and preferences to our best knowledge previous work on the optimization of the spatial allocation of suds has not considered the connections real and feasible distances and the harvested water flows from the suds to supply water demanding areas the closest attempt to achieve this goal is the work carried out by inamdar et al 2013 which calculated a radius of influence using spatial data of the offer and demand but which fails to determine an optimal configuration considering this information this paper proposes to calculate the linear distance and associated costs of each connection the ts milp herein introduced considers i the hydrologic balance of harvested water in suds typologies ii the infiltration and evapotranspiration processes iii the water uptake and iv the rainfall uncertainty three objective functions are used during the sequential execution of the proposed ts milp first we consider the amount of potable water that is used second we account for the total runoff not captured by the system and third we account for the total installation cost of the system since the proposed model requires the minimization of potentially competing objectives we use traditional techniques commonly used to solve multicriteria optimization problems we test the proposed methodology in a real world case study based on the central campus at universidad de los andes which consumes around 4800 m3 of potable water each month the rest of the paper is organized as follows section 2 provides a detailed explanation of the five steps of the proposed methodology starting from the data processing for the feasible sites identification to the final visualization of results section 3 presents the case study involving the central campus at universidad de los andes colombia while section 4 addresses our findings including a closing discussion with stakeholders finally section 5 concludes the work and outlines future research 2 methods the methodology starts with the processing of spatial data with gis to obtain the parameters required by the ts milp the results from the optimization model are then loaded back onto the gis platform for visualization fig 1 shows the general scheme of the methodology in which five main steps are identified 1 feasible sites identification catchment delineation and stakeholders preferences involvement 2 water consumption quantification 3 rainfall scenarios and runoff quantification 4 optimization and 5 results visualization steps 1 2 and 3 constitute the appraisal of spatial databases rainfall data and secondary information to obtain the parameters of the problem in step 4 the optimization program is parameterized with this information and is later used to calculate the optimal solution which is finally visualized in the gis and shared with stakeholders in step 5 this last step provides a space for stakeholders to discuss proposed solutions and give feedback on what can be improved to reach a satisfactory solution the adaptability of the model plays an important role for incorporating a variety of stakeholder requirements or preferences that may arise after the first proposed solution see connecting arrow between step 5 and step 1 in fig 1 the following subsections describe each step of the methodology in detail 2 1 feasible sites identification catchment delineation and stakeholders inputs fig 2 illustrates the flow diagram of the main processes carried out in step 1 the participation of the stakeholders is shown in gray to begin with georeferenced information of terrain slope average water table depth infiltration rate and buildings are required to create a preliminary map of feasible sites by applying raster calculations this preliminary selection of feasible sites is shared with stakeholders who are involved in the decision making process through the development of social cartography exercises paulston and liebman 1994 downs and stea 1973 from which they can map relevant information about the proposed locations the information collected from stakeholders is then used to modify the preliminary feasible sites by eliminating conflicting sites and re evaluating the feasibility of new areas fig 3 illustrates this first input of stakeholders in step 1 as well as the subsequent steps with stakeholders interventions steps 4 and 5 which will be discusses in subsection 2 5 the catchment delineation is obtained by processing a digital elevation model dem and a surface inventory is used to associate a weighted runoff coefficient to each catchment according to the literature dem based algorithms are not very efficient for catchment delineation in urban areas e g sanzana et al 2017 jankowfsky et al 2013 therefore a modification of the methodologies proposed by parece and campbell 2015 and jato espino 2016 is applied here see fig 2 first the dem is corrected by using building polygons in order to create high obstacles that direct the flow jato espino et al 2016 and then the catchment areas are refined manually using layers of storm water pipelines and gullypots parece and campbell 2015 finally an ortophoto of the study area is used to identify the types of surfaces e g grass roofs and pavements in the catchments the resulting surface inventory and the runoff coefficient values reported in the literature e g butler and davies 2003 hindman et al 2016 asce wef cswr 2011 are used to calculate a weighted runoff coefficient per catchment 2 2 quantification of water consumption water consumption for irrigation is calculated using historical potable water bills and the irrigation regime implemented in the study area since water bills are typically aggregated by buildings or other billing units that generally supply multiple green areas and because the irrigation regime varies for different types of vegetation the plants water requirements are used to disaggregate water demand per unit area these calculations allow the construction of demand maps which show the spatial distribution of the water demand 2 3 rainfall scenarios and runoff quantification historical hourly rainfall time series are used to set up the rainfall scenarios that will be used in the optimization model in an effort to identify important characteristics of the long series an exploratory data analysis is performed the first step is the separation of the series into precipitation events for this purpose the methodology proposed by brown et al 1985 is followed in which a precipitation event is defined to be a period of one or more consecutive hours of precipitation of at least 0 25 mm followed by one or more hours of no precipitation brown et al 1985 following this a frequency analysis is performed in order to identify the range of durations observed in the rainfall series for each duration three intensity categories are defined low medium and high upper and lower limits are set by dividing the intensities range into three sets of equal length for notation each rainfall scenario e corresponds to a designed rainfall level of constant intensity i through a duration d i e e i d to calculate the probabilities of occurrence for each scenario  e we counted the number of occurrences of the combination i d and divided by the total number of rainfall events in the historical series the runoff volume reaching each feasible site is calculated using the rational method see butler and davies 2003 to do so the surface of the study area is classified into k surface types e g grass roofs pavements each holding a runoff coefficient obtained from literature butler and davies 2003 hindman et al 2016 cswr 2011 asce wef the runoff volume that reaches a feasible point is essentially the amount of potential harvesting water for surface storage based suds typologies however an additional calculation is required to determine the runoff volume that is available for those typologies in which the storage takes place beneath a porous medium or modular surface given that a portion of the water is retained in the media until field capacity is reached woods ballard et al 2015 pitt et al 2008 for each time step s s equations 1 3 obtained from the soil water balance calculations proposed by pitt et al 1999 are applied the following parameters are required to calculate both the soil water content v s and the water available for storage l s initial soil moisture v 0 infiltration rate r saturated hydraulic conductivity g and saturation water content h 1 v s v 0 r s s s 1 2 v s v s 1 r s s s 1 3 l s g s s v s h 2 4 optimization model formulation as a result of the steps described above two subsets containing geographical sites are identified first the offering nodes o i e spaces available for suds to store runoff water and second the demanding nodes d i e green spaces requiring water for irrigation both sets belonging to the set of nodes n the set t stands for the suds typologies the set s represents the time steps considered and the set e gathers the three precipitation scenarios low medium and high the model is formulated under two assumptions i a rainfall event can be split into a wet period and a dry period ii runoff occurs only during the wet period while evapotranspiration and the use of water for irrigation occurs only in the dry period fig 4 depicts the scheme of these flows using detention basins as an example flows for other suds typologies are illustrated in appendix a the parameters of the model i e values that are known before the optimization are defined as follows each demanding node d d demands a given amount of water  d that we attempt to satisfy using the runoff water temporarily stored in the suds which must be transported from node n to node m through a pipe that has a unitary installation cost of  n m per meter or alternatively using potable water from the water utility which has a cost per cubic meter  for the sake of simplicity the distance among nodes  n m is calculated as euclidean distances it is worth mentioning that connections and thus values for  n m and  n m are permitted only under the following circumstances i among offering nodes ii from offering to demanding nodes and iii if the difference in height allows the flow of water by gravity it is worth mentioning that the model can be easily extended to allow flow against gravity by also considering water pumps installation costs however we limit our discussion to the former case suds costs are estimated per unit area for each particular typology  t the area to be installed in each offering node is limited by an upper bound corresponding to the maximum feasible area  o t obtained from the feasibility analysis and a lower bound  o t depending on the nature of the suds typology the storage capacity of each offering node depends on a generic depth for each suds typology  t the potential evapotranspiration and infiltration are  t and  o and depend on the suds typology and the particular geographical site of the offering node respectively the available runoff volume to be harvested  o s e is calculated using the rational method for each offering node time and scenario other parameters are the available budget  the probability of occurrence of each scenario  e and a binary parameter  s that takes the value of 1 if the time step is dry no rainfall and 0 otherwise it is worth emphasizing that some of the parameters described above do not exist for all the combinations given by the subindices for example  o n will only exists for a given o o n n if the flow of water is allowed by gravity nine sets of decision variables are defined for the model let x o t be a binary variable that takes the value of 1 if a suds of typology t t is selected to be installed on offering node o o and 0 otherwise y o t be a continuous variable that represents the area of the typology t t to be installed in offering node o o v o n be a binary variable that takes the value of 1 if the connection between offering node o o and node n n is used and 0 otherwise and q o n s e be the volume sent from offering node o o to node n n at the time s s and scenario e e we use w d s e to denote the volume of potable water from the water utility used in the demanding node d d in the time s s and scenario e e r o s e to represent the runoff volume leaving the offering node o o when the maximum storage capacity is exceeded at the time s s and scenario e e i o s e and z o s e to represent the inventory volume available and the losses by evapotranspiration and infiltration respectively in node o o at time s s and scenario e e finally let u o s e be a binary variable that takes the value of 1 if there is evapotranspiration in node o o time s s and scenario e e and 0 otherwise a complete list of sets variables and parameters is available in appendix b 2 4 1 objective functions we consider three competing objective functions in the proposed model i the amount of potable water that is being consumed ii the runoff that is not captured by the system and iii the cost of deploying the system all of which we attempt to minimize there are several techniques designed to handle the interaction of multiple objectives for mixed integer optimization perhaps the most commonly used method is known as the weighted sum approach ehrgott 2005 which consists in aggregating the multiple objectives into a single objective function by introducing a normalization weight associated to each of the objectives each objective function is multiplied by its corresponding weight and a single objective function is produced by adding all the resulting weighted terms the main goal of the weights is twofold first since it is likely that the objective functions are defined over a different set of units and vary in scale the weights are set so that all the objectives are commensurate second depending on the importance that the stakeholders give to the corresponding objectives the set of weights is also used to account for the relevancy they should carry over the overarching set of decisions to this end a larger weight is thus typically given to the objectives of greater importance unfortunately the weighted sum method has several limitations in particular when the scale difference between objectives is of several orders of magnitude finding the ideal set of weights to properly balance all the objectives is not only challenging but may also drastically affect the results of the optimization process by introducing computational rounding errors furthermore incorporating the relevance of the objective functions along with the scale reduction factors can bring further complications to the task of selecting appropriate weights in this paper we use a lexicographic multi objective approach instead often referred to as the  constraints method ehrgott 2005 waltz 1967 marler and arora 2004 this method assumes in general that the stakeholders can provide a lexicographic order i e a given ranking of the objective functions based on their importance following this predefined order the method optimizes the model sequentially each time with respect to a new objective function in order to guarantee that at each iteration the quality of the solution with respect to the previous objectives is not compromised the method introduces additional constraints that limit the detriment of the previous objectives to be at most a predefined value  we note that as with other multi objective optimization methods including traditional meta heuristic approaches deb et al 2002 the proposed lexicographic method can also be used to identify several optimal non dominated solutions in the form of a pareto frontier for different suds configurations by solving the proposed formulation applying different lexicographic orders and varying the values for  one particular case of interest is when the allowed objective deterioration  is set to zero this allows the optimization model to search for alternative solutions within the optimal solution face of the feasible regions furthermore in the specific context of this paper given the importance of the stakeholders inputs the flexibility of the proposed approach allows for a guided parameterization of different setups runs to be evaluated and tested in addition to the weighted sum and the proposed lexicographic methods there are other alternatives that can be explored to tackle the multi objective nature of the problem ehrgott 2005 marler and arora 2004 we decided to use the lexicographic method because it allows us to incorporate the stakeholders requirements within the decision making process in a more natural way i e it is in general easier for the stakeholders to rank the importance of the objectives rather than providing a numerical preference for the specific case of our ts milp model the three objective functions are optimized in the following order selected by the stakeholders the first objective function equation 4 minimizes potable water consumption which is the sum of the consumption w d s e in each scenario e e demanding node d d and time step s s multiplied by the probability of occurrence  e of scenario e e the second objective function equation 5 minimizes the runoff leaving the offering nodes regardless of whether a suds is installed or not r o s e in each scenario e e offering node o o and time step s s multiplied by the probability of occurrence  e of scenario e e finally the third objective function equation 6 minimizes the costs which includes the cost of the connections  o n v o n from offering node o o to node n n the installation costs of the suds area  t y o t in nodes o o using typologies t t and the cost of the potable water used  w d s e in each scenario e e demanding node d d and time step s s multiplied by the probability of occurrence of each scenario  e 4 min e e d d s s  s 1  e w d s e 5 min e e o o s s  s 0  e r o s e 6 min o o n n  o n  o n v o n o o t t  o t  t y o t e e d d s s  s 1  w d s e  e 2 4 2 constraints we will now discuss the set of constraints that define the solution space of the problem expressions 7 33 along with the three objectives mentioned above define the proposed mathematical formulation 7 t t  o t x o t 1 o o 8 y o t  o t x o t o o t t  o t 9 y o t  o t x o t o o t t  o t 10 o  o t  t  o t  t y o t o  o n  n  o n  o n v o n  constraint set 7 guarantees that only one suds typology can be installed per offering node while the sets of constraints 8 and 9 guarantee that the selected area is within the maximum and minimum allotted areas constraint 10 represents the budget limitation the first term corresponds to the cost of installed suds typologies and the second term is the cost of the installed connections 11 q o n s e m v o n o o n n s s e e  o n 12 v o n t  t  o t x o t o o n n  o n 13 q o n s e i o s e o o n n s s e e  o n 14 n n  o n v o n n o o the sets of constraints 11 to 14 relate the variables q o n s e v o n and x o t first constraint set 11 ensures that the flow q o n s e is zero if variable v o n is zero i e if the connection between nodes o and n is not used here the value of m is essentially an upper bound on the flow given by q o n s e note that if the connection from node o o to n n does not exist then q o n s e does not exist either the set of constraints 12 assures that the connection v o n can exist only if at least one suds typology is installed in node o the set of constraints 13 states that the volume flowing through the connection q o n s e has to be less or equal to the inventory i o s e finally the set of constraints 14 limits the number of connections n that can exist from an offering node o 15 i o 1 e  o 1 e r o 1 e o o e e 16 i o s e i o s 1 e  o s e r o s e o o s s e e  s 0 s 1 17 i o s e i o s 1 e n n q o n s e n n q n o s e z o s e o o s s e e  s 1 the set of constraints 15 to 17 are the inventory constraints the set of constraints 15 is used for the first time step which is defined as a wet period thus the first balance includes the incoming runoff  o 1 e and the runoff leaving the node the runoff that exceed the suds capacity constraint set 16 is used for subsequent wet periods and includes the condition of the inventory in the previous time step constraint set 17 is the inventory for dry periods which besides including the state of the inventory in the previous time step adds the inflows and outflows from other nodes second and third terms on the right hand of the equation and the losses of water by evapotranspiration and infiltration the last term of the equation to properly estimate these losses terms z o s e the model requires to consider their dependency on the typology of suds selected and the inventory of water available during the previous time step at each of the candidate locations in essence the losses due to evapotranspiration and infiltration depend on 1 whether there is a suds installed in the location 2 the evapotranspiration  t and infiltration  o of the suds typology installed and 3 whether the inventory of water collected by the suds has reached the potential evapotranspiration limit over a single time step i e maximum expected evapotranspiration to incorporate these disjunctive requirements into the proposed formulation we model the term z o s e in a similar fashion as the way semi continuous variables are modeled in integer programming see bertsimas and weismantel 2005 guret et al 2002 and nemhauser and wolsey 1988 for further reference 18 i o s e t t  o t y o t  t  o m u o s e o o s s e e 19 i o s e t t  o t y o t  t  o 1 m u o s e m 1 u o s e o o s s e e 20 z o s e m 1 u o s 1 e o o s s e e s 1 21 z o s e t t  o t y o t  t  o o o s s e e s 1 22 z o s e t t  o t y o t  t  o m u o s 1 e o o s s e e s 1 modelling this type of semi continuous variables is typically done by introducing an auxiliary set of binary variables here the u o s e which take the value of one if the inventory of water has reached the potential evapotranspiration level and zero otherwise furthermore auxiliary variables u o s s are later used in constraints 20 to 22 to limit the values that the loss terms can take based on the conditions described above the sets of constraints 18 to 22 are of similar nature to the constraints that are traditionally used to linearize bi linear terms i e multiplications of variables often binary when solving integer programming models bertsimas and weismantel 2005 it is important to notice that despite the fact this approach requires increasing the size of the model by introducing additional sets of variables and constraints it allow us to model the dependencies of the losses on the type of suds selected and the inventory of water stored in the suds 23 i o s e t t  o t  t y o t o o s s e e 24  d w d s e o o q o n s e d d s s e e  s 1 constraint set 23 guarantees that the inventory does not exceed the storage capacity of the installed suds while the set of constraints 24 guarantees that the demand is satisfied by means of both potable water and inflows from offering nodes finally the sets of constraints 25 33 represent the nature of the decision variables 25 x o t 0 1 o o t t  o t 26 y o t 0 o o t t  o t 27 v o n 0 1 o o n n  o n 28 q o n s e 0 o o n n s s e e  o n 29 w d s e 0 d d s s e e  s 1 30 r o s e 0 o o s s e e  s 0 31 i o s e 0 o o s s e e 32 z o s e 0 o o s s e e 33 u o s e 0 1 o o s s e e fig 5 schemes the three steps of the lexicographic multi objective model during step 1 the algorithm solves the optimization problem for the first objective function let z 1 be the corresponding optimal solution then at step 2 the algorithm introduces a new constraint that bounds the detriment of z 1 and solves the optimization problem for the second objective let z 2 be the corresponding optimal solution of step 2 finally in step three the algorithm adds a constraint that bounds the detriment of z 2 and solves the problem for the third objective one of the advantages of this type of formulations is that they can be easily parameterized to incorporate the specific needs of a wide variety of scenarios moreover depending on the scale of the problem instance these can be typically solved without the need of heavily specialized hardware for the optimization process any black box commercial optimizer can be effectively used to obtain optimal solutions 2 5 visualization of results because of the spatial nature of the problem maps are used to communicate results aiming for an understandable format and graphical language the maps illustrate the optimal solution which is defined by the selected offering nodes and the corresponding typology and size the supplied demanding nodes and the connection to the offering nodes that supply the harvested water they are automatically visualized in the gis by uploading csv files output of the optimization model containing the characteristics and coordinates of the optimal solution in arcpy the same format and procedure is used to present a sensitivity analysis to assess trade offs between alternative considerations and or stakeholders preferences mysiak et al 2005 understandable and informative maps are expected to encourage stakeholders to contribute with suggestions at each iteration of the framework while promoting bi directional social learning mostert et al 2008 voinov and bousquet 2010 for example modelers learn how to frame the problem while stakeholders develop insights on causal connections e g the soil impermeabilization and its effect in the runoff volume montalto et al 2013 fig 3 illustrates the iterative process looping on stakeholders suggestions until reaching the final set of site typologies spatial configuration the stop criteria is defined by the question is the proposed result satisfactory if no the stakeholders comments and suggestions are retrofitted to the feasible sites selection the optimization or the results processing for visualization see fig 3 the ability to modify the optimization model is perhaps one of the most valuable aspects of this framework here the stakeholders and modeler communication is crucial to achieve a consensus on when the stop criteria is reached 2 6 case study the proposed methodology was applied to identify an optimal selection of suds as well as their optimal locations in the central campus at universidad de los andes in bogot colombia which comprises a constructed area of 6 ha consisting of 30 facility buildings and consumes around 4800 m3 of potable water each month ninety seven percent of this demand is supplied by the local water utility while the remaining 3 is obtained from reuse of gray water and harvested rainfall irrigation accounts for 13 of the total water which is supplied by the water utility the central campus gardens are irrigated manually using hosepipes sprinklers systems or by drip irrigation and they consume 16 6 m3 per day the distribution of this demand in the study area is illustrated in fig 6 the available information for the case study includes an ortophoto raster layers of infiltration rate and water table depth a buildings vector layer and a dem to consider inter and intra annual variability of the groundwater table depth and infiltration rate at city scale the rasters 50 50 m resolution were obtained by applying kriging interpolation from 3384 points from drilling studies undertaken from 1961 to 2011 jimnez ariza et al 2019 the slope raster was calculated from the 1 m resolution dem while the 3 m resolution orthophoto was obtained from a drone flight undertaken by the campus management office finally the calculation of the distances from the university buildings was attained using the buildings vector layer using the above information see fig 2 feasible areas for suds siting were identified per typology five typologies were used for this study considering the screening matrices provided by ciria in which the case study is classified as commercial land use steep slopes ranging from 0 to 50 with a mean of 13 clay soil type mean infiltration rate 8 5 mm h and limited availability of space see woods ballard et al 2007 woods ballard et al 2015 detention basins retention ponds rain barrels permeable pavements and green roofs topographic and environmental constraints obtained from suds guidelines summarized in table 1 were used and implemented using arcgis 10 4 1 the result of this analysis is a map with the feasible sites which was shared with the campus managers who played the roles of both of decision makers and stakeholders several meetings resulted in a map containing information regarding sites that cannot be modified for suds placement and the inclusion of new areas that were not considered previously fig 7 shows the map resulting from the social cartography and fig 8 illustrates the final feasible sites per suds typology a total of 70 feasible sites were identified 1 site for retention ponds 2 sites for detention basins 7 for permeable pavements 12 for green roofs and 48 for rain barrels which were considered to supply the demand of 45 demanding nodes a 2 m resolution dem was used to delineate the sub catchments in the campus which was corrected using the buildings height historical rainfall records were obtained from a nearby rain gauge station located 400 m away from the campus see fig 6 which contained hourly records for the 2000 2013 period the rain series was separated into individual rainfall events following the methodology proposed by brown et al 1985 and a frequency analysis was performed for the duration of the rainfall event fig 9 shows that 95 of the events have a duration of less than 6 h and that precipitation events with a duration of 2 h are the most frequent followed by durations of 1 and 3 h precipitation events were categorized per duration and each category was classified in three ranges of equal length corresponding to low medium and high intensities eighteen scenarios were constructed using 6 durations and three intensities as shown in fig 10 probabilities of occurrence were calculated using the set of rainfall events ranging from 1 to 6 h so that the sum of probabilities from these 18 scenarios is 1 fig 10 shows that for all durations the low scenario has the highest probability of occurrence and that this probability decreases with the duration of the events see continuous lines in fig 10 on the other hand the total runoff for each scenario in the reference situation the sum of the runoff reaching each feasible point with no suds implemented increases with duration thus scenarios with a high probability of occurrence are those with lower runoff see bars in fig 10 this configuration of scenarios follows the philosophy of designing for the most frequent events instead of for the worst case scenario table 2 summarizes the probability of occurrence duration and intensity range for the 18 scenarios synthetic hydrographs were constructed for each scenario by assuming a constant intensity which corresponds to the upper limit of the range reported in fig 8 the expected value calculated by multiplying the mean of each intensity range see fig 10 times its corresponding probability of occurrence and applying the rational method of the total runoff available for harvesting given these 18 scenarios is 378 m3 the model was implemented in the python language and solved using the commercial optimizer gurobi 7 0 2 gurobi optimization 2017 the experiments were ran in a dell optiplex 7060 equipped with an intel r core i7 3 4 ghz processor 32 gb of ram and running windows 10 the specific parameters found in literature and summarized in tables 3 and 4 were used for this case study the detriment of the objective values in subsequent steps of the lexicographic multi objective model was limited to 5 i e  0 05 the evaporation rate was calculated based on the mean evaporation rate for bogot and the infiltration rate for retention ponds and detention basins was extracted using the coordinates of each feasible site from the infiltration rate raster layer green roofs parameters are set based on reported values for a lightweight gravel sized drainage layer and a composite growing media the budget was set as us 150 000 and only one rainwater harvesting device was allotted per roof also the unitary cost of each meter of connection was set at us 45 considering both the costs of a pvc pipe in bogot and the installation costs in an urbanized area 3 results 3 1 sensitivity analysis of maximum connection length the allotted length of the connections is an important parameter that influences the amount of runoff water used for irrigation since the second objective function of the model is to minimize runoff the model will allocate as much area for locating suds as it is possible to temporarily store runoff water but if the connections that permit the flow among the offering and demanding nodes are limiting the supply of stormwater the demand will be satisfied using potable water for this reason to assess the effect of limiting the connection length into the optimal solution the model was implemented for varying maximum connections length ranging from 5 to 30 m connections longer than 30 m were considered impractical and were not contemplated in this study fig 11 shows the optimal spatial configurations for each of the maximum connection length while fig 12 describes the percentage of reduction of potable water and runoff volumes as well as the percentage of budget used as expected the maximum connection length has an important effect on the resulting optimal configuration the 5 m length shown in fig 11 a can supply only one demanding site around 4 2 of the total water demand in contrast with the 30 m length shown in fig 11 f which supplies 27 demanding sites 60 of the demand for all cases the budget used was 87 90 of the total budget and the expected value of runoff reduction is around 62 regarding these results it is worth mentioning that a suds cannot supply the total demand because demanding sites located in high areas are not connected to any offering node only connections that flow by gravity are allotted and because the demand is assumed constant in time while suds water availability decreases after the precipitation event because of water uptake infiltration and evapotranspiration losses b the budget is not completely consumed even though the runoff reduction does not surpass 50 because we imposed a limit on the maximum suds area available per node restricting the volume that can be stored particularly for the rain barrels which were limited to one rain barrel of 0 4 m3 capacity per roof top and c because the second objective function which minimizes the runoff is being limited by the first objective value minimizing potable water the spatial configuration of the suds are forcing the model to select those nodes closest to demanding areas even if these suds have the lowest storage capacity in order to confirm these findings two analyses were carried out evaluating the sensitivity of the model to different budgets and different number of rain barrels allowed and eliminating the first objective function from the analysis optimizing for runoff reduction and budget only 3 2 sensitivity analysis of the budget and the number of rain barrels in the best case scenario were there are no budget limitations the installation costs of all the feasible suds representas a total of usd 780 000 which was deemed as too high by the stakeholders we then performed a sensitivity analysis for different budget levels to evaluate the overall impact that limiting the installation costs has on the expected benefits obtained by the system to this end we ran the model for different budgets calculated as a percentage of the largest expected cost of usd 780 000 the percentages used were 30 000 4 of the total cost 45 000 6 60 000 8 90 000 11 120 000 15 150 000 19 180 000 23 210 000 27 240 000 30 we performed a second sensitivity analysis with respect to the maximum number of rain barrels that can be installed per rooftop we find this particular analysis of importance because the number of rain barrels limits the total volume of water that can be stored for irrigation and since it was previously found that rain barrels are consistently being selected by the optimization model for its closeness to demanding areas see fig 8 increasing this number is expected to reduce both the potable water consumption and the runoff fig 13 shows the comparison of these reductions for the above mentioned budgets using a maximum connection length of 30 m first of all the results of the model suggest that the difference from allowing 1 to 2 rain barrels resulted in changes in potable water reduction of between 3 and 6 about 0 3 and 0 6 m3 and runoff reduction of between 11 and 12 18 and 21 m3 however the change from allowing 2 to 3 rain barrels resulted in non significant reductions in potable water 0 00005 0 1 and for runoff 0 09 0 2 this result evidences that using two rain barrels per rooftop increases the storage capacity but three rain barrels will result in a system that exceeds the offering volume thus leaving a non utilized storage capacity that provides no benefits additionally each curve has an inflection point of usd 50 000 for the potable water reduction curve and of usd 60 000 for the runoff reduction curve the potable water reduction curve shows no improvement after the inflection point but the runoff reduction curve keeps increasing for higher budgets with slopes that tend to zero for illustration purposes we will use the solution obtained with the 60 000 budget and two rain barrels per rooftop fig 14 illustrates the expected value of both potable water consumption and runoff reduction for the usd 60 000 budget 2 rain barrels allotted per rooftop and maximum length of 30 m solution that is the reduction observed in each scenario multiplied by its probability of occurrence the figure shows i runoff reductions are more sensitive to precipitation scenarios than potable water consumption reductions ii high precipitation and higher duration scenarios have the lowest percentage of runoff reductions while low precipitation and lower duration scenarios which are also the most probable have the highest percentage of reductions and iii potable water consumption reduction remains almost constant for all durations all the above affirmations can be explained by the fact that the runoff available is one order of magnitude higher than the potable water hence the required water for irrigation can be guaranteed by the storage capacity of the suds selected the reduction of potable water is no more than 50 because the model assumes a constant demand while the stored water availability decreases in time accounting for evapotranspiration infiltration losses and drainage rate 3 3 comparison with without potable water fig 15 contrasts the spatial configuration obtained for the usd 60 000 budget when potable water is not considered in the optimization model this is the new lexicographic model has only the two last objective functions table 5 specifies potable water and runoff reduction as well as the number and areas per typology as can be observed when potable water is not considered bigger suds areas are selected for detention basins 49 larger and one permeable pavement typology is selected the number of rain barrels remains the same although the configuration of offering nodes with 1 or 2 rain barrels is variable no clear pattern is identified the increase in the suds areas is the result of not considering connections using the surplus budget in constructing larger structures with bigger storage capacity to reduce more runoff the solution that considers potable water reduces 47 of the runoff while not considering potable water results in a runoff reduction of 61 however if the latter configuration is selected there is a lost opportunity cost of reducing potable water by 50 6 an interesting finding is that the spatial distribution of the two solutions with and without potable water is similar it was expected that when potable water is not considered the model would select other typologies instead of rain barrels which is preferred for rainwater harvesting for its closeness with demanding areas and lack of infiltration and evapotranspiration losses however obtained results show that even with the sole objective of reducing runoff rain barrels are preferred showing that rain barrels are an economic and effective measure to reduce runoff this result has been found in previous studies such as jones and hunt 2010 and seo et al 2012 however other studies that consider water quality have also mentioned that rain barrels may not be cost effective in sites with substantial areas for infiltration practices zhen et al 2006 finally it is worth mentioning that from all the model implementations changing budgets connection length and eliminating the potable water reduction optimal solutions were invariably those that selected all typologies except for green roofs in spite of the fact that green roofs are the second least expensive typology see table 3 three facts are particular about this typology i similarly to rain barrels the catchment area is limited to the roof area so these two typologies receive a lower runoff volume ii green roofs retain a considerable amount of water in the substrate layer e g ferrans et al 2018 hence reducing the amount of water available for use in demanding areas and iii while green roofs reduce runoff through evapotranspiration this magnitude is considerably less than the runoff volume losses from a comparably sized infiltration practice chui et al 2016 3 4 stakeholders comments suggestions the methodology was designed to aid stakeholders and decision makers in the selection and allocation of suds as shown in section 2 the stakeholder engagement is proposed as iterative to guarantee that obtained results are satisfactory in order to receive their feedback on the areas they consider required further improvement a meeting with the stakeholders was scheduled to present the obtained results and gave them space to share their insights two iterations were required to reach a consensus on a satisfactory result refer to fig 3 we implemented their suggestions to refine results accordingly in this section we will describe stakeholders comments suggestions and how this new information was included in the second iteration of the method a topic that was revisited during the meeting was the selection of the suds typologies included in the analyses decision makers acknowledged that retention ponds and detention basins have never been considered in previous campus projects since consulting companies previously hired did not explore other suds typologies besides green roofs and rain barrels campus managers showed special interest in the infiltrating based structures considered novel for the university context stakeholders have perceptions derived from past experiences that influenced the acceptance of proposed results they expressed for example a reluctance to install rain barrels at ground level they insisted on locating these structures in the basement of buildings even if this meant a loss of the hydraulic head and a possible increase of costs due to pumps requirements they claimed that rain barrels have large space requirements are not aesthetic and generate noise derived from the pumping through sand filters and activated carbon water treatments on the other hand although green roofs were not included in the final solution the campus managers mentioned they would have discarded these structures from the beginning of the analysis since they consider they have high maintenance costs and the disadvantage of demanding potable water with added nutrients these insights are of extreme value for the optimized solution to fulfill decision makers expectations regarding the assumptions and constraints used to build the model the stakeholders agreed on considering only connections that flow by gravity since they prefer to avoid the use of pumps additionally they reinforced the 30 m connections maximum length assumption but criticized that feasibility is only determined by the distance between nodes they suggest considering possible obstacles such as reinforced walls pillars and underneath pipes and wiring campus managers also mentioned that in some locations gardens or demanding nodes are not at ground level but on a platform about a meter higher this information modifies the feasibility of some connections but does not affect the equations governing the optimization model comments were also made regarding the plots and information shown in the results images similar to those in fig 11 were shown to explain optimized configurations campus managers interpreted the graphs and qualified the proposed solution as feasible and useful and the budget suggested usd 60 000 as accessible however they mentioned that in order to consider this proposal for future implementation they require more details from the model e g where the outlet is to be located where the pipe is to be buried what the environmental benefits are etc they valued the fact that the model is selecting best locations from among a long list of possibilities but they mentioned the usefulness of ranking few top sites to develop a cost benefit analysis that allows them to choose among these reduced prioritized options suggestions regarding quantifying the water volumes stored per year were made claiming that this data will help them evaluate the project financially finally the authors inquired about the perceived value of the tool and the interest of the campus managers in rainwater harvesting projects decision makers agreed on the usefulness of the exercise for the optimal selection of suds sites they mentioned that some of the outputs will be considered for future projects since the university campus is largely interested in constructing more and better rainwater harvesting strategies the sustainability is a path we are already building our university is evaluating the feasibility of projects that even if not the most financially favorable they provide ludic educative spaces and environmental benefits both potable water savings and runoff reduction are objectives of major importance however they mentioned that for the near future they are focusing their efforts on rainwater harvesting for flushing toilets instead of irrigation purposes since recent studies based within the campus have shown that flushing water volumes are considerable higher 3 5 implementation of stakeholders comments suggestions fig 3 shows the three stages in which stakeholders comments can be addressed in the first place there are changes concerning the feasible sites selection and parameterization i eliminate green roofs as a suds typology option ii modify the distance of connecting nodes to include the pipe required to go around possible obstacles such as reinforced walls iii consider the gardens platform height above the ground level iv increase the cost of rain barrels to account for pumps for water distribution from the basements the second category gathers those comments that require a modification in the optimization model equations examples or these changes are the elimination of one or more objective functions or restricting the length or number of allotted connections these type of modifications were performed for the sensitivity analyses and comparisons presented in subsections 4 2 and 4 3 finally third category includes comments that modify results presentation for example i provide a top 5 ranking sites from which to start the implementations and ii report the stored water volume per year updated results from the second iteration are shown in fig 16 table 6 summarizes the number of suds and the area per typology optimized in the second iteration it is observed that the model prioritizes the reduction of potable water use despite the increase on rain barrels costs accounting for pumps and pipes to round obstacles as a result the budget left for the second objective i e minimize runoff volume is decreased and the infiltration based suds are reduced in area also given that the cost of the pump is the same despite the number of rain barrels installed 1 or 2 the model is systematically replacing 1 rain barrel for 2 to reduce the unitary extra costs see figs 15 and 16 the runoff volumes and the harvested water volume to supply the demand were simulated for the period 2010 2017 using the spatial configuration of the optimal solution fig 17 shows these volumes per year the total annual precipitation and the multi year mean 1720 m 3 for intercepted runoff volume and 1619 m 3 for harvested water volume to supply the demand observe that the runoff volume intercepted white bars is bigger than that used to supply the demand gray bars not all the suds selected are connected to demanding nodes specifically the infiltration based suds are only reducing runoff volume see fig 16 finally table 7 provides a top 5 ranking of the nodes typologies based on a benefit cost ratio b c ratio for i the demand satisfied with harvested rainwater m 3 and ii the runoff volume intercepted m 3 since the two criteria gave as expected different ranking positions we organized the b c ratio following the lexicographic model priorities potable water first and runoff volume second these top 5 nodes are shown in fig 16 a top 20 list of the ranking is available in appendix c observe that the top 20 corresponds to rain barrels typology only evidencing again rain barrels efficiency over infiltration based suds for rainwater collecting for reuse 4 discussion and conclusions this paper developed a methodology that couples gis feasibility analysis with a stochastic multi objective model for the selection of sites and suds typologies with the purpose of reducing i the use of potable water for irrigation ii runoff and iii the installation costs we used an iterative participatory approach to engage stakeholders in the decision making process this method is especially useful when the data is scarce and detailed hydrologic hydraulic models are not available and when a more active participation of the stakeholders is seeked the methodology was tested using a case study involving the central campus at universidad de los andes to supply the demand of 16 6 m3 per day used in the campus gardens we found that the expected runoff of the sites selected and the use of potable water can be reduced by 67 and 50 respectively our results for both potable water and runoff reduction lay in the middle range of the efficiencies reported in literature for a variety of scales e g individual houses multi story residential buildings neighborhoods university campuses and cities e g steffen et al 2013 crowley 2005 ghisi and de oliveira 2007 lpez zavala et al 2016 this along with the wide range of average annual runoff volume reduction 20 100 zhang and hu 2014 gilroy and mccuen 2009 is explained by the diversity of hydrologic patterns and the specific characteristics of the site e g roof lot size ratio soil permeability slope karpiscak et al 1990 the optimization model consistently selected rain barrels over infiltration based typologies in spite that rain barrels efficiencies have proven promising in previous studies domnech and saur 2011 infiltration based typologies have been reported to overpass rain barrels performance in terms of runoff peak and volume reduction abi aad et al 2009 this finding evidences the importance of considering the connections in the optimization model rain barrels are preferred in this case because the rainwater is collected close to the place it is used similarly the effect of the connections between demanding and offering nodes proved decisive when selecting suds siting the location in the watershed e g downstream vs upstream or high vs low imperviousness areas played an essential role in previous studies chang et al 2009 di vittorio and ahiablame 2015 hopkins et al 2017 but this effect was undermined in our study when considered where the harvested water is used as a result we did not find any pattern that favored the suds location besides its closeness to demanding nodes an advantage of using this iterative participatory method is that it allows stakeholders to suggest changes to the model via the modification of parameters constraints and objective functions the proposed framework relies on the use of mixed integer programs as the main optimization engine however we note that the proposed model can be replaced by other mechanisms such as metaheuristics to identify similar solutions that also fit the stakeholders needs a disadvantage of using exact methods such as mixed integer programs is the difficulty of incorporating the complex hydraulic equations to quantify water flows heuristic based methods coupled with urban drainage models are often used to provide a more accurate hydraulic representation however note that this implies loosing some desired properties of exact methods such as the solutions guaranteed optimality and the adaptability to seamlessly adapt the model to incorporate additional features for example a common metaheuristic that is used in this context are the genetic algorithms some of the changes that may be required by the stakeholders may trigger significant modifications to vital components of the metaheuristic such as the phenotype description and the crossover and mutation operators to overcome the lack of precision of other exact methods found in the literature we strengthened the description of the hydrologic dynamics and thus improve the accuracy of the system representation by introducing an additional set of variables and constraints we focused our efforts on better accounting for the inventory of water collected by the suds and their interaction with the evapotranspiration and infiltration losses these considerations improve the model accuracy without compromising its solvability in terms of limitations our methodology may present scalability problems in cases where the number of variables required to model the system becomes too large in such cases it is possible for these exact methods to stall before finding optimal solutions also our approach shares the limitations of all hydrological models a strong dependency on the proper estimation of the parameters as well as the limitations on the considerations of the hydrological interactions occurring at finer temporal and spatial scales e g soil moisture can change in the order of minutes salvadore et al 2015 bach et al 2014 a consideration that aligns with the above mentioned limitation is the granularity of the time discretization on the one hand decreasing the time step length increases the accuracy of the model when considering the temporal variations of the evapotranspiration and infiltration losses for they occur in finer intervals of less than an hour salvadore et al 2015 on the other hand optimizing for a series of events with their corresponding dry periods between rainfalls or even for a long continuous time series could increase the computational effort required to solve the resulting problem due to the number of additional variables and constraints that must be considered furthermore introducing a component that accounts for the antecedent dry period can also improve the accuracy of the suds hydrological performance evaluation since this is a relevant parameter for the stormwater retention in soils and suds substrate berretta et al 2014 an area of improvement for future work is to consider the variability of water demand in time which is likely to present inter and intra day week season fluctuations zhou et al 2002 this may have an effect on the flows from the offering nodes which in turn may also affect the expected runoff and the saving of potable water used for irrigation purposes we note that it is possible to incorporate the stochastic nature of the demand in a similar fashion as the way the rainfall was modeled this however would require a more complex scenario based analysis that can be considered in future efforts declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors would like to thank andrs felipe muoz for designing the social cartography exercises and holding the meetings with the campus management office we would also like to acknowledge the help of engineer daniel rodrguez from bogot s water utility in assigning connections costs for the case study we thank the editor and two anonymous reviewers whose valuable insights improved this manuscript finally we thank the colombian department of science technology and innovation colciencias for funding this work appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2019 104532 appendix a image 1 appendix b table 8 list of sets parameters and variables of the ts milp table 8 sets t set of suds typologies s set of time steps e set of scenarios n set of nodes d set of demanding nodes o set of offering nodes parameters  d water demand in node d d  o s e runoff volume available for storage in node o o scenario e e and time s s  t generic depth of the typology t t  o t maximum area available of offering node o o for typology t t  o t minimum area available of offering node o o for typology t t  cost of a cubic meter of potable water from the water utility  n m cost of the pipe from node n n to node m n  n m euclidean distance from node n n to node m n  budget  t unitary cost of the typology t t  t evapotranspiration per hour from typology t t  o infiltration per hour in node o o  allowed detriment from previous optimal solution  e probability of occurrence of scenario e e  s 1 if the time step is a dry period 0 otherwise variables x o t 1 if the typology t t is selected in offering node o o 0 otherwise y o t area of the typology t t is selected in offering node o o v o n 1 if the connection among offering node o o and node n n exists 0 otherwise q o n s e volume sent from the offering node o o to node n n in the time s s and scenario e e w d s e volume of potable water from water utility used in demanding node d d in the time s s and scenario e e z o s e losses volume evapotranspiration and infiltration from offering node o o in the time s s and scenario e e r o s e runoff volume generated in offering node o o in the time s s and scenario e e i o s e inventory volume available in offering node o o in the time s s and scenario e e u o s e auxiliary variable used in the linearization of evapotranspiration and infiltration losses for offering node o o time s s and scenario e e appendix c table 9 top 20 nodes suds based on b c ratio table 9 node typology satisfied demand m 3 runoff intercepted m 3 satisfied demand based runoff intercepted based b c m 3 usd position b c m 3 usd position 76 2rb 287 3 6156 1 5 1 265 3 4 81 2rb 236 5 5044 1 3 2 217 5 16 91 2rb 192 7 6162 1 0 3 265 6 3 88 2rb 148 9 5744 0 8 4 247 6 12 85 2rb 140 2 5364 0 8 4 231 2 15 73 2rb 131 4 6053 0 7 5 260 9 10 83 2rb 113 9 6104 0 6 6 263 1 7 71 2rb 96 4 5724 0 5 7 246 8 13 115 2rb 96 4 6585 0 5 7 283 9 1 92 2rb 69 2 5711 0 4 8 246 2 14 80 2rb 52 6 6067 0 3 9 261 5 9 70 2rb 42 0 6142 0 2 10 264 8 5 82 2rb 26 3 6175 0 1 11 266 2 2 74 2rb 17 5 6116 0 1 11 263 6 6 114 2rb 823 4 2047 0 1 11 2 5 20 113 2rb 0 6585 5 0 0 11 283 1 1 75 2rb 0 6585 5 0 0 11 283 1 1 79 2rb 0 6585 5 0 0 11 283 1 1 86 2rb 0 6585 5 0 0 11 283 1 1 78 2rb 0 6585 5 0 0 11 283 1 1 
26106,rainwater harvesting rwh is the practice of capturing and storing stormwater for later use in addition to being an alternative source of water for non potable applications rwh is also used to effectively reduce stormwater runoff volumes and pollutant loads dropped into sewage systems rwh is typically carried out by placing a variety of sustainable urban drainage systems suds in different locations of the urban landscape however because of the staggering number of potential combinations of suds typologies and spatial configurations that can be used identifying a strategy that optimally selects and allocates suds to maximize the benefits of rwh is a complex endeavor one of the challenges that emerges during the optimal design and location of these systems is incorporating the inherent uncertainty of the rainfall in this paper we develop a flexible computational framework that couples a geographic information system gis with a two stage stochastic mixed integer linear program ts milp to select and locate suds in order to minimize the use of potable water for irrigation and reduce the water runoff at a minimum cost this framework incorporates an iterative participatory approach to engage stakeholders in the decision making process we tested the proposed methodology on a case study for the central campus at universidad de los andes bogot colombia our results showed that the expected value of the total runoff volume and the consumption of potable water can be reduced up to 67 and 50 respectively keywords mixed integer program participatory approach rainwater harvesting stormwater recycling sustainable urban drainage systems two stage stochastic programming 1 introduction rainwater harvesting rwh is the practice of capturing and storing stormwater for later use for non potable purposes jones and hunt 2010 although rwh has been practiced for centuries abdelkhaleq and ahmed 2007 chocat and schilling 2001 united states environmental protection agency 2013 its use has grown remarkably over the last few decades sparked by the benefits that rwh brings for the environment as well as for the growing number of new potential applications that have stemmed from this practice boers and ben asher 1982 in particular rwh has recently re emerged as a solution for regional water scarcity e g drought mitigation and increased demand satisfaction campisano et al 2017 and as a low cost and environmentally friendly practice to reduce stormwater runoff volumes and its pollutant loads aladenola and adeboye 2010 united states environmental protection agency 2013 jones and hunt 2010 while the earliest rwh techniques were commonly limited to rural environments on suitable natural surfaces the development of new technologies based on simple inducement and collection methods boers and ben asher 1982 have substantially expanded the possibilities of carrying out rwh in more complex and dense urban environments modern implementations have experimented with novel systems to fulfill the goal of rwh in urban areas i e the concentration collection storage and treatment of rainwater from rooftops terraces courtyards and other impervious building surfaces for on site use campisano et al 2017 recent studies have shown that rwh is a promising practice for surface runoff control steffen et al 2013 zhang and hu 2014 vaes and berlamont 1999 herrmann and schmida 2000 and more importantly to reduce the consumption of fresh water e g aladenola and adeboye 2010 rahman et al 2012 herrmann and schmida 2000 appan 2000 handia et al 2003 indeed some researchers have theorized that the total consumption of potable water that could be substituted by rwh accounts for up to 80 of the total water consumption of an average household ward et al 2012 other more conservative reports have shown some variability in the expected reduction but nevertheless a notable reduction in general for example for a household in germany or australia the reported potable water saving potential is up to 60 coombes et al 2000 herrmann and schmida 2000 while in brazil it ranges from 34 to 92 depending on the type of rwh used ghisi et al 2006 in addition to its potential to save potable water rwh is known for its capability of reducing runoff in fact the increased attention and expanding global implementation of sustainable urban drainage systems suds throughout the last 20 years have boosted the research on the effectiveness of rwh systems to control runoff campisano et al 2017 recent studies have systematically reported the success of rwh and other suds as complementary measures to mitigate the increment of both runoff peaks and runoff volumes caused by urbanization burns et al 2015 chocat et al 2007 kozak et al 2012 for example in a study conducted by selbig and bannerman 2008 pre development hydrological and near complete build out conditions were achieved in a basin with suds other studies have reported suds s high effectiveness in both volume and peak flow attenuation e g wild and davis 2009 and palla and gnecco 2015 the introduction of suds did much more than merely propelling rwh it has also broadened the options of using multiple structures to capture and store stormwater for example some green roofs include additional drainage compartments that can be used as rainwater storage qin et al 2016 vila et al 2012 allowing excess water to be used for other purposes after appropriate treatment woods ballard et al 2015 permeable pavements detention basins ponds or swales have the capacity of temporarily storing stormwater that can be later used for irrigation purposes such structures often have storage compartments beneath the overlying surfaces woods ballard et al 2015 or vegetated depressions to accommodate large volumes of water and thus attenuate excessive runoff lawson et al 2012 a notable characteristic of suds is that they are diverse and flexible which gives them the adaptability to be placed in several components of the urban landscape e g sidewalks highways roofs parking lots green areas the empiric widespread adoption of suds has raised the question of whether there is an efficient methodology to identify an optimal configuration that maximize their benefits this research question has spurred the development of optimization methodologies that take into consideration physical social and economical constraints to spatially allocate suds in complex urban environments zhang and chui 2018 the spatial allocation of suds has proven to play an important role when maximizing the benefits of rwh since particular locations and configurations may have characteristics that favor different objectives for example a downstream location will be more suitable for regional control treating larger runoff volumes locations with high imperviousness favor infiltration based suds to reduce runoff efficiently and promote groundwater recharge or hot spots for a particular pollutant may be of special interest in terms of improving water quality in the receiving water bodies zhang and chui 2018 the problem of selecting and allocating suds has been tackled by previous researchers using a wide variety of methodologies in particular a notable contribution to the field has been the use of geographic information systems gis to perform spatial feasibility analyses by means of gis researchers have been able to propose a variety of applications regarding suds planning for example dearden and price 2012 and cooper and calvert 2011 developed suitability maps for infiltration based suds jato espino et al 2016 applied geometric and hydrologic criteria to find areas to install permeable pavements shoemaker et al 2009 developed a framework and tool sustain to identify feasible locations for 14 types of suds and tiwari et al 2018 identified suitable locations for rainwater harvesting structures using remote sensing data the main contribution of most of these works is to determine feasible locations for certain suds however no further conclusions have been drawn in terms of the preferred optimal locations and configurations of the selected suds to be installed the first approaches to tackle this problem applied the traditional benefit cost analysis andoh and declerck 1997 latter applications used exact optimization methodologies such as linear and dynamic programming doyle et al 1976 mays and bedient 1982 alaya et al 2003 while most recent endeavors have focused on the development of metaheuristics like genetic algorithms simulated annealing or tabu search methods metaheuristics are generic random search procedures able to identify good solutions of complex optimization problems e g gendreau et al 2008 fontecha et al 2019 the flexibility of metaheuristics allows them to be coupled with other algorithms like simulations to efficiently explore a large number of potential solutions albeit at the expense of not having a guarantee of the quality of the solution found glover and kochenberger 2006 maier et al 2014 zufferey 2012 in order to simulate the processes of surface runoff infiltration evapotranspiration and other physical and biological processes the metaheuristics are generally coupled with a calculation engine lee et al 2005 zhang and chui 2018 common calculation engines recently used for this purpose are the stormwater management model swmm e g macro et al 2018 cunha et al 2016 ghodsi et al 2016 and the soil and water assessment tool swat e g kaini et al 2012 zhang et al 2013 although other works use other non point source pollution models such as the wqm tmdl n and the agnps e g srivastava et al 2003 yang and best 2015 parallel to the consideration on which optimization techniques are appropriate to tackle the suds allocation problem a compulsory aspect is the integration of stakeholders in the decision making process wynne 1996 evans and plows 2007 an effective stakeholder engagement results in an increased likelihood of success carmona et al 2013 voinov et al 2016 especially when a strong science and policy making relationship is crucial to effectively address the environmental challenge argent et al 2016 in fact widely adopted guidance such as ciria suds design manual woods ballard et al 2007 and epa guidelines united states environmental protection agency 2017 stress the need to engage stakeholders with the decision making process from early stages for this reason we propose an iterative participatory approach in which the stakeholders provide insights to i the prioritized order of the objectives ii the feasibility of potential solutions and iii the satisfactoriness of the proposed result this work stems from previous contributions in participatory literature gis applications and optimization techniques applied to the spatial allocation of suds we propose the use of a two stage stochastic mixed integer linear program ts milp to find the optimal spatial configuration that adapts best to the set of potential outcomes according to their probability of occurrence one of the two stages evaluates the performance of the set of possible solutions over the different scenarios under consideration delage et al 2014 ahmed 2010 birge and louveaux 2011 the proposed methodology is tailored to identify exact solutions for the complex spatial allocation of suds our methodology considers includes i the stochasticity of rainfall on the basis of its probability of occurrence instead of optimizing for the average or the worst case scenario ii the identification of optimal solutions by means of linear programming which permits the application of efficient optimization methodologies to reduce the solution search space iii multiple objectives allowing the stakeholders to identify an importance hierarchy of preference among them and iv adaptability to incorporate a wide variety of stakeholder requirements and preferences to our best knowledge previous work on the optimization of the spatial allocation of suds has not considered the connections real and feasible distances and the harvested water flows from the suds to supply water demanding areas the closest attempt to achieve this goal is the work carried out by inamdar et al 2013 which calculated a radius of influence using spatial data of the offer and demand but which fails to determine an optimal configuration considering this information this paper proposes to calculate the linear distance and associated costs of each connection the ts milp herein introduced considers i the hydrologic balance of harvested water in suds typologies ii the infiltration and evapotranspiration processes iii the water uptake and iv the rainfall uncertainty three objective functions are used during the sequential execution of the proposed ts milp first we consider the amount of potable water that is used second we account for the total runoff not captured by the system and third we account for the total installation cost of the system since the proposed model requires the minimization of potentially competing objectives we use traditional techniques commonly used to solve multicriteria optimization problems we test the proposed methodology in a real world case study based on the central campus at universidad de los andes which consumes around 4800 m3 of potable water each month the rest of the paper is organized as follows section 2 provides a detailed explanation of the five steps of the proposed methodology starting from the data processing for the feasible sites identification to the final visualization of results section 3 presents the case study involving the central campus at universidad de los andes colombia while section 4 addresses our findings including a closing discussion with stakeholders finally section 5 concludes the work and outlines future research 2 methods the methodology starts with the processing of spatial data with gis to obtain the parameters required by the ts milp the results from the optimization model are then loaded back onto the gis platform for visualization fig 1 shows the general scheme of the methodology in which five main steps are identified 1 feasible sites identification catchment delineation and stakeholders preferences involvement 2 water consumption quantification 3 rainfall scenarios and runoff quantification 4 optimization and 5 results visualization steps 1 2 and 3 constitute the appraisal of spatial databases rainfall data and secondary information to obtain the parameters of the problem in step 4 the optimization program is parameterized with this information and is later used to calculate the optimal solution which is finally visualized in the gis and shared with stakeholders in step 5 this last step provides a space for stakeholders to discuss proposed solutions and give feedback on what can be improved to reach a satisfactory solution the adaptability of the model plays an important role for incorporating a variety of stakeholder requirements or preferences that may arise after the first proposed solution see connecting arrow between step 5 and step 1 in fig 1 the following subsections describe each step of the methodology in detail 2 1 feasible sites identification catchment delineation and stakeholders inputs fig 2 illustrates the flow diagram of the main processes carried out in step 1 the participation of the stakeholders is shown in gray to begin with georeferenced information of terrain slope average water table depth infiltration rate and buildings are required to create a preliminary map of feasible sites by applying raster calculations this preliminary selection of feasible sites is shared with stakeholders who are involved in the decision making process through the development of social cartography exercises paulston and liebman 1994 downs and stea 1973 from which they can map relevant information about the proposed locations the information collected from stakeholders is then used to modify the preliminary feasible sites by eliminating conflicting sites and re evaluating the feasibility of new areas fig 3 illustrates this first input of stakeholders in step 1 as well as the subsequent steps with stakeholders interventions steps 4 and 5 which will be discusses in subsection 2 5 the catchment delineation is obtained by processing a digital elevation model dem and a surface inventory is used to associate a weighted runoff coefficient to each catchment according to the literature dem based algorithms are not very efficient for catchment delineation in urban areas e g sanzana et al 2017 jankowfsky et al 2013 therefore a modification of the methodologies proposed by parece and campbell 2015 and jato espino 2016 is applied here see fig 2 first the dem is corrected by using building polygons in order to create high obstacles that direct the flow jato espino et al 2016 and then the catchment areas are refined manually using layers of storm water pipelines and gullypots parece and campbell 2015 finally an ortophoto of the study area is used to identify the types of surfaces e g grass roofs and pavements in the catchments the resulting surface inventory and the runoff coefficient values reported in the literature e g butler and davies 2003 hindman et al 2016 asce wef cswr 2011 are used to calculate a weighted runoff coefficient per catchment 2 2 quantification of water consumption water consumption for irrigation is calculated using historical potable water bills and the irrigation regime implemented in the study area since water bills are typically aggregated by buildings or other billing units that generally supply multiple green areas and because the irrigation regime varies for different types of vegetation the plants water requirements are used to disaggregate water demand per unit area these calculations allow the construction of demand maps which show the spatial distribution of the water demand 2 3 rainfall scenarios and runoff quantification historical hourly rainfall time series are used to set up the rainfall scenarios that will be used in the optimization model in an effort to identify important characteristics of the long series an exploratory data analysis is performed the first step is the separation of the series into precipitation events for this purpose the methodology proposed by brown et al 1985 is followed in which a precipitation event is defined to be a period of one or more consecutive hours of precipitation of at least 0 25 mm followed by one or more hours of no precipitation brown et al 1985 following this a frequency analysis is performed in order to identify the range of durations observed in the rainfall series for each duration three intensity categories are defined low medium and high upper and lower limits are set by dividing the intensities range into three sets of equal length for notation each rainfall scenario e corresponds to a designed rainfall level of constant intensity i through a duration d i e e i d to calculate the probabilities of occurrence for each scenario  e we counted the number of occurrences of the combination i d and divided by the total number of rainfall events in the historical series the runoff volume reaching each feasible site is calculated using the rational method see butler and davies 2003 to do so the surface of the study area is classified into k surface types e g grass roofs pavements each holding a runoff coefficient obtained from literature butler and davies 2003 hindman et al 2016 cswr 2011 asce wef the runoff volume that reaches a feasible point is essentially the amount of potential harvesting water for surface storage based suds typologies however an additional calculation is required to determine the runoff volume that is available for those typologies in which the storage takes place beneath a porous medium or modular surface given that a portion of the water is retained in the media until field capacity is reached woods ballard et al 2015 pitt et al 2008 for each time step s s equations 1 3 obtained from the soil water balance calculations proposed by pitt et al 1999 are applied the following parameters are required to calculate both the soil water content v s and the water available for storage l s initial soil moisture v 0 infiltration rate r saturated hydraulic conductivity g and saturation water content h 1 v s v 0 r s s s 1 2 v s v s 1 r s s s 1 3 l s g s s v s h 2 4 optimization model formulation as a result of the steps described above two subsets containing geographical sites are identified first the offering nodes o i e spaces available for suds to store runoff water and second the demanding nodes d i e green spaces requiring water for irrigation both sets belonging to the set of nodes n the set t stands for the suds typologies the set s represents the time steps considered and the set e gathers the three precipitation scenarios low medium and high the model is formulated under two assumptions i a rainfall event can be split into a wet period and a dry period ii runoff occurs only during the wet period while evapotranspiration and the use of water for irrigation occurs only in the dry period fig 4 depicts the scheme of these flows using detention basins as an example flows for other suds typologies are illustrated in appendix a the parameters of the model i e values that are known before the optimization are defined as follows each demanding node d d demands a given amount of water  d that we attempt to satisfy using the runoff water temporarily stored in the suds which must be transported from node n to node m through a pipe that has a unitary installation cost of  n m per meter or alternatively using potable water from the water utility which has a cost per cubic meter  for the sake of simplicity the distance among nodes  n m is calculated as euclidean distances it is worth mentioning that connections and thus values for  n m and  n m are permitted only under the following circumstances i among offering nodes ii from offering to demanding nodes and iii if the difference in height allows the flow of water by gravity it is worth mentioning that the model can be easily extended to allow flow against gravity by also considering water pumps installation costs however we limit our discussion to the former case suds costs are estimated per unit area for each particular typology  t the area to be installed in each offering node is limited by an upper bound corresponding to the maximum feasible area  o t obtained from the feasibility analysis and a lower bound  o t depending on the nature of the suds typology the storage capacity of each offering node depends on a generic depth for each suds typology  t the potential evapotranspiration and infiltration are  t and  o and depend on the suds typology and the particular geographical site of the offering node respectively the available runoff volume to be harvested  o s e is calculated using the rational method for each offering node time and scenario other parameters are the available budget  the probability of occurrence of each scenario  e and a binary parameter  s that takes the value of 1 if the time step is dry no rainfall and 0 otherwise it is worth emphasizing that some of the parameters described above do not exist for all the combinations given by the subindices for example  o n will only exists for a given o o n n if the flow of water is allowed by gravity nine sets of decision variables are defined for the model let x o t be a binary variable that takes the value of 1 if a suds of typology t t is selected to be installed on offering node o o and 0 otherwise y o t be a continuous variable that represents the area of the typology t t to be installed in offering node o o v o n be a binary variable that takes the value of 1 if the connection between offering node o o and node n n is used and 0 otherwise and q o n s e be the volume sent from offering node o o to node n n at the time s s and scenario e e we use w d s e to denote the volume of potable water from the water utility used in the demanding node d d in the time s s and scenario e e r o s e to represent the runoff volume leaving the offering node o o when the maximum storage capacity is exceeded at the time s s and scenario e e i o s e and z o s e to represent the inventory volume available and the losses by evapotranspiration and infiltration respectively in node o o at time s s and scenario e e finally let u o s e be a binary variable that takes the value of 1 if there is evapotranspiration in node o o time s s and scenario e e and 0 otherwise a complete list of sets variables and parameters is available in appendix b 2 4 1 objective functions we consider three competing objective functions in the proposed model i the amount of potable water that is being consumed ii the runoff that is not captured by the system and iii the cost of deploying the system all of which we attempt to minimize there are several techniques designed to handle the interaction of multiple objectives for mixed integer optimization perhaps the most commonly used method is known as the weighted sum approach ehrgott 2005 which consists in aggregating the multiple objectives into a single objective function by introducing a normalization weight associated to each of the objectives each objective function is multiplied by its corresponding weight and a single objective function is produced by adding all the resulting weighted terms the main goal of the weights is twofold first since it is likely that the objective functions are defined over a different set of units and vary in scale the weights are set so that all the objectives are commensurate second depending on the importance that the stakeholders give to the corresponding objectives the set of weights is also used to account for the relevancy they should carry over the overarching set of decisions to this end a larger weight is thus typically given to the objectives of greater importance unfortunately the weighted sum method has several limitations in particular when the scale difference between objectives is of several orders of magnitude finding the ideal set of weights to properly balance all the objectives is not only challenging but may also drastically affect the results of the optimization process by introducing computational rounding errors furthermore incorporating the relevance of the objective functions along with the scale reduction factors can bring further complications to the task of selecting appropriate weights in this paper we use a lexicographic multi objective approach instead often referred to as the  constraints method ehrgott 2005 waltz 1967 marler and arora 2004 this method assumes in general that the stakeholders can provide a lexicographic order i e a given ranking of the objective functions based on their importance following this predefined order the method optimizes the model sequentially each time with respect to a new objective function in order to guarantee that at each iteration the quality of the solution with respect to the previous objectives is not compromised the method introduces additional constraints that limit the detriment of the previous objectives to be at most a predefined value  we note that as with other multi objective optimization methods including traditional meta heuristic approaches deb et al 2002 the proposed lexicographic method can also be used to identify several optimal non dominated solutions in the form of a pareto frontier for different suds configurations by solving the proposed formulation applying different lexicographic orders and varying the values for  one particular case of interest is when the allowed objective deterioration  is set to zero this allows the optimization model to search for alternative solutions within the optimal solution face of the feasible regions furthermore in the specific context of this paper given the importance of the stakeholders inputs the flexibility of the proposed approach allows for a guided parameterization of different setups runs to be evaluated and tested in addition to the weighted sum and the proposed lexicographic methods there are other alternatives that can be explored to tackle the multi objective nature of the problem ehrgott 2005 marler and arora 2004 we decided to use the lexicographic method because it allows us to incorporate the stakeholders requirements within the decision making process in a more natural way i e it is in general easier for the stakeholders to rank the importance of the objectives rather than providing a numerical preference for the specific case of our ts milp model the three objective functions are optimized in the following order selected by the stakeholders the first objective function equation 4 minimizes potable water consumption which is the sum of the consumption w d s e in each scenario e e demanding node d d and time step s s multiplied by the probability of occurrence  e of scenario e e the second objective function equation 5 minimizes the runoff leaving the offering nodes regardless of whether a suds is installed or not r o s e in each scenario e e offering node o o and time step s s multiplied by the probability of occurrence  e of scenario e e finally the third objective function equation 6 minimizes the costs which includes the cost of the connections  o n v o n from offering node o o to node n n the installation costs of the suds area  t y o t in nodes o o using typologies t t and the cost of the potable water used  w d s e in each scenario e e demanding node d d and time step s s multiplied by the probability of occurrence of each scenario  e 4 min e e d d s s  s 1  e w d s e 5 min e e o o s s  s 0  e r o s e 6 min o o n n  o n  o n v o n o o t t  o t  t y o t e e d d s s  s 1  w d s e  e 2 4 2 constraints we will now discuss the set of constraints that define the solution space of the problem expressions 7 33 along with the three objectives mentioned above define the proposed mathematical formulation 7 t t  o t x o t 1 o o 8 y o t  o t x o t o o t t  o t 9 y o t  o t x o t o o t t  o t 10 o  o t  t  o t  t y o t o  o n  n  o n  o n v o n  constraint set 7 guarantees that only one suds typology can be installed per offering node while the sets of constraints 8 and 9 guarantee that the selected area is within the maximum and minimum allotted areas constraint 10 represents the budget limitation the first term corresponds to the cost of installed suds typologies and the second term is the cost of the installed connections 11 q o n s e m v o n o o n n s s e e  o n 12 v o n t  t  o t x o t o o n n  o n 13 q o n s e i o s e o o n n s s e e  o n 14 n n  o n v o n n o o the sets of constraints 11 to 14 relate the variables q o n s e v o n and x o t first constraint set 11 ensures that the flow q o n s e is zero if variable v o n is zero i e if the connection between nodes o and n is not used here the value of m is essentially an upper bound on the flow given by q o n s e note that if the connection from node o o to n n does not exist then q o n s e does not exist either the set of constraints 12 assures that the connection v o n can exist only if at least one suds typology is installed in node o the set of constraints 13 states that the volume flowing through the connection q o n s e has to be less or equal to the inventory i o s e finally the set of constraints 14 limits the number of connections n that can exist from an offering node o 15 i o 1 e  o 1 e r o 1 e o o e e 16 i o s e i o s 1 e  o s e r o s e o o s s e e  s 0 s 1 17 i o s e i o s 1 e n n q o n s e n n q n o s e z o s e o o s s e e  s 1 the set of constraints 15 to 17 are the inventory constraints the set of constraints 15 is used for the first time step which is defined as a wet period thus the first balance includes the incoming runoff  o 1 e and the runoff leaving the node the runoff that exceed the suds capacity constraint set 16 is used for subsequent wet periods and includes the condition of the inventory in the previous time step constraint set 17 is the inventory for dry periods which besides including the state of the inventory in the previous time step adds the inflows and outflows from other nodes second and third terms on the right hand of the equation and the losses of water by evapotranspiration and infiltration the last term of the equation to properly estimate these losses terms z o s e the model requires to consider their dependency on the typology of suds selected and the inventory of water available during the previous time step at each of the candidate locations in essence the losses due to evapotranspiration and infiltration depend on 1 whether there is a suds installed in the location 2 the evapotranspiration  t and infiltration  o of the suds typology installed and 3 whether the inventory of water collected by the suds has reached the potential evapotranspiration limit over a single time step i e maximum expected evapotranspiration to incorporate these disjunctive requirements into the proposed formulation we model the term z o s e in a similar fashion as the way semi continuous variables are modeled in integer programming see bertsimas and weismantel 2005 guret et al 2002 and nemhauser and wolsey 1988 for further reference 18 i o s e t t  o t y o t  t  o m u o s e o o s s e e 19 i o s e t t  o t y o t  t  o 1 m u o s e m 1 u o s e o o s s e e 20 z o s e m 1 u o s 1 e o o s s e e s 1 21 z o s e t t  o t y o t  t  o o o s s e e s 1 22 z o s e t t  o t y o t  t  o m u o s 1 e o o s s e e s 1 modelling this type of semi continuous variables is typically done by introducing an auxiliary set of binary variables here the u o s e which take the value of one if the inventory of water has reached the potential evapotranspiration level and zero otherwise furthermore auxiliary variables u o s s are later used in constraints 20 to 22 to limit the values that the loss terms can take based on the conditions described above the sets of constraints 18 to 22 are of similar nature to the constraints that are traditionally used to linearize bi linear terms i e multiplications of variables often binary when solving integer programming models bertsimas and weismantel 2005 it is important to notice that despite the fact this approach requires increasing the size of the model by introducing additional sets of variables and constraints it allow us to model the dependencies of the losses on the type of suds selected and the inventory of water stored in the suds 23 i o s e t t  o t  t y o t o o s s e e 24  d w d s e o o q o n s e d d s s e e  s 1 constraint set 23 guarantees that the inventory does not exceed the storage capacity of the installed suds while the set of constraints 24 guarantees that the demand is satisfied by means of both potable water and inflows from offering nodes finally the sets of constraints 25 33 represent the nature of the decision variables 25 x o t 0 1 o o t t  o t 26 y o t 0 o o t t  o t 27 v o n 0 1 o o n n  o n 28 q o n s e 0 o o n n s s e e  o n 29 w d s e 0 d d s s e e  s 1 30 r o s e 0 o o s s e e  s 0 31 i o s e 0 o o s s e e 32 z o s e 0 o o s s e e 33 u o s e 0 1 o o s s e e fig 5 schemes the three steps of the lexicographic multi objective model during step 1 the algorithm solves the optimization problem for the first objective function let z 1 be the corresponding optimal solution then at step 2 the algorithm introduces a new constraint that bounds the detriment of z 1 and solves the optimization problem for the second objective let z 2 be the corresponding optimal solution of step 2 finally in step three the algorithm adds a constraint that bounds the detriment of z 2 and solves the problem for the third objective one of the advantages of this type of formulations is that they can be easily parameterized to incorporate the specific needs of a wide variety of scenarios moreover depending on the scale of the problem instance these can be typically solved without the need of heavily specialized hardware for the optimization process any black box commercial optimizer can be effectively used to obtain optimal solutions 2 5 visualization of results because of the spatial nature of the problem maps are used to communicate results aiming for an understandable format and graphical language the maps illustrate the optimal solution which is defined by the selected offering nodes and the corresponding typology and size the supplied demanding nodes and the connection to the offering nodes that supply the harvested water they are automatically visualized in the gis by uploading csv files output of the optimization model containing the characteristics and coordinates of the optimal solution in arcpy the same format and procedure is used to present a sensitivity analysis to assess trade offs between alternative considerations and or stakeholders preferences mysiak et al 2005 understandable and informative maps are expected to encourage stakeholders to contribute with suggestions at each iteration of the framework while promoting bi directional social learning mostert et al 2008 voinov and bousquet 2010 for example modelers learn how to frame the problem while stakeholders develop insights on causal connections e g the soil impermeabilization and its effect in the runoff volume montalto et al 2013 fig 3 illustrates the iterative process looping on stakeholders suggestions until reaching the final set of site typologies spatial configuration the stop criteria is defined by the question is the proposed result satisfactory if no the stakeholders comments and suggestions are retrofitted to the feasible sites selection the optimization or the results processing for visualization see fig 3 the ability to modify the optimization model is perhaps one of the most valuable aspects of this framework here the stakeholders and modeler communication is crucial to achieve a consensus on when the stop criteria is reached 2 6 case study the proposed methodology was applied to identify an optimal selection of suds as well as their optimal locations in the central campus at universidad de los andes in bogot colombia which comprises a constructed area of 6 ha consisting of 30 facility buildings and consumes around 4800 m3 of potable water each month ninety seven percent of this demand is supplied by the local water utility while the remaining 3 is obtained from reuse of gray water and harvested rainfall irrigation accounts for 13 of the total water which is supplied by the water utility the central campus gardens are irrigated manually using hosepipes sprinklers systems or by drip irrigation and they consume 16 6 m3 per day the distribution of this demand in the study area is illustrated in fig 6 the available information for the case study includes an ortophoto raster layers of infiltration rate and water table depth a buildings vector layer and a dem to consider inter and intra annual variability of the groundwater table depth and infiltration rate at city scale the rasters 50 50 m resolution were obtained by applying kriging interpolation from 3384 points from drilling studies undertaken from 1961 to 2011 jimnez ariza et al 2019 the slope raster was calculated from the 1 m resolution dem while the 3 m resolution orthophoto was obtained from a drone flight undertaken by the campus management office finally the calculation of the distances from the university buildings was attained using the buildings vector layer using the above information see fig 2 feasible areas for suds siting were identified per typology five typologies were used for this study considering the screening matrices provided by ciria in which the case study is classified as commercial land use steep slopes ranging from 0 to 50 with a mean of 13 clay soil type mean infiltration rate 8 5 mm h and limited availability of space see woods ballard et al 2007 woods ballard et al 2015 detention basins retention ponds rain barrels permeable pavements and green roofs topographic and environmental constraints obtained from suds guidelines summarized in table 1 were used and implemented using arcgis 10 4 1 the result of this analysis is a map with the feasible sites which was shared with the campus managers who played the roles of both of decision makers and stakeholders several meetings resulted in a map containing information regarding sites that cannot be modified for suds placement and the inclusion of new areas that were not considered previously fig 7 shows the map resulting from the social cartography and fig 8 illustrates the final feasible sites per suds typology a total of 70 feasible sites were identified 1 site for retention ponds 2 sites for detention basins 7 for permeable pavements 12 for green roofs and 48 for rain barrels which were considered to supply the demand of 45 demanding nodes a 2 m resolution dem was used to delineate the sub catchments in the campus which was corrected using the buildings height historical rainfall records were obtained from a nearby rain gauge station located 400 m away from the campus see fig 6 which contained hourly records for the 2000 2013 period the rain series was separated into individual rainfall events following the methodology proposed by brown et al 1985 and a frequency analysis was performed for the duration of the rainfall event fig 9 shows that 95 of the events have a duration of less than 6 h and that precipitation events with a duration of 2 h are the most frequent followed by durations of 1 and 3 h precipitation events were categorized per duration and each category was classified in three ranges of equal length corresponding to low medium and high intensities eighteen scenarios were constructed using 6 durations and three intensities as shown in fig 10 probabilities of occurrence were calculated using the set of rainfall events ranging from 1 to 6 h so that the sum of probabilities from these 18 scenarios is 1 fig 10 shows that for all durations the low scenario has the highest probability of occurrence and that this probability decreases with the duration of the events see continuous lines in fig 10 on the other hand the total runoff for each scenario in the reference situation the sum of the runoff reaching each feasible point with no suds implemented increases with duration thus scenarios with a high probability of occurrence are those with lower runoff see bars in fig 10 this configuration of scenarios follows the philosophy of designing for the most frequent events instead of for the worst case scenario table 2 summarizes the probability of occurrence duration and intensity range for the 18 scenarios synthetic hydrographs were constructed for each scenario by assuming a constant intensity which corresponds to the upper limit of the range reported in fig 8 the expected value calculated by multiplying the mean of each intensity range see fig 10 times its corresponding probability of occurrence and applying the rational method of the total runoff available for harvesting given these 18 scenarios is 378 m3 the model was implemented in the python language and solved using the commercial optimizer gurobi 7 0 2 gurobi optimization 2017 the experiments were ran in a dell optiplex 7060 equipped with an intel r core i7 3 4 ghz processor 32 gb of ram and running windows 10 the specific parameters found in literature and summarized in tables 3 and 4 were used for this case study the detriment of the objective values in subsequent steps of the lexicographic multi objective model was limited to 5 i e  0 05 the evaporation rate was calculated based on the mean evaporation rate for bogot and the infiltration rate for retention ponds and detention basins was extracted using the coordinates of each feasible site from the infiltration rate raster layer green roofs parameters are set based on reported values for a lightweight gravel sized drainage layer and a composite growing media the budget was set as us 150 000 and only one rainwater harvesting device was allotted per roof also the unitary cost of each meter of connection was set at us 45 considering both the costs of a pvc pipe in bogot and the installation costs in an urbanized area 3 results 3 1 sensitivity analysis of maximum connection length the allotted length of the connections is an important parameter that influences the amount of runoff water used for irrigation since the second objective function of the model is to minimize runoff the model will allocate as much area for locating suds as it is possible to temporarily store runoff water but if the connections that permit the flow among the offering and demanding nodes are limiting the supply of stormwater the demand will be satisfied using potable water for this reason to assess the effect of limiting the connection length into the optimal solution the model was implemented for varying maximum connections length ranging from 5 to 30 m connections longer than 30 m were considered impractical and were not contemplated in this study fig 11 shows the optimal spatial configurations for each of the maximum connection length while fig 12 describes the percentage of reduction of potable water and runoff volumes as well as the percentage of budget used as expected the maximum connection length has an important effect on the resulting optimal configuration the 5 m length shown in fig 11 a can supply only one demanding site around 4 2 of the total water demand in contrast with the 30 m length shown in fig 11 f which supplies 27 demanding sites 60 of the demand for all cases the budget used was 87 90 of the total budget and the expected value of runoff reduction is around 62 regarding these results it is worth mentioning that a suds cannot supply the total demand because demanding sites located in high areas are not connected to any offering node only connections that flow by gravity are allotted and because the demand is assumed constant in time while suds water availability decreases after the precipitation event because of water uptake infiltration and evapotranspiration losses b the budget is not completely consumed even though the runoff reduction does not surpass 50 because we imposed a limit on the maximum suds area available per node restricting the volume that can be stored particularly for the rain barrels which were limited to one rain barrel of 0 4 m3 capacity per roof top and c because the second objective function which minimizes the runoff is being limited by the first objective value minimizing potable water the spatial configuration of the suds are forcing the model to select those nodes closest to demanding areas even if these suds have the lowest storage capacity in order to confirm these findings two analyses were carried out evaluating the sensitivity of the model to different budgets and different number of rain barrels allowed and eliminating the first objective function from the analysis optimizing for runoff reduction and budget only 3 2 sensitivity analysis of the budget and the number of rain barrels in the best case scenario were there are no budget limitations the installation costs of all the feasible suds representas a total of usd 780 000 which was deemed as too high by the stakeholders we then performed a sensitivity analysis for different budget levels to evaluate the overall impact that limiting the installation costs has on the expected benefits obtained by the system to this end we ran the model for different budgets calculated as a percentage of the largest expected cost of usd 780 000 the percentages used were 30 000 4 of the total cost 45 000 6 60 000 8 90 000 11 120 000 15 150 000 19 180 000 23 210 000 27 240 000 30 we performed a second sensitivity analysis with respect to the maximum number of rain barrels that can be installed per rooftop we find this particular analysis of importance because the number of rain barrels limits the total volume of water that can be stored for irrigation and since it was previously found that rain barrels are consistently being selected by the optimization model for its closeness to demanding areas see fig 8 increasing this number is expected to reduce both the potable water consumption and the runoff fig 13 shows the comparison of these reductions for the above mentioned budgets using a maximum connection length of 30 m first of all the results of the model suggest that the difference from allowing 1 to 2 rain barrels resulted in changes in potable water reduction of between 3 and 6 about 0 3 and 0 6 m3 and runoff reduction of between 11 and 12 18 and 21 m3 however the change from allowing 2 to 3 rain barrels resulted in non significant reductions in potable water 0 00005 0 1 and for runoff 0 09 0 2 this result evidences that using two rain barrels per rooftop increases the storage capacity but three rain barrels will result in a system that exceeds the offering volume thus leaving a non utilized storage capacity that provides no benefits additionally each curve has an inflection point of usd 50 000 for the potable water reduction curve and of usd 60 000 for the runoff reduction curve the potable water reduction curve shows no improvement after the inflection point but the runoff reduction curve keeps increasing for higher budgets with slopes that tend to zero for illustration purposes we will use the solution obtained with the 60 000 budget and two rain barrels per rooftop fig 14 illustrates the expected value of both potable water consumption and runoff reduction for the usd 60 000 budget 2 rain barrels allotted per rooftop and maximum length of 30 m solution that is the reduction observed in each scenario multiplied by its probability of occurrence the figure shows i runoff reductions are more sensitive to precipitation scenarios than potable water consumption reductions ii high precipitation and higher duration scenarios have the lowest percentage of runoff reductions while low precipitation and lower duration scenarios which are also the most probable have the highest percentage of reductions and iii potable water consumption reduction remains almost constant for all durations all the above affirmations can be explained by the fact that the runoff available is one order of magnitude higher than the potable water hence the required water for irrigation can be guaranteed by the storage capacity of the suds selected the reduction of potable water is no more than 50 because the model assumes a constant demand while the stored water availability decreases in time accounting for evapotranspiration infiltration losses and drainage rate 3 3 comparison with without potable water fig 15 contrasts the spatial configuration obtained for the usd 60 000 budget when potable water is not considered in the optimization model this is the new lexicographic model has only the two last objective functions table 5 specifies potable water and runoff reduction as well as the number and areas per typology as can be observed when potable water is not considered bigger suds areas are selected for detention basins 49 larger and one permeable pavement typology is selected the number of rain barrels remains the same although the configuration of offering nodes with 1 or 2 rain barrels is variable no clear pattern is identified the increase in the suds areas is the result of not considering connections using the surplus budget in constructing larger structures with bigger storage capacity to reduce more runoff the solution that considers potable water reduces 47 of the runoff while not considering potable water results in a runoff reduction of 61 however if the latter configuration is selected there is a lost opportunity cost of reducing potable water by 50 6 an interesting finding is that the spatial distribution of the two solutions with and without potable water is similar it was expected that when potable water is not considered the model would select other typologies instead of rain barrels which is preferred for rainwater harvesting for its closeness with demanding areas and lack of infiltration and evapotranspiration losses however obtained results show that even with the sole objective of reducing runoff rain barrels are preferred showing that rain barrels are an economic and effective measure to reduce runoff this result has been found in previous studies such as jones and hunt 2010 and seo et al 2012 however other studies that consider water quality have also mentioned that rain barrels may not be cost effective in sites with substantial areas for infiltration practices zhen et al 2006 finally it is worth mentioning that from all the model implementations changing budgets connection length and eliminating the potable water reduction optimal solutions were invariably those that selected all typologies except for green roofs in spite of the fact that green roofs are the second least expensive typology see table 3 three facts are particular about this typology i similarly to rain barrels the catchment area is limited to the roof area so these two typologies receive a lower runoff volume ii green roofs retain a considerable amount of water in the substrate layer e g ferrans et al 2018 hence reducing the amount of water available for use in demanding areas and iii while green roofs reduce runoff through evapotranspiration this magnitude is considerably less than the runoff volume losses from a comparably sized infiltration practice chui et al 2016 3 4 stakeholders comments suggestions the methodology was designed to aid stakeholders and decision makers in the selection and allocation of suds as shown in section 2 the stakeholder engagement is proposed as iterative to guarantee that obtained results are satisfactory in order to receive their feedback on the areas they consider required further improvement a meeting with the stakeholders was scheduled to present the obtained results and gave them space to share their insights two iterations were required to reach a consensus on a satisfactory result refer to fig 3 we implemented their suggestions to refine results accordingly in this section we will describe stakeholders comments suggestions and how this new information was included in the second iteration of the method a topic that was revisited during the meeting was the selection of the suds typologies included in the analyses decision makers acknowledged that retention ponds and detention basins have never been considered in previous campus projects since consulting companies previously hired did not explore other suds typologies besides green roofs and rain barrels campus managers showed special interest in the infiltrating based structures considered novel for the university context stakeholders have perceptions derived from past experiences that influenced the acceptance of proposed results they expressed for example a reluctance to install rain barrels at ground level they insisted on locating these structures in the basement of buildings even if this meant a loss of the hydraulic head and a possible increase of costs due to pumps requirements they claimed that rain barrels have large space requirements are not aesthetic and generate noise derived from the pumping through sand filters and activated carbon water treatments on the other hand although green roofs were not included in the final solution the campus managers mentioned they would have discarded these structures from the beginning of the analysis since they consider they have high maintenance costs and the disadvantage of demanding potable water with added nutrients these insights are of extreme value for the optimized solution to fulfill decision makers expectations regarding the assumptions and constraints used to build the model the stakeholders agreed on considering only connections that flow by gravity since they prefer to avoid the use of pumps additionally they reinforced the 30 m connections maximum length assumption but criticized that feasibility is only determined by the distance between nodes they suggest considering possible obstacles such as reinforced walls pillars and underneath pipes and wiring campus managers also mentioned that in some locations gardens or demanding nodes are not at ground level but on a platform about a meter higher this information modifies the feasibility of some connections but does not affect the equations governing the optimization model comments were also made regarding the plots and information shown in the results images similar to those in fig 11 were shown to explain optimized configurations campus managers interpreted the graphs and qualified the proposed solution as feasible and useful and the budget suggested usd 60 000 as accessible however they mentioned that in order to consider this proposal for future implementation they require more details from the model e g where the outlet is to be located where the pipe is to be buried what the environmental benefits are etc they valued the fact that the model is selecting best locations from among a long list of possibilities but they mentioned the usefulness of ranking few top sites to develop a cost benefit analysis that allows them to choose among these reduced prioritized options suggestions regarding quantifying the water volumes stored per year were made claiming that this data will help them evaluate the project financially finally the authors inquired about the perceived value of the tool and the interest of the campus managers in rainwater harvesting projects decision makers agreed on the usefulness of the exercise for the optimal selection of suds sites they mentioned that some of the outputs will be considered for future projects since the university campus is largely interested in constructing more and better rainwater harvesting strategies the sustainability is a path we are already building our university is evaluating the feasibility of projects that even if not the most financially favorable they provide ludic educative spaces and environmental benefits both potable water savings and runoff reduction are objectives of major importance however they mentioned that for the near future they are focusing their efforts on rainwater harvesting for flushing toilets instead of irrigation purposes since recent studies based within the campus have shown that flushing water volumes are considerable higher 3 5 implementation of stakeholders comments suggestions fig 3 shows the three stages in which stakeholders comments can be addressed in the first place there are changes concerning the feasible sites selection and parameterization i eliminate green roofs as a suds typology option ii modify the distance of connecting nodes to include the pipe required to go around possible obstacles such as reinforced walls iii consider the gardens platform height above the ground level iv increase the cost of rain barrels to account for pumps for water distribution from the basements the second category gathers those comments that require a modification in the optimization model equations examples or these changes are the elimination of one or more objective functions or restricting the length or number of allotted connections these type of modifications were performed for the sensitivity analyses and comparisons presented in subsections 4 2 and 4 3 finally third category includes comments that modify results presentation for example i provide a top 5 ranking sites from which to start the implementations and ii report the stored water volume per year updated results from the second iteration are shown in fig 16 table 6 summarizes the number of suds and the area per typology optimized in the second iteration it is observed that the model prioritizes the reduction of potable water use despite the increase on rain barrels costs accounting for pumps and pipes to round obstacles as a result the budget left for the second objective i e minimize runoff volume is decreased and the infiltration based suds are reduced in area also given that the cost of the pump is the same despite the number of rain barrels installed 1 or 2 the model is systematically replacing 1 rain barrel for 2 to reduce the unitary extra costs see figs 15 and 16 the runoff volumes and the harvested water volume to supply the demand were simulated for the period 2010 2017 using the spatial configuration of the optimal solution fig 17 shows these volumes per year the total annual precipitation and the multi year mean 1720 m 3 for intercepted runoff volume and 1619 m 3 for harvested water volume to supply the demand observe that the runoff volume intercepted white bars is bigger than that used to supply the demand gray bars not all the suds selected are connected to demanding nodes specifically the infiltration based suds are only reducing runoff volume see fig 16 finally table 7 provides a top 5 ranking of the nodes typologies based on a benefit cost ratio b c ratio for i the demand satisfied with harvested rainwater m 3 and ii the runoff volume intercepted m 3 since the two criteria gave as expected different ranking positions we organized the b c ratio following the lexicographic model priorities potable water first and runoff volume second these top 5 nodes are shown in fig 16 a top 20 list of the ranking is available in appendix c observe that the top 20 corresponds to rain barrels typology only evidencing again rain barrels efficiency over infiltration based suds for rainwater collecting for reuse 4 discussion and conclusions this paper developed a methodology that couples gis feasibility analysis with a stochastic multi objective model for the selection of sites and suds typologies with the purpose of reducing i the use of potable water for irrigation ii runoff and iii the installation costs we used an iterative participatory approach to engage stakeholders in the decision making process this method is especially useful when the data is scarce and detailed hydrologic hydraulic models are not available and when a more active participation of the stakeholders is seeked the methodology was tested using a case study involving the central campus at universidad de los andes to supply the demand of 16 6 m3 per day used in the campus gardens we found that the expected runoff of the sites selected and the use of potable water can be reduced by 67 and 50 respectively our results for both potable water and runoff reduction lay in the middle range of the efficiencies reported in literature for a variety of scales e g individual houses multi story residential buildings neighborhoods university campuses and cities e g steffen et al 2013 crowley 2005 ghisi and de oliveira 2007 lpez zavala et al 2016 this along with the wide range of average annual runoff volume reduction 20 100 zhang and hu 2014 gilroy and mccuen 2009 is explained by the diversity of hydrologic patterns and the specific characteristics of the site e g roof lot size ratio soil permeability slope karpiscak et al 1990 the optimization model consistently selected rain barrels over infiltration based typologies in spite that rain barrels efficiencies have proven promising in previous studies domnech and saur 2011 infiltration based typologies have been reported to overpass rain barrels performance in terms of runoff peak and volume reduction abi aad et al 2009 this finding evidences the importance of considering the connections in the optimization model rain barrels are preferred in this case because the rainwater is collected close to the place it is used similarly the effect of the connections between demanding and offering nodes proved decisive when selecting suds siting the location in the watershed e g downstream vs upstream or high vs low imperviousness areas played an essential role in previous studies chang et al 2009 di vittorio and ahiablame 2015 hopkins et al 2017 but this effect was undermined in our study when considered where the harvested water is used as a result we did not find any pattern that favored the suds location besides its closeness to demanding nodes an advantage of using this iterative participatory method is that it allows stakeholders to suggest changes to the model via the modification of parameters constraints and objective functions the proposed framework relies on the use of mixed integer programs as the main optimization engine however we note that the proposed model can be replaced by other mechanisms such as metaheuristics to identify similar solutions that also fit the stakeholders needs a disadvantage of using exact methods such as mixed integer programs is the difficulty of incorporating the complex hydraulic equations to quantify water flows heuristic based methods coupled with urban drainage models are often used to provide a more accurate hydraulic representation however note that this implies loosing some desired properties of exact methods such as the solutions guaranteed optimality and the adaptability to seamlessly adapt the model to incorporate additional features for example a common metaheuristic that is used in this context are the genetic algorithms some of the changes that may be required by the stakeholders may trigger significant modifications to vital components of the metaheuristic such as the phenotype description and the crossover and mutation operators to overcome the lack of precision of other exact methods found in the literature we strengthened the description of the hydrologic dynamics and thus improve the accuracy of the system representation by introducing an additional set of variables and constraints we focused our efforts on better accounting for the inventory of water collected by the suds and their interaction with the evapotranspiration and infiltration losses these considerations improve the model accuracy without compromising its solvability in terms of limitations our methodology may present scalability problems in cases where the number of variables required to model the system becomes too large in such cases it is possible for these exact methods to stall before finding optimal solutions also our approach shares the limitations of all hydrological models a strong dependency on the proper estimation of the parameters as well as the limitations on the considerations of the hydrological interactions occurring at finer temporal and spatial scales e g soil moisture can change in the order of minutes salvadore et al 2015 bach et al 2014 a consideration that aligns with the above mentioned limitation is the granularity of the time discretization on the one hand decreasing the time step length increases the accuracy of the model when considering the temporal variations of the evapotranspiration and infiltration losses for they occur in finer intervals of less than an hour salvadore et al 2015 on the other hand optimizing for a series of events with their corresponding dry periods between rainfalls or even for a long continuous time series could increase the computational effort required to solve the resulting problem due to the number of additional variables and constraints that must be considered furthermore introducing a component that accounts for the antecedent dry period can also improve the accuracy of the suds hydrological performance evaluation since this is a relevant parameter for the stormwater retention in soils and suds substrate berretta et al 2014 an area of improvement for future work is to consider the variability of water demand in time which is likely to present inter and intra day week season fluctuations zhou et al 2002 this may have an effect on the flows from the offering nodes which in turn may also affect the expected runoff and the saving of potable water used for irrigation purposes we note that it is possible to incorporate the stochastic nature of the demand in a similar fashion as the way the rainfall was modeled this however would require a more complex scenario based analysis that can be considered in future efforts declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors would like to thank andrs felipe muoz for designing the social cartography exercises and holding the meetings with the campus management office we would also like to acknowledge the help of engineer daniel rodrguez from bogot s water utility in assigning connections costs for the case study we thank the editor and two anonymous reviewers whose valuable insights improved this manuscript finally we thank the colombian department of science technology and innovation colciencias for funding this work appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2019 104532 appendix a image 1 appendix b table 8 list of sets parameters and variables of the ts milp table 8 sets t set of suds typologies s set of time steps e set of scenarios n set of nodes d set of demanding nodes o set of offering nodes parameters  d water demand in node d d  o s e runoff volume available for storage in node o o scenario e e and time s s  t generic depth of the typology t t  o t maximum area available of offering node o o for typology t t  o t minimum area available of offering node o o for typology t t  cost of a cubic meter of potable water from the water utility  n m cost of the pipe from node n n to node m n  n m euclidean distance from node n n to node m n  budget  t unitary cost of the typology t t  t evapotranspiration per hour from typology t t  o infiltration per hour in node o o  allowed detriment from previous optimal solution  e probability of occurrence of scenario e e  s 1 if the time step is a dry period 0 otherwise variables x o t 1 if the typology t t is selected in offering node o o 0 otherwise y o t area of the typology t t is selected in offering node o o v o n 1 if the connection among offering node o o and node n n exists 0 otherwise q o n s e volume sent from the offering node o o to node n n in the time s s and scenario e e w d s e volume of potable water from water utility used in demanding node d d in the time s s and scenario e e z o s e losses volume evapotranspiration and infiltration from offering node o o in the time s s and scenario e e r o s e runoff volume generated in offering node o o in the time s s and scenario e e i o s e inventory volume available in offering node o o in the time s s and scenario e e u o s e auxiliary variable used in the linearization of evapotranspiration and infiltration losses for offering node o o time s s and scenario e e appendix c table 9 top 20 nodes suds based on b c ratio table 9 node typology satisfied demand m 3 runoff intercepted m 3 satisfied demand based runoff intercepted based b c m 3 usd position b c m 3 usd position 76 2rb 287 3 6156 1 5 1 265 3 4 81 2rb 236 5 5044 1 3 2 217 5 16 91 2rb 192 7 6162 1 0 3 265 6 3 88 2rb 148 9 5744 0 8 4 247 6 12 85 2rb 140 2 5364 0 8 4 231 2 15 73 2rb 131 4 6053 0 7 5 260 9 10 83 2rb 113 9 6104 0 6 6 263 1 7 71 2rb 96 4 5724 0 5 7 246 8 13 115 2rb 96 4 6585 0 5 7 283 9 1 92 2rb 69 2 5711 0 4 8 246 2 14 80 2rb 52 6 6067 0 3 9 261 5 9 70 2rb 42 0 6142 0 2 10 264 8 5 82 2rb 26 3 6175 0 1 11 266 2 2 74 2rb 17 5 6116 0 1 11 263 6 6 114 2rb 823 4 2047 0 1 11 2 5 20 113 2rb 0 6585 5 0 0 11 283 1 1 75 2rb 0 6585 5 0 0 11 283 1 1 79 2rb 0 6585 5 0 0 11 283 1 1 86 2rb 0 6585 5 0 0 11 283 1 1 78 2rb 0 6585 5 0 0 11 283 1 1 
26107,a reliable thermoelectricity supply system requires available cooling water recent electricity supply failures that have occurred all over the world during drought events indicate that the thermoelectricity system is vulnerable however knowledge and policy gaps remain regarding water electricity interactions at the watershed scale in this study a water electricity nexus model is developed to facilitate electricity generation decisions and environmental policy designs involving cooling water consumption and temperature controls this nexus model consists of three modules a physically based hydrologic module a decentralized optimization module and a thermoelectricity generation module which are closely integrated at the daily time step the model is used to quantify tradeoffs between environmental impacts and potential electricity supplies at the power plant and watershed levels a case study is conducted to demonstrate the model application for a watershed wide coordinated water energy policy design under different combinations of environmental regulations and economic penalties during a drought event keywords water electricity nexus thermoelectricity cooling water economic penalties drought 1 introduction the reliability and future expansion of the thermoelectricity supply system are vulnerable to inadequate cooling water availability tidwell et al 2012 zhou et al 2018 cooling of thermal power plants requires a significant amount of water withdrawal and consumption during the electricity generation process meldrum et al 2013 an estimated 13 billion m 3 of fresh water is consumed annually for energy production all over the world spang et al 2014 the united states and china account for the most cooling water use in the us 45 of water withdrawal of which approximately 3 is consumed is used for cooling maupin et al 2010 a percentage that is even higher than water withdrawal used for irrigation the 1 290 thermoelectric power plants in the us withdraw and consume an estimated 488 and 13 million m 3 of cooling water per day respectively diehl and harris 2014 this amount of water can support hundreds of cities the size of new york city each day averyt et al 2011 in china 178 and 13 million m 3 of water are withdrawn and consumed per day for thermoelectricity generation respectively liao et al 2016 zheng et al 2016 zhang et al 2017 and are projected to exceed 767 and 41 million m 3 by 2050 possibly violating the government quotas on water if no technological changes are adopted qin et al 2015 water intensity i e water withdrawal or consumption per unit of electricity generation is spatially heterogeneous because thermal power plants in different areas use various cooling technologies macknick et al 2012 open loop cooling plants have a large water withdrawal intensity but a small water consumption intensity most of the water withdrawn is discharged to water bodies with high thermal pollution potentially elevating the water temperature and causing unintended consequences to the aquatic ecosystem such as reducing the dissolved oxygen and killing aquatic wildlife madden et al 2013 on the other hand closed loop cooling recirculating ponds or towers plants have a much smaller water withdrawal intensity than that of open loop cooling plants but a larger water consumption intensity a plant with a recirculating pond may discharge thermal pollution to a water body if the return flow is not completely cooled before being discharged recirculating tower plants have little impact on the water temperature since most of the cooling water evaporates through the tower rather than being discharged into a water body in general thermoelectricity supply infrastructures substantially alter the local hydrology and need to be well managed mcmanamay et al 2017 environmental regulations involving water withdrawal consumption and temperature constraints are commonly adopted to regulate thermoelectric power plants and limit their impacts on public waters in the us water withdrawal constraints are implemented per section 316 b of the us clean water act us epa 2013 during the planning or construction stages of a plant these constraints require that the water withdrawal does not exceed the allowable amount to minimize the adverse effects e g entrainment and impingement on aquatic species associated with the plant s intake enforced by the national pollution discharge elimination system npdes gaba 2007 under section 316 a of the clean water act water temperature constraints require that the discharge water does not exceed the allowable maximum temperature or maximum temperature change enacted to protect aquatic ecosystems logan and stillwell 2018 state or local regulations ipcb 2018 texas administrative code 2014 are also used to further dictate the discharge water temperature temperature constraints are applied only to those plants that discharge thermal pollution to surface water there are no specific federal policies that regulate cooling water consumption in the us though requests for such policies have been made in recent years eheart 2004 zhang and balay 2014 the absence of water consumption constraints may influence the water supplies used for other purposes during a drought event when a significant amount of water is used for cooling cooling water consumption is assumed to be no larger than 1 of the streamflow gjorgiev and sansavini 2018 which may be underestimated during a drought in recent years many cases of curtailment and shutdown have been reported in europe payet burin et al 2018 povoledo 2003 in the us averyt et al 2011 lydersen 2016 and in other countries wri 2017 luo et al 2018 during droughts because of limited cooling water availability and high water temperatures these circumstances have led to power outages in some regions resulting in chaos bbc 2003 and even increased mortality anderson and bell 2012 as a result thermal variances or relaxed constraints were proposed lubega and stillwell 2018 or granted kopytko and perkins 2011 lydersen 2016 to power plants during droughts and heat waves to maintain the electricity supply however these variances are considered anticompetitive subsidies and are controversial as a way to sustain the electricity supply even during drought events micha 2014 to address these issues some models have been developed sattler et al 2012 miara and vrsmarty 2013 miara et al 2013 jornada and leon 2016 parkinson et al 2016 khan et al 2018 to investigate the water electricity nexus at a regional or national scale in planning for the future sattler et al 2012 integrates the regional energy deployment system reeds with the water evaluation and planning weap model which is used to investigate the impacts of different future electricity profiles on water resources in the southwestern us yates et al 2013 miara and vrsmarty 2013 develops a thermoelectric power thermal pollution model tp2m for a hypothetical watershed to examine the tradeoffs between electricity production and thermal pollution findings show that strict water constraints may reduce some plants electricity generation but may also increase generation efficiency at the watershed scale miara et al 2013 tp2m is applied in miara et al 2018 to analyze the impact of thermal pollution on the electricity supply in the mississippi river watershed a two stage optimization model that minimizes capital costs and water withdrawal in the first stage and maximizes the robustness under future uncertainties in the second stage is built in texas to address electricity expansion and planning problems jornada and leon 2016 parkinson et al 2016 integrates the electricity and freshwater supply systems to ascertain the feasibility of low carbon electricity strategies in saudi arabia under the constraints of a groundwater conservation policy khan et al 2018 develops a coupled water energy optimization model that tracks the entire life cycle of water and energy with linear representations for long term resource security enhancement and to increase resource use efficiencies in these models power plants in a watershed or region with similar fuels and cooling technologies are usually aggregated as one representative plant to simplify the simulation e g sattler et al 2012 as a result spatial distributions of power plants and local streamflow conditions are usually overlooked these models generally consider the long term water resources conditions while neglecting the impacts of a specific drought or low flow episode the models typically provide long term electricity expansion strategies such as the technology and location selections of new power plants for example retrofitting to water efficient cooling technologies tidwell et al 2014 is proposed to enhance the reliability of the future electricity supply regardless of the large capital costs and energy penalties some studies e g khan et al 2018 consider the cost as one of the criteria when evaluating the reliability of the water electricity nexus optimization models for the short term cortinovis et al 2009 sanders et al 2014 sanders 2015 fooladivanda and taylor 2015 gjorgiev and sansavini 2017 2018 lubega and stillwell 2018 have also been developed at a finer spatial scale e g a watershed scale to examine the electricity supply reliability during a drought when both water and electricity demands peak and cooling technologies cannot be immediately retrofitted cortinovis et al 2009 presents a systemic approach to optimize the operation of a wet cooling tower system by minimizing operating costs including cooling water costs sanders et al 2014 uses a unit commitment and dispatch model plexos to estimate how the dispatch and water use of power plants would respond to various levels of water fees in the electric reliability council of texas ercot which is responsible for operating the power grid throughout most of the state fooladivanda and taylor 2015 demonstrates a numerical dispatch model to minimize the total cost of a power system while satisfying the constraints including water use of once through cooling systems gjorgiev and sansavini 2017 develops a smart water management model that integrates the operation of an upstream hydropower plant and a downstream thermal power plant to maximize the gross electricity output and reduce possible power curtailment of the downstream plant with a once through cooling system the model has been applied to investigate the impacts of water constraints on electricity generation gjorgiev and sansavini 2018 lubega and stillwell 2018 develops a linear optimization model to identify how much and to which plants the thermal pollution variances should be granted to maintain the power grid reliability during a specific drought event most of the models investigate the reliability of the open loop or recirculating pond plants which may resort to violating the water temperature constraints for more power generation during a hot summer some thermal variances are proposed gjorgiev and sansavini 2018 lubega and stillwell 2018 to avoid power plant curtailment or temporary shutdown the impact of the cooling water consumption on streamflow is usually neither considered nor underestimated in previous studies this impact is minimal during normal hydrologic conditions or wet seasons but can be serious during a drought event especially in a watershed with many closed loop cooling plants that consume a significant amount of water cooling technologies are shifting from open loop to closed loop which would exert increasing effects on water consumption but decreasing impacts on water withdrawal and temperature the existing models usually oversimplify hydrologic processes and use observed streamflow or results from conceptual hydrologic models to represent the cooling water availability for example gjorgiev and sansavini 2018 use streamflow and water temperature as exogenous inputs but do not explicitly simulate them in the modeling framework lubega and stillwell 2018 use principal components analysis pca to determine streamflow thus the dynamics of streamflow and the impact of upstream cooling water consumption on downstream water availability and power generation cannot be simulated in detail which to some degree limits the applicability of these models to ungagged sites and future scenarios in addition the top down centralized optimization framework commonly used in the existing models assumes full cooperation among the power plants to achieve watershed wide benefits which is usually not true in the real world and would overestimate the potential electricity supply gjorgiev and sansavini 2018 the centralized optimization framework approaches the realistic representation when all plants in a region are operated by the same utility in other cases plants would maximize their own profits rather than fully cooperate with each other to achieve system wide benefits therefore a decentralized optimization framework yang et al 2009 is preferred in this context as in our study this study contributes to water energy nexus research communities by providing a coupled modeling tool pyhspf we water electricity nexus model based on a hydrologic model hydrological simulation program fortran written in python programming language closely combining hydrologic processes streamflow and water temperature thermoelectricity generation and economic incentive determination at the watershed level and at the daily time step first this tool enables a more explicit assessment of the impact of thermal power plant cooling water consumption on daily streamflow which is commonly underrepresented in previous studies e g gjorgiev and sansavini 2018 lubega and stillwell 2018 second solutions that involve both environmental regulations i e via different levels of environmental constraints and economic penalties are explored to deal with the tradeoffs between electricity generation and environment protection third spatially distinguished policies are examined for different thermal power plants thereby producing more realistic solutions that lead to more environmental benefits and electricity generation within a watershed the physically based hydrologic module hydrological simulation program fortran hspf bicknell et al 2005 is used to simulate daily hydrological processes and take into account the impact of cooling water consumption on streamflow and power generation over time the thermoelectricity generation module links cooling water consumption and thermal pollution to the electricity generation of a plant we formulate a decentralized optimization module yang et al 2009 for each power plant to determine how power plants would respond to different hydrologic conditions environmental constraints and economic penalties a case study is conducted for the drought in 2012 knapp et al 2017 in the kaskaskia river watershed in illinois us to demonstrate the model applicability while exploring the tradeoffs between environmental constraints and the electricity supply the potential for using economic penalties to mitigate the environmental effects of electricity generation and the upstream vs downstream effect at the watershed level is also demonstrated this water electricity nexus model can be easily adopted for other watersheds to examine the thermoelectricity supply reliability under environmental regulations and economic penalties serving as a versatile modeling tool to investigate a wide range of policy issues regarding the water electricity nexus 2 methods the flowchart in fig 1 shows the workflow for integrating three modules to create a water electricity nexus model an interface is developed that integrates these three modules on a daily basis at each time step the hspf module assimilates the necessary input data and simulates the hydrologic conditions daily streamflow and water temperature that serve as the input for the other two modules the decentralized optimization module is then used to optimize the power plant s electricity generation to maximize its own profits the electricity generation of each plant that has a specific cooling technology further determines the cooling water consumption which would be input back to hspf to update the initial hydrologic conditions of the next time step these processes iterate over time and space i e from upstream to downstream plants to determine the impact of cooling water consumption on the next time step and downstream hydrologic conditions this nexus modeling framework captures the interactions between hydrology and thermoelectricity generation the following is the detailed description of each module 2 1 the hydrologic module hspf hspf bicknell et al 2005 is a physically based hydrologic model that can simulate the spatially distributed water quantity and quality processes at a watershed scale and at various time steps from 1 min to one year the model has been developed and maintained by the us environmental protection agency epa and the us geological survey usgs since the 1960s in the hspf a watershed is divided into individual hydrologic response units hrus in which the hydrologic responses are assumed homogeneous hspf uses climate forcing land use and hydrography data as inputs and provides hydrologic variables such as streamflow and river water temperature as outputs with the original fortran codes the hspf is time consuming to compile maintain and extend for example the most recent model release does not provide formal makefiles or detailed documentation to compile the source codes here we use a recently developed open source hspf interface called pyhspf lampert and wu 2015 2018 to prepare the input data and run the hspf coded in the python programming language pyhspf offers the advantages of having an open source nature and the flexibility to extend for certain purposes in our study we further extend the pyhspf by 1 adding a new interface to interact with the water temperature simulation module in the hspf and 2 adding a new interface to account for the impact of cooling water consumption on streamflow hspf is calibrated and run at a daily time step using the pyhspf the extended pyhspf is further integrated with the decentralized optimization and thermoelectricity generation modules 2 2 the decentralized optimization module the optimization problem in this study is formulated in a decentralized optimization framework yang et al 2009 to determine how much electricity would be produced by each plant in response to specific streamflow conditions environmental regulations and economic penalties this decentralized optimization can represent a more realistic setting taken from the real world in which the upstream and downstream plants usually do not cooperate with each other to achieve the best system level benefit but instead manage to maximize their individual benefits i e the economic profit in this context this setting indicates that an upstream plant would use as much water and discharge as much thermal pollution as necessary to maximize its profit as long as the environmental constraints are not violated the upstream power plants would not sacrifice their water rights to conserve water for those downstream the result of the decentralized optimization would converge with that of the centralized optimization if the upstream plants are always more water efficient than those downstream when a water shortage occurs during a drought yang et al 2009 the following describes the decentralized optimization formulation used in this study the optimization of each plant is conducted from upstream to downstream at each daily time step to maximize its own objective function f i t 1 max e i t f i t e i t q i t t i t i n where i is the index of the plants t is the time index e i t is the daily electricity generation m w h which is the decision variable and q i t and t i t i n are the streamflow m 3 s and inlet water temperature c respectively the above optimization problem is limited by four constraints for each plant i the first is the physical limitation of the generating unit of the plant 2 e i m i n e i t 24 e i m a x o r e i t 0 where e i m i n and e i m a x are the minimum load m w and maximum capacity m w power plants can operate continuously only above the minimum load and below the maximum capacity otherwise plants will temporarily shut down thereby reducing their electricity output to zero the second constraint is introduced by the cooling water consumption rate constraint and applies to all plants regardless of their cooling technologies 3 w i t w 0  w q i t where w i t is the cooling water consumption rate m 3 s and w 0 is the initial water consumption rate constraint i e 1 gjorgiev and sansavini 2018  w is the constraint relaxation which varies from 0 to 14 at the step of 1 4 in this study used to analyze the tradeoffs between water consumption and the electricity supply a maximum constraint relaxation of 14 allows operating all the plants at full capacity during the studied period the other two constraints are introduced by water temperature regulations which apply to plants with a cooling pond and not to those with recirculating towers 4 t i t o u t t 0  t 5  t i t  t 0  t where t 0 and  t 0 are the initial allowable maximum temperature and temperature rise above the natural water temperature c and  t is the constraint relaxation for thermal pollution varying from 0 to 3 c at the step of 0 3 c in this study a maximum temperature constraint relaxation of 3 c allows operating all the temperature sensitive plants at full capacity during the studied period the average electricity output e i m w by plant i during the summer months can be calculated as 6 e i 1 24 n t t e i t where n t is the length of the study period i e 92 days in the case study the total electricity output m w at the watershed level is the sum of the electricity output by all plants located in the study watershed over time 7 i e i 1 24 n t i t e i t 2 3 the thermoelectricity generation module the following thermoelectricity generation module links the hspf and the optimization modules by defining the objective function and relevant components such as the water consumption requirement and thermal pollution the objective function f is defined as the daily profit of the plant 8 f i t r i t o m i t p w i t p t i t where i is the plant index t is the time index r i t is the revenue for selling electricity to the market o m i t is the operating and maintenance cost including the fuel cost and p w i t and p t i t are the economic penalties for the extra water consumption and water temperature rise the revenue for selling electricity to the market is 9 r i t e i t e p t where e i t is the daily electricity generation m w h and e p t is the electricity price m w h in the market the o m cost is 10 o m i t e i t o p i where o p i is the plant specific o m cost per unit of electricity generation m w h in the following pages we introduce the concepts of economic penalties for plants that violate the initial environmental constraints w 0 t 0 and  t 0 during a drought some policy flexibility and constraints relaxation are usually assumed necessary gjorgiev and sansavini 2018 lubega and stillwell 2018 and are granted by environmental agencies in this study we propose that economic penalties should also be imposed on the plants that relax the constraints since a water pricing strategy has been advocated to have more advantages and social welfare gains compared to those of the policy controls mansur and olmstead 2012 luby et al 2018 in the short run these penalties may result in a greater contribution to the electricity market by water efficient plants and a smaller contribution by water inefficient plants the penalties that the plants pay may be used for environmental recovery after the drought in the long run these penalties may encourage plants to retrofit to more water efficient cooling technologies to avoid economic penalties eventually reducing the impacts on water resources the penalty for extra water consumption p w is calculated as 11 p w i t  w max w i t w 0 q i t 0 2 where w 0 is the initial water consumption constraint which is set as 1 gjorgiev and sansavini 2018 due to the absence of general policies and regulations related to cooling water consumption in the us eheart 2004 zhang and balay 2014 w 0 q i t is the allowable maximum cooling water consumption rate m 3 s if the initial water consumption policy is strictly enforced and when the consumption rate of cooling water does not exceed 1 of the natural streamflow q i t in this context max w i t w 0 q i t 0 is the daily average extra water consumption rate m 3 s  w is the penalty factor m 3 s 2 for violating the water consumption rate constraint and  w max w i t w 0 q i t 0 is the penalty price m 3 s of the extra water consumption which means the plants would have to pay a higher unit price for a higher extra water consumption rate the penalty price equals zero and the plants do not need to pay if water consumption w i t is less than 1 w 0 of q i t when the initial water consumption constraint is not violated the cooling water consumption rate w i t m 3 s is determined by electricity generation and water consumption intensity 12 w i t e i t w i i 3600 24 where w i i is the plant specific cooling water consumption intensity m 3 m w h and 3600 24 is the unit conversion factor similarly the penalty for an extra temperature rise p t is defined as 13 p t i t  t max t i t o u t t 0  t i t  t 0 0 2 where t 0 and  t 0 are the allowable maximum temperature and temperature rise above the natural water temperature in the initial policy context t i t o u t is the water temperature at the ending point of the cooling mixing zone  t i t is the temperature rise caused by thermal pollution which elevates the water temperature from t i t i n to t i t o u t  t and  t max t i t o u t t 0  t i t  t 0 0 are the penalty factor c 2 and penalty price c respectively for violating the initial water temperature constraints the plants would not be penalized if none of the temperature constraints were violated p t i t is applied only to recirculating pond cooling plants in this study since recirculating tower cooling plants discharge minimal thermal pollution to the river the water temperature rise  t i t is calculated following the heat transfer model and energy balance 14  t i t e i t 1  i  i v i  c p 3 6 10 9 where  i is the thermal efficiency of the plant which is assumed constant during the study period gjorgiev and sansavini 2017 2018 lubega and stillwell 2018 although it actually fluctuates with the climatic and hydrologic conditions and the performance of generators v i is the volume of the cooling mixing zone m 3  is the water density k g m 3 c p is the heat capacity of water j k g c 3 6 10 9 is the conversion factor that converts the unit m w h to j the outlet water temperature t i t o u t at the cooling mixing zone is 15 t i t o u t t i t i n  t i t where t i t i n is the inlet river water temperature the decentralized optimization module is formulated in the pyomo hart et al 2017 programming environment and solved with a nonlinear solver ipopt wchter and biegler 2006 which allows high speed computing with good accuracy a closed loop optimization is performed in terms of the feedback between the decisions related to electricity generation the environmental impacts and policy controls one sub optimization process is conducted for each power plant during the study period so the number of sub optimization processes depends on the number of plants in the case study 3 case study and data 3 1 case study description a case study is conducted in the kaskaskia river watershed fig 2 in southern illinois to demonstrate the application of the water electricity nexus model this watershed which hosts four large thermal power plants eia 2016a denoted by p1 p4 suffered from the 2012 drought knapp et al 2017 many communities in this region were forced to limit their water usage erickson 2012 while the power plants consumed a significant amount of cooling water during this period to generate electricity and discharged thermal effluents at high temperatures eia 2016b four 8 digit hucs hydrologic unit codes are contained in this watershed and are divided into 106 hrus hydrologic response units the study period focuses on the drought event in summer 2012 92 days from june 1 to august 31 miara et al 2018 when the electricity demands were at the peak the water temperatures were the highest and the water flows were the lowest power plants p1 and p2 are located upstream and thus their cooling water availabilities are not affected by other plants the nexus model runs at p1 and p2 over time to determine the dynamics of cooling water availability and electricity generation the impact of the current time step cooling water consumption on the next time step cooling water availability is included at each plant after finishing the modeling processes at p1 and p2 the nexus model moves forward to p3 while considering the impact of p1 and p2 and then to p4 while considering the impact of all three upstream plants in this way the impact of the upstream plants cooling water consumption on downstream plants is included since currently there is no specific cooling water consumption constraint applied in this watershed 1 gjorgiev and sansavini 2018 of the natural streamflow at each plant is set as the initial water consumption constraint to limit the impact on water resources required by code 302 211 in title 35 of the illinois administrative code ipcb 2018 the allowable maximum temperature t 0 and temperature rise  t 0 above the natural water temperature at the cooling mixing zone should not exceed 32 c and 2 8 c respectively in the model relaxations  w a n d  t of water consumption constraints and temperature constraints are granted to plants when necessary during a drought to maintain the reliability of the electricity supply but with subsequent economic penalties  w and  t the water electricity nexus model built in the case study is implemented on a pc with an intel r core tm i5 2500 cpu 3 30 ghz each run with a specific combination of parameters takes about 25 minutes 3 2 input data hydrography data in the kaskaskia river watershed e g flowlines catchments elevations slopes and boundaries are extracted from the national hydrography dataset plus version 2 nhdplusv2 mckay et al 2012 land use data are obtained from the cropland data layer cdl nass 2017 streamflow and river water temperature data are downloaded from the usgs national water information system nwis usgs 2018 for model calibration and validation climate forcing data are obtained from various sources station based precipitations are extracted from the hourly precipitation dataset dsi 3240 ncdc 2003 and aggregated for each sub watershed using the inverse distance weighting method daily maximum and minimum temperatures snow depths and snowfalls are extracted from the global historical climatology network ghcn menne et al 2016 daily wind speeds and dew points are extracted from the global surface summary of the day gsod ncdc 2017 solar radiation data are taken from the national solar radiation database nsrdb sengupta et al 2014 daily cloud cover data are necessary for the water temperature simulation module and are extracted from the advanced very high resolution radiometer avhrr remote sensing product patmos x heidinger et al 2014 a summary of the input data for the hspf is shown in table 1 using the input data in table 1 the hspf is run at a daily time step from 1980 to 1995 for streamflow calibration and from 2001 to 2012 for streamflow validation at the gage station usgs 05594100 the simulation between 1995 and 2000 is eliminated because of the inconsistency in precipitation and streamflow observations high streamflows with low precipitations the water temperature simulation module in hspf is calibrated at usgs 05594100 during 1980 1995 and validated at the other 15 usgs stations during the same period this calibration method is applicable since all the sub watersheds share the same calibrated parameters in the water temperature simulation module the detailed calibration and validation results for streamflow and water temperature can be found in appendix a next we focus our study period on the 2012 summer 92 days from june 1 to august 31 the hspf outputs daily streamflow and water temperature data that serve as the input for the thermoelectricity generation and optimization modules the operating and maintenance cost o p i is obtained from the electric power annual table 8 4 eia 2017a p1 uses the natural gas fired combined cycle ngcc and its o p is 35 67 m w h p2 p3 and p4 use conventional steam coal csc and their o p is 37 60 m w h here the o p differences between p2 p3 and p4 are ignored due to the lack of more detailed information the plant specific operating cost is usually confidential and unavailable payet burin et al 2018 average cooling water consumption intensity w i i in summer months is compiled from the us energy information administration eia thermoelectric cooling water data eia 2017b for each plant the minimum load e i m i n and maximum capacity e i m a x of each plant are obtained from form eia 860 eia 2016a thermal efficiency  i of the plant during the summer season is calculated as the average rate of the net electricity output to electric fuel consumption from form eia 923 eia 2016b v i is the volume of the cooling mixing zone of a recirculating pond cooling plant which is obtained from form eia 923 eia 2016b a summary of the characteristic data of the four plants in the kaskaskia river watershed is shown in table 2 the price of electricity during the study period is obtained from the intercontinental exchange ice database ice 2012 during the summer of 2012 in the indiana hub where the kaskaskia river watershed is located 4 results 4 1 electricity supply under varying environmental constraint relaxation levels but no economic penalties the model results allow us to understand how the electricity supplies at both the plant and watershed levels respond to varying environmental constraint relaxation levels during the summer 2012 for the modeling analysis in this section economic penalties  w and  t for water consumption and temperature constraints violation respectively are set as zero which means the plants are granted constraints relaxation with no penalties  t varies from 0 to 3 c at the step of 0 3 and  w varies from 0 to 14 at the step of 1 4 in fig 3 the four plants show different responses to the changes of  w and  t the warmer color in fig 3 represents a larger value at the z axis and the cooler color represents a smaller value this same labeling applies to the figures hereinafter if not specified the electricity supplies by p1 fig 3a and p3 fig 3c increase with  w but are not affected by the increase of  t since they are equipped with recirculating tower cooling technology which is not limited by temperature constraints more water consumption constraint relaxation is needed by p1 14 than p3 10 to reach maximum capacity p2 fig 3b uses cooling pond technology and thus is subject to temperature constraints we assume that p2 is not limited by water consumption constraints since it withdraws water from a nearby reservoir which can provide adequate cooling water the minimum temperature constraint relaxation  t is 1 c for p2 to operate at full capacity p4 fig 3d is significantly subject to both water consumption and temperature constraints when  w is set as zero the increase of  t does not increase the electricity supply at all when  t is set as zero as much as 52 of the capacity can be used when  w is increased to 14 the relaxation of  t is necessary if more than 52 of the capacity is expected by the electricity market the minimum  t and  w are 3 c and 14 respectively for p4 to operate at its full capacity at the watershed level the sensitivities of the total electricity supplies by the four plants are shown in fig 3e the violation and relaxation of the initial water consumption constraint are necessary if a significant increase in the electricity supply is expected a larger increase can also be achieved with the relaxation of water temperature constraints it should be noted that the pattern at the watershed level fig 3e follows p4 fig 3d the reason is that p4 has a large capacity and is constrained by both the water consumption and temperature limitations which is similar to the setting at the watershed level while the other three power plants are constrained by either consumption or temperature limitations 4 2 electricity supply under fixed environmental constraint relaxation levels and varying economic penalties in this section the fixed maximum constraint relaxation levels i e  w 14 and  t 3 c are set for the four plants but with varying economic penalties the penalty factor  w m 3 s 2 for extra water consumption varies from 0 to 10 at the step of 1 and  t c 2 for an extra temperature rise varies from 0 to 2 at the step of 0 2 fig 4 shows the response of electricity supplies to varying economic penalties and the associated cooling water consumption the electricity supplies by p1 fig 4a and p3 fig 4c decrease with an increase of  w but are not affected by  t since they are insensitive to temperature constraints more than half of their capacities will be curtailed with the maximum  w as 10 p2 fig 4b will decrease the electricity supply when  t increases of its capacity 20 will be curtailed if the maximum  t is imposed the electricity supply by p4 fig 4d will experience a quick drop even if a small  w and  t are adopted in some cases p4 would slightly increase its electricity supply when the penalty factor increases for example when  w is fixed as 4 and  t increases from 0 to 0 2 this result is reasonable since p4 is located downstream of the kaskaskia river and can receive more cooling water if upstream plants use less water when a penalty is imposed however when the penalty factor becomes larger p4 would choose to decrease its electricity supply to avoid a penalty and maximize its profits even though there is more available cooling water the total electricity supply fig 4e at the watershed level closely follows the pattern of p4 the second z axis in fig 4 demonstrates the cooling water consumption w the patterns of w exactly follow the patterns of e since w is a linear function of e as shown in equation 12 in section 2 3 in fig 4 generally the downstream plants p3 and p4 fig 4c and fig 4d consume more water than the upstream plants p1 and p2 do fig 4a and fig 4b this is a reasonable location design since power plants with a large capacity and water consumption such as p3 and p4 are usually located downstream where the water is adequate to support electricity production except during a drought comparing w in fig 4c and fig 4d p4 consumes nearly 1 5 times as much as p3 with a same level of electricity production which is caused by the larger cooling water consumption intensity at p4 another aspect of the environmental impacts the rise in water temperature  t by plants p2 and p4 is quantified in fig 5 p1 and p3 do not discharge thermal pollution to water bodies raising the water temperature focusing on the  t axis and fixing  w as zero when the penalty factor on a water temperature rise is larger than 0 4 both p2 and p4 will reduce  t to around the initial allowable maximum level of 2 8 c to avoid economic losses however in fig 4b and fig 4d the electricity generation will continue to slightly decrease with a larger  t this implicates that adopting an  t larger than 0 4 is impractical when making the policy decision since it does not significantly reduce  t but decreases the electricity generation at p4 in fig 5b  t is further reduced to lower than 2 8 c when  w is increased which indicates that a larger economic penalty on the extra water consumption would also help to relieve the environmental impacts of a rising water temperature p2 is not limited by the cooling water constraint  w or the economic penalty  w 4 3 electricity supply under varying environmental constraint relaxation levels and economic penalties following the results from the modeling exercises that have fixed environmental constraint relaxation levels or economic penalties to separate their impacts on electricity supply in this section different combinations of constraint relaxation levels and economic penalties are used to investigate the joint impacts at the watershed level economic penalties are set as five levels in the subfigures of fig 6 as  w increases from 0 to 10 and  t increases from 0 to 2 in each subfigure the increase of  w at the step of 1 4 is represented by the horizontal axis and the increase of  t at the step of 0 2 is represented by scenarios s1 to s11 when no penalties are applied fig 6a the electricity supply increases with  w and  t though at different rates the increase of e is largely driven by  w when  w is smaller than 5 6 and the increase of  t contributes slightly to the increase of e when  w is larger than 8 4 the increase of e is largely driven by  t and the increase of  w contributes just a little different combinations of  w and  t can maintain the same level of electricity supply e g e a e b fig 6a comparing a to b there is less impact on water quantity but more on water temperature to increase the electricity supply from e b to e c or e d we can choose the path from b to d which consumes more water but with the same level of impact on water temperature or the path from b to c which causes a greater water temperature rise but with the same water consumption these tradeoffs between the electricity supply water consumption and river water temperature need to be balanced by watershed agencies during a drought event when larger penalties are imposed from fig 6a to fig 6e profit driven plants would decrease their electricity supplies to avoid paying a penalty comparing fig 6b to fig 6a a small increase of  t would cause a quick decrease of e and reduce the differences among scenarios s1 to s11 which means that the temperature constraints relaxation cannot encourage an increased electricity supply if the penalty factor  t is larger than 0 25 the contribution to e by the increase of  w would significantly decrease if the penalty factor  w is larger than 5 in fig 6e e would not increase with  w when  w is larger than 1 4 since the penalty is high for violating the initial cooling water consumption constraint generally the upstream aquatic environment in a watershed is more fragile and sensitive than the one downstream the water availability is usually smaller upstream and its capability to absorb the hydrologic disturbance is limited in addition upstream water consumption would result in a cumulative impact on the aquatic ecosystem and less water availability for users downstream therefore resource agencies may apply more stringent constraints or penalties at the headwaters than at downstream locations srbc 2012 for this reason we further apply a spatially distinguished penalty or penalty price discrimination stole 2007 by imposing a larger penalty factor on the two upstream plants p1 and p2 and a smaller factor on the two downstream plants p3 and p4 ten levels of penalty price discrimination are applied the penalty factor for extra cooling water consumption under the price discrimination is 16  w i  w 1 p i 1 2  w 1 p i 3 4 the penalty factor for an extra rise in water temperature under the discrimination is 17  t i  t 1 p i 1 2  t 1 p i 3 4 where p is the penalty discrimination level expressed as a percentage varying from 0 to 100 when p 0 all four plants share the same penalty factors  w 5 and  t 1 which are the same as in fig 6d regarded as the baseline penalty scenario a positive p means a larger penalty for upstream plants and a smaller penalty for downstream plants when p 100 the largest penalty is imposed on the upstream plants but there is no penalty for those downstream scenarios s 1 to s 11 represent the different levels of environmental constraint relaxation with  t increasing from 0 c to 2 c at the step of 0 2 c and  w increasing from 0 to 14 at the step of 1 4 as shown in fig 7 the watershed level total electricity supply would significantly increase if the penalty discrimination is applied in this watershed this kind of increase shows in all constraint relaxation scenarios s 1 to s 11 some small decreases are observed when p varies from 90 to 100 in scenarios s 2 to s 5 compared to the baseline penalty scenario as much as 60 more electricity can be supplied if the largest penalty discrimination is applied in scenario s 11 with the maximum constraints relaxation these modeling results reveal the quantitative tradeoffs between the electricity supply and environmental constraints under various management regulations and economic penalties the final decision is left to watershed agencies to decide which and how much constraints relaxation should be granted to each power plant and how much of a penalty should be imposed on constraints violation agencies different preferences may lead to different policies and thus different environmental impacts and electricity supplies for example an aggressive agency that only values the reliability of the thermoelectricity supply system may allow plants to break the initial environmental constraints as much as needed to maintain the maximum electricity supply an agency that chooses to reduce the cooling water consumption and thereby transfer more water supply to other sectors may set a small  w and a large  w an agency that seeks to maintain a suitable water temperature for aquatic life may set a small  t and a large  t the modeling of watershed level decisions is warranted in the future 4 4 sensitivity analysis of electricity supply to the market electricity price the market electricity price e p is a critical exogenous parameter in the water electricity nexus model in the above analysis e p is assumed as a constant during the whole study period which is referred to as the baseline scenario e p 0 however there are great daily variations in e p ranging from 30 to 80 m w h during the 2012 summer ice 2012 to analyze the sensitivity of electricity supply to e p four scenarios are designed in this section the daily e p s during the study period are obtained from the ice database ice 2012 and are linearly interpolated to fill data gaps referred to as the first scenario e p t 1 the electricity price in the baseline scenario is calculated as the average of the daily e p t 1 18 e p 0 e p t 1 in the second scenario e p t 2 the daily e p t 1 are increased by 20 19 e p t 2 e p t 1 1 20 in the third scenario e p t 3 the daily e p t 1 are decreased by 20 20 e p t 3 e p t 1 1 20 in the fourth scenario e p t 4 the daily e p t 1 are increased by 20 if they are larger than the average price and decreased by 20 if smaller 21 e p t 4 e p t 1 1 20 e p t 1 e p t 1 e p t 1 1 20 e p t 1 e p t 1 the water electricity nexus model is run over the four scenarios with all other parameters remaining the same as in section 4 2 the watershed level results are shown in fig 8 comparing fig 8a to fig 4e when the daily variations in the electricity price are considered the potential electricity supply is reduced at most by 50 this implicates more power generation curtailment during the days when the electricity price is lower compared to fig 8a when the daily electricity prices are increased decreased by 20 the potential electricity supply would be dramatically increased decreased in fig 8b fig 8c comparing fig 8d to fig 8a when there are larger daily variations in electricity price the potential electricity supply is slightly decreased the sensitivity analysis demonstrates that power plants are more willing to pay the economic penalties for more electricity generation when the e p is high and stable fig 8a and 8b but are less willing when the e p is low or unstable fig 8c and 8d the nexus modeling results prove to be very sensitive to e p therefore much attention should be paid to determining a proper e p when the nexus model is used in future works modeling the electricity market equilibrium at the grid scale and obtaining an endogenous electricity price would advance the nexus model 5 conclusions and discussion in this study a water electricity nexus model pyhspf we is developed to support both water resources management and electricity supply planning during a drought event the hydrologic module hspf the decentralized optimization module and the thermoelectricity generation module are closely integrated at a daily time step at the watershed scale the nexus model is capable of testing the various environmental regulations and economic penalties and quantifying the tradeoffs among streamflow water temperature and electricity supply at both the power plant and watershed levels findings show that some flexibility in environmental policies i e relaxations of cooling water consumption and temperature constraints would generally allow improvement in the reliability of the thermoelectricity supply system during a drought applying economic penalties can regulate the contributions of the individual power plants with different environmental impacts the different responses of the power plants to various environmental policies including environmental constraints relaxation and economic penalties on constraints violation can be attributed to the different hydrologic conditions that exist at the plants locations and their thermoelectric characteristics such as primary fuels and cooling technologies these general findings can be extended to other watersheds or drought events even though the magnitude of the tradeoffs and the effects of environmental regulations and economic penalties may depend on the specific situation of the case study a case study is conducted in the kaskaskia river watershed the results show that the minimum required relaxations of cooling water consumption and temperature constraints are 14 and 3 c respectively if the power plants are expected to operate at their full capacities during the 2012 drought at the watershed level a spatially distinguished penalty policy i e a larger penalty factor for upstream plants and a smaller one for downstream plants is found to improve the total electricity supply by as much as 60 compared to the baseline penalty scenario these results indicate that plant specific policies have more advantages than uniform policies although more efforts will be required for the watershed agencies to put these policies into practice the water electricity nexus model developed in this study may be used for a wide range of applications including planning and assessment and operational use our analyses in this study primarily focus on the planning and assessment of the tradeoffs between electricity supplies and environmental impacts during a drought event for operational use with real time hydrologic information unknown weather forecast information can be used as the climatic inputs to the hspf module to predict the future streamflow and water temperature one of the advantages of our nexus model is that it directly uses climatic inputs and thus no streamflow inputs are required due to integration of the hydrologic model we admit that the current nexus model would introduce uncertainties to hydrologic forecasts under an operational setting how to incorporate the hydrologic uncertainties into water resources management is a typical issue investigated in many previous studies e g cai and rosegrant 2004 since the hydrologic uncertainties would increase with the lead time in practice we may suggest running the nexus model for a short period e g a week rather than 3 months as in the current case study and then running the model for the next period with an updated weather forecast the data assimilation technique vrugt et al 2005 liu and gupta 2007 may be used to update the initial conditions of the next period with observed hydrologic data in the past period the stochastic optimization technique salazar et al 2013 guerra et al 2019 may also be used to consider the different hydrologic scenarios and provide the expected outcomes the exact duration and extent of a drought event cannot be known before it ends under the operational setting based on the nexus model however environmental agencies can still be supported in obtaining useful hydrologic forecast information on the drought and setting predicted values for constraints relaxation and economic penalties a limitation of the proposed nexus model is that the electricity price is set as an exogenous variable though a sensitivity analysis is conducted to demonstrate the responses of power plants to different price scenarios we also assume that paying economic penalties for extra water consumption and a rise in the water temperature would not affect bidding offers of the power plants and the electricity price at the grid scale this study focuses on the thermal power plants within a watershed with a relatively small number of plants and total generation capacity from an economic point of view in a market with many competitive sellers the power sellers within such a watershed which is much smaller than the region with a power grid is usually not powerful enough to affect the market equilibrium price if the model is applied to a much larger spatial scale all these factors must be taken into account some future works may improve this newly developed water electricity nexus model for more policy implications for example if the predictive daily or even hourly electricity demands and prices in the coming months are available the dynamics of the electricity market and the response of each power plant can be represented with more details this would require the incorporation of a system level electricity market model that allows us to investigate the impacts of paying economic penalties on the bidding offers and finally the market electricity price by simulating the electricity demand supply and the equilibrium price in a consistent framework the inclusion of a unit commitment and dispatch model fooladivanda and taylor 2015 has the potential to simulate the changes in electricity generation associated with electricity price and test the assumption of the exogenous price in the current case study a more detailed thermoelectricity generation model at the power plant level would also help simulate the dynamic status of the generating units zhai et al 2011 for example dynamic cooling water consumption intensities and operating costs at each time step can be determined considering the ambient hydrologic conditions such as cooling water availability and river water temperature the current nexus model focuses on the daily average analysis mainly limited by the availability of hydrologic information the nexus model can be enhanced to capture the sub daily dynamics of the power generation and the associated environmental impacts if sub daily hydrologic conditions e g hourly streamflow and river water temperature can be simulated by climatic inputs with a finer temporal resolution or estimated by some assumptions on the sub daily variations of streamflow acknowledgment this work was supported by national natural science foundation of china 41730645 41425002 and 41790424 china scholarship council and the international partnership program of chinese academy of sciences 131a11kysb20170113 the authors declare no conflict of interest we are grateful to lisa sheppard for her editorial review appendix a hspf calibration and validation results the hspf model calibration and validation results are presented here the nash sutcliffe efficiency coefficient ns 1 nash and sutcliffe 1970 is used to evaluate the model performance a higher ns means a better model performance streamflow is calibrated during 1980 1995 and validated during 2001 2012 at the gage station usgs 05594100 fig a1 shows the results of simulated daily streamflow for calibration fig a1a and validation fig a1b the ns coefficients are 0 721 and 0 635 respectively which are adequate for capturing the streamflow variations in the watershed however a good calibration of the model at that station does not necessarily guarantee the model accuracy in other sections of the basin fig a2 shows the results of simulated daily water temperatures observed data for water temperatures t are not as adequate as those for streamflow only a small amount of observation records are available for the kaskaskia river watershed usgs 2018 especially after the year 2000 for this reason we calibrate fig a2a the hspf water temperature module with observed data from the gage station usgs 05594100 during 1980 1995 while validating fig a2b for the same period with observed data from the 15 other usgs stations this validation strategy is like one round cross validation hspf shows a good performance for simulating daily water temperature with ns as 0 917 and 0 882 for calibration and validation respectively fig a1 evaluation of hspf simulated daily streamflow q m 3 s a calibration and b validation at the gage station usgs 05594100 fig a1 fig a2 evaluation of hspf simulated daily river water temperature t c a calibration at the gage station usgs 05594100 and b validation at the other 15 usgs stations both during 1980 1995 fig a2 
26107,a reliable thermoelectricity supply system requires available cooling water recent electricity supply failures that have occurred all over the world during drought events indicate that the thermoelectricity system is vulnerable however knowledge and policy gaps remain regarding water electricity interactions at the watershed scale in this study a water electricity nexus model is developed to facilitate electricity generation decisions and environmental policy designs involving cooling water consumption and temperature controls this nexus model consists of three modules a physically based hydrologic module a decentralized optimization module and a thermoelectricity generation module which are closely integrated at the daily time step the model is used to quantify tradeoffs between environmental impacts and potential electricity supplies at the power plant and watershed levels a case study is conducted to demonstrate the model application for a watershed wide coordinated water energy policy design under different combinations of environmental regulations and economic penalties during a drought event keywords water electricity nexus thermoelectricity cooling water economic penalties drought 1 introduction the reliability and future expansion of the thermoelectricity supply system are vulnerable to inadequate cooling water availability tidwell et al 2012 zhou et al 2018 cooling of thermal power plants requires a significant amount of water withdrawal and consumption during the electricity generation process meldrum et al 2013 an estimated 13 billion m 3 of fresh water is consumed annually for energy production all over the world spang et al 2014 the united states and china account for the most cooling water use in the us 45 of water withdrawal of which approximately 3 is consumed is used for cooling maupin et al 2010 a percentage that is even higher than water withdrawal used for irrigation the 1 290 thermoelectric power plants in the us withdraw and consume an estimated 488 and 13 million m 3 of cooling water per day respectively diehl and harris 2014 this amount of water can support hundreds of cities the size of new york city each day averyt et al 2011 in china 178 and 13 million m 3 of water are withdrawn and consumed per day for thermoelectricity generation respectively liao et al 2016 zheng et al 2016 zhang et al 2017 and are projected to exceed 767 and 41 million m 3 by 2050 possibly violating the government quotas on water if no technological changes are adopted qin et al 2015 water intensity i e water withdrawal or consumption per unit of electricity generation is spatially heterogeneous because thermal power plants in different areas use various cooling technologies macknick et al 2012 open loop cooling plants have a large water withdrawal intensity but a small water consumption intensity most of the water withdrawn is discharged to water bodies with high thermal pollution potentially elevating the water temperature and causing unintended consequences to the aquatic ecosystem such as reducing the dissolved oxygen and killing aquatic wildlife madden et al 2013 on the other hand closed loop cooling recirculating ponds or towers plants have a much smaller water withdrawal intensity than that of open loop cooling plants but a larger water consumption intensity a plant with a recirculating pond may discharge thermal pollution to a water body if the return flow is not completely cooled before being discharged recirculating tower plants have little impact on the water temperature since most of the cooling water evaporates through the tower rather than being discharged into a water body in general thermoelectricity supply infrastructures substantially alter the local hydrology and need to be well managed mcmanamay et al 2017 environmental regulations involving water withdrawal consumption and temperature constraints are commonly adopted to regulate thermoelectric power plants and limit their impacts on public waters in the us water withdrawal constraints are implemented per section 316 b of the us clean water act us epa 2013 during the planning or construction stages of a plant these constraints require that the water withdrawal does not exceed the allowable amount to minimize the adverse effects e g entrainment and impingement on aquatic species associated with the plant s intake enforced by the national pollution discharge elimination system npdes gaba 2007 under section 316 a of the clean water act water temperature constraints require that the discharge water does not exceed the allowable maximum temperature or maximum temperature change enacted to protect aquatic ecosystems logan and stillwell 2018 state or local regulations ipcb 2018 texas administrative code 2014 are also used to further dictate the discharge water temperature temperature constraints are applied only to those plants that discharge thermal pollution to surface water there are no specific federal policies that regulate cooling water consumption in the us though requests for such policies have been made in recent years eheart 2004 zhang and balay 2014 the absence of water consumption constraints may influence the water supplies used for other purposes during a drought event when a significant amount of water is used for cooling cooling water consumption is assumed to be no larger than 1 of the streamflow gjorgiev and sansavini 2018 which may be underestimated during a drought in recent years many cases of curtailment and shutdown have been reported in europe payet burin et al 2018 povoledo 2003 in the us averyt et al 2011 lydersen 2016 and in other countries wri 2017 luo et al 2018 during droughts because of limited cooling water availability and high water temperatures these circumstances have led to power outages in some regions resulting in chaos bbc 2003 and even increased mortality anderson and bell 2012 as a result thermal variances or relaxed constraints were proposed lubega and stillwell 2018 or granted kopytko and perkins 2011 lydersen 2016 to power plants during droughts and heat waves to maintain the electricity supply however these variances are considered anticompetitive subsidies and are controversial as a way to sustain the electricity supply even during drought events micha 2014 to address these issues some models have been developed sattler et al 2012 miara and vrsmarty 2013 miara et al 2013 jornada and leon 2016 parkinson et al 2016 khan et al 2018 to investigate the water electricity nexus at a regional or national scale in planning for the future sattler et al 2012 integrates the regional energy deployment system reeds with the water evaluation and planning weap model which is used to investigate the impacts of different future electricity profiles on water resources in the southwestern us yates et al 2013 miara and vrsmarty 2013 develops a thermoelectric power thermal pollution model tp2m for a hypothetical watershed to examine the tradeoffs between electricity production and thermal pollution findings show that strict water constraints may reduce some plants electricity generation but may also increase generation efficiency at the watershed scale miara et al 2013 tp2m is applied in miara et al 2018 to analyze the impact of thermal pollution on the electricity supply in the mississippi river watershed a two stage optimization model that minimizes capital costs and water withdrawal in the first stage and maximizes the robustness under future uncertainties in the second stage is built in texas to address electricity expansion and planning problems jornada and leon 2016 parkinson et al 2016 integrates the electricity and freshwater supply systems to ascertain the feasibility of low carbon electricity strategies in saudi arabia under the constraints of a groundwater conservation policy khan et al 2018 develops a coupled water energy optimization model that tracks the entire life cycle of water and energy with linear representations for long term resource security enhancement and to increase resource use efficiencies in these models power plants in a watershed or region with similar fuels and cooling technologies are usually aggregated as one representative plant to simplify the simulation e g sattler et al 2012 as a result spatial distributions of power plants and local streamflow conditions are usually overlooked these models generally consider the long term water resources conditions while neglecting the impacts of a specific drought or low flow episode the models typically provide long term electricity expansion strategies such as the technology and location selections of new power plants for example retrofitting to water efficient cooling technologies tidwell et al 2014 is proposed to enhance the reliability of the future electricity supply regardless of the large capital costs and energy penalties some studies e g khan et al 2018 consider the cost as one of the criteria when evaluating the reliability of the water electricity nexus optimization models for the short term cortinovis et al 2009 sanders et al 2014 sanders 2015 fooladivanda and taylor 2015 gjorgiev and sansavini 2017 2018 lubega and stillwell 2018 have also been developed at a finer spatial scale e g a watershed scale to examine the electricity supply reliability during a drought when both water and electricity demands peak and cooling technologies cannot be immediately retrofitted cortinovis et al 2009 presents a systemic approach to optimize the operation of a wet cooling tower system by minimizing operating costs including cooling water costs sanders et al 2014 uses a unit commitment and dispatch model plexos to estimate how the dispatch and water use of power plants would respond to various levels of water fees in the electric reliability council of texas ercot which is responsible for operating the power grid throughout most of the state fooladivanda and taylor 2015 demonstrates a numerical dispatch model to minimize the total cost of a power system while satisfying the constraints including water use of once through cooling systems gjorgiev and sansavini 2017 develops a smart water management model that integrates the operation of an upstream hydropower plant and a downstream thermal power plant to maximize the gross electricity output and reduce possible power curtailment of the downstream plant with a once through cooling system the model has been applied to investigate the impacts of water constraints on electricity generation gjorgiev and sansavini 2018 lubega and stillwell 2018 develops a linear optimization model to identify how much and to which plants the thermal pollution variances should be granted to maintain the power grid reliability during a specific drought event most of the models investigate the reliability of the open loop or recirculating pond plants which may resort to violating the water temperature constraints for more power generation during a hot summer some thermal variances are proposed gjorgiev and sansavini 2018 lubega and stillwell 2018 to avoid power plant curtailment or temporary shutdown the impact of the cooling water consumption on streamflow is usually neither considered nor underestimated in previous studies this impact is minimal during normal hydrologic conditions or wet seasons but can be serious during a drought event especially in a watershed with many closed loop cooling plants that consume a significant amount of water cooling technologies are shifting from open loop to closed loop which would exert increasing effects on water consumption but decreasing impacts on water withdrawal and temperature the existing models usually oversimplify hydrologic processes and use observed streamflow or results from conceptual hydrologic models to represent the cooling water availability for example gjorgiev and sansavini 2018 use streamflow and water temperature as exogenous inputs but do not explicitly simulate them in the modeling framework lubega and stillwell 2018 use principal components analysis pca to determine streamflow thus the dynamics of streamflow and the impact of upstream cooling water consumption on downstream water availability and power generation cannot be simulated in detail which to some degree limits the applicability of these models to ungagged sites and future scenarios in addition the top down centralized optimization framework commonly used in the existing models assumes full cooperation among the power plants to achieve watershed wide benefits which is usually not true in the real world and would overestimate the potential electricity supply gjorgiev and sansavini 2018 the centralized optimization framework approaches the realistic representation when all plants in a region are operated by the same utility in other cases plants would maximize their own profits rather than fully cooperate with each other to achieve system wide benefits therefore a decentralized optimization framework yang et al 2009 is preferred in this context as in our study this study contributes to water energy nexus research communities by providing a coupled modeling tool pyhspf we water electricity nexus model based on a hydrologic model hydrological simulation program fortran written in python programming language closely combining hydrologic processes streamflow and water temperature thermoelectricity generation and economic incentive determination at the watershed level and at the daily time step first this tool enables a more explicit assessment of the impact of thermal power plant cooling water consumption on daily streamflow which is commonly underrepresented in previous studies e g gjorgiev and sansavini 2018 lubega and stillwell 2018 second solutions that involve both environmental regulations i e via different levels of environmental constraints and economic penalties are explored to deal with the tradeoffs between electricity generation and environment protection third spatially distinguished policies are examined for different thermal power plants thereby producing more realistic solutions that lead to more environmental benefits and electricity generation within a watershed the physically based hydrologic module hydrological simulation program fortran hspf bicknell et al 2005 is used to simulate daily hydrological processes and take into account the impact of cooling water consumption on streamflow and power generation over time the thermoelectricity generation module links cooling water consumption and thermal pollution to the electricity generation of a plant we formulate a decentralized optimization module yang et al 2009 for each power plant to determine how power plants would respond to different hydrologic conditions environmental constraints and economic penalties a case study is conducted for the drought in 2012 knapp et al 2017 in the kaskaskia river watershed in illinois us to demonstrate the model applicability while exploring the tradeoffs between environmental constraints and the electricity supply the potential for using economic penalties to mitigate the environmental effects of electricity generation and the upstream vs downstream effect at the watershed level is also demonstrated this water electricity nexus model can be easily adopted for other watersheds to examine the thermoelectricity supply reliability under environmental regulations and economic penalties serving as a versatile modeling tool to investigate a wide range of policy issues regarding the water electricity nexus 2 methods the flowchart in fig 1 shows the workflow for integrating three modules to create a water electricity nexus model an interface is developed that integrates these three modules on a daily basis at each time step the hspf module assimilates the necessary input data and simulates the hydrologic conditions daily streamflow and water temperature that serve as the input for the other two modules the decentralized optimization module is then used to optimize the power plant s electricity generation to maximize its own profits the electricity generation of each plant that has a specific cooling technology further determines the cooling water consumption which would be input back to hspf to update the initial hydrologic conditions of the next time step these processes iterate over time and space i e from upstream to downstream plants to determine the impact of cooling water consumption on the next time step and downstream hydrologic conditions this nexus modeling framework captures the interactions between hydrology and thermoelectricity generation the following is the detailed description of each module 2 1 the hydrologic module hspf hspf bicknell et al 2005 is a physically based hydrologic model that can simulate the spatially distributed water quantity and quality processes at a watershed scale and at various time steps from 1 min to one year the model has been developed and maintained by the us environmental protection agency epa and the us geological survey usgs since the 1960s in the hspf a watershed is divided into individual hydrologic response units hrus in which the hydrologic responses are assumed homogeneous hspf uses climate forcing land use and hydrography data as inputs and provides hydrologic variables such as streamflow and river water temperature as outputs with the original fortran codes the hspf is time consuming to compile maintain and extend for example the most recent model release does not provide formal makefiles or detailed documentation to compile the source codes here we use a recently developed open source hspf interface called pyhspf lampert and wu 2015 2018 to prepare the input data and run the hspf coded in the python programming language pyhspf offers the advantages of having an open source nature and the flexibility to extend for certain purposes in our study we further extend the pyhspf by 1 adding a new interface to interact with the water temperature simulation module in the hspf and 2 adding a new interface to account for the impact of cooling water consumption on streamflow hspf is calibrated and run at a daily time step using the pyhspf the extended pyhspf is further integrated with the decentralized optimization and thermoelectricity generation modules 2 2 the decentralized optimization module the optimization problem in this study is formulated in a decentralized optimization framework yang et al 2009 to determine how much electricity would be produced by each plant in response to specific streamflow conditions environmental regulations and economic penalties this decentralized optimization can represent a more realistic setting taken from the real world in which the upstream and downstream plants usually do not cooperate with each other to achieve the best system level benefit but instead manage to maximize their individual benefits i e the economic profit in this context this setting indicates that an upstream plant would use as much water and discharge as much thermal pollution as necessary to maximize its profit as long as the environmental constraints are not violated the upstream power plants would not sacrifice their water rights to conserve water for those downstream the result of the decentralized optimization would converge with that of the centralized optimization if the upstream plants are always more water efficient than those downstream when a water shortage occurs during a drought yang et al 2009 the following describes the decentralized optimization formulation used in this study the optimization of each plant is conducted from upstream to downstream at each daily time step to maximize its own objective function f i t 1 max e i t f i t e i t q i t t i t i n where i is the index of the plants t is the time index e i t is the daily electricity generation m w h which is the decision variable and q i t and t i t i n are the streamflow m 3 s and inlet water temperature c respectively the above optimization problem is limited by four constraints for each plant i the first is the physical limitation of the generating unit of the plant 2 e i m i n e i t 24 e i m a x o r e i t 0 where e i m i n and e i m a x are the minimum load m w and maximum capacity m w power plants can operate continuously only above the minimum load and below the maximum capacity otherwise plants will temporarily shut down thereby reducing their electricity output to zero the second constraint is introduced by the cooling water consumption rate constraint and applies to all plants regardless of their cooling technologies 3 w i t w 0  w q i t where w i t is the cooling water consumption rate m 3 s and w 0 is the initial water consumption rate constraint i e 1 gjorgiev and sansavini 2018  w is the constraint relaxation which varies from 0 to 14 at the step of 1 4 in this study used to analyze the tradeoffs between water consumption and the electricity supply a maximum constraint relaxation of 14 allows operating all the plants at full capacity during the studied period the other two constraints are introduced by water temperature regulations which apply to plants with a cooling pond and not to those with recirculating towers 4 t i t o u t t 0  t 5  t i t  t 0  t where t 0 and  t 0 are the initial allowable maximum temperature and temperature rise above the natural water temperature c and  t is the constraint relaxation for thermal pollution varying from 0 to 3 c at the step of 0 3 c in this study a maximum temperature constraint relaxation of 3 c allows operating all the temperature sensitive plants at full capacity during the studied period the average electricity output e i m w by plant i during the summer months can be calculated as 6 e i 1 24 n t t e i t where n t is the length of the study period i e 92 days in the case study the total electricity output m w at the watershed level is the sum of the electricity output by all plants located in the study watershed over time 7 i e i 1 24 n t i t e i t 2 3 the thermoelectricity generation module the following thermoelectricity generation module links the hspf and the optimization modules by defining the objective function and relevant components such as the water consumption requirement and thermal pollution the objective function f is defined as the daily profit of the plant 8 f i t r i t o m i t p w i t p t i t where i is the plant index t is the time index r i t is the revenue for selling electricity to the market o m i t is the operating and maintenance cost including the fuel cost and p w i t and p t i t are the economic penalties for the extra water consumption and water temperature rise the revenue for selling electricity to the market is 9 r i t e i t e p t where e i t is the daily electricity generation m w h and e p t is the electricity price m w h in the market the o m cost is 10 o m i t e i t o p i where o p i is the plant specific o m cost per unit of electricity generation m w h in the following pages we introduce the concepts of economic penalties for plants that violate the initial environmental constraints w 0 t 0 and  t 0 during a drought some policy flexibility and constraints relaxation are usually assumed necessary gjorgiev and sansavini 2018 lubega and stillwell 2018 and are granted by environmental agencies in this study we propose that economic penalties should also be imposed on the plants that relax the constraints since a water pricing strategy has been advocated to have more advantages and social welfare gains compared to those of the policy controls mansur and olmstead 2012 luby et al 2018 in the short run these penalties may result in a greater contribution to the electricity market by water efficient plants and a smaller contribution by water inefficient plants the penalties that the plants pay may be used for environmental recovery after the drought in the long run these penalties may encourage plants to retrofit to more water efficient cooling technologies to avoid economic penalties eventually reducing the impacts on water resources the penalty for extra water consumption p w is calculated as 11 p w i t  w max w i t w 0 q i t 0 2 where w 0 is the initial water consumption constraint which is set as 1 gjorgiev and sansavini 2018 due to the absence of general policies and regulations related to cooling water consumption in the us eheart 2004 zhang and balay 2014 w 0 q i t is the allowable maximum cooling water consumption rate m 3 s if the initial water consumption policy is strictly enforced and when the consumption rate of cooling water does not exceed 1 of the natural streamflow q i t in this context max w i t w 0 q i t 0 is the daily average extra water consumption rate m 3 s  w is the penalty factor m 3 s 2 for violating the water consumption rate constraint and  w max w i t w 0 q i t 0 is the penalty price m 3 s of the extra water consumption which means the plants would have to pay a higher unit price for a higher extra water consumption rate the penalty price equals zero and the plants do not need to pay if water consumption w i t is less than 1 w 0 of q i t when the initial water consumption constraint is not violated the cooling water consumption rate w i t m 3 s is determined by electricity generation and water consumption intensity 12 w i t e i t w i i 3600 24 where w i i is the plant specific cooling water consumption intensity m 3 m w h and 3600 24 is the unit conversion factor similarly the penalty for an extra temperature rise p t is defined as 13 p t i t  t max t i t o u t t 0  t i t  t 0 0 2 where t 0 and  t 0 are the allowable maximum temperature and temperature rise above the natural water temperature in the initial policy context t i t o u t is the water temperature at the ending point of the cooling mixing zone  t i t is the temperature rise caused by thermal pollution which elevates the water temperature from t i t i n to t i t o u t  t and  t max t i t o u t t 0  t i t  t 0 0 are the penalty factor c 2 and penalty price c respectively for violating the initial water temperature constraints the plants would not be penalized if none of the temperature constraints were violated p t i t is applied only to recirculating pond cooling plants in this study since recirculating tower cooling plants discharge minimal thermal pollution to the river the water temperature rise  t i t is calculated following the heat transfer model and energy balance 14  t i t e i t 1  i  i v i  c p 3 6 10 9 where  i is the thermal efficiency of the plant which is assumed constant during the study period gjorgiev and sansavini 2017 2018 lubega and stillwell 2018 although it actually fluctuates with the climatic and hydrologic conditions and the performance of generators v i is the volume of the cooling mixing zone m 3  is the water density k g m 3 c p is the heat capacity of water j k g c 3 6 10 9 is the conversion factor that converts the unit m w h to j the outlet water temperature t i t o u t at the cooling mixing zone is 15 t i t o u t t i t i n  t i t where t i t i n is the inlet river water temperature the decentralized optimization module is formulated in the pyomo hart et al 2017 programming environment and solved with a nonlinear solver ipopt wchter and biegler 2006 which allows high speed computing with good accuracy a closed loop optimization is performed in terms of the feedback between the decisions related to electricity generation the environmental impacts and policy controls one sub optimization process is conducted for each power plant during the study period so the number of sub optimization processes depends on the number of plants in the case study 3 case study and data 3 1 case study description a case study is conducted in the kaskaskia river watershed fig 2 in southern illinois to demonstrate the application of the water electricity nexus model this watershed which hosts four large thermal power plants eia 2016a denoted by p1 p4 suffered from the 2012 drought knapp et al 2017 many communities in this region were forced to limit their water usage erickson 2012 while the power plants consumed a significant amount of cooling water during this period to generate electricity and discharged thermal effluents at high temperatures eia 2016b four 8 digit hucs hydrologic unit codes are contained in this watershed and are divided into 106 hrus hydrologic response units the study period focuses on the drought event in summer 2012 92 days from june 1 to august 31 miara et al 2018 when the electricity demands were at the peak the water temperatures were the highest and the water flows were the lowest power plants p1 and p2 are located upstream and thus their cooling water availabilities are not affected by other plants the nexus model runs at p1 and p2 over time to determine the dynamics of cooling water availability and electricity generation the impact of the current time step cooling water consumption on the next time step cooling water availability is included at each plant after finishing the modeling processes at p1 and p2 the nexus model moves forward to p3 while considering the impact of p1 and p2 and then to p4 while considering the impact of all three upstream plants in this way the impact of the upstream plants cooling water consumption on downstream plants is included since currently there is no specific cooling water consumption constraint applied in this watershed 1 gjorgiev and sansavini 2018 of the natural streamflow at each plant is set as the initial water consumption constraint to limit the impact on water resources required by code 302 211 in title 35 of the illinois administrative code ipcb 2018 the allowable maximum temperature t 0 and temperature rise  t 0 above the natural water temperature at the cooling mixing zone should not exceed 32 c and 2 8 c respectively in the model relaxations  w a n d  t of water consumption constraints and temperature constraints are granted to plants when necessary during a drought to maintain the reliability of the electricity supply but with subsequent economic penalties  w and  t the water electricity nexus model built in the case study is implemented on a pc with an intel r core tm i5 2500 cpu 3 30 ghz each run with a specific combination of parameters takes about 25 minutes 3 2 input data hydrography data in the kaskaskia river watershed e g flowlines catchments elevations slopes and boundaries are extracted from the national hydrography dataset plus version 2 nhdplusv2 mckay et al 2012 land use data are obtained from the cropland data layer cdl nass 2017 streamflow and river water temperature data are downloaded from the usgs national water information system nwis usgs 2018 for model calibration and validation climate forcing data are obtained from various sources station based precipitations are extracted from the hourly precipitation dataset dsi 3240 ncdc 2003 and aggregated for each sub watershed using the inverse distance weighting method daily maximum and minimum temperatures snow depths and snowfalls are extracted from the global historical climatology network ghcn menne et al 2016 daily wind speeds and dew points are extracted from the global surface summary of the day gsod ncdc 2017 solar radiation data are taken from the national solar radiation database nsrdb sengupta et al 2014 daily cloud cover data are necessary for the water temperature simulation module and are extracted from the advanced very high resolution radiometer avhrr remote sensing product patmos x heidinger et al 2014 a summary of the input data for the hspf is shown in table 1 using the input data in table 1 the hspf is run at a daily time step from 1980 to 1995 for streamflow calibration and from 2001 to 2012 for streamflow validation at the gage station usgs 05594100 the simulation between 1995 and 2000 is eliminated because of the inconsistency in precipitation and streamflow observations high streamflows with low precipitations the water temperature simulation module in hspf is calibrated at usgs 05594100 during 1980 1995 and validated at the other 15 usgs stations during the same period this calibration method is applicable since all the sub watersheds share the same calibrated parameters in the water temperature simulation module the detailed calibration and validation results for streamflow and water temperature can be found in appendix a next we focus our study period on the 2012 summer 92 days from june 1 to august 31 the hspf outputs daily streamflow and water temperature data that serve as the input for the thermoelectricity generation and optimization modules the operating and maintenance cost o p i is obtained from the electric power annual table 8 4 eia 2017a p1 uses the natural gas fired combined cycle ngcc and its o p is 35 67 m w h p2 p3 and p4 use conventional steam coal csc and their o p is 37 60 m w h here the o p differences between p2 p3 and p4 are ignored due to the lack of more detailed information the plant specific operating cost is usually confidential and unavailable payet burin et al 2018 average cooling water consumption intensity w i i in summer months is compiled from the us energy information administration eia thermoelectric cooling water data eia 2017b for each plant the minimum load e i m i n and maximum capacity e i m a x of each plant are obtained from form eia 860 eia 2016a thermal efficiency  i of the plant during the summer season is calculated as the average rate of the net electricity output to electric fuel consumption from form eia 923 eia 2016b v i is the volume of the cooling mixing zone of a recirculating pond cooling plant which is obtained from form eia 923 eia 2016b a summary of the characteristic data of the four plants in the kaskaskia river watershed is shown in table 2 the price of electricity during the study period is obtained from the intercontinental exchange ice database ice 2012 during the summer of 2012 in the indiana hub where the kaskaskia river watershed is located 4 results 4 1 electricity supply under varying environmental constraint relaxation levels but no economic penalties the model results allow us to understand how the electricity supplies at both the plant and watershed levels respond to varying environmental constraint relaxation levels during the summer 2012 for the modeling analysis in this section economic penalties  w and  t for water consumption and temperature constraints violation respectively are set as zero which means the plants are granted constraints relaxation with no penalties  t varies from 0 to 3 c at the step of 0 3 and  w varies from 0 to 14 at the step of 1 4 in fig 3 the four plants show different responses to the changes of  w and  t the warmer color in fig 3 represents a larger value at the z axis and the cooler color represents a smaller value this same labeling applies to the figures hereinafter if not specified the electricity supplies by p1 fig 3a and p3 fig 3c increase with  w but are not affected by the increase of  t since they are equipped with recirculating tower cooling technology which is not limited by temperature constraints more water consumption constraint relaxation is needed by p1 14 than p3 10 to reach maximum capacity p2 fig 3b uses cooling pond technology and thus is subject to temperature constraints we assume that p2 is not limited by water consumption constraints since it withdraws water from a nearby reservoir which can provide adequate cooling water the minimum temperature constraint relaxation  t is 1 c for p2 to operate at full capacity p4 fig 3d is significantly subject to both water consumption and temperature constraints when  w is set as zero the increase of  t does not increase the electricity supply at all when  t is set as zero as much as 52 of the capacity can be used when  w is increased to 14 the relaxation of  t is necessary if more than 52 of the capacity is expected by the electricity market the minimum  t and  w are 3 c and 14 respectively for p4 to operate at its full capacity at the watershed level the sensitivities of the total electricity supplies by the four plants are shown in fig 3e the violation and relaxation of the initial water consumption constraint are necessary if a significant increase in the electricity supply is expected a larger increase can also be achieved with the relaxation of water temperature constraints it should be noted that the pattern at the watershed level fig 3e follows p4 fig 3d the reason is that p4 has a large capacity and is constrained by both the water consumption and temperature limitations which is similar to the setting at the watershed level while the other three power plants are constrained by either consumption or temperature limitations 4 2 electricity supply under fixed environmental constraint relaxation levels and varying economic penalties in this section the fixed maximum constraint relaxation levels i e  w 14 and  t 3 c are set for the four plants but with varying economic penalties the penalty factor  w m 3 s 2 for extra water consumption varies from 0 to 10 at the step of 1 and  t c 2 for an extra temperature rise varies from 0 to 2 at the step of 0 2 fig 4 shows the response of electricity supplies to varying economic penalties and the associated cooling water consumption the electricity supplies by p1 fig 4a and p3 fig 4c decrease with an increase of  w but are not affected by  t since they are insensitive to temperature constraints more than half of their capacities will be curtailed with the maximum  w as 10 p2 fig 4b will decrease the electricity supply when  t increases of its capacity 20 will be curtailed if the maximum  t is imposed the electricity supply by p4 fig 4d will experience a quick drop even if a small  w and  t are adopted in some cases p4 would slightly increase its electricity supply when the penalty factor increases for example when  w is fixed as 4 and  t increases from 0 to 0 2 this result is reasonable since p4 is located downstream of the kaskaskia river and can receive more cooling water if upstream plants use less water when a penalty is imposed however when the penalty factor becomes larger p4 would choose to decrease its electricity supply to avoid a penalty and maximize its profits even though there is more available cooling water the total electricity supply fig 4e at the watershed level closely follows the pattern of p4 the second z axis in fig 4 demonstrates the cooling water consumption w the patterns of w exactly follow the patterns of e since w is a linear function of e as shown in equation 12 in section 2 3 in fig 4 generally the downstream plants p3 and p4 fig 4c and fig 4d consume more water than the upstream plants p1 and p2 do fig 4a and fig 4b this is a reasonable location design since power plants with a large capacity and water consumption such as p3 and p4 are usually located downstream where the water is adequate to support electricity production except during a drought comparing w in fig 4c and fig 4d p4 consumes nearly 1 5 times as much as p3 with a same level of electricity production which is caused by the larger cooling water consumption intensity at p4 another aspect of the environmental impacts the rise in water temperature  t by plants p2 and p4 is quantified in fig 5 p1 and p3 do not discharge thermal pollution to water bodies raising the water temperature focusing on the  t axis and fixing  w as zero when the penalty factor on a water temperature rise is larger than 0 4 both p2 and p4 will reduce  t to around the initial allowable maximum level of 2 8 c to avoid economic losses however in fig 4b and fig 4d the electricity generation will continue to slightly decrease with a larger  t this implicates that adopting an  t larger than 0 4 is impractical when making the policy decision since it does not significantly reduce  t but decreases the electricity generation at p4 in fig 5b  t is further reduced to lower than 2 8 c when  w is increased which indicates that a larger economic penalty on the extra water consumption would also help to relieve the environmental impacts of a rising water temperature p2 is not limited by the cooling water constraint  w or the economic penalty  w 4 3 electricity supply under varying environmental constraint relaxation levels and economic penalties following the results from the modeling exercises that have fixed environmental constraint relaxation levels or economic penalties to separate their impacts on electricity supply in this section different combinations of constraint relaxation levels and economic penalties are used to investigate the joint impacts at the watershed level economic penalties are set as five levels in the subfigures of fig 6 as  w increases from 0 to 10 and  t increases from 0 to 2 in each subfigure the increase of  w at the step of 1 4 is represented by the horizontal axis and the increase of  t at the step of 0 2 is represented by scenarios s1 to s11 when no penalties are applied fig 6a the electricity supply increases with  w and  t though at different rates the increase of e is largely driven by  w when  w is smaller than 5 6 and the increase of  t contributes slightly to the increase of e when  w is larger than 8 4 the increase of e is largely driven by  t and the increase of  w contributes just a little different combinations of  w and  t can maintain the same level of electricity supply e g e a e b fig 6a comparing a to b there is less impact on water quantity but more on water temperature to increase the electricity supply from e b to e c or e d we can choose the path from b to d which consumes more water but with the same level of impact on water temperature or the path from b to c which causes a greater water temperature rise but with the same water consumption these tradeoffs between the electricity supply water consumption and river water temperature need to be balanced by watershed agencies during a drought event when larger penalties are imposed from fig 6a to fig 6e profit driven plants would decrease their electricity supplies to avoid paying a penalty comparing fig 6b to fig 6a a small increase of  t would cause a quick decrease of e and reduce the differences among scenarios s1 to s11 which means that the temperature constraints relaxation cannot encourage an increased electricity supply if the penalty factor  t is larger than 0 25 the contribution to e by the increase of  w would significantly decrease if the penalty factor  w is larger than 5 in fig 6e e would not increase with  w when  w is larger than 1 4 since the penalty is high for violating the initial cooling water consumption constraint generally the upstream aquatic environment in a watershed is more fragile and sensitive than the one downstream the water availability is usually smaller upstream and its capability to absorb the hydrologic disturbance is limited in addition upstream water consumption would result in a cumulative impact on the aquatic ecosystem and less water availability for users downstream therefore resource agencies may apply more stringent constraints or penalties at the headwaters than at downstream locations srbc 2012 for this reason we further apply a spatially distinguished penalty or penalty price discrimination stole 2007 by imposing a larger penalty factor on the two upstream plants p1 and p2 and a smaller factor on the two downstream plants p3 and p4 ten levels of penalty price discrimination are applied the penalty factor for extra cooling water consumption under the price discrimination is 16  w i  w 1 p i 1 2  w 1 p i 3 4 the penalty factor for an extra rise in water temperature under the discrimination is 17  t i  t 1 p i 1 2  t 1 p i 3 4 where p is the penalty discrimination level expressed as a percentage varying from 0 to 100 when p 0 all four plants share the same penalty factors  w 5 and  t 1 which are the same as in fig 6d regarded as the baseline penalty scenario a positive p means a larger penalty for upstream plants and a smaller penalty for downstream plants when p 100 the largest penalty is imposed on the upstream plants but there is no penalty for those downstream scenarios s 1 to s 11 represent the different levels of environmental constraint relaxation with  t increasing from 0 c to 2 c at the step of 0 2 c and  w increasing from 0 to 14 at the step of 1 4 as shown in fig 7 the watershed level total electricity supply would significantly increase if the penalty discrimination is applied in this watershed this kind of increase shows in all constraint relaxation scenarios s 1 to s 11 some small decreases are observed when p varies from 90 to 100 in scenarios s 2 to s 5 compared to the baseline penalty scenario as much as 60 more electricity can be supplied if the largest penalty discrimination is applied in scenario s 11 with the maximum constraints relaxation these modeling results reveal the quantitative tradeoffs between the electricity supply and environmental constraints under various management regulations and economic penalties the final decision is left to watershed agencies to decide which and how much constraints relaxation should be granted to each power plant and how much of a penalty should be imposed on constraints violation agencies different preferences may lead to different policies and thus different environmental impacts and electricity supplies for example an aggressive agency that only values the reliability of the thermoelectricity supply system may allow plants to break the initial environmental constraints as much as needed to maintain the maximum electricity supply an agency that chooses to reduce the cooling water consumption and thereby transfer more water supply to other sectors may set a small  w and a large  w an agency that seeks to maintain a suitable water temperature for aquatic life may set a small  t and a large  t the modeling of watershed level decisions is warranted in the future 4 4 sensitivity analysis of electricity supply to the market electricity price the market electricity price e p is a critical exogenous parameter in the water electricity nexus model in the above analysis e p is assumed as a constant during the whole study period which is referred to as the baseline scenario e p 0 however there are great daily variations in e p ranging from 30 to 80 m w h during the 2012 summer ice 2012 to analyze the sensitivity of electricity supply to e p four scenarios are designed in this section the daily e p s during the study period are obtained from the ice database ice 2012 and are linearly interpolated to fill data gaps referred to as the first scenario e p t 1 the electricity price in the baseline scenario is calculated as the average of the daily e p t 1 18 e p 0 e p t 1 in the second scenario e p t 2 the daily e p t 1 are increased by 20 19 e p t 2 e p t 1 1 20 in the third scenario e p t 3 the daily e p t 1 are decreased by 20 20 e p t 3 e p t 1 1 20 in the fourth scenario e p t 4 the daily e p t 1 are increased by 20 if they are larger than the average price and decreased by 20 if smaller 21 e p t 4 e p t 1 1 20 e p t 1 e p t 1 e p t 1 1 20 e p t 1 e p t 1 the water electricity nexus model is run over the four scenarios with all other parameters remaining the same as in section 4 2 the watershed level results are shown in fig 8 comparing fig 8a to fig 4e when the daily variations in the electricity price are considered the potential electricity supply is reduced at most by 50 this implicates more power generation curtailment during the days when the electricity price is lower compared to fig 8a when the daily electricity prices are increased decreased by 20 the potential electricity supply would be dramatically increased decreased in fig 8b fig 8c comparing fig 8d to fig 8a when there are larger daily variations in electricity price the potential electricity supply is slightly decreased the sensitivity analysis demonstrates that power plants are more willing to pay the economic penalties for more electricity generation when the e p is high and stable fig 8a and 8b but are less willing when the e p is low or unstable fig 8c and 8d the nexus modeling results prove to be very sensitive to e p therefore much attention should be paid to determining a proper e p when the nexus model is used in future works modeling the electricity market equilibrium at the grid scale and obtaining an endogenous electricity price would advance the nexus model 5 conclusions and discussion in this study a water electricity nexus model pyhspf we is developed to support both water resources management and electricity supply planning during a drought event the hydrologic module hspf the decentralized optimization module and the thermoelectricity generation module are closely integrated at a daily time step at the watershed scale the nexus model is capable of testing the various environmental regulations and economic penalties and quantifying the tradeoffs among streamflow water temperature and electricity supply at both the power plant and watershed levels findings show that some flexibility in environmental policies i e relaxations of cooling water consumption and temperature constraints would generally allow improvement in the reliability of the thermoelectricity supply system during a drought applying economic penalties can regulate the contributions of the individual power plants with different environmental impacts the different responses of the power plants to various environmental policies including environmental constraints relaxation and economic penalties on constraints violation can be attributed to the different hydrologic conditions that exist at the plants locations and their thermoelectric characteristics such as primary fuels and cooling technologies these general findings can be extended to other watersheds or drought events even though the magnitude of the tradeoffs and the effects of environmental regulations and economic penalties may depend on the specific situation of the case study a case study is conducted in the kaskaskia river watershed the results show that the minimum required relaxations of cooling water consumption and temperature constraints are 14 and 3 c respectively if the power plants are expected to operate at their full capacities during the 2012 drought at the watershed level a spatially distinguished penalty policy i e a larger penalty factor for upstream plants and a smaller one for downstream plants is found to improve the total electricity supply by as much as 60 compared to the baseline penalty scenario these results indicate that plant specific policies have more advantages than uniform policies although more efforts will be required for the watershed agencies to put these policies into practice the water electricity nexus model developed in this study may be used for a wide range of applications including planning and assessment and operational use our analyses in this study primarily focus on the planning and assessment of the tradeoffs between electricity supplies and environmental impacts during a drought event for operational use with real time hydrologic information unknown weather forecast information can be used as the climatic inputs to the hspf module to predict the future streamflow and water temperature one of the advantages of our nexus model is that it directly uses climatic inputs and thus no streamflow inputs are required due to integration of the hydrologic model we admit that the current nexus model would introduce uncertainties to hydrologic forecasts under an operational setting how to incorporate the hydrologic uncertainties into water resources management is a typical issue investigated in many previous studies e g cai and rosegrant 2004 since the hydrologic uncertainties would increase with the lead time in practice we may suggest running the nexus model for a short period e g a week rather than 3 months as in the current case study and then running the model for the next period with an updated weather forecast the data assimilation technique vrugt et al 2005 liu and gupta 2007 may be used to update the initial conditions of the next period with observed hydrologic data in the past period the stochastic optimization technique salazar et al 2013 guerra et al 2019 may also be used to consider the different hydrologic scenarios and provide the expected outcomes the exact duration and extent of a drought event cannot be known before it ends under the operational setting based on the nexus model however environmental agencies can still be supported in obtaining useful hydrologic forecast information on the drought and setting predicted values for constraints relaxation and economic penalties a limitation of the proposed nexus model is that the electricity price is set as an exogenous variable though a sensitivity analysis is conducted to demonstrate the responses of power plants to different price scenarios we also assume that paying economic penalties for extra water consumption and a rise in the water temperature would not affect bidding offers of the power plants and the electricity price at the grid scale this study focuses on the thermal power plants within a watershed with a relatively small number of plants and total generation capacity from an economic point of view in a market with many competitive sellers the power sellers within such a watershed which is much smaller than the region with a power grid is usually not powerful enough to affect the market equilibrium price if the model is applied to a much larger spatial scale all these factors must be taken into account some future works may improve this newly developed water electricity nexus model for more policy implications for example if the predictive daily or even hourly electricity demands and prices in the coming months are available the dynamics of the electricity market and the response of each power plant can be represented with more details this would require the incorporation of a system level electricity market model that allows us to investigate the impacts of paying economic penalties on the bidding offers and finally the market electricity price by simulating the electricity demand supply and the equilibrium price in a consistent framework the inclusion of a unit commitment and dispatch model fooladivanda and taylor 2015 has the potential to simulate the changes in electricity generation associated with electricity price and test the assumption of the exogenous price in the current case study a more detailed thermoelectricity generation model at the power plant level would also help simulate the dynamic status of the generating units zhai et al 2011 for example dynamic cooling water consumption intensities and operating costs at each time step can be determined considering the ambient hydrologic conditions such as cooling water availability and river water temperature the current nexus model focuses on the daily average analysis mainly limited by the availability of hydrologic information the nexus model can be enhanced to capture the sub daily dynamics of the power generation and the associated environmental impacts if sub daily hydrologic conditions e g hourly streamflow and river water temperature can be simulated by climatic inputs with a finer temporal resolution or estimated by some assumptions on the sub daily variations of streamflow acknowledgment this work was supported by national natural science foundation of china 41730645 41425002 and 41790424 china scholarship council and the international partnership program of chinese academy of sciences 131a11kysb20170113 the authors declare no conflict of interest we are grateful to lisa sheppard for her editorial review appendix a hspf calibration and validation results the hspf model calibration and validation results are presented here the nash sutcliffe efficiency coefficient ns 1 nash and sutcliffe 1970 is used to evaluate the model performance a higher ns means a better model performance streamflow is calibrated during 1980 1995 and validated during 2001 2012 at the gage station usgs 05594100 fig a1 shows the results of simulated daily streamflow for calibration fig a1a and validation fig a1b the ns coefficients are 0 721 and 0 635 respectively which are adequate for capturing the streamflow variations in the watershed however a good calibration of the model at that station does not necessarily guarantee the model accuracy in other sections of the basin fig a2 shows the results of simulated daily water temperatures observed data for water temperatures t are not as adequate as those for streamflow only a small amount of observation records are available for the kaskaskia river watershed usgs 2018 especially after the year 2000 for this reason we calibrate fig a2a the hspf water temperature module with observed data from the gage station usgs 05594100 during 1980 1995 while validating fig a2b for the same period with observed data from the 15 other usgs stations this validation strategy is like one round cross validation hspf shows a good performance for simulating daily water temperature with ns as 0 917 and 0 882 for calibration and validation respectively fig a1 evaluation of hspf simulated daily streamflow q m 3 s a calibration and b validation at the gage station usgs 05594100 fig a1 fig a2 evaluation of hspf simulated daily river water temperature t c a calibration at the gage station usgs 05594100 and b validation at the other 15 usgs stations both during 1980 1995 fig a2 
26108,the denitrification decomposition model dndc has known limitations for simulating soil hydrology which can strongly influence biogeochemical processes for this study dndc s soil hydrological framework was enhanced by including a new sub model for mechanistic tile drainage improved water flux root growth dynamics and a deeper and heterogeneous soil profile comparisons were then conducted against the root zone water quality model rzwqm2 using measurements of soil water storage runoff and drainage in eastern canada and the us midwest simulation of soil water storage dndc 0 81 d 0 90 rzwqm2 0 76 d 0 84 daily water flow dndc 0 76 d 0 88 rzwqm2 0 77 d 0 90 and nitrogen loading to tile drains were improved post development dndc was able to capture the observed differences in water and n losses between conventional drainage and controlled drainage management with sub irrigation the enhancements to dndc s hydrological framework should enable the development of improved biogeochemical processes 1 introduction efficient management of water and nutrients in agricultural systems is essential to further improve profitability for producers and to reduce greenhouse gases ghg losses of excess nitrogen n phosphorus and ammonia which can contribute to global warming eutrophication of water bodies and increases in atmospheric fine particulate matter when considering the long term sustainability of agriculture it is of great importance to examine the interrelationships and trade offs between crop productivity and all environmental outcomes there are numerous field and laboratory studies worldwide which focus on mitigating losses of nutrients reducing ghg emissions and sequestering soil carbon in agricultural systems however due to extreme spatial and temporal variability in soils and climate tools are required for extrapolating the knowledge gained from these studies over space and time because process based models such as daycent del grosso et al 2001 the denitrification decomposition model dndc li et al 2012 the root zone water quality model rzwqm2 ahuja et al 2000 and apsim thorburn et al 2018 can dynamically simulate many of the interdependent process while maintaining a strict mass balance of nutrients and water they are valuable for predicting n losses in the environment and assisting in the selection of best management practices bmps de jong et al 2009 while they offer valuable opportunities for expanding the scope of existing assessments such models still have recognized knowledge gaps and thus require new targeted measurements for the development of improved mechanisms to ensure that the iterative process for model development continues for instance model structure is often limited by the oversimplified representation of soil and hydrological processes in a review of nine ghg models brilli et al 2017 found that 46 of the deficiencies in models were due to issues with the simulation of pedo climatic conditions including soil water simulation in the same review dndc was found to be the only model which simulated all c n related ghg emissions considered the dndc model is the most prominent process based model used for simulating ghg emissions worldwide however it has known issues in simulating soil hydrology smith et al 2019 he et al 2019 2018 brill et al 2017 congreves et al 2016 dutta et al 2016a cui et al 2014 abdalla et al 2011 deng et al 2011 these deficiencies impact the performance of the model for simulating c n cycling and the timing of n2o emissions he et al 2018 uzoma et al 2015 smith et al 2008 as a result it has been suggested in many of these studies that dndc development should be focused on improving the simulation of soil hydrology several iterations of the dndc model have been developed for different regions globally including new zealand dndc saggar et al 2007 landscape dndc haas et al 2013 china dndc li et al 2017 and canada dndc smith et al 2013 each one of these models can still be applied globally but they were developed to include additional processes and management options relevant to the locations where they were developed in the case of the canada dndc model dndc vcan it was designed to better simulate soil plant climate interactions in cool weather climate and has recently been improved for simulating evapotranspiration dutta et al 2016a ammonia volatilization dutta et al 2016b congreves et al 2016 impacts of snow cover and residue on soil temperature dutta et al 2018 and improved growth of cool weather crops he et al 2019 grant et al 2016 kroebel et al 2011 further model developments from canada dndc were integrated back into the primary u s release version smith et al 2019 however as with any model there remain shortcomings in the current model framework grant et al 2016 identified that mineralization rates were too low in dndc sometimes resulting in excessive crop n stress this can largely be attributed to the limitation that dndc only simulates soil c n processes over a 50 cm soil horizon also in a detailed assessment of water processes in canada dndc smith et al 2019 found that dndc predicted crop biomass and monthly water and n flow to tile drains well but did poorly in predicting soil water content and daily tile flow events in the same study another model rzwqm2 using more computational intensive hydrological processes predicted good results but rzwqm2 requires more expertise to employ greater simulation time and is not well validated for simulating some biogeochemical processes since soil biogeochemical processes including chemical equilibria nitrification denitrification and fermentation are highly dependent on soil water content smith et al 2019 recommended the inclusion of a heterogeneous profile that exceeds crop rooting depths root density functions improved water flow and mechanistic tile drainage there is considerable complexity in developing improved soil structure hydrology and tile drainage in dndcv can while ensuring that the reliant biogeochemical mechanisms still function appropriately but research has indicated that these improvements are critical towards the evolution of the model an accurate estimate of soil hydrology is important for predicting the timing of n2o emissions and n leaching events therefore the objectives of this study were i to improve dndc for simulating soil hydrology including the addition of a heterogeneous and deeper soil profile root density functions and improved water flow ii to incorporate a mechanistic tile drainage sub model and include the ability to simulate a fluctuating water table controlled drainage and sub irrigation and iii to compare the performance of dndc to the computationally intensive rzwqm2 using detailed datasets of runoff and drainage in eastern canada and the us midwest it was deemed important that model developments be implemented at the minimum level of complexity and computation time necessary for improving accuracy while keeping the user expertise at a manageable level 2 materials and methods 2 1 description of experimental sites 2 1 1 gilmore city iowa usa experimental site a five year field experiment was established in the fall of 2004 and lasted until the end of 2009 at the agricultural drainage and water quality research and demonstration site close to gilmore city in north central iowa usa the site soils are predominantly characterized as nicollet fine loamy mixed superactive aquic hapludoll webster fine loamy mesic typic endoaquolls canisteo fine loamy mesic typic endoaquolls and okoboji fine smectitic mesic cumulic vertic endoaquolls general site characteristic are shown in table 1 and detailed soils data by horizon are presented in table s1 four land cover treatments were initiated with the first two consisting of alternating phases of winter rye cover crop prior to maize or prior to soybean first phase of the rotation tiledrain covercrop maizesoybean td cc ms and second phase of the rotation tiledrain covercrop soybeanmaize td cc sm the next two treatments were alternating phases of maize and soybean with no cover crop first phase of rotation tiledrain nocovercrop maizesoybean td ncc ms and second phase of rotation tiledrain nocovercrop soybeanmaize td ncc sm table 2 aqueous ammonium nitrogen was applied to maize at a rate of 140 kg n ha 1 in the spring near emergence time the site includes a large compliment of measurements including water content across 4 depths crop yields biomass and daily measurement of water flow and n concentration to tile drains see qi et al 2011a b for a more detailed description of soil management and experimental setup 2 1 2 woodslee ontario canada experimental site a study was conducted at the honorable eugene f whalen experimental farm woodslee ontario canada 42 13 n 82 44 w to monitor surface runoff and tile drainage drury et al 2014 the brookston clay loam soil at the site is classified as an orthic humic gleysol canadian classification system or a poorly drained fine loamy mixed mesic typic argiaquoll in the usda system tables 1 and s1 the study was of 5 years duration starting in late 1999 and ending in early 2005 table 3 treatments included a maize soybean rotation and unrestricted tile drainage with td cc ms and without td ncc ms a winter wheat cover crop and also controlled drainage and sub irrigation with cds cc ms and without cds ncc ms a cover crop this data helped to facilitate testing the new controlled drainage sub irrigation feature in dndc both a starter 18 46 0 and sidedress application of uan 150 kg n ha 1 was applied to maize for a combined nitrogen rate of 175 kg n ha 1 maize grain was harvested in early november and tillage generally consisted of fall disking except when excessive residue required a more substantial cultivated heavy plow two flow meters were used in each plot to measure cumulative surface runoff and drainage flow samples of surface water and runoff were collected using an autosampler every 500 3000 l of flow and analysed for no3 concentration from june to july 2001 intact soil cores were collected for determination of bulk density saturated hydraulic conductivity and soil water retention at 9 matric potentials see drury et al 2014 for a more detailed description of soil management and experimental setup 2 2 model description 2 2 1 dndc model the dndc model was developed originally to simulate n2o emissions li et al 1992 and gained popularity due to its detailed biochemical equations describing nitrification and denitrification processes it was later expanded to simulate soil c n cycling water and n movement li et al 2006 and full farm nutrient cycling li et al 2012 and now contains sub models for simulating crop biomass decomposition nitrification denitrification fermentation and ammonia volatilization the model simulates a very wide array of agricultural management and crop types the input requirements are reasonable and it can be applied with relative ease as a result dndc has been used extensively worldwide ehrhardt et al 2018 brilli et al 2017 zhang and niu 2016 gilhespy et al 2014 giltrap et al 2010 many users have however reported that the model had issues in simulating soil water content smith et al 2008 2019 he et al 2018 brilli et al 2017 congreves et al 2016 dutta et al 2016a uzoma et al 2015 cui et al 2014 abdalla et al 2011 deng et al 2011 which is correlated with soil oxygen content a driver for the growth and death of nitrifier and denitrifier bacteria in dndc since soil water content impacts the type and rate of microbial reactions in dndc it can greatly impact n2o emissions furthermore since dndc only simulates soil c n cycling to a 50 cm depth processes such as nitrification denitrification nitrate leaching fermentation ammonium fixation and mineralization may be represented inaccurately to account for the limited depth of simulation dndc employs a simple layered cascade approach for simulating bulk water flux and n transport down the soil profile water drains to field capacity in each layer 2 cm thickness at the rate of ksat fig 1 both water flow and c n cycling are simulated to 50 cm depth through a homogeneous soil profile a deep water pool with a water holding capacity based on its bulk density is situated below the 50 cm soil profile to provide water for crop transpiration 50 cm soil profile 50 cm deep water pool 100 cm total water pool the model rooting depth is fixed with transpiration being drawn equally across all soil layers followed by extraction from the deep water pool when plants are under water stress to improve the simulation of water and n loss to tiles li et al 2006 incorporated a simple recession curve to delay drainage by soil layer but this is not active in the current u s dndc release version smith et al 2019 tested this approach and although the simulated drainage was improved soil water content was then overestimated by 22 and n2o emissions increased by 26 since 2011 a canadian version of dndc now referred to as dndcv can has been under development to improve the simulation of agricultural management and crop cultivars in cool weather climate smith et al 2019 compared dndcv can to rzwqm2 and found limitations in its ability to simulate soil hydrology thus suggested several improvements including a deeper and heterogeneous soil profile improved water flow down the profile root density functions a fluctuating water table and mechanistic tile drainage in this study we incorporate these developments while attempting to minimize extra model inputs complexity for users and computation time in this study canada dndc prior to development is referred to as default dndc and canada dndc post development is referred to as revised dndc 2 2 2 rzwqm2 rzwqm2 version 3 0 2015 ahuja et al 2000 ma et al 2012 was developed to simulate detailed biogeochemical processes in cropping systems with a major focus on simulating water quality the model simulates a wide array of agricultural management and has recently been expanded and improved for simulating n2o emissions fang et al 2015 jiang et al 2019 and phosphorous dynamics sadhukhan et al 2019 rzwqm2 includes dssat 4 0 crop models with ceres and cropgro components hoogenboom et al 2017 ma et al 2005 2006 which is a very well established framework for simulating crop growth and development worldwide rzwqm2 uses a numerical solution to determine water fluxes and includes the green ampt equation for infiltration the richards equation with an option for lateral hydraulic gradient for lateral water loss and the hooghoudt s equation for simulating quasi 2d tile drainage thus the model input requirements modeller expertise and computation time are greater than for dndc the model has been validated for simulating drainage and n loading to tiles at many locations in north america malone et al 2017 xian et al 2017 qi et al 2011b li et al 2008 thorp et al 2007 akhand et al 2003 and has been employed to investigate bmps for reducing n losses since rzwqm2 is a well recognized model for simulating soil hydrology it offers an excellent opportunity for benchmarking dndc developments 2 3 development of dndc to improve the simulation of soil hydrology and to include mechanistic tile drainage 2 3 1 heterogeneous and deeper soil profile the default dndc model only characterizes the top soil horizon and assumes a homogeneous profile throughout often this is not a good representation of agricultural soils which can have striking differences across depths as a result of changing textures and organic carbon contents therefore the model interface was restructured to allow for the user input of soil properties by definable layer depths soil properties that are now defined by depth include bulk density soil organic carbon ph soil texture field capacity wilting point porosity and saturated hydraulic conductivity the user can specify the depth of the soil profile up to 200 cm and define properties for up to 10 user defined depths the soil profile information can be saved such that it can be used for other simulations the modifications to the model interface were conducted in parallel with the model simulation depth being adjusted from 50 cm to 200 cm fig 1 the total number of simulated layers were increased to ensure that the calculated layer thickness remained in the same range 0 5 2 5 cm as it was previously for the 50 cm version of the model this was important since many processes are formulated to calculate the mass and energy flows based on this conceptual range of layer thickness it was decided that 200 cm would provide a sufficient depth to accommodate the effective root penetration of most commonly used crops and allow for the simulation of a fluctuating water table and tile drainage modifications to internal variables were conducted to ensure that soil properties water carbon nutrients and temperature could be tracked over the entire depth and these variables could be applied for estimating decomposition denitrification nitrification fermentation adsorption onto clay chemical equilibria and n movement functions as a result dndc was not only enhanced for simulating soil hydrology but also for the simulation of all biogeochemical processes up to a 200 cm depth 2 3 2 root penetration and density function the default dndc model calculates a linear estimate of root penetration to a maximum depth of only 50 cm without considering root density since water uptake for transpiration is partitioned equally across the profile this can result in the model underestimating water and n uptake near the surface and overestimating these components in the deeper profile further crops only have access to 100 cm of soil water when the deep water pool is included fig 1 thus deeper rooted crops can sometimes become water limited as a result of these limitations in the default model a root penetration equation based on growing degree days gdd pedersen et al 2010 was incorporated into dndc temperature or gdd are considered to be the main drivers for root growth and penetration kage et al 2000 thorup kristensen 2006 kirkegaard and lilley 2007 the equation expressed in terms of pgi plant growth index which is the fraction of accumulated degree days required for a plant to reach maturity in dndc is as follows 1 r z r z m i n p g i p g i l a g p g i p g i l a g k r z r z m i n p g i p g i l a g r z m a x p g i p g i l a g k r z r z m i n r z m a x where rz is the depth of root penetration rzmin is the planting depth pgilag accounts for the time period between planting and start of root penetration germination krz is the root depth penetration rate with values provided for some crops in pedersen et al 2010 rzmax is the maximum root penetration depth the rzmax value is user defined in the dndc input interface an algorithm for root distribution based on a study by gerwitz and page 1974 and further modified by yang et al 2009 to extend the rooting depth of fine roots by an additional 30 was also employed in dndc the root density declines logarithmically to the root penetration depth rz followed by a linear decrease to zero at 1 3rz the relative root length distribution is as follows 2 l r z e a z z z r z e a z z 1 z r z 0 3 r z r z z 1 3 r z where az is the shape parameter describing root distribution with increasing soil depth pedersen et al 2010 used values of az 2 for wheat and winter wheat and 1 5 for brassica s and we currently use a default value of 2 but the user can define the shape parameter and rooting depth based on field studies or from sources such as fan et al 2016 and benjamin et al 2013 2 3 3 simulating water flow the default cascade flow algorithm whereby water content per layer tips to field capacity on an hourly basis can result in an erroneously low prediction of soil water contents complex numerical schemes such as finite difference and finite element solutions of richard s equation can generally produce more accurate result however they are data and computation intensive it is possible to use pedotransfer functions to estimate water retention curves and other hydrological parameters for use in these equations but in doing so it can undermine much of the improved accuracy that is achieved using this approach further there is some uncertainty regarding the applicably of richards equation for highly heterogeneous agricultural soils in a review of water flow approaches beven and germann 2013 commented that in unsaturated heterogeneous soils there is rarely a consistent hydraulic gradient which richard s equation assumes since capillary potentials are not in equilibrium initially we investigated including an integrated richards equation approach with the van genuchten equation van genuchten 1980 for estimating soil water retention characteristics in dndc as presented in yang et al 2009 but once implemented the hydrology sub model time step needed to be reduced to such an extent that the computational time of dndc was greatly increased and we also found it difficult to obtain data to properly fit the van genuchten or other water retention equations during the course of development after the inclusion of a heterogeneous soil profile root density function and mechanistic tile drainage we found that the cascade approach could provide sufficient accuracy in estimating water contents flux we decided to keep the cascade flow approach intact but limited water movement above field capacity based on soil water status using the following simple approach derived by both averkjanov 1950 and irmay 1954 for estimating unsaturated conductivity 3 k k s a t   r  s  r n where k is hydraulic conductivity ksat is saturated hydraulic conductivity  is actual r residual and s saturated soil water content cm3 cm 3 this equation differs in power n where irmay used a value of 3 and averkjanov 3 5 our tests indicate that a value of 3 5 worked well in the range of soil water contents from field capacity to saturation the only incidence when k is calculated in revised dndc 2 3 4 fluctuating water table dndc was modified to simulate a fluctuating water table by adjusting the hydraulic conductivity of the deepest profile to near impermeable user defined value a water table slowly builds up from the bottom soil layer with deep seepage at the lower boundary the water table is maintained as a mass balance of incoming water from precipitation and irrigation and outgoing water from runoff evapotranspiration tile drainage deep seepage and change in soil water content in unsaturated layers for the purposes of estimating tile flow rate the water table height was calculated at the top of the saturated soil layer closest to the soil surface 2 3 5 incorporating a tile drainage sub model similar to rzwqm2 and drainmod skaggs et al 2012 the steady state hooghoudt equation was also included in dndc the drawdown of water table height is not fully steady state however the rate of change usually proceeds slow enough that the hooghoudt equation can be used effectively skaggs et al 2012 a recent study by xian et al 2017 when assessing the performance of rzwqm2 using the original steady state equation and two transient equations found that there was no significant difference in model performance for hourly drainage simulation the hooghoudt equation as written in skaggs et al 2012 is 4 q 4 k e m 2 d e m l 2 where q cm h 1 is the drainage discharge rate ke cm h 1 is the effective lateral hydraulic conductivity m is the water table level above the drain at midpoint between the drains de is the equivalent depth to the impermeable or restrictive layer below the drain and l is the drain spacing equations to estimate ke and de below were outlined in xian et al 2017 5 k e i 1 i n d i k i i 1 i n d i where n is the number of soil layers di is the thickness of layer i cm and ki is the lateral hydraulic conductivity of layer i cm h 1 as indicated in xian et al 2017 the calculation of de depends on the actual depth d of the soil profile 6 if d l 0 3 d e d 1 d l 8  l n d r c o n where 7 c o n 3 55 1 6 d l 2 d l 2 8 if d l 0 3 d e l 8  l n l r 1 15 where r is the radius of the drain m 2 3 6 movement of nitrogen to runoff tile drains and through the soil profile the primary development aim of this study was to improve estimation of soil hydrology and thus the existing n movement mechanisms in dndc were not extensively modified the default nitrate movement in dndc is described simply as a function of the water flux and nitrate concentration per layer soil nitrate was considered to be mobilized by a positive water flux 90 mobilized and transferred to the layer below as a one dimensional vertical n flux towards the bottom soil profile additionally another fraction 10 of the no3 in a layer was considered to be lost through preferential water flow via macropores directly out of the soil profile this preferential loss was calculated regardless of whether the soil layer directly below also met the condition of having a positive water flux for simulations now with tile drainage the movement of nitrate is an iterative step through each of the saturated layers per hour that are drained to tiles in dndcv can this preferential n leaching function was modified to ensure correlation with water movement it was previously found that dndc sometimes simulated n losses when there was no water flux out of the bottom of the soil profile in dndcv can the fraction of no3 available to be transferred to the layer below at an hourly time step can now be parameterized through the user interface with a default value of 0 9 the fraction per layer that is preferentially lost directly to drains i e it bypasses the iterative layer loop is set to a default fraction of 0 02 nitrate losses to tile drains are calculated starting from the layer situated at the top of the saturated water table down to the layer at the bottom of the tile drains additionally we found that in default dndc nitrate losses to runoff were always very low irrespective of the soil conditions water inputs or crop management employed to address this issue we first fixed a water mass balance error in the scs runoff curve number method second the model was modified to simulate a fluctuating water table and when the water table reaches the soil surface runoff and additional loss of n could then occur further n loss to runoff was originally calculated as a fraction of rainfall that goes to runoff based on scs method multiplied by the nitrate found in only the top surface layer 0 5 2 cm we extended this calculation to the top 2 layers 1 4 cm and included a user defined parameter where the fraction can be adjusted 2 4 initialization calibration and validation at both the gilmore city and woodslee research locations the td cc ms treatment was used for model calibration and the remaining 3 treatments were used for validation a similar trial and error method for calibration as conducted in smith et al 2019 was used where the rmse for simulated yield drainage and n loss to tiles was minimized this was conducted for default dndc revised dndc and rzwqm2 in all simulations a 10 year spin up was included prior to the experimental periods to stabilize soil c n and water experimental data from the sites was used to initialize the models this data included soil properties such as soil texture bulk density field capacity wilting point porosity saturated hydraulic conductivity and soil organic carbon content table s1 note that soil data was only available at two depths at the woodslee site thus the properties from the 10 20 cm depth were extrapolated down to 200 cm daily weather data including min and max temperature precipitation wind speed solar radiation and relative humidity were available at both sites for all years of the studies management data including tillage scheduling and implements and fertilizer scheduling and application rates was also available for the gilmore city site default dndc and rzwqm2 have previously been calibrated and validated smith et al 2019 in this study we compare the performance of the revised dndc model to those results after the hydrology developments had been implemented the revised model was calibrated using the same approach as the other two models crop soil and tile drainage parameters used in the study for default and revised dndc are shown in table s2 and crop parameters used in rzwqm2 are shown in table s3 note that a winter rye cultivar was not available in rzwqm2 thus qi et al 2011b developed parameters based on a winter wheat cultivar and these were further modified for a more recent version of rzwqm2 by smith et al 2019 2 4 1 calibration of crop parameters in dndc for revised dndc several crop parameters were calibrated however parameters remained close to those used by default dndc the thermal degree days to maturity tdd was increased marginally for both maize and soybean table s2 water requirement for maize and soybean were reduced at gilmore city soybean was set to 340 g water per g dry matter which is very close to the default 350 value for the u s release version in default dndc plant roots only had access to the top 100 cm of the profile and had no access to a water table which was a structural deficiency the crop water requirements needed to be increased in the default model to simulate an appropriate level of crop water uptake evapotranspiration and drainage which often resulted in soil water content that was too low in the growing season smith et al 2019 in the revised model appropriate rooting depth and uptake from a fluctuating water table was simulated thus crops were less water stressed and crop water requirements were calibrated to be on average 15 lower for maize and 23 lower for soybean at the woodslee location the average soybean yields were only 60 of that at gilmore city we believe this was partly due to different varieties being used than at gilmore city a different variety was planted every year at woodlsee as the soybean variety a2553 was no longer available in 2005 and a shorter season variety was planted in 2003 as a result of a late plant date drury et al 2014 we used a lower maximum grain c parameter optimum yield at woodslee for soybean table 2 however the main contributing factor was likely that more crop water stress occurred at woodslee this was attributed to greater runoff due to a lower permeability soil and more precipitation occurring in the off season months also woodslee receives less average precipitation on average during the growing season than at gilmore city fig s1 in default dndc rooting depth is always constant at 50 cm in revised dndc we set a lower max root depth at woodslee site 0 8 m for maize and 1 1 m for soybean since there is higher clay content and lower root penetration table s2 this helped minimize rmse for yields and drainage rooting depth in dndc was set considerably lower than in rzwqm2 which has max possible root depth of 1 8 m for both maize and soybean for the winter rye cover crop at gilmore city the parameters used in smith et al 2019 for default dndc were employed for revised dndc default parameters for both default and revised dndc were used for the winter wheat cover crop grown at the woodslee site the winter rye and winter wheat cover crop never reached the grain filling stage before being terminated in any of the treatments simulated a similar magnitude of winter wheat biomass was simulated for dndc and rzwqm2 at woodslee but no measured data was available for validation 2 4 2 calibration of soil and drainage parameters in dndc the drainage development required the integration of additional input parameters to the dndc interface including drain depth spacing and radius depth to bedrock and ksat at each depth lateral ksat is estimated as 2 ksat qi et al 2011b which is needed to calculate ke for use in the hooghoudt equation in general it is very difficult to get a good measure of in situ ksat particularly at deeper soil depths laboratory measurements of ksat using soil cores and the traditional saturated flow desorption method can in fact be over an order of magnitude greater than in situ measured ksat smith et al 1995 in this study we used the ksat values from qi et al 2011b for the gilmore city site and adjusted ksat with depth for the woodslee site to values that would provide a good estimate of tile drainage using both dndc and rzwqm2 table s1 during the calibration process for default dndc it was necessary to reduce the size of the slow humus soil organic carbon soc pool from a default value of 0 95 to 0 7 to provide sufficient n mineralization when simulating the observed levels of n losses at the gilmore city site smith et al 2019 using revised dndc it was only necessary to reduce this parameter to 0 90 the revised dndc model simulates decomposition to 200 cm and thus it estimates a more plausible rate of mineralization which was previously noted to be a model weakness in some studies grant et al 2016 smith et al 2008 similar to the gilmore city location for default dndc it was necessary to reduce the size of the slow humus soc pool in default dndc from 0 95 to 0 75 to simulate the correct magnitude of n losses in the calibration treatment at woodslee using revised dndc this value was decreased only to 0 91 the scs curves number for estimating runoff in revised dndc at gilmore city was set to 64 the same value as used for default dndc smith et al 2019 a value of 87 was used at woodslee for both model versions to account for a lower permeability soil and thus simulate the correct level of runoff for the calibration treatment preferential movement of n was set to 2 in revised dndc to allow rapid movement of a small portion of n to drains without moving through the soil matrix this improved the model performance at both sites the n concentration in precipitation was set to 1 8 mg n l 1 the same value as used at the gilmore city site qi et al 2011b the microbial parameters related to nitrification and denitrification rates were left as default however during the course of development we added several new parameters into the dndc input interface such that they could potentially be adjusted the rate of microbial activity can vary greatly between soil types and locations 2 4 3 calibration of rzwqm2 at woodslee site a similar procedure employed in smith et al 2019 and qi et al 2011b at the gilmore city site was used for calibrating rzwqm2 at the woodslee site measured soil properties were input into the model according to table s1 initial soil moisture was set to saturation below the 60 cm depth at the beginning of the 10 year spin up to initiate the simulation of a water table the magnitude of the initial soil carbon was based on site measurements however the partitioning of the soc pools was determined by using a built in tool for equilibrating soc based on total soc at the soil surface global position and regional temperatures similar to smith et al 2019 at the gilmore city site it was necessary to increase the decomposition rate of the soc pools by about 30 at the woodslee site in order to simulate the appropriate level of n mineralization and subsequent n losses to tile drainage and runoff the simulated organic n levels in the soil profile remained stable over the five year study the n concentration in precipitation was set to the same total n input rate as for dndc with values of 0 5 mg n l 1 and 1 3 mg n l 1 for nh4 and no3 respectively the impermeable layer was set at 390 cm with a ksat rate of 0 01 cm h 1 in the bottom layer which limited flow and maintained a water table the brookes corey soil water retention model was used with curve fitting parameters being estimated internally in rzwqm2 based on measured water contents at saturation 1 10 bar 1 3 bar and 15 bar wilting point similar to dndc the crop parameters in rzwqm2 needed to be lowered to simulate the appropriate level of crop yields at the woodslee location particularly for soybean a number of the dssat crop parameters for maize ib 1068 dekalb 521 and soybean 990002 m group 2 were left as default particularly the ones controlling phenology however to optimize rmse for biomass for the calibration treatment at woodslee we reduced three crop parameters for maize and five parameters for soybean table s3 default parameters for winter wheat 990003 winter us were used at woodslee 2 5 statistical measures for testing model performance model performance of default dndc revised dndc and rzwqm2 were evaluated using several statistical measures including normalized average relative error nare normalized root mean square error nrmse nash sutcliffe model efficiency coefficient nse nash and sutcliffe 1970 and the d index wilmott and matsuura 2005 9 n a r e 100 1 n i 1 n p i o i o 10 n r m s e 100 1 n i 1 n o i p i 2 o 11 n s e 1 i 1 n o i p i 2 i 1 n o i o 2 12 d 1 i 1 n p i o i 2 i 1 n p i o o i o 2 where pi is the predicted or simulated value and oi is the observed value nare is the average percent over or under prediction of a model relative to measurements both nrmse and nare are commonly used to evaluate model performance for estimating yield and biomass jamieson et al 1991 indicated that a model had excellent performance if nrsme 10 good 20 fair 30 and poor 30 whereas ahuja et al 2000 indicated satisfactory performance if nare 15 for estimating yield and biomass nse and d statistics are commonly employed for estimating water and n leaching and runoff an nse value of greater than 0 indicates the model estimates are more accurate than the average of observations nse has a maximum value of 1 and a negative nse indicates poor model performance however nse is more sensitive to values that have higher deviation kraus et al 2005 and may in certain instances be close to zero or negative even when model results are very close to measurements but the measurements show little deviation thus it is important to also assess are and rmse the d index provides a qualitative assessment of model accuracy with d 0 9 showing an excellent agreement between model and observed values 0 8 d 0 9 indicates a good agreement 0 7 d 0 8 a fair agreement and d 0 7 a poor agreement for water drainage and n flow to tiles moriasi et al 2007 considered model performance to be satisfactory if nse 0 5 drainage was satisfactory if nare 25 and n loss to tiles if nare 70 3 results and discussion it was previously demonstrated that the default version of canada dndc performed well for simulating crop yields monthly water and n loss to tile drains at the gilmore city smith et al 2019 in this study we verified that the revised model performed well for these components however most of the emphasis was placed on testing the model for simulating soil water storage and daily n and water loss to tile drains at gilmore city for which it did not previously perform well and also for simulating drainage and runoff at the woodslee site in addition we tested the new functionality of the model for simulating controlled drainage and sub irrigation 3 1 simulation of crop yields the revised dndc model performed well in simulating crop yields at the gilmore city site table 4 giving similar results as both the previously tested models default dndc and rzwqm2 as reported by smith et al 2019 all three models demonstrated good to excellent performance nrmse 20 for yield estimates except for soybeans in the td cc sm treatment which were over predicted in 2007 and 2009 these were years which had lower seasonal gdd perhaps supressing observed yields the models were only calibrated in 2006 and 2008 table 2 thus they may have under predicted this impact it was interesting that the improvements to hydrology simulation as will be demonstrated in subsequent sections did not improve yield prediction for this site with average statistic being similarly good between models the rmse levels in this study were generally lower than those in jerecki et al 2018 where the estimates for maize were over 1100 kg dm ha 1 using dndc vcan at the woodslee location all models demonstrated good to excellent performance nrmse s 20 for simulating maize and soybean yields under the unrestricted tile drainage calibration and validation treatments table 4 note that revised dndc performed better than default dndc for maize and large improvements were observed for soybean likely as a result of the improved hydrology simulation crops are generally more water limited at woodslee due to more off season runoff and less growing season precipitation maize yields were also well simulated by both revised dndc and rzwqm2 for both the cc and ncc treatments under cds of course default dndc was not capable of simulating controlled drainage or sub irrigation both dndc and rzwqm2 showed fair performance in simulating soybean yield under cds cc but interestingly their performance was poor for cds ncc with about a 40 overestimation of yields revised dndc produced similar nrmse values as rzwqm2 demonstrating the value of running more than one model for a study both models simulated less crop water stress in this system with controlled drainage and sub irrigation in investigating measurements the cds ncc system appears to have behaved counterintuitive to what might have been expected since observed overall runoff drainage to tiles was about 10 less than the other 3 treatments table s4 yet crop yields and assumedly evapotranspiration were similar one explanation is that there may have been more deep seepage for this plot which is further discussed in subsequent sections 3 2 soil water storage at gilmore city as demonstrated by smith et al 2019 soil water storage was poorly simulated by default dndc and reasonably simulated by rzwqm2 this was the case across all four treatments some of the main issues were that dndc did not include root density functions a heterogeneous profile or unsaturated flow during this development we found that characterizing these aspects improved the model particularly the addition of root density functions higher root density near the soil surface resulted in more water uptake near the soil surface fig 2 0 6 cm depth thereby improving the water content simulation however the largest improvement for simulating soil water content resulted from the inclusion of a fluctuating water table and mechanistic tile drainage default dndc greatly under predicted soil water storage at deeper depths in the summer months primarily because crop roots had no access to the water table post development the roots could now penetrate beyond 50 cm to a depth defined by the user with fine roots penetrating 30 further and potentially allowing plant roots to access the water table this greatly improved the model fit for simulating soil water content at deeper depths fig 2 and soil water storage to 60 cm depth fig 3 as demonstrated by the statistical performance nse and d of default and revised dndc table 5 soil water storage was improved for all treatments from fair poor 0 69 d 0 79 performance to good excellent 0 81 d 0 90 performance all three models predicted the average magnitude of soil water content well during the 5 year study 1 3 nare 4 6 however revised dndc and rzwqm2 performed much better in predicting the trends over time revised dndc had similar performance as rzwqm2 for the cc treatments and had improved performance for the ncc treatments interestingly the soil water storage as predicted by rzwqm2 indicated that drainage from the profile was sometimes more delayed in relation to observations this may be related to an issue with using richard s equation since it assumes a consistent hydraulic gradient which often does not exist in heterogeneous agricultural soils beven and germann 2013 3 3 tile drainage at gilmore city the implementation of a water table mechanistic tile drainage and root penetration functions in dndc resulted in the simulation of a fluctuating water table that was distinctly similar to rzwqm2 fig s2 a similar level of water table draw down during the growing season occurred each year due to crop water uptake transpiration and also the rise in water table after rainfall events and the time required for drainage to the tile depth were similar as a result the simulated daily water flow to tile drains was often remarkably similar as is demonstrated in validation treatment td cc sm fig 4 the daily predicted drainage flows for revised dndc and rzwqm2 often overlapped we found that the inclusion of hooghoudt s equation was particularly crucial for simulating the correct timing of events which gave dndc the same functionality of commonly used water quality models such as rzwqm2 and drainmod skaggs et al 2012 default dndc which simulates bulk flux of water down the profile via the cascade approach simulated peak flow events that were too high and diminished too quickly however monthly flow was well simulated table 5 revised dndc demonstrated excellent performance d 0 90 nse 0 69 for simulating monthly water flow to tile drains for the three validation treatments with marginal improvements over default dndc which was previously found to perform well for monthly flow smith et al 2019 table 5 all three models predicted the correct average magnitude of drainage from td cc ms and td ncc ms treatments but under predicted the drainage from treatment td cc sm and over predicted it from td ncc sm observations indicated that more loss occurred to tile drains from td cc sm with cover crop 347 mm over 5 years than td ncc sm without cover crop 252 mm over 5 years which is unexpected this disparity may be attributed to measurement variability during peak flow events in 2007 and 2008 which were high smith et al 2019 this variability was not taken into account in the model performance statistics all three models predicted more transpiration and less water loss to tile drains in treatments with cover crops than without experimental studies generally report no difference in subsurface drainage drury et al 2014 qi et al 2011a 2011c kaspar et al 2007 or reduced drainage qi and helmers 2010 strock et al 2004 when a cover crop was present the performance of revised dndc for simulating daily drainage was improved in all treatments particularly for td cc ms and td ncc sm where nse values went from negative worse than the average of measurements to 0 5 table 5 note that daily measurements were only available in 2007 and 2008 qi et al 2011b the d statistic indicated that simulations changed from being characterized as poor to fair i e d from 0 68 to 0 74 to fair to good i e 0 76 to 0 88 average statistics across treatments were similar between revised dndc and rzwqm2 indicating that developments were successfully implemented in particular we found that the inclusion of mechanistic tile drainage improved the performance of revised dndc which is consistent with david et al 2009 who found that models designed to simulate tile drainage swat epic and drainmod n performed better for simulating bulk water flux than those which did not daycent dndcv 82a and dndcv 82h malone et al 2017 compared the performance of the hermes model to rzwqm2 for simulating water and n loss to tile drains the hermes model which did not include mechanistic drainage performed reasonably well but rzwqm2 performed better in simulating monthly drainage guest et al 2017 found that canada dndc performed similarly to daycent and stics models for simulating soil water dynamics but the three models all included cascade water flux approaches at the time in a cross canada assessment guest et al 2018 found that canada dndc performed a little better than the water budget models vsmb and holos but the water budget models did not explicitly simulate crop water stress and the feedbacks from crop growth and development the revised dndc improved the simulation of monthly n loss to tile drains demonstrating excellent performance across all treatments with better nse and d statistics than both default dndc and rzwqm2 note that n concentrations in tile drainage were measured less frequently than water volumes qi et al 2011b similar to water flow all 3 models under predicted n loss for the td cc sm treatment and over predicted for the td ncc sm treatment however similar to the models most studies show reduced n loss to tiles when a cover crop was included malone et al 2017 drury et al 2014 li et al 2008 kaspar et al 2007 parkin et al 2006 strock et al 2004 at the gilmore city site the difference in n loss between the treatments based on observations was not found to be significant qi et al 2011a and thus the higher average annual loss from td cc sm 39 9 kg ha 1 y 1 relative to td ncc sm 33 7 kg ha 1 y 1 may be related to measurement variability most of the development in this study focused on improving soil hydrology and drainage however we still found it necessary to adjust the way n moved and was simulated in dndc both u s dndc and dndcv can the model was adjusted to simulate n loss to tiles at the depth of the drains but also to only allow preferential n movement to occur when there was water movement this improved the timing of simulated n loss events as is demonstrated for validation treatment td ncc ms in fig 5 although the simulated upper soil profile was frozen and there was no water movement in the fall and winter of 2005 n loss to tiles was still simulated using default dndc simulating preferential n movement as a function of water flow the implementation of n loss to drains at the specified depth and improved simulation of hydrology were responsible for the improved statistics noted in table 5 3 4 impacts of hydrology developments on ghg emissions at gilmour city although measurements of n2o or ch4 emissions were not available at this site the impact of the hydrology developments was substantial for the revised model simulated n2o emissions were reduced by 41 on average across the 5 years with an example shown in fig s3 for the validation treatment td cc sm where emissions were reduced by 34 the reduced emissions were primarily caused by increased crop water uptake near the soil surface resulting in much lower soil water contents fig 2 in dndc nitrification and denitrification reactions occur primarily near the soil surface where substrates are high thus emissions were strongly impacted and reduced by the lower soil water content simulation in the surface 15 cm more emissions were simulated in the spring after snowmelt in revised dndc primarily because inorganic soil n was higher there was 11 1 kg ha 1 less simulated n loss to tiles during the winter period for revised dndc relative to default dndc because preferential n movement was prevented from occurring when there was no water flux note that in default dndc water tips to field capacity on an hourly basis however it is known that n2o production should occur above field capacity usually at about 80 wfps butterbach bahl et al 2013 the improvement of the hydrology framework will allow for future research whereby the denitrification reactions can be set to occur in the proper ranges of soil water and oxygen contents water content is also a driver of n2o diffusion and n2o production and consumption which can also now be targeted for improvement the soil at gilmour city has good drainage and is well aerated thus there was no simulated production of ch4 from methanogenisis for either model version however simulated ch4 uptake by oxidation increased from 0 38 to 0 628 kg c ha 1y 1 on average across the five year study for the revised model relative to the default model 3 5 runoff and tile drainage at woodslee although soil water contents were not available at the woodslee site there was an opportunity to benchmark the simulation of water and n loss to runoff along with the implementation of controlled drainage and sub irrigation for dndc in general the revised dndc model demonstrated good to excellent performance 0 83 d 0 96 table 6 fig 6 for simulating tile drainage for the validation treatments with notable improvement over default dndc d 0 68 poor performance for the unrestricted tile drainage treatments default dndc does not have the capability of simulating controlled drainage or sub irrigation and thus could not be evaluated for these aspects rzwqm2 showed good performance across all treatments which was certainly satisfactory but could perhaps have been improved if additional measured soil hydraulic properties were available below 20 cm depth at the site rzwqm2 uses the brookes corey four parameter nonlinear curve fitting model for fitting water retention data and a better fit can be provided if measured saturated and residual soil water contents pore size distribution and bubbling pressure are available even though revised dndc and rzwqm2 demonstrated good performance in simulating drainage events according to the d statistic the overall magnitude of drainage was well simulated for only 3 of the treatments for the cds ncc ms treatment observed water losses from runoff tile drainage were considerably lower table s4 than for the other three treatments evapotranspiration was not measured but it s unlikely that there was more water loss due to et since observed yields were similar between treatments it is possible that there was more deep seepage but we did not have available soil physical and hydraulic properties at deeper depths and deep seepage was assumed to be minimal which resulted in good results for 3 of 4 treatments the magnitude of runoff was very well predicted over the 5 year study for all but the cds ncc ms treatment however the statistics for simulating runoff events were poor unlike default dndc or rzwqm the nse was 0 for revised dndc for all validation treatments however the d statistic was low interestingly the statistics for cumulative runoff often being the only statistics provided by some studies guest et al 2018 were good to excellent with d 0 82 for both revised dndc and rzwqm2 across all treatments rzwqm2 overestimated runoff in the cds cc ms treatment fig 6 however as mentioned previously the hydraulic parameters employed in the brookes corey soil water retention model are very sensitive below 20 cm depth these parameters were estimated using an internal curve fitting routine rather than being supplied from measured data note that total runoff tile drainage were simulated with good model performance by rzwqm2 and excellent performance by revised dndc across all treatments similar to the gilmore city location the simulation of nitrogen loss to tiles by revised dndc was improved over default dndc at woodslee and revised dndc produced similar average statistics relative to rzwqm2 across the two cds treatments with fair model performance table 6 both models over predicted n loss during the early stages of the study then predicted less loss during 2002 with similar losses for the remainder of the study fig 6 n movement to tiles in dndc was strongly correlated with water movement fig 6a and b and overall the cumulative losses were well simulated d 0 76 the timing of n loss to runoff was not well simulated by either model but the cumulative loss was simulated with fair to excellent performance revised dndc predicted a large n runoff event on june 21 2002 at the time of 66 4 mm of precipitation which was not observed nor predicted by rzwqm2 it is likely that dndc under predicted the rate of n movement down the profile with too much n remaining in the top 2 layers 3 cm depth note that default dndc predicted nearly zero n in runoff as the fraction of n lost to runoff was set internally at a very low value and was only based on the top soil layer revised dndc simulated the appropriate reduction in n losses to tiles under controlled drainage relative to unrestricted drainage fig 6 table s4 the reduction in n loss to drains from cds for the cc treatments was 39 1 40 8 and 24 3 for observed revised dndc and rzwqm2 respectively fig 6 table s4 whereas cds reduced nitrate loss by 37 5 39 1 and 20 2 for the ncc treatments compared to unrestricted tile drainage table s4 reduced n loss to tiles for controlled drainage relative to unrestricted drainage is a common finding in many studies drury et al 2009 2014 tan et al 1993 2007 since soil n is a crucial driver for several biogeochemical processes the successful simulation by revised dndc expands the models accuracy and capabilities 4 conclusions inaccuracies in the simulation of water and n dynamics in the dndc model have strongly impacted and impeded the further development of several related biogeochemical processes particularly in the case of trace gas emission estimates prior to the developments implemented in this study dndc canada u s versions only simulated cascade water flux vertically down the soil profile without a mechanistic tile drainage algorithm we implemented a deeper and heterogeneous soil profile root penetration and density functions a fluctuating water table unsaturated flow above field capacity and the hooghoudt equation to simulate mechanistic tile drainage based on drain spacing depth and tile diameter after development simulations of soil water storage daily drainage n loss to runoff and n loss to tile drains were improved comparing well to measurements at two research sites and showing at least as good of performance as rzwqm2 this demonstrated that dndc development was successful considering rzwqm2 is a well validated water quality model which includes detailed computational hydrology the soil water input requirements for dndc were kept relatively low and the model simulation time remains 4 times faster than rzwqm2 which are important factors for larger scale assessments the revised dndc model did not simulate the timing of water or n losses to runoff well but performed satisfactory in simulating the cumulative magnitudes the simulation of runoff is complex particularly when surface crusting clay cracking preferential flow through insect and root channels snow dynamics and soil freeze thaw are prevalent and further research is recommended through these developments we have expanded the ability of dndc to simulate the impacts of tile drainage management such as drain depth and spacing controlled drainage and sub irrigation on soil water and n dynamics future studies should now focus on improving biogeochemical processes such as nitrification denitrification fermentation and mineralization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors acknowledge the funding support from science and technology branch agriculture and agri food canada under the scope of project modelling to identify resilient bmps j 001793 appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2019 104577 
26108,the denitrification decomposition model dndc has known limitations for simulating soil hydrology which can strongly influence biogeochemical processes for this study dndc s soil hydrological framework was enhanced by including a new sub model for mechanistic tile drainage improved water flux root growth dynamics and a deeper and heterogeneous soil profile comparisons were then conducted against the root zone water quality model rzwqm2 using measurements of soil water storage runoff and drainage in eastern canada and the us midwest simulation of soil water storage dndc 0 81 d 0 90 rzwqm2 0 76 d 0 84 daily water flow dndc 0 76 d 0 88 rzwqm2 0 77 d 0 90 and nitrogen loading to tile drains were improved post development dndc was able to capture the observed differences in water and n losses between conventional drainage and controlled drainage management with sub irrigation the enhancements to dndc s hydrological framework should enable the development of improved biogeochemical processes 1 introduction efficient management of water and nutrients in agricultural systems is essential to further improve profitability for producers and to reduce greenhouse gases ghg losses of excess nitrogen n phosphorus and ammonia which can contribute to global warming eutrophication of water bodies and increases in atmospheric fine particulate matter when considering the long term sustainability of agriculture it is of great importance to examine the interrelationships and trade offs between crop productivity and all environmental outcomes there are numerous field and laboratory studies worldwide which focus on mitigating losses of nutrients reducing ghg emissions and sequestering soil carbon in agricultural systems however due to extreme spatial and temporal variability in soils and climate tools are required for extrapolating the knowledge gained from these studies over space and time because process based models such as daycent del grosso et al 2001 the denitrification decomposition model dndc li et al 2012 the root zone water quality model rzwqm2 ahuja et al 2000 and apsim thorburn et al 2018 can dynamically simulate many of the interdependent process while maintaining a strict mass balance of nutrients and water they are valuable for predicting n losses in the environment and assisting in the selection of best management practices bmps de jong et al 2009 while they offer valuable opportunities for expanding the scope of existing assessments such models still have recognized knowledge gaps and thus require new targeted measurements for the development of improved mechanisms to ensure that the iterative process for model development continues for instance model structure is often limited by the oversimplified representation of soil and hydrological processes in a review of nine ghg models brilli et al 2017 found that 46 of the deficiencies in models were due to issues with the simulation of pedo climatic conditions including soil water simulation in the same review dndc was found to be the only model which simulated all c n related ghg emissions considered the dndc model is the most prominent process based model used for simulating ghg emissions worldwide however it has known issues in simulating soil hydrology smith et al 2019 he et al 2019 2018 brill et al 2017 congreves et al 2016 dutta et al 2016a cui et al 2014 abdalla et al 2011 deng et al 2011 these deficiencies impact the performance of the model for simulating c n cycling and the timing of n2o emissions he et al 2018 uzoma et al 2015 smith et al 2008 as a result it has been suggested in many of these studies that dndc development should be focused on improving the simulation of soil hydrology several iterations of the dndc model have been developed for different regions globally including new zealand dndc saggar et al 2007 landscape dndc haas et al 2013 china dndc li et al 2017 and canada dndc smith et al 2013 each one of these models can still be applied globally but they were developed to include additional processes and management options relevant to the locations where they were developed in the case of the canada dndc model dndc vcan it was designed to better simulate soil plant climate interactions in cool weather climate and has recently been improved for simulating evapotranspiration dutta et al 2016a ammonia volatilization dutta et al 2016b congreves et al 2016 impacts of snow cover and residue on soil temperature dutta et al 2018 and improved growth of cool weather crops he et al 2019 grant et al 2016 kroebel et al 2011 further model developments from canada dndc were integrated back into the primary u s release version smith et al 2019 however as with any model there remain shortcomings in the current model framework grant et al 2016 identified that mineralization rates were too low in dndc sometimes resulting in excessive crop n stress this can largely be attributed to the limitation that dndc only simulates soil c n processes over a 50 cm soil horizon also in a detailed assessment of water processes in canada dndc smith et al 2019 found that dndc predicted crop biomass and monthly water and n flow to tile drains well but did poorly in predicting soil water content and daily tile flow events in the same study another model rzwqm2 using more computational intensive hydrological processes predicted good results but rzwqm2 requires more expertise to employ greater simulation time and is not well validated for simulating some biogeochemical processes since soil biogeochemical processes including chemical equilibria nitrification denitrification and fermentation are highly dependent on soil water content smith et al 2019 recommended the inclusion of a heterogeneous profile that exceeds crop rooting depths root density functions improved water flow and mechanistic tile drainage there is considerable complexity in developing improved soil structure hydrology and tile drainage in dndcv can while ensuring that the reliant biogeochemical mechanisms still function appropriately but research has indicated that these improvements are critical towards the evolution of the model an accurate estimate of soil hydrology is important for predicting the timing of n2o emissions and n leaching events therefore the objectives of this study were i to improve dndc for simulating soil hydrology including the addition of a heterogeneous and deeper soil profile root density functions and improved water flow ii to incorporate a mechanistic tile drainage sub model and include the ability to simulate a fluctuating water table controlled drainage and sub irrigation and iii to compare the performance of dndc to the computationally intensive rzwqm2 using detailed datasets of runoff and drainage in eastern canada and the us midwest it was deemed important that model developments be implemented at the minimum level of complexity and computation time necessary for improving accuracy while keeping the user expertise at a manageable level 2 materials and methods 2 1 description of experimental sites 2 1 1 gilmore city iowa usa experimental site a five year field experiment was established in the fall of 2004 and lasted until the end of 2009 at the agricultural drainage and water quality research and demonstration site close to gilmore city in north central iowa usa the site soils are predominantly characterized as nicollet fine loamy mixed superactive aquic hapludoll webster fine loamy mesic typic endoaquolls canisteo fine loamy mesic typic endoaquolls and okoboji fine smectitic mesic cumulic vertic endoaquolls general site characteristic are shown in table 1 and detailed soils data by horizon are presented in table s1 four land cover treatments were initiated with the first two consisting of alternating phases of winter rye cover crop prior to maize or prior to soybean first phase of the rotation tiledrain covercrop maizesoybean td cc ms and second phase of the rotation tiledrain covercrop soybeanmaize td cc sm the next two treatments were alternating phases of maize and soybean with no cover crop first phase of rotation tiledrain nocovercrop maizesoybean td ncc ms and second phase of rotation tiledrain nocovercrop soybeanmaize td ncc sm table 2 aqueous ammonium nitrogen was applied to maize at a rate of 140 kg n ha 1 in the spring near emergence time the site includes a large compliment of measurements including water content across 4 depths crop yields biomass and daily measurement of water flow and n concentration to tile drains see qi et al 2011a b for a more detailed description of soil management and experimental setup 2 1 2 woodslee ontario canada experimental site a study was conducted at the honorable eugene f whalen experimental farm woodslee ontario canada 42 13 n 82 44 w to monitor surface runoff and tile drainage drury et al 2014 the brookston clay loam soil at the site is classified as an orthic humic gleysol canadian classification system or a poorly drained fine loamy mixed mesic typic argiaquoll in the usda system tables 1 and s1 the study was of 5 years duration starting in late 1999 and ending in early 2005 table 3 treatments included a maize soybean rotation and unrestricted tile drainage with td cc ms and without td ncc ms a winter wheat cover crop and also controlled drainage and sub irrigation with cds cc ms and without cds ncc ms a cover crop this data helped to facilitate testing the new controlled drainage sub irrigation feature in dndc both a starter 18 46 0 and sidedress application of uan 150 kg n ha 1 was applied to maize for a combined nitrogen rate of 175 kg n ha 1 maize grain was harvested in early november and tillage generally consisted of fall disking except when excessive residue required a more substantial cultivated heavy plow two flow meters were used in each plot to measure cumulative surface runoff and drainage flow samples of surface water and runoff were collected using an autosampler every 500 3000 l of flow and analysed for no3 concentration from june to july 2001 intact soil cores were collected for determination of bulk density saturated hydraulic conductivity and soil water retention at 9 matric potentials see drury et al 2014 for a more detailed description of soil management and experimental setup 2 2 model description 2 2 1 dndc model the dndc model was developed originally to simulate n2o emissions li et al 1992 and gained popularity due to its detailed biochemical equations describing nitrification and denitrification processes it was later expanded to simulate soil c n cycling water and n movement li et al 2006 and full farm nutrient cycling li et al 2012 and now contains sub models for simulating crop biomass decomposition nitrification denitrification fermentation and ammonia volatilization the model simulates a very wide array of agricultural management and crop types the input requirements are reasonable and it can be applied with relative ease as a result dndc has been used extensively worldwide ehrhardt et al 2018 brilli et al 2017 zhang and niu 2016 gilhespy et al 2014 giltrap et al 2010 many users have however reported that the model had issues in simulating soil water content smith et al 2008 2019 he et al 2018 brilli et al 2017 congreves et al 2016 dutta et al 2016a uzoma et al 2015 cui et al 2014 abdalla et al 2011 deng et al 2011 which is correlated with soil oxygen content a driver for the growth and death of nitrifier and denitrifier bacteria in dndc since soil water content impacts the type and rate of microbial reactions in dndc it can greatly impact n2o emissions furthermore since dndc only simulates soil c n cycling to a 50 cm depth processes such as nitrification denitrification nitrate leaching fermentation ammonium fixation and mineralization may be represented inaccurately to account for the limited depth of simulation dndc employs a simple layered cascade approach for simulating bulk water flux and n transport down the soil profile water drains to field capacity in each layer 2 cm thickness at the rate of ksat fig 1 both water flow and c n cycling are simulated to 50 cm depth through a homogeneous soil profile a deep water pool with a water holding capacity based on its bulk density is situated below the 50 cm soil profile to provide water for crop transpiration 50 cm soil profile 50 cm deep water pool 100 cm total water pool the model rooting depth is fixed with transpiration being drawn equally across all soil layers followed by extraction from the deep water pool when plants are under water stress to improve the simulation of water and n loss to tiles li et al 2006 incorporated a simple recession curve to delay drainage by soil layer but this is not active in the current u s dndc release version smith et al 2019 tested this approach and although the simulated drainage was improved soil water content was then overestimated by 22 and n2o emissions increased by 26 since 2011 a canadian version of dndc now referred to as dndcv can has been under development to improve the simulation of agricultural management and crop cultivars in cool weather climate smith et al 2019 compared dndcv can to rzwqm2 and found limitations in its ability to simulate soil hydrology thus suggested several improvements including a deeper and heterogeneous soil profile improved water flow down the profile root density functions a fluctuating water table and mechanistic tile drainage in this study we incorporate these developments while attempting to minimize extra model inputs complexity for users and computation time in this study canada dndc prior to development is referred to as default dndc and canada dndc post development is referred to as revised dndc 2 2 2 rzwqm2 rzwqm2 version 3 0 2015 ahuja et al 2000 ma et al 2012 was developed to simulate detailed biogeochemical processes in cropping systems with a major focus on simulating water quality the model simulates a wide array of agricultural management and has recently been expanded and improved for simulating n2o emissions fang et al 2015 jiang et al 2019 and phosphorous dynamics sadhukhan et al 2019 rzwqm2 includes dssat 4 0 crop models with ceres and cropgro components hoogenboom et al 2017 ma et al 2005 2006 which is a very well established framework for simulating crop growth and development worldwide rzwqm2 uses a numerical solution to determine water fluxes and includes the green ampt equation for infiltration the richards equation with an option for lateral hydraulic gradient for lateral water loss and the hooghoudt s equation for simulating quasi 2d tile drainage thus the model input requirements modeller expertise and computation time are greater than for dndc the model has been validated for simulating drainage and n loading to tiles at many locations in north america malone et al 2017 xian et al 2017 qi et al 2011b li et al 2008 thorp et al 2007 akhand et al 2003 and has been employed to investigate bmps for reducing n losses since rzwqm2 is a well recognized model for simulating soil hydrology it offers an excellent opportunity for benchmarking dndc developments 2 3 development of dndc to improve the simulation of soil hydrology and to include mechanistic tile drainage 2 3 1 heterogeneous and deeper soil profile the default dndc model only characterizes the top soil horizon and assumes a homogeneous profile throughout often this is not a good representation of agricultural soils which can have striking differences across depths as a result of changing textures and organic carbon contents therefore the model interface was restructured to allow for the user input of soil properties by definable layer depths soil properties that are now defined by depth include bulk density soil organic carbon ph soil texture field capacity wilting point porosity and saturated hydraulic conductivity the user can specify the depth of the soil profile up to 200 cm and define properties for up to 10 user defined depths the soil profile information can be saved such that it can be used for other simulations the modifications to the model interface were conducted in parallel with the model simulation depth being adjusted from 50 cm to 200 cm fig 1 the total number of simulated layers were increased to ensure that the calculated layer thickness remained in the same range 0 5 2 5 cm as it was previously for the 50 cm version of the model this was important since many processes are formulated to calculate the mass and energy flows based on this conceptual range of layer thickness it was decided that 200 cm would provide a sufficient depth to accommodate the effective root penetration of most commonly used crops and allow for the simulation of a fluctuating water table and tile drainage modifications to internal variables were conducted to ensure that soil properties water carbon nutrients and temperature could be tracked over the entire depth and these variables could be applied for estimating decomposition denitrification nitrification fermentation adsorption onto clay chemical equilibria and n movement functions as a result dndc was not only enhanced for simulating soil hydrology but also for the simulation of all biogeochemical processes up to a 200 cm depth 2 3 2 root penetration and density function the default dndc model calculates a linear estimate of root penetration to a maximum depth of only 50 cm without considering root density since water uptake for transpiration is partitioned equally across the profile this can result in the model underestimating water and n uptake near the surface and overestimating these components in the deeper profile further crops only have access to 100 cm of soil water when the deep water pool is included fig 1 thus deeper rooted crops can sometimes become water limited as a result of these limitations in the default model a root penetration equation based on growing degree days gdd pedersen et al 2010 was incorporated into dndc temperature or gdd are considered to be the main drivers for root growth and penetration kage et al 2000 thorup kristensen 2006 kirkegaard and lilley 2007 the equation expressed in terms of pgi plant growth index which is the fraction of accumulated degree days required for a plant to reach maturity in dndc is as follows 1 r z r z m i n p g i p g i l a g p g i p g i l a g k r z r z m i n p g i p g i l a g r z m a x p g i p g i l a g k r z r z m i n r z m a x where rz is the depth of root penetration rzmin is the planting depth pgilag accounts for the time period between planting and start of root penetration germination krz is the root depth penetration rate with values provided for some crops in pedersen et al 2010 rzmax is the maximum root penetration depth the rzmax value is user defined in the dndc input interface an algorithm for root distribution based on a study by gerwitz and page 1974 and further modified by yang et al 2009 to extend the rooting depth of fine roots by an additional 30 was also employed in dndc the root density declines logarithmically to the root penetration depth rz followed by a linear decrease to zero at 1 3rz the relative root length distribution is as follows 2 l r z e a z z z r z e a z z 1 z r z 0 3 r z r z z 1 3 r z where az is the shape parameter describing root distribution with increasing soil depth pedersen et al 2010 used values of az 2 for wheat and winter wheat and 1 5 for brassica s and we currently use a default value of 2 but the user can define the shape parameter and rooting depth based on field studies or from sources such as fan et al 2016 and benjamin et al 2013 2 3 3 simulating water flow the default cascade flow algorithm whereby water content per layer tips to field capacity on an hourly basis can result in an erroneously low prediction of soil water contents complex numerical schemes such as finite difference and finite element solutions of richard s equation can generally produce more accurate result however they are data and computation intensive it is possible to use pedotransfer functions to estimate water retention curves and other hydrological parameters for use in these equations but in doing so it can undermine much of the improved accuracy that is achieved using this approach further there is some uncertainty regarding the applicably of richards equation for highly heterogeneous agricultural soils in a review of water flow approaches beven and germann 2013 commented that in unsaturated heterogeneous soils there is rarely a consistent hydraulic gradient which richard s equation assumes since capillary potentials are not in equilibrium initially we investigated including an integrated richards equation approach with the van genuchten equation van genuchten 1980 for estimating soil water retention characteristics in dndc as presented in yang et al 2009 but once implemented the hydrology sub model time step needed to be reduced to such an extent that the computational time of dndc was greatly increased and we also found it difficult to obtain data to properly fit the van genuchten or other water retention equations during the course of development after the inclusion of a heterogeneous soil profile root density function and mechanistic tile drainage we found that the cascade approach could provide sufficient accuracy in estimating water contents flux we decided to keep the cascade flow approach intact but limited water movement above field capacity based on soil water status using the following simple approach derived by both averkjanov 1950 and irmay 1954 for estimating unsaturated conductivity 3 k k s a t   r  s  r n where k is hydraulic conductivity ksat is saturated hydraulic conductivity  is actual r residual and s saturated soil water content cm3 cm 3 this equation differs in power n where irmay used a value of 3 and averkjanov 3 5 our tests indicate that a value of 3 5 worked well in the range of soil water contents from field capacity to saturation the only incidence when k is calculated in revised dndc 2 3 4 fluctuating water table dndc was modified to simulate a fluctuating water table by adjusting the hydraulic conductivity of the deepest profile to near impermeable user defined value a water table slowly builds up from the bottom soil layer with deep seepage at the lower boundary the water table is maintained as a mass balance of incoming water from precipitation and irrigation and outgoing water from runoff evapotranspiration tile drainage deep seepage and change in soil water content in unsaturated layers for the purposes of estimating tile flow rate the water table height was calculated at the top of the saturated soil layer closest to the soil surface 2 3 5 incorporating a tile drainage sub model similar to rzwqm2 and drainmod skaggs et al 2012 the steady state hooghoudt equation was also included in dndc the drawdown of water table height is not fully steady state however the rate of change usually proceeds slow enough that the hooghoudt equation can be used effectively skaggs et al 2012 a recent study by xian et al 2017 when assessing the performance of rzwqm2 using the original steady state equation and two transient equations found that there was no significant difference in model performance for hourly drainage simulation the hooghoudt equation as written in skaggs et al 2012 is 4 q 4 k e m 2 d e m l 2 where q cm h 1 is the drainage discharge rate ke cm h 1 is the effective lateral hydraulic conductivity m is the water table level above the drain at midpoint between the drains de is the equivalent depth to the impermeable or restrictive layer below the drain and l is the drain spacing equations to estimate ke and de below were outlined in xian et al 2017 5 k e i 1 i n d i k i i 1 i n d i where n is the number of soil layers di is the thickness of layer i cm and ki is the lateral hydraulic conductivity of layer i cm h 1 as indicated in xian et al 2017 the calculation of de depends on the actual depth d of the soil profile 6 if d l 0 3 d e d 1 d l 8  l n d r c o n where 7 c o n 3 55 1 6 d l 2 d l 2 8 if d l 0 3 d e l 8  l n l r 1 15 where r is the radius of the drain m 2 3 6 movement of nitrogen to runoff tile drains and through the soil profile the primary development aim of this study was to improve estimation of soil hydrology and thus the existing n movement mechanisms in dndc were not extensively modified the default nitrate movement in dndc is described simply as a function of the water flux and nitrate concentration per layer soil nitrate was considered to be mobilized by a positive water flux 90 mobilized and transferred to the layer below as a one dimensional vertical n flux towards the bottom soil profile additionally another fraction 10 of the no3 in a layer was considered to be lost through preferential water flow via macropores directly out of the soil profile this preferential loss was calculated regardless of whether the soil layer directly below also met the condition of having a positive water flux for simulations now with tile drainage the movement of nitrate is an iterative step through each of the saturated layers per hour that are drained to tiles in dndcv can this preferential n leaching function was modified to ensure correlation with water movement it was previously found that dndc sometimes simulated n losses when there was no water flux out of the bottom of the soil profile in dndcv can the fraction of no3 available to be transferred to the layer below at an hourly time step can now be parameterized through the user interface with a default value of 0 9 the fraction per layer that is preferentially lost directly to drains i e it bypasses the iterative layer loop is set to a default fraction of 0 02 nitrate losses to tile drains are calculated starting from the layer situated at the top of the saturated water table down to the layer at the bottom of the tile drains additionally we found that in default dndc nitrate losses to runoff were always very low irrespective of the soil conditions water inputs or crop management employed to address this issue we first fixed a water mass balance error in the scs runoff curve number method second the model was modified to simulate a fluctuating water table and when the water table reaches the soil surface runoff and additional loss of n could then occur further n loss to runoff was originally calculated as a fraction of rainfall that goes to runoff based on scs method multiplied by the nitrate found in only the top surface layer 0 5 2 cm we extended this calculation to the top 2 layers 1 4 cm and included a user defined parameter where the fraction can be adjusted 2 4 initialization calibration and validation at both the gilmore city and woodslee research locations the td cc ms treatment was used for model calibration and the remaining 3 treatments were used for validation a similar trial and error method for calibration as conducted in smith et al 2019 was used where the rmse for simulated yield drainage and n loss to tiles was minimized this was conducted for default dndc revised dndc and rzwqm2 in all simulations a 10 year spin up was included prior to the experimental periods to stabilize soil c n and water experimental data from the sites was used to initialize the models this data included soil properties such as soil texture bulk density field capacity wilting point porosity saturated hydraulic conductivity and soil organic carbon content table s1 note that soil data was only available at two depths at the woodslee site thus the properties from the 10 20 cm depth were extrapolated down to 200 cm daily weather data including min and max temperature precipitation wind speed solar radiation and relative humidity were available at both sites for all years of the studies management data including tillage scheduling and implements and fertilizer scheduling and application rates was also available for the gilmore city site default dndc and rzwqm2 have previously been calibrated and validated smith et al 2019 in this study we compare the performance of the revised dndc model to those results after the hydrology developments had been implemented the revised model was calibrated using the same approach as the other two models crop soil and tile drainage parameters used in the study for default and revised dndc are shown in table s2 and crop parameters used in rzwqm2 are shown in table s3 note that a winter rye cultivar was not available in rzwqm2 thus qi et al 2011b developed parameters based on a winter wheat cultivar and these were further modified for a more recent version of rzwqm2 by smith et al 2019 2 4 1 calibration of crop parameters in dndc for revised dndc several crop parameters were calibrated however parameters remained close to those used by default dndc the thermal degree days to maturity tdd was increased marginally for both maize and soybean table s2 water requirement for maize and soybean were reduced at gilmore city soybean was set to 340 g water per g dry matter which is very close to the default 350 value for the u s release version in default dndc plant roots only had access to the top 100 cm of the profile and had no access to a water table which was a structural deficiency the crop water requirements needed to be increased in the default model to simulate an appropriate level of crop water uptake evapotranspiration and drainage which often resulted in soil water content that was too low in the growing season smith et al 2019 in the revised model appropriate rooting depth and uptake from a fluctuating water table was simulated thus crops were less water stressed and crop water requirements were calibrated to be on average 15 lower for maize and 23 lower for soybean at the woodslee location the average soybean yields were only 60 of that at gilmore city we believe this was partly due to different varieties being used than at gilmore city a different variety was planted every year at woodlsee as the soybean variety a2553 was no longer available in 2005 and a shorter season variety was planted in 2003 as a result of a late plant date drury et al 2014 we used a lower maximum grain c parameter optimum yield at woodslee for soybean table 2 however the main contributing factor was likely that more crop water stress occurred at woodslee this was attributed to greater runoff due to a lower permeability soil and more precipitation occurring in the off season months also woodslee receives less average precipitation on average during the growing season than at gilmore city fig s1 in default dndc rooting depth is always constant at 50 cm in revised dndc we set a lower max root depth at woodslee site 0 8 m for maize and 1 1 m for soybean since there is higher clay content and lower root penetration table s2 this helped minimize rmse for yields and drainage rooting depth in dndc was set considerably lower than in rzwqm2 which has max possible root depth of 1 8 m for both maize and soybean for the winter rye cover crop at gilmore city the parameters used in smith et al 2019 for default dndc were employed for revised dndc default parameters for both default and revised dndc were used for the winter wheat cover crop grown at the woodslee site the winter rye and winter wheat cover crop never reached the grain filling stage before being terminated in any of the treatments simulated a similar magnitude of winter wheat biomass was simulated for dndc and rzwqm2 at woodslee but no measured data was available for validation 2 4 2 calibration of soil and drainage parameters in dndc the drainage development required the integration of additional input parameters to the dndc interface including drain depth spacing and radius depth to bedrock and ksat at each depth lateral ksat is estimated as 2 ksat qi et al 2011b which is needed to calculate ke for use in the hooghoudt equation in general it is very difficult to get a good measure of in situ ksat particularly at deeper soil depths laboratory measurements of ksat using soil cores and the traditional saturated flow desorption method can in fact be over an order of magnitude greater than in situ measured ksat smith et al 1995 in this study we used the ksat values from qi et al 2011b for the gilmore city site and adjusted ksat with depth for the woodslee site to values that would provide a good estimate of tile drainage using both dndc and rzwqm2 table s1 during the calibration process for default dndc it was necessary to reduce the size of the slow humus soil organic carbon soc pool from a default value of 0 95 to 0 7 to provide sufficient n mineralization when simulating the observed levels of n losses at the gilmore city site smith et al 2019 using revised dndc it was only necessary to reduce this parameter to 0 90 the revised dndc model simulates decomposition to 200 cm and thus it estimates a more plausible rate of mineralization which was previously noted to be a model weakness in some studies grant et al 2016 smith et al 2008 similar to the gilmore city location for default dndc it was necessary to reduce the size of the slow humus soc pool in default dndc from 0 95 to 0 75 to simulate the correct magnitude of n losses in the calibration treatment at woodslee using revised dndc this value was decreased only to 0 91 the scs curves number for estimating runoff in revised dndc at gilmore city was set to 64 the same value as used for default dndc smith et al 2019 a value of 87 was used at woodslee for both model versions to account for a lower permeability soil and thus simulate the correct level of runoff for the calibration treatment preferential movement of n was set to 2 in revised dndc to allow rapid movement of a small portion of n to drains without moving through the soil matrix this improved the model performance at both sites the n concentration in precipitation was set to 1 8 mg n l 1 the same value as used at the gilmore city site qi et al 2011b the microbial parameters related to nitrification and denitrification rates were left as default however during the course of development we added several new parameters into the dndc input interface such that they could potentially be adjusted the rate of microbial activity can vary greatly between soil types and locations 2 4 3 calibration of rzwqm2 at woodslee site a similar procedure employed in smith et al 2019 and qi et al 2011b at the gilmore city site was used for calibrating rzwqm2 at the woodslee site measured soil properties were input into the model according to table s1 initial soil moisture was set to saturation below the 60 cm depth at the beginning of the 10 year spin up to initiate the simulation of a water table the magnitude of the initial soil carbon was based on site measurements however the partitioning of the soc pools was determined by using a built in tool for equilibrating soc based on total soc at the soil surface global position and regional temperatures similar to smith et al 2019 at the gilmore city site it was necessary to increase the decomposition rate of the soc pools by about 30 at the woodslee site in order to simulate the appropriate level of n mineralization and subsequent n losses to tile drainage and runoff the simulated organic n levels in the soil profile remained stable over the five year study the n concentration in precipitation was set to the same total n input rate as for dndc with values of 0 5 mg n l 1 and 1 3 mg n l 1 for nh4 and no3 respectively the impermeable layer was set at 390 cm with a ksat rate of 0 01 cm h 1 in the bottom layer which limited flow and maintained a water table the brookes corey soil water retention model was used with curve fitting parameters being estimated internally in rzwqm2 based on measured water contents at saturation 1 10 bar 1 3 bar and 15 bar wilting point similar to dndc the crop parameters in rzwqm2 needed to be lowered to simulate the appropriate level of crop yields at the woodslee location particularly for soybean a number of the dssat crop parameters for maize ib 1068 dekalb 521 and soybean 990002 m group 2 were left as default particularly the ones controlling phenology however to optimize rmse for biomass for the calibration treatment at woodslee we reduced three crop parameters for maize and five parameters for soybean table s3 default parameters for winter wheat 990003 winter us were used at woodslee 2 5 statistical measures for testing model performance model performance of default dndc revised dndc and rzwqm2 were evaluated using several statistical measures including normalized average relative error nare normalized root mean square error nrmse nash sutcliffe model efficiency coefficient nse nash and sutcliffe 1970 and the d index wilmott and matsuura 2005 9 n a r e 100 1 n i 1 n p i o i o 10 n r m s e 100 1 n i 1 n o i p i 2 o 11 n s e 1 i 1 n o i p i 2 i 1 n o i o 2 12 d 1 i 1 n p i o i 2 i 1 n p i o o i o 2 where pi is the predicted or simulated value and oi is the observed value nare is the average percent over or under prediction of a model relative to measurements both nrmse and nare are commonly used to evaluate model performance for estimating yield and biomass jamieson et al 1991 indicated that a model had excellent performance if nrsme 10 good 20 fair 30 and poor 30 whereas ahuja et al 2000 indicated satisfactory performance if nare 15 for estimating yield and biomass nse and d statistics are commonly employed for estimating water and n leaching and runoff an nse value of greater than 0 indicates the model estimates are more accurate than the average of observations nse has a maximum value of 1 and a negative nse indicates poor model performance however nse is more sensitive to values that have higher deviation kraus et al 2005 and may in certain instances be close to zero or negative even when model results are very close to measurements but the measurements show little deviation thus it is important to also assess are and rmse the d index provides a qualitative assessment of model accuracy with d 0 9 showing an excellent agreement between model and observed values 0 8 d 0 9 indicates a good agreement 0 7 d 0 8 a fair agreement and d 0 7 a poor agreement for water drainage and n flow to tiles moriasi et al 2007 considered model performance to be satisfactory if nse 0 5 drainage was satisfactory if nare 25 and n loss to tiles if nare 70 3 results and discussion it was previously demonstrated that the default version of canada dndc performed well for simulating crop yields monthly water and n loss to tile drains at the gilmore city smith et al 2019 in this study we verified that the revised model performed well for these components however most of the emphasis was placed on testing the model for simulating soil water storage and daily n and water loss to tile drains at gilmore city for which it did not previously perform well and also for simulating drainage and runoff at the woodslee site in addition we tested the new functionality of the model for simulating controlled drainage and sub irrigation 3 1 simulation of crop yields the revised dndc model performed well in simulating crop yields at the gilmore city site table 4 giving similar results as both the previously tested models default dndc and rzwqm2 as reported by smith et al 2019 all three models demonstrated good to excellent performance nrmse 20 for yield estimates except for soybeans in the td cc sm treatment which were over predicted in 2007 and 2009 these were years which had lower seasonal gdd perhaps supressing observed yields the models were only calibrated in 2006 and 2008 table 2 thus they may have under predicted this impact it was interesting that the improvements to hydrology simulation as will be demonstrated in subsequent sections did not improve yield prediction for this site with average statistic being similarly good between models the rmse levels in this study were generally lower than those in jerecki et al 2018 where the estimates for maize were over 1100 kg dm ha 1 using dndc vcan at the woodslee location all models demonstrated good to excellent performance nrmse s 20 for simulating maize and soybean yields under the unrestricted tile drainage calibration and validation treatments table 4 note that revised dndc performed better than default dndc for maize and large improvements were observed for soybean likely as a result of the improved hydrology simulation crops are generally more water limited at woodslee due to more off season runoff and less growing season precipitation maize yields were also well simulated by both revised dndc and rzwqm2 for both the cc and ncc treatments under cds of course default dndc was not capable of simulating controlled drainage or sub irrigation both dndc and rzwqm2 showed fair performance in simulating soybean yield under cds cc but interestingly their performance was poor for cds ncc with about a 40 overestimation of yields revised dndc produced similar nrmse values as rzwqm2 demonstrating the value of running more than one model for a study both models simulated less crop water stress in this system with controlled drainage and sub irrigation in investigating measurements the cds ncc system appears to have behaved counterintuitive to what might have been expected since observed overall runoff drainage to tiles was about 10 less than the other 3 treatments table s4 yet crop yields and assumedly evapotranspiration were similar one explanation is that there may have been more deep seepage for this plot which is further discussed in subsequent sections 3 2 soil water storage at gilmore city as demonstrated by smith et al 2019 soil water storage was poorly simulated by default dndc and reasonably simulated by rzwqm2 this was the case across all four treatments some of the main issues were that dndc did not include root density functions a heterogeneous profile or unsaturated flow during this development we found that characterizing these aspects improved the model particularly the addition of root density functions higher root density near the soil surface resulted in more water uptake near the soil surface fig 2 0 6 cm depth thereby improving the water content simulation however the largest improvement for simulating soil water content resulted from the inclusion of a fluctuating water table and mechanistic tile drainage default dndc greatly under predicted soil water storage at deeper depths in the summer months primarily because crop roots had no access to the water table post development the roots could now penetrate beyond 50 cm to a depth defined by the user with fine roots penetrating 30 further and potentially allowing plant roots to access the water table this greatly improved the model fit for simulating soil water content at deeper depths fig 2 and soil water storage to 60 cm depth fig 3 as demonstrated by the statistical performance nse and d of default and revised dndc table 5 soil water storage was improved for all treatments from fair poor 0 69 d 0 79 performance to good excellent 0 81 d 0 90 performance all three models predicted the average magnitude of soil water content well during the 5 year study 1 3 nare 4 6 however revised dndc and rzwqm2 performed much better in predicting the trends over time revised dndc had similar performance as rzwqm2 for the cc treatments and had improved performance for the ncc treatments interestingly the soil water storage as predicted by rzwqm2 indicated that drainage from the profile was sometimes more delayed in relation to observations this may be related to an issue with using richard s equation since it assumes a consistent hydraulic gradient which often does not exist in heterogeneous agricultural soils beven and germann 2013 3 3 tile drainage at gilmore city the implementation of a water table mechanistic tile drainage and root penetration functions in dndc resulted in the simulation of a fluctuating water table that was distinctly similar to rzwqm2 fig s2 a similar level of water table draw down during the growing season occurred each year due to crop water uptake transpiration and also the rise in water table after rainfall events and the time required for drainage to the tile depth were similar as a result the simulated daily water flow to tile drains was often remarkably similar as is demonstrated in validation treatment td cc sm fig 4 the daily predicted drainage flows for revised dndc and rzwqm2 often overlapped we found that the inclusion of hooghoudt s equation was particularly crucial for simulating the correct timing of events which gave dndc the same functionality of commonly used water quality models such as rzwqm2 and drainmod skaggs et al 2012 default dndc which simulates bulk flux of water down the profile via the cascade approach simulated peak flow events that were too high and diminished too quickly however monthly flow was well simulated table 5 revised dndc demonstrated excellent performance d 0 90 nse 0 69 for simulating monthly water flow to tile drains for the three validation treatments with marginal improvements over default dndc which was previously found to perform well for monthly flow smith et al 2019 table 5 all three models predicted the correct average magnitude of drainage from td cc ms and td ncc ms treatments but under predicted the drainage from treatment td cc sm and over predicted it from td ncc sm observations indicated that more loss occurred to tile drains from td cc sm with cover crop 347 mm over 5 years than td ncc sm without cover crop 252 mm over 5 years which is unexpected this disparity may be attributed to measurement variability during peak flow events in 2007 and 2008 which were high smith et al 2019 this variability was not taken into account in the model performance statistics all three models predicted more transpiration and less water loss to tile drains in treatments with cover crops than without experimental studies generally report no difference in subsurface drainage drury et al 2014 qi et al 2011a 2011c kaspar et al 2007 or reduced drainage qi and helmers 2010 strock et al 2004 when a cover crop was present the performance of revised dndc for simulating daily drainage was improved in all treatments particularly for td cc ms and td ncc sm where nse values went from negative worse than the average of measurements to 0 5 table 5 note that daily measurements were only available in 2007 and 2008 qi et al 2011b the d statistic indicated that simulations changed from being characterized as poor to fair i e d from 0 68 to 0 74 to fair to good i e 0 76 to 0 88 average statistics across treatments were similar between revised dndc and rzwqm2 indicating that developments were successfully implemented in particular we found that the inclusion of mechanistic tile drainage improved the performance of revised dndc which is consistent with david et al 2009 who found that models designed to simulate tile drainage swat epic and drainmod n performed better for simulating bulk water flux than those which did not daycent dndcv 82a and dndcv 82h malone et al 2017 compared the performance of the hermes model to rzwqm2 for simulating water and n loss to tile drains the hermes model which did not include mechanistic drainage performed reasonably well but rzwqm2 performed better in simulating monthly drainage guest et al 2017 found that canada dndc performed similarly to daycent and stics models for simulating soil water dynamics but the three models all included cascade water flux approaches at the time in a cross canada assessment guest et al 2018 found that canada dndc performed a little better than the water budget models vsmb and holos but the water budget models did not explicitly simulate crop water stress and the feedbacks from crop growth and development the revised dndc improved the simulation of monthly n loss to tile drains demonstrating excellent performance across all treatments with better nse and d statistics than both default dndc and rzwqm2 note that n concentrations in tile drainage were measured less frequently than water volumes qi et al 2011b similar to water flow all 3 models under predicted n loss for the td cc sm treatment and over predicted for the td ncc sm treatment however similar to the models most studies show reduced n loss to tiles when a cover crop was included malone et al 2017 drury et al 2014 li et al 2008 kaspar et al 2007 parkin et al 2006 strock et al 2004 at the gilmore city site the difference in n loss between the treatments based on observations was not found to be significant qi et al 2011a and thus the higher average annual loss from td cc sm 39 9 kg ha 1 y 1 relative to td ncc sm 33 7 kg ha 1 y 1 may be related to measurement variability most of the development in this study focused on improving soil hydrology and drainage however we still found it necessary to adjust the way n moved and was simulated in dndc both u s dndc and dndcv can the model was adjusted to simulate n loss to tiles at the depth of the drains but also to only allow preferential n movement to occur when there was water movement this improved the timing of simulated n loss events as is demonstrated for validation treatment td ncc ms in fig 5 although the simulated upper soil profile was frozen and there was no water movement in the fall and winter of 2005 n loss to tiles was still simulated using default dndc simulating preferential n movement as a function of water flow the implementation of n loss to drains at the specified depth and improved simulation of hydrology were responsible for the improved statistics noted in table 5 3 4 impacts of hydrology developments on ghg emissions at gilmour city although measurements of n2o or ch4 emissions were not available at this site the impact of the hydrology developments was substantial for the revised model simulated n2o emissions were reduced by 41 on average across the 5 years with an example shown in fig s3 for the validation treatment td cc sm where emissions were reduced by 34 the reduced emissions were primarily caused by increased crop water uptake near the soil surface resulting in much lower soil water contents fig 2 in dndc nitrification and denitrification reactions occur primarily near the soil surface where substrates are high thus emissions were strongly impacted and reduced by the lower soil water content simulation in the surface 15 cm more emissions were simulated in the spring after snowmelt in revised dndc primarily because inorganic soil n was higher there was 11 1 kg ha 1 less simulated n loss to tiles during the winter period for revised dndc relative to default dndc because preferential n movement was prevented from occurring when there was no water flux note that in default dndc water tips to field capacity on an hourly basis however it is known that n2o production should occur above field capacity usually at about 80 wfps butterbach bahl et al 2013 the improvement of the hydrology framework will allow for future research whereby the denitrification reactions can be set to occur in the proper ranges of soil water and oxygen contents water content is also a driver of n2o diffusion and n2o production and consumption which can also now be targeted for improvement the soil at gilmour city has good drainage and is well aerated thus there was no simulated production of ch4 from methanogenisis for either model version however simulated ch4 uptake by oxidation increased from 0 38 to 0 628 kg c ha 1y 1 on average across the five year study for the revised model relative to the default model 3 5 runoff and tile drainage at woodslee although soil water contents were not available at the woodslee site there was an opportunity to benchmark the simulation of water and n loss to runoff along with the implementation of controlled drainage and sub irrigation for dndc in general the revised dndc model demonstrated good to excellent performance 0 83 d 0 96 table 6 fig 6 for simulating tile drainage for the validation treatments with notable improvement over default dndc d 0 68 poor performance for the unrestricted tile drainage treatments default dndc does not have the capability of simulating controlled drainage or sub irrigation and thus could not be evaluated for these aspects rzwqm2 showed good performance across all treatments which was certainly satisfactory but could perhaps have been improved if additional measured soil hydraulic properties were available below 20 cm depth at the site rzwqm2 uses the brookes corey four parameter nonlinear curve fitting model for fitting water retention data and a better fit can be provided if measured saturated and residual soil water contents pore size distribution and bubbling pressure are available even though revised dndc and rzwqm2 demonstrated good performance in simulating drainage events according to the d statistic the overall magnitude of drainage was well simulated for only 3 of the treatments for the cds ncc ms treatment observed water losses from runoff tile drainage were considerably lower table s4 than for the other three treatments evapotranspiration was not measured but it s unlikely that there was more water loss due to et since observed yields were similar between treatments it is possible that there was more deep seepage but we did not have available soil physical and hydraulic properties at deeper depths and deep seepage was assumed to be minimal which resulted in good results for 3 of 4 treatments the magnitude of runoff was very well predicted over the 5 year study for all but the cds ncc ms treatment however the statistics for simulating runoff events were poor unlike default dndc or rzwqm the nse was 0 for revised dndc for all validation treatments however the d statistic was low interestingly the statistics for cumulative runoff often being the only statistics provided by some studies guest et al 2018 were good to excellent with d 0 82 for both revised dndc and rzwqm2 across all treatments rzwqm2 overestimated runoff in the cds cc ms treatment fig 6 however as mentioned previously the hydraulic parameters employed in the brookes corey soil water retention model are very sensitive below 20 cm depth these parameters were estimated using an internal curve fitting routine rather than being supplied from measured data note that total runoff tile drainage were simulated with good model performance by rzwqm2 and excellent performance by revised dndc across all treatments similar to the gilmore city location the simulation of nitrogen loss to tiles by revised dndc was improved over default dndc at woodslee and revised dndc produced similar average statistics relative to rzwqm2 across the two cds treatments with fair model performance table 6 both models over predicted n loss during the early stages of the study then predicted less loss during 2002 with similar losses for the remainder of the study fig 6 n movement to tiles in dndc was strongly correlated with water movement fig 6a and b and overall the cumulative losses were well simulated d 0 76 the timing of n loss to runoff was not well simulated by either model but the cumulative loss was simulated with fair to excellent performance revised dndc predicted a large n runoff event on june 21 2002 at the time of 66 4 mm of precipitation which was not observed nor predicted by rzwqm2 it is likely that dndc under predicted the rate of n movement down the profile with too much n remaining in the top 2 layers 3 cm depth note that default dndc predicted nearly zero n in runoff as the fraction of n lost to runoff was set internally at a very low value and was only based on the top soil layer revised dndc simulated the appropriate reduction in n losses to tiles under controlled drainage relative to unrestricted drainage fig 6 table s4 the reduction in n loss to drains from cds for the cc treatments was 39 1 40 8 and 24 3 for observed revised dndc and rzwqm2 respectively fig 6 table s4 whereas cds reduced nitrate loss by 37 5 39 1 and 20 2 for the ncc treatments compared to unrestricted tile drainage table s4 reduced n loss to tiles for controlled drainage relative to unrestricted drainage is a common finding in many studies drury et al 2009 2014 tan et al 1993 2007 since soil n is a crucial driver for several biogeochemical processes the successful simulation by revised dndc expands the models accuracy and capabilities 4 conclusions inaccuracies in the simulation of water and n dynamics in the dndc model have strongly impacted and impeded the further development of several related biogeochemical processes particularly in the case of trace gas emission estimates prior to the developments implemented in this study dndc canada u s versions only simulated cascade water flux vertically down the soil profile without a mechanistic tile drainage algorithm we implemented a deeper and heterogeneous soil profile root penetration and density functions a fluctuating water table unsaturated flow above field capacity and the hooghoudt equation to simulate mechanistic tile drainage based on drain spacing depth and tile diameter after development simulations of soil water storage daily drainage n loss to runoff and n loss to tile drains were improved comparing well to measurements at two research sites and showing at least as good of performance as rzwqm2 this demonstrated that dndc development was successful considering rzwqm2 is a well validated water quality model which includes detailed computational hydrology the soil water input requirements for dndc were kept relatively low and the model simulation time remains 4 times faster than rzwqm2 which are important factors for larger scale assessments the revised dndc model did not simulate the timing of water or n losses to runoff well but performed satisfactory in simulating the cumulative magnitudes the simulation of runoff is complex particularly when surface crusting clay cracking preferential flow through insect and root channels snow dynamics and soil freeze thaw are prevalent and further research is recommended through these developments we have expanded the ability of dndc to simulate the impacts of tile drainage management such as drain depth and spacing controlled drainage and sub irrigation on soil water and n dynamics future studies should now focus on improving biogeochemical processes such as nitrification denitrification fermentation and mineralization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors acknowledge the funding support from science and technology branch agriculture and agri food canada under the scope of project modelling to identify resilient bmps j 001793 appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2019 104577 
26109,understanding the range of approaches available for assessing the impacts of agricultural changes at landscape scale is important when addressing local to global issues using a topic modelling approach we reviewed the literature on impact modelling of agricultural landscapes a search in web of science using the keywords model agricultural systems and landscape yielded 1 975 hits of which 514 papers met our selection criteria the most salient terms fell within six groups change scale pollution biodiversity practices and terms on biophysical regulatory conditions we identified four main topics water quality water quantity energy crops biodiversity and integrated assessment water management issues were more likely to be covered in north american researches while issues related to integrated assessment were mainly covered in european studies we found no relationship between topic and model type we conclude that future integrated studies should consider the diversity of agricultural systems in governance of water and biodiversity issues keywords water quality water quantity integrated assessment biodiversity conservation topic modelling 1 introduction spatial expansion and intensification of agriculture in recent decades has had tremendous environmental impacts on agricultural landscapes foley et al 2011 these landscapes are defined as systems in which interactions occur between farmers and their natural and social resources including management of fields field margins and associated semi natural habitats benot et al 2012 modern agriculture is contributing to water degradation increased energy use and greenhouse gas emissions together with widespread pollution and loss of biodiversity foley et al 2011 these impacts take place beyond the field and farm levels necessitating a landscape approach if they are to be addressed properly at the relevant scale s through relevant research disciplines and methods impacts resulting from spatial interactions need to be considered at larger scales than point effects this can be watershed scale when considering water quality or quantity e g frey et al 2013 gngr and gnc 2013 fan and shibata 2015 carvalho santos et al 2016 or landscape scale when considering spatial flows of pathogens e g hossard et al 2013 nectar foraging species e g baveco et al 2016 etc many studies have examined sustainability at field or farm scale e g zahm et al 2008 pelzer et al 2012 craheix et al 2016 but upscaling their results to larger spatial or temporal scales may be difficult and produce uncertain conclusions dalgaard et al 2003 however such upscaling may be necessary to understand the impact of different land uses crops and or cropping techniques on landscape performance sustainability and ecosystem services tscharntke et al 2005 because of the multiple temporal and spatial scales involved assessment of agricultural landscapes is challenging and requires modelling approaches to study system changes and their impacts modelling allows the complex processes occurring to be simplified in order to explore the impacts of possible changes land use crop practices that cannot be distinguished in the real world e g legg 2004 skelsey et al 2010 different modelling approaches can be used for designing and or assessing landscape performance in the face of change depending on the topic studied and available knowledge these approaches may involve empirical models e g bennett et al 2014 process based models e g santhi et al 2014 optimisation models e g huang et al 2012 agent based models e g brady et al 2012 statistical models e g gottschalk et al 2007 or a combination of these types of models e g schnhart et al 2016 in such studies the objective in designing alternatives is to compare their impacts with appropriate indicators with simulation models being used to predict values for these indicators clavel et al 2012 different methods can be used to design alternatives ranging from simulation studies comparable to sensitivity analyses on cropping practices and or their proportion location to participatory approaches scenarios which describe possible futures that reflect different perspectives on past present and future developments van notten 2005 are currently used in participatory approaches they usually include a description of the initial situation for comparison with alternatives and often also the drivers causes of change dockerty et al 2006 alcamo and henrichs 2008 which can be social economic e g policies and or physical or ecological e g climate change the design of alternative landscapes can be performed by the research team e g babel et al 2011 or in a participatory approach involving stakeholders e g hossard et al 2018 depending on the topic studied the model used for assessment and the preferences of the research team understanding the range of approaches available for impact modelling at landscape scale is important when exploring potential opportunities to efficiently address local to global problems in the first instance bibliometric analyses have been performed without specifying scale or agriculture on specific impacts in e g biodiversity research focusing on literature growth collaboration citation networks and top terms liu et al 2011 stork and astrin 2014 such analyses were also performed looking specifically at groundwater research zare et al 2017 and water impacts niu et al 2014 to identify trends in publications highly cited publications keywords and associated trends a recent review focused on global environmental assessment highlighting decision theoretic approaches e g life cycle assessment indicator selection new methods model geographic information system and hotspots e g biodiversity climate change risk assessment li and zhao 2015 however such studies explore one specific impact while not focusing on agricultural uses or on a specific landscape scale reviews can also be performed specifically at landscape scale however those performed to date also focus on a specific impact e g water scenario analyses march et al 2012 on specific methods e g multi criteria assessments allain et al 2017 decision support systems for landscape management zasada et al 2017 or on synthesis and qualitative analysis of the literature on landscape approaches and their potential operationalisation freeman et al 2015 thus to our knowledge no quantitative systematic review has been performed to date on model based assessment of agricultural changes to identify consistent groups of studies defining different topics the only studies addressing the objective of group identification have focused on water scenario analyses march et al 2012 or on biodiversity only chopin et al 2019 the latter using similar keywords to those used in our study hence the objectives of this study were to 1 assemble a comprehensive dataset of published studies designing alternative agricultural landscapes and assessing associated changes and impacts through modelling and 2 identify and analyse study structure trends in knowledge and associated methods and models employed in this dataset thus we focused our research on studies using models to explore the consequences of future agricultural landscape changes i e design and or assessment of new landscapes and applied a topic modelling approach to link the type of impact with modelling approaches in order to identify potential methodological improvements in impact analysis blei et al 2003 we chose to focus on agricultural landscape changes that explicitly include cropping practices or the organisation of crops practices in the landscape thus we excluded pure land cover land use studies where the data on agriculture are too aggregated to discriminate the diversity of cropping systems chopin et al 2017 identifying trends and groups of publications sharing a similar structure can help to identify gaps in methods topics crossing 2 methods 2 1 literature search and study selection the literature search was conducted in april 2017 and involved entering keywords in the clarivate analytics web of science formerly operated by the institute for scientific information without a time frame limitation the search was limited to the article document type and to the english language for topics the following search equation was used model and agri or agro or crop or farm and landscape or watershed or water near catchment and scenar or alternative this initial search yielded 1 975 hits spanning from 1978 to 2017 we then excluded papers based on article abstracts 1 461 studies when they did not match our selection criteria which were 1 use of a model i e a simplified representation of the system as a tool to design or assess future agricultural landscape s 2 a focus on agricultural systems including farming practices and or agricultural organisation explaining why we chose not to use land use as a key word 3 resolution at landscape scale i e beyond the farm level and 4 with outcomes on alternative agricultural systems thus excluding papers focusing only on the effects of climate change we did not specify the type of impact e g pollution nitrates as our objective was to gain a general overview of the literature without focusing on a specific impact as done in previous studies e g water in zare et al 2017 biodiversity in liu et al 2011 since our focus was on agricultural landscape changes explicitly including cropping practices or their organisation in the landscape we excluded pure land cover land use studies that provide limited descriptions of agricultural practices by 1 our search equation with specific agricultural terms and 2 excluding remaining studies 920 in the initial 1 975 paper dataset eligibility step excluded as no agriculture fig 1 we then manually excluded general papers lacking a case study application e g reviews without a case study 12 papers fig 1 our final dataset thus comprised 514 individual papers which were all read by the research team the list and references of the 514 papers are available online together with the lda r code and the groups results https doi org 10 15454 cnytlq 2 2 overview of bibliometric analysis and topic modelling records of the 514 papers were manually downloaded from web of science into zotero bibtex format the dataset was then exported from zotero www zotero org as a json file http www json org for analysis with r software version 3 3 3 r core team 2017 using jsonlite r package ooms 2014 metadata including journal name year of publication and main author country were analysed to determine trends in publication with regard to time periods journals and geographical distribution related to author country not case study country in addition to metadata analyses publication abstracts were analysed using a topic modelling approach topic models proposed in the late 1990s hofman 1999 papadimitriou et al 2000 are models used to assess the frequency of occurrence of terms in a dataset of papers from the literature grn and hornik 2011 the latent dirichlet allocation lda model blei et al 2003 is designed for topic modelling it is a probabilistic model based on the hypothesis that each article is characterised by one or more topics and that each topic is characterised by a unique multinomial distribution of terms d amato et al 2017 weinshall et al 2013 yau et al 2014 the lda model thus allows identification of topics reflecting relevant information on the relations and similarities in structure between papers in a dataset weinshall et al 2013 topics are assumed to be uncorrelated in the lda model grn and hornik 2011 and it allows journal articles to contain more than one topic blei et al 2003 as a bayesian model lda requires information on the a priori distribution of model parameters called prior distribution which can be informative or non informative depending on the modeller choice using the bayes theorem the prior distribution is updated to obtain the posterior distribution a probability distribution which is based on both the prior distribution and the information gathered in the data thus the posterior distribution is conditional on the data used 2 3 lda procedure for main dataset topics three main steps have to be performed before estimating the lda of a dataset grn and hornik 2011 the first step is to pre process data with tokenisation and stemming to build a dataset dictionary in order to ensure relevant analyses grn and hornik 2011 tokenisation is applied to separate so called tokens e g words by removing punctuation characters numbers converting to lower case and removing stop words using the tm r package feinerer and hornik 2017 stemming is applied to reduce each word to its root grammatical form in order to increase inter paper comparability i e homogeneity of terms e g chang would be the root for changes change changing etc appendix a in addition in our lda analysis we deleted the term model from the dictionary as it was the only mandatory term in our search equation see section 2 1 we then analysed the resulting dictionary to further homogenise tokens by merging redundant terms e g plough and plow tillage and till actor and stakeholder see appendix a for the entire list potentially misleading terms were manually checked in each paper to avoid unintentional mergers e g catchment relating to non water applications very infrequent words i e terms occurring less than five times were also removed from the analysis as in d amato et al 2017 in the second step the number of topics k included in the dataset has to be chosen before running lda this number is often set a priori by the user based on assumptions on the dataset structure e g on research fields in kane et al 2016 in the present study we hypothesised that topics would correspond to the main sustainability issues environmental economic social but that these could be further split into sub issues e g water quality and water quantity both consider the environmental aspect of sustainability or according to scientific discipline e g economics agronomy hydrology etc given this uncertainty we opted not to specify the number of topics a priori but to set it according to the estimation strategy proposed by taddy 2012 this method finds the best number of topics within the minimum and maximum user defined number of topics the best number of topics is that maximising the bayes factor computed with marginal likelihood calculations taddy 2012 i e maximising the posterior distribution over the possible instances of topics over words uto et al 2017 to analyse our dataset of 514 papers we set the possible number of topics between 2 and 51 where 51 corresponded to mean number of 10 papers per topic using the topics function in the maptpx r package taddy 2012 the third step to be performed before lda estimation concerns the paper sampling method and thus the value specification for the parameters of the prior distributions grn and hornik 2011 we used a collapsed gibbs sampler e g d amato et al 2017 and set the distribution parameters as suggested in taddy 2012 gibbs sampling is a markov chain monte carlo algorithm used to obtain a sequence of observations based on a multivariate probability distribution which is particularly useful for calculating the posterior distribution of a bayesian network geman and geman 1984 the lda model for main topics was then fitted using the lda collapsed gibbs sampler of the lda r package chang 2015 using 2500 iterations as in d amato et al 2017 this lda gibbs approach provides estimates of posterior probability of association between journal articles and topic and terms and topic it thus provides the probability for 1 allocation of the journal articles to each topic and 2 allocation of individual terms to each topic topic keywords topic keywords can be either generic to the entire dataset or specific to one or a few topic s keyword specificity to one topic is measured based on computation of the relevance of a given term to a given topic sievert and shirley 2014 sievert and shirley 2014 define the relevance of a term w to a topic t as a function of a weight parameter lambda  ranging between 0 and 1  determines the user defined weight given to the probability of a term w under topic k relative to its lift relevance term w topic t  p w t 1  p w t p w sievert and shirley 2014 a high value of  results in keywords common to the entire dataset while a low value results in topic specific keywords sievert and shirley 2014  is chosen a priori by the user in this study we mainly used a value of  0 6 as recommended by sievert and shirley 2014 although lower values of  were also employed 0 1 step to look for specificities of methods and models especially for highly specific terms  0 topic results are available online for further exploration http shin r innovation inra fr review lh pc with the possibility of choosing different  values and visualising relevant terms according to the chosen  value in addition our analyses included a list of salient terms in the whole dataset the saliency of a term refers to the frequency of keywords in the dataset using word distinctiveness chuang et al 2012 the analyses of salient and topic specific keywords were performed using the ldavis r package sievert and shirley 2015 which also calculates the distance between topics using jensen shannon divergence sievert and shirley 2014 this inter topic distance approximates the between topic semantic relationship using multidimensional scaling 2 4 characterising the main topics in the dataset we sought to examine the potential range of models and methods within the main dataset topics identified by the general lda model constructed above to this end we divided the main dataset into groups of papers corresponding to the k dataset topics as each paper could cover more than one topic blei et al 2003 we considered only papers where one topic was dominant to define topic dominance for a paper we considered the number of times words sw in the paper were assigned to each of the k topics we assigned a paper to a specific topic ka if the related word count was at least 15 larger than the word count for any other topic kb i e s w k a s w k b s w k a 0 15 other values were tested to determine the sensitivity of our results to this 0 15 threshold see appendix b for tests using values of 0 05 0 10 0 20 and 0 25 most diagrams were built with the ggplot2 r package wickham 2009 venn diagrams crossing topics were created with the venndiagram r package chen 2016 3 results 3 1 bibliometric analysis based on our search equation the first journal articles to focus on modelling impacts of agricultural landscape changes were published in 1992 among the 514 publications included in our analysis the vast majority 329 papers were published after 2009 up to april 2017 the date of our search fig 2 a the 514 articles were published in 150 journals in total with the majority of these journals 87 journals or 57 33 publishing only one article during the whole period and only 19 30 journals publishing more than five articles fig 2b the period 1992 1999 yielded 21 publications from eight countries the period 2000 2009 yielded 164 papers from 28 countries and the most recent period yielded 329 papers from 36 countries fig 2a table 1 over the whole period usa germany and france were the countries publishing the most with the usa producing about three times as many papers as the other two top countries 165 papers in usa compared with 53 and 40 in germany and france respectively table 1 the european continent published the largest numbers of papers in the two more recent periods 81 papers in 2000 2009 and 154 in 2010 2017 see table 1 the top journals publishing papers on modelling the impacts of agricultural landscape changes were mainly oriented towards the environment management modelling and agriculture fig 3 the most productive outlet was journal of environmental management with 5 of all publications followed by agricultural water management and agriculture ecosystems environment about 4 each all of the top 10 journals were launched before 1992 except environmental modelling software launched in 1997 most landscape studies published in the journals assessed environmental impacts while economic and social impacts were in second place 3 2 characteristics of the main topics 3 2 1 salient terms and description of topics the five most salient terms in the entire dataset were water chang land watersh i e corresponding to watershed s and crop fig 4 the top 30 most salient terms fell within six broad groups 1 change trend 2 spatial scale 3 pollution 4 biodiversity 5 agricultural practices and 6 terms related to biophysical and regulatory conditions for agricultural production fig 4 table 2 four of these top 30 most salient terms were in our search equation water watershed crop and landscape but all those related to change pollution and biodiversity were original themes not explicitly specified by our search by maximising the bayes factor when fitting lda on our set of 514 papers we identified four main topics fig 4 table 3 two of these concerned water focusing on quality and quantity management topic 1 and 3 respectively the others were integrated assessment and biodiversity topic 2 and 4 respectively 3 2 1 1 water topics 1 and 3 the first topic topic 1 was associated with the highest number of tokens fig 4 and was covered by 177 papers this topic concerned water quality sediment load associated with various agricultural practices at watershed scale see top terms in table 3 relevant terms  0 6 for this topic also concerned runoff erosion fertilisation nitrogen nitrate phosphorus fertility and agricultural practices bmps tillage practice management see http shin r innovation inra fr review lh pc the only relevant terms  0 6 related to methods or models were simulation and swat soil and water assessment tool which is a watershed modelling tool developed by usda in the 1990s to predict the pollution impacts of agricultural practices in large basins gassman et al 2007 for topic 1 the main purpose of modelling alternative agricultural landscapes was to simulate at watershed scale the mitigating effect of best management practices e g tillage on erosion runoff and or water pollution nutrient nitrate and phosphorus losses and associated yield with a number of the studies on this topic using swat looking at very specific terms  0 two models appeared namely agnps agricultural non point source and annagnps annualised agricultural non point source the second model being an extension of the first these are distributed environmental models developed to study the response of watershed hydrological and water quality problems to alternative agricultural management practices e g fertilisation best management practices bmps e g sugiharto et al 1994 yuan et al 2003 for  0 i e highly topic specific model related terms namely coefficient and algorithm were among the top 30 most relevant terms other model oriented terms for topic 1 were calibration  0 1 0 2 and 0 3 validation  0 2 and simulation  0 4 0 5 and 0 6 with the latter being less specific to this topic as indicated by the higher  values no temporal scale was found for topic 1 for any  topic 3 was more related to water quantity aspects in management of groundwater resources especially linked with irrigation practices and climate together with bioenergy crops this topic was dominant in 95 papers table 3 it included relevant terms  0 6 related to bioenergy crops corn biofuel bioenergy and their hydrological aspects water change irrigation based on  0 6 the main purpose for topic 3 of modelling alternative agricultural landscapes was to study the impact of climate change future bioenergy biofuel crop production e g corn or irrigation on water demand and potential yields mainly at regional seasonal and annual scale temporal scales were highlighted season annual year while terms on spatial scale included region river and basin the term carbon was also among the 30 most relevant terms for this topic  0 6 as were some terms related to scenarios and impacts supply demand balance with  values between 0 2 and 0 5 see online diagrams in the water resource sector zare et al 2017 performed a bibliometric analysis of trends without distinguishing themes related to quantity or quality in their search equation niu et al 2014 performed a similar analysis focusing on groundwater and identified more terms related to quality in the most frequent keywords water quality nitrate nitrogen pesticide contamination compared with irrigation for quantity related terms the dominance in our study of the water quality topic topic 1 over water quantity topic 3 is in line with this top terms in the study by zare et al 2017 also included quality but not more specific terms related to pollution and irrigation was not identified however climate change identified as a top term for the water quantity topic identifier in this study topic 3 was among the top 13 terms in the study by zare et al 2017 suggesting that their dataset included studies on water quantity management no term specifically relating to agriculture was identified in the two previous analyses but zare et al 2017 identified terms related to socio economic terms e g policy economic stakeholder which were absent from the two water related topics topics 1 and 3 in the present analysis no journal related to agriculture was among the most active identified by niu et al 2014 the only common journal between our results and those by zare et al 2017 was environmental modelling software fig 3 although not specific to agriculture the two journals identified in our dataset of 514 papers that specifically relate to water i e agricultural water management and journal of soil and water conservation were not among the most active journals identified by niu et al 2014 and zare et al 2017 3 2 1 2 integrated assessment topic 2 the second most important topic topic 2 identified by the lda model applied on the whole dataset of 514 papers was related to integrated assessment approaches studying the effects of policies on landscape change and stakeholder decisions table 3 using  0 6 the main purpose of modelling alternative agricultural landscapes in this topic was thus to assess the effects of environmental policy scenarios on farmers decisions farm regional production and or ecosystem services using an integrated assessment approach stakeholder participation relevant terms  0 6 for this topic included words related to the approach used integrated assessment framework system process and economy these terms are descriptors of methods related to integrated assessment and modelling iam parker et al 2002 of agricultural systems with stakeholders to evaluate policy options van ittersum et al 2008 also called participatory modelling assessment tol and vellinga 1998 support was also included in the top 30 relevant terms scale terms i e farm local both specific to this topic and region were among the 30 most relevant terms the term ecosystem services was also specific to this topic the terms stakeholder and farmer were among the 30 most relevant terms this topic was dominant in 137 papers out of the 514 included in the dataset table 3 it appeared to be oriented more towards real world applications with method oriented highly specific terms  0 like participatory software dss decision support system and trade off design was also included in the top 30 most relevant terms for topic 2 with a  value of 0 2 see online diagrams no terms were related to temporal scale some keywords for this topic corresponded to those identified as socio economic in the review by zare et al 2017 that review focused on integrated water assessment i e using an integrated approach in the water resource sector e g dss economic policy stakeholder etc which appeared later than overarching and bio physical keywords zare et al 2017 this indicates some fluidity in different topics terms 3 2 1 3 biodiversity topic 4 the fourth topic topic 4 was related to ecological issues top words were species habitat and bird while two top words related to scales landscape and field the last appearing as a most relevant term only for this topic a total of 54 papers had this as a dominant topic table 3 some of the most relevant terms  0 6 were biodiversity oriented biodiversity population abundance conservation diversity density dispersal the terms gm genetically modified crops weed payment and grassland were also among the 30 most relevant terms the only relevant term related to method or models was predict  0 6 thus the main purpose of modelling alternative agricultural landscapes in this topic was to predict the effect of gm development payment or land use change in farmland specifying crops or practices on species habitat conservation diversity abundance density population e g bird and biodiversity with particular focus on field scale with decreasing  value the only relevant highly specific term for this topic was mechanist  0 see online diagrams patch and distance appeared as specific terms only in this topic  0 2 and  0 to 0 3 respectively no terms were related to temporal scale the biodiversity topic has been reviewed in the past e g hendricks and duarte 2008 liu et al 2011 stork and astrin 2014 although with a wider scope than our focus on agricultural landscapes these thematic reviews used biodiversity as the main search word although others e g genetic ecosystem etc were used in liu et al 2011 in those studies the top terms concerned biodiversity conservation species forests communities ecology and ecosystems liu et al 2011 stork and astrin 2014 although the subject category agronomy was raised it was not among the most frequently cited liu et al 2011 and agriculture related terms were not among the top 10 terms ranking only 38th in stork and astrin 2014 a small number of agriculture specific journals were included in these reviews e g agricultural ecosystems environment ranked 13th in stork and astrin 2014 and 23rd in liu et al 2011 but was not identified in hendricks and duarte 2008 it ranked 3rd in our analysis considering the complete dataset of 514 papers 3 2 2 temporal and geographical distribution of topics topic 1 water quality was the main topic in the early 1990s and the number of articles on this steadily increased after 2005 fig 5 which is consistent with findings by niu et al 2014 and zare et al 2017 although they identified more papers due to the difference in search equations topic 2 integrated assessment and topic 3 water quantity energy crops appeared in the mid 1990s the number of articles related to topic 2 then grew from the early 2000s while the number of articles on topic 3 stayed low until 2004 and increased from 2008 to 2009 to comprise more than a quarter of the total in 2015 2016 fig 5 topic 4 biodiversity was the last to appear 2001 and began to expand strongly in 2006 to comprise 13 16 of the total in 2015 2016 for the biodiversity topic hendricks and duarte 2008 liu et al 2011 and stork and astrin 2014 showed exponential growth over time which differed from our result focusing on agricultural landscape fig 5 similarly while we show that publication on this topic began in the early 2000s they report that it began in the early 1990s hendricks and duarte 2008 liu et al 2011 stork and astrin 2014 this shows that studies on biodiversity in alternative agricultural landscapes came later than studies focusing on biodiversity conservation highlighted as a main theme in liu et al 2011 and stork and astrin 2014 finally the share of topics changed between the periods 1990 1999 2000 2009 and 2010 2017 with topic 1 being less represented in recent periods although still dominant the trend in the top 10 terms in topic 1 table 3 showed a decrease over time in the occurrence of sediment while the term pollution became more frequently used appendix b the term bmps also tended to decrease in use while practice increased for topic 2 use of the term policy increased while decision and farmer first increased and then tended to decrease in recent years use of stakeholder varied greatly over time although it became more frequent in recent years for topic 3 use of the terms climate and change largely increased since 2010 while the term groundwater was less often used for topic 4 the term landscape was frequently used since 2007 more than the term field appendix b the word population gained in popularity over time while use of richness declined finally the term prediction was more frequently used in very recent years since 2015 the four topics were common in north american literature usa and canada especially topics related to water quality topic 1 48 of papers and water quantity energy crops topic 3 51 of papers fig 6 european countries also published on the four topics but in contrast produced more on topic 2 integrated assessment 71 of papers and topic 4 biodiversity 78 of papers germany the netherlands france and uk were the european leaders on topic 2 19 18 14 and 14 papers respectively out of 97 in europe while germany clearly dominated the literature on topic 4 among european countries 19 papers out of 42 in europe australia contributed to all topics china to all except topic 4 biodiversity and african researchers to all except topic 2 integrated assessment while south american countries only brazil contributed only to topic 3 water quantity energy crops fig 6 identification of north america and to a lesser extent europe as leaders of topics 1 and 3 was consistent with findings by niu et al 2014 and zare et al 2017 who focused their reviews on groundwater and integrated water assessment respectively they also identified china india and australia among the most active countries niu et al 2014 zare et al 2017 while our results are in accordance with the ranking of asian countries they underestimate publications by oceanic countries on water issues the dominance of usa and europe on the biodiversity topic topic 4 is in accordance with findings in biodiversity specific reviews hendricks and duarte 2008 liu et al 2011 however our geographical analysis was based on the country of the first author only and did not consider the study site country this gave different results e g for biodiversity stork and astrin 2014 found a strong focus on asia and south america 3 3 multiple topics at a topic dominance threshold of 0 15 463 papers related to only one topic fig 7 no article displayed a large frequency of terms corresponding to more than two topics fig 7 such articles appeared only for higher dominance thresholds with one paper showing a large number of terms related to topics 1 2 and 4 threshold of 0 20 and higher and one article related to topics 2 3 and 4 threshold of 0 25 appendix c a higher number of articles used terms relevant to two topics 51 papers except for topics 1 and 4 combined i e water quality and biodiversity and topics 3 and 4 combined i e water quantity energy crops and biodiversity with only one article each at the 0 15 threshold fig 7 the article combining topics 3 and 4 was published in 2011 by a uk team and assessed potential regional carbon stocks according to different scenarios among which were a bioenergy crop scenario topic 3 and a biodiversity scenario topic 4 cantarello et al 2011 combinations of topics 1 and 4 and topics 3 and 4 were rare whatever the threshold tested appendix c at the 0 15 threshold the number of articles sharing two topics was similar as regards topics 1 and 2 1 and 3 2 and 3 and 2 and 4 11 13 articles in each case see fig 7 combinations of topics 1 and 3 and of topics 2 and 3 were more sensitive to the threshold value with 10 fold more papers at a threshold of 0 25 than at a threshold of 0 05 appendix c the number of articles covering topic 3 was the most sensitive to threshold value with almost 19 fewer articles at a threshold of 0 05 compared with 0 25 comparing these two thresholds 20 topic 3 papers water quantity energy crops appeared to share terms with topic 2 12 papers topic 1 7 papers and topic 4 1 paper this shows that those studies on water quantity energy crops mostly included an integrated assessment framework or aspects on water quality which is consistent with the research trend on integrated water assessment and modelling zare et al 2017 no time trend of mixed topics in the relevant papers was found for any dominant topic appendix d this shows some fluidity between topics with varying impacts studied e g the impact on birds of developing bioenergy crops engel et al 2012 everaars et al 2014 or the impact of policy on bird conservation or field habitat drum et al 2015 bredemeier et al 2015 although the paper was allocated to one specific topic topic 4 for the examples cited for the 51 papers for which no dominant topic was found at a threshold of 0 15 no time trend was identified regarding an increase in mixing topics appendix d overall 29 of these papers performed an integrated assessment including water quality topics 1 and 2 25 made an integrated assessment including water quantity or energy crops topics 2 and 3 22 studied biodiversity with an integrated assessment approach topics 4 and 2 and 20 of the 51 papers studied both water quality and water quantity energy crops topics 1 and 3 less frequent topic combinations were studies of water quality together with biodiversity topics 1 and 4 and studies of biodiversity and water quantity energy crops topics 4 and 3 with one paper each 4 discussion in this review we assessed published studies in which a modelling approach was used to design and assess the performance of alternative agricultural landscapes our aim was to identify the structure of existing research and the range of associated methods and models employed 4 1 main topics identified potential reasons and limits our analysis of the selected literature identified four main topics water quality topic 1 water quantity energy crops topic 3 biodiversity and gm topic 4 and a multi issue topic considering integrated assessment i e policies and stakeholder decisions for landscape simulation topic 2 these topics were each linked to a scientific discipline hydrology for topics 1 and 3 ecology for topic 4 and economics policy study for topic 2 terms related to cropping practices i e agronomic terms were associated to each topic although with a lower number of terms for topic 4 topic 3 was associated with one specific cropping practice irrigation and type of crop biofuel corn and their proportions within the landscapes topic 1 was associated with bmps with a specification options of tillage fertilisation showing a certain homogeneity and simplification in the range of agronomic options tested bmps constituted a positive list of agronomic practices regarding soil water nutrients integrated pest and landscape management schenpf and cox 2007 the term bmps appeared to be mainly used by north american researchers this term arose in the usa in guidelines to address non point source pollution for water quality protection through the 1972 federal water pollution control act phillips and blinn 2004 this is consistent with the specific terms related to models in topic 1 with the names of models developed in the north america e g swat see gassman et al 2007 being the leader for water management topics topics 1 and 3 this could be linked to the type of agriculture practised in north america i e highly irrigated fao 2014 intensive and specialised e g monocropping in the corn belt leading to both water quality and quantity issues and related research europe was the leader for the topic integrated assessment topic 2 characterised by the more general term decision support system or dss the dominance of europe on the topic integrated assessment including stakeholder participation and decision support systems within the specific context of alternative agricultural landscape modelling can be attributed to the fact that it emerged in the netherlands in the late 1990s rotmans and van asselt 1996 and had grown into a booming field by the early 2000s hisschemller et al 2001 integrated assessment was initially defined by two main characteristics i building upon research in different disciplines and ii providing information for decision makers rotmans and van asselt 1996 however we focused on agricultural landscapes which could explain the geographical bias observed for this topic for instance integrated assessment methods are used by north american researchers but their focus is not on agriculture e g flood resilience in allen et al 2019 topic 1 showed greater homogeneity in methods for the water quality topic which makes comparisons easier but could also indicate less originality in the methods applied in contrast to integrated assessment and water quantity energy crops topics 2 and 3 the topic on biodiversity topic 4 was the only one highlighting different spatial scales patch field landscape thus tending to have a spatially explicit approach the topic on integrated assessment included the term farm which is more related to a decision level water quality studies used mostly swat which is a distributed spatially explicit model water quantity energy crop studies looked more at aggregated values on e g water demand or total production although they sometimes considered spatial scale for implementation of a crop practice change the spatial scale was thus determined by the issue however alternative landscapes are the result of multiple drivers that take place at different scales e g biodiversity at patch scale decision and economic consequences at field and farm scale aggregated effects at landscape scale thus calling for multi scale studies 4 2 potential gaps and future works the impact of agricultural landscapes on biodiversity topic 4 the last to emerge in our dataset was studied equally in north america and europe this is consistent with findings in a more general review i e not specific to agricultural landscapes by di marco et al 2017 that there is a geographical bias europe north america central america in studies of conservation science surprisingly the term ecosystem services was associated with integrated assessment of agricultural landscapes topic 2 and not biodiversity topic 4 the relative absence of ecosystem services in the biodiversity topic is consistent with previous findings in a review by egoh et al 2007 that a very low number of conservation assessments include ecosystem services this could be explained by the way in which the concept of ecosystem services was promoted in millennium ecosystem assessment ma 2005 i e as a policy tool aiming at sustainable use of natural resources seppelt et al 2011 thus corresponding more to our topic integrated assessment however the ecosystem services concept was also developed to demonstrate the value of nature walz and syrbe in press and is closely related to biodiversity preservation european commission 2011 this could indicate that biodiversity studies need to align more tightly to political context and governance alternatives e g velten et al 2018 with inclusion of biodiversity aspects in dss more stakeholder interactions and greater inclusion of ecology researchers on ecosystem services which is becoming a hot topic in particular integrating the relationships between biodiversity and ecosystem services e g birds feeding on weed seeds gaba et al 2014 in agricultural landscape modelling could help provide a framework for future policies combining biodiversity and agriculture while we identified a few papers studying the impacts of policy on birds or habitats those did not include a bottom up approach involving local stakeholders to co design possible actions and their translation into local policies e g bredemeier et al 2015 or used a simplified vision of agricultural practices e g drum et al 2015 this calls for more inclusive biodiversity based studies involving the participation of local stakeholders farmers but also local authorities and nature ngos to develop local policies for alternative landscapes combining biodiversity preservation and agricultural production with explicit and detailed consideration of the constraints of these two sectors unlike current policy developments those studies would be based on a bottom up approach combining detailed knowledge of current agricultural practices biodiversity issues and potential win win or compromise situations identified e g in participatory workshops the benefits of this type of research would be both scientific transdisciplinary research with cross fertilisation between different disciplines e g ecology agronomy economics and oriented towards local action through the promotion of practices and policies developed locally it follows that the design of agricultural landscapes will require joint work by scientists and stakeholders to identify the desired ecosystem services and design the necessary landscape modifications landis 2017 as biodiversity and nature are becoming a hot topic with recent reports of species decreases and extinctions diaz et al 2019 policy makers are urged to promote effective actions in favour of biodiversity and ecosystem services preservation in this work research methods and tools could be used for both design and assessment of alternative landscapes as claimed by hill et al 2013 participatory scenario design together with collective visioning urgently needs to be revised to favour policy development and foster social consensus on biodiversity conservation complex landscapes should be represented with models accounting for the spatial configuration or composition in a balanced way although development of such models is still in its infancy langhammer et al 2019 studies could target for instance natural pest control in an ecological intensification perspective where natural enemies replace pesticides in cropping and farming systems in landscape scenarios bommarco et al 2013 an exploratory model based approach is lacking at landscape level where natural pest control is only assessed via some landscape proxies such as diversity of land cover around the perimeter to determine the potential amount of services mitchell et al 2013 most papers in our dataset were linked to one dominant topic less frequent topic combinations were studies of water quality together with biodiversity topics 1 and 4 and studies of biodiversity and water quantity energy crops topics 3 and 4 although we excluded papers focusing only on the effects of climate change this theme emerged as a driver of scenarios in topic 3 water quantity energy crops thus in our dataset biodiversity was apparently not assessed in studies linking climate change and agricultural practices the two main factors that actually threaten biodiversity different studies have assessed biodiversity responses to climate change e g bellard et al 2012 or to agriculture and their potential conflicts e g henle et al 2008 attempts to study their joint effects appear to have focused mostly on land use change without detailing agricultural practices several studies have considered habitat loss but with less attention to spatial e g fragmentation in the landscape or practice change e g management intensity de chazal and rounsevell 2009 and with a limited number of taxa considered chopin et al 2019 future studies of alternative agricultural landscapes thus would need to enlarge the vision on biodiversity e g by increasing the number of taxa chopin et al 2019 and including detailed population characteristics and their climate drivers together with potential agricultural practices to be applied in these futures this will require integrated approaches as agricultural practices are determined by a set of drivers including but not limited to climate change participatory approaches would thus be also required for this issue finally our review did not identify hot topics and methods used in agricultural studies for instance resilience was not identified as a top word among our four topics appearing in only five of the 514 papers in our dataset however resilience is gaining increasing attention in agricultural research to characterise the relationship between agricultural outputs and perturbation the two main parameters being global warming and price volatility urruty et al 2016 agronomists study agricultural resilience at farm to country scale urruty et al 2016 the landscape scale tends to be studied by researchers in ecology looking at e g spatial resilience location connectivity complexity cumming 2011 land use management and habitat tscharntke et al 2005 or by economists looking at land use patterns and the resilience of agricultural returns abson et al 2013 in those ecology based studies agricultural practices are often simplified characterised as categories of land use and disregarding the level of decision i e the farm this indicates that the landscape agronomy approach called for by benot et al 2012 has not yet fully emerged this approach is necessary for disaggregating land use and better characterising the diversity of cropping systems and landscape diversity as highlighted by chopin et al 2017 it is particularly important for issues requiring coordination of agriculture related actions at the landscape scale e g erosion in souchre et al 2010 or collective governance of e g water resources e g murgue et al 2015 or integrated crop livestock systems e g moraine et al 2017 5 conclusions in this review we distinguished four main topics covered by studies modelling the impacts of agricultural changes at landscape scale these were water quality water quantity energy crops biodiversity and integrated assessment we found very few publications on these topics in south america and africa despite the fact that hot topics like water scarcity in africa are likely to increase with climate change calling for collective governance at scales beyond field and farms similarly issues like gms and emerging weed resistance particularly in south america call for spatially explicit methods for coordinating actions at medium spatial scales finally although we found abundant north american and european studies on modelling agricultural changes and impacts at landscape scale hot topics like pesticides eu and diversification usa did not emerge despite their critical impacts at landscape scale for e g water quality water quantity and pest control this indicates an urgent need for integrated studies considering the diversity of agricultural and cropping systems in governance of the collective issues of water quality water quantity and biodiversity acknowledgments the second author received funding from slu s cropping system platform this work was also carried out with the financial support of inra france we would like to thank mary mcafee for english editing we thank the three anonymous reviewers for their helpful and valuable comments on an earlier draft of the manuscript appendix a tokenisation and stemming r code image 1 appendix b trends of the top 10 keywords for the four topics the y axis indicates the number of articles in which the word was identified image 2 appendix c sensitivity of document topics mixture to dominance threshold value topic 1 is related to water quality topic 2 is related to integrated assessment of agricultural systems topic 3 is related to water quantity and bio energy crops and topic 4 is related to biodiversity image 3 appendix d distribution of topics in the 514 papers presented for each dominating topic threshold 0 15 topic 1 is related to water quality topic 2 is related to integrated assessment of agricultural systems topic 3 is related to water quantity and bio energy crops and topic 4 is related to biodiversity image 4 appendix e supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix e supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2019 104513 
26109,understanding the range of approaches available for assessing the impacts of agricultural changes at landscape scale is important when addressing local to global issues using a topic modelling approach we reviewed the literature on impact modelling of agricultural landscapes a search in web of science using the keywords model agricultural systems and landscape yielded 1 975 hits of which 514 papers met our selection criteria the most salient terms fell within six groups change scale pollution biodiversity practices and terms on biophysical regulatory conditions we identified four main topics water quality water quantity energy crops biodiversity and integrated assessment water management issues were more likely to be covered in north american researches while issues related to integrated assessment were mainly covered in european studies we found no relationship between topic and model type we conclude that future integrated studies should consider the diversity of agricultural systems in governance of water and biodiversity issues keywords water quality water quantity integrated assessment biodiversity conservation topic modelling 1 introduction spatial expansion and intensification of agriculture in recent decades has had tremendous environmental impacts on agricultural landscapes foley et al 2011 these landscapes are defined as systems in which interactions occur between farmers and their natural and social resources including management of fields field margins and associated semi natural habitats benot et al 2012 modern agriculture is contributing to water degradation increased energy use and greenhouse gas emissions together with widespread pollution and loss of biodiversity foley et al 2011 these impacts take place beyond the field and farm levels necessitating a landscape approach if they are to be addressed properly at the relevant scale s through relevant research disciplines and methods impacts resulting from spatial interactions need to be considered at larger scales than point effects this can be watershed scale when considering water quality or quantity e g frey et al 2013 gngr and gnc 2013 fan and shibata 2015 carvalho santos et al 2016 or landscape scale when considering spatial flows of pathogens e g hossard et al 2013 nectar foraging species e g baveco et al 2016 etc many studies have examined sustainability at field or farm scale e g zahm et al 2008 pelzer et al 2012 craheix et al 2016 but upscaling their results to larger spatial or temporal scales may be difficult and produce uncertain conclusions dalgaard et al 2003 however such upscaling may be necessary to understand the impact of different land uses crops and or cropping techniques on landscape performance sustainability and ecosystem services tscharntke et al 2005 because of the multiple temporal and spatial scales involved assessment of agricultural landscapes is challenging and requires modelling approaches to study system changes and their impacts modelling allows the complex processes occurring to be simplified in order to explore the impacts of possible changes land use crop practices that cannot be distinguished in the real world e g legg 2004 skelsey et al 2010 different modelling approaches can be used for designing and or assessing landscape performance in the face of change depending on the topic studied and available knowledge these approaches may involve empirical models e g bennett et al 2014 process based models e g santhi et al 2014 optimisation models e g huang et al 2012 agent based models e g brady et al 2012 statistical models e g gottschalk et al 2007 or a combination of these types of models e g schnhart et al 2016 in such studies the objective in designing alternatives is to compare their impacts with appropriate indicators with simulation models being used to predict values for these indicators clavel et al 2012 different methods can be used to design alternatives ranging from simulation studies comparable to sensitivity analyses on cropping practices and or their proportion location to participatory approaches scenarios which describe possible futures that reflect different perspectives on past present and future developments van notten 2005 are currently used in participatory approaches they usually include a description of the initial situation for comparison with alternatives and often also the drivers causes of change dockerty et al 2006 alcamo and henrichs 2008 which can be social economic e g policies and or physical or ecological e g climate change the design of alternative landscapes can be performed by the research team e g babel et al 2011 or in a participatory approach involving stakeholders e g hossard et al 2018 depending on the topic studied the model used for assessment and the preferences of the research team understanding the range of approaches available for impact modelling at landscape scale is important when exploring potential opportunities to efficiently address local to global problems in the first instance bibliometric analyses have been performed without specifying scale or agriculture on specific impacts in e g biodiversity research focusing on literature growth collaboration citation networks and top terms liu et al 2011 stork and astrin 2014 such analyses were also performed looking specifically at groundwater research zare et al 2017 and water impacts niu et al 2014 to identify trends in publications highly cited publications keywords and associated trends a recent review focused on global environmental assessment highlighting decision theoretic approaches e g life cycle assessment indicator selection new methods model geographic information system and hotspots e g biodiversity climate change risk assessment li and zhao 2015 however such studies explore one specific impact while not focusing on agricultural uses or on a specific landscape scale reviews can also be performed specifically at landscape scale however those performed to date also focus on a specific impact e g water scenario analyses march et al 2012 on specific methods e g multi criteria assessments allain et al 2017 decision support systems for landscape management zasada et al 2017 or on synthesis and qualitative analysis of the literature on landscape approaches and their potential operationalisation freeman et al 2015 thus to our knowledge no quantitative systematic review has been performed to date on model based assessment of agricultural changes to identify consistent groups of studies defining different topics the only studies addressing the objective of group identification have focused on water scenario analyses march et al 2012 or on biodiversity only chopin et al 2019 the latter using similar keywords to those used in our study hence the objectives of this study were to 1 assemble a comprehensive dataset of published studies designing alternative agricultural landscapes and assessing associated changes and impacts through modelling and 2 identify and analyse study structure trends in knowledge and associated methods and models employed in this dataset thus we focused our research on studies using models to explore the consequences of future agricultural landscape changes i e design and or assessment of new landscapes and applied a topic modelling approach to link the type of impact with modelling approaches in order to identify potential methodological improvements in impact analysis blei et al 2003 we chose to focus on agricultural landscape changes that explicitly include cropping practices or the organisation of crops practices in the landscape thus we excluded pure land cover land use studies where the data on agriculture are too aggregated to discriminate the diversity of cropping systems chopin et al 2017 identifying trends and groups of publications sharing a similar structure can help to identify gaps in methods topics crossing 2 methods 2 1 literature search and study selection the literature search was conducted in april 2017 and involved entering keywords in the clarivate analytics web of science formerly operated by the institute for scientific information without a time frame limitation the search was limited to the article document type and to the english language for topics the following search equation was used model and agri or agro or crop or farm and landscape or watershed or water near catchment and scenar or alternative this initial search yielded 1 975 hits spanning from 1978 to 2017 we then excluded papers based on article abstracts 1 461 studies when they did not match our selection criteria which were 1 use of a model i e a simplified representation of the system as a tool to design or assess future agricultural landscape s 2 a focus on agricultural systems including farming practices and or agricultural organisation explaining why we chose not to use land use as a key word 3 resolution at landscape scale i e beyond the farm level and 4 with outcomes on alternative agricultural systems thus excluding papers focusing only on the effects of climate change we did not specify the type of impact e g pollution nitrates as our objective was to gain a general overview of the literature without focusing on a specific impact as done in previous studies e g water in zare et al 2017 biodiversity in liu et al 2011 since our focus was on agricultural landscape changes explicitly including cropping practices or their organisation in the landscape we excluded pure land cover land use studies that provide limited descriptions of agricultural practices by 1 our search equation with specific agricultural terms and 2 excluding remaining studies 920 in the initial 1 975 paper dataset eligibility step excluded as no agriculture fig 1 we then manually excluded general papers lacking a case study application e g reviews without a case study 12 papers fig 1 our final dataset thus comprised 514 individual papers which were all read by the research team the list and references of the 514 papers are available online together with the lda r code and the groups results https doi org 10 15454 cnytlq 2 2 overview of bibliometric analysis and topic modelling records of the 514 papers were manually downloaded from web of science into zotero bibtex format the dataset was then exported from zotero www zotero org as a json file http www json org for analysis with r software version 3 3 3 r core team 2017 using jsonlite r package ooms 2014 metadata including journal name year of publication and main author country were analysed to determine trends in publication with regard to time periods journals and geographical distribution related to author country not case study country in addition to metadata analyses publication abstracts were analysed using a topic modelling approach topic models proposed in the late 1990s hofman 1999 papadimitriou et al 2000 are models used to assess the frequency of occurrence of terms in a dataset of papers from the literature grn and hornik 2011 the latent dirichlet allocation lda model blei et al 2003 is designed for topic modelling it is a probabilistic model based on the hypothesis that each article is characterised by one or more topics and that each topic is characterised by a unique multinomial distribution of terms d amato et al 2017 weinshall et al 2013 yau et al 2014 the lda model thus allows identification of topics reflecting relevant information on the relations and similarities in structure between papers in a dataset weinshall et al 2013 topics are assumed to be uncorrelated in the lda model grn and hornik 2011 and it allows journal articles to contain more than one topic blei et al 2003 as a bayesian model lda requires information on the a priori distribution of model parameters called prior distribution which can be informative or non informative depending on the modeller choice using the bayes theorem the prior distribution is updated to obtain the posterior distribution a probability distribution which is based on both the prior distribution and the information gathered in the data thus the posterior distribution is conditional on the data used 2 3 lda procedure for main dataset topics three main steps have to be performed before estimating the lda of a dataset grn and hornik 2011 the first step is to pre process data with tokenisation and stemming to build a dataset dictionary in order to ensure relevant analyses grn and hornik 2011 tokenisation is applied to separate so called tokens e g words by removing punctuation characters numbers converting to lower case and removing stop words using the tm r package feinerer and hornik 2017 stemming is applied to reduce each word to its root grammatical form in order to increase inter paper comparability i e homogeneity of terms e g chang would be the root for changes change changing etc appendix a in addition in our lda analysis we deleted the term model from the dictionary as it was the only mandatory term in our search equation see section 2 1 we then analysed the resulting dictionary to further homogenise tokens by merging redundant terms e g plough and plow tillage and till actor and stakeholder see appendix a for the entire list potentially misleading terms were manually checked in each paper to avoid unintentional mergers e g catchment relating to non water applications very infrequent words i e terms occurring less than five times were also removed from the analysis as in d amato et al 2017 in the second step the number of topics k included in the dataset has to be chosen before running lda this number is often set a priori by the user based on assumptions on the dataset structure e g on research fields in kane et al 2016 in the present study we hypothesised that topics would correspond to the main sustainability issues environmental economic social but that these could be further split into sub issues e g water quality and water quantity both consider the environmental aspect of sustainability or according to scientific discipline e g economics agronomy hydrology etc given this uncertainty we opted not to specify the number of topics a priori but to set it according to the estimation strategy proposed by taddy 2012 this method finds the best number of topics within the minimum and maximum user defined number of topics the best number of topics is that maximising the bayes factor computed with marginal likelihood calculations taddy 2012 i e maximising the posterior distribution over the possible instances of topics over words uto et al 2017 to analyse our dataset of 514 papers we set the possible number of topics between 2 and 51 where 51 corresponded to mean number of 10 papers per topic using the topics function in the maptpx r package taddy 2012 the third step to be performed before lda estimation concerns the paper sampling method and thus the value specification for the parameters of the prior distributions grn and hornik 2011 we used a collapsed gibbs sampler e g d amato et al 2017 and set the distribution parameters as suggested in taddy 2012 gibbs sampling is a markov chain monte carlo algorithm used to obtain a sequence of observations based on a multivariate probability distribution which is particularly useful for calculating the posterior distribution of a bayesian network geman and geman 1984 the lda model for main topics was then fitted using the lda collapsed gibbs sampler of the lda r package chang 2015 using 2500 iterations as in d amato et al 2017 this lda gibbs approach provides estimates of posterior probability of association between journal articles and topic and terms and topic it thus provides the probability for 1 allocation of the journal articles to each topic and 2 allocation of individual terms to each topic topic keywords topic keywords can be either generic to the entire dataset or specific to one or a few topic s keyword specificity to one topic is measured based on computation of the relevance of a given term to a given topic sievert and shirley 2014 sievert and shirley 2014 define the relevance of a term w to a topic t as a function of a weight parameter lambda  ranging between 0 and 1  determines the user defined weight given to the probability of a term w under topic k relative to its lift relevance term w topic t  p w t 1  p w t p w sievert and shirley 2014 a high value of  results in keywords common to the entire dataset while a low value results in topic specific keywords sievert and shirley 2014  is chosen a priori by the user in this study we mainly used a value of  0 6 as recommended by sievert and shirley 2014 although lower values of  were also employed 0 1 step to look for specificities of methods and models especially for highly specific terms  0 topic results are available online for further exploration http shin r innovation inra fr review lh pc with the possibility of choosing different  values and visualising relevant terms according to the chosen  value in addition our analyses included a list of salient terms in the whole dataset the saliency of a term refers to the frequency of keywords in the dataset using word distinctiveness chuang et al 2012 the analyses of salient and topic specific keywords were performed using the ldavis r package sievert and shirley 2015 which also calculates the distance between topics using jensen shannon divergence sievert and shirley 2014 this inter topic distance approximates the between topic semantic relationship using multidimensional scaling 2 4 characterising the main topics in the dataset we sought to examine the potential range of models and methods within the main dataset topics identified by the general lda model constructed above to this end we divided the main dataset into groups of papers corresponding to the k dataset topics as each paper could cover more than one topic blei et al 2003 we considered only papers where one topic was dominant to define topic dominance for a paper we considered the number of times words sw in the paper were assigned to each of the k topics we assigned a paper to a specific topic ka if the related word count was at least 15 larger than the word count for any other topic kb i e s w k a s w k b s w k a 0 15 other values were tested to determine the sensitivity of our results to this 0 15 threshold see appendix b for tests using values of 0 05 0 10 0 20 and 0 25 most diagrams were built with the ggplot2 r package wickham 2009 venn diagrams crossing topics were created with the venndiagram r package chen 2016 3 results 3 1 bibliometric analysis based on our search equation the first journal articles to focus on modelling impacts of agricultural landscape changes were published in 1992 among the 514 publications included in our analysis the vast majority 329 papers were published after 2009 up to april 2017 the date of our search fig 2 a the 514 articles were published in 150 journals in total with the majority of these journals 87 journals or 57 33 publishing only one article during the whole period and only 19 30 journals publishing more than five articles fig 2b the period 1992 1999 yielded 21 publications from eight countries the period 2000 2009 yielded 164 papers from 28 countries and the most recent period yielded 329 papers from 36 countries fig 2a table 1 over the whole period usa germany and france were the countries publishing the most with the usa producing about three times as many papers as the other two top countries 165 papers in usa compared with 53 and 40 in germany and france respectively table 1 the european continent published the largest numbers of papers in the two more recent periods 81 papers in 2000 2009 and 154 in 2010 2017 see table 1 the top journals publishing papers on modelling the impacts of agricultural landscape changes were mainly oriented towards the environment management modelling and agriculture fig 3 the most productive outlet was journal of environmental management with 5 of all publications followed by agricultural water management and agriculture ecosystems environment about 4 each all of the top 10 journals were launched before 1992 except environmental modelling software launched in 1997 most landscape studies published in the journals assessed environmental impacts while economic and social impacts were in second place 3 2 characteristics of the main topics 3 2 1 salient terms and description of topics the five most salient terms in the entire dataset were water chang land watersh i e corresponding to watershed s and crop fig 4 the top 30 most salient terms fell within six broad groups 1 change trend 2 spatial scale 3 pollution 4 biodiversity 5 agricultural practices and 6 terms related to biophysical and regulatory conditions for agricultural production fig 4 table 2 four of these top 30 most salient terms were in our search equation water watershed crop and landscape but all those related to change pollution and biodiversity were original themes not explicitly specified by our search by maximising the bayes factor when fitting lda on our set of 514 papers we identified four main topics fig 4 table 3 two of these concerned water focusing on quality and quantity management topic 1 and 3 respectively the others were integrated assessment and biodiversity topic 2 and 4 respectively 3 2 1 1 water topics 1 and 3 the first topic topic 1 was associated with the highest number of tokens fig 4 and was covered by 177 papers this topic concerned water quality sediment load associated with various agricultural practices at watershed scale see top terms in table 3 relevant terms  0 6 for this topic also concerned runoff erosion fertilisation nitrogen nitrate phosphorus fertility and agricultural practices bmps tillage practice management see http shin r innovation inra fr review lh pc the only relevant terms  0 6 related to methods or models were simulation and swat soil and water assessment tool which is a watershed modelling tool developed by usda in the 1990s to predict the pollution impacts of agricultural practices in large basins gassman et al 2007 for topic 1 the main purpose of modelling alternative agricultural landscapes was to simulate at watershed scale the mitigating effect of best management practices e g tillage on erosion runoff and or water pollution nutrient nitrate and phosphorus losses and associated yield with a number of the studies on this topic using swat looking at very specific terms  0 two models appeared namely agnps agricultural non point source and annagnps annualised agricultural non point source the second model being an extension of the first these are distributed environmental models developed to study the response of watershed hydrological and water quality problems to alternative agricultural management practices e g fertilisation best management practices bmps e g sugiharto et al 1994 yuan et al 2003 for  0 i e highly topic specific model related terms namely coefficient and algorithm were among the top 30 most relevant terms other model oriented terms for topic 1 were calibration  0 1 0 2 and 0 3 validation  0 2 and simulation  0 4 0 5 and 0 6 with the latter being less specific to this topic as indicated by the higher  values no temporal scale was found for topic 1 for any  topic 3 was more related to water quantity aspects in management of groundwater resources especially linked with irrigation practices and climate together with bioenergy crops this topic was dominant in 95 papers table 3 it included relevant terms  0 6 related to bioenergy crops corn biofuel bioenergy and their hydrological aspects water change irrigation based on  0 6 the main purpose for topic 3 of modelling alternative agricultural landscapes was to study the impact of climate change future bioenergy biofuel crop production e g corn or irrigation on water demand and potential yields mainly at regional seasonal and annual scale temporal scales were highlighted season annual year while terms on spatial scale included region river and basin the term carbon was also among the 30 most relevant terms for this topic  0 6 as were some terms related to scenarios and impacts supply demand balance with  values between 0 2 and 0 5 see online diagrams in the water resource sector zare et al 2017 performed a bibliometric analysis of trends without distinguishing themes related to quantity or quality in their search equation niu et al 2014 performed a similar analysis focusing on groundwater and identified more terms related to quality in the most frequent keywords water quality nitrate nitrogen pesticide contamination compared with irrigation for quantity related terms the dominance in our study of the water quality topic topic 1 over water quantity topic 3 is in line with this top terms in the study by zare et al 2017 also included quality but not more specific terms related to pollution and irrigation was not identified however climate change identified as a top term for the water quantity topic identifier in this study topic 3 was among the top 13 terms in the study by zare et al 2017 suggesting that their dataset included studies on water quantity management no term specifically relating to agriculture was identified in the two previous analyses but zare et al 2017 identified terms related to socio economic terms e g policy economic stakeholder which were absent from the two water related topics topics 1 and 3 in the present analysis no journal related to agriculture was among the most active identified by niu et al 2014 the only common journal between our results and those by zare et al 2017 was environmental modelling software fig 3 although not specific to agriculture the two journals identified in our dataset of 514 papers that specifically relate to water i e agricultural water management and journal of soil and water conservation were not among the most active journals identified by niu et al 2014 and zare et al 2017 3 2 1 2 integrated assessment topic 2 the second most important topic topic 2 identified by the lda model applied on the whole dataset of 514 papers was related to integrated assessment approaches studying the effects of policies on landscape change and stakeholder decisions table 3 using  0 6 the main purpose of modelling alternative agricultural landscapes in this topic was thus to assess the effects of environmental policy scenarios on farmers decisions farm regional production and or ecosystem services using an integrated assessment approach stakeholder participation relevant terms  0 6 for this topic included words related to the approach used integrated assessment framework system process and economy these terms are descriptors of methods related to integrated assessment and modelling iam parker et al 2002 of agricultural systems with stakeholders to evaluate policy options van ittersum et al 2008 also called participatory modelling assessment tol and vellinga 1998 support was also included in the top 30 relevant terms scale terms i e farm local both specific to this topic and region were among the 30 most relevant terms the term ecosystem services was also specific to this topic the terms stakeholder and farmer were among the 30 most relevant terms this topic was dominant in 137 papers out of the 514 included in the dataset table 3 it appeared to be oriented more towards real world applications with method oriented highly specific terms  0 like participatory software dss decision support system and trade off design was also included in the top 30 most relevant terms for topic 2 with a  value of 0 2 see online diagrams no terms were related to temporal scale some keywords for this topic corresponded to those identified as socio economic in the review by zare et al 2017 that review focused on integrated water assessment i e using an integrated approach in the water resource sector e g dss economic policy stakeholder etc which appeared later than overarching and bio physical keywords zare et al 2017 this indicates some fluidity in different topics terms 3 2 1 3 biodiversity topic 4 the fourth topic topic 4 was related to ecological issues top words were species habitat and bird while two top words related to scales landscape and field the last appearing as a most relevant term only for this topic a total of 54 papers had this as a dominant topic table 3 some of the most relevant terms  0 6 were biodiversity oriented biodiversity population abundance conservation diversity density dispersal the terms gm genetically modified crops weed payment and grassland were also among the 30 most relevant terms the only relevant term related to method or models was predict  0 6 thus the main purpose of modelling alternative agricultural landscapes in this topic was to predict the effect of gm development payment or land use change in farmland specifying crops or practices on species habitat conservation diversity abundance density population e g bird and biodiversity with particular focus on field scale with decreasing  value the only relevant highly specific term for this topic was mechanist  0 see online diagrams patch and distance appeared as specific terms only in this topic  0 2 and  0 to 0 3 respectively no terms were related to temporal scale the biodiversity topic has been reviewed in the past e g hendricks and duarte 2008 liu et al 2011 stork and astrin 2014 although with a wider scope than our focus on agricultural landscapes these thematic reviews used biodiversity as the main search word although others e g genetic ecosystem etc were used in liu et al 2011 in those studies the top terms concerned biodiversity conservation species forests communities ecology and ecosystems liu et al 2011 stork and astrin 2014 although the subject category agronomy was raised it was not among the most frequently cited liu et al 2011 and agriculture related terms were not among the top 10 terms ranking only 38th in stork and astrin 2014 a small number of agriculture specific journals were included in these reviews e g agricultural ecosystems environment ranked 13th in stork and astrin 2014 and 23rd in liu et al 2011 but was not identified in hendricks and duarte 2008 it ranked 3rd in our analysis considering the complete dataset of 514 papers 3 2 2 temporal and geographical distribution of topics topic 1 water quality was the main topic in the early 1990s and the number of articles on this steadily increased after 2005 fig 5 which is consistent with findings by niu et al 2014 and zare et al 2017 although they identified more papers due to the difference in search equations topic 2 integrated assessment and topic 3 water quantity energy crops appeared in the mid 1990s the number of articles related to topic 2 then grew from the early 2000s while the number of articles on topic 3 stayed low until 2004 and increased from 2008 to 2009 to comprise more than a quarter of the total in 2015 2016 fig 5 topic 4 biodiversity was the last to appear 2001 and began to expand strongly in 2006 to comprise 13 16 of the total in 2015 2016 for the biodiversity topic hendricks and duarte 2008 liu et al 2011 and stork and astrin 2014 showed exponential growth over time which differed from our result focusing on agricultural landscape fig 5 similarly while we show that publication on this topic began in the early 2000s they report that it began in the early 1990s hendricks and duarte 2008 liu et al 2011 stork and astrin 2014 this shows that studies on biodiversity in alternative agricultural landscapes came later than studies focusing on biodiversity conservation highlighted as a main theme in liu et al 2011 and stork and astrin 2014 finally the share of topics changed between the periods 1990 1999 2000 2009 and 2010 2017 with topic 1 being less represented in recent periods although still dominant the trend in the top 10 terms in topic 1 table 3 showed a decrease over time in the occurrence of sediment while the term pollution became more frequently used appendix b the term bmps also tended to decrease in use while practice increased for topic 2 use of the term policy increased while decision and farmer first increased and then tended to decrease in recent years use of stakeholder varied greatly over time although it became more frequent in recent years for topic 3 use of the terms climate and change largely increased since 2010 while the term groundwater was less often used for topic 4 the term landscape was frequently used since 2007 more than the term field appendix b the word population gained in popularity over time while use of richness declined finally the term prediction was more frequently used in very recent years since 2015 the four topics were common in north american literature usa and canada especially topics related to water quality topic 1 48 of papers and water quantity energy crops topic 3 51 of papers fig 6 european countries also published on the four topics but in contrast produced more on topic 2 integrated assessment 71 of papers and topic 4 biodiversity 78 of papers germany the netherlands france and uk were the european leaders on topic 2 19 18 14 and 14 papers respectively out of 97 in europe while germany clearly dominated the literature on topic 4 among european countries 19 papers out of 42 in europe australia contributed to all topics china to all except topic 4 biodiversity and african researchers to all except topic 2 integrated assessment while south american countries only brazil contributed only to topic 3 water quantity energy crops fig 6 identification of north america and to a lesser extent europe as leaders of topics 1 and 3 was consistent with findings by niu et al 2014 and zare et al 2017 who focused their reviews on groundwater and integrated water assessment respectively they also identified china india and australia among the most active countries niu et al 2014 zare et al 2017 while our results are in accordance with the ranking of asian countries they underestimate publications by oceanic countries on water issues the dominance of usa and europe on the biodiversity topic topic 4 is in accordance with findings in biodiversity specific reviews hendricks and duarte 2008 liu et al 2011 however our geographical analysis was based on the country of the first author only and did not consider the study site country this gave different results e g for biodiversity stork and astrin 2014 found a strong focus on asia and south america 3 3 multiple topics at a topic dominance threshold of 0 15 463 papers related to only one topic fig 7 no article displayed a large frequency of terms corresponding to more than two topics fig 7 such articles appeared only for higher dominance thresholds with one paper showing a large number of terms related to topics 1 2 and 4 threshold of 0 20 and higher and one article related to topics 2 3 and 4 threshold of 0 25 appendix c a higher number of articles used terms relevant to two topics 51 papers except for topics 1 and 4 combined i e water quality and biodiversity and topics 3 and 4 combined i e water quantity energy crops and biodiversity with only one article each at the 0 15 threshold fig 7 the article combining topics 3 and 4 was published in 2011 by a uk team and assessed potential regional carbon stocks according to different scenarios among which were a bioenergy crop scenario topic 3 and a biodiversity scenario topic 4 cantarello et al 2011 combinations of topics 1 and 4 and topics 3 and 4 were rare whatever the threshold tested appendix c at the 0 15 threshold the number of articles sharing two topics was similar as regards topics 1 and 2 1 and 3 2 and 3 and 2 and 4 11 13 articles in each case see fig 7 combinations of topics 1 and 3 and of topics 2 and 3 were more sensitive to the threshold value with 10 fold more papers at a threshold of 0 25 than at a threshold of 0 05 appendix c the number of articles covering topic 3 was the most sensitive to threshold value with almost 19 fewer articles at a threshold of 0 05 compared with 0 25 comparing these two thresholds 20 topic 3 papers water quantity energy crops appeared to share terms with topic 2 12 papers topic 1 7 papers and topic 4 1 paper this shows that those studies on water quantity energy crops mostly included an integrated assessment framework or aspects on water quality which is consistent with the research trend on integrated water assessment and modelling zare et al 2017 no time trend of mixed topics in the relevant papers was found for any dominant topic appendix d this shows some fluidity between topics with varying impacts studied e g the impact on birds of developing bioenergy crops engel et al 2012 everaars et al 2014 or the impact of policy on bird conservation or field habitat drum et al 2015 bredemeier et al 2015 although the paper was allocated to one specific topic topic 4 for the examples cited for the 51 papers for which no dominant topic was found at a threshold of 0 15 no time trend was identified regarding an increase in mixing topics appendix d overall 29 of these papers performed an integrated assessment including water quality topics 1 and 2 25 made an integrated assessment including water quantity or energy crops topics 2 and 3 22 studied biodiversity with an integrated assessment approach topics 4 and 2 and 20 of the 51 papers studied both water quality and water quantity energy crops topics 1 and 3 less frequent topic combinations were studies of water quality together with biodiversity topics 1 and 4 and studies of biodiversity and water quantity energy crops topics 4 and 3 with one paper each 4 discussion in this review we assessed published studies in which a modelling approach was used to design and assess the performance of alternative agricultural landscapes our aim was to identify the structure of existing research and the range of associated methods and models employed 4 1 main topics identified potential reasons and limits our analysis of the selected literature identified four main topics water quality topic 1 water quantity energy crops topic 3 biodiversity and gm topic 4 and a multi issue topic considering integrated assessment i e policies and stakeholder decisions for landscape simulation topic 2 these topics were each linked to a scientific discipline hydrology for topics 1 and 3 ecology for topic 4 and economics policy study for topic 2 terms related to cropping practices i e agronomic terms were associated to each topic although with a lower number of terms for topic 4 topic 3 was associated with one specific cropping practice irrigation and type of crop biofuel corn and their proportions within the landscapes topic 1 was associated with bmps with a specification options of tillage fertilisation showing a certain homogeneity and simplification in the range of agronomic options tested bmps constituted a positive list of agronomic practices regarding soil water nutrients integrated pest and landscape management schenpf and cox 2007 the term bmps appeared to be mainly used by north american researchers this term arose in the usa in guidelines to address non point source pollution for water quality protection through the 1972 federal water pollution control act phillips and blinn 2004 this is consistent with the specific terms related to models in topic 1 with the names of models developed in the north america e g swat see gassman et al 2007 being the leader for water management topics topics 1 and 3 this could be linked to the type of agriculture practised in north america i e highly irrigated fao 2014 intensive and specialised e g monocropping in the corn belt leading to both water quality and quantity issues and related research europe was the leader for the topic integrated assessment topic 2 characterised by the more general term decision support system or dss the dominance of europe on the topic integrated assessment including stakeholder participation and decision support systems within the specific context of alternative agricultural landscape modelling can be attributed to the fact that it emerged in the netherlands in the late 1990s rotmans and van asselt 1996 and had grown into a booming field by the early 2000s hisschemller et al 2001 integrated assessment was initially defined by two main characteristics i building upon research in different disciplines and ii providing information for decision makers rotmans and van asselt 1996 however we focused on agricultural landscapes which could explain the geographical bias observed for this topic for instance integrated assessment methods are used by north american researchers but their focus is not on agriculture e g flood resilience in allen et al 2019 topic 1 showed greater homogeneity in methods for the water quality topic which makes comparisons easier but could also indicate less originality in the methods applied in contrast to integrated assessment and water quantity energy crops topics 2 and 3 the topic on biodiversity topic 4 was the only one highlighting different spatial scales patch field landscape thus tending to have a spatially explicit approach the topic on integrated assessment included the term farm which is more related to a decision level water quality studies used mostly swat which is a distributed spatially explicit model water quantity energy crop studies looked more at aggregated values on e g water demand or total production although they sometimes considered spatial scale for implementation of a crop practice change the spatial scale was thus determined by the issue however alternative landscapes are the result of multiple drivers that take place at different scales e g biodiversity at patch scale decision and economic consequences at field and farm scale aggregated effects at landscape scale thus calling for multi scale studies 4 2 potential gaps and future works the impact of agricultural landscapes on biodiversity topic 4 the last to emerge in our dataset was studied equally in north america and europe this is consistent with findings in a more general review i e not specific to agricultural landscapes by di marco et al 2017 that there is a geographical bias europe north america central america in studies of conservation science surprisingly the term ecosystem services was associated with integrated assessment of agricultural landscapes topic 2 and not biodiversity topic 4 the relative absence of ecosystem services in the biodiversity topic is consistent with previous findings in a review by egoh et al 2007 that a very low number of conservation assessments include ecosystem services this could be explained by the way in which the concept of ecosystem services was promoted in millennium ecosystem assessment ma 2005 i e as a policy tool aiming at sustainable use of natural resources seppelt et al 2011 thus corresponding more to our topic integrated assessment however the ecosystem services concept was also developed to demonstrate the value of nature walz and syrbe in press and is closely related to biodiversity preservation european commission 2011 this could indicate that biodiversity studies need to align more tightly to political context and governance alternatives e g velten et al 2018 with inclusion of biodiversity aspects in dss more stakeholder interactions and greater inclusion of ecology researchers on ecosystem services which is becoming a hot topic in particular integrating the relationships between biodiversity and ecosystem services e g birds feeding on weed seeds gaba et al 2014 in agricultural landscape modelling could help provide a framework for future policies combining biodiversity and agriculture while we identified a few papers studying the impacts of policy on birds or habitats those did not include a bottom up approach involving local stakeholders to co design possible actions and their translation into local policies e g bredemeier et al 2015 or used a simplified vision of agricultural practices e g drum et al 2015 this calls for more inclusive biodiversity based studies involving the participation of local stakeholders farmers but also local authorities and nature ngos to develop local policies for alternative landscapes combining biodiversity preservation and agricultural production with explicit and detailed consideration of the constraints of these two sectors unlike current policy developments those studies would be based on a bottom up approach combining detailed knowledge of current agricultural practices biodiversity issues and potential win win or compromise situations identified e g in participatory workshops the benefits of this type of research would be both scientific transdisciplinary research with cross fertilisation between different disciplines e g ecology agronomy economics and oriented towards local action through the promotion of practices and policies developed locally it follows that the design of agricultural landscapes will require joint work by scientists and stakeholders to identify the desired ecosystem services and design the necessary landscape modifications landis 2017 as biodiversity and nature are becoming a hot topic with recent reports of species decreases and extinctions diaz et al 2019 policy makers are urged to promote effective actions in favour of biodiversity and ecosystem services preservation in this work research methods and tools could be used for both design and assessment of alternative landscapes as claimed by hill et al 2013 participatory scenario design together with collective visioning urgently needs to be revised to favour policy development and foster social consensus on biodiversity conservation complex landscapes should be represented with models accounting for the spatial configuration or composition in a balanced way although development of such models is still in its infancy langhammer et al 2019 studies could target for instance natural pest control in an ecological intensification perspective where natural enemies replace pesticides in cropping and farming systems in landscape scenarios bommarco et al 2013 an exploratory model based approach is lacking at landscape level where natural pest control is only assessed via some landscape proxies such as diversity of land cover around the perimeter to determine the potential amount of services mitchell et al 2013 most papers in our dataset were linked to one dominant topic less frequent topic combinations were studies of water quality together with biodiversity topics 1 and 4 and studies of biodiversity and water quantity energy crops topics 3 and 4 although we excluded papers focusing only on the effects of climate change this theme emerged as a driver of scenarios in topic 3 water quantity energy crops thus in our dataset biodiversity was apparently not assessed in studies linking climate change and agricultural practices the two main factors that actually threaten biodiversity different studies have assessed biodiversity responses to climate change e g bellard et al 2012 or to agriculture and their potential conflicts e g henle et al 2008 attempts to study their joint effects appear to have focused mostly on land use change without detailing agricultural practices several studies have considered habitat loss but with less attention to spatial e g fragmentation in the landscape or practice change e g management intensity de chazal and rounsevell 2009 and with a limited number of taxa considered chopin et al 2019 future studies of alternative agricultural landscapes thus would need to enlarge the vision on biodiversity e g by increasing the number of taxa chopin et al 2019 and including detailed population characteristics and their climate drivers together with potential agricultural practices to be applied in these futures this will require integrated approaches as agricultural practices are determined by a set of drivers including but not limited to climate change participatory approaches would thus be also required for this issue finally our review did not identify hot topics and methods used in agricultural studies for instance resilience was not identified as a top word among our four topics appearing in only five of the 514 papers in our dataset however resilience is gaining increasing attention in agricultural research to characterise the relationship between agricultural outputs and perturbation the two main parameters being global warming and price volatility urruty et al 2016 agronomists study agricultural resilience at farm to country scale urruty et al 2016 the landscape scale tends to be studied by researchers in ecology looking at e g spatial resilience location connectivity complexity cumming 2011 land use management and habitat tscharntke et al 2005 or by economists looking at land use patterns and the resilience of agricultural returns abson et al 2013 in those ecology based studies agricultural practices are often simplified characterised as categories of land use and disregarding the level of decision i e the farm this indicates that the landscape agronomy approach called for by benot et al 2012 has not yet fully emerged this approach is necessary for disaggregating land use and better characterising the diversity of cropping systems and landscape diversity as highlighted by chopin et al 2017 it is particularly important for issues requiring coordination of agriculture related actions at the landscape scale e g erosion in souchre et al 2010 or collective governance of e g water resources e g murgue et al 2015 or integrated crop livestock systems e g moraine et al 2017 5 conclusions in this review we distinguished four main topics covered by studies modelling the impacts of agricultural changes at landscape scale these were water quality water quantity energy crops biodiversity and integrated assessment we found very few publications on these topics in south america and africa despite the fact that hot topics like water scarcity in africa are likely to increase with climate change calling for collective governance at scales beyond field and farms similarly issues like gms and emerging weed resistance particularly in south america call for spatially explicit methods for coordinating actions at medium spatial scales finally although we found abundant north american and european studies on modelling agricultural changes and impacts at landscape scale hot topics like pesticides eu and diversification usa did not emerge despite their critical impacts at landscape scale for e g water quality water quantity and pest control this indicates an urgent need for integrated studies considering the diversity of agricultural and cropping systems in governance of the collective issues of water quality water quantity and biodiversity acknowledgments the second author received funding from slu s cropping system platform this work was also carried out with the financial support of inra france we would like to thank mary mcafee for english editing we thank the three anonymous reviewers for their helpful and valuable comments on an earlier draft of the manuscript appendix a tokenisation and stemming r code image 1 appendix b trends of the top 10 keywords for the four topics the y axis indicates the number of articles in which the word was identified image 2 appendix c sensitivity of document topics mixture to dominance threshold value topic 1 is related to water quality topic 2 is related to integrated assessment of agricultural systems topic 3 is related to water quantity and bio energy crops and topic 4 is related to biodiversity image 3 appendix d distribution of topics in the 514 papers presented for each dominating topic threshold 0 15 topic 1 is related to water quality topic 2 is related to integrated assessment of agricultural systems topic 3 is related to water quantity and bio energy crops and topic 4 is related to biodiversity image 4 appendix e supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix e supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2019 104513 
