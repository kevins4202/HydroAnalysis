index,text
525,flood propagation in rivers is strongly influenced by the presence of bridges and other hydraulic structures among the available approaches for including these elements in numerical models the adoption of internal boundary conditions ibc given its ability to capture backwater is suitable for field scale analyses for flood hazard assessment in this paper the implementation of internal boundary conditions in the two dimensional shallow water code named parflood is presented the application to experimental and real test cases shows that the proposed ibc model can handle both low and high flow conditions for bridges while being flexible for other types of structures e g flow through dams moreover the model is computationally efficient physical computational time ratio around 20 30 for domains with 106 cells thanks to the code parallelization on gpu keywords 2d shallow water equations internal boundary conditions bridges hydraulic structures flood modeling gpu 1 introduction the presence of bridges and other crossing structures can significantly affect the flood propagation in rivers and channels since the piers abutments and deck represent an obstruction to the flow in particular the lateral and vertical constrictions at bridge sites induce a backwater effect upstream of these structures possibly increasing the hazard in flood prone areas in case of severe flood events the water level may exceed the elevation of the deck low chord generating pressure flow under the bridge the deck may even experience overtopping during extreme events these high flow conditions generate very complex flows hence this topic was studied experimentally e g martin vide and prio 2005 picek et al 2007 with a special focus on the assessment of backwater brown 1985 seckin 2004 besides bridges other notable types of structures include sluice gates for flow regulation and irrigation management weirs and flow through dams for flood control all these elements interfere with the flow and their presence should be properly taken into account in numerical simulations performed for flood management applications costabile et al 2015 nowadays two dimensional 2d models based on the shallow water equations swe are often adopted for flood risk and hazard assessment for the design and verification of mitigation strategies and even for civil protection purposes ferrari et al 2020 however the markedly three dimensional characteristics of the flow field around most hydraulic structures where non negligible vertical velocities and accelerations can occur prevent a straightforward integration of these elements in depth averaged models based on the hypothesis of a hydrostatic pressure distribution even if different simple approaches are available for the representation of bridges and other hydraulic structures in one dimensional 1d models i e brunner 2016 natale et al 2004 catella and bechi 2006 fewer analyses can be found in the context of 2d models according to ratia et al 2014 there are three available methods for considering the presence of bridges mesh discretization md head loss hl and internal boundary conditions ibcs maranzoni et al 2015 propose an additional method namely the 2d extension of the preissmann slot model 2d ps the md approach requires an adequate grid refinement at bridge sites in order to represent the piers as holes in the mesh with reflective boundaries the hl model ratia et al 2014 includes an additional source term in the swe which represents the contraction and expansion losses through the bridge the ibcs modify the numerical scheme only at special cells near the inner structure depending on the implementation ibcs can modify either the flux computation zhao et al 1994 or the value of the conserved variables morales hernández et al 2013 usually imposing the unit discharge passing through the hydraulic structure bridge weir dam etc evaluated from a prescribed rating curve or discharge formula finally the 2d ps model based on a modified set of swe accounts for possible flow pressurization when the water surface reaches the bridge low chord and must be combined with the md approach for low flow conditions among these strategies hl and ibcs predict the global effect induced by the bridge presence i e backwater while md aims at simulating the flow field near the hydraulic structure especially as regards the possible transition to supercritical flow downstream however the latter and also 2d ps entails longer simulation times due to the higher resolution needed and to the restriction of the admissible time step moreover md is unable to reproduce high flow conditions correctly and 2d ps can simulate only pressurization without overtopping while hl and ibcs are more flexible in this respect even if empirical formulae are often required finally hl was developed specifically for bridges while ibcs were successfully applied to different types of structures zhao et al 1994 including gates morales hernández et al 2013 and levees echeverribar et al 2019 based on this short discussion ibcs can be identified as a promising strategy for including the presence of hydraulic structures in a 2d model to simulate flood propagation in field scale analyses thanks to their flexibility for different structures and flow conditions and to their ability to capture backwater flood simulations in large domains usually imply long computational times unless optimized and or parallelized codes are used in particular models able to run on graphics processing unit gpu devices e g lastra et al 2009 lacasta et al 2014 vacondio et al 2014 are gaining attention due to their computational efficiency but to date the implementation of ibcs in gpu accelerated codes has never been analyzed in the literature the aim of this paper is to present an efficient strategy for including ibcs in the gpu accelerated 2d swe code named parflood vacondio et al 2014 2017 details about the modifications to the numerical scheme and the gpu implementation are herein provided the model is validated against experimental tests concerning bridge backwater in steady and unsteady conditions and then applied to the simulation of the propagation of floods in the parma river italy with bridges experiencing high flow conditions moreover the case of an ibc to represent the dam which controls a flood detention basin is analyzed the paper is organized as follows section 2 is dedicated to the model presentation focusing on the description of the ibc implementation the validation of the proposed model is described in section 3 while applications to field scale tests are shown in section 4 discussion and conclusions are provided in the last section 2 model description 2 1 the parflood model 2 1 1 mathematical model the parflood model vacondio et al 2014 2017 solves the 2d swe through a finite volume fv scheme the governing equations are depth averaged mass and momentum conservation laws written in integral form as follows toro 2001 1 t a u d a c h n d c a s 0 s f d a where t is the time a and c represent the area and boundary of the integration volume respectively while u is the vector of conserved variables h f g is the tensor of fluxes in the x and y directions and n is the outward unit vector normal to c finally s 0 and s f are the bed slope and friction source terms respectively following the well balanced formulation of liang and marche 2009 the terms u f and g s 0 and s f are defined as follows 2 u η u h v h f u h u 2 h 1 2 g η 2 2 η z u v h g v h u v h v 2 h 1 2 g η 2 2 η z s 0 0 g η z x g η z y s f 0 g h n f 2 u u 2 v 2 h 4 3 g h n f 2 v u 2 v 2 h 4 3 in eq 2 h and z are the flow depth and the bed elevation respectively while η h z represents the water surface elevation moreover u and v are the velocity components along the x and y directions g is the acceleration due to gravity and nf is manning s roughness coefficient an explicit fv scheme is employed to discretize the equations in the first order accurate approximation the conserved variables are updated according to the following expression 3 u i j n 1 u i j n δ t δ x f i 1 2 j f i 1 2 j δ t δ y g i j 1 2 g i j 1 2 δ t s 0 s f where superscript n and subscripts i j indicate the time level and the cell position respectively while δx δy is the cell size in the x y direction and δt is the time step which must satisfy the courant friedrichs lewy stability condition intercell fluxes are computed using the hllc approximate riemann solver toro 2001 and a correction to avoid non physical velocities at wet dry fronts kurganov and petrova 2007 is implemented moreover a centered approximation is adopted to discretize the slope source term vacondio et al 2014 while the implicit formulation proposed by caleffi et al 2003 is used for the friction source term second order accuracy in space and time can be achieved by adopting a depth positive muscl extrapolation at cell boundaries audusse et al 2004 and by applying the second order runge kutta method for advancing the solution in time 2 1 2 gpu implementation one of the main advantages of the parflood model is its cuda c implementation which allows for the exploitation of the intrinsic parallel computations of gpu devices thus guaranteeing simulation times up to two orders of magnitude lower than the ones of serial codes vacondio et al 2014 examples of the good performance of the parflood model for real applications can be found in vacondio et al 2016 and dazzi et al 2018 2019 in the cuda framework the basic work unit is the thread which corresponds to one computational cell of the domain and many threads are grouped into a block each containing k k cells k 16 in this work the parflood model can discretize the domain using either a cartesian computational grid or a block uniform quadtree buq grid which is a non uniform structured mesh specifically designed for guaranteeing efficiency on the gpu architecture see vacondio et al 2017 for details the cuda code takes advantage of two hardware resources the cpu the host and the gpu the device the former controls the execution flow including the memory exchanges between the device and the host keeping track of the time advancement during the simulation while the latter executes the different pieces of code kernels containing instructions for the actual computations during each time step from tn to tn 1 the code performs a sequence of three main tasks as summarized in fig 1 each of which includes cpu instructions for launching one or more kernels before describing the implementation of ibcs in detail section 2 2 some features of the original model are briefly recalled see vacondio et al 2014 for further details 2 1 3 external boundary conditions boundary conditions bcs are handled by adopting the implicit local ghost approach which does not require the explicit modeling of ghost cells since ghost values at boundary edges are retrieved at runtime thanks to appropriate instructions included in the kernels information concerning the existence and type of bc for each cell must be stored in additional data structures and later accessed during kernel execution to correct the neighbor values with appropriate expressions e g reflective transmissive and compute boundary fluxes please notice that different boundary conditions can be associated to different edges of the same cell without any conflicts and this makes the simulation of complex boundaries in field applications straightforward and efficient while wall and far field bcs are handled directly by the flux computation kernel in the case of open boundaries discharge or level hydrograph stage discharge relationship some conserved variables must be imposed at boundary cells task 1 in fig 1 for an inflow bc discharge values are interpolated from the discrete time series provided as input data and converted to specific discharges by cpu processing then a dedicated kernel is launched over the boundary cells to assign the prescribed value of specific discharge water elevation is also imposed for supercritical inflow for outflow boundaries the water level is prescribed for subcritical conditions while no assignments are performed for supercritical outflow finally a stage discharge relationship can also be imposed as downstream bc based on the average water level at boundary cells the value of discharge is interpolated from the discrete table provided as input data and the specific discharge is redistributed over boundary cells 2 1 4 δt computation and block deactivation optimization bdo in a dedicated kernel launched during task 2 in fig 1 the allowable time step is computed for each cell and the minimum for each block is determined then the cpu calculates the minimum for the whole domain at the same time the kernel also identifies whether a block is wet dry blocks are then deactivated excluded from the computations during the current time step by cpu processing in order to avoid unnecessary calculations and thus reduce the computational burden 2 1 5 flux computation and time integration for each cell a kernel retrieves the left and right states at each of the four edges north south east west of a cell computes the four fluxes using the hllc solver and updates the vector of the conserved variables according to eq 3 it must be noted that the algorithm actually repeats the calculation of each intercell flux twice once for each thread sharing that edge because this strategy was found to be more efficient on the gpu than introducing a separate kernel for flux computation and allocating an extra array for fluxes on the global memory however conservation is guaranteed by the fact that the same left right values are used for both computations for the first order approximation these values coincide with the conserved variables at the center of the current cell and of its four neighbor cells for the second order scheme additional kernels for muscl extrapolation and half step summation are necessary see vacondio et al 2014 for boundary conditions specific procedures allow the correct definition of the conserved variables in neighbor cells used for flux computation 2 2 internal boundary conditions in the present section the details of the algorithm adopted to introduce the internal boundary conditions in the parflood solver are described the planimetric position of a hydraulic structure is identified by means of a line or polyline which is discretized through a number of cell edges at the pre processing stage see fig 2 cells facing at least one of these internal edges are then identified and marked as upstream or downstream ibc cells the case of a bridge type ibc will be described in the following whereas other types of hydraulic structures will be considered at the end of the section the input data must include the bridge geometry fig 3 in particular the low chord elevations a ceiling elevation for pressurization is assigned to each ibc cell so that complex geometries like single or multiple arched bridges can be described adequately an overtopping elevation is also provided abutments and piers can be either handled as holes in the mesh or included in the bridge geometry as cells with a ceiling coinciding with the bottom elevation zero opening see fig 2 2 2 1 selection of flow conditions and discharge estimation the basic idea is to compute the average water level upstream and downstream of the bridge structure and to compare it with the minimum and maximum ceiling elevations in order to distinguish different flow conditions low flow partially pressurized fully pressurized overtopped see fig 3 these values are then used for estimating the discharge flowing through the bridge by adopting a discharge formula this approach differs from previous works concerning ibcs in 2d models where the discharge formula was employed at each cell edge separately morales hernández et al 2013 echeverribar et al 2019 although the strategy of using a global evaluation is closer to 1d modeling it is more robust and efficient and also more flexible to different types of structures for which global rating curves are sometimes available from physical modeling for low flow conditions no interaction with the deck ibcs are not activated and all cells behave as ordinary inner cells conversely for high flow conditions the specific discharge is imposed in upstream ibc cells please note that the water level is not modified in any cell so that mass is neither added nor subtracted to the domain the same specific discharge assigned to each upstream ibc cell is replicated in its companion downstream ibc cell the model assumes that the flow is normal to the ibc edge hence the specific discharge in the tangential direction is set equal to zero this hypothesis may induce directionality to flow which can be particularly noticeable in the case of skewed bridges but in the meantime it guarantees that mass is conserved through the ibc edge moreover this effect is expected to affect the flow field only locally while the overall prediction of flood propagation and backwater should not be much influenced more in detail the ibc processing in the parflood model starts during task 1 fig 1 after open bcs have been assigned a first kernel is launched over blocks containing ibc cells with the aim of computing the mean levels upstream ηu and downstream ηd of the bridge in particular the partial summation of water surface elevations in upstream and downstream ibc cells for each block is performed during kernel execution based on a logarithmic reduction vacondio et al 2014 then these partial values are passed to the cpu which combines them to compute the result some discharge formulae require the additional definition of the total heads hu and hd these average values are also evaluated if necessary based on the computed mean levels and on the bridge geometry the flow condition during the current time step is selected by cpu processing let us define zlow min and zlow max the minimum and maximum elevations of the bridge low chord ztop the elevation of the top chord and zbottom as the minimum bottom elevation along the bridge section fig 3 first a check on the flow direction is performed in order to capture possible flow reversal which can be observed at bridges immediately upstream of a retaining structure or a confluence if ηu ηd most common case one of the following conditions is verified 1 if ηu zlow min low flow conditions occur and ibcs are ineffective a simple kernel which sets to zero the specific discharge normal to upstream and downstream zero opening cells if present is launched 2 if zlow min ηu zlow max the bridge is partially pressurized only a subset of ibc cells interacts with the bridge deck this partial obstruction is taken into account by reducing the normal specific discharge q in the upstream cells whose water surface elevation exceeds the local ceiling z low k for cell k for example as follows 4 q k q k z l o w k z k η k z k if η k z l o w k where q coincides with uh or vh depending on the ibc edge inclination both components are modified if the cell shares two ibc edges then the same specific discharge overlined is assigned to the corresponding downstream ibc cell note that the specific discharge in all ibc cells with η zlow remains unchanged while the specific discharge in zero opening cells e g with zlow k zk is zeroed 3 if zlow max ηu ztop the bridge is fully pressurized two possible flow conditions namely free flow and submerged flow can occur in the former case the discharge q passing through the bridge is evaluated as follows 5 q c d a 2 g h u 0 5 z l o w m a x z b o t t o m for submerged flow on the other hand the pressure flow equation is used 6 q c q a 2 g h u η d in eqs 5 and 6 a represents the total area of the bridge opening while cd and cq are discharge coefficients for the two flow conditions typical values used in the practice are 0 5 and 0 8 bradley 1978 the selection of the appropriate configuration is performed following cozzolino et al 2015 namely by evaluating a tentative discharge by means of eq 5 and computing the depth at the vena contracta and its conjugate depth if the latter is exceeded by the downstream depth the flow is submerged otherwise free flow conditions occur please notice that in the free flow case the discharge is computed by adopting eq 5 but the downstream depth is not set equal to the depth at vena contracta indeed this operation would violate mass conservation unless a special procedure is introduced as done by echeverribar et al 2019 as regards the imposition of the critical depth downstream of a weir which is not straightforward in an efficient gpu implementation moreover the drawback of neglecting this contraction downstream of bridges is common to other approaches ratia et al 2014 aimed at capturing the global effect of the bridge presence backwater rather than the local details of the flow field 4 if ηu ztop the bridge is also overtopped compared to the previous case the discharge is increased according to the weir equation 7 q c w l 2 g h u z t o p 3 2 where l is the bridge length normal to flow and cw is a weir coefficient please notice that the local head losses at the bridge site are represented by the discharge coefficients for case 3 on the other hand the strategy of imposing a reduced discharge based on the area available to flow in ibc cells for case 2 is preferred over the introduction of an additional head loss in order to guarantee smooth transitions from low flow to partially pressurized flow conditions and between adjacent pressurized and non pressurized cells moreover no additional calibration coefficients which lack experimental grounds are required for this simple and computationally efficient approach for cases 3 bridge fully pressurized and 4 bridge fully pressurized and overtopped based on the evaluated total discharge and on the length and orientation of the ibc string please recall that the flow direction is assumed normal to the bridge the specific discharge q is computed and redistributed over the upstream ibc cells the new values of the conserved variables to be imposed for a generic upstream ibc cell k are as follows 8 q k q h a v a i l k k 1 n h a v a i l k where as before q k coincides with uh or vh depending on the ibc edge inclination both components are considered for cells with two ibc edges while n represents the number of ibc edges moreover havail k is the weight of cell k coinciding with the available flow area divided by the grid size which can be evaluated as z low k zk for case 3 and z low k zk η k ztop for case 4 note that for piers cells havail k is zero for case 3 and η k ztop for case 4 if a cell shares two ibc edges both specific discharge components are actually modified based on havail k then the same values of the specific discharge are attributed to downstream ibc cells as in case 2 the water level is never modified in ibc cells during this redistribution for example let us consider the simple case of two neighbor cells i j and i 1 j separated by an ibc edge fig 4 a while η i j and η i 1 j are not modified the following values are assigned to the specific discharges in the x and y directions u h i j u h i 1 j u h vh i j vh i 1 j 0 where u h is the result of the discharge redistribution for cell i j according to eq 8 if the flow is reversed downstream towards upstream all the previous checks are performed considering ηd instead of ηu and swapping upstream and downstream ibc cells finally for other types of internal structures the flowchart for selecting the appropriate flow condition is modified according to the type of ibc considered for example only cases 1 and 3 need to be considered for a sluice gate for complex structures e g flow through dams a stage discharge relationship obtained from physical modeling is often available and can be provided in tabular form as input data checks 1 4 are skipped and the discharge is simply obtained from the rating curve valid for the considered hydraulic structure then the modified conserved variables at the ibc cell can be computed by means of eq 8 more complex cases could be handled by supplying multiple rating curves and instructions on how to switch between them e g gate operations 2 2 2 flux computation as regards flux computation and cell updating task 3 in fig 1 the ibc implementation requires few changes to the original scheme thanks to the implicit local ghost cell approach already implemented for external bcs in fact the most important modification to the usual scheme for ibc cells lies in the definition of left and right states for an ibc edge while all fluxes are then computed using the hllc riemann solver as in standard cells it is worth recalling that in the parflood implementation each cell computes its own fluxes hence each flux is actually calculated twice in the framework of ibcs this peculiarity is exploited to take into account the bridge discontinuity in particular different values of the left right states are used to compute fluxes at the ibc intercell in the upstream and downstream cell so that limited to these particular edges the fluxes exiting from the upstream cell are not the same as those entering the downstream cell with reference to the simple case of cells i j and i 1 j fig 4b let us consider cell i j first the fluxes to the east are computed using the conserved variables at the cell center as left state while the right state is simply determined by mirroring the left state the result of the hllc solver with the same left and right states coincides with the physical flux 9 f i 1 2 j u u h u h h i j 1 2 g η 2 2 η z i j 0 focusing on cell i 1 j the same strategy of mirroring the centered values is applied to define the left state at the western edge and the physical flux is the following 10 f i 1 2 j d u h u h h i 1 j 1 2 g η 2 2 η z i 1 j 0 from a comparison between the two fluxes it can be noticed that the first component is the same for both computations meaning that mass conservation is always guaranteed the difference between the momentum fluxes a part from a possible bottom step discontinuity which is balanced by a proper discretization of the bed slope source term equals the reaction exerted by the deck onto the fluid assuming a hydrostatic pressure distribution see appendix a please note that other models also introduce violations of the momentum conservation in order to consider the presence of a structure ratia et al 2014 introduced the presence of a bridge as a momentum sink additional source term using the hl approach in maranzoni and mignosa 2018 a fictitious cell was inserted to mimic the unbalance in the momentum equations caused by a ceiling step discontinuity while in cozzolino et al 2015 different physical fluxes were imposed directly when updating cells separated by a gate the advantage of the proposed approach compared to zhao et al 1994 cozzolino et al 2015 and maranzoni and mignosa 2018 is the fact that code branching is very limited since basically only the introduction of an additional type of boundary condition handled by means of the implicit local ghost approach is required while the call to the hllc solver remains unchanged this is also convenient for enabling both high and low flow conditions in ibc cells in the latter case the mirroring of centered values is simply skipped so that left right states at the ibc edge are retrieved from the conserved variables in the current cell and in its neighbor as in standard cells 3 model validation in this section the results of numerical tests for model validation are reported all simulations are performed using a p100 tesla gpu 3 1 steady flow experiments 3 1 1 picek et al 2007 a subset of the laboratory tests presented by picek et al 2007 was simulated for the model validation in high flow conditions experiments were carried out in a flume with a 0 75 m wide rectangular cross section and a horizontal bottom where a 0 3 m long 7 5 cm thick bridge was placed 1 1 m from the downstream end of the channel different steady state subcritical conditions all characterized by pressurized flow through the bridge were realized by varying the inflow discharge the deck s vertical position and the water level at the downstream end of the flume table 1 reports the 9 test conditions here considered in particular tests labelled p1 correspond to pressurized conditions while p2 and p3 refer to overtopping with unsubmerged or submerged flow respectively in the simulations the domain is discretized by means of cells of size 0 05 m while manning s coefficient is set equal to 0 01 m 1 3 s a constant inflow discharge and the measured water level is imposed as upstream and downstream boundary conditions respectively while for the weir coefficient in eq 7 the value 0 32 is assumed the discharge coefficient in eq 6 is set equal to 0 97 after trial and error this value is higher than the usual range 0 7 0 9 however picek et al 2007 showed that for their deck geometry the actual range for cq is 0 8 0 95 for a partially submerged bridge and up to 1 0 1 1 for an overtopped bridge the discrepancy was there justified by the absence of side contractions in the test geometry measured and simulated values of the average water depth upstream of the bridge are compared in table 1 together with the relative error which is always below 5 these results confirm the capability of the model to reproduce the backwater induced by the presence of the deck a sensitivity analysis to the discharge coefficient was performed for test p1a and results show that relative errors of the upstream water level remain below 10 as long as cq is higher than 0 88 up to 1 1 while overtopping is wrongly predicted for lower values predicted water surface profiles along the channel centerline are analyzed for test cases of type b fig 5 the comparison between measured and numerical profiles shows that as expected the near field features around the bridge are not reproduced accurately by the model especially the local water surface upsurge at the upstream face of the deck probably due to the head loss for the vertical flow contraction and the flow expansion profile downstream actually the flow through a bridge is characterized by significant accelerations in the vertical direction which cannot be simulated adopting a depth averaged model also as regards the overtopping tests the ibc model is unable to reproduce the profile over the deck the flow field here consists of two independent layers below and above the bridge and clearly a shallow water model cannot represent this configuration however the backwater profile which develops upstream of the bridge is well caught for all flow conditions hence the model is able to predict the overall effect induced by the deck this can be evaluated quantitatively by computing the root mean square error rmse of the numerical water surface profile along the channel compared to the experimental one table 1 values of rmse below 1 cm less than 4 of the mean water level in the channel except for test p1a confirm the quite good performance of the model 3 1 2 brown 1985 the laboratory investigation performed at the hr wallingford laboratory and reported by brown 1985 was selected for validating the model in the case of arched bridges a large number of experimental runs in steady flow conditions were performed in a 15 m long channel with variable width where a bridge was inserted 7 6 m from the downstream end different bridge configurations inflow discharges and tailwater levels were considered the three types of bridge simple arch unit hr1 widened arch unit hr2 and multiple arches hr3 selected for this work are represented in fig 6 a large subset of these tests all characterized by fully pressurized conditions with no overtopping were simulated with the proposed model assuming δx δ y 0 02 m and manning s coefficient equal to 0 01 m 1 3 s test conditions are summarized in table 2 bridge piers are modelled as cells with zero opening in the ibc model measured and simulated upstream levels compared in table 2 are in good agreement in fact the relative error is always below 3 these results were obtained using a calibrated value for cq set equal to 1 0 0 86 and 0 92 for bridge types hr1 hr2 and hr3 respectively these values were selected after performing a sensitivity analysis of the upstream water depth to cq for one test for each bridge geometry namely tests 4d 19c and 29b which allowed selecting the most suitable value it was also observed that relative errors of the upstream water level were always below 10 considering discharge coefficients in the range 0 8 1 10 for tests 4d and 29b and 0 7 1 0 for test 19c this suggests that even though the predicted backwater somehow depends on the discharge coefficient when the bridge is fully pressurized moderate variations of this parameter still guarantee acceptable results as described in section 2 2 the model redistributes the specific discharge based on the available area for arch bridges in pressurized conditions this treatment gives origin to a markedly 2d flow field upstream of the bridge as can be observed in fig 7 for test 29b at bridge piers the water surface level slightly increases and velocity falls to zero while the maximum velocity is noticeable at the center of arches 3 2 unsteady flow experiments the performance of the model in case of unsteady flows is assessed by simulating some of the experimental dam break test cases reported by ratia et al 2014 the laboratory set up consisted of a 0 84 m wide reservoir filled with still water and a 6 m long 0 24 m wide channel closed downstream fig 8 a the instantaneous lifting of a gate between channel and reservoir generated a dam break wave a bridge was positioned approximately 1 65 m downstream of the gate and different bridge shapes were employed figs 8b d the water level was measured at two locations upstream and downstream of the bridge g1 and g2 in fig 8a table 3 summarizes the test conditions for the three cases considered in this work numerical simulations are performed adopting a uniform 0 015 m grid resolution while the value 0 0125 m 1 3 s for manning s coefficient was calibrated to fit the arrival time of the dam break wave at the upstream gage the first test case r1 concerns a deck bridge without piers and the results of numerical simulations including or excluding ibcs are compared with experimental measurements in fig 9 the description of the bridge through an ibc allows predicting the backwater upstream which as expected cannot be modelled in the base simulation without ibc the discharge coefficient in eq 6 was set equal to 0 75 after calibration in particular its value was varied in the range 0 65 0 85 and the envelope of the obtained results is represented in fig 9 as a gray band the predicted maximum water depth at gage g1 varies in the range 7 compared to the simulation with the calibrated value it should be kept in mind that discharge formulae used at the ibc are valid for steady flow or slowly varying flow while the impact of a dam break wave is highly unsteady and entails dissipations that cannot be easily included in a shallow water model despite this the ibc model can capture the overall process adopting any value for cq while tuning this parameter allows improving the agreement with experimental data two additional test cases were considered concerning an arch bridge r2 or a deck with two piers r3 for these tests three approaches were compared 1 piers as holes in the mesh md approach neglecting the influence of the deck 2 ibc approach where piers are included as ibc cells with zero opening and 3 a combination of md and ibc where piers are holes in the mesh but the deck is also included as an ibc notice that in these experimental setups the main flow obstruction is represented by the bridge piers and good numerical results may be expected even adopting the md approach moreover for these test cases the discharge coefficient does not influence the results since the bridge barely becomes pressurized during the process fig 10 reports the numerical results along with experimental data the upstream water levels are reproduced quite well in all simulations even if the peak is slightly underestimated conversely only approaches 1 and 3 allow a good prediction of the downstream water levels because the flow contraction due to the piers is relevant in these configurations but it cannot be described properly assuming a thin structure as in approach 2 this limitation is common to other methods e g hl described by ratia et al 2014 and is related to the impossibility of modeling the supercritical flow downstream of the bridge without a detailed reproduction of contraction and expansion through the piers especially for test r2 despite this the overall process is in reasonable agreement with experiments even with this simplified approach for describing bridge piers small oscillations downstream at t 14 s are related to the complex flow field due to the interaction of the flow passing through the bridge with the surge wave travelling upstream generated after the dam break wave impacts the wall at the end of the channel 4 application the application of the proposed model to a field test case is here presented the middle reach of the parma river northern italy which flows through the city of parma is selected as case study a sketch of the study area is represented in fig 11 two sets of tests are carried out the first tests labelled f concerns the simulation of the 2014 flood event in the urban reach of the river which is crossed by five arched bridges with piers the second one shows the use of an internal rating curve to represent the flow through dam of the flood detention basin which protects the town 4 1 2014 flood event the model is used to simulate the flood event which occurred on october 13th 2014 on the parma and baganza rivers this first application tests labelled f is focused on the flow interaction with the five historical bridges on the parma river hence the domain is limited to the 6 km long river reach identified in fig 11 the upstream boundary condition is the estimated discharge hydrograph immediately downstream of the confluence of the two rivers with a peak value equal to 820 m3 s fig 12 a while a rating curve is imposed as downstream boundary condition at the highway crossing the geometry of bridge 2 is reported in fig 12b as an example four simulations were performed adopting either the md approach or the ibc method for representing the bridges see test conditions in table 4 and discretizing the domain with square cells of resolution equal to 1 m 5 5 million cells or 2 m 1 4 million cells manning s coefficient in the urban reach of the river was set equal to 0 03 m 1 3 s for the ibc tests the discharge coefficient in eq 6 was set equal to 0 9 the physical time of simulation is 8 h fig 13 a compares the longitudinal profiles of the maximum water surface elevations along the river centerline obtained from different simulations the surveyed maximum levels are also reported the differences between simulated and observed maximum water surface elevations are plotted in fig 13b for better comparison results show that during this event four bridges were partially pressurized during the peak flow and this is predicted correctly by the ibc model adopting both 1 m and 2 m meshes tests f2 and f4 in fact the simulated profiles of the maximum levels are in good agreement with the high water marks this is confirmed by the evaluation of the rmse of the simulated maximum water surface elevations with reference to the surveyed maximum levels reported in table 4 the rmse is below 0 20 m for these tests the md simulation with the finest resolution test f1 also provides good results rmse 0 23 m even though the maximum profile is slightly lower than the ibc tests because in this case the flow interaction with the decks is not modelled conversely the md simulation with the coarse mesh test f3 which is characterized by the highest value of the rmse 0 39 m overestimates the backwater upstream of bridges this is due to the fact that bridge piers are artificially widened adopting a 2 m resolution for example the piers of bridge 2 are 3 m wide fig 12b and cannot be represented adequately unless the finer resolution is used computational times for all tests are reported in table 4 it can be noticed that for tests f1 and f2 1 m grid the simulation time required by the ibc method is roughly 15 higher compared to the md approach the overhead is due to the execution of additional kernels during the computations but the ibcs do not restrict the allowable time step however the ibc model provides good results even for the coarser resolution test f4 which is four times faster hence it can be considered an efficient alternative to the md approach 4 2 hypothetical flood scenario with 500 years return period the model is then used to simulate the hypothetical scenario of a 500 years return period flood along the parma river the domain includes the flood detention basin and the 13 km long river reach downstream fig 11 the contribution of the baganza river is neglected for this application the domain is discretized with square cells of size 2 m 3 7 million cells and the bridges in the urban reach are modelled using the ibc approach similarly to section 4 1 the flood control reservoir dam is composed of a central concrete body with two lateral spillways and three bottom openings equipped with movable gates d oria et al 2012 the structure is included in the simulation using an internal rating curve as ibc shown in fig 14 in this application gate operations are not considered and then a unique rating curve is adopted a common approach for simulating the lamination in online flood detention basins is the level pool routing lpr method chow et al 1988 which also requires the definition of a stage area relationship for the reservoir see the curve shown in fig 14 obtained from the digital terrain model fig 15 a shows a comparison between the predicted discharge hydrograph flowing through the dam obtained from the lpr method and from the 2d simulation with ibc the difference between the two predictions is negligible the same observation is true as regards the stage hydrograph inside the reservoir fig 15b in this application velocities in the reservoir are close to zero hence the zero dimensional approximation of the lpr method is acceptable and provides results similar to a 2d model however for more complex cases e g multiple basins non negligible dynamics inside the reservoir the 2d model is expected to provide more accurate results compared to the lpr approach moreover when detention basins are located halfway in the domain coupling between different models can be avoided if ibcs are used as an example of simulation results downstream fig 16 shows the predicted water surface profiles in the urban reach of the river at selected times the transition from low flow to partially and fully pressurized conditions can be observed at all the bridge sites except bridge 1 in particular when the peak discharge is observed t 18 h bridges 2 and 3 become fully pressurized and the difference between the upstream and downstream water level is roughly 1 m a sensitivity analysis on the discharge coefficient cq in eq 6 was performed in order to verify its influence on the numerical results in real applications besides the reference value 0 9 the coefficients 0 8 and 1 0 were considered and the comparison was performed by analyzing the longitudinal profile of the maximum water surface elevations along the 1 8 km long urban reach of the parma river the rmse of this profile vs the reference simulation is equal to 16 cm and 12 cm when cq is 0 8 and 1 0 respectively the highest differences 25 cm are observed upstream of bridge 3 in general the definition of the most suitable value for cq in field studies for which calibration data are seldom available is not straightforward however this application shows that its variation generates a change in the maximum water levels in the order of 15 25 cm only upstream of fully pressurized bridges which is in line with the possible inaccuracy in the numerical results due to the other sources of uncertainty roughness topography boundary conditions bridge geometry modification due to drift accumulation etc finally the simulation time is approximately 82 min for 48 h of physical time and the physical computational time ratio equal to 35 confirms the good performance of the parflood code for field simulations even when ibcs are included in the model in fact the simulation takes less than 10 more time compared to a companion simulation where bridges are excluded from the computations 5 conclusions in this paper the parflood model was extended with the implementation of internal boundary conditions to simulate the presence of bridges and other hydraulic structures in 2d domains the validation tests showed that the adoption of ibcs provides good results both in low and high flow conditions for bridges while the simulation of a real case confirmed the applicability of this approach for field scale tests involving not only bridges but also flood detention basins the model is computationally efficient physical computational time ratio around 20 30 thanks to the gpu implementation and can therefore be used for real simulations e g for flood hazard maps levee system verification etc when the backwater upstream of bridges or the presence of structures interfering with the flow needs to be considered for this kind of analysis the drawback of not obtaining a very accurate representation of the flow field near the bridge can be surely acceptable further applications to real flood events may provide useful guidelines on the definition of the most suitable values for the empirical coefficients required by the model in case of fully pressurized flow declaration of competing interest the authors declare that they have no known competing financial interestsor personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors wish to thank prof t picek and prof j murillo for providing the experimental data used for model validation the reviewers are also kindly acknowledged for their valuable suggestions this research benefits from the hpc high performance computing facility of the university of parma appendix a analysis of momentum conservation at ibc edges let us consider the example of a 1d channel with rectangular section width b and horizontal bottom where a constant unit discharge q is flowing a gate is placed midstream fig a1 the downstream level is high enough to obtain submerged conditions at the gate assuming steady state conditions and neglecting friction and head losses the momentum balance applied to the control volume between section 1 and section 2 fig a1 reads a1 p 1 p 2 f g m 1 m 2 0 where p 1 and p 2 are the pressure terms on sections 1 and 2 while m 1 and m 2 represent the convective part of the momentum flux and fg is the net reaction of the gate assuming a hydrostatic pressure distribution eq a1 becomes a2 1 2 ρ g h 1 2 b 1 2 ρ g h 2 2 b ρ q b u 1 ρ q b u 2 f g 0 where h 1 h 2 and u 1 u 2 represent the water depth and mean velocity at section 1 2 and ρ is the water density hence the reaction of the gate per unit width per unit density can be expressed as a3 f g ρ b 1 2 g h 1 2 h 2 2 u 1 2 h 1 u 2 2 h 2 it can be easily verified that the term on the right hand side of eq a3 coincides with the difference between the momentum terms in the physical flux at cells upstream and downstream of the ibc see second component in eqs 9 and 10 when the bottom is horizontal z 0 and η h and sections 1 and 2 coincide with the centers of cells i j and i 1 j the same physical interpretation holds in the case of a non submerged gate 
525,flood propagation in rivers is strongly influenced by the presence of bridges and other hydraulic structures among the available approaches for including these elements in numerical models the adoption of internal boundary conditions ibc given its ability to capture backwater is suitable for field scale analyses for flood hazard assessment in this paper the implementation of internal boundary conditions in the two dimensional shallow water code named parflood is presented the application to experimental and real test cases shows that the proposed ibc model can handle both low and high flow conditions for bridges while being flexible for other types of structures e g flow through dams moreover the model is computationally efficient physical computational time ratio around 20 30 for domains with 106 cells thanks to the code parallelization on gpu keywords 2d shallow water equations internal boundary conditions bridges hydraulic structures flood modeling gpu 1 introduction the presence of bridges and other crossing structures can significantly affect the flood propagation in rivers and channels since the piers abutments and deck represent an obstruction to the flow in particular the lateral and vertical constrictions at bridge sites induce a backwater effect upstream of these structures possibly increasing the hazard in flood prone areas in case of severe flood events the water level may exceed the elevation of the deck low chord generating pressure flow under the bridge the deck may even experience overtopping during extreme events these high flow conditions generate very complex flows hence this topic was studied experimentally e g martin vide and prio 2005 picek et al 2007 with a special focus on the assessment of backwater brown 1985 seckin 2004 besides bridges other notable types of structures include sluice gates for flow regulation and irrigation management weirs and flow through dams for flood control all these elements interfere with the flow and their presence should be properly taken into account in numerical simulations performed for flood management applications costabile et al 2015 nowadays two dimensional 2d models based on the shallow water equations swe are often adopted for flood risk and hazard assessment for the design and verification of mitigation strategies and even for civil protection purposes ferrari et al 2020 however the markedly three dimensional characteristics of the flow field around most hydraulic structures where non negligible vertical velocities and accelerations can occur prevent a straightforward integration of these elements in depth averaged models based on the hypothesis of a hydrostatic pressure distribution even if different simple approaches are available for the representation of bridges and other hydraulic structures in one dimensional 1d models i e brunner 2016 natale et al 2004 catella and bechi 2006 fewer analyses can be found in the context of 2d models according to ratia et al 2014 there are three available methods for considering the presence of bridges mesh discretization md head loss hl and internal boundary conditions ibcs maranzoni et al 2015 propose an additional method namely the 2d extension of the preissmann slot model 2d ps the md approach requires an adequate grid refinement at bridge sites in order to represent the piers as holes in the mesh with reflective boundaries the hl model ratia et al 2014 includes an additional source term in the swe which represents the contraction and expansion losses through the bridge the ibcs modify the numerical scheme only at special cells near the inner structure depending on the implementation ibcs can modify either the flux computation zhao et al 1994 or the value of the conserved variables morales hernández et al 2013 usually imposing the unit discharge passing through the hydraulic structure bridge weir dam etc evaluated from a prescribed rating curve or discharge formula finally the 2d ps model based on a modified set of swe accounts for possible flow pressurization when the water surface reaches the bridge low chord and must be combined with the md approach for low flow conditions among these strategies hl and ibcs predict the global effect induced by the bridge presence i e backwater while md aims at simulating the flow field near the hydraulic structure especially as regards the possible transition to supercritical flow downstream however the latter and also 2d ps entails longer simulation times due to the higher resolution needed and to the restriction of the admissible time step moreover md is unable to reproduce high flow conditions correctly and 2d ps can simulate only pressurization without overtopping while hl and ibcs are more flexible in this respect even if empirical formulae are often required finally hl was developed specifically for bridges while ibcs were successfully applied to different types of structures zhao et al 1994 including gates morales hernández et al 2013 and levees echeverribar et al 2019 based on this short discussion ibcs can be identified as a promising strategy for including the presence of hydraulic structures in a 2d model to simulate flood propagation in field scale analyses thanks to their flexibility for different structures and flow conditions and to their ability to capture backwater flood simulations in large domains usually imply long computational times unless optimized and or parallelized codes are used in particular models able to run on graphics processing unit gpu devices e g lastra et al 2009 lacasta et al 2014 vacondio et al 2014 are gaining attention due to their computational efficiency but to date the implementation of ibcs in gpu accelerated codes has never been analyzed in the literature the aim of this paper is to present an efficient strategy for including ibcs in the gpu accelerated 2d swe code named parflood vacondio et al 2014 2017 details about the modifications to the numerical scheme and the gpu implementation are herein provided the model is validated against experimental tests concerning bridge backwater in steady and unsteady conditions and then applied to the simulation of the propagation of floods in the parma river italy with bridges experiencing high flow conditions moreover the case of an ibc to represent the dam which controls a flood detention basin is analyzed the paper is organized as follows section 2 is dedicated to the model presentation focusing on the description of the ibc implementation the validation of the proposed model is described in section 3 while applications to field scale tests are shown in section 4 discussion and conclusions are provided in the last section 2 model description 2 1 the parflood model 2 1 1 mathematical model the parflood model vacondio et al 2014 2017 solves the 2d swe through a finite volume fv scheme the governing equations are depth averaged mass and momentum conservation laws written in integral form as follows toro 2001 1 t a u d a c h n d c a s 0 s f d a where t is the time a and c represent the area and boundary of the integration volume respectively while u is the vector of conserved variables h f g is the tensor of fluxes in the x and y directions and n is the outward unit vector normal to c finally s 0 and s f are the bed slope and friction source terms respectively following the well balanced formulation of liang and marche 2009 the terms u f and g s 0 and s f are defined as follows 2 u η u h v h f u h u 2 h 1 2 g η 2 2 η z u v h g v h u v h v 2 h 1 2 g η 2 2 η z s 0 0 g η z x g η z y s f 0 g h n f 2 u u 2 v 2 h 4 3 g h n f 2 v u 2 v 2 h 4 3 in eq 2 h and z are the flow depth and the bed elevation respectively while η h z represents the water surface elevation moreover u and v are the velocity components along the x and y directions g is the acceleration due to gravity and nf is manning s roughness coefficient an explicit fv scheme is employed to discretize the equations in the first order accurate approximation the conserved variables are updated according to the following expression 3 u i j n 1 u i j n δ t δ x f i 1 2 j f i 1 2 j δ t δ y g i j 1 2 g i j 1 2 δ t s 0 s f where superscript n and subscripts i j indicate the time level and the cell position respectively while δx δy is the cell size in the x y direction and δt is the time step which must satisfy the courant friedrichs lewy stability condition intercell fluxes are computed using the hllc approximate riemann solver toro 2001 and a correction to avoid non physical velocities at wet dry fronts kurganov and petrova 2007 is implemented moreover a centered approximation is adopted to discretize the slope source term vacondio et al 2014 while the implicit formulation proposed by caleffi et al 2003 is used for the friction source term second order accuracy in space and time can be achieved by adopting a depth positive muscl extrapolation at cell boundaries audusse et al 2004 and by applying the second order runge kutta method for advancing the solution in time 2 1 2 gpu implementation one of the main advantages of the parflood model is its cuda c implementation which allows for the exploitation of the intrinsic parallel computations of gpu devices thus guaranteeing simulation times up to two orders of magnitude lower than the ones of serial codes vacondio et al 2014 examples of the good performance of the parflood model for real applications can be found in vacondio et al 2016 and dazzi et al 2018 2019 in the cuda framework the basic work unit is the thread which corresponds to one computational cell of the domain and many threads are grouped into a block each containing k k cells k 16 in this work the parflood model can discretize the domain using either a cartesian computational grid or a block uniform quadtree buq grid which is a non uniform structured mesh specifically designed for guaranteeing efficiency on the gpu architecture see vacondio et al 2017 for details the cuda code takes advantage of two hardware resources the cpu the host and the gpu the device the former controls the execution flow including the memory exchanges between the device and the host keeping track of the time advancement during the simulation while the latter executes the different pieces of code kernels containing instructions for the actual computations during each time step from tn to tn 1 the code performs a sequence of three main tasks as summarized in fig 1 each of which includes cpu instructions for launching one or more kernels before describing the implementation of ibcs in detail section 2 2 some features of the original model are briefly recalled see vacondio et al 2014 for further details 2 1 3 external boundary conditions boundary conditions bcs are handled by adopting the implicit local ghost approach which does not require the explicit modeling of ghost cells since ghost values at boundary edges are retrieved at runtime thanks to appropriate instructions included in the kernels information concerning the existence and type of bc for each cell must be stored in additional data structures and later accessed during kernel execution to correct the neighbor values with appropriate expressions e g reflective transmissive and compute boundary fluxes please notice that different boundary conditions can be associated to different edges of the same cell without any conflicts and this makes the simulation of complex boundaries in field applications straightforward and efficient while wall and far field bcs are handled directly by the flux computation kernel in the case of open boundaries discharge or level hydrograph stage discharge relationship some conserved variables must be imposed at boundary cells task 1 in fig 1 for an inflow bc discharge values are interpolated from the discrete time series provided as input data and converted to specific discharges by cpu processing then a dedicated kernel is launched over the boundary cells to assign the prescribed value of specific discharge water elevation is also imposed for supercritical inflow for outflow boundaries the water level is prescribed for subcritical conditions while no assignments are performed for supercritical outflow finally a stage discharge relationship can also be imposed as downstream bc based on the average water level at boundary cells the value of discharge is interpolated from the discrete table provided as input data and the specific discharge is redistributed over boundary cells 2 1 4 δt computation and block deactivation optimization bdo in a dedicated kernel launched during task 2 in fig 1 the allowable time step is computed for each cell and the minimum for each block is determined then the cpu calculates the minimum for the whole domain at the same time the kernel also identifies whether a block is wet dry blocks are then deactivated excluded from the computations during the current time step by cpu processing in order to avoid unnecessary calculations and thus reduce the computational burden 2 1 5 flux computation and time integration for each cell a kernel retrieves the left and right states at each of the four edges north south east west of a cell computes the four fluxes using the hllc solver and updates the vector of the conserved variables according to eq 3 it must be noted that the algorithm actually repeats the calculation of each intercell flux twice once for each thread sharing that edge because this strategy was found to be more efficient on the gpu than introducing a separate kernel for flux computation and allocating an extra array for fluxes on the global memory however conservation is guaranteed by the fact that the same left right values are used for both computations for the first order approximation these values coincide with the conserved variables at the center of the current cell and of its four neighbor cells for the second order scheme additional kernels for muscl extrapolation and half step summation are necessary see vacondio et al 2014 for boundary conditions specific procedures allow the correct definition of the conserved variables in neighbor cells used for flux computation 2 2 internal boundary conditions in the present section the details of the algorithm adopted to introduce the internal boundary conditions in the parflood solver are described the planimetric position of a hydraulic structure is identified by means of a line or polyline which is discretized through a number of cell edges at the pre processing stage see fig 2 cells facing at least one of these internal edges are then identified and marked as upstream or downstream ibc cells the case of a bridge type ibc will be described in the following whereas other types of hydraulic structures will be considered at the end of the section the input data must include the bridge geometry fig 3 in particular the low chord elevations a ceiling elevation for pressurization is assigned to each ibc cell so that complex geometries like single or multiple arched bridges can be described adequately an overtopping elevation is also provided abutments and piers can be either handled as holes in the mesh or included in the bridge geometry as cells with a ceiling coinciding with the bottom elevation zero opening see fig 2 2 2 1 selection of flow conditions and discharge estimation the basic idea is to compute the average water level upstream and downstream of the bridge structure and to compare it with the minimum and maximum ceiling elevations in order to distinguish different flow conditions low flow partially pressurized fully pressurized overtopped see fig 3 these values are then used for estimating the discharge flowing through the bridge by adopting a discharge formula this approach differs from previous works concerning ibcs in 2d models where the discharge formula was employed at each cell edge separately morales hernández et al 2013 echeverribar et al 2019 although the strategy of using a global evaluation is closer to 1d modeling it is more robust and efficient and also more flexible to different types of structures for which global rating curves are sometimes available from physical modeling for low flow conditions no interaction with the deck ibcs are not activated and all cells behave as ordinary inner cells conversely for high flow conditions the specific discharge is imposed in upstream ibc cells please note that the water level is not modified in any cell so that mass is neither added nor subtracted to the domain the same specific discharge assigned to each upstream ibc cell is replicated in its companion downstream ibc cell the model assumes that the flow is normal to the ibc edge hence the specific discharge in the tangential direction is set equal to zero this hypothesis may induce directionality to flow which can be particularly noticeable in the case of skewed bridges but in the meantime it guarantees that mass is conserved through the ibc edge moreover this effect is expected to affect the flow field only locally while the overall prediction of flood propagation and backwater should not be much influenced more in detail the ibc processing in the parflood model starts during task 1 fig 1 after open bcs have been assigned a first kernel is launched over blocks containing ibc cells with the aim of computing the mean levels upstream ηu and downstream ηd of the bridge in particular the partial summation of water surface elevations in upstream and downstream ibc cells for each block is performed during kernel execution based on a logarithmic reduction vacondio et al 2014 then these partial values are passed to the cpu which combines them to compute the result some discharge formulae require the additional definition of the total heads hu and hd these average values are also evaluated if necessary based on the computed mean levels and on the bridge geometry the flow condition during the current time step is selected by cpu processing let us define zlow min and zlow max the minimum and maximum elevations of the bridge low chord ztop the elevation of the top chord and zbottom as the minimum bottom elevation along the bridge section fig 3 first a check on the flow direction is performed in order to capture possible flow reversal which can be observed at bridges immediately upstream of a retaining structure or a confluence if ηu ηd most common case one of the following conditions is verified 1 if ηu zlow min low flow conditions occur and ibcs are ineffective a simple kernel which sets to zero the specific discharge normal to upstream and downstream zero opening cells if present is launched 2 if zlow min ηu zlow max the bridge is partially pressurized only a subset of ibc cells interacts with the bridge deck this partial obstruction is taken into account by reducing the normal specific discharge q in the upstream cells whose water surface elevation exceeds the local ceiling z low k for cell k for example as follows 4 q k q k z l o w k z k η k z k if η k z l o w k where q coincides with uh or vh depending on the ibc edge inclination both components are modified if the cell shares two ibc edges then the same specific discharge overlined is assigned to the corresponding downstream ibc cell note that the specific discharge in all ibc cells with η zlow remains unchanged while the specific discharge in zero opening cells e g with zlow k zk is zeroed 3 if zlow max ηu ztop the bridge is fully pressurized two possible flow conditions namely free flow and submerged flow can occur in the former case the discharge q passing through the bridge is evaluated as follows 5 q c d a 2 g h u 0 5 z l o w m a x z b o t t o m for submerged flow on the other hand the pressure flow equation is used 6 q c q a 2 g h u η d in eqs 5 and 6 a represents the total area of the bridge opening while cd and cq are discharge coefficients for the two flow conditions typical values used in the practice are 0 5 and 0 8 bradley 1978 the selection of the appropriate configuration is performed following cozzolino et al 2015 namely by evaluating a tentative discharge by means of eq 5 and computing the depth at the vena contracta and its conjugate depth if the latter is exceeded by the downstream depth the flow is submerged otherwise free flow conditions occur please notice that in the free flow case the discharge is computed by adopting eq 5 but the downstream depth is not set equal to the depth at vena contracta indeed this operation would violate mass conservation unless a special procedure is introduced as done by echeverribar et al 2019 as regards the imposition of the critical depth downstream of a weir which is not straightforward in an efficient gpu implementation moreover the drawback of neglecting this contraction downstream of bridges is common to other approaches ratia et al 2014 aimed at capturing the global effect of the bridge presence backwater rather than the local details of the flow field 4 if ηu ztop the bridge is also overtopped compared to the previous case the discharge is increased according to the weir equation 7 q c w l 2 g h u z t o p 3 2 where l is the bridge length normal to flow and cw is a weir coefficient please notice that the local head losses at the bridge site are represented by the discharge coefficients for case 3 on the other hand the strategy of imposing a reduced discharge based on the area available to flow in ibc cells for case 2 is preferred over the introduction of an additional head loss in order to guarantee smooth transitions from low flow to partially pressurized flow conditions and between adjacent pressurized and non pressurized cells moreover no additional calibration coefficients which lack experimental grounds are required for this simple and computationally efficient approach for cases 3 bridge fully pressurized and 4 bridge fully pressurized and overtopped based on the evaluated total discharge and on the length and orientation of the ibc string please recall that the flow direction is assumed normal to the bridge the specific discharge q is computed and redistributed over the upstream ibc cells the new values of the conserved variables to be imposed for a generic upstream ibc cell k are as follows 8 q k q h a v a i l k k 1 n h a v a i l k where as before q k coincides with uh or vh depending on the ibc edge inclination both components are considered for cells with two ibc edges while n represents the number of ibc edges moreover havail k is the weight of cell k coinciding with the available flow area divided by the grid size which can be evaluated as z low k zk for case 3 and z low k zk η k ztop for case 4 note that for piers cells havail k is zero for case 3 and η k ztop for case 4 if a cell shares two ibc edges both specific discharge components are actually modified based on havail k then the same values of the specific discharge are attributed to downstream ibc cells as in case 2 the water level is never modified in ibc cells during this redistribution for example let us consider the simple case of two neighbor cells i j and i 1 j separated by an ibc edge fig 4 a while η i j and η i 1 j are not modified the following values are assigned to the specific discharges in the x and y directions u h i j u h i 1 j u h vh i j vh i 1 j 0 where u h is the result of the discharge redistribution for cell i j according to eq 8 if the flow is reversed downstream towards upstream all the previous checks are performed considering ηd instead of ηu and swapping upstream and downstream ibc cells finally for other types of internal structures the flowchart for selecting the appropriate flow condition is modified according to the type of ibc considered for example only cases 1 and 3 need to be considered for a sluice gate for complex structures e g flow through dams a stage discharge relationship obtained from physical modeling is often available and can be provided in tabular form as input data checks 1 4 are skipped and the discharge is simply obtained from the rating curve valid for the considered hydraulic structure then the modified conserved variables at the ibc cell can be computed by means of eq 8 more complex cases could be handled by supplying multiple rating curves and instructions on how to switch between them e g gate operations 2 2 2 flux computation as regards flux computation and cell updating task 3 in fig 1 the ibc implementation requires few changes to the original scheme thanks to the implicit local ghost cell approach already implemented for external bcs in fact the most important modification to the usual scheme for ibc cells lies in the definition of left and right states for an ibc edge while all fluxes are then computed using the hllc riemann solver as in standard cells it is worth recalling that in the parflood implementation each cell computes its own fluxes hence each flux is actually calculated twice in the framework of ibcs this peculiarity is exploited to take into account the bridge discontinuity in particular different values of the left right states are used to compute fluxes at the ibc intercell in the upstream and downstream cell so that limited to these particular edges the fluxes exiting from the upstream cell are not the same as those entering the downstream cell with reference to the simple case of cells i j and i 1 j fig 4b let us consider cell i j first the fluxes to the east are computed using the conserved variables at the cell center as left state while the right state is simply determined by mirroring the left state the result of the hllc solver with the same left and right states coincides with the physical flux 9 f i 1 2 j u u h u h h i j 1 2 g η 2 2 η z i j 0 focusing on cell i 1 j the same strategy of mirroring the centered values is applied to define the left state at the western edge and the physical flux is the following 10 f i 1 2 j d u h u h h i 1 j 1 2 g η 2 2 η z i 1 j 0 from a comparison between the two fluxes it can be noticed that the first component is the same for both computations meaning that mass conservation is always guaranteed the difference between the momentum fluxes a part from a possible bottom step discontinuity which is balanced by a proper discretization of the bed slope source term equals the reaction exerted by the deck onto the fluid assuming a hydrostatic pressure distribution see appendix a please note that other models also introduce violations of the momentum conservation in order to consider the presence of a structure ratia et al 2014 introduced the presence of a bridge as a momentum sink additional source term using the hl approach in maranzoni and mignosa 2018 a fictitious cell was inserted to mimic the unbalance in the momentum equations caused by a ceiling step discontinuity while in cozzolino et al 2015 different physical fluxes were imposed directly when updating cells separated by a gate the advantage of the proposed approach compared to zhao et al 1994 cozzolino et al 2015 and maranzoni and mignosa 2018 is the fact that code branching is very limited since basically only the introduction of an additional type of boundary condition handled by means of the implicit local ghost approach is required while the call to the hllc solver remains unchanged this is also convenient for enabling both high and low flow conditions in ibc cells in the latter case the mirroring of centered values is simply skipped so that left right states at the ibc edge are retrieved from the conserved variables in the current cell and in its neighbor as in standard cells 3 model validation in this section the results of numerical tests for model validation are reported all simulations are performed using a p100 tesla gpu 3 1 steady flow experiments 3 1 1 picek et al 2007 a subset of the laboratory tests presented by picek et al 2007 was simulated for the model validation in high flow conditions experiments were carried out in a flume with a 0 75 m wide rectangular cross section and a horizontal bottom where a 0 3 m long 7 5 cm thick bridge was placed 1 1 m from the downstream end of the channel different steady state subcritical conditions all characterized by pressurized flow through the bridge were realized by varying the inflow discharge the deck s vertical position and the water level at the downstream end of the flume table 1 reports the 9 test conditions here considered in particular tests labelled p1 correspond to pressurized conditions while p2 and p3 refer to overtopping with unsubmerged or submerged flow respectively in the simulations the domain is discretized by means of cells of size 0 05 m while manning s coefficient is set equal to 0 01 m 1 3 s a constant inflow discharge and the measured water level is imposed as upstream and downstream boundary conditions respectively while for the weir coefficient in eq 7 the value 0 32 is assumed the discharge coefficient in eq 6 is set equal to 0 97 after trial and error this value is higher than the usual range 0 7 0 9 however picek et al 2007 showed that for their deck geometry the actual range for cq is 0 8 0 95 for a partially submerged bridge and up to 1 0 1 1 for an overtopped bridge the discrepancy was there justified by the absence of side contractions in the test geometry measured and simulated values of the average water depth upstream of the bridge are compared in table 1 together with the relative error which is always below 5 these results confirm the capability of the model to reproduce the backwater induced by the presence of the deck a sensitivity analysis to the discharge coefficient was performed for test p1a and results show that relative errors of the upstream water level remain below 10 as long as cq is higher than 0 88 up to 1 1 while overtopping is wrongly predicted for lower values predicted water surface profiles along the channel centerline are analyzed for test cases of type b fig 5 the comparison between measured and numerical profiles shows that as expected the near field features around the bridge are not reproduced accurately by the model especially the local water surface upsurge at the upstream face of the deck probably due to the head loss for the vertical flow contraction and the flow expansion profile downstream actually the flow through a bridge is characterized by significant accelerations in the vertical direction which cannot be simulated adopting a depth averaged model also as regards the overtopping tests the ibc model is unable to reproduce the profile over the deck the flow field here consists of two independent layers below and above the bridge and clearly a shallow water model cannot represent this configuration however the backwater profile which develops upstream of the bridge is well caught for all flow conditions hence the model is able to predict the overall effect induced by the deck this can be evaluated quantitatively by computing the root mean square error rmse of the numerical water surface profile along the channel compared to the experimental one table 1 values of rmse below 1 cm less than 4 of the mean water level in the channel except for test p1a confirm the quite good performance of the model 3 1 2 brown 1985 the laboratory investigation performed at the hr wallingford laboratory and reported by brown 1985 was selected for validating the model in the case of arched bridges a large number of experimental runs in steady flow conditions were performed in a 15 m long channel with variable width where a bridge was inserted 7 6 m from the downstream end different bridge configurations inflow discharges and tailwater levels were considered the three types of bridge simple arch unit hr1 widened arch unit hr2 and multiple arches hr3 selected for this work are represented in fig 6 a large subset of these tests all characterized by fully pressurized conditions with no overtopping were simulated with the proposed model assuming δx δ y 0 02 m and manning s coefficient equal to 0 01 m 1 3 s test conditions are summarized in table 2 bridge piers are modelled as cells with zero opening in the ibc model measured and simulated upstream levels compared in table 2 are in good agreement in fact the relative error is always below 3 these results were obtained using a calibrated value for cq set equal to 1 0 0 86 and 0 92 for bridge types hr1 hr2 and hr3 respectively these values were selected after performing a sensitivity analysis of the upstream water depth to cq for one test for each bridge geometry namely tests 4d 19c and 29b which allowed selecting the most suitable value it was also observed that relative errors of the upstream water level were always below 10 considering discharge coefficients in the range 0 8 1 10 for tests 4d and 29b and 0 7 1 0 for test 19c this suggests that even though the predicted backwater somehow depends on the discharge coefficient when the bridge is fully pressurized moderate variations of this parameter still guarantee acceptable results as described in section 2 2 the model redistributes the specific discharge based on the available area for arch bridges in pressurized conditions this treatment gives origin to a markedly 2d flow field upstream of the bridge as can be observed in fig 7 for test 29b at bridge piers the water surface level slightly increases and velocity falls to zero while the maximum velocity is noticeable at the center of arches 3 2 unsteady flow experiments the performance of the model in case of unsteady flows is assessed by simulating some of the experimental dam break test cases reported by ratia et al 2014 the laboratory set up consisted of a 0 84 m wide reservoir filled with still water and a 6 m long 0 24 m wide channel closed downstream fig 8 a the instantaneous lifting of a gate between channel and reservoir generated a dam break wave a bridge was positioned approximately 1 65 m downstream of the gate and different bridge shapes were employed figs 8b d the water level was measured at two locations upstream and downstream of the bridge g1 and g2 in fig 8a table 3 summarizes the test conditions for the three cases considered in this work numerical simulations are performed adopting a uniform 0 015 m grid resolution while the value 0 0125 m 1 3 s for manning s coefficient was calibrated to fit the arrival time of the dam break wave at the upstream gage the first test case r1 concerns a deck bridge without piers and the results of numerical simulations including or excluding ibcs are compared with experimental measurements in fig 9 the description of the bridge through an ibc allows predicting the backwater upstream which as expected cannot be modelled in the base simulation without ibc the discharge coefficient in eq 6 was set equal to 0 75 after calibration in particular its value was varied in the range 0 65 0 85 and the envelope of the obtained results is represented in fig 9 as a gray band the predicted maximum water depth at gage g1 varies in the range 7 compared to the simulation with the calibrated value it should be kept in mind that discharge formulae used at the ibc are valid for steady flow or slowly varying flow while the impact of a dam break wave is highly unsteady and entails dissipations that cannot be easily included in a shallow water model despite this the ibc model can capture the overall process adopting any value for cq while tuning this parameter allows improving the agreement with experimental data two additional test cases were considered concerning an arch bridge r2 or a deck with two piers r3 for these tests three approaches were compared 1 piers as holes in the mesh md approach neglecting the influence of the deck 2 ibc approach where piers are included as ibc cells with zero opening and 3 a combination of md and ibc where piers are holes in the mesh but the deck is also included as an ibc notice that in these experimental setups the main flow obstruction is represented by the bridge piers and good numerical results may be expected even adopting the md approach moreover for these test cases the discharge coefficient does not influence the results since the bridge barely becomes pressurized during the process fig 10 reports the numerical results along with experimental data the upstream water levels are reproduced quite well in all simulations even if the peak is slightly underestimated conversely only approaches 1 and 3 allow a good prediction of the downstream water levels because the flow contraction due to the piers is relevant in these configurations but it cannot be described properly assuming a thin structure as in approach 2 this limitation is common to other methods e g hl described by ratia et al 2014 and is related to the impossibility of modeling the supercritical flow downstream of the bridge without a detailed reproduction of contraction and expansion through the piers especially for test r2 despite this the overall process is in reasonable agreement with experiments even with this simplified approach for describing bridge piers small oscillations downstream at t 14 s are related to the complex flow field due to the interaction of the flow passing through the bridge with the surge wave travelling upstream generated after the dam break wave impacts the wall at the end of the channel 4 application the application of the proposed model to a field test case is here presented the middle reach of the parma river northern italy which flows through the city of parma is selected as case study a sketch of the study area is represented in fig 11 two sets of tests are carried out the first tests labelled f concerns the simulation of the 2014 flood event in the urban reach of the river which is crossed by five arched bridges with piers the second one shows the use of an internal rating curve to represent the flow through dam of the flood detention basin which protects the town 4 1 2014 flood event the model is used to simulate the flood event which occurred on october 13th 2014 on the parma and baganza rivers this first application tests labelled f is focused on the flow interaction with the five historical bridges on the parma river hence the domain is limited to the 6 km long river reach identified in fig 11 the upstream boundary condition is the estimated discharge hydrograph immediately downstream of the confluence of the two rivers with a peak value equal to 820 m3 s fig 12 a while a rating curve is imposed as downstream boundary condition at the highway crossing the geometry of bridge 2 is reported in fig 12b as an example four simulations were performed adopting either the md approach or the ibc method for representing the bridges see test conditions in table 4 and discretizing the domain with square cells of resolution equal to 1 m 5 5 million cells or 2 m 1 4 million cells manning s coefficient in the urban reach of the river was set equal to 0 03 m 1 3 s for the ibc tests the discharge coefficient in eq 6 was set equal to 0 9 the physical time of simulation is 8 h fig 13 a compares the longitudinal profiles of the maximum water surface elevations along the river centerline obtained from different simulations the surveyed maximum levels are also reported the differences between simulated and observed maximum water surface elevations are plotted in fig 13b for better comparison results show that during this event four bridges were partially pressurized during the peak flow and this is predicted correctly by the ibc model adopting both 1 m and 2 m meshes tests f2 and f4 in fact the simulated profiles of the maximum levels are in good agreement with the high water marks this is confirmed by the evaluation of the rmse of the simulated maximum water surface elevations with reference to the surveyed maximum levels reported in table 4 the rmse is below 0 20 m for these tests the md simulation with the finest resolution test f1 also provides good results rmse 0 23 m even though the maximum profile is slightly lower than the ibc tests because in this case the flow interaction with the decks is not modelled conversely the md simulation with the coarse mesh test f3 which is characterized by the highest value of the rmse 0 39 m overestimates the backwater upstream of bridges this is due to the fact that bridge piers are artificially widened adopting a 2 m resolution for example the piers of bridge 2 are 3 m wide fig 12b and cannot be represented adequately unless the finer resolution is used computational times for all tests are reported in table 4 it can be noticed that for tests f1 and f2 1 m grid the simulation time required by the ibc method is roughly 15 higher compared to the md approach the overhead is due to the execution of additional kernels during the computations but the ibcs do not restrict the allowable time step however the ibc model provides good results even for the coarser resolution test f4 which is four times faster hence it can be considered an efficient alternative to the md approach 4 2 hypothetical flood scenario with 500 years return period the model is then used to simulate the hypothetical scenario of a 500 years return period flood along the parma river the domain includes the flood detention basin and the 13 km long river reach downstream fig 11 the contribution of the baganza river is neglected for this application the domain is discretized with square cells of size 2 m 3 7 million cells and the bridges in the urban reach are modelled using the ibc approach similarly to section 4 1 the flood control reservoir dam is composed of a central concrete body with two lateral spillways and three bottom openings equipped with movable gates d oria et al 2012 the structure is included in the simulation using an internal rating curve as ibc shown in fig 14 in this application gate operations are not considered and then a unique rating curve is adopted a common approach for simulating the lamination in online flood detention basins is the level pool routing lpr method chow et al 1988 which also requires the definition of a stage area relationship for the reservoir see the curve shown in fig 14 obtained from the digital terrain model fig 15 a shows a comparison between the predicted discharge hydrograph flowing through the dam obtained from the lpr method and from the 2d simulation with ibc the difference between the two predictions is negligible the same observation is true as regards the stage hydrograph inside the reservoir fig 15b in this application velocities in the reservoir are close to zero hence the zero dimensional approximation of the lpr method is acceptable and provides results similar to a 2d model however for more complex cases e g multiple basins non negligible dynamics inside the reservoir the 2d model is expected to provide more accurate results compared to the lpr approach moreover when detention basins are located halfway in the domain coupling between different models can be avoided if ibcs are used as an example of simulation results downstream fig 16 shows the predicted water surface profiles in the urban reach of the river at selected times the transition from low flow to partially and fully pressurized conditions can be observed at all the bridge sites except bridge 1 in particular when the peak discharge is observed t 18 h bridges 2 and 3 become fully pressurized and the difference between the upstream and downstream water level is roughly 1 m a sensitivity analysis on the discharge coefficient cq in eq 6 was performed in order to verify its influence on the numerical results in real applications besides the reference value 0 9 the coefficients 0 8 and 1 0 were considered and the comparison was performed by analyzing the longitudinal profile of the maximum water surface elevations along the 1 8 km long urban reach of the parma river the rmse of this profile vs the reference simulation is equal to 16 cm and 12 cm when cq is 0 8 and 1 0 respectively the highest differences 25 cm are observed upstream of bridge 3 in general the definition of the most suitable value for cq in field studies for which calibration data are seldom available is not straightforward however this application shows that its variation generates a change in the maximum water levels in the order of 15 25 cm only upstream of fully pressurized bridges which is in line with the possible inaccuracy in the numerical results due to the other sources of uncertainty roughness topography boundary conditions bridge geometry modification due to drift accumulation etc finally the simulation time is approximately 82 min for 48 h of physical time and the physical computational time ratio equal to 35 confirms the good performance of the parflood code for field simulations even when ibcs are included in the model in fact the simulation takes less than 10 more time compared to a companion simulation where bridges are excluded from the computations 5 conclusions in this paper the parflood model was extended with the implementation of internal boundary conditions to simulate the presence of bridges and other hydraulic structures in 2d domains the validation tests showed that the adoption of ibcs provides good results both in low and high flow conditions for bridges while the simulation of a real case confirmed the applicability of this approach for field scale tests involving not only bridges but also flood detention basins the model is computationally efficient physical computational time ratio around 20 30 thanks to the gpu implementation and can therefore be used for real simulations e g for flood hazard maps levee system verification etc when the backwater upstream of bridges or the presence of structures interfering with the flow needs to be considered for this kind of analysis the drawback of not obtaining a very accurate representation of the flow field near the bridge can be surely acceptable further applications to real flood events may provide useful guidelines on the definition of the most suitable values for the empirical coefficients required by the model in case of fully pressurized flow declaration of competing interest the authors declare that they have no known competing financial interestsor personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors wish to thank prof t picek and prof j murillo for providing the experimental data used for model validation the reviewers are also kindly acknowledged for their valuable suggestions this research benefits from the hpc high performance computing facility of the university of parma appendix a analysis of momentum conservation at ibc edges let us consider the example of a 1d channel with rectangular section width b and horizontal bottom where a constant unit discharge q is flowing a gate is placed midstream fig a1 the downstream level is high enough to obtain submerged conditions at the gate assuming steady state conditions and neglecting friction and head losses the momentum balance applied to the control volume between section 1 and section 2 fig a1 reads a1 p 1 p 2 f g m 1 m 2 0 where p 1 and p 2 are the pressure terms on sections 1 and 2 while m 1 and m 2 represent the convective part of the momentum flux and fg is the net reaction of the gate assuming a hydrostatic pressure distribution eq a1 becomes a2 1 2 ρ g h 1 2 b 1 2 ρ g h 2 2 b ρ q b u 1 ρ q b u 2 f g 0 where h 1 h 2 and u 1 u 2 represent the water depth and mean velocity at section 1 2 and ρ is the water density hence the reaction of the gate per unit width per unit density can be expressed as a3 f g ρ b 1 2 g h 1 2 h 2 2 u 1 2 h 1 u 2 2 h 2 it can be easily verified that the term on the right hand side of eq a3 coincides with the difference between the momentum terms in the physical flux at cells upstream and downstream of the ibc see second component in eqs 9 and 10 when the bottom is horizontal z 0 and η h and sections 1 and 2 coincide with the centers of cells i j and i 1 j the same physical interpretation holds in the case of a non submerged gate 
526,flow within vegetation characterized by non uniform roughness density is drawing significant research attention given its relevance to a plethora of applications in eco hydraulics including river restoration and flow in wetland and marshes the focus here is on flume experiments and modeling of the mean longitudinal velocity profile in a two layered cylindrical vegetation system layer 1 represents the region close to the channel bottom where the flow experiences maximum drag due to the densely placed vegetation while layer 2 represents the flow region above the short vegetation characterized by a smaller vegetation density considering the aforementioned arrangements a new analytical model based on reynolds averaged closure principles is proposed to describe the vertical distribution of mean streamwise velocity in an open channel with two different vegetation densities in the proposed model the one dimensional steady and planar homogeneous momentum equation is used where the turbulent eddy viscosity is assumed to be linearly related to the local mean velocity the proposed analytical model has been calibrated using experiments reported here in which vegetation is represented by using circular plastic cylinders of two different heights the proposed model is further tested against published experiments with similar arrangements in total 22 different experimental conditions with distinct densities rigidity and flow depths have been analyzed the root mean square error rmse of the velocity comparisons is found to be less than 0 0342 m s which is acceptable keywords emergent vegetation open channel flow submerged vegetation two layer vegetation velocity profile 1 introduction the hydrodynamics of free surface flow through and above vegetation is impacted by the presence of vegetation which affects the velocity boundary shear reynolds stress and turbulence intensity nepf 1999 nepf and vivoni 2000 lopez and garcia 2001 ghisalberti and nepf 2006 poggi et al 2004 stoesser et al 2010 furthermore flow induced through differential vegetation heights densities and flow depth alters the overall roughness which completely changes the physics of the flow tang et al 2018 2019 in addition the complexity of flow manifolds due to macro roughness causes this type of flow no longer to be explained through a single global factor such as manning s roughness coefficient multiple mechanisms impact the flow description within vertically non uniform canopies katul et al 2011 nikora et al 2013 huai et al 2014 these multiple mechanism can be represented layer by layer to account for changes in roughness density vegetation height water level and dominant vertical structures carollo et al 2002 huai et al 2014 tang and ali 2013 tang 2018a 2019a 2019b 2019c singh et al 2019a previous methods describing the mean velocity profile employed the approaches based on solutions to the mean momentum equation that is subject to closure schemes for the total stresses the most problematic feature of the velocity profile is the shear layer at the top of vegetation which is induced through gradient of velocity raupach et al 1996 the turbulence produced in this region is governed by the mixing length and vertical turbulent transport of momentum from the overlying flow with the negligible contribution from the pressure gradient the effect of the shear length scale was found to be a function of the vegetation height and flow depth klopstra et al 1997 defina and bixio 2005 tang 2019a 2019c singh et al 2019b several studies and experiments see fig 1 have examined the submerged single layered flow with both flexible and rigid plant models poggi et al 2004 nikora et al 2013 okamoto and nezu 2013 liu et al 2010 huai et al 2014 however only few studies have examined the two layered vegetation flow with tall vegetation being emergent i e ht h where ht is the height of the tall vegetation and h is the flow depth this condition seems most realistic in case of real time scenarios where the flow depth covers the small vegetation but the taller vegetation is emergent throughout the flow finally momentum transport is mainly due to vertical turbulent exchange since the longitudinal advection can be insignificant in the lower vegetation zone fig 1 using the mean longitudinal momentum balance equation subject to planar homogeneous steady state conditions and further assuming bed and wall shear stresses to be negligible compared to the drag force imposed by the vegetation a mathematical model is proposed and tested using new flume experiments this paper develops and evaluates a phenomenological model for estimating the vertical distribution of mean longitudinal velocity in the two layer vegetation with taller vegetation being emergent our experimental studies have shown that the density of vegetation plays a key role in capturing the inflection point and the mixing length over the short vegetation height the flow is divided into two layers that are modelled independently by coupled through continuity and smoothness the application of the proposed model was carried out in a condition where short dowels are fully submerged but the tall ones are emergent the first zone is the one that starts from the channel bed to the location near the top of short vegetation the second zone is in between the top of short vegetation and the water surface for the two zones different parameters have been embedded in the proposed analytical equations to predict the flow velocity for the aforementioned condition in addition the performance of the proposed method was evaluated with our experimental data using root mean square errors banerjee et al 2018 tang 2018b 2 theoretical background vegetation inside the channel could be either emergent or submerged experimental studies have shown that the vertical distribution of mean velocity in emergent conditions is almost uniform over the depth tsujimoto and kitamura 1990 stone and shen 2002 on the other hand in submerged conditions the vertical distribution of mean velocity follows an s shaped pattern with inflection over the zero plane displacement generally found near the top of the short vegetation kouwen et al 1969 temple 1986 ikeda and kanazawa 1996 carollo et al 2002 the previous analytical models proposed by klopstra et al 1997 ghisalberti and nepf 2004 poggi et al 2004 defina and bixio 2005 kubrak et al 2008 huai et al 2014 and tang 2019c are all based on the steady uniform momentum equation eq 1 the wall and bed boundary shear stresses are considered to be negligible in the vegetation column where drag induced forces are the primary resistance to the flow under those idealized conditions the mean momentum balance is given by 1 1 ρ τ z z f v g s 0 where τ is the turbulent shear stress ρ is the density of water g is the gravitational acceleration z is the vertical coordinate above the bed s 0 is the bed slope and fv is the drag force per unit mass generated by the vegetation drag force can be defined by 2 f v 1 2 c d a u 2 z h 0 z h m a v where u is the velocity in the streamwise direction h is the vegetation height cd is the vegetation drag coefficient a is the vegetation density m and av are the number of vegetation per unit area and the frontal area of vegetation per unit volume respectively in eq 1 the shear stress can be modeled through the boussinesq hypothesis as 3 τ z ρ ν t u z ρ ϕ u u z where the total eddy viscosity vt is defined as the product of local velocity scale and the characteristic length scale φ which is assumed to be independent of vertical component z klopstra et al 1997 defina and bixio 2005 meanwhile it is worth noting that the local velocity u here is chosen as a characteristic velocity for the eddy viscosity model in eq 3 which is one of different hypotheses for eddy viscosity models used in the literature if distinct models are used a different form of solution can result e g huai et al 2014 inserting eqs 2 3 into eq 1 gives 4 ϕ 2 u 2 z 2 a c d u 2 2 g s 0 0 eq 4 can be solved analytically for u 2 by providing the vegetation density a drag coefficient cd and eddy characteristic length scale ϕ with boundary conditions which vary from datum to short vegetation height 0 z hs as layer 1 and from the short vegetation height to the free surface hs z h as layer 2 fig 2 the subsequent eq 4 is used to develop the new analytical model for the case of two layered vegetative flow with emergent tall vegetation the closure of the proposed model is obtained through modeling parameters such as drag coefficient cd and characteristic length scale ϕ which will be discussed by acknowledging the physics of the flow with complete explanation and contextual background in a later section 2 1 previous models klopstra et al 1997 proposed a model for single layered vegetation using eq 4 and boundary conditions such as u o u z o 2 g s o a c d where negligible bed shear stress is considered with the local equilibrium between the gravity force and vegetation drag along with the condition for the boundary shear stress at the top of vegetation to be considered as τ z h ρg h h so the symbols have usual meaning as mentioned earlier the flow velocity in the vegetation layer is given by 5 u v c 1 e z 2 a c 2 e z 2 a u s 0 2 0 z h where c 1 and c 2 are the integration constants and u s0 is the characteristic constant flow velocity in non submerged condition the terms a and u soare given as 6 a m d c d 2 7 u s 0 2 g s o c d m d where d is the diameter of cylindrical vegetation c 1 and c 2 can be determined to ensure that the upper and lower boundary conditions are satisfied c 1 and c 2 in eq 5 are derived as eqs 8 and 9 using limiting boundary conditions and are given as 8 c 1 2 g s o h h 2 a e h 2 a e h 2 a 9 c 2 c 1 where h is the height of vegetation the log law of prandtl defined for the surface layer can be expressed as 10 u u 1 κ l n z h δ s k s z h where u is the shear velocity κ is the von karman constant taken as 0 4 ks is the height of the virtual bed roughness of the surface layer and δ s is the vertical shift of the virtual zero level of the logarithmic profile by applying continuity and smoothness conditions on the mean velocity profile parameters δ s and ks can be determined and are given as 11 δ s g 1 1 4 e 2 κ 2 h h g 2 e 2 κ 2 12 k s δ s e f where 13 e 2 a c 3 e h 2 a 2 c 3 e h 2 a u v 0 2 14 f k c 3 e h 2 a u v 0 2 g h h δ s 15 u v 0 u s 0 s o 16 c 3 c 2 s o the velocity profile inside and above the vegetation is defined by eq 5 and 10 respectively while all the limiting boundary conditions and the variables used in the equations can be found in eqs 6 9 and eqs 11 16 accordingly klopstra et al 1997 found a relationship between φ and vegetation characteristic with flow depth as 17 ϕ 0 0793 h l n h h 0 0009 and ϕ 0 001 meijer and van velzen 1999 conducted an experimental study and applied klopstra et al 1997 model which confirmed the applicability of the model for their set of data however they found out that the model for the mixing length parameter ϕ of eq 17 was not suitable for their datasets therefore meijer and van velzen 1999 gave a new model for the mixing length parameter ϕ by considering the same variables but with different curve fitting function the fitting procedure to their data resulted in 18 ϕ 0 0144 h h baptist et al 2007 used the mixing length concept to define the eddy viscosity vt as 19 v t z l k t c p l u z where l is defined as a characteristic mixing length that is found to be the function of the spatial arrangement of vegetation kt is the turbulent kinetic energy per unit mass and cp is the turbulence intensity that is defined as 20 c p 1 h 0 h h z dz 1 h 0 h u z dz thus eq 5 becomes as as 21 u v u s 0 2 a e z l b e z l 22 u s 0 2 g s o c d m d 23 l c p l c d m d where a and b are the integration constants eq 21 comprises two different components which can be labelled as near free surface component and near bed component the first component is dealt with ae z l while the latter one is be z l therefore the shape of the profile is determined by the values of integration constants a and b in further analysis constant value of b is found to be insignificant for estimating the vertical distribution of mean velocity in vegetation area fig 3 shows that there is a decline in the velocity trend from the top of the vegetation downward until the uniform flow velocity u s0 is reached ultimately the velocity profile through the vegetation is defined by 24 u v s o u v 0 2 a v e z l where 25 u vo 2 g c d md and a v 2 lg h h c p l e h l baptist et al 2007 also studied the velocity above vegetation and modeled it using the same logarithmic profile where they tried to shift the inflection using a vertical asymptote called momentum absorption δ v or zero plane displacement given by 26 u u 1 κ ln z δ v k s where the vertical position of the centroid of momentum absorption δ v was calculated by thom 1971 using the centroid method and is given as 27 δ v 0 h d τ z dz zdz 0 h d τ z dz dz the boundary condition over the vegetation was used to compute the roughness height ks so that the velocity profile through the vegetation uv z is matched to the logarithmic profile of flow velocity u z thus δ v and k s are given by 28 δ v h l 1 e h l 29 k s h δ v e k 2 l c p l 1 l h h finally the turbulence intensity cp is approximated as 30 c p 1 20 h h l to determine the overall streamwise velocity in submerged condition an analytical model was established by huthoff et al 2007 using cylindrical dowels to represent vegetation with two different layers fig 4 the proposed model of huthoff et al 2007 is given in eqs 31 and 32 for the average velocity in the subsequent layers 31 u v 2 b g s o 1 2 b h f for emergent condition h h 32 u v 2 b g s o 1 b 32 h k s h 1 3 for submerged condition h h where f is the coefficient of bed resistance and b is defined by belcher et al 2003 as 33 b 1 c d m d moreover the average velocity in the surface layer can be scaled with l the scaling length and α the transition exponent as in eq 34 34 u s u v h h l 2 3 1 h h α nezu and sanjou 2008 assumed the three sub zones in the vegetated region as emergent zone 0 z hp mixing layer zone hp z hlog and log law zone hlog z h as shown in fig 4 wake effects from stem in the emergent zone see fig 4 lead to a mean velocity profile that is vertically uniform as discussed elsewhere nezu and sanjou 2008 comparing to some previous studies this zone is similar to the longitudinal exchange area in which the vertical transport of momentum is considerably small nepf and vivoni 2000 nepf and vivoni 2000 and ghisalberti and nepf 2006 designated the entire upper zone as the exchange zone while nezu and sanjou 2008 divided it into two zones named as the mixing layer and log law most recently yilmazer et al 2018 studied the effect of submergence ratio and solid volume fraction svf of a vegetation patch on the velocity profiles their study showed that the vegetation decreases the velocity of flow both inside the vegetation layer and in the wake region furthermore their experimental data revealed that vegetation with different heights has different effects on velocity profiles for example low svf has small effect on the velocity profile over the vegetation layer while higher svf causes a decline in the velocity profile along the cross section of the channel for the higher vegetation height the vegetation layer affects the velocity distribution both within and over the vegetation layer the vertical distribution of mean velocity implied that jet flow occurs in the non vegetated half of the channel yilmazer et al 2018 huai et al 2014 proposed an analytical model to predict the velocity profile using their experimental datasets their model may work for a different range of data however their model depends on a variety of coefficients and different parameters which need to be defined and calibrated individually 2 2 model development based on schlichting and gersten 2017 and according to boussinesq hypothesis the turbulent shear stress can be defined as 38 τ z ρ v t u z ρ λ u where vt and λ are the total eddy viscosity of vegetated flow and the mixing length of eddy respectively in eq 38 the application of vt λu is attributed to kolmogorov s energy cascade analysis of v t c 1 4 l e t where l is the length scale of eddy c is the kolmogorov constant and et is the turbulent kinetic energy in analogous fashion the velocity scale u may be taken as the square root of et since the turbulent fluctuations characterize the transport of momentum katopodes 2019 pp 625 626 as similar to eq 19 by baptist et al 2007 for given vegetation density of a and drag coefficient of cd an analytical solution can be obtained for u 2 in eq 20 as 39 u 2 2 g s 0 a c d a e μ z b e μ z where μ a c d λ the integration constant a and b can be calculated by applying the boundary conditions klopstra et al 1997 defina and bixio 2005 baptist et al 2007 tang 2019c in layer 1 see fig 2 at the bed where z 0 the bed shear stress can be neglected in comparison to the drag coefficient of vegetation under this assumption the local equilibrium between gravity force and drag force of vegetation will lead to 40 u 0 u z 0 2 g s 0 a c d at the top of the vegetation where z h the boundary shear stress is defined by 41 τ z h ρ g h h s 0 thus similar to the analysis of the model of klopstra et al 1997 the constant in eq 39 will become a b hence given by 42 a g s 0 h h λ μ cosh μ h by inserting eq 42 into eq 39 the velocity for the first layer becomes 43 u 1 u 0 2 2 a sinh μ 1 z where the subscript 1 denotes the region of layer 1 and u 0 is described by 44 u 0 2 g s 0 a 1 c d where a 1 is the parameter related to the density of vegetation and defined by 45 a 1 d δ s x δ s y where d is the diameter of dowels i e models of vegetation δsx and δsy are the streamwise and lateral spacing of dowels respectively furthermore μ1 in eq 43 is defined by 46 μ 1 a 1 c d λ 1 where λ1 is the parameter related to the characteristic length of eddy in the flow this parameter λ1 is dependent on the height of vegetation and the flow depth as suggested by klopstra et al 1997 defina bixio 2005 baptist et al 2007 and tang 2019c in addition it should be mentioned that the characteristic length of eddy is associated with the coherent eddy described by nezu and sanjou 2008 as illustrated in fig 4 the mixing layer zone is due to the substantial wake effect of vegetation in the emergent zone poggi et al 2004 described the flow structure over the submerged vegetation in three zones as shown in fig 5 this mixing length can be empirically evaluated by 47 λ 1 k 1 h h s h s where hs represents the short vegetation height k 1 is a constant whose value should be empirically evaluated as discussed in tang 2019c the optimal value of k 1 was found as 0 001 in this study eq 39 still applies for the layer 2 where only tall vegetation exists see fig 2 in different boundary condition based on the boundary condition at the free surface where the turbulent shear stress is negligible compared with the drag force of vegetation the velocity can then be described by a hyperbolic function profile as 48 u 2 u t 2 c e μ 2 z e μ 2 2 h z where the subscript 2 denotes the region of layer 2 and 49 u t 2 g s 0 a 2 50 μ 2 a 2 c d λ 1 following the continuous boundary conditions of velocity and its gradient at z h s the constants a and c can be obtained as 51 a u t 2 u 0 2 2 sinh μ 1 h s 2 μ 1 μ 2 cosh μ 1 h s t a n h μ 2 2 h h s 52 c μ 1 c o s h μ 1 h s μ 2 e μ 2 h c o s h μ 2 h h s thus in the two layered vegetation where the short vegetation is fully submerged and the tall one is emergent the two new eqs 43 and 48 predict the velocity profiles for layers 1 and 2 respectively 2 3 experiments to test the proposed analytical model several experiments were conducted in an open channel with two layers of vegetation where the short vegetation was fully submerged and the tall one was emergent all the experiments were carried out in a 12 m long rectangular flume of 0 4 m width x 0 4 m height at nanjing hydraulic research institute china fig 6 a the bed slope of the channel was 0 004 to obtain a uniform flow under different flow conditions and vegetation configurations a flow straightener of different mesh sizes was used at the entrance in the stilling tank combined with the manual tailgate at the end of the flume the schematic plan and vertical view of the channel are shown in fig 6 the vegetation is modelled by circular plastic cylinders of 6 35 mm diameter with two different heights of 0 1 m and 0 2 m which represent the short and tall vegetation respectively fig 6b all the rigid dowels were mounted in 10 mm thick pre perforated plates at the bottom of the flume which covered 7 m of the channel length starting at 4 m downstream of the stilling tank different measurement locations were selected to evaluate the flow characteristics in different regions of the vegetation as illustrated in fig 7 all the instantaneous velocity measurements u v w in x y z direction respectively were taken using nortek acoustic doppler velocimetry adv with an accuracy of 0 5 of measured value with 1 mm s the collected datasets were processed on winadv software the streamwise lateral and vertical directions are denoted by the x y and z direction respectively where the datum is at z 0 the time averaged velocity components and fluctuating velocities in each direction are denoted as u v w and u v w corresponding to x y and z direction based on acoustic frequency of the instrument used the sampling volume and sampling rate of the adv were 0 09 cm3 and 0 1 to 50 hz respectively generally 25 hz is the most appropriate value since it provides the highest temporal resolution the number of velocity measurement points varies with the distribution of signal to noise ratio snr over the measurement locations 2 4 vegetation formation the experiments were conducted based on combination of linear and staggered patterns for both short and tall dowels fig 7 the vegetation configuration was designed to resemble the vegetation in natural rivers that is usually denser in the lower layer and sparser in the upper layer nepf et al 2007 the measurement locations in fig 7 are denoted by small circles these locations are tactically selected to cover the regions behind the short and tall dowels and free open region so that velocity variation can be identified and modelled in all possible regions table 1 summarizes variables of each experiment run and its parameters used for the subsequent model test for consistency a uniform flow depth with almost similar discharges was maintained to compare the effect of different formations and spacing of vegetation in the same experimental condition to ensure that the proposed model is not limited to our experiments other studies have been included see table 1 these data include liu et al 2008 and huai et al 2014 study which have varieties of formations of vegetation it should be mentioned that in all these experiments the flow depth is somewhere between the short and tall vegetation heights in other words the short vegetation is fully submerged while the tall one is emergent in the subsequent result section the experimental and analytical results of vertical distribution of mean streamwise velocity are presented followed by the comparison between the proposed model and the data from liu et al 2010 and huai et al 2014 2 5 experimental results and discussion comparisons between measured and modelled longitudinal velocity profiles are shown in fig 9 the velocity data marked as ave are the spatial average of velocity from different locations in individual cross section of each case as marked in fig 7 spatial averaging of the data here is required because the mean momentum balance already assumes a planar averaging carried out by raupach and shaw 1982 the averaging is calculated by weighted average method where the weights were selected as a parameter related to the diameters of dowels and the space between centres of two adjacent dowels for example in fig 8 locations in free region have the highest velocity compared to those behind the dowels liu et al 2008 rahimi et al 2019 either short or tall so they have the highest coefficient that is s d otherwise the locations behind the dowels have the coefficient of d 2 therefore the weighted average velocity v ave is calculated by 53 v ave v l 1 d 2 v l 2 s d v l 3 d 2 d d where v is the velocity at different locations d is the diameter of each dowel d is the distance between two adjacent dowels and s is the distance between the centres of two adjacent dowels fig 9 summarizes all the runs of our experiments for completeness among all the runs the largest velocity occurs in the free regions such as l2 and l4 the least velocity is found in the regions downstream of the dowels locations l1 l3 l5 l6 and l7 irrespective of the dowel height in the uniform velocity zone z hs locations l3 and l6 are behind the tall dowels with the velocity profile also having least velocity throughout the sections these observations from l3 and l6 show that the fluid experiences most drag in these regions inflection spike in these profiles is not significant which is not the same as the case with the profiles at locations l1 l5 and l7 in these locations where the short dowel is completely submerged inflection over the height of z hs is significant with a sudden increase in velocity immediately above z hs similarly in experiment 1 1 2 1 3 1 and 4 1 figs 9a d g j respectively the minimum depth of flow was maintained at 12 cm the velocity appears a similar trend to that of flow with single layer vegetation the velocities in these runs are found to be almost constant throughout the height of short vegetation followed by a rapid increase in velocity at z hs however the spatial variation l1 l6 or l7 of velocity trend is observed in each case from linear linear to staggered staggered formation see fig 9 for the other runs i e experiments 1 2 1 3 2 2 2 3 3 2 3 3 4 2 and 4 3 fig 9b c e f h i k and l velocity increases rapidly near the top of the short vegetation hs 0 1m and the increase in velocity becomes larger with increasing depth in all the cases furthermore in the sparser dowel arrangements with high flow depth experiment 2 3 multiple inflections in velocity profile can be seen in locations l1 l2 l4 and l5 the increment in the velocity above zero plane displacement is also found to be dependent on the location proximity to the tall dowels about 15 18 is found for the variation in velocity above z hs at location l5 behind short dowel in the mid section of the configuration in experiments 1 1 1 2 and 1 3 figs 9a b and c on the other hand with sparser arrangement at location l5 the percentage increment in velocity above z hs is found to be around 9 13 in experiments 2 1 2 3 see figs 9d f in fig 9g l with sparser arrangement of tall dowels the velocity profile does not become constant immediately behind locations l3 and l6 while in other locations the velocity is least moreover the velocity above z hs does not appear to converge onto a single logarithmic profile after slip velocity this could be attributed to the effect from the depth of submergence of the tall dowel in these cases drag dominates throughout the column of flow behind tall dowels however in case of complete submergence both turbulent stress and wake effects come into action in the region close to the surface in which a logarithmic velocity applies 2 6 model application to test the analytical model on data sets not used in its calibration the following published experiments are used fig 11 for experiments by liu et al 2010 and fig 13 for experiments in huai et al 2014 a total of 22 runs were considered without any biased selection see table 1 with vegetation height varying from 0 051 hs 0 14 and 0 152 ht 0 24 flow depth from 0 12 h 0 23 the frontal area of vegetation from 0 47 a 1 1 57 and 0 27 a 2 0 62 and drag coefficient from 1 1 cd 1 13 the averaged velocity of weighted experimental data and analytical results are compared in fig 10 this shows an overall good agreement between the experimental and predicted velocities in experiments 1 1 1 2 and 1 3 with linear formations for both short and tall dowels case 1 the analytical model shows good agreement with experimental data however there is a slight difference at the edge of short and tall vegetation for experiment 1 3 where the flow depth of 18 1 cm is very close to the height of tall vegetation this difference in the figure demonstrates the complexity in the flow near the edge of dowels in experiments 2 1 2 2 and 2 3 where the short and tall vegetation are in staggered and linear formations respectively case 2 there is also good agreement between analytical and experimental data with high correlations moreover in experiments 3 1 3 2 and 3 3 the experimental and predicted data agree except at the edge of vegetation in experiments 3 3 in the high flow depth of 18 3 cm i e experiment 3 3 although both experimental and analytical data have the same trend the agreement is not as good as that in the lower depth run 12 3 cm in experiment 3 1 nevertheless the model agrees with the experimental data with staggered formations for both short and tall vegetation see experiments 4 1 4 2 and 4 3 in fig 10 in fig 11 the proposed model is compared with the datasets of liu et al 2010 which are spatially averaged the results in figs 11 a b and f are for staggered staggered configurations with varying vegetation heights see table 1 whereas in figs 11 c d and e short and tall vegetation is configured as the combination of linear staggered linear linear and staggered linear respectively see fig 12 a sharp inflection point at z hs is visible in all the datasets which justifies that the slip velocity lies in the region close to short vegetation height in all the cases fig 11 in the datasets of liu et al 2010 the variation of the dowel height has affected the profile in the region of z hs for instance in figs 11 a and d the velocity profile in the region of z hs is not converging towards the logarithmic shape on the other hand flow is able to achieve a constant velocity which shows the great influence of the submergence ratio of the short dowel and independent behavior of the tall dowel see fig 11 c d e and f in experiment 4 of liu et al 2010 all the measurement locations are behind the dowels and there is no measurement in the free region area see fig 12 the lack of measurement in the free region affects the spatially weighted average consequently resulting in a smaller spatial average velocity so the average velocity in fig 11 c is less than the trend of analytical model prediction therefore it is not surprising that analytical and experimental data did not show good agreement in experiment 4 the experimental datasets of huai et al 2014 are spatial average of the complete frame of the piv data for their experiments x1 x2 y1 and y2 where x1 and x2 are linear linear configurations but y1 and y2 are staggered staggered configurations with two flow depths see table 1 the velocity data as the function of z have been taken with the spatial average over 22 cm width of the camera field in the streamwise direction which is finally averaged transversely across the test section huai et al 2014 fig 13 shows the comparison between the data of huai et al and the analytical model in general the proposed model shows reasonably good agreement 3 discussion to further check the robustness of the proposed model with the experiments error analyses are carried out the values of rmse root mean square of errors have been given for different cases of vegetation formations and flow depths in table 2 rmse is given by 54 r m s e 1 n i 1 n u a n u e n 2 where u a is the predicted velocity by the analytical model u e is the measured velocity data from experiments and n is the number of data the small values of rmse in table 2 show agreement between analytical and experimental results in experiments 1 1 2 1 3 1 and 4 1 where the flow depths are around 12 cm the analytical model performed exceptionally well while in experiments 1 3 2 3 3 3 and 4 3 where the flow depths are relatively high around 18 cm the model comparatively underestimates in the region of hs z ht one of the reasons may be due to the complexity of flow with an increase in shear over the slip velocity around z hs which may lead to an increase in flow velocity moreover the influence of short and tall vegetation heights on the mixing layer can be further speculated as another reason for slight under performance in the region hs z ht based on fig 13 although huai et al 2014 proposed a different analytical model for two layered vegetation with calibration using their own experimental data the large number of parameters with various constants in their model made it complicated and difficult to apply on the other hand the accuracy of their model to capture the point of inflection on the edge of short vegetation appears less in this proposed model 4 conclusions the two layered vegetation was modelled by pvc cylindrical dowels to study vegetated flow which was found to be more complex compared with the single layered flow the flow velocity characteristics at different locations were studied by 3d adv that for doubly layered vegetation with different densities and formations a new analytical model was proposed to describe the velocity profile in two layered vegetative flow with tall vegetation being emergent the main finding here is that the planar averaging is necessary in such data model comparisons moreover eddy viscosity models that are based on a local mean velocity and a prescribed mixing length appear to be reasonable at least in such class of models 5 future work the proposed analytical model in this study can evaluate velocity profiles in the cases where the short vegetation is fully submerged but tall ones are emergent this often occurs in nature but in some conditions especially in extreme flood conditions both short and tall vegetation could be fully submerged the future studies will be focusing on studying the flow with fully submerged conditions for both short and tall vegetation which include both experimental study and analytical model development credit authorship contribution statement h r rahimi visualization investigation data curation methodology software writing original draft x tang supervision visualization investigation writing original draft writing review editing p singh visualization investigation writing review editing m li supervision s alaghmand writing review editing acknowledgement the authors would like to thank the staff of nanjing hydraulic research institute for their support and time during the experiments and also acknowledge the support by the research development fund rdf 15 01 10 rdf 16 02 02 key programme special fund ksf e 17 of xjtlu and national natural science foundation of china 11772270 the authors would also like to thank two anonymous reviewers and the editor of the journal for their constructive comments which helped to improve the paper supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103527 appendix supplementary materials image application 1 
526,flow within vegetation characterized by non uniform roughness density is drawing significant research attention given its relevance to a plethora of applications in eco hydraulics including river restoration and flow in wetland and marshes the focus here is on flume experiments and modeling of the mean longitudinal velocity profile in a two layered cylindrical vegetation system layer 1 represents the region close to the channel bottom where the flow experiences maximum drag due to the densely placed vegetation while layer 2 represents the flow region above the short vegetation characterized by a smaller vegetation density considering the aforementioned arrangements a new analytical model based on reynolds averaged closure principles is proposed to describe the vertical distribution of mean streamwise velocity in an open channel with two different vegetation densities in the proposed model the one dimensional steady and planar homogeneous momentum equation is used where the turbulent eddy viscosity is assumed to be linearly related to the local mean velocity the proposed analytical model has been calibrated using experiments reported here in which vegetation is represented by using circular plastic cylinders of two different heights the proposed model is further tested against published experiments with similar arrangements in total 22 different experimental conditions with distinct densities rigidity and flow depths have been analyzed the root mean square error rmse of the velocity comparisons is found to be less than 0 0342 m s which is acceptable keywords emergent vegetation open channel flow submerged vegetation two layer vegetation velocity profile 1 introduction the hydrodynamics of free surface flow through and above vegetation is impacted by the presence of vegetation which affects the velocity boundary shear reynolds stress and turbulence intensity nepf 1999 nepf and vivoni 2000 lopez and garcia 2001 ghisalberti and nepf 2006 poggi et al 2004 stoesser et al 2010 furthermore flow induced through differential vegetation heights densities and flow depth alters the overall roughness which completely changes the physics of the flow tang et al 2018 2019 in addition the complexity of flow manifolds due to macro roughness causes this type of flow no longer to be explained through a single global factor such as manning s roughness coefficient multiple mechanisms impact the flow description within vertically non uniform canopies katul et al 2011 nikora et al 2013 huai et al 2014 these multiple mechanism can be represented layer by layer to account for changes in roughness density vegetation height water level and dominant vertical structures carollo et al 2002 huai et al 2014 tang and ali 2013 tang 2018a 2019a 2019b 2019c singh et al 2019a previous methods describing the mean velocity profile employed the approaches based on solutions to the mean momentum equation that is subject to closure schemes for the total stresses the most problematic feature of the velocity profile is the shear layer at the top of vegetation which is induced through gradient of velocity raupach et al 1996 the turbulence produced in this region is governed by the mixing length and vertical turbulent transport of momentum from the overlying flow with the negligible contribution from the pressure gradient the effect of the shear length scale was found to be a function of the vegetation height and flow depth klopstra et al 1997 defina and bixio 2005 tang 2019a 2019c singh et al 2019b several studies and experiments see fig 1 have examined the submerged single layered flow with both flexible and rigid plant models poggi et al 2004 nikora et al 2013 okamoto and nezu 2013 liu et al 2010 huai et al 2014 however only few studies have examined the two layered vegetation flow with tall vegetation being emergent i e ht h where ht is the height of the tall vegetation and h is the flow depth this condition seems most realistic in case of real time scenarios where the flow depth covers the small vegetation but the taller vegetation is emergent throughout the flow finally momentum transport is mainly due to vertical turbulent exchange since the longitudinal advection can be insignificant in the lower vegetation zone fig 1 using the mean longitudinal momentum balance equation subject to planar homogeneous steady state conditions and further assuming bed and wall shear stresses to be negligible compared to the drag force imposed by the vegetation a mathematical model is proposed and tested using new flume experiments this paper develops and evaluates a phenomenological model for estimating the vertical distribution of mean longitudinal velocity in the two layer vegetation with taller vegetation being emergent our experimental studies have shown that the density of vegetation plays a key role in capturing the inflection point and the mixing length over the short vegetation height the flow is divided into two layers that are modelled independently by coupled through continuity and smoothness the application of the proposed model was carried out in a condition where short dowels are fully submerged but the tall ones are emergent the first zone is the one that starts from the channel bed to the location near the top of short vegetation the second zone is in between the top of short vegetation and the water surface for the two zones different parameters have been embedded in the proposed analytical equations to predict the flow velocity for the aforementioned condition in addition the performance of the proposed method was evaluated with our experimental data using root mean square errors banerjee et al 2018 tang 2018b 2 theoretical background vegetation inside the channel could be either emergent or submerged experimental studies have shown that the vertical distribution of mean velocity in emergent conditions is almost uniform over the depth tsujimoto and kitamura 1990 stone and shen 2002 on the other hand in submerged conditions the vertical distribution of mean velocity follows an s shaped pattern with inflection over the zero plane displacement generally found near the top of the short vegetation kouwen et al 1969 temple 1986 ikeda and kanazawa 1996 carollo et al 2002 the previous analytical models proposed by klopstra et al 1997 ghisalberti and nepf 2004 poggi et al 2004 defina and bixio 2005 kubrak et al 2008 huai et al 2014 and tang 2019c are all based on the steady uniform momentum equation eq 1 the wall and bed boundary shear stresses are considered to be negligible in the vegetation column where drag induced forces are the primary resistance to the flow under those idealized conditions the mean momentum balance is given by 1 1 ρ τ z z f v g s 0 where τ is the turbulent shear stress ρ is the density of water g is the gravitational acceleration z is the vertical coordinate above the bed s 0 is the bed slope and fv is the drag force per unit mass generated by the vegetation drag force can be defined by 2 f v 1 2 c d a u 2 z h 0 z h m a v where u is the velocity in the streamwise direction h is the vegetation height cd is the vegetation drag coefficient a is the vegetation density m and av are the number of vegetation per unit area and the frontal area of vegetation per unit volume respectively in eq 1 the shear stress can be modeled through the boussinesq hypothesis as 3 τ z ρ ν t u z ρ ϕ u u z where the total eddy viscosity vt is defined as the product of local velocity scale and the characteristic length scale φ which is assumed to be independent of vertical component z klopstra et al 1997 defina and bixio 2005 meanwhile it is worth noting that the local velocity u here is chosen as a characteristic velocity for the eddy viscosity model in eq 3 which is one of different hypotheses for eddy viscosity models used in the literature if distinct models are used a different form of solution can result e g huai et al 2014 inserting eqs 2 3 into eq 1 gives 4 ϕ 2 u 2 z 2 a c d u 2 2 g s 0 0 eq 4 can be solved analytically for u 2 by providing the vegetation density a drag coefficient cd and eddy characteristic length scale ϕ with boundary conditions which vary from datum to short vegetation height 0 z hs as layer 1 and from the short vegetation height to the free surface hs z h as layer 2 fig 2 the subsequent eq 4 is used to develop the new analytical model for the case of two layered vegetative flow with emergent tall vegetation the closure of the proposed model is obtained through modeling parameters such as drag coefficient cd and characteristic length scale ϕ which will be discussed by acknowledging the physics of the flow with complete explanation and contextual background in a later section 2 1 previous models klopstra et al 1997 proposed a model for single layered vegetation using eq 4 and boundary conditions such as u o u z o 2 g s o a c d where negligible bed shear stress is considered with the local equilibrium between the gravity force and vegetation drag along with the condition for the boundary shear stress at the top of vegetation to be considered as τ z h ρg h h so the symbols have usual meaning as mentioned earlier the flow velocity in the vegetation layer is given by 5 u v c 1 e z 2 a c 2 e z 2 a u s 0 2 0 z h where c 1 and c 2 are the integration constants and u s0 is the characteristic constant flow velocity in non submerged condition the terms a and u soare given as 6 a m d c d 2 7 u s 0 2 g s o c d m d where d is the diameter of cylindrical vegetation c 1 and c 2 can be determined to ensure that the upper and lower boundary conditions are satisfied c 1 and c 2 in eq 5 are derived as eqs 8 and 9 using limiting boundary conditions and are given as 8 c 1 2 g s o h h 2 a e h 2 a e h 2 a 9 c 2 c 1 where h is the height of vegetation the log law of prandtl defined for the surface layer can be expressed as 10 u u 1 κ l n z h δ s k s z h where u is the shear velocity κ is the von karman constant taken as 0 4 ks is the height of the virtual bed roughness of the surface layer and δ s is the vertical shift of the virtual zero level of the logarithmic profile by applying continuity and smoothness conditions on the mean velocity profile parameters δ s and ks can be determined and are given as 11 δ s g 1 1 4 e 2 κ 2 h h g 2 e 2 κ 2 12 k s δ s e f where 13 e 2 a c 3 e h 2 a 2 c 3 e h 2 a u v 0 2 14 f k c 3 e h 2 a u v 0 2 g h h δ s 15 u v 0 u s 0 s o 16 c 3 c 2 s o the velocity profile inside and above the vegetation is defined by eq 5 and 10 respectively while all the limiting boundary conditions and the variables used in the equations can be found in eqs 6 9 and eqs 11 16 accordingly klopstra et al 1997 found a relationship between φ and vegetation characteristic with flow depth as 17 ϕ 0 0793 h l n h h 0 0009 and ϕ 0 001 meijer and van velzen 1999 conducted an experimental study and applied klopstra et al 1997 model which confirmed the applicability of the model for their set of data however they found out that the model for the mixing length parameter ϕ of eq 17 was not suitable for their datasets therefore meijer and van velzen 1999 gave a new model for the mixing length parameter ϕ by considering the same variables but with different curve fitting function the fitting procedure to their data resulted in 18 ϕ 0 0144 h h baptist et al 2007 used the mixing length concept to define the eddy viscosity vt as 19 v t z l k t c p l u z where l is defined as a characteristic mixing length that is found to be the function of the spatial arrangement of vegetation kt is the turbulent kinetic energy per unit mass and cp is the turbulence intensity that is defined as 20 c p 1 h 0 h h z dz 1 h 0 h u z dz thus eq 5 becomes as as 21 u v u s 0 2 a e z l b e z l 22 u s 0 2 g s o c d m d 23 l c p l c d m d where a and b are the integration constants eq 21 comprises two different components which can be labelled as near free surface component and near bed component the first component is dealt with ae z l while the latter one is be z l therefore the shape of the profile is determined by the values of integration constants a and b in further analysis constant value of b is found to be insignificant for estimating the vertical distribution of mean velocity in vegetation area fig 3 shows that there is a decline in the velocity trend from the top of the vegetation downward until the uniform flow velocity u s0 is reached ultimately the velocity profile through the vegetation is defined by 24 u v s o u v 0 2 a v e z l where 25 u vo 2 g c d md and a v 2 lg h h c p l e h l baptist et al 2007 also studied the velocity above vegetation and modeled it using the same logarithmic profile where they tried to shift the inflection using a vertical asymptote called momentum absorption δ v or zero plane displacement given by 26 u u 1 κ ln z δ v k s where the vertical position of the centroid of momentum absorption δ v was calculated by thom 1971 using the centroid method and is given as 27 δ v 0 h d τ z dz zdz 0 h d τ z dz dz the boundary condition over the vegetation was used to compute the roughness height ks so that the velocity profile through the vegetation uv z is matched to the logarithmic profile of flow velocity u z thus δ v and k s are given by 28 δ v h l 1 e h l 29 k s h δ v e k 2 l c p l 1 l h h finally the turbulence intensity cp is approximated as 30 c p 1 20 h h l to determine the overall streamwise velocity in submerged condition an analytical model was established by huthoff et al 2007 using cylindrical dowels to represent vegetation with two different layers fig 4 the proposed model of huthoff et al 2007 is given in eqs 31 and 32 for the average velocity in the subsequent layers 31 u v 2 b g s o 1 2 b h f for emergent condition h h 32 u v 2 b g s o 1 b 32 h k s h 1 3 for submerged condition h h where f is the coefficient of bed resistance and b is defined by belcher et al 2003 as 33 b 1 c d m d moreover the average velocity in the surface layer can be scaled with l the scaling length and α the transition exponent as in eq 34 34 u s u v h h l 2 3 1 h h α nezu and sanjou 2008 assumed the three sub zones in the vegetated region as emergent zone 0 z hp mixing layer zone hp z hlog and log law zone hlog z h as shown in fig 4 wake effects from stem in the emergent zone see fig 4 lead to a mean velocity profile that is vertically uniform as discussed elsewhere nezu and sanjou 2008 comparing to some previous studies this zone is similar to the longitudinal exchange area in which the vertical transport of momentum is considerably small nepf and vivoni 2000 nepf and vivoni 2000 and ghisalberti and nepf 2006 designated the entire upper zone as the exchange zone while nezu and sanjou 2008 divided it into two zones named as the mixing layer and log law most recently yilmazer et al 2018 studied the effect of submergence ratio and solid volume fraction svf of a vegetation patch on the velocity profiles their study showed that the vegetation decreases the velocity of flow both inside the vegetation layer and in the wake region furthermore their experimental data revealed that vegetation with different heights has different effects on velocity profiles for example low svf has small effect on the velocity profile over the vegetation layer while higher svf causes a decline in the velocity profile along the cross section of the channel for the higher vegetation height the vegetation layer affects the velocity distribution both within and over the vegetation layer the vertical distribution of mean velocity implied that jet flow occurs in the non vegetated half of the channel yilmazer et al 2018 huai et al 2014 proposed an analytical model to predict the velocity profile using their experimental datasets their model may work for a different range of data however their model depends on a variety of coefficients and different parameters which need to be defined and calibrated individually 2 2 model development based on schlichting and gersten 2017 and according to boussinesq hypothesis the turbulent shear stress can be defined as 38 τ z ρ v t u z ρ λ u where vt and λ are the total eddy viscosity of vegetated flow and the mixing length of eddy respectively in eq 38 the application of vt λu is attributed to kolmogorov s energy cascade analysis of v t c 1 4 l e t where l is the length scale of eddy c is the kolmogorov constant and et is the turbulent kinetic energy in analogous fashion the velocity scale u may be taken as the square root of et since the turbulent fluctuations characterize the transport of momentum katopodes 2019 pp 625 626 as similar to eq 19 by baptist et al 2007 for given vegetation density of a and drag coefficient of cd an analytical solution can be obtained for u 2 in eq 20 as 39 u 2 2 g s 0 a c d a e μ z b e μ z where μ a c d λ the integration constant a and b can be calculated by applying the boundary conditions klopstra et al 1997 defina and bixio 2005 baptist et al 2007 tang 2019c in layer 1 see fig 2 at the bed where z 0 the bed shear stress can be neglected in comparison to the drag coefficient of vegetation under this assumption the local equilibrium between gravity force and drag force of vegetation will lead to 40 u 0 u z 0 2 g s 0 a c d at the top of the vegetation where z h the boundary shear stress is defined by 41 τ z h ρ g h h s 0 thus similar to the analysis of the model of klopstra et al 1997 the constant in eq 39 will become a b hence given by 42 a g s 0 h h λ μ cosh μ h by inserting eq 42 into eq 39 the velocity for the first layer becomes 43 u 1 u 0 2 2 a sinh μ 1 z where the subscript 1 denotes the region of layer 1 and u 0 is described by 44 u 0 2 g s 0 a 1 c d where a 1 is the parameter related to the density of vegetation and defined by 45 a 1 d δ s x δ s y where d is the diameter of dowels i e models of vegetation δsx and δsy are the streamwise and lateral spacing of dowels respectively furthermore μ1 in eq 43 is defined by 46 μ 1 a 1 c d λ 1 where λ1 is the parameter related to the characteristic length of eddy in the flow this parameter λ1 is dependent on the height of vegetation and the flow depth as suggested by klopstra et al 1997 defina bixio 2005 baptist et al 2007 and tang 2019c in addition it should be mentioned that the characteristic length of eddy is associated with the coherent eddy described by nezu and sanjou 2008 as illustrated in fig 4 the mixing layer zone is due to the substantial wake effect of vegetation in the emergent zone poggi et al 2004 described the flow structure over the submerged vegetation in three zones as shown in fig 5 this mixing length can be empirically evaluated by 47 λ 1 k 1 h h s h s where hs represents the short vegetation height k 1 is a constant whose value should be empirically evaluated as discussed in tang 2019c the optimal value of k 1 was found as 0 001 in this study eq 39 still applies for the layer 2 where only tall vegetation exists see fig 2 in different boundary condition based on the boundary condition at the free surface where the turbulent shear stress is negligible compared with the drag force of vegetation the velocity can then be described by a hyperbolic function profile as 48 u 2 u t 2 c e μ 2 z e μ 2 2 h z where the subscript 2 denotes the region of layer 2 and 49 u t 2 g s 0 a 2 50 μ 2 a 2 c d λ 1 following the continuous boundary conditions of velocity and its gradient at z h s the constants a and c can be obtained as 51 a u t 2 u 0 2 2 sinh μ 1 h s 2 μ 1 μ 2 cosh μ 1 h s t a n h μ 2 2 h h s 52 c μ 1 c o s h μ 1 h s μ 2 e μ 2 h c o s h μ 2 h h s thus in the two layered vegetation where the short vegetation is fully submerged and the tall one is emergent the two new eqs 43 and 48 predict the velocity profiles for layers 1 and 2 respectively 2 3 experiments to test the proposed analytical model several experiments were conducted in an open channel with two layers of vegetation where the short vegetation was fully submerged and the tall one was emergent all the experiments were carried out in a 12 m long rectangular flume of 0 4 m width x 0 4 m height at nanjing hydraulic research institute china fig 6 a the bed slope of the channel was 0 004 to obtain a uniform flow under different flow conditions and vegetation configurations a flow straightener of different mesh sizes was used at the entrance in the stilling tank combined with the manual tailgate at the end of the flume the schematic plan and vertical view of the channel are shown in fig 6 the vegetation is modelled by circular plastic cylinders of 6 35 mm diameter with two different heights of 0 1 m and 0 2 m which represent the short and tall vegetation respectively fig 6b all the rigid dowels were mounted in 10 mm thick pre perforated plates at the bottom of the flume which covered 7 m of the channel length starting at 4 m downstream of the stilling tank different measurement locations were selected to evaluate the flow characteristics in different regions of the vegetation as illustrated in fig 7 all the instantaneous velocity measurements u v w in x y z direction respectively were taken using nortek acoustic doppler velocimetry adv with an accuracy of 0 5 of measured value with 1 mm s the collected datasets were processed on winadv software the streamwise lateral and vertical directions are denoted by the x y and z direction respectively where the datum is at z 0 the time averaged velocity components and fluctuating velocities in each direction are denoted as u v w and u v w corresponding to x y and z direction based on acoustic frequency of the instrument used the sampling volume and sampling rate of the adv were 0 09 cm3 and 0 1 to 50 hz respectively generally 25 hz is the most appropriate value since it provides the highest temporal resolution the number of velocity measurement points varies with the distribution of signal to noise ratio snr over the measurement locations 2 4 vegetation formation the experiments were conducted based on combination of linear and staggered patterns for both short and tall dowels fig 7 the vegetation configuration was designed to resemble the vegetation in natural rivers that is usually denser in the lower layer and sparser in the upper layer nepf et al 2007 the measurement locations in fig 7 are denoted by small circles these locations are tactically selected to cover the regions behind the short and tall dowels and free open region so that velocity variation can be identified and modelled in all possible regions table 1 summarizes variables of each experiment run and its parameters used for the subsequent model test for consistency a uniform flow depth with almost similar discharges was maintained to compare the effect of different formations and spacing of vegetation in the same experimental condition to ensure that the proposed model is not limited to our experiments other studies have been included see table 1 these data include liu et al 2008 and huai et al 2014 study which have varieties of formations of vegetation it should be mentioned that in all these experiments the flow depth is somewhere between the short and tall vegetation heights in other words the short vegetation is fully submerged while the tall one is emergent in the subsequent result section the experimental and analytical results of vertical distribution of mean streamwise velocity are presented followed by the comparison between the proposed model and the data from liu et al 2010 and huai et al 2014 2 5 experimental results and discussion comparisons between measured and modelled longitudinal velocity profiles are shown in fig 9 the velocity data marked as ave are the spatial average of velocity from different locations in individual cross section of each case as marked in fig 7 spatial averaging of the data here is required because the mean momentum balance already assumes a planar averaging carried out by raupach and shaw 1982 the averaging is calculated by weighted average method where the weights were selected as a parameter related to the diameters of dowels and the space between centres of two adjacent dowels for example in fig 8 locations in free region have the highest velocity compared to those behind the dowels liu et al 2008 rahimi et al 2019 either short or tall so they have the highest coefficient that is s d otherwise the locations behind the dowels have the coefficient of d 2 therefore the weighted average velocity v ave is calculated by 53 v ave v l 1 d 2 v l 2 s d v l 3 d 2 d d where v is the velocity at different locations d is the diameter of each dowel d is the distance between two adjacent dowels and s is the distance between the centres of two adjacent dowels fig 9 summarizes all the runs of our experiments for completeness among all the runs the largest velocity occurs in the free regions such as l2 and l4 the least velocity is found in the regions downstream of the dowels locations l1 l3 l5 l6 and l7 irrespective of the dowel height in the uniform velocity zone z hs locations l3 and l6 are behind the tall dowels with the velocity profile also having least velocity throughout the sections these observations from l3 and l6 show that the fluid experiences most drag in these regions inflection spike in these profiles is not significant which is not the same as the case with the profiles at locations l1 l5 and l7 in these locations where the short dowel is completely submerged inflection over the height of z hs is significant with a sudden increase in velocity immediately above z hs similarly in experiment 1 1 2 1 3 1 and 4 1 figs 9a d g j respectively the minimum depth of flow was maintained at 12 cm the velocity appears a similar trend to that of flow with single layer vegetation the velocities in these runs are found to be almost constant throughout the height of short vegetation followed by a rapid increase in velocity at z hs however the spatial variation l1 l6 or l7 of velocity trend is observed in each case from linear linear to staggered staggered formation see fig 9 for the other runs i e experiments 1 2 1 3 2 2 2 3 3 2 3 3 4 2 and 4 3 fig 9b c e f h i k and l velocity increases rapidly near the top of the short vegetation hs 0 1m and the increase in velocity becomes larger with increasing depth in all the cases furthermore in the sparser dowel arrangements with high flow depth experiment 2 3 multiple inflections in velocity profile can be seen in locations l1 l2 l4 and l5 the increment in the velocity above zero plane displacement is also found to be dependent on the location proximity to the tall dowels about 15 18 is found for the variation in velocity above z hs at location l5 behind short dowel in the mid section of the configuration in experiments 1 1 1 2 and 1 3 figs 9a b and c on the other hand with sparser arrangement at location l5 the percentage increment in velocity above z hs is found to be around 9 13 in experiments 2 1 2 3 see figs 9d f in fig 9g l with sparser arrangement of tall dowels the velocity profile does not become constant immediately behind locations l3 and l6 while in other locations the velocity is least moreover the velocity above z hs does not appear to converge onto a single logarithmic profile after slip velocity this could be attributed to the effect from the depth of submergence of the tall dowel in these cases drag dominates throughout the column of flow behind tall dowels however in case of complete submergence both turbulent stress and wake effects come into action in the region close to the surface in which a logarithmic velocity applies 2 6 model application to test the analytical model on data sets not used in its calibration the following published experiments are used fig 11 for experiments by liu et al 2010 and fig 13 for experiments in huai et al 2014 a total of 22 runs were considered without any biased selection see table 1 with vegetation height varying from 0 051 hs 0 14 and 0 152 ht 0 24 flow depth from 0 12 h 0 23 the frontal area of vegetation from 0 47 a 1 1 57 and 0 27 a 2 0 62 and drag coefficient from 1 1 cd 1 13 the averaged velocity of weighted experimental data and analytical results are compared in fig 10 this shows an overall good agreement between the experimental and predicted velocities in experiments 1 1 1 2 and 1 3 with linear formations for both short and tall dowels case 1 the analytical model shows good agreement with experimental data however there is a slight difference at the edge of short and tall vegetation for experiment 1 3 where the flow depth of 18 1 cm is very close to the height of tall vegetation this difference in the figure demonstrates the complexity in the flow near the edge of dowels in experiments 2 1 2 2 and 2 3 where the short and tall vegetation are in staggered and linear formations respectively case 2 there is also good agreement between analytical and experimental data with high correlations moreover in experiments 3 1 3 2 and 3 3 the experimental and predicted data agree except at the edge of vegetation in experiments 3 3 in the high flow depth of 18 3 cm i e experiment 3 3 although both experimental and analytical data have the same trend the agreement is not as good as that in the lower depth run 12 3 cm in experiment 3 1 nevertheless the model agrees with the experimental data with staggered formations for both short and tall vegetation see experiments 4 1 4 2 and 4 3 in fig 10 in fig 11 the proposed model is compared with the datasets of liu et al 2010 which are spatially averaged the results in figs 11 a b and f are for staggered staggered configurations with varying vegetation heights see table 1 whereas in figs 11 c d and e short and tall vegetation is configured as the combination of linear staggered linear linear and staggered linear respectively see fig 12 a sharp inflection point at z hs is visible in all the datasets which justifies that the slip velocity lies in the region close to short vegetation height in all the cases fig 11 in the datasets of liu et al 2010 the variation of the dowel height has affected the profile in the region of z hs for instance in figs 11 a and d the velocity profile in the region of z hs is not converging towards the logarithmic shape on the other hand flow is able to achieve a constant velocity which shows the great influence of the submergence ratio of the short dowel and independent behavior of the tall dowel see fig 11 c d e and f in experiment 4 of liu et al 2010 all the measurement locations are behind the dowels and there is no measurement in the free region area see fig 12 the lack of measurement in the free region affects the spatially weighted average consequently resulting in a smaller spatial average velocity so the average velocity in fig 11 c is less than the trend of analytical model prediction therefore it is not surprising that analytical and experimental data did not show good agreement in experiment 4 the experimental datasets of huai et al 2014 are spatial average of the complete frame of the piv data for their experiments x1 x2 y1 and y2 where x1 and x2 are linear linear configurations but y1 and y2 are staggered staggered configurations with two flow depths see table 1 the velocity data as the function of z have been taken with the spatial average over 22 cm width of the camera field in the streamwise direction which is finally averaged transversely across the test section huai et al 2014 fig 13 shows the comparison between the data of huai et al and the analytical model in general the proposed model shows reasonably good agreement 3 discussion to further check the robustness of the proposed model with the experiments error analyses are carried out the values of rmse root mean square of errors have been given for different cases of vegetation formations and flow depths in table 2 rmse is given by 54 r m s e 1 n i 1 n u a n u e n 2 where u a is the predicted velocity by the analytical model u e is the measured velocity data from experiments and n is the number of data the small values of rmse in table 2 show agreement between analytical and experimental results in experiments 1 1 2 1 3 1 and 4 1 where the flow depths are around 12 cm the analytical model performed exceptionally well while in experiments 1 3 2 3 3 3 and 4 3 where the flow depths are relatively high around 18 cm the model comparatively underestimates in the region of hs z ht one of the reasons may be due to the complexity of flow with an increase in shear over the slip velocity around z hs which may lead to an increase in flow velocity moreover the influence of short and tall vegetation heights on the mixing layer can be further speculated as another reason for slight under performance in the region hs z ht based on fig 13 although huai et al 2014 proposed a different analytical model for two layered vegetation with calibration using their own experimental data the large number of parameters with various constants in their model made it complicated and difficult to apply on the other hand the accuracy of their model to capture the point of inflection on the edge of short vegetation appears less in this proposed model 4 conclusions the two layered vegetation was modelled by pvc cylindrical dowels to study vegetated flow which was found to be more complex compared with the single layered flow the flow velocity characteristics at different locations were studied by 3d adv that for doubly layered vegetation with different densities and formations a new analytical model was proposed to describe the velocity profile in two layered vegetative flow with tall vegetation being emergent the main finding here is that the planar averaging is necessary in such data model comparisons moreover eddy viscosity models that are based on a local mean velocity and a prescribed mixing length appear to be reasonable at least in such class of models 5 future work the proposed analytical model in this study can evaluate velocity profiles in the cases where the short vegetation is fully submerged but tall ones are emergent this often occurs in nature but in some conditions especially in extreme flood conditions both short and tall vegetation could be fully submerged the future studies will be focusing on studying the flow with fully submerged conditions for both short and tall vegetation which include both experimental study and analytical model development credit authorship contribution statement h r rahimi visualization investigation data curation methodology software writing original draft x tang supervision visualization investigation writing original draft writing review editing p singh visualization investigation writing review editing m li supervision s alaghmand writing review editing acknowledgement the authors would like to thank the staff of nanjing hydraulic research institute for their support and time during the experiments and also acknowledge the support by the research development fund rdf 15 01 10 rdf 16 02 02 key programme special fund ksf e 17 of xjtlu and national natural science foundation of china 11772270 the authors would also like to thank two anonymous reviewers and the editor of the journal for their constructive comments which helped to improve the paper supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103527 appendix supplementary materials image application 1 
527,injection of co2 into carbonate rocks causes dissolution and alters rock transport properties the extent of the permeability increases due to the increased pore volume and connectivity strongly depends on the regimes of transport and dissolution reactions identification of these regimes and their parametrization at the microscopic scale is required for an understanding of the injection processes and afterward for calculating the effective macroscopic parameters for field scale simulations currently a commonly used approach for calculating the rock effective parameters is the pore network method pnm but a better understanding of the validity of its basic assumptions and their areas of applicability is essential here we performed a combined microscopic experimental and numerical study to explore pore shape evolution over a wide range of transport and dissolution reaction regimes experiments were conducted by flowing an acidic solution through a microscopic capillary channel in a calcite crystal at two different flow rates the experimental results were used to validate our pore scale reactive transport model that could reproduce the measured effluent composition as well as pore shape changes two key stages in pore shape evolution were observed a transient phase and a quasi steady state phase during the first stage the shape of the single pore evolved very fast depending on the flow regime under advective dominant flow the pore shape remained nearly cylindrical while under diffusive dominant transport the pore shape developed into a half hyperboloid shape during the quasi steady state stage the pore volume continued to increase however without or with diminutive change of the pore shape in this stage only a long period of injection may result in a significant deviation of the pore shape from its original cylinder shape which is a common assumption in pnms furthermore we quantitatively evaluated the impact of evolved pore shape spectrum on the conductance calculations and compared it to the formulations currently used for pore network modeling of reactive transport under low flow rates neglecting the developed non uniform pore shape during the non steady stage may lead to an overestimation of pore conductance up to 80 graphical abstract image graphical abstract keywords co2 injection single pore model microfluidics pore shape evolution pore conductivity evolution 1 introduction geological sequestration of co2 in carbonate reservoirs is considered to be a promising solution for mitigating the global warming problem caused by greenhouse gas emission hawez and ahmed 2014 liao et al 2012 pacala and socolow 2004 shaw and bachu 2002 injection of co2 into such rocks triggers a series of chemical reactions most importantly calcite dissolution that may cause changes in pore shape connectivity and tortuosity e g rathnaweera et al 2016 accurate predictions of these changes are important in order to control the injection rate and to assess the long term stability of the stored co2 rochelle et al 2004 traditionally the dissolution of carbonate rocks by acidic co2 rich solutions is simulated at the darcy scale which solves macroscopic equations over averaged porous media with the assumption that each spatial element of a porous medium is a well mixed volume however the fluid transport processes and geochemical reactions occur at the pore scale of the reservoir rock where the solid fluid interface are well defined therefore confident prediction of rock transport properties from continuum scale models needs input from pore scale models several research groups have utilized 3d micro ct images or virtually generated geometries to simulate the coupled physical and chemical processes at the pore scale however they are limited to a relatively small amount of pore volumes even with the existing computational power another powerful approach to investigate these coupled subsurface processes at the pore scale is pore network modeling pnm where the pore space is represented by a set of pre defined shapes for pore bodies and throats pnms enable simulations on orders of magnitude larger rock volumes compared to the full 3d pore scale simulations due to a simplified representation of pore geometries several reactive pnms capable of handling evolving geometries have been proposed in the literature in the context of co2 related problems algive et al 2010 mehmani et al 2012 nogues et al 2013 raoof et al 2012 tansey and balhoff 2016 varloteaux et al 2013b 2013a for instance microscopic pore wall evolution can be related to the change in porosity and permeability using dimensionless numbers algive et al 2010 varloteaux et al 2013a 2013b in other available pnms the geometry modification assumes that pores open linearly without changing shape irrespective of reaction and transport regime mehmani et al 2012 nogues et al 2013 raoof et al 2012 the validity of these assumptions can be tested using microfluidics experiments and detailed simulations at the single pore scale single pore models allow a detailed description of reactive transport processes chen et al 2014a b kang et al 2003 kumar et al 2011 li et al 2008a b van noorden 2009 these models simulated coupled processes in the context of carbonate dissolution for fixed geometry li et al 2008 and relatively simple chemical system or evolving geometry chen et al 2014a b kang et al 2003 kumar et al 2011 li et al 2008b van noorden 2009 recently gray et al 2018 investigated a single channel drilled through solid calcite and a pristine ketton oolite core plug they observed that the cylindrical pore evolves into a nonlinear half hyperboloid shape however they did not investigate the flow and reactive transport regimes under which the nonlinear pore shape developed and the influence of different transport and reaction parameters on the developed pore shape here we combine microscopic experiments with numerical simulations at the single pore scale to investigate the impact of acidic solution injection on pore shape evolution in calcite we have used the stokes equation for fluid flow coupled with solute advection diffusion equations and multicomponent chemical reactions the evolution of the explicitly defined calcite solid fluid interface is simulated using arbitrary lagrangian eulerian ale method the developed model is validated by microfluidic experiments conducted in single pores drilled through optical grade calcite crystals confocal laser microscope was used to track the pore shape evolution furthermore the chemical composition of the effluent solution was measured to validate the overall calcite dissolution rate depending on flow regime our results showed an initial intense pore shape change while the concentration gradients turn into a quasi steady state once quasi steady state was attained the continued dissolution lead to an additional pore widening with limited change of pore shape over time which deviates from the original cylinder shape only for long periods of injection we have quantitatively evaluated the impact of our results on assumptions relating conductance evolution for pnm models that assume a linear pore opening the goals of this paper are as follows i to validate the numerically simulated pore shapes against the microfluidic lab experiments ii to perform a systematic study of different flow transport and reaction conditions in order to identify the regimes for which the currently used pnms are providing reliable results and the regimes for which the usage of pnms assuming constant cylindrical pore shapes can lead to significant errors iii to calculate the pore conductance through the direct simulation algorithm presented here as well as using state of the art approaches used by pnms and compare the two methods 2 materials and methods 2 1 single pore simulations to simulate pore evolutions fluid flow and multi complement transport processes were solved fully coupled with moving boundaries due to dissolution reactions si section s1 a finite element method was used comsol multiphysics and a backward euler time stepping method was implemented for time discretization 2 1 1 fluid flow and transport in this study we have considered slow fluid velocity only i e reynolds number re 1 therefore the inertial terms can be neglected in the momentum equations and the stokes equation may be used to compute the velocity field and the pressure in the single pore 1 ρ u t p μ δ u 2 u 0 where p is pressure ρ is the fluid density and μ is the fluid viscosity the density and dynamic viscosity of water were 998 25 kg m 3 and 8 96 10 4 pa s respectively the concentration of the dissolved species is assumed to be low enough so that the fluid density and the viscosity changes are negligible at the inlet a constant mass flux condition is imposed and a constant pressure of 1 0 bar is applied at the outlet at the lateral boundaries of the pore no slip boundary conditions are imposed the normal velocity at the lateral pore boundaries is continuous i e the normal fluid velocity at the interface is equal to the normal velocity with which the solid wall moves due to the solid surface dissolution initialy i e at time zero it is assumed that the pore with calcite walls is in equilibrium with the steady state flow the simulation starts by dropping the ph of the injecting fluid via the inlet of the pore which initiates the dissolution process leading to pore geometry evolution during the simulation the velocity field is updated to account for the pore geometry changes to simulate the transport of each dissolved species advection diffusion reaction equation is implemented 3 c i t d i c i u c i r i where di ci and ri are diffusion coeffcient m2 s 1 concentration mol m 3 and reaction input of species ith mol m 3 s 1 respectively at the pore inlet we implemented a flux based boundary condition starchenko et al 2016 this flux depends upon the fluid velocity and the concentration values specified 4 n d i c i u c i u n c o i where coi is the inlet injected concentration of species ith and un is the normal velocity at the inlet the concentration for each aqueous species is given in table 1 the outlet boundary is exposed to zero gradient condition for all species to conserve the mass across the solid fluid interface the total diffusive plus convective flux for species involved in the surface reactions i e ca2 and co3 2 equals the reactive flux at the interface this reads 5 n d i c i u c i r c a l c i t e where rcalcite mol m 2 s1 is the surface reaction rate as discussed in si section s1 1 2 1 2 geochemical model the injected solution into the carbonate rock reservoirs contains dissolved co2 this leads to the formation of the weak carbonic acid and its dissociation to establish new equilibria with hco3 and co3 2 species the reactions involving the dissolution of co2 in the water are much faster than any other fluid mineral reactions rochelle et al 2004 as long as the ph 9 wolthers et al 2008 zeebe and wolf gladrow 2001 which is the situation for this study therefore we can safely assume that solution phase reactions are of equilibrium type si section s1 1 calcite dissolution occurs at the fluid solid interface which is represented by the lateral boundaries of the pore the dissolution rate laws applied at these boundaries are based on the study by busenberg and plummer 1986 si sections s1 1 and s3 1 under acidic conditions the overall dissolution rate strongly depends upon the activity of h which becomes ph independent when values of ph are above 7 to calculate the activity coefficient of charged species the davies equation was applied 2 1 3 pore shape evolution model calcite dissolution results in a moving fluid solid interface problem for such problems the arbitrary lagrangian eulerian ale method is considered to be very precise as the solid fluid boundary can be exactly tracked kumar et al 2011 soulaine et al 2017 van noorden 2009 see kumar et al 2013 for more details on the ale method in the context of reactive transport related problems a displacement rate normal to the pore surface is assigned to the reactive walls which depend on the amount of the dissolved calcite and thus on the reaction rate of calcite dissolution we should note that in the free boundary problem considered here the displacement rate of the pore wall i e the solid fluid interface is not a predefined constant value or function instead it is calculated at each time step and for each point along the pore length si section s1 2 this makes the dissolution rate a dynamic nonlinear parameter which depends on the solution composition 2 1 4 physical chemical parameters the initial cylindrical pore geometry is representing a single pore located in a carbonate rock sample for model validation the dimension of the pore was set using the size of the capillary tube used in experiments being length l 2 10 3 m and radius r 2 5 10 4 m for models used for analysis the dimension of the pore was set equal to the naturally occurring pore sizes i e l 5 10 4 m and r 4 10 5 m the pore is initially filled with calcite saturated water the equilibrium concentration of species corresponding to this condition is listed in table 1 unless specified otherwise the diffusion coefficients for all species were assumed identical with a value of 3 36 10 9 m2 s 1 which is the average of the self diffusion coefficient of species present in the reactive system as listed in table 1 hereafter this model is referred as model i we performed several simulations by applying different flow velocities to cover a range of transport regimes from diffusion dominated to advection dominated conditions moreover by changing the chemical composition of the injecting solution we aimed to explore the impact of different reaction regimes for the model validation two flow rates corresponding to the microfluidic experiments were implemented which were equal to 8 3 10 11 and 8 3 10 10 m3 s 1 resulting in an average velocity of 4 10 4 and 4 10 3 m s 1 respectively for the further analysis of the single pore system five flow rates were imposed in our model including 2 10 10 2 10 11 2 10 12 2 10 13 2 10 14 m3 s 1 this resulted in average velocity values of 4 10 2 4 10 3 4 10 4 4 10 5 and 4 10 6 m s 1 the injected solution is in equilibrium with a certain pco2 value pressure of co2 gas the concentration of all species with the target pco2 values were obtained using phreeqc parkhurst and appelo 2013 with the phreeqc dat database in this study pco2 values of 100 0 10 0 and 1 0 bar were chosen to represent different reaction regimes the corresponding values of the species concentrations in these solutions are listed in table 1 to implement the experimental conditions as accurately as possible in the comsol model the injecting solution composition was matched to the ph 2 using hcl acid in place of pco2 the details of this solution are given in table 1 2 1 5 parametrization of the flow and reaction regimes in order to analyze the relative strength of advection diffusion and reaction we use dimensionless péclet number and damkhöler number the péclet number pe compares the characteristic times of diffusion and advection transport processes as 6 p e v r d where v is the average velocity at the inlet boundary and r is the radius of the channel at the inlet due to the dissolution the radius at the inlet changes and this leads also to the change of the inlet velocity both effects indicate that pe and da change with time the damkhöler number da measures the solution reactivity compared to the advection rate as 7 d a t a t r 8 t a r v 9 t r c c a l c i t e s r ta and tr are the advection time scale and reaction time scale respectively sr is the surface reaction rate noted at the end of the first stage from the inlet pore wall mol m 2 s 1 and ccalcite is the density of surface sites of calcite at the start of dissolution mol m 2 this is calculated from the surface site density data i e 4 9 calcite molecules per nm2 based on crystallographic data for the dominant cleavage plane of calcite e g wolthers et al 2008 and avogadro number 6 023 1023 providing ccalcite as 0 8 10 5 mol m 2 as pe and da numbers change over time we examine the results with respect to the initial pe and da numbers calculated at the inlet boundary of the pore table 2 provides the da and pe numbers corresponding to the numerical simulations model i where simulations 1 and 2 were used for the model validation and simulations 3 11 were used for the pore shape analysis 2 2 microfluidic experiments to directly observe pore evolution and to validate our numerical model microfluidic experiments were conducted using a channel of radius 2 5 10 4 m and length 2 10 3 m drilled in optical grade calcite crystal iceland spar a laser fluorescence confocal microscopy nikon a1r confocal was used to image the extent of dissolution and the pore shape change for the fluorescent dye fluorescein sodium salt lot no bcbm7214v sigma aldrich emission wavelength 515 nm was used the injection solutions were prepared using deionized water equilibrated with atmospheric co2 and adjusted to desired ph value of 2 with 1 m stock solution of hcl acid to ensure the sufficiently constant ionic activity of solutions 0 2 m equivalent nacl salt lot no k48328204648 was added at the start of each experiment caco3 saturated water is injected in the channel to attain the approximate carbonate reservoir initial conditions the solutions were injected with the use of a syringe pump 11 pico plus elite harvard apparatus and a 5 ml gastight syringe hamilton 1700 series at the desired flow rates effluent measurements were done to obtain changes in ph and ca2 concentration due to the dissolution of the calcite orion micro ph electrode was used for the ph measurement of the effluent solution inductively coupled plasma optical emission spectrometer icp oes spectro arcos with a cross flow nebulizer was used for the ca2 concentration measurement the collected outflow samples for the period 0 t were diluted with 2 hno3 solution to attain the minimum required sample volume of 6 ml for icp oes measurements measured ca2 concentration from the outflow solution is compared to the flux weighted averaged concentration of ca2 at the pore outlet of the numerical model calculated as 10 c c a o u t 0 r t c c a r u r r d r 0 r t u r r d r here c c a r and u r are the ca2 concentration and velocity at the radial distance of r respectively r t stands for the outlet radius of the pore at time t t radial symmetry of the solution is assumed thus no integration with respect to the angle φ in the cylindrical coordinates is needed displacement of the calcite surface was quantified with reference to the position of the inert glass section attached to the inlet face of the channel additional details of material and methods are provided in si section s2 the experiments were conducted at two flow rates with one order of magnitude difference i e 5 µl min 1 and 50 µl min 1 to inject the solution with a ph value of 2 these flow rates yielded average velocities of 4 2 10 4 m s 1 and 4 2 10 3 m s 1 respectively 3 results and discussion 3 1 validation of the numerical model outcome with experiment results fig 1 shows the ca2 concentration and the ph at the outflow obtained by measurements and using the numerical simulations the agreement between modeling and measured data was good for ca outflow concentrations and reasonably well for ph under both flow rates the simulation results for pore shape evolutions also showed a good agreement with the experimentally observed pore shape under both flow regimes fig 2 under high flow rates the channel evolved almost uniformly with only minor curvatures of the pore wall near to the inlet and almost retained the original cylindrical pore shape fig 2a and c under low flow rate conditions the channel evolved to a non uniform half hyperboloid shape with a strong curvature developing close to the pore inlet fig 2b and d in the high flow rate experiment average pore wall displacement was calculated using the average of the top pore wall displacement and the bottom pore wall displacement we found a similar value for the experiment equal to 51 µm shown in fig 2a and simulations equal to 61 µm shown in fig 2c after injecting the same number of pore volumes in contrast under low flow rate the magnitude of experimentally observed average pore wall displacement with a value of 179 µm was overestimated by the model which provide a value of 252 µm fig 2b and d for high flow rate both effluent measurement and microscope image based results are within the experimental error with the model utilizing a single diffusion coefficient for all aqueous species also the agreement between the amount of dissolved calcite from the microscopic and the simulated image of the channel fig 2 indicates that the reactive transport model appropriately captures the dissolution rate i e the pore evolution in the low flow rate experiment the disagreement between the obtained calcite surface displacement value using modeling and experiments is within the range of the uncertainty of the input parameters i e reaction rate constants and the choice of diffusion model details are provided in si sections s3 1 and s3 2 we observed that the system remains far from the equilibrium for the whole duration of the experiment fig s5 which supports the capability of the implemented rate model to capture the dissolution process throughout the experiment period we also found that changing the diffusion coefficients or using species specific diffusion coefficients would not improve the results therefore as pore shape evolution under varying fluid velocity and composition is captured well by using a single diffusion coefficient model we have applied model i for further analysis 3 2 initial stages of pore shape development the pore fluid is initially at equilibrium with calcite proving a ph value of 9 9 injection of an acidic solution with a ph value of 3 9 and pco2 value of 1 0 bar shifts the equilibrium conditions of the pore fluid differently under different flow regimes the injection initiates calcite dissolution through a set of bulk reactions as well as surface reaction the surface reaction products i e ca2 and co3 2 accumulate within the boundary layer near the pore wall from where they move away towards the bulk fluid the amount of reaction products strongly depends on the difference between ph of the injected solution and that of the initial pore fluid we observe a front propagation behavior along the pore at the initial stage of the reaction in the advection dominated flow regime pe 1 the ca2 rich zone that is initially near the pore wall at the pore inlet fig 3 a plot a is predominantly transported downstream along the pore wall fig 3a plots b and c before reaching the central part of the pore as such the longitudinal gradient smoothens faster than the transversal i e cross sectional gradient yielding concentration profiles with a prominent transversal gradient fig 3a plot d whereas in diffusion dominated flow regime pe 1 the ca2 plume is shorter and more intensive i e with a higher concentration of the reaction products fig 3b plot a the reason is that at pe 0 47 the flow velocity is slower and more time is available to wash out the dissolution products a stronger diffusive flux drives the transversal mixing as well resulting in a concentration profile with a less prominent transversal gradient compared to the longitudinal gradient fig 3b plots b d although the low and high flow rate conditions lead to distinct concentration gradients in both cases during the injection we observe two stages in the development of the concentration gradients in the first stage the concentration field changes significantly leading to the establishment of a flow regime specific concentration field whereas in the second stage referred to here as the quasi steady stage these changes become minute and the concentration gradients change only slowly the quasi steady state concentration gradient govern the dissolution and thus the pore wall evolution during the time in the case when the concentration gradient along the wall is almost zero the pore just expands in the normal direction without significant change of shape in the case when there is a positive concentration gradient along the pore wall the pore widens faster near the inlet compared to the outlet to quantify the pore shape evolution during these stages and to explicitly mark the duration of the first stage the relative displacement rate of the pore wall was calculated as the ratio of the displacement rate of the pore inlet to the pore outlet at any time the value of the relative displacement rate indicates how faster the pore inlet is displaced compared to the pore outlet for example for pe number 0 47 initially inlet displacement rate is 8 5 times faster than the outlet displacement rate fig 4 b during the first stage the displacement rate of the pore outlet decreases constantly and at the end of this stage the relative displacement rate reaches an asymptotic value of 2 3 fig 4b contrastingly in the first stage for pe number 47 4 this rate attains an almost constant value of 1 27 fig 4a such evolution of the relative displacement rate of the pore wall results into a rigorous modification of the pore wall shape the continuous change in the relative displacement rate is related to the shape of the pore at that time shown in figs s7 and s8 for the example case of pe number 47 4 and 0 47 respectively in conclusion during the first stage the concentration field modifies intensively resulting into the intensive evolution of the pore geometry and the end of this stage is marked by a nearly established concentration gradients along the pore wall providing a basis to find a predictive rate for the pore shape evolution while the pore shape evolves during the first stage the pressure gradient remains constant less than 0 1 see si section s3 3 this is due to the fact that the magnitude of the pore wall displacement in the short duration of the first stage is negligible compared to the overall aperture of the pore therefore in the context of the simulated dissolution regimes and the pore dimensions the geometry changes during the first stage of the dissolution can be neglected which is in agreement with the theoretical evaluation of reactive transport regimes algive et al 2010 3 3 evolution of the pore shapes under extended injection times although during the first stage the overall pore size would not increase considerably the developed half hyperboloid pore shapes indicate the dissolution pattern the persisting longitudinal gradients in this stage imply that the pore inlet has a higher dissolution rate compared to the pore outlet the overall pore opening takes place during the second stage to explain the pore evolution we choose the simulation corresponding to the pe number of 0 47 and da number of 2 13 as concentration gradients are established along the pore after the first stage and considering that the reaction rate depends on the concentration gradients dissolution of the interface at the inlet and at the outlet will take place at different speeds however with a predictive manner fig 5 a remarkable observation was that for about 2 000 000 s nearly 23 days the reaction rate showed larger values at the inlet compared to the outlet as a result during this period the pore widened faster at the inlet compared to the outlet deviating to a greater extent from the initial cylindrical shape initially the calcite near the inlet dissolves about twice faster than close to the outlet see also fig 4b while at time scales well beyond 23 days we observe lower however similar dissolution rates at both inlet and the outlet faces fig 5 fig 6 shows relative displacement rates modifying the pore shape during the second stage the continued opening of the half hyperboloid shape will eventually result in the development of a non linear pressure profile fig 6 shows the shape of the pore at two different times at the time of 1000s when the inlet radius has increased with about 1 5 40 6 vs 40 and the outlet radius has increased 0 67 40 3 vs 40 the pressure along the pore remains linear meaning that at each point along the pore we have a constant pressure gradient recall that the constant pressure gradient along a pore is an essential assumption in pore network algorithms however at t 30 000 s the pore shape develops so that the inlet radius has increased by 44 and the outlet radius by 18 resulting in a non linear pressure profile along the pore in contrast for pe 47 the relative displacement rate at the end of the first stage is close to one and the initially cylindrical pore remains nearly cylindrical throughout the second stage and the pressure profile stays linear fig s10 3 4 flow rate effects on the pore shape evolution to further explore the flow rate effects we have performed several simulations by varying the pe number while the ph of the inflowing solution was kept constant at a value of 3 9 at pe 1 the reaction products effectively diffuse into the pore bulk fluid region before any substantial longitudinal transport takes place fig 3b near the inlet strong diffusion of the reaction products toward the central parts of the pore facilitates calcite dissolution at the same time along the pore the saturation index of the pore fluid with respect to calcite increases towards equilibrium due to the buffering by the dissolution products and dissolution rates decrease along the flow path consequently dissolution reactions take place mainly close to the pore inlet resulting in non uniform pore widening and formation of a half hyperboloid shaped pore figs 2b and 7 a for pe 1 the transport is dominated by advection under this regime the fast entering solution into the channel replaces the resident solution before the diffusion of the reaction products smoothens transversal gradients and buffers the ph of the solution therefore the calcite pore wall is exposed to a reactive solution along the entire pore resulting in an even dissolution rate and a nearly uniform evolution of the pore shape figs 2a and 7b note that at both flow rates flow velocity increases towards the outlet face of the pore which reflects the constricted shape of the pore fig 7 besides a difference in the shape evolution i e a localized difference in calcite dissolution rate there is also a clear difference in the total amount of dissolved calcite per injected pore volume the simulation under low flow rate resulted in a higher value of calcite surface displacement per pore volume injected compared to the simulation under a fast flow rate this is because the solution residence time is larger for the low flow rate simulation and therefore reactants dissolve more calcite however when using time rather than injected pore volume the low flow rate dissolves less calcite compare to a high flow rate over time the evolution of the pore shape corresponding to all of the simulated flow rates is discussed in section s3 4 3 5 chemistry effects on the pore shape evolution in addition to the flow rate the chemistry of the injecting fluid affects the pore shape to explore chemistry effects further we performed simulations with two injecting solutions at ph values of 3 1 and 3 9 corresponding to pco2 of 100 0 bar and 1 0 bar respectively evolution of the pore shape depends on the reactivity of the pore wall towards the injecting solution expectedly the ph 3 1 solution results in the stronger displacement of the pore wall than the ph 3 9 solution this results in increased concentrations of the reaction products near the pore wall driving the local solution chemistry towards equilibrium with respect to calcite this buffering of fluid is also reflected by a change of the fluid ph in the case of the ph 3 1 inflow solution at pe 4 74 the transversal average ph increases from 4 71 to 4 82 corresponding to the dissolution rate from 1 70 10 4 mol m2 s 1 to 0 49 10 4 mol m2 s 1 from inlet to outlet boundaries respectively the result of this alteration in the pore fluid chemistry is ultimately reflected by the evolved pore shape in this case the pore widens non uniformly along the pore length fig s12a however injecting a ph 3 9 solution at pe 4 74 provides a transversal average ph that changes from 4 09 to 5 10 and dissolution rate from 2 12 10 5 mol m2 s 1 to 1 72 10 5 mol m2 s 1 from the inlet to outlet boundaries respectively in this case fluid buffering during dissolution is relatively weaker and a more uniform pore shape develops fig s12b to cover a range of values for damkhöler numbers i e reaction regimes we have chosen a combination of flow rates and injecting fluid chemistries fig 8 table 2 provides details of these simulations by increasing da number the reaction time scale decreases compared to the advection time scale and the system approaches being transport limited instead of surface rate limited the normalized displacement profiles after injecting 1590 pore volumes provided in fig 8 show that there is a monotonic relation between pore shape and da under the considered reaction regimes for da 1 and pe 47 4 reaction time scale is higher than the advection time scale and at the same time advection dominates the diffusion in such advection dominated transport regimes the chemistry of the injecting fluid has less control on pore shape evolution and adjusting inflow ph from 3 4 to 3 9 has a negligible impact over the pore shape fig 8a da numbers 0 03 and 0 21 whereas in the da 1 and pe 0 47 regime which is overall reaction dominated while transport is diffusion dominated the same shift of inlet ph causes a profound change in pore shape fig 8a da number 2 13 and 14 95 the dissolution regime corresponding to da 1 and da 1 can also be obtained by changing the ph of the injecting fluid if the ph 3 9 solution is injected i e da 1 the impact of changing flow rate is less prominent over the pore shape and the pore shape remains nearly uniform fig 8b da 0 03 pe 47 4 versus da 0 29 pe 4 74 for a regime of da 1 using a reactive fluid with ph 3 1 a shift of pe number causes a significant change of the pore shape fig 8b da number 0 96 and 9 1 in reaction limited dissolution regimes da 1 control of flow rate and reactive strength of the injecting fluid becomes marginal over the shape of the pore the reason is that the time necessary for dissolution reaction i e generating the reaction products and consuming protons may dominate rather than the fluid mixing scale when analyzing the fluid buffering state and in these regimes dissolution is spatially homogeneous leading to uniformly developed pore shapes whereas in transport limited dissolution regimes da 1 fluid mixing strength exerts control over the chemical gradient inside pore space this leads to heterogeneous dissolution process in which both flow rate and chemistry of the injecting fluid govern the pore shape to summarize we can conclude that both injection parameters such as flow rate and fluid chemistry impart control over the pore shape fig 9 provides a spectrum of pore shapes based on changes in transport and reaction regimes shown by pe and da numbers the marking of the regimes in this study aligns well with the previously reported pore scale work specific to the calcite dissolution for e g soulaine et al 2017 they have also observed the boundary between the uniform and non uniform type of dissolution at da number 1 in the subsequent section we compare the conductance of a single pore after long injection period calculated here with using fully coupled pore scale model utilizing ale method and the approximate calculation of the conductance discussed in pore network algorithms and investigate the related error depending on the dimensionless process parameters pe and da 3 6 implication of the pore shapes on the pore conductance evolution of conductance in dissolution simulations is implemented in existing pore network algorithms e g raoof et al 2012 mehmani et al 2012 raoof et al 2013 and nogues et al 2013 a significant underlying assumption in this implementation is that the shape of the pore remains uniform where the evolved pore shape still results in a linear pressure drop along the pore the results presented here show that this assumption is valid under the advection dominated flow regimes with pe 1 and transport dominated reaction regimes with da 1 however as we observed in the case of the pe 0 47 the changes of the shape start to influence the pressure profile in a time scale of 30 000 s which is within the time scale of injection period in a reservoir the pressure profile along a pore is directly related to the conductance calculated in pnm taking the commonly assumed laminar flow when the pore changes are uniform along its length the pressure drops linearly fig s10 this is not the case when the pore shape deviates from the cylindrical one in such a case the pressure gradient is not constant and changes along the pore fig 6 such pressure nonlinearity affects the pore conductance and therefore the rock permeability hence we need to quantify the impact of such modified shapes on the conductance of the pore the definition of conductance k is given via the flow rate q m3 s 1 and the pressure drop δp n m 2 along the pore as 11 q k δ p for a rounded cylindrical pore with a constant diameter along the pore with a parabolic velocity profile i e hagen poiseuille flow the conductance k m5 n 1 s 1 is known and it is given by 12 k π 2 r 4 128 μ l here l is the length of the pore called also pore throat length in the pnm literature given in meters m r is the radius of the pore m in dissolution experiments as the radius r r t and eventually the shape of the pore changes the pore conductance is no longer constant k k t we calculated the apparent pore conductance i e overall conductance of the pore using eq 11 for fig 10 the conductance and pore volume is normalized with respect to the initial pore conductance and the initial pore volume respectively the half hyperboloid pore shape leads to a changing pressure gradient along the pore fig 10a black line the narrowness of the pore aperture towards the outlet provides small contributions to the overall volume changes of the pore however this section of the pore controls the overall conductance of the pore consequently pore volume increases considerably near the pore inlet while pore conductance changes marginally during hyperboloid pore shape formation fig 10a black line this means that as non uniformity of the pore shape increases the change of conductance becomes smaller for the same amount of volume change fig 10 therefore at the pore scale the change of the pore conductance in time in certain cases cannot be described just as a function of the pore volume the pore shape may play a significant role the implication of this observation for macroscale simulations is that formulae which provide permeability only as a function of porosity are not always suitable and they are accurate only over a certain flow and reactive transport regime for which they have been developed in most of the existing pore network models the conductance of the pore throat is updated at each time step in response to the changing volume of the pore only without accounting for the pore shape evolution and such a conductance is obtained by utilizing either the volume of the connecting pore bodies nogues et al 2013 or the volume of the pore throat raoof et al 2012 we calculated the conductance of the simulated pore geometry in a similar method as used by raoof et al 2012 at each time step the volume of the pore provides the uniform radius of the pore which is further utilized in calculating the conductance fig 11 shows the comparison of this conductance with the one calculated from the actual geometry of the pore for two of the dissolution regimes we observe that if the dissolution process maintains the cylindrical shape of the pore then the conductance is only a function of the volume of the pore as assumed in pnms fig 11b whereas for the dissolution regime corresponding to pe 1 and da 1 the conductance of the pore does not remain a function only of the volume of the pore but it depends also on the shape of the pore in the latter case ignoring the dependence of the conductance from the pore shape results in an error the conductance calculated from the volume of the pore pnm approach overestimates by 38 the conductance calculated from the actual hyperboloid pore shape when the volume of the dissolved calcite is equal to the original volume of the pore this overestimation is 76 when the volume of the dissolved calcite is equal to two times the original volume of the pore and may increase further with dissolution fig 11a note that the pore conductance evolution during the dissolution process depends not only on the flow and reaction regimes as shown here fig 10 but also on the length of the pore on the initial radius of the pore on the equilibrium ph and on the ph of the injected fluid for the ph radius and length of the pore investigated here fig 12 summarizes the regimes in which the conductance can be calculated as in pnm only by the volume of the pore vs the regimes where this method fails to capture the correct conductance this figure presents a moment during the dissolution process at which the change in the pore volume is 100 i e v v0 2 for the reaction controlled regimes da 1 irrespective of the flow rate the volume based conductance is within 1 range of the actual conductance this difference increases significantly for the transport controlled regimes where the diffusion dominated flow regimes yielding up to 76 of the difference note that the difference increases further with dissolving larger volume of the calcite this result illustrates the limitation of the existing assumption in the pore network model however the work for deriving a more defined relationship for conductance remains a topic for future work although the presented insights about the pore scale processes are based on a detailed geochemical model which includes both equilibrium and kinetic processes along with the multi component solution system it would be interesting future work to investigate the limitation of a simplified geochemical model against the current detailed model also in this study we have presented two sets of microfluid experiments with an objective of validating the modeled pore shapes however utilizing such calcite micromodel setups to investigate the calcite dissolution processes under a wider range of transport and reaction regimes and in different pore geometries remains future work 4 conclusions 1 the simulation results of reactive transport processes through single calcite pore and the results from the respective microfluidic experiments were found to be in good agreement at both investigated flow rates the validated computational algorithm was used to perform a thorough and detailed study of the dissolution processes for a range of hydrochemical parameters 2 it was observed that the calcite dissolution process can be divided into two stages with respect to the concentration field development and pore shape evolution during the first very short in the order of seconds and intrinsically transient stage the reactive transport processes rapidly change the concentration field inside the pore and at the end of this stage the pore has attained a characteristic shape and concentration gradient only the latter plays a critical role in the longer term dissolution process these numerical results are a justification of the statements of other authors that the pore shape development during the first stage can be ignored while the concentration gradient should be accurately calculated the second stage is long days or longer and corresponds to real injection times in reservoirs at this stage the flow and transport are at a quasi steady state the pore shape changes slowly but for large concentration gradients significant deviation from the original cylindrical shape can be observed for certain dissolution regimes 3 generally lower flow rates result in significant concentration gradients in the longitudinal direction and thus in a non uniform change of the pore shape as a result the pressure gradient is no longer constant along the pore an increase in solution reactivity lowering in ph provides the same effect it drives reactions towards equilibrium over a shorter distance from the inlet and therefore results in non uniform pore shapes injecting fluid with a high flow rate or lower reactivity yields a more uniform pore volume increase we also observe that the impact of flow rate and fluid reactivity on the pore shape are more significant when dissolution is transport controlled da 1 4 for certain flow and reaction regimes a significant difference is observed between the pore conductance computed here and pore conductance computed according to pnm assuming constant pore shape further research is needed to understand if and how pnm can be used for dissolution regimes for which the basic pnm assumption leads to significant error in conductance evaluation supporting information available additional details on numerical model and experiment methods and figures 1 12 credit authorship contribution statement priyanka agrawal conceptualization methodology formal analysis visualization writing original draft writing review editing validation investigation amir raoof conceptualization methodology formal analysis visualization writing original draft writing review editing supervision oleg iliev conceptualization methodology formal analysis visualization writing original draft writing review editing supervision mariëtte wolthers conceptualization methodology formal analysis visualization writing original draft writing review editing supervision funding acquisition resources project administration declaration of competing interest there are no conflicts to declare acknowledgements the research work of p a and m w is part of the industrial partnership programme i32 computational sciences for energy research that is carried out under an agreement between shell and the netherlands organisation for scientific research nwo veni talent scheme awarded to a r with project number 016 151 047 which is partly financed by nwo support for this research of o i from the bundesministerium für bildung und forschung bmbf germany via project reskin 0310011c is highly appreciated part of the work was done during o i s stay in utrecht university as visiting professor of the darcy center of utrecht university and eindhoven university of technology supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 103480 appendix supplementary materials image application 1 
527,injection of co2 into carbonate rocks causes dissolution and alters rock transport properties the extent of the permeability increases due to the increased pore volume and connectivity strongly depends on the regimes of transport and dissolution reactions identification of these regimes and their parametrization at the microscopic scale is required for an understanding of the injection processes and afterward for calculating the effective macroscopic parameters for field scale simulations currently a commonly used approach for calculating the rock effective parameters is the pore network method pnm but a better understanding of the validity of its basic assumptions and their areas of applicability is essential here we performed a combined microscopic experimental and numerical study to explore pore shape evolution over a wide range of transport and dissolution reaction regimes experiments were conducted by flowing an acidic solution through a microscopic capillary channel in a calcite crystal at two different flow rates the experimental results were used to validate our pore scale reactive transport model that could reproduce the measured effluent composition as well as pore shape changes two key stages in pore shape evolution were observed a transient phase and a quasi steady state phase during the first stage the shape of the single pore evolved very fast depending on the flow regime under advective dominant flow the pore shape remained nearly cylindrical while under diffusive dominant transport the pore shape developed into a half hyperboloid shape during the quasi steady state stage the pore volume continued to increase however without or with diminutive change of the pore shape in this stage only a long period of injection may result in a significant deviation of the pore shape from its original cylinder shape which is a common assumption in pnms furthermore we quantitatively evaluated the impact of evolved pore shape spectrum on the conductance calculations and compared it to the formulations currently used for pore network modeling of reactive transport under low flow rates neglecting the developed non uniform pore shape during the non steady stage may lead to an overestimation of pore conductance up to 80 graphical abstract image graphical abstract keywords co2 injection single pore model microfluidics pore shape evolution pore conductivity evolution 1 introduction geological sequestration of co2 in carbonate reservoirs is considered to be a promising solution for mitigating the global warming problem caused by greenhouse gas emission hawez and ahmed 2014 liao et al 2012 pacala and socolow 2004 shaw and bachu 2002 injection of co2 into such rocks triggers a series of chemical reactions most importantly calcite dissolution that may cause changes in pore shape connectivity and tortuosity e g rathnaweera et al 2016 accurate predictions of these changes are important in order to control the injection rate and to assess the long term stability of the stored co2 rochelle et al 2004 traditionally the dissolution of carbonate rocks by acidic co2 rich solutions is simulated at the darcy scale which solves macroscopic equations over averaged porous media with the assumption that each spatial element of a porous medium is a well mixed volume however the fluid transport processes and geochemical reactions occur at the pore scale of the reservoir rock where the solid fluid interface are well defined therefore confident prediction of rock transport properties from continuum scale models needs input from pore scale models several research groups have utilized 3d micro ct images or virtually generated geometries to simulate the coupled physical and chemical processes at the pore scale however they are limited to a relatively small amount of pore volumes even with the existing computational power another powerful approach to investigate these coupled subsurface processes at the pore scale is pore network modeling pnm where the pore space is represented by a set of pre defined shapes for pore bodies and throats pnms enable simulations on orders of magnitude larger rock volumes compared to the full 3d pore scale simulations due to a simplified representation of pore geometries several reactive pnms capable of handling evolving geometries have been proposed in the literature in the context of co2 related problems algive et al 2010 mehmani et al 2012 nogues et al 2013 raoof et al 2012 tansey and balhoff 2016 varloteaux et al 2013b 2013a for instance microscopic pore wall evolution can be related to the change in porosity and permeability using dimensionless numbers algive et al 2010 varloteaux et al 2013a 2013b in other available pnms the geometry modification assumes that pores open linearly without changing shape irrespective of reaction and transport regime mehmani et al 2012 nogues et al 2013 raoof et al 2012 the validity of these assumptions can be tested using microfluidics experiments and detailed simulations at the single pore scale single pore models allow a detailed description of reactive transport processes chen et al 2014a b kang et al 2003 kumar et al 2011 li et al 2008a b van noorden 2009 these models simulated coupled processes in the context of carbonate dissolution for fixed geometry li et al 2008 and relatively simple chemical system or evolving geometry chen et al 2014a b kang et al 2003 kumar et al 2011 li et al 2008b van noorden 2009 recently gray et al 2018 investigated a single channel drilled through solid calcite and a pristine ketton oolite core plug they observed that the cylindrical pore evolves into a nonlinear half hyperboloid shape however they did not investigate the flow and reactive transport regimes under which the nonlinear pore shape developed and the influence of different transport and reaction parameters on the developed pore shape here we combine microscopic experiments with numerical simulations at the single pore scale to investigate the impact of acidic solution injection on pore shape evolution in calcite we have used the stokes equation for fluid flow coupled with solute advection diffusion equations and multicomponent chemical reactions the evolution of the explicitly defined calcite solid fluid interface is simulated using arbitrary lagrangian eulerian ale method the developed model is validated by microfluidic experiments conducted in single pores drilled through optical grade calcite crystals confocal laser microscope was used to track the pore shape evolution furthermore the chemical composition of the effluent solution was measured to validate the overall calcite dissolution rate depending on flow regime our results showed an initial intense pore shape change while the concentration gradients turn into a quasi steady state once quasi steady state was attained the continued dissolution lead to an additional pore widening with limited change of pore shape over time which deviates from the original cylinder shape only for long periods of injection we have quantitatively evaluated the impact of our results on assumptions relating conductance evolution for pnm models that assume a linear pore opening the goals of this paper are as follows i to validate the numerically simulated pore shapes against the microfluidic lab experiments ii to perform a systematic study of different flow transport and reaction conditions in order to identify the regimes for which the currently used pnms are providing reliable results and the regimes for which the usage of pnms assuming constant cylindrical pore shapes can lead to significant errors iii to calculate the pore conductance through the direct simulation algorithm presented here as well as using state of the art approaches used by pnms and compare the two methods 2 materials and methods 2 1 single pore simulations to simulate pore evolutions fluid flow and multi complement transport processes were solved fully coupled with moving boundaries due to dissolution reactions si section s1 a finite element method was used comsol multiphysics and a backward euler time stepping method was implemented for time discretization 2 1 1 fluid flow and transport in this study we have considered slow fluid velocity only i e reynolds number re 1 therefore the inertial terms can be neglected in the momentum equations and the stokes equation may be used to compute the velocity field and the pressure in the single pore 1 ρ u t p μ δ u 2 u 0 where p is pressure ρ is the fluid density and μ is the fluid viscosity the density and dynamic viscosity of water were 998 25 kg m 3 and 8 96 10 4 pa s respectively the concentration of the dissolved species is assumed to be low enough so that the fluid density and the viscosity changes are negligible at the inlet a constant mass flux condition is imposed and a constant pressure of 1 0 bar is applied at the outlet at the lateral boundaries of the pore no slip boundary conditions are imposed the normal velocity at the lateral pore boundaries is continuous i e the normal fluid velocity at the interface is equal to the normal velocity with which the solid wall moves due to the solid surface dissolution initialy i e at time zero it is assumed that the pore with calcite walls is in equilibrium with the steady state flow the simulation starts by dropping the ph of the injecting fluid via the inlet of the pore which initiates the dissolution process leading to pore geometry evolution during the simulation the velocity field is updated to account for the pore geometry changes to simulate the transport of each dissolved species advection diffusion reaction equation is implemented 3 c i t d i c i u c i r i where di ci and ri are diffusion coeffcient m2 s 1 concentration mol m 3 and reaction input of species ith mol m 3 s 1 respectively at the pore inlet we implemented a flux based boundary condition starchenko et al 2016 this flux depends upon the fluid velocity and the concentration values specified 4 n d i c i u c i u n c o i where coi is the inlet injected concentration of species ith and un is the normal velocity at the inlet the concentration for each aqueous species is given in table 1 the outlet boundary is exposed to zero gradient condition for all species to conserve the mass across the solid fluid interface the total diffusive plus convective flux for species involved in the surface reactions i e ca2 and co3 2 equals the reactive flux at the interface this reads 5 n d i c i u c i r c a l c i t e where rcalcite mol m 2 s1 is the surface reaction rate as discussed in si section s1 1 2 1 2 geochemical model the injected solution into the carbonate rock reservoirs contains dissolved co2 this leads to the formation of the weak carbonic acid and its dissociation to establish new equilibria with hco3 and co3 2 species the reactions involving the dissolution of co2 in the water are much faster than any other fluid mineral reactions rochelle et al 2004 as long as the ph 9 wolthers et al 2008 zeebe and wolf gladrow 2001 which is the situation for this study therefore we can safely assume that solution phase reactions are of equilibrium type si section s1 1 calcite dissolution occurs at the fluid solid interface which is represented by the lateral boundaries of the pore the dissolution rate laws applied at these boundaries are based on the study by busenberg and plummer 1986 si sections s1 1 and s3 1 under acidic conditions the overall dissolution rate strongly depends upon the activity of h which becomes ph independent when values of ph are above 7 to calculate the activity coefficient of charged species the davies equation was applied 2 1 3 pore shape evolution model calcite dissolution results in a moving fluid solid interface problem for such problems the arbitrary lagrangian eulerian ale method is considered to be very precise as the solid fluid boundary can be exactly tracked kumar et al 2011 soulaine et al 2017 van noorden 2009 see kumar et al 2013 for more details on the ale method in the context of reactive transport related problems a displacement rate normal to the pore surface is assigned to the reactive walls which depend on the amount of the dissolved calcite and thus on the reaction rate of calcite dissolution we should note that in the free boundary problem considered here the displacement rate of the pore wall i e the solid fluid interface is not a predefined constant value or function instead it is calculated at each time step and for each point along the pore length si section s1 2 this makes the dissolution rate a dynamic nonlinear parameter which depends on the solution composition 2 1 4 physical chemical parameters the initial cylindrical pore geometry is representing a single pore located in a carbonate rock sample for model validation the dimension of the pore was set using the size of the capillary tube used in experiments being length l 2 10 3 m and radius r 2 5 10 4 m for models used for analysis the dimension of the pore was set equal to the naturally occurring pore sizes i e l 5 10 4 m and r 4 10 5 m the pore is initially filled with calcite saturated water the equilibrium concentration of species corresponding to this condition is listed in table 1 unless specified otherwise the diffusion coefficients for all species were assumed identical with a value of 3 36 10 9 m2 s 1 which is the average of the self diffusion coefficient of species present in the reactive system as listed in table 1 hereafter this model is referred as model i we performed several simulations by applying different flow velocities to cover a range of transport regimes from diffusion dominated to advection dominated conditions moreover by changing the chemical composition of the injecting solution we aimed to explore the impact of different reaction regimes for the model validation two flow rates corresponding to the microfluidic experiments were implemented which were equal to 8 3 10 11 and 8 3 10 10 m3 s 1 resulting in an average velocity of 4 10 4 and 4 10 3 m s 1 respectively for the further analysis of the single pore system five flow rates were imposed in our model including 2 10 10 2 10 11 2 10 12 2 10 13 2 10 14 m3 s 1 this resulted in average velocity values of 4 10 2 4 10 3 4 10 4 4 10 5 and 4 10 6 m s 1 the injected solution is in equilibrium with a certain pco2 value pressure of co2 gas the concentration of all species with the target pco2 values were obtained using phreeqc parkhurst and appelo 2013 with the phreeqc dat database in this study pco2 values of 100 0 10 0 and 1 0 bar were chosen to represent different reaction regimes the corresponding values of the species concentrations in these solutions are listed in table 1 to implement the experimental conditions as accurately as possible in the comsol model the injecting solution composition was matched to the ph 2 using hcl acid in place of pco2 the details of this solution are given in table 1 2 1 5 parametrization of the flow and reaction regimes in order to analyze the relative strength of advection diffusion and reaction we use dimensionless péclet number and damkhöler number the péclet number pe compares the characteristic times of diffusion and advection transport processes as 6 p e v r d where v is the average velocity at the inlet boundary and r is the radius of the channel at the inlet due to the dissolution the radius at the inlet changes and this leads also to the change of the inlet velocity both effects indicate that pe and da change with time the damkhöler number da measures the solution reactivity compared to the advection rate as 7 d a t a t r 8 t a r v 9 t r c c a l c i t e s r ta and tr are the advection time scale and reaction time scale respectively sr is the surface reaction rate noted at the end of the first stage from the inlet pore wall mol m 2 s 1 and ccalcite is the density of surface sites of calcite at the start of dissolution mol m 2 this is calculated from the surface site density data i e 4 9 calcite molecules per nm2 based on crystallographic data for the dominant cleavage plane of calcite e g wolthers et al 2008 and avogadro number 6 023 1023 providing ccalcite as 0 8 10 5 mol m 2 as pe and da numbers change over time we examine the results with respect to the initial pe and da numbers calculated at the inlet boundary of the pore table 2 provides the da and pe numbers corresponding to the numerical simulations model i where simulations 1 and 2 were used for the model validation and simulations 3 11 were used for the pore shape analysis 2 2 microfluidic experiments to directly observe pore evolution and to validate our numerical model microfluidic experiments were conducted using a channel of radius 2 5 10 4 m and length 2 10 3 m drilled in optical grade calcite crystal iceland spar a laser fluorescence confocal microscopy nikon a1r confocal was used to image the extent of dissolution and the pore shape change for the fluorescent dye fluorescein sodium salt lot no bcbm7214v sigma aldrich emission wavelength 515 nm was used the injection solutions were prepared using deionized water equilibrated with atmospheric co2 and adjusted to desired ph value of 2 with 1 m stock solution of hcl acid to ensure the sufficiently constant ionic activity of solutions 0 2 m equivalent nacl salt lot no k48328204648 was added at the start of each experiment caco3 saturated water is injected in the channel to attain the approximate carbonate reservoir initial conditions the solutions were injected with the use of a syringe pump 11 pico plus elite harvard apparatus and a 5 ml gastight syringe hamilton 1700 series at the desired flow rates effluent measurements were done to obtain changes in ph and ca2 concentration due to the dissolution of the calcite orion micro ph electrode was used for the ph measurement of the effluent solution inductively coupled plasma optical emission spectrometer icp oes spectro arcos with a cross flow nebulizer was used for the ca2 concentration measurement the collected outflow samples for the period 0 t were diluted with 2 hno3 solution to attain the minimum required sample volume of 6 ml for icp oes measurements measured ca2 concentration from the outflow solution is compared to the flux weighted averaged concentration of ca2 at the pore outlet of the numerical model calculated as 10 c c a o u t 0 r t c c a r u r r d r 0 r t u r r d r here c c a r and u r are the ca2 concentration and velocity at the radial distance of r respectively r t stands for the outlet radius of the pore at time t t radial symmetry of the solution is assumed thus no integration with respect to the angle φ in the cylindrical coordinates is needed displacement of the calcite surface was quantified with reference to the position of the inert glass section attached to the inlet face of the channel additional details of material and methods are provided in si section s2 the experiments were conducted at two flow rates with one order of magnitude difference i e 5 µl min 1 and 50 µl min 1 to inject the solution with a ph value of 2 these flow rates yielded average velocities of 4 2 10 4 m s 1 and 4 2 10 3 m s 1 respectively 3 results and discussion 3 1 validation of the numerical model outcome with experiment results fig 1 shows the ca2 concentration and the ph at the outflow obtained by measurements and using the numerical simulations the agreement between modeling and measured data was good for ca outflow concentrations and reasonably well for ph under both flow rates the simulation results for pore shape evolutions also showed a good agreement with the experimentally observed pore shape under both flow regimes fig 2 under high flow rates the channel evolved almost uniformly with only minor curvatures of the pore wall near to the inlet and almost retained the original cylindrical pore shape fig 2a and c under low flow rate conditions the channel evolved to a non uniform half hyperboloid shape with a strong curvature developing close to the pore inlet fig 2b and d in the high flow rate experiment average pore wall displacement was calculated using the average of the top pore wall displacement and the bottom pore wall displacement we found a similar value for the experiment equal to 51 µm shown in fig 2a and simulations equal to 61 µm shown in fig 2c after injecting the same number of pore volumes in contrast under low flow rate the magnitude of experimentally observed average pore wall displacement with a value of 179 µm was overestimated by the model which provide a value of 252 µm fig 2b and d for high flow rate both effluent measurement and microscope image based results are within the experimental error with the model utilizing a single diffusion coefficient for all aqueous species also the agreement between the amount of dissolved calcite from the microscopic and the simulated image of the channel fig 2 indicates that the reactive transport model appropriately captures the dissolution rate i e the pore evolution in the low flow rate experiment the disagreement between the obtained calcite surface displacement value using modeling and experiments is within the range of the uncertainty of the input parameters i e reaction rate constants and the choice of diffusion model details are provided in si sections s3 1 and s3 2 we observed that the system remains far from the equilibrium for the whole duration of the experiment fig s5 which supports the capability of the implemented rate model to capture the dissolution process throughout the experiment period we also found that changing the diffusion coefficients or using species specific diffusion coefficients would not improve the results therefore as pore shape evolution under varying fluid velocity and composition is captured well by using a single diffusion coefficient model we have applied model i for further analysis 3 2 initial stages of pore shape development the pore fluid is initially at equilibrium with calcite proving a ph value of 9 9 injection of an acidic solution with a ph value of 3 9 and pco2 value of 1 0 bar shifts the equilibrium conditions of the pore fluid differently under different flow regimes the injection initiates calcite dissolution through a set of bulk reactions as well as surface reaction the surface reaction products i e ca2 and co3 2 accumulate within the boundary layer near the pore wall from where they move away towards the bulk fluid the amount of reaction products strongly depends on the difference between ph of the injected solution and that of the initial pore fluid we observe a front propagation behavior along the pore at the initial stage of the reaction in the advection dominated flow regime pe 1 the ca2 rich zone that is initially near the pore wall at the pore inlet fig 3 a plot a is predominantly transported downstream along the pore wall fig 3a plots b and c before reaching the central part of the pore as such the longitudinal gradient smoothens faster than the transversal i e cross sectional gradient yielding concentration profiles with a prominent transversal gradient fig 3a plot d whereas in diffusion dominated flow regime pe 1 the ca2 plume is shorter and more intensive i e with a higher concentration of the reaction products fig 3b plot a the reason is that at pe 0 47 the flow velocity is slower and more time is available to wash out the dissolution products a stronger diffusive flux drives the transversal mixing as well resulting in a concentration profile with a less prominent transversal gradient compared to the longitudinal gradient fig 3b plots b d although the low and high flow rate conditions lead to distinct concentration gradients in both cases during the injection we observe two stages in the development of the concentration gradients in the first stage the concentration field changes significantly leading to the establishment of a flow regime specific concentration field whereas in the second stage referred to here as the quasi steady stage these changes become minute and the concentration gradients change only slowly the quasi steady state concentration gradient govern the dissolution and thus the pore wall evolution during the time in the case when the concentration gradient along the wall is almost zero the pore just expands in the normal direction without significant change of shape in the case when there is a positive concentration gradient along the pore wall the pore widens faster near the inlet compared to the outlet to quantify the pore shape evolution during these stages and to explicitly mark the duration of the first stage the relative displacement rate of the pore wall was calculated as the ratio of the displacement rate of the pore inlet to the pore outlet at any time the value of the relative displacement rate indicates how faster the pore inlet is displaced compared to the pore outlet for example for pe number 0 47 initially inlet displacement rate is 8 5 times faster than the outlet displacement rate fig 4 b during the first stage the displacement rate of the pore outlet decreases constantly and at the end of this stage the relative displacement rate reaches an asymptotic value of 2 3 fig 4b contrastingly in the first stage for pe number 47 4 this rate attains an almost constant value of 1 27 fig 4a such evolution of the relative displacement rate of the pore wall results into a rigorous modification of the pore wall shape the continuous change in the relative displacement rate is related to the shape of the pore at that time shown in figs s7 and s8 for the example case of pe number 47 4 and 0 47 respectively in conclusion during the first stage the concentration field modifies intensively resulting into the intensive evolution of the pore geometry and the end of this stage is marked by a nearly established concentration gradients along the pore wall providing a basis to find a predictive rate for the pore shape evolution while the pore shape evolves during the first stage the pressure gradient remains constant less than 0 1 see si section s3 3 this is due to the fact that the magnitude of the pore wall displacement in the short duration of the first stage is negligible compared to the overall aperture of the pore therefore in the context of the simulated dissolution regimes and the pore dimensions the geometry changes during the first stage of the dissolution can be neglected which is in agreement with the theoretical evaluation of reactive transport regimes algive et al 2010 3 3 evolution of the pore shapes under extended injection times although during the first stage the overall pore size would not increase considerably the developed half hyperboloid pore shapes indicate the dissolution pattern the persisting longitudinal gradients in this stage imply that the pore inlet has a higher dissolution rate compared to the pore outlet the overall pore opening takes place during the second stage to explain the pore evolution we choose the simulation corresponding to the pe number of 0 47 and da number of 2 13 as concentration gradients are established along the pore after the first stage and considering that the reaction rate depends on the concentration gradients dissolution of the interface at the inlet and at the outlet will take place at different speeds however with a predictive manner fig 5 a remarkable observation was that for about 2 000 000 s nearly 23 days the reaction rate showed larger values at the inlet compared to the outlet as a result during this period the pore widened faster at the inlet compared to the outlet deviating to a greater extent from the initial cylindrical shape initially the calcite near the inlet dissolves about twice faster than close to the outlet see also fig 4b while at time scales well beyond 23 days we observe lower however similar dissolution rates at both inlet and the outlet faces fig 5 fig 6 shows relative displacement rates modifying the pore shape during the second stage the continued opening of the half hyperboloid shape will eventually result in the development of a non linear pressure profile fig 6 shows the shape of the pore at two different times at the time of 1000s when the inlet radius has increased with about 1 5 40 6 vs 40 and the outlet radius has increased 0 67 40 3 vs 40 the pressure along the pore remains linear meaning that at each point along the pore we have a constant pressure gradient recall that the constant pressure gradient along a pore is an essential assumption in pore network algorithms however at t 30 000 s the pore shape develops so that the inlet radius has increased by 44 and the outlet radius by 18 resulting in a non linear pressure profile along the pore in contrast for pe 47 the relative displacement rate at the end of the first stage is close to one and the initially cylindrical pore remains nearly cylindrical throughout the second stage and the pressure profile stays linear fig s10 3 4 flow rate effects on the pore shape evolution to further explore the flow rate effects we have performed several simulations by varying the pe number while the ph of the inflowing solution was kept constant at a value of 3 9 at pe 1 the reaction products effectively diffuse into the pore bulk fluid region before any substantial longitudinal transport takes place fig 3b near the inlet strong diffusion of the reaction products toward the central parts of the pore facilitates calcite dissolution at the same time along the pore the saturation index of the pore fluid with respect to calcite increases towards equilibrium due to the buffering by the dissolution products and dissolution rates decrease along the flow path consequently dissolution reactions take place mainly close to the pore inlet resulting in non uniform pore widening and formation of a half hyperboloid shaped pore figs 2b and 7 a for pe 1 the transport is dominated by advection under this regime the fast entering solution into the channel replaces the resident solution before the diffusion of the reaction products smoothens transversal gradients and buffers the ph of the solution therefore the calcite pore wall is exposed to a reactive solution along the entire pore resulting in an even dissolution rate and a nearly uniform evolution of the pore shape figs 2a and 7b note that at both flow rates flow velocity increases towards the outlet face of the pore which reflects the constricted shape of the pore fig 7 besides a difference in the shape evolution i e a localized difference in calcite dissolution rate there is also a clear difference in the total amount of dissolved calcite per injected pore volume the simulation under low flow rate resulted in a higher value of calcite surface displacement per pore volume injected compared to the simulation under a fast flow rate this is because the solution residence time is larger for the low flow rate simulation and therefore reactants dissolve more calcite however when using time rather than injected pore volume the low flow rate dissolves less calcite compare to a high flow rate over time the evolution of the pore shape corresponding to all of the simulated flow rates is discussed in section s3 4 3 5 chemistry effects on the pore shape evolution in addition to the flow rate the chemistry of the injecting fluid affects the pore shape to explore chemistry effects further we performed simulations with two injecting solutions at ph values of 3 1 and 3 9 corresponding to pco2 of 100 0 bar and 1 0 bar respectively evolution of the pore shape depends on the reactivity of the pore wall towards the injecting solution expectedly the ph 3 1 solution results in the stronger displacement of the pore wall than the ph 3 9 solution this results in increased concentrations of the reaction products near the pore wall driving the local solution chemistry towards equilibrium with respect to calcite this buffering of fluid is also reflected by a change of the fluid ph in the case of the ph 3 1 inflow solution at pe 4 74 the transversal average ph increases from 4 71 to 4 82 corresponding to the dissolution rate from 1 70 10 4 mol m2 s 1 to 0 49 10 4 mol m2 s 1 from inlet to outlet boundaries respectively the result of this alteration in the pore fluid chemistry is ultimately reflected by the evolved pore shape in this case the pore widens non uniformly along the pore length fig s12a however injecting a ph 3 9 solution at pe 4 74 provides a transversal average ph that changes from 4 09 to 5 10 and dissolution rate from 2 12 10 5 mol m2 s 1 to 1 72 10 5 mol m2 s 1 from the inlet to outlet boundaries respectively in this case fluid buffering during dissolution is relatively weaker and a more uniform pore shape develops fig s12b to cover a range of values for damkhöler numbers i e reaction regimes we have chosen a combination of flow rates and injecting fluid chemistries fig 8 table 2 provides details of these simulations by increasing da number the reaction time scale decreases compared to the advection time scale and the system approaches being transport limited instead of surface rate limited the normalized displacement profiles after injecting 1590 pore volumes provided in fig 8 show that there is a monotonic relation between pore shape and da under the considered reaction regimes for da 1 and pe 47 4 reaction time scale is higher than the advection time scale and at the same time advection dominates the diffusion in such advection dominated transport regimes the chemistry of the injecting fluid has less control on pore shape evolution and adjusting inflow ph from 3 4 to 3 9 has a negligible impact over the pore shape fig 8a da numbers 0 03 and 0 21 whereas in the da 1 and pe 0 47 regime which is overall reaction dominated while transport is diffusion dominated the same shift of inlet ph causes a profound change in pore shape fig 8a da number 2 13 and 14 95 the dissolution regime corresponding to da 1 and da 1 can also be obtained by changing the ph of the injecting fluid if the ph 3 9 solution is injected i e da 1 the impact of changing flow rate is less prominent over the pore shape and the pore shape remains nearly uniform fig 8b da 0 03 pe 47 4 versus da 0 29 pe 4 74 for a regime of da 1 using a reactive fluid with ph 3 1 a shift of pe number causes a significant change of the pore shape fig 8b da number 0 96 and 9 1 in reaction limited dissolution regimes da 1 control of flow rate and reactive strength of the injecting fluid becomes marginal over the shape of the pore the reason is that the time necessary for dissolution reaction i e generating the reaction products and consuming protons may dominate rather than the fluid mixing scale when analyzing the fluid buffering state and in these regimes dissolution is spatially homogeneous leading to uniformly developed pore shapes whereas in transport limited dissolution regimes da 1 fluid mixing strength exerts control over the chemical gradient inside pore space this leads to heterogeneous dissolution process in which both flow rate and chemistry of the injecting fluid govern the pore shape to summarize we can conclude that both injection parameters such as flow rate and fluid chemistry impart control over the pore shape fig 9 provides a spectrum of pore shapes based on changes in transport and reaction regimes shown by pe and da numbers the marking of the regimes in this study aligns well with the previously reported pore scale work specific to the calcite dissolution for e g soulaine et al 2017 they have also observed the boundary between the uniform and non uniform type of dissolution at da number 1 in the subsequent section we compare the conductance of a single pore after long injection period calculated here with using fully coupled pore scale model utilizing ale method and the approximate calculation of the conductance discussed in pore network algorithms and investigate the related error depending on the dimensionless process parameters pe and da 3 6 implication of the pore shapes on the pore conductance evolution of conductance in dissolution simulations is implemented in existing pore network algorithms e g raoof et al 2012 mehmani et al 2012 raoof et al 2013 and nogues et al 2013 a significant underlying assumption in this implementation is that the shape of the pore remains uniform where the evolved pore shape still results in a linear pressure drop along the pore the results presented here show that this assumption is valid under the advection dominated flow regimes with pe 1 and transport dominated reaction regimes with da 1 however as we observed in the case of the pe 0 47 the changes of the shape start to influence the pressure profile in a time scale of 30 000 s which is within the time scale of injection period in a reservoir the pressure profile along a pore is directly related to the conductance calculated in pnm taking the commonly assumed laminar flow when the pore changes are uniform along its length the pressure drops linearly fig s10 this is not the case when the pore shape deviates from the cylindrical one in such a case the pressure gradient is not constant and changes along the pore fig 6 such pressure nonlinearity affects the pore conductance and therefore the rock permeability hence we need to quantify the impact of such modified shapes on the conductance of the pore the definition of conductance k is given via the flow rate q m3 s 1 and the pressure drop δp n m 2 along the pore as 11 q k δ p for a rounded cylindrical pore with a constant diameter along the pore with a parabolic velocity profile i e hagen poiseuille flow the conductance k m5 n 1 s 1 is known and it is given by 12 k π 2 r 4 128 μ l here l is the length of the pore called also pore throat length in the pnm literature given in meters m r is the radius of the pore m in dissolution experiments as the radius r r t and eventually the shape of the pore changes the pore conductance is no longer constant k k t we calculated the apparent pore conductance i e overall conductance of the pore using eq 11 for fig 10 the conductance and pore volume is normalized with respect to the initial pore conductance and the initial pore volume respectively the half hyperboloid pore shape leads to a changing pressure gradient along the pore fig 10a black line the narrowness of the pore aperture towards the outlet provides small contributions to the overall volume changes of the pore however this section of the pore controls the overall conductance of the pore consequently pore volume increases considerably near the pore inlet while pore conductance changes marginally during hyperboloid pore shape formation fig 10a black line this means that as non uniformity of the pore shape increases the change of conductance becomes smaller for the same amount of volume change fig 10 therefore at the pore scale the change of the pore conductance in time in certain cases cannot be described just as a function of the pore volume the pore shape may play a significant role the implication of this observation for macroscale simulations is that formulae which provide permeability only as a function of porosity are not always suitable and they are accurate only over a certain flow and reactive transport regime for which they have been developed in most of the existing pore network models the conductance of the pore throat is updated at each time step in response to the changing volume of the pore only without accounting for the pore shape evolution and such a conductance is obtained by utilizing either the volume of the connecting pore bodies nogues et al 2013 or the volume of the pore throat raoof et al 2012 we calculated the conductance of the simulated pore geometry in a similar method as used by raoof et al 2012 at each time step the volume of the pore provides the uniform radius of the pore which is further utilized in calculating the conductance fig 11 shows the comparison of this conductance with the one calculated from the actual geometry of the pore for two of the dissolution regimes we observe that if the dissolution process maintains the cylindrical shape of the pore then the conductance is only a function of the volume of the pore as assumed in pnms fig 11b whereas for the dissolution regime corresponding to pe 1 and da 1 the conductance of the pore does not remain a function only of the volume of the pore but it depends also on the shape of the pore in the latter case ignoring the dependence of the conductance from the pore shape results in an error the conductance calculated from the volume of the pore pnm approach overestimates by 38 the conductance calculated from the actual hyperboloid pore shape when the volume of the dissolved calcite is equal to the original volume of the pore this overestimation is 76 when the volume of the dissolved calcite is equal to two times the original volume of the pore and may increase further with dissolution fig 11a note that the pore conductance evolution during the dissolution process depends not only on the flow and reaction regimes as shown here fig 10 but also on the length of the pore on the initial radius of the pore on the equilibrium ph and on the ph of the injected fluid for the ph radius and length of the pore investigated here fig 12 summarizes the regimes in which the conductance can be calculated as in pnm only by the volume of the pore vs the regimes where this method fails to capture the correct conductance this figure presents a moment during the dissolution process at which the change in the pore volume is 100 i e v v0 2 for the reaction controlled regimes da 1 irrespective of the flow rate the volume based conductance is within 1 range of the actual conductance this difference increases significantly for the transport controlled regimes where the diffusion dominated flow regimes yielding up to 76 of the difference note that the difference increases further with dissolving larger volume of the calcite this result illustrates the limitation of the existing assumption in the pore network model however the work for deriving a more defined relationship for conductance remains a topic for future work although the presented insights about the pore scale processes are based on a detailed geochemical model which includes both equilibrium and kinetic processes along with the multi component solution system it would be interesting future work to investigate the limitation of a simplified geochemical model against the current detailed model also in this study we have presented two sets of microfluid experiments with an objective of validating the modeled pore shapes however utilizing such calcite micromodel setups to investigate the calcite dissolution processes under a wider range of transport and reaction regimes and in different pore geometries remains future work 4 conclusions 1 the simulation results of reactive transport processes through single calcite pore and the results from the respective microfluidic experiments were found to be in good agreement at both investigated flow rates the validated computational algorithm was used to perform a thorough and detailed study of the dissolution processes for a range of hydrochemical parameters 2 it was observed that the calcite dissolution process can be divided into two stages with respect to the concentration field development and pore shape evolution during the first very short in the order of seconds and intrinsically transient stage the reactive transport processes rapidly change the concentration field inside the pore and at the end of this stage the pore has attained a characteristic shape and concentration gradient only the latter plays a critical role in the longer term dissolution process these numerical results are a justification of the statements of other authors that the pore shape development during the first stage can be ignored while the concentration gradient should be accurately calculated the second stage is long days or longer and corresponds to real injection times in reservoirs at this stage the flow and transport are at a quasi steady state the pore shape changes slowly but for large concentration gradients significant deviation from the original cylindrical shape can be observed for certain dissolution regimes 3 generally lower flow rates result in significant concentration gradients in the longitudinal direction and thus in a non uniform change of the pore shape as a result the pressure gradient is no longer constant along the pore an increase in solution reactivity lowering in ph provides the same effect it drives reactions towards equilibrium over a shorter distance from the inlet and therefore results in non uniform pore shapes injecting fluid with a high flow rate or lower reactivity yields a more uniform pore volume increase we also observe that the impact of flow rate and fluid reactivity on the pore shape are more significant when dissolution is transport controlled da 1 4 for certain flow and reaction regimes a significant difference is observed between the pore conductance computed here and pore conductance computed according to pnm assuming constant pore shape further research is needed to understand if and how pnm can be used for dissolution regimes for which the basic pnm assumption leads to significant error in conductance evaluation supporting information available additional details on numerical model and experiment methods and figures 1 12 credit authorship contribution statement priyanka agrawal conceptualization methodology formal analysis visualization writing original draft writing review editing validation investigation amir raoof conceptualization methodology formal analysis visualization writing original draft writing review editing supervision oleg iliev conceptualization methodology formal analysis visualization writing original draft writing review editing supervision mariëtte wolthers conceptualization methodology formal analysis visualization writing original draft writing review editing supervision funding acquisition resources project administration declaration of competing interest there are no conflicts to declare acknowledgements the research work of p a and m w is part of the industrial partnership programme i32 computational sciences for energy research that is carried out under an agreement between shell and the netherlands organisation for scientific research nwo veni talent scheme awarded to a r with project number 016 151 047 which is partly financed by nwo support for this research of o i from the bundesministerium für bildung und forschung bmbf germany via project reskin 0310011c is highly appreciated part of the work was done during o i s stay in utrecht university as visiting professor of the darcy center of utrecht university and eindhoven university of technology supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 103480 appendix supplementary materials image application 1 
528,we investigate the influence of poroelasticity on solute transport processes during viscously unstable flows in a deformable aquifer we hypothesize that viscous fingering induced fluctuations in the flow field can increase the strength of coupling between poroelastic stresses and mixing and spreading characteristics of the solute slug to test the hypothesis we develop a coupled flow transport and geomechanics framework to simulate spreading mixing and deformation mechanisms during viscous fingering in a stress sensitive aquifer we show quantitatively that concentration dependent fluid mobility affects the pressure and effective stress fields and deformation driven changes in porosity affects advective and diffusive fluxes we perform a sensitivity analysis to evaluate the dependence of global transport characteristics the solute breakthrough time breakthrough curve and the degree of mixing on the strength of flow deformation coupling defined in terms of poroelastic moduli results are obtained for different magnitudes of the peclet number solute viscosity contrast biot coefficient rock bulk modulus fluid compressibility and permeability heterogeneity we find that in presence of less consolidated formations softer rocks or more compressible fluids the injected solute breaks through earlier and mixes with the resident fluid better our results provide important insights for modeling hydrodynamically unstable contaminant remediation and fluid injection processes in stress sensitive reservoirs keywords viscous fingering poroelasticity mixing geomechanics contaminant transport 1 introduction spreading and mixing of solutes n subsurface reservoirs has garnered significant interest especially in real time surveillance applications such as tracer analysis and waste disposal monitoring welty and gelhar 1991 kapoor and kitanidis 1998 le borgne et al 2010 jha et al 2013 nicolaides et al 2015 while spreading describes the spatial stretching and deformation of a solute slug driven by advective mechanisms mixing is the mechanism that increases the actual fluid volume occupied by the solute behind the spreading front kapoor and gelhar 1994 kapoor and kitanidis 1998 le borgne et al 2010 spreading usually intensifies the solute concentration contrast in the domain while mixing tends to smooth out the concentration gradient within the solute contaminated region le borgne et al 2013 jha et al 2011b these processes are also critical for enhanced oil recovery eor technologies such as chemical flooding and injection of co2 nitrogen methane and ethane gases waggoner et al 1992 chen and meiburg 1998 lake et al 2014 the injected fluid can be less viscous than the resident crude oil or brine to improve wellbore injectivity at lower injection pressures it can also be more viscous than the resident fluid to increase the sweep efficiency of the fluid fluid displacement process also the injected and resident fluids can mix and react within the reservoir which can change the physical properties of the mixture e g viscosity or density this can impact the fluid velocity field and lead to two way coupling between flow and transport welty and gelhar 1991 waggoner et al 1992 tan and homsy 1992 jha et al 2011a the displacement of a more viscous fluid by a less viscous fluid leads to the saffman taylor instability also known as viscous fingering koval 1963 homsy 1987 it is well known that fingering reduces the recovery efficiency of fluid fluid displacement processes such as waterflooding lake et al 2014 in case of groundwater contaminant treatment and transport viscous fingering leads to a rapid increase in the macrodispersivity welty and gelhar 1991 and affects contaminant breakthrough and removal nicolaides et al 2015 the length of the mixing region is shown to increase linearly with time and monotonically with the permeability variance in one study tan and homsy 1992 and in another study it is shown to increase linearly with the square root of time and behave non monotonically with the variance de wit and homsy 1997 in terms of the interaction between the permeability correlation length scale and the scale of fingering a resonance mechanism was proposed to explain the maximum growth of the mixing length at intermediate correlation values tan and homsy 1992 in summary the effect of fingering on solute mixing in heterogeneous rocks is still unclear often the reservoir of interest is geomechanically sensitive and deformable due to the presence of pre existing fractures unconsolidated formations excessive flow induced stresses or low compressibility fluids the last scenario can result from an increase in the water saturation associated with water injection or hydrocarbon production from an oil reservoir because water is usually less compressible than oil or gas zhao and jha 2019 the role of biot coefficient in groundwater pumping induced fissure formation has been hypothesized recently budhu 2011 the effect of consolidation on solute transport has been studied in the context of loosely packed landfill columns with incompressible grains where it is reported that compaction induced decrease in porosity and increase in the particle velocity lead to a faster breakthrough peters and smith 2002 alshawabkeh et al 2005 fox et al 2011 zhang et al 2012 compared to the case without compaction however we do not know how the breakthrough time varies for rocks at depth where the grains are tightly packed and cemented together and their compressibility cannot be ignored we hypothesize that the compaction induced breakthrough acceleration mechanism is weaker in rocks because the magnitude of compaction is smaller in rocks than in soils as a result of these observations there is a growing interest in integrating rock deformation with fluid flow processes in existing reservoir models to obtain a more realistic representation of the subsurface and to improve the agreement between model predictions and field observations several computational frameworks of coupled flow and geomechanics have been proposed for applications in hydrocarbon recovery groundwater extraction underground waste disposal and co2 storage lewis and sukirman 1993b gawin et al 1995 rutqvist et al 2013 white and borja 2007 ferronato et al 2010 jha and juanes 2014 castelletto et al 2015 effect of stress on permeability under the assumption of uncoupled pressure and stress fields has been studied recently using a pore scale model roded et al 2018 however most of these studies neglect the two way coupling mechanisms between transport and deformation i e deformation induced changes in the solute transport behavior and concentration dependent fluid mobility effects on deformation the effect of geomechanical coupling on various transport mechanisms such as spreading mixing and viscous fingering in stress sensitive reservoirs is unexplored tran et al 2018 a study on the effect of stress on contaminant transport in fractured crystalline rock showed that the residence time of contaminant is a strong function of the boundary stress ratio wang et al 2017 we focus on unraveling the transport deformation coupling mechanisms at reservoir conditions when the two way coupling between flow transport and deformation cannot be neglected in particular we focus on the mechanisms that affect mixing and spreading because these processes control the ultimate recovery during contaminant removal or enhanced oil recovery we present a numerical framework to model and analyze the effect of poroelasticity on tracer transport under viscous fingering instability we use the framework to evaluate the sensitivity of transport metrics to poromechanical properties including the biot coefficient and the bulk modulus 2 physical model we consider a 2d section of an aquifer bounded by a horizontal injection well and a horizontal production well fig 1 the reservoir is fully saturated and under hydromechanical equilibrium with external stresses σh and σh which are the minimum and maximum principal horizontal compressions from regional tectonics the injection well injects two fluids of different viscosities alternatingly in the form of slugs the fluids are perfectly miscible with each other and with the resident fluid one of the fluids has the same viscosity as the resident fluid and the other fluid is less viscous due to the presence of a chemical tracer the production well is open to flow at a fixed bottom hole pressure that is set lower than the reservoir pressure as the less viscous slug moves through the reservoir and displaces the more viscous resident fluid viscous fingering ensues at the leading front of the less viscous slug this affects the spreading and mixing of the slug as well as the recovery of the resident fluid from the producer since the reservoir pressure is coupled to both slug transport and the state of stress we can use this model to probe the coupling between transport and deformation processes and extract possible physical mechanisms arising from such coupling we make the following assumptions which are appropriate for the physical problem at hand 1 slightly compressible fluid 2 small strain 3 quasi static equilibrium 4 linear elasticity 5 single phase flow 6 isotropic material behavior 7 permeability not dependent on deformation 8 isothermal system no temperature change and 9 first contact miscibility between the fluids 3 mathematical model the starting point is to state the governing equations of flow deformation and transport in the strong form which will be converted into the respective weak forms and discretized later we adopt a continuum representation of a macroscopic model of porous media where fluid and solid are viewed as overlapping continua bai and elsworth 2000 coussy 2004 the model domain has an area ω l x l y where lx and ly are the dimensions in the x and y directions we denote the closed boundary of the domain by γ the initial porosity is ϕ 0 and the permeability k is assumed to be isotropic and constant in time the domain is saturated with a fluid of density ρ f 0 subscript 0 indicates initial condition the mass conservation equation for single phase slightly compressible flow under small deformation gradients with no sources or sinks in the domain is 1 1 m p t α ϵ v t v 0 where p is the pore fluid pressure t is time 1 m ϕ 0 c f α ϕ 0 k s is the inverse biot modulus α 1 k k s is the biot coefficient indicating the degree of cementation between grains k is the drained bulk modulus of rock ks is the bulk modulus of solid grains cf 1 ρf dρf dp is the fluid compressibility ρf is the fluid density v is the darcy fluid velocity vector relative to the solid skeleton and ϵ v is the volumetric strain the volumetric strain rate term in the equation above couples fluid flow to mechanical deformation and acts as a local source term denoting the solid skeleton displacement vector with u and the skeleton velocity with v s u t and noting that ϵ v u we obtain 2 1 m p t v α v s 0 the fluid momentum balance equation or darcy s law is 3 v k μ c ρ f g p where μ c is the concentration dependent fluid viscosity and g is the gravitational vector we use a gaussian random field model with the following parameters to model permeability heterogeneity geometric mean permeability kg dimensionless log permeability variance σ logk 2 and permeability correlation lengths ξx and ξy an example is shown in fig 2 the quasi static linear momentum balance equations for a fluid saturated rock is 4 σ ρ g 0 where σ σ α p i d is the cauchy total stress tensor σ is the effective stress tensor id is the identity tensor ρ ϕ ρ f 1 ϕ ρ s is the bulk density and ρs is the solid grain density here ϕ is the eulerian or true porosity in the current configuration a sign convention where the normal stresses are positive in tension is used the total volumetric stress σ v trace σ n d and the effective volumetric stress σ v are related by σ v σ v α p where nd is the number of space dimensions n d 2 in 2d σ v and p are also related by the compatibility relation 2 σ v α 2 p the isotropic part of the deformation ϵ v volumetric expansion or contraction is controlled by σ v and the deviatoric part rock failure and plastic yielding is controlled by the von mises stress σ v m 3 j 2 where j 2 is the second invariant of the deviatoric stress σ σ v i d substituting the effective stress into eq 4 we obtain 5 σ α p ρ g 0 assuming a linear elastic behavior of the rock σ d ϵ where ϵ u u t 2 is the small strain tensor defined as the symmetric gradient of the displacement vector the 2d domain represents a thin layer of rock thus a state of plane stress is assumed in the compact engineering notation σ σ x x σ y y σ x y t ϵ ϵ x x ϵ y y 2 ϵ x y t and i d 1 1 0 t are the stress strain and identity vectors in the plane stress configuration the isotropic drained elasticity tensor d can be written as 6 d e 1 ν 2 1 ν 0 ν 1 0 0 0 1 ν 2 where drained young s modulus e and poisson s ratio ν are the two parameters of the isotropic elastic material model in 2d σ v k ϵ v with k e 3 1 2 ν the fluid mass conservation and the mechanical equilibrium equations are coupled through biot s poroelasticity equation which relates the fluid mass increment per unit initial bulk volume δ m δ ρ f ϕ 1 ϵ v to strain and pressure as δ m ρ f 0 α δ ϵ v δ p m we can obtain the equation for porosity evolution from the solid mass conservation equation lewis and schrefler 1998 and partitioning of the total stress on porous skeleton between the stress acting on the solid grains and the pressure of the pore fluid coussy 2004 jha and juanes 2014 7 d ϕ d t ϕ t ϕ v s α ϕ ϵ v t α ϕ k s p t which can be integrated in time and approximated under infinitesimal strain as 8 δ ϕ α ϕ δ ϵ v 1 α δ p k there are several interesting limiting cases of eq 1 the first case is that of almost incompressible solid and fluid i e cf 0 ks m to maintain finite values of the pressure this results into an instantaneous and local equilibration of pressure such that δ m ρ f 0 α δ ϵ v or δ ϕ α δ ϵ v this implies 9 v α v s 0 v α ϵ v t ϕ t this is relevant to model flow in shallow aquifers or underneath dams away from wells where flow is driven by the volumetric expansion or contraction of the pores the second case is that of flow through low porosity consolidated rocks i e ϕ 1 k ks α 0 which results into the traditional flow equation uncoupled to mechanical deformation 10 ϕ 0 c f c r p t v 0 where cr is the rock compressibility aziz and settari 1979 this approximation is also valid in highly stiff rock k ks saturated with highly compressible fluid large cf such as gas this case is relevant for modeling flow in conventional strongly consolidated petroleum reservoirs the third case is undrained deformation low permeability i e δm 0 k 0 i e v 0 such that 11 1 m p t α ϵ v t 0 δ p u α m δ ϵ v b δ σ v where b α m k u is the skempton s coefficient k u k α 2 m is the undrained bulk modulus and δpu is the undrained pressure change this case is relevant for monitoring sudden stress changes due to production and pressure changes during hydraulic fracturing daneshy 2015 kampfer and dawson 2016 roussel and agrawal 2017 in nanodarcy rocks such as shales which are considered unconventional petroleum resources the fourth case is drained deformation i e δp 0 which is the same as the first case in terms of the resulting equations the advection dispersion equation ade for tracer or solute transport is 12 ϕ c t v c ϕ d d c 0 here c is the normalized local concentration of tracer and dd is the hydrodynamic dispersion coefficient assumed to be a constant we assume that velocity dependent dispersion is less important for the rectilinear injection case considered here compared to the radial injection case chen and meiburg 1998 nicolaides et al 2015 where the average velocities decrease rapidly with the distance from injection source re arranging the terms to extract the effect of geomechanical coupling on transport 13 ϕ c t v c ϕ d d 2 c d d ϕ c c ϕ t the left hand side is the residual of the traditional ade uncoupled to geomechanics and the right hand side is the mechanics to transport coupling term composed of source sink due to variations in porosity which can be calculated using eq 8 we use an exponential model for the concentration dependent viscosity of the mixture 14 μ c μ 1 e r 1 c where r log e μ 0 μ 1 is the log viscosity ratio of the resident fluid viscosity μ 0 and the injected fluid viscosity μ 1 when 0 c 1 depending on the value of r the viscosity of the mixture is higher than the viscosity of injected tracer this promotes viscous fingering at the front between the tracer and resident fluids when the former displaces the latter the mathematical model requires boundary and initial conditions for well posedness for the rectangular domain considered in fig 1 the normal displacement is zero on the bottom and right boundaries compressions are applied on the left and top boundaries and normal fluid flux is zero on the left and right boundaries the producer is controlled by a prescribed bottom hole pressure p out and the injector is controlled by an injection rate q in per unit length in the third dimension prescribed at the bottom boundary the flow rate at the producing boundary q out can be calculated from p out and the flow area length lx natural outflux boundary condition is imposed on the top left and right boundary initial pressure concentration stress displacements and porosity are prescribed to achieve equilibrium with the boundary and body forces at t 0 governing parameters of the problem are r pe α k cf σ logk 2 and ξy ξx boundary compressions pressure flow rate kg and slug length prescribed as part of the boundary conditions can also be included in the list of control parameters 3 1 dimensionless forms it is instructive to look at the dimensionless forms of the governing equations choosing the domain length lx as the characteristic length pc as the characteristic pressure or stress μ 1 as the characteristic viscosity kg as the characteristic permeability v c q in h x h z as the characteristic darcy velocity assuming h z 1 meter ϕ 0 as the characteristic porosity t c ϕ 0 l x v c as the characteristic time and neglecting gravity we obtain the dimensionless flow equation 15 p c m p d t d α ϵ v t d ϕ 0 d k d e r c 1 d p d 0 where the subscript d indicates dimensionless quantities kd xd yd is a multi gaussian function of σ log k 2 and ξy ξx the dimensionless form of the mechanics equations becomes 16 d σ d α d p d 0 the dimensionless form of the porosity evolution equation becomes 17 δ ϕ d α ϕ 0 ϕ d δ ϵ v 1 α p c k δ p d the dimensionless form of the ade is 18 ϕ d c t d d v d c 1 pe d ϕ d d c 0 where v d k d e r c 1 d p d and pe v c l x ϕ 0 d d is the peclet number we can choose pc as equal to k or define it from the prescribed injection rate as p c q in μ 1 k g here we choose the latter below we drop the subscript d when referring to the dimensionless quantities 3 2 spreading and mixing we will characterize spreading of the tracer slug by the tracer breakthrough time tbr and the breakthrough curve c prd t c l y t at the producer where the transversely averaged concentration c is defined as 19 c 1 l x 0 l x c x y d x since the general flow is along the y direction or the longitudinal direction evolution of transversely averaged quantities from the flow transport and geomechanics sub problems can help us understand the macroscopic effect of viscous fingering and poroelasticity on transport in our previous work jha et al 2011a jha 2013 we have analyzed the transversely averaged concentration in detail we can see the relation between transversely averaged pressure p which controls stress changes the darcy velocity v y which controls the breakthrough time and the biot parameters α and m by applying the transverse averaging operator to eq 2 20 1 m p t y v y α v s y 0 q in and p out which are driving longitudinal flow through the domain are constants in time we know that as the permeability variance σ logk 2 or the viscosity ratio r increases the tracer breaks through at the producer earlier i e tbr becomes smaller waggoner et al 1992 chen and meiburg 1998 berkowitz et al 2006 le borgne and gouze 2008 nicolaides et al 2015 however the effects of σ logk 2 and r on the breakthrough curve are hypothesized to be different higher σ logk 2 should lead to enhanced mixing at the tip of tracer channels and therefore lower breakthrough concentrations whereas higher positive values of r should lead to reduced mixing at the finger tip and higher breakthrough concentrations this reasoning is aligned with the observation that local scale mixing influences global spreading measures as reported previously kapoor and gelhar 1994 le borgne et al 2010 the mixing process in porous media flows can be described by the evolution of the degree of mixing and the rate of mixing kapoor and kitanidis 1998 le borgne et al 2010 jha et al 2011a jha 2013 nicolaides et al 2015 which is based on the idea of mixing in turbulent flows jones and launder 1972 eswaran and pope 1988 pope 2000 the degree of mixing χ which quantifies the amount of mixing in the domain can be defined in terms of the concentration variance σ c 2 or the scalar energy and the rate of mixing can be quantified in terms of the mean scalar dissipation rate ϵ c jones and launder 1972 eswaran and pope 1988 le borgne et al 2010 jha et al 2011a 2011b 2013 21 χ t 1 σ c 2 t σ c max 2 σ c 2 c c 2 ϵ c c 2 pe where denotes spatial averaging over the entire domain we fix c 0 5 and σ c max 2 0 25 in the definition above to define the lack of mixing as deviation from the perfectly mixed state of 50 tracer concentration which will correspond to σ c 2 0 and χ 1 in a completely segregated state e g c 0 or c 1 σ c 2 σ c max 2 and χ 0 we denote the degree of mixing at the breakthrough time as χ b r χ t b r ϵ c quantifies the amount of concentration gradient or equivalently the fluid fluid interfacial area in the flow a higher value of ϵ c means a longer and sharper interface which leads to a larger value of the total diffusive flux across the interface which leads to a larger value of dχ dt therefore ϵ c can be understood as a measure of the mixing rate ϵ c can be measured during a lab or field experiment by measuring the average viscosity of the fluids in the domain at discrete time steps and calculating the time rate of change of the average viscosity jha 2013 the degree of mixing evolves as follows 22 d χ d t 2 σ c max 2 ϵ c source due to injection sink due to production source sink due to porosity coupling similarly the evolution equation for ϵ c should have two source terms due to fingering induced interface stretching and entrance of new interfaces from the injection boundary and it should have three sink terms due to merging of fingers diffusion and the production boundary stretching and merging are nonlinear interactions that arise due to coupling between the velocity field and the concentration gradient field for analysis of the simulation results below we also define σ c 2 c 2 c 2 χ 1 σ c 2 σ max 2 and ϵ c c 2 pe similar to the definition of the breakthrough concentration in eq 19 3 2 1 fickian mixing for fickian or purely diffusive mixing of linear slugs or blobs transported through a homogeneous porous medium in absence of geomechanical coupling i e for r 0 σ logk 2 0 α ϕ 1 the evolution of ϵ c has been studied the 1d analytical solution for ϵ c in such diffusive mixing suggests ϵ c 1d t c 0 2 l x t 3 2 8 2 π pe i e a power law slope of 3 2 in the log ϵ c vs log t plot with c 0 as a constant le borgne et al 2010 however the evolution of ϵ c in a 2d periodic flow transitions from an early time power law to an intermediate time exponential to a late time error function behavior jha 2013 this corresponds to different regimes of slow and fast decay of the scalar energy σ c 2 and it is captured by the following analytical model jha 2013 23 ϵ c t e c 2 t c 1 t pe where c 1 and c 2 are positive constants this is a solution of the following evolution equation 24 d ϵ c d t c 2 ϵ c 1 2 pe ϵ c 2 t e c 2 t 0 4 numerical model numerical simulation of hydrodynamically unstable processes such as viscous fingering is sensitive to numerical discretization or truncation errors which can grow in time due to the nonlinearity of the equations because of different smoothness and continuity requirements of the pressure displacement and concentration functions the three pdes must be treated differently during discretization for example the miscible flow pressure field is expected to be smooth at all times whereas the concentration field is expected to show sharp gradients due to fingering that evolves in time higher order discretization schemes are required in ade to resolve the sharp concentration gradients jha et al 2011a 2011b also the fluid mass conservation must be honored locally for each element which can become a challenge in heterogeneous flow fields given these and other considerations around simulation runtime the finite volume method has proven to be a robust method for solving the flow and transport equations the mechanics equation is suited for a nodal finite element method because it can satisfy force balance at each node in the mesh in absence of faults fractures the displacement field is expected to be free of any discontinuities however a smooth stress field requires the displacement to be discretized with at least piecewise linear functions in mixed field problems such as the one we have the choice of discrete function spaces for pressure and displacement must satisfy the stability and solvability conditions e g the ladyzhenskaya babuska brezzi lbb condition brezzi 1974 white and borja 2007 to simultaneously solve the equations when both the fluid and solid behavior become nearly incompressible e g immediately after wells start to produce or inject to satisfy or avoid the lbb condition at all times we consider compressible systems with finite positive values of ks and cf and reasonably large time step sizes all of which are representative of a typical petroleum reservoir or a deep aquifer motivated by these considerations we use a finite volume finite element formulation to solve our coupled problem jha and juanes 2014 we derive the weak forms of the flow and mechanics equations as follows multiplication of the strong form by a suitably smooth test function integration over the domain integration by parts to reduce the order of differentiation on the unknown function application of the divergence theorem and imposition of the boundary conditions the flow problem is discretized in space with cell centered piecewise constant pressures and two point flux approximation tpfa the mechanics problem is discretized with bilinear elements and nodal displacement vectors jha and juanes 2014 for compressible systems considered here this choice is not subject to the lbb or inf sup condition the transport problem is discretized using a sixth order accurate compact finite difference method lele 1992 jha et al 2011a the flow problem is integrated in time using the first order accurate implicit backward euler scheme the transport equation is integrated in time using the third order accurate explicit runge kutta scheme we solve the dimensionless forms of the equations over a dimensionless time period 0 t 3 which allows complete drainage of the injected slug 4 1 coupling strategy and solution scheme we utilize a fully coupled simultaneous solution approach to solve for pressure and displacement fields at each time step lewis and sukirman 1993a pao et al 2001 lewis et al 2003 jha and juanes 2007 ferronato et al 2010 the system of linear equations becomes 25 k q q t s δ t t u p n 1 f u δ t f p q t u n s p n where u is the vector of nodal degrees of freedom from the finite element interpolation u n t u n is the matrix of bilinear shape functions p is the vector of cell centered pressure unknowns n is the previous time step and n 1 is the current time step at which displacements and pressures are sought such that δ t t n 1 t n the global stiffness matrix is calculated by assembling individual element stiffness matrices 26 k ω i b i t d i b i d ω where b is the strain displacement matrix computed by applying the symmetric gradient operator to n and i is the element or cell index for 2d quadrilateral elements with eight nodal degrees of freedom per element n is a 2 8 matrix b is a 3 8 matrix and k i is a 8 8 matrix the global transmissibility matrix t is calculated by assembling the individual interfaces transmissibilities for the interface ij between cell i and cell j the interface transmissibility is t i j γ i j l i μ i k i l j μ j k j which is the harmonic mean of fluid mobilities ki μi and kj μj weighted by the cell centroid to face centroid distances li and lj within the two cells γ ij is the interface area between two cells the global storativity or compressibility matrix is a diagonal matrix with components s i i ω i 1 m i d ω the flow geomechanics coupling matrix at the element level is 27 q i ω i α b i t i d d ω the right hand side of the weak form of the mechanics problem consists of traction and body forces 28 f u γ t n t σ d γ ω n t ρ g d ω where γ t denotes neumann boundaries of the domain with the prescribed tractions σ 0 σ h t on the top boundary and σ σ h 0 t on the left boundary the right hand side of the weak form of the flow problem consists of prescribed fluxes and well terms for cell i 29 f i p q in q out we solve eq 25 using a direct solver next we discuss the solution of the ade eq 18 coupling between the poroelastic solver and the transport solver is implemented using a sequential one way coupled approach for relatively small values of r as considered here r 3 the transport to deformation coupling strength is expected to be weak because there is no explicit appearance of a concentration functional in eq 16 and concentration dependence of pressure is limited to the fluid mobility term this suggests that a one way coupled approach to solve the two way coupled transport deformation problem can be implemented to reduce computational cost without sacrificing accuracy we will test this hypothesis in section 5 by analyzing the magnitude of fingering induced stress and porosity changes resulting from transport to deformation coupling we discretize eq 18 in space using a sixth order accurate compact finite difference method lele 1992 jha 2013 we compute the discrete interface velocities using a two point flux approximation of eq 3 i e v i j t i j p i p j γ i j where vij is the velocity across the ij interface between cells i and j and pi and pj are the pressures of the two neighboring cells we compute the nx ny matrices of cell centered face normal velocities vx and vy using a linear interpolation of the interface velocities we integrate the semi discrete ode system over the time step δt of eq 25 using a third order explicit runge kutta rk method the residual function of the rk integrator which is the discretized form of the flux divergence term in eq 18 is f c v x d x c v y d y c c d x v x d y v y 1 pe ϕ d xx d yy c 1 pe d x ϕ d x c d y ϕ d y c 1 δ t c δ ϕ where dx dy dxx and dyy are the discrete nx ny differentiation matrices for the x y 2 x 2 and 2 y 2 operators respectively the differentiation matrices are pre computed outside the time loop using standard methods lele 1992 c ϕ and δϕ are nx ny matrices of cell centered concentration porosity and porosity increment fields evaluated at tn vx and vy are at t n 1 available from the poroelastic solver δ ϕ n 1 is calculated using eq 17 and we update porosity as ϕ n 1 ϕ n δ ϕ n 1 the operator above denotes the element wise multiplication of two arrays an adaptive time stepping method based on the courant friedrichs lewy cfl condition is used to ensure stability of the explicit transport solver the dimensionless time step is calculated as δ t γ l x max v where max v is the maximum magnitude of the dimensionless velocity over the entire domain the value of γ is chosen to ensure stability and smoothness of the coupled solution 5 numerical simulation here we present the parameter values of our base case simulation model we discretize the rectangular domain in fig 1 using a mesh with square elements the mesh has a sufficient number of elements to ensure that the fingers are resolved and the simulation finishes within a reasonable time frame 2 6 hours on our cluster see table 1 for values of the mesh initial condition and boundary condition parameters values of other parameters in the base case model are given in table 2 5 1 initialization initialization of coupled flow geomechanical models is a non trivial task settari and walters 2001 ideally the initial state initial stresses and pressure should be in mechanical and hydrostatic equilibria such that the initial strains and fluid fluxes inside the domain are zero theoretically this is achievable by prescribing a total initial stress tensor for each grid cell which balances the prescribed boundary stresses initial pressure and body forces in each direction and by prescribing an initial pressure distribution that honors the hydrostatic potential gradient including the effects of depth dependent compressibility and fluid contacts in case of reservoirs containing multiple fluids such as oil and water in complex cases e g heterogeneous distribution of ρ f 0 α plastic deformation or time dependent boundary conditions achieving mechanical equilibrium at t 0 can become a challenge and may require a separate initialization step during the simulation this is the approach we follow here to create a more robust formulation that is suitable for real world applications the stresses are initialized from the results of the first timestep during which the domain deforms under the action of boundary loads initial pressure and body forces the displacement field at the end of the initialization timestep is designated as the reference displacement field deformation at subsequent time steps are calculated from that reference configuration our initial concentration field consists of a partially injected tracer slug in the domain with a diffused interface between the two fluids initiation of fingering at the unstable interface requires a small perturbation in the velocity field which is achieved by perturbing either the permeability field or the concentration dependent viscosity field we choose the latter alternative by superposing small amplitude random wave number perturbations on the c 0 5 contour at the interface jha et al 2011b based on the parameters of the problem and the physics of saffman taylor instability homsy 1987 a few of these wave numbers or modes are selected as the unstable modes which grow to become fingers while other modes are damped and suppressed this is a result of the nonlinear dispersion relation between the growth rate and wavenumber tan and homsy 1986 which predicts short wavelength stability cutoff wavenumber and long wavelength instability yortsos and hickernell 1989 loggia et al 1995 and the presence of a selection mechanisms for the finger size in the transverse direction we utilize this mechanism in initiating the instability from a broadband random perturbation of the initial front which does not affect the fingering dynamics in our simulations at intermediate and late times 5 2 alternating injection we define an alternating injection cycle as the injection of one slug of the tracer fluid for a dimensionless duration of t inj followed by one slug of the more viscous fluid for the dimensionless duration t gap the total duration of one cycle is t cyc t inj t gap we implement this boundary condition at the injector as follows 30 c y 0 1 if i cyc 1 t cyc t i cyc 1 t cyc t inj 0 if i cyc t cyc t gap t i cyc t cyc where 1 i cyc n cyc is the alternating injection cycle number which is an integer and n cyc is the total number of cycles we choose t inj 0 7 and t gap 1 4 in this study we fix n cyc 1 the simulation stops when the entire tracer slug has exited the domain the breakthrough time tbr is defined when the maximum tracer concentration in the producer exceeds 0 1 which occurs when the fingers of the first tracer slug arrive at the producer the drainage time tdr is defined when no cell in the domain has a concentration exceeding 0 01 meaning most of the tracer has exited the domain 5 3 sensitivity simulations to better understand the coupling mechanisms between transport and deformation processes in real reservoirs whose properties can vary over a wide range we perform a sensitivity analysis to investigate the influence of rock fluid properties on the breakthrough and mixing results of the base case defined above we choose the following parameters of the problem as the sensitivity parameters the biot coefficient α peclet number pe log viscosity ratio r permeability field parameters σ logk 2 and ξy ξx fluid compressibility cf and the rock drained bulk modulus k each simulation provides spatial maps of nodal displacements ux and uy cell centered pressure p effective volumetric stress σ v von mises stress σvm concentration c porosity ϕ and face centered velocities vx and vy at user selected timesteps 6 results below we discuss the base case results extract the transport deformation coupling mechanisms and identify mechanisms sensitivity to important poroelastic parameters 6 1 base case fig 3 shows the development of viscous fingers during the simulation through nonlinear interactions of tip splitting shielding and coalescence of fingers tan and homsy 1988 zimmerman and homsy 1992 transversely averaged profiles of concentration and change in pressure are also shown at three time steps including at the breakthrough time t b r 1 16 with time both the leading and the trailing fronts of c stretch along the flow direction the leading front stretches because of fingering and the trailing front stretches due to diffusion the pressure profiles can be explained as follows as the volume occupied by the less viscous slug increases due to spreading the pressure decreases in the domain similarly when t tbr the domain is increasingly occupied by the more viscous fluid and pressure increases because we maintain the same injection rate this is the first order effect of tracer transport which does not show the detailed effect of fingering on deformation for the chosen values of the governing parameters the pressure profiles are smooth because of the dominantly diffusive nature of the pressure equation as opposed to the dominantly hyperbolic nature of the ade this also holds true for transversely averaged profiles or 2d maps of the effective volumetric stress σ v not shown because of the stress compatibility relation between laplacians of σ v and p mentioned earlier in general the pressure changes are negative which lead to negative or compressive change in σ v and ϕ leading to reservoir compaction as also shown in fig 5 6 2 transport deformation coupling mechanisms we are interested in observing the effects of poroelasticity on the tracer transport behavior and thereby extracting the transport deformation coupling mechanisms fig 4 shows important quantities from the three processes flow deformation and transport that are expected to define such coupling mechanisms to that effect we analyze the gradient fields of pressure stress and porosity we choose p because it drives advection in ade and appears as a body force in the mechanical equilibrium eq 5 we choose σ v because it drives volumetric deformation as per hooke s law σvm can also be analyzed to evaluate the shear deformation tendency we did not include a separate plot for σvm in fig 4 because for the base case parameter values σvm behaves almost identical to σ v this happens because initially the reservoir is in a principal state of stress with zero shear and hydrostatic loading from tracer transport does not induce significant shear finally we choose ϕ and dϕ dt because they appear in the deformation to transport coupling term on the rhs of ade eq 13 next we investigate the results at the observation point which is at the center of the domain lx 2 ly 2 as the tracer slug passes through the observation point the concentration first increases and then decreases in time as shown by δc in fig 5 a drop in pressure at the observation point leads to compressive stress change δ σ v 0 compaction δuy 0 and loss of porosity δϕ 0 δux becomes positive due to the poisson effect due to equal values of the boundary stresses and the hydrostatic loading from slug injection σ x x σ y y and the shear stress change is negligible δσxy 0 this leads to almost identical changes in δ σ v magnitude and δσvm fig 6 shows the evolution of mixing and spreading metrics χ ϵ c and c prd as the injection progresses χ increases due to fingering induced spreading of the tracer merging of the fingers and diffusion across the finger interface these sources of mixing affect the length and sharpness of the fluid fluid interface which are captured quantitatively by ϵ c as mentioned in section 3 2 ϵ c is a dynamic quantity itself spreading of the slug and entry of the trailing front act as sources of ϵ c and finger coalescence and diffusion act as sinks of ϵ c after breakthrough the mixed fluid exits the domain and the producer acts as a sink for both χ and ϵ c the balance between the sources and sinks of mixing determines when χ starts to decrease in fig 6 a entrance of the trailing front causes a spike in ϵ c because the concentration gradient is large across the front which causes a sudden jump in ϵ c followed by a drop due to smearing of the front from diffusion across the front fig 6 b the next event is breakthrough after which ϵ c starts to drop monotonically the breakthrough curve c prd t shows arrivals of the viscous fingers at the producer as wiggles all the fingers exit the domain by t 2 4 and mixing in the domain is purely diffusive after that which results in another sharp drop in the mean scalar dissipation rate fig 6b the breakthrough time tbr the time tmc at which c prd is maximum and the concentration c prd t m c are three important quantities during a contaminant remediation operation because their values indicate when and how much remediation effort is necessary at a given location in enhanced oil recovery applications e g waterflooding or co2 injection the same quantities determine the estimated ultimate recovery eur and the life of the well before it becomes uneconomical due to excessive production of the injectant compared to a purely diffusive r 0 mixing and spreading process viscous fingering shortens tbr and tmc and increases c prd t m c nicolaides et al 2015 we identify the coupling between transport and deformation processes by plotting mixing and spreading metrics against deformation metrics we plot the degree of mixing as a function of the root mean square rms of the change in porosity δϕrms and the breakthrough concentration as a function of the root mean square of the change in effective volumetric stress δ σ v r m s fig 7 as the transport deformation coupling becomes stronger e g α increases or k decreases from left most curve to right most curve in fig 7 the slope of χ vs δϕrms changes this signifies the dependence of the degree of mixing on the change in porosity due to different degrees of geomechanical coupling porosity is related to the volumetric strain of the reservoir and the effective volumetric stress is related to the total volumetric stress and pressure together they can characterize the state of volumetric deformation in the reservoir also the rms of change from initial porosity or stress is numerically comparable to χ because σ c 2 is defined as a mean of squared deviation eq 21 based on fig 4 we can also choose the rms of change in the von mises stress as a metric for shear deformation to investigate coupling between transport and induced shear failure events such as hydroshearing in geothermal rocks 7 sensitivity analysis fig 7 already shows how the degree or strength of coupling varies as α and k are varied here we analyze the sensitivity of the coupling mechanisms to various poroelastic parameters in detail 7 1 biot coefficient the biot coefficient α captures the strength of cementation between the grains relative to the grain compressibility we saw in the mathematical model section eq 9 that for an incompressible system or in the drained deformation case α δ ϕ δ ϵ v and the biot coefficient can be interpreted as the change in porosity for a unit change in the volumetric strain α also dictates the degree of coupling between flow and mechanics problems through the coupling terms in eqs 1 and 5 according to the compatibility relation of α 2 σ v 2 p α determines the deviation in σ v from its local average value for a given value of deviation from local average in pressure in other words for smaller values of α the effective volumetric stress is smoother and more independent of pressure fluctuations such as the fluctuations arising from fingering or permeability field α is less than 1 0 for rocks with high degrees of cementation and close to 1 0 for soft soil we vary it from 0 95 loose soil to 0 1 rigid tight rocks based on eq 13 we hypothesize that the effect of α on spreading and mixing is limited by the maximum change in porosity which is less than 1 in all the simulations considered here figs 8 and 9 analyze the effect of α on slug spreading and mixing behavior the main observation is that the effect is weak for the range of parameter values considered here tbr decreases with α and the degree of mixing at breakthrough χbr increases slightly with α α s effect on breakthrough is more significant than its effect on mixing the effect on spreading appears at late times after breakthrough fig 9 the reason is that the primary effect of α is on the finger velocity as α increases and the fingers move faster breakthrough occurs earlier the effect of α on χ is not significant because fingers do not spend enough time in our relatively short domain to cause a difference in mixing to better observe the effect of poroelastic or geomechanical coupling on the spatial distribution of tracer we plot the difference of concentration fields corresponding to different values of the biot coefficient which is a measure of the poroelastic coupling strength in fig 10 the fields are at respective breakthrough times as α increases we see that the concentration at the trailing front of the injected slug in the lower half of the figure increases this occurs because the finger velocities are different for different α more interestingly we observe concentration differences in the upper part of the domain where fingering occurs this difference becomes more pronounced as poroelastic coupling becomes stronger from left to right in fig 10 which suggests that neglecting poroelasticity can lead to an erroneous concentration field 7 2 permeability heterogeneity we vary the log permeability variance σ logk 2 and the ratio of correlation lengths ξy ξx as shown in table 3 σ logk 2 controls the range of permeability values in the domain at higher variances e g case 2 the more permeable regions of the reservoir will be connected by streamlines leading to channeling of the tracer and a shorter breakthrough time whereas the less permeable regions will act as stagnation or hold up zones leading to a long residence or slug removal time chen and meiburg 1998 nicolaides et al 2015 permeability heterogeneity controls the spatial distribution of the tracer and resident fluids and the control is exerted equivalently on both fluids eq 3 and the viscosity contrast controls the growth rate of the interface between the two fluids tan and homsy 1992 this leads to rapid stretching of the interface and subsequent mixing fig 11 shows c x y tbr for the three values of σ logk 2 we observe more spreading of the slug and hence expect an earlier breakthrough and higher degrees of mixing at higher heterogeneity levels this is confirmed in fig 8 presence of stagnation zones at higher σ logk 2 also contributes to larger spreading of the tracer slug and higher drainage time next we vary the ratio of permeability correlation lengths ξy ξx to evaluate the effect of channelized features on the transport characteristics we expect that case 4 with a longer correlation length along the flow direction will lead to tracer channeling and earlier breakthrough fig 12 shows that as ξy ξx increases the fingers are elongated in the y direction and thinner in the x direction fig 8 verifies the hypothesis of earlier breakthrough at ξy ξx 1 mixing of the slug is also enhanced across the longer interface achieved with larger ξy ξx 7 3 peclet number peclet number is the relative strength of advection compared to diffusion here we consider the range of 200 pe 700 a lower value of pe due to lower injection rate q in or higher diffusion dispersion coefficient dd leads to diffused fingers that are wider and fewer in number compared to another case with higher pe higher pe also means faster travelling fingers higher growth rate of the viscous instability homsy 1987 i e earlier breakthrough as seen in fig 13 and confirmed in fig 8 extensive tip splitting and merging of fingers lead to enhanced spreading and lower σ c 2 or higher χ merging of fingers increases the advective energy of the dominant finger to further spread the solute in the domain this balances against the lower diffusive flux at higher pe which causes a loss of diffusive mixing and lower χ the balance between the two mechanisms of splitting merging and diffusion results in a non monotonic profile of χbr vs pe shown in fig 8 7 4 viscosity ratio the log viscosity ratio r between the injected and resident fluids determines the number size width and speed of the fingers homsy 1987 since fingering plays a critical role in the development of miscibility between the two fluids and in recovering the resident fluid in case of miscible co2 injection in eor and the tracer fluid in case of contaminant remediation r is an important parameter for sensitivity analysis when we inject a less viscous fluid into the aquifer r 0 the degree of mixing at breakthrough can be as much as 88 higher compared to injecting a tracer with r 0 fig 8 this is due to faster tip velocities of the fingers which lead to faster spreading of the slug fig 14 as fingers develop dispersion or spreading of the solute becomes stronger resulting in sharper concentration gradients and a longer interface which in turn augments the diffusive flux and the degree of mixing 8 summary and conclusion we investigated the coupling between poroelastic deformation and solute spreading and mixing during viscous fingering using high resolution numerical simulations motivated by the difference in the mathematical nature of the governing equations we proposed a numerical formulation of a monolithic flow geomechanics solver sequentially coupled to a transport solver via the velocity field and the concentration dependent mobility model transport deformation coupling mechanisms and their sensitivity to poromechanical parameters were identified and analyzed a sensitivity analysis was performed to obtain the extent of poroelastic influence on the macroscopic transport quantities the breakthrough time the breakthrough curve and the degree of mixing the sensitivity analysis considered the heterogeneity in permeability field the biot coefficient log viscosity ratio r and peclet number the parameters and their values were chosen to represent injection in real world confined aquifers the results show that the poroelastic processes influence solute transport from fig 8 we observe that spreading of the injected tracer slug is accelerated i e breakthrough occurs earlier when the rock is less consolidated or more loosely packed viscosity contrast increases or diffusion is weaker compared to advection mixing of the injected slug is enhanced when rock becomes less consolidated and more deformable failure to account for this coupling will result in an inaccurate prediction of the breakthrough time solute recovery and the degree of mixing thus an inaccurate determination of the efficiency of the groundwater remediation or enhanced oil recovery operation the 2d study presented here can be extended to 3d the physical mechanisms of advection diffusion and pressure induced deformation will carry over from 2d to 3d however we may observe the following changes the flow field around the wells will change from linear to radial resulting in a 3d stress field which will not satisfy the plane stress approximation including the vertical dimension to the domain will activate gravity which appears as a body force in the mechanics problem and as a velocity potential in the flow problem the effect of gravity as a body force can be absorbed into the initial stresses because we assume the bulk density to remain constant in time also since we assume a slightly compressible fluid with a density that is independent of the tracer concentration spatial variations of the fluid density can be neglected therefore we believe our main result related to transport deformation mechanisms are generalizable our workflow employs different discretization methods for different sub problems finite element method for the mechanics problem finite volume method for the flow problem and compact finite difference method for the transport problem finite element and finite volume methods can be applied easily to unstructured grids because the volume and surface integrals required for terms in eq 25 can be evaluated for arbitrary shapes and orientations however the compact finite difference method is more appropriate for a structured grid because we assume that the grid lines are oriented parallel to the two cartesian directions of our 2d domain with a fixed number of cells in each grid direction in other words fixed values of nx and ny in x and y directions are required to build the differentiation matrices and discretize the spatial derivatives in the transport solver to extend our work to unstructured grids one may consider using a compact high order finite volume method ollivier gooch and altena 2002 to solve the transport problem credit authorship contribution statement minh tran software data curation writing original draft visualization investigation validation birendra jha conceptualization methodology software supervision writing review editing funding acquisition resources declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment funding from american chemical society petroleum research fund number 58769 dni9 is acknowledged 
528,we investigate the influence of poroelasticity on solute transport processes during viscously unstable flows in a deformable aquifer we hypothesize that viscous fingering induced fluctuations in the flow field can increase the strength of coupling between poroelastic stresses and mixing and spreading characteristics of the solute slug to test the hypothesis we develop a coupled flow transport and geomechanics framework to simulate spreading mixing and deformation mechanisms during viscous fingering in a stress sensitive aquifer we show quantitatively that concentration dependent fluid mobility affects the pressure and effective stress fields and deformation driven changes in porosity affects advective and diffusive fluxes we perform a sensitivity analysis to evaluate the dependence of global transport characteristics the solute breakthrough time breakthrough curve and the degree of mixing on the strength of flow deformation coupling defined in terms of poroelastic moduli results are obtained for different magnitudes of the peclet number solute viscosity contrast biot coefficient rock bulk modulus fluid compressibility and permeability heterogeneity we find that in presence of less consolidated formations softer rocks or more compressible fluids the injected solute breaks through earlier and mixes with the resident fluid better our results provide important insights for modeling hydrodynamically unstable contaminant remediation and fluid injection processes in stress sensitive reservoirs keywords viscous fingering poroelasticity mixing geomechanics contaminant transport 1 introduction spreading and mixing of solutes n subsurface reservoirs has garnered significant interest especially in real time surveillance applications such as tracer analysis and waste disposal monitoring welty and gelhar 1991 kapoor and kitanidis 1998 le borgne et al 2010 jha et al 2013 nicolaides et al 2015 while spreading describes the spatial stretching and deformation of a solute slug driven by advective mechanisms mixing is the mechanism that increases the actual fluid volume occupied by the solute behind the spreading front kapoor and gelhar 1994 kapoor and kitanidis 1998 le borgne et al 2010 spreading usually intensifies the solute concentration contrast in the domain while mixing tends to smooth out the concentration gradient within the solute contaminated region le borgne et al 2013 jha et al 2011b these processes are also critical for enhanced oil recovery eor technologies such as chemical flooding and injection of co2 nitrogen methane and ethane gases waggoner et al 1992 chen and meiburg 1998 lake et al 2014 the injected fluid can be less viscous than the resident crude oil or brine to improve wellbore injectivity at lower injection pressures it can also be more viscous than the resident fluid to increase the sweep efficiency of the fluid fluid displacement process also the injected and resident fluids can mix and react within the reservoir which can change the physical properties of the mixture e g viscosity or density this can impact the fluid velocity field and lead to two way coupling between flow and transport welty and gelhar 1991 waggoner et al 1992 tan and homsy 1992 jha et al 2011a the displacement of a more viscous fluid by a less viscous fluid leads to the saffman taylor instability also known as viscous fingering koval 1963 homsy 1987 it is well known that fingering reduces the recovery efficiency of fluid fluid displacement processes such as waterflooding lake et al 2014 in case of groundwater contaminant treatment and transport viscous fingering leads to a rapid increase in the macrodispersivity welty and gelhar 1991 and affects contaminant breakthrough and removal nicolaides et al 2015 the length of the mixing region is shown to increase linearly with time and monotonically with the permeability variance in one study tan and homsy 1992 and in another study it is shown to increase linearly with the square root of time and behave non monotonically with the variance de wit and homsy 1997 in terms of the interaction between the permeability correlation length scale and the scale of fingering a resonance mechanism was proposed to explain the maximum growth of the mixing length at intermediate correlation values tan and homsy 1992 in summary the effect of fingering on solute mixing in heterogeneous rocks is still unclear often the reservoir of interest is geomechanically sensitive and deformable due to the presence of pre existing fractures unconsolidated formations excessive flow induced stresses or low compressibility fluids the last scenario can result from an increase in the water saturation associated with water injection or hydrocarbon production from an oil reservoir because water is usually less compressible than oil or gas zhao and jha 2019 the role of biot coefficient in groundwater pumping induced fissure formation has been hypothesized recently budhu 2011 the effect of consolidation on solute transport has been studied in the context of loosely packed landfill columns with incompressible grains where it is reported that compaction induced decrease in porosity and increase in the particle velocity lead to a faster breakthrough peters and smith 2002 alshawabkeh et al 2005 fox et al 2011 zhang et al 2012 compared to the case without compaction however we do not know how the breakthrough time varies for rocks at depth where the grains are tightly packed and cemented together and their compressibility cannot be ignored we hypothesize that the compaction induced breakthrough acceleration mechanism is weaker in rocks because the magnitude of compaction is smaller in rocks than in soils as a result of these observations there is a growing interest in integrating rock deformation with fluid flow processes in existing reservoir models to obtain a more realistic representation of the subsurface and to improve the agreement between model predictions and field observations several computational frameworks of coupled flow and geomechanics have been proposed for applications in hydrocarbon recovery groundwater extraction underground waste disposal and co2 storage lewis and sukirman 1993b gawin et al 1995 rutqvist et al 2013 white and borja 2007 ferronato et al 2010 jha and juanes 2014 castelletto et al 2015 effect of stress on permeability under the assumption of uncoupled pressure and stress fields has been studied recently using a pore scale model roded et al 2018 however most of these studies neglect the two way coupling mechanisms between transport and deformation i e deformation induced changes in the solute transport behavior and concentration dependent fluid mobility effects on deformation the effect of geomechanical coupling on various transport mechanisms such as spreading mixing and viscous fingering in stress sensitive reservoirs is unexplored tran et al 2018 a study on the effect of stress on contaminant transport in fractured crystalline rock showed that the residence time of contaminant is a strong function of the boundary stress ratio wang et al 2017 we focus on unraveling the transport deformation coupling mechanisms at reservoir conditions when the two way coupling between flow transport and deformation cannot be neglected in particular we focus on the mechanisms that affect mixing and spreading because these processes control the ultimate recovery during contaminant removal or enhanced oil recovery we present a numerical framework to model and analyze the effect of poroelasticity on tracer transport under viscous fingering instability we use the framework to evaluate the sensitivity of transport metrics to poromechanical properties including the biot coefficient and the bulk modulus 2 physical model we consider a 2d section of an aquifer bounded by a horizontal injection well and a horizontal production well fig 1 the reservoir is fully saturated and under hydromechanical equilibrium with external stresses σh and σh which are the minimum and maximum principal horizontal compressions from regional tectonics the injection well injects two fluids of different viscosities alternatingly in the form of slugs the fluids are perfectly miscible with each other and with the resident fluid one of the fluids has the same viscosity as the resident fluid and the other fluid is less viscous due to the presence of a chemical tracer the production well is open to flow at a fixed bottom hole pressure that is set lower than the reservoir pressure as the less viscous slug moves through the reservoir and displaces the more viscous resident fluid viscous fingering ensues at the leading front of the less viscous slug this affects the spreading and mixing of the slug as well as the recovery of the resident fluid from the producer since the reservoir pressure is coupled to both slug transport and the state of stress we can use this model to probe the coupling between transport and deformation processes and extract possible physical mechanisms arising from such coupling we make the following assumptions which are appropriate for the physical problem at hand 1 slightly compressible fluid 2 small strain 3 quasi static equilibrium 4 linear elasticity 5 single phase flow 6 isotropic material behavior 7 permeability not dependent on deformation 8 isothermal system no temperature change and 9 first contact miscibility between the fluids 3 mathematical model the starting point is to state the governing equations of flow deformation and transport in the strong form which will be converted into the respective weak forms and discretized later we adopt a continuum representation of a macroscopic model of porous media where fluid and solid are viewed as overlapping continua bai and elsworth 2000 coussy 2004 the model domain has an area ω l x l y where lx and ly are the dimensions in the x and y directions we denote the closed boundary of the domain by γ the initial porosity is ϕ 0 and the permeability k is assumed to be isotropic and constant in time the domain is saturated with a fluid of density ρ f 0 subscript 0 indicates initial condition the mass conservation equation for single phase slightly compressible flow under small deformation gradients with no sources or sinks in the domain is 1 1 m p t α ϵ v t v 0 where p is the pore fluid pressure t is time 1 m ϕ 0 c f α ϕ 0 k s is the inverse biot modulus α 1 k k s is the biot coefficient indicating the degree of cementation between grains k is the drained bulk modulus of rock ks is the bulk modulus of solid grains cf 1 ρf dρf dp is the fluid compressibility ρf is the fluid density v is the darcy fluid velocity vector relative to the solid skeleton and ϵ v is the volumetric strain the volumetric strain rate term in the equation above couples fluid flow to mechanical deformation and acts as a local source term denoting the solid skeleton displacement vector with u and the skeleton velocity with v s u t and noting that ϵ v u we obtain 2 1 m p t v α v s 0 the fluid momentum balance equation or darcy s law is 3 v k μ c ρ f g p where μ c is the concentration dependent fluid viscosity and g is the gravitational vector we use a gaussian random field model with the following parameters to model permeability heterogeneity geometric mean permeability kg dimensionless log permeability variance σ logk 2 and permeability correlation lengths ξx and ξy an example is shown in fig 2 the quasi static linear momentum balance equations for a fluid saturated rock is 4 σ ρ g 0 where σ σ α p i d is the cauchy total stress tensor σ is the effective stress tensor id is the identity tensor ρ ϕ ρ f 1 ϕ ρ s is the bulk density and ρs is the solid grain density here ϕ is the eulerian or true porosity in the current configuration a sign convention where the normal stresses are positive in tension is used the total volumetric stress σ v trace σ n d and the effective volumetric stress σ v are related by σ v σ v α p where nd is the number of space dimensions n d 2 in 2d σ v and p are also related by the compatibility relation 2 σ v α 2 p the isotropic part of the deformation ϵ v volumetric expansion or contraction is controlled by σ v and the deviatoric part rock failure and plastic yielding is controlled by the von mises stress σ v m 3 j 2 where j 2 is the second invariant of the deviatoric stress σ σ v i d substituting the effective stress into eq 4 we obtain 5 σ α p ρ g 0 assuming a linear elastic behavior of the rock σ d ϵ where ϵ u u t 2 is the small strain tensor defined as the symmetric gradient of the displacement vector the 2d domain represents a thin layer of rock thus a state of plane stress is assumed in the compact engineering notation σ σ x x σ y y σ x y t ϵ ϵ x x ϵ y y 2 ϵ x y t and i d 1 1 0 t are the stress strain and identity vectors in the plane stress configuration the isotropic drained elasticity tensor d can be written as 6 d e 1 ν 2 1 ν 0 ν 1 0 0 0 1 ν 2 where drained young s modulus e and poisson s ratio ν are the two parameters of the isotropic elastic material model in 2d σ v k ϵ v with k e 3 1 2 ν the fluid mass conservation and the mechanical equilibrium equations are coupled through biot s poroelasticity equation which relates the fluid mass increment per unit initial bulk volume δ m δ ρ f ϕ 1 ϵ v to strain and pressure as δ m ρ f 0 α δ ϵ v δ p m we can obtain the equation for porosity evolution from the solid mass conservation equation lewis and schrefler 1998 and partitioning of the total stress on porous skeleton between the stress acting on the solid grains and the pressure of the pore fluid coussy 2004 jha and juanes 2014 7 d ϕ d t ϕ t ϕ v s α ϕ ϵ v t α ϕ k s p t which can be integrated in time and approximated under infinitesimal strain as 8 δ ϕ α ϕ δ ϵ v 1 α δ p k there are several interesting limiting cases of eq 1 the first case is that of almost incompressible solid and fluid i e cf 0 ks m to maintain finite values of the pressure this results into an instantaneous and local equilibration of pressure such that δ m ρ f 0 α δ ϵ v or δ ϕ α δ ϵ v this implies 9 v α v s 0 v α ϵ v t ϕ t this is relevant to model flow in shallow aquifers or underneath dams away from wells where flow is driven by the volumetric expansion or contraction of the pores the second case is that of flow through low porosity consolidated rocks i e ϕ 1 k ks α 0 which results into the traditional flow equation uncoupled to mechanical deformation 10 ϕ 0 c f c r p t v 0 where cr is the rock compressibility aziz and settari 1979 this approximation is also valid in highly stiff rock k ks saturated with highly compressible fluid large cf such as gas this case is relevant for modeling flow in conventional strongly consolidated petroleum reservoirs the third case is undrained deformation low permeability i e δm 0 k 0 i e v 0 such that 11 1 m p t α ϵ v t 0 δ p u α m δ ϵ v b δ σ v where b α m k u is the skempton s coefficient k u k α 2 m is the undrained bulk modulus and δpu is the undrained pressure change this case is relevant for monitoring sudden stress changes due to production and pressure changes during hydraulic fracturing daneshy 2015 kampfer and dawson 2016 roussel and agrawal 2017 in nanodarcy rocks such as shales which are considered unconventional petroleum resources the fourth case is drained deformation i e δp 0 which is the same as the first case in terms of the resulting equations the advection dispersion equation ade for tracer or solute transport is 12 ϕ c t v c ϕ d d c 0 here c is the normalized local concentration of tracer and dd is the hydrodynamic dispersion coefficient assumed to be a constant we assume that velocity dependent dispersion is less important for the rectilinear injection case considered here compared to the radial injection case chen and meiburg 1998 nicolaides et al 2015 where the average velocities decrease rapidly with the distance from injection source re arranging the terms to extract the effect of geomechanical coupling on transport 13 ϕ c t v c ϕ d d 2 c d d ϕ c c ϕ t the left hand side is the residual of the traditional ade uncoupled to geomechanics and the right hand side is the mechanics to transport coupling term composed of source sink due to variations in porosity which can be calculated using eq 8 we use an exponential model for the concentration dependent viscosity of the mixture 14 μ c μ 1 e r 1 c where r log e μ 0 μ 1 is the log viscosity ratio of the resident fluid viscosity μ 0 and the injected fluid viscosity μ 1 when 0 c 1 depending on the value of r the viscosity of the mixture is higher than the viscosity of injected tracer this promotes viscous fingering at the front between the tracer and resident fluids when the former displaces the latter the mathematical model requires boundary and initial conditions for well posedness for the rectangular domain considered in fig 1 the normal displacement is zero on the bottom and right boundaries compressions are applied on the left and top boundaries and normal fluid flux is zero on the left and right boundaries the producer is controlled by a prescribed bottom hole pressure p out and the injector is controlled by an injection rate q in per unit length in the third dimension prescribed at the bottom boundary the flow rate at the producing boundary q out can be calculated from p out and the flow area length lx natural outflux boundary condition is imposed on the top left and right boundary initial pressure concentration stress displacements and porosity are prescribed to achieve equilibrium with the boundary and body forces at t 0 governing parameters of the problem are r pe α k cf σ logk 2 and ξy ξx boundary compressions pressure flow rate kg and slug length prescribed as part of the boundary conditions can also be included in the list of control parameters 3 1 dimensionless forms it is instructive to look at the dimensionless forms of the governing equations choosing the domain length lx as the characteristic length pc as the characteristic pressure or stress μ 1 as the characteristic viscosity kg as the characteristic permeability v c q in h x h z as the characteristic darcy velocity assuming h z 1 meter ϕ 0 as the characteristic porosity t c ϕ 0 l x v c as the characteristic time and neglecting gravity we obtain the dimensionless flow equation 15 p c m p d t d α ϵ v t d ϕ 0 d k d e r c 1 d p d 0 where the subscript d indicates dimensionless quantities kd xd yd is a multi gaussian function of σ log k 2 and ξy ξx the dimensionless form of the mechanics equations becomes 16 d σ d α d p d 0 the dimensionless form of the porosity evolution equation becomes 17 δ ϕ d α ϕ 0 ϕ d δ ϵ v 1 α p c k δ p d the dimensionless form of the ade is 18 ϕ d c t d d v d c 1 pe d ϕ d d c 0 where v d k d e r c 1 d p d and pe v c l x ϕ 0 d d is the peclet number we can choose pc as equal to k or define it from the prescribed injection rate as p c q in μ 1 k g here we choose the latter below we drop the subscript d when referring to the dimensionless quantities 3 2 spreading and mixing we will characterize spreading of the tracer slug by the tracer breakthrough time tbr and the breakthrough curve c prd t c l y t at the producer where the transversely averaged concentration c is defined as 19 c 1 l x 0 l x c x y d x since the general flow is along the y direction or the longitudinal direction evolution of transversely averaged quantities from the flow transport and geomechanics sub problems can help us understand the macroscopic effect of viscous fingering and poroelasticity on transport in our previous work jha et al 2011a jha 2013 we have analyzed the transversely averaged concentration in detail we can see the relation between transversely averaged pressure p which controls stress changes the darcy velocity v y which controls the breakthrough time and the biot parameters α and m by applying the transverse averaging operator to eq 2 20 1 m p t y v y α v s y 0 q in and p out which are driving longitudinal flow through the domain are constants in time we know that as the permeability variance σ logk 2 or the viscosity ratio r increases the tracer breaks through at the producer earlier i e tbr becomes smaller waggoner et al 1992 chen and meiburg 1998 berkowitz et al 2006 le borgne and gouze 2008 nicolaides et al 2015 however the effects of σ logk 2 and r on the breakthrough curve are hypothesized to be different higher σ logk 2 should lead to enhanced mixing at the tip of tracer channels and therefore lower breakthrough concentrations whereas higher positive values of r should lead to reduced mixing at the finger tip and higher breakthrough concentrations this reasoning is aligned with the observation that local scale mixing influences global spreading measures as reported previously kapoor and gelhar 1994 le borgne et al 2010 the mixing process in porous media flows can be described by the evolution of the degree of mixing and the rate of mixing kapoor and kitanidis 1998 le borgne et al 2010 jha et al 2011a jha 2013 nicolaides et al 2015 which is based on the idea of mixing in turbulent flows jones and launder 1972 eswaran and pope 1988 pope 2000 the degree of mixing χ which quantifies the amount of mixing in the domain can be defined in terms of the concentration variance σ c 2 or the scalar energy and the rate of mixing can be quantified in terms of the mean scalar dissipation rate ϵ c jones and launder 1972 eswaran and pope 1988 le borgne et al 2010 jha et al 2011a 2011b 2013 21 χ t 1 σ c 2 t σ c max 2 σ c 2 c c 2 ϵ c c 2 pe where denotes spatial averaging over the entire domain we fix c 0 5 and σ c max 2 0 25 in the definition above to define the lack of mixing as deviation from the perfectly mixed state of 50 tracer concentration which will correspond to σ c 2 0 and χ 1 in a completely segregated state e g c 0 or c 1 σ c 2 σ c max 2 and χ 0 we denote the degree of mixing at the breakthrough time as χ b r χ t b r ϵ c quantifies the amount of concentration gradient or equivalently the fluid fluid interfacial area in the flow a higher value of ϵ c means a longer and sharper interface which leads to a larger value of the total diffusive flux across the interface which leads to a larger value of dχ dt therefore ϵ c can be understood as a measure of the mixing rate ϵ c can be measured during a lab or field experiment by measuring the average viscosity of the fluids in the domain at discrete time steps and calculating the time rate of change of the average viscosity jha 2013 the degree of mixing evolves as follows 22 d χ d t 2 σ c max 2 ϵ c source due to injection sink due to production source sink due to porosity coupling similarly the evolution equation for ϵ c should have two source terms due to fingering induced interface stretching and entrance of new interfaces from the injection boundary and it should have three sink terms due to merging of fingers diffusion and the production boundary stretching and merging are nonlinear interactions that arise due to coupling between the velocity field and the concentration gradient field for analysis of the simulation results below we also define σ c 2 c 2 c 2 χ 1 σ c 2 σ max 2 and ϵ c c 2 pe similar to the definition of the breakthrough concentration in eq 19 3 2 1 fickian mixing for fickian or purely diffusive mixing of linear slugs or blobs transported through a homogeneous porous medium in absence of geomechanical coupling i e for r 0 σ logk 2 0 α ϕ 1 the evolution of ϵ c has been studied the 1d analytical solution for ϵ c in such diffusive mixing suggests ϵ c 1d t c 0 2 l x t 3 2 8 2 π pe i e a power law slope of 3 2 in the log ϵ c vs log t plot with c 0 as a constant le borgne et al 2010 however the evolution of ϵ c in a 2d periodic flow transitions from an early time power law to an intermediate time exponential to a late time error function behavior jha 2013 this corresponds to different regimes of slow and fast decay of the scalar energy σ c 2 and it is captured by the following analytical model jha 2013 23 ϵ c t e c 2 t c 1 t pe where c 1 and c 2 are positive constants this is a solution of the following evolution equation 24 d ϵ c d t c 2 ϵ c 1 2 pe ϵ c 2 t e c 2 t 0 4 numerical model numerical simulation of hydrodynamically unstable processes such as viscous fingering is sensitive to numerical discretization or truncation errors which can grow in time due to the nonlinearity of the equations because of different smoothness and continuity requirements of the pressure displacement and concentration functions the three pdes must be treated differently during discretization for example the miscible flow pressure field is expected to be smooth at all times whereas the concentration field is expected to show sharp gradients due to fingering that evolves in time higher order discretization schemes are required in ade to resolve the sharp concentration gradients jha et al 2011a 2011b also the fluid mass conservation must be honored locally for each element which can become a challenge in heterogeneous flow fields given these and other considerations around simulation runtime the finite volume method has proven to be a robust method for solving the flow and transport equations the mechanics equation is suited for a nodal finite element method because it can satisfy force balance at each node in the mesh in absence of faults fractures the displacement field is expected to be free of any discontinuities however a smooth stress field requires the displacement to be discretized with at least piecewise linear functions in mixed field problems such as the one we have the choice of discrete function spaces for pressure and displacement must satisfy the stability and solvability conditions e g the ladyzhenskaya babuska brezzi lbb condition brezzi 1974 white and borja 2007 to simultaneously solve the equations when both the fluid and solid behavior become nearly incompressible e g immediately after wells start to produce or inject to satisfy or avoid the lbb condition at all times we consider compressible systems with finite positive values of ks and cf and reasonably large time step sizes all of which are representative of a typical petroleum reservoir or a deep aquifer motivated by these considerations we use a finite volume finite element formulation to solve our coupled problem jha and juanes 2014 we derive the weak forms of the flow and mechanics equations as follows multiplication of the strong form by a suitably smooth test function integration over the domain integration by parts to reduce the order of differentiation on the unknown function application of the divergence theorem and imposition of the boundary conditions the flow problem is discretized in space with cell centered piecewise constant pressures and two point flux approximation tpfa the mechanics problem is discretized with bilinear elements and nodal displacement vectors jha and juanes 2014 for compressible systems considered here this choice is not subject to the lbb or inf sup condition the transport problem is discretized using a sixth order accurate compact finite difference method lele 1992 jha et al 2011a the flow problem is integrated in time using the first order accurate implicit backward euler scheme the transport equation is integrated in time using the third order accurate explicit runge kutta scheme we solve the dimensionless forms of the equations over a dimensionless time period 0 t 3 which allows complete drainage of the injected slug 4 1 coupling strategy and solution scheme we utilize a fully coupled simultaneous solution approach to solve for pressure and displacement fields at each time step lewis and sukirman 1993a pao et al 2001 lewis et al 2003 jha and juanes 2007 ferronato et al 2010 the system of linear equations becomes 25 k q q t s δ t t u p n 1 f u δ t f p q t u n s p n where u is the vector of nodal degrees of freedom from the finite element interpolation u n t u n is the matrix of bilinear shape functions p is the vector of cell centered pressure unknowns n is the previous time step and n 1 is the current time step at which displacements and pressures are sought such that δ t t n 1 t n the global stiffness matrix is calculated by assembling individual element stiffness matrices 26 k ω i b i t d i b i d ω where b is the strain displacement matrix computed by applying the symmetric gradient operator to n and i is the element or cell index for 2d quadrilateral elements with eight nodal degrees of freedom per element n is a 2 8 matrix b is a 3 8 matrix and k i is a 8 8 matrix the global transmissibility matrix t is calculated by assembling the individual interfaces transmissibilities for the interface ij between cell i and cell j the interface transmissibility is t i j γ i j l i μ i k i l j μ j k j which is the harmonic mean of fluid mobilities ki μi and kj μj weighted by the cell centroid to face centroid distances li and lj within the two cells γ ij is the interface area between two cells the global storativity or compressibility matrix is a diagonal matrix with components s i i ω i 1 m i d ω the flow geomechanics coupling matrix at the element level is 27 q i ω i α b i t i d d ω the right hand side of the weak form of the mechanics problem consists of traction and body forces 28 f u γ t n t σ d γ ω n t ρ g d ω where γ t denotes neumann boundaries of the domain with the prescribed tractions σ 0 σ h t on the top boundary and σ σ h 0 t on the left boundary the right hand side of the weak form of the flow problem consists of prescribed fluxes and well terms for cell i 29 f i p q in q out we solve eq 25 using a direct solver next we discuss the solution of the ade eq 18 coupling between the poroelastic solver and the transport solver is implemented using a sequential one way coupled approach for relatively small values of r as considered here r 3 the transport to deformation coupling strength is expected to be weak because there is no explicit appearance of a concentration functional in eq 16 and concentration dependence of pressure is limited to the fluid mobility term this suggests that a one way coupled approach to solve the two way coupled transport deformation problem can be implemented to reduce computational cost without sacrificing accuracy we will test this hypothesis in section 5 by analyzing the magnitude of fingering induced stress and porosity changes resulting from transport to deformation coupling we discretize eq 18 in space using a sixth order accurate compact finite difference method lele 1992 jha 2013 we compute the discrete interface velocities using a two point flux approximation of eq 3 i e v i j t i j p i p j γ i j where vij is the velocity across the ij interface between cells i and j and pi and pj are the pressures of the two neighboring cells we compute the nx ny matrices of cell centered face normal velocities vx and vy using a linear interpolation of the interface velocities we integrate the semi discrete ode system over the time step δt of eq 25 using a third order explicit runge kutta rk method the residual function of the rk integrator which is the discretized form of the flux divergence term in eq 18 is f c v x d x c v y d y c c d x v x d y v y 1 pe ϕ d xx d yy c 1 pe d x ϕ d x c d y ϕ d y c 1 δ t c δ ϕ where dx dy dxx and dyy are the discrete nx ny differentiation matrices for the x y 2 x 2 and 2 y 2 operators respectively the differentiation matrices are pre computed outside the time loop using standard methods lele 1992 c ϕ and δϕ are nx ny matrices of cell centered concentration porosity and porosity increment fields evaluated at tn vx and vy are at t n 1 available from the poroelastic solver δ ϕ n 1 is calculated using eq 17 and we update porosity as ϕ n 1 ϕ n δ ϕ n 1 the operator above denotes the element wise multiplication of two arrays an adaptive time stepping method based on the courant friedrichs lewy cfl condition is used to ensure stability of the explicit transport solver the dimensionless time step is calculated as δ t γ l x max v where max v is the maximum magnitude of the dimensionless velocity over the entire domain the value of γ is chosen to ensure stability and smoothness of the coupled solution 5 numerical simulation here we present the parameter values of our base case simulation model we discretize the rectangular domain in fig 1 using a mesh with square elements the mesh has a sufficient number of elements to ensure that the fingers are resolved and the simulation finishes within a reasonable time frame 2 6 hours on our cluster see table 1 for values of the mesh initial condition and boundary condition parameters values of other parameters in the base case model are given in table 2 5 1 initialization initialization of coupled flow geomechanical models is a non trivial task settari and walters 2001 ideally the initial state initial stresses and pressure should be in mechanical and hydrostatic equilibria such that the initial strains and fluid fluxes inside the domain are zero theoretically this is achievable by prescribing a total initial stress tensor for each grid cell which balances the prescribed boundary stresses initial pressure and body forces in each direction and by prescribing an initial pressure distribution that honors the hydrostatic potential gradient including the effects of depth dependent compressibility and fluid contacts in case of reservoirs containing multiple fluids such as oil and water in complex cases e g heterogeneous distribution of ρ f 0 α plastic deformation or time dependent boundary conditions achieving mechanical equilibrium at t 0 can become a challenge and may require a separate initialization step during the simulation this is the approach we follow here to create a more robust formulation that is suitable for real world applications the stresses are initialized from the results of the first timestep during which the domain deforms under the action of boundary loads initial pressure and body forces the displacement field at the end of the initialization timestep is designated as the reference displacement field deformation at subsequent time steps are calculated from that reference configuration our initial concentration field consists of a partially injected tracer slug in the domain with a diffused interface between the two fluids initiation of fingering at the unstable interface requires a small perturbation in the velocity field which is achieved by perturbing either the permeability field or the concentration dependent viscosity field we choose the latter alternative by superposing small amplitude random wave number perturbations on the c 0 5 contour at the interface jha et al 2011b based on the parameters of the problem and the physics of saffman taylor instability homsy 1987 a few of these wave numbers or modes are selected as the unstable modes which grow to become fingers while other modes are damped and suppressed this is a result of the nonlinear dispersion relation between the growth rate and wavenumber tan and homsy 1986 which predicts short wavelength stability cutoff wavenumber and long wavelength instability yortsos and hickernell 1989 loggia et al 1995 and the presence of a selection mechanisms for the finger size in the transverse direction we utilize this mechanism in initiating the instability from a broadband random perturbation of the initial front which does not affect the fingering dynamics in our simulations at intermediate and late times 5 2 alternating injection we define an alternating injection cycle as the injection of one slug of the tracer fluid for a dimensionless duration of t inj followed by one slug of the more viscous fluid for the dimensionless duration t gap the total duration of one cycle is t cyc t inj t gap we implement this boundary condition at the injector as follows 30 c y 0 1 if i cyc 1 t cyc t i cyc 1 t cyc t inj 0 if i cyc t cyc t gap t i cyc t cyc where 1 i cyc n cyc is the alternating injection cycle number which is an integer and n cyc is the total number of cycles we choose t inj 0 7 and t gap 1 4 in this study we fix n cyc 1 the simulation stops when the entire tracer slug has exited the domain the breakthrough time tbr is defined when the maximum tracer concentration in the producer exceeds 0 1 which occurs when the fingers of the first tracer slug arrive at the producer the drainage time tdr is defined when no cell in the domain has a concentration exceeding 0 01 meaning most of the tracer has exited the domain 5 3 sensitivity simulations to better understand the coupling mechanisms between transport and deformation processes in real reservoirs whose properties can vary over a wide range we perform a sensitivity analysis to investigate the influence of rock fluid properties on the breakthrough and mixing results of the base case defined above we choose the following parameters of the problem as the sensitivity parameters the biot coefficient α peclet number pe log viscosity ratio r permeability field parameters σ logk 2 and ξy ξx fluid compressibility cf and the rock drained bulk modulus k each simulation provides spatial maps of nodal displacements ux and uy cell centered pressure p effective volumetric stress σ v von mises stress σvm concentration c porosity ϕ and face centered velocities vx and vy at user selected timesteps 6 results below we discuss the base case results extract the transport deformation coupling mechanisms and identify mechanisms sensitivity to important poroelastic parameters 6 1 base case fig 3 shows the development of viscous fingers during the simulation through nonlinear interactions of tip splitting shielding and coalescence of fingers tan and homsy 1988 zimmerman and homsy 1992 transversely averaged profiles of concentration and change in pressure are also shown at three time steps including at the breakthrough time t b r 1 16 with time both the leading and the trailing fronts of c stretch along the flow direction the leading front stretches because of fingering and the trailing front stretches due to diffusion the pressure profiles can be explained as follows as the volume occupied by the less viscous slug increases due to spreading the pressure decreases in the domain similarly when t tbr the domain is increasingly occupied by the more viscous fluid and pressure increases because we maintain the same injection rate this is the first order effect of tracer transport which does not show the detailed effect of fingering on deformation for the chosen values of the governing parameters the pressure profiles are smooth because of the dominantly diffusive nature of the pressure equation as opposed to the dominantly hyperbolic nature of the ade this also holds true for transversely averaged profiles or 2d maps of the effective volumetric stress σ v not shown because of the stress compatibility relation between laplacians of σ v and p mentioned earlier in general the pressure changes are negative which lead to negative or compressive change in σ v and ϕ leading to reservoir compaction as also shown in fig 5 6 2 transport deformation coupling mechanisms we are interested in observing the effects of poroelasticity on the tracer transport behavior and thereby extracting the transport deformation coupling mechanisms fig 4 shows important quantities from the three processes flow deformation and transport that are expected to define such coupling mechanisms to that effect we analyze the gradient fields of pressure stress and porosity we choose p because it drives advection in ade and appears as a body force in the mechanical equilibrium eq 5 we choose σ v because it drives volumetric deformation as per hooke s law σvm can also be analyzed to evaluate the shear deformation tendency we did not include a separate plot for σvm in fig 4 because for the base case parameter values σvm behaves almost identical to σ v this happens because initially the reservoir is in a principal state of stress with zero shear and hydrostatic loading from tracer transport does not induce significant shear finally we choose ϕ and dϕ dt because they appear in the deformation to transport coupling term on the rhs of ade eq 13 next we investigate the results at the observation point which is at the center of the domain lx 2 ly 2 as the tracer slug passes through the observation point the concentration first increases and then decreases in time as shown by δc in fig 5 a drop in pressure at the observation point leads to compressive stress change δ σ v 0 compaction δuy 0 and loss of porosity δϕ 0 δux becomes positive due to the poisson effect due to equal values of the boundary stresses and the hydrostatic loading from slug injection σ x x σ y y and the shear stress change is negligible δσxy 0 this leads to almost identical changes in δ σ v magnitude and δσvm fig 6 shows the evolution of mixing and spreading metrics χ ϵ c and c prd as the injection progresses χ increases due to fingering induced spreading of the tracer merging of the fingers and diffusion across the finger interface these sources of mixing affect the length and sharpness of the fluid fluid interface which are captured quantitatively by ϵ c as mentioned in section 3 2 ϵ c is a dynamic quantity itself spreading of the slug and entry of the trailing front act as sources of ϵ c and finger coalescence and diffusion act as sinks of ϵ c after breakthrough the mixed fluid exits the domain and the producer acts as a sink for both χ and ϵ c the balance between the sources and sinks of mixing determines when χ starts to decrease in fig 6 a entrance of the trailing front causes a spike in ϵ c because the concentration gradient is large across the front which causes a sudden jump in ϵ c followed by a drop due to smearing of the front from diffusion across the front fig 6 b the next event is breakthrough after which ϵ c starts to drop monotonically the breakthrough curve c prd t shows arrivals of the viscous fingers at the producer as wiggles all the fingers exit the domain by t 2 4 and mixing in the domain is purely diffusive after that which results in another sharp drop in the mean scalar dissipation rate fig 6b the breakthrough time tbr the time tmc at which c prd is maximum and the concentration c prd t m c are three important quantities during a contaminant remediation operation because their values indicate when and how much remediation effort is necessary at a given location in enhanced oil recovery applications e g waterflooding or co2 injection the same quantities determine the estimated ultimate recovery eur and the life of the well before it becomes uneconomical due to excessive production of the injectant compared to a purely diffusive r 0 mixing and spreading process viscous fingering shortens tbr and tmc and increases c prd t m c nicolaides et al 2015 we identify the coupling between transport and deformation processes by plotting mixing and spreading metrics against deformation metrics we plot the degree of mixing as a function of the root mean square rms of the change in porosity δϕrms and the breakthrough concentration as a function of the root mean square of the change in effective volumetric stress δ σ v r m s fig 7 as the transport deformation coupling becomes stronger e g α increases or k decreases from left most curve to right most curve in fig 7 the slope of χ vs δϕrms changes this signifies the dependence of the degree of mixing on the change in porosity due to different degrees of geomechanical coupling porosity is related to the volumetric strain of the reservoir and the effective volumetric stress is related to the total volumetric stress and pressure together they can characterize the state of volumetric deformation in the reservoir also the rms of change from initial porosity or stress is numerically comparable to χ because σ c 2 is defined as a mean of squared deviation eq 21 based on fig 4 we can also choose the rms of change in the von mises stress as a metric for shear deformation to investigate coupling between transport and induced shear failure events such as hydroshearing in geothermal rocks 7 sensitivity analysis fig 7 already shows how the degree or strength of coupling varies as α and k are varied here we analyze the sensitivity of the coupling mechanisms to various poroelastic parameters in detail 7 1 biot coefficient the biot coefficient α captures the strength of cementation between the grains relative to the grain compressibility we saw in the mathematical model section eq 9 that for an incompressible system or in the drained deformation case α δ ϕ δ ϵ v and the biot coefficient can be interpreted as the change in porosity for a unit change in the volumetric strain α also dictates the degree of coupling between flow and mechanics problems through the coupling terms in eqs 1 and 5 according to the compatibility relation of α 2 σ v 2 p α determines the deviation in σ v from its local average value for a given value of deviation from local average in pressure in other words for smaller values of α the effective volumetric stress is smoother and more independent of pressure fluctuations such as the fluctuations arising from fingering or permeability field α is less than 1 0 for rocks with high degrees of cementation and close to 1 0 for soft soil we vary it from 0 95 loose soil to 0 1 rigid tight rocks based on eq 13 we hypothesize that the effect of α on spreading and mixing is limited by the maximum change in porosity which is less than 1 in all the simulations considered here figs 8 and 9 analyze the effect of α on slug spreading and mixing behavior the main observation is that the effect is weak for the range of parameter values considered here tbr decreases with α and the degree of mixing at breakthrough χbr increases slightly with α α s effect on breakthrough is more significant than its effect on mixing the effect on spreading appears at late times after breakthrough fig 9 the reason is that the primary effect of α is on the finger velocity as α increases and the fingers move faster breakthrough occurs earlier the effect of α on χ is not significant because fingers do not spend enough time in our relatively short domain to cause a difference in mixing to better observe the effect of poroelastic or geomechanical coupling on the spatial distribution of tracer we plot the difference of concentration fields corresponding to different values of the biot coefficient which is a measure of the poroelastic coupling strength in fig 10 the fields are at respective breakthrough times as α increases we see that the concentration at the trailing front of the injected slug in the lower half of the figure increases this occurs because the finger velocities are different for different α more interestingly we observe concentration differences in the upper part of the domain where fingering occurs this difference becomes more pronounced as poroelastic coupling becomes stronger from left to right in fig 10 which suggests that neglecting poroelasticity can lead to an erroneous concentration field 7 2 permeability heterogeneity we vary the log permeability variance σ logk 2 and the ratio of correlation lengths ξy ξx as shown in table 3 σ logk 2 controls the range of permeability values in the domain at higher variances e g case 2 the more permeable regions of the reservoir will be connected by streamlines leading to channeling of the tracer and a shorter breakthrough time whereas the less permeable regions will act as stagnation or hold up zones leading to a long residence or slug removal time chen and meiburg 1998 nicolaides et al 2015 permeability heterogeneity controls the spatial distribution of the tracer and resident fluids and the control is exerted equivalently on both fluids eq 3 and the viscosity contrast controls the growth rate of the interface between the two fluids tan and homsy 1992 this leads to rapid stretching of the interface and subsequent mixing fig 11 shows c x y tbr for the three values of σ logk 2 we observe more spreading of the slug and hence expect an earlier breakthrough and higher degrees of mixing at higher heterogeneity levels this is confirmed in fig 8 presence of stagnation zones at higher σ logk 2 also contributes to larger spreading of the tracer slug and higher drainage time next we vary the ratio of permeability correlation lengths ξy ξx to evaluate the effect of channelized features on the transport characteristics we expect that case 4 with a longer correlation length along the flow direction will lead to tracer channeling and earlier breakthrough fig 12 shows that as ξy ξx increases the fingers are elongated in the y direction and thinner in the x direction fig 8 verifies the hypothesis of earlier breakthrough at ξy ξx 1 mixing of the slug is also enhanced across the longer interface achieved with larger ξy ξx 7 3 peclet number peclet number is the relative strength of advection compared to diffusion here we consider the range of 200 pe 700 a lower value of pe due to lower injection rate q in or higher diffusion dispersion coefficient dd leads to diffused fingers that are wider and fewer in number compared to another case with higher pe higher pe also means faster travelling fingers higher growth rate of the viscous instability homsy 1987 i e earlier breakthrough as seen in fig 13 and confirmed in fig 8 extensive tip splitting and merging of fingers lead to enhanced spreading and lower σ c 2 or higher χ merging of fingers increases the advective energy of the dominant finger to further spread the solute in the domain this balances against the lower diffusive flux at higher pe which causes a loss of diffusive mixing and lower χ the balance between the two mechanisms of splitting merging and diffusion results in a non monotonic profile of χbr vs pe shown in fig 8 7 4 viscosity ratio the log viscosity ratio r between the injected and resident fluids determines the number size width and speed of the fingers homsy 1987 since fingering plays a critical role in the development of miscibility between the two fluids and in recovering the resident fluid in case of miscible co2 injection in eor and the tracer fluid in case of contaminant remediation r is an important parameter for sensitivity analysis when we inject a less viscous fluid into the aquifer r 0 the degree of mixing at breakthrough can be as much as 88 higher compared to injecting a tracer with r 0 fig 8 this is due to faster tip velocities of the fingers which lead to faster spreading of the slug fig 14 as fingers develop dispersion or spreading of the solute becomes stronger resulting in sharper concentration gradients and a longer interface which in turn augments the diffusive flux and the degree of mixing 8 summary and conclusion we investigated the coupling between poroelastic deformation and solute spreading and mixing during viscous fingering using high resolution numerical simulations motivated by the difference in the mathematical nature of the governing equations we proposed a numerical formulation of a monolithic flow geomechanics solver sequentially coupled to a transport solver via the velocity field and the concentration dependent mobility model transport deformation coupling mechanisms and their sensitivity to poromechanical parameters were identified and analyzed a sensitivity analysis was performed to obtain the extent of poroelastic influence on the macroscopic transport quantities the breakthrough time the breakthrough curve and the degree of mixing the sensitivity analysis considered the heterogeneity in permeability field the biot coefficient log viscosity ratio r and peclet number the parameters and their values were chosen to represent injection in real world confined aquifers the results show that the poroelastic processes influence solute transport from fig 8 we observe that spreading of the injected tracer slug is accelerated i e breakthrough occurs earlier when the rock is less consolidated or more loosely packed viscosity contrast increases or diffusion is weaker compared to advection mixing of the injected slug is enhanced when rock becomes less consolidated and more deformable failure to account for this coupling will result in an inaccurate prediction of the breakthrough time solute recovery and the degree of mixing thus an inaccurate determination of the efficiency of the groundwater remediation or enhanced oil recovery operation the 2d study presented here can be extended to 3d the physical mechanisms of advection diffusion and pressure induced deformation will carry over from 2d to 3d however we may observe the following changes the flow field around the wells will change from linear to radial resulting in a 3d stress field which will not satisfy the plane stress approximation including the vertical dimension to the domain will activate gravity which appears as a body force in the mechanics problem and as a velocity potential in the flow problem the effect of gravity as a body force can be absorbed into the initial stresses because we assume the bulk density to remain constant in time also since we assume a slightly compressible fluid with a density that is independent of the tracer concentration spatial variations of the fluid density can be neglected therefore we believe our main result related to transport deformation mechanisms are generalizable our workflow employs different discretization methods for different sub problems finite element method for the mechanics problem finite volume method for the flow problem and compact finite difference method for the transport problem finite element and finite volume methods can be applied easily to unstructured grids because the volume and surface integrals required for terms in eq 25 can be evaluated for arbitrary shapes and orientations however the compact finite difference method is more appropriate for a structured grid because we assume that the grid lines are oriented parallel to the two cartesian directions of our 2d domain with a fixed number of cells in each grid direction in other words fixed values of nx and ny in x and y directions are required to build the differentiation matrices and discretize the spatial derivatives in the transport solver to extend our work to unstructured grids one may consider using a compact high order finite volume method ollivier gooch and altena 2002 to solve the transport problem credit authorship contribution statement minh tran software data curation writing original draft visualization investigation validation birendra jha conceptualization methodology software supervision writing review editing funding acquisition resources declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment funding from american chemical society petroleum research fund number 58769 dni9 is acknowledged 
529,advances in hydraulic fracturing technology are promoting global interest in the simulation of the transient flow in fractured porous media boundary element method bem is widely used in pressure transient analysis because of its high precision and simple discretization of the boundaries and the fractures however bem is computationally expensive when real heterogeneities and large numbers of fractures are modeled a green element method gem based discrete fracture model dfm is proposed in this paper to address this problem and this is the first study to enrich the gem in modeling the transient behavior of heterogeneous porous media with discrete fracture networks gem is applied to handle formation heterogeneities and discrete fractures first a new mathematic model and integral formulation are proposed with the consideration of formation heterogeneities and discrete fractures next structured cartesian grids are used to discretize the domain and characterize the heterogeneities and discrete fracture networks are embedded into the domain grids then gem is used to handle fluid flow between connected domain blocks and between a domain block and connected discrete fracture segments the finite difference method fdm is used to model fluid flow between connected discrete fracture segments the solution of the model is obtained by coupling the two systems two validation cases and several synthetic cases are used to verify the precision efficiency and application of the proposed gem based dfm the results show that the proposed model is precise and efficient by comparing it to the bem and a commercial simulator the number of integrals and the computation are largely decreased by applying the boundary integral equation to each local block finally a field example with several synthetic cases is studied to show the model s application the proposed gem based dfm serves as a good tool for simulation of the transient flow in heterogeneous fractured porous media keywords reservoir simulation discrete fracture model green element method transient behavior heterogeneity hybrid model nomenclature b fluid volume factor m3 m3 cfd dimensionless conductivity of fracture ct total compressibility mpa 1 ctm total compressibility of matrix mpa 1 ctf total compressibility of fracture mpa 1 ctf total compressibility of the discrete fracture mpa 1 g fundamental green s solution h formation thickness m hm height of the matrix slabs m k permeability md kf fracture permeability dual porosity md kfd dimensionless fracture permeability kf discrete fracture permeability md kfd dimensionless discrete fracture permeability km matrix permeability md kr reference permeability md l the length along a fracture m ld dimensionless length along a fracture l length of fracture matrix block m lr reference length m nj lagrange shape function n outer normal on the boundary p pressure mpa pf fracture pressure dual porosity mpa pfd dimensionless fracture pressure pf discrete fracture pressure mpa pfd dimensionless discrete fracture pressure pi initial pressure mpa pm matrix pressure mpa pmd dimensionless matrix pressure pw bottom hole pressure mpa q flow rate m3 d qmf inter porosity flux 0 0864 d 1 qfd dimensionless pressure normal derivative qf flux strength along the fracture m2 d qfd dimensionless flux strength along the fracture qr reference flow rate m3 d qw wellbore production rate m3 d qwd dimensionless wellbore production rate r radial direction m rd dimensionless radius rm radius of the spherical matrix m s laplace constant t time day t transmissibility m 1 wf fracture width m x x direction m xd dimensionless x direction y y direction yd dimensionless y direction z compressibility factor of gas greeks symbols φ porosity m3 m3 φ m porosity of matrix m3 m3 φ f porosity of fracture dual porosity m3 m3 φ f porosity of discrete fracture m3 m3 ψ pseudo pressure mpa mpa s ω domain γ boundary η pressure transfer coefficient md mpa mpa s η md dimensionless pressure transfer coefficient of matrix η fd dimensionless pressure transfer coefficient of fracture dual porosity differential operator μ fluid viscosity mpa s δ dirac constant λ inter porosity flow coefficient α shape factor m 2 ω fracture storativity θ i the angle enclosed by the boundary ξ distance in ξ direction ζ distance in ζ direction superscripts laplace transform i the ith fracture element j the jth boundary element k the kth fracture element b boundary e the eth block f fracture nf the nf th fracture element subscripts d dimensionless f fracture system of the dual porosity model f discrete fracture m matrix system of the dual porosity model ef the efth fracture element i the ith element j the jth element k the kth element sc surface condition w wellbore 1 introduction the underground formation is rich in natural fractures in addition many artificial fractures are generated by hydraulic fracturing which is widely used in co2 sequestration geothermal and petroleum industry in addition to large scale hydraulic fractures many small scale natural fractures are activated during fracturing stimulation and the activated natural fractures are called induced fractures in general the fractures are always with heterogeneities so it is quite important to propose a comprehensive model to capture the transient behavior in the heterogeneous fractured formation the fractures in the formation are often divided into two types the first type is small scale induced fractures which are small in size and large in number because it is often impossible to describe these fractures precisely continuum models are proposed to capture the flow behavior like enhanced single porosity model dual porosity model and multi porosity model warren and root 1963 kazemi 1969 de swaan 1976 raghavan and ohaer 1981 serra et al 1983 pruess and narasimhan 1985 wu and pruess 1988 wu et al 2004 the second type of fracture is large scale hydraulic fractures which are sporadically distributed in the formation the large scale hydraulic fractures generated by hydraulic fracturing are also called main fractures the main fractures are small in number and large in size dual porosity models do not correctly capture their flow behavior so the main fractures are often handled explicitly cinco ley et al 1978 ozkan and raghavan 1991a 1991b chen and raghavan 1997 biryukov and kuchuk 2012 kuchuk and biryukov 2014 zhou et al 2012 jia et al 2015 he et al 2017 to capture the multiscale fractures in the formation hybrid models are often used by many researchers jia et al 2016 jiang and younis 2016 2017 cheng et al 2017 ding et al 2018 in these models small scale fractures are handled with enhanced single porosity or dual porosity model large scale fractures are handled explicitly the advantage of the hybrid model is that the computational burden is largely reduced with tolerated precision at present there are mainly three types of methods to obtain the transient behavior for fluids flow in the heterogeneous fractured formation the first type of method is based on multi region linear flow models including enhanced fracture region model tri linear flow model and five region model brown et al 2009 brohi et al 2011 stalgorova and mattar 2013 wu et al 2016 in these models the formation is divided into several regions and different regions are given different properties to capture the heterogeneities the flow in each region is assumed to be linear to derive the analytical solution using laplace transformation however complex fracture geometries cannot be captured with these analytical models for the complexities in the formation the second type of method is based on green s function and bem the biggest advantage of this kind of method is the high precision of green s solution in addition complex fracture networks can be modeled with this method by discretizing large scale fractures into several segments and treating each segment as a source or sink to handle complex boundaries and heterogeneities of the formation the domain is often divided into several subregions in many bem models the boundary between two connecting regions is divided into several segments and the whole system is coupled to obtain the solution numbere and tiab 1988 kikani and horne 1993 jongkittinarukorn and tiab 1998 lough et al 1998 idorenyin and shirif 2016 jia et al 2017 cao and killough 2017 wu et al 2019 however a more rigorous model is needed to obtain the flow behavior more precisely when more heterogeneities information is known in addition it is impossible to model real heterogeneities with composite models the third type of method is based on numerical models in which heterogeneities can be incorporated easily so far many dfms and embedded discrete fracture models edfms are widely proposed to simulate fluids flow in fractured systems kim and deo 2000 lee et al 2001 karimi fard et al 2003 matthai et al 2005 reichenberger et al 2006 li and lee 2008 hoteit and firoozabadi 2008 warpinski et al 2009 cipolla et al 2010 mayerhofer et al 2010 moinfar et al 2012 wu et al 2014 karimi fard and durlofsky 2016 yan et al 2016 jiang and younis 2017a 2017b tang et al 2018 flemisch et al 2018 most of the models are based on fdm the fractures are represented explicitly and refined grids are often used to capture the flow behavior around discrete fractures gem is another accurate numerical method which is first proposed by taigbenu 1995 gem is accurate even in very early flow regimes and not grid sensitive for its rigorous green s function basis comparing to bem gem is more efficient in computation because a sparse matrix is obtained with gem while a dense matrix is generated with bem moreover heterogeneous and nonlinear problems can be handled with gem to enhance the computational accuracy of gem several modifications are proposed including flux vector based gem pecher et al 2001 lorenczi et al 2006 2009 2011 and many flux correct formulations taigbenu 2003 2004 2008 2012 rao et al 2018 the modified gem is suggested to have second order accuracy even with relatively coarse grids system so it is very convenient in transient behavior analysis for fluid flow in the porous media with heterogeneity anisotropy and nonlinear problems unfortunately this method has not been widely used in transient behavior analysis in addition fractures in different scales should be handled before the gem being used to analyze the transient behavior in fractured media in this work we proposed a dfm based on the flux correct gem taigbenu 2008 to make it suitable for handling complex fractures explicitly structured cartesian grids are used as domain grids to discretize the integral equation and discrete fracture networks are embedded into the domain grids and discretized correspondingly in this paper we first presented the physical and mathematical model for fluid flow in fractured porous media with heterogeneities then the mathematical fundamentals of the modified gem were introduced finally we verified the solution and presented several examples to demonstrate its application 2 physical model hydraulic fracturing is widely used in many fields such as geothermal and petroleum industry after hydraulic fracturing a stimulated reservoir volume srv including many large scale main fractures and small scale induced fractures are generated around the wellbore microseismic data is used to interpret these fractures fig 1 a shows a map view of the microseismic moment density and microseismic events of three hydraulically fractured horizontal well maxwell and cipolla 2011 the microseismic events are used to generate the large scale main fractures the contour of the seismic moment density can be used to generate the small scale induced fractures fig 1 b shows a schematic of the interpreted multi scale fractures including large scale fractures and small scale fractures there are three kinds of media including large scale fractures small scale fractures and rock matrix fig 1 c shows the conceptual model to handle multi scale fractures for the case shown in fig 1 b the large scale main fractures are represented explicitly and the small scale induced fractures and the rock matrix are modeled using dual porosity models the schematic of the dual porosity system is shown in figs a 1 and a 2 we should note that there are mainly two steps to generate the model shown in fig 1 c the first step is fracture modeling which generates the fracture configuration shown in fig 1 b in the second step large scale fractures are extracted and small scale fractures are upscaled into the dual porosity system as shown in fig 1 c geological data well logs and microseismic data are often used in fracture modeling at present this technique is not mature and more work needs to be done concerning this problem the analytical method proposed by oda 1985 can be used to upscale the small scale fractures into the dual porosity system in this paper we just simply assume that there is a linear relationship between the seismic moment density in fig 1 a and the shape factor and porosity of the dual porosity system in fig 1 c because the model generated using the two steps is with many uncertainties history matching is often used to calibrate the model because of the heterogeneities of natural fractures and young s modulus of rock the fractures created by hydraulic fracturing are often heterogeneous as suggested by fuentes cruz et al 2014 and fuentes cruz and valko 2015 the induced fracture system is heterogeneous and the density of the induced fractures is higher near the main fractures rather than far away from the main fractures as shown in fig 2 this is because the shear stress and deformation density near the hydraulic fractures is much higher than far away from hydraulic fractures and more natural fractures near the hydraulic fractures can be reactivated in the process of hydraulic fracturing mayerhofer et al 2010 maxwell and cipolla 2011 therefore the heterogeneities are taken into consideration in this paper as shown in fig 1 the heterogeneities of induced fractures shown in fig 1 b can be easily captured by using the heterogeneous dual porosity model shown in fig 1 c after discretizing the reservoir into many blocks we can give different blocks with different properties to capture the heterogeneities including shape factor porosity and permeability here one should note that the blocks in figs 1 c and 2 are totally different the blocks in fig 2 are matrix blocks of the dual porosity system and they are in small scale the size of the blocks signifies the induced fracture density which is characterized using the shape factor of the dual porosity system the blocks in fig 1 c are the cartesian grids of the numerical approach and they are in large scale in this model each block in fig 1 c is a dual porosity system shown in fig 2 when the dual porosity model is used to characterize the small scale fractures in the srv in this paper the following assumptions are made to obtain the solution of the conceptual model shown in fig 1 b 1 the thickness of the formation is assumed to be constant and the formation is fully penetrated by the fractures so the model is assumed to be two dimensional in practice the thickness of some target formations are not very large many target formations in unconventional reservoirs are within 50 m the formations are easy to get fully penetrated in hydraulic fracturing in addition the permeability in the vertical direction is rather lower than that of the horizontal direction in deep formations the vertical permeability is often assumed to be 1 10 of the horizontal permeability in oil and gas reservoirs therefore the two dimensional model can be used under these circumstances however the present two dimentsional model cannot be used to the cases with the formation thickness varying significantly and we will continue working on extending the present model to real three dimensional problems and taking the gravity into consideration 2 the rock is assumed to be slightly compressible this assumption is often used in model derivation because of the stiffness of rock in addition only isotropic media is considered at present 3 single phase flow is modeled single phase flow is very common in the underground water petroleum and geothermal systems however more rigorous model should be used when multi phase flow is exhibited in the formation 4 the horizontal well is assumed to only connect with the main fractures because casing perforation completion is often used in petroleum engineering and geothermal systems 5 the temperature in the formation is assumed to be constant in the sections which follow we present the mathematical fundamentals of the mathematic model verify its results and present some examples to demonstrate its utility 3 mathematical model in this section we first present the theoretical model for fluid flow in the dual porosity system and the discrete fracture networks next numerical techniques of the gem based dfm model are presented for flow in the dual porosity system the bem theory is also simply presented for comparison then the fdm solution is presented for flow within the discrete fracture networks finally the coupled solution of the two systems is presented 3 1 description of the theoretical model as shown in section 2 three kinds of media including large scale fractures with the subscript f in the following formulations small scale fractures with the subscript f and rock matrix with the subscript m are included in the system section 3 1 1 presents the mathematical model of the dual porosity system including the matrix and small scale fracture system section 3 1 2 presents the model for fluid flow within the large scale fracture system the discrete fractures 3 1 1 model for flow in the dual porosity system in this section the mathematical model is based on the conceptual model shown in fig 1 b heterogeneous problems are addressed and different blocks are with different properties in this paper but the properties in a single block are regarded as homogeneous this will make it convenient to compare the results with other numerical methods in addition this makes it easy to couple the proposed model with the widely used commercial reservoir modeling software like petrol which generates models with block based properties therefore we derived the model based on the homogeneous assumption for each block dual porosity models are efficient in modeling fluid flow in the domain with many small scale fractures because of the complexities of real models several conceptual models are proposed to idealize the matrix blocks to obtain the analytical solution of the dual porosity model including cylinders slabs and squares warren and root 1963 kazemi 1969 de swaan 1976 raghavan and ohaer 1981 serra et al 1983 in the following only the derivations of the scenario with cylindrical shaped matrix blocks are presented and the results of other scenarios are directly given in appendix a the sketches of different idealizations are shown in fig a 1 for flow in the dual porosity system with the cylindrical shaped matrix blocks the governing equation for the cylindrical matrix blocks is given by 1 1 r r r p m r μ ϕ m c t m k m p m t when transient state inter porosity flow is assumed the flux exchange happens on the boundary for a matrix block shown in fig a 2 therefore the term qmf is not added in eq 1 instead the pressure continuity condition shown in eq 4 is used as the coupling condition the initial condition is 2 p m r t 0 p i the inner boundary condition is 3 p m r r 0 0 the outer boundary condition is coupled with the fracture system and given by 4 p m r m t p f the inter porosity flux is given by 5 q m f 2 r m k m μ p r r r m in which rm is the matrix block size eqs 1 4 can be solved in laplace space analytically the results using the dimensionless variables defined in appendix a and taking the laplace transformation of eqs 1 4 with respect to the dimensionless time yields 6 1 r d r d r d p m d r d s η m d p m d p m d r d r d 0 0 p m d r m d t d p f d the solution of the model suggested in eq 6 is 7 p m d i 0 r d s η m d i 0 r m d s η m d p f d thus 8 p m d r d r d r m d i 1 r m d s η m d i 0 r m d s η m d s η m d p f d where i υ is the modified bessel function of the first kind υ 0 1 the governing equation for the fracture system is given by 9 x k f p f x y k f p f y μ q m f μ ϕ f c t f p f t here one should note that the matrix and fracture system are coupled using the boundary conditions shown in eq 4 and the flux term shown in eq 5 for the transient state flow problem for the matrix system the inter porosity flux shown in eq 5 is the result of the model shown in eqs 1 4 and it acts on the boundary of the matrix block so the flux term is not added in eq 1 for the fracture system the inter porosity flux is regarded as a domain flux term so it is added in eq 9 another formulation is to add the flux term in both the fracture and matrix equations and the boundary conditions in eqs 3 and 4 are not needed however if this formulation is used the analytical solution cannot be obtained it should be noticed that eq 9 is the governing equation for fluid flow in heterogeneous dual porosity media this is valid for fluid flow in a single block shown in fig 1 b we should also notice that no discrete fractures are considered in eq 9 in this paper large scale main fractures are handled explicitly with the green element method where the fractures are discretized into several segments and each segment is treated as a line sink thus the governing equation for the system can be written as 10 x k f p f x y k f p f y μ q m f q f f b μ h μ ϕ f c t f p f t different from the flux term the third term in eq 10 of the dual porosity system the discrete fractures do not act on the whole domain so the flux term caused by the discrete fractures is expressed as 11 q f f n 1 n f γ n q f l δ x y d l where qf is the flux strength along the discrete fracture it is the flow rate per unit length γ n is the nth discrete fracture line nf is the total number of discrete fractures x is a point in the two dimensional space and y is a point located on the discrete fracture line δ x y is the dirac delta function which is given as 12 δ x y 0 x y x y which satisfies the following property 13 ω f x δ x y d ω f y where ω is the domain substituting eq 5 into eq 10 results in 14 2 p f 2 r m k m k f p m r r r m b μ h k f n 1 n f γ n q f l δ x y d l μ ϕ f c t f k f p f t equilibrium is assumed for the initial state of the reservoir and the pressure in the whole reservoir is assumed to be the same using the dimensionless variables defined in appendix a and taking the laplace transform of eq 14 with respect to the dimensionless time results in 15 2 p f d 2 r m d k m k f p m d r d r d r m d 2 π k f d n 1 n f γ n q f d l d δ x d y d d l d s η f d p f d substituting eq 8 into eq 15 results in 16 2 p f d s f s p f d 2 π k f d n 1 n f γ n q f d l d δ x d y d d l d 0 where 17 f s 1 η f d λ 4 s 8 1 ω s λ ω η f d i 1 8 1 ω s λ ω η f d i 0 8 1 ω s λ ω η f d where qfd is defined by q f d q f l r q r ω is fracture storativity ratio λ is the inter porosity flow coefficient it should be noted that f s is different for different realizations of the dual porosity system this is shown in eq a 17 3 1 2 model for in the discrete fracture networks the aperture of the fractures in the formation is very small in the petroleum industry the aperture is often given as 10 3 10 2 m jia et al 2016 jiang and younis 2017b therefore for a discrete fracture the flow is assumed to be one dimensional and the governing equation is 18 2 p f l 2 b μ k f q f w f h μ ϕ f c t f k f p f t because the fracture aperture is very narrow compared to its length so the flux contribution to the fracture tip is neglected in this paper and a closed boundary is assumed at the fracture tip 19 p f l t i p 0 if a fracture is connected to the wellbore the inner boundary is given by 20 p f w p w 21 p f j l w j q w j b μ w f j k f j h where pw is the pressure at the wellbore qwj is the production rate at the surface standard condition from the jth fracture connected to the wellbore wfj and kfj are the width and permeability of the jth fracture for multiple fractured horizontal wells there are several perforations and each perforation is stimulated with hydraulic fracturing the total flow rate of the wellbore is the summation of all the connected fractures 22 j 1 n p q w j q w where np is the total number of fractures that are connected with the wellbore qw is the production rate of the wellbore using the dimensionless variables defined in appendix a and taking the laplace transformation of eqs 18 22 with respect to the dimensionless time results in 23 2 p f d l d 2 2 π c f d q f d s η f d p f d 24 p f d l d t i p 0 25 p f w p w 26 p f d j l d w j 2 π c f d q w d j 27 j 1 n p q w d j 1 s it should be noted that the definition of qwdj is q w d j q w j q r which should be distinguished from qfd for constant rate cases qr is often chosen as the total production rate qw 3 1 3 coupling conditions for flow in the two systems the flow in the dual porosity system and the discrete fracture system should be coupled to obtain the solution and the coupling conditions are given based on the flux exchange of the two systems and pressure continuity conditions at the contacting points the flux exchange between the two systems is characterized using the line sink qf in eqs 14 and 18 and eqs 16 and 23 in addition the pressure is assumed to be equal at the connecting point of the two systems on the discrete fractures and is written as 28 p f d x d y d p f d x d y d 3 2 bem and gem based dfm for flow in the dual porosity system in this section we presented mathematical fundamentals for the proposed gem based dfm which is used to obtain the numerical solution of the theoretical model proposed in section 3 1 1 we also made a theoretical comparison between bem and gem for handling fluid flow in porous media with discrete fractures the procedures to obtain the solution using gem is quite like bem first the integral equation should be derived based on green s second identity then we discretized the boundary for bem and the domain for gem and the main fractures should be discretized for both methods finally equations are generated using the grids system and solved to obtain the solution 3 2 1 integral equation like other boundary element based methods gem begins by finding the relevant free space green s function for the problem for the transient problem described by eq 16 the fundamental green s function in free space is given by 29 2 g s f s g δ x d x di 0 in which g is the fundamental solution in free space δ x d x di is the dirac delta function it is not the same function shown in eq 11 x di is a point in the two dimensional domain for two dimensional problems the fundamental solution of eq 29 for a homogeneous domain in laplace space is zauderer 1983 30 g 1 2 π k 0 r d s f s where k 0 x is the modified bessel function of the second kind rd is the distance between a field point and the source point and given by 31 r d x d x d 2 y d y d 2 eq 29 p f d eq 16 g and taking the integration within the domain results in 32 ω p f d δ x d x di d ω ω p f d 2 g g 2 p f d d ω ω g 2 π k f d n 1 n f γ n q f d l d δ x d y d d l d d ω for the term on the left hand side of eq 32 we can drop the integral over the domain using the property of the dirac delta function 33 ω p f d δ x d x di d ω θ i 2 π p f d i in which θ i is the nodal angle at the point i θ i is the angle enclosed by the boundary for a point on the boundary θ i equals 2π for a point within the domain according to green s second identity 34 ω p f d 2 g g 2 p f d d ω γ p f d g n g p f d n d γ where γ is the boundary of the domain ω n is the outward pointing normal on the boundary for the second term on the right hand side of eq 32 it can be simplified using eq 13 35 ω g 2 π k f d n 1 n f γ n q f d l d δ x d y d d l d d ω 2 π k f d n 1 n f γ n g q f d l d d l d substituting eqs 33 35 into eq 33 results in 36 θ i 2 π p f d i γ p f d g n g p f d n d γ 2 π k f d n 1 n f γ n g q f d d l d 0 eq 36 is the integral equation of the model discretization approximation is needed to solve the model in the following we presented the discretization of eq 36 using bem and gem respectively for comparison 3 2 2 bem based dfm in this section we introduced the bem based dfm to make a comparison with the proposed gem based dfm we use the example shown in fig 3 to illustrate the discretization of bem in this case only the boundary and the fractures are discretized the boundary is discretized into nb elements the fracture networks are discretized into nf elements here one should notice that this model can also handle fractures connected to the boundaries when closed boundaries are handeled this problem can be handled with no changes when other kinds of boudnaries are considered in the model we just need to change the boundary conditions eqs 19 and 24 of these fractures the discretized form of eq 36 is given by 37 θ i 2 π p f d i e 1 n b γ e p f d g n g p f d n d γ 2 π k f d n 1 n f γ n g q f d d γ 0 in which γ bj and γ fk are the jth boundary element and kth fracture segment if the boundary and the fracture elements are regarded as constant elements that is the properties of each element are uniformly distributed eq 37 can be further simplified to 38 θ i 2 π p f d i j 1 n b p f d γ b j g n d γ j 1 n b p f d n γ b j g d γ 2 π k f d k 1 n f q f d γ f k g d γ 0 if the point i in eq 38 is located on the boundary elements and fracture elements we obtain nb nf equations however there are 2 nb nf unknowns so other nb nf equations are needed to obtain the solution the boundary conditions and the flow equation within the fracture system are used to this in general the boundary condition is classified into three types they are given as follows dirichlet boundary condition pfd c 1onγ neumann boundary condition k p f d n c 2 on γ cauchy boundary condition ζ 1 p f d ζ 2 k p f d n c 3 on γ where c 1 c 2 c 3 ζ1 and ζ2 are constants using the boundary conditions of the nb boundary elements we can obtain nb functions which are used to eliminate nb unknowns in the model in this way we obtain the following equations 39 a n b n b b n b n f o n b n f c n f n b d n f n f f n f n f u n b 1 q n f 1 p n f 1 r n b 1 s n f 1 in which u is the unknown vector for the boundary it is the flux for a constant pressure boundary and it is the pressure for a closed boundary q and p are the flux and pressure on the fracture elements a b c d and f are coefficient matrixes with non zero elements o is a matrix with all zero elements r and s are vectors it is found that there are only nb nf equations in eq 39 so we still need nf equations to solve the model in this paper the fdm is used to handle flow within the fracture networks and nf equations are obtained and this is presented in section 3 3 the computational efficiency of eq 39 is not good because a dense matrix is generated using bem in addition the computational expense is very high in calculating the integrals in the coefficient matrix of eq 38 numerically for transient problems the fundamental green s solution g should be updated step by step so the integrals should also be calculated at every step it should be noted that there are nb nf 2nb nf integrals in the equations in each time step this number can be decreased to nb nf 2 if the outer boundary is assumed to be closed if nt steps are modeled the total number of integrals should be at least nt nb nf 2 therefore the bem is quite time consuming if many boundary elements and fracture segments are handled in the model the procedures used in the bem based dfm can be summarized in fig 4 3 2 3 gem based dfm in conventional gem models the transient flow problem in porous media with multiscale fractures is not addressed in this section the grids system and discretization method are presented for the proposed gem based dfm gem requires the entire domain to be discretized and has good adaptability to the grids system in this paper cartesian grids are used to discretize the domain and one dimensional grids are used to discretize large scale fractures as shown in fig 1 b there are mainly three advantages for the application of cartesian grids first the discretization of cartesian grids is very convenient to use besides detection of the intersection points between individual fractures and the cartesian grids provide a natural way to discretize the fracture networks in addition many domain grids are the same if the cartesian grids are used this will greatly decrease the number of integrals in the coefficients and save computation time however for realistic cases groundwater simulation in fractured rock formations usually requires the challenge of unstructured mesh generation lee and ni 2015 lee et al 2019 it is promising to explore the extension of simulation with three dimentional unstructured mesh as shown in fig 5 a schematic is used to present the connections of domain grids and individual fractures first the domain is discretized into several blocks with the cartesian grid then discrete fractures are embedded into the domain grids and discretized if a fracture intersects with the edges of the domain grids and other discrete fractures in each block the four corner nodes are used as solution points of unknown pressures in the dual porosity formation the midpoint of each fracture element is used as the solution point of the pressure of the fracture element and the flux from the block to each fracture element is assumed to be uniform fluid flow in the system can be discretized into three processes and the example shown in fig 5 is used to explain these processes the first process is the flow between the matrix and small scale fracture of a dual porosity block for example m1 and f1 this process is analytically incorporated into the sf s as shown in eq 17 the second process is the flow between dual porosity blocks the small scale fracture system for example f1 and f2 this is calculated using eq 40 and all the connected blocks are coupled at the solution points in this process the discrete fracture segments are regarded as sinks for a block for example f2 f3 f4 and f5 are sinks of the block f2 and a dual porosity block and the connected discrete fracture segments are coupled using the continuity of pressure shown in eq 28 and the sinks q f d in eqs 40 and 65 the fluid flow between dual porosity blocks and discrete fracture elements is computed with the gem based dfm and the mathematical fundamentals will be presented in this section the third process is fluid flow between discrete fracture segments for example f1 f2 f3 etc to further explain this we extracted the discrete fractures from fig 5 and the extracted fractures are shown in fig a 3 the fluid flow between adjacent fracture segments is computed with the segment center based fdm presented in section 3 3 for example f1 and f2 for each fracture element the fluid contribution from the connected dual porosity block is regarded as a source term for example qf1 is a source term of f1 in section 3 3 we will also present the approaches to handle cross fractures for example f2 f3 f4 and f5 boundary conditions at the fracture tips and fractures connected to the wellbore the integral equation presented in eq 36 for homogeneous problems can also be applied to each block which is assumed to be homogeneous the integral equation for the eth grid is written as 40 θ i 2 π p f d i j 1 4 γ b e j p f d g n d γ j 1 4 γ b e j p f d n g d γ 2 π k f d k 1 n f e γ f e k g q f d d γ 0 for the eth grid ω e is the domain of the gird γ be is the boundary of the domain ω e for the rectangular grids system there are four boundaries for each gird γ bej is the jth boundary element γ fe is the fracture element within the eth grid assuming there are n f e fracture elements within the eth grid γ fek is the kth fracture element the element with the subscript and superscript of e mean the element is numbered within the eth grid if e is dropped it means the elements are numbered in the whole system ω is the whole domain γ bj is the jth edge among all the edges of the domain grids γ fk is the kth fracture element among all the fracture elements in each dual porosity block the corners are used as the solution nodes for the unknown pressures in the dual porosity formation and the parameters for the integrals over the edges are calculated by interpolation each fracture element is treated as a sink within the block and fluid does not flow through the edges to the connected discrete fractures the fracture elements are treated as constant elements which means that the properties are uniform in each fracture element the second and third term in eq 40 are integrals over the edges of the blocks both the pressure p f d and pressure derivative p f d n for each edge are approximated in terms of the values at the two solution nodes of each edge the linear shape function is 41 p f d p f d 1 n 1 p f d 2 n 2 in which n 1 1 ξ n 2 ξ eq 41 is also used for the approximation of p f d n for each edge of a block then eq 40 is transformed to 42 θ i 2 π p f d i j 1 4 r i j e p f d j j 1 4 l i j e q f d j e k 1 n f e v i k e q f d k 0 where 43 r i j e γ b e g n n j d γ 44 l i j e 1 k f d γ b e j g n j d γ 45 v i k e 2 π k f d γ f e k g d γ 46 q f d j e k f d p f d j n for the e th element from eq 42 several equations are generated if the observation point i runs over the corner points of a block or over the mid points of the fracture segments within the block these equations are used to obtain the solution of the model it should be noticed that the unknown pressure normal derivative q f d j e is with a superscript e unlike the pressure p f d j this signifies that the pressure normal derivatives at the same corner point j are supposed to differ for different domain blocks for the cartesian grids used in this paper four blocks interact at a solution point within the domain and two blocks interact at a solution point on the boundary each block has a pressure normal derivative at the same solution point however the unknown pressure should be continuous at this point and all the connected blocks share one unknown with so many unknowns at the same point the model equations and the closure problem will be addressed in the next section here it is important to restate the pressure continuity condition shown in eq 28 for a point on a discrete fracture segment 47 p f d i p f d if i is located on the fracture the flux connectivity at the solution points of the domain grids the closure problem will be presented in section 3 2 4 and the flux connectivity at the discrete fractures will be presented in section 3 2 5 3 2 4 solution system construction and its closure problem as shown in eq 42 four equations are generated if the point i subsequently runs over the four corner points of the eth block we can write the four equations in the following form 48 a m e p f d l m e q f d e v m e q f d 0 where 49 p f d p f d 1 p f d 2 p f d 3 p f d 4 q f d e q f d 1 e q f d 2 e q f d 3 e q f d 4 e q f d q f d 1 q f d 2 q f d n f e 50 a m e r 11 e θ i 2 π r 12 e r 13 e r 14 e r 21 e r 22 e θ i 2 π r 23 e r 24 e r 31 e r 32 e r 33 e θ i 2 π r 34 e r 41 e r 42 e r 43 e r 44 e θ i 2 π 51 l m e l 11 e l 12 e l 13 e l 14 e l 21 e l 22 e l 23 e l 24 e l 31 e l 32 e l 33 e l 34 e l 41 e l 42 e l 43 e l 44 e v m e v 11 e v 1 n f e e v 21 e v 2 n f e e v 31 e v 3 n f e e v 41 e v 4 n f e e for a corner point θ i π 2 it should be noted that the third term in eq 48 equals zero if there are no fracture elements in the eth block because lm e is a square matrix with no zeroes so eq 48 can be rewritten as 52 q f d e a p m e p f d a q f e q f d 0 where a p m e l m e 1 a m e a q f e l m e 1 v m e therefore for each of the corner points p the pressure normal derivative is expressed using the pressure vector p f d and flux vector q f d 53 q f d p e a p m p e p f d a q f p e q f d 0 in which a p m p e and a q f p e are the pth row in the matrixes a p m e and a q f e if there are n f e discrete fractures in the eth block and the point i is located at the midpoint of a discrete fracture element the following equations are obtained according to eq 42 54 a f e p f d l f e q f d e b e p f d v f e q f d 0 where 55 a f e r 11 e r 12 e r 13 e r 14 e r n f e 1 e r n f e 2 e r n f e 3 e r n f e 4 e 56 l f e l 11 e l 12 e l 13 e l 14 e l n f e 1 e l n f e 2 e l n f e 3 e l n f e 4 e v f e v 11 e v 1 n f e e v n f e 1 e l n f e n f e e 57 p f d p f d 1 p f d 2 p f d n f e b e θ i 2 π e n f e n f e in this case the fracture point is within the block θ i 2π substituting eq 52 into eq 54 we obtain 58 b p m e p f d b q f e q f d p f d 0 in which b p m e l f e a p m e a f e b q f e v f e l f e a q f e eqs 52 and 58 are the equations obtained from one of the domain grids and this can be applied to all the grids in the system however there is still a closure problem because there are four unknown pressure normal derivatives at each solution point within the domain this problem is addressed in the following in this paper the concept suggested by taigbenu 2008 is applied in this paper to introduce additional equations at the corner nodes of the grids it is based on the integration of the flux the permeability multiplied by the pressure normal derivative around a circle of small radius σ around a solution point as shown in fig 6 as the radius σ tends to zero the integral equals zero if the pressure is continuous around the point it is obvious that continuity is often assumed in the model this is also why the flux exchange between a domain grid element and the connected discrete fractures is assumed to not happen on the edges of the grid 59 k f d p f d n d n k f d p f d n d n 0 the domain is discretized in numerical models eq 59 can be written as 60 k f d p f d n d n lim σ 0 σ 0 2 π q f d j d θ i 1 m q f d j i θ i 0 in which θ i is the angle of element i and m is the numbers of grids intersecting at the point for cartesian grids θ i π 2 m 4 for internal points and m 2 for points on the closed boundary 61 i 1 m q f d j i θ i π 2 i 1 m q f d j i i 1 m q f d j i 0 it should be noted that eq 61 can be also used for the nodes on the boundary if the outer boundary is closed for a corner point we could obtain m equations using eq 53 and adding them up 62 e 1 m q f d p e a p m p e p f d a q f p e q f d 0 substituting eq 61 into eq 53 we obtain 63 e 1 m a p m p e p f d a q f p e q f d 0 therefore one equation is obtained by adding the m equations up at this point and the pressure normal derivative is excluded from the unknowns applying eqs 58 and 63 to the whole grids system and coupling the equations we obtain 64 a pm a qf o b pm b qf e p fd q fd p fd 0 there is only one unknown p f d for each corner point of the domain grids system and two unknowns p f d and q f d for each fracture segment so np 2nf unknowns in total as shown previously we can obtain one equation for each corner point of the domain girds and one equation for each discrete fracture element that is np nf equations in total therefore we still need nf equations to obtain a unique solution of the system and this is presented in the next section for fluid flow within the discrete fracture system here we can estimate the number of integrals in the system it is shown in eq 42 that there are 32 integrals on the edges for one grid and 4 n f e integrals over the fracture elements within the grid this will be a very large number if the integrals are calculated for every block actually the integrals do not need to be calculated for every block for blocks with the same size and properties the integrals should only be computed once this will save much computation time therefore if the domain grids are all in the same size and the reservoir is homogeneous the number of integrals for the whole grids system should be at least nt 32 9nf times which is a rather small value comparing to bem for the homogeneous problem however the number of integrals should be larger if some part of the reservoir is heterogeneous the procedures used in the gem based dfm can be summarized in fig 7 here we can find that the procedures for the two methods are the same however there are mainly three differences first the meshes for the two methods are totally different only the fractures and the boundaries are discretized in the bem based dfm while the domain is also discretized in the gem based dfm second the methods to handle fluid flow in the domain are different the boundary elements and fracture segments are used to generate the equations in the bem based dfm while the solution points and fracture segments are used to generate the equations in the gem based dfm third for flow in the domain the equations are generated using all the boundary elements and fracture segments in the whole reservoir in the bem based dfm while only the edges and fracture segments in a local domain grid are used to generate the equations in this way a dense matrix is generated using the bem based dfm while a sparse matrix is generated using the gem based dfm 3 3 fdm solution for flow within the discrete fractures for the one dimensional flow in the discrete fractures as shown in eq 23 the fdm is used to model fluid flow within the fracture elements as shown figs 1 c and 5 intersection points between individual fractures and between fractures and cartesian grids furnish a natural discretization of the fracture network therefore the fracture elements are not with equal length so the discretization form of eq 23 is written as 65 2 δ l k δ l k δ l k 1 p f d k 1 p f d k 2 δ l k δ l k δ l k 1 p f d k 1 p f d k s η f d p f d k 2 π c f d q f d k where δlk is the length of the kth fracture element we define 66 t k 1 δ l k 2 67 t k k 1 t k t k 1 t k t k 1 eq 65 is transformed into 68 t k k 1 p f d k 1 p f d k t k k 1 p f d k 1 p f d k δ l k s η f d p f d k 2 π c f d q f d k in which t k k 1 is regarded as the transmissibility between the kth and k 1 th elements if a fracture segment is at the tip as shown in fig a 3 the outer boundary condition shown in eq 24 is used 69 p f d l d t i p p f d k 1 p f d k δ l k 2 0 p f d k 1 p f d k thus eq 68 is transformed into eq 70 for the element at the fracture tip 70 t k k 1 p f d k 1 p f d k δ l k s η f d p f d k 2 π c f d q f d k if more than two fracture segments connecting with each other for example f2 f3 f4 and f5 in fig 5 as shown in fig a 3 the star delta transformation can be used to handle fluid flow between any two fracture elements karimi fard et al 2003 jia et al 2016 if there are nf fracture segments intersecting at the same point the transmissibility between kth and jth segment is calculated using eq 71 71 t k j t k t j i 1 n f t i applying eq 71 eq 68 is transformed into eq 72 for multiple fractures intersecting 72 i 1 n f t k i p f d i p f d k δ l k s η f d p f d k 2 π c f d q f d k if a fracture segment connects to the wellbore as shown in fig a 3 p f d k 1 p w d δl k 1 0 so eq 68 comes to 73 t k k 1 p f d k 1 p f d k t k p w d p f d k δ l k s η f d p f d k 2 π c f d q f d k according to eqs 68 70 72 and 73 we obtain the following equations for fluid flow within the fracture system 74 c f p fd d f q fd 0 for the same fracture segment the flux term q f d k in eqs 68 70 72 and 73 is equal to the flux term q f d k in eq 42 because of the flux conservation condition the matrix form q fd in eqs 74 and 64 are the same it should be noted that if the well is producing at constant rate condition p w d in eq 73 is also an unknown the inner boundary condition shown in eqs 26 and 27 are needed 75 p f d j l d w j p f d j p w d δ l d 2 2 π c f d q w d j q w d j c f d 2 π p f d j p w d δ l d 2 76 j 1 n p w f j p f d j p w d 2 π s in which w f j c f d j δ l d j 2 3 4 coupled solution in sections 3 2 and 3 3 the gem based dfm solution system is constructed for flow in the dual porosity system and the fdm solution system for flow within the fracture networks are constructed the two systems should be coupled to obtain the final solution of the model coupling eqs 64 74 and 76 the solution of the system is obtained 77 a pm a qf o o b pm b qf e o o c f d f o o o w f w f j p fd q fd p fd p w o o o 2 π s where o is a zero matrix o is a zero vector e is a unit matrix there are np 2nf 1 unknowns and np 2nf 1 independent equations in eq 77 a unique solution is sure to be obtained one should notice that the solution is obtained in laplace space the solution in the time domain is obtained using the numerical algorithm proposed by stehfest 1970 for a parameter χ in the laplace domain the corresponding value in the time domain is 78 χ ln 2 t d i 1 n v i χ ln 2 t d i where 79 v i 1 n 2 i k i 1 2 min i n 2 k n 2 1 2 k n 2 k k k 1 2 k 1 in which n is a constant and often given as 6 and 8 vi are constants if n is given here we should note that n iterations are needed in each time step to obtain the solution in the time domain this is also a drawback for numerical simulation in the laplace domain we can directly derive the gem model and obtain the numerical solution in the time domain in this way the temporal derivative term on the right hand side of eq 10 should be approximated by the fdm taigbenu 2008 in addition the fundamental solution to the problem shown in eq 30 should be replaced by 80 g 1 2 π ln r d there are mainly two advantages to use a steady flow solution first the numerical solution can be directly obtained in the time domain and much computational can be saved because the inverse problem from the laplace domain is avoided second the integrals in eqs 43 45 need to be calculated only once because eq 80 is independent of time however one should note that eq 80 is the fundamental solution for steady flow problems the application of eq 80 to transient flow problems will reduce the precision of the model particularly the early flow regime can be totally wrong therefore eq 80 can only be used for steady flow problem and some transient problems where the precision in early time is not important for example in petroleum engineering the steady solution can be used in models for oil and gas production prediction the performance is predicted by days but it cannot be used in models for transient behavior analysis in well testing the performance is predicted by minutes in this paper there are two reasons why the model is solved in the laplace domain first we are focused on proposing the gem based dfm for modeling the transient behavior in fractured porous media the early flow behavior is also considered second multi porosity models can be incorporated in the same model practically without any modification in the numerical approach just as shown in eqs 16 and 17 so far the fundamentals of the gem based dfm have been presented one can notice that the grids system of the proposed model is quite like that of the edfm however we can find that they are different numerical methods according to the mathematical fundamentals the edfm is normally based on the fdm and the concept of average normal distance is used to calculate the transmissibility between domain grids and fracture segments however the gem based dfm is based on green s function and the boundary equation shown in eq 36 is used to govern the fluid flow between domain grids and fracture segments 4 simulation examples and discussion in this section two cases are used to validate the proposed model the first model is a two zone model based on bem jia et al 2017 this case is to show the proposed model s capability of handling discrete fractures in the second validation case the commercial simulator eclipse is used to verify the proposed model s capability of handling real heterogeneities in petroleum industry the data in the wellbore production data is often analyzed to reveal the formation properties because the production data is easy and cheap to measure the pressure transient behavior at the wellbore is analyzed for all cases which are assumed to be single phase and two dimensional to present all the flow regimes clearly the wellbore storage and skin effect are not considered for all cases presented below the initial pressure throughout the entire reservoir is the same the outer boundary of the reservoir is assumed to be closed and the wellbore is assumed to produce at a constant rate 4 1 model validation 4 1 1 flow in a two zone system with discrete fracture networks in this section the developed model is validated using a bem model proposed by jia et al 2017 using the two models we compared the dimensionless pressure and the pressure derivative results obtained a two zone system is modeled and it is assumed to be single porosity the fluid is assumed to be slightly compressible and the viscosity and compressibility are assumed to be constants the properties of the two zones are all the same except the formation permeability and the parameters of the inner zone are chosen as reference parameters the dimensionless permeability of the outer zone is 0 01 the reference length is 10 m the dimensionless conductivity of the discrete fractures is set to 1000 as shown in fig 8 the dimension of the whole reservoir is 320 m 200 m the dimension of the inner zone is 140 m 100 m and the wellbore is located on a fracture segment for comparison these formation and fracture parameters are the same for both the bem and the proposed gem model in this paper the schematic of the grids system for bem and proposed gem model are shown in fig 8 for the gem model the dimensionless grid size of the domain grids is given as 1 1 and the discrete fractures are embedded into the domain grids and discretized 640 domain grids and 64 fracture elements are used in total for the bem model only the discrete fractures domain boundaries are discretized into several segments the dimensionless boundary element length is about 2 and the dimensionless fracture element length is set to about 0 5 the length of the elements may not be multiples of 2 and 0 5 in total 52 outer boundary elements 24 inner boundary elements and 67 fracture elements are used for the bem model the results of this validation case shown in fig 9 illustrate that our model provides a good match with the bem model the pressure at the wellbore as shown in fig 8 a is recorded this shows the ability and precision of the proposed method in handling fluids flow in the formation with fractures and simple heterogeneities in addition we also compared the computational efficacy of the two models for the two zone bem model the number of integrals in each step should be n b o 2n b i 2 2n b i nf 2 so 23 225 integrals should be calculated this is a relatively large number however for the proposed gem model there are two zones and two types of grids are used in this case the number of integrations over the grid boundary is 2 2 4 4 4nf for the two kinds of domain grids the number of integrations over all the fracture elements is 4nf it should be noted that other 7 4 4 integrals should be needed because there are 7 fracture intersections in the model thus in total 944 integrals are needed in each time step for the proposed gem model the number of integrals can be largely reduced if the proposed gem based dfm is used for this kind of problem in this paper the programs for both models are based on matlab r2018a the processor of the computer is intel xeon cup w2540 2 93 ghz and only one core is used in computation for comparison the computation time for the bem model is 5 72 h while the computation time for the gem model is 9 7 min another reason for the expensive computation of the bem model is that the dense matrix should be solved in each step however the computation time for both cases can be reduced if more cores are used it is concluded that the proposed gem model is quite efficient in handling fluid flow in bounded formation with discrete fracture networks 4 1 2 flow in heterogeneous porous media with discrete fractures in this section we validated the proposed gem based dfm by modeling fluid flow in heterogeneous dual porosity media with large scale fractures explicitly represented to validate the proposed method we used the commercial numerical simulator eclipse which is based on fdm the pseudo steady dual porosity model with square matrix blocks is used for comparison in addition only orthogonal fractures can be modeled using eclipse because discrete fractures are modeled with refined grids and the ability of the proposed model in handling complex fracture networks have been validated using a bem model so a simple fracture topology is used in this case fig 10 shows the grid system of the gem model the model parameters including the characteristic length inter porosity flow coefficient storativity ratio and dimensionless permeability of the dual porosity system are shown in fig 10 other parameters are shown in table 1 the distribution of characteristic length inter porosity flow coefficient dimensionless permeability and storativity ratio of fracture system are assumed to be heterogeneous as shown in fig 10 the grids system for the model using commercial simulator eclipse is shown in fig 11 to exclude the influence of grid effects the grid size for the eclipse runs is reduced by half and refined grids are used near the discrete fracture for this case respectively 120 grids and 858 grids are used for the proposed gem and commercial numerical simulator fig 12 shows the validation results using the commercial numerical simulator the pressure at the wellbore as shown in fig 10 a is recorded it is shown that the solutions obtained with our model and the commercial simulator are almost the same except the discrepancy when the dimensionless time is exceedingly small t d 10 7 although relatively coarser grids are used for the gem model quite precise results are obtained using the proposed gem based dfm this shows the ability and precision of the proposed gem in handling fluid flow in heterogeneous media with discrete fractures at present we should admit that the speed of the matlab code of the proposed gem is not as fast as the commercial simulator in this case 21 7 min are used in our model while 18 s are used by the commercial simulator however at present we cannot only compare the speed with the commercial simulator in which the code is carefully optimized and parallel computing is applied our model also has some advantages first not only orthogonal fractures but also complex fracture networks can be handled second different kinds of dual porosity models and even multi porosity models can be incorporated in the proposed gem based dfm just by changing a formulation to compute the f s shown in eq 17 third a high level computational precision is obtained even at the early time with a relatively coarse grids system and this will make it convenient to conduct transient analysis with a short time period like well testing it should also be noted that the computation time is much longer than it used in the previous case this is because an extremely heterogeneous problem is handled in this case and much more integrations are needed in each step we hope to optimize the code of the proposed model in order to optimize the computational time and this will be our future work 4 2 field case study and discussion in this section a field case is studied based on the proposed model this case is from a shale gas field from the southern sichuan basin which is now the leading area for shale gas development in china the thickness of the black shale in this region exceeds 100 m among which the lower longmaxi and wufeng formation are the target formations because it is characterized by its abundant organic matter high maturity strong gas generation intensity and favorable brittleness these characteristics are quite beneficial for shale gas formation and accumulation in addition the favorable brittleness characteristic makes it easy to generate fracture networks in hydraulic fracturing long horizontal wells are drilled in the target formation and multiple stage hydraulic fracturing is used in each horizontal well to promote shale gas production in this section we are focusing on simulating the performance of a multiple stage fractured horizontal wells from this gas field the well is 1500 m long and fractured with 15 stages and 3 clusters are used for each stage the microseismic data show that a complex fracture network is generated around the wellbore as shown in fig 13 a but we do not know the exact fracture networks in addition the extent of srv is also unknown therefore it is important to study the effects of fracture parameters on the transient behavior of the well in addition the thickness of the target formation is 46 m the microseismic data shows that the target formation is fully penetrated by the fractures as shown in fig a 4 therefore two dimension model is used in analysis in many previous studies symmetric and transverse fractures and homogeneous srv assumptions are often used for field case analysis just like the case shown in fig 13 b in this section multiscale fractures and the heterogeneities of srv are considered in the model so the other two conceptual models are used in the analysis as shown in fig 13 c d for all three scenarios large scale main fractures are represented explicitly small scale induced fractures in the srv are described using the dual porosity model shown in fig 2 c the reservoir beyond the srv is assumed to be a single porosity zone for the conceptual model shown in fig 13 d the heterogeneity within the srv is modeled the shape factor and storativity ratio are assumed to be linearly distributed depending on the distance to the main fractures for the conceptual model shown in fig 13 c complex fracture networks are applied but the properties of the srv are assumed to be homogeneous in the following the effects of multiscale fractures and the heterogeneities of srv on the transient behavior are analyzed based on the three conceptual models shown in fig 13 b d comparing to the uncertainties of the shale matrix the parameters of fracture networks are with much greater uncertainties and have a more significant influence on the transient behavior of shale gas wells therefore four problems are discussed about the fracture parameters including fracture configuration the area and heterogeneities of srv because the obtained properties of the dual porosity system and discrete fractures are often with uncertainties another case is also provided in section 4 2 4 to match the parameters using the production data some properties of the formation are shown in table 2 and these parameters are given the same value for all the studied cases some fracture parameters are listed in table 2 like matrix porosity these parameters are not studied in this paper because these parameters are assumed to be with less uncertainty and have less influence on the transient behaviors the fracture width is not put in table 2 because the fracture width is included in the conductivity which is studied in the cases and defined as cf kfwf in this section the reference parameters for all the cases are given the same for comparison and shown in table 2 the reference porosity times compressibility is given as μ gi ctm ctf the gas pvt properties are shown in fig a 5 4 2 1 case 1 fracture configuration the hydraulic fractures provide many pathways for fluid flow in the unconventional formation the properties of large scale main fractures can have a great influence on shale gas production obtaining the configuration and total length of fractures is a major concern to have a basic understanding of the influence of fracture configuration and fracture length four scenarios are studied in this case as shown in fig 14 complex fracture network scenarios with different fracture numbers and length are shown in fig 14 a b and fig 14 c d is for transverse fracture scenarios for comparison the fracture total length is the same for scenarios a and c and so are scenarios b and d in addition the number of fractures that are directly connected with the wellbore is given the same value for scenarios a and c and so are scenarios b and d the homogeneous dual porosity model is used to the srv while the single porosity model is used to the reservoir beyond the srv the studied fracture parameters are shown in table 3 and other parameters are shown in table 2 the simulation results are shown in figs 15 and 16 it is obvious that pressure drop in the srv and the fracture networks will be smaller if there are more fractures by comparing scenarios a and b in fig 15 in addition some interesting results can be drawn from this case first as shown in fig 15 the drainage area of real fracture networks is much smaller than that of the transverse fractures with the same fracture length second the effects of fracture configuration have a much larger influence on transient behavior than the fracture length one can notice that the drainage area of transverse fractures with 11 765 m fractures scenario c is much larger than the drainage area of fracture networks with 15 519 m fractures scenario b in addition fig 16 shows the dimensionless pressure in the horizontal wellbore which is marked in fig 13 a the results show that the pressure drop in the wellbore is much smaller for the cases with transverse fractures than fracture networks therefore this result is very important in production data analysis and we will present some further cases in section 4 2 4 figs 16 presents the pressure transient behavior of the four models there are four main flow regimes shown on the type curves the first flow regime is a bilinear flow regime with a ¼ slope on the log log plot which is caused by transient linear flow in both the hydraulic fractures and the dual porosity system the second flow regime is mainly caused by fracture interference so a pseudo steady flow character is observed however the slope is not 1 because of the influence of fluid contribution from the srv and inter porosity flow in the dual porosity system the third flow regime is dominated by fluid flow in the srv beyond the hydraulic fractures for long horizontal wells a linear flow would be observed if the srv is large enough however the srv is limited in reality and this flow region is replaced by boundary dominated flow before a ½ slope can be observed on the type curve the last flow regime is boundary dominated flow the results also show that the length and configuration of the hydraulic fractures have a significant effect on transient behaviors 4 2 2 case 2 area of the srv in addition to the large scale main fractures the small scale induced fractures also contribute a lot to gas production in this paper dual porosity is used to model the small scale fractures in the srv one of the uncertain parameters concerning the dual porosity system is the area of the srv the srv area determines the control reserve of the well and it also determines the well space and in fill well design three scenarios are analyzed in this case to study the effects of the srv area in the three scenarios the boundary of the srv is assumed to be 20 m 60 m and 100 m from the fracture networks respectively the fracture networks are shown in fig 14 a in this case and all parameters except the srv area are shown in tables 2 and 3 fig 17 a b presents the schematics for the scenarios with the srv boundary being 20 m and 100 m from the fracture networks and the corresponding dimensionless pressure profile at t d 1 is shown in fig 17 c d it is very obvious that the drainage area is larger for scenarios with larger srv to maintain the same production the pressure drop in the drainage area for scenarios with smaller srv should remain much larger than scenarios with larger srv the dimensionless pressure and the pressure derivative curves are shown in fig 18 the results show that the srv area mainly influences the flow regimes after the bilinear flow regime if the srv area and the matrix permeability are small the fluid contribution from the reservoir beyond the srv is quite limited so the pseudo steady flow characteristics for small srv area cases will last for a long time this is also why the dimensionless pressure for small srv area scenarios is higher than the other scenarios when 0 1 t d 300 this period is quite important in the analysis because most of the production period for field shale gas wells is during this time interval 4 2 3 case 3 heterogeneities in the srv another important factor is the heterogeneity of the srv especially the shape factor of the dual porosity system as shown in figs 1 and 2 we assume the value of the shape factor and fracture porosity of the dual porosity system are proportional to the distance to the nearest main fractures three scenarios with the same average properties are analyzed in this part the average shape factor and porosity of the dual porosity system are respectively given as 0 5 and 1 10 5 in the first scenario the homogeneous scenario in fig 19 homogeneous srv is assumed and the schematic is shown in fig 13 c all parameters except the srv area are shown in tables 2 and 3 in the second and third scenarios the heterogeneous scenario 1 and 2 in fig 19 the distribution of shape factor is assumed to be linear and the schematics are respectively presented in fig 17 a and fig 13 d the porosity distributions for heterogeneous cases 1 and 2 are also assumed to be linear and their ranges are respectively 5 10 6 1 5 10 5 and 1 10 6 1 9 10 5 here the properties for each grid element are given based on the distance from the element s center to the nearest hydraulic fracture fig 20 b d shows the dimensionless pressure profile in the formation for all three scenarios one can notice that the pressure profiles at t d 0 03 for all the cases are quite similar however they are not the same the pressure drop in the drainage area for the homogeneous case is highest and the heterogeneous scenario 2 is the lowest this is because the drainage area is within 30 m from the hydraulic fractures at this time and the shape factor and induced fracture porosity in this area is lowest for the homogeneous scenario and highest for heterogeneous scenario 2 the dimensionless pressure in the wellbore and the pressure derivative are shown in fig 21 the results show that the effects of shape factor distribution on transient behavior are significant when t d 0 08 however the shape factor distribution in this case has little influence on the later flow regimes therefore if the properties in the srv obey linear distribution a homogeneous srv can be used in history matching first then we can match the early bilinear flow regime to obtain the distribution in the area 4 2 4 case 4 production data analysis in this case all three conceptual models are used to match the field production data including transverse fractures models with homogeneous srv complex fracture network models with and without considering heterogeneities in the srv with the exception of some fracture parameters the other parameters are presented in table 2 the daily reports of the gas production rate and bhp are shown in fig 22 although variable production rate and variable bhp data can be matched with the proposed numerical approach the pressure behavior at constant production rate condition is presented to analyze the transient responses to match the pressure response at variable rate conditions the normalized pressure ψ i ψ w q s c and material balance time tca are used to process the production data wu et al 2016 81 t c a μ i c t i q t 0 t q t μ c t d t where ψ is the pseudo pressure which is defined in eq a 3 for the gas case the processed data using the normalized pressure and material balance time is shown in fig 23 one should note that the well is almost controlled by bhp after 300 days of production and this will make the production decline so the calculated material balance time using eq 81 is much larger than the actual time different flow regimes are recognized based on the slope exhibited on the log log plot and a large slope means a quick bhp drop in the wellbore it is obvious that there are mainly two flow regimes exhibited by the production data including a long linear flow regime and a pseudo steady flow regime the linear flow regime is mainly caused by fluid in the srv linearly flow into the main fractures the pseudo steady flow regime is mainly caused by fracture interference and the boundary of the inner srv because the matrix permeability is ultra low the reservoir beyond the srv does not make much fluid contribution to make up for the depletion in the main fractures and srv fig 23 presents the history matching results of the three scenarios we can find that good matches are obtained using all three conceptual models the production data can be matched with different parameter combinations and different models comparing the matched parameters for the three scenarios shown in table 4 the interpreted fracture length for the scenario with transverse fractures is much larger than the scenario with fracture networks in addition small average shape factor and induced fracture porosity are obtained if the heterogeneities in the srv are considered in the analysis we should keep in mind that complex fracture networks are generated in the formation of this case if transverse fractures are assumed in the model the interpreted fracture length will be misleading because it is much smaller than the actual fracture length besides the interpreted range of srv will be much larger this case also shows the large uncertainties in production data analysis different conceptual models reflect different information about the formation it is very crucial to choose a suitable conceptual model based on the known information about the reservoir on the other hand we can find that all the conceptual models can be incorporated in the proposed gem based dfm which makes it convenient to analyze production data and obtain the transient behavior of different conceptual models at present we should admit that the history matching result obtained in this case may not be the only one because this inverse problem consists of many uncertain parameters in addition the uncertainties will significantly increase if the parameters for different blocks are stochastically given in history matching it is a very interesting topic to extend the developed model to simulate interference tests and quantify the uncertainties by coupling an inversion algorithm for enhanced model calibrations this task will require the simulation to run tens of thousands of times so the code should be programmed and optimized based on a general purpose programming language like c 5 conclusions modeling the transient behavior of heterogeneous porous media with multiscale fractures is of significance although conventional bem can handle discrete fractures the real heterogeneous problem is not addressed in addition the computation of bem in handling large numbers of large scale fractures is rather expensive this paper is the first to present the gem based dfm for this problem based on the analysis in this paper the following conclusions are drawn 1 there are many integrals in the bem based dfm and the computation is rather expensive if amounts of discrete fracture and boundary elements are handled the proposed gem based dfm is a good choice for this problem by discretizing the domain into many blocks and applying the superposition principle within a lock block rather than the whole domain the number of integrals and computations can be largely reduced 2 there are several dramatic advantages in applying the cartesian grids to the discretization of the gem based dfm first the cartesian grids provide a natural way to discretize the fracture networks in addition this makes it convenient to eliminate the flux terms and handle the closure problem at a solution point by adding the equations up at the same point furthermore the number of integrals can be largely reduced because many blocks are of the same size and properties 3 the fracture parameters including length and configuration of the main fractures and shape factor porosity and heterogeneities of the induced fractures dual porosity have significant influences on the transient behavior the length and configuration of the main fractures affect almost all the flow regimes except boundary dominated flow regime with the same total fracture length the pressure drop in fracture networks is smaller for models with transverse fractures than complex fractures the area of the srv has a significant influence on the production period of the well because the srv area mainly controls the drainage area of the fracture network the field case shows that the same data can be matched with different models but different models reflect different information about the formation and should be compared the proposed gem based dfm serves as a good tool for this problem since many conceptual models can be simulated credit authorship contribution statement yonghui wu conceptualization investigation methodology software writing original draft linsong cheng funding acquisition resources supervision sidong fang software data curation visualization shijun huang project administration supervision pin jia writing review editing validation declaration of competing interest none acknowledgments the authors acknowledge that this study was partially funded by the national science and technology major project no 2017zx05037001 we also thank the national natural science fund of china no u1762210 for financial support supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 103489 appendix b supplementary materials image application 1 appendix a definitions of dimensionless variables we define the dimensionless pressure and time respectively by a 1 p d k r h p i p 1 842 q b μ and a 2 t d 0 0864 k r μ i ϕ r c t r l r 2 t for analysis of gas wells we follow the usual approach and incorporate the liquid flow analogy of al hussainy et al 1966 through the pseudo pressure transformation a 3 ψ 2 0 p p μ z d p in addition the time t in eq a 2 should be replaced by pseudo time ta a 4 t a 0 t μ g i c t i μ g p c t p d t the dimensionless pressure for the gas case can be defined as a 5 p d k r h ψ i ψ 1 291 10 3 q r t the dimensionless distances in the x and y direction are defined respectively by a 6 x d x l r a 7 y d y l r for one dimensional flow in the discrete fractures a 8 l d l l r dimensionless permeability is defined as a 9 k d k k r in this model we used the following definitions of dimensionless fracture conductivity a 10 c f d k f w f k r l r k f d w f d where wfd wf lr fracture conductivity is defined as cf kfwf for fluids flow in naturally fractured media it is very practical to use bulk properties in dual porosity models characteristics of the matrix and fracture media are incorporated into the model by the storativity and flow capacity ratios which can be defined by a 11 ω ϕ f c t f ϕ f c t f ϕ m c t m a 12 λ α k m k f l r 2 lr is the reference length which is chosen as a parameter as long as it stands for a length lr is chosen as the block size of the grid in this paper it should be noticed that lr is chosen as the half length for fractured many models and wellbore radius for vertical well models α is shape factor which is different for the different idealization of dual porosity models for square matrix blocks the flow between the matrix block and fracture system is assumed to be in pseudo steady the shape factor is defined as a 13 α 4 1 l x 2 1 l y 2 1 l z 2 where lx ly and lz are the characteristic length of the matrix blocks for cylindrical matrix blocks given the radius of the matrix cylinders r m the transient solution can be obtained analytically the shape factor is defined as a 14 α 8 r m 2 for slab matrix blocks given the width of the matrix slabs h m the transient solution can be obtained analytically the shape factor is defined as a 15 α 12 h m 2 to capture the heterogeneities of the porous media different blocks are of different properties and a set of reference properties including kr φ r and ctr should be chosen the following diffusivity ratio for the fracture system is defined a 16 η f d η f η r k f μ ϕ c t f k r μ ϕ c t r k f d μ ϕ c t r μ ϕ c t f for heterogeneous cases if we neglected the nonlinearity of viscosity and assumed kr kf φ r ctr φ f ctf η fd 1 fig a 1 shows the sketches of different idealizations of dual porosity models including square slab and cylinder warren and root 1963 kazemi 1969 de swaan 1976 raghavan and ohaer 1981 serra et al 1983 one should notice that the large scale fractures are handled explicitly and they are not included in the dual porosity system fig a 2 shows the schematic for fluid flow in the dual porosity system with different matrix shapes for different conceptual idealizations of dual porosity models f s in eq 16 should be given a different formulation the results derived in the literature can be used for homogeneous cases warren and root 1963 kazemi 1969 de swaan 1976 raghavan and ohaer 1981 serra et al 1983 however the formulations are different because the reference parameters are not the same for different heterogeneous problems therefore general formulations are given below a 17 f s 1 η f d single porosity model 1 η f d λ 1 ω 1 ω s λ ω η f d dual porosity model square 1 η f d λ 1 ω 3 ω η f d s tanh 3 1 ω s λ ω η f d dual porosity model slab 1 η f d λ 4 s 8 1 ω s λ ω η f d i 1 8 1 ω s λ ω η f d i 0 8 1 ω s λ ω η f d dual porosity model cylinder 
529,advances in hydraulic fracturing technology are promoting global interest in the simulation of the transient flow in fractured porous media boundary element method bem is widely used in pressure transient analysis because of its high precision and simple discretization of the boundaries and the fractures however bem is computationally expensive when real heterogeneities and large numbers of fractures are modeled a green element method gem based discrete fracture model dfm is proposed in this paper to address this problem and this is the first study to enrich the gem in modeling the transient behavior of heterogeneous porous media with discrete fracture networks gem is applied to handle formation heterogeneities and discrete fractures first a new mathematic model and integral formulation are proposed with the consideration of formation heterogeneities and discrete fractures next structured cartesian grids are used to discretize the domain and characterize the heterogeneities and discrete fracture networks are embedded into the domain grids then gem is used to handle fluid flow between connected domain blocks and between a domain block and connected discrete fracture segments the finite difference method fdm is used to model fluid flow between connected discrete fracture segments the solution of the model is obtained by coupling the two systems two validation cases and several synthetic cases are used to verify the precision efficiency and application of the proposed gem based dfm the results show that the proposed model is precise and efficient by comparing it to the bem and a commercial simulator the number of integrals and the computation are largely decreased by applying the boundary integral equation to each local block finally a field example with several synthetic cases is studied to show the model s application the proposed gem based dfm serves as a good tool for simulation of the transient flow in heterogeneous fractured porous media keywords reservoir simulation discrete fracture model green element method transient behavior heterogeneity hybrid model nomenclature b fluid volume factor m3 m3 cfd dimensionless conductivity of fracture ct total compressibility mpa 1 ctm total compressibility of matrix mpa 1 ctf total compressibility of fracture mpa 1 ctf total compressibility of the discrete fracture mpa 1 g fundamental green s solution h formation thickness m hm height of the matrix slabs m k permeability md kf fracture permeability dual porosity md kfd dimensionless fracture permeability kf discrete fracture permeability md kfd dimensionless discrete fracture permeability km matrix permeability md kr reference permeability md l the length along a fracture m ld dimensionless length along a fracture l length of fracture matrix block m lr reference length m nj lagrange shape function n outer normal on the boundary p pressure mpa pf fracture pressure dual porosity mpa pfd dimensionless fracture pressure pf discrete fracture pressure mpa pfd dimensionless discrete fracture pressure pi initial pressure mpa pm matrix pressure mpa pmd dimensionless matrix pressure pw bottom hole pressure mpa q flow rate m3 d qmf inter porosity flux 0 0864 d 1 qfd dimensionless pressure normal derivative qf flux strength along the fracture m2 d qfd dimensionless flux strength along the fracture qr reference flow rate m3 d qw wellbore production rate m3 d qwd dimensionless wellbore production rate r radial direction m rd dimensionless radius rm radius of the spherical matrix m s laplace constant t time day t transmissibility m 1 wf fracture width m x x direction m xd dimensionless x direction y y direction yd dimensionless y direction z compressibility factor of gas greeks symbols φ porosity m3 m3 φ m porosity of matrix m3 m3 φ f porosity of fracture dual porosity m3 m3 φ f porosity of discrete fracture m3 m3 ψ pseudo pressure mpa mpa s ω domain γ boundary η pressure transfer coefficient md mpa mpa s η md dimensionless pressure transfer coefficient of matrix η fd dimensionless pressure transfer coefficient of fracture dual porosity differential operator μ fluid viscosity mpa s δ dirac constant λ inter porosity flow coefficient α shape factor m 2 ω fracture storativity θ i the angle enclosed by the boundary ξ distance in ξ direction ζ distance in ζ direction superscripts laplace transform i the ith fracture element j the jth boundary element k the kth fracture element b boundary e the eth block f fracture nf the nf th fracture element subscripts d dimensionless f fracture system of the dual porosity model f discrete fracture m matrix system of the dual porosity model ef the efth fracture element i the ith element j the jth element k the kth element sc surface condition w wellbore 1 introduction the underground formation is rich in natural fractures in addition many artificial fractures are generated by hydraulic fracturing which is widely used in co2 sequestration geothermal and petroleum industry in addition to large scale hydraulic fractures many small scale natural fractures are activated during fracturing stimulation and the activated natural fractures are called induced fractures in general the fractures are always with heterogeneities so it is quite important to propose a comprehensive model to capture the transient behavior in the heterogeneous fractured formation the fractures in the formation are often divided into two types the first type is small scale induced fractures which are small in size and large in number because it is often impossible to describe these fractures precisely continuum models are proposed to capture the flow behavior like enhanced single porosity model dual porosity model and multi porosity model warren and root 1963 kazemi 1969 de swaan 1976 raghavan and ohaer 1981 serra et al 1983 pruess and narasimhan 1985 wu and pruess 1988 wu et al 2004 the second type of fracture is large scale hydraulic fractures which are sporadically distributed in the formation the large scale hydraulic fractures generated by hydraulic fracturing are also called main fractures the main fractures are small in number and large in size dual porosity models do not correctly capture their flow behavior so the main fractures are often handled explicitly cinco ley et al 1978 ozkan and raghavan 1991a 1991b chen and raghavan 1997 biryukov and kuchuk 2012 kuchuk and biryukov 2014 zhou et al 2012 jia et al 2015 he et al 2017 to capture the multiscale fractures in the formation hybrid models are often used by many researchers jia et al 2016 jiang and younis 2016 2017 cheng et al 2017 ding et al 2018 in these models small scale fractures are handled with enhanced single porosity or dual porosity model large scale fractures are handled explicitly the advantage of the hybrid model is that the computational burden is largely reduced with tolerated precision at present there are mainly three types of methods to obtain the transient behavior for fluids flow in the heterogeneous fractured formation the first type of method is based on multi region linear flow models including enhanced fracture region model tri linear flow model and five region model brown et al 2009 brohi et al 2011 stalgorova and mattar 2013 wu et al 2016 in these models the formation is divided into several regions and different regions are given different properties to capture the heterogeneities the flow in each region is assumed to be linear to derive the analytical solution using laplace transformation however complex fracture geometries cannot be captured with these analytical models for the complexities in the formation the second type of method is based on green s function and bem the biggest advantage of this kind of method is the high precision of green s solution in addition complex fracture networks can be modeled with this method by discretizing large scale fractures into several segments and treating each segment as a source or sink to handle complex boundaries and heterogeneities of the formation the domain is often divided into several subregions in many bem models the boundary between two connecting regions is divided into several segments and the whole system is coupled to obtain the solution numbere and tiab 1988 kikani and horne 1993 jongkittinarukorn and tiab 1998 lough et al 1998 idorenyin and shirif 2016 jia et al 2017 cao and killough 2017 wu et al 2019 however a more rigorous model is needed to obtain the flow behavior more precisely when more heterogeneities information is known in addition it is impossible to model real heterogeneities with composite models the third type of method is based on numerical models in which heterogeneities can be incorporated easily so far many dfms and embedded discrete fracture models edfms are widely proposed to simulate fluids flow in fractured systems kim and deo 2000 lee et al 2001 karimi fard et al 2003 matthai et al 2005 reichenberger et al 2006 li and lee 2008 hoteit and firoozabadi 2008 warpinski et al 2009 cipolla et al 2010 mayerhofer et al 2010 moinfar et al 2012 wu et al 2014 karimi fard and durlofsky 2016 yan et al 2016 jiang and younis 2017a 2017b tang et al 2018 flemisch et al 2018 most of the models are based on fdm the fractures are represented explicitly and refined grids are often used to capture the flow behavior around discrete fractures gem is another accurate numerical method which is first proposed by taigbenu 1995 gem is accurate even in very early flow regimes and not grid sensitive for its rigorous green s function basis comparing to bem gem is more efficient in computation because a sparse matrix is obtained with gem while a dense matrix is generated with bem moreover heterogeneous and nonlinear problems can be handled with gem to enhance the computational accuracy of gem several modifications are proposed including flux vector based gem pecher et al 2001 lorenczi et al 2006 2009 2011 and many flux correct formulations taigbenu 2003 2004 2008 2012 rao et al 2018 the modified gem is suggested to have second order accuracy even with relatively coarse grids system so it is very convenient in transient behavior analysis for fluid flow in the porous media with heterogeneity anisotropy and nonlinear problems unfortunately this method has not been widely used in transient behavior analysis in addition fractures in different scales should be handled before the gem being used to analyze the transient behavior in fractured media in this work we proposed a dfm based on the flux correct gem taigbenu 2008 to make it suitable for handling complex fractures explicitly structured cartesian grids are used as domain grids to discretize the integral equation and discrete fracture networks are embedded into the domain grids and discretized correspondingly in this paper we first presented the physical and mathematical model for fluid flow in fractured porous media with heterogeneities then the mathematical fundamentals of the modified gem were introduced finally we verified the solution and presented several examples to demonstrate its application 2 physical model hydraulic fracturing is widely used in many fields such as geothermal and petroleum industry after hydraulic fracturing a stimulated reservoir volume srv including many large scale main fractures and small scale induced fractures are generated around the wellbore microseismic data is used to interpret these fractures fig 1 a shows a map view of the microseismic moment density and microseismic events of three hydraulically fractured horizontal well maxwell and cipolla 2011 the microseismic events are used to generate the large scale main fractures the contour of the seismic moment density can be used to generate the small scale induced fractures fig 1 b shows a schematic of the interpreted multi scale fractures including large scale fractures and small scale fractures there are three kinds of media including large scale fractures small scale fractures and rock matrix fig 1 c shows the conceptual model to handle multi scale fractures for the case shown in fig 1 b the large scale main fractures are represented explicitly and the small scale induced fractures and the rock matrix are modeled using dual porosity models the schematic of the dual porosity system is shown in figs a 1 and a 2 we should note that there are mainly two steps to generate the model shown in fig 1 c the first step is fracture modeling which generates the fracture configuration shown in fig 1 b in the second step large scale fractures are extracted and small scale fractures are upscaled into the dual porosity system as shown in fig 1 c geological data well logs and microseismic data are often used in fracture modeling at present this technique is not mature and more work needs to be done concerning this problem the analytical method proposed by oda 1985 can be used to upscale the small scale fractures into the dual porosity system in this paper we just simply assume that there is a linear relationship between the seismic moment density in fig 1 a and the shape factor and porosity of the dual porosity system in fig 1 c because the model generated using the two steps is with many uncertainties history matching is often used to calibrate the model because of the heterogeneities of natural fractures and young s modulus of rock the fractures created by hydraulic fracturing are often heterogeneous as suggested by fuentes cruz et al 2014 and fuentes cruz and valko 2015 the induced fracture system is heterogeneous and the density of the induced fractures is higher near the main fractures rather than far away from the main fractures as shown in fig 2 this is because the shear stress and deformation density near the hydraulic fractures is much higher than far away from hydraulic fractures and more natural fractures near the hydraulic fractures can be reactivated in the process of hydraulic fracturing mayerhofer et al 2010 maxwell and cipolla 2011 therefore the heterogeneities are taken into consideration in this paper as shown in fig 1 the heterogeneities of induced fractures shown in fig 1 b can be easily captured by using the heterogeneous dual porosity model shown in fig 1 c after discretizing the reservoir into many blocks we can give different blocks with different properties to capture the heterogeneities including shape factor porosity and permeability here one should note that the blocks in figs 1 c and 2 are totally different the blocks in fig 2 are matrix blocks of the dual porosity system and they are in small scale the size of the blocks signifies the induced fracture density which is characterized using the shape factor of the dual porosity system the blocks in fig 1 c are the cartesian grids of the numerical approach and they are in large scale in this model each block in fig 1 c is a dual porosity system shown in fig 2 when the dual porosity model is used to characterize the small scale fractures in the srv in this paper the following assumptions are made to obtain the solution of the conceptual model shown in fig 1 b 1 the thickness of the formation is assumed to be constant and the formation is fully penetrated by the fractures so the model is assumed to be two dimensional in practice the thickness of some target formations are not very large many target formations in unconventional reservoirs are within 50 m the formations are easy to get fully penetrated in hydraulic fracturing in addition the permeability in the vertical direction is rather lower than that of the horizontal direction in deep formations the vertical permeability is often assumed to be 1 10 of the horizontal permeability in oil and gas reservoirs therefore the two dimensional model can be used under these circumstances however the present two dimentsional model cannot be used to the cases with the formation thickness varying significantly and we will continue working on extending the present model to real three dimensional problems and taking the gravity into consideration 2 the rock is assumed to be slightly compressible this assumption is often used in model derivation because of the stiffness of rock in addition only isotropic media is considered at present 3 single phase flow is modeled single phase flow is very common in the underground water petroleum and geothermal systems however more rigorous model should be used when multi phase flow is exhibited in the formation 4 the horizontal well is assumed to only connect with the main fractures because casing perforation completion is often used in petroleum engineering and geothermal systems 5 the temperature in the formation is assumed to be constant in the sections which follow we present the mathematical fundamentals of the mathematic model verify its results and present some examples to demonstrate its utility 3 mathematical model in this section we first present the theoretical model for fluid flow in the dual porosity system and the discrete fracture networks next numerical techniques of the gem based dfm model are presented for flow in the dual porosity system the bem theory is also simply presented for comparison then the fdm solution is presented for flow within the discrete fracture networks finally the coupled solution of the two systems is presented 3 1 description of the theoretical model as shown in section 2 three kinds of media including large scale fractures with the subscript f in the following formulations small scale fractures with the subscript f and rock matrix with the subscript m are included in the system section 3 1 1 presents the mathematical model of the dual porosity system including the matrix and small scale fracture system section 3 1 2 presents the model for fluid flow within the large scale fracture system the discrete fractures 3 1 1 model for flow in the dual porosity system in this section the mathematical model is based on the conceptual model shown in fig 1 b heterogeneous problems are addressed and different blocks are with different properties in this paper but the properties in a single block are regarded as homogeneous this will make it convenient to compare the results with other numerical methods in addition this makes it easy to couple the proposed model with the widely used commercial reservoir modeling software like petrol which generates models with block based properties therefore we derived the model based on the homogeneous assumption for each block dual porosity models are efficient in modeling fluid flow in the domain with many small scale fractures because of the complexities of real models several conceptual models are proposed to idealize the matrix blocks to obtain the analytical solution of the dual porosity model including cylinders slabs and squares warren and root 1963 kazemi 1969 de swaan 1976 raghavan and ohaer 1981 serra et al 1983 in the following only the derivations of the scenario with cylindrical shaped matrix blocks are presented and the results of other scenarios are directly given in appendix a the sketches of different idealizations are shown in fig a 1 for flow in the dual porosity system with the cylindrical shaped matrix blocks the governing equation for the cylindrical matrix blocks is given by 1 1 r r r p m r μ ϕ m c t m k m p m t when transient state inter porosity flow is assumed the flux exchange happens on the boundary for a matrix block shown in fig a 2 therefore the term qmf is not added in eq 1 instead the pressure continuity condition shown in eq 4 is used as the coupling condition the initial condition is 2 p m r t 0 p i the inner boundary condition is 3 p m r r 0 0 the outer boundary condition is coupled with the fracture system and given by 4 p m r m t p f the inter porosity flux is given by 5 q m f 2 r m k m μ p r r r m in which rm is the matrix block size eqs 1 4 can be solved in laplace space analytically the results using the dimensionless variables defined in appendix a and taking the laplace transformation of eqs 1 4 with respect to the dimensionless time yields 6 1 r d r d r d p m d r d s η m d p m d p m d r d r d 0 0 p m d r m d t d p f d the solution of the model suggested in eq 6 is 7 p m d i 0 r d s η m d i 0 r m d s η m d p f d thus 8 p m d r d r d r m d i 1 r m d s η m d i 0 r m d s η m d s η m d p f d where i υ is the modified bessel function of the first kind υ 0 1 the governing equation for the fracture system is given by 9 x k f p f x y k f p f y μ q m f μ ϕ f c t f p f t here one should note that the matrix and fracture system are coupled using the boundary conditions shown in eq 4 and the flux term shown in eq 5 for the transient state flow problem for the matrix system the inter porosity flux shown in eq 5 is the result of the model shown in eqs 1 4 and it acts on the boundary of the matrix block so the flux term is not added in eq 1 for the fracture system the inter porosity flux is regarded as a domain flux term so it is added in eq 9 another formulation is to add the flux term in both the fracture and matrix equations and the boundary conditions in eqs 3 and 4 are not needed however if this formulation is used the analytical solution cannot be obtained it should be noticed that eq 9 is the governing equation for fluid flow in heterogeneous dual porosity media this is valid for fluid flow in a single block shown in fig 1 b we should also notice that no discrete fractures are considered in eq 9 in this paper large scale main fractures are handled explicitly with the green element method where the fractures are discretized into several segments and each segment is treated as a line sink thus the governing equation for the system can be written as 10 x k f p f x y k f p f y μ q m f q f f b μ h μ ϕ f c t f p f t different from the flux term the third term in eq 10 of the dual porosity system the discrete fractures do not act on the whole domain so the flux term caused by the discrete fractures is expressed as 11 q f f n 1 n f γ n q f l δ x y d l where qf is the flux strength along the discrete fracture it is the flow rate per unit length γ n is the nth discrete fracture line nf is the total number of discrete fractures x is a point in the two dimensional space and y is a point located on the discrete fracture line δ x y is the dirac delta function which is given as 12 δ x y 0 x y x y which satisfies the following property 13 ω f x δ x y d ω f y where ω is the domain substituting eq 5 into eq 10 results in 14 2 p f 2 r m k m k f p m r r r m b μ h k f n 1 n f γ n q f l δ x y d l μ ϕ f c t f k f p f t equilibrium is assumed for the initial state of the reservoir and the pressure in the whole reservoir is assumed to be the same using the dimensionless variables defined in appendix a and taking the laplace transform of eq 14 with respect to the dimensionless time results in 15 2 p f d 2 r m d k m k f p m d r d r d r m d 2 π k f d n 1 n f γ n q f d l d δ x d y d d l d s η f d p f d substituting eq 8 into eq 15 results in 16 2 p f d s f s p f d 2 π k f d n 1 n f γ n q f d l d δ x d y d d l d 0 where 17 f s 1 η f d λ 4 s 8 1 ω s λ ω η f d i 1 8 1 ω s λ ω η f d i 0 8 1 ω s λ ω η f d where qfd is defined by q f d q f l r q r ω is fracture storativity ratio λ is the inter porosity flow coefficient it should be noted that f s is different for different realizations of the dual porosity system this is shown in eq a 17 3 1 2 model for in the discrete fracture networks the aperture of the fractures in the formation is very small in the petroleum industry the aperture is often given as 10 3 10 2 m jia et al 2016 jiang and younis 2017b therefore for a discrete fracture the flow is assumed to be one dimensional and the governing equation is 18 2 p f l 2 b μ k f q f w f h μ ϕ f c t f k f p f t because the fracture aperture is very narrow compared to its length so the flux contribution to the fracture tip is neglected in this paper and a closed boundary is assumed at the fracture tip 19 p f l t i p 0 if a fracture is connected to the wellbore the inner boundary is given by 20 p f w p w 21 p f j l w j q w j b μ w f j k f j h where pw is the pressure at the wellbore qwj is the production rate at the surface standard condition from the jth fracture connected to the wellbore wfj and kfj are the width and permeability of the jth fracture for multiple fractured horizontal wells there are several perforations and each perforation is stimulated with hydraulic fracturing the total flow rate of the wellbore is the summation of all the connected fractures 22 j 1 n p q w j q w where np is the total number of fractures that are connected with the wellbore qw is the production rate of the wellbore using the dimensionless variables defined in appendix a and taking the laplace transformation of eqs 18 22 with respect to the dimensionless time results in 23 2 p f d l d 2 2 π c f d q f d s η f d p f d 24 p f d l d t i p 0 25 p f w p w 26 p f d j l d w j 2 π c f d q w d j 27 j 1 n p q w d j 1 s it should be noted that the definition of qwdj is q w d j q w j q r which should be distinguished from qfd for constant rate cases qr is often chosen as the total production rate qw 3 1 3 coupling conditions for flow in the two systems the flow in the dual porosity system and the discrete fracture system should be coupled to obtain the solution and the coupling conditions are given based on the flux exchange of the two systems and pressure continuity conditions at the contacting points the flux exchange between the two systems is characterized using the line sink qf in eqs 14 and 18 and eqs 16 and 23 in addition the pressure is assumed to be equal at the connecting point of the two systems on the discrete fractures and is written as 28 p f d x d y d p f d x d y d 3 2 bem and gem based dfm for flow in the dual porosity system in this section we presented mathematical fundamentals for the proposed gem based dfm which is used to obtain the numerical solution of the theoretical model proposed in section 3 1 1 we also made a theoretical comparison between bem and gem for handling fluid flow in porous media with discrete fractures the procedures to obtain the solution using gem is quite like bem first the integral equation should be derived based on green s second identity then we discretized the boundary for bem and the domain for gem and the main fractures should be discretized for both methods finally equations are generated using the grids system and solved to obtain the solution 3 2 1 integral equation like other boundary element based methods gem begins by finding the relevant free space green s function for the problem for the transient problem described by eq 16 the fundamental green s function in free space is given by 29 2 g s f s g δ x d x di 0 in which g is the fundamental solution in free space δ x d x di is the dirac delta function it is not the same function shown in eq 11 x di is a point in the two dimensional domain for two dimensional problems the fundamental solution of eq 29 for a homogeneous domain in laplace space is zauderer 1983 30 g 1 2 π k 0 r d s f s where k 0 x is the modified bessel function of the second kind rd is the distance between a field point and the source point and given by 31 r d x d x d 2 y d y d 2 eq 29 p f d eq 16 g and taking the integration within the domain results in 32 ω p f d δ x d x di d ω ω p f d 2 g g 2 p f d d ω ω g 2 π k f d n 1 n f γ n q f d l d δ x d y d d l d d ω for the term on the left hand side of eq 32 we can drop the integral over the domain using the property of the dirac delta function 33 ω p f d δ x d x di d ω θ i 2 π p f d i in which θ i is the nodal angle at the point i θ i is the angle enclosed by the boundary for a point on the boundary θ i equals 2π for a point within the domain according to green s second identity 34 ω p f d 2 g g 2 p f d d ω γ p f d g n g p f d n d γ where γ is the boundary of the domain ω n is the outward pointing normal on the boundary for the second term on the right hand side of eq 32 it can be simplified using eq 13 35 ω g 2 π k f d n 1 n f γ n q f d l d δ x d y d d l d d ω 2 π k f d n 1 n f γ n g q f d l d d l d substituting eqs 33 35 into eq 33 results in 36 θ i 2 π p f d i γ p f d g n g p f d n d γ 2 π k f d n 1 n f γ n g q f d d l d 0 eq 36 is the integral equation of the model discretization approximation is needed to solve the model in the following we presented the discretization of eq 36 using bem and gem respectively for comparison 3 2 2 bem based dfm in this section we introduced the bem based dfm to make a comparison with the proposed gem based dfm we use the example shown in fig 3 to illustrate the discretization of bem in this case only the boundary and the fractures are discretized the boundary is discretized into nb elements the fracture networks are discretized into nf elements here one should notice that this model can also handle fractures connected to the boundaries when closed boundaries are handeled this problem can be handled with no changes when other kinds of boudnaries are considered in the model we just need to change the boundary conditions eqs 19 and 24 of these fractures the discretized form of eq 36 is given by 37 θ i 2 π p f d i e 1 n b γ e p f d g n g p f d n d γ 2 π k f d n 1 n f γ n g q f d d γ 0 in which γ bj and γ fk are the jth boundary element and kth fracture segment if the boundary and the fracture elements are regarded as constant elements that is the properties of each element are uniformly distributed eq 37 can be further simplified to 38 θ i 2 π p f d i j 1 n b p f d γ b j g n d γ j 1 n b p f d n γ b j g d γ 2 π k f d k 1 n f q f d γ f k g d γ 0 if the point i in eq 38 is located on the boundary elements and fracture elements we obtain nb nf equations however there are 2 nb nf unknowns so other nb nf equations are needed to obtain the solution the boundary conditions and the flow equation within the fracture system are used to this in general the boundary condition is classified into three types they are given as follows dirichlet boundary condition pfd c 1onγ neumann boundary condition k p f d n c 2 on γ cauchy boundary condition ζ 1 p f d ζ 2 k p f d n c 3 on γ where c 1 c 2 c 3 ζ1 and ζ2 are constants using the boundary conditions of the nb boundary elements we can obtain nb functions which are used to eliminate nb unknowns in the model in this way we obtain the following equations 39 a n b n b b n b n f o n b n f c n f n b d n f n f f n f n f u n b 1 q n f 1 p n f 1 r n b 1 s n f 1 in which u is the unknown vector for the boundary it is the flux for a constant pressure boundary and it is the pressure for a closed boundary q and p are the flux and pressure on the fracture elements a b c d and f are coefficient matrixes with non zero elements o is a matrix with all zero elements r and s are vectors it is found that there are only nb nf equations in eq 39 so we still need nf equations to solve the model in this paper the fdm is used to handle flow within the fracture networks and nf equations are obtained and this is presented in section 3 3 the computational efficiency of eq 39 is not good because a dense matrix is generated using bem in addition the computational expense is very high in calculating the integrals in the coefficient matrix of eq 38 numerically for transient problems the fundamental green s solution g should be updated step by step so the integrals should also be calculated at every step it should be noted that there are nb nf 2nb nf integrals in the equations in each time step this number can be decreased to nb nf 2 if the outer boundary is assumed to be closed if nt steps are modeled the total number of integrals should be at least nt nb nf 2 therefore the bem is quite time consuming if many boundary elements and fracture segments are handled in the model the procedures used in the bem based dfm can be summarized in fig 4 3 2 3 gem based dfm in conventional gem models the transient flow problem in porous media with multiscale fractures is not addressed in this section the grids system and discretization method are presented for the proposed gem based dfm gem requires the entire domain to be discretized and has good adaptability to the grids system in this paper cartesian grids are used to discretize the domain and one dimensional grids are used to discretize large scale fractures as shown in fig 1 b there are mainly three advantages for the application of cartesian grids first the discretization of cartesian grids is very convenient to use besides detection of the intersection points between individual fractures and the cartesian grids provide a natural way to discretize the fracture networks in addition many domain grids are the same if the cartesian grids are used this will greatly decrease the number of integrals in the coefficients and save computation time however for realistic cases groundwater simulation in fractured rock formations usually requires the challenge of unstructured mesh generation lee and ni 2015 lee et al 2019 it is promising to explore the extension of simulation with three dimentional unstructured mesh as shown in fig 5 a schematic is used to present the connections of domain grids and individual fractures first the domain is discretized into several blocks with the cartesian grid then discrete fractures are embedded into the domain grids and discretized if a fracture intersects with the edges of the domain grids and other discrete fractures in each block the four corner nodes are used as solution points of unknown pressures in the dual porosity formation the midpoint of each fracture element is used as the solution point of the pressure of the fracture element and the flux from the block to each fracture element is assumed to be uniform fluid flow in the system can be discretized into three processes and the example shown in fig 5 is used to explain these processes the first process is the flow between the matrix and small scale fracture of a dual porosity block for example m1 and f1 this process is analytically incorporated into the sf s as shown in eq 17 the second process is the flow between dual porosity blocks the small scale fracture system for example f1 and f2 this is calculated using eq 40 and all the connected blocks are coupled at the solution points in this process the discrete fracture segments are regarded as sinks for a block for example f2 f3 f4 and f5 are sinks of the block f2 and a dual porosity block and the connected discrete fracture segments are coupled using the continuity of pressure shown in eq 28 and the sinks q f d in eqs 40 and 65 the fluid flow between dual porosity blocks and discrete fracture elements is computed with the gem based dfm and the mathematical fundamentals will be presented in this section the third process is fluid flow between discrete fracture segments for example f1 f2 f3 etc to further explain this we extracted the discrete fractures from fig 5 and the extracted fractures are shown in fig a 3 the fluid flow between adjacent fracture segments is computed with the segment center based fdm presented in section 3 3 for example f1 and f2 for each fracture element the fluid contribution from the connected dual porosity block is regarded as a source term for example qf1 is a source term of f1 in section 3 3 we will also present the approaches to handle cross fractures for example f2 f3 f4 and f5 boundary conditions at the fracture tips and fractures connected to the wellbore the integral equation presented in eq 36 for homogeneous problems can also be applied to each block which is assumed to be homogeneous the integral equation for the eth grid is written as 40 θ i 2 π p f d i j 1 4 γ b e j p f d g n d γ j 1 4 γ b e j p f d n g d γ 2 π k f d k 1 n f e γ f e k g q f d d γ 0 for the eth grid ω e is the domain of the gird γ be is the boundary of the domain ω e for the rectangular grids system there are four boundaries for each gird γ bej is the jth boundary element γ fe is the fracture element within the eth grid assuming there are n f e fracture elements within the eth grid γ fek is the kth fracture element the element with the subscript and superscript of e mean the element is numbered within the eth grid if e is dropped it means the elements are numbered in the whole system ω is the whole domain γ bj is the jth edge among all the edges of the domain grids γ fk is the kth fracture element among all the fracture elements in each dual porosity block the corners are used as the solution nodes for the unknown pressures in the dual porosity formation and the parameters for the integrals over the edges are calculated by interpolation each fracture element is treated as a sink within the block and fluid does not flow through the edges to the connected discrete fractures the fracture elements are treated as constant elements which means that the properties are uniform in each fracture element the second and third term in eq 40 are integrals over the edges of the blocks both the pressure p f d and pressure derivative p f d n for each edge are approximated in terms of the values at the two solution nodes of each edge the linear shape function is 41 p f d p f d 1 n 1 p f d 2 n 2 in which n 1 1 ξ n 2 ξ eq 41 is also used for the approximation of p f d n for each edge of a block then eq 40 is transformed to 42 θ i 2 π p f d i j 1 4 r i j e p f d j j 1 4 l i j e q f d j e k 1 n f e v i k e q f d k 0 where 43 r i j e γ b e g n n j d γ 44 l i j e 1 k f d γ b e j g n j d γ 45 v i k e 2 π k f d γ f e k g d γ 46 q f d j e k f d p f d j n for the e th element from eq 42 several equations are generated if the observation point i runs over the corner points of a block or over the mid points of the fracture segments within the block these equations are used to obtain the solution of the model it should be noticed that the unknown pressure normal derivative q f d j e is with a superscript e unlike the pressure p f d j this signifies that the pressure normal derivatives at the same corner point j are supposed to differ for different domain blocks for the cartesian grids used in this paper four blocks interact at a solution point within the domain and two blocks interact at a solution point on the boundary each block has a pressure normal derivative at the same solution point however the unknown pressure should be continuous at this point and all the connected blocks share one unknown with so many unknowns at the same point the model equations and the closure problem will be addressed in the next section here it is important to restate the pressure continuity condition shown in eq 28 for a point on a discrete fracture segment 47 p f d i p f d if i is located on the fracture the flux connectivity at the solution points of the domain grids the closure problem will be presented in section 3 2 4 and the flux connectivity at the discrete fractures will be presented in section 3 2 5 3 2 4 solution system construction and its closure problem as shown in eq 42 four equations are generated if the point i subsequently runs over the four corner points of the eth block we can write the four equations in the following form 48 a m e p f d l m e q f d e v m e q f d 0 where 49 p f d p f d 1 p f d 2 p f d 3 p f d 4 q f d e q f d 1 e q f d 2 e q f d 3 e q f d 4 e q f d q f d 1 q f d 2 q f d n f e 50 a m e r 11 e θ i 2 π r 12 e r 13 e r 14 e r 21 e r 22 e θ i 2 π r 23 e r 24 e r 31 e r 32 e r 33 e θ i 2 π r 34 e r 41 e r 42 e r 43 e r 44 e θ i 2 π 51 l m e l 11 e l 12 e l 13 e l 14 e l 21 e l 22 e l 23 e l 24 e l 31 e l 32 e l 33 e l 34 e l 41 e l 42 e l 43 e l 44 e v m e v 11 e v 1 n f e e v 21 e v 2 n f e e v 31 e v 3 n f e e v 41 e v 4 n f e e for a corner point θ i π 2 it should be noted that the third term in eq 48 equals zero if there are no fracture elements in the eth block because lm e is a square matrix with no zeroes so eq 48 can be rewritten as 52 q f d e a p m e p f d a q f e q f d 0 where a p m e l m e 1 a m e a q f e l m e 1 v m e therefore for each of the corner points p the pressure normal derivative is expressed using the pressure vector p f d and flux vector q f d 53 q f d p e a p m p e p f d a q f p e q f d 0 in which a p m p e and a q f p e are the pth row in the matrixes a p m e and a q f e if there are n f e discrete fractures in the eth block and the point i is located at the midpoint of a discrete fracture element the following equations are obtained according to eq 42 54 a f e p f d l f e q f d e b e p f d v f e q f d 0 where 55 a f e r 11 e r 12 e r 13 e r 14 e r n f e 1 e r n f e 2 e r n f e 3 e r n f e 4 e 56 l f e l 11 e l 12 e l 13 e l 14 e l n f e 1 e l n f e 2 e l n f e 3 e l n f e 4 e v f e v 11 e v 1 n f e e v n f e 1 e l n f e n f e e 57 p f d p f d 1 p f d 2 p f d n f e b e θ i 2 π e n f e n f e in this case the fracture point is within the block θ i 2π substituting eq 52 into eq 54 we obtain 58 b p m e p f d b q f e q f d p f d 0 in which b p m e l f e a p m e a f e b q f e v f e l f e a q f e eqs 52 and 58 are the equations obtained from one of the domain grids and this can be applied to all the grids in the system however there is still a closure problem because there are four unknown pressure normal derivatives at each solution point within the domain this problem is addressed in the following in this paper the concept suggested by taigbenu 2008 is applied in this paper to introduce additional equations at the corner nodes of the grids it is based on the integration of the flux the permeability multiplied by the pressure normal derivative around a circle of small radius σ around a solution point as shown in fig 6 as the radius σ tends to zero the integral equals zero if the pressure is continuous around the point it is obvious that continuity is often assumed in the model this is also why the flux exchange between a domain grid element and the connected discrete fractures is assumed to not happen on the edges of the grid 59 k f d p f d n d n k f d p f d n d n 0 the domain is discretized in numerical models eq 59 can be written as 60 k f d p f d n d n lim σ 0 σ 0 2 π q f d j d θ i 1 m q f d j i θ i 0 in which θ i is the angle of element i and m is the numbers of grids intersecting at the point for cartesian grids θ i π 2 m 4 for internal points and m 2 for points on the closed boundary 61 i 1 m q f d j i θ i π 2 i 1 m q f d j i i 1 m q f d j i 0 it should be noted that eq 61 can be also used for the nodes on the boundary if the outer boundary is closed for a corner point we could obtain m equations using eq 53 and adding them up 62 e 1 m q f d p e a p m p e p f d a q f p e q f d 0 substituting eq 61 into eq 53 we obtain 63 e 1 m a p m p e p f d a q f p e q f d 0 therefore one equation is obtained by adding the m equations up at this point and the pressure normal derivative is excluded from the unknowns applying eqs 58 and 63 to the whole grids system and coupling the equations we obtain 64 a pm a qf o b pm b qf e p fd q fd p fd 0 there is only one unknown p f d for each corner point of the domain grids system and two unknowns p f d and q f d for each fracture segment so np 2nf unknowns in total as shown previously we can obtain one equation for each corner point of the domain girds and one equation for each discrete fracture element that is np nf equations in total therefore we still need nf equations to obtain a unique solution of the system and this is presented in the next section for fluid flow within the discrete fracture system here we can estimate the number of integrals in the system it is shown in eq 42 that there are 32 integrals on the edges for one grid and 4 n f e integrals over the fracture elements within the grid this will be a very large number if the integrals are calculated for every block actually the integrals do not need to be calculated for every block for blocks with the same size and properties the integrals should only be computed once this will save much computation time therefore if the domain grids are all in the same size and the reservoir is homogeneous the number of integrals for the whole grids system should be at least nt 32 9nf times which is a rather small value comparing to bem for the homogeneous problem however the number of integrals should be larger if some part of the reservoir is heterogeneous the procedures used in the gem based dfm can be summarized in fig 7 here we can find that the procedures for the two methods are the same however there are mainly three differences first the meshes for the two methods are totally different only the fractures and the boundaries are discretized in the bem based dfm while the domain is also discretized in the gem based dfm second the methods to handle fluid flow in the domain are different the boundary elements and fracture segments are used to generate the equations in the bem based dfm while the solution points and fracture segments are used to generate the equations in the gem based dfm third for flow in the domain the equations are generated using all the boundary elements and fracture segments in the whole reservoir in the bem based dfm while only the edges and fracture segments in a local domain grid are used to generate the equations in this way a dense matrix is generated using the bem based dfm while a sparse matrix is generated using the gem based dfm 3 3 fdm solution for flow within the discrete fractures for the one dimensional flow in the discrete fractures as shown in eq 23 the fdm is used to model fluid flow within the fracture elements as shown figs 1 c and 5 intersection points between individual fractures and between fractures and cartesian grids furnish a natural discretization of the fracture network therefore the fracture elements are not with equal length so the discretization form of eq 23 is written as 65 2 δ l k δ l k δ l k 1 p f d k 1 p f d k 2 δ l k δ l k δ l k 1 p f d k 1 p f d k s η f d p f d k 2 π c f d q f d k where δlk is the length of the kth fracture element we define 66 t k 1 δ l k 2 67 t k k 1 t k t k 1 t k t k 1 eq 65 is transformed into 68 t k k 1 p f d k 1 p f d k t k k 1 p f d k 1 p f d k δ l k s η f d p f d k 2 π c f d q f d k in which t k k 1 is regarded as the transmissibility between the kth and k 1 th elements if a fracture segment is at the tip as shown in fig a 3 the outer boundary condition shown in eq 24 is used 69 p f d l d t i p p f d k 1 p f d k δ l k 2 0 p f d k 1 p f d k thus eq 68 is transformed into eq 70 for the element at the fracture tip 70 t k k 1 p f d k 1 p f d k δ l k s η f d p f d k 2 π c f d q f d k if more than two fracture segments connecting with each other for example f2 f3 f4 and f5 in fig 5 as shown in fig a 3 the star delta transformation can be used to handle fluid flow between any two fracture elements karimi fard et al 2003 jia et al 2016 if there are nf fracture segments intersecting at the same point the transmissibility between kth and jth segment is calculated using eq 71 71 t k j t k t j i 1 n f t i applying eq 71 eq 68 is transformed into eq 72 for multiple fractures intersecting 72 i 1 n f t k i p f d i p f d k δ l k s η f d p f d k 2 π c f d q f d k if a fracture segment connects to the wellbore as shown in fig a 3 p f d k 1 p w d δl k 1 0 so eq 68 comes to 73 t k k 1 p f d k 1 p f d k t k p w d p f d k δ l k s η f d p f d k 2 π c f d q f d k according to eqs 68 70 72 and 73 we obtain the following equations for fluid flow within the fracture system 74 c f p fd d f q fd 0 for the same fracture segment the flux term q f d k in eqs 68 70 72 and 73 is equal to the flux term q f d k in eq 42 because of the flux conservation condition the matrix form q fd in eqs 74 and 64 are the same it should be noted that if the well is producing at constant rate condition p w d in eq 73 is also an unknown the inner boundary condition shown in eqs 26 and 27 are needed 75 p f d j l d w j p f d j p w d δ l d 2 2 π c f d q w d j q w d j c f d 2 π p f d j p w d δ l d 2 76 j 1 n p w f j p f d j p w d 2 π s in which w f j c f d j δ l d j 2 3 4 coupled solution in sections 3 2 and 3 3 the gem based dfm solution system is constructed for flow in the dual porosity system and the fdm solution system for flow within the fracture networks are constructed the two systems should be coupled to obtain the final solution of the model coupling eqs 64 74 and 76 the solution of the system is obtained 77 a pm a qf o o b pm b qf e o o c f d f o o o w f w f j p fd q fd p fd p w o o o 2 π s where o is a zero matrix o is a zero vector e is a unit matrix there are np 2nf 1 unknowns and np 2nf 1 independent equations in eq 77 a unique solution is sure to be obtained one should notice that the solution is obtained in laplace space the solution in the time domain is obtained using the numerical algorithm proposed by stehfest 1970 for a parameter χ in the laplace domain the corresponding value in the time domain is 78 χ ln 2 t d i 1 n v i χ ln 2 t d i where 79 v i 1 n 2 i k i 1 2 min i n 2 k n 2 1 2 k n 2 k k k 1 2 k 1 in which n is a constant and often given as 6 and 8 vi are constants if n is given here we should note that n iterations are needed in each time step to obtain the solution in the time domain this is also a drawback for numerical simulation in the laplace domain we can directly derive the gem model and obtain the numerical solution in the time domain in this way the temporal derivative term on the right hand side of eq 10 should be approximated by the fdm taigbenu 2008 in addition the fundamental solution to the problem shown in eq 30 should be replaced by 80 g 1 2 π ln r d there are mainly two advantages to use a steady flow solution first the numerical solution can be directly obtained in the time domain and much computational can be saved because the inverse problem from the laplace domain is avoided second the integrals in eqs 43 45 need to be calculated only once because eq 80 is independent of time however one should note that eq 80 is the fundamental solution for steady flow problems the application of eq 80 to transient flow problems will reduce the precision of the model particularly the early flow regime can be totally wrong therefore eq 80 can only be used for steady flow problem and some transient problems where the precision in early time is not important for example in petroleum engineering the steady solution can be used in models for oil and gas production prediction the performance is predicted by days but it cannot be used in models for transient behavior analysis in well testing the performance is predicted by minutes in this paper there are two reasons why the model is solved in the laplace domain first we are focused on proposing the gem based dfm for modeling the transient behavior in fractured porous media the early flow behavior is also considered second multi porosity models can be incorporated in the same model practically without any modification in the numerical approach just as shown in eqs 16 and 17 so far the fundamentals of the gem based dfm have been presented one can notice that the grids system of the proposed model is quite like that of the edfm however we can find that they are different numerical methods according to the mathematical fundamentals the edfm is normally based on the fdm and the concept of average normal distance is used to calculate the transmissibility between domain grids and fracture segments however the gem based dfm is based on green s function and the boundary equation shown in eq 36 is used to govern the fluid flow between domain grids and fracture segments 4 simulation examples and discussion in this section two cases are used to validate the proposed model the first model is a two zone model based on bem jia et al 2017 this case is to show the proposed model s capability of handling discrete fractures in the second validation case the commercial simulator eclipse is used to verify the proposed model s capability of handling real heterogeneities in petroleum industry the data in the wellbore production data is often analyzed to reveal the formation properties because the production data is easy and cheap to measure the pressure transient behavior at the wellbore is analyzed for all cases which are assumed to be single phase and two dimensional to present all the flow regimes clearly the wellbore storage and skin effect are not considered for all cases presented below the initial pressure throughout the entire reservoir is the same the outer boundary of the reservoir is assumed to be closed and the wellbore is assumed to produce at a constant rate 4 1 model validation 4 1 1 flow in a two zone system with discrete fracture networks in this section the developed model is validated using a bem model proposed by jia et al 2017 using the two models we compared the dimensionless pressure and the pressure derivative results obtained a two zone system is modeled and it is assumed to be single porosity the fluid is assumed to be slightly compressible and the viscosity and compressibility are assumed to be constants the properties of the two zones are all the same except the formation permeability and the parameters of the inner zone are chosen as reference parameters the dimensionless permeability of the outer zone is 0 01 the reference length is 10 m the dimensionless conductivity of the discrete fractures is set to 1000 as shown in fig 8 the dimension of the whole reservoir is 320 m 200 m the dimension of the inner zone is 140 m 100 m and the wellbore is located on a fracture segment for comparison these formation and fracture parameters are the same for both the bem and the proposed gem model in this paper the schematic of the grids system for bem and proposed gem model are shown in fig 8 for the gem model the dimensionless grid size of the domain grids is given as 1 1 and the discrete fractures are embedded into the domain grids and discretized 640 domain grids and 64 fracture elements are used in total for the bem model only the discrete fractures domain boundaries are discretized into several segments the dimensionless boundary element length is about 2 and the dimensionless fracture element length is set to about 0 5 the length of the elements may not be multiples of 2 and 0 5 in total 52 outer boundary elements 24 inner boundary elements and 67 fracture elements are used for the bem model the results of this validation case shown in fig 9 illustrate that our model provides a good match with the bem model the pressure at the wellbore as shown in fig 8 a is recorded this shows the ability and precision of the proposed method in handling fluids flow in the formation with fractures and simple heterogeneities in addition we also compared the computational efficacy of the two models for the two zone bem model the number of integrals in each step should be n b o 2n b i 2 2n b i nf 2 so 23 225 integrals should be calculated this is a relatively large number however for the proposed gem model there are two zones and two types of grids are used in this case the number of integrations over the grid boundary is 2 2 4 4 4nf for the two kinds of domain grids the number of integrations over all the fracture elements is 4nf it should be noted that other 7 4 4 integrals should be needed because there are 7 fracture intersections in the model thus in total 944 integrals are needed in each time step for the proposed gem model the number of integrals can be largely reduced if the proposed gem based dfm is used for this kind of problem in this paper the programs for both models are based on matlab r2018a the processor of the computer is intel xeon cup w2540 2 93 ghz and only one core is used in computation for comparison the computation time for the bem model is 5 72 h while the computation time for the gem model is 9 7 min another reason for the expensive computation of the bem model is that the dense matrix should be solved in each step however the computation time for both cases can be reduced if more cores are used it is concluded that the proposed gem model is quite efficient in handling fluid flow in bounded formation with discrete fracture networks 4 1 2 flow in heterogeneous porous media with discrete fractures in this section we validated the proposed gem based dfm by modeling fluid flow in heterogeneous dual porosity media with large scale fractures explicitly represented to validate the proposed method we used the commercial numerical simulator eclipse which is based on fdm the pseudo steady dual porosity model with square matrix blocks is used for comparison in addition only orthogonal fractures can be modeled using eclipse because discrete fractures are modeled with refined grids and the ability of the proposed model in handling complex fracture networks have been validated using a bem model so a simple fracture topology is used in this case fig 10 shows the grid system of the gem model the model parameters including the characteristic length inter porosity flow coefficient storativity ratio and dimensionless permeability of the dual porosity system are shown in fig 10 other parameters are shown in table 1 the distribution of characteristic length inter porosity flow coefficient dimensionless permeability and storativity ratio of fracture system are assumed to be heterogeneous as shown in fig 10 the grids system for the model using commercial simulator eclipse is shown in fig 11 to exclude the influence of grid effects the grid size for the eclipse runs is reduced by half and refined grids are used near the discrete fracture for this case respectively 120 grids and 858 grids are used for the proposed gem and commercial numerical simulator fig 12 shows the validation results using the commercial numerical simulator the pressure at the wellbore as shown in fig 10 a is recorded it is shown that the solutions obtained with our model and the commercial simulator are almost the same except the discrepancy when the dimensionless time is exceedingly small t d 10 7 although relatively coarser grids are used for the gem model quite precise results are obtained using the proposed gem based dfm this shows the ability and precision of the proposed gem in handling fluid flow in heterogeneous media with discrete fractures at present we should admit that the speed of the matlab code of the proposed gem is not as fast as the commercial simulator in this case 21 7 min are used in our model while 18 s are used by the commercial simulator however at present we cannot only compare the speed with the commercial simulator in which the code is carefully optimized and parallel computing is applied our model also has some advantages first not only orthogonal fractures but also complex fracture networks can be handled second different kinds of dual porosity models and even multi porosity models can be incorporated in the proposed gem based dfm just by changing a formulation to compute the f s shown in eq 17 third a high level computational precision is obtained even at the early time with a relatively coarse grids system and this will make it convenient to conduct transient analysis with a short time period like well testing it should also be noted that the computation time is much longer than it used in the previous case this is because an extremely heterogeneous problem is handled in this case and much more integrations are needed in each step we hope to optimize the code of the proposed model in order to optimize the computational time and this will be our future work 4 2 field case study and discussion in this section a field case is studied based on the proposed model this case is from a shale gas field from the southern sichuan basin which is now the leading area for shale gas development in china the thickness of the black shale in this region exceeds 100 m among which the lower longmaxi and wufeng formation are the target formations because it is characterized by its abundant organic matter high maturity strong gas generation intensity and favorable brittleness these characteristics are quite beneficial for shale gas formation and accumulation in addition the favorable brittleness characteristic makes it easy to generate fracture networks in hydraulic fracturing long horizontal wells are drilled in the target formation and multiple stage hydraulic fracturing is used in each horizontal well to promote shale gas production in this section we are focusing on simulating the performance of a multiple stage fractured horizontal wells from this gas field the well is 1500 m long and fractured with 15 stages and 3 clusters are used for each stage the microseismic data show that a complex fracture network is generated around the wellbore as shown in fig 13 a but we do not know the exact fracture networks in addition the extent of srv is also unknown therefore it is important to study the effects of fracture parameters on the transient behavior of the well in addition the thickness of the target formation is 46 m the microseismic data shows that the target formation is fully penetrated by the fractures as shown in fig a 4 therefore two dimension model is used in analysis in many previous studies symmetric and transverse fractures and homogeneous srv assumptions are often used for field case analysis just like the case shown in fig 13 b in this section multiscale fractures and the heterogeneities of srv are considered in the model so the other two conceptual models are used in the analysis as shown in fig 13 c d for all three scenarios large scale main fractures are represented explicitly small scale induced fractures in the srv are described using the dual porosity model shown in fig 2 c the reservoir beyond the srv is assumed to be a single porosity zone for the conceptual model shown in fig 13 d the heterogeneity within the srv is modeled the shape factor and storativity ratio are assumed to be linearly distributed depending on the distance to the main fractures for the conceptual model shown in fig 13 c complex fracture networks are applied but the properties of the srv are assumed to be homogeneous in the following the effects of multiscale fractures and the heterogeneities of srv on the transient behavior are analyzed based on the three conceptual models shown in fig 13 b d comparing to the uncertainties of the shale matrix the parameters of fracture networks are with much greater uncertainties and have a more significant influence on the transient behavior of shale gas wells therefore four problems are discussed about the fracture parameters including fracture configuration the area and heterogeneities of srv because the obtained properties of the dual porosity system and discrete fractures are often with uncertainties another case is also provided in section 4 2 4 to match the parameters using the production data some properties of the formation are shown in table 2 and these parameters are given the same value for all the studied cases some fracture parameters are listed in table 2 like matrix porosity these parameters are not studied in this paper because these parameters are assumed to be with less uncertainty and have less influence on the transient behaviors the fracture width is not put in table 2 because the fracture width is included in the conductivity which is studied in the cases and defined as cf kfwf in this section the reference parameters for all the cases are given the same for comparison and shown in table 2 the reference porosity times compressibility is given as μ gi ctm ctf the gas pvt properties are shown in fig a 5 4 2 1 case 1 fracture configuration the hydraulic fractures provide many pathways for fluid flow in the unconventional formation the properties of large scale main fractures can have a great influence on shale gas production obtaining the configuration and total length of fractures is a major concern to have a basic understanding of the influence of fracture configuration and fracture length four scenarios are studied in this case as shown in fig 14 complex fracture network scenarios with different fracture numbers and length are shown in fig 14 a b and fig 14 c d is for transverse fracture scenarios for comparison the fracture total length is the same for scenarios a and c and so are scenarios b and d in addition the number of fractures that are directly connected with the wellbore is given the same value for scenarios a and c and so are scenarios b and d the homogeneous dual porosity model is used to the srv while the single porosity model is used to the reservoir beyond the srv the studied fracture parameters are shown in table 3 and other parameters are shown in table 2 the simulation results are shown in figs 15 and 16 it is obvious that pressure drop in the srv and the fracture networks will be smaller if there are more fractures by comparing scenarios a and b in fig 15 in addition some interesting results can be drawn from this case first as shown in fig 15 the drainage area of real fracture networks is much smaller than that of the transverse fractures with the same fracture length second the effects of fracture configuration have a much larger influence on transient behavior than the fracture length one can notice that the drainage area of transverse fractures with 11 765 m fractures scenario c is much larger than the drainage area of fracture networks with 15 519 m fractures scenario b in addition fig 16 shows the dimensionless pressure in the horizontal wellbore which is marked in fig 13 a the results show that the pressure drop in the wellbore is much smaller for the cases with transverse fractures than fracture networks therefore this result is very important in production data analysis and we will present some further cases in section 4 2 4 figs 16 presents the pressure transient behavior of the four models there are four main flow regimes shown on the type curves the first flow regime is a bilinear flow regime with a ¼ slope on the log log plot which is caused by transient linear flow in both the hydraulic fractures and the dual porosity system the second flow regime is mainly caused by fracture interference so a pseudo steady flow character is observed however the slope is not 1 because of the influence of fluid contribution from the srv and inter porosity flow in the dual porosity system the third flow regime is dominated by fluid flow in the srv beyond the hydraulic fractures for long horizontal wells a linear flow would be observed if the srv is large enough however the srv is limited in reality and this flow region is replaced by boundary dominated flow before a ½ slope can be observed on the type curve the last flow regime is boundary dominated flow the results also show that the length and configuration of the hydraulic fractures have a significant effect on transient behaviors 4 2 2 case 2 area of the srv in addition to the large scale main fractures the small scale induced fractures also contribute a lot to gas production in this paper dual porosity is used to model the small scale fractures in the srv one of the uncertain parameters concerning the dual porosity system is the area of the srv the srv area determines the control reserve of the well and it also determines the well space and in fill well design three scenarios are analyzed in this case to study the effects of the srv area in the three scenarios the boundary of the srv is assumed to be 20 m 60 m and 100 m from the fracture networks respectively the fracture networks are shown in fig 14 a in this case and all parameters except the srv area are shown in tables 2 and 3 fig 17 a b presents the schematics for the scenarios with the srv boundary being 20 m and 100 m from the fracture networks and the corresponding dimensionless pressure profile at t d 1 is shown in fig 17 c d it is very obvious that the drainage area is larger for scenarios with larger srv to maintain the same production the pressure drop in the drainage area for scenarios with smaller srv should remain much larger than scenarios with larger srv the dimensionless pressure and the pressure derivative curves are shown in fig 18 the results show that the srv area mainly influences the flow regimes after the bilinear flow regime if the srv area and the matrix permeability are small the fluid contribution from the reservoir beyond the srv is quite limited so the pseudo steady flow characteristics for small srv area cases will last for a long time this is also why the dimensionless pressure for small srv area scenarios is higher than the other scenarios when 0 1 t d 300 this period is quite important in the analysis because most of the production period for field shale gas wells is during this time interval 4 2 3 case 3 heterogeneities in the srv another important factor is the heterogeneity of the srv especially the shape factor of the dual porosity system as shown in figs 1 and 2 we assume the value of the shape factor and fracture porosity of the dual porosity system are proportional to the distance to the nearest main fractures three scenarios with the same average properties are analyzed in this part the average shape factor and porosity of the dual porosity system are respectively given as 0 5 and 1 10 5 in the first scenario the homogeneous scenario in fig 19 homogeneous srv is assumed and the schematic is shown in fig 13 c all parameters except the srv area are shown in tables 2 and 3 in the second and third scenarios the heterogeneous scenario 1 and 2 in fig 19 the distribution of shape factor is assumed to be linear and the schematics are respectively presented in fig 17 a and fig 13 d the porosity distributions for heterogeneous cases 1 and 2 are also assumed to be linear and their ranges are respectively 5 10 6 1 5 10 5 and 1 10 6 1 9 10 5 here the properties for each grid element are given based on the distance from the element s center to the nearest hydraulic fracture fig 20 b d shows the dimensionless pressure profile in the formation for all three scenarios one can notice that the pressure profiles at t d 0 03 for all the cases are quite similar however they are not the same the pressure drop in the drainage area for the homogeneous case is highest and the heterogeneous scenario 2 is the lowest this is because the drainage area is within 30 m from the hydraulic fractures at this time and the shape factor and induced fracture porosity in this area is lowest for the homogeneous scenario and highest for heterogeneous scenario 2 the dimensionless pressure in the wellbore and the pressure derivative are shown in fig 21 the results show that the effects of shape factor distribution on transient behavior are significant when t d 0 08 however the shape factor distribution in this case has little influence on the later flow regimes therefore if the properties in the srv obey linear distribution a homogeneous srv can be used in history matching first then we can match the early bilinear flow regime to obtain the distribution in the area 4 2 4 case 4 production data analysis in this case all three conceptual models are used to match the field production data including transverse fractures models with homogeneous srv complex fracture network models with and without considering heterogeneities in the srv with the exception of some fracture parameters the other parameters are presented in table 2 the daily reports of the gas production rate and bhp are shown in fig 22 although variable production rate and variable bhp data can be matched with the proposed numerical approach the pressure behavior at constant production rate condition is presented to analyze the transient responses to match the pressure response at variable rate conditions the normalized pressure ψ i ψ w q s c and material balance time tca are used to process the production data wu et al 2016 81 t c a μ i c t i q t 0 t q t μ c t d t where ψ is the pseudo pressure which is defined in eq a 3 for the gas case the processed data using the normalized pressure and material balance time is shown in fig 23 one should note that the well is almost controlled by bhp after 300 days of production and this will make the production decline so the calculated material balance time using eq 81 is much larger than the actual time different flow regimes are recognized based on the slope exhibited on the log log plot and a large slope means a quick bhp drop in the wellbore it is obvious that there are mainly two flow regimes exhibited by the production data including a long linear flow regime and a pseudo steady flow regime the linear flow regime is mainly caused by fluid in the srv linearly flow into the main fractures the pseudo steady flow regime is mainly caused by fracture interference and the boundary of the inner srv because the matrix permeability is ultra low the reservoir beyond the srv does not make much fluid contribution to make up for the depletion in the main fractures and srv fig 23 presents the history matching results of the three scenarios we can find that good matches are obtained using all three conceptual models the production data can be matched with different parameter combinations and different models comparing the matched parameters for the three scenarios shown in table 4 the interpreted fracture length for the scenario with transverse fractures is much larger than the scenario with fracture networks in addition small average shape factor and induced fracture porosity are obtained if the heterogeneities in the srv are considered in the analysis we should keep in mind that complex fracture networks are generated in the formation of this case if transverse fractures are assumed in the model the interpreted fracture length will be misleading because it is much smaller than the actual fracture length besides the interpreted range of srv will be much larger this case also shows the large uncertainties in production data analysis different conceptual models reflect different information about the formation it is very crucial to choose a suitable conceptual model based on the known information about the reservoir on the other hand we can find that all the conceptual models can be incorporated in the proposed gem based dfm which makes it convenient to analyze production data and obtain the transient behavior of different conceptual models at present we should admit that the history matching result obtained in this case may not be the only one because this inverse problem consists of many uncertain parameters in addition the uncertainties will significantly increase if the parameters for different blocks are stochastically given in history matching it is a very interesting topic to extend the developed model to simulate interference tests and quantify the uncertainties by coupling an inversion algorithm for enhanced model calibrations this task will require the simulation to run tens of thousands of times so the code should be programmed and optimized based on a general purpose programming language like c 5 conclusions modeling the transient behavior of heterogeneous porous media with multiscale fractures is of significance although conventional bem can handle discrete fractures the real heterogeneous problem is not addressed in addition the computation of bem in handling large numbers of large scale fractures is rather expensive this paper is the first to present the gem based dfm for this problem based on the analysis in this paper the following conclusions are drawn 1 there are many integrals in the bem based dfm and the computation is rather expensive if amounts of discrete fracture and boundary elements are handled the proposed gem based dfm is a good choice for this problem by discretizing the domain into many blocks and applying the superposition principle within a lock block rather than the whole domain the number of integrals and computations can be largely reduced 2 there are several dramatic advantages in applying the cartesian grids to the discretization of the gem based dfm first the cartesian grids provide a natural way to discretize the fracture networks in addition this makes it convenient to eliminate the flux terms and handle the closure problem at a solution point by adding the equations up at the same point furthermore the number of integrals can be largely reduced because many blocks are of the same size and properties 3 the fracture parameters including length and configuration of the main fractures and shape factor porosity and heterogeneities of the induced fractures dual porosity have significant influences on the transient behavior the length and configuration of the main fractures affect almost all the flow regimes except boundary dominated flow regime with the same total fracture length the pressure drop in fracture networks is smaller for models with transverse fractures than complex fractures the area of the srv has a significant influence on the production period of the well because the srv area mainly controls the drainage area of the fracture network the field case shows that the same data can be matched with different models but different models reflect different information about the formation and should be compared the proposed gem based dfm serves as a good tool for this problem since many conceptual models can be simulated credit authorship contribution statement yonghui wu conceptualization investigation methodology software writing original draft linsong cheng funding acquisition resources supervision sidong fang software data curation visualization shijun huang project administration supervision pin jia writing review editing validation declaration of competing interest none acknowledgments the authors acknowledge that this study was partially funded by the national science and technology major project no 2017zx05037001 we also thank the national natural science fund of china no u1762210 for financial support supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 103489 appendix b supplementary materials image application 1 appendix a definitions of dimensionless variables we define the dimensionless pressure and time respectively by a 1 p d k r h p i p 1 842 q b μ and a 2 t d 0 0864 k r μ i ϕ r c t r l r 2 t for analysis of gas wells we follow the usual approach and incorporate the liquid flow analogy of al hussainy et al 1966 through the pseudo pressure transformation a 3 ψ 2 0 p p μ z d p in addition the time t in eq a 2 should be replaced by pseudo time ta a 4 t a 0 t μ g i c t i μ g p c t p d t the dimensionless pressure for the gas case can be defined as a 5 p d k r h ψ i ψ 1 291 10 3 q r t the dimensionless distances in the x and y direction are defined respectively by a 6 x d x l r a 7 y d y l r for one dimensional flow in the discrete fractures a 8 l d l l r dimensionless permeability is defined as a 9 k d k k r in this model we used the following definitions of dimensionless fracture conductivity a 10 c f d k f w f k r l r k f d w f d where wfd wf lr fracture conductivity is defined as cf kfwf for fluids flow in naturally fractured media it is very practical to use bulk properties in dual porosity models characteristics of the matrix and fracture media are incorporated into the model by the storativity and flow capacity ratios which can be defined by a 11 ω ϕ f c t f ϕ f c t f ϕ m c t m a 12 λ α k m k f l r 2 lr is the reference length which is chosen as a parameter as long as it stands for a length lr is chosen as the block size of the grid in this paper it should be noticed that lr is chosen as the half length for fractured many models and wellbore radius for vertical well models α is shape factor which is different for the different idealization of dual porosity models for square matrix blocks the flow between the matrix block and fracture system is assumed to be in pseudo steady the shape factor is defined as a 13 α 4 1 l x 2 1 l y 2 1 l z 2 where lx ly and lz are the characteristic length of the matrix blocks for cylindrical matrix blocks given the radius of the matrix cylinders r m the transient solution can be obtained analytically the shape factor is defined as a 14 α 8 r m 2 for slab matrix blocks given the width of the matrix slabs h m the transient solution can be obtained analytically the shape factor is defined as a 15 α 12 h m 2 to capture the heterogeneities of the porous media different blocks are of different properties and a set of reference properties including kr φ r and ctr should be chosen the following diffusivity ratio for the fracture system is defined a 16 η f d η f η r k f μ ϕ c t f k r μ ϕ c t r k f d μ ϕ c t r μ ϕ c t f for heterogeneous cases if we neglected the nonlinearity of viscosity and assumed kr kf φ r ctr φ f ctf η fd 1 fig a 1 shows the sketches of different idealizations of dual porosity models including square slab and cylinder warren and root 1963 kazemi 1969 de swaan 1976 raghavan and ohaer 1981 serra et al 1983 one should notice that the large scale fractures are handled explicitly and they are not included in the dual porosity system fig a 2 shows the schematic for fluid flow in the dual porosity system with different matrix shapes for different conceptual idealizations of dual porosity models f s in eq 16 should be given a different formulation the results derived in the literature can be used for homogeneous cases warren and root 1963 kazemi 1969 de swaan 1976 raghavan and ohaer 1981 serra et al 1983 however the formulations are different because the reference parameters are not the same for different heterogeneous problems therefore general formulations are given below a 17 f s 1 η f d single porosity model 1 η f d λ 1 ω 1 ω s λ ω η f d dual porosity model square 1 η f d λ 1 ω 3 ω η f d s tanh 3 1 ω s λ ω η f d dual porosity model slab 1 η f d λ 4 s 8 1 ω s λ ω η f d i 1 8 1 ω s λ ω η f d i 0 8 1 ω s λ ω η f d dual porosity model cylinder 
