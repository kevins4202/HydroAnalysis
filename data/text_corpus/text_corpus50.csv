index,text
250,capillary heterogeneity trapping caused by mesoscale heterogeneity at the millimeter scale has been shown to have a great potential in immobilizing a significant amount of co2 in co2 geologic storage the goal of this study is to develop and apply a macroscopic percolation simulator to better understand how post imbibition co2 capillary heterogeneity trapping varies with different types and degrees of mesoscale heterogeneity as well as to quantify and compare its contribution to the pore scale snap off bypass residual trapping mechanism using invasion percolation during drainage and ordinary percolation with macroscopic trapping during imbibition the macroscopic percolation simulator can rapidly simulate both post drainage and post imbibition co2 saturation fields under capillary gravity equilibrium producing results that are validated by a full physics reservoir simulator with a speedup of 10 to 100 times the macroscopic percolation simulation results have shown that for domains that are completely uncorrelated or with nonleaky downstream capillary barriers co2 heterogeneity trapping contribution always increases with the degree of heterogeneity of the domain this is consistent with previous experimental results however the relationship between the co2 residual trapping ability of a domain also depends on the spatial structure of the heterogeneity and trapping ability does not always increase linearly with the degree of heterogeneity as previously shown additionally when the capillary barrier is leaky then regardless of the degree of heterogeneity no extra capillary heterogeneity trapping can be achieved after long term imbibition finally this study demonstrates how residual trapping relationships may not be scale invariant and calls for more sophisticated upscaling methods such as the macroscopic percolation simulation method presented here keywords macroscopic percolation reduced physics simulation co2 sequestration multiphase flow residual trapping capillary heterogeneity trapping 1 introduction co2 geologic storage is an integral part of the climate change solutions that allow the society to transition toward carbon neutral energy while still relying on fossil fuels ipcc 2014 2005 rogelj et al 2018 there are several secondary trapping mechanisms that provide extra immobilization security of the co2 plume in addition to the cap rock primary trapping mechanism residual trapping by capillary forces is one such secondary trapping mechanism that is capable of immobilizing a significant amount of co2 ipcc 2005 conventionally the pore scale snap off and bypass mechanisms are considered to be the main trapping mechanisms responsible for residual trapping krevor et al 2015 however recent studies have shown that mesoscale heterogeneity at the millimeter to centimeter scale also plays an important role in residually trapping the nonwetting phase fluid causing what is known as capillary heterogeneity trapping corbett et al 1992 huang et al 1995 jackson and krevor 2020 kortekaas 1985 krevor et al 2011 meckel et al 2015 saadatpoor et al 2010 trevisan et al 2017 a few simulation studies have previously investigated capillary heterogeneity trapping of co2 or other nonwetting phase fluid such as oil under capillary dominated flow regimes a significant portion of the literature on this topic focuses on capillary heterogeneity trapping due to buoyancy flow behzadi et al 2011 gershenzon et al 2017 meckel et al 2015 ren et al 2019 ren and duncan 2019 saadatpoor et al 2013 2010 trevisan et al 2017 and just a few examine post imbibition capillary heterogeneity trapping the topic of this study corbett et al 1992 kortekaas 1985 ren 2018 kortekaas 1985 through mathematical simulation found that when water imbibition direction is perpendicular to the lamination oil capillary heterogeneity trapping occurs when inter laminae permeability contrast is present the same conclusion is reached by corbett et al 1992 with an eclipse black oil simulator more recently ren 2018 conducted 2d reservoir scale simulations with the cmg gem simulator and reported that the amount of capillary heterogeneity trapping is intrinsic to the heterogeneity of the domain later ren et al 2019 used an analytical method to identify and quantify the capillary heterogeneity trapping amount however ren et al s method only obtains the upper bound of the capillary heterogeneity trapping capacity and does not consider any contribution from pore scale residual trapping therefore it is of interest to develop a simulation method that can enable rapid and accurate quantification of both the mesoscale capillary heterogeneity trapping amount and the pore scale residual trapping amount of any heterogeneous domain in order to measure total post imbibition residual trapping and the relative importance of the two residual trapping mechanisms however full physics reservoir simulators such as the matlab reservoir simulation toolbox mrst that is used in this study are not well suited to the task of simulating low rate injection scenarios on domains with a high degree of capillary heterogeneity full physics reservoir simulations take a long simulated time to reach capillary equilibrium as many pore volumes of fluid need to be injected into the domain they can also take a long wall clock time to run when flow rates are low because small time steps are needed to ensure convergence this itself is because large contrasts in capillary pressure characteristic curves resulting from capillary heterogeneity can lead to convergence problems particularly at very low flow rates a type of reduced physics simulator based on macroscopic percolation mp can overcome such challenges ioannidis et al 1996 kueper and mcwhorter 1992 yortsos et al 1993 this type of simulator applies the pore scale microscopic percolation displacement algorithms to macroscopic voxels with well defined continuum scale properties such as porosity permeability and saturation hence the term macroscopic the mp simulator is best applied when capillary forces dominate the flow regime and there is no significant viscous impact on flow one major advantage of an mp simulator is that it can easily handle highly discontinuous and heterogeneous domains because the highly nonlinear dynamic multiphase flow displacement processes are not modeled another advantage of an mp simulator is the significant amount of speedup in simulation time that is achievable celia et al 2015 in the co2 storage field permedia s co2 migration module is a widely used industry mp simulator cavanagh and haszeldine 2014 meckel et al 2015 trevisan et al 2017 cavanagh and haszeldine 2014 first applied permedia to history match co2 plume migration at the sleipner site meckel et al 2015 and trevisan et al 2017 have also utilized this tool to investigate how the amount of domain average post drainage co2 saturation varies with different types and degrees of heterogeneity however permedia s original purpose is to model hydrocarbon migration as a consequence permedia assigns only one of two saturation values to all invaded voxels they are the irreducible water saturation for the voxels accumulating co2 behind a capillary barrier and the breakthrough co2 saturation for the voxels on the migration path this simple formulation does not allow permedia to report the more heterogeneous saturation fields often seen in coreflooding experiments furthermore permedia can only simulate nonwetting phase drainage and not wetting phase imbibition a number of past studies have presented mp formulations for generating domain effective relative permeability and capillary pressure curves for heterogeneous domains for both drainage jackson and krevor 2020 yang et al 2013 and imbibition nooruddin and blunt 2018 wolff et al 2013 yang et al 2020 therefore the mp algorithm can be used to generate upscaled properties to be used as inputs into full physics simulators to simulate co2 plume migration in order to save computational resources and increase simulation speeds as is done by jackson and krevor 2020 yet the mp simulator can also be directly applied to field scale domains due to the simplicity of the mp algorithm and its small computational burden in this study we will present just one such field scale mp simulation example by developing a fast and reliable mp simulator the current study aims to answer the following two questions for heterogeneous domains how does residual trapping ability vary with different types and degrees of mesoscale heterogeneity and does the residual trapping relationship remain unchanged across scales the rest of this study is organized as such first the mp simulation model model inputs and input data will be presented then the mp simulation results will be discussed two kinds of simulation cases are presented that 1 predict residual trapping abilities on different types of permeability fields and 2 demonstrate how the mp simulator can be applied to a field scale domain 2 the mp simulation model the mp simulation model is a reduced physics simulator that rapidly estimates the distribution of co2 water saturations under strongly capillary dominated flow regimes by applying two phase flow and trapping rules the mp simulator can estimate co2 residual trapping during post injection imbibition the core idea of the mp simulation model is to reduce computation complexity by simulating quasi static equilibrium states ioannidis et al 1996 it involves increasing or decreasing an externally imposed capillary pressure on the domain in discrete steps in order to simulate nonwetting phase saturation during drainage and wetting phase imbibition after drainage at each such capillary pressure step the saturation field can be computed from the set of input capillary pressure curves for each voxel at the voxel level the only necessary input into the mp simulator is the drainage and imbibition capillary pressure curves that govern the voxel saturation at a specified capillary pressure while it is relatively straightforward to simulate the drainage process one major challenge in building the mp simulation model is to equip it with the ability to accurately capture both pore scale and mesoscale residual trapping during the imbibition process in conventional reservoir simulation pore scale residual trapping is modeled by adding hysteresis to the voxel level imbibition capillary pressure curves in conventional mp simulation mesoscale residual trapping or capillary heterogeneity trapping is modeled by adding macroscopic trapping rules during imbibition however to simulate residual trapping for both scales at the same time is not as simple as directly combining voxel level hysteresis with macroscopic trapping rules previously nooruddin and blunt 2018 applied the aforementioned simple combination method and reported that essentially no post imbibition nonwetting phase capillary heterogeneity trapping is present in their mp simulations for water wet rocks this is because the authors followed the conventional approach by allowing the voxel level capillary pressure to reduce to 0 at the residual saturation during imbibition simulation however when this is the case it has been confirmed that no extra capillary heterogeneity trapping can be achieved in either mp simulations or full physics simulations with enough pore volumes injected pvi bech and frykman 2018 ioannidis et al 1996 jackson and krevor 2019 kueper and mcwhorter 1992 these simulation results run contrary to the fact that a significant amount of post imbibition capillary heterogeneity trapping has been observed in water wet sandstone coreflooding experiments krevor et al 2011 therefore key modifications to both the voxel level hysteresis model and the macroscopic trapping rules are needed to better match reality these modifications include setting the imbibition snap off pressure ps to be nonzero jackson et al 2020 jackson and krevor 2019 and applying an additional domain level macroscopic trapping rule when the ps value is reached during the mp imbibition simulation we assume that this nonzero continuum scale snap off capillary pressure ps occurs at the residual saturation caused purely by pore scale residual trapping mechanisms and that this is the capillary pressure below which the nonwetting phase is no longer continuous during imbibition with these assumptions in place the voxel level hysteretic capillary pressure model should then terminate at its ps value during imbibition and does not further decrease for the mp imbibition simulation process this means it is necessary to implement a macroscopic trapping rule that freezes the domain saturation during imbibition when the externally imposed capillary pressure drops below this specified ps value to ensure that the nonwetting phase is no longer flowing while some studies have adopted lower ps values jackson et al 2020 jackson and krevor 2019 in this study we set the ps value equal to the voxel level capillary entry pressure pe value for simplicity although determining the exact value for ps is outside the scope of the current study ps does directly affect the mp residual trapping simulation results therefore a sensitivity analysis has been conducted on the value of ps and is provided in appendix a because the mp simulator is a reduced physics simulator several assumptions are employed in the current study the flow rate is assumed to be infinitesimal such that viscous forces are negligible it is also assumed that capillary pressure equilibrium is instantly reached at every pressure step each voxel in the domain is assumed to be at the continuum scale so that they would have well defined voxel level petrophysical and multiphase flow properties i e porosity permeability and capillary pressure curves the mp simulations in this study are run on 3d domains for boundary conditions both the inlet and the outlet slices are constant pressure boundaries all the other boundaries are no flow boundaries drainage simulations start at 100 water saturation everywhere in the domain and imbibition simulations start with the post drainage saturation field in other words first a primary drainage and then a secondary imbibition are simulated to demonstrate that the mp simulator is a suitable tool for simulating realistic co2 storage projects at the field scale a scaling group analysis has been conducted field scale co2 storage has a viscosity ratio μ w μ nw of 10 1 where μ w and μ nw are viscosity for the wetting and the nonwetting phase the field scale microscopic bond number δρgd 2 σ is 10 3 where δρ is the density difference between the two phases g is the gravity acceleration constant d is the mean pore diameter and σ is the interfacial tension cinar et al 2007 kimbrel et al 2015 morrow et al 1988 during co2 injection when we are away from the well and during the post injection fluid redistribution stage the field scale range of the capillary number vμ σ computed is 10 12 to 10 8 where v is the darcy velocity and μ is the viscosity of the invading fluid larkin 2010 lefebvre du prey 1973 morrow et al 1988 finally the gravity number δρgk vμ value range at the field scale is 100 to 103 where k is average permeability engelberts and klinkenberg 1951 larkin 2010 mp simulations have the same viscosity ratio and microscopic bond number values as the previous field scale values because the flow rate is taken to be zero in mp simulations the capillary number of any mp simulation is 0 and the gravity number is infinite which are also consistent with the strongly capillary and gravity dominated flow regime at the field scale the calculation details can be found in the supplementary material the rest of this section describes the details of the mp simulation formulation and the inputs into the simulator here an algorithm based mp simulator formulation is presented for a matrix representation of the mp simulator see nooruddin and blunt 2018 2 1 voxel level inputs voxel level properties need to be specified as inputs into the mp simulator strictly speaking the mp simulator only requires capillary pressure curves to be defined at the voxel level the input voxel level capillary pressure curves can be brooks corey van genuchten or any user defined models in this study we use a brooks corey model for capillary pressure curves so that a nonzero capillary entry pressure exists the leverett j function scaling relationship has been shown to provide accurate modeling of core scale experiments it is a convenient way to assign different capillary pressure curves to voxels and has been widely used as a way to model capillary heterogeneity huang et al 1995 krause et al 2013 2011 kuo and benson 2015 saadatpoor et al 2010 zeybek et al 1995 a single j function can be scaled according to the voxels porosity and permeability values to generate voxel level capillary pressure curves for voxels belonging to a single rock formation akin et al 2000 leverett 1941 li and benson 2015 the equations used to represent the drainage voxel level capillary pressure curves are shown in eqs 1 to 4 brooks and corey 1964 pini and benson 2017 1 p c j d α p e j 2 j s w 1 λ 3 s w s w s w i 1 s w i 4 α k a v g ϕ j ϕ a v g k j where p c j d is the drainage capillary pressure of each voxel j j is the j function s w is the effective wetting phase water saturation and α is the scaling factor that converts the average capillary pressure curve to the voxel level curves in eq 1 pe is the domain capillary entry pressure of the brooks corey model in eq 2 λ is the pore size distribution index in eq 3 sw is the water saturation and swi is the irreducible water saturation in eq 4 φ avg and kavg are the average porosity and permeability values while φ j and kj are the voxel level porosity and permeability values note that for field scale simulations different φ avg and kavg values should be specified for every rock type after the leverett j function scaling relationship is applied when the voxels are at capillary equilibrium the saturation of the voxels would all be different with respect mainly to their permeability values as illustrated in fig 1 the case for the imbibition capillary pressure curves is more complex because hysteresis is present we can choose to simply use the nonhysteretic drainage capillary pressure curves during imbibition however this is not realistic when comparing to experimental results in order to account for hysteresis caused by pore scale trapping mechanisms we use a trapping model like the land or the linear trapping relationship in this study the linear trapping relationship is used unless otherwise specified the equations used to represent the imbibition hysteretic voxel level capillary pressure curves are shown in eqs 5 to 9 jackson et al 2020 pini and benson 2017 5 p c j i α p c i 1 s n w m 1 λ 1 p s 6 p c i p e p s s w i 1 λ 1 s w i 1 λ 1 7 s n w m s n w s n w r 1 a p 8 s n w r a p s n w i 9 s n w s n w 1 s w i where p c j i is the imbibition hysteretic capillary pressure of each voxel j s n w m is the effective mobile nonwetting phase co2 saturation and s n w is the effective nonwetting phase saturation in eq 5 α is the same scaling factor as in the drainage case and ps is the imbibition snap off capillary pressure in eq 6 s w i 1 s n w i where s n w i is the effective initial co2 saturation prior to imbibition a k a the turning point saturation in eq 7 s n w m is computed using a linear trapping relationship which is defined in eq 8 where ap is the pore scale linear trapping coefficient and s n w r is the effective residual nonwetting phase saturation finally eq 9 shows how the effective nonwetting phase saturation is computed instead of using the linear trapping relationship to calculate s n w m it is also possible to use the land trapping relationship as shown in eqs 10 to 12 where cp is the pore scale land trapping coefficient jackson et al 2020 land 1968 pini and benson 2017 the illustration for the voxel level capillary pressure curves is shown in fig 2 fig 2 also shows the differences between the capillary pressure models computed with the two different trapping models the selection of the voxel level residual trapping model determines the amount of pore scale residual trapping there exists in the voxel at different capillary pressure values and will therefore affect the final domain residual trapping amount simulated 10 s n w m 1 2 δ δ 2 4 δ c p 11 δ s n w r s n w 12 s n w r s n w i 1 c p s n w i 2 2 simulation procedure there are three main steps in the mp simulation procedure as illustrated in the workflow chart in fig 3 1 assign simulation input values 2 conduct the drainage process and 3 conduct the imbibition process previously section 2 1 has introduced the voxel level inputs required and how pore scale residual trapping is accounted for by incorporating hysteresis into the voxel level input model the current section will focus on the two phase flow rules implemented to carry out the drainage and imbibition processes as well as the macroscopic trapping rules used to account for capillary heterogeneity trapping for a detailed description of the mp simulation code see supplementary material 2 2 1 drainage a nonzero pressure is imposed on the nonwetting phase to initiate the drainage displacement process because there is essentially no viscous pressure gradient the externally imposed non wetting phase pressure is directly equal to the capillary pressure between the two fluids and because all voxels are at capillary equilibrium the whole grid therefore has the same capillary pressure everywhere that is equal to the externally imposed nonwetting phase pressure ioannidis et al 1996 for these simulations the externally imposed nonwetting phase pressure is increased from 0 to a maximum value in small pressure increments of 100 pa to model the drainage process in which co2 invades the fully water saturated grid during drainage for strongly water wet porous media under capillary dominated flow regimes the nonwetting phase cannot enter the domain unless the capillary entry pressure is overcome therefore invasion percolation algorithm is used to simulate the drainage process this results in a distinct co2 invasion front as shown in fig 4 ioannidis et al 1996 kueper and mcwhorter 1992 wilkinson and willemsen 1983 as shown in the workflow chart in fig 3 at each pressure step the simulator examines which voxels on the co2 invasion front have capillary entry pressures lower than the currently imposed pressure and will invade those voxels if that is the case then the co2 saturation values of the invaded voxels are computed using the capillary pressure functions defined for each voxel kueper and mcwhorter 1992 therefore the front can only advance through the domain if the capillary pressure is greater than the entry pressure of the voxels downstream of the invasion front 2 2 2 imbibition after the drainage process is complete the imposed pressure is then reduced in the same number of pressure steps from the maximum drainage capillary pressure back to 0 to model the imbibition process in which water displaces co2 the imbibition process is terminated when the co2 saturation field reaches a constant value because the remaining co2 is trapped we assume that water can flow throughout the entire domain in grain coating films for strongly water wet porous media therefore an ordinary percolation algorithm is suitable to model imbibition at the continuum scale because it allows water to get access to the whole domain at any capillary pressure as a consequence no water imbibition front is observable as demonstrated in fig 5 ioannidis et al 1996 when no capillary heterogeneity trapping is accounted for the saturation of each voxel is simply calculated according to the individually defined voxel level imbibition hysteretic capillary pressure functions at each pressure step 2 2 3 implementation of capillary heterogeneity trapping during mp drainage simulation because it is assumed that water dominantly flows in films no water capillary heterogeneity trapping by co2 invasion is imposed the justification for this simulation choice is that water flowing in films means that the wetting phase is always continuous in the domain so co2 should not be able to disconnect any portion of water from the continuous water phase at any capillary pressure therefore given a high enough capillary pressure co2 is capable of invading all voxels to the irreducible water saturation as shown in fig 6 left during mp imbibition simulation while co2 pore scale trapping is captured by hysteresis in the voxel level capillary pressure curves in order to capture co2 capillary heterogeneity trapping caused by mesoscale heterogeneity two macroscopic trapping rules are implemented the first imbibition macroscopic trapping rule states that when a group of voxels is completely surrounded by neighboring voxels at their voxel level residual saturation then this group of voxels is determined to be macroscopically trapped by the capillary heterogeneity trapping mechanism the co2 saturation value of the macroscopically trapped voxels can no longer change with decreasing capillary pressure as shown in fig 6 right ioannidis et al 1996 kueper and mcwhorter 1992 yortsos et al 1993 with this trapping rule co2 tends to be trapped in higher permeability regions which have lower capillary entry pressure and are surrounded by lower permeability regions which require higher capillary entry pressure to enter with only the first macroscopic trapping rule applied the match in voxel level co2 saturation between mp and full physics simulation results is good for a low degree of heterogeneity but at a high degree of heterogeneity mp simulation consistently underestimates the trapped co2 saturation therefore a second macroscopic trapping rule needs to be applied this second rule states that all voxels are macroscopically trapped when the domain capillary pressure value drops below the imbibition snap off capillary pressure this is because at or below this snap off capillary pressure value co2 is no longer a continuous phase and should not be able to flow as shown in the workflow chart in fig 3 with both macroscopic trapping rules applied now for imbibition it is necessary to first check whether the current capillary pressure is high enough and whether the voxels are macroscopically trapped before proceeding after the imbibition process is finished simulation of a single primary drainage and secondary imbibition cycle is now complete the domain effective co2 saturation can then be calculated at each pressure step and the domain effective capillary pressure curves for both drainage and imbibition can be obtained by convention capillary pressure graphs show the difference in pressure between the two continuous immiscible phases plotted against water saturation because this is the only capillary pressure that is measurable in darcy scale lab experiments in the mp simulation case this would be equivalent to plotting the externally imposed pressure against the water saturation ioannidis et al 1996 yortsos et al 1993 however it is worth noting that the externally imposed pressure capillary pressure of the continuous phases is not simply equal to the average capillary pressure of the grid simple arithmetic average of voxel level capillary pressure values at each effective water saturation this is especially the case before co2 percolation during drainage and when there is co2 capillary heterogeneity trapping during imbibition 2 2 4 implementation of gravity in the mp simulator the mp simulator is capable of incorporating gravity forces by imposing capillary gravity equilibrium when the domain size is small gravity effects are much smaller than capillary effects and can be ignored however for large domain sizes such as the field scale it is important to consider gravity forces when gravity forces are ignored the mp simulator does not require specifying the exact size of the voxel however when gravity forces are considered the voxel size in the vertical z direction does need to be supplied for the mp simulator to calculate the difference in hydrostatic head between voxel pairs when gravity forces are not added the imposed capillary pressure p c imposed of the whole domain is 13 p c i m p o s e d p c o 2 p w where p c o 2 and pw are the pressure in the co2 and the water phase respectively when gravity forces are included in the model there exists a hydrostatic pressure gradient in both the co2 and the water phase as shown in fig 7 a the capillary pressure of the domain can then be computed as follows ioannidis et al 1996 14 p c d z 0 p c o 2 d z 0 p w d z 0 p c i m p o s e d 15 p c d z p c o 2 d z p w d z p c i m p o s e d δ ρ g d z gravity forces are calculated as δρgdz where δρ is the density difference between the two fluids water and co2 g is the gravitational acceleration and dz is the relative depth defined as 0 at the top of the domain and increases to the maximum value at the bottom of the domain as shown in fig 7a from eqs 14 and 15 it is apparent that when gravity forces are present the effective capillary pressure value decreases with the depth dz in the domain with gravity forces added now a voxel can only be invaded during drainage when the currently imposed domain capillary pressure is greater than the capillary entry pressure of the current voxel and the gravity forces combined as shown in eq 16 16 p c d z p e v o x e l or equivalently p c i m p o s e d p e v o x e l δ ρ g d z fig 7b and c show the capillary pressure values needed to invade each voxel in a realistic reservoir slice domain with and without gravity forces added details of this domain will be presented later in section 2 3 3 for an invading fluid co2 that is lighter than the defending fluid water gravity forces hinder downward fluid invasion ioannidis et al 1996 this can be clearly seen by comparing the two graphs as much higher pressure is needed in order to invade deeper voxels 2 3 simulation input data this section provides the values used for the voxel level inputs and explains the two sets of simulation cases run with the mp simulator the first set of mp simulation cases is run to obtain the domain specific co2 residual trapping abilities for different types and degrees of mesoscale heterogeneity the second set is run on a realistic vertical reservoir slice to demonstrate how the mp simulator can be applied at the field scale in order to ensure that saturation is sufficiently uniform within a voxel to be represented by a single value both viscous and gravity forces need to be small relative to capillary forces within the voxel therefore the voxel size cannot be arbitrary and needs to be small enough to ensure that the mp simulation assumptions are valid while viscous forces mainly act on co2 in the horizontal direction in a vertical well injection scenario gravity forces only act on co2 in the vertical direction therefore we would expect the magnitude of the viscous forces to limit the size of the voxel in the horizontal direction and the magnitude of the gravity forces to limit the size of the voxel in the vertical direction the voxel size selected for the core scale analysis is 2 mm which is well below the voxel size limit at which viscous forces kpe μv 0 3 m and gravity forces pe δρg 0 7 m surpass capillary forces ioannidis et al 1996 the voxel size selected for the field scale analysis is 1 m in the horizontal direction and 5 cm in the vertical direction while the vertical voxel size is well within the limit of 1 3 m the horizontal voxel size limit varies between 0 8 m and 1400 m largely depending on the flow rate v chosen even so the horizontal voxel size is approximately at the strictest limit of 0 8 m with this field scale voxel size the macroscopic bond number δρgl p e d is 10 2 where l is the voxel height and p e d is the domain effective entry breakthrough capillary pressure ioannidis et al 1996 see supplementary material for calculation details 2 3 1 voxel level input data in order to use the leverett j function scaling relationship to assign voxel level capillary pressure curves as inputs into the mp simulator voxel level porosity and permeability values need to be specified for this study a constant porosity value is assigned to all the voxels for simplicity as is done in li and benson 2015 table 1 shows the voxel level input parameter values used the values for the various input parameters are based on the average berea sandstone experimental data published by krevor et al 2012 and ni et al 2019 one exception is the pore scale linear trapping coefficient ap in order to obtain a sandstone rock s residual trapping characteristics coreflooding experiments need to be conducted upon the results of which empirical trapping relationships such as the linear or the land models are fitted due to the fact that the medical ct scanners do not provide micron level resolution it is not possible to directly differentiate between pore scale and mesoscale residual trapping mechanisms consequently the experimental residual trapping models capture all residual trapping regardless of the underlying trapping mechanisms the mp simulation addresses this challenge by explicitly simulating the two residual trapping mechanisms separately because the macroscopic trapping rules separately account for capillary heterogeneity trapping the trapping model for voxel level hysteresis should strictly capture only pore scale residual trapping ap is the coefficient in the linear trapping model defined in eq 8 and ni et al 2019 have used an extrapolation method to infer the ap value on a set of diverse coreflooding data therefore the resulting value of ap 0 46 is used as the input in the mp simulation model for voxel level hysteresis just like the ps parameter this input ap value significantly affects the mp residual trapping simulation results therefore a sensitivity study on the value of this input parameter can be found in appendix a 2 3 2 trapping ability simulation input data we can employ the mp simulator to quickly obtain post imbibition co2 residual trapping ability for different types of domains by turning on capillary heterogeneity trapping all simulation cases in this section have 3d cubic domains the size of 10 10 10 voxels with artificially generated permeability fields the voxel size used is 2 mm 2 mm 2 mm which is greater than the representative elementary volume scale jackson et al 2020 pini and madonna 2016 because the domain size is small gravity forces do not have a significant influence and are turned off for this set of simulation cases the inlet face is to the left and the outlet face is to the right the permeability fields used can be completely random or homogeneous except for a downstream low permeability barrier as shown in fig 8 the random permeability fields are uncorrelated with a lognormal distribution for the random permeability fields the permeability value for each voxel is randomly generated from a normal distribution with a specified mean and standard deviation an increasing standard deviation represents an increasing spread of the permeability values and this in turn represents an increasing degree of mesoscale heterogeneity after a normal distribution is obtained the values are exponentiated in order to get lognormally distributed permeability values for the permeability fields with barriers there are three types of barriers that are investigated the perfect barrier type has a single layer of voxels with homogeneous low permeability values the leaky barrier type has a hole the size of a single voxel in the upper corner of its barrier and is otherwise identical to the perfect barrier finally the multilayer barrier type has two layers of barrier voxels with lognormally distributed uncorrelated random low permeability values with a standard deviation std ln k of 0 5 for random domains we want to investigate how increasing the degree of heterogeneity affects the domain effective linear trapping coefficient ad so ten random domains with different values of std ln k ranging from 0 to 5 are used where 5 represents an extremely high degree of mesoscale heterogeneity for barrier domains we want to investigate how increasing the permeability contrast between the upstream domain and the downstream capillary barrier affects ad so eleven barrier domains with different values of the downstream low permeability barrier are used a fifth type of domain with an extremely high degree of heterogeneity is also examined for the extreme cases we position 5 layers of homogeneous barrier downstream the permeability values of the extreme case barriers are quite low note that the input mean or upstream domain permeability into the simulation is always at 300 md for every case previously in literature it has been assumed that the capillary dominated residual trapping relationship for a certain rock type does not change across scales and it is considered an intrinsic property of the porous medium itself al menhali and krevor 2016 krevor et al 2015 niu et al 2015 pini and krevor 2019 in order to examine whether the initial residual saturation ir curves are truly scale invariant for every case in this section we run twenty mp simulations with different maximum drainage capillary pressure values then the linear and land trapping coefficients computed from the domain averaged initial and residual co2 saturation values are plotted on a single ir plot we can then compare this domain level trapping relationship with the voxel level trapping relationship all model parameter values covered in this section are shown in detail in table 2 2 3 3 field scale simulation input data the mp simulator is applied to a realistic vertical reservoir slice domain to predict both post drainage and post imbibition co2 saturation the reservoir slice is extracted from parasequence 1 of the paaratte formation at the otway site in australia in between well crc2 and crc3 mishra et al 2020 2019 the paaratte sandstone formation is a saline aquifer pevzner et al 2013 at a depth of 1500 m the temperature is 60 c and the pressure is 15 mpa the dimension of the model is 40 m vertically and 760 m horizontally the voxel size is 1 m 1 m 5 cm with 5 cm as the resolution in the vertical direction realistic porosity permeability rock type and facies values have been assigned to the voxels in the model to best represent the true properties of the geological formation mishra et al 2020 2019 the depositional facies and rock type maps generated are constrained by log data of the two wells present near the two ends of the domain therefore the layer thicknesses in the vertical direction are set ranging from a few centimeters to 5 8 m for different facies different variograms have been derived for different facies and these facies therefore each has a different correlation length in the horizontal direction ranging from 200 300 m to over a kilometer porosity and permeability values are correlated and are both associated with the facies and rock types assigned for more details about how the field scale model is generated see mishra et al 2020 2019 and dance et al 2019 for the current study we use a modified version of the aforementioned vertical reservoir slice domain by applying the following simplifications we choose to ignore the dip angle of 4 in the formation and select only the top 10 m of the domain which includes roughly 150 000 voxels the porosity and horizontal permeability maps for the simulation domain are shown in fig 9 the domain has an average porosity of 0 21 and a geometric permeability average of 37 md it can be clearly seen that this is a highly heterogeneous domain with an std ln k value of 2 8 the resulting pressure required to invade the voxels in this domain with or without gravity present is shown in fig 7b and c the capillary pressure curve for each voxel is calculated using the leverett j function scaling relationship in eqs 1 4 with the properties for kavg λ and pe provided in table 1 anisotropy in the permeability field is disregarded and only the horizontal permeability values are used finally the density of water and co2 are uniform throughout the domain based on a temperature of 60 c and a pressure of 15 mpa ρ w 989 60 kg m3 and ρ c o 2 604 09 kg m3 lemmon et al 2018 gravity forces are included for this field scale simulation case with gravity the externally imposed capillary pressure value is the greatest at the top layer of the model and reduces with increasing depth for co2 drainage and water imbibition a maximum capillary pressure value of 35 kpa during drainage is selected this value is selected such that the domain reaches post drainage co2 saturation values observed from full physics simulations of co2 injection at flow rates typical for field scale projects for mp simulation boundary conditions the inlet is the left edge and the outlet is the right edge because viscous forces are the strongest at the injection well and reduce rapidly away from the well dance et al 2019 hovorka et al 2006 meckel and bryant 2014 the mp simulator is best applied to domains some distance away from the injection well where flow rates are low enough that capillary and gravity forces dominate celia et al 2015 meckel et al 2015 table 3 summarizes all the model parameter values for this field scale domain 3 mp simulation results and discussion there are two major parts to the results the first part of this section shows and discusses the co2 residual trapping ability simulation results for the four different types of synthetic cube domains the second part of this section applies the mp simulator to a realistic fine grid vertical reservoir slice domain 3 1 trapping ability simulation results before we report the trapping abilities for the different types of permeability fields we first turn our attention to the difference between the voxel level and the domain level residual trapping relationships as shown in fig 10 fig 10 displays the voxel level and domain level ir plots with different voxel level trapping models for the same domain that has uncorrelated random permeability values here the voxel level ir plot is obtained by simulating a single primary drainage imbibition cycle and plotting the voxel level ir values whereas the domain level ir plot is obtained by simulating repeated primary drainage imbibition cycles and plotting the domain effective ir values from the voxel level ir plots in the case when ps is nonzero it can be seen that voxels with low initial co2 saturation 0 4 follow the input voxel level trapping relationships ps 0 and voxels with high initial co2 saturation 0 4 display capillary heterogeneity trapping behaviors that diverge from the input voxel level trapping relationships the permeability of the voxels at which this apparent bend occurs is approximately at the domain median permeability value similar voxel level ir results can also be found in full physics coreflooding simulations conducted by jackson and krevor 2019 the reason for this kind of trapping behavior is as follows low permeability voxels according to the leverett j scaling relationship will have voxel level capillary pressure curves with high capillary entry pressure this means that in the post drainage co2 saturation field at capillary equilibrium these low permeability voxels will have low initial co2 saturation then during the mp imbibition simulation process as the domain capillary pressure decreases these low permeability voxels will reach their pore scale residual trapping amount first and get frozen as the imbibition capillary pressure keeps dropping only after the domain already contains frozen voxels can other higher permeability voxels have a chance of been macroscopically trapped as a consequence capillary heterogeneity trapping behavior occurs only in higher permeability voxels which have low capillary entry pressures and high drainage co2 saturations from the domain level ir plots it can be seen that with the linear trapping model as the voxel level input the macroscopic trapping rules cause the domain level ir curve to deviate from the linear trapping model and follow a double linear model a linear trapping relationship similar to the double linear model shown here has been reported on a water wet limestone using the porous plate experimental method tanino and blunt 2013 this double linear trapping model is a direct consequence of the first macroscopic trapping rule implemented the effect of this trapping rule is such that if imbibition proceeds before co2 drainage has percolated the domain reached the outlet then any co2 present in the domain will be 100 trapped at the end of imbibition such trapping behavior is realistic and has been observed in sand tank experiments trevisan et al 2017b only after co2 drainage has percolated the domain can the effect of the pore scale residual trapping model be seen at the domain level after imbibition fig 10 clearly shows that regardless of the type of voxel level trapping model implemented there are significant differences between the input voxel level trapping model and the larger scale domain effective trapping relationship this mp simulation result shows that residual trapping relationships are not scale invariant when capillary heterogeneity trapping is present in order to investigate how residual trapping abilities vary with different types and degrees of mesoscale heterogeneity mp simulations are run on four types of permeability fields with varying degrees of heterogeneity or matrix barrier permeability contrast in order to measure the linear trapping coefficient for any domain more accurately the fitted least square linear regression values are reported in this section however note that with this fitting the linear residual trapping ability will be underestimated when the initial saturation is low and overestimated when the initial saturation is high fig 11 shows all simulation results with two different voxel level input residual trapping models the linear trapping model in a and the land trapping model in b from fig 11a we can see that other than the leaky barrier case the domain effective linear trapping coefficient ad increases with the degree of mesoscale heterogeneity represented by the maximum standard deviation in the drainage co2 saturation fields s t d m a x s c o 2 this simulation result is consistent with the experimental results shown in black dots this result is also consistent with simulation results in the literature that under capillary dominated flow regimes more oil capillary heterogeneity trapping can be achieved in water wet rocks with increasing permeability contrasts for cross lamination flow corbett et al 1992 however unlike previously assumed the relationship between ad and s t d m a x s c o 2 appears to be nonlinear and dependent on the structure of the heterogeneity field for the multilayer barrier case no extra capillary heterogeneity trapping can be achieved at low degrees of heterogeneity yet as the degree of heterogeneity increases the multilayer barrier domain has a similar shape with the perfect barrier case and it is also the case that best fits the experimental data for the leaky barrier case it is clear that when the capillary barrier is leaky no capillary heterogeneity trapping can be achieved even at a high degree of heterogeneity as shown in fig 11b similar trends in the residual trapping results can be obtained when the voxel level input trapping model changes from the linear to the land model the simulation results from these four different types of domains have demonstrated that although these domains can have the same degree of mesoscale heterogeneity by this simple standard deviation measure the actual residual trapping ability value is highly heterogeneity dependent good capillary barriers can achieve a much higher residual trapping ability at a lower degree of heterogeneity than an uncorrelated random domain a good fit of the multilayer barrier case to the majority of the experimental data also suggests that some sandstone rock samples used here may in fact be mostly homogeneous with just a few capillary barriers to be able to achieve a high amount of capillary heterogeneity trapping numerical values of the data used in fig 11 can be found in supplementary material however we notice that there is one experimental data point shown in fig 11 with an extremely high degree of heterogeneity that cannot be simulated by the aforementioned four types of domains for the random domains std ln k 5 already represents an extremely high degree of heterogeneity and further increases in std ln k are possible but not realistic for the barrier domains reducing the barrier permeability below 0 01 md no longer increases the degree of heterogeneity value measured by the parameter s t d m a x s c o 2 in an effort to simulate the data point with an extremely high degree of heterogeneity the fifth type of extreme barrier cases is run the results are close to the data point albeit still being slightly less heterogeneous by the s t d m a x s c o 2 measure sensitivity analysis run with different values of the ps and the ap parameter show that although the resulting ad values do vary the general trends as shown in fig 11 remain the same it is worth noting that even as we vary the two input parameters the two domains with the nonleaky downstream barriers remain the most consistent with the experimental data points this result indicates that real sandstone rocks behave more closely to the two nonleaky barrier domains than the random or the leaky barrier domains for the sensitivity analysis results see supplementary material 3 2 field scale simulation results the results of the vertical slice mp simulation are shown in figs 12 and 13 fig 12 shows the co2 saturation results of several pressure steps taken during drainage and imbibition fig 12 also shows the end states for both drainage and imbibition with and without capillary heterogeneity trapping fig 13 shows the corresponding voxel level capillary pressure curves for the two different imbibition end states shown in fig 12 from fig 12 it can be seen that during drainage there exists a distinct invasion front extending from the inlet on the left to the outlet on the right as the domain capillary pressure increases similarly heterogeneous plume saturation caused by capillary heterogeneity have been observed in modeling studies by jackson and krevor 2020 after the co2 plume percolates through the domain co2 continues to invade more voxels as domain capillary pressure further increases and backfills towards the lower parts of the domain in the presence of gravity the backfilling would be more obvious if the maximum capillary pressure value reached during drainage is set higher we can also see that no distinct imbibition front is present as the domain capillary pressure drops during imbibition the co2 plume in the domain becomes fully immobilized when the externally imposed capillary pressure reduces to 24 kpa when capillary heterogeneity trapping is included as shown in fig 12e with capillary heterogeneity trapping excluded the plume continues to migrate until the externally imposed capillary pressure reduces to the imbibition snap off value of 5 kpa as shown in fig 12f when the end state is reached after drainage in fig 12d we can see that the post drainage co2 saturation at some regions can be as high as 0 8 although the majority of invaded voxels have co2 saturation values lower than 0 6 high co2 saturation values 0 6 0 8 in thin layers of plume have been observed away from the injection well in field scale co2 storage projects such as the frio project observation well 30 m away hovorka et al 2006 krevor et al 2015 and the sleipner project observation 100 500 m away chadwick et al 2005 whereas for the otway observation well 170 m away dance et al 2019 and the nagaoka project observation wells 40 m and 60 m away mito and xue 2011 sato et al 2011 lower co2 saturation values 0 6 away from the injection well have been reported permeability and the degree of heterogeneity may have affected plume migration at different sites both the frio 2 4 d hovorka et al 2006 and the sleipner 1 d eiken et al 2011 sites have high permeability values whereas the otway site has a large range of permeability values anywhere from 0 001 md to 10 d dance et al 2019 and the nagaoka site has rather low permeability values 0 5 12 md sato et al 2011 because the permeability of the vertical slice domain we are working with in this study is relatively low we would likely expect the post drainage co2 saturation to be low as well when measured away from the injection well after imbibition the co2 saturation map with capillary heterogeneity trapping is shown in fig 12e 79 of the initial co2 is trapped as residual co2 saturation comparing to 46 with pore scale trapping only consequently capillary heterogeneity trapping contributes 42 to the total co2 volume that is residually trapped by comparing the residual trapping results and capillary pressure curves with and without capillary heterogeneity trapping in figs 12 and 13 it is clear that with macroscopic trapping rules applied many voxels with high initial co2 saturation values now have high amounts of capillary heterogeneity trapping which would have escaped otherwise 4 conclusions an mp simulator has been developed to simulate co2 water post drainage and post imbibition co2 saturation distribution with capillary heterogeneity trapping under capillary and gravity dominated flow regimes the mp simulator has been validated by a full physics simulator mrst and can achieve a speedup of 10 to 100 times an example of how the mp simulator can be applied to a field scale vertical reservoir slice has also been shown from the mp simulation results the following conclusions can be drawn there are significant differences observed between the voxel level and the domain level ir trapping relationships for heterogeneous rocks suggesting that approaches such as the one described here need to be taken in order to correctly compute the effective trapping characteristics of a heterogeneous domain for uncorrelated random domains and for cases with downstream capillary barrier layers that are nonleaky post imbibition capillary heterogeneity trapping always increases with the degree of mesoscale heterogeneity which is consistent with previous experimental results although the relationship between ad and s t d m a x s c o 2 is not linear as previously shown even when the degrees of mesoscale heterogeneity are the same the spatial distribution of heterogeneity significantly affects the amount of capillary heterogeneity trapping achieved domains with nonleaky capillary barriers trap more than domains that are uncorrelated and random which in turn trap more than domains with leaky barriers the heterogeneity case with residual trapping abilities that best fit the experimental data suggests that domains with few capillary barriers and are otherwise homogenous can still achieve a significant amount of capillary heterogeneity trapping overall the simulation results presented in this study highlight the benefits of having a higher degree of heterogeneity and good capillary barriers at the mesoscale for increasing post imbibition capillary heterogeneity trapping credit authorship contribution statement hailun ni methodology software visualization validation writing original draft olav møyner software writing review editing kuncho d kurtev resources sally m benson conceptualization supervision funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this work was supported by stanford university s global climate energy project and the geocquest project funded by bhp the geocquest project is a collaboration between the university of melbourne cambridge university and stanford university the authors thank the co2crc ltd for providing the geological data from the otway international test centre supporting this study the authors have no known financial conflicts of interests all mp and mrst simulation codes can be found online at http dx doi org 10 17632 6gj3rd7ntr 2 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103990 appendix c supplementary materials image application 1 image application 2 appendix a sensitivity of the residual trapping simulation results both the pore scale trapping ability ap and the imbibition snap off capillary pressure ps have a large effect on the residual trapping amount simulated in the mp simulation ap solely determines the amount of residual trapping that is caused by the pore scale snap off bypass trapping mechanism at the voxel level and ps largely determines the amount of residual trapping that is caused by the mesoscale capillary heterogeneity trapping mechanism at the domain level in order to explore the effect of ap and ps on residual trapping simulation results a sensitivity analysis is provided here the residual trapping results for the four synthetic cube domains are shown in fig a1 sensitivity of the residual trapping simulation results to the tessellation pattern and the grid size is also discussed fig a1a shows that other than the leaky barrier case all the other cases have their domain trapping ability ad increase linearly with the ps value the rate of increase differs depending on the type of heterogeneity of the domain we can see that having a nonzero ps value is essential for capturing any capillary heterogeneity trapping because the leaky barrier case does not have a completely sealing capillary barrier it has no extra amount of capillary heterogeneity trapping regardless of the value of ps and regardless of the degree of heterogeneity of the domain as we have previously discussed physically ps determines the voxel level capillary pressure at which the pore scale residual trapping amount is reached the higher the ps value the sooner this particular voxel will reach its pore scale residual trapping amount and get frozen during the imbibition mp simulation with more voxels frozen early on during imbibition the remaining voxels will have higher chances of been macroscopically trapped and therefore the domain is likely to have a greater amount of capillary heterogeneity trapping as a result fig a1b shows that the ad value for all types of domains increases linearly at different rates with the ap value the leaky barrier case has a unit slope again indicating that no extra capillary heterogeneity trapping can be achieved above the ap value the results of this sensitivity study have demonstrated that for any given domain with a reasonable degree of heterogeneity the ad value changes linearly with ps and ap however when a domain has an extremely high degree of heterogeneity then the previous linear relationship between the input parameters ps ap and the output ad value breaks down this is because when the barriers in the domain have extremely low permeability no matter how the value of ps and ap changes during imbibition the water phase would not have enough driving forces to push the co2 through the barrier and therefore the ad value is always 1 for sensitivity analysis results on highly heterogeneous domains see supplementary material in the presence of spatial correlations the coordination number of the percolation lattice no longer affects the percolation threshold ioannidis et al 1996 in the current study all the synthetic barrier domains and the field scale slice domains used have some kinds of spatial correlation present the only domain without any spatial correlations is the random synthetic domain case for this particular case it is true that if other types of space filling tessellation are chosen the residual trapping simulation results may be different this is because the different percolation threshold values will affect at what initial co2 saturation the co2 phase percolates the domain which determines the point at which the domain level ir plot starts deviating from the 100 trapping line the coordination number also determines how easily a voxel can be macroscopically trapped generally a smaller coordination number promotes more macroscopic trapping however the general trapping trends observed here should still remain valid regardless of the tessellation chosen that more heterogeneous domains will have more capillary heterogeneity macroscopic trapping to demonstrate the validity of the residual trapping results in fig 11 at larger domain sizes extra mp simulation cases with the domain size 100 100 100 voxels have also been run for all the four major types of synthetic cube domains for the random perfect barrier and the leaky barrier cases the larger domain simulation results are highly similar to the results from the corresponding smaller domains the differences in the domain average linear trapping coefficient ad are all within 0 01 the only exception is the multilayer barrier case because the permeability value of its barrier voxels draws from a lognormal distribution with just two layers of capillary barrier voxels and a much larger barrier size there is a much higher chance that certain voxels on the barriers have similar permeability values as the upstream matrix as a consequence the multilayer barrier acts like a leaky barrier and no extra capillary heterogeneity trapping can be achieved in the larger domain therefore for the larger domain size of the multilayer barrier case to achieve similar results as the smaller domain size either more layers of capillary barriers need to be added or the mean standard deviation of the barrier permeability values need to be reduced appendix b validation of the mp simulator in order to validate the mp simulation results we compare with the results from a full physics reservoir simulator the mrst lie 2019 the advantage of using mrst is that it is matlab based so it is easy to use and to visualize simulation results also as the source code is open it allows fully customizable capillary pressure and relative permeability inputs for both drainage and imbibition furthermore it is easy to turn gravity on or off because mrst is a full physics simulator some extra inputs are necessary to specify a flow scenario note that we use the two phase black oil simulator module treating co2 as the oil phase and water as the water phase the discretization used by the simulator is a fully implicit scheme with two point flux approximation and single point mobility upwind identical in configuration to most commercially available full physics simulators b 1 mrst validation inputs ten simulation cases are run for validation these cases have the same domain sizes as the previous trapping ability simulation cases among the ten validation cases several different parameters are varied so that all simulation cases covered in the current study are validated the validation cases include the following homogeneous domains with different imbibition snap off capillary pressure ps cases 1 and 2 uncorrelated heterogeneous domains with an increasing degree of heterogeneity cases 3 and 4 a heterogeneous domain with a different trapping model case 5 heterogeneous domains with different types of downstream capillary barrier cases 6 7 and 8 an uncorrelated heterogeneous slice domain case 9 finally a homogeneous domain with gravity forces added case 10 details of the input parameters for the ten validation cases are shown in supplementary material capillary heterogeneity trapping is included for all validation cases in the mp simulator in order to match mp simulation results to the full physics simulation results the maximum drainage capillary pressure for mp simulations is set to the median value of the resulting drainage capillary pressure field obtained from running the full physics simulation in order to minimize capillary end effects in mrst simulation five slices are added both at the inlet and the outlet the extra slices have uniform core average properties a constant flux boundary condition is applied at the inlet and a constant pressure boundary condition of 1300 psia is applied at the outlet all other boundaries are no flow boundaries co2 and water fluid properties are taken at 50 c and 1300 psia during drainage 100 co2 is injected during imbibition 100 water is injected a relatively high flow rate 5 ml min during drainage is used to establish enough capillary pressure in the domain and a very low flow rate 0 01 ml min is used during imbibition to reach capillary dominated flow regimes to ensure steady state is reached and to check for persistence of the trapped co2 saturation both drainage and imbibition simulation are run for 50 pvi for the single validation case involving gravity the voxel sizes are increased to 2 dm 2 dm 2 dm so that obvious gravity effects are present a low drainage flow rate 0 1 ml min is used for this case to ensure that the domain capillary gravity equilibrium is established and a higher imbibition flow rate 1 ml min is used to ensure full water sweep of the domain the most important additional simulation input that mrst requires but mp simulator does not is relative permeability for mrst simulations a single set of drainage relative permeability curves is used for the entire domain for the imbibition relative permeability curves we assume that no hysteresis exists in the water relative permeability curve for strongly water wet sandstones ruprecht et al 2014 hysteresis is then only present in the co2 relative permeability curve either the linear or the land trapping model can be used to determine the hysteretic co2 scanning curves the equations for the voxel level relative permeability model are shown in eqs b1 to b4 ruprecht et al 2014 b1 k r w d i s w n w b2 k r n w d 1 s w n n w d b3 k r n w i 1 s w n n w i b4 s w s w s w i 1 s w i s n w r where k r w is the wetting phase water relative permeability k r nw is the nonwetting phase co2 relative permeability superscript and subscript d represents drainage and i represents imbibition eqs b1 to b4 show the commonly used power model relative permeability for both drainage and imbibition eq b4 calculates the imbibition effective water saturation s w where the s nw r value can be obtained either from the linear trapping relationship eq 8 or the land trapping relationship eq 12 the illustration of the voxel level relative permeability curves is shown in fig b1 table b1 shows all the additional input parameter values used in the fluid model in mrst simulations note that when the flow rate is low and the flow regime is strongly capillary dominated the exact shape of the relative permeability does not significantly impact the final equilibrium saturation field as long as the endpoints are the same we have varied both the water and the co2 relative permeability coefficients from 2 to 5 during mrst imbibition simulations the resulting mrst domain average residual co2 saturation values differ by 0 01 or less when compared to the corresponding mp values one last simulation decision that deserves extra attention is the choice of whether to have hysteresis in only the capillary pressure curves only the relative permeability curves or both when hysteresis is present only in capillary pressure because co2 is always mobile according to the relative permeability curves eventually when steady state is reached during imbibition after many pvi all co2 saturation goes to 0 with no residual trapping at all when hysteresis is present only in relative permeability because co2 remains mobile until each voxel reaches the residual saturation saturation of the entire domain always goes down to exactly the voxel level residual co2 saturation amount with no extra capillary heterogeneity trapping hence the desired case that most accurately represents the actual fluid physics in reality would be to have hysteresis present in both capillary pressure and relative permeability and this is the case we run in mrst imbibition simulation to validate mp simulation results in this study b 2 mrst validation results ten different validation cases are simulated and the mp simulation results are compared with the corresponding mrst simulation results here all simulation results for the validation cases are shown in figs b2 and b3 the numerical values for the validation results can be found in supplementary material in general the mp simulation runs 10 to 100 times faster than the equivalent mrst simulation mrst needs to take small time steps when the domain degree of heterogeneity is high or when the injection flow rate is low and runs especially slowly under these circumstances as a result sometimes if the property field is extremely heterogeneous and discontinuous when combined with a low flow rate mrst s solver cannot converge no matter how much the time steps are cut from fig b2 and fig b3 it can be seen that the degree of match between the mp and the mrst simulation results is very good the mp and mrst simulated saturation maps appear highly similar except the cases where capillary gradients can be seen particularly in the mrst post drainage results such as cases 1 and 2 the mismatch in domain average co2 saturation is at 0 01 or less for all cases for both drainage and imbibition results from the scatter plots of the voxel level co2 saturation values in figs b2 and b3 we can see that cases 1 to 5 have almost perfect matches for both drainage and imbibition for cases 6 to 10 while the vast majority of the voxels do match up well the mp simulator tends to overestimate the co2 saturation at the end of drainage for a small portion of the voxels at the outlet because the mp simulator does not simulate the capillary end effects that are present in the mrst results during drainage as a consequence of the good match in the co2 saturation fields the estimated value for the domain effective linear trapping coefficient ad from mp simulation is within 0 01 of the mrst values for all validation cases from the results for cases 1 and 2 in fig b2 we can see the effect of varying the value of ps on homogeneous domains because there is no heterogeneity present in the domain the overall post imbibition co2 residual trapping amount remains the same with no extra capillary heterogeneity trapping achieved however as the degree of mesoscale heterogeneity increases when ps is nonzero a significant amount of capillary heterogeneity trapping can be obtained as can be seen by comparing the results for cases 2 3 and 4 
250,capillary heterogeneity trapping caused by mesoscale heterogeneity at the millimeter scale has been shown to have a great potential in immobilizing a significant amount of co2 in co2 geologic storage the goal of this study is to develop and apply a macroscopic percolation simulator to better understand how post imbibition co2 capillary heterogeneity trapping varies with different types and degrees of mesoscale heterogeneity as well as to quantify and compare its contribution to the pore scale snap off bypass residual trapping mechanism using invasion percolation during drainage and ordinary percolation with macroscopic trapping during imbibition the macroscopic percolation simulator can rapidly simulate both post drainage and post imbibition co2 saturation fields under capillary gravity equilibrium producing results that are validated by a full physics reservoir simulator with a speedup of 10 to 100 times the macroscopic percolation simulation results have shown that for domains that are completely uncorrelated or with nonleaky downstream capillary barriers co2 heterogeneity trapping contribution always increases with the degree of heterogeneity of the domain this is consistent with previous experimental results however the relationship between the co2 residual trapping ability of a domain also depends on the spatial structure of the heterogeneity and trapping ability does not always increase linearly with the degree of heterogeneity as previously shown additionally when the capillary barrier is leaky then regardless of the degree of heterogeneity no extra capillary heterogeneity trapping can be achieved after long term imbibition finally this study demonstrates how residual trapping relationships may not be scale invariant and calls for more sophisticated upscaling methods such as the macroscopic percolation simulation method presented here keywords macroscopic percolation reduced physics simulation co2 sequestration multiphase flow residual trapping capillary heterogeneity trapping 1 introduction co2 geologic storage is an integral part of the climate change solutions that allow the society to transition toward carbon neutral energy while still relying on fossil fuels ipcc 2014 2005 rogelj et al 2018 there are several secondary trapping mechanisms that provide extra immobilization security of the co2 plume in addition to the cap rock primary trapping mechanism residual trapping by capillary forces is one such secondary trapping mechanism that is capable of immobilizing a significant amount of co2 ipcc 2005 conventionally the pore scale snap off and bypass mechanisms are considered to be the main trapping mechanisms responsible for residual trapping krevor et al 2015 however recent studies have shown that mesoscale heterogeneity at the millimeter to centimeter scale also plays an important role in residually trapping the nonwetting phase fluid causing what is known as capillary heterogeneity trapping corbett et al 1992 huang et al 1995 jackson and krevor 2020 kortekaas 1985 krevor et al 2011 meckel et al 2015 saadatpoor et al 2010 trevisan et al 2017 a few simulation studies have previously investigated capillary heterogeneity trapping of co2 or other nonwetting phase fluid such as oil under capillary dominated flow regimes a significant portion of the literature on this topic focuses on capillary heterogeneity trapping due to buoyancy flow behzadi et al 2011 gershenzon et al 2017 meckel et al 2015 ren et al 2019 ren and duncan 2019 saadatpoor et al 2013 2010 trevisan et al 2017 and just a few examine post imbibition capillary heterogeneity trapping the topic of this study corbett et al 1992 kortekaas 1985 ren 2018 kortekaas 1985 through mathematical simulation found that when water imbibition direction is perpendicular to the lamination oil capillary heterogeneity trapping occurs when inter laminae permeability contrast is present the same conclusion is reached by corbett et al 1992 with an eclipse black oil simulator more recently ren 2018 conducted 2d reservoir scale simulations with the cmg gem simulator and reported that the amount of capillary heterogeneity trapping is intrinsic to the heterogeneity of the domain later ren et al 2019 used an analytical method to identify and quantify the capillary heterogeneity trapping amount however ren et al s method only obtains the upper bound of the capillary heterogeneity trapping capacity and does not consider any contribution from pore scale residual trapping therefore it is of interest to develop a simulation method that can enable rapid and accurate quantification of both the mesoscale capillary heterogeneity trapping amount and the pore scale residual trapping amount of any heterogeneous domain in order to measure total post imbibition residual trapping and the relative importance of the two residual trapping mechanisms however full physics reservoir simulators such as the matlab reservoir simulation toolbox mrst that is used in this study are not well suited to the task of simulating low rate injection scenarios on domains with a high degree of capillary heterogeneity full physics reservoir simulations take a long simulated time to reach capillary equilibrium as many pore volumes of fluid need to be injected into the domain they can also take a long wall clock time to run when flow rates are low because small time steps are needed to ensure convergence this itself is because large contrasts in capillary pressure characteristic curves resulting from capillary heterogeneity can lead to convergence problems particularly at very low flow rates a type of reduced physics simulator based on macroscopic percolation mp can overcome such challenges ioannidis et al 1996 kueper and mcwhorter 1992 yortsos et al 1993 this type of simulator applies the pore scale microscopic percolation displacement algorithms to macroscopic voxels with well defined continuum scale properties such as porosity permeability and saturation hence the term macroscopic the mp simulator is best applied when capillary forces dominate the flow regime and there is no significant viscous impact on flow one major advantage of an mp simulator is that it can easily handle highly discontinuous and heterogeneous domains because the highly nonlinear dynamic multiphase flow displacement processes are not modeled another advantage of an mp simulator is the significant amount of speedup in simulation time that is achievable celia et al 2015 in the co2 storage field permedia s co2 migration module is a widely used industry mp simulator cavanagh and haszeldine 2014 meckel et al 2015 trevisan et al 2017 cavanagh and haszeldine 2014 first applied permedia to history match co2 plume migration at the sleipner site meckel et al 2015 and trevisan et al 2017 have also utilized this tool to investigate how the amount of domain average post drainage co2 saturation varies with different types and degrees of heterogeneity however permedia s original purpose is to model hydrocarbon migration as a consequence permedia assigns only one of two saturation values to all invaded voxels they are the irreducible water saturation for the voxels accumulating co2 behind a capillary barrier and the breakthrough co2 saturation for the voxels on the migration path this simple formulation does not allow permedia to report the more heterogeneous saturation fields often seen in coreflooding experiments furthermore permedia can only simulate nonwetting phase drainage and not wetting phase imbibition a number of past studies have presented mp formulations for generating domain effective relative permeability and capillary pressure curves for heterogeneous domains for both drainage jackson and krevor 2020 yang et al 2013 and imbibition nooruddin and blunt 2018 wolff et al 2013 yang et al 2020 therefore the mp algorithm can be used to generate upscaled properties to be used as inputs into full physics simulators to simulate co2 plume migration in order to save computational resources and increase simulation speeds as is done by jackson and krevor 2020 yet the mp simulator can also be directly applied to field scale domains due to the simplicity of the mp algorithm and its small computational burden in this study we will present just one such field scale mp simulation example by developing a fast and reliable mp simulator the current study aims to answer the following two questions for heterogeneous domains how does residual trapping ability vary with different types and degrees of mesoscale heterogeneity and does the residual trapping relationship remain unchanged across scales the rest of this study is organized as such first the mp simulation model model inputs and input data will be presented then the mp simulation results will be discussed two kinds of simulation cases are presented that 1 predict residual trapping abilities on different types of permeability fields and 2 demonstrate how the mp simulator can be applied to a field scale domain 2 the mp simulation model the mp simulation model is a reduced physics simulator that rapidly estimates the distribution of co2 water saturations under strongly capillary dominated flow regimes by applying two phase flow and trapping rules the mp simulator can estimate co2 residual trapping during post injection imbibition the core idea of the mp simulation model is to reduce computation complexity by simulating quasi static equilibrium states ioannidis et al 1996 it involves increasing or decreasing an externally imposed capillary pressure on the domain in discrete steps in order to simulate nonwetting phase saturation during drainage and wetting phase imbibition after drainage at each such capillary pressure step the saturation field can be computed from the set of input capillary pressure curves for each voxel at the voxel level the only necessary input into the mp simulator is the drainage and imbibition capillary pressure curves that govern the voxel saturation at a specified capillary pressure while it is relatively straightforward to simulate the drainage process one major challenge in building the mp simulation model is to equip it with the ability to accurately capture both pore scale and mesoscale residual trapping during the imbibition process in conventional reservoir simulation pore scale residual trapping is modeled by adding hysteresis to the voxel level imbibition capillary pressure curves in conventional mp simulation mesoscale residual trapping or capillary heterogeneity trapping is modeled by adding macroscopic trapping rules during imbibition however to simulate residual trapping for both scales at the same time is not as simple as directly combining voxel level hysteresis with macroscopic trapping rules previously nooruddin and blunt 2018 applied the aforementioned simple combination method and reported that essentially no post imbibition nonwetting phase capillary heterogeneity trapping is present in their mp simulations for water wet rocks this is because the authors followed the conventional approach by allowing the voxel level capillary pressure to reduce to 0 at the residual saturation during imbibition simulation however when this is the case it has been confirmed that no extra capillary heterogeneity trapping can be achieved in either mp simulations or full physics simulations with enough pore volumes injected pvi bech and frykman 2018 ioannidis et al 1996 jackson and krevor 2019 kueper and mcwhorter 1992 these simulation results run contrary to the fact that a significant amount of post imbibition capillary heterogeneity trapping has been observed in water wet sandstone coreflooding experiments krevor et al 2011 therefore key modifications to both the voxel level hysteresis model and the macroscopic trapping rules are needed to better match reality these modifications include setting the imbibition snap off pressure ps to be nonzero jackson et al 2020 jackson and krevor 2019 and applying an additional domain level macroscopic trapping rule when the ps value is reached during the mp imbibition simulation we assume that this nonzero continuum scale snap off capillary pressure ps occurs at the residual saturation caused purely by pore scale residual trapping mechanisms and that this is the capillary pressure below which the nonwetting phase is no longer continuous during imbibition with these assumptions in place the voxel level hysteretic capillary pressure model should then terminate at its ps value during imbibition and does not further decrease for the mp imbibition simulation process this means it is necessary to implement a macroscopic trapping rule that freezes the domain saturation during imbibition when the externally imposed capillary pressure drops below this specified ps value to ensure that the nonwetting phase is no longer flowing while some studies have adopted lower ps values jackson et al 2020 jackson and krevor 2019 in this study we set the ps value equal to the voxel level capillary entry pressure pe value for simplicity although determining the exact value for ps is outside the scope of the current study ps does directly affect the mp residual trapping simulation results therefore a sensitivity analysis has been conducted on the value of ps and is provided in appendix a because the mp simulator is a reduced physics simulator several assumptions are employed in the current study the flow rate is assumed to be infinitesimal such that viscous forces are negligible it is also assumed that capillary pressure equilibrium is instantly reached at every pressure step each voxel in the domain is assumed to be at the continuum scale so that they would have well defined voxel level petrophysical and multiphase flow properties i e porosity permeability and capillary pressure curves the mp simulations in this study are run on 3d domains for boundary conditions both the inlet and the outlet slices are constant pressure boundaries all the other boundaries are no flow boundaries drainage simulations start at 100 water saturation everywhere in the domain and imbibition simulations start with the post drainage saturation field in other words first a primary drainage and then a secondary imbibition are simulated to demonstrate that the mp simulator is a suitable tool for simulating realistic co2 storage projects at the field scale a scaling group analysis has been conducted field scale co2 storage has a viscosity ratio μ w μ nw of 10 1 where μ w and μ nw are viscosity for the wetting and the nonwetting phase the field scale microscopic bond number δρgd 2 σ is 10 3 where δρ is the density difference between the two phases g is the gravity acceleration constant d is the mean pore diameter and σ is the interfacial tension cinar et al 2007 kimbrel et al 2015 morrow et al 1988 during co2 injection when we are away from the well and during the post injection fluid redistribution stage the field scale range of the capillary number vμ σ computed is 10 12 to 10 8 where v is the darcy velocity and μ is the viscosity of the invading fluid larkin 2010 lefebvre du prey 1973 morrow et al 1988 finally the gravity number δρgk vμ value range at the field scale is 100 to 103 where k is average permeability engelberts and klinkenberg 1951 larkin 2010 mp simulations have the same viscosity ratio and microscopic bond number values as the previous field scale values because the flow rate is taken to be zero in mp simulations the capillary number of any mp simulation is 0 and the gravity number is infinite which are also consistent with the strongly capillary and gravity dominated flow regime at the field scale the calculation details can be found in the supplementary material the rest of this section describes the details of the mp simulation formulation and the inputs into the simulator here an algorithm based mp simulator formulation is presented for a matrix representation of the mp simulator see nooruddin and blunt 2018 2 1 voxel level inputs voxel level properties need to be specified as inputs into the mp simulator strictly speaking the mp simulator only requires capillary pressure curves to be defined at the voxel level the input voxel level capillary pressure curves can be brooks corey van genuchten or any user defined models in this study we use a brooks corey model for capillary pressure curves so that a nonzero capillary entry pressure exists the leverett j function scaling relationship has been shown to provide accurate modeling of core scale experiments it is a convenient way to assign different capillary pressure curves to voxels and has been widely used as a way to model capillary heterogeneity huang et al 1995 krause et al 2013 2011 kuo and benson 2015 saadatpoor et al 2010 zeybek et al 1995 a single j function can be scaled according to the voxels porosity and permeability values to generate voxel level capillary pressure curves for voxels belonging to a single rock formation akin et al 2000 leverett 1941 li and benson 2015 the equations used to represent the drainage voxel level capillary pressure curves are shown in eqs 1 to 4 brooks and corey 1964 pini and benson 2017 1 p c j d α p e j 2 j s w 1 λ 3 s w s w s w i 1 s w i 4 α k a v g ϕ j ϕ a v g k j where p c j d is the drainage capillary pressure of each voxel j j is the j function s w is the effective wetting phase water saturation and α is the scaling factor that converts the average capillary pressure curve to the voxel level curves in eq 1 pe is the domain capillary entry pressure of the brooks corey model in eq 2 λ is the pore size distribution index in eq 3 sw is the water saturation and swi is the irreducible water saturation in eq 4 φ avg and kavg are the average porosity and permeability values while φ j and kj are the voxel level porosity and permeability values note that for field scale simulations different φ avg and kavg values should be specified for every rock type after the leverett j function scaling relationship is applied when the voxels are at capillary equilibrium the saturation of the voxels would all be different with respect mainly to their permeability values as illustrated in fig 1 the case for the imbibition capillary pressure curves is more complex because hysteresis is present we can choose to simply use the nonhysteretic drainage capillary pressure curves during imbibition however this is not realistic when comparing to experimental results in order to account for hysteresis caused by pore scale trapping mechanisms we use a trapping model like the land or the linear trapping relationship in this study the linear trapping relationship is used unless otherwise specified the equations used to represent the imbibition hysteretic voxel level capillary pressure curves are shown in eqs 5 to 9 jackson et al 2020 pini and benson 2017 5 p c j i α p c i 1 s n w m 1 λ 1 p s 6 p c i p e p s s w i 1 λ 1 s w i 1 λ 1 7 s n w m s n w s n w r 1 a p 8 s n w r a p s n w i 9 s n w s n w 1 s w i where p c j i is the imbibition hysteretic capillary pressure of each voxel j s n w m is the effective mobile nonwetting phase co2 saturation and s n w is the effective nonwetting phase saturation in eq 5 α is the same scaling factor as in the drainage case and ps is the imbibition snap off capillary pressure in eq 6 s w i 1 s n w i where s n w i is the effective initial co2 saturation prior to imbibition a k a the turning point saturation in eq 7 s n w m is computed using a linear trapping relationship which is defined in eq 8 where ap is the pore scale linear trapping coefficient and s n w r is the effective residual nonwetting phase saturation finally eq 9 shows how the effective nonwetting phase saturation is computed instead of using the linear trapping relationship to calculate s n w m it is also possible to use the land trapping relationship as shown in eqs 10 to 12 where cp is the pore scale land trapping coefficient jackson et al 2020 land 1968 pini and benson 2017 the illustration for the voxel level capillary pressure curves is shown in fig 2 fig 2 also shows the differences between the capillary pressure models computed with the two different trapping models the selection of the voxel level residual trapping model determines the amount of pore scale residual trapping there exists in the voxel at different capillary pressure values and will therefore affect the final domain residual trapping amount simulated 10 s n w m 1 2 δ δ 2 4 δ c p 11 δ s n w r s n w 12 s n w r s n w i 1 c p s n w i 2 2 simulation procedure there are three main steps in the mp simulation procedure as illustrated in the workflow chart in fig 3 1 assign simulation input values 2 conduct the drainage process and 3 conduct the imbibition process previously section 2 1 has introduced the voxel level inputs required and how pore scale residual trapping is accounted for by incorporating hysteresis into the voxel level input model the current section will focus on the two phase flow rules implemented to carry out the drainage and imbibition processes as well as the macroscopic trapping rules used to account for capillary heterogeneity trapping for a detailed description of the mp simulation code see supplementary material 2 2 1 drainage a nonzero pressure is imposed on the nonwetting phase to initiate the drainage displacement process because there is essentially no viscous pressure gradient the externally imposed non wetting phase pressure is directly equal to the capillary pressure between the two fluids and because all voxels are at capillary equilibrium the whole grid therefore has the same capillary pressure everywhere that is equal to the externally imposed nonwetting phase pressure ioannidis et al 1996 for these simulations the externally imposed nonwetting phase pressure is increased from 0 to a maximum value in small pressure increments of 100 pa to model the drainage process in which co2 invades the fully water saturated grid during drainage for strongly water wet porous media under capillary dominated flow regimes the nonwetting phase cannot enter the domain unless the capillary entry pressure is overcome therefore invasion percolation algorithm is used to simulate the drainage process this results in a distinct co2 invasion front as shown in fig 4 ioannidis et al 1996 kueper and mcwhorter 1992 wilkinson and willemsen 1983 as shown in the workflow chart in fig 3 at each pressure step the simulator examines which voxels on the co2 invasion front have capillary entry pressures lower than the currently imposed pressure and will invade those voxels if that is the case then the co2 saturation values of the invaded voxels are computed using the capillary pressure functions defined for each voxel kueper and mcwhorter 1992 therefore the front can only advance through the domain if the capillary pressure is greater than the entry pressure of the voxels downstream of the invasion front 2 2 2 imbibition after the drainage process is complete the imposed pressure is then reduced in the same number of pressure steps from the maximum drainage capillary pressure back to 0 to model the imbibition process in which water displaces co2 the imbibition process is terminated when the co2 saturation field reaches a constant value because the remaining co2 is trapped we assume that water can flow throughout the entire domain in grain coating films for strongly water wet porous media therefore an ordinary percolation algorithm is suitable to model imbibition at the continuum scale because it allows water to get access to the whole domain at any capillary pressure as a consequence no water imbibition front is observable as demonstrated in fig 5 ioannidis et al 1996 when no capillary heterogeneity trapping is accounted for the saturation of each voxel is simply calculated according to the individually defined voxel level imbibition hysteretic capillary pressure functions at each pressure step 2 2 3 implementation of capillary heterogeneity trapping during mp drainage simulation because it is assumed that water dominantly flows in films no water capillary heterogeneity trapping by co2 invasion is imposed the justification for this simulation choice is that water flowing in films means that the wetting phase is always continuous in the domain so co2 should not be able to disconnect any portion of water from the continuous water phase at any capillary pressure therefore given a high enough capillary pressure co2 is capable of invading all voxels to the irreducible water saturation as shown in fig 6 left during mp imbibition simulation while co2 pore scale trapping is captured by hysteresis in the voxel level capillary pressure curves in order to capture co2 capillary heterogeneity trapping caused by mesoscale heterogeneity two macroscopic trapping rules are implemented the first imbibition macroscopic trapping rule states that when a group of voxels is completely surrounded by neighboring voxels at their voxel level residual saturation then this group of voxels is determined to be macroscopically trapped by the capillary heterogeneity trapping mechanism the co2 saturation value of the macroscopically trapped voxels can no longer change with decreasing capillary pressure as shown in fig 6 right ioannidis et al 1996 kueper and mcwhorter 1992 yortsos et al 1993 with this trapping rule co2 tends to be trapped in higher permeability regions which have lower capillary entry pressure and are surrounded by lower permeability regions which require higher capillary entry pressure to enter with only the first macroscopic trapping rule applied the match in voxel level co2 saturation between mp and full physics simulation results is good for a low degree of heterogeneity but at a high degree of heterogeneity mp simulation consistently underestimates the trapped co2 saturation therefore a second macroscopic trapping rule needs to be applied this second rule states that all voxels are macroscopically trapped when the domain capillary pressure value drops below the imbibition snap off capillary pressure this is because at or below this snap off capillary pressure value co2 is no longer a continuous phase and should not be able to flow as shown in the workflow chart in fig 3 with both macroscopic trapping rules applied now for imbibition it is necessary to first check whether the current capillary pressure is high enough and whether the voxels are macroscopically trapped before proceeding after the imbibition process is finished simulation of a single primary drainage and secondary imbibition cycle is now complete the domain effective co2 saturation can then be calculated at each pressure step and the domain effective capillary pressure curves for both drainage and imbibition can be obtained by convention capillary pressure graphs show the difference in pressure between the two continuous immiscible phases plotted against water saturation because this is the only capillary pressure that is measurable in darcy scale lab experiments in the mp simulation case this would be equivalent to plotting the externally imposed pressure against the water saturation ioannidis et al 1996 yortsos et al 1993 however it is worth noting that the externally imposed pressure capillary pressure of the continuous phases is not simply equal to the average capillary pressure of the grid simple arithmetic average of voxel level capillary pressure values at each effective water saturation this is especially the case before co2 percolation during drainage and when there is co2 capillary heterogeneity trapping during imbibition 2 2 4 implementation of gravity in the mp simulator the mp simulator is capable of incorporating gravity forces by imposing capillary gravity equilibrium when the domain size is small gravity effects are much smaller than capillary effects and can be ignored however for large domain sizes such as the field scale it is important to consider gravity forces when gravity forces are ignored the mp simulator does not require specifying the exact size of the voxel however when gravity forces are considered the voxel size in the vertical z direction does need to be supplied for the mp simulator to calculate the difference in hydrostatic head between voxel pairs when gravity forces are not added the imposed capillary pressure p c imposed of the whole domain is 13 p c i m p o s e d p c o 2 p w where p c o 2 and pw are the pressure in the co2 and the water phase respectively when gravity forces are included in the model there exists a hydrostatic pressure gradient in both the co2 and the water phase as shown in fig 7 a the capillary pressure of the domain can then be computed as follows ioannidis et al 1996 14 p c d z 0 p c o 2 d z 0 p w d z 0 p c i m p o s e d 15 p c d z p c o 2 d z p w d z p c i m p o s e d δ ρ g d z gravity forces are calculated as δρgdz where δρ is the density difference between the two fluids water and co2 g is the gravitational acceleration and dz is the relative depth defined as 0 at the top of the domain and increases to the maximum value at the bottom of the domain as shown in fig 7a from eqs 14 and 15 it is apparent that when gravity forces are present the effective capillary pressure value decreases with the depth dz in the domain with gravity forces added now a voxel can only be invaded during drainage when the currently imposed domain capillary pressure is greater than the capillary entry pressure of the current voxel and the gravity forces combined as shown in eq 16 16 p c d z p e v o x e l or equivalently p c i m p o s e d p e v o x e l δ ρ g d z fig 7b and c show the capillary pressure values needed to invade each voxel in a realistic reservoir slice domain with and without gravity forces added details of this domain will be presented later in section 2 3 3 for an invading fluid co2 that is lighter than the defending fluid water gravity forces hinder downward fluid invasion ioannidis et al 1996 this can be clearly seen by comparing the two graphs as much higher pressure is needed in order to invade deeper voxels 2 3 simulation input data this section provides the values used for the voxel level inputs and explains the two sets of simulation cases run with the mp simulator the first set of mp simulation cases is run to obtain the domain specific co2 residual trapping abilities for different types and degrees of mesoscale heterogeneity the second set is run on a realistic vertical reservoir slice to demonstrate how the mp simulator can be applied at the field scale in order to ensure that saturation is sufficiently uniform within a voxel to be represented by a single value both viscous and gravity forces need to be small relative to capillary forces within the voxel therefore the voxel size cannot be arbitrary and needs to be small enough to ensure that the mp simulation assumptions are valid while viscous forces mainly act on co2 in the horizontal direction in a vertical well injection scenario gravity forces only act on co2 in the vertical direction therefore we would expect the magnitude of the viscous forces to limit the size of the voxel in the horizontal direction and the magnitude of the gravity forces to limit the size of the voxel in the vertical direction the voxel size selected for the core scale analysis is 2 mm which is well below the voxel size limit at which viscous forces kpe μv 0 3 m and gravity forces pe δρg 0 7 m surpass capillary forces ioannidis et al 1996 the voxel size selected for the field scale analysis is 1 m in the horizontal direction and 5 cm in the vertical direction while the vertical voxel size is well within the limit of 1 3 m the horizontal voxel size limit varies between 0 8 m and 1400 m largely depending on the flow rate v chosen even so the horizontal voxel size is approximately at the strictest limit of 0 8 m with this field scale voxel size the macroscopic bond number δρgl p e d is 10 2 where l is the voxel height and p e d is the domain effective entry breakthrough capillary pressure ioannidis et al 1996 see supplementary material for calculation details 2 3 1 voxel level input data in order to use the leverett j function scaling relationship to assign voxel level capillary pressure curves as inputs into the mp simulator voxel level porosity and permeability values need to be specified for this study a constant porosity value is assigned to all the voxels for simplicity as is done in li and benson 2015 table 1 shows the voxel level input parameter values used the values for the various input parameters are based on the average berea sandstone experimental data published by krevor et al 2012 and ni et al 2019 one exception is the pore scale linear trapping coefficient ap in order to obtain a sandstone rock s residual trapping characteristics coreflooding experiments need to be conducted upon the results of which empirical trapping relationships such as the linear or the land models are fitted due to the fact that the medical ct scanners do not provide micron level resolution it is not possible to directly differentiate between pore scale and mesoscale residual trapping mechanisms consequently the experimental residual trapping models capture all residual trapping regardless of the underlying trapping mechanisms the mp simulation addresses this challenge by explicitly simulating the two residual trapping mechanisms separately because the macroscopic trapping rules separately account for capillary heterogeneity trapping the trapping model for voxel level hysteresis should strictly capture only pore scale residual trapping ap is the coefficient in the linear trapping model defined in eq 8 and ni et al 2019 have used an extrapolation method to infer the ap value on a set of diverse coreflooding data therefore the resulting value of ap 0 46 is used as the input in the mp simulation model for voxel level hysteresis just like the ps parameter this input ap value significantly affects the mp residual trapping simulation results therefore a sensitivity study on the value of this input parameter can be found in appendix a 2 3 2 trapping ability simulation input data we can employ the mp simulator to quickly obtain post imbibition co2 residual trapping ability for different types of domains by turning on capillary heterogeneity trapping all simulation cases in this section have 3d cubic domains the size of 10 10 10 voxels with artificially generated permeability fields the voxel size used is 2 mm 2 mm 2 mm which is greater than the representative elementary volume scale jackson et al 2020 pini and madonna 2016 because the domain size is small gravity forces do not have a significant influence and are turned off for this set of simulation cases the inlet face is to the left and the outlet face is to the right the permeability fields used can be completely random or homogeneous except for a downstream low permeability barrier as shown in fig 8 the random permeability fields are uncorrelated with a lognormal distribution for the random permeability fields the permeability value for each voxel is randomly generated from a normal distribution with a specified mean and standard deviation an increasing standard deviation represents an increasing spread of the permeability values and this in turn represents an increasing degree of mesoscale heterogeneity after a normal distribution is obtained the values are exponentiated in order to get lognormally distributed permeability values for the permeability fields with barriers there are three types of barriers that are investigated the perfect barrier type has a single layer of voxels with homogeneous low permeability values the leaky barrier type has a hole the size of a single voxel in the upper corner of its barrier and is otherwise identical to the perfect barrier finally the multilayer barrier type has two layers of barrier voxels with lognormally distributed uncorrelated random low permeability values with a standard deviation std ln k of 0 5 for random domains we want to investigate how increasing the degree of heterogeneity affects the domain effective linear trapping coefficient ad so ten random domains with different values of std ln k ranging from 0 to 5 are used where 5 represents an extremely high degree of mesoscale heterogeneity for barrier domains we want to investigate how increasing the permeability contrast between the upstream domain and the downstream capillary barrier affects ad so eleven barrier domains with different values of the downstream low permeability barrier are used a fifth type of domain with an extremely high degree of heterogeneity is also examined for the extreme cases we position 5 layers of homogeneous barrier downstream the permeability values of the extreme case barriers are quite low note that the input mean or upstream domain permeability into the simulation is always at 300 md for every case previously in literature it has been assumed that the capillary dominated residual trapping relationship for a certain rock type does not change across scales and it is considered an intrinsic property of the porous medium itself al menhali and krevor 2016 krevor et al 2015 niu et al 2015 pini and krevor 2019 in order to examine whether the initial residual saturation ir curves are truly scale invariant for every case in this section we run twenty mp simulations with different maximum drainage capillary pressure values then the linear and land trapping coefficients computed from the domain averaged initial and residual co2 saturation values are plotted on a single ir plot we can then compare this domain level trapping relationship with the voxel level trapping relationship all model parameter values covered in this section are shown in detail in table 2 2 3 3 field scale simulation input data the mp simulator is applied to a realistic vertical reservoir slice domain to predict both post drainage and post imbibition co2 saturation the reservoir slice is extracted from parasequence 1 of the paaratte formation at the otway site in australia in between well crc2 and crc3 mishra et al 2020 2019 the paaratte sandstone formation is a saline aquifer pevzner et al 2013 at a depth of 1500 m the temperature is 60 c and the pressure is 15 mpa the dimension of the model is 40 m vertically and 760 m horizontally the voxel size is 1 m 1 m 5 cm with 5 cm as the resolution in the vertical direction realistic porosity permeability rock type and facies values have been assigned to the voxels in the model to best represent the true properties of the geological formation mishra et al 2020 2019 the depositional facies and rock type maps generated are constrained by log data of the two wells present near the two ends of the domain therefore the layer thicknesses in the vertical direction are set ranging from a few centimeters to 5 8 m for different facies different variograms have been derived for different facies and these facies therefore each has a different correlation length in the horizontal direction ranging from 200 300 m to over a kilometer porosity and permeability values are correlated and are both associated with the facies and rock types assigned for more details about how the field scale model is generated see mishra et al 2020 2019 and dance et al 2019 for the current study we use a modified version of the aforementioned vertical reservoir slice domain by applying the following simplifications we choose to ignore the dip angle of 4 in the formation and select only the top 10 m of the domain which includes roughly 150 000 voxels the porosity and horizontal permeability maps for the simulation domain are shown in fig 9 the domain has an average porosity of 0 21 and a geometric permeability average of 37 md it can be clearly seen that this is a highly heterogeneous domain with an std ln k value of 2 8 the resulting pressure required to invade the voxels in this domain with or without gravity present is shown in fig 7b and c the capillary pressure curve for each voxel is calculated using the leverett j function scaling relationship in eqs 1 4 with the properties for kavg λ and pe provided in table 1 anisotropy in the permeability field is disregarded and only the horizontal permeability values are used finally the density of water and co2 are uniform throughout the domain based on a temperature of 60 c and a pressure of 15 mpa ρ w 989 60 kg m3 and ρ c o 2 604 09 kg m3 lemmon et al 2018 gravity forces are included for this field scale simulation case with gravity the externally imposed capillary pressure value is the greatest at the top layer of the model and reduces with increasing depth for co2 drainage and water imbibition a maximum capillary pressure value of 35 kpa during drainage is selected this value is selected such that the domain reaches post drainage co2 saturation values observed from full physics simulations of co2 injection at flow rates typical for field scale projects for mp simulation boundary conditions the inlet is the left edge and the outlet is the right edge because viscous forces are the strongest at the injection well and reduce rapidly away from the well dance et al 2019 hovorka et al 2006 meckel and bryant 2014 the mp simulator is best applied to domains some distance away from the injection well where flow rates are low enough that capillary and gravity forces dominate celia et al 2015 meckel et al 2015 table 3 summarizes all the model parameter values for this field scale domain 3 mp simulation results and discussion there are two major parts to the results the first part of this section shows and discusses the co2 residual trapping ability simulation results for the four different types of synthetic cube domains the second part of this section applies the mp simulator to a realistic fine grid vertical reservoir slice domain 3 1 trapping ability simulation results before we report the trapping abilities for the different types of permeability fields we first turn our attention to the difference between the voxel level and the domain level residual trapping relationships as shown in fig 10 fig 10 displays the voxel level and domain level ir plots with different voxel level trapping models for the same domain that has uncorrelated random permeability values here the voxel level ir plot is obtained by simulating a single primary drainage imbibition cycle and plotting the voxel level ir values whereas the domain level ir plot is obtained by simulating repeated primary drainage imbibition cycles and plotting the domain effective ir values from the voxel level ir plots in the case when ps is nonzero it can be seen that voxels with low initial co2 saturation 0 4 follow the input voxel level trapping relationships ps 0 and voxels with high initial co2 saturation 0 4 display capillary heterogeneity trapping behaviors that diverge from the input voxel level trapping relationships the permeability of the voxels at which this apparent bend occurs is approximately at the domain median permeability value similar voxel level ir results can also be found in full physics coreflooding simulations conducted by jackson and krevor 2019 the reason for this kind of trapping behavior is as follows low permeability voxels according to the leverett j scaling relationship will have voxel level capillary pressure curves with high capillary entry pressure this means that in the post drainage co2 saturation field at capillary equilibrium these low permeability voxels will have low initial co2 saturation then during the mp imbibition simulation process as the domain capillary pressure decreases these low permeability voxels will reach their pore scale residual trapping amount first and get frozen as the imbibition capillary pressure keeps dropping only after the domain already contains frozen voxels can other higher permeability voxels have a chance of been macroscopically trapped as a consequence capillary heterogeneity trapping behavior occurs only in higher permeability voxels which have low capillary entry pressures and high drainage co2 saturations from the domain level ir plots it can be seen that with the linear trapping model as the voxel level input the macroscopic trapping rules cause the domain level ir curve to deviate from the linear trapping model and follow a double linear model a linear trapping relationship similar to the double linear model shown here has been reported on a water wet limestone using the porous plate experimental method tanino and blunt 2013 this double linear trapping model is a direct consequence of the first macroscopic trapping rule implemented the effect of this trapping rule is such that if imbibition proceeds before co2 drainage has percolated the domain reached the outlet then any co2 present in the domain will be 100 trapped at the end of imbibition such trapping behavior is realistic and has been observed in sand tank experiments trevisan et al 2017b only after co2 drainage has percolated the domain can the effect of the pore scale residual trapping model be seen at the domain level after imbibition fig 10 clearly shows that regardless of the type of voxel level trapping model implemented there are significant differences between the input voxel level trapping model and the larger scale domain effective trapping relationship this mp simulation result shows that residual trapping relationships are not scale invariant when capillary heterogeneity trapping is present in order to investigate how residual trapping abilities vary with different types and degrees of mesoscale heterogeneity mp simulations are run on four types of permeability fields with varying degrees of heterogeneity or matrix barrier permeability contrast in order to measure the linear trapping coefficient for any domain more accurately the fitted least square linear regression values are reported in this section however note that with this fitting the linear residual trapping ability will be underestimated when the initial saturation is low and overestimated when the initial saturation is high fig 11 shows all simulation results with two different voxel level input residual trapping models the linear trapping model in a and the land trapping model in b from fig 11a we can see that other than the leaky barrier case the domain effective linear trapping coefficient ad increases with the degree of mesoscale heterogeneity represented by the maximum standard deviation in the drainage co2 saturation fields s t d m a x s c o 2 this simulation result is consistent with the experimental results shown in black dots this result is also consistent with simulation results in the literature that under capillary dominated flow regimes more oil capillary heterogeneity trapping can be achieved in water wet rocks with increasing permeability contrasts for cross lamination flow corbett et al 1992 however unlike previously assumed the relationship between ad and s t d m a x s c o 2 appears to be nonlinear and dependent on the structure of the heterogeneity field for the multilayer barrier case no extra capillary heterogeneity trapping can be achieved at low degrees of heterogeneity yet as the degree of heterogeneity increases the multilayer barrier domain has a similar shape with the perfect barrier case and it is also the case that best fits the experimental data for the leaky barrier case it is clear that when the capillary barrier is leaky no capillary heterogeneity trapping can be achieved even at a high degree of heterogeneity as shown in fig 11b similar trends in the residual trapping results can be obtained when the voxel level input trapping model changes from the linear to the land model the simulation results from these four different types of domains have demonstrated that although these domains can have the same degree of mesoscale heterogeneity by this simple standard deviation measure the actual residual trapping ability value is highly heterogeneity dependent good capillary barriers can achieve a much higher residual trapping ability at a lower degree of heterogeneity than an uncorrelated random domain a good fit of the multilayer barrier case to the majority of the experimental data also suggests that some sandstone rock samples used here may in fact be mostly homogeneous with just a few capillary barriers to be able to achieve a high amount of capillary heterogeneity trapping numerical values of the data used in fig 11 can be found in supplementary material however we notice that there is one experimental data point shown in fig 11 with an extremely high degree of heterogeneity that cannot be simulated by the aforementioned four types of domains for the random domains std ln k 5 already represents an extremely high degree of heterogeneity and further increases in std ln k are possible but not realistic for the barrier domains reducing the barrier permeability below 0 01 md no longer increases the degree of heterogeneity value measured by the parameter s t d m a x s c o 2 in an effort to simulate the data point with an extremely high degree of heterogeneity the fifth type of extreme barrier cases is run the results are close to the data point albeit still being slightly less heterogeneous by the s t d m a x s c o 2 measure sensitivity analysis run with different values of the ps and the ap parameter show that although the resulting ad values do vary the general trends as shown in fig 11 remain the same it is worth noting that even as we vary the two input parameters the two domains with the nonleaky downstream barriers remain the most consistent with the experimental data points this result indicates that real sandstone rocks behave more closely to the two nonleaky barrier domains than the random or the leaky barrier domains for the sensitivity analysis results see supplementary material 3 2 field scale simulation results the results of the vertical slice mp simulation are shown in figs 12 and 13 fig 12 shows the co2 saturation results of several pressure steps taken during drainage and imbibition fig 12 also shows the end states for both drainage and imbibition with and without capillary heterogeneity trapping fig 13 shows the corresponding voxel level capillary pressure curves for the two different imbibition end states shown in fig 12 from fig 12 it can be seen that during drainage there exists a distinct invasion front extending from the inlet on the left to the outlet on the right as the domain capillary pressure increases similarly heterogeneous plume saturation caused by capillary heterogeneity have been observed in modeling studies by jackson and krevor 2020 after the co2 plume percolates through the domain co2 continues to invade more voxels as domain capillary pressure further increases and backfills towards the lower parts of the domain in the presence of gravity the backfilling would be more obvious if the maximum capillary pressure value reached during drainage is set higher we can also see that no distinct imbibition front is present as the domain capillary pressure drops during imbibition the co2 plume in the domain becomes fully immobilized when the externally imposed capillary pressure reduces to 24 kpa when capillary heterogeneity trapping is included as shown in fig 12e with capillary heterogeneity trapping excluded the plume continues to migrate until the externally imposed capillary pressure reduces to the imbibition snap off value of 5 kpa as shown in fig 12f when the end state is reached after drainage in fig 12d we can see that the post drainage co2 saturation at some regions can be as high as 0 8 although the majority of invaded voxels have co2 saturation values lower than 0 6 high co2 saturation values 0 6 0 8 in thin layers of plume have been observed away from the injection well in field scale co2 storage projects such as the frio project observation well 30 m away hovorka et al 2006 krevor et al 2015 and the sleipner project observation 100 500 m away chadwick et al 2005 whereas for the otway observation well 170 m away dance et al 2019 and the nagaoka project observation wells 40 m and 60 m away mito and xue 2011 sato et al 2011 lower co2 saturation values 0 6 away from the injection well have been reported permeability and the degree of heterogeneity may have affected plume migration at different sites both the frio 2 4 d hovorka et al 2006 and the sleipner 1 d eiken et al 2011 sites have high permeability values whereas the otway site has a large range of permeability values anywhere from 0 001 md to 10 d dance et al 2019 and the nagaoka site has rather low permeability values 0 5 12 md sato et al 2011 because the permeability of the vertical slice domain we are working with in this study is relatively low we would likely expect the post drainage co2 saturation to be low as well when measured away from the injection well after imbibition the co2 saturation map with capillary heterogeneity trapping is shown in fig 12e 79 of the initial co2 is trapped as residual co2 saturation comparing to 46 with pore scale trapping only consequently capillary heterogeneity trapping contributes 42 to the total co2 volume that is residually trapped by comparing the residual trapping results and capillary pressure curves with and without capillary heterogeneity trapping in figs 12 and 13 it is clear that with macroscopic trapping rules applied many voxels with high initial co2 saturation values now have high amounts of capillary heterogeneity trapping which would have escaped otherwise 4 conclusions an mp simulator has been developed to simulate co2 water post drainage and post imbibition co2 saturation distribution with capillary heterogeneity trapping under capillary and gravity dominated flow regimes the mp simulator has been validated by a full physics simulator mrst and can achieve a speedup of 10 to 100 times an example of how the mp simulator can be applied to a field scale vertical reservoir slice has also been shown from the mp simulation results the following conclusions can be drawn there are significant differences observed between the voxel level and the domain level ir trapping relationships for heterogeneous rocks suggesting that approaches such as the one described here need to be taken in order to correctly compute the effective trapping characteristics of a heterogeneous domain for uncorrelated random domains and for cases with downstream capillary barrier layers that are nonleaky post imbibition capillary heterogeneity trapping always increases with the degree of mesoscale heterogeneity which is consistent with previous experimental results although the relationship between ad and s t d m a x s c o 2 is not linear as previously shown even when the degrees of mesoscale heterogeneity are the same the spatial distribution of heterogeneity significantly affects the amount of capillary heterogeneity trapping achieved domains with nonleaky capillary barriers trap more than domains that are uncorrelated and random which in turn trap more than domains with leaky barriers the heterogeneity case with residual trapping abilities that best fit the experimental data suggests that domains with few capillary barriers and are otherwise homogenous can still achieve a significant amount of capillary heterogeneity trapping overall the simulation results presented in this study highlight the benefits of having a higher degree of heterogeneity and good capillary barriers at the mesoscale for increasing post imbibition capillary heterogeneity trapping credit authorship contribution statement hailun ni methodology software visualization validation writing original draft olav møyner software writing review editing kuncho d kurtev resources sally m benson conceptualization supervision funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this work was supported by stanford university s global climate energy project and the geocquest project funded by bhp the geocquest project is a collaboration between the university of melbourne cambridge university and stanford university the authors thank the co2crc ltd for providing the geological data from the otway international test centre supporting this study the authors have no known financial conflicts of interests all mp and mrst simulation codes can be found online at http dx doi org 10 17632 6gj3rd7ntr 2 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103990 appendix c supplementary materials image application 1 image application 2 appendix a sensitivity of the residual trapping simulation results both the pore scale trapping ability ap and the imbibition snap off capillary pressure ps have a large effect on the residual trapping amount simulated in the mp simulation ap solely determines the amount of residual trapping that is caused by the pore scale snap off bypass trapping mechanism at the voxel level and ps largely determines the amount of residual trapping that is caused by the mesoscale capillary heterogeneity trapping mechanism at the domain level in order to explore the effect of ap and ps on residual trapping simulation results a sensitivity analysis is provided here the residual trapping results for the four synthetic cube domains are shown in fig a1 sensitivity of the residual trapping simulation results to the tessellation pattern and the grid size is also discussed fig a1a shows that other than the leaky barrier case all the other cases have their domain trapping ability ad increase linearly with the ps value the rate of increase differs depending on the type of heterogeneity of the domain we can see that having a nonzero ps value is essential for capturing any capillary heterogeneity trapping because the leaky barrier case does not have a completely sealing capillary barrier it has no extra amount of capillary heterogeneity trapping regardless of the value of ps and regardless of the degree of heterogeneity of the domain as we have previously discussed physically ps determines the voxel level capillary pressure at which the pore scale residual trapping amount is reached the higher the ps value the sooner this particular voxel will reach its pore scale residual trapping amount and get frozen during the imbibition mp simulation with more voxels frozen early on during imbibition the remaining voxels will have higher chances of been macroscopically trapped and therefore the domain is likely to have a greater amount of capillary heterogeneity trapping as a result fig a1b shows that the ad value for all types of domains increases linearly at different rates with the ap value the leaky barrier case has a unit slope again indicating that no extra capillary heterogeneity trapping can be achieved above the ap value the results of this sensitivity study have demonstrated that for any given domain with a reasonable degree of heterogeneity the ad value changes linearly with ps and ap however when a domain has an extremely high degree of heterogeneity then the previous linear relationship between the input parameters ps ap and the output ad value breaks down this is because when the barriers in the domain have extremely low permeability no matter how the value of ps and ap changes during imbibition the water phase would not have enough driving forces to push the co2 through the barrier and therefore the ad value is always 1 for sensitivity analysis results on highly heterogeneous domains see supplementary material in the presence of spatial correlations the coordination number of the percolation lattice no longer affects the percolation threshold ioannidis et al 1996 in the current study all the synthetic barrier domains and the field scale slice domains used have some kinds of spatial correlation present the only domain without any spatial correlations is the random synthetic domain case for this particular case it is true that if other types of space filling tessellation are chosen the residual trapping simulation results may be different this is because the different percolation threshold values will affect at what initial co2 saturation the co2 phase percolates the domain which determines the point at which the domain level ir plot starts deviating from the 100 trapping line the coordination number also determines how easily a voxel can be macroscopically trapped generally a smaller coordination number promotes more macroscopic trapping however the general trapping trends observed here should still remain valid regardless of the tessellation chosen that more heterogeneous domains will have more capillary heterogeneity macroscopic trapping to demonstrate the validity of the residual trapping results in fig 11 at larger domain sizes extra mp simulation cases with the domain size 100 100 100 voxels have also been run for all the four major types of synthetic cube domains for the random perfect barrier and the leaky barrier cases the larger domain simulation results are highly similar to the results from the corresponding smaller domains the differences in the domain average linear trapping coefficient ad are all within 0 01 the only exception is the multilayer barrier case because the permeability value of its barrier voxels draws from a lognormal distribution with just two layers of capillary barrier voxels and a much larger barrier size there is a much higher chance that certain voxels on the barriers have similar permeability values as the upstream matrix as a consequence the multilayer barrier acts like a leaky barrier and no extra capillary heterogeneity trapping can be achieved in the larger domain therefore for the larger domain size of the multilayer barrier case to achieve similar results as the smaller domain size either more layers of capillary barriers need to be added or the mean standard deviation of the barrier permeability values need to be reduced appendix b validation of the mp simulator in order to validate the mp simulation results we compare with the results from a full physics reservoir simulator the mrst lie 2019 the advantage of using mrst is that it is matlab based so it is easy to use and to visualize simulation results also as the source code is open it allows fully customizable capillary pressure and relative permeability inputs for both drainage and imbibition furthermore it is easy to turn gravity on or off because mrst is a full physics simulator some extra inputs are necessary to specify a flow scenario note that we use the two phase black oil simulator module treating co2 as the oil phase and water as the water phase the discretization used by the simulator is a fully implicit scheme with two point flux approximation and single point mobility upwind identical in configuration to most commercially available full physics simulators b 1 mrst validation inputs ten simulation cases are run for validation these cases have the same domain sizes as the previous trapping ability simulation cases among the ten validation cases several different parameters are varied so that all simulation cases covered in the current study are validated the validation cases include the following homogeneous domains with different imbibition snap off capillary pressure ps cases 1 and 2 uncorrelated heterogeneous domains with an increasing degree of heterogeneity cases 3 and 4 a heterogeneous domain with a different trapping model case 5 heterogeneous domains with different types of downstream capillary barrier cases 6 7 and 8 an uncorrelated heterogeneous slice domain case 9 finally a homogeneous domain with gravity forces added case 10 details of the input parameters for the ten validation cases are shown in supplementary material capillary heterogeneity trapping is included for all validation cases in the mp simulator in order to match mp simulation results to the full physics simulation results the maximum drainage capillary pressure for mp simulations is set to the median value of the resulting drainage capillary pressure field obtained from running the full physics simulation in order to minimize capillary end effects in mrst simulation five slices are added both at the inlet and the outlet the extra slices have uniform core average properties a constant flux boundary condition is applied at the inlet and a constant pressure boundary condition of 1300 psia is applied at the outlet all other boundaries are no flow boundaries co2 and water fluid properties are taken at 50 c and 1300 psia during drainage 100 co2 is injected during imbibition 100 water is injected a relatively high flow rate 5 ml min during drainage is used to establish enough capillary pressure in the domain and a very low flow rate 0 01 ml min is used during imbibition to reach capillary dominated flow regimes to ensure steady state is reached and to check for persistence of the trapped co2 saturation both drainage and imbibition simulation are run for 50 pvi for the single validation case involving gravity the voxel sizes are increased to 2 dm 2 dm 2 dm so that obvious gravity effects are present a low drainage flow rate 0 1 ml min is used for this case to ensure that the domain capillary gravity equilibrium is established and a higher imbibition flow rate 1 ml min is used to ensure full water sweep of the domain the most important additional simulation input that mrst requires but mp simulator does not is relative permeability for mrst simulations a single set of drainage relative permeability curves is used for the entire domain for the imbibition relative permeability curves we assume that no hysteresis exists in the water relative permeability curve for strongly water wet sandstones ruprecht et al 2014 hysteresis is then only present in the co2 relative permeability curve either the linear or the land trapping model can be used to determine the hysteretic co2 scanning curves the equations for the voxel level relative permeability model are shown in eqs b1 to b4 ruprecht et al 2014 b1 k r w d i s w n w b2 k r n w d 1 s w n n w d b3 k r n w i 1 s w n n w i b4 s w s w s w i 1 s w i s n w r where k r w is the wetting phase water relative permeability k r nw is the nonwetting phase co2 relative permeability superscript and subscript d represents drainage and i represents imbibition eqs b1 to b4 show the commonly used power model relative permeability for both drainage and imbibition eq b4 calculates the imbibition effective water saturation s w where the s nw r value can be obtained either from the linear trapping relationship eq 8 or the land trapping relationship eq 12 the illustration of the voxel level relative permeability curves is shown in fig b1 table b1 shows all the additional input parameter values used in the fluid model in mrst simulations note that when the flow rate is low and the flow regime is strongly capillary dominated the exact shape of the relative permeability does not significantly impact the final equilibrium saturation field as long as the endpoints are the same we have varied both the water and the co2 relative permeability coefficients from 2 to 5 during mrst imbibition simulations the resulting mrst domain average residual co2 saturation values differ by 0 01 or less when compared to the corresponding mp values one last simulation decision that deserves extra attention is the choice of whether to have hysteresis in only the capillary pressure curves only the relative permeability curves or both when hysteresis is present only in capillary pressure because co2 is always mobile according to the relative permeability curves eventually when steady state is reached during imbibition after many pvi all co2 saturation goes to 0 with no residual trapping at all when hysteresis is present only in relative permeability because co2 remains mobile until each voxel reaches the residual saturation saturation of the entire domain always goes down to exactly the voxel level residual co2 saturation amount with no extra capillary heterogeneity trapping hence the desired case that most accurately represents the actual fluid physics in reality would be to have hysteresis present in both capillary pressure and relative permeability and this is the case we run in mrst imbibition simulation to validate mp simulation results in this study b 2 mrst validation results ten different validation cases are simulated and the mp simulation results are compared with the corresponding mrst simulation results here all simulation results for the validation cases are shown in figs b2 and b3 the numerical values for the validation results can be found in supplementary material in general the mp simulation runs 10 to 100 times faster than the equivalent mrst simulation mrst needs to take small time steps when the domain degree of heterogeneity is high or when the injection flow rate is low and runs especially slowly under these circumstances as a result sometimes if the property field is extremely heterogeneous and discontinuous when combined with a low flow rate mrst s solver cannot converge no matter how much the time steps are cut from fig b2 and fig b3 it can be seen that the degree of match between the mp and the mrst simulation results is very good the mp and mrst simulated saturation maps appear highly similar except the cases where capillary gradients can be seen particularly in the mrst post drainage results such as cases 1 and 2 the mismatch in domain average co2 saturation is at 0 01 or less for all cases for both drainage and imbibition results from the scatter plots of the voxel level co2 saturation values in figs b2 and b3 we can see that cases 1 to 5 have almost perfect matches for both drainage and imbibition for cases 6 to 10 while the vast majority of the voxels do match up well the mp simulator tends to overestimate the co2 saturation at the end of drainage for a small portion of the voxels at the outlet because the mp simulator does not simulate the capillary end effects that are present in the mrst results during drainage as a consequence of the good match in the co2 saturation fields the estimated value for the domain effective linear trapping coefficient ad from mp simulation is within 0 01 of the mrst values for all validation cases from the results for cases 1 and 2 in fig b2 we can see the effect of varying the value of ps on homogeneous domains because there is no heterogeneity present in the domain the overall post imbibition co2 residual trapping amount remains the same with no extra capillary heterogeneity trapping achieved however as the degree of mesoscale heterogeneity increases when ps is nonzero a significant amount of capillary heterogeneity trapping can be obtained as can be seen by comparing the results for cases 2 3 and 4 
251,an adaptive scheme for the sequential formulation of reactive transport involving two fluid phases is presented instead of solving the transport problem on the global fine scale model we decompose the domain into coarse gridblocks that are aggregates of fine gridblocks and we define and solve transport problem on each of the coarse blocks the details of the prolongation operator that allows for accurate reconstruction of the fine scale solution within a coarse gridblock are described the prolongation operator is independent of the details of the chemical reactions involving the particular component being transported and does not interfere with the chemical module providing flexibility of implementation and applicability to a wide range of conditions test cases include applications of the adaptive strategy for chains of homogeneous decay reactions as well heterogeneous reactions that involve changes in porosity and the reactive surface area with variable time step size and changes in operational conditions keywords reactive transport adaptive multiscale sequential multiphase flow 1 introduction the occurrence of chemical reactions between fluid and solid phases in subsurface porous media affects a wide variety of processes such as carbon dioxide storage contaminant transport and enhanced oil recovery numerical reservoir simulators are used to model reactive transport and quantify the impact of chemical reactions on the flow dynamics in the subsurface reservoir simulation for multiphase reactive transport problems involve the solution of coupled nonlinear equations and associated constraints for such problems the fully implicit method fim is considered a robust approach fan et al 2012 however the computational cost of fim can become prohibitive for highly detailed reservoir models with large numbers of reactive components moreover fim numerical solutions are associated with significant numerical dispersion and that can severely impact the quality of the predictions for many important reactive transport applications boso et al 2013 sequential strategies based on operator splitting of transport and reactive terms are an alternative to the fim and are the most commonly used approach to model reactive transport problems in the subsurface steefel et al 2015 in reservoir simulation problems high resolution descriptions of the porous medium are needed to accurately represent fluid flow in the subsurface this is a consequence of multiscale heterogeneity of formation properties especially the porosity and permeability to overcome the difficulties associated with the fim sequential methods such as implicit pressure explicit saturation composition impes impec coats et al 2000 and sequential implicit watts et al 1986 can be employed although they suffer from stability limitations the sequential schemes handle flow and transport separately and this reduces the size of the systems of equations that need to be solved and allows for the use of specialized solvers and discretization schemes jiang and tchelepi 2019 importantly sequential schemes allow the use of high order approximations to solve the transport equations reducing the impact of numerical dispersion on the solutions multiscale methods have been developed by the reservoir simulation community to efficiently model the impact of the spatial heterogeneity of the properties on the flow and transport dynamics jenny et al 2003 møyner and lie 2016 the multiscale finite volume method msfv was developed by jenny et al 2003 to reduce the computational cost related to the solution of elliptic problems that arise in reservoir simulation tchelepi et al 2007 introduced a framework for reservoir simulation using msfv and a sequential solution of flow and transport equations that employs adaptive computations to reduce the computational cost associated with the solution of the flow problem lee et al 2009 zhou 2010 zhou et al 2012 developed a multiscale formulation for the hyperbolic saturation equation that reduces the computational costs of solving the transport equations and further improve the overall computational efficiency of simulating coupled flow and transport the most significant challenges in the field of reactive transport problems are related to the wide range of spatial and temporal length scales that need to be modeled accurately steefel 2019 in this work we address the challenge of improving the spatial resolution of the numerical solutions of reactive transport in heterogeneous subsurface formations an adaptive scheme for the sequential formulation of reactive transport involving one and two fluid phases is presented the proposed scheme is inspired in the ideas presented by lee et al 2009 that developed an adaptive formulation for the nonlinear saturation equations by recognizing that behind the leading displacement front the saturation increases slowly the application of this idea to reactive transport problems presents additional difficulties because the components involved in different chemical reactions can have very different behaviors to overcome these difficulties we explore the modularity of flow transport and chemical reactions in a sequential solution approach to develop an adaptive strategy that operates exclusively on the transport step in such a way that it does not interfere with the chemical module of the simulator providing wide flexibility of implementation and an accurate representation of the different behaviors that can arise in reactive transport problems the developed scheme is quite general and should apply to a wide range of conditions 2 governing equations and discrete formulation at the darcy scale the conservation equation for fluid component c in a system with n p phases and n r reactions is given by 1 t ϕ p 1 n p ρ p s p x c p p 1 n p f c p c o n v f c p d i s p r 1 n r ν c r r r p 1 n p m c p where f c p are the advective and dispersive fluxes of component c in phase p which are given by 2a f c p c o n v ρ p x c p u p 2b f c p d i s p ϕ ρ p s p d c p x c p in eqs 1 and 2 the subscript p refers to a phase the subscript c to a component and the subscript r to a reaction ϕ is porosity ρ is density s is saturation x c p is the molality of component c in phase p m o l s c k g p d is the dispersion tensor m represents source sink terms due to the presence of wells ν c r is the stoichiometric coefficient of component c in reaction r and r is the reaction rate we take r positive if component c is formed by the chemical reaction r and negative otherwise for m positive values denote injection and negative ones indicate production in this work we restrict our attention to the case of incompressible two phase immiscible flow of oil and water with no gravitational and capillary effects furthermore we consider that the reactive components exist only in the water phase and that they do not affect the water phase density and viscosity even though the rock is considered to be incompressible the occurrence of heterogeneous chemical reactions may induce changes in porosity due to solid dissolution with these assumptions the mass balances for the oil water and reactive component c become 3 ρ o ϕ s o t ρ o f o u t m o 4 ρ w ϕ s w t ρ w f w u t m w 5 ρ w ϕ s w x c t ρ w f w x c u t ρ w ϕ s w d c x c r 1 n r ν c r r r m c w where d c is the dispersion tensor of component c in the water phase and u t is the total velocity given by darcy s law 6 u t k λ t p where k is the heterogeneous permeability p is pressure and λ t the total mobility given by 7 λ t λ o λ w the phase mobilities are given by 8 λ p k r p μ p where k r p is the relative permeability of phase p μ is the viscosity the fractional flow of phase p is 9 f p λ p λ t the 1 st term on the right hand side of eq 5 accounts for chemical reactions in this work we restrict our attention to irreversible kinetically limited reactions the rates of homogeneous reactions are expressed as 10 r r h o m ϕ ρ w s w ω r c x c α c r where ω is the kinetic rate constant and α c r is the exponential dependence of reaction r on the molality of component c α c r is usually given by the stoichiometric constants in the reaction similarly the rates of heterogeneous reactions are expressed as 11 r r h e t a s ρ w s w ω r c x c α c r where a s is the reactive surface area m s o l i d 2 m b u l k 3 the occurrence of a direct relationship between water saturation and heterogeneous reaction rates as seen in eq 11 depends on rock fluid properties such as wettability as discussed by nishiyama and yokoyama 2013 the reaction rates expressed by eqs 10 and 11 are given in units of m o l s m b u l k 3 s changes in porosity caused by heterogeneous reactions induce changes in the reactive surface area and the absolute permeability here we assume the rock is composed of a single mineral that is dissolved estimating how the reactive surface area evolves is a major source on uncertainty nevertheless it is a common practice to adopt models that allow for the variation of the reactive surface area leal et al 2015 in this work we consider that the reactive surface area changes with dissolution according to steefel 2009 12 a s a s o ϕ ϕ o 1 ϕ 1 ϕ o 2 3 where the superscript o denotes the initial time changes in permeability are related to changes in porosity by the kozeny carman equation used here in a form given by korrani et al 2015 13 k k o ϕ ϕ o 3 1 ϕ o 1 ϕ 2 2 1 sequential solution and discretization equations 3 and 4 involve strong nonlinearities in the advective transport term that are subject of ongoing research in the reservoir engineering community the mass balance for water soluble reactive components eq 5 involves advective and dispersive terms that are linear with respect to x c while the reactive term is nonlinear and adds to the stiffness of the system of equations most of the methods for coupling transport and reactions were initially developed considering single phase fluid flow multiphase reactive transport simulation inherits the complexity of both problems and thus should take advantage of the accumulated knowledge in the reservoir simulation and reactive transport disciplines sin and corvisier 2019 sequential solution strategies based on the operator splitting approach are particularly well suited for combining advances in different disciplines in this section we present a sequential strategy that combines the use of impes impec and the operator splitting approach to tackle the coupled problem given by eqs 3 4 and 5 multiplying eq 4 by ρ o ρ w summing the result to eq 3 taking into account that s w s o 1 and that the rock is incompressible and using darcy s law for u t we obtain the pressure equation 14 k λ t p q t where q t is the total volumetric flowrate per unit volume due to the wells for cell i the finite volume discretization of eq 14 considering two point flux approximation tpfa for the flux term becomes 15 j λ t i j t i j p j p i q t i where single point upstream weighting is used for the phase mobilities 16 λ p i j λ p i if p i p j λ p j else in eq 15 j indicates summation over all connections between gridblock i and its neighboring gridblocks j q t i is the total volumetric flow rate due to wells in gridblock i and t i j is the static component of the transmissibility between cells i and j as defined by aziz and settari 1979 after solving eq 14 implicitly to obtain the pressure distribution and the total velocity u t the water saturation is updated explicitly 17 s n 1 s n δ t ϕ n f w u t f w q t n where the subscript in s w is omitted from now on and the superscripts n 1 and n refer to the current and previous time steps and δ t is the time step size the reactive component mass balance eq 5 is solved using the sequential non iterative operator splitting approach steefel and macquarrie 1996 with this the transport and reaction equations are solved in sequence within a single time step with no iteration as follows 18 x c t r a n s p s n s n 1 x c n δ t ϕ n s n 1 f w x c u t ϕ s d c x c f w x c q t n 19 x c n 1 x c t r a n s p δ t ϕ n ρ w s n 1 r 1 n r ν c r r r t r a n s p where the superscript t r a n s p refers to the concentrations after the transport step in the operator splitting approach for the advective term in eqs 17 and 18 the evaluation of f w and x c at the interfaces uses single point upstream weighting similar to the treatment given for phase mobilities in eq 16 for the dispersive term in eq 18 we use second order central differences and the evaluation of the product ϕ s d c at the interfaces is done by averaging the left and right states the reaction rates of homogeneous and heterogeneous reactions are computed considering the concentrations after the transport step as follows 20 r r t r a n s p h o m ϕ n ρ w s n 1 ω r c x c α c r t r a n s p 21 r r t r a n s p h e t a s n ρ w s n 1 ω r c x c α c r t r a n s p note that in the explicit updates done in eqs 17 18 and 19 the porosity and the reactive surface areas are held constant for any one time step following steefel 2009 that justifies this approach because normally the porosity evolves much slower than the solute concentrations after solving eq 19 the porosity is updated 22 ϕ i n 1 ϕ i n 1 ρ min δ t r het reac ν min r r r i t r a n s p mineral consumed where the summation is over the heterogeneous reactions ρ min is the molar density of the mineral being dissolved precipitated and ν min r is the stoichiometric coefficient of the mineral in heterogeneous reaction r for simplicity we adopted forward euler time discretization for the reactive step peszynska and sun 2002 due to the stiffness of systems of odes involving chemical reactions the use of implicit methods is most common we note that the prolongation operator for reactive transport presented ahead that is the main contribution of this work does not rely on this explicit update of the systems of odes and the extension to implicit treatments or advanced chemical solvers to perform the reaction step is straight forward sequential solution strategies are widely used to solve reactive transport problems steefel et al 2015 they are easy to implement and allow for the use of specialized schemes for solving the transport and reaction operators this is a major advantage of operator splitting approaches over fully implicit approaches steefel and macquarrie 1996 however it should be pointed out that for certain applications such as simulations of water rock interactions over very large time scales farshidi 2016 the sequential non iterative approach might require prohibitively small time steps to obtain accurate solutions and can be outperformed by fully implicit approaches fahs et al 2008 due to the explicit treatment of the saturation and compositions the solution has conditional stability and to keep the solution stable the maximum cfl number should be smaller than one in all gridblocks additional limitations in time step size exist due to the sequential non iterative approach valocchi and malmstead 1992 which are necessary to ensure accuracy of information transfer between the operators sin and corvisier 2019 and control mass balance errors that increase with the time step size 3 adaptive transport computations in this section we present the formulation of a coarse scale operator for transport under reactive transport conditions the idea is to combine solving the transport problem at a scale that is significantly coarser than the reference fine grid with a local solve with a coarse cell that yields accurate fine scale transport results thus we avoid solving the transport problems on the global fine scale model ω specifically we operate on each coarse block a represented in fig 1 with a coarsening ratio of five in each direction additionally we consider a coarse scale domain ω that will be used in the adaptive transport computations before introducing the adaptive transport scheme for the reactive components we recap the adaptive transport operator for the saturation equation lee et al 2009 3 1 adaptive computation of saturation inspired by the buckley leverett saturation profile represented in fig 2 lee et al 2009 proposed an adaptive transport strategy for the nonlinear saturation equation that divides the coarse scale domain ω into three different regions ω 1 unperturbed region lies ahead of the water front where there has been no appreciable water breakthrough for coarse blocks in this region there is no need to solve the local transport problem ω 2 front region lies at or near the water front for this region the solution for the transport problem is obtained by solving eq 17 locally at the fine scale ω 3 rarefaction region lies behind the water front where the saturation distribution changes smoothly for coarse blocks in this region the transport problem is solved at the coarse scale and a prolongation operator projects the coarse scale solution back to the fine scale allowing fine scale results to be obtained without effectively solving the fine scale equations for the rarefaction region where the transport problem is solved at the coarse scale we construct a prolongation operator as follows we express the change in the water saturation s over a time step in a fine cell a as a fraction of the change in the corresponding coarse cell a saturation s 23 p a a n s a n s a n 1 s a n s a n 1 for ω a ω a where the superscripts n refer to the time step to maintain mass conservation on the coarse and fine scale domains the coarse scale saturation is defined as the volume weighted average for each coarse cell 24 s a 1 v a ω a ω a v a s a where v denotes the pore volume if the saturations change slowly we can use the prolongation operator to reconstruct the fine scale saturations based on the coarse scale quantities 25 s a n 1 s a n p a a n s a n 1 s a n for ω a ω a where the saturation at the coarse scale of the new time step n 1 is obtained by solving the transport problem eq 17 at the coarse scale 26 s n 1 s n δ t ϕ n f w u t f w q t n with the coarse scale velocity and fractional flow between coarse cells i and j obtained by integrating the fine scale fluxes over the boundaries of the coarse cell ω 27 u i j l ω i j u l 28 f w i j 1 u i j l ω i j f w l u l note that to solve the transport problem at the coarse scale no upscaled quantities such as permeability are required because the fluxes are all obtained from the fine scale results this is an important feature that differentiates multiscale methods from upscaling techniques in multiscale methods even though the solution of global fine scale equations is avoided in favor of solving smaller systems that are either coarse or local in nature the actual computations use fine scale quantities this translates into the higher accuracy provided by multiscale techniques when compared to upscaling up to this point the adaptive strategy to solve the saturation equation presented in this work follows the developments of lee et al 2009 and zhou et al 2012 the only difference is that here we do not employ the coarse scale operator that interpolates velocities from the coarse to the fine scale because the operator in question is strongly connected to the multiscale solution for the flow pressure and total velocity problem that is not addressed in this work identifying the different regions of the domain we propose a few changes to the original strategy and the criteria to choose among the different regions are as follows the original algorithm lee et al 2009 first computes the coarse scale saturations at time step n 1 and then uses s n 1 to define the location of the regions for an explicit solution of the transport problems this strategy does not allow the algorithm to take advantage of adaptivity to take larger time steps as to evolve the saturations from n to n 1 the time step size needs to be defined before the regions of the domain are established here we define the regions of the domain for time step n 1 based only on the saturations at time step n which allows us to take larger time steps as will be seen in section 4 2 2 at time step n 1 the unperturbed region ω 1 is detected by the following condition 29 max s a a n s w i δ s u n p e r t u r b e d where s w i is the irreducible water saturation and δ s u n p e r t u r b e d represents a change in saturation below which we consider the region to be unperturbed this criterion provides robust results and is directly connected to known physical quantities also it does not recognize regions behind the front with very small changes in saturation to be part of the unperturbed region the rarefaction region ω 3 is detected by the following conditions 30a m i n s a a n s r a r e f for ω a ω a 30b s a n s a n 1 30c u l n u l n 1 u l n ϵ v e l l ω a 30d δ p max max p a a n p a a n 1 ϵ s a t for ω a ω a in eq 30a s r a r e f represents some saturation above the saturation of the shock described by the buckley leverett theory to avoid the need to define s r a r e f individually for each set of relative permeabilities and fluid viscosities it can be connected to known quantities related to the fractional flow curve see fig 3 as follows 31 s r a r e f s s h o c k ϵ r a r e f δ s max where s s h o c k is the saturation of the shock wave that propagates in a 1d buckley leverett displacement and δ s max 1 s o r s s h o c k is the maximum increase in water saturation above the shock saturation with s o r representing the residual oil saturation ϵ r a r e f is a user specified value between 0 and 1 the higher the value of ϵ r a r e f the smaller will be the prevalence of the rarefaction region the condition given by eq 30a guarantees that eq 25 will be applied only to regions where the saturations have already evolved to a value above the saturation of the shock the condition given by eq 30b guarantees the prolongation operator will only be applied to regions where saturation is increasing with time the condition of eq 30c limits the maximum relative changes in velocity that can occur between two time steps in order to use eq 25 to avoid severe loss of accuracy when eq 25 is applied the condition given in eq 30d must be honored it states that the change in the prolongation operator between the two previous time steps should be smaller than a given threshold this threshold is closely related to the error that will be introduced by using eq 25 at each time step parts of the domain that do not honor either eqs 29 or 30 are tagged as being part of the front region ω 2 after the three regions are defined the front region is expanded to include all neighboring unperturbed coarse blocks since we define the regions at time step n 1 based on the saturations at time step n this step is needed to ensure that no breakthrough will occur in coarse cells defined to be part of the unperturbed region 3 2 adaptive transport for the reacting components in the last section the adaptive strategy developed by lee et al 2009 and zhou et al 2012 to reduce the computational time for the nonlinear saturation equations was presented here we want to achieve the same goal for the reactive components in order to keep the transport and reactive computational modules as independent as possible such strategy must not affect the computations related to the system of odes that arise in the reactive step of the operator splitting approach this allows for flexibility and ease of implementation when coupling the different modules of a reactive transport simulator the additional challenge lies not on the transport itself as the transport operator is linear with respect to the concentrations instead the difficulties are related to the nonlinearities and coupling introduced by the reactive terms on eq 5 for reactive systems we can not anticipate an expected behavior of the concentration as was done in fig 2 for the saturation problem indeed the behavior of the concentrations behind the front varies significantly depending on the reactions involved and non monotonic concentration profiles may be found behind the front as will be seen ahead to preserve the modularity of the transport and reaction computations with the adaptive strategy we take advantage of the sequential solution of transport and reactions to develop a prolongation operator that operates at the coarse scale ω only on the transport term this keeps the reactive step of the solution untouched meaning that all the nonlinearities and coupling involved in the reactive term are still treated at the fine scale ω similarly to the treatment of the saturation equation we divide the coarse scale domain ω into three regions since we have n c mass balance equations for the reactive components and each component has its own concentration distribution we divide the domain individually for each component the regions to be defined are similar to the ones defined for the saturation problem ω 1 unperturbed region lies ahead of the reactive front where there has been no appreciable perturbation of the initial concentrations for coarse blocks in this region there is no need to solve the local transport problem ω 2 front region lies at or near the reactive front where concentrations changes quickly in time for this region the solution for the transport problem is obtained by solving eq 18 locally at the fine scale ω 3 creeping region lies behind the reactive front where the concentrations change in time are small for coarse blocks in this region the transport step is solved at the coarse scale and a prolongation operator projects the coarse scale solution back to the fine scale field scale displacements are usually characterized by advection dominated flows orr et al 2007 with high peclet numbers under these conditions the different regions can be identified and the adaptive scheme applied for dispersion dominated flows the breakdown of the domain in these three regions is not possible and the adaptive scheme is not applicable for each component c we define the ratio between the changes in concentration x c that occur during a transport step in fine cell a over the changes that happen in the corresponding coarse cell a as follows 32 t a a n x a t r a n s p n x a n 1 x a t r a n s p n x a n 1 for ω a ω a where the subscript c is dropped to simplify notation the coarse scale concentrations are given by 33 x a 1 v a ω a ω a v a x a in the creeping region we use the prolongation operator t defined above to reconstruct the fine scale concentrations after computing the coarse scale concentrations 34 x a t r a n s p n 1 x a n t a a n x a t r a n s p n 1 x a n for ω a ω a where the concentrations at the coarse scale after applying the transport operator at the new time step n 1 are obtained by solving the transport problem eq 18 at the coarse scale as follows 35 with the advective and dispersive fluxes of the reactive component between cells i and j obtained by integrating the fine scale fluxes over the borders of the coarse grid ω 36a f w x i j 1 u i j l ω i j f w l x l u l 36b ϕ s d x l ω i j ϕ s d x l identifying the different regions of the domain the identification of the different regions for each component is done similarly to the saturation equation as follows at time step n 1 the unperturbed region ω 1 is detected by 37 max x a a n x i n i t δ x u n p e r t for every reactive component where x i n i t is the initial concentration and δ x u n p e r t is a user specified threshold that represents the maximum allowable change in concentration for a gridblock to be assigned to the unperturbed region the creeping region at time step n 1 ω 3 is detected by the condition given by eq 30c and 38a δ t max max t a a n t a a n 1 ϵ r e a c 38b min t a a n 0 where eq 38a bears a very close relation to the condition given by eq 30d and the additional constraint given by eq 38b avoids the use of negative values of the prolongation operator 3 3 time step size due to the explicit treatment of the saturations and concentrations the numerical solution is conditionally stable to compute the time step size incoming fluxes are considered to compute the cfl number for each gridblock 39 c f l δ t v p i n l e t f i n l e t n q i n l e t n where f 1 for the reactive components and f f w for the saturation equation additionally the maximum time step size should also account for limitations related to the dispersive term 40 δ t i 1 n d i m δ i 2 2 d where d is the dispersion coefficient n d i m is the number of dimensions and δ i is the gridblock size in coordinate direction i due to the explicit time discretization the δ t limit given by eq 40 can be severely restrictive in cases with strong dispersive effects nevertheless for convective dominated flows with large peclet numbers that we are interested in the restriction in timestep size given by eq 39 will usually prevail for gridblocks in the rarefaction and creeping regions the transport computations take place at the coarse scale and the step size restrictions are computed at the coarse level relaxing the requirements for stability due to the larger cell volume at each time step δ t is chosen based on the most restrictive gridblock and applied through the whole domain 4 numerical results in this section we explore the acccuracy and behavior of the adaptive scheme for reactive transport the adaptive scheme is compared with reference results obtained by solving the transport problems globally at the fine scale to allow for a direct analysis of the errors introduced by the adaptive transport scheme the underlying pressure and velocity fields are obtained by solving the pressure equation at the fine scale without the use of multiscale approximation to the flow problem we note that due to the modularity of flow and transport in the sequential scheme the combination of a multiscale approximation to the pressure field and the adaptive scheme for reactive transport is straightforward but not explored in this work the systems considered have unit length in all coordinate directions with isotropic permeability distributions and a uniform initial porosity of 20 in the adaptive transport algorithm all the cases consider a coarsening ratio of five in each direction δ x u n p e r t δ s u n p e r t 10 9 ϵ r a r e f 0 2 and ϵ v e l 0 1 unless otherwise noted ϵ r e a c and ϵ s a t are 10 5 and 10 4 respectively we note that the choices of δ x u n p e r t and δ s u n p e r t are extremely conservative and looser thresholds could be used safely we opted for such a small value in order to avoid sources of errors other than the use of the prolongation operator to interfere in the error analysis all results consider a maximum cfl number of 0 7 and unless otherwise noted time step sizes are fixed to avoid the impact of time discretization on the error analysis the combined effects of reaction and flow rates can be expressed through the damköhler number that relates the time scale of advection and time scale of the chemical reactions for the homogeneous and heterogeneous reactions the damköhler number is defined as 41 d a h o m ω l x v 42 d a h e t a s o ω l x ϕ o v where v is the average interstitial velocity l x is the length of the domain in the x direction and the superscript o denotes initial conditions we consider a constant injection rate q i n j 0 2 m 3 d of water containing reactive components production is done at fixed pressure although not relevant for the dynamics of the problem as we express the results in terms of the damköhler number q i n j needs to be informed in order to fully specify the production rates of reactive components in the results that will be presented in the examples that follow dispersive fluxes are only considered in section 4 2 3 4 1 single phase flow and homogeneous reactions this case considers three reactive components c 1 c 2 and c 3 that participate on the following first order irreversible decay reactions 43a c 1 c 2 43b c 2 c 3 43c c 1 c 3 the exponential dependence of the reactions α are given by the stoichiometric coefficients of the reactants involved in each of the reactions that are all of first order initially the system contains none of the components and the injected water contains component c 1 with a concentration of 1 mol kg 1 this system of decay reactions is hypothetical and it was intentionally chosen because it leads to concentration distributions that are markedly different for components c 1 c 2 and c 3 including non monotonic concentration distributions for component c 2 behind the reactive front with this in a single test case we can verify the capability of the prolongation operator described in section 3 2 to tackle complicated nonlinear reactive flow problems involving several coupled reactive components with different behaviors 4 1 1 one dimensional problem here we consider a one dimensional domain with 200 gridblocks the damköhler numbers of the reactions given by eqs 43a to 43c are 2 10 and 2 respectively fig 4 presents the concentration profiles at 0 7 pore volumes injected pvi for c 1 c 2 and c 3 obtained with the reference and adaptive solutions from which it can be seen that the adaptive transport computations reproduce the reference solution remarkably well the analysis of the data in fig 4 also reveals that behind the reactive front components c 1 and c 3 have monotonic behaviors from left to right c 1 concentration monotonically decreases and c 3 concentration monotonically increases component c 2 has a non monotonic behavior behind the front at this point it is relevant to analyze the behavior of the prolongation operator given by eq 32 fig 5 presents the concentration of c 2 as well as t at 0 8 pvi obtained with the adaptive scheme it can be seen that in the creeping region shaded in red t has different behaviors for positions to the left of the peak in concentration t reduces from left to right inside a single coarse cell and the changes in t are larger near the peak in concentration to the right of the peak in concentration t changes it s behavior and increases from left to right inside each coarse cell and the changes in t get smaller at positions farther away from the peak further ahead of the peak in concentration the behavior of t changes again and starts decreasing from left to right inside each coarse cell these different behaviors of t did not prevent an accurate reconstruction of fine scale concentrations as seen in fig 4 this is an important result as it shows that the single adaptive strategy proposed does not require the behavior of the concentration profile to be known a priori making it applicable to different reactive systems and avoiding the need to develop prolongation operators that are specifically designed for a given reactive component fig 5 also shows that the prolongation operator reaches values close to 0 near the concentration peak depending on system properties negative values can be obtained and this would violate the condition given by eq 38b a situation more likely to occur in heterogeneous reservoirs 4 1 2 heterogeneous reservoirs in this section we consider the permeability distribution shown in fig 6 where x and y directions are discretized in 120 gridblocks leading to a total of 14 400 gridblocks the damköhler numbers of the reactions given by eqs 43a to 43c are 1 5 and 0 5 respectively to illustrate the accuracy and behavior of the algorithm fig 7 shows a comparison of the concentration of c 3 given by the reference and adaptive solutions at 1 2 and 3 pvi as well as the distribution of the regions of the domain and the absolute error at each point in space it can be noted that the adaptive algorithm accurately represents the reference results and that the evolution of the regions of the domain with time is correlated to the more permeable regions of the reservoir important to note that at 2 and 3 pvi approximately 50 and 80 of the transport computations are done at the coarse scale fig 8 presents the production rates for c 1 c 2 and c 3 the reference and adaptive solution results are in excellent agreement throughout the whole simulation time fig 9 a presents the fraction of the global domain that are defined as unperturbed front and creeping regions for c 2 as a function of time it can be seen that the regions of the domain change smoothly and with minor oscillations also the fraction of the domain assigned to unperturbed region decreases with time and the opposite happens for the creeping region as expected indicating that the identification of the regions is occurring in a satisfactory manner fig 9 b presents the fraction of the domain that is assigned to the creeping region for different values of ϵ r e a c as expected the tighter the value of ϵ r e a c the smaller will be the fraction of the domain assigned to the creeping region it is also relevant to note the high fractions of the domain that are assigned to the creeping region for large times that translates to significant savings in computational costs by using the adaptive formulation fig 10 a and b show the relation between the infinity norm of the error e i n f and ϵ r e a c for the 1d and 2d cases respectively it can be seen that there is a linear relation with slope 1 for all components this is an important result that indicates that the errors that come from the adaptive solution are directly related to the parameter ϵ r e a c that is specified by the user it can also be noted that the higher the heterogeneity the larger the errors are for the same value of ϵ r e a c but nonetheless the adaptive threshold ϵ r e a c still has a direct control on the errors incurred by use of the adaptive formulation even for highly heterogeneous cases the results shown in this section did not explicitly account for dispersive effects which will be done in section 4 2 but it is important to point that due to the significant numerical dispersion introduced by single point upwinding similar results are expected when dispersive effects are present but advective forces are still dominant even though the results presented for homogeneous decay type reactions are encouraging it must be pointed out that the evolution of these reactive systems is directly related to the fluid residence time and such systems achieve a steady distribution of concentrations behind the front thus it can be argued that the prolongation operator is being responsible only for keeping the correct steady concentrations behind the front to show that the prolongation operator is also able to accurately perform transport computations in situations where a steady state is not achieved we apply next the adaptive formulation for heterogeneous chemical reactions 4 2 two phase flow and heterogeneous reactions we consider quadratic corey type relative permeability curves for both oil and water 44 k r w k r w max s w s w i 1 s w i s o r 2 45 k r o k r o max 1 s w s o r 1 s w i s o r 2 with s w i 0 2 s o r 0 2 k r w max 1 and k r o max 1 the mobility ratio is defined as 46 m k r w max μ w k r o max μ o where μ w and μ o are water and oil viscosities in addition to the nonlinearities introduced by two phase flow this case also considers the dissolution of the porous medium by a chemical reactant c 1 that is injected in the domain with a concentration of 1 mol kg the dissolution induces changes in porosity permeability and reactive surface area although more complex chemical models exist to represent solid dissolution sanford and konikow 1989 we follow a simplified approach that considers the heterogeneous dissolution reaction to be an irreversible first order reaction with respect to the concentration of c 1 molins et al 2020 esteves et al 2020 47 r r het a s ρ w s w ω r x c 1 the damköhler number is 1 and the mineral density is 27 080 mol m 3 reference values for calcite and it is considered that each mol of c 1 that reacts dissolves 1 mol of the rock matrix before proceeding to the analysis of reactive transport we analyze the behavior of the adaptive strategy for the saturation equation in a 1d setting 4 2 1 one dimensional problem for the saturation equation fig 11 presents the saturation profiles at 1 0 and 3 0 pvis obtained with the reference and adaptive solution with m 1 and the 1d domain discretized in 200 griblocks it can be seen that the errors are small but the adaptive solution for the saturation equation does not reproduce the reference results as accurately as it did for the reactive components in fig 4 this observation is further emphasized by fig 12 that shows the relationship between the error and the adaptivity threshold ϵ s a t for different mobility ratios it can be seen that although there is a clear relationship between the error and ϵ s a t for the saturation equation this relation is weaker than the one observed for ϵ r e a c and the error in concentration of the reactive components for the reactive components a slope of 1 was observed for the saturation equation a slope between 1 4 and 1 2 is observed fig 12 also allows us to draw an important conclusion the adaptivity strategy is less precise for unfavourable mobility ratios and this is expected because of the more pronounced rarefaction in such a way that the saturation changes that are evolved through the prolongation operator are larger the more unfavourable the mobility ratio to understand what causes the larger errors and the weaker control of the adaptivity threshold on the errors of the saturation equation as compared to the reactive components we analyze the behavior of the prolongation operator given by eq 23 in cases that do not make use of the adaptive strategy i e the front region is used in the whole domain fig 13 shows at 0 4 pvi the water saturation p and δ p max eq 30d which represents the maximum change in the prolongation operator between two consecutive time steps in a coarse cell it can be seen that the prolongation operator has the same behavior for all positions in the rarefaction region in contrast to what was observed for the behavior of the prolongation operator in the creeping region of fig 5 this is expected because the saturation has a monotonic behavior it can also be noted that near the injector where the changes in saturation in time are smaller the gradient of the prolongation operator is steeper this behavior poses no problem to the adaptive strategy as the prolongation operator will give accurate reconstruction of fine scale saturations provided the value of the prolongation operator properly relates coarse and fine scale quantities ultimately the source of errors in the adaptive strategy are the changes in the prolongation operator with time that are given by δ p max even though the values of δ p max in the rarefaction region that are shown in fig 13 are on the order of 10 4 they represent the change that happens over a single time step in the span of several time steps the cumulative changes in the prolongation operator may be significant as the adaptive scheme fixes the value of the prolongation operator once a gridblock is defined to be part of the rarefaction region after a significant number of time steps the prolongation operator used by the adaptive strategy can be outdated which leads to the slight inaccuracies observed in fig 11 the observation above points towards an effective way to improve accuracy of the adaptive strategy which is to recompute the prolongation operator in the whole domain with a certain frequency this is a topic for future research another point that deserves attention in fig 13 is that δ p max tends to have larger values for positions well behind the front this may cause problems in the identification of the rarefaction region specifically on the criterion given by eq 30d as regions far behind the front that should be clearly assigned to the rarefaction region might not be so due to this behavior of δ p max the issues described in the two previous paragraphs are smaller the larger the number of gridblocks in the model as can be seen in fig 14 that shows δ p max at 0 4 pvi for models composed of 100 200 400 and 1000 gridblocks fig 14 reveals that the larger the number of gridblocks the smaller will be δ p max thus for larger numbers of gridblocks we can expect smaller errors with the use of the adaptive strategy as well as less occurrence of inadequate identification of regions well behind the front due to large values of δ p max 4 2 2 heterogeneous reservoir with point source wells the changes in rock properties due to dissolution of the solid introduce additional numerical challenges that are particularly relevant for highly heterogeneous reservoirs this is because changes in porosity and permeability affect the flow field making the flow problem dependent on the reactive transport effectively causing a two way coupling between flow and reactive transport to explore the behavior of the adaptive strategy under these conditions we consider a sector comprising 50 50 gridblocks of the permeability field shown in fig 6 the wells are point sources with the injector operating with fixed injection rate on the left bottom corner and the producer operating with fixed pressure at the top right corner figs 15 and 16 present for water saturation and component c 1 respectively the results obtained with reference and adaptive solutions as well as the division of the domain in the different adaptivity regions and the error at 0 5 1 5 and 2 5 pvis the reference and adaptive solution results are in good agreement for all times and significant portions of the domain are assigned to the rarefaction and creeping regions fig 17 presents the porosity for reference and adaptive solutions as well as the error at 0 5 1 5 and 2 5 pvis note that the strongest changes rock properties happen near the injector where coarse scale computations and the prolongation operator are frequently employed the small errors shown in figs 15 16 and 17 show that the adaptive scheme properly represents the more complicated dynamics involved in heterogeneous chemical reactions with alterations in rock properties variable time step size in addition to the gains related to performing the transport computations at the coarse scale adaptive computations also allow for larger time step sizes δ t this is because the regions with higher velocities that limit δ t due to the cfl condition are also the portions of the domain where the coarse scale transport computations are earlier and more often used whenever the adaptive algorithm performs transport computations at the coarse scale in regions that would otherwise limit δ t if the transport computations were performed at the fine scale significant increases in δ t occur to demonstrate this we run the reference and adaptive simulations with variable δ t by respecting the cfl condition at each individual time step fig 18 presents a comparison of the time step sizes taken with reference and adaptive solutions from which we can see that time step sizes up to 25 times larger could be taken with the adaptive scheme fig 19 a compares the water cut and the production rate of c 1 obtained by the reference and adaptive solutions it can be observed that the adaptive solution accurately reproduces the reference solution even in a highly dynamic problem where changes in the flow field are caused by the nonlinearities in the water oil displacement as well as by changes in permeability induced by dissolution the problem also accounts for changes in the reaction rate caused by changes in reactive surface area the excellent behavior of the adaptive strategy in such a complex problem demonstrates its robustness the results shown in fig 19a consider the variable time step sizes shown in fig 18 this shows that the results are converged w r t time step size and also that the mass balance errors introduced by the operator splitting approach valocchi and malmstead 1992 that are related to the time step size are small importantly by taking variable time step sizes the definition of the adaptive regions presents only minor oscillations as can be seen in fig 20 a and b the ability of the algorithm to take variable time step sizes without significant oscillations is an important characteristic as variable time step sizes are the norm rather than the exception for large scale reservoir simulations changes in operational conditions here we explore the behavior of the adaptive strategy when changes in operational condition occur this is done by shutting in the wells at 1 5 pvi and start injecting with a new well on the bottom right corner and producing with a new well on the upper left corner no information is given to the adaptive algorithm about the changes in operational condition but it recognizes the changes by variations in the velocity field that are detected through condition eq 30c fig 19 b compares the water cut and the production rate of c 1 obtained by the reference and adaptive solutions with variable time step sizes where the change in operational conditions at 1 5 pvi and its impacts on production are accurately represented by the adaptive scheme when the change in operational condition happens the velocity field changes and the saturations and concentrations start evolving differently in the domain which causes the adaptive strategy to redefine the regions in such a way that right after the change in operational condition all gridblocks are treated as if they are the front region and after time passes and the changes in saturation and concentration start reaching an asymptotic behavior the fraction of the domain that is assigned to rarefaction and creeping regions increases gradually this behavior can be observed in fig 20 that shows the fraction of each region in the domain for the cases without and with change in operational condition variable time step sizes were used for this result to further illustrate the behavior and accuracy of the adaptive scheme after the change in operational condition fig 21 presents the concentration of c 1 for reference and adaptive solutions as well as the division of the domain in the different adaptivity regions and the error at 1 6 2 0 and 3 0 pvis at 1 6 pvi the concentration field is going through significant changes in the whole domain as a consequence the adaptive scheme solves the transport problem at the fine scale in the whole domain because the use of the prolongation operator in such condition would lead to inaccurate results at 2 and 3 pvi significant parts of the domain undergo coarse scale transport computations and the errors remain small 4 2 3 3d case with dispersive fluxes in this section we consider a three dimensional domain discretized in 100 30 20 gridblocks in the x y and z directions injection occurs from left to right and the permeability distribution consists of a log normal gaussian distribution with average permeability of 100 md shown in fig 22 the peclet number represents the ratio of dispersion and advection time scales and is here defined as p e v l x d where d stands for the isotropic dispersion coefficient that is considered constant throughout the domain in this example we set p e 50 which lies in the lower range of peclet numbers typically found in field scale applications dispersive effects smear the sharp concentration gradients observed in cases without dispersion as can be seen in fig 23 which shows a comparison of the concentrations of c 1 at 0 5 pvi for the cases without and with dispersion obtained with the reference solution this affects the division of the domain in the three different regions as can be seen in fig 24 that shows the fraction of each region in the domain with and without dispersion for short times dispersive effects lead to a larger portion of the domain being subject to strong changes in concentration leading to a smaller prevalence of the unperturbed region and a larger prevalence of the front region this reduces the efficiency of the adaptive scheme as the transport computations of the front region entail the largest computational cost for long times the fraction of the creeping region is larger for the case with dispersion in fact the fraction of the creeping region reaches 100 even though poorly swept regions exist in the domain due to the heterogeneous permeability field thus for large times the efficiency of the adaptive scheme can be increased by dispersive effects the adaptive scheme is able to provide accurate results when dispersive effects are present as can be seen in fig 25 that presents a comparison of the concentration of c 1 for reference and adaptive solutions at 0 5 and 1 5 pvi as well as the errors and the distribution of the domain in the different regions where blue green and red colors indicate unperturbed front and creeping regions respectively errors smaller than 10 6 are not shown and the errors are made transparent to allow for a clear evaluation of the errors through the whole domain accurate results are also obtained for the water saturation as can be seen in fig 26 that presents for s w the same results shown in fig 25 for the concentration of c 1 the number of cell updates required to solve the transport problems provides an estimate of the computational savings obtained with the adaptive scheme for a 3d case with a coarsening ratio of 5 in each direction each coarse cell in the creeping or rarefaction regions requires a number of cell updates that is 125 times smaller than would be required in the reference solution for the unperturbed region no cell update is needed fig 27 shows the number of cell updates required to solve eqs 17 and 18 at each time step normalized by the number of updates required in the reference solution it can be seen that for long times the number of cell updates required by the adaptive scheme is more than an order of magnitude smaller than the number of cell updates required by the reference solution fig 28 compares the water cut and the production rate of c 1 obtained by the reference and adaptive solutions showing that the adaptive scheme remains accurate until the end of the simulation although not presented here this case also accounts for changes in rock properties and the adaptive scheme provided an accurate representation of the changes in porosity permeability and reactive surface area the results presented demonstrate the applicability of the adaptive scheme to solve the advection dispersion reaction equation in heterogeneous 3 dimensional cases with the added complexities related to the non linearities of two phase flow as well as changes in rock properties due to dissolution 5 conclusions we describe the development of an adaptive scheme for reactive transport computations based on sequential solution of flow transport and reactions in heterogeneous porous media the formulation is applied to one and two phase flow problems the adaptive scheme for the solution of the saturation equation previously developed by lee et al 2009 is used to treat the nonlinear saturation equations in this work the original algorithm is modified and different criteria are proposed to identify the adaptivity regions the proposed modifications allow the algorithm to take advantage of adaptivity to take larger time steps with impes impec computations for the components involved in chemical reactions a single prolongation operator that is applicable to components with different behaviors and involved in different chemical reactions is developed this prolongation operator is applied to regions in the domain where the concentrations change slowly with time to not interfere with the computations of the source sink terms related to the chemical reactions the adaptive strategy acts exclusively on the transport step of the operator splitting approach preserving the modularity of transport and reaction computations examples demonstrate that the adaptive strategy does not require previous knowledge about the distribution of the reactive components throughout the domain as it accurately solves the concentrations distribution for chemical components that experience concentration increase decrease and even problems with non monotonic concentration profiles it is shown that for single phase flow user specified thresholds have an excellent control on accuracy the robustness of the algorithm is demonstrated in cases that involve two phase flow in highly heterogeneous permeability distributions in 2 and 3 dimensions with the occurrence of heterogeneous reactions that cause rock dissolution and consequent changes in porosity permeability and reactive surface area in this highly dynamic system where coupling between flow transport and reactions occurs due to the nonlinearities of the saturation equation as well as by the changes in rock properties the adaptive algorithm provides excellent results for both the saturation and the reactive component in both linear and radial displacement problems furthermore it is demonstrated that the adaptive scheme is able to tackle problems with changes in operational conditions the adaptive solution allows larger time steps to be taken in the explicit transport computations as the cfl condition is less severe when the transport computations are performed at the coarse scale significant increases in time step size are obtained with the adaptive algorithm where adaptive computations allowed time step sizes up to 25 larger than the ones taken with the reference solution this further diminishes the computational effort that was already reduced by performing the transport computations at the coarse scale credit authorship contribution statement ricardo h deucher conceptualization investigation methodology software writing original draft writing review editing hamdi a tchelepi conceptualization investigation methodology supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment we thank petrobras petróleo brasileiro s a and the reservoir simulation research consortium at stanford university supri b for supporting this work 
251,an adaptive scheme for the sequential formulation of reactive transport involving two fluid phases is presented instead of solving the transport problem on the global fine scale model we decompose the domain into coarse gridblocks that are aggregates of fine gridblocks and we define and solve transport problem on each of the coarse blocks the details of the prolongation operator that allows for accurate reconstruction of the fine scale solution within a coarse gridblock are described the prolongation operator is independent of the details of the chemical reactions involving the particular component being transported and does not interfere with the chemical module providing flexibility of implementation and applicability to a wide range of conditions test cases include applications of the adaptive strategy for chains of homogeneous decay reactions as well heterogeneous reactions that involve changes in porosity and the reactive surface area with variable time step size and changes in operational conditions keywords reactive transport adaptive multiscale sequential multiphase flow 1 introduction the occurrence of chemical reactions between fluid and solid phases in subsurface porous media affects a wide variety of processes such as carbon dioxide storage contaminant transport and enhanced oil recovery numerical reservoir simulators are used to model reactive transport and quantify the impact of chemical reactions on the flow dynamics in the subsurface reservoir simulation for multiphase reactive transport problems involve the solution of coupled nonlinear equations and associated constraints for such problems the fully implicit method fim is considered a robust approach fan et al 2012 however the computational cost of fim can become prohibitive for highly detailed reservoir models with large numbers of reactive components moreover fim numerical solutions are associated with significant numerical dispersion and that can severely impact the quality of the predictions for many important reactive transport applications boso et al 2013 sequential strategies based on operator splitting of transport and reactive terms are an alternative to the fim and are the most commonly used approach to model reactive transport problems in the subsurface steefel et al 2015 in reservoir simulation problems high resolution descriptions of the porous medium are needed to accurately represent fluid flow in the subsurface this is a consequence of multiscale heterogeneity of formation properties especially the porosity and permeability to overcome the difficulties associated with the fim sequential methods such as implicit pressure explicit saturation composition impes impec coats et al 2000 and sequential implicit watts et al 1986 can be employed although they suffer from stability limitations the sequential schemes handle flow and transport separately and this reduces the size of the systems of equations that need to be solved and allows for the use of specialized solvers and discretization schemes jiang and tchelepi 2019 importantly sequential schemes allow the use of high order approximations to solve the transport equations reducing the impact of numerical dispersion on the solutions multiscale methods have been developed by the reservoir simulation community to efficiently model the impact of the spatial heterogeneity of the properties on the flow and transport dynamics jenny et al 2003 møyner and lie 2016 the multiscale finite volume method msfv was developed by jenny et al 2003 to reduce the computational cost related to the solution of elliptic problems that arise in reservoir simulation tchelepi et al 2007 introduced a framework for reservoir simulation using msfv and a sequential solution of flow and transport equations that employs adaptive computations to reduce the computational cost associated with the solution of the flow problem lee et al 2009 zhou 2010 zhou et al 2012 developed a multiscale formulation for the hyperbolic saturation equation that reduces the computational costs of solving the transport equations and further improve the overall computational efficiency of simulating coupled flow and transport the most significant challenges in the field of reactive transport problems are related to the wide range of spatial and temporal length scales that need to be modeled accurately steefel 2019 in this work we address the challenge of improving the spatial resolution of the numerical solutions of reactive transport in heterogeneous subsurface formations an adaptive scheme for the sequential formulation of reactive transport involving one and two fluid phases is presented the proposed scheme is inspired in the ideas presented by lee et al 2009 that developed an adaptive formulation for the nonlinear saturation equations by recognizing that behind the leading displacement front the saturation increases slowly the application of this idea to reactive transport problems presents additional difficulties because the components involved in different chemical reactions can have very different behaviors to overcome these difficulties we explore the modularity of flow transport and chemical reactions in a sequential solution approach to develop an adaptive strategy that operates exclusively on the transport step in such a way that it does not interfere with the chemical module of the simulator providing wide flexibility of implementation and an accurate representation of the different behaviors that can arise in reactive transport problems the developed scheme is quite general and should apply to a wide range of conditions 2 governing equations and discrete formulation at the darcy scale the conservation equation for fluid component c in a system with n p phases and n r reactions is given by 1 t ϕ p 1 n p ρ p s p x c p p 1 n p f c p c o n v f c p d i s p r 1 n r ν c r r r p 1 n p m c p where f c p are the advective and dispersive fluxes of component c in phase p which are given by 2a f c p c o n v ρ p x c p u p 2b f c p d i s p ϕ ρ p s p d c p x c p in eqs 1 and 2 the subscript p refers to a phase the subscript c to a component and the subscript r to a reaction ϕ is porosity ρ is density s is saturation x c p is the molality of component c in phase p m o l s c k g p d is the dispersion tensor m represents source sink terms due to the presence of wells ν c r is the stoichiometric coefficient of component c in reaction r and r is the reaction rate we take r positive if component c is formed by the chemical reaction r and negative otherwise for m positive values denote injection and negative ones indicate production in this work we restrict our attention to the case of incompressible two phase immiscible flow of oil and water with no gravitational and capillary effects furthermore we consider that the reactive components exist only in the water phase and that they do not affect the water phase density and viscosity even though the rock is considered to be incompressible the occurrence of heterogeneous chemical reactions may induce changes in porosity due to solid dissolution with these assumptions the mass balances for the oil water and reactive component c become 3 ρ o ϕ s o t ρ o f o u t m o 4 ρ w ϕ s w t ρ w f w u t m w 5 ρ w ϕ s w x c t ρ w f w x c u t ρ w ϕ s w d c x c r 1 n r ν c r r r m c w where d c is the dispersion tensor of component c in the water phase and u t is the total velocity given by darcy s law 6 u t k λ t p where k is the heterogeneous permeability p is pressure and λ t the total mobility given by 7 λ t λ o λ w the phase mobilities are given by 8 λ p k r p μ p where k r p is the relative permeability of phase p μ is the viscosity the fractional flow of phase p is 9 f p λ p λ t the 1 st term on the right hand side of eq 5 accounts for chemical reactions in this work we restrict our attention to irreversible kinetically limited reactions the rates of homogeneous reactions are expressed as 10 r r h o m ϕ ρ w s w ω r c x c α c r where ω is the kinetic rate constant and α c r is the exponential dependence of reaction r on the molality of component c α c r is usually given by the stoichiometric constants in the reaction similarly the rates of heterogeneous reactions are expressed as 11 r r h e t a s ρ w s w ω r c x c α c r where a s is the reactive surface area m s o l i d 2 m b u l k 3 the occurrence of a direct relationship between water saturation and heterogeneous reaction rates as seen in eq 11 depends on rock fluid properties such as wettability as discussed by nishiyama and yokoyama 2013 the reaction rates expressed by eqs 10 and 11 are given in units of m o l s m b u l k 3 s changes in porosity caused by heterogeneous reactions induce changes in the reactive surface area and the absolute permeability here we assume the rock is composed of a single mineral that is dissolved estimating how the reactive surface area evolves is a major source on uncertainty nevertheless it is a common practice to adopt models that allow for the variation of the reactive surface area leal et al 2015 in this work we consider that the reactive surface area changes with dissolution according to steefel 2009 12 a s a s o ϕ ϕ o 1 ϕ 1 ϕ o 2 3 where the superscript o denotes the initial time changes in permeability are related to changes in porosity by the kozeny carman equation used here in a form given by korrani et al 2015 13 k k o ϕ ϕ o 3 1 ϕ o 1 ϕ 2 2 1 sequential solution and discretization equations 3 and 4 involve strong nonlinearities in the advective transport term that are subject of ongoing research in the reservoir engineering community the mass balance for water soluble reactive components eq 5 involves advective and dispersive terms that are linear with respect to x c while the reactive term is nonlinear and adds to the stiffness of the system of equations most of the methods for coupling transport and reactions were initially developed considering single phase fluid flow multiphase reactive transport simulation inherits the complexity of both problems and thus should take advantage of the accumulated knowledge in the reservoir simulation and reactive transport disciplines sin and corvisier 2019 sequential solution strategies based on the operator splitting approach are particularly well suited for combining advances in different disciplines in this section we present a sequential strategy that combines the use of impes impec and the operator splitting approach to tackle the coupled problem given by eqs 3 4 and 5 multiplying eq 4 by ρ o ρ w summing the result to eq 3 taking into account that s w s o 1 and that the rock is incompressible and using darcy s law for u t we obtain the pressure equation 14 k λ t p q t where q t is the total volumetric flowrate per unit volume due to the wells for cell i the finite volume discretization of eq 14 considering two point flux approximation tpfa for the flux term becomes 15 j λ t i j t i j p j p i q t i where single point upstream weighting is used for the phase mobilities 16 λ p i j λ p i if p i p j λ p j else in eq 15 j indicates summation over all connections between gridblock i and its neighboring gridblocks j q t i is the total volumetric flow rate due to wells in gridblock i and t i j is the static component of the transmissibility between cells i and j as defined by aziz and settari 1979 after solving eq 14 implicitly to obtain the pressure distribution and the total velocity u t the water saturation is updated explicitly 17 s n 1 s n δ t ϕ n f w u t f w q t n where the subscript in s w is omitted from now on and the superscripts n 1 and n refer to the current and previous time steps and δ t is the time step size the reactive component mass balance eq 5 is solved using the sequential non iterative operator splitting approach steefel and macquarrie 1996 with this the transport and reaction equations are solved in sequence within a single time step with no iteration as follows 18 x c t r a n s p s n s n 1 x c n δ t ϕ n s n 1 f w x c u t ϕ s d c x c f w x c q t n 19 x c n 1 x c t r a n s p δ t ϕ n ρ w s n 1 r 1 n r ν c r r r t r a n s p where the superscript t r a n s p refers to the concentrations after the transport step in the operator splitting approach for the advective term in eqs 17 and 18 the evaluation of f w and x c at the interfaces uses single point upstream weighting similar to the treatment given for phase mobilities in eq 16 for the dispersive term in eq 18 we use second order central differences and the evaluation of the product ϕ s d c at the interfaces is done by averaging the left and right states the reaction rates of homogeneous and heterogeneous reactions are computed considering the concentrations after the transport step as follows 20 r r t r a n s p h o m ϕ n ρ w s n 1 ω r c x c α c r t r a n s p 21 r r t r a n s p h e t a s n ρ w s n 1 ω r c x c α c r t r a n s p note that in the explicit updates done in eqs 17 18 and 19 the porosity and the reactive surface areas are held constant for any one time step following steefel 2009 that justifies this approach because normally the porosity evolves much slower than the solute concentrations after solving eq 19 the porosity is updated 22 ϕ i n 1 ϕ i n 1 ρ min δ t r het reac ν min r r r i t r a n s p mineral consumed where the summation is over the heterogeneous reactions ρ min is the molar density of the mineral being dissolved precipitated and ν min r is the stoichiometric coefficient of the mineral in heterogeneous reaction r for simplicity we adopted forward euler time discretization for the reactive step peszynska and sun 2002 due to the stiffness of systems of odes involving chemical reactions the use of implicit methods is most common we note that the prolongation operator for reactive transport presented ahead that is the main contribution of this work does not rely on this explicit update of the systems of odes and the extension to implicit treatments or advanced chemical solvers to perform the reaction step is straight forward sequential solution strategies are widely used to solve reactive transport problems steefel et al 2015 they are easy to implement and allow for the use of specialized schemes for solving the transport and reaction operators this is a major advantage of operator splitting approaches over fully implicit approaches steefel and macquarrie 1996 however it should be pointed out that for certain applications such as simulations of water rock interactions over very large time scales farshidi 2016 the sequential non iterative approach might require prohibitively small time steps to obtain accurate solutions and can be outperformed by fully implicit approaches fahs et al 2008 due to the explicit treatment of the saturation and compositions the solution has conditional stability and to keep the solution stable the maximum cfl number should be smaller than one in all gridblocks additional limitations in time step size exist due to the sequential non iterative approach valocchi and malmstead 1992 which are necessary to ensure accuracy of information transfer between the operators sin and corvisier 2019 and control mass balance errors that increase with the time step size 3 adaptive transport computations in this section we present the formulation of a coarse scale operator for transport under reactive transport conditions the idea is to combine solving the transport problem at a scale that is significantly coarser than the reference fine grid with a local solve with a coarse cell that yields accurate fine scale transport results thus we avoid solving the transport problems on the global fine scale model ω specifically we operate on each coarse block a represented in fig 1 with a coarsening ratio of five in each direction additionally we consider a coarse scale domain ω that will be used in the adaptive transport computations before introducing the adaptive transport scheme for the reactive components we recap the adaptive transport operator for the saturation equation lee et al 2009 3 1 adaptive computation of saturation inspired by the buckley leverett saturation profile represented in fig 2 lee et al 2009 proposed an adaptive transport strategy for the nonlinear saturation equation that divides the coarse scale domain ω into three different regions ω 1 unperturbed region lies ahead of the water front where there has been no appreciable water breakthrough for coarse blocks in this region there is no need to solve the local transport problem ω 2 front region lies at or near the water front for this region the solution for the transport problem is obtained by solving eq 17 locally at the fine scale ω 3 rarefaction region lies behind the water front where the saturation distribution changes smoothly for coarse blocks in this region the transport problem is solved at the coarse scale and a prolongation operator projects the coarse scale solution back to the fine scale allowing fine scale results to be obtained without effectively solving the fine scale equations for the rarefaction region where the transport problem is solved at the coarse scale we construct a prolongation operator as follows we express the change in the water saturation s over a time step in a fine cell a as a fraction of the change in the corresponding coarse cell a saturation s 23 p a a n s a n s a n 1 s a n s a n 1 for ω a ω a where the superscripts n refer to the time step to maintain mass conservation on the coarse and fine scale domains the coarse scale saturation is defined as the volume weighted average for each coarse cell 24 s a 1 v a ω a ω a v a s a where v denotes the pore volume if the saturations change slowly we can use the prolongation operator to reconstruct the fine scale saturations based on the coarse scale quantities 25 s a n 1 s a n p a a n s a n 1 s a n for ω a ω a where the saturation at the coarse scale of the new time step n 1 is obtained by solving the transport problem eq 17 at the coarse scale 26 s n 1 s n δ t ϕ n f w u t f w q t n with the coarse scale velocity and fractional flow between coarse cells i and j obtained by integrating the fine scale fluxes over the boundaries of the coarse cell ω 27 u i j l ω i j u l 28 f w i j 1 u i j l ω i j f w l u l note that to solve the transport problem at the coarse scale no upscaled quantities such as permeability are required because the fluxes are all obtained from the fine scale results this is an important feature that differentiates multiscale methods from upscaling techniques in multiscale methods even though the solution of global fine scale equations is avoided in favor of solving smaller systems that are either coarse or local in nature the actual computations use fine scale quantities this translates into the higher accuracy provided by multiscale techniques when compared to upscaling up to this point the adaptive strategy to solve the saturation equation presented in this work follows the developments of lee et al 2009 and zhou et al 2012 the only difference is that here we do not employ the coarse scale operator that interpolates velocities from the coarse to the fine scale because the operator in question is strongly connected to the multiscale solution for the flow pressure and total velocity problem that is not addressed in this work identifying the different regions of the domain we propose a few changes to the original strategy and the criteria to choose among the different regions are as follows the original algorithm lee et al 2009 first computes the coarse scale saturations at time step n 1 and then uses s n 1 to define the location of the regions for an explicit solution of the transport problems this strategy does not allow the algorithm to take advantage of adaptivity to take larger time steps as to evolve the saturations from n to n 1 the time step size needs to be defined before the regions of the domain are established here we define the regions of the domain for time step n 1 based only on the saturations at time step n which allows us to take larger time steps as will be seen in section 4 2 2 at time step n 1 the unperturbed region ω 1 is detected by the following condition 29 max s a a n s w i δ s u n p e r t u r b e d where s w i is the irreducible water saturation and δ s u n p e r t u r b e d represents a change in saturation below which we consider the region to be unperturbed this criterion provides robust results and is directly connected to known physical quantities also it does not recognize regions behind the front with very small changes in saturation to be part of the unperturbed region the rarefaction region ω 3 is detected by the following conditions 30a m i n s a a n s r a r e f for ω a ω a 30b s a n s a n 1 30c u l n u l n 1 u l n ϵ v e l l ω a 30d δ p max max p a a n p a a n 1 ϵ s a t for ω a ω a in eq 30a s r a r e f represents some saturation above the saturation of the shock described by the buckley leverett theory to avoid the need to define s r a r e f individually for each set of relative permeabilities and fluid viscosities it can be connected to known quantities related to the fractional flow curve see fig 3 as follows 31 s r a r e f s s h o c k ϵ r a r e f δ s max where s s h o c k is the saturation of the shock wave that propagates in a 1d buckley leverett displacement and δ s max 1 s o r s s h o c k is the maximum increase in water saturation above the shock saturation with s o r representing the residual oil saturation ϵ r a r e f is a user specified value between 0 and 1 the higher the value of ϵ r a r e f the smaller will be the prevalence of the rarefaction region the condition given by eq 30a guarantees that eq 25 will be applied only to regions where the saturations have already evolved to a value above the saturation of the shock the condition given by eq 30b guarantees the prolongation operator will only be applied to regions where saturation is increasing with time the condition of eq 30c limits the maximum relative changes in velocity that can occur between two time steps in order to use eq 25 to avoid severe loss of accuracy when eq 25 is applied the condition given in eq 30d must be honored it states that the change in the prolongation operator between the two previous time steps should be smaller than a given threshold this threshold is closely related to the error that will be introduced by using eq 25 at each time step parts of the domain that do not honor either eqs 29 or 30 are tagged as being part of the front region ω 2 after the three regions are defined the front region is expanded to include all neighboring unperturbed coarse blocks since we define the regions at time step n 1 based on the saturations at time step n this step is needed to ensure that no breakthrough will occur in coarse cells defined to be part of the unperturbed region 3 2 adaptive transport for the reacting components in the last section the adaptive strategy developed by lee et al 2009 and zhou et al 2012 to reduce the computational time for the nonlinear saturation equations was presented here we want to achieve the same goal for the reactive components in order to keep the transport and reactive computational modules as independent as possible such strategy must not affect the computations related to the system of odes that arise in the reactive step of the operator splitting approach this allows for flexibility and ease of implementation when coupling the different modules of a reactive transport simulator the additional challenge lies not on the transport itself as the transport operator is linear with respect to the concentrations instead the difficulties are related to the nonlinearities and coupling introduced by the reactive terms on eq 5 for reactive systems we can not anticipate an expected behavior of the concentration as was done in fig 2 for the saturation problem indeed the behavior of the concentrations behind the front varies significantly depending on the reactions involved and non monotonic concentration profiles may be found behind the front as will be seen ahead to preserve the modularity of the transport and reaction computations with the adaptive strategy we take advantage of the sequential solution of transport and reactions to develop a prolongation operator that operates at the coarse scale ω only on the transport term this keeps the reactive step of the solution untouched meaning that all the nonlinearities and coupling involved in the reactive term are still treated at the fine scale ω similarly to the treatment of the saturation equation we divide the coarse scale domain ω into three regions since we have n c mass balance equations for the reactive components and each component has its own concentration distribution we divide the domain individually for each component the regions to be defined are similar to the ones defined for the saturation problem ω 1 unperturbed region lies ahead of the reactive front where there has been no appreciable perturbation of the initial concentrations for coarse blocks in this region there is no need to solve the local transport problem ω 2 front region lies at or near the reactive front where concentrations changes quickly in time for this region the solution for the transport problem is obtained by solving eq 18 locally at the fine scale ω 3 creeping region lies behind the reactive front where the concentrations change in time are small for coarse blocks in this region the transport step is solved at the coarse scale and a prolongation operator projects the coarse scale solution back to the fine scale field scale displacements are usually characterized by advection dominated flows orr et al 2007 with high peclet numbers under these conditions the different regions can be identified and the adaptive scheme applied for dispersion dominated flows the breakdown of the domain in these three regions is not possible and the adaptive scheme is not applicable for each component c we define the ratio between the changes in concentration x c that occur during a transport step in fine cell a over the changes that happen in the corresponding coarse cell a as follows 32 t a a n x a t r a n s p n x a n 1 x a t r a n s p n x a n 1 for ω a ω a where the subscript c is dropped to simplify notation the coarse scale concentrations are given by 33 x a 1 v a ω a ω a v a x a in the creeping region we use the prolongation operator t defined above to reconstruct the fine scale concentrations after computing the coarse scale concentrations 34 x a t r a n s p n 1 x a n t a a n x a t r a n s p n 1 x a n for ω a ω a where the concentrations at the coarse scale after applying the transport operator at the new time step n 1 are obtained by solving the transport problem eq 18 at the coarse scale as follows 35 with the advective and dispersive fluxes of the reactive component between cells i and j obtained by integrating the fine scale fluxes over the borders of the coarse grid ω 36a f w x i j 1 u i j l ω i j f w l x l u l 36b ϕ s d x l ω i j ϕ s d x l identifying the different regions of the domain the identification of the different regions for each component is done similarly to the saturation equation as follows at time step n 1 the unperturbed region ω 1 is detected by 37 max x a a n x i n i t δ x u n p e r t for every reactive component where x i n i t is the initial concentration and δ x u n p e r t is a user specified threshold that represents the maximum allowable change in concentration for a gridblock to be assigned to the unperturbed region the creeping region at time step n 1 ω 3 is detected by the condition given by eq 30c and 38a δ t max max t a a n t a a n 1 ϵ r e a c 38b min t a a n 0 where eq 38a bears a very close relation to the condition given by eq 30d and the additional constraint given by eq 38b avoids the use of negative values of the prolongation operator 3 3 time step size due to the explicit treatment of the saturations and concentrations the numerical solution is conditionally stable to compute the time step size incoming fluxes are considered to compute the cfl number for each gridblock 39 c f l δ t v p i n l e t f i n l e t n q i n l e t n where f 1 for the reactive components and f f w for the saturation equation additionally the maximum time step size should also account for limitations related to the dispersive term 40 δ t i 1 n d i m δ i 2 2 d where d is the dispersion coefficient n d i m is the number of dimensions and δ i is the gridblock size in coordinate direction i due to the explicit time discretization the δ t limit given by eq 40 can be severely restrictive in cases with strong dispersive effects nevertheless for convective dominated flows with large peclet numbers that we are interested in the restriction in timestep size given by eq 39 will usually prevail for gridblocks in the rarefaction and creeping regions the transport computations take place at the coarse scale and the step size restrictions are computed at the coarse level relaxing the requirements for stability due to the larger cell volume at each time step δ t is chosen based on the most restrictive gridblock and applied through the whole domain 4 numerical results in this section we explore the acccuracy and behavior of the adaptive scheme for reactive transport the adaptive scheme is compared with reference results obtained by solving the transport problems globally at the fine scale to allow for a direct analysis of the errors introduced by the adaptive transport scheme the underlying pressure and velocity fields are obtained by solving the pressure equation at the fine scale without the use of multiscale approximation to the flow problem we note that due to the modularity of flow and transport in the sequential scheme the combination of a multiscale approximation to the pressure field and the adaptive scheme for reactive transport is straightforward but not explored in this work the systems considered have unit length in all coordinate directions with isotropic permeability distributions and a uniform initial porosity of 20 in the adaptive transport algorithm all the cases consider a coarsening ratio of five in each direction δ x u n p e r t δ s u n p e r t 10 9 ϵ r a r e f 0 2 and ϵ v e l 0 1 unless otherwise noted ϵ r e a c and ϵ s a t are 10 5 and 10 4 respectively we note that the choices of δ x u n p e r t and δ s u n p e r t are extremely conservative and looser thresholds could be used safely we opted for such a small value in order to avoid sources of errors other than the use of the prolongation operator to interfere in the error analysis all results consider a maximum cfl number of 0 7 and unless otherwise noted time step sizes are fixed to avoid the impact of time discretization on the error analysis the combined effects of reaction and flow rates can be expressed through the damköhler number that relates the time scale of advection and time scale of the chemical reactions for the homogeneous and heterogeneous reactions the damköhler number is defined as 41 d a h o m ω l x v 42 d a h e t a s o ω l x ϕ o v where v is the average interstitial velocity l x is the length of the domain in the x direction and the superscript o denotes initial conditions we consider a constant injection rate q i n j 0 2 m 3 d of water containing reactive components production is done at fixed pressure although not relevant for the dynamics of the problem as we express the results in terms of the damköhler number q i n j needs to be informed in order to fully specify the production rates of reactive components in the results that will be presented in the examples that follow dispersive fluxes are only considered in section 4 2 3 4 1 single phase flow and homogeneous reactions this case considers three reactive components c 1 c 2 and c 3 that participate on the following first order irreversible decay reactions 43a c 1 c 2 43b c 2 c 3 43c c 1 c 3 the exponential dependence of the reactions α are given by the stoichiometric coefficients of the reactants involved in each of the reactions that are all of first order initially the system contains none of the components and the injected water contains component c 1 with a concentration of 1 mol kg 1 this system of decay reactions is hypothetical and it was intentionally chosen because it leads to concentration distributions that are markedly different for components c 1 c 2 and c 3 including non monotonic concentration distributions for component c 2 behind the reactive front with this in a single test case we can verify the capability of the prolongation operator described in section 3 2 to tackle complicated nonlinear reactive flow problems involving several coupled reactive components with different behaviors 4 1 1 one dimensional problem here we consider a one dimensional domain with 200 gridblocks the damköhler numbers of the reactions given by eqs 43a to 43c are 2 10 and 2 respectively fig 4 presents the concentration profiles at 0 7 pore volumes injected pvi for c 1 c 2 and c 3 obtained with the reference and adaptive solutions from which it can be seen that the adaptive transport computations reproduce the reference solution remarkably well the analysis of the data in fig 4 also reveals that behind the reactive front components c 1 and c 3 have monotonic behaviors from left to right c 1 concentration monotonically decreases and c 3 concentration monotonically increases component c 2 has a non monotonic behavior behind the front at this point it is relevant to analyze the behavior of the prolongation operator given by eq 32 fig 5 presents the concentration of c 2 as well as t at 0 8 pvi obtained with the adaptive scheme it can be seen that in the creeping region shaded in red t has different behaviors for positions to the left of the peak in concentration t reduces from left to right inside a single coarse cell and the changes in t are larger near the peak in concentration to the right of the peak in concentration t changes it s behavior and increases from left to right inside each coarse cell and the changes in t get smaller at positions farther away from the peak further ahead of the peak in concentration the behavior of t changes again and starts decreasing from left to right inside each coarse cell these different behaviors of t did not prevent an accurate reconstruction of fine scale concentrations as seen in fig 4 this is an important result as it shows that the single adaptive strategy proposed does not require the behavior of the concentration profile to be known a priori making it applicable to different reactive systems and avoiding the need to develop prolongation operators that are specifically designed for a given reactive component fig 5 also shows that the prolongation operator reaches values close to 0 near the concentration peak depending on system properties negative values can be obtained and this would violate the condition given by eq 38b a situation more likely to occur in heterogeneous reservoirs 4 1 2 heterogeneous reservoirs in this section we consider the permeability distribution shown in fig 6 where x and y directions are discretized in 120 gridblocks leading to a total of 14 400 gridblocks the damköhler numbers of the reactions given by eqs 43a to 43c are 1 5 and 0 5 respectively to illustrate the accuracy and behavior of the algorithm fig 7 shows a comparison of the concentration of c 3 given by the reference and adaptive solutions at 1 2 and 3 pvi as well as the distribution of the regions of the domain and the absolute error at each point in space it can be noted that the adaptive algorithm accurately represents the reference results and that the evolution of the regions of the domain with time is correlated to the more permeable regions of the reservoir important to note that at 2 and 3 pvi approximately 50 and 80 of the transport computations are done at the coarse scale fig 8 presents the production rates for c 1 c 2 and c 3 the reference and adaptive solution results are in excellent agreement throughout the whole simulation time fig 9 a presents the fraction of the global domain that are defined as unperturbed front and creeping regions for c 2 as a function of time it can be seen that the regions of the domain change smoothly and with minor oscillations also the fraction of the domain assigned to unperturbed region decreases with time and the opposite happens for the creeping region as expected indicating that the identification of the regions is occurring in a satisfactory manner fig 9 b presents the fraction of the domain that is assigned to the creeping region for different values of ϵ r e a c as expected the tighter the value of ϵ r e a c the smaller will be the fraction of the domain assigned to the creeping region it is also relevant to note the high fractions of the domain that are assigned to the creeping region for large times that translates to significant savings in computational costs by using the adaptive formulation fig 10 a and b show the relation between the infinity norm of the error e i n f and ϵ r e a c for the 1d and 2d cases respectively it can be seen that there is a linear relation with slope 1 for all components this is an important result that indicates that the errors that come from the adaptive solution are directly related to the parameter ϵ r e a c that is specified by the user it can also be noted that the higher the heterogeneity the larger the errors are for the same value of ϵ r e a c but nonetheless the adaptive threshold ϵ r e a c still has a direct control on the errors incurred by use of the adaptive formulation even for highly heterogeneous cases the results shown in this section did not explicitly account for dispersive effects which will be done in section 4 2 but it is important to point that due to the significant numerical dispersion introduced by single point upwinding similar results are expected when dispersive effects are present but advective forces are still dominant even though the results presented for homogeneous decay type reactions are encouraging it must be pointed out that the evolution of these reactive systems is directly related to the fluid residence time and such systems achieve a steady distribution of concentrations behind the front thus it can be argued that the prolongation operator is being responsible only for keeping the correct steady concentrations behind the front to show that the prolongation operator is also able to accurately perform transport computations in situations where a steady state is not achieved we apply next the adaptive formulation for heterogeneous chemical reactions 4 2 two phase flow and heterogeneous reactions we consider quadratic corey type relative permeability curves for both oil and water 44 k r w k r w max s w s w i 1 s w i s o r 2 45 k r o k r o max 1 s w s o r 1 s w i s o r 2 with s w i 0 2 s o r 0 2 k r w max 1 and k r o max 1 the mobility ratio is defined as 46 m k r w max μ w k r o max μ o where μ w and μ o are water and oil viscosities in addition to the nonlinearities introduced by two phase flow this case also considers the dissolution of the porous medium by a chemical reactant c 1 that is injected in the domain with a concentration of 1 mol kg the dissolution induces changes in porosity permeability and reactive surface area although more complex chemical models exist to represent solid dissolution sanford and konikow 1989 we follow a simplified approach that considers the heterogeneous dissolution reaction to be an irreversible first order reaction with respect to the concentration of c 1 molins et al 2020 esteves et al 2020 47 r r het a s ρ w s w ω r x c 1 the damköhler number is 1 and the mineral density is 27 080 mol m 3 reference values for calcite and it is considered that each mol of c 1 that reacts dissolves 1 mol of the rock matrix before proceeding to the analysis of reactive transport we analyze the behavior of the adaptive strategy for the saturation equation in a 1d setting 4 2 1 one dimensional problem for the saturation equation fig 11 presents the saturation profiles at 1 0 and 3 0 pvis obtained with the reference and adaptive solution with m 1 and the 1d domain discretized in 200 griblocks it can be seen that the errors are small but the adaptive solution for the saturation equation does not reproduce the reference results as accurately as it did for the reactive components in fig 4 this observation is further emphasized by fig 12 that shows the relationship between the error and the adaptivity threshold ϵ s a t for different mobility ratios it can be seen that although there is a clear relationship between the error and ϵ s a t for the saturation equation this relation is weaker than the one observed for ϵ r e a c and the error in concentration of the reactive components for the reactive components a slope of 1 was observed for the saturation equation a slope between 1 4 and 1 2 is observed fig 12 also allows us to draw an important conclusion the adaptivity strategy is less precise for unfavourable mobility ratios and this is expected because of the more pronounced rarefaction in such a way that the saturation changes that are evolved through the prolongation operator are larger the more unfavourable the mobility ratio to understand what causes the larger errors and the weaker control of the adaptivity threshold on the errors of the saturation equation as compared to the reactive components we analyze the behavior of the prolongation operator given by eq 23 in cases that do not make use of the adaptive strategy i e the front region is used in the whole domain fig 13 shows at 0 4 pvi the water saturation p and δ p max eq 30d which represents the maximum change in the prolongation operator between two consecutive time steps in a coarse cell it can be seen that the prolongation operator has the same behavior for all positions in the rarefaction region in contrast to what was observed for the behavior of the prolongation operator in the creeping region of fig 5 this is expected because the saturation has a monotonic behavior it can also be noted that near the injector where the changes in saturation in time are smaller the gradient of the prolongation operator is steeper this behavior poses no problem to the adaptive strategy as the prolongation operator will give accurate reconstruction of fine scale saturations provided the value of the prolongation operator properly relates coarse and fine scale quantities ultimately the source of errors in the adaptive strategy are the changes in the prolongation operator with time that are given by δ p max even though the values of δ p max in the rarefaction region that are shown in fig 13 are on the order of 10 4 they represent the change that happens over a single time step in the span of several time steps the cumulative changes in the prolongation operator may be significant as the adaptive scheme fixes the value of the prolongation operator once a gridblock is defined to be part of the rarefaction region after a significant number of time steps the prolongation operator used by the adaptive strategy can be outdated which leads to the slight inaccuracies observed in fig 11 the observation above points towards an effective way to improve accuracy of the adaptive strategy which is to recompute the prolongation operator in the whole domain with a certain frequency this is a topic for future research another point that deserves attention in fig 13 is that δ p max tends to have larger values for positions well behind the front this may cause problems in the identification of the rarefaction region specifically on the criterion given by eq 30d as regions far behind the front that should be clearly assigned to the rarefaction region might not be so due to this behavior of δ p max the issues described in the two previous paragraphs are smaller the larger the number of gridblocks in the model as can be seen in fig 14 that shows δ p max at 0 4 pvi for models composed of 100 200 400 and 1000 gridblocks fig 14 reveals that the larger the number of gridblocks the smaller will be δ p max thus for larger numbers of gridblocks we can expect smaller errors with the use of the adaptive strategy as well as less occurrence of inadequate identification of regions well behind the front due to large values of δ p max 4 2 2 heterogeneous reservoir with point source wells the changes in rock properties due to dissolution of the solid introduce additional numerical challenges that are particularly relevant for highly heterogeneous reservoirs this is because changes in porosity and permeability affect the flow field making the flow problem dependent on the reactive transport effectively causing a two way coupling between flow and reactive transport to explore the behavior of the adaptive strategy under these conditions we consider a sector comprising 50 50 gridblocks of the permeability field shown in fig 6 the wells are point sources with the injector operating with fixed injection rate on the left bottom corner and the producer operating with fixed pressure at the top right corner figs 15 and 16 present for water saturation and component c 1 respectively the results obtained with reference and adaptive solutions as well as the division of the domain in the different adaptivity regions and the error at 0 5 1 5 and 2 5 pvis the reference and adaptive solution results are in good agreement for all times and significant portions of the domain are assigned to the rarefaction and creeping regions fig 17 presents the porosity for reference and adaptive solutions as well as the error at 0 5 1 5 and 2 5 pvis note that the strongest changes rock properties happen near the injector where coarse scale computations and the prolongation operator are frequently employed the small errors shown in figs 15 16 and 17 show that the adaptive scheme properly represents the more complicated dynamics involved in heterogeneous chemical reactions with alterations in rock properties variable time step size in addition to the gains related to performing the transport computations at the coarse scale adaptive computations also allow for larger time step sizes δ t this is because the regions with higher velocities that limit δ t due to the cfl condition are also the portions of the domain where the coarse scale transport computations are earlier and more often used whenever the adaptive algorithm performs transport computations at the coarse scale in regions that would otherwise limit δ t if the transport computations were performed at the fine scale significant increases in δ t occur to demonstrate this we run the reference and adaptive simulations with variable δ t by respecting the cfl condition at each individual time step fig 18 presents a comparison of the time step sizes taken with reference and adaptive solutions from which we can see that time step sizes up to 25 times larger could be taken with the adaptive scheme fig 19 a compares the water cut and the production rate of c 1 obtained by the reference and adaptive solutions it can be observed that the adaptive solution accurately reproduces the reference solution even in a highly dynamic problem where changes in the flow field are caused by the nonlinearities in the water oil displacement as well as by changes in permeability induced by dissolution the problem also accounts for changes in the reaction rate caused by changes in reactive surface area the excellent behavior of the adaptive strategy in such a complex problem demonstrates its robustness the results shown in fig 19a consider the variable time step sizes shown in fig 18 this shows that the results are converged w r t time step size and also that the mass balance errors introduced by the operator splitting approach valocchi and malmstead 1992 that are related to the time step size are small importantly by taking variable time step sizes the definition of the adaptive regions presents only minor oscillations as can be seen in fig 20 a and b the ability of the algorithm to take variable time step sizes without significant oscillations is an important characteristic as variable time step sizes are the norm rather than the exception for large scale reservoir simulations changes in operational conditions here we explore the behavior of the adaptive strategy when changes in operational condition occur this is done by shutting in the wells at 1 5 pvi and start injecting with a new well on the bottom right corner and producing with a new well on the upper left corner no information is given to the adaptive algorithm about the changes in operational condition but it recognizes the changes by variations in the velocity field that are detected through condition eq 30c fig 19 b compares the water cut and the production rate of c 1 obtained by the reference and adaptive solutions with variable time step sizes where the change in operational conditions at 1 5 pvi and its impacts on production are accurately represented by the adaptive scheme when the change in operational condition happens the velocity field changes and the saturations and concentrations start evolving differently in the domain which causes the adaptive strategy to redefine the regions in such a way that right after the change in operational condition all gridblocks are treated as if they are the front region and after time passes and the changes in saturation and concentration start reaching an asymptotic behavior the fraction of the domain that is assigned to rarefaction and creeping regions increases gradually this behavior can be observed in fig 20 that shows the fraction of each region in the domain for the cases without and with change in operational condition variable time step sizes were used for this result to further illustrate the behavior and accuracy of the adaptive scheme after the change in operational condition fig 21 presents the concentration of c 1 for reference and adaptive solutions as well as the division of the domain in the different adaptivity regions and the error at 1 6 2 0 and 3 0 pvis at 1 6 pvi the concentration field is going through significant changes in the whole domain as a consequence the adaptive scheme solves the transport problem at the fine scale in the whole domain because the use of the prolongation operator in such condition would lead to inaccurate results at 2 and 3 pvi significant parts of the domain undergo coarse scale transport computations and the errors remain small 4 2 3 3d case with dispersive fluxes in this section we consider a three dimensional domain discretized in 100 30 20 gridblocks in the x y and z directions injection occurs from left to right and the permeability distribution consists of a log normal gaussian distribution with average permeability of 100 md shown in fig 22 the peclet number represents the ratio of dispersion and advection time scales and is here defined as p e v l x d where d stands for the isotropic dispersion coefficient that is considered constant throughout the domain in this example we set p e 50 which lies in the lower range of peclet numbers typically found in field scale applications dispersive effects smear the sharp concentration gradients observed in cases without dispersion as can be seen in fig 23 which shows a comparison of the concentrations of c 1 at 0 5 pvi for the cases without and with dispersion obtained with the reference solution this affects the division of the domain in the three different regions as can be seen in fig 24 that shows the fraction of each region in the domain with and without dispersion for short times dispersive effects lead to a larger portion of the domain being subject to strong changes in concentration leading to a smaller prevalence of the unperturbed region and a larger prevalence of the front region this reduces the efficiency of the adaptive scheme as the transport computations of the front region entail the largest computational cost for long times the fraction of the creeping region is larger for the case with dispersion in fact the fraction of the creeping region reaches 100 even though poorly swept regions exist in the domain due to the heterogeneous permeability field thus for large times the efficiency of the adaptive scheme can be increased by dispersive effects the adaptive scheme is able to provide accurate results when dispersive effects are present as can be seen in fig 25 that presents a comparison of the concentration of c 1 for reference and adaptive solutions at 0 5 and 1 5 pvi as well as the errors and the distribution of the domain in the different regions where blue green and red colors indicate unperturbed front and creeping regions respectively errors smaller than 10 6 are not shown and the errors are made transparent to allow for a clear evaluation of the errors through the whole domain accurate results are also obtained for the water saturation as can be seen in fig 26 that presents for s w the same results shown in fig 25 for the concentration of c 1 the number of cell updates required to solve the transport problems provides an estimate of the computational savings obtained with the adaptive scheme for a 3d case with a coarsening ratio of 5 in each direction each coarse cell in the creeping or rarefaction regions requires a number of cell updates that is 125 times smaller than would be required in the reference solution for the unperturbed region no cell update is needed fig 27 shows the number of cell updates required to solve eqs 17 and 18 at each time step normalized by the number of updates required in the reference solution it can be seen that for long times the number of cell updates required by the adaptive scheme is more than an order of magnitude smaller than the number of cell updates required by the reference solution fig 28 compares the water cut and the production rate of c 1 obtained by the reference and adaptive solutions showing that the adaptive scheme remains accurate until the end of the simulation although not presented here this case also accounts for changes in rock properties and the adaptive scheme provided an accurate representation of the changes in porosity permeability and reactive surface area the results presented demonstrate the applicability of the adaptive scheme to solve the advection dispersion reaction equation in heterogeneous 3 dimensional cases with the added complexities related to the non linearities of two phase flow as well as changes in rock properties due to dissolution 5 conclusions we describe the development of an adaptive scheme for reactive transport computations based on sequential solution of flow transport and reactions in heterogeneous porous media the formulation is applied to one and two phase flow problems the adaptive scheme for the solution of the saturation equation previously developed by lee et al 2009 is used to treat the nonlinear saturation equations in this work the original algorithm is modified and different criteria are proposed to identify the adaptivity regions the proposed modifications allow the algorithm to take advantage of adaptivity to take larger time steps with impes impec computations for the components involved in chemical reactions a single prolongation operator that is applicable to components with different behaviors and involved in different chemical reactions is developed this prolongation operator is applied to regions in the domain where the concentrations change slowly with time to not interfere with the computations of the source sink terms related to the chemical reactions the adaptive strategy acts exclusively on the transport step of the operator splitting approach preserving the modularity of transport and reaction computations examples demonstrate that the adaptive strategy does not require previous knowledge about the distribution of the reactive components throughout the domain as it accurately solves the concentrations distribution for chemical components that experience concentration increase decrease and even problems with non monotonic concentration profiles it is shown that for single phase flow user specified thresholds have an excellent control on accuracy the robustness of the algorithm is demonstrated in cases that involve two phase flow in highly heterogeneous permeability distributions in 2 and 3 dimensions with the occurrence of heterogeneous reactions that cause rock dissolution and consequent changes in porosity permeability and reactive surface area in this highly dynamic system where coupling between flow transport and reactions occurs due to the nonlinearities of the saturation equation as well as by the changes in rock properties the adaptive algorithm provides excellent results for both the saturation and the reactive component in both linear and radial displacement problems furthermore it is demonstrated that the adaptive scheme is able to tackle problems with changes in operational conditions the adaptive solution allows larger time steps to be taken in the explicit transport computations as the cfl condition is less severe when the transport computations are performed at the coarse scale significant increases in time step size are obtained with the adaptive algorithm where adaptive computations allowed time step sizes up to 25 larger than the ones taken with the reference solution this further diminishes the computational effort that was already reduced by performing the transport computations at the coarse scale credit authorship contribution statement ricardo h deucher conceptualization investigation methodology software writing original draft writing review editing hamdi a tchelepi conceptualization investigation methodology supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment we thank petrobras petróleo brasileiro s a and the reservoir simulation research consortium at stanford university supri b for supporting this work 
252,pore network model simulation pnm is an important method to simulate reactive transport processes in porous media and to investigate constitutive relationships between permeability and porosity that can be implemented in continuum scale reactive transport modeling the existing reactive transport pore network models rtpnms assume that the initially cylindrical pore throats maintain their shape and pore throat conductance is updated using a form of hagen poiseuille relation however in the context of calcite dissolution earlier studies have shown that during dissolution pore throats can attain a spectrum of shapes depending upon the imposed reactive flow conditions agrawal et al 2020 in the current study we derived new constitutive relations for the calculation of conductance as a function of pore throat volume and shape evolution for a range of imposed flow and reaction conditions these relations were used to build animproved new reactive pore network model nrtpnm using the new model the porosity permeability changes were simulated and compared against the existing pore network models in order to validate the reactive transport pore network model we conducted two sets of flow through experiments on two ketton limestone samples acidic solutions ph 3 0 were injected at two darcy velocities i e 7 3 10 4 and 1 5 10 4 m s 1 while performing x ray micro ct scanning experimental values of the changes in sample permeability were estimated in two independent ways through pnm flow simulation and through direct numerical simulation both approaches used images of the samples from the beginning and the end of experiments extracted pore networks obtained from the micro ct images of the sample from the beginning of the experiment were used for reactive transport pnms rtpnm and nrtpnm we observed that for the experimental conditions most of the pore throats maintained the initially prescribed cylindrical shape such that both rtpnm and nrtpnm showed a similar evolution of porosity and permeability this was found to be in reasonable agreement with the porosity and permeability changes observed in the experiment next we have applied a range of flow and reaction regimes to compare permeability evolutions between rtpnm and nrtpnm we found that for certain dissolution regimes neglecting the evolution of the pore throat shape in the pore network can lead to an overestimation of up to 27 in the predicted permeability values and an overestimation of over 50 in the fitted exponent for the porosity permeability relations in summary this study showed that while under high flow rate conditions the rtpnm model is accurate enough it overestimates permeability under lower flow rates keywords carbonate dissolution reactive transport micro ct pore network model porosity permeability relation 1 introduction numerous applications require an understanding of fluid interactions with porous solid phases examples include optimization of the recovery from hydrocarbon reservoirs and prediction of the long term consequences of co2 injection in the subsurface calcite dissolution is an important reaction in the subsurface reservoirs several studies have demonstrated that during calcite dissolution a multitude of physical and chemical processes operate at the pore scale which govern the evolution of the porous medium such modification of the porous medium and the related porosity permeability relations is a function of the initial heterogeneity of the rock and of the dissolution conditions like the injection rate and chemistry of the injected fluid e g agrawal et al 2020 golfier et al 2002 hoefner and fogler 1988 li et al 2008 luquot et al 2014 luquot and gouze 2009 meile and tuncay 2006 molins et al 2014 one approach to comprehend the complexity of calcite dissolution process is through using pore scale models such as pore network models pnms several pore network formulations have been developed to present porous media topology and angular pore geometries acharya et al 2005 al gharbi and blunt 2005 ghanbarian b hunt a g 2016 raoof et al 2013 raoof and hassanizadeh 2012 raoof and hassanizadeh 2009 some studies have used pore throats with varying shapes such as sinusoidal or other converging diverging shapes acharya et al 2005 al gharbi and blunt 2005 for which analytical expressions can be applied to calculate pore conductance acharya et al 2005 ghanbarian b hunt a g 2016 raoof and hassanizadeh 2012 correct estimation of the hydraulic conductance values of the pores throats is required to obtain an accurate permeability for the sample in the context of calcite dissolution the existing pore network models use a network of spherical pores bodies and cylindrical pore throats to simulate the related reactive transport processes mehmani et al 2012 nogues et al 2013 raoof et al 2012 these pore network models provide porosity permeability relations as a function of the specific dissolution condition which is a key input for continuum scale models an important consideration in the existing pore network models is related to the way conductance of the pore throat is updated during the calcite dissolution most pore network models assume that pore throats having initially a uniform circular cross section along their length preserve their form throughout dissolution irrespective of the flow and reaction regimes consequently in response to dissolution pore conductance values can be calculated using the hagen poiseuille relation however it has been shown that initially uniform pore throat structures can develop into a spectrum of pore throat shapes with circular cross sections of variable diameter along their length depending on the flow and reaction regimes e g agrawal et al 2020 for example under diffusion and reaction dominated dissolution regimes the pore throat structure changes into a half hyperboloid i e conical shape under this condition the hagen poiseuille equation would result in an overestimation of pore throat conductance agrawal et al 2020 showed that the conductance evolution in the pore network models should include information on pore throat shape evolution that takes the reaction regime into account as mentioned earlier some pnms have been developed with originally non uniform shapes of pore throats however no pore network based study has incorporated the dissolution induced evolution of pore throat shapes in this study we link the evolving shape of pore throats under a wide range of conditions to the resulting pore throat conductance values using reactive transport simulations we implemented the correlation relations for the evolution of conductance as a function of pore throat shape and volume agrawal et al 2020 in a pore network extracted from experimental micro ct data to simulate reactive transport across the rock sample in a modified pnm the outcome was compared to the hagen poiseuille pnm approach and to the permeability evolution determined experimentally using micro ct finally the impact of the new conductance evolution relationship on porosity permeability relations was tested for a range of flow and reaction regimes 2 experimental method in this study we used an oolitic limestone sample ketton limestone quarried from the upper lincolnshire limestone formation village of ketton in rutland england two plugs with a diameter of 6 mm and an approximate length of 12 mm were extracted from the homogeneous oolitic block hereafter these samples are referred as k1 and k2 two sets of reactive transport experiments were conducted on these samples the injecting solution contained hcl acid with a ph value of 3 0 applied under two flow rates provided in table 1 the environmental micro ct emct scanner bultreys et al 2016 at the center for x ray tomography www ugct ugent be was used to image the progress of calcite dissolution with a reconstructed voxel size of 6 µm each dynamic scan consisted of 2200 projections recorded in a total scan time of around 15 min the sample was scanned at the beginning and at the end of the experiment data from raw projections were reconstructed into a 3d stack volume using the filtered back projection method implemented in octopus software vlassenbroeck et al 2007 next 3d datasets were filtered using a non local means filter and segmented with the watershed segmentation method avizo 9 5 0 table 1 provides the porosity values computed from the segmented image volumes of the sample from the beginning of the experiments we observed that the computed porosity values in this study fall within the range of earlier reported image based segmentation porosity values for the ketton rock e g table 3 in menke et al 2017 these values differ from the measured bulk porosity e g table 1 in menke et al 2017 indicating that image segmentation include some unavoidable deviations from the measured bulk porosity values for both experiments the size of the segmented 3d volume was 1318 1316 2494 voxels from which smaller sub volumes were used in this study as discussed in section 3 2 1 3 numerical methods we performed pore scale modeling at three different levels i single pore scale where we simulated reactive transport for a single evolving pore space under different conditions cf agrawal et al 2020 ii pore network scale where rock dissolution is simulated using pnm and iii direct numerical simulations dns using 3d imaged pore structures where detailed flow field is obtained by simulating incompressible flow in the rock images the single pore scale model provided insight on the evolution of the conductance of a pore throat for a range of physiochemical conditions and was previously validated against experimental microfluidic experiments agrawal et al 2020 in the current work we develop constitutive relationships for dissolution induced conductance based on results from this systematic single pore model the evolution of porosity and permeability observed in the pore network model was validated against a direct numerical solution of flow across the sample next for a range of flow and reaction regimes pore network models were run with and without the new improved conductance relationships and the permeability results of both models were compared table 2 summarizes key details of various simulations used in this study 3 1 single pore scale model pore scale reactive transport utilizing a single capillary geometry were simulated by solving the stokes equations for fluid flow and advection diffusion reaction equations for reactive transport of aqueous species comsol multiphysics readers are referred to agrawal et al 2020 for details of the simulations and their validation against microscopic experiments of reactive transport in calcite crystals the modeled range of boundary conditions i e injection rate composition of injecting solution and pore throat geometry correspond conditions relevant to injection of co2 or acidic solution into carbonate rocks details of the simulated flow regimes reaction regimes and pore throat geometries are provided in table s1 to investigate the control of the reaction and flow regimes over the evolution of pore throat conductance we calculated three dimensionless parameters including the péclet number the damköhler number and the geometry factor at the beginning of each simulation the péclet number pe was defined as 1 p e v r d where v is the average velocity at the inlet boundary r is the radius of the pore throat m and d is the diffusion coefficient i e 3 36 10 9 m2 s 1 the damköhler number da was defined as 2 d a r k v c c a l c i t e where ccalcite is the density of surface sites of calcite i e 0 8 10 5 mol m 2 and k mol m 2 s 1 is obtained based on the forward rate constant in the kinetic rate law for calcite dissolution i e the reaction rate constant k 1 in eq 11 in section 3 3 2 and the activity of h ions i e ah in eq 11 in section 3 3 2 in the injected solution the geometry factor gf was defined as 3 g f l r where l is the length of the pore throat the conductance g m5 n 1 s 1 of the pore throat was calculated from the imposed volumetric flux f m3 s 1 and the pressure drop across the pore throat δpsp n m 2 as 4 f g δ p s p in the case of a cylindrical pore throat geometry and laminar flow eq 4 is equivalent to the following definition of conductance g 5 g π r 4 8 μ l where μ is the viscosity of water 0 001 pa s at about 25 c section 4 2 provides the modified relations for the calculation of the pore throat conductance for a range of flow and reaction regimes 3 2 pore network generation 3 2 1 pore networks extracted from the digital rock volumes a total of five pore network structures were generated from the micro ct images of ketton using the maximal ball algorithm raeini et al 2017 two subsets of size 700 700 700 voxels k1s1 and k1s2 were obtained from the digital volumes of the sample k1 at two different times i e t 0 and t 102 min similar sized subsets k2s1 and k2s2 were extracted from the digital volumes of the sample k2 at the two experiment times i e t 0 and t 330 min respectively these subsets were utilized for the purpose of validation of the pore network model such that networks k1s1 and k2s1 were the starting pore networks to perform reactive transport simulation note that the selected time duration for both experiments leads to injection of comparable pore volumes i e 2442 in experiment e1 hq and 1996 in the experiment e2 lq table 1 another subset of size 300 300 300 voxel namely k1s3 was extracted from the digital volume of the sample k1 at an experiment time step t 0 min this subset was utilized for the sensitivity study of the modified conductance model presented in section 4 3 the position of these subsets with reference to the full volumes of the ketton sample is shown in figs 1 and s1 fig 2 shows the frequency distribution of properties of the extracted pore networks such as pore body radius pore throat radius pore throat length and coordination number table 3 provides the statistics of each extracted pore network 3 3 pore network model the pore network model utilized in this study is an adaptation of the previously developed pore scale model by raoof et al 2012 in the following this model is discussed briefly 3 3 1 flow and solute transport for this study single phase flow was established across the pore network this was achieved by assuming laminar flow along each pore throat of the network i e reynolds number is less than 1 flux through a pore throat was described by the hagen poiseuille equation as 6 q i j g i j p j p i where qij is total volumetric flux through the pore throat ij gij is the conductance of the pore throat ij and pi and pj are the pressures in pore bodies i and j respectively the simulated pore network models in this study utilized the hagen poiseuille relation i e eq 5 and modified conductance relations i e eqs 18 for calculation of the pore throat conductance for incompressible saturated flow conditions the sum of fluxes of all pore throats connected to a pore body was equated to zero this implies that the amount of flux going to a pore body should be equal to the amount of flux coming out of that pore body 7 j 1 n k q i j 0 j 1 2 n k where nk is the coordination number of pore body k eq 7 is valid for all pore bodies of the network except those present at the inlet and outlet face of the network combination of eqs 6 and 7 resulted in a linear system of equations to be solved for the pressure of the pore bodies and the volumetric flux through the pore throats we have used a constant darcy velocity boundary condition at the inlet face a constant pressure i e atmospheric pressure boundary condition at the outlet face and no slip boundary conditions was applied at the lateral faces of the network from the imposed darcy velocity ud and pressure difference between the inlet and outlet faces δppnm the absolute permeability of the pore network is calculated from 8 k p n m μ u d l δ p p n m where l is the length of the pore network along the flow direction all the chemical components are transported through the pore network by advection and diffusion processes for a given pore body i and for the flow conditions under which fluid flowing from pore body j towards pore body i through pore throat ij we can define the transport of the kth chemical component as 9 v i d d t c k i j 1 n i n t h r o a t q i j c k i j q i c k i j 1 z i d a i j c k i j c k i l i j r k i where vi qi and c k i are the volume volumetric flow rate and concentration of kth component in pore body i respectively the left hand side l h s of the eq 9 provides the rate of change of concentration for the kth component in the pore body i over time this rate is a combined output of the advective diffusive and reactive rates the first term on the right hand side r h s of the eq 9 calculates the total amount of the incoming flux of each component through n i n t h r o a t upstream pore throats i e pore throats flowing into pore body i this calculation utilizes the volumetric flow rate qij and concentration c k ij in pore throat ij the second term on the r h s calculates the total outflux of the kth component the third term on the r h s calculates the diffusion rate of the kth component through zi connected pore throats this calculation utilizes the molecular diffusion coefficient d and the cross sectional area of the throat aij the last r h s term r k i defines changes due to chemical reactions of the kth component taking place inside the pore body similarly the mass balance equation for pore throat ij and for the case when the fluid is flowing from pore body j to pore throat ij can be written as 10 v i j d d t c k i j q i j c k j q i j c i j d a i j c k j c k i j l i j d a i j c k i c k i j l i j r k i j where vij qij and c k ij are the volume volumetric flow rate and concentration of kth component in pore throat ij respectively r k ij provides feedback from reactions of the kth component taking place inside the pore throat 3 3 2 reactions and rate laws to describe the calcite dissolution system we have incorporated a total of four reactions out of those four reactions three reactions involving only aqueous species are described using equilibrium relationships whereas the dissolution of calcite is described by a kinetic rate law details of equilibrium reactions are provided in table 4 plummer et al 1978 has identified three main mechanisms through which calcite dissolution takes place accordingly we have defined the calcite dissolution rate as 11 r a t e a k 1 a h k 2 a h 2 c o 3 k 3 1 a c a 2 a c o 3 2 k e q where a is the reactive surface area of calcite and ai is the activity of species i k 1 8 64 10 5 m s 1 k 2 4 78 10 7 m s 1 and k 3 2 34 10 9 m s 1 are reaction rate constants at 25 c plummer and busenberg 1982 keq 10 8 48 is the equilibrium constant for calcite dissolution plummer and busenberg 1982 3 3 3 modeling parameters we have utilized two sets of flow and chemical conditions for pore network modeling the first set is derived from the experimental parameters table 1 and the second set covers the range of reaction and flow regimes which are relevant to acid stimulation experiments in carbonate reservoirs in the experiments we injected the solutions at a fixed flow rate table 5 provides the magnitude of the calculated darcy velocity for the experiments e1 hq and e2 lq models corresponding to these experiments utilized the respective value of the darcy velocity for injecting a solution with the ph value of 3 0 additional sets of utilized darcy velocities and ph of the injected solutions are provided in table 5 lower ph values of the injected acid are relevant to acid stimulation applications in carbonate reservoirs al ameri and gamadi 2020 janbumrung and trisarn 2017 leong and ben mahmud 2019 the composition of these solutions was calculated using phreeqc parkhurst and appelo 2013 and phreeqc dat database table s2 in order to categorize the simulated flow and reaction regimes we have defined the macroscopic peclet number p e and damköhler numbers d a i and d a i i as 12 p e u d l d 13 d a i l 2 k 1 a h d c c a l c i t e 14 d a i i l k 1 a h u d c c a l c i t e where ud is the darcy velocity m s 1 and l is the length of the pore network along the flow direction table 5 provides p e d a i and d a i i numbers for all the simulated models note that the pe and da numbers without sign were defined at the scale of an individual throat while pe and da numbers with sign were defined at the scale of pore network 3 4 direct flow simulation of pore scale images in order to compare the permeability values obtained from pnm results we have performed pore scale flow dns we have used the volume of fluid vof method implemented in openfoam computational fluid dynamic cfd package to solve incompressible flow using a semi implicit method for pressure aslannejad et al 2018 bedram and moosavi 2011 numerical three dimensional simulation of incompressible linear viscous flow was done by solving the navier stokes equations 15 ρ u t u u p μ 2 u 16 u 0 where p is pressure u is velocity μ is the viscosity of water μ 0 001 pa s and ρ is the density of water ρ 1000 kg m 3 the flow equations are solved by applying a constant pressure difference between the inlet and the outlet faces δpi and a no slip boundary condition at the remaining faces this yielded the velocity and pressure for each voxel in the domain the flow rate q m3 s 1 was calculated as q u x a x where ax m2 is the cross sectional area of the inlet face perpendicular to the direction of flow x and ux is the inlet face velocity component in the direction of flow from the flow rate q and the imposed pressure difference δpdns absolute permeability of the 3d xmt image kdns m2 is calculated using darcy equation 17 k d n s μ q l x δ p d n s l y l z where lx ly and lz are the domain lengths in each direction 4 results and discussions section 4 1 presents a comparison of the pore network models against the observations from micro ct experiments next using single pore simulations we derived correlation relations for the conductance of pore throats in section 4 2 these relations were implemented in the new pnm nrtpnm section 4 3 provides comparison of permeability evolution from nrtpnm versus rtpnm for the experimental conditions section 4 4 extends this comparison for a range of transport and reaction regimes in section 4 5 we present the impact of flow and reaction conditions over the porosity permeability relations obtained from nrtpnm versus rtpnm 4 1 validation of the reactive transport pore network model rtpnm with the micro ct experiments two rock pore networks i e k1s1 and k2s1 were simulated with similar initial and boundary conditions to the experiments e1 hq and e2 lq respectively at time t 0 samples were filled with a fluid solution equilibrated with calcite in the experiment e1 hq injection of a solution with a ph value of 3 0 initiated calcite dissolution which shows itself as a decreasing amount of calcite in fig 3 e fig 3a d shows the corresponding time based evolution of the average chemical species concentrations the ph of the solution inside the sample decreased continuously as a larger number of pores were penetrated by the acidic solution fig 3a d the acid arrival time for each pore throat depends on its distance from the inlet boundary and its connectivity with the dominant flow channels the inlet area of the sample reaches a steady state in shorter time compared to the outlet area figure s2 moreover the steady state ph of the inlet area is lower than that of the outlet area figure s2 this indicates that within the simulation time a significant number of pore throats located in the outlet area were not yet filled with the inflow solution chemistry from the distribution of ph of the solution inside the sample after injection of around 2442 pore volumes we observed that more than 40 of pore throats were filled with the inflow solution ph value of 3 0 while 1 pore throats retained their calcite equilibrated solution figure s3a compared to experiment e1 hq the lower injection rate in experiment e2 lq further delayed the attainment of steady state for different part of the sample figure s4 consequently after around 1996 pore volumes of acid injection in the experiment e2 lq a significant fraction of pore throats were filled with solutions having ph values larger than 7 figure s3b fig 4 compares the evolution of porosity and permeability in the reactive transport model rtpnm against the experimental porosity and permeability data obtained from the time lapse micro ct images experimental data of changes in porosity were calculated from the porosities of the extracted pore networks that were derived from the digital images of the sample belonging to the start and end of the experiment table 3 the model showed a smaller amount of dissolved calcite compared to the measured experimental values fig 4a a possible cause could be the deviation of the implemented rates in models from those operating in the experiments such deviation can cause for example slower penetration rate of the acid in the simulations compared to the experiment for the model related to the experiment e1 hq 2442 pore volumes of acid injection were not sufficient to attain a complete steady state ph in the system fig 3e for both experiments we observed a fairly good agreement between the permeability evolution in the reactive transport model krtpnm and in the dissolution experiments kfopnm and kdns fig 4b additionally we observed that for the experiment e2 lq kfopnm agreed well with kdns while for the experiment e1 hq the two values differred significantly fig 4b the difference between permeabilities obtained through fopnm and dns is likely due to the simplification of the pore scale geometrical features during extraction of pore network boever et al 2016 4 2 derivation of the constitutive relations for calculation of pore throat conductance agrawal et al 2020 have shown that the imposed flow and reaction regimes determine the evolution of the pore throat shape and subsequent evolution of conductance during calcite dissolution figs 5 and s5 present the dependency of the conductance of a pore throat on the volume of that pore throat for the simulated flow and reaction regimes while the length and initial radius of the pore throat are fixed at a value of 500 10 6 and 40 10 6 m respectively we observe that at any time during calcite dissolution the updated pore conductance can be related to the modified volume of the pore throat using an exponent b 18 g t g o v t v o b where g t and go are the conductance of the pore throat calculated from eq 4 go at time t 0 s and g t at time t during the course of the dissolution similarly vt and vo are the volume of pore throat at time t 0 s and at time t exponent b represents the distinctiveness and topology of the evolved pore shape since the evolution of the pore throat shape was guided by a number of parameters such as initial geometry of the pore throat and imposed flow and reaction regimes b is a function of these parameters fig 6 a fig 6a shows that under advection dominated regimes indicated by pe 1 and reaction controlled regimes indicated by da 1 the b coefficient approached a value of 2 0 under these regimes the shape of the pore throat remained cylindrical throughout the dissolution period agrawal et al 2020 fig 7 b under this condition i e b 2 0 our relation eq 19 became equal to the hagen poiseuille relation eq 5 for diffusion dominated regimes when pe 1 and reaction dominated regimes when da 1 the cylindrical shape evolved into half hyperboloid shapes agrawal et al 2020 fig 7a for these cases the value of b became smaller than 2 0 and the accurate pore conductance can be calculated from eq 19 it should be noted that here shape evolution implied that the profile of the shape along the flow path changed from cylinder to half hyperboloid longitudinal while cross section of the pore throat i e perpendicular to the flow path remained circular the relation for coefficient b can be expressed as 19 b a 1 2 a 1 1 d a p 3 p e p 4 20 a 1 p 1 g f p 2 values of fitting parameters p 1 p 2 p 3 and p 4 were obtained using nonlinear least squares method si section s1 figure s6a we have obtained a r square value of 0 94 indicating that the fitted relationship and its parameters were able to describe data points figure s6b fig 6b shows the 3d plot of the fitted relation and the corresponding data points in general for reaction regimes corresponding to da 1 and da 1 the fitted relationship captured the dependency of b over pe number da number and gf fig 6b figure s7 shows the sensitivity of the derived model over the testing data set for most of the test data points the difference in the value of b calculated from the fitted model vs that obtained from numerical simulation was within 10 figure s7b this assures the predictive capacity of the proposed model next along with hagen poiseuille s relation we have used our developed relation to perform pore network model simulations hereafter these two pore network models will be referred as rtpnm and nrtpnm i e new model in nrtpnm at each time step of the simulation using the updated pe number da number and gf the b value was calculated for each pore throat of the pore network subsequently for each pore throat of the pore network the modification in conductance was calculated in sections 4 3 and 4 4 we compare the impact of these two pore network modeling approaches on the evolution of the permeability of the sample 4 3 nrtpnm under flow and reaction regimes of micro ct experiments for the experiment e1 hq diffusion dominated pore throats are highlighted in red in figure s8a after injection of around 2442 pore volumes these pore throats either had pe 0 0001 i e diffusion was the major transport mechanism or 0 0001 pe 1 i e both diffusion and low velocity convection were controlling the transport part of the diffusion dominated pore throats mostly pore throats with pe 0 0001 had a da number greater than 1 highlighted in green color in figure s8b these pore throats will transform into non uniform pore shapes and a value of b smaller than 2 0 is obtained for the calculation of conductance using eq 19 highlighted in yellow color in figure s8c in the experiment e1 hq the fraction of such diffusion dominated and reaction dominated pore throats wass 8 whereas in the experiment e2 lq this fraction was 11 figure s8d s8f we observed that both rtpnm and nrtpnm provided porosity and permeability evolutions that are so similar that the results would overlap in figure s9 this is because the flow conditions for both experiments which were selected to trigger visible porosity changes within the time frame of the micro ct experiments lead predominantly to advection dominated regimes as indicated by large p e numbers table 5 therefore under these flow conditions 89 92 pore throats kept their cylindrical shape during dissolution and nrtpnm agreed equally well as rtpnm with the experimentally determined porosities and permeabilities 4 4 nrtpnm under different flow and reaction regimes this section explores the influence of the injection velocity and ph value of the injected solution over the calcite dissolution processes and subsequent evolution of the petrophysical properties of the sample calcite dissolution is a combination of three processes i transport of the reactants towards the calcite surface ii interaction of reactants with the calcite surface and iii removal of the products away from the calcite surface the fluid velocity inside the pore throat determines the transport rate for the first and the last steps the ph of the solution controls the rate of the second step calcite dissolution increases when a solution with a lower ph value is injected or the injection rates are increased fig 7 shows the impact of changing the injection rate resulting in a different p e number on the evolution of porosity while the ph of the injected solution was fixed at a value of 1 0 for the injection of the same number of pore volumes lowering of the acid injection rates led to dissolution of a higher amount of calcite fig 7 as it increased the residence time of acid within the sample we observed that the reactive transport conditions inside the pore network evolved constantly during dissolution figure s10 these updated reactive transport conditions of the pore throat were utilized in the calculation of new conductance value using eq 19 and 20 comparing results from nrtpnm and rtpnm we observed similarity in the porosity evolution but difference in the permeability evolution fig 7 figures s11 and s12 provide the evolution of porosity and permeability for remaining simulated cases differences in the evolution of permeability in these models are proportional to the number of pore throats transforming into non uniform shapes during dissolution as mentioned earlier these sets of pore throats belong to a diffusion dominated transport regime and a reaction dominated dissolution regime for each of the simulated boundary conditions we have identified the fraction of pore throats which fulfilled this criteria table s3 figure s13 for example for a simulated network s5 injection of a solution with ph of 1 0 and a darcy velocity of 3 17 10 6 m s 1 resulted into development of a non uniform shape for around 60 of pore throats fig 7 p e 1 70 and d a i i 6 13 105 consequently for this case we observed that rtpnm overestimated the permeability by around 27 as compared to nrtpnm for all simulated boundary conditions fig 8 summarizes the percentage difference in the predicted value of permeability from these two models this shows that for flow and reaction regimes corresponding to d a i i greater than 100 the two pore network models started to deviate and for d a i i greater than 103 significant differences incurred in the permeability prediction of the sample 4 5 implications for porosity permeability relationship used at the field scale many continuum scale models use a power law relation to determine the evolution of permeability from the changes in porosity e g hommel et al 2018 21 k t k o t o α where ko and o are the initial permeability and porosity of a sample the fitting parameter α depends on the initial properties of the rock and on the processes controlling the changes in the pore geometry e g parvan et al 2020 the α value can either be obtained through theoretical derivation or through fitting of experiments and models in this study we observed that for a very similar rock sample α is a function of the injection parameters such as darcy velocity and acidity of the injected solution fig 9 see also nogues et al 2013 moreover we observed a temporal variation in α which indicates different phases of dissolution fig 9 fig 9 shows α as a function of the porosity of our samples for a set of simulations first for some of the injection conditions rtpnm provided larger α values by a factor of over 50 as compared to the nrtpnm fig 9 p e 1 70 and d a i i 6 13 105 the initially large α value suggests that the first target of the acid reactions were the highly conductive paths where a small increment in the porosity resulted in large increment in permeability bernabé et al 2003 nogues et al 2013 we observed that the increment in the injection velocity or in the ph of the injected solution led to a consistent increase of α fig 9 irrespective of which model was used rtpnm or nrtpnm this can be explained by the fact that in advection dominated regimes or in reaction controlled regimes the dissolution takes place more uniformly in the sample fig 9 again shows that at certain conditions rtpnm was fine to be used but at other conditions it will give an overestimation 5 conclusions in the context of reactive pore network models for calcite dissolution we have presented new constitutive relations to update pore throat conductance which takes care of the evolving pore throat shape as per the imposed flow and reaction regimes this was achieved through numerical simulation of reactive transport processes on a scale of single capillary pore throat and later extraction of the evolution of conductance of the capillary we observed that for the advection dominated and reaction controlled dissolution regimes the conductance can be updated using the hagen poiseuille relation since the initial cylindrical pore throat shape is maintained during dissolution on the contrary for the diffusion dominated and reaction dominated dissolution regimes the pore throat shape changes to the half hyperboloid i e conical shape and the proposed new conductance relations provides an improved description of the impact on conductance evolution of the pore throat next the derived conductance relations were implemented in pore network simulations and the prediction of permeability was compared with the existing pore network models we observed that corresponding to the micro ct experimental conditions i e p e 974 pe 974 da 59 8 and pe 192 da 303 only d a i i 59 8 and p e 192 d a i i 303 only around 11 of total pore throats were subjected to the conditions which are responsible for the development of the non uniform pore throat shapes consequently estimated permeability from the pore network model remained indifferent to the relations used for updating of conductance of individual pore throats as a result new and existing pnm provided equally good agreement with the permeability of the reacted sample image obtained after the experiment finally we performed a sensitivity study of the new conductance relations across a range of flow and reaction regimes this revealed that the injection of highly acidic solutions with a ph value of 1 0 and at an injection velocity of 3 17 10 6 m s 1 caused 60 of total pore throats to modify their initially cylindrical shapes into non uniform shapes due to dissolution we observed that compared to the newly modified pnm utilization of existing pnm can lead to an overestimation of 27 in the predicted permeability value and an overestimation of over 50 in the fitted exponent α used in the porosity permeability relationship in the context of applications such as the injection of co2 or acidic solution into carbonate rocks pore network models are the most promising tool for the prediction of porosity permeability relations at the representative elementary volume level depending on the reactive flow regime incorporation of the dissolution induced changes of the pore throat shape may be required in order to enhance the prediction capacity of existing pore network models and possibly bring the modeled outcomes closer to field observations for example realistic prediction of porosity permeability changes in the case of development of different dissolution patterns when varied range of injection velocity or solution chemistry are utilized in summary pnm provide constitutive relations for rev s in continuum models that can be used to simulate field sites and we proposed improved constitutive relationships supporting information available additional details on the presented results tables 1 3 and figs 1 13 declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the research work of p a m w and a r is part of the industrial partnership programme i32 computational sciences for energy research that is carried out under an agreement between shell and the netherlands organization for scientific research nwo m w has received funding from the european research council erc under the european union s horizon 2020 research and innovation program grant agreement no 819588 the xmt experiments in this work were performed at ghent university s center for x ray tomography ugct a center of expertise funded by the ghent university special research fund bof ugent under grant bof exp 2017 007 tb am and vc received funding from the research foundation flanders fwo under project grant g051418n tb is a postdoctoral fellow of the research foundation flanders fwo and acknowledges its support under grant 12 0919 n supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103991 appendix supplementary materials image application 1 
252,pore network model simulation pnm is an important method to simulate reactive transport processes in porous media and to investigate constitutive relationships between permeability and porosity that can be implemented in continuum scale reactive transport modeling the existing reactive transport pore network models rtpnms assume that the initially cylindrical pore throats maintain their shape and pore throat conductance is updated using a form of hagen poiseuille relation however in the context of calcite dissolution earlier studies have shown that during dissolution pore throats can attain a spectrum of shapes depending upon the imposed reactive flow conditions agrawal et al 2020 in the current study we derived new constitutive relations for the calculation of conductance as a function of pore throat volume and shape evolution for a range of imposed flow and reaction conditions these relations were used to build animproved new reactive pore network model nrtpnm using the new model the porosity permeability changes were simulated and compared against the existing pore network models in order to validate the reactive transport pore network model we conducted two sets of flow through experiments on two ketton limestone samples acidic solutions ph 3 0 were injected at two darcy velocities i e 7 3 10 4 and 1 5 10 4 m s 1 while performing x ray micro ct scanning experimental values of the changes in sample permeability were estimated in two independent ways through pnm flow simulation and through direct numerical simulation both approaches used images of the samples from the beginning and the end of experiments extracted pore networks obtained from the micro ct images of the sample from the beginning of the experiment were used for reactive transport pnms rtpnm and nrtpnm we observed that for the experimental conditions most of the pore throats maintained the initially prescribed cylindrical shape such that both rtpnm and nrtpnm showed a similar evolution of porosity and permeability this was found to be in reasonable agreement with the porosity and permeability changes observed in the experiment next we have applied a range of flow and reaction regimes to compare permeability evolutions between rtpnm and nrtpnm we found that for certain dissolution regimes neglecting the evolution of the pore throat shape in the pore network can lead to an overestimation of up to 27 in the predicted permeability values and an overestimation of over 50 in the fitted exponent for the porosity permeability relations in summary this study showed that while under high flow rate conditions the rtpnm model is accurate enough it overestimates permeability under lower flow rates keywords carbonate dissolution reactive transport micro ct pore network model porosity permeability relation 1 introduction numerous applications require an understanding of fluid interactions with porous solid phases examples include optimization of the recovery from hydrocarbon reservoirs and prediction of the long term consequences of co2 injection in the subsurface calcite dissolution is an important reaction in the subsurface reservoirs several studies have demonstrated that during calcite dissolution a multitude of physical and chemical processes operate at the pore scale which govern the evolution of the porous medium such modification of the porous medium and the related porosity permeability relations is a function of the initial heterogeneity of the rock and of the dissolution conditions like the injection rate and chemistry of the injected fluid e g agrawal et al 2020 golfier et al 2002 hoefner and fogler 1988 li et al 2008 luquot et al 2014 luquot and gouze 2009 meile and tuncay 2006 molins et al 2014 one approach to comprehend the complexity of calcite dissolution process is through using pore scale models such as pore network models pnms several pore network formulations have been developed to present porous media topology and angular pore geometries acharya et al 2005 al gharbi and blunt 2005 ghanbarian b hunt a g 2016 raoof et al 2013 raoof and hassanizadeh 2012 raoof and hassanizadeh 2009 some studies have used pore throats with varying shapes such as sinusoidal or other converging diverging shapes acharya et al 2005 al gharbi and blunt 2005 for which analytical expressions can be applied to calculate pore conductance acharya et al 2005 ghanbarian b hunt a g 2016 raoof and hassanizadeh 2012 correct estimation of the hydraulic conductance values of the pores throats is required to obtain an accurate permeability for the sample in the context of calcite dissolution the existing pore network models use a network of spherical pores bodies and cylindrical pore throats to simulate the related reactive transport processes mehmani et al 2012 nogues et al 2013 raoof et al 2012 these pore network models provide porosity permeability relations as a function of the specific dissolution condition which is a key input for continuum scale models an important consideration in the existing pore network models is related to the way conductance of the pore throat is updated during the calcite dissolution most pore network models assume that pore throats having initially a uniform circular cross section along their length preserve their form throughout dissolution irrespective of the flow and reaction regimes consequently in response to dissolution pore conductance values can be calculated using the hagen poiseuille relation however it has been shown that initially uniform pore throat structures can develop into a spectrum of pore throat shapes with circular cross sections of variable diameter along their length depending on the flow and reaction regimes e g agrawal et al 2020 for example under diffusion and reaction dominated dissolution regimes the pore throat structure changes into a half hyperboloid i e conical shape under this condition the hagen poiseuille equation would result in an overestimation of pore throat conductance agrawal et al 2020 showed that the conductance evolution in the pore network models should include information on pore throat shape evolution that takes the reaction regime into account as mentioned earlier some pnms have been developed with originally non uniform shapes of pore throats however no pore network based study has incorporated the dissolution induced evolution of pore throat shapes in this study we link the evolving shape of pore throats under a wide range of conditions to the resulting pore throat conductance values using reactive transport simulations we implemented the correlation relations for the evolution of conductance as a function of pore throat shape and volume agrawal et al 2020 in a pore network extracted from experimental micro ct data to simulate reactive transport across the rock sample in a modified pnm the outcome was compared to the hagen poiseuille pnm approach and to the permeability evolution determined experimentally using micro ct finally the impact of the new conductance evolution relationship on porosity permeability relations was tested for a range of flow and reaction regimes 2 experimental method in this study we used an oolitic limestone sample ketton limestone quarried from the upper lincolnshire limestone formation village of ketton in rutland england two plugs with a diameter of 6 mm and an approximate length of 12 mm were extracted from the homogeneous oolitic block hereafter these samples are referred as k1 and k2 two sets of reactive transport experiments were conducted on these samples the injecting solution contained hcl acid with a ph value of 3 0 applied under two flow rates provided in table 1 the environmental micro ct emct scanner bultreys et al 2016 at the center for x ray tomography www ugct ugent be was used to image the progress of calcite dissolution with a reconstructed voxel size of 6 µm each dynamic scan consisted of 2200 projections recorded in a total scan time of around 15 min the sample was scanned at the beginning and at the end of the experiment data from raw projections were reconstructed into a 3d stack volume using the filtered back projection method implemented in octopus software vlassenbroeck et al 2007 next 3d datasets were filtered using a non local means filter and segmented with the watershed segmentation method avizo 9 5 0 table 1 provides the porosity values computed from the segmented image volumes of the sample from the beginning of the experiments we observed that the computed porosity values in this study fall within the range of earlier reported image based segmentation porosity values for the ketton rock e g table 3 in menke et al 2017 these values differ from the measured bulk porosity e g table 1 in menke et al 2017 indicating that image segmentation include some unavoidable deviations from the measured bulk porosity values for both experiments the size of the segmented 3d volume was 1318 1316 2494 voxels from which smaller sub volumes were used in this study as discussed in section 3 2 1 3 numerical methods we performed pore scale modeling at three different levels i single pore scale where we simulated reactive transport for a single evolving pore space under different conditions cf agrawal et al 2020 ii pore network scale where rock dissolution is simulated using pnm and iii direct numerical simulations dns using 3d imaged pore structures where detailed flow field is obtained by simulating incompressible flow in the rock images the single pore scale model provided insight on the evolution of the conductance of a pore throat for a range of physiochemical conditions and was previously validated against experimental microfluidic experiments agrawal et al 2020 in the current work we develop constitutive relationships for dissolution induced conductance based on results from this systematic single pore model the evolution of porosity and permeability observed in the pore network model was validated against a direct numerical solution of flow across the sample next for a range of flow and reaction regimes pore network models were run with and without the new improved conductance relationships and the permeability results of both models were compared table 2 summarizes key details of various simulations used in this study 3 1 single pore scale model pore scale reactive transport utilizing a single capillary geometry were simulated by solving the stokes equations for fluid flow and advection diffusion reaction equations for reactive transport of aqueous species comsol multiphysics readers are referred to agrawal et al 2020 for details of the simulations and their validation against microscopic experiments of reactive transport in calcite crystals the modeled range of boundary conditions i e injection rate composition of injecting solution and pore throat geometry correspond conditions relevant to injection of co2 or acidic solution into carbonate rocks details of the simulated flow regimes reaction regimes and pore throat geometries are provided in table s1 to investigate the control of the reaction and flow regimes over the evolution of pore throat conductance we calculated three dimensionless parameters including the péclet number the damköhler number and the geometry factor at the beginning of each simulation the péclet number pe was defined as 1 p e v r d where v is the average velocity at the inlet boundary r is the radius of the pore throat m and d is the diffusion coefficient i e 3 36 10 9 m2 s 1 the damköhler number da was defined as 2 d a r k v c c a l c i t e where ccalcite is the density of surface sites of calcite i e 0 8 10 5 mol m 2 and k mol m 2 s 1 is obtained based on the forward rate constant in the kinetic rate law for calcite dissolution i e the reaction rate constant k 1 in eq 11 in section 3 3 2 and the activity of h ions i e ah in eq 11 in section 3 3 2 in the injected solution the geometry factor gf was defined as 3 g f l r where l is the length of the pore throat the conductance g m5 n 1 s 1 of the pore throat was calculated from the imposed volumetric flux f m3 s 1 and the pressure drop across the pore throat δpsp n m 2 as 4 f g δ p s p in the case of a cylindrical pore throat geometry and laminar flow eq 4 is equivalent to the following definition of conductance g 5 g π r 4 8 μ l where μ is the viscosity of water 0 001 pa s at about 25 c section 4 2 provides the modified relations for the calculation of the pore throat conductance for a range of flow and reaction regimes 3 2 pore network generation 3 2 1 pore networks extracted from the digital rock volumes a total of five pore network structures were generated from the micro ct images of ketton using the maximal ball algorithm raeini et al 2017 two subsets of size 700 700 700 voxels k1s1 and k1s2 were obtained from the digital volumes of the sample k1 at two different times i e t 0 and t 102 min similar sized subsets k2s1 and k2s2 were extracted from the digital volumes of the sample k2 at the two experiment times i e t 0 and t 330 min respectively these subsets were utilized for the purpose of validation of the pore network model such that networks k1s1 and k2s1 were the starting pore networks to perform reactive transport simulation note that the selected time duration for both experiments leads to injection of comparable pore volumes i e 2442 in experiment e1 hq and 1996 in the experiment e2 lq table 1 another subset of size 300 300 300 voxel namely k1s3 was extracted from the digital volume of the sample k1 at an experiment time step t 0 min this subset was utilized for the sensitivity study of the modified conductance model presented in section 4 3 the position of these subsets with reference to the full volumes of the ketton sample is shown in figs 1 and s1 fig 2 shows the frequency distribution of properties of the extracted pore networks such as pore body radius pore throat radius pore throat length and coordination number table 3 provides the statistics of each extracted pore network 3 3 pore network model the pore network model utilized in this study is an adaptation of the previously developed pore scale model by raoof et al 2012 in the following this model is discussed briefly 3 3 1 flow and solute transport for this study single phase flow was established across the pore network this was achieved by assuming laminar flow along each pore throat of the network i e reynolds number is less than 1 flux through a pore throat was described by the hagen poiseuille equation as 6 q i j g i j p j p i where qij is total volumetric flux through the pore throat ij gij is the conductance of the pore throat ij and pi and pj are the pressures in pore bodies i and j respectively the simulated pore network models in this study utilized the hagen poiseuille relation i e eq 5 and modified conductance relations i e eqs 18 for calculation of the pore throat conductance for incompressible saturated flow conditions the sum of fluxes of all pore throats connected to a pore body was equated to zero this implies that the amount of flux going to a pore body should be equal to the amount of flux coming out of that pore body 7 j 1 n k q i j 0 j 1 2 n k where nk is the coordination number of pore body k eq 7 is valid for all pore bodies of the network except those present at the inlet and outlet face of the network combination of eqs 6 and 7 resulted in a linear system of equations to be solved for the pressure of the pore bodies and the volumetric flux through the pore throats we have used a constant darcy velocity boundary condition at the inlet face a constant pressure i e atmospheric pressure boundary condition at the outlet face and no slip boundary conditions was applied at the lateral faces of the network from the imposed darcy velocity ud and pressure difference between the inlet and outlet faces δppnm the absolute permeability of the pore network is calculated from 8 k p n m μ u d l δ p p n m where l is the length of the pore network along the flow direction all the chemical components are transported through the pore network by advection and diffusion processes for a given pore body i and for the flow conditions under which fluid flowing from pore body j towards pore body i through pore throat ij we can define the transport of the kth chemical component as 9 v i d d t c k i j 1 n i n t h r o a t q i j c k i j q i c k i j 1 z i d a i j c k i j c k i l i j r k i where vi qi and c k i are the volume volumetric flow rate and concentration of kth component in pore body i respectively the left hand side l h s of the eq 9 provides the rate of change of concentration for the kth component in the pore body i over time this rate is a combined output of the advective diffusive and reactive rates the first term on the right hand side r h s of the eq 9 calculates the total amount of the incoming flux of each component through n i n t h r o a t upstream pore throats i e pore throats flowing into pore body i this calculation utilizes the volumetric flow rate qij and concentration c k ij in pore throat ij the second term on the r h s calculates the total outflux of the kth component the third term on the r h s calculates the diffusion rate of the kth component through zi connected pore throats this calculation utilizes the molecular diffusion coefficient d and the cross sectional area of the throat aij the last r h s term r k i defines changes due to chemical reactions of the kth component taking place inside the pore body similarly the mass balance equation for pore throat ij and for the case when the fluid is flowing from pore body j to pore throat ij can be written as 10 v i j d d t c k i j q i j c k j q i j c i j d a i j c k j c k i j l i j d a i j c k i c k i j l i j r k i j where vij qij and c k ij are the volume volumetric flow rate and concentration of kth component in pore throat ij respectively r k ij provides feedback from reactions of the kth component taking place inside the pore throat 3 3 2 reactions and rate laws to describe the calcite dissolution system we have incorporated a total of four reactions out of those four reactions three reactions involving only aqueous species are described using equilibrium relationships whereas the dissolution of calcite is described by a kinetic rate law details of equilibrium reactions are provided in table 4 plummer et al 1978 has identified three main mechanisms through which calcite dissolution takes place accordingly we have defined the calcite dissolution rate as 11 r a t e a k 1 a h k 2 a h 2 c o 3 k 3 1 a c a 2 a c o 3 2 k e q where a is the reactive surface area of calcite and ai is the activity of species i k 1 8 64 10 5 m s 1 k 2 4 78 10 7 m s 1 and k 3 2 34 10 9 m s 1 are reaction rate constants at 25 c plummer and busenberg 1982 keq 10 8 48 is the equilibrium constant for calcite dissolution plummer and busenberg 1982 3 3 3 modeling parameters we have utilized two sets of flow and chemical conditions for pore network modeling the first set is derived from the experimental parameters table 1 and the second set covers the range of reaction and flow regimes which are relevant to acid stimulation experiments in carbonate reservoirs in the experiments we injected the solutions at a fixed flow rate table 5 provides the magnitude of the calculated darcy velocity for the experiments e1 hq and e2 lq models corresponding to these experiments utilized the respective value of the darcy velocity for injecting a solution with the ph value of 3 0 additional sets of utilized darcy velocities and ph of the injected solutions are provided in table 5 lower ph values of the injected acid are relevant to acid stimulation applications in carbonate reservoirs al ameri and gamadi 2020 janbumrung and trisarn 2017 leong and ben mahmud 2019 the composition of these solutions was calculated using phreeqc parkhurst and appelo 2013 and phreeqc dat database table s2 in order to categorize the simulated flow and reaction regimes we have defined the macroscopic peclet number p e and damköhler numbers d a i and d a i i as 12 p e u d l d 13 d a i l 2 k 1 a h d c c a l c i t e 14 d a i i l k 1 a h u d c c a l c i t e where ud is the darcy velocity m s 1 and l is the length of the pore network along the flow direction table 5 provides p e d a i and d a i i numbers for all the simulated models note that the pe and da numbers without sign were defined at the scale of an individual throat while pe and da numbers with sign were defined at the scale of pore network 3 4 direct flow simulation of pore scale images in order to compare the permeability values obtained from pnm results we have performed pore scale flow dns we have used the volume of fluid vof method implemented in openfoam computational fluid dynamic cfd package to solve incompressible flow using a semi implicit method for pressure aslannejad et al 2018 bedram and moosavi 2011 numerical three dimensional simulation of incompressible linear viscous flow was done by solving the navier stokes equations 15 ρ u t u u p μ 2 u 16 u 0 where p is pressure u is velocity μ is the viscosity of water μ 0 001 pa s and ρ is the density of water ρ 1000 kg m 3 the flow equations are solved by applying a constant pressure difference between the inlet and the outlet faces δpi and a no slip boundary condition at the remaining faces this yielded the velocity and pressure for each voxel in the domain the flow rate q m3 s 1 was calculated as q u x a x where ax m2 is the cross sectional area of the inlet face perpendicular to the direction of flow x and ux is the inlet face velocity component in the direction of flow from the flow rate q and the imposed pressure difference δpdns absolute permeability of the 3d xmt image kdns m2 is calculated using darcy equation 17 k d n s μ q l x δ p d n s l y l z where lx ly and lz are the domain lengths in each direction 4 results and discussions section 4 1 presents a comparison of the pore network models against the observations from micro ct experiments next using single pore simulations we derived correlation relations for the conductance of pore throats in section 4 2 these relations were implemented in the new pnm nrtpnm section 4 3 provides comparison of permeability evolution from nrtpnm versus rtpnm for the experimental conditions section 4 4 extends this comparison for a range of transport and reaction regimes in section 4 5 we present the impact of flow and reaction conditions over the porosity permeability relations obtained from nrtpnm versus rtpnm 4 1 validation of the reactive transport pore network model rtpnm with the micro ct experiments two rock pore networks i e k1s1 and k2s1 were simulated with similar initial and boundary conditions to the experiments e1 hq and e2 lq respectively at time t 0 samples were filled with a fluid solution equilibrated with calcite in the experiment e1 hq injection of a solution with a ph value of 3 0 initiated calcite dissolution which shows itself as a decreasing amount of calcite in fig 3 e fig 3a d shows the corresponding time based evolution of the average chemical species concentrations the ph of the solution inside the sample decreased continuously as a larger number of pores were penetrated by the acidic solution fig 3a d the acid arrival time for each pore throat depends on its distance from the inlet boundary and its connectivity with the dominant flow channels the inlet area of the sample reaches a steady state in shorter time compared to the outlet area figure s2 moreover the steady state ph of the inlet area is lower than that of the outlet area figure s2 this indicates that within the simulation time a significant number of pore throats located in the outlet area were not yet filled with the inflow solution chemistry from the distribution of ph of the solution inside the sample after injection of around 2442 pore volumes we observed that more than 40 of pore throats were filled with the inflow solution ph value of 3 0 while 1 pore throats retained their calcite equilibrated solution figure s3a compared to experiment e1 hq the lower injection rate in experiment e2 lq further delayed the attainment of steady state for different part of the sample figure s4 consequently after around 1996 pore volumes of acid injection in the experiment e2 lq a significant fraction of pore throats were filled with solutions having ph values larger than 7 figure s3b fig 4 compares the evolution of porosity and permeability in the reactive transport model rtpnm against the experimental porosity and permeability data obtained from the time lapse micro ct images experimental data of changes in porosity were calculated from the porosities of the extracted pore networks that were derived from the digital images of the sample belonging to the start and end of the experiment table 3 the model showed a smaller amount of dissolved calcite compared to the measured experimental values fig 4a a possible cause could be the deviation of the implemented rates in models from those operating in the experiments such deviation can cause for example slower penetration rate of the acid in the simulations compared to the experiment for the model related to the experiment e1 hq 2442 pore volumes of acid injection were not sufficient to attain a complete steady state ph in the system fig 3e for both experiments we observed a fairly good agreement between the permeability evolution in the reactive transport model krtpnm and in the dissolution experiments kfopnm and kdns fig 4b additionally we observed that for the experiment e2 lq kfopnm agreed well with kdns while for the experiment e1 hq the two values differred significantly fig 4b the difference between permeabilities obtained through fopnm and dns is likely due to the simplification of the pore scale geometrical features during extraction of pore network boever et al 2016 4 2 derivation of the constitutive relations for calculation of pore throat conductance agrawal et al 2020 have shown that the imposed flow and reaction regimes determine the evolution of the pore throat shape and subsequent evolution of conductance during calcite dissolution figs 5 and s5 present the dependency of the conductance of a pore throat on the volume of that pore throat for the simulated flow and reaction regimes while the length and initial radius of the pore throat are fixed at a value of 500 10 6 and 40 10 6 m respectively we observe that at any time during calcite dissolution the updated pore conductance can be related to the modified volume of the pore throat using an exponent b 18 g t g o v t v o b where g t and go are the conductance of the pore throat calculated from eq 4 go at time t 0 s and g t at time t during the course of the dissolution similarly vt and vo are the volume of pore throat at time t 0 s and at time t exponent b represents the distinctiveness and topology of the evolved pore shape since the evolution of the pore throat shape was guided by a number of parameters such as initial geometry of the pore throat and imposed flow and reaction regimes b is a function of these parameters fig 6 a fig 6a shows that under advection dominated regimes indicated by pe 1 and reaction controlled regimes indicated by da 1 the b coefficient approached a value of 2 0 under these regimes the shape of the pore throat remained cylindrical throughout the dissolution period agrawal et al 2020 fig 7 b under this condition i e b 2 0 our relation eq 19 became equal to the hagen poiseuille relation eq 5 for diffusion dominated regimes when pe 1 and reaction dominated regimes when da 1 the cylindrical shape evolved into half hyperboloid shapes agrawal et al 2020 fig 7a for these cases the value of b became smaller than 2 0 and the accurate pore conductance can be calculated from eq 19 it should be noted that here shape evolution implied that the profile of the shape along the flow path changed from cylinder to half hyperboloid longitudinal while cross section of the pore throat i e perpendicular to the flow path remained circular the relation for coefficient b can be expressed as 19 b a 1 2 a 1 1 d a p 3 p e p 4 20 a 1 p 1 g f p 2 values of fitting parameters p 1 p 2 p 3 and p 4 were obtained using nonlinear least squares method si section s1 figure s6a we have obtained a r square value of 0 94 indicating that the fitted relationship and its parameters were able to describe data points figure s6b fig 6b shows the 3d plot of the fitted relation and the corresponding data points in general for reaction regimes corresponding to da 1 and da 1 the fitted relationship captured the dependency of b over pe number da number and gf fig 6b figure s7 shows the sensitivity of the derived model over the testing data set for most of the test data points the difference in the value of b calculated from the fitted model vs that obtained from numerical simulation was within 10 figure s7b this assures the predictive capacity of the proposed model next along with hagen poiseuille s relation we have used our developed relation to perform pore network model simulations hereafter these two pore network models will be referred as rtpnm and nrtpnm i e new model in nrtpnm at each time step of the simulation using the updated pe number da number and gf the b value was calculated for each pore throat of the pore network subsequently for each pore throat of the pore network the modification in conductance was calculated in sections 4 3 and 4 4 we compare the impact of these two pore network modeling approaches on the evolution of the permeability of the sample 4 3 nrtpnm under flow and reaction regimes of micro ct experiments for the experiment e1 hq diffusion dominated pore throats are highlighted in red in figure s8a after injection of around 2442 pore volumes these pore throats either had pe 0 0001 i e diffusion was the major transport mechanism or 0 0001 pe 1 i e both diffusion and low velocity convection were controlling the transport part of the diffusion dominated pore throats mostly pore throats with pe 0 0001 had a da number greater than 1 highlighted in green color in figure s8b these pore throats will transform into non uniform pore shapes and a value of b smaller than 2 0 is obtained for the calculation of conductance using eq 19 highlighted in yellow color in figure s8c in the experiment e1 hq the fraction of such diffusion dominated and reaction dominated pore throats wass 8 whereas in the experiment e2 lq this fraction was 11 figure s8d s8f we observed that both rtpnm and nrtpnm provided porosity and permeability evolutions that are so similar that the results would overlap in figure s9 this is because the flow conditions for both experiments which were selected to trigger visible porosity changes within the time frame of the micro ct experiments lead predominantly to advection dominated regimes as indicated by large p e numbers table 5 therefore under these flow conditions 89 92 pore throats kept their cylindrical shape during dissolution and nrtpnm agreed equally well as rtpnm with the experimentally determined porosities and permeabilities 4 4 nrtpnm under different flow and reaction regimes this section explores the influence of the injection velocity and ph value of the injected solution over the calcite dissolution processes and subsequent evolution of the petrophysical properties of the sample calcite dissolution is a combination of three processes i transport of the reactants towards the calcite surface ii interaction of reactants with the calcite surface and iii removal of the products away from the calcite surface the fluid velocity inside the pore throat determines the transport rate for the first and the last steps the ph of the solution controls the rate of the second step calcite dissolution increases when a solution with a lower ph value is injected or the injection rates are increased fig 7 shows the impact of changing the injection rate resulting in a different p e number on the evolution of porosity while the ph of the injected solution was fixed at a value of 1 0 for the injection of the same number of pore volumes lowering of the acid injection rates led to dissolution of a higher amount of calcite fig 7 as it increased the residence time of acid within the sample we observed that the reactive transport conditions inside the pore network evolved constantly during dissolution figure s10 these updated reactive transport conditions of the pore throat were utilized in the calculation of new conductance value using eq 19 and 20 comparing results from nrtpnm and rtpnm we observed similarity in the porosity evolution but difference in the permeability evolution fig 7 figures s11 and s12 provide the evolution of porosity and permeability for remaining simulated cases differences in the evolution of permeability in these models are proportional to the number of pore throats transforming into non uniform shapes during dissolution as mentioned earlier these sets of pore throats belong to a diffusion dominated transport regime and a reaction dominated dissolution regime for each of the simulated boundary conditions we have identified the fraction of pore throats which fulfilled this criteria table s3 figure s13 for example for a simulated network s5 injection of a solution with ph of 1 0 and a darcy velocity of 3 17 10 6 m s 1 resulted into development of a non uniform shape for around 60 of pore throats fig 7 p e 1 70 and d a i i 6 13 105 consequently for this case we observed that rtpnm overestimated the permeability by around 27 as compared to nrtpnm for all simulated boundary conditions fig 8 summarizes the percentage difference in the predicted value of permeability from these two models this shows that for flow and reaction regimes corresponding to d a i i greater than 100 the two pore network models started to deviate and for d a i i greater than 103 significant differences incurred in the permeability prediction of the sample 4 5 implications for porosity permeability relationship used at the field scale many continuum scale models use a power law relation to determine the evolution of permeability from the changes in porosity e g hommel et al 2018 21 k t k o t o α where ko and o are the initial permeability and porosity of a sample the fitting parameter α depends on the initial properties of the rock and on the processes controlling the changes in the pore geometry e g parvan et al 2020 the α value can either be obtained through theoretical derivation or through fitting of experiments and models in this study we observed that for a very similar rock sample α is a function of the injection parameters such as darcy velocity and acidity of the injected solution fig 9 see also nogues et al 2013 moreover we observed a temporal variation in α which indicates different phases of dissolution fig 9 fig 9 shows α as a function of the porosity of our samples for a set of simulations first for some of the injection conditions rtpnm provided larger α values by a factor of over 50 as compared to the nrtpnm fig 9 p e 1 70 and d a i i 6 13 105 the initially large α value suggests that the first target of the acid reactions were the highly conductive paths where a small increment in the porosity resulted in large increment in permeability bernabé et al 2003 nogues et al 2013 we observed that the increment in the injection velocity or in the ph of the injected solution led to a consistent increase of α fig 9 irrespective of which model was used rtpnm or nrtpnm this can be explained by the fact that in advection dominated regimes or in reaction controlled regimes the dissolution takes place more uniformly in the sample fig 9 again shows that at certain conditions rtpnm was fine to be used but at other conditions it will give an overestimation 5 conclusions in the context of reactive pore network models for calcite dissolution we have presented new constitutive relations to update pore throat conductance which takes care of the evolving pore throat shape as per the imposed flow and reaction regimes this was achieved through numerical simulation of reactive transport processes on a scale of single capillary pore throat and later extraction of the evolution of conductance of the capillary we observed that for the advection dominated and reaction controlled dissolution regimes the conductance can be updated using the hagen poiseuille relation since the initial cylindrical pore throat shape is maintained during dissolution on the contrary for the diffusion dominated and reaction dominated dissolution regimes the pore throat shape changes to the half hyperboloid i e conical shape and the proposed new conductance relations provides an improved description of the impact on conductance evolution of the pore throat next the derived conductance relations were implemented in pore network simulations and the prediction of permeability was compared with the existing pore network models we observed that corresponding to the micro ct experimental conditions i e p e 974 pe 974 da 59 8 and pe 192 da 303 only d a i i 59 8 and p e 192 d a i i 303 only around 11 of total pore throats were subjected to the conditions which are responsible for the development of the non uniform pore throat shapes consequently estimated permeability from the pore network model remained indifferent to the relations used for updating of conductance of individual pore throats as a result new and existing pnm provided equally good agreement with the permeability of the reacted sample image obtained after the experiment finally we performed a sensitivity study of the new conductance relations across a range of flow and reaction regimes this revealed that the injection of highly acidic solutions with a ph value of 1 0 and at an injection velocity of 3 17 10 6 m s 1 caused 60 of total pore throats to modify their initially cylindrical shapes into non uniform shapes due to dissolution we observed that compared to the newly modified pnm utilization of existing pnm can lead to an overestimation of 27 in the predicted permeability value and an overestimation of over 50 in the fitted exponent α used in the porosity permeability relationship in the context of applications such as the injection of co2 or acidic solution into carbonate rocks pore network models are the most promising tool for the prediction of porosity permeability relations at the representative elementary volume level depending on the reactive flow regime incorporation of the dissolution induced changes of the pore throat shape may be required in order to enhance the prediction capacity of existing pore network models and possibly bring the modeled outcomes closer to field observations for example realistic prediction of porosity permeability changes in the case of development of different dissolution patterns when varied range of injection velocity or solution chemistry are utilized in summary pnm provide constitutive relations for rev s in continuum models that can be used to simulate field sites and we proposed improved constitutive relationships supporting information available additional details on the presented results tables 1 3 and figs 1 13 declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the research work of p a m w and a r is part of the industrial partnership programme i32 computational sciences for energy research that is carried out under an agreement between shell and the netherlands organization for scientific research nwo m w has received funding from the european research council erc under the european union s horizon 2020 research and innovation program grant agreement no 819588 the xmt experiments in this work were performed at ghent university s center for x ray tomography ugct a center of expertise funded by the ghent university special research fund bof ugent under grant bof exp 2017 007 tb am and vc received funding from the research foundation flanders fwo under project grant g051418n tb is a postdoctoral fellow of the research foundation flanders fwo and acknowledges its support under grant 12 0919 n supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103991 appendix supplementary materials image application 1 
253,we investigate the combined effects of network scale flow variability and retention due to matrix diffusion on the scaling behavior of transport through fractured media two of the principal mechanisms controlling the transport of solutes through fractured low permeability media are broad distributions of flow velocities and retention times in the solid matrix we study the relative impact of these two processes under different initial conditions using a set of three dimensional discrete fracture network simulations we use these simulations to develop and calibrate an upscaled continuous time random walk ctrw approach for advective transport based on an ornstein uhlenbeck model for the particle velocities that accounts for the fracture matrix coupling using a compound poisson process this ctrw model can be conditioned on the initial solute distribution and allows to observe late time scaling behavior at distances beyond what is feasible to observe using high fidelity direct numerical simulations we determine that the initial distribution of particles leads to marked differences in the persistent long term scale behavior in the solute travel time distributions even those undergoing retention due to matrix diffusion through implementation and analysis of the model keywords fracture networks matrix diffusion solute transport injection mode continuous time random walk 1 introduction the transit time of solutes carried along by flows within low permeability low porosity fractured media is determined by the interplay of multiple phenomena berkowitz 2002 bonnet et al 2001 national research council 1996 the national academies of sciences engineering and medicine 2021 neuman 2005 tsang and neretnieks 1998 tsang 1991 two of the principal mechanisms that govern the behavior of solutes are the structure of heterogeneous fluid velocity field within the fracture network through which the solute advects cvetkovic et al 1999 de dreuzy et al 2012 edery et al 2016 grindrod and impey 1993 hyman et al 2019a hyman 2020 kang et al 2011 painter et al 2002 and mass transfer between mobile and immobile zones e g diffusion into and out of the rock matrix surrounding the fracture network becker and shapiro 2000 carrera et al 1998 neretnieks 1980 grisak and pickens 1980 haggerty et al 2001 hyman et al 2019c małoszewski and zuber 1985 maloszewski and zuber 1993 meigs and beauheim 2001 the relative impact of these two mechanisms depends on various hydrological and geophysical conditions including how solutes enter the fracture network and properties of the rock matrix carrera et al 1998 shapiro 2001 zhou et al 2007 in general the initial distribution of a solute entering a domain can be described using one of two conceptualizations resident based and flux weighted injection kreft and zuber 1978 physically resident based injection corresponds to a source that introduces a solute uniformly throughout an input area for this reason it is also referred to as uniform injection this boundary condition can be achieved in experiments or simulations by injecting a constant amount of mass into all inflow channels in the field it could correspond to multiple leaking canisters within a buffer zone surrounding a subsurface waste repository in contrast flux weighted injection corresponds to a solute released in proportion to the in flowing volumetric flow rate at a location of insertion this boundary condition can be achieved by maintaining a constant concentration at all inflow channels and would correspond to a miscible chemical released into a packed off bore hole connected to multiple hydraulically active fractures these two injection modes are known to result in different transport behaviors through both fractured and heterogeneous porous media demmy et al 1999 frampton and cvetkovic 2009 2011 gotovac et al 2009 2010 janković and fiori 2010 hyman et al 2015b kang et al 2017 2020 vanderborght et al 1998 puyguiraud et al 2019b comolli et al 2019 the initial condition determines what regions in the domain are sampled by the particles during a pre asymptotic non ergodic period when particles enter the domain according to flux weighting under ergodic conditions the distribution of lagrangian velocities sampled at equal distances along a pathline is stationary and can be related directly to the eulerian velocity pdf through flux weighting dentz et al 2016 comolli and dentz 2017 kang et al 2017 hyman et al 2019b in contrast particles sample the unweighted eulerian velocity distribution along the inlet plane under resident initial conditions as particles move through the system they channelize into regions of higher velocity and evolve into the steady state lagrangian distribution hyman et al 2015b i e the velocity pdf is not initially stationary the particles injected under resident conditions sample more low velocities than their flux weighted counterparts and in turn lower decay exponents in the advective travel time distributions are commonly observed frampton and cvetkovic 2009 kang et al 2017 2020 hyman et al 2015b while these studies concerning the influence of particle injection mode have advanced our understanding of the impact of initial positions on transport little is comparatively understood about the combined effects of injection mode and matrix diffusion field and laboratory experiments as well as numerical simulations have shown that solutes undergoing matrix diffusion exhibit power law scaling in the tails of the travel time distribution becker and shapiro 2000 berkowitz and scher 1995 cushman and o malley 2015 haggerty et al 2001 hyman et al 2019c małoszewski and zuber 1985 maloszewski and zuber 1993 meigs and beauheim 2001 in the classical model of matrix diffusion this power law tail decays with an exponent of 3 2 małoszewski and zuber 1985 tsang 1995 hadermann and heer 1996 however there are tracer tests in fractured rock that exhibit breakthrough curves where the exponent deviates from this classical prediction haggerty et al 2001 meigs and beauheim 2001 becker and shapiro 2000 a number of theories and interpretations have been proposed to explain these differences haggerty et al 2000 carrera et al 1998 hyman et al 2019c geiger et al 2010 comolli et al 2016 a recent work hyman et al 2019c showed that under particular conditions the interplay between advection and matrix diffusion could lead to power law tailing behavior with exponents deviating from the classically predicted 3 2 if the advective travel time distribution decays sufficiently slowly moreover it was found hyman et al 2019c comolli et al 2016 that the influence of matrix diffusion manifests in breakthrough curves depending on the scale of observation at short distances there is a pre asymptotic time regime that is fully determined by advective heterogeneity while at longer times there is an asymptotic regime that shows the signatures of matrix diffusion we characterize the relative impact of flow heterogeneity and matrix diffusion at different initial conditions on long term transport behavior in fracture networks using a combination of high fidelity simulations and upscaled transport models for the high fidelity models we perform a series of flow and transport simulations in a semi generic three dimensional discrete fracture network dfn at the kilometer scale dfn models are a simulation methodology to model flow and transport through a fractured medium where fractures are explicitly represented cf berre et al 2019 for a review of modern approaches for the simulation flow and transport in fractured media we represent solute transport as a plume of passive tracer particles to characterize the influence of both uniform and flux weighted injection modes we observe particle attributes e g travel time and path line distance at uniformly spaced control planes throughout the network we observe purely advective transport as well as that retarded by matrix diffusion this particle based methodology readily allows for the inclusion of matrix diffusion into a dfn model using a time domain random walk tdrw where the total travel time of a particle is a combination of the time advecting through the in fracture flow field and time spent diffusing into and out of the matrix bodin et al 2003 delay and bodin 2001 hyman et al 2019c painter et al 2008 the computational expense of running dfn simulators limits their usage to study transport at large scales which is required to observe the relative impact of injection mode and matrix diffusion this limitation has prompted the use of upscaled transport models such as the continuous time random walk ctrw and fractional order transport models berkowitz et al 2006 benson et al 2000 dentz et al 2012 fomin et al 2005 2011 to study flow and transport in fractured media to this end we develop a ctrw model for advective transport based on an ornstein uhlenbeck model for the particle velocities and the fracture matrix coupling based on a compound poisson process we calibrate the model using the dfn simulations and then provide observations of transport behavior beyond what is observable using the high fidelity simulations additionally we use this model to derive the expected scalings of the breakthrough curves which we compare to the ctrw observations through implementation and analysis of the models we determine that the initial distribution of particles leads to marked differences in the persistent long term scale behavior undergoing retention due to matrix diffusion 2 solute transport we represent solute transport using a plume of indivisible nonreactive particles i e using a lagrangian approach this section describes how the initial positions of particles are determined and then their movement through the fluid velocity field within the fracture network 2 1 initial positions there are multiple methods to determine the distribution of particles under resident uniform and flux weighted conditions in one numerical method all particles are assigned the same mass and the injection mode is determined by how particles are distributed along the inlet face let m denote the total mass of a solute represented by n individual particles the mass represented by each particle is given by m m n let x 0 denote the set of initial positions along fractures intersecting with the inlet plane denoted ω 0 we use equi spacing uniform distance between points in x 0 along the fracture intersections the value of this distance depends on the total intersection length of fractures along ω 0 and the number of initial posiitions x 0 δ l ω 0 x 0 then the number of particles placed at every position is given by 1 n x 0 n x 0 x 0 x 0 for flux weighting we also need to consider the volumetric flow rate across the entire inflow face and at every point in x 0 the total volumetric flow rate q along ω 0 is defined as 2 q ω 0 d x 0 q x 0 where q x 0 is the volumetric flow rate at x 0 then the number of particles placed at x 0 is proportional to the volumetric flow rate at that point 3 n x 0 n x 0 q x 0 q in an alternative numerical method particles are assigned different portions of the total mass but the same number of particles are assigned to every point in x 0 to represent resident injection the mass of a single particle m x 0 placed at point in x 0 is 4 m x 0 m n x 0 x 0 and for flux weighted 5 m x 0 m n q x 0 q by comparison the two methods for resident injection are clearly equivalent for flux weighting comparison of 3 and 5 indicates that the methods become equivalent as the number of particles or initial positions becomes sufficiently large the primary advantage of the second method is that the number of initial positions can be substantially larger than when using the first method for the same number of particles which can facilitate improved sampling of the velocity field with fewer particles we adopt the second method in our simulations 2 2 particle transport we consider first purely advective transport of particles that originate from the position x 0 in the inlet plane ω 0 located at x 0 which is perpendicular to the mean flow direction the particle position x t evolves according to the advection equation 6 d x t d t u x t x t 0 x 0 the advective transport problem can be formulated equivalently in terms of the distance s t traveled by a particle along a streamline the length s t of the trajectory at a time t is given by 7 ds t dt u x t where we defined the lagrangian velocity magnitude u x t u x t as mentioned above the length of the pathline s is used to parameterize the spatial and temporal coordinates of the particle thus changing variables according to d t u x s d s we obtain for the space time particle trajectory in terms of s 8 d x s d s v s v s d t s d s 1 v s where we defined the space lagrangian velocity v s u x s and its magnitude v s v s when particles arrive at a fracture intersection we assume the flow is diffusion dominated and the probability to enter an outgoing fracture is weighted by the outgoing volumetric flow rate i e a complete mixing rule is applied berkowitz et al 1994 stockman et al 1997 park et al 2001 2003 kang et al 2015 sherman et al 2018 note that this stochastic method at intersections leads to dispersion of particles with the same initial position which would otherwise follow the same deterministic pathline through the network we do not consider molecular diffusion in these simulations there are a variety of mathematical formulations to include the effects of matrix diffusion into transport models cf carrera et al 1998 for a review the general idea is that a source sink term representing mass diffusing into and out of the matrix is included into the solute transport equation a key difference between the proposed models is the form of the source sink term representing matrix diffusion haggerty and gorelick 1995 we account for particles diffusing in and out of the matrix using the time domain random walk tdrw approach detailed in delay and bodin 2001 which is agnostic to the initial distribution of mass into the domain details of the specific implementation are given in appendix a we consider the duration a particle spends within a fracture media to be the sum of the times spent advecting through the fracture network and the times retained within the surrounding rock matrix 3 upscaled transport model in this section we present the ctrw approach for advective transport that is based on an ornstein uhlenbeck model for the particle speeds morales et al 2017 hakoun et al 2019 puyguiraud et al 2019a the fracture matrix coupling is quantified by a compound poisson process furthermore we derive the expected scalings of the breakthrough curves 3 1 advective transport ornstein uhlenbeck model for velocity transitions we model particle motion by a ctrw combined with an ornstein uhlenbeck process for the normal scores of particle velocity as described in the following we assume that the series v s of equidistantly sampled particle speeds see eq 8 form a stationary markov process with the limit distribution p s v under ergodic conditions this means for a sufficiently large injection volume and flow domain the steady space lagrangian pdf p s v and the eulerian velocity pdfs are related through flux weighting dentz et al 2016 comolli and dentz 2017 kang et al 2017 9 p s v v p e v v e stationary markov models for equidistantly sampled particle speeds have been used for the prediction of transport in fractured and benke and painter 2003 kang et al 2011 and porous media le borgne et al 2008b a dentz et al 2016 hakoun et al 2019 puyguiraud et al 2019a stationarity is assumed to hold also for the normal scores w s of particle speeds v s which are defined by 10 w φ 1 p s v p s v 0 v d v p s v where φ w is the cumulative unit gaussian distribution and p s v is the cumulative distribution of particle speeds based on the doob theorem doob 1942 we thus model the evolution of the normal w s with distance s along the streamline by the ornstein uhlenbeck process 11 d w s d s γ w s 2 γ ξ s where ξ s is a gaussian white noise characterized by zero mean and ξ s ξ s δ s s the relaxation parameter γ ℓ c 1 is the inverse of the correlation length scale ℓ c the initial values w 0 w s 0 are given in terms of the initial speeds v 0 v s 0 by 10 the distribution of initial velocities is denoted by p 0 v it varies depending on the injection mode see section 2 1 the particle speed v s is given by w s by inverting 10 as 12 v s p v 1 φ w s the ornstein uhlenbeck model describes the stochastic evolution of v s from an arbitrary initial distribution p 0 v it is a stochastic model for the sequence of particle speeds along trajectories note that this markov model for the particle speeds does not require detailed knowledge of the high fidelity trajectories but only needs as an input the point distribution p s v of particle speeds which can be related to the flow speeds through eq 9 and the characteristic relaxation scale ℓ c particle motion along a streamline is described here by its advective travel time t a s which satisfies according to 8 13 d t a s d s 1 v s where v s is obtained from the ornstein uhlenbeck process described above the ctrw quantifies the travel time t s up to a distance s along streamlines the linear distance x between the inlet and control planes and the distance s along the tortuous streamlines are related through tortuosity χ as x s χ tortuosity is discussed in detail in section 4 3 4 in this sense this approach models the particle trajectories projected onto the mean flow direction this means as one dimensional objects the distribution f v t x of advective travel times at a distance x from the inlet boundary is given by 14 f a t x δ t t a x χ 3 2 matrix diffusion compound poisson process for fracture matrix mass transfer we couple the ctrw model discussed in the previous section with diffusive mass transfer between fracture and matrix the series of residence or trapping times in the matrix is modeled as a compound poisson process margolin et al 2003 benson and meerschaert 2009 comolli et al 2016 russian et al 2016 this assumes that trapping occurs at a constant rate γ which is related to the diffusion time over the fracture cross section the particle time t s at a given distance s along the path is then given by 15 t s t a s τ c t a s τ c t k 1 n t η i the residence times η i in the matrix are distributed according to ψ f t which is specified below the number n t of trapping events up to time t is poisson distributed 16 p n t γ t n exp γ t n the distribution ψ c t t δ t τ c t of τ c t is given in laplace space by 17 ψ c λ exp γ t 1 ψ f λ λ t we consider a semi infinite matrix thus the trapping time distribution is given by the inverse gaussian distribution 18 ψ f t ϵ exp ϵ 2 4 d m t 4 d m t 3 where d m is the diffusion coefficient in the matrix the trapping or residence time distribution is equivalent to the return time distribution to the boundary the microscopic distance ϵ from the interface regularizes the return time distribution which otherwise is not defined in the continuum weiss 1994 redner 2001 the regularization implies that ψ f t decays exponentially fast for times smaller than ϵ 2 d m at times t ϵ 2 d m it behaves as a power law t 3 2 finiteness of the matrix implies a long time cut off at τ d ℓ m 2 d m where ℓ m is a characteristic matrix block scale we assume here that τ d is much larger than the observation time scale the trapping rate is given in terms of the effective fracture aperture b e porosity ϕ and the diffusion coefficient d m as 19 γ 2 ϕ d m ϵ b e as detailed in appendix b the distribution f t x of arrival times at distance x s χ from the inlet boundary is given in analogy to 14 by 20 f t x δ t t x χ it is related to the travel time distribution f a t x by 21 f t x 0 t d t f a t x ψ c t t t this equation reads as follows the probability for a particle arrival at time t is given by the probability that the particle travels to distance x in time t times the probability that the compound trapping time is t t 3 3 scaling of breakthrough curves in order to derive asymptotic expressions for the breakthrough curve scaling at a control plane at x we coarse grain the velocity process on the correlation length ℓ c this means the particle speed is set constant over the distance ℓ c and sampled randomly according to p s v after the distance ℓ c this simplifies the time process 15 according to 22 t n 1 τ n τ c τ n τ n ℓ c v n the distribution ψ t of the combined advective transition and residence times over the distance ℓ c is given in laplace space by 23 ψ λ ψ a λ γ 1 ψ f λ where ψ a t is the steady state distribution of advective travel times it is given in terms of the velocity distribution p s v as 24 ψ a t ℓ c t 2 p s ℓ c t the transition time distribution for the first step of distance ℓ c is accordingly given in terms of the initial velocity distribution p 0 v as 25 ψ 0 t ℓ c t 2 p 0 ℓ c t note that it is through ψ 0 t and p 0 v that the model includes the injection mode of the particles in this coarse grained picture the breakthrough curve f t x is given by the n fold self convolution of the transition time distribution ψ t which reads in laplace space as 26 f λ x ψ 0 λ γ 1 ψ f λ ψ a λ γ 1 ψ f λ n c 1 where n c x χ ℓ c we note that the transition time distribution here behaves as ψ a t t 1 β with 1 β 2 while the initial velocity distribution may scale as ψ 0 t t 1 α with 0 α 2 note that the exponent β in the steady state transition time distribution cannot be smaller than 1 because it is derived from the flux weighted speed distribution p s v v β 1 if the eulerian speed distribution p e v v α 1 with α 0 at v smaller than some characteristic velocity v 0 it follows that p s v v β 1 with β 1 α 1 the behavior of the breakthrough curves is determined by two relevant times scales the scale t c x c u measures the time for purely advective motion over the distance between the inlet and control planes the time scale τ γ γ 1 is the average time a particle is mobile and the time scale τ e γ 2 ϵ 2 d denotes the time at which particles have spent the same amount of time in the fracture and in the matrix comolli et al 2016 this means for times t τ e advection in the network dominates and for t τ e retention in the matrix is the dominant process we first consider the case of a flux weighted injection such that ψ 0 t behaves approximately as ψ a t for t c t τ e the breakthrough curve is expected to scale as f t t 1 β because transport is dominated by the network scale advective heterogeneity because particles are mostly mobile and transport is dominated by advection in the network for t τ e the matrix is activated as a retention mechanism and the breakthrough curves behaves according to the characteristic f t t 3 2 scaling secondly we consider the case of a uniform injection characterized by ψ 0 t t 1 α with 0 α 1 while ψ a t t 2 α as in the previous case for t c t τ e advection dominates and the breakthrough curve scales as f t t 1 α however for t τ e the behavior of the breakthrough curves is affected by retention in the matrix and retention at the source zone due to slow advection this gives the breakthrough curve scaling f t t 1 α 2 the derivations of these scaling behaviors are detailed in appendix c 4 dfn flow and transport simulations we perform a set of high fidelity three dimensional discrete fracture network dfn simulations using dfnworks hyman et al 2015a to determine the solute breakthrough curves tortuosity of particle paths and distributions of flow and particle speeds we record both the advective breakthrough curves and breakthrough curves of particles undergoing advection and matrix diffusion at uniformly spaced control planes in the domain that are perpendicular to the primary direction of flow we represent solute transport passing through the network using a plume of particles we consider both uniform and flux weighted injection modes for the initial positions of particles we then observe attributes that are input parameters for the ctrw model distribution of particle speeds correlation length and tortuosity these parameters can in principle be obtained from non lagrangian observations hyman et al 2019b 2019a see also section 4 2 here we calibrate the ctrw model in terms of the lagrangian observations and use it for the characterization and prediction of the combined effect of network scale flow heterogeneity and matrix diffusion on solute transport beyond what is possible using the dfn model 4 1 discrete fracture network model we perform flow and transport simulations in a semi generic dfn composed of a single family of disc shaped fractures within a cubic domain with sides of length one kilometer fracture radii r are sampled from truncated power law distribution with exponent α 2 6 and upper and lower cutoffs r u 1000 m r 0 10 m with pdf p r r for the radius 27 p r r α r 0 r r 0 1 α 1 r u r 0 α fractures in geological media are commonly observed to have length distributions that appear to follow a powerlaw distribution bonnet et al 2001 fracture centers are uniformly distributed throughout the domain fracture orientations are sampled from a von mises fisher distribution with intensity parameter κ 0 and mean normal vector of 0 0 1 using the method provided by wood 1994 this method results in normal vectors with a uniform covering of the unit sphere which mimics disordered fractures networks composed of many families klint et al 2004 hyman and jiménez martínez 2018 there are 7055 fractures in the domain which corresponds to a dimensionless density of 14 using the definition provided by de dreuzy et al 2000 which indicates that the domain is 14 times denser than the critical percolation density value berkowitz and balberg 1993 bour and davy 1997 1998 sahimi 1994 the computational mesh of the dfn contains 11 368 981 nodes and 23 089 485 triangles the mesh has been optionally refined near intersections to ensure that gradients in the pressure field which are higher in these regions are properly resolved hyman et al 2014 the hydraulic aperture of the fractures b is positively correlated to the radii via a powerlaw relationship b 5 0 10 4 r and fracture permeability is determined by the cubic law svensk kärnbränslehantering ab 2010 although it is possible to include in fracture aperture variations into three dimensional dfn simulation de dreuzy et al 2012 makedonska et al 2016 frampton et al 2019 we do not do so here our focus is on the interplay of injection mode advective transport and matrix diffusion rather than sub fracture scale variability flow in the fracture network is modeled using the reynolds equation zimmerman and bodvarsson 1996 flow through the network is created by applying a pressure difference of 4 kpa 1m m gradient across the domain aligned with the x axis this pressure difference allows us to observe the effects of both advection and matrix diffusion within this domain and selected matrix properties but is not meant to represent a particular field site no flow boundary conditions are applied along lateral boundaries we use the methods of makedonska et al 2015 and painter et al 2012 to reconstruct eulerian velocity field u x within each dfn fig 1 is an image of the network where fractures planes are colored by the logarithm base 10 of the velocity magnitude divided by the mean velocity magnitude v m 2 72 10 7 m s there are large contrasts in velocity values between fractures and smaller variations within the fractures larger fractures are better connected and more flow passes through them additionally the positive correlation between hydraulic aperture and fracture size results in lower resistance to flow within bigger fractures 4 2 velocity distributions the pdfs of eulerian velocity magnitude speed are directly obtained from the reconstructed u x velocity field and the lagrangian pdfs are obtained using the particle tracking methods described above fig 2 shows the eulerian flux weighted eulerian and the space lagrangian velocity pdfs as well as the space lagrangian velocity pdf at the injection plane for the three fracture networks under consideration under ergodic conditions and for a sufficiently large injection volume and flow domain the steady space lagrangian pdf p s v and the eulerian velocity pdfs are related through flux weighting as previous discussed cf 9 in the samples shown here we see good agreement between the steady s lagrangian pdf and flux weighted pdf at high velocities and the two deviate from one another at low velocity values nonetheless there is good agreement over five orders of magnitude also the inlet velocity distribution appears to be representative of the full eulerian pdf the right panel shows the corresponding transition time distributions by directly inverting the velocity pdfs the solid black lines denote the power law scalings as t 1 β with β 0 2 1 2 0 7 and 1 7 the high probability of low flow speeds translates into power law tails in the transition time pdf as we have seen in section 3 3 power law tails in ψ t gives rise to intriguing non fickian behaviors in the solute breakthrough curves which are discussed in detail in section 5 we conjecture that the behaviors of the distribution of flow speeds and corresponding transition times can be related to network properties such as connectivity and aperture distribution which however needs to be probed in further studies 4 3 lagrangian transport attributes a set of one hundred thousand particles denoted ω a are tracked through the network increasing the number of particles beyond these counts did not influence observed quantities we observe particle attributes at uniformly spaced control planes that are perpendicular to the primary direction of flow placed at 250 500 750 and 1000 m from the inlet 4 3 1 breakthrough curves the first arrival time τ x 1 x 0 of a particle starting at x 0 to reach a control plane located at x is given by 28 τ x 1 x 0 min t x 1 t x 0 x 1 where x 1 t x 0 corresponds to the 1 component of the position vector of the particle originating from the position x 0 and x 1 corresponds to the first spatial component of the position vector the mass represented by each particle m x 0 and τ x 1 x 0 are combined to determine the solute mass flux f t x that has broken through a control plane at x x 1 at a time t 29 f t x 1 1 m ω a d x 0 m x 0 δ τ x 1 x 0 t where δ t is the dirac delta function we refer to 29 as the breakthrough curve we use 29 for both purely advective and advection matrix diffusion travel times in the latter case the diffusion coefficient in the matrix is set to d m 10 13 m 2 s and the porosity ϕ 5 10 2 these values are selected to allow to study both the effects of advection and matrix diffusion for this network and flow field but not meant to represent a particular field site although they do fall within physically reasonable range of values for low permeability rocks zhou et al 2007 4 3 2 equivalent aperture the method implemented to account for matrix diffusion in dfnworks allows for hydraulic apertures to vary between fractures hyman et al 2019c however the presented upscaled transport model requires a single equivalent effective aperture which can be obtained by combining the advective travel time 28 with the lagrangian retention parameter defined in cvetkovic et al 1999 30 0 s 2 d s b s v s dividing twice the advective travel time by 30 provides an integrated value for the resistance along a pathline and an effective aperture value b e f f hyman et al 2016 we observe an average value of b e f f 0 0048 m for flux weighted and b e f f 0 0041 m for resident injection at the outlet plane where the average is taken over all particle trajectories in appendix d we compare the dfn btcs including matrix diffusion using the actual fracture hydraulic apertures that vary between fractures and the effective hydraulic apertures that show good agreement between the two methods 4 3 3 correlation length the autocorrelation of lagrangian velocities is determined using the magnitude of particle velocities sampled equidistantly along pathlines 31 c v v s 1 v 0 ω a d x 0 0 d s v s s v s s s σ v v 2 where σ v v 2 is the velocity variance and v s s the fluctuation about the mean the correlation distance ℓ c is when fluctuations anticorrelate which we take at the first zero crossing of 31 for resident injection ℓ c 221 m and for flux weighted injection ℓ c 204 m note that c v v is a purely advective quantity 4 3 4 tortuosity we focus on a flow dependent geometric tortuosity as it is naturally compatible with lagrangian observations other tortuosity definitions can be found in ghanbarian et al 2013 let s x i x 0 be the total pathline distance of a particle upon its first crossing of a control plane at x x i then the tortuosity of the pathline defined 32 χ x i s i x 0 x i we take the average of χ over ω a under ergodic conditions this means here at a linear distance x 1 ℓ c much larger than the characteristic fracture length the tortuosity is given by koponen et al 1996 33 χ lim x 1 χ x 1 v e u 1 the asymptotic tortuosity for this network is χ 2 54 due to higher number of relatively short fractures which induces a high tortuosity in the particle path note that the asymptotic tortuosity does not depend on the particle injection mode at finite distances however the tortuosity depends on the injection mode and on the local fracture geometry for resident injection χ 2 18 250m 2 63 500m 2 78 750m and 2 55 1000m for flux weighted χ 1 62 250m 2 11 500m 2 63 750m and 2 50 1000m the observed values of tortuosity do not fully stabilize at χ but the observed values at 1000 m are close to these asymptotic value the values of flux weighted particles are always less than those observed for resident injection note that χ is a purely advective quantity 5 results in this section we discuss the behavior of solute breakthrough curves at different control planes we consider two different injection conditions uniform and flux weighted as discussed above we first discuss the case of advective transport and compare the dfn simulations with the ctrw model then we consider advective transport under matrix diffusion again for the two different injection conditions and again compare the dfn simulations with the ctrw model in the following the breakthrough curves for the uniform injection are marked by blue the ones for the flux weighted injection by black lines or symbols 5 1 advective transport fig 3 shows solute breakthrough curves at different control planes for uniform and flux weighted initial conditions the symbols and lines denote the results from the direct numerical simulation and the ctrw model respectively we observe a stronger tailing for the uniform than for the flux weighted injection at all control planes this is due the fact that the uniform injection emphasizes the low speeds in the injection plane while the flux weighted injection emphasizes the high speeds as shown in fig 2 the ctrw model provides a good estimate for the peak and the tail behavior at all distances from the control plane it overestimates early arrivals at control planes close to the inlet this is due to the fact that only a few fractures connect from the inlet to the control planes close to the inlet while the ctrw model simulates access to the full spectrum of fracture velocities thus the prediction of early arrivals improves with distance from the control plane because particles are able to sample a larger part of the velocity spectrum fig 4 shows breakthrough curves for the two different injection modes left uniform and right flux weighted we show both the data from the direct numerical simulations and the ctrw model at 250 and 1000 m we also include the breakthrough curves at dotted lines x 5000 and dash dotted lines 10 4 m which are extrapolations based on the ctrw model we can observe two different power law regimes that correspond to the power laws identified for the speed distributions in fig 2 furthermore we see that the tails of the breakthrough curves for the uniform injection essentially collapse this can be traced back to the fact that the tail behavior here is dominated by the large transition times the particles experience during the first step for the flux weighted injection the tails show the same power law behavior but seem to collapse at much larger times than for the uniform injection 5 2 advective transport under matrix diffusion fig 5 compares breakthrough curves a the control plane at x 1000 m for pure advection and under matrix diffusion for uniform left and flux weighted right initial distributions it clearly illustrates the increased tailing due to solute retention in the matrix again the tailing is stronger for the case of uniform injection in this case strong retention in the source zone due to low flow speeds competes with retention due to matrix diffusion which leads to the power law behavior as t 1 α 2 as discussed in section 3 3 where α is the exponent that characterizes the power law regimes for the velocity distributions shown in fig 2 the breakthrough curves for the flux weighted injection are dominated by matrix diffusion and show the characteristic t 3 2 scaling fig 6 shows breakthrough curves at different control planes for uniform and flux weighted initial conditions under matrix diffusion the ctrw model provides good estimates for peak and the tail behavior at all distances from the injection plane early arrivals are overestimated at control planes close to the injection plane as for the purely advective case this can be traced back to the fact that only a few dominant fractures connect the injection and control plane while the ctrw model simulates availability of the full fracture spectrum thus the ctrw estimates for early arrival times improve with distance from the inlet plane as more fractures are sampled fig 7 shows breakthrough at distances x 250 1000 5000 m and 10000 m from the inlet plane the breakthrough curves at dotted lines x 5000 and dash dotted lines 10 4 m are extrapolations based on the ctrw model the strong retention due to low flow speeds in the source zone combined with matrix diffusion dominates the tail behavior for uniform injection the tails of the breakthrough curves essentially collapse for the flux weighted injection the tails show the same scalings and again seem to collapse at later times 6 conclusions we investigate and upscale the combined effect of flow heterogeneity and matrix diffusion on conservative transport in three dimensional fracture networks under different initial solute distributions direct numerical simulations for flow and particle transport give insight into the advective and diffusive transport mechanisms and the impact of heterogeneity and retention due to matrix diffusion on solute breakthrough curves at different observation planes in order to probe the impact of the initial solute distribution we consider resident uniform particle injections over the inlet plane as well as flux weighted injection we observe significant power law tailing in the solute travel time distribution due to advective heterogeneity and a broad velocity distribution within the networks this tailing is amplified under resident injection in this scenario the solute is distributed equally across all velocities within the inlet plane which leads to stronger retention at the initial plane due to low speeds than for the flux weighted injection condition in the presence of matrix diffusion the breakthrough tailing is amplified both for the flux weighted and resident injection conditions for the flux weighted injection we observe the characteristic t 3 2 late time scaling in the case of resident injection we observe a different scaling in this case the interaction of strong retention due to low flow speeds along with immobilization in the matrix leads to a different scaling behavior we quantify these behaviors using an upscaled ctrw approach that accounts for advective heterogeneity and retention in the matrix conditioned on the initial solute data velocity variability along each pathline is modeled as a stationary markov process where the velocity changes at equidistant positions along the path specifically we map the particle speed onto a gaussian random variable which evolves according to an ornstein uhlenbeck process the proces is parameterized by the lagrangian speed distribution and correlation distance which in principle can be obtained from the eulerian speed pdf and characteristic fracture scale advective transition times are obtained kinematically from the constant transition distance and speed this approach captures the impact of flow variability and injection condition on breakthrough curve tailing we use a compound poisson process to model retention due to diffusion into the matrix blocks which means trapping events occur at a constant rate along a particle pathline the trapping time distribution is governed by an inverse gaussian distribution thus trapping times are sampled from an inverse gaussian random variable where the trapping rate is given by the diffusion coefficient in the matrix matrix porosity and the effective fracture aperture this upscaled approach captures the combined effect of flow heterogeneity and matrix diffusion on solute transport and breakthrough at control planes at variable distances from the inlet and gives analytical predictions for the long time scalings the model relates the intermediate scalings of the breakthrough curves to advective heterogeneity and the distribution of particle and thus flow speeds the latter depends on the network properties such as aperture distribution and correlation between fracture length and aperture hyman et al 2019b in this sense the advective breakthrough curve scalings reflect and change with the network structure the characteristic t 3 2 scaling however is due to the fracture matrix exchange and independent of the medium structure the upscaled model provides insights into the mechanism and the complex interactions between advective and diffusive mass transfer mechanisms furthermore it provides a computationally efficient tool to extrapolate transport to distances and times difficult to reach using direct numerical simulations the upscaled model is parameterized by the distribution of lagrangian speeds which in principle can be inferred from the eulerian speed distribution a flow property by tortuosity and by the velocity correlation scale which depend on the network and flow properties the relation between geometric and hydraulic network properties and these characteristics is an outstanding question that needs to be answered to bridge the gap between medium properties and flow and transport behaviors the proposed upscaled approach captures the main physical transport processes that dominate conservative tracer transport it shows that particle motion in a complex fracture network can be by quantified by an upscaled ctrw model based on a markov process that is parameterized by point statistics of speed and a single correlation scale as well as a poissonian trapping process for fracture matrix echange the proposed mathematical formulation for fracture matrix interaction can be used also to model linear kinetic adsorption of a solute to the solid matrix furthermore the model can be generalized to chemical reactions of single species and between particles by combining the ctrw model with suitable rules for particle survival and interactions credit authorship contribution statement jeffrey d hyman conceptualization methodology software formal analysis investigation writing original draft writing review editing visualization investigation data curation marco dentz conceptualization methodology software formal analysis investigation writing original draft writing review editing visualization investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments jdh thanks the department of energy basic energy sciences program lanle3w1 and the spent fuel and waste science and technology campaign office of nuclear energy of the u s department of energy under contract number los alamos national laboratory is operated by triad national security llc for the national nuclear security administration of u s department of energy contract no 89233218cna000001 this work was prepared as an account of work sponsored by an agency of the united states government the views and opinions of authors expressed herein do not necessarily state or reflect those of the united states government or any agency thereof its contractors or subcontractors md gratefully acknowledges the support of the spanish ministry of science and innovation through the project hydropore pid2019 106887gb c31 los alamos national laboratory unclassified release number la ur 21 22994 appendix a tdrw for matrix diffusion for a pulse injection into a single uniform fracture surrounded by an infinite matrix małoszewski and zuber 1985 derived an analytical solution considering only advection within the fracture the probability density function of travel times exiting the fracture may be obtained from their solution as a 1 p t t f a t f π t t f 3 2 exp a 2 t f 2 t t f if t t f 0 if t t f where t f is the advective travel time through a fracture and a 2 a ϕ d m b here ϕ is the matrix porosity d m is the matrix diffusivity and b is the fracture aperture which can vary between fractures but not within them using this formulation from a 1 the cumulative density function cdf for the travel time distribution in a single fracture that accounting for both advection and matrix diffusion is a 3 f t erfc a t f t t f particle tracking simulations provide the advective travel time of a particle in a fracture t f the time retained in the matrix can be obtained using the inverse cdf method a 4 t d a t f erfc 1 ξ 2 where erfc is the complementary error function and ξ is a random number drawn from the uniform distribution between 0 and 1 the total travel time to pass through a fracture t is the sum of t f and t d starting with the advective travel time of a particle passing through the i th fracture t f i the total travel time is t i t f i t d i and the travel time of the particle through the network is t i i t i where i is the set of all fractures that the particle passes through appendix b trapping rate the relation 19 can be understood by considering the travel time distribution over a single fracture predicted by the eulerian matrix diffusion formulation it is given in laplace space by małoszewski and zuber 1985 hyman et al 2019c b 1 f λ τ f exp λ τ f 2 ϕ τ f a λ φ λ by setting φ λ d m λ we obtain b 2 f λ τ f exp λ τ f τ f 2 ϕ d m a λ note that the factor of 2 comes from the symmetry of matrix diffusion across both fracture matrix interfaces from the ctrw model we obtain in laplace space b 3 f λ τ f exp λ τ f γ 1 p m λ the laplace transform of the trapping time pdf is b 4 p m λ exp λ ϵ 2 d m 1 λ ϵ 2 d m thus the arrival time distribution over a single fracture can be written in the limit ϵ 1 as b 5 f λ τ f exp λ τ f γ ϵ d m λ comparison between b 2 and b 5 gives b 6 2 ϕ d m a γ ϵ d m and thus b 7 γ 2 ϕ d m ϵ a appendix c scaling of breakthrough curves the laplace transform of ψ a t can be expanded as c 1 ψ a λ 1 τ λ a λ τ 0 β where τ is the mean advective transition time τ 0 a characteristic time scale and a a constant that depends on the particular form of ψ a t the laplace transform of ψ 0 t for 1 β 2 is analogous for 0 β 1 the laplace transform of ψ 0 t is given by c 2 ψ 0 λ 1 c λ τ 0 β where c is a constant furthermore we note that the trapping time distribution ψ f t has the laplace transform c 3 ψ f λ exp λ ϵ 2 d m 1 λ ϵ 2 d m we first consider the case ψ 0 t ψ a t such that expression 26 simplifies to c 4 f λ x ψ a λ γ 1 ψ f λ n c using expressions c 1 and c 3 in eq c 4 we can write c 5 f λ x exp n c ln 1 τ λ τ γ λ ϵ 2 d m a τ 0 β λ γ λ ϵ 2 d m β expanding the logarithm gives c 6 f λ x exp t c λ λ τ e a t c τ 1 τ 0 β λ λ τ e β where we defined τ e γ 2 ϵ 2 d and t c n c τ the scale τ e marks the time at which particles have spent in average the same time in the fracture and the matrix for λ τ e 1 we can expand c 7 f λ x 1 t c λ a t c τ 1 τ 0 λ β and thus f t x t 1 β for t c t τ e for times t τ e retention in the matrix dominates the breakthrough curves for λ τ e 1 we can expand c 8 f λ x 1 t c λ τ e and thus f t x t 3 2 we now consider the case that ψ 0 t t 1 α where 0 α 1 and ψ a t t 2 α thus we can expand f λ as c 9 f λ x exp c τ 0 α λ λ τ e α exp t c λ λ τ e a t c τ 1 τ 0 α 1 λ λ τ e α 1 where we set n c 1 τ t c for λ τ 0 1 we can expand c 10 f λ x 1 c τ 0 α λ λ τ e α t c λ λ τ e a t c τ 1 τ 0 α 1 λ λ τ e α 1 for λ τ e 1 we further obtain c 11 f λ x 1 c λ τ 0 α t c λ a t c τ 1 λ τ 0 α 1 for t t c this means λ t c 1 we have in leading order c 12 f λ x 1 c λ τ 0 α which implies that f t t 1 α similarly for λ τ e 1 we can expand c 13 f λ x 1 c τ 0 α λ τ e α 2 which implies f t t 1 α 2 for t τ e appendix d effective aperture fig d 8 compares the dfn btcs including matrix diffusion using the actual fracture hydraulic apertures that vary between fractures blue squares and using the effective hydraulic apertures black circles at the outlet plane x 1 1000 m the left subfigure shows that btcs for resident injection and the right subfigure shows the results for flux weighted there is a slight deviation between the curves at the initial breakthrough but the scaling in the tails of the distributions are the same 
253,we investigate the combined effects of network scale flow variability and retention due to matrix diffusion on the scaling behavior of transport through fractured media two of the principal mechanisms controlling the transport of solutes through fractured low permeability media are broad distributions of flow velocities and retention times in the solid matrix we study the relative impact of these two processes under different initial conditions using a set of three dimensional discrete fracture network simulations we use these simulations to develop and calibrate an upscaled continuous time random walk ctrw approach for advective transport based on an ornstein uhlenbeck model for the particle velocities that accounts for the fracture matrix coupling using a compound poisson process this ctrw model can be conditioned on the initial solute distribution and allows to observe late time scaling behavior at distances beyond what is feasible to observe using high fidelity direct numerical simulations we determine that the initial distribution of particles leads to marked differences in the persistent long term scale behavior in the solute travel time distributions even those undergoing retention due to matrix diffusion through implementation and analysis of the model keywords fracture networks matrix diffusion solute transport injection mode continuous time random walk 1 introduction the transit time of solutes carried along by flows within low permeability low porosity fractured media is determined by the interplay of multiple phenomena berkowitz 2002 bonnet et al 2001 national research council 1996 the national academies of sciences engineering and medicine 2021 neuman 2005 tsang and neretnieks 1998 tsang 1991 two of the principal mechanisms that govern the behavior of solutes are the structure of heterogeneous fluid velocity field within the fracture network through which the solute advects cvetkovic et al 1999 de dreuzy et al 2012 edery et al 2016 grindrod and impey 1993 hyman et al 2019a hyman 2020 kang et al 2011 painter et al 2002 and mass transfer between mobile and immobile zones e g diffusion into and out of the rock matrix surrounding the fracture network becker and shapiro 2000 carrera et al 1998 neretnieks 1980 grisak and pickens 1980 haggerty et al 2001 hyman et al 2019c małoszewski and zuber 1985 maloszewski and zuber 1993 meigs and beauheim 2001 the relative impact of these two mechanisms depends on various hydrological and geophysical conditions including how solutes enter the fracture network and properties of the rock matrix carrera et al 1998 shapiro 2001 zhou et al 2007 in general the initial distribution of a solute entering a domain can be described using one of two conceptualizations resident based and flux weighted injection kreft and zuber 1978 physically resident based injection corresponds to a source that introduces a solute uniformly throughout an input area for this reason it is also referred to as uniform injection this boundary condition can be achieved in experiments or simulations by injecting a constant amount of mass into all inflow channels in the field it could correspond to multiple leaking canisters within a buffer zone surrounding a subsurface waste repository in contrast flux weighted injection corresponds to a solute released in proportion to the in flowing volumetric flow rate at a location of insertion this boundary condition can be achieved by maintaining a constant concentration at all inflow channels and would correspond to a miscible chemical released into a packed off bore hole connected to multiple hydraulically active fractures these two injection modes are known to result in different transport behaviors through both fractured and heterogeneous porous media demmy et al 1999 frampton and cvetkovic 2009 2011 gotovac et al 2009 2010 janković and fiori 2010 hyman et al 2015b kang et al 2017 2020 vanderborght et al 1998 puyguiraud et al 2019b comolli et al 2019 the initial condition determines what regions in the domain are sampled by the particles during a pre asymptotic non ergodic period when particles enter the domain according to flux weighting under ergodic conditions the distribution of lagrangian velocities sampled at equal distances along a pathline is stationary and can be related directly to the eulerian velocity pdf through flux weighting dentz et al 2016 comolli and dentz 2017 kang et al 2017 hyman et al 2019b in contrast particles sample the unweighted eulerian velocity distribution along the inlet plane under resident initial conditions as particles move through the system they channelize into regions of higher velocity and evolve into the steady state lagrangian distribution hyman et al 2015b i e the velocity pdf is not initially stationary the particles injected under resident conditions sample more low velocities than their flux weighted counterparts and in turn lower decay exponents in the advective travel time distributions are commonly observed frampton and cvetkovic 2009 kang et al 2017 2020 hyman et al 2015b while these studies concerning the influence of particle injection mode have advanced our understanding of the impact of initial positions on transport little is comparatively understood about the combined effects of injection mode and matrix diffusion field and laboratory experiments as well as numerical simulations have shown that solutes undergoing matrix diffusion exhibit power law scaling in the tails of the travel time distribution becker and shapiro 2000 berkowitz and scher 1995 cushman and o malley 2015 haggerty et al 2001 hyman et al 2019c małoszewski and zuber 1985 maloszewski and zuber 1993 meigs and beauheim 2001 in the classical model of matrix diffusion this power law tail decays with an exponent of 3 2 małoszewski and zuber 1985 tsang 1995 hadermann and heer 1996 however there are tracer tests in fractured rock that exhibit breakthrough curves where the exponent deviates from this classical prediction haggerty et al 2001 meigs and beauheim 2001 becker and shapiro 2000 a number of theories and interpretations have been proposed to explain these differences haggerty et al 2000 carrera et al 1998 hyman et al 2019c geiger et al 2010 comolli et al 2016 a recent work hyman et al 2019c showed that under particular conditions the interplay between advection and matrix diffusion could lead to power law tailing behavior with exponents deviating from the classically predicted 3 2 if the advective travel time distribution decays sufficiently slowly moreover it was found hyman et al 2019c comolli et al 2016 that the influence of matrix diffusion manifests in breakthrough curves depending on the scale of observation at short distances there is a pre asymptotic time regime that is fully determined by advective heterogeneity while at longer times there is an asymptotic regime that shows the signatures of matrix diffusion we characterize the relative impact of flow heterogeneity and matrix diffusion at different initial conditions on long term transport behavior in fracture networks using a combination of high fidelity simulations and upscaled transport models for the high fidelity models we perform a series of flow and transport simulations in a semi generic three dimensional discrete fracture network dfn at the kilometer scale dfn models are a simulation methodology to model flow and transport through a fractured medium where fractures are explicitly represented cf berre et al 2019 for a review of modern approaches for the simulation flow and transport in fractured media we represent solute transport as a plume of passive tracer particles to characterize the influence of both uniform and flux weighted injection modes we observe particle attributes e g travel time and path line distance at uniformly spaced control planes throughout the network we observe purely advective transport as well as that retarded by matrix diffusion this particle based methodology readily allows for the inclusion of matrix diffusion into a dfn model using a time domain random walk tdrw where the total travel time of a particle is a combination of the time advecting through the in fracture flow field and time spent diffusing into and out of the matrix bodin et al 2003 delay and bodin 2001 hyman et al 2019c painter et al 2008 the computational expense of running dfn simulators limits their usage to study transport at large scales which is required to observe the relative impact of injection mode and matrix diffusion this limitation has prompted the use of upscaled transport models such as the continuous time random walk ctrw and fractional order transport models berkowitz et al 2006 benson et al 2000 dentz et al 2012 fomin et al 2005 2011 to study flow and transport in fractured media to this end we develop a ctrw model for advective transport based on an ornstein uhlenbeck model for the particle velocities and the fracture matrix coupling based on a compound poisson process we calibrate the model using the dfn simulations and then provide observations of transport behavior beyond what is observable using the high fidelity simulations additionally we use this model to derive the expected scalings of the breakthrough curves which we compare to the ctrw observations through implementation and analysis of the models we determine that the initial distribution of particles leads to marked differences in the persistent long term scale behavior undergoing retention due to matrix diffusion 2 solute transport we represent solute transport using a plume of indivisible nonreactive particles i e using a lagrangian approach this section describes how the initial positions of particles are determined and then their movement through the fluid velocity field within the fracture network 2 1 initial positions there are multiple methods to determine the distribution of particles under resident uniform and flux weighted conditions in one numerical method all particles are assigned the same mass and the injection mode is determined by how particles are distributed along the inlet face let m denote the total mass of a solute represented by n individual particles the mass represented by each particle is given by m m n let x 0 denote the set of initial positions along fractures intersecting with the inlet plane denoted ω 0 we use equi spacing uniform distance between points in x 0 along the fracture intersections the value of this distance depends on the total intersection length of fractures along ω 0 and the number of initial posiitions x 0 δ l ω 0 x 0 then the number of particles placed at every position is given by 1 n x 0 n x 0 x 0 x 0 for flux weighting we also need to consider the volumetric flow rate across the entire inflow face and at every point in x 0 the total volumetric flow rate q along ω 0 is defined as 2 q ω 0 d x 0 q x 0 where q x 0 is the volumetric flow rate at x 0 then the number of particles placed at x 0 is proportional to the volumetric flow rate at that point 3 n x 0 n x 0 q x 0 q in an alternative numerical method particles are assigned different portions of the total mass but the same number of particles are assigned to every point in x 0 to represent resident injection the mass of a single particle m x 0 placed at point in x 0 is 4 m x 0 m n x 0 x 0 and for flux weighted 5 m x 0 m n q x 0 q by comparison the two methods for resident injection are clearly equivalent for flux weighting comparison of 3 and 5 indicates that the methods become equivalent as the number of particles or initial positions becomes sufficiently large the primary advantage of the second method is that the number of initial positions can be substantially larger than when using the first method for the same number of particles which can facilitate improved sampling of the velocity field with fewer particles we adopt the second method in our simulations 2 2 particle transport we consider first purely advective transport of particles that originate from the position x 0 in the inlet plane ω 0 located at x 0 which is perpendicular to the mean flow direction the particle position x t evolves according to the advection equation 6 d x t d t u x t x t 0 x 0 the advective transport problem can be formulated equivalently in terms of the distance s t traveled by a particle along a streamline the length s t of the trajectory at a time t is given by 7 ds t dt u x t where we defined the lagrangian velocity magnitude u x t u x t as mentioned above the length of the pathline s is used to parameterize the spatial and temporal coordinates of the particle thus changing variables according to d t u x s d s we obtain for the space time particle trajectory in terms of s 8 d x s d s v s v s d t s d s 1 v s where we defined the space lagrangian velocity v s u x s and its magnitude v s v s when particles arrive at a fracture intersection we assume the flow is diffusion dominated and the probability to enter an outgoing fracture is weighted by the outgoing volumetric flow rate i e a complete mixing rule is applied berkowitz et al 1994 stockman et al 1997 park et al 2001 2003 kang et al 2015 sherman et al 2018 note that this stochastic method at intersections leads to dispersion of particles with the same initial position which would otherwise follow the same deterministic pathline through the network we do not consider molecular diffusion in these simulations there are a variety of mathematical formulations to include the effects of matrix diffusion into transport models cf carrera et al 1998 for a review the general idea is that a source sink term representing mass diffusing into and out of the matrix is included into the solute transport equation a key difference between the proposed models is the form of the source sink term representing matrix diffusion haggerty and gorelick 1995 we account for particles diffusing in and out of the matrix using the time domain random walk tdrw approach detailed in delay and bodin 2001 which is agnostic to the initial distribution of mass into the domain details of the specific implementation are given in appendix a we consider the duration a particle spends within a fracture media to be the sum of the times spent advecting through the fracture network and the times retained within the surrounding rock matrix 3 upscaled transport model in this section we present the ctrw approach for advective transport that is based on an ornstein uhlenbeck model for the particle speeds morales et al 2017 hakoun et al 2019 puyguiraud et al 2019a the fracture matrix coupling is quantified by a compound poisson process furthermore we derive the expected scalings of the breakthrough curves 3 1 advective transport ornstein uhlenbeck model for velocity transitions we model particle motion by a ctrw combined with an ornstein uhlenbeck process for the normal scores of particle velocity as described in the following we assume that the series v s of equidistantly sampled particle speeds see eq 8 form a stationary markov process with the limit distribution p s v under ergodic conditions this means for a sufficiently large injection volume and flow domain the steady space lagrangian pdf p s v and the eulerian velocity pdfs are related through flux weighting dentz et al 2016 comolli and dentz 2017 kang et al 2017 9 p s v v p e v v e stationary markov models for equidistantly sampled particle speeds have been used for the prediction of transport in fractured and benke and painter 2003 kang et al 2011 and porous media le borgne et al 2008b a dentz et al 2016 hakoun et al 2019 puyguiraud et al 2019a stationarity is assumed to hold also for the normal scores w s of particle speeds v s which are defined by 10 w φ 1 p s v p s v 0 v d v p s v where φ w is the cumulative unit gaussian distribution and p s v is the cumulative distribution of particle speeds based on the doob theorem doob 1942 we thus model the evolution of the normal w s with distance s along the streamline by the ornstein uhlenbeck process 11 d w s d s γ w s 2 γ ξ s where ξ s is a gaussian white noise characterized by zero mean and ξ s ξ s δ s s the relaxation parameter γ ℓ c 1 is the inverse of the correlation length scale ℓ c the initial values w 0 w s 0 are given in terms of the initial speeds v 0 v s 0 by 10 the distribution of initial velocities is denoted by p 0 v it varies depending on the injection mode see section 2 1 the particle speed v s is given by w s by inverting 10 as 12 v s p v 1 φ w s the ornstein uhlenbeck model describes the stochastic evolution of v s from an arbitrary initial distribution p 0 v it is a stochastic model for the sequence of particle speeds along trajectories note that this markov model for the particle speeds does not require detailed knowledge of the high fidelity trajectories but only needs as an input the point distribution p s v of particle speeds which can be related to the flow speeds through eq 9 and the characteristic relaxation scale ℓ c particle motion along a streamline is described here by its advective travel time t a s which satisfies according to 8 13 d t a s d s 1 v s where v s is obtained from the ornstein uhlenbeck process described above the ctrw quantifies the travel time t s up to a distance s along streamlines the linear distance x between the inlet and control planes and the distance s along the tortuous streamlines are related through tortuosity χ as x s χ tortuosity is discussed in detail in section 4 3 4 in this sense this approach models the particle trajectories projected onto the mean flow direction this means as one dimensional objects the distribution f v t x of advective travel times at a distance x from the inlet boundary is given by 14 f a t x δ t t a x χ 3 2 matrix diffusion compound poisson process for fracture matrix mass transfer we couple the ctrw model discussed in the previous section with diffusive mass transfer between fracture and matrix the series of residence or trapping times in the matrix is modeled as a compound poisson process margolin et al 2003 benson and meerschaert 2009 comolli et al 2016 russian et al 2016 this assumes that trapping occurs at a constant rate γ which is related to the diffusion time over the fracture cross section the particle time t s at a given distance s along the path is then given by 15 t s t a s τ c t a s τ c t k 1 n t η i the residence times η i in the matrix are distributed according to ψ f t which is specified below the number n t of trapping events up to time t is poisson distributed 16 p n t γ t n exp γ t n the distribution ψ c t t δ t τ c t of τ c t is given in laplace space by 17 ψ c λ exp γ t 1 ψ f λ λ t we consider a semi infinite matrix thus the trapping time distribution is given by the inverse gaussian distribution 18 ψ f t ϵ exp ϵ 2 4 d m t 4 d m t 3 where d m is the diffusion coefficient in the matrix the trapping or residence time distribution is equivalent to the return time distribution to the boundary the microscopic distance ϵ from the interface regularizes the return time distribution which otherwise is not defined in the continuum weiss 1994 redner 2001 the regularization implies that ψ f t decays exponentially fast for times smaller than ϵ 2 d m at times t ϵ 2 d m it behaves as a power law t 3 2 finiteness of the matrix implies a long time cut off at τ d ℓ m 2 d m where ℓ m is a characteristic matrix block scale we assume here that τ d is much larger than the observation time scale the trapping rate is given in terms of the effective fracture aperture b e porosity ϕ and the diffusion coefficient d m as 19 γ 2 ϕ d m ϵ b e as detailed in appendix b the distribution f t x of arrival times at distance x s χ from the inlet boundary is given in analogy to 14 by 20 f t x δ t t x χ it is related to the travel time distribution f a t x by 21 f t x 0 t d t f a t x ψ c t t t this equation reads as follows the probability for a particle arrival at time t is given by the probability that the particle travels to distance x in time t times the probability that the compound trapping time is t t 3 3 scaling of breakthrough curves in order to derive asymptotic expressions for the breakthrough curve scaling at a control plane at x we coarse grain the velocity process on the correlation length ℓ c this means the particle speed is set constant over the distance ℓ c and sampled randomly according to p s v after the distance ℓ c this simplifies the time process 15 according to 22 t n 1 τ n τ c τ n τ n ℓ c v n the distribution ψ t of the combined advective transition and residence times over the distance ℓ c is given in laplace space by 23 ψ λ ψ a λ γ 1 ψ f λ where ψ a t is the steady state distribution of advective travel times it is given in terms of the velocity distribution p s v as 24 ψ a t ℓ c t 2 p s ℓ c t the transition time distribution for the first step of distance ℓ c is accordingly given in terms of the initial velocity distribution p 0 v as 25 ψ 0 t ℓ c t 2 p 0 ℓ c t note that it is through ψ 0 t and p 0 v that the model includes the injection mode of the particles in this coarse grained picture the breakthrough curve f t x is given by the n fold self convolution of the transition time distribution ψ t which reads in laplace space as 26 f λ x ψ 0 λ γ 1 ψ f λ ψ a λ γ 1 ψ f λ n c 1 where n c x χ ℓ c we note that the transition time distribution here behaves as ψ a t t 1 β with 1 β 2 while the initial velocity distribution may scale as ψ 0 t t 1 α with 0 α 2 note that the exponent β in the steady state transition time distribution cannot be smaller than 1 because it is derived from the flux weighted speed distribution p s v v β 1 if the eulerian speed distribution p e v v α 1 with α 0 at v smaller than some characteristic velocity v 0 it follows that p s v v β 1 with β 1 α 1 the behavior of the breakthrough curves is determined by two relevant times scales the scale t c x c u measures the time for purely advective motion over the distance between the inlet and control planes the time scale τ γ γ 1 is the average time a particle is mobile and the time scale τ e γ 2 ϵ 2 d denotes the time at which particles have spent the same amount of time in the fracture and in the matrix comolli et al 2016 this means for times t τ e advection in the network dominates and for t τ e retention in the matrix is the dominant process we first consider the case of a flux weighted injection such that ψ 0 t behaves approximately as ψ a t for t c t τ e the breakthrough curve is expected to scale as f t t 1 β because transport is dominated by the network scale advective heterogeneity because particles are mostly mobile and transport is dominated by advection in the network for t τ e the matrix is activated as a retention mechanism and the breakthrough curves behaves according to the characteristic f t t 3 2 scaling secondly we consider the case of a uniform injection characterized by ψ 0 t t 1 α with 0 α 1 while ψ a t t 2 α as in the previous case for t c t τ e advection dominates and the breakthrough curve scales as f t t 1 α however for t τ e the behavior of the breakthrough curves is affected by retention in the matrix and retention at the source zone due to slow advection this gives the breakthrough curve scaling f t t 1 α 2 the derivations of these scaling behaviors are detailed in appendix c 4 dfn flow and transport simulations we perform a set of high fidelity three dimensional discrete fracture network dfn simulations using dfnworks hyman et al 2015a to determine the solute breakthrough curves tortuosity of particle paths and distributions of flow and particle speeds we record both the advective breakthrough curves and breakthrough curves of particles undergoing advection and matrix diffusion at uniformly spaced control planes in the domain that are perpendicular to the primary direction of flow we represent solute transport passing through the network using a plume of particles we consider both uniform and flux weighted injection modes for the initial positions of particles we then observe attributes that are input parameters for the ctrw model distribution of particle speeds correlation length and tortuosity these parameters can in principle be obtained from non lagrangian observations hyman et al 2019b 2019a see also section 4 2 here we calibrate the ctrw model in terms of the lagrangian observations and use it for the characterization and prediction of the combined effect of network scale flow heterogeneity and matrix diffusion on solute transport beyond what is possible using the dfn model 4 1 discrete fracture network model we perform flow and transport simulations in a semi generic dfn composed of a single family of disc shaped fractures within a cubic domain with sides of length one kilometer fracture radii r are sampled from truncated power law distribution with exponent α 2 6 and upper and lower cutoffs r u 1000 m r 0 10 m with pdf p r r for the radius 27 p r r α r 0 r r 0 1 α 1 r u r 0 α fractures in geological media are commonly observed to have length distributions that appear to follow a powerlaw distribution bonnet et al 2001 fracture centers are uniformly distributed throughout the domain fracture orientations are sampled from a von mises fisher distribution with intensity parameter κ 0 and mean normal vector of 0 0 1 using the method provided by wood 1994 this method results in normal vectors with a uniform covering of the unit sphere which mimics disordered fractures networks composed of many families klint et al 2004 hyman and jiménez martínez 2018 there are 7055 fractures in the domain which corresponds to a dimensionless density of 14 using the definition provided by de dreuzy et al 2000 which indicates that the domain is 14 times denser than the critical percolation density value berkowitz and balberg 1993 bour and davy 1997 1998 sahimi 1994 the computational mesh of the dfn contains 11 368 981 nodes and 23 089 485 triangles the mesh has been optionally refined near intersections to ensure that gradients in the pressure field which are higher in these regions are properly resolved hyman et al 2014 the hydraulic aperture of the fractures b is positively correlated to the radii via a powerlaw relationship b 5 0 10 4 r and fracture permeability is determined by the cubic law svensk kärnbränslehantering ab 2010 although it is possible to include in fracture aperture variations into three dimensional dfn simulation de dreuzy et al 2012 makedonska et al 2016 frampton et al 2019 we do not do so here our focus is on the interplay of injection mode advective transport and matrix diffusion rather than sub fracture scale variability flow in the fracture network is modeled using the reynolds equation zimmerman and bodvarsson 1996 flow through the network is created by applying a pressure difference of 4 kpa 1m m gradient across the domain aligned with the x axis this pressure difference allows us to observe the effects of both advection and matrix diffusion within this domain and selected matrix properties but is not meant to represent a particular field site no flow boundary conditions are applied along lateral boundaries we use the methods of makedonska et al 2015 and painter et al 2012 to reconstruct eulerian velocity field u x within each dfn fig 1 is an image of the network where fractures planes are colored by the logarithm base 10 of the velocity magnitude divided by the mean velocity magnitude v m 2 72 10 7 m s there are large contrasts in velocity values between fractures and smaller variations within the fractures larger fractures are better connected and more flow passes through them additionally the positive correlation between hydraulic aperture and fracture size results in lower resistance to flow within bigger fractures 4 2 velocity distributions the pdfs of eulerian velocity magnitude speed are directly obtained from the reconstructed u x velocity field and the lagrangian pdfs are obtained using the particle tracking methods described above fig 2 shows the eulerian flux weighted eulerian and the space lagrangian velocity pdfs as well as the space lagrangian velocity pdf at the injection plane for the three fracture networks under consideration under ergodic conditions and for a sufficiently large injection volume and flow domain the steady space lagrangian pdf p s v and the eulerian velocity pdfs are related through flux weighting as previous discussed cf 9 in the samples shown here we see good agreement between the steady s lagrangian pdf and flux weighted pdf at high velocities and the two deviate from one another at low velocity values nonetheless there is good agreement over five orders of magnitude also the inlet velocity distribution appears to be representative of the full eulerian pdf the right panel shows the corresponding transition time distributions by directly inverting the velocity pdfs the solid black lines denote the power law scalings as t 1 β with β 0 2 1 2 0 7 and 1 7 the high probability of low flow speeds translates into power law tails in the transition time pdf as we have seen in section 3 3 power law tails in ψ t gives rise to intriguing non fickian behaviors in the solute breakthrough curves which are discussed in detail in section 5 we conjecture that the behaviors of the distribution of flow speeds and corresponding transition times can be related to network properties such as connectivity and aperture distribution which however needs to be probed in further studies 4 3 lagrangian transport attributes a set of one hundred thousand particles denoted ω a are tracked through the network increasing the number of particles beyond these counts did not influence observed quantities we observe particle attributes at uniformly spaced control planes that are perpendicular to the primary direction of flow placed at 250 500 750 and 1000 m from the inlet 4 3 1 breakthrough curves the first arrival time τ x 1 x 0 of a particle starting at x 0 to reach a control plane located at x is given by 28 τ x 1 x 0 min t x 1 t x 0 x 1 where x 1 t x 0 corresponds to the 1 component of the position vector of the particle originating from the position x 0 and x 1 corresponds to the first spatial component of the position vector the mass represented by each particle m x 0 and τ x 1 x 0 are combined to determine the solute mass flux f t x that has broken through a control plane at x x 1 at a time t 29 f t x 1 1 m ω a d x 0 m x 0 δ τ x 1 x 0 t where δ t is the dirac delta function we refer to 29 as the breakthrough curve we use 29 for both purely advective and advection matrix diffusion travel times in the latter case the diffusion coefficient in the matrix is set to d m 10 13 m 2 s and the porosity ϕ 5 10 2 these values are selected to allow to study both the effects of advection and matrix diffusion for this network and flow field but not meant to represent a particular field site although they do fall within physically reasonable range of values for low permeability rocks zhou et al 2007 4 3 2 equivalent aperture the method implemented to account for matrix diffusion in dfnworks allows for hydraulic apertures to vary between fractures hyman et al 2019c however the presented upscaled transport model requires a single equivalent effective aperture which can be obtained by combining the advective travel time 28 with the lagrangian retention parameter defined in cvetkovic et al 1999 30 0 s 2 d s b s v s dividing twice the advective travel time by 30 provides an integrated value for the resistance along a pathline and an effective aperture value b e f f hyman et al 2016 we observe an average value of b e f f 0 0048 m for flux weighted and b e f f 0 0041 m for resident injection at the outlet plane where the average is taken over all particle trajectories in appendix d we compare the dfn btcs including matrix diffusion using the actual fracture hydraulic apertures that vary between fractures and the effective hydraulic apertures that show good agreement between the two methods 4 3 3 correlation length the autocorrelation of lagrangian velocities is determined using the magnitude of particle velocities sampled equidistantly along pathlines 31 c v v s 1 v 0 ω a d x 0 0 d s v s s v s s s σ v v 2 where σ v v 2 is the velocity variance and v s s the fluctuation about the mean the correlation distance ℓ c is when fluctuations anticorrelate which we take at the first zero crossing of 31 for resident injection ℓ c 221 m and for flux weighted injection ℓ c 204 m note that c v v is a purely advective quantity 4 3 4 tortuosity we focus on a flow dependent geometric tortuosity as it is naturally compatible with lagrangian observations other tortuosity definitions can be found in ghanbarian et al 2013 let s x i x 0 be the total pathline distance of a particle upon its first crossing of a control plane at x x i then the tortuosity of the pathline defined 32 χ x i s i x 0 x i we take the average of χ over ω a under ergodic conditions this means here at a linear distance x 1 ℓ c much larger than the characteristic fracture length the tortuosity is given by koponen et al 1996 33 χ lim x 1 χ x 1 v e u 1 the asymptotic tortuosity for this network is χ 2 54 due to higher number of relatively short fractures which induces a high tortuosity in the particle path note that the asymptotic tortuosity does not depend on the particle injection mode at finite distances however the tortuosity depends on the injection mode and on the local fracture geometry for resident injection χ 2 18 250m 2 63 500m 2 78 750m and 2 55 1000m for flux weighted χ 1 62 250m 2 11 500m 2 63 750m and 2 50 1000m the observed values of tortuosity do not fully stabilize at χ but the observed values at 1000 m are close to these asymptotic value the values of flux weighted particles are always less than those observed for resident injection note that χ is a purely advective quantity 5 results in this section we discuss the behavior of solute breakthrough curves at different control planes we consider two different injection conditions uniform and flux weighted as discussed above we first discuss the case of advective transport and compare the dfn simulations with the ctrw model then we consider advective transport under matrix diffusion again for the two different injection conditions and again compare the dfn simulations with the ctrw model in the following the breakthrough curves for the uniform injection are marked by blue the ones for the flux weighted injection by black lines or symbols 5 1 advective transport fig 3 shows solute breakthrough curves at different control planes for uniform and flux weighted initial conditions the symbols and lines denote the results from the direct numerical simulation and the ctrw model respectively we observe a stronger tailing for the uniform than for the flux weighted injection at all control planes this is due the fact that the uniform injection emphasizes the low speeds in the injection plane while the flux weighted injection emphasizes the high speeds as shown in fig 2 the ctrw model provides a good estimate for the peak and the tail behavior at all distances from the control plane it overestimates early arrivals at control planes close to the inlet this is due to the fact that only a few fractures connect from the inlet to the control planes close to the inlet while the ctrw model simulates access to the full spectrum of fracture velocities thus the prediction of early arrivals improves with distance from the control plane because particles are able to sample a larger part of the velocity spectrum fig 4 shows breakthrough curves for the two different injection modes left uniform and right flux weighted we show both the data from the direct numerical simulations and the ctrw model at 250 and 1000 m we also include the breakthrough curves at dotted lines x 5000 and dash dotted lines 10 4 m which are extrapolations based on the ctrw model we can observe two different power law regimes that correspond to the power laws identified for the speed distributions in fig 2 furthermore we see that the tails of the breakthrough curves for the uniform injection essentially collapse this can be traced back to the fact that the tail behavior here is dominated by the large transition times the particles experience during the first step for the flux weighted injection the tails show the same power law behavior but seem to collapse at much larger times than for the uniform injection 5 2 advective transport under matrix diffusion fig 5 compares breakthrough curves a the control plane at x 1000 m for pure advection and under matrix diffusion for uniform left and flux weighted right initial distributions it clearly illustrates the increased tailing due to solute retention in the matrix again the tailing is stronger for the case of uniform injection in this case strong retention in the source zone due to low flow speeds competes with retention due to matrix diffusion which leads to the power law behavior as t 1 α 2 as discussed in section 3 3 where α is the exponent that characterizes the power law regimes for the velocity distributions shown in fig 2 the breakthrough curves for the flux weighted injection are dominated by matrix diffusion and show the characteristic t 3 2 scaling fig 6 shows breakthrough curves at different control planes for uniform and flux weighted initial conditions under matrix diffusion the ctrw model provides good estimates for peak and the tail behavior at all distances from the injection plane early arrivals are overestimated at control planes close to the injection plane as for the purely advective case this can be traced back to the fact that only a few dominant fractures connect the injection and control plane while the ctrw model simulates availability of the full fracture spectrum thus the ctrw estimates for early arrival times improve with distance from the inlet plane as more fractures are sampled fig 7 shows breakthrough at distances x 250 1000 5000 m and 10000 m from the inlet plane the breakthrough curves at dotted lines x 5000 and dash dotted lines 10 4 m are extrapolations based on the ctrw model the strong retention due to low flow speeds in the source zone combined with matrix diffusion dominates the tail behavior for uniform injection the tails of the breakthrough curves essentially collapse for the flux weighted injection the tails show the same scalings and again seem to collapse at later times 6 conclusions we investigate and upscale the combined effect of flow heterogeneity and matrix diffusion on conservative transport in three dimensional fracture networks under different initial solute distributions direct numerical simulations for flow and particle transport give insight into the advective and diffusive transport mechanisms and the impact of heterogeneity and retention due to matrix diffusion on solute breakthrough curves at different observation planes in order to probe the impact of the initial solute distribution we consider resident uniform particle injections over the inlet plane as well as flux weighted injection we observe significant power law tailing in the solute travel time distribution due to advective heterogeneity and a broad velocity distribution within the networks this tailing is amplified under resident injection in this scenario the solute is distributed equally across all velocities within the inlet plane which leads to stronger retention at the initial plane due to low speeds than for the flux weighted injection condition in the presence of matrix diffusion the breakthrough tailing is amplified both for the flux weighted and resident injection conditions for the flux weighted injection we observe the characteristic t 3 2 late time scaling in the case of resident injection we observe a different scaling in this case the interaction of strong retention due to low flow speeds along with immobilization in the matrix leads to a different scaling behavior we quantify these behaviors using an upscaled ctrw approach that accounts for advective heterogeneity and retention in the matrix conditioned on the initial solute data velocity variability along each pathline is modeled as a stationary markov process where the velocity changes at equidistant positions along the path specifically we map the particle speed onto a gaussian random variable which evolves according to an ornstein uhlenbeck process the proces is parameterized by the lagrangian speed distribution and correlation distance which in principle can be obtained from the eulerian speed pdf and characteristic fracture scale advective transition times are obtained kinematically from the constant transition distance and speed this approach captures the impact of flow variability and injection condition on breakthrough curve tailing we use a compound poisson process to model retention due to diffusion into the matrix blocks which means trapping events occur at a constant rate along a particle pathline the trapping time distribution is governed by an inverse gaussian distribution thus trapping times are sampled from an inverse gaussian random variable where the trapping rate is given by the diffusion coefficient in the matrix matrix porosity and the effective fracture aperture this upscaled approach captures the combined effect of flow heterogeneity and matrix diffusion on solute transport and breakthrough at control planes at variable distances from the inlet and gives analytical predictions for the long time scalings the model relates the intermediate scalings of the breakthrough curves to advective heterogeneity and the distribution of particle and thus flow speeds the latter depends on the network properties such as aperture distribution and correlation between fracture length and aperture hyman et al 2019b in this sense the advective breakthrough curve scalings reflect and change with the network structure the characteristic t 3 2 scaling however is due to the fracture matrix exchange and independent of the medium structure the upscaled model provides insights into the mechanism and the complex interactions between advective and diffusive mass transfer mechanisms furthermore it provides a computationally efficient tool to extrapolate transport to distances and times difficult to reach using direct numerical simulations the upscaled model is parameterized by the distribution of lagrangian speeds which in principle can be inferred from the eulerian speed distribution a flow property by tortuosity and by the velocity correlation scale which depend on the network and flow properties the relation between geometric and hydraulic network properties and these characteristics is an outstanding question that needs to be answered to bridge the gap between medium properties and flow and transport behaviors the proposed upscaled approach captures the main physical transport processes that dominate conservative tracer transport it shows that particle motion in a complex fracture network can be by quantified by an upscaled ctrw model based on a markov process that is parameterized by point statistics of speed and a single correlation scale as well as a poissonian trapping process for fracture matrix echange the proposed mathematical formulation for fracture matrix interaction can be used also to model linear kinetic adsorption of a solute to the solid matrix furthermore the model can be generalized to chemical reactions of single species and between particles by combining the ctrw model with suitable rules for particle survival and interactions credit authorship contribution statement jeffrey d hyman conceptualization methodology software formal analysis investigation writing original draft writing review editing visualization investigation data curation marco dentz conceptualization methodology software formal analysis investigation writing original draft writing review editing visualization investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments jdh thanks the department of energy basic energy sciences program lanle3w1 and the spent fuel and waste science and technology campaign office of nuclear energy of the u s department of energy under contract number los alamos national laboratory is operated by triad national security llc for the national nuclear security administration of u s department of energy contract no 89233218cna000001 this work was prepared as an account of work sponsored by an agency of the united states government the views and opinions of authors expressed herein do not necessarily state or reflect those of the united states government or any agency thereof its contractors or subcontractors md gratefully acknowledges the support of the spanish ministry of science and innovation through the project hydropore pid2019 106887gb c31 los alamos national laboratory unclassified release number la ur 21 22994 appendix a tdrw for matrix diffusion for a pulse injection into a single uniform fracture surrounded by an infinite matrix małoszewski and zuber 1985 derived an analytical solution considering only advection within the fracture the probability density function of travel times exiting the fracture may be obtained from their solution as a 1 p t t f a t f π t t f 3 2 exp a 2 t f 2 t t f if t t f 0 if t t f where t f is the advective travel time through a fracture and a 2 a ϕ d m b here ϕ is the matrix porosity d m is the matrix diffusivity and b is the fracture aperture which can vary between fractures but not within them using this formulation from a 1 the cumulative density function cdf for the travel time distribution in a single fracture that accounting for both advection and matrix diffusion is a 3 f t erfc a t f t t f particle tracking simulations provide the advective travel time of a particle in a fracture t f the time retained in the matrix can be obtained using the inverse cdf method a 4 t d a t f erfc 1 ξ 2 where erfc is the complementary error function and ξ is a random number drawn from the uniform distribution between 0 and 1 the total travel time to pass through a fracture t is the sum of t f and t d starting with the advective travel time of a particle passing through the i th fracture t f i the total travel time is t i t f i t d i and the travel time of the particle through the network is t i i t i where i is the set of all fractures that the particle passes through appendix b trapping rate the relation 19 can be understood by considering the travel time distribution over a single fracture predicted by the eulerian matrix diffusion formulation it is given in laplace space by małoszewski and zuber 1985 hyman et al 2019c b 1 f λ τ f exp λ τ f 2 ϕ τ f a λ φ λ by setting φ λ d m λ we obtain b 2 f λ τ f exp λ τ f τ f 2 ϕ d m a λ note that the factor of 2 comes from the symmetry of matrix diffusion across both fracture matrix interfaces from the ctrw model we obtain in laplace space b 3 f λ τ f exp λ τ f γ 1 p m λ the laplace transform of the trapping time pdf is b 4 p m λ exp λ ϵ 2 d m 1 λ ϵ 2 d m thus the arrival time distribution over a single fracture can be written in the limit ϵ 1 as b 5 f λ τ f exp λ τ f γ ϵ d m λ comparison between b 2 and b 5 gives b 6 2 ϕ d m a γ ϵ d m and thus b 7 γ 2 ϕ d m ϵ a appendix c scaling of breakthrough curves the laplace transform of ψ a t can be expanded as c 1 ψ a λ 1 τ λ a λ τ 0 β where τ is the mean advective transition time τ 0 a characteristic time scale and a a constant that depends on the particular form of ψ a t the laplace transform of ψ 0 t for 1 β 2 is analogous for 0 β 1 the laplace transform of ψ 0 t is given by c 2 ψ 0 λ 1 c λ τ 0 β where c is a constant furthermore we note that the trapping time distribution ψ f t has the laplace transform c 3 ψ f λ exp λ ϵ 2 d m 1 λ ϵ 2 d m we first consider the case ψ 0 t ψ a t such that expression 26 simplifies to c 4 f λ x ψ a λ γ 1 ψ f λ n c using expressions c 1 and c 3 in eq c 4 we can write c 5 f λ x exp n c ln 1 τ λ τ γ λ ϵ 2 d m a τ 0 β λ γ λ ϵ 2 d m β expanding the logarithm gives c 6 f λ x exp t c λ λ τ e a t c τ 1 τ 0 β λ λ τ e β where we defined τ e γ 2 ϵ 2 d and t c n c τ the scale τ e marks the time at which particles have spent in average the same time in the fracture and the matrix for λ τ e 1 we can expand c 7 f λ x 1 t c λ a t c τ 1 τ 0 λ β and thus f t x t 1 β for t c t τ e for times t τ e retention in the matrix dominates the breakthrough curves for λ τ e 1 we can expand c 8 f λ x 1 t c λ τ e and thus f t x t 3 2 we now consider the case that ψ 0 t t 1 α where 0 α 1 and ψ a t t 2 α thus we can expand f λ as c 9 f λ x exp c τ 0 α λ λ τ e α exp t c λ λ τ e a t c τ 1 τ 0 α 1 λ λ τ e α 1 where we set n c 1 τ t c for λ τ 0 1 we can expand c 10 f λ x 1 c τ 0 α λ λ τ e α t c λ λ τ e a t c τ 1 τ 0 α 1 λ λ τ e α 1 for λ τ e 1 we further obtain c 11 f λ x 1 c λ τ 0 α t c λ a t c τ 1 λ τ 0 α 1 for t t c this means λ t c 1 we have in leading order c 12 f λ x 1 c λ τ 0 α which implies that f t t 1 α similarly for λ τ e 1 we can expand c 13 f λ x 1 c τ 0 α λ τ e α 2 which implies f t t 1 α 2 for t τ e appendix d effective aperture fig d 8 compares the dfn btcs including matrix diffusion using the actual fracture hydraulic apertures that vary between fractures blue squares and using the effective hydraulic apertures black circles at the outlet plane x 1 1000 m the left subfigure shows that btcs for resident injection and the right subfigure shows the results for flux weighted there is a slight deviation between the curves at the initial breakthrough but the scaling in the tails of the distributions are the same 
254,snow and glaciers are important freshwater resources in the himalayan catchments for all biological activities however under recent climate change these resources are decreasing thereby posing a serious threat to the future freshwater resources among the himalayan catchments therefore understanding the hydrological behaviour and sources of streamflow is necessary for better assessment planning and management of these waters in the mountainous catchments this study is based on the use of δ18o and d excess to identify and estimate the different sources of streamflow in the western himalayas the isotopic composition of different source waters varied over space and time these variabilities are attributed to the seasonal meteorological changes precipitation form differential melting of snowpacks and moistures sources the vertical isotope gradients were observed between the sampling sites and the elevation of the basin the results suggest that snow and snowpack dominantly up to 55 contribute to the streamflow during high flow period while as groundwater maintains the flow in the streams during lean period and contributes up to 78 the study provides the important insights about the understanding of spatio temporal variability of different source waters contributing to runoff in addition the changing climate could have serious impact on the water resources of the region and thereby affecting the economic and social values of the downstream populations keywords stable isotopes streamflow snow groundwater mixing analysis western himalayas 1 introduction mountains which cover 24 of earth s land surface kapos et al 2000 are the principal component of global water supply because they act as natural reservoirs of fresh water in the form of snow and glaciers runoff from precipitation meltwater from mountain snowpacks and glaciers and groundwater discharge provide a valuable resource to downstream population for domestic agricultural and other allied activities kriegel et al 2013 in addition to surface runoff processes the snow and glaciers play a critical role in climate the high albedo of snow and glaciers reflect significant proportions of solar radiation away from the earth s surface which results in cooling effect thus balancing the surface energy budget the himalayas encompassing 9600 glaciers with an area of 40 000 km2 form the largest cryospheric reserve outside the arctic and antarctic regions bolch et al 2012 agris 2018 these glaciers and snowpacks maintain the perennial source of runoff to major river systems such as the indus ganga and brahmaputra housing nearly 17 of the global population barnett et al 2005 lemke et al 2007 the runoff from these himalayan rivers support world s most extensive irrigated regions of northern india and plains of pakistan among these major himalayan basins the indus basin has the largest 22 000 km2 snow and glacial cover where snow and glacial melt are estimated to contribute 65 85 to annual flows immerzeel et al 2009 2010 mukhopadhyay and khan 2015 lone et al 2021 previous studies have suggested that most of the himalayan glaciers 70 are receding at faster rate with some fewer exceptions from karakorum range that are advancing naithani et al 2001 dobhal et al 2004 hewitt 2005 kulkarni et al 2007 kumar et al 2008 bolch et al 2012 bhambri and bolch 2009 casper 2010 the large scale retreat of glacier and snow cover could pose a serious threat of water security in downstream population and even increase the risks of natural hazards immerzeel et al 2010 therefore understanding the existing hydrological regimes in the region adaptive countermeasures are required for the management of these water resources the kashmir valley also known as upper jhelum basin ujb lies in the nw himalayan complex with an area of about 12757 km2 the ujb forms one of the major tributary of indus river system where precipitation snow and rains meltwater and groundwater availability is especially important because most of the area s growing economic production in terms of agriculture horticulture and hydropower generation depends on these resources in western himalayas maximum stream river runoff is generated from snow ice melt besides rainfall and baseflow the flow within the streams varies over space and time which may exhibit seasonal trend due to varying contribution from glacier or ice snowmelt groundwater baseflow and rainfall understanding the spatio temporal variability of the stream river flow is an important step for the assessment planning and management of these waters in the downstream areas stable isotopes of water 18o and 2h have been widely used as conservative tracers to understand the various hydrological processes such as source of atmospheric precipitation interaction between surface water and groundwater groundwater recharge and discharge identification of river water sources hydrograph separation etc craig 1961 rozanski et al 1993 clark and fritz 1997 rai et al 2014 yao et al 2009 yin et al 2011 the isotopic composition of hydrogen and oxygen isotopes in various water bodies influenced by isotopic fractionation has wide spatio temporal distribution and the different sources of water bodies have different isotopic characteristics zhang and wu 2007 the isotopic composition of river waters from different areas are affected by meteorological processes providing a characteristic fingerprint of their sources clark and fritz 1997 besides large scale atmospheric processes the stable isotopes of precipitation in small watersheds are affected by local meteorological factors and geographical conditions zongxing et al 2015a with the change in isotopic composition of precipitation input isotopes in surface water and groundwater will also experience wide spatial and temporal distribution heterogeneity huang et al 2016 several previous stable water isotope studies have been carried out in the himalayas breitenbach et al 2010 deshpande et al 2003 gupta et al 2005 jeelani et al 2010 2013 2017 2018 kumar et al 2010 lone et al 2019 sukhija et al 1998 where special emphasis was given to atmospheric moisture source relationship with meteorological factors and the spatio temporal variation of isotopes in different water bodies in recent years conservative isotopic tracing has been carried out at watershed level in order to quantify the contribution of winter and summer derived precipitation in high altitude catchments singh et al 2019 estimate the catchment residence times jeelani et al 2013 hu et al 2020 wan et al 2020 compute the regional water balance jeelani et al 2017 lone et al 2017 gibson et al 2018 kumar et al 2018 singh et al 2019 moreover these tracers have the potential to identify the various components that contribute to the runoff including snowmelt glacier melt and groundwater baseflow and estimate their relative contribution to streamflow maurya et al 2011 penna et al 2014 jeelani et al 2016 2017 singh et al 2019 although various studies have been carried out in the himalayas but most of them are focussed on the model based results of stable water isotopes their controlling factors and quantification of end member contribution to the streamflow considering the complex terrain and climate in himalayas a thorough analysis of the high spatio temporal variability in the isotopic composition of the source waters to streamflow in high elevation catchments like sindh and rambiara are still lacking despite the complex terrain and difficulty in sampling high resolution analysis was performed to identify and estimate the contribution of various source waters such as rainwater snow snowpacks and groundwater to the streamflow in these catchments the study will enhance the reliability of results based on isotope hydrograph separation by considering the spatio temporal variations in the isotopic composition of these source waters the objectives of the study are 1 to assess the spatio temporal variability of stable water isotopes in source waters rainwater snow snowpack and groundwater and 2 to quantify the relative contribution of source waters to streamflow in sindh and rambiara catchments this study is expected to improve the knowledge of hydrometrological processes in these cold high elevation and snow dominated catchments of western himalayas 2 study area the kashmir valley is an intermontane sedimentary basin bounded by pir panjal range on sw and the greater himalayan range on nw jaan et al 2015 fig 1 the ujb comprises of 24 watersheds with half of them originating from pir panjal range left bank tributaries and half from the greater himalayan range right bank tributaries all these tributaries fall into the major drainage of the valley known as river jhelum which is one of the major tributary of indus river system the sindh catchment 34 05 34 30 n 74 35 75 40 e is one of the upland mountainous catchment of river jhelum which is located towards the northeastern extremity of kashmir valley fig 1 the area of this catchment is 1585 km2 and exhibit an altitudinal variation of 1560 to 5375 m above the mean sea level the main channel length is 96 km with a height difference of 3020 m from source to the outlet the sindh river originates from the lofty peaks of bodpathar and poshpathar area of greater himalayan glaciers panjtarni group of glaciers and flows in e w direction downstream tributaries originating from nehnar group of glaciers har nag thajiwas glacier and harmukh group of glaciers are also the primary perennial feeders of the sindh river the catchment is divided into two zones based on morphological characteristics from east to west from source to mid basin up to ganderbal the first zone is comprised of rocky uplands characterised by high steep rocky mountains with narrow and deeply incised fluvial valleys numerous small lakes like sona sar hoka sar yamhar sar nil nag har nag gangbal lake nund kol andarun sar lalgul sar salnal sar kaul sar etc are found within this zone that remain snow covered most of the year the second zone is comprised of recent alluvium characterised by wide valleys river capture river bradding and several unpaired river terraces farooqi and desai 1974 bhatt 1989 the river finally meets the wetland shalabug nambal before the confluence with the jhelum river at shadipur the catchment consists of various source rocks from archean to quaternary age middlemiss 1910 the salkhala series of archean rocks carbonaceous slates phyllites marble and mica schists together with syringothyris limestones carboniferous triassic jurassic limestones panjal volcanics carboniferous zewan limestone permian muth quartizite devonian and granites are widely distributed and oldest exposed rocks in the upper river basin in the mid lower basin older rocks salkhala and panjal volcanics are exposed while as in middle these rocks are overlain by the unconsolidated sediments karewas of upper pleistocene age and recent alluvium lone et al 2016 the rambiara catchment 33 20 34 54 n 73 35 75 35 e is located in the south and southwest extremity of kashmir valley fig 1 the area of this catchment is 641 06 km2 and exhibit an altitudinal variation of 1580 to 5000 m above the mean sea level the main channel length is 72 km with a height difference of 2646 m from source to the outlet the rambiara river originates from the rupri ridge of the pir panjal range and the bhag sar lake near naba pir pass at sokh saria as the rambiara catchment is devoid of any glacier mass the huge accumulations of snow at higher elevations in winter maintains the flow within the river during different seasons within the catchment there is a gradual decrease in the terrain from south to north with distinct geomorphological characteristics divisible in three zones starting from its south to southwestern side the first zone is comprised of rocky uplands characterised by high steep rocky mountains with deep and narrow fluvial valleys numerous small lakes like bhag sar barani sar kotori sar laksukh sar golio sar dhaklar sar chandan sar and nandan sar are found within this zone that remain snow covered most of the year in the middle the second zone tilted lower karewas with wide and gently sloping pediment directly overlie the basement rocks of panjal traps triassic limestone this zone is marked by river capture beheaded streams river bradding and several unpaired river terraces farooqi and desai 1974 bhatt 1989 the maximum width of river is also observed within this zone reaching upto 1 km near balapur village characterized by a large braided bar deposit the third zone is comprised of recent alluvium characterised by wide valleys and river terraces similar to the first zone the river has regained its narrow course but with lower gradient of the terrain before the confluence with the vishaw river and finally the jhelum river at nyaiyun the catchment consists of various source rocks from upper carboniferous to quaternary age middlemiss 1910 the upper carboniferous permian rocks slates andesite and basalts together with triassic limestones dolomites and shale are widely distributed and oldest exposed rocks in the mid upper river basin in the mid lower basin older rocks are overlain with an angular unconformity by the unconsolidated plio pleistocene sediments of fluvio glacial origin known as karewas the karewas form the dominant lithology of the catchment while as the northeastern part of the basin consists of recent alluvium the region has a temperate climate the sindh catchment received an annual average precipitation of about 1240 mm and the rambiara catchment received about 1136 mm during the year 2017 fig 2 snowfall occurs in winter and spring while rains are prominent throughout the year the monthly precipitation is highly variable but comparable in both the catchments higher precipitation was observed in january while lowest in november the high precipitation observed at higher altitudes and low precipitation towards the lower altitudes suggest the influence of topography in both the catchments the mean annual temperature ranged from 0 8 to 19 c for sindh and 1 3 to 23 c for rambiara catchment with lowest temperature recorded in january and highest in july like precipitation the monthly temperatures in sindh were relatively lower than the rambiara catchment which again indicates the strong influence of topography of the catchments the altitude of sindh varies from 1563 to 5375 m amsl while as for rambiara from 1583 to 4560 m amsl 3 materials and methods 3 1 sampling and analysis an extensive strategy was designed to document the spatial and temporal variation in the isotopic composition of source water precipitation stream water and snowmelt and groundwater water sampling was carried out in the representative catchments from january to december 2017 and a total of 725 water samples were collected during the course of this study event based precipitation samples n 235 were collected from three stations within each catchment table 1 fig 1 the rainwater samples were collected throughout the year while as fresh snow n 37 during the winter the precipitation collector was made in accordance to iaea guidelines iaea 1983 while as fresh snow was collected using pvc tube 1 2 inch diameter the fresh snow samples were transferred in 1 l wide mouthed bottles capped and left for melting to avoid evaporation processes the samples were immediately bottled in 10 ml hdpe bottles since both the catchments are devoid of any meteorological station the meteorological information precipitation amount temperature and relative humidity from the station of adjacent watershed avg distance to the centre of catchment is 30 km was considered to be the representative of the sampling station the meteorological data from pahalgam weather station 34 01 n 75 19 e 2132 m amsl was chosen for sindh catchment while the qazigund weather station 33 38 n 75 08 e 1661 m amsl for rambiara catchment respectively fig 1 the river water samples n 168 were also collected on monthly basis during the observation period the river water samples were collected from 7 different locations within each catchment keeping in view the altitudinal gradient along the river course fig 1 groundwater samples were collected from the tube wells sponsored by central groundwater board cgwb and state groundwater board sgwb and 10 wells per catchment were chosen along the river course a total of 240 groundwater samples were collected during the year 2017 on monthly basis the depth of the sampled wells ranged from 1 4 m below the ground surface and classified as shallow wells jeelani et al 2020 prior to sample collection the tube wells were purged for at least 5 min as all the wells are of shallower depth the snowpack samples n 82 were collected from march to november from the winter accumulated snow at various altitudes ranging between 1900 and 3700 m amsl the snow and snowpacks from high altitude peaks above 3700 m altitude were inaccessible which makes it difficult for sampling besides these remain frozen and are added to the mass of glacier due to sub zero temperature conditions all the water samples were collected in 10 ml pre cleaned high density polyethylene hdpe bottles the bottles were filled to the maximum limit without any residual air bubbles and tightly capped to prevent evaporation and exchange with the atmosphere after proper labelling coding the samples were kept in the laboratory at a container temperature maintained at 4 c until their analysis the samples were sent to geosciences division physical research laboratory prl ahmedabad for the analysis of stable water isotopes δ18o and δ2h the liquid oxygen and hydrogen analysis was carried out using delta v plus isotope ratio mass spectrometer in a continuous flow mode and following equilibration with standard gas epstein and mayeda 1953 the δ18o and δ2h measurements were determined by equilibrating 300 μl of water samples with co2 and h2 for 16 hours at 25 c respectively maurya et al 2009 the results are denoted in the δ notation as per mil and defined in relation to vienna standard mean ocean water vsmow the overall precision and consistency of the measurements for δ18o and δ2h was 0 1 and 1 0 based on multiple aliquots of secondary laboratory standards the amount weighted means of precipitation δ18o and δ2h values were calculated as 1 x w m a n n u a l p i x i i p p i where pi denotes the precipitation amount of every single sample recorded at the respective precipitation site and xi is the corresponding isotopic value another parameter the deuterium excess d excess defined as d δ2h 8 δ18o by dansgaard 1964 determines the deviation of a set of data points from the line of slope 8 in δ18o δ2h plot the d excess has been a useful tracer of the vapour source region used to measure the contribution of water vapour from different sources to the specific site feng et al 2009 juhlke et al 2019 the evaporation over the source regions generate d excess due to the process of kinetic fractionation under non equilibrium conditions bershaw 2018 the degree of kinetic fractionation is influenced by both oceanic variables including sea surface temperature sst relative humidity and evaporation flux pfahl and sodemann 2014 bonne et al 2019 as well as continental variables such as elevation sub cloud evaporation of falling raindrops continental moisture recycling or air mass trajectory length over land surfaces rozanski et al 1982 froehlich et al 2008 goldsmith et al 2017 3 2 hydrograph separation three component hydrograph separation based on mass balance approach genereux et al 1998 was used to calculate the ratios of different recharging sources in the sindh and rambiara catchments to estimate the seasonal temporal variation in the proportion of various source waters contributing to the total river discharge a few assumptions are made as follows 1 the total river discharge in both the river catchments is predominantly sourced from three components as i the rain water ii the melt from snow snowpack and iii the groundwater discharge although it is presumed that groundwater is recharged by meltwaters derived from snow snowpacks but a significant amount is contributed by rainfall as well therefore the groundwater forms an important component with definite isotopic composition derived from the mixing of stored groundwater meltwaters from snow snowpack and rain water during winter december to february the δ18o and d excess of fresh snow was selected as a separate end member when the meltwater contribution from snowpacks is insignificant to cover the entire spectrum of meltwater contribution fresh snow and winter accumulated snowpacks were selected as two separate components fresh snow is isotopically depleted in heavier isotopes while as snowpacks are affected by post depositional processes which could cause large isotope fractionation earlier studies have reported that the δ18o values in snowpacks could be 3 to 5 heavier than the fresh snow due to preferential melting of lighter isotopes that cause large uncertainties in the hydrograph separation taylor et al 2002 he et al 2006 schmieder et al 2018 zuecco et al 2019 the isotopic composition of these end members components differ significantly from each other 2 though the isotopic tracers of the contributing sources end members vary in space and time these variations are attenuated due to mixing which result in reasonably homogenized average catchment scale values over certain time maurya et al 2011 also the observed variation in the source waters clearly reflects the temporal variation in relative contributions of the hydrological components to the river water various studies on three component hydrograph separations have been reported based on geochemical and isotopic approach with two tracers saleem and jeelani 2017 engel et al 2016 hugenschmidt et al 2014 jeelani et al 2013 uhlenbrook and hoeg 2003 the δ18o along with electrical conductivity ec chloride cl and silica sio2 are most commonly used tracers for three component hydrograph separation klauss and mcdonnell 2013 however these tracers have limitations as they may get altered due to process of water rock interaction in glacier fed river catchments singh et al 2019 to overcome this problem several studies have been carried out where δ18o and d excess have been successfully used to estimate the contribution of various hydrological components gibson et al 2000 throckmorton et al 2016 singh et al 2019 following the mass balance equation singh et al 2019 the three component hydrograph separation can be written as follows 2 q s t q r w q s m q g w where qrw qsm and qgw are the contribution of rain water snowmelt snowpack and groundwater to the river discharge qst 3 1 f r w f s m f g w where frw fsm and fgw are the fractions of rain water snowmelt snowpack and groundwater to the total river discharge 4 δ s t δ r w δ f r w δ s m δ f s m δ g w f g w where δ st δ rw δ sm and δ gw are δ18o tracer for the stream water rain water snowmelt and groundwater respectively 5 d s t d r w d f r w d s m d f s m d g w f g w dst drw dsm and dgw are d excess tracer for the stream water rain water snowmelt and groundwater respectively 6 q r w d s t d g w δ s m δ g w d s m d g w δ s t δ g w d r w d g w δ s m δ g w d s m d g w δ r w δ g w 100 7 q s m d s t d g w d s m d g w 100 d r w d g w d s m d g w q r w 8 q g w 100 q r w q s m the rain water snowmelt and groundwater contributions to the total river discharge were calculated using eqs 6 8 respectively 3 3 uncertainty analysis the uncertainty analysis was performed using classical gaussian error propagation technique based on first order taylor series expansion genereux 1998 uhlenbrook and hoeg 2003 liu et al 2004 the uncertainty of the tracer based hydrograph separation includes the uncertainties of the endmembers and the laboratory analysis the uncertainty in the estimated contributions of different runoff components may be caused by the laboratory analytical error due to measurement errors in end member concentrations similarly the spatio temporal variations in the tracer components result in significant uncertainty in hydrograph separations genereux 1998 pu et al 2013 the standard deviations of the tracer components were multiplied by t values calculated from student s t distribution at 90 confidence level the analytical uncertainty for δ18o and δ2h measurements was 0 1 and 1 respectively though the analytical uncertainty for d excess is estimated from both the 18o and 2h measurements but it is strongly dependent on the uncertainty in δ2h 1 the uncertainty analysis for three component hydrograph separations was calculated by following equations genereux 1998 9 w f x w o w d 10 w o f x o 1 w o 1 2 f x o 2 w o 2 2 f x o 3 w o 3 2 11 w d f x d 1 w d 1 2 f x d 2 w d 2 2 f x d 3 w d 3 2 where o is δ18o d is d excess 1 is rain water 2 is snowmelt 3 is groundwater and w is the uncertainty in the variable specified by the subscript respectively fx is the contribution of a specific streamflow component x to the river discharge 3 4 identification of end members the end member mixing analysis emma used to identify the potential end members to streamflow was performed using δ18o and d excess value of rainfall snow and snowpacks and groundwater table 1 the δ18o values plotted against the d excess for all stream water samples fell within the triangular domain defined by the average δ18o and d excess singh et al 2019 of rainfall snow snowpacks and groundwater fig 3 the rainwater samples were amount weighted while the snowpack and groundwater samples were not this could affect the mass balance computations but we assume that this would not change the general evidence provided by fig 3 in winter fresh snow was chosen as a separate end member when the melt from snowpacks was insignificant in both the catchments however snowpack end member was selected on seasonal basis spring to autumn from lower to higher altitudes as the progressive rise in temperature shift the snowpacks towards the higher altitudes with advancing seasons 4 results and discussion 4 1 tracer concentration in source waters the different source waters sampled in the sindh and rambiara catchments showed a marked variability in tracer concentration fig 4 for all data the δ18o values ranged between 17 2 and 3 2 and d excess between 6 9 and 25 8 the highly variable rain and fresh snow samples exhibited the most positive and the most negative isotopic composition respectively the isotopic values of snowpack fall close to the fresh snow samples with slightly enriched isotopic signature stream water and groundwater from both the catchments showed a narrow isotopic range that evolved from other source waters on the other hand the d excess of rain has maximum variability being lower than the d excess of other water types higher d excess values were observed in snow and snowpacks the d excess of groundwater falls between rain and snow snowpack the variability in d excess of these source waters is due to the interplay of different processes like different sources and their mixing precipitation form snow accumulation and seasonal change in meteorological factors temperature rh and wind speed lower δ18o and d excess is usually associated with the precipitation brought by indian summer monsoon ism originating from arabian sea and bay of bengal indian ocean during summer however lower δ18o and higher d excess in precipitation mostly snow and rain is brought by western disturbances originated from mediterranean sea and travel long distances over continents gat and carmi 1970 jeelani et al 2018 the lower and narrow range of d excess was observed in stream water which clearly reflects the contribution of different source waters with changing seasons the results from the mixing plot clearly reflects the importance of snowpacks rain and groundwater as potential source waters due to less variability in their measurements defined by the short horizontal and vertical error bars in the runoff regimes of the sindh and rambiara river in sindh catchment the tracer signature of stream water was defined by the lower δ18o of snowpack snow in winter only to the bottom the higher δ18o of rain water to the left and the lower δ18o of groundwater to the right of the mixing plot fig 3 on the other hand the d excess showed lower value in rain higher value in groundwater and an intermediate value in snowpack however the tracer signature of stream water in rambiara catchment was defined by the lower δ18o of snowpack to the right the higher δ18o of rain to the top left and the lower δ18o of groundwater to the bottom of the mixing plot fig 3 the d excess signature is defined by lower value of rain higher value of snowpack and intermediate value of groundwater 4 2 stable water isotopes in precipitation during the monitoring period the stable isotopes in precipitation rain varied between 3 2 and 16 9 standard deviation sd 3 1 for δ18o and 6 9 to 25 8 sd 4 0 for d excess with an average of 6 7 and 17 2 respectively table 2 in sindh catchment the measured δ18o and d excess values of precipitation from three sampling stations rayil cherwan and sumbal ranged between 15 0 and 3 2 for δ18o with an annual amount weighted precipitation value of awap 6 32 and 6 9 and 25 8 awap 17 2 for d excess likewise in rambiara catchment the isotopic composition of precipitation from three sampling stations hirpur kanipora and wachi ranged between 16 9 and 1 4 for δ18o awap 6 9 and between 8 and 25 4 awap 17 2 for d excess the δ18o showed a marked spatio temporal variation in precipitation in both the catchments from all the six stations the lower isotopic values were observed at higher altitudes and higher values at lower altitudes which are consistent with the so called altitude effect jeelani et al 2010 clark and fritz 1997 ingraham and taylor 1991 from the regression equations a significant correlation exists between the annual amount weighted δ18o values of precipitation and the altitude of the stations with r2 0 90 p values 0 01 for sindh and r2 0 96 p value 0 01 for rambiara catchment fig 5 the altitudinal gradient of 0 32 and 0 37 for δ18o per 100 m increase in elevation was observed in sindh and rambiara catchments respectively these results fall within the limits of earlier reported studies based on catchment scales in the himalayas yao et al 2009 jeelani et al 2017a and across the globe clark and fritz 1997 dansgaard 1964 the isotopic values δ18o and d excess of each precipitation event showed higher degrees of fluctuation throughout the observation period fig 6 a pronounced sinuosity was observed in the isotope data which represent different seasons the lower isotopic values were observed from september to march whereas the higher values were observed from april to august in sindh catchment the lower δ18o values from september to march varied between 14 6 and 2 3 with a mean of 7 7 and the d excess between 12 4 to 25 8 with a mean of 19 3 fig 6a the higher δ18o values from april to august varied between 15 0 and 3 2 with a mean of 4 7 and the d excess between 6 9 and 22 2 with a mean of 14 9 similarly in rambiara catchment fig 6b the lower δ18o values from september to march varied between 16 9 and 3 4 with a mean of 7 6 and the d excess between 8 0 to 25 4 with a mean of 18 7 the higher δ18o values from april to august varied between 16 6 and 1 4 with a mean of 6 1 and the d excess between 9 6 and 24 9 with a mean of 15 5 in january lowest isotopic values δ18o 13 7 to 4 5 for sindh and 10 0 to 3 7 for rambiara and high d excess 15 to 25 8 for sindh and 17 to 22 7 for rambiara were observed in precipitation whereas higher isotopic values were observed in june δ18o 3 4 to 3 2 for sindh and 7 2 to 1 4 for rambiara with lower d excess 6 9 to 16 for sindh and 9 6 to 18 4 for rambiara the lower and higher isotopic values of precipitation events are attributed to seasonal change in the meteorological parameters and the moisture sources as evident from fig 6 the progressive increase in δ18o from january to june and decline in δ18o from july to december is consistent with the progressive rise in temperature from january to june and decrease in temperature from october to december the higher δ18o values observed in precipitation events of may and june suggest the secondary evaporation of the events with lesser precipitation amount however from july to september irrespective of the higher temperatures and rh 80 the decreasing trend in precipitation δ18o values reflects the change in the moisture source during this period precipitation is brought by ism on the other hand the increase in d excess from october to april with increasing temperatures fig 6 indicates an equilibrium state between temperature influencing isotopic enrichment via evaporation and moisture recycling froehlich et al 2008 pang et al 2011 the higher d excess 20 usually is due to evaporation under non equilibrium conditions over the mediterranean sea and neighbouring areas and the influence of continental effect from source to the site gat and carmi 1970 jeelani et al 2018 previous studies have revealed that the high d excess is associated with the precipitation brought by western disturbances wd to the western himalayas during october to may jeelani et al 2017 2018 lone et al 2019 the decrease in d excess from may to september suggests the seasonal meteorological change and moisture source interestingly some of the events in july showed higher d excess 12 which may be attributed to the mixing of different moisture sources as both the wd known to be active throughout the year being more intensive during winters and the ism active during june to september only are active jeelani et al 2018 the lower d excess 10 4 to 14 of precipitation events was observed during the month of august the precipitation events with lower d excess 10 indicate the moisture source from ism gat and carmi 1970 gat et al 1996 tian et al 2005 hren et al 2009 kumar et al 2010 jeelani et al 2010 2017 2018 4 3 stable water isotopes in snow and snowpacks fresh snow samples from three stations in each catchment during december to february winter and snowpack samples from winter accumulated snow were collected along various transects during this study fig 1 both snow and snowpacks covered a broad isotopic range between 7 2 and 13 5 sd 1 64 for δ18o and 15 6 and 25 6 sd 2 45 for d excess with an average of 9 7 and 20 4 respectively table 2 in sindh catchment the measured isotopic values ranged between 7 7 and 13 5 with an average value of 10 3 sd 1 5 for δ18o and between 15 6 to 24 with an average value of 20 sd 1 9 for d excess likewise in rambiara catchment the isotopic composition of snow and snowpacks ranged between 7 2 and 11 8 with an average value of 8 4 sd 1 for δ18o and 18 1 and 25 6 for d excess with an average value of 22 2 sd 1 9 like precipitation the snowpacks also showed a good correlation r2 0 76 p value 0 05 for sindh and r2 0 67 p value 0 05 for rambiara with altitude fig 7 the vertical isotopic gradients of 0 23 and 0 16 for δ18o per 100 m rise in elevation were observed in snow and snowpacks of sindh and rambiara catchments respectively the snow and snowpacks from high altitude peaks above 3700 m amsl adds mass to the glacier and doesn t contribute to the streamflow as the annual average temperature in these high altitude regions is sub zero besides these could diminish the lapse rate due to post depositional processes taking place over space and time the observed isotopic altitude gradient of meltwaters from snow and snowpacks was higher than that of stream water and lower than that of precipitation rainfall in sindh and the rambiara basin respectively the broad isotopic range of fresh snow samples in winter result due to wide variability in temperature however wide variability in isotopic composition of snowpack samples suggest their sampling from different elevations and at the same time the progressive seasonal isotopic enrichment that snowpacks underwent during the melting processes taylor et al 2001 lee et al 2010a the temperature isotherms distinguish the seasonal distribution of temperature in both the river catchments fig 8 the spatial variation in temperature indicates how the snowpack influence varies over progressive seasons representative months chosen for each season as the temperature increases from march spring the melting of snowpacks takes place at lower altitudes which consequently results in higher isotopic values however with the progressive melting in summer and autumn july to september the snowpacks shift towards high altitudes the meltwater released from these high altitude snowpacks result in lower isotopic values this is attributed to lower temperatures which results in increased fractionation in addition the summer precipitation brought by indian summer monsoons have presumably lower isotopic values which admixes with the snowpacks and result in lower isotopic values from november to early march winter and early spring the higher isotopic values were observed which could be attributed to the fresh snowfall subjected to evaporative enrichment through the winter 4 4 stable water isotopes in groundwater the isotopic values of groundwater varied between 4 8 and 9 8 sd 0 9 for δ18o and 12 4 and 25 4 sd 8 15 for d excess with an average of 7 7 and 19 6 respectively table 2 in sindh catchment the measured δ18o and d excess values in groundwater ranged between 4 8 and 9 8 with an average value of 7 7 sd 0 9 for δ18o and 12 4 to 25 3 with an average value of 19 6 sd 3 1 for d excess likewise in rambiara catchment the groundwater isotopic composition ranged between 6 1 and 9 5 with an average value of 7 7 sd 0 8 for δ18o and 14 8 and 25 4 for d excess with an average value of 19 9 sd 7 5 the isotopic composition of groundwater obtained from shallow observation wells vary in space and time the lower isotopic values at the upstream suggest the contribution from high altitude precipitation while as higher values towards downstream area are suggestive of the mixing of river components rain melt from snow snowpack and groundwater respectively the groundwater samples fall between precipitation rain and snow and river water indicating that these are the major sources of groundwater recharge in the basin the isotopic composition of groundwater was found to be variable throughout the year fig 9 in sindh catchment higher isotopic values were observed in summer may june except august while lower during the rest of year except december in contrast lower isotopic values were observed in rambiara throughout the year except june and december the higher isotopic values in may june and even in december are attributed to mixing of meltwaters derived from low altitude snow and snowpacks and precipitation with higher isotopic composition the narrower range or lower values in august suggests the recharge from meltwaters from snow and snowpacks higher river discharge at higher altitudes besides lower isotopic values in groundwater during these months also reflect the recharge from monsoonal precipitation the mixing of source waters from different altitudes and routing through different flow paths often results in high variability as in case of september this is because the meltwaters from snowpacks that are at the verge of extinction result in higher isotopic values while monsoonal precipitation result in lower isotopic values however in winter with sub zero temperatures insignificant snow or glacier melting minimum river discharge indicates the maximum contribution of water from the aquifer system of the basin with uniform isotopic values fig 3 and hence a true representative of baseflow 4 5 stable water isotopes in stream water the isotopic values of stream water varied between 4 6 and 11 6 sd 1 00 for δ18o and 14 7 to 22 4 sd 1 5 for d excess with an average of 7 9 and 18 6 respectively table 2 in sindh catchment the measured δ18o and d excess values in stream water ranged between 4 6 and 11 6 with an average value of 8 54 sd 1 0 for δ18o and 22 4 to 14 7 with an average value of 18 4 sd 1 8 for d excess similarly in rambiara catchment the stream water isotopic composition ranged between 4 9 and 9 2 with an average value of 7 3 sd 0 6 for δ18o and 22 and 16 8 for d excess with an average value of 18 8 sd 1 3 in both the catchments the isotopic composition of stream water showed a narrower range compared to rainfall snow and snowpacks indicating the waters originating from headstreams mixed to give composite stream water the relatively depleted isotopic values of sindh river compared to rambiara river refers to the low evaporation rate and rapid discharge particularly in headstream areas the rapid discharge results in less transient time of water induced by the steep gradient and hence least effect of evaporation fractionation on stable water isotopes moreover the differential aspect of snow and snowpacks to the solar radiation further confirms the less evaporation and thus depleted isotopic values in sindh catchment obvious spatio temporal variations were observed in both the catchments the stable isotopes of river water are also affected by the elevation of the basins lower isotopic values were observed towards the head streams while as higher values at lower altitudes fig 5 the lower values may be due to the influence of high altitude precipitation whereas higher values suggest the mixing of waters from different flow paths and altitudes in downstream catchment in addition the decrease in elevation and latitude enhance the degree of evaporation of water along the river course which also results in downstream isotopic enrichment li and garzione 2017 the vertical isotopic gradients of 0 15 and 0 11 for δ18o per 100 m increase in elevation r2 0 93 p value 0 05 for sindh and r2 0 88 p value 0 05 for rambiara were observed in stream water of sindh and rambiara catchments respectively the observed isotopic gradients fig 5 were similar to that reported from kumaun lesser himalaya 0 15 100 m bartarya et al 1995 and western himalayas 0 133 100 m biggs et al 2015 but lower than the headwaters of river ganga 0 19 100 m ramesh and sarin 1992 and that observed by pande et al 2000 0 19 100 m the samples of stream water from garzione et al 2000 which include samples from central eastern himalayas tibetan plateau and nepalese himalaya result in higher isotopic gradient 0 29 100 m our results are in good agreement with the studies reported by bartarya et al 1995 and biggs et al 2015 suggesting the regional variation in isotopic composition is controlled by vapour source and meteorology of the region in sindh catchment the stream water isotopes were lower throughout the year avg δ18o 7 except july fig 10 the lower isotopic values correspond to the discharge from melting of the snow and winter accumulated snowpacks at higher altitudes besides the seasonal precipitation contributes significantly governing the temporal variability of the isotopic composition of stream water in july the increase in δ18o of stream water may be due to the mixing of meltwaters derived from snowpacks and precipitation with higher isotopic values the relatively lower δ18o values in august suggest the mixing of meltwaters and the maximum influence of summer rainfall with lower isotopic composition to the stream water in rambiara catchment similar isotopic trend was observed during october to may while as higher values were found during summer fig 10 lower values result due the mixing of meltwaters from winter accumulated snow at higher altitudes and precipitation with lower isotopic composition however higher temperature in summer results in progressive evaporative enrichment of snowpacks with advancing season thereby higher isotopic values also the rambiara catchment is devoid of any glacier mass the rain signature becomes more pronounced when the snowpacks are about to disappear moreover the lower gradient of rambiara compared to sindh river results in high evaporation and lower discharge and thus higher isotopic composition in autumn the change in the water source from snowpacks to rain groundwater with lower discharge results in higher isotopic values of river water 4 6 sources of stream water and their uncertainties the estimated monthly contribution of stream water components and associated uncertainties values suggested that the groundwater and snowmelt were the dominant stream water components in the sindh and rambiara river basins fig 11 the monthly contribution of groundwater varied between 12 0 5 and 78 5 0 and that of the snowpacks between 11 1 6 and 55 4 6 in both the river basins in sindh basin the snowpacks and groundwater offer maximum contribution to stream water where the contribution of the snowpacks varied between 22 0 2 and 55 4 6 with an annual average value of 40 4 6 and the groundwater between 12 0 5 and 65 7 4 with an annual average value of 34 3 6 respectively however in rambiara basin the groundwater 15 4 6 78 5 0 with an average annual value of 39 4 2 followed by the snowpacks 11 1 6 51 6 2 with an annual average value of 35 4 0 were the dominant contributors to the stream water the dominant contributions from snowmelt to streamflow are common in high elevation catchments of western himalayas monthly contributions between 11 and 55 in both the river catchments are comparable to the results of studies conducted in other himalayan catchments jeelani et al 2012 2016 and 2017 the hydrograph separation was dominated by snowmelt followed by groundwater to streamflow contributions bookhagen and burbank 2010 reported that on an annual timescale snowmelt contributes 15 to 60 of discharge in the western himalayan rivers whereas the central and eastern himalaya receive more than 80 of their discharge from rainfall importantly for all himalayan rivers draining into the arabian sea the snowmelt contribution is significant due to their high winter snow cover area in spring march to may the contribution of the end members was governed by the mixture of snowpacks 44 3 and rainfall 42 4 to the sindh river runoff and 38 3 and 40 5 to the rambiara river runoff respectively the groundwater contribution was found to be minimum from march to may in both the catchments the increase in temperature 4 18 c from early spring results in melting of snow from lower altitudes 2500 m amsl resulting in the increase of meltwater contribution from snow and snowpacks with the progressive seasons moreover precipitation mostly in the form of rains in march april was observed to be higher which further corroborates with our findings during summer june to august the snowpack 52 3 and the groundwater 26 2 contribution in sindh increased by 8 and 12 while in rambiara snowpack 51 4 contribution increased by 13 and the groundwater 23 3 increased by 1 respectively however the contribution of rainfall 22 3 in sindh and 26 3 in rambiara decreased by 20 in sindh and 14 in rambiara respectively this is because the maximum temperatures 18 23 c particularly in summer and early autumn september promote higher degrees of melting of winter accumulated snow and result in higher discharge being a dominant contributor the meltwater from winter accumulated snow not only flows in streams but also recharges the groundwater from the beginning of the melting season however due to shallower nature these aquifers are not only quickly recharged but starts contributing significantly to stream flow with the advancement in melting season the contribution from snow and snowpacks 40 3 in both sindh and rambiara started to decrease in autumn september to november whereas the groundwater contribution increases with advancing season 35 5 in sindh and 34 6 in rambiara the decrease 10 12 in snow and snowpack meltwater is due to the fact that most of the snowpacks at higher altitudes have been lost and some are at the verge of extinction due to prolonged melting through summers in winter maximum groundwater contribution of 62 6 was observed in sindh and 71 7 in rambiara river runoff the decrease in contribution of other components snowmelt and rain in winter corresponds to the decrease in ambient temperatures and change in precipitation form rain to snow overall temperature altitude and the precipitation form were the dominant factors that regulate the contribution of different components to the stream water runoff the contribution from glacier melt end member was not considered in the analysis this could affect mass balance computations but it is reasonable to assume that this would not change the general runoff regime the glaciers in the temperate climate such as kashmir valley are covered by seasonal snow cover even during the peak melting season a potential contribution from glacier melt was assumed to be insignificant a study carried out in glacier fed catchment by jeelani et al 2016 have reported that the annual contribution of glacier melt to streamflow was only 5 the study also demonstrates that the glacier melt contribution could vary depending upon the persistence of snowpacks in the catchment therefore with no data option from glacier melt and the presence of snow at altitudes above 4000 m asl having similar isotopic composition to that of glaciers the contribution from glacier melt was neglected the uncertainty defined in eq 9 was applied to three component hydrograph estimates which involve two tracers δ18o and d excess as for the separation in this study spatio temporal variations were observed in all water types which led to uncertainties in the estimated hydrograph components however the uncertainty from the laboratory analytical error calculated from the measurement method were less compared to the spatio temporal variations in tracer concentrations the calculated uncertainties ranged from 0 2 to 7 9 for sindh catchment and 0 7 to 7 0 for rambiara catchment the uncertainty for snow and snowpacks was highest than those of other components this is attributed to the altitude seasonal variability of air temperature and post depositional processes that enhance the spatial and temporal variability of isotopic composition of snowpacks dahlke and lyon 2013 dietermann and weiler 2013 schmieder et al 2016 zuecco et al 2019 4 7 significance of cryosphere in riverine ecosystem globally various studies about the high spatial variability in the isotopic composition of snowpacks have been related to the topography carey and quinton 2004 dahlke and lyon 2013 dietermann and weiler 2013 schmieder et al 2016 elevation beaulieu et al 2012 and ohlanders et al 2013 canopy allen et al 2016 snow sublimation earman et al 2006 n da et al 2016 snow metamorphism and snow redistribution friedman et al 1991 taylor et al 2001 mott et al 2010 etc in alpine catchments like the sindh and rambiara with high relief the meltwater released from the snowpack cover a wide isotopic range which depend not only on the altitude but also the melting stage of the snowpack jeelani et al 2018 besides altitude and seasonal effects several other factors such as micro and macro topography redistribution through wind drift canopy land surface slope and aspect can significantly impact the spatial and temporal variability of isotopic composition of snowpack gustafson and others 2010 lee 2014 pu et al 2020 prior to melting two physical processes such as wind scour and sublimation tend to modify the isotopic composition of top layer of the snowpack and thereby decrease the vertical isotopic gradient naftz et al 2004 helsen et al 2005 the process of sublimation plays a major role in snow ablation which is influenced by the sun s exposure and winds in general sublimation is most effective in arid climates stronger winds whereas wind scour is prominent in small basins microscale catchment with high relief stichler and schotterer 2000 in the present study the humid and temperate climate of the region and large area of the catchments makes these processes less effective however the higher vertical isotopic gradient observed in the snowpacks suggests the effect of post depositional processes in the snowpack modification evolution over changing seasons the snow and or snowpacks start melting in early spring when the average temperatures rise melting occurs primarily on sun exposed slopes as these receive largest influx of solar radiation the resultant melt percolates through the snowpack so called pervasive flow and flows at the ground surface snowpack interface resulting in a progressive contribution of isotopically enriched isotopes this change is caused by the isotopic mass exchange between snow grains and liquid water and or water vapour in pore spaces and the exchange with the atmosphere lee et al 2010a johnsen et al 2000 neumann and wadington 2004 in addition the isotopic change depends on the contact time between snow and liquid water and or water vapour primarily defined by the melting rate of the snowpack via sun s exposure and also to the isotopic layering of the snowpack pang et al 2006 taylor et al 2001 during this exchange the isotopically lighter vapours or melt are lost to the atmosphere and drained out after reaching the retention capacity eventually leaving behind the heavier isotopes in the residual snowpack ekaykin et al 2009 o neil 1968 stichler 1987 rhode 1998 as these processes are directly dependent on the altitude of snowpacks the contact time between various phases of water is longer at lower altitudes than at higher altitudes the lower altitude snowpacks are more exposed to warm ambient temperatures which result in enriched heavier isotopes than at higher altitudes and therefore the higher isotopic altitude gradient in snowpacks in mountainous catchments such as sindh and rambiara the snow and snowpacks are the important resources of water to downstream catchments these resources are of high economic and social value as they govern the spatial and temporal runoff dynamics within the river flow besides these resources are useful in maintaining ecological and environmental sustainability in the region the meltwater derived from such resources are important in domestic agricultural and hydropower generation in particular these play a major role in agriculture horticulture as majority of the downstream population deals with the agriculture horticulture moreover meltwater plays a critical role in the aquatic ecology of the catchment by regulating the summer stream temperatures by maintaining the high quality habitat of the aquatic life however in the face of recent climate change the snow cover and glaciers are vulnerable which could lead to the shrinkage of these resources towards higher altitudes and would cause a systematic reduction in water supply security the glaciers and snowpacks in the kashmir region are retreating at an accelerated pace in response to climate change kääb et al 2012 the shrinking of the himalayan cryosphere has been linked to decrease in contribution to streamflow and could affect the water availability in the downstream catchments immerzeel et al 2012 studies have reported an increasing trend in temperature and precipitation from the long term data 1901 2010 over the 20th century jeelani et al 2012 the increasing trend in temperature during winter not only lessens the solid precipitation snow but also results in reducing snow cover and subsequently less snowmelt contribution to streamflow the climate change scenario significantly affects the water cycle and the availability of the seasonal source waters to the stream flow in the region the increase in temperature during spring results in higher snowmelt contribution higher discharge with profound impact on snowpack health and less runoff with progressive seasons the consequences of this change are that flood risks are likely to increase during high spring runoff while decrease in availability of water for agriculture horticulture during summer all these changes have the potential to affect the economy and food security of the region dependent on these resources therefore understating the hydrological functioning within the mountainous catchments is necessary for their sustainability 5 conclusion in this study marked spatial and temporal variation was observed in different source waters of sindh and rambiara river catchments rain and fresh snow samples evolve as two end members with the former exhibiting the most positive enriched and later the most negative depleted δ18o values it was observed from the results that the stream and groundwater showed a narrow range falling between rain and snow stable water isotopic composition the wide variability in the isotopic composition of source waters appeared due to change in the meteorological parameters differential melting of snowpacks and moisture source regions moreover the lower isotopic values at higher altitudes and higher values at lower altitudes are consistent with the altitude effect the altitudinal gradients of 0 32 0 23 and 0 15 for δ18o per 100 m increase in elevation were observed in the rain snow and snowpack and stream water of sindh while as 0 37 0 16 and 0 11 for rambiara catchment respectively the mixing calculation indicates that the meltwater derived from snow snowpacks and groundwater are the dominant components of streamflow in sindh river the snowmelt offer an annual average contribution of 40 4 6 followed by the groundwater 34 3 6 whereas slightly higher contribution from groundwater 39 4 2 than that of snowmelt 35 4 0 was observed in rambiara river the study suggested that the temperature altitude and the precipitation form were the regulatory factors controlling the contribution from different sources to the stream water runoff the changing climate and differential melting behaviour of snow could have serious impact on the water resources of the region which may then influence the large populations housing downstream at local and regional scale credit authorship contribution statement altaf lone conceptualization methodology data curation writing original draft ghulam jeelani conceptualization supervision writing review editing r d deshpande formal analysis supervision writing review editing virendra padhya formal analysis writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103995 appendix supplementary materials image application 1 
254,snow and glaciers are important freshwater resources in the himalayan catchments for all biological activities however under recent climate change these resources are decreasing thereby posing a serious threat to the future freshwater resources among the himalayan catchments therefore understanding the hydrological behaviour and sources of streamflow is necessary for better assessment planning and management of these waters in the mountainous catchments this study is based on the use of δ18o and d excess to identify and estimate the different sources of streamflow in the western himalayas the isotopic composition of different source waters varied over space and time these variabilities are attributed to the seasonal meteorological changes precipitation form differential melting of snowpacks and moistures sources the vertical isotope gradients were observed between the sampling sites and the elevation of the basin the results suggest that snow and snowpack dominantly up to 55 contribute to the streamflow during high flow period while as groundwater maintains the flow in the streams during lean period and contributes up to 78 the study provides the important insights about the understanding of spatio temporal variability of different source waters contributing to runoff in addition the changing climate could have serious impact on the water resources of the region and thereby affecting the economic and social values of the downstream populations keywords stable isotopes streamflow snow groundwater mixing analysis western himalayas 1 introduction mountains which cover 24 of earth s land surface kapos et al 2000 are the principal component of global water supply because they act as natural reservoirs of fresh water in the form of snow and glaciers runoff from precipitation meltwater from mountain snowpacks and glaciers and groundwater discharge provide a valuable resource to downstream population for domestic agricultural and other allied activities kriegel et al 2013 in addition to surface runoff processes the snow and glaciers play a critical role in climate the high albedo of snow and glaciers reflect significant proportions of solar radiation away from the earth s surface which results in cooling effect thus balancing the surface energy budget the himalayas encompassing 9600 glaciers with an area of 40 000 km2 form the largest cryospheric reserve outside the arctic and antarctic regions bolch et al 2012 agris 2018 these glaciers and snowpacks maintain the perennial source of runoff to major river systems such as the indus ganga and brahmaputra housing nearly 17 of the global population barnett et al 2005 lemke et al 2007 the runoff from these himalayan rivers support world s most extensive irrigated regions of northern india and plains of pakistan among these major himalayan basins the indus basin has the largest 22 000 km2 snow and glacial cover where snow and glacial melt are estimated to contribute 65 85 to annual flows immerzeel et al 2009 2010 mukhopadhyay and khan 2015 lone et al 2021 previous studies have suggested that most of the himalayan glaciers 70 are receding at faster rate with some fewer exceptions from karakorum range that are advancing naithani et al 2001 dobhal et al 2004 hewitt 2005 kulkarni et al 2007 kumar et al 2008 bolch et al 2012 bhambri and bolch 2009 casper 2010 the large scale retreat of glacier and snow cover could pose a serious threat of water security in downstream population and even increase the risks of natural hazards immerzeel et al 2010 therefore understanding the existing hydrological regimes in the region adaptive countermeasures are required for the management of these water resources the kashmir valley also known as upper jhelum basin ujb lies in the nw himalayan complex with an area of about 12757 km2 the ujb forms one of the major tributary of indus river system where precipitation snow and rains meltwater and groundwater availability is especially important because most of the area s growing economic production in terms of agriculture horticulture and hydropower generation depends on these resources in western himalayas maximum stream river runoff is generated from snow ice melt besides rainfall and baseflow the flow within the streams varies over space and time which may exhibit seasonal trend due to varying contribution from glacier or ice snowmelt groundwater baseflow and rainfall understanding the spatio temporal variability of the stream river flow is an important step for the assessment planning and management of these waters in the downstream areas stable isotopes of water 18o and 2h have been widely used as conservative tracers to understand the various hydrological processes such as source of atmospheric precipitation interaction between surface water and groundwater groundwater recharge and discharge identification of river water sources hydrograph separation etc craig 1961 rozanski et al 1993 clark and fritz 1997 rai et al 2014 yao et al 2009 yin et al 2011 the isotopic composition of hydrogen and oxygen isotopes in various water bodies influenced by isotopic fractionation has wide spatio temporal distribution and the different sources of water bodies have different isotopic characteristics zhang and wu 2007 the isotopic composition of river waters from different areas are affected by meteorological processes providing a characteristic fingerprint of their sources clark and fritz 1997 besides large scale atmospheric processes the stable isotopes of precipitation in small watersheds are affected by local meteorological factors and geographical conditions zongxing et al 2015a with the change in isotopic composition of precipitation input isotopes in surface water and groundwater will also experience wide spatial and temporal distribution heterogeneity huang et al 2016 several previous stable water isotope studies have been carried out in the himalayas breitenbach et al 2010 deshpande et al 2003 gupta et al 2005 jeelani et al 2010 2013 2017 2018 kumar et al 2010 lone et al 2019 sukhija et al 1998 where special emphasis was given to atmospheric moisture source relationship with meteorological factors and the spatio temporal variation of isotopes in different water bodies in recent years conservative isotopic tracing has been carried out at watershed level in order to quantify the contribution of winter and summer derived precipitation in high altitude catchments singh et al 2019 estimate the catchment residence times jeelani et al 2013 hu et al 2020 wan et al 2020 compute the regional water balance jeelani et al 2017 lone et al 2017 gibson et al 2018 kumar et al 2018 singh et al 2019 moreover these tracers have the potential to identify the various components that contribute to the runoff including snowmelt glacier melt and groundwater baseflow and estimate their relative contribution to streamflow maurya et al 2011 penna et al 2014 jeelani et al 2016 2017 singh et al 2019 although various studies have been carried out in the himalayas but most of them are focussed on the model based results of stable water isotopes their controlling factors and quantification of end member contribution to the streamflow considering the complex terrain and climate in himalayas a thorough analysis of the high spatio temporal variability in the isotopic composition of the source waters to streamflow in high elevation catchments like sindh and rambiara are still lacking despite the complex terrain and difficulty in sampling high resolution analysis was performed to identify and estimate the contribution of various source waters such as rainwater snow snowpacks and groundwater to the streamflow in these catchments the study will enhance the reliability of results based on isotope hydrograph separation by considering the spatio temporal variations in the isotopic composition of these source waters the objectives of the study are 1 to assess the spatio temporal variability of stable water isotopes in source waters rainwater snow snowpack and groundwater and 2 to quantify the relative contribution of source waters to streamflow in sindh and rambiara catchments this study is expected to improve the knowledge of hydrometrological processes in these cold high elevation and snow dominated catchments of western himalayas 2 study area the kashmir valley is an intermontane sedimentary basin bounded by pir panjal range on sw and the greater himalayan range on nw jaan et al 2015 fig 1 the ujb comprises of 24 watersheds with half of them originating from pir panjal range left bank tributaries and half from the greater himalayan range right bank tributaries all these tributaries fall into the major drainage of the valley known as river jhelum which is one of the major tributary of indus river system the sindh catchment 34 05 34 30 n 74 35 75 40 e is one of the upland mountainous catchment of river jhelum which is located towards the northeastern extremity of kashmir valley fig 1 the area of this catchment is 1585 km2 and exhibit an altitudinal variation of 1560 to 5375 m above the mean sea level the main channel length is 96 km with a height difference of 3020 m from source to the outlet the sindh river originates from the lofty peaks of bodpathar and poshpathar area of greater himalayan glaciers panjtarni group of glaciers and flows in e w direction downstream tributaries originating from nehnar group of glaciers har nag thajiwas glacier and harmukh group of glaciers are also the primary perennial feeders of the sindh river the catchment is divided into two zones based on morphological characteristics from east to west from source to mid basin up to ganderbal the first zone is comprised of rocky uplands characterised by high steep rocky mountains with narrow and deeply incised fluvial valleys numerous small lakes like sona sar hoka sar yamhar sar nil nag har nag gangbal lake nund kol andarun sar lalgul sar salnal sar kaul sar etc are found within this zone that remain snow covered most of the year the second zone is comprised of recent alluvium characterised by wide valleys river capture river bradding and several unpaired river terraces farooqi and desai 1974 bhatt 1989 the river finally meets the wetland shalabug nambal before the confluence with the jhelum river at shadipur the catchment consists of various source rocks from archean to quaternary age middlemiss 1910 the salkhala series of archean rocks carbonaceous slates phyllites marble and mica schists together with syringothyris limestones carboniferous triassic jurassic limestones panjal volcanics carboniferous zewan limestone permian muth quartizite devonian and granites are widely distributed and oldest exposed rocks in the upper river basin in the mid lower basin older rocks salkhala and panjal volcanics are exposed while as in middle these rocks are overlain by the unconsolidated sediments karewas of upper pleistocene age and recent alluvium lone et al 2016 the rambiara catchment 33 20 34 54 n 73 35 75 35 e is located in the south and southwest extremity of kashmir valley fig 1 the area of this catchment is 641 06 km2 and exhibit an altitudinal variation of 1580 to 5000 m above the mean sea level the main channel length is 72 km with a height difference of 2646 m from source to the outlet the rambiara river originates from the rupri ridge of the pir panjal range and the bhag sar lake near naba pir pass at sokh saria as the rambiara catchment is devoid of any glacier mass the huge accumulations of snow at higher elevations in winter maintains the flow within the river during different seasons within the catchment there is a gradual decrease in the terrain from south to north with distinct geomorphological characteristics divisible in three zones starting from its south to southwestern side the first zone is comprised of rocky uplands characterised by high steep rocky mountains with deep and narrow fluvial valleys numerous small lakes like bhag sar barani sar kotori sar laksukh sar golio sar dhaklar sar chandan sar and nandan sar are found within this zone that remain snow covered most of the year in the middle the second zone tilted lower karewas with wide and gently sloping pediment directly overlie the basement rocks of panjal traps triassic limestone this zone is marked by river capture beheaded streams river bradding and several unpaired river terraces farooqi and desai 1974 bhatt 1989 the maximum width of river is also observed within this zone reaching upto 1 km near balapur village characterized by a large braided bar deposit the third zone is comprised of recent alluvium characterised by wide valleys and river terraces similar to the first zone the river has regained its narrow course but with lower gradient of the terrain before the confluence with the vishaw river and finally the jhelum river at nyaiyun the catchment consists of various source rocks from upper carboniferous to quaternary age middlemiss 1910 the upper carboniferous permian rocks slates andesite and basalts together with triassic limestones dolomites and shale are widely distributed and oldest exposed rocks in the mid upper river basin in the mid lower basin older rocks are overlain with an angular unconformity by the unconsolidated plio pleistocene sediments of fluvio glacial origin known as karewas the karewas form the dominant lithology of the catchment while as the northeastern part of the basin consists of recent alluvium the region has a temperate climate the sindh catchment received an annual average precipitation of about 1240 mm and the rambiara catchment received about 1136 mm during the year 2017 fig 2 snowfall occurs in winter and spring while rains are prominent throughout the year the monthly precipitation is highly variable but comparable in both the catchments higher precipitation was observed in january while lowest in november the high precipitation observed at higher altitudes and low precipitation towards the lower altitudes suggest the influence of topography in both the catchments the mean annual temperature ranged from 0 8 to 19 c for sindh and 1 3 to 23 c for rambiara catchment with lowest temperature recorded in january and highest in july like precipitation the monthly temperatures in sindh were relatively lower than the rambiara catchment which again indicates the strong influence of topography of the catchments the altitude of sindh varies from 1563 to 5375 m amsl while as for rambiara from 1583 to 4560 m amsl 3 materials and methods 3 1 sampling and analysis an extensive strategy was designed to document the spatial and temporal variation in the isotopic composition of source water precipitation stream water and snowmelt and groundwater water sampling was carried out in the representative catchments from january to december 2017 and a total of 725 water samples were collected during the course of this study event based precipitation samples n 235 were collected from three stations within each catchment table 1 fig 1 the rainwater samples were collected throughout the year while as fresh snow n 37 during the winter the precipitation collector was made in accordance to iaea guidelines iaea 1983 while as fresh snow was collected using pvc tube 1 2 inch diameter the fresh snow samples were transferred in 1 l wide mouthed bottles capped and left for melting to avoid evaporation processes the samples were immediately bottled in 10 ml hdpe bottles since both the catchments are devoid of any meteorological station the meteorological information precipitation amount temperature and relative humidity from the station of adjacent watershed avg distance to the centre of catchment is 30 km was considered to be the representative of the sampling station the meteorological data from pahalgam weather station 34 01 n 75 19 e 2132 m amsl was chosen for sindh catchment while the qazigund weather station 33 38 n 75 08 e 1661 m amsl for rambiara catchment respectively fig 1 the river water samples n 168 were also collected on monthly basis during the observation period the river water samples were collected from 7 different locations within each catchment keeping in view the altitudinal gradient along the river course fig 1 groundwater samples were collected from the tube wells sponsored by central groundwater board cgwb and state groundwater board sgwb and 10 wells per catchment were chosen along the river course a total of 240 groundwater samples were collected during the year 2017 on monthly basis the depth of the sampled wells ranged from 1 4 m below the ground surface and classified as shallow wells jeelani et al 2020 prior to sample collection the tube wells were purged for at least 5 min as all the wells are of shallower depth the snowpack samples n 82 were collected from march to november from the winter accumulated snow at various altitudes ranging between 1900 and 3700 m amsl the snow and snowpacks from high altitude peaks above 3700 m altitude were inaccessible which makes it difficult for sampling besides these remain frozen and are added to the mass of glacier due to sub zero temperature conditions all the water samples were collected in 10 ml pre cleaned high density polyethylene hdpe bottles the bottles were filled to the maximum limit without any residual air bubbles and tightly capped to prevent evaporation and exchange with the atmosphere after proper labelling coding the samples were kept in the laboratory at a container temperature maintained at 4 c until their analysis the samples were sent to geosciences division physical research laboratory prl ahmedabad for the analysis of stable water isotopes δ18o and δ2h the liquid oxygen and hydrogen analysis was carried out using delta v plus isotope ratio mass spectrometer in a continuous flow mode and following equilibration with standard gas epstein and mayeda 1953 the δ18o and δ2h measurements were determined by equilibrating 300 μl of water samples with co2 and h2 for 16 hours at 25 c respectively maurya et al 2009 the results are denoted in the δ notation as per mil and defined in relation to vienna standard mean ocean water vsmow the overall precision and consistency of the measurements for δ18o and δ2h was 0 1 and 1 0 based on multiple aliquots of secondary laboratory standards the amount weighted means of precipitation δ18o and δ2h values were calculated as 1 x w m a n n u a l p i x i i p p i where pi denotes the precipitation amount of every single sample recorded at the respective precipitation site and xi is the corresponding isotopic value another parameter the deuterium excess d excess defined as d δ2h 8 δ18o by dansgaard 1964 determines the deviation of a set of data points from the line of slope 8 in δ18o δ2h plot the d excess has been a useful tracer of the vapour source region used to measure the contribution of water vapour from different sources to the specific site feng et al 2009 juhlke et al 2019 the evaporation over the source regions generate d excess due to the process of kinetic fractionation under non equilibrium conditions bershaw 2018 the degree of kinetic fractionation is influenced by both oceanic variables including sea surface temperature sst relative humidity and evaporation flux pfahl and sodemann 2014 bonne et al 2019 as well as continental variables such as elevation sub cloud evaporation of falling raindrops continental moisture recycling or air mass trajectory length over land surfaces rozanski et al 1982 froehlich et al 2008 goldsmith et al 2017 3 2 hydrograph separation three component hydrograph separation based on mass balance approach genereux et al 1998 was used to calculate the ratios of different recharging sources in the sindh and rambiara catchments to estimate the seasonal temporal variation in the proportion of various source waters contributing to the total river discharge a few assumptions are made as follows 1 the total river discharge in both the river catchments is predominantly sourced from three components as i the rain water ii the melt from snow snowpack and iii the groundwater discharge although it is presumed that groundwater is recharged by meltwaters derived from snow snowpacks but a significant amount is contributed by rainfall as well therefore the groundwater forms an important component with definite isotopic composition derived from the mixing of stored groundwater meltwaters from snow snowpack and rain water during winter december to february the δ18o and d excess of fresh snow was selected as a separate end member when the meltwater contribution from snowpacks is insignificant to cover the entire spectrum of meltwater contribution fresh snow and winter accumulated snowpacks were selected as two separate components fresh snow is isotopically depleted in heavier isotopes while as snowpacks are affected by post depositional processes which could cause large isotope fractionation earlier studies have reported that the δ18o values in snowpacks could be 3 to 5 heavier than the fresh snow due to preferential melting of lighter isotopes that cause large uncertainties in the hydrograph separation taylor et al 2002 he et al 2006 schmieder et al 2018 zuecco et al 2019 the isotopic composition of these end members components differ significantly from each other 2 though the isotopic tracers of the contributing sources end members vary in space and time these variations are attenuated due to mixing which result in reasonably homogenized average catchment scale values over certain time maurya et al 2011 also the observed variation in the source waters clearly reflects the temporal variation in relative contributions of the hydrological components to the river water various studies on three component hydrograph separations have been reported based on geochemical and isotopic approach with two tracers saleem and jeelani 2017 engel et al 2016 hugenschmidt et al 2014 jeelani et al 2013 uhlenbrook and hoeg 2003 the δ18o along with electrical conductivity ec chloride cl and silica sio2 are most commonly used tracers for three component hydrograph separation klauss and mcdonnell 2013 however these tracers have limitations as they may get altered due to process of water rock interaction in glacier fed river catchments singh et al 2019 to overcome this problem several studies have been carried out where δ18o and d excess have been successfully used to estimate the contribution of various hydrological components gibson et al 2000 throckmorton et al 2016 singh et al 2019 following the mass balance equation singh et al 2019 the three component hydrograph separation can be written as follows 2 q s t q r w q s m q g w where qrw qsm and qgw are the contribution of rain water snowmelt snowpack and groundwater to the river discharge qst 3 1 f r w f s m f g w where frw fsm and fgw are the fractions of rain water snowmelt snowpack and groundwater to the total river discharge 4 δ s t δ r w δ f r w δ s m δ f s m δ g w f g w where δ st δ rw δ sm and δ gw are δ18o tracer for the stream water rain water snowmelt and groundwater respectively 5 d s t d r w d f r w d s m d f s m d g w f g w dst drw dsm and dgw are d excess tracer for the stream water rain water snowmelt and groundwater respectively 6 q r w d s t d g w δ s m δ g w d s m d g w δ s t δ g w d r w d g w δ s m δ g w d s m d g w δ r w δ g w 100 7 q s m d s t d g w d s m d g w 100 d r w d g w d s m d g w q r w 8 q g w 100 q r w q s m the rain water snowmelt and groundwater contributions to the total river discharge were calculated using eqs 6 8 respectively 3 3 uncertainty analysis the uncertainty analysis was performed using classical gaussian error propagation technique based on first order taylor series expansion genereux 1998 uhlenbrook and hoeg 2003 liu et al 2004 the uncertainty of the tracer based hydrograph separation includes the uncertainties of the endmembers and the laboratory analysis the uncertainty in the estimated contributions of different runoff components may be caused by the laboratory analytical error due to measurement errors in end member concentrations similarly the spatio temporal variations in the tracer components result in significant uncertainty in hydrograph separations genereux 1998 pu et al 2013 the standard deviations of the tracer components were multiplied by t values calculated from student s t distribution at 90 confidence level the analytical uncertainty for δ18o and δ2h measurements was 0 1 and 1 respectively though the analytical uncertainty for d excess is estimated from both the 18o and 2h measurements but it is strongly dependent on the uncertainty in δ2h 1 the uncertainty analysis for three component hydrograph separations was calculated by following equations genereux 1998 9 w f x w o w d 10 w o f x o 1 w o 1 2 f x o 2 w o 2 2 f x o 3 w o 3 2 11 w d f x d 1 w d 1 2 f x d 2 w d 2 2 f x d 3 w d 3 2 where o is δ18o d is d excess 1 is rain water 2 is snowmelt 3 is groundwater and w is the uncertainty in the variable specified by the subscript respectively fx is the contribution of a specific streamflow component x to the river discharge 3 4 identification of end members the end member mixing analysis emma used to identify the potential end members to streamflow was performed using δ18o and d excess value of rainfall snow and snowpacks and groundwater table 1 the δ18o values plotted against the d excess for all stream water samples fell within the triangular domain defined by the average δ18o and d excess singh et al 2019 of rainfall snow snowpacks and groundwater fig 3 the rainwater samples were amount weighted while the snowpack and groundwater samples were not this could affect the mass balance computations but we assume that this would not change the general evidence provided by fig 3 in winter fresh snow was chosen as a separate end member when the melt from snowpacks was insignificant in both the catchments however snowpack end member was selected on seasonal basis spring to autumn from lower to higher altitudes as the progressive rise in temperature shift the snowpacks towards the higher altitudes with advancing seasons 4 results and discussion 4 1 tracer concentration in source waters the different source waters sampled in the sindh and rambiara catchments showed a marked variability in tracer concentration fig 4 for all data the δ18o values ranged between 17 2 and 3 2 and d excess between 6 9 and 25 8 the highly variable rain and fresh snow samples exhibited the most positive and the most negative isotopic composition respectively the isotopic values of snowpack fall close to the fresh snow samples with slightly enriched isotopic signature stream water and groundwater from both the catchments showed a narrow isotopic range that evolved from other source waters on the other hand the d excess of rain has maximum variability being lower than the d excess of other water types higher d excess values were observed in snow and snowpacks the d excess of groundwater falls between rain and snow snowpack the variability in d excess of these source waters is due to the interplay of different processes like different sources and their mixing precipitation form snow accumulation and seasonal change in meteorological factors temperature rh and wind speed lower δ18o and d excess is usually associated with the precipitation brought by indian summer monsoon ism originating from arabian sea and bay of bengal indian ocean during summer however lower δ18o and higher d excess in precipitation mostly snow and rain is brought by western disturbances originated from mediterranean sea and travel long distances over continents gat and carmi 1970 jeelani et al 2018 the lower and narrow range of d excess was observed in stream water which clearly reflects the contribution of different source waters with changing seasons the results from the mixing plot clearly reflects the importance of snowpacks rain and groundwater as potential source waters due to less variability in their measurements defined by the short horizontal and vertical error bars in the runoff regimes of the sindh and rambiara river in sindh catchment the tracer signature of stream water was defined by the lower δ18o of snowpack snow in winter only to the bottom the higher δ18o of rain water to the left and the lower δ18o of groundwater to the right of the mixing plot fig 3 on the other hand the d excess showed lower value in rain higher value in groundwater and an intermediate value in snowpack however the tracer signature of stream water in rambiara catchment was defined by the lower δ18o of snowpack to the right the higher δ18o of rain to the top left and the lower δ18o of groundwater to the bottom of the mixing plot fig 3 the d excess signature is defined by lower value of rain higher value of snowpack and intermediate value of groundwater 4 2 stable water isotopes in precipitation during the monitoring period the stable isotopes in precipitation rain varied between 3 2 and 16 9 standard deviation sd 3 1 for δ18o and 6 9 to 25 8 sd 4 0 for d excess with an average of 6 7 and 17 2 respectively table 2 in sindh catchment the measured δ18o and d excess values of precipitation from three sampling stations rayil cherwan and sumbal ranged between 15 0 and 3 2 for δ18o with an annual amount weighted precipitation value of awap 6 32 and 6 9 and 25 8 awap 17 2 for d excess likewise in rambiara catchment the isotopic composition of precipitation from three sampling stations hirpur kanipora and wachi ranged between 16 9 and 1 4 for δ18o awap 6 9 and between 8 and 25 4 awap 17 2 for d excess the δ18o showed a marked spatio temporal variation in precipitation in both the catchments from all the six stations the lower isotopic values were observed at higher altitudes and higher values at lower altitudes which are consistent with the so called altitude effect jeelani et al 2010 clark and fritz 1997 ingraham and taylor 1991 from the regression equations a significant correlation exists between the annual amount weighted δ18o values of precipitation and the altitude of the stations with r2 0 90 p values 0 01 for sindh and r2 0 96 p value 0 01 for rambiara catchment fig 5 the altitudinal gradient of 0 32 and 0 37 for δ18o per 100 m increase in elevation was observed in sindh and rambiara catchments respectively these results fall within the limits of earlier reported studies based on catchment scales in the himalayas yao et al 2009 jeelani et al 2017a and across the globe clark and fritz 1997 dansgaard 1964 the isotopic values δ18o and d excess of each precipitation event showed higher degrees of fluctuation throughout the observation period fig 6 a pronounced sinuosity was observed in the isotope data which represent different seasons the lower isotopic values were observed from september to march whereas the higher values were observed from april to august in sindh catchment the lower δ18o values from september to march varied between 14 6 and 2 3 with a mean of 7 7 and the d excess between 12 4 to 25 8 with a mean of 19 3 fig 6a the higher δ18o values from april to august varied between 15 0 and 3 2 with a mean of 4 7 and the d excess between 6 9 and 22 2 with a mean of 14 9 similarly in rambiara catchment fig 6b the lower δ18o values from september to march varied between 16 9 and 3 4 with a mean of 7 6 and the d excess between 8 0 to 25 4 with a mean of 18 7 the higher δ18o values from april to august varied between 16 6 and 1 4 with a mean of 6 1 and the d excess between 9 6 and 24 9 with a mean of 15 5 in january lowest isotopic values δ18o 13 7 to 4 5 for sindh and 10 0 to 3 7 for rambiara and high d excess 15 to 25 8 for sindh and 17 to 22 7 for rambiara were observed in precipitation whereas higher isotopic values were observed in june δ18o 3 4 to 3 2 for sindh and 7 2 to 1 4 for rambiara with lower d excess 6 9 to 16 for sindh and 9 6 to 18 4 for rambiara the lower and higher isotopic values of precipitation events are attributed to seasonal change in the meteorological parameters and the moisture sources as evident from fig 6 the progressive increase in δ18o from january to june and decline in δ18o from july to december is consistent with the progressive rise in temperature from january to june and decrease in temperature from october to december the higher δ18o values observed in precipitation events of may and june suggest the secondary evaporation of the events with lesser precipitation amount however from july to september irrespective of the higher temperatures and rh 80 the decreasing trend in precipitation δ18o values reflects the change in the moisture source during this period precipitation is brought by ism on the other hand the increase in d excess from october to april with increasing temperatures fig 6 indicates an equilibrium state between temperature influencing isotopic enrichment via evaporation and moisture recycling froehlich et al 2008 pang et al 2011 the higher d excess 20 usually is due to evaporation under non equilibrium conditions over the mediterranean sea and neighbouring areas and the influence of continental effect from source to the site gat and carmi 1970 jeelani et al 2018 previous studies have revealed that the high d excess is associated with the precipitation brought by western disturbances wd to the western himalayas during october to may jeelani et al 2017 2018 lone et al 2019 the decrease in d excess from may to september suggests the seasonal meteorological change and moisture source interestingly some of the events in july showed higher d excess 12 which may be attributed to the mixing of different moisture sources as both the wd known to be active throughout the year being more intensive during winters and the ism active during june to september only are active jeelani et al 2018 the lower d excess 10 4 to 14 of precipitation events was observed during the month of august the precipitation events with lower d excess 10 indicate the moisture source from ism gat and carmi 1970 gat et al 1996 tian et al 2005 hren et al 2009 kumar et al 2010 jeelani et al 2010 2017 2018 4 3 stable water isotopes in snow and snowpacks fresh snow samples from three stations in each catchment during december to february winter and snowpack samples from winter accumulated snow were collected along various transects during this study fig 1 both snow and snowpacks covered a broad isotopic range between 7 2 and 13 5 sd 1 64 for δ18o and 15 6 and 25 6 sd 2 45 for d excess with an average of 9 7 and 20 4 respectively table 2 in sindh catchment the measured isotopic values ranged between 7 7 and 13 5 with an average value of 10 3 sd 1 5 for δ18o and between 15 6 to 24 with an average value of 20 sd 1 9 for d excess likewise in rambiara catchment the isotopic composition of snow and snowpacks ranged between 7 2 and 11 8 with an average value of 8 4 sd 1 for δ18o and 18 1 and 25 6 for d excess with an average value of 22 2 sd 1 9 like precipitation the snowpacks also showed a good correlation r2 0 76 p value 0 05 for sindh and r2 0 67 p value 0 05 for rambiara with altitude fig 7 the vertical isotopic gradients of 0 23 and 0 16 for δ18o per 100 m rise in elevation were observed in snow and snowpacks of sindh and rambiara catchments respectively the snow and snowpacks from high altitude peaks above 3700 m amsl adds mass to the glacier and doesn t contribute to the streamflow as the annual average temperature in these high altitude regions is sub zero besides these could diminish the lapse rate due to post depositional processes taking place over space and time the observed isotopic altitude gradient of meltwaters from snow and snowpacks was higher than that of stream water and lower than that of precipitation rainfall in sindh and the rambiara basin respectively the broad isotopic range of fresh snow samples in winter result due to wide variability in temperature however wide variability in isotopic composition of snowpack samples suggest their sampling from different elevations and at the same time the progressive seasonal isotopic enrichment that snowpacks underwent during the melting processes taylor et al 2001 lee et al 2010a the temperature isotherms distinguish the seasonal distribution of temperature in both the river catchments fig 8 the spatial variation in temperature indicates how the snowpack influence varies over progressive seasons representative months chosen for each season as the temperature increases from march spring the melting of snowpacks takes place at lower altitudes which consequently results in higher isotopic values however with the progressive melting in summer and autumn july to september the snowpacks shift towards high altitudes the meltwater released from these high altitude snowpacks result in lower isotopic values this is attributed to lower temperatures which results in increased fractionation in addition the summer precipitation brought by indian summer monsoons have presumably lower isotopic values which admixes with the snowpacks and result in lower isotopic values from november to early march winter and early spring the higher isotopic values were observed which could be attributed to the fresh snowfall subjected to evaporative enrichment through the winter 4 4 stable water isotopes in groundwater the isotopic values of groundwater varied between 4 8 and 9 8 sd 0 9 for δ18o and 12 4 and 25 4 sd 8 15 for d excess with an average of 7 7 and 19 6 respectively table 2 in sindh catchment the measured δ18o and d excess values in groundwater ranged between 4 8 and 9 8 with an average value of 7 7 sd 0 9 for δ18o and 12 4 to 25 3 with an average value of 19 6 sd 3 1 for d excess likewise in rambiara catchment the groundwater isotopic composition ranged between 6 1 and 9 5 with an average value of 7 7 sd 0 8 for δ18o and 14 8 and 25 4 for d excess with an average value of 19 9 sd 7 5 the isotopic composition of groundwater obtained from shallow observation wells vary in space and time the lower isotopic values at the upstream suggest the contribution from high altitude precipitation while as higher values towards downstream area are suggestive of the mixing of river components rain melt from snow snowpack and groundwater respectively the groundwater samples fall between precipitation rain and snow and river water indicating that these are the major sources of groundwater recharge in the basin the isotopic composition of groundwater was found to be variable throughout the year fig 9 in sindh catchment higher isotopic values were observed in summer may june except august while lower during the rest of year except december in contrast lower isotopic values were observed in rambiara throughout the year except june and december the higher isotopic values in may june and even in december are attributed to mixing of meltwaters derived from low altitude snow and snowpacks and precipitation with higher isotopic composition the narrower range or lower values in august suggests the recharge from meltwaters from snow and snowpacks higher river discharge at higher altitudes besides lower isotopic values in groundwater during these months also reflect the recharge from monsoonal precipitation the mixing of source waters from different altitudes and routing through different flow paths often results in high variability as in case of september this is because the meltwaters from snowpacks that are at the verge of extinction result in higher isotopic values while monsoonal precipitation result in lower isotopic values however in winter with sub zero temperatures insignificant snow or glacier melting minimum river discharge indicates the maximum contribution of water from the aquifer system of the basin with uniform isotopic values fig 3 and hence a true representative of baseflow 4 5 stable water isotopes in stream water the isotopic values of stream water varied between 4 6 and 11 6 sd 1 00 for δ18o and 14 7 to 22 4 sd 1 5 for d excess with an average of 7 9 and 18 6 respectively table 2 in sindh catchment the measured δ18o and d excess values in stream water ranged between 4 6 and 11 6 with an average value of 8 54 sd 1 0 for δ18o and 22 4 to 14 7 with an average value of 18 4 sd 1 8 for d excess similarly in rambiara catchment the stream water isotopic composition ranged between 4 9 and 9 2 with an average value of 7 3 sd 0 6 for δ18o and 22 and 16 8 for d excess with an average value of 18 8 sd 1 3 in both the catchments the isotopic composition of stream water showed a narrower range compared to rainfall snow and snowpacks indicating the waters originating from headstreams mixed to give composite stream water the relatively depleted isotopic values of sindh river compared to rambiara river refers to the low evaporation rate and rapid discharge particularly in headstream areas the rapid discharge results in less transient time of water induced by the steep gradient and hence least effect of evaporation fractionation on stable water isotopes moreover the differential aspect of snow and snowpacks to the solar radiation further confirms the less evaporation and thus depleted isotopic values in sindh catchment obvious spatio temporal variations were observed in both the catchments the stable isotopes of river water are also affected by the elevation of the basins lower isotopic values were observed towards the head streams while as higher values at lower altitudes fig 5 the lower values may be due to the influence of high altitude precipitation whereas higher values suggest the mixing of waters from different flow paths and altitudes in downstream catchment in addition the decrease in elevation and latitude enhance the degree of evaporation of water along the river course which also results in downstream isotopic enrichment li and garzione 2017 the vertical isotopic gradients of 0 15 and 0 11 for δ18o per 100 m increase in elevation r2 0 93 p value 0 05 for sindh and r2 0 88 p value 0 05 for rambiara were observed in stream water of sindh and rambiara catchments respectively the observed isotopic gradients fig 5 were similar to that reported from kumaun lesser himalaya 0 15 100 m bartarya et al 1995 and western himalayas 0 133 100 m biggs et al 2015 but lower than the headwaters of river ganga 0 19 100 m ramesh and sarin 1992 and that observed by pande et al 2000 0 19 100 m the samples of stream water from garzione et al 2000 which include samples from central eastern himalayas tibetan plateau and nepalese himalaya result in higher isotopic gradient 0 29 100 m our results are in good agreement with the studies reported by bartarya et al 1995 and biggs et al 2015 suggesting the regional variation in isotopic composition is controlled by vapour source and meteorology of the region in sindh catchment the stream water isotopes were lower throughout the year avg δ18o 7 except july fig 10 the lower isotopic values correspond to the discharge from melting of the snow and winter accumulated snowpacks at higher altitudes besides the seasonal precipitation contributes significantly governing the temporal variability of the isotopic composition of stream water in july the increase in δ18o of stream water may be due to the mixing of meltwaters derived from snowpacks and precipitation with higher isotopic values the relatively lower δ18o values in august suggest the mixing of meltwaters and the maximum influence of summer rainfall with lower isotopic composition to the stream water in rambiara catchment similar isotopic trend was observed during october to may while as higher values were found during summer fig 10 lower values result due the mixing of meltwaters from winter accumulated snow at higher altitudes and precipitation with lower isotopic composition however higher temperature in summer results in progressive evaporative enrichment of snowpacks with advancing season thereby higher isotopic values also the rambiara catchment is devoid of any glacier mass the rain signature becomes more pronounced when the snowpacks are about to disappear moreover the lower gradient of rambiara compared to sindh river results in high evaporation and lower discharge and thus higher isotopic composition in autumn the change in the water source from snowpacks to rain groundwater with lower discharge results in higher isotopic values of river water 4 6 sources of stream water and their uncertainties the estimated monthly contribution of stream water components and associated uncertainties values suggested that the groundwater and snowmelt were the dominant stream water components in the sindh and rambiara river basins fig 11 the monthly contribution of groundwater varied between 12 0 5 and 78 5 0 and that of the snowpacks between 11 1 6 and 55 4 6 in both the river basins in sindh basin the snowpacks and groundwater offer maximum contribution to stream water where the contribution of the snowpacks varied between 22 0 2 and 55 4 6 with an annual average value of 40 4 6 and the groundwater between 12 0 5 and 65 7 4 with an annual average value of 34 3 6 respectively however in rambiara basin the groundwater 15 4 6 78 5 0 with an average annual value of 39 4 2 followed by the snowpacks 11 1 6 51 6 2 with an annual average value of 35 4 0 were the dominant contributors to the stream water the dominant contributions from snowmelt to streamflow are common in high elevation catchments of western himalayas monthly contributions between 11 and 55 in both the river catchments are comparable to the results of studies conducted in other himalayan catchments jeelani et al 2012 2016 and 2017 the hydrograph separation was dominated by snowmelt followed by groundwater to streamflow contributions bookhagen and burbank 2010 reported that on an annual timescale snowmelt contributes 15 to 60 of discharge in the western himalayan rivers whereas the central and eastern himalaya receive more than 80 of their discharge from rainfall importantly for all himalayan rivers draining into the arabian sea the snowmelt contribution is significant due to their high winter snow cover area in spring march to may the contribution of the end members was governed by the mixture of snowpacks 44 3 and rainfall 42 4 to the sindh river runoff and 38 3 and 40 5 to the rambiara river runoff respectively the groundwater contribution was found to be minimum from march to may in both the catchments the increase in temperature 4 18 c from early spring results in melting of snow from lower altitudes 2500 m amsl resulting in the increase of meltwater contribution from snow and snowpacks with the progressive seasons moreover precipitation mostly in the form of rains in march april was observed to be higher which further corroborates with our findings during summer june to august the snowpack 52 3 and the groundwater 26 2 contribution in sindh increased by 8 and 12 while in rambiara snowpack 51 4 contribution increased by 13 and the groundwater 23 3 increased by 1 respectively however the contribution of rainfall 22 3 in sindh and 26 3 in rambiara decreased by 20 in sindh and 14 in rambiara respectively this is because the maximum temperatures 18 23 c particularly in summer and early autumn september promote higher degrees of melting of winter accumulated snow and result in higher discharge being a dominant contributor the meltwater from winter accumulated snow not only flows in streams but also recharges the groundwater from the beginning of the melting season however due to shallower nature these aquifers are not only quickly recharged but starts contributing significantly to stream flow with the advancement in melting season the contribution from snow and snowpacks 40 3 in both sindh and rambiara started to decrease in autumn september to november whereas the groundwater contribution increases with advancing season 35 5 in sindh and 34 6 in rambiara the decrease 10 12 in snow and snowpack meltwater is due to the fact that most of the snowpacks at higher altitudes have been lost and some are at the verge of extinction due to prolonged melting through summers in winter maximum groundwater contribution of 62 6 was observed in sindh and 71 7 in rambiara river runoff the decrease in contribution of other components snowmelt and rain in winter corresponds to the decrease in ambient temperatures and change in precipitation form rain to snow overall temperature altitude and the precipitation form were the dominant factors that regulate the contribution of different components to the stream water runoff the contribution from glacier melt end member was not considered in the analysis this could affect mass balance computations but it is reasonable to assume that this would not change the general runoff regime the glaciers in the temperate climate such as kashmir valley are covered by seasonal snow cover even during the peak melting season a potential contribution from glacier melt was assumed to be insignificant a study carried out in glacier fed catchment by jeelani et al 2016 have reported that the annual contribution of glacier melt to streamflow was only 5 the study also demonstrates that the glacier melt contribution could vary depending upon the persistence of snowpacks in the catchment therefore with no data option from glacier melt and the presence of snow at altitudes above 4000 m asl having similar isotopic composition to that of glaciers the contribution from glacier melt was neglected the uncertainty defined in eq 9 was applied to three component hydrograph estimates which involve two tracers δ18o and d excess as for the separation in this study spatio temporal variations were observed in all water types which led to uncertainties in the estimated hydrograph components however the uncertainty from the laboratory analytical error calculated from the measurement method were less compared to the spatio temporal variations in tracer concentrations the calculated uncertainties ranged from 0 2 to 7 9 for sindh catchment and 0 7 to 7 0 for rambiara catchment the uncertainty for snow and snowpacks was highest than those of other components this is attributed to the altitude seasonal variability of air temperature and post depositional processes that enhance the spatial and temporal variability of isotopic composition of snowpacks dahlke and lyon 2013 dietermann and weiler 2013 schmieder et al 2016 zuecco et al 2019 4 7 significance of cryosphere in riverine ecosystem globally various studies about the high spatial variability in the isotopic composition of snowpacks have been related to the topography carey and quinton 2004 dahlke and lyon 2013 dietermann and weiler 2013 schmieder et al 2016 elevation beaulieu et al 2012 and ohlanders et al 2013 canopy allen et al 2016 snow sublimation earman et al 2006 n da et al 2016 snow metamorphism and snow redistribution friedman et al 1991 taylor et al 2001 mott et al 2010 etc in alpine catchments like the sindh and rambiara with high relief the meltwater released from the snowpack cover a wide isotopic range which depend not only on the altitude but also the melting stage of the snowpack jeelani et al 2018 besides altitude and seasonal effects several other factors such as micro and macro topography redistribution through wind drift canopy land surface slope and aspect can significantly impact the spatial and temporal variability of isotopic composition of snowpack gustafson and others 2010 lee 2014 pu et al 2020 prior to melting two physical processes such as wind scour and sublimation tend to modify the isotopic composition of top layer of the snowpack and thereby decrease the vertical isotopic gradient naftz et al 2004 helsen et al 2005 the process of sublimation plays a major role in snow ablation which is influenced by the sun s exposure and winds in general sublimation is most effective in arid climates stronger winds whereas wind scour is prominent in small basins microscale catchment with high relief stichler and schotterer 2000 in the present study the humid and temperate climate of the region and large area of the catchments makes these processes less effective however the higher vertical isotopic gradient observed in the snowpacks suggests the effect of post depositional processes in the snowpack modification evolution over changing seasons the snow and or snowpacks start melting in early spring when the average temperatures rise melting occurs primarily on sun exposed slopes as these receive largest influx of solar radiation the resultant melt percolates through the snowpack so called pervasive flow and flows at the ground surface snowpack interface resulting in a progressive contribution of isotopically enriched isotopes this change is caused by the isotopic mass exchange between snow grains and liquid water and or water vapour in pore spaces and the exchange with the atmosphere lee et al 2010a johnsen et al 2000 neumann and wadington 2004 in addition the isotopic change depends on the contact time between snow and liquid water and or water vapour primarily defined by the melting rate of the snowpack via sun s exposure and also to the isotopic layering of the snowpack pang et al 2006 taylor et al 2001 during this exchange the isotopically lighter vapours or melt are lost to the atmosphere and drained out after reaching the retention capacity eventually leaving behind the heavier isotopes in the residual snowpack ekaykin et al 2009 o neil 1968 stichler 1987 rhode 1998 as these processes are directly dependent on the altitude of snowpacks the contact time between various phases of water is longer at lower altitudes than at higher altitudes the lower altitude snowpacks are more exposed to warm ambient temperatures which result in enriched heavier isotopes than at higher altitudes and therefore the higher isotopic altitude gradient in snowpacks in mountainous catchments such as sindh and rambiara the snow and snowpacks are the important resources of water to downstream catchments these resources are of high economic and social value as they govern the spatial and temporal runoff dynamics within the river flow besides these resources are useful in maintaining ecological and environmental sustainability in the region the meltwater derived from such resources are important in domestic agricultural and hydropower generation in particular these play a major role in agriculture horticulture as majority of the downstream population deals with the agriculture horticulture moreover meltwater plays a critical role in the aquatic ecology of the catchment by regulating the summer stream temperatures by maintaining the high quality habitat of the aquatic life however in the face of recent climate change the snow cover and glaciers are vulnerable which could lead to the shrinkage of these resources towards higher altitudes and would cause a systematic reduction in water supply security the glaciers and snowpacks in the kashmir region are retreating at an accelerated pace in response to climate change kääb et al 2012 the shrinking of the himalayan cryosphere has been linked to decrease in contribution to streamflow and could affect the water availability in the downstream catchments immerzeel et al 2012 studies have reported an increasing trend in temperature and precipitation from the long term data 1901 2010 over the 20th century jeelani et al 2012 the increasing trend in temperature during winter not only lessens the solid precipitation snow but also results in reducing snow cover and subsequently less snowmelt contribution to streamflow the climate change scenario significantly affects the water cycle and the availability of the seasonal source waters to the stream flow in the region the increase in temperature during spring results in higher snowmelt contribution higher discharge with profound impact on snowpack health and less runoff with progressive seasons the consequences of this change are that flood risks are likely to increase during high spring runoff while decrease in availability of water for agriculture horticulture during summer all these changes have the potential to affect the economy and food security of the region dependent on these resources therefore understating the hydrological functioning within the mountainous catchments is necessary for their sustainability 5 conclusion in this study marked spatial and temporal variation was observed in different source waters of sindh and rambiara river catchments rain and fresh snow samples evolve as two end members with the former exhibiting the most positive enriched and later the most negative depleted δ18o values it was observed from the results that the stream and groundwater showed a narrow range falling between rain and snow stable water isotopic composition the wide variability in the isotopic composition of source waters appeared due to change in the meteorological parameters differential melting of snowpacks and moisture source regions moreover the lower isotopic values at higher altitudes and higher values at lower altitudes are consistent with the altitude effect the altitudinal gradients of 0 32 0 23 and 0 15 for δ18o per 100 m increase in elevation were observed in the rain snow and snowpack and stream water of sindh while as 0 37 0 16 and 0 11 for rambiara catchment respectively the mixing calculation indicates that the meltwater derived from snow snowpacks and groundwater are the dominant components of streamflow in sindh river the snowmelt offer an annual average contribution of 40 4 6 followed by the groundwater 34 3 6 whereas slightly higher contribution from groundwater 39 4 2 than that of snowmelt 35 4 0 was observed in rambiara river the study suggested that the temperature altitude and the precipitation form were the regulatory factors controlling the contribution from different sources to the stream water runoff the changing climate and differential melting behaviour of snow could have serious impact on the water resources of the region which may then influence the large populations housing downstream at local and regional scale credit authorship contribution statement altaf lone conceptualization methodology data curation writing original draft ghulam jeelani conceptualization supervision writing review editing r d deshpande formal analysis supervision writing review editing virendra padhya formal analysis writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103995 appendix supplementary materials image application 1 
