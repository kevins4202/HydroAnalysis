index,text
23840,the coupling between surface waves and the motion in a flexible porous surface layer is investigated theoretically we apply a lagrangian formulation for the viscous fluid and the fluid saturated porous medium in the floating porous layer which we assume to be much thinner than the wavelength we apply a macroscopic version of darcy s law the interface between the porous layer and the underlying fluid is permeable and the wave induced vertical motion at the interface leads to wave damping in addition the viscous shear stress at the interface also dampens the waves we here investigate the relative strength of the two mechanisms furthermore we calculate the lagrangian mean drift in the porous surface layer the present study may provide a physical model for wave damping in the presence of unconsolidated rubble ice and the slow particle drift in rubble ice layers keywords damped surface gravity waves porous floating surface layer rubble ice wave induced lagrangian mean drift 1 introduction in a pioneering paper reid and kajiura 1957 the linear interaction between surface wave motion in a fluid layer of finite depth and the motion in an underlying saturated porous medium of infinite depth is investigated the fluid is inviscid and the flow in the porous medium is governed by darcy s law it is found that the vertical flow at the boundary between the porous bed and the overlying fluid causes the waves to become spatially attenuated later works webber and huppert 2020 2021 weber and ghaffari 2021 have studied the associated nonlinear mean drift in a porous seabed of finite thickness when the ocean wave motion is irrotational the present investigation takes this problem further by considering the coupling between deep water gravity waves and a thin floating flexible porous layer again as in the bottom layer case there will be a wave induced vertical motion at the boundary between the porous layer and the fluid leading to wave damping here we assume that the ocean is viscous and the viscous shear stress at the interface beavers and joseph 1967 jones 1973 leads to an additional damping of the wave motion in this paper we investigate the relative strength of the two mechanisms furthermore we calculate the lagrangian mean drift in the porous surface layer since the thickness of the viscous boundary layer in the fluid is very much smaller than the wave amplitude one should apply a curvilinear type of coordinate system to describe the motion for small but finite wave amplitudes in the present paper this is achieved by describing the fluid motion in lagrangian particle following coordinates since the pressure gradient becomes nonlinear in this description the procedure has the additional advantage that the wave drift terms now appears directly in the darcy equation for the porous flexible layer the rest of this article is organized as follows in section 2 we describe the mathematical formulation and in section 3 we present results from a linear analysis in section 4 we discuss the possible application of our theory to rubble ice in section 5 we derive the lagrangian mean drift in the porous layer while section 6 contains a discussion and some concluding remarks 2 mathematical formulation we study surface gravity waves in an ocean of unlimited depth the effect of the earth s rotation is neglected and the motion is two dimensional at the surface we have a floating fluid saturated thin flexible porous layer of initial thickness h 1 we take that the x axis is horizontal and situated at the undisturbed interface between the porous layer and the infinitely deep fluid while the z axis is vertical and directed upwards the fluid is incompressible with constant density ρ in the porous medium and in the fluid below upper and lower layer variables are denoted by subscripts 1 and 2 respectively the material upper surface is found at z 1 h 1 η 1 and the position of the water surface the interface is z 2 η 2 see fig 1 the lower boundary is situated very far from the surface here mathematically z 2 the infinitely deep ocean is taken to be a newtonian viscous fluid which makes the wave motion rotational in the porous medium the motion is dominated by friction we here consider a porous medium where the pore dimension is not necessarily microscopic such larger scales may for example be found in floating vegetation mats with a fibrous structure or in rubble ice as indicated in fig 1 in the present study we apply a rather simple model for the flow in the porous medium assuming that the reynolds averaged navier stokes rans equations are valid in the voids by averaging the rans equations over a representative elementary volume of the porous medium domain a macroscale equation for the momentum balance is obtained with an effective permeability k and an eddy viscosity ν 1 see e g masuoka and takatsu 1996 to the lowest order approximation darcy s law bear 1972 then applies to the motion in the macroscopic porous medium as explained in the introduction we apply lagrangian coordinates for the mathematical analysis let a fluid particle a c initially have coordinates x 0 z 0 its position x z at later times will then be a function of a c and time t velocity components and accelerations are given by x t z t and x t t z t t respectively where subscripts denote partial differentiation and the pressure is p the transformation of x z from independent variables in the eulerian description to dependent lagrangian variables x a c t z a c t is trivial see lamb 1932 we consider a thin flexible porous layer and assume that the balance of forces in the vertical direction is hydrostatic furthermore we take that the pressure is constant along the upper surface then we have for the pressure distribution in the porous layer 1 p 1 ρ g z 1 h 1 η 1 where g is the acceleration due to gravity and an insignificant constant has been put equal to zero in lagrangian coordinates darcy s law can be written weber and ghaffari 2021 2 ν 1 k x 1 t x 1 a g η 1 a here k is the permeability in the horizontal direction and ν 1 is the kinematic viscosity of the fluid in the voids we note from 2 that x 1 is only a function of a and t the momentum balance in the fluid can be written in lagrangian notation from lamb 1932 by adding the viscous terms 3 x 2 t t x 2 a z 2 t t z 2 a g z 2 a p 2 a ρ ν 2 x 2 a 2 x 2 t z 2 a 2 z 2 t 4 x 2 t t x 2 c z 2 t t z 2 c g z 2 c p 2 c ρ ν 2 x 2 c 2 x 2 t z 2 c 2 z 2 t where ν 2 is the constant eddy viscosity in the fluid the laplacian operator 2 is non linear in the lagrangian formulation see for example pierson 1962 for the explicit form finally since the density is constant and the same in each layer the conservation of mass now volume can be written in both layers as 5 j x z j x 0 z 0 here j f g f a g c f c g a is the two dimensional jacobian even though a c is not the initial particle position it is convenient to write the displacements and pressure as pierson 1962 6 x 1 a x 1 a t z 1 c z 1 a c t p 1 ρ g c h 1 p 1 a c t 0 c h 1 7 x 2 a x 2 a c t z 2 c z 2 a c t p 2 ρ g c h 1 p 2 a c t c 0 the deviations x 1 2 z 1 2 p 1 2 in 6 7 can be expanded in series after a small parameter ɛ proportional to the wave amplitude see e g weber 2019 accordingly 2 5 can be written 8 ν 1 k x 1 t 1 x 1 a p 1 ρ g z 1 a g η 1 a 9 x 2 t t 1 x 2 a z 2 t t z 2 a p 2 ρ g z 2 a ν 2 1 x 2 a 2 x 2 t z 2 a 2 z 2 t 10 x 2 t t x 2 c z 2 t t 1 z 2 c p 2 ρ g z 2 c ν 2 x 2 c 2 x 2 t 1 z 2 c 2 z 2 t 11 x 1 2 t a z 1 2 t c x 1 2 a z 1 2 c t x 1 2 c z 1 2 a t 0 with this notation we have that η 1 a t z 1 a h 1 t and η 2 a t z 2 a 0 t in fig 1 3 linear analysis 3 1 porous layer we linearize our governing equations 8 11 and denote our linearized variables by a tilde in the porous layer we have 12 ν 1 k x 1 t g η 1 a we take that 13 η 1 η 0 exp i κ a n t where η 0 is the real wave amplitude and 14 κ k i α 15 n ω i β here k is the real wave number and ω the wave frequency while α and β are the spatial and temporal damping coefficients respectively we assume slow damping i e α k 1 and β ω 1 from 12 16 x 1 g κ k η 1 n ν 1 then from 11 17 z 1 t c x 1 t a g κ 2 k η 1 ν 1 at the upper boundary we have z 1 c h 1 η 1 accordingly 18 z 1 1 i g κ 2 k h 1 c n ν 1 η 1 3 2 viscous fluid in the fluid the linearized equations become 19 x 2 t t p 2 ρ g z 2 a ν 2 l 2 x 2 t 20 z 2 t t p 2 ρ g z 2 c ν 2 l 2 z 2 t where l 2 2 a 2 2 c 2 from lamb 1932 we introduce 21 x 2 t φ a ψ c 22 z 2 t φ c ψ a then 19 20 and the linearized version of 11 yield that 23 l 2 φ 0 24 ψ t ν 2 l 2 ψ 0 25 p 2 ρ φ t g z 2 assuming that φ ψ 0 when c we find 26 φ a 2 exp κ c i κ a n t 27 ψ b 2 exp m c i κ a n t where 28 m 1 i γ here the large parameter γ is given by γ ω 2 ν 2 1 2 3 3 boundary conditions with an upper porous layer we have a discontinuity in the horizontal velocities at the interface the vertical velocity however must be continuous see for example the discussion in webber and huppert 2021 hence 29 z 1 c 0 z 2 c 0 furthermore with a viscous fluid beneath the porous layer the horizontal stress in the fluid cannot vanish at the interface from beavers and joseph 1967 and jones 1973 we have that 30 x 2 t c z 2 t a a b j k 1 2 x 2 t x 1 t c 0 here a b j is the dimensionless beavers joseph parameter which depends on the pore space geometry of the porous medium experimental studies by beavers and joseph 1967 indicate that this parameter is in the range 0 1 4 0 where the largest values of a b j occur for the largest pore diameter finally the normal stresses must be continuous at the interface i e 31 p 1 p 2 2 ρ ν 2 z 2 t c c 0 here p 1 ρ g z 1 η 1 from 1 while p 2 is given by 25 utilizing 29 we find from 31 that 32 φ t 2 ν 2 z 2 t c g η 1 0 c 0 from the kinematic condition 29 we obtain 33 a 2 i b 2 i n κ 1 i κ 2 g h 1 k n ν 1 η 0 while 30 yields that 34 ω κ q 1 2 κ a 2 i ω m m q 1 b 2 g κ q 2 η 0 here we have defined the material constants q 1 and q 2 by 35 q 1 a b j k 1 2 36 q 2 a b j ω k 1 2 ν 1 while m is defined by 28 finally from 32 we find that 37 i n 2 κ 2 ν 2 a 2 2 i κ m ν 2 b 2 g η 0 in solving the system of eqs 33 34 and 37 where η 0 is given we utilize the fact that 38 k γ 1 39 k q 1 1 furthermore 40 r ω k ν 1 q 2 q 1 1 here 38 follows from the fact that the viscous boundary layer is very thin and 39 from the fact that the permeability of the porous medium is small finally r in 40 is a small fundamental parameter in the porous problem as first pointed out by reid and kajiura 1957 it is readily shown that to lowest order 33 and 34 yield the obvious result ω 2 g k utilizing this fact we obtain to next order 41 a 2 i ω β η 0 k 42 b 2 i 2 β ω α k ω k h 1 r η 0 k finally by inserting these results into 34 we find from the real part that 43 β c g α ω k q 1 2 2 γ q 2 q 1 q 2 4 γ q 1 2 2 γ 2 2 γ q 1 ω k h 1 r 2 q where c g ω 2 k is the group velocity for deep water gravity waves here 43 is just a special version of the general form relating temporal and spatial wave damping to the dissipative process in the wave motion weber 2022 specifically we note from 43 that if α 0 temporal attenuation then β q if β 0 spatial attenuation then α q c g accordingly when comparing the two different cases we have β c g α as shown by gaster 1962 we can non dimensionalize 43 by scaling the temporal wave damping by the inextensible film limit β i n e x ω k 4 γ lamb 1932 this is the case where the water particles in contact with the surface cover have zero horizontal velocity introducing β ˆ β β i n e x and α ˆ 4 γ α k 2 43 becomes 44 β ˆ 1 2 α ˆ q 1 2 2 γ q 2 q 1 q 2 q 1 2 2 γ 2 2 γ q 1 2 γ h 1 r q 1 q 2 here q 1 represents the wave damping caused by friction while q 2 models the damping caused by vertical motion at the interface between the porous layer and the fluid we shall refer to the two mechanisms as viscous and porous damping respectively as mentioned in the introduction the latter damping mechanism was first described for an infinitely deep porous seabed by reid and kajiura 1957 4 application to rubble ice rubble ice is produced when ice floes collide leading to smaller pieces of broken ice such formation also occurs when ice collides with offshore structures or when ships pass through an ice cover see the comprehensive review of field observations by strub klein and sudom 2012 the rubble layer consists of randomly orientated elongated ice blocks with water in the voids between them see the sketch in fig 1 on top there is usually a thinner layer of consolidated ice as the freezing season progresses the rubble layer may partly refreeze the dimensions of the rubble blocks are related to the thickness of the ice floes that break up i e thicker ice larger rubble as inferred from strub klein and sudom 2012 a typical block thickness d could be of the order 0 5 m with lateral dimensions 2 d 3 d the thickness of the rubble layer is several times the thickness of the consolidated ice on top from field measurements in the barents sea the permeability of rubble ice appears to be of order 1 0 8 m 2 marchenko 2022 while freitag and eicken 2003 report values up to 1 0 7 m 2 it should be mentioned that these values refer to permeability in the vertical direction in calculating the right hand side of 44 we assume that we have a moderately large eddy viscosity in the ocean beneath the ice see weber 1987 or melsom 1992 also in the rubble we take that the viscosity is somewhat larger than the molecular value furthermore we assume from beavers and joseph 1967 that a b j 4 0 in 35 36 this choice is not very sensitive and a ten times higher value does not change the results accordingly for the calculation of the right hand side of 44 we take that ν 1 5 1 0 6 m 2 s 1 ν 2 1 0 4 m 2 s 1 k 5 1 0 8 m 2 h 1 2 m and a b j 4 0 it is seen that with these values the conditions 38 40 are very well fulfilled in fig 2 we have displayed q 1 and q 2 from 44 as function of the wavelength λ 2 π k we note from the figure that porous damping red line is considerably larger than viscous damping blue line for shorter waves in this example from 30 we see that for large values of q 1 we have that x 2 t 0 when c 0 this corresponds to the inextensible layer limit lamb 1932 this is actually the case for the whole wave number range in fig 2 making q 1 1 as seen from 44 we realize from fig 2 that the porous damping mechanism very effectively filters out smaller waves from the wave spectrum as the surface wave propagate from the open sea into the ice pack we have here assume that the thin layer of consolidated is broken up on the wave scale hence we can neglect the elastic properties of the consolidated ice liu and mollo christensen 1988 melsom 1992 it should be stressed that the porous damping effect is related to the small parameter r ω k ν 1 hence a smaller value of ν 1 a molecular value or a larger permeability will enhance the numerical values of the damping rates considerably 5 the lagrangian mean drift here we consider the nonlinear problem to second order for the lagrangian mean quantities the mean is defined by averaging over the wave cycle and this process is denoted by an over bar we find to second order when averaging 8 in the porous layer 45 u 1 l x 1 t x 1 a g k ν 1 η 1 a where u 1 l x 1 t is the horizontal lagrangian mean drift in the porous medium the stokes drift stokes 1847 to second order in eulerian variables was derived by longuet higgins 1953 in lagrangian terms longuet higgins formula can be written 46 u 1 s x 1 x 1 t a z 1 x 1 t c since x 1 x 1 a t see 6 we find from 46 that in the porous layer 47 u 1 s x 1 t x 1 a x 1 x 1 t a x 1 x 1 t a since x 1 t x 1 a is very small of o α β hence we can write 45 as 48 u 1 l u 1 s u 1 e where 49 u 1 e g k ν 1 η 1 a is the eulerian mean velocity we see right away that for purely temporal decay α 0 we have that u 1 e 0 in calculating the wave damping 43 the ocean was assumed to be a viscous fluid fig 2 shows that the viscous effect alone on damping was equivalent to assuming an inextensible layer at the surface the associated lagrangian mean current in the viscous ocean in this case has been thoroughly discussed in weber 1987 the new element in this paper is porous damping which operates independently of the oceanic eddy viscosity it yields considerably larger wave damping than viscosity as seen in fig 2 we therefore focus on this effect on the drift velocity and neglect viscosity in the ocean in this last part of our study with this assumption we obtain from 9 that 50 u 2 t l x 2 t t x 2 a z 2 t t z 2 a p 2 ρ g z 2 a where u 2 l x 2 t is the horizontal lagrangian mean drift we require a steady lagrangian mean drift then the right hand side of 50 must vanish accordingly 51 p 2 ρ g z 2 a x 2 t t x 2 a z 2 t t z 2 a α ω 2 x 2 2 z 2 2 where the last result is correct to lowest order at the interface we must have continuity of pressure and the mean elevation i e p 1 c 0 p 2 c 0 and z 1 c 0 z 2 c 0 hence 52 p 1 ρ g z 1 a p 2 ρ g z 2 a c 0 inserting from 8 and 51 we find that 53 g η 1 a α ω 2 x 2 2 z 2 2 c 0 when we neglect the effect of viscosity in the fluid we have from 21 22 that x 2 t φ a and z 2 t φ c where φ is given by 26 here to lowest order from 41 a 2 i ω η 0 k inserting real values into 53 we find that 54 g η 1 a α ω 2 η 0 2 exp 2 α a β t in this case we obtain from 43 for the damping rates 55 β c g α ω k h 1 r 2 where the small parameter r is given by 40 from 49 the eulerian mean current becomes 56 u 1 e α ω r η 0 2 exp 2 α a β t likewise we find from 47 for the stokes drift 57 u 1 s 1 2 ω k r 2 η 0 2 exp 2 α a β t hence the lagrangian mean drift 48 becomes 58 u 1 l r 2 α k ω k r η 0 2 exp 2 α a β t where the second term in the parenthesis is the eulerian contribution for spatially damped waves β 0 which is the relevant case for waves propagating inwards from the ice edge we have from 55 that α k 2 h 1 r hence 58 becomes 59 u 1 l 1 2 k h 1 ω k r 2 η 0 2 exp 2 α a since we have assumed that the porous layer is thin k h 1 1 we note from the second term in 59 that the eulerian contribution to the lagrangian mean drift is small hence pure temporal wave decay and pure spatial wave decay yield in practice the same mean drift current in the porous layer being the stokes drift in the fluid we have assumed a non accelerating mean drift i e u 2 t l 0 in 50 to derive an explicit expression for the steady lagrangian mean velocity we use the fact that the vorticity is zero in the fluid in this non viscous part of the study expressing the vorticity in lagrangian terms and assuming that the vorticity vanishes identically we obtain from weber 2011 eq 21 that 60 u 2 c l 2 x x t a z x t c 2 k u 2 s hence in the infinitely deep fluid 61 u 2 l u 2 s ω k η 0 2 exp 2 k c 2 α a β t we remark that this result is also obtained if we use the stokes drift expression 46 for the ocean the difference here is that 61 yields the lagrangian mean drift so this equation tells us in addition that the eulerian mean velocity vanishes in the inviscid ocean which should not come as a surprise see longuet higgins 1953 spatial attenuation α 0 introduces a small vertical mean drift into the problem we obtain from the continuity eq 11 that z 1 t c 2 α x 1 t and z 2 t c 2 α x 2 t assuming vanishing mean vertical velocity when c we find for the fluid that 62 z 2 t α k u 2 s c 0 utilizing the continuity of mean velocities at c 0 and neglecting a very small vertical creep of o r 3 within the medium the interface and the porous layer will move upwards with a small velocity given by 63 z 1 t α k u 2 s c 0 we find that 64 z 2 t z 2 t α η 0 k h 1 r k η 0 where all of the three parts are much less than one hence the vertical mean drift has no practical consequences in this problem 6 discussion and final remarks we study the coupling between surface gravity waves and the motion in a floating flexible porous surface cover as first shown by reid and kajiura 1957 for inviscid wave motion over a porous seabed wave damping occurs due to the vertical flow at the boundary between the fluid and the porous bottom layer as we have shown here this phenomenon which we have termed porous damping also occurs when we have a floating porous layer at the sea surface thin porous floating layers at the sea surface do occur in nature the perhaps most fascinating example is the case of large mats of floating vegetation formed by sargassum seaweed in the sargasso sea see e g gower and king 2011 these mats form a fibrous water filled porous medium which constitutes an important habitat for many marine species it is sometimes referred to as the golden floating rainforest of the atlantic ocean however it is hard to find reports of physical properties such as porosity or permeability in the literature hence without such data our results will be rather speculative on the other hand with relevant data the results reported in this paper could be applied to the slow flow of water and pollution in sargassum seaweed cause by incoming surface waves we have therefore concentrated on the application to rubble ice layers which is a well documented phenomenon in cold regions this application is interesting in that porous damping acts stronger than viscous damping on shorter surface waves it increases the filtering of shorter waves from wave spectra observed from platforms on the ice however also this case is not without problems since rubble ice often occurs beneath a layer of consolidated ice the rubble is hard to observe from stations on the ice hence it is difficult to separate the damping effect described here from other damping mechanisms in the vast amount of observations of waves in the ice see for example wadhams 2000 squire 2020 and references therein in addition the thickness of the rubble layer is not constant in real world ice covers it has maximum thickness beneath ice ridges see for example strub klein and sudom 2012 on the other hand haapala 2000 reports of regions of fairly constant thickness rubble ice in the baltic sea anyway as long as the rubble layer is porous some lateral variation in thickness will not obstruct the porous wave damping mechanism described here finally we remark that the porous matrix elements in ice rubble are not rigidly connected however we assume that the individual rubble blocks are so densely packed that we can ignore their relative motion furthermore a precise description of the flow in the pores is probably not possible but certainly a kind of creeping motion will occur then the darcy formulation of the friction in the permeable medium may constitute a robust lowest order approximation see also marchenko 2022 the description of the slow lagrangian mean transport in the rubble layer in this paper is new it may have bearing to the motion of ice algae or pollution like oil or microplastics in rubble ice declaration of competing interest the author declares that he has no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments financial support from the research council of norway through the grant 280625 dynamics of floating ice is gratefully acknowledged 
23840,the coupling between surface waves and the motion in a flexible porous surface layer is investigated theoretically we apply a lagrangian formulation for the viscous fluid and the fluid saturated porous medium in the floating porous layer which we assume to be much thinner than the wavelength we apply a macroscopic version of darcy s law the interface between the porous layer and the underlying fluid is permeable and the wave induced vertical motion at the interface leads to wave damping in addition the viscous shear stress at the interface also dampens the waves we here investigate the relative strength of the two mechanisms furthermore we calculate the lagrangian mean drift in the porous surface layer the present study may provide a physical model for wave damping in the presence of unconsolidated rubble ice and the slow particle drift in rubble ice layers keywords damped surface gravity waves porous floating surface layer rubble ice wave induced lagrangian mean drift 1 introduction in a pioneering paper reid and kajiura 1957 the linear interaction between surface wave motion in a fluid layer of finite depth and the motion in an underlying saturated porous medium of infinite depth is investigated the fluid is inviscid and the flow in the porous medium is governed by darcy s law it is found that the vertical flow at the boundary between the porous bed and the overlying fluid causes the waves to become spatially attenuated later works webber and huppert 2020 2021 weber and ghaffari 2021 have studied the associated nonlinear mean drift in a porous seabed of finite thickness when the ocean wave motion is irrotational the present investigation takes this problem further by considering the coupling between deep water gravity waves and a thin floating flexible porous layer again as in the bottom layer case there will be a wave induced vertical motion at the boundary between the porous layer and the fluid leading to wave damping here we assume that the ocean is viscous and the viscous shear stress at the interface beavers and joseph 1967 jones 1973 leads to an additional damping of the wave motion in this paper we investigate the relative strength of the two mechanisms furthermore we calculate the lagrangian mean drift in the porous surface layer since the thickness of the viscous boundary layer in the fluid is very much smaller than the wave amplitude one should apply a curvilinear type of coordinate system to describe the motion for small but finite wave amplitudes in the present paper this is achieved by describing the fluid motion in lagrangian particle following coordinates since the pressure gradient becomes nonlinear in this description the procedure has the additional advantage that the wave drift terms now appears directly in the darcy equation for the porous flexible layer the rest of this article is organized as follows in section 2 we describe the mathematical formulation and in section 3 we present results from a linear analysis in section 4 we discuss the possible application of our theory to rubble ice in section 5 we derive the lagrangian mean drift in the porous layer while section 6 contains a discussion and some concluding remarks 2 mathematical formulation we study surface gravity waves in an ocean of unlimited depth the effect of the earth s rotation is neglected and the motion is two dimensional at the surface we have a floating fluid saturated thin flexible porous layer of initial thickness h 1 we take that the x axis is horizontal and situated at the undisturbed interface between the porous layer and the infinitely deep fluid while the z axis is vertical and directed upwards the fluid is incompressible with constant density ρ in the porous medium and in the fluid below upper and lower layer variables are denoted by subscripts 1 and 2 respectively the material upper surface is found at z 1 h 1 η 1 and the position of the water surface the interface is z 2 η 2 see fig 1 the lower boundary is situated very far from the surface here mathematically z 2 the infinitely deep ocean is taken to be a newtonian viscous fluid which makes the wave motion rotational in the porous medium the motion is dominated by friction we here consider a porous medium where the pore dimension is not necessarily microscopic such larger scales may for example be found in floating vegetation mats with a fibrous structure or in rubble ice as indicated in fig 1 in the present study we apply a rather simple model for the flow in the porous medium assuming that the reynolds averaged navier stokes rans equations are valid in the voids by averaging the rans equations over a representative elementary volume of the porous medium domain a macroscale equation for the momentum balance is obtained with an effective permeability k and an eddy viscosity ν 1 see e g masuoka and takatsu 1996 to the lowest order approximation darcy s law bear 1972 then applies to the motion in the macroscopic porous medium as explained in the introduction we apply lagrangian coordinates for the mathematical analysis let a fluid particle a c initially have coordinates x 0 z 0 its position x z at later times will then be a function of a c and time t velocity components and accelerations are given by x t z t and x t t z t t respectively where subscripts denote partial differentiation and the pressure is p the transformation of x z from independent variables in the eulerian description to dependent lagrangian variables x a c t z a c t is trivial see lamb 1932 we consider a thin flexible porous layer and assume that the balance of forces in the vertical direction is hydrostatic furthermore we take that the pressure is constant along the upper surface then we have for the pressure distribution in the porous layer 1 p 1 ρ g z 1 h 1 η 1 where g is the acceleration due to gravity and an insignificant constant has been put equal to zero in lagrangian coordinates darcy s law can be written weber and ghaffari 2021 2 ν 1 k x 1 t x 1 a g η 1 a here k is the permeability in the horizontal direction and ν 1 is the kinematic viscosity of the fluid in the voids we note from 2 that x 1 is only a function of a and t the momentum balance in the fluid can be written in lagrangian notation from lamb 1932 by adding the viscous terms 3 x 2 t t x 2 a z 2 t t z 2 a g z 2 a p 2 a ρ ν 2 x 2 a 2 x 2 t z 2 a 2 z 2 t 4 x 2 t t x 2 c z 2 t t z 2 c g z 2 c p 2 c ρ ν 2 x 2 c 2 x 2 t z 2 c 2 z 2 t where ν 2 is the constant eddy viscosity in the fluid the laplacian operator 2 is non linear in the lagrangian formulation see for example pierson 1962 for the explicit form finally since the density is constant and the same in each layer the conservation of mass now volume can be written in both layers as 5 j x z j x 0 z 0 here j f g f a g c f c g a is the two dimensional jacobian even though a c is not the initial particle position it is convenient to write the displacements and pressure as pierson 1962 6 x 1 a x 1 a t z 1 c z 1 a c t p 1 ρ g c h 1 p 1 a c t 0 c h 1 7 x 2 a x 2 a c t z 2 c z 2 a c t p 2 ρ g c h 1 p 2 a c t c 0 the deviations x 1 2 z 1 2 p 1 2 in 6 7 can be expanded in series after a small parameter ɛ proportional to the wave amplitude see e g weber 2019 accordingly 2 5 can be written 8 ν 1 k x 1 t 1 x 1 a p 1 ρ g z 1 a g η 1 a 9 x 2 t t 1 x 2 a z 2 t t z 2 a p 2 ρ g z 2 a ν 2 1 x 2 a 2 x 2 t z 2 a 2 z 2 t 10 x 2 t t x 2 c z 2 t t 1 z 2 c p 2 ρ g z 2 c ν 2 x 2 c 2 x 2 t 1 z 2 c 2 z 2 t 11 x 1 2 t a z 1 2 t c x 1 2 a z 1 2 c t x 1 2 c z 1 2 a t 0 with this notation we have that η 1 a t z 1 a h 1 t and η 2 a t z 2 a 0 t in fig 1 3 linear analysis 3 1 porous layer we linearize our governing equations 8 11 and denote our linearized variables by a tilde in the porous layer we have 12 ν 1 k x 1 t g η 1 a we take that 13 η 1 η 0 exp i κ a n t where η 0 is the real wave amplitude and 14 κ k i α 15 n ω i β here k is the real wave number and ω the wave frequency while α and β are the spatial and temporal damping coefficients respectively we assume slow damping i e α k 1 and β ω 1 from 12 16 x 1 g κ k η 1 n ν 1 then from 11 17 z 1 t c x 1 t a g κ 2 k η 1 ν 1 at the upper boundary we have z 1 c h 1 η 1 accordingly 18 z 1 1 i g κ 2 k h 1 c n ν 1 η 1 3 2 viscous fluid in the fluid the linearized equations become 19 x 2 t t p 2 ρ g z 2 a ν 2 l 2 x 2 t 20 z 2 t t p 2 ρ g z 2 c ν 2 l 2 z 2 t where l 2 2 a 2 2 c 2 from lamb 1932 we introduce 21 x 2 t φ a ψ c 22 z 2 t φ c ψ a then 19 20 and the linearized version of 11 yield that 23 l 2 φ 0 24 ψ t ν 2 l 2 ψ 0 25 p 2 ρ φ t g z 2 assuming that φ ψ 0 when c we find 26 φ a 2 exp κ c i κ a n t 27 ψ b 2 exp m c i κ a n t where 28 m 1 i γ here the large parameter γ is given by γ ω 2 ν 2 1 2 3 3 boundary conditions with an upper porous layer we have a discontinuity in the horizontal velocities at the interface the vertical velocity however must be continuous see for example the discussion in webber and huppert 2021 hence 29 z 1 c 0 z 2 c 0 furthermore with a viscous fluid beneath the porous layer the horizontal stress in the fluid cannot vanish at the interface from beavers and joseph 1967 and jones 1973 we have that 30 x 2 t c z 2 t a a b j k 1 2 x 2 t x 1 t c 0 here a b j is the dimensionless beavers joseph parameter which depends on the pore space geometry of the porous medium experimental studies by beavers and joseph 1967 indicate that this parameter is in the range 0 1 4 0 where the largest values of a b j occur for the largest pore diameter finally the normal stresses must be continuous at the interface i e 31 p 1 p 2 2 ρ ν 2 z 2 t c c 0 here p 1 ρ g z 1 η 1 from 1 while p 2 is given by 25 utilizing 29 we find from 31 that 32 φ t 2 ν 2 z 2 t c g η 1 0 c 0 from the kinematic condition 29 we obtain 33 a 2 i b 2 i n κ 1 i κ 2 g h 1 k n ν 1 η 0 while 30 yields that 34 ω κ q 1 2 κ a 2 i ω m m q 1 b 2 g κ q 2 η 0 here we have defined the material constants q 1 and q 2 by 35 q 1 a b j k 1 2 36 q 2 a b j ω k 1 2 ν 1 while m is defined by 28 finally from 32 we find that 37 i n 2 κ 2 ν 2 a 2 2 i κ m ν 2 b 2 g η 0 in solving the system of eqs 33 34 and 37 where η 0 is given we utilize the fact that 38 k γ 1 39 k q 1 1 furthermore 40 r ω k ν 1 q 2 q 1 1 here 38 follows from the fact that the viscous boundary layer is very thin and 39 from the fact that the permeability of the porous medium is small finally r in 40 is a small fundamental parameter in the porous problem as first pointed out by reid and kajiura 1957 it is readily shown that to lowest order 33 and 34 yield the obvious result ω 2 g k utilizing this fact we obtain to next order 41 a 2 i ω β η 0 k 42 b 2 i 2 β ω α k ω k h 1 r η 0 k finally by inserting these results into 34 we find from the real part that 43 β c g α ω k q 1 2 2 γ q 2 q 1 q 2 4 γ q 1 2 2 γ 2 2 γ q 1 ω k h 1 r 2 q where c g ω 2 k is the group velocity for deep water gravity waves here 43 is just a special version of the general form relating temporal and spatial wave damping to the dissipative process in the wave motion weber 2022 specifically we note from 43 that if α 0 temporal attenuation then β q if β 0 spatial attenuation then α q c g accordingly when comparing the two different cases we have β c g α as shown by gaster 1962 we can non dimensionalize 43 by scaling the temporal wave damping by the inextensible film limit β i n e x ω k 4 γ lamb 1932 this is the case where the water particles in contact with the surface cover have zero horizontal velocity introducing β ˆ β β i n e x and α ˆ 4 γ α k 2 43 becomes 44 β ˆ 1 2 α ˆ q 1 2 2 γ q 2 q 1 q 2 q 1 2 2 γ 2 2 γ q 1 2 γ h 1 r q 1 q 2 here q 1 represents the wave damping caused by friction while q 2 models the damping caused by vertical motion at the interface between the porous layer and the fluid we shall refer to the two mechanisms as viscous and porous damping respectively as mentioned in the introduction the latter damping mechanism was first described for an infinitely deep porous seabed by reid and kajiura 1957 4 application to rubble ice rubble ice is produced when ice floes collide leading to smaller pieces of broken ice such formation also occurs when ice collides with offshore structures or when ships pass through an ice cover see the comprehensive review of field observations by strub klein and sudom 2012 the rubble layer consists of randomly orientated elongated ice blocks with water in the voids between them see the sketch in fig 1 on top there is usually a thinner layer of consolidated ice as the freezing season progresses the rubble layer may partly refreeze the dimensions of the rubble blocks are related to the thickness of the ice floes that break up i e thicker ice larger rubble as inferred from strub klein and sudom 2012 a typical block thickness d could be of the order 0 5 m with lateral dimensions 2 d 3 d the thickness of the rubble layer is several times the thickness of the consolidated ice on top from field measurements in the barents sea the permeability of rubble ice appears to be of order 1 0 8 m 2 marchenko 2022 while freitag and eicken 2003 report values up to 1 0 7 m 2 it should be mentioned that these values refer to permeability in the vertical direction in calculating the right hand side of 44 we assume that we have a moderately large eddy viscosity in the ocean beneath the ice see weber 1987 or melsom 1992 also in the rubble we take that the viscosity is somewhat larger than the molecular value furthermore we assume from beavers and joseph 1967 that a b j 4 0 in 35 36 this choice is not very sensitive and a ten times higher value does not change the results accordingly for the calculation of the right hand side of 44 we take that ν 1 5 1 0 6 m 2 s 1 ν 2 1 0 4 m 2 s 1 k 5 1 0 8 m 2 h 1 2 m and a b j 4 0 it is seen that with these values the conditions 38 40 are very well fulfilled in fig 2 we have displayed q 1 and q 2 from 44 as function of the wavelength λ 2 π k we note from the figure that porous damping red line is considerably larger than viscous damping blue line for shorter waves in this example from 30 we see that for large values of q 1 we have that x 2 t 0 when c 0 this corresponds to the inextensible layer limit lamb 1932 this is actually the case for the whole wave number range in fig 2 making q 1 1 as seen from 44 we realize from fig 2 that the porous damping mechanism very effectively filters out smaller waves from the wave spectrum as the surface wave propagate from the open sea into the ice pack we have here assume that the thin layer of consolidated is broken up on the wave scale hence we can neglect the elastic properties of the consolidated ice liu and mollo christensen 1988 melsom 1992 it should be stressed that the porous damping effect is related to the small parameter r ω k ν 1 hence a smaller value of ν 1 a molecular value or a larger permeability will enhance the numerical values of the damping rates considerably 5 the lagrangian mean drift here we consider the nonlinear problem to second order for the lagrangian mean quantities the mean is defined by averaging over the wave cycle and this process is denoted by an over bar we find to second order when averaging 8 in the porous layer 45 u 1 l x 1 t x 1 a g k ν 1 η 1 a where u 1 l x 1 t is the horizontal lagrangian mean drift in the porous medium the stokes drift stokes 1847 to second order in eulerian variables was derived by longuet higgins 1953 in lagrangian terms longuet higgins formula can be written 46 u 1 s x 1 x 1 t a z 1 x 1 t c since x 1 x 1 a t see 6 we find from 46 that in the porous layer 47 u 1 s x 1 t x 1 a x 1 x 1 t a x 1 x 1 t a since x 1 t x 1 a is very small of o α β hence we can write 45 as 48 u 1 l u 1 s u 1 e where 49 u 1 e g k ν 1 η 1 a is the eulerian mean velocity we see right away that for purely temporal decay α 0 we have that u 1 e 0 in calculating the wave damping 43 the ocean was assumed to be a viscous fluid fig 2 shows that the viscous effect alone on damping was equivalent to assuming an inextensible layer at the surface the associated lagrangian mean current in the viscous ocean in this case has been thoroughly discussed in weber 1987 the new element in this paper is porous damping which operates independently of the oceanic eddy viscosity it yields considerably larger wave damping than viscosity as seen in fig 2 we therefore focus on this effect on the drift velocity and neglect viscosity in the ocean in this last part of our study with this assumption we obtain from 9 that 50 u 2 t l x 2 t t x 2 a z 2 t t z 2 a p 2 ρ g z 2 a where u 2 l x 2 t is the horizontal lagrangian mean drift we require a steady lagrangian mean drift then the right hand side of 50 must vanish accordingly 51 p 2 ρ g z 2 a x 2 t t x 2 a z 2 t t z 2 a α ω 2 x 2 2 z 2 2 where the last result is correct to lowest order at the interface we must have continuity of pressure and the mean elevation i e p 1 c 0 p 2 c 0 and z 1 c 0 z 2 c 0 hence 52 p 1 ρ g z 1 a p 2 ρ g z 2 a c 0 inserting from 8 and 51 we find that 53 g η 1 a α ω 2 x 2 2 z 2 2 c 0 when we neglect the effect of viscosity in the fluid we have from 21 22 that x 2 t φ a and z 2 t φ c where φ is given by 26 here to lowest order from 41 a 2 i ω η 0 k inserting real values into 53 we find that 54 g η 1 a α ω 2 η 0 2 exp 2 α a β t in this case we obtain from 43 for the damping rates 55 β c g α ω k h 1 r 2 where the small parameter r is given by 40 from 49 the eulerian mean current becomes 56 u 1 e α ω r η 0 2 exp 2 α a β t likewise we find from 47 for the stokes drift 57 u 1 s 1 2 ω k r 2 η 0 2 exp 2 α a β t hence the lagrangian mean drift 48 becomes 58 u 1 l r 2 α k ω k r η 0 2 exp 2 α a β t where the second term in the parenthesis is the eulerian contribution for spatially damped waves β 0 which is the relevant case for waves propagating inwards from the ice edge we have from 55 that α k 2 h 1 r hence 58 becomes 59 u 1 l 1 2 k h 1 ω k r 2 η 0 2 exp 2 α a since we have assumed that the porous layer is thin k h 1 1 we note from the second term in 59 that the eulerian contribution to the lagrangian mean drift is small hence pure temporal wave decay and pure spatial wave decay yield in practice the same mean drift current in the porous layer being the stokes drift in the fluid we have assumed a non accelerating mean drift i e u 2 t l 0 in 50 to derive an explicit expression for the steady lagrangian mean velocity we use the fact that the vorticity is zero in the fluid in this non viscous part of the study expressing the vorticity in lagrangian terms and assuming that the vorticity vanishes identically we obtain from weber 2011 eq 21 that 60 u 2 c l 2 x x t a z x t c 2 k u 2 s hence in the infinitely deep fluid 61 u 2 l u 2 s ω k η 0 2 exp 2 k c 2 α a β t we remark that this result is also obtained if we use the stokes drift expression 46 for the ocean the difference here is that 61 yields the lagrangian mean drift so this equation tells us in addition that the eulerian mean velocity vanishes in the inviscid ocean which should not come as a surprise see longuet higgins 1953 spatial attenuation α 0 introduces a small vertical mean drift into the problem we obtain from the continuity eq 11 that z 1 t c 2 α x 1 t and z 2 t c 2 α x 2 t assuming vanishing mean vertical velocity when c we find for the fluid that 62 z 2 t α k u 2 s c 0 utilizing the continuity of mean velocities at c 0 and neglecting a very small vertical creep of o r 3 within the medium the interface and the porous layer will move upwards with a small velocity given by 63 z 1 t α k u 2 s c 0 we find that 64 z 2 t z 2 t α η 0 k h 1 r k η 0 where all of the three parts are much less than one hence the vertical mean drift has no practical consequences in this problem 6 discussion and final remarks we study the coupling between surface gravity waves and the motion in a floating flexible porous surface cover as first shown by reid and kajiura 1957 for inviscid wave motion over a porous seabed wave damping occurs due to the vertical flow at the boundary between the fluid and the porous bottom layer as we have shown here this phenomenon which we have termed porous damping also occurs when we have a floating porous layer at the sea surface thin porous floating layers at the sea surface do occur in nature the perhaps most fascinating example is the case of large mats of floating vegetation formed by sargassum seaweed in the sargasso sea see e g gower and king 2011 these mats form a fibrous water filled porous medium which constitutes an important habitat for many marine species it is sometimes referred to as the golden floating rainforest of the atlantic ocean however it is hard to find reports of physical properties such as porosity or permeability in the literature hence without such data our results will be rather speculative on the other hand with relevant data the results reported in this paper could be applied to the slow flow of water and pollution in sargassum seaweed cause by incoming surface waves we have therefore concentrated on the application to rubble ice layers which is a well documented phenomenon in cold regions this application is interesting in that porous damping acts stronger than viscous damping on shorter surface waves it increases the filtering of shorter waves from wave spectra observed from platforms on the ice however also this case is not without problems since rubble ice often occurs beneath a layer of consolidated ice the rubble is hard to observe from stations on the ice hence it is difficult to separate the damping effect described here from other damping mechanisms in the vast amount of observations of waves in the ice see for example wadhams 2000 squire 2020 and references therein in addition the thickness of the rubble layer is not constant in real world ice covers it has maximum thickness beneath ice ridges see for example strub klein and sudom 2012 on the other hand haapala 2000 reports of regions of fairly constant thickness rubble ice in the baltic sea anyway as long as the rubble layer is porous some lateral variation in thickness will not obstruct the porous wave damping mechanism described here finally we remark that the porous matrix elements in ice rubble are not rigidly connected however we assume that the individual rubble blocks are so densely packed that we can ignore their relative motion furthermore a precise description of the flow in the pores is probably not possible but certainly a kind of creeping motion will occur then the darcy formulation of the friction in the permeable medium may constitute a robust lowest order approximation see also marchenko 2022 the description of the slow lagrangian mean transport in the rubble layer in this paper is new it may have bearing to the motion of ice algae or pollution like oil or microplastics in rubble ice declaration of competing interest the author declares that he has no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments financial support from the research council of norway through the grant 280625 dynamics of floating ice is gratefully acknowledged 
23841,operational flood forecast systems are typically based on barotropic models in order to limit computational cost in this study a computationally efficient way of adding spatial and temporal variations of water density henceforth adding baroclinicity to a global barotropic forecast system is described and evaluated the approach is illustrated using a global high resolution 1 12 model with an optimized vertical grid of nine ocean levels temperature t and salinity s for each layer are weakly nudged to forecast fields provided by a coarser resolution 1 4 data assimilative ocean model this adds realistic baroclinic variability with periods exceeding about 15 d to the 1 12 model while allowing the higher frequency variability to evolve freely the computational cost of running the new model is only 10 higher than the cost of running the two dimensional barotropic version of the model that forms the basis of the present total water level twl forecast system the value of adding baroclinicity is demonstrated across the sea level frequency spectrum using hourly observations of twl made between october 20 2019 and february 28 2021 by a global distribution of 211 tide gauges large improvements in the tidal residuals twl tide are shown for periods exceeding 15 d this is consistent with the known importance of baroclinic processes to sea level variability in this frequency range for periods between 10 h and 15 d baroclinicity also improves the predictions of extreme residuals by up to 15 cm with the largest improvements occurring on narrow shelves in terms of extremes adding baroclinicity improves predictions of the three largest positive tidal residuals for 2020 at 89 of the tide gauges with the largest improvements reaching 42 cm similar results were found for the three largest negative residuals for each tide gauge record the importance of modeling baroclinically modified coastal trapped waves is illustrated for the west coast of north and south america keywords baroclinic effect storm surge tide coastal trapped waves operational flood forecasting sea level 1 introduction flooding caused by extreme sea levels poses a serious threat to coastal communities worldwide and the associated costs are expected to increase significantly over the next century e g ipcc 2014 hinkel et al 2014 extreme low levels can also threaten marine navigation and result in the grounding of vessels in shallow waters e g bernier and thompson 2015 effective mitigation of the risk of coastal flooding and vessel grounding requires forecasts of total water level twl with lead times of order ten days decadal and longer timescale projections of twl are also required to assess the potential impact of climate change and variability on coastal flooding e g muis et al 2016 vousdoukas et al 2018 both short term forecasting of twl and the projection of twl on climate times scales require ensembles of model runs in order to quantify uncertainty e g flowerdew et al 2010 bernier and thompson 2015 palmer 2019 accurate forecasts of twl for many coastal regions require the model domain to be large enough to capture signals that may have been generated thousands of kilometers from the region of interest e g wang et al 2021 and references therein the model s horizontal resolution must also be sufficiently high to accurately represent local shelf processes and the propagation of remotely generated signals along coastal waveguides e g hughes et al 2019 particularly during extreme weather events including tropical cyclones and hurricanes e g bunya et al 2010 bloemendaal et al 2019 the above requirements present a major challenge in the development of a computationally viable forecast projection system for twl barotropic models have a long history of success in predicting tides and storm surges e g flather 2000 werner et al 2009 verlaan et al 2015 bernier and thompson 2007 2015 allen et al 2018 pringle et al 2021 wang et al 2021 given this success and their relatively low computational cost barotropic models are used in most of today s global and regional twl forecast systems however baroclinic processes can make important contributions to twl across the entire frequency spectrum for example the el niño southern oscillation enso the best known climate mode of the coupled atmosphere ocean system can contribute changes of order 30 cm to interannual changes of sea level in the western tropical pacific becker et al 2012 and 20 cm along the west coast of the u s hamlington et al 2015 on seasonal timescales steric changes contribute about 2 cm to the annual cycle of sea level averaged separately over the northern and southern hemispheres leuliette and willis 2011 the amplitude can be much larger if the averaging is performed over smaller regions e g it can reach several decimeters in the vicinity of river outflows tsimplis and woodworth 1994 on timescales of weeks to seasons equatorial kelvin waves 30 100 days excited by winds associated with the madden julian oscillation mjo madden and julian 1972 and rossby gravity yanai waves 1 2 weeks excited by meridional winds e g han et al 2008 can propagate great distances along the equatorial waveguide when these equatorial waves reach the eastern boundary they transform into coastal trapped waves ctws and westward propagating rossby waves moore 1968 this transformation is governed by a critical period t c such that for t p t c energy is trapped to the coast while for t p t c energy leaves the coast clarke and shi 1991 for nonmeridional boundaries the critical period is affected by the coastline orientation the more zonal a coastline the longer the critical period ctws transformed from equatorial waves have been used to describe sea level changes of order 10 cm along the eastern boundaries of the indian ocean and pacific ocean e g cornejo rodriguez and enfield 1987 oliver and thompson 2010 on timescales of weeks and less a significant part of observed twl variability can be explained in terms of ctws e g mysak 1980 brink 1991 hughes et al 2019 the characteristics of ctws are strongly dependent on vertical density stratification as parameterized by the burger number 1 b u n 2 h 2 f 2 l 2 l r 2 l 2 where n h and l are typical values of buoyancy frequency depth and shelf width respectively f is the coriolis parameter and l r is the internal rossby radius of deformation huthnance 1978 for b u 1 ctws approach barotropic shelf waves or topographic rossby waves for b u 1 a sloping sea floor near the coast serves approximately as a side wall and ctws can be approximated by internal kelvin waves this approximation is to be anticipated to hold in regions with strong stratification a narrow shelf or low latitude to illustrate baroclinic effects on storm surges of order 10 cm have been reported for the narrow shelf of southeast coast of africa kodaira et al 2016a based on a two layer model kitade and matsuyama 2000 qualitatively explained the sea level variability observed on timescales of days off the southeast coast of honshu japan using a combination of shelf and internal kelvin waves baroclinicity can also affect surges through changes in bottom friction and the tides through changes in the eddy viscosity profile müller 2012 and the conversion of energy from barotropic to baroclinic tides e g arbic et al 2010 the inclusion of baroclinic effects in an ocean model can lead to a substantial increase in computational cost recently kodaira et al 2016a evaluated a baroclinic model with a reduced vertical resolution 19 z levels model and temperature t and salinity s nudged to a climatological density field the model was able to capture important baroclinic effects on ctws we note however that variations of t and s about the climatological mean state were not considered and the model s configuration 1 12 resolution and 19 z levels is still computationally expensive for ensemble forecasting or making climate projections an alternative approach is to utilize t and s fields generated separately by a large scale data assimilative ocean model for example muis et al 2018 and zhai et al 2019 used the monthly means of ocean reanalysis products to account for low frequency baroclinic contributions to twl variability pringle et al 2019 used a more dynamically consistent approach by adding depth integrated baroclinic pressure gradients calculated from forecast fields of t and s to the right hand side of the barotropic momentum equation approaches such as these pose a challenge for the externally generated t and s fields their resolution in both space and time needs to be sufficiently high in order to resolve baroclinic variability on timescales of weeks and less and spatial variability over narrow shelves and near small scale topographic features such as islands environment and climate change canada eccc has already started to produce medium range ocean forecasts including three dimensional fields of t and s using a global coupled atmosphere ocean model gem nemo smith et al 2018 lin et al 2020 the ocean model has 50 vertical levels and uses the orca025 grid which has a nominal resolution of 1 4 it assimilates observations of sea surface temperature sea level anomaly and vertical profiles of t and s note that operational baroclinic models like gem nemo are usually not suitable for twl forecasting because they do not include tides and their horizontal resolution is too coarse to resolve for example baroclinically modified ctws propagating along narrow shelves the t and s fields are however useful in the present study in constraining low frequency large scale changes in t and s eccc has also recently developed a global twl forecast system wang et al 2021 with a nominal resolution of 1 12 eorca12 the model is barotropic and includes both storm surges and tides the present study outlines and evaluates an approach for including baroclinic effects in the global twl forecast model two overriding questions are addressed 1 what is the most efficient way of adding baroclinicity to the twl forecast model we will explore ways of taking advantage of the t and s forecasts produced by gem nemo and pay particular attention to the choice of vertical levels because their number is an important determinant of the computational cost of the system 2 what is the impact on the skill of the predictions of twl tides and the tidal residuals in addition to using standard metrics like the root mean square difference between observed and predicted hourly records of twl we will also quantify errors in extreme levels the structure of the paper is as follows the observations of coastal twl and tidal currents from the deep ocean used to constrain the model s tides are described in section 2 the ocean model its atmospheric forcing and the t and s forecasts from gem nemo are described in section 3 the optimization of the vertical grid is described in section 4 the impact of adding baroclinicity is quantified in section 5 and the importance of resolving baroclinically modified ctws is illustrated in section 6 the results are summarized and discussed in the final section 2 observations hourly twls observed by a global array of tide gauges between october 2019 and february 2021 inclusive were obtained from the university of hawaii sea level centre caldwell et al 2015 tide gauge stations were excluded if any of the following criteria were met 1 the proportion of missing observation exceeds 90 2 the station is more than 25 km from the nearest ocean model grid point 3 the station is shielded from the open ocean by barrier islands or located far inland on an estuary 4 the station is on an island that is too small to be resolved by the model 5 the statistical properties of the observed hourly record e g variance seasonal cycle datum change abruptly through time applying the five selection criteria resulted in a global distribution of 211 stations fig 1 the uneven global distribution of the 211 stations causes difficulty when attempting to plot the global distribution of point statistics such as root mean square error rmse for this reason we reordered the 211 stations taking into account the tendency of extended coastlines and adjacent shelves to act as coastal wave guides fig 1 shows the numbering of the reordered stations and their grouping into 6 subregions several figures in section 4 and section 5 show point statistics e g rmse as a function of station code grouped by subregion the depth averaged horizontal currents in deep water predicted by the model are tidally nudged kodaira et al 2019 wang et al 2021 and section 3 toward externally generated tidal current fields that are strongly constrained by observations the fields were calculated from the tidal amplitudes and phases of eight tidal constituents m 2 s 2 n 2 k 2 o 1 k 1 p 1 and q 1 generated by the tpxo8 model egbert and erofeeva 2002 the amplitudes and phases were obtained from oregon state university on a global grid with a spacing of 1 30 given the good agreement between tpxo8 tidal predictions and independent observations stammer et al 2014 the tpxo8 predictions will henceforth be treated as observations 3 the ocean model 3 1 governing equations the governing equations of the model are as follows 2 u h t u u h f u h h p a ρ 0 g 1 α s η g η a g z 0 ρ ρ 0 ρ 0 d z a h h 2 u h z a z u h z λ x u o b s u h 3 u 0 4 t t t u k h h 2 t z k z t z r t t f 5 s t s u k h h 2 s z k z s z r s s f subscript h refers to horizontal u h is the horizontal velocity vector u v and u is the full three dimensional velocity vector u v w η is the sea surface height η a is the gravitational tidal potential p a is atmospheric pressure at sea level and ρ 0 is a reference density 1025 kg m 3 the coefficient α s parameterizes self attraction and loading and following stepanov and hughes 2004 is depth dependent the last term on the right side of 2 denotes the nudging of modeled depth averaged horizontal current u h toward the observed current u o b s given by tpxo8 the angle brackets represent temporal filtering of the nudging term to isolate variability in selected tidal frequency bands kodaira et al 2019 wang et al 2021 λ x determines the spatially varying strength of the nudging at horizontal position x and its global distribution is given by wang et al 2021 r in 4 and 5 is a spatially uniform coefficient that controls the strength of the nudging of modeled t and s to operational forecasts t f and s f provided by gem nemo see section 3 3 for more detail constant values of lateral eddy viscosity and diffusivity coefficients a h 100 m2 s 1 and k h 10 m2 s 1 are used over the whole ocean vertical eddy viscosity and diffusivity coefficients a z and k z are computed based on the turbulent kinetic energy tke scheme of gaspar et al 1990 the prognostic equation for the tke e is given by 6 e t a z u z 2 v z 2 k z n 2 z a z e z c ε e 3 2 l ε 7 a z c k l k e k z a z p r t where n is the local buoyancy frequency the dissipation and mixing turbulent length scales take the same value l ε l k 2 e n and they are bounded by the assumption that vertical variations of the length scale cannot be larger than the variations of depth as stated in the user manual of nemo madec 2008 the prandtl number p r t is a function of the local richardson number following blanke and delecluse 1993 the constants c k 0 1 and c ε 2 2 are designed to handle vertical mixing at any depth the surface boundary conditions for 2 are 8 a z u h z z 0 τ s ρ 0 τ s ρ a c d s u 10 u 10 where τ s is the surface stress ρ a is the air density u 10 is wind velocity at 10 m following bernier and thompson 2007 the surface drag coefficient c d s equals 1 2 1 0 3 for wind speeds below 8 m s 1 and increases linearly with u 10 for higher wind speeds with a slope of 0 065 1 0 3 for every 1 m s 1 increase in u 10 the bottom boundary conditions for 2 are 9 a z u h z z h τ b ρ 0 τ b ρ 0 c d b u b u b where τ b is the bottom stress and u b is the bottom current velocity the bottom drag coefficient c d b is set equal to 2 5 1 0 3 in contrast to wang et al 2021 who used a barotropic version of the present model we do not include parameterized internal wave drag the reason is the present model is baroclinic and can explicitly resolve long internal tides via the baroclinic pressure gradient this means internal tides can be generated when barotropic tides push stratified water over topographic features e g baines 1973 sensitivity tests not presented show the inclusion of internal wave drag degraded model skill in some regions e g southeast asia presumably due to double counting we also note that kodaira et al 2016b found removal of internal wave drag from the baroclinic model had minimal effect on model skill in deep water the governing equations are solved numerically using the nemo modeling framework madec 2008 the model grid is the extended version of a tri polar orca grid eorca12 and covers the antarctic ice shelves it has a nominal resolution of 1 12 the bathymetry is derived from gebco 2014 weatherall et al 2015 local improvements were made in hudson bay and on the labrador and newfoundland shelf using bathymetric data kindly provided by f lyard personal communication the choice of vertical grid is discussed in section 4 mode splitting was used with a time step of 240 s for the internal mode and 6 s for the external mode 3 2 atmospheric forcing gridded fields of surface wind and air pressure were obtained from the assimilation component of the global deterministic prediction system gdps buehner et al 2015 developed and run operationally at eccc the gdps is used to produce hourly forecasts on a grid with a spacing of approximately 15 km note the present model is not forced by fluxes of heat and freshwater across the air sea interface or freshwater input from rivers their effect on ocean density is included implicitly by the nudging of temperature and salinity 3 3 temperature and salinity nudging temperature and salinity in governing equations 4 and 5 are weakly nudged to externally generated forecasts of t f and s f using a spatially uniform nudging coefficient r gridded forecasts of t f and s f were obtained from eccc s operational global ensemble prediction system based on gem nemo smith et al 2018 the atmospheric component of this coupled system has a horizontal resolution of approximately 39 km the sea ice component is based on cice with 10 ice thickness categories the ocean component has 50 vertical levels an eddy permitting horizontal resolution of 1 4 and uses a time step of 15 min it is initialized using analyses generated by the system d assimilation mercator version 2 sam2 developed by mercator océan tranchant et al 2008 more details on the coupling and initialization procedures are given by smith et al 2018 note the ocean component does not include the air pressure forcing and thus the inverse barometer effect its impact on t and s and the associated steric height anomaly is expected to be negligible as will be shown later the linear combination of the gem nemo forecast and the inverse barometer effect compares well with observed seasonal cycle of sea level the coupled system is run each week to produce a 32 day forecast we concatenated the first week of each 32 day forecast and thereby generated a continuous time sequence of three dimensional fields of t f and s f the latest version of the coupled system was implemented operationally at eccc in july 2019 three dimensional fields of t f and s f were available starting october 2019 the nudging coefficient was taken to be r 0 2 d 1 to interpret this value we note that for an idealized version of 4 of the form d t d t r t t f the frequency dependent gain of t with respect to t f exceeds 0 5 for periods exceeding t p 0 5 2 π 3 r 18 d priestley 1981 this implies the nudged model will be guided at low frequencies by the three dimensional fields of t f and s f generated by gem nemo which in turn are constrained by observed sea level anomalies sea surface temperature and vertical profiles of t and s sensitivity tests see fig s2 in the supplementary material show that r values that correspond to a t p 0 5 of about 18 days are reasonable choices halving or doubling a t p 0 5 of 18 days reduces overall model performance in the synoptic or subseasonal frequency bands there is a potential mismatch in the spatial scales of variability of t and t f and s and s f resulting from the differing horizontal resolution of the grids used by the present model and gem nemo this implies the nudging may suppress high wavenumber variability in t and s particularly for large values of r and that it may be worthwhile reducing high wavenumber variability in the nudges by spatially smoothing t t f and s s f before feeding them into 4 and 5 this is consistent with the philosophy of spectral nudging outlined by thompson et al 2006 sensitivity runs see appendix a show spatial smoothing is not required for the chosen value of r 3 4 evaluation of model skill power spectra of observed and predicted twl for the same tide gauge station are compared two forms of presentation are used in the standard form spectral density h ω is plotted on the y axis and ω is plotted on the x axis in the variance preserving form e g thomson and emery 2014 ω h ω is plotted on the y axis and log ω is plotted on the x axis for both forms of presentation area under the curve is proportional to twl variance in the selected frequency band the advantage of the variance preserving form is that it stretches the x axis as ω 0 thereby gives a more detailed view of the spectrum for low frequencies in accord with previous studies extensive use is made of root mean square error rmse in assessing model skill for individual tide gauge stations for comparison we also calculate the root mean square rms of the observations from each station to provide a global assessment of model skill we use the three quartiles of the set of 211 rmse values for all tide gauges the second quartile is thus the median of these rmse values and will henceforth be referred to as rmse 50 where the 50 refers to the 50th percentile note the arithmetic means of the observed and modeled records of twl for each tide gauge were removed prior to comparison the above statistics were calculated for twl tides and the tidal residuals tides were reconstructed using the t tide package of pawlowicz et al 2002 using the following tidal constituents m 2 s 2 n 2 k 2 o 1 k 1 p 1 and q 1 these are the eight constituents used to force the model and tidally nudge to the tpxo8 observations in order to resolve all eight constituents the evaluation of tides was only applied to stations with at least 6 months of data tidal residuals were obtained using all tidal constituents for a given record except the annual sa and semi annual ssa tides both of these long period tides are primarily meteorological in origin with only a small contribution several mm from gravitational forcing pugh and woodworth 2014 for this reason we chose to retain sa and ssa in the tidal residuals short period radiational tides e g s 1 and s 2 are unavoidably removed from the residuals by the tidal analysis to quantify model skill in predicting extreme levels we calculated the three largest positive values of an observed hourly record we required the largest values to be separated in time by more than one day in order to focus on individual events each extreme was then compared to the largest prediction made within three hours of the observed extreme this allows for small errors in the timing of the predicted extreme to obtain a single measure of fit from the three discrepancies we calculated the mean absolute error mae which is simply the arithmetic average of the absolute errors willmott and matsuura 2005 mean absolute errors were also calculated for the three largest negative values of each record 4 optimization of the vertical grid the number of vertical levels n z is an important determinant of the computational cost of our twl forecast system global ocean models generally require at least 50 vertical levels to resolve complex vertical dynamics it is possible to relax this requirement for our model because it is nudged toward realistic temperature and salinity fields generated by a more complex data assimilative model with 50 vertical levels section 3 3 however sufficient vertical levels are still required to resolve the main features of the density profile that will determine for example steric changes and the contribution of baroclinically modified ctws section 1 in this section we examine the trade off between model performance and computational cost for five vertical grids with n z 6 9 12 19 and 50 all of the runs described in this section are restricted to the period january to june 2020 the grids are shown in the left panels of fig 2 for each grid most levels are in the upper 300 m where baroclinic variability is expected to dominate maes and o kane 2014 partial steps are used for the bottom layer to more accurately represent the bathymetry for comparison runs were also performed with n z 2 the two dimensional barotropic configuration the right panel of fig 2 shows the run time of a 10 day forecast as a function of n z run time increases by only 10 as n z increases from 2 to 9 but by almost 100 as n z increases from 9 to 50 we note however that the full global operational ocean system with 50 levels is far more expensive and complex as it requires for example sophisticated data assimilation more complex lateral and vertical mixing schemes and coupling to advanced sea ice models all of which require a lot of effort to optimize the right panel of fig 2 also shows rmse 50 for twl tide and tidal residual as a function of n z for the tide rmse 50 decreases by 21 as n z increases from 2 to 6 further decreases by 5 from n z 6 to 19 and then increases slightly by 4 from n z 19 to 50 for both twl and the tidal residuals rmse 50 decreases by 20 and 32 respectively as n z increases from 2 to 9 with much smaller changes for n z 9 fig 3 shows the mae for extreme tidal residuals as a function of station code the two dimensional barotropic run n z 2 has the lowest skill for maxima it has the largest mae at 88 of the 181 stations and 80 of the stations for the minima the inclusion of baroclinicity n z 2 significantly improves model skill with the average of mae across all stations see numbers within parentheses in the legend approximately reduced by a half or a third for maxima or minima for individual stations the mae for n z 9 are very similar based on a trade off of model performance and computational cost we chose the vertical grid with n z 9 levels 5 impact of adding baroclinicity on predictions of sea level the impact of baroclinicity is now quantified by comparing results from the barotropic run 9 bt and baroclinic run 9 bc runs both runs use n z 9 levels and differ only in the way t and s are calculated for run 9 bt t and s are kept constant for run 9 bc t and s are weakly nudged to the daily means provided by gem nemo the study period is constrained by the availability of the gem nemo forecasts and covers the period september 7 2019 to february 28 2021 the first 43 days are discarded to allow for model spin up the model spin up time is determined mainly by the spin up time of the tidal nudging wang et al 2021 5 1 total water level we first compare the power spectra of observed and predicted twl at 11 stations fig 4 all of the stations excluding halifax hong kong and esperance border narrow or narrowing shelves where we anticipate baroclinic effects will be significant section 1 based on visual inspection of these spectra we focus the subsequent discussion on the frequency bands defined in table 1 the addition of baroclinicity improves the agreement between the observed and predicted spectra in the interseasonal and subseasonal frequency bands at all stations these improvements are mainly the result of the nudging of t and s in run 9 bc to the gem nemo forecasts which in turn are constrained by observations improvements are also evident in the low frequency synoptic band for stations in the tropics e g quepos dakar and benoa note that at these frequencies the model is less constrained by the nudging less than 50 section 3 3 the nudging also improves agreement in the high frequency synoptic band at dakar port elizabeth toyama benoa and suva even though the model is not nudged at these frequencies spectra for the high frequency band are shown in standard form in fig 5 sharp peaks centered on periods close to 8 h 6 h and 4 h are evident in the observed spectra these peaks are likely due to overtides resulting from nonlinear effects in shallow waters e g bernoulli setdown and quadratic bottom friction parker 1991 run 9 bt and run 9 bc underestimate or completely miss the observed peaks close to 6 h at many stations e g halifax andenes dakar port elizabeth and hong kong we assume this is due to the inability of the models to resolve the aforementioned nonlinear processes which are known to occur on small spatial scales it is interesting to note that both run 9 bt and run 9 bc are more successful in reproducing the observed peaks around 8 h this can be explained by a terdiurnal oscillation known to exist in surface air pressure ray and poulose 2005 and which is therefore included in the atmospheric forcing applied to both models in addition to sharp peaks some of the observed spectra e g crescent city halifax port elizabeth and esperance indicate more broadly distributed energy at high frequencies that is not evident in the run 9 bt and run 9 bc spectra we speculate this is the result of instrument errors e g sensor or clock malfunctions instability of the vertical datum of the tide gauge and seiches not resolved by the models the similarity of the run 9 bt and run 9 bc spectra shows that baroclinic effects in the high frequency band are insignificant we note however that pringle et al 2019 showed baroclinic coupling improved simulated high frequency 1 2 cycles per hour seiches on narrow island shelves using a very high resolution 30 m in coastal areas regional model investigation in this high frequency range requires high temporal resolution typically less than 15 min for both observations and model output this type of investigation was not possible in the present study which is based on hourly data the horizontal resolution of our global model is also too coarse to simulate such high frequency variability we now quantify the difference in observed and predicted twl using rmse section 3 4 fig 6a shows the quartiles of the rmse values for the 211 stations adding baroclinicity improves predicted twl at 93 of the stations and reduces the three quartiles of rmse values by 18 26 from a practical point of view the most important concerns are coastal flooding and vessel grounding caused by extremely high and low water levels section 1 we now focus on baroclinic effects on extreme water levels the upper left panel of fig 7 is a scatterplot of the observed and predicted annual twl maxima for 186 stations with at most 20 missing observations during the year 2020 the data points for run 9 bc appear slightly more concentrated to the 1 1 line than run 9 bt but it is not easy to see the differences due to the dominant contribution made by the tide at most stations to illustrate this the upper middle panel shows a scatterplot of the corresponding annual tidal maxima all tidal constituents except sa and ssa were included the two scatterplots are very similar confirming most of the variability in the twl maxima can be explained by the tidal contribution to allow for this we have referenced the twl maximum for each yearly record by subtracting the corresponding tidal maximum for the same period the referenced annual maxima are plotted as a function of station code in the middle panel of fig 7 and the scatterplot of referenced maxima is shown in the upper right panel the lower panel further shows the differences in the absolute errors for the referenced maxima between run 9 bt and run 9 bc these plots clearly show the substantial improvement in the prediction of the annual maxima resulting from the addition of baroclinicity the errors are reduced up to 42 cm at 78 of the 186 stations the corresponding results for the annual twl minima fig 8 are similar with reduced errors up to 20 cm occurring at 82 of the stations relatively large improvements greater than 10 cm are found in two subregions southeast asia and japan and indian ocean this is discussed in section 5 3 5 2 tides adding baroclinicity improves the predicted tide constructed using eight major constituents see section 3 4 at 78 of the 211 stations and leads to a modest reduction 13 18 in the quartiles of rmse values across all stations fig 6a rmse values for each station are shown in fig 9 the rms of the observed tide is shown in the bottom panel for reference large improvements 6 20 cm are seen at a few stations in the southeast asia and japan region further analysis of individual tidal constituents at the 211 stations see fig s1 in the supplementary material indicates that most of the improvements in tidal predictions are due to reductions in amplitude errors for m 2 s 2 and k 1 reductions in phase errors are relatively small less than 3 degrees for the semidiurnal tides m 2 and s 2 major reductions in rmse 3 17 cm occur in the vicinity of southeast and east asia and south of alaska for the diurnal tide k 1 major improvements 3 7 cm occur in the vicinity of southeast asia south of alaska and the northern adriatic sea most of these improvements are due to the correction of overestimated tidal amplitudes from run 9 bt sensitivity tests not presented show that adding the internal wave drag parameterization to run 9 bt leads to similar reductions in these regions this leads us to speculate that barotropic baroclinic energy conversion via the baroclinic pressure gradient is responsible for the improvements in run 9 bc tidal predictions this is the reason internal wave drag parameterization was not included in run 9 bc it avoids double counting however we note the importance of internal wave drag in global ocean models has been demonstrated extensively e g arbic et al 2010 shriver et al 2012 2014 ansong et al 2015 in addition to barotropic baroclinic energy conversion arbic et al 2010 and ansong et al 2015 have argued that internal wave drag can be employed to represent unresolved breaking of internal tides the best way to include internal wave drag in our baroclinic model is a complex issue requiring further investigation 5 3 tidal residuals adding baroclinicity improves the predicted residuals at 94 of the 211 stations and reduces the three quartiles of rmse values across all stations by 31 37 fig 6a individual rms and rmse values are plotted in fig 10 the barotropic run shows almost no skill in the tropics e g stations 142 211 bottom panel indicating the residual variability is mostly baroclinic relatively large improvements greater than 0 03 m are seen across the tropics west of north america and along the coasts of norway japan and australia middle and bottom panels we note that even small rmse differences of several centimeters can reflect large but highly intermittent twl differences of decimeters these improvements can be explained in large part by i interannual variability in the pacific associated with enso ii the relatively large annual cycle of steric sea level at most stations iii baroclinically modified ctws over narrow i e small burger number or narrowing shelves and iv the partition of energy of equatorial waves into components associated with ctws and reflected westward propagating baroclinic rossby waves at the coast see section 1 for background further discussion of the improvements in different frequency bands is given below we next examine the fit to the observed seasonal cycle sa and ssa fig 6b indicates the addition of baroclinicity results in reductions by approximately 50 in the three quartiles of rmse the observed and predicted amplitudes and phases of sa are shown in fig 11 as a function of station code note only results for sa are presented as improvements for sa and ssa are similar the results from gem nemo are included for comparison gem nemo does not include the inverse barometer effect and so we added the water level predicted by our barotropic model forced by air pressure alone the barotropic response of sa predicted by run 9 bt blue line in fig 11 is consistent with earlier studies e g fig 2a in ponte 2006 pattullo et al 1955 it has an overall poleward increase as expected with amplitudes exceeding 6 cm in the vicinity of the aleutian low in the north pacific stations 3 7 and in the northern north atlantic stations 66 71 75 79 80 large amplitudes were also found in the bay of bengal stations 101 102 and in the southeast asia and japan region stations 106 107 110 121 these barotropic responses can be explained mostly by the inverse barometer effect caused by the seasonal variation of air pressure this is supported by model results based on pressure forcing alone not presented only a few exceptions are found along the norwegian coast stations 73 76 in the north sea station 79 and in the vicinity of gulf of thailand stations 105 107 where local winds can explain about 50 of the variability the addition of baroclinicity run 9 bc red line in fig 11 leads to more realistic seasonal cycles again reflecting the quality of the gem nemo forecasts of t f and s f to which run 9 bc is nudged the nudging is not perfect run 9 bc shows relatively large discrepancies in sa amplitude in the laborador sea stations 63 65 66 and around the hawaiian islands stations 196 201 compared to gem nemo green line in fig 11 as expected we found this discrepancy can be reduced by increasing the nudging coefficient this indicates stronger nudging is likely required over these two regions to overcome model bias in predicted t and s reasons include i imperfect bathymetry and parameterizations of mixing and ii the lack of ice dynamics in the labrador sea fluxes of heat and freshwater across the air sea interface and river runoff we next examine the effect of adding baroclinicity in the interseasonal with sa and ssa removed subseasonal and synoptic frequency bands fig 6b shows adding baroclinicity improves predictions in all three bands with the three quartiles of rmse reduced by 28 30 23 25 and 13 14 respectively individual rms and rmse values are plotted as a function of station code in fig 12 significant improvements in the interseasonal band occur in the tropics e g indian ocean and pacific islands where baroclinic processes are dominant compare rms and rmse values in fig 12a large improvements are evident in the subseasonal band fig 12b in the eastern indian ocean stations 152 160 where the sea level variability associated with the mjo is known to be significant oliver and thompson 2010 improvements in the synoptic band fig 12c are relatively small in terms of reductions of rmse but we note that the impact on peak water levels can be much larger up to 15 cm see appendix a for an example in addition improvements across all three frequency bands are found along the west coast of north america stations 5 20 and the northwest coast of norway stations 70 75 to explain improvements over the two regions we consider the burger number b u l r l 2 on the west coast of north america the shelf width l is only about 30 km and the internal rossby radius of deformation l r varies from 10 100 km chelton et al 1998 this leads to quite large b u values in low latitudes and moderate b u values in mid latitudes suggesting strong baroclinic effects on ctws another factor that likely contributes further to the improvement is the relatively long critical periods t c 100 days clarke and shi 1991 along the southwest coast of north america south of 23 n associated with the more zonally inclined coastline as a result more incident energy is partitioned into ctws as opposed to westward propagating rossby waves the role of ctws over this region is discussed further in section 6 along the northwest coast of norway b u is much smaller b u 1 as l is about 40 200 km and l r is up to only 10 km however this region features abrupt narrowing shelves which are known to be subject to enhanced transmission of ctws with baroclinicity wilkin and chapman 1990 we now focus on baroclinic effects on extreme tidal residuals the top three panels of fig 13 show the three largest positive values of the observed and predicted tidal residuals for 2020 as a function of station code the addition of baroclinicity reduces the mae section 3 4 of the three largest positive residuals at 89 of the stations the average of the mae values across all stations is reduced by 46 from 13 9 cm to 7 5 cm the largest improvements up to 42 cm are found in the eastern indian ocean stations 152 160 consistent with large reductions in rmse values in the interseasonal and subseasonal bands over this region see fig 12 the improvements along the south coast of sumatra and java stations 155 160 can be explained by both the large burger numbers b u 1 with l of about 10 km and l r of 100 230 km and the long critical periods associated with zonally inclined coastlines both of which favor baroclinic ctws further investigation not presented confirms that large subseasonal ctws driven by eastward propagating equatorial waves are responsible for the substantial improvements at stations 155 160 toward the eastern end of this coastline energetic westward propagating rossby waves are continuously generated resulting in large improvements at the two deep water island stations 153 154 the corresponding results for the three largest negative residuals are shown in fig 14 adding baroclinicity improves the predictions of minima at 86 of the stations and reduces the average of mae values by 43 from 8 6 cm to 4 9 cm 6 the role of coastal trapped waves it is well known that ctws propagating along the west coast of north and south america have hybrid characteristics of shelf and internal kelvin waves and can be forced both locally and remotely including the equator allen and romea 1980 enfield and allen 1980 1983 enfield 1987 spillane et al 1987 in this section we examine the difference in tidal residuals predicted by run 9 bc and run 9 bt henceforth η b c b t for this coastline and physically interpret the difference in terms of locally and remotely forced ctws the contribution of sa and ssa has been removed from η b c b t to simplify the discussion we introduce the alongshore coordinate s defined by fig 15 the same figure also shows a snapshot of η b c b t for march 1 2020 fig 16a shows the variability of η b c b t along the coast as a function of time and distance from the equator changes in η b c b t approach 15 cm poleward propagation is evident on both sides of the equator it is also clear that the propagation speed is not spatially uniform for example there is a pronounced increase in speed moving north of about 35 n s 7200 km based on separate hovmöller diagrams for run 9 bt and run 9 bc not shown we conclude this increase is due to a switch from primarily baroclinic to barotropic ctws consistent with ctw theory allen and romea 1980 the rest of this section examines η b c b t in the interseasonal subseasonal and synoptic frequency bands table 1 interseasonal band fig 16b is dominated by a biennial cycle with an amplitude approaching 10 cm and phase speed of 1 5 3 0 m s 1 the cycle is coherent from 20 s to about 55 n based on an analysis of 25 years of monthly mean sea level enfield and allen 1980 identified sea level signals with periods of 2 to 5 years that propagate poleward from the equator with phase speeds of 0 7 1 2 m s 1 and are coherent over alongshore distances approaching 10 000 km this type of interannual variability is known to be coherent with the southern oscillation index quinn 1974 we speculate that the biennial cycle in fig 16b is related to the biennial component of enso rasmusson et al 1990 north of about 55 n baroclinic variability with a period of about four months and amplitude of 2 4 cm can be seen subseasonal band fig 16c shows ctws modified by baroclinicity propagating poleward from the equator with a phase speed of approximately 2 5 m s 1 this phase speed is consistent with the phase speed of freely propagating ctws associated with the lowest baroclinic mode enfield 1987 north of the equator there is a significant weakening of the poleward propagating signal near the mouth of the gulf of california 23 n s 5200 km previous studies spillane et al 1987 gutiérrez et al 2014 suggest that subseasonal ctws split into two parts at the mouth of the gulf of california one part enters the gulf and dissipates due to bottom friction and the other part appears to jump the mouth and continue to propagate poleward discontinuity in wave propagation is also visible at 16 n s 3200 km and 11 n s 2200 km a plausible explanation is the continuous generation of westward propagating rossby waves around these two latitudes see fig 15 north of 35 n s 7200 km baroclinicity appears to have increased the strength of the barotropic shelf waves synoptic band fig 16d shows the influence of baroclinicity on ctws as they propagate poleward at a speed of approximately 2 5 m s 1 it is interesting to note that some of these waves appear to be forced by yanai mixed rossby gravity waves due to their antisymmetric structure about the equator enfield et al 1987 have shown that equatorial yanai waves are responsible for observed free ctw activity off peru cornejo rodriguez and enfield 1987 further north these waves propagate into the gulf of california where they dissipate consistent with the study of martínez and allen 2004 north of the gulf of california locally forced barotropic shelf waves are only slightly modified by baroclinicity the above interpretation of η b c b t in terms of baroclinically modified ctws has two important implications for the design of models for predicting coastal sea level the grid spacing must be small enough to resolve the shelf and slope and the model domain must be large enough to capture the effect of remotely forced ctws which can propagate thousands of km 7 summary and conclusions the present study outlines and evaluates an approach for adding baroclinicity to a global twl forecast model two overriding questions were addressed 1 what is the most efficient way of including baroclinic effects in the twl forecast model 2 what is its impact on the skill of the model predictions of twl tides and the tidal residuals the approach is based on a baroclinic high resolution 1 12 model with an optimized vertical distribution of ocean layers temperature and salinity for each layer are weakly nudged to forecast fields provided by a coarser resolution 1 4 data assimilative ocean model the weak nudging allowed us to combine the advantages of both models realistic low frequency baroclinic changes from the 1 4 model were implicitly accounted for without need to specify fluxes of heat and freshwater across the air sea interface or river runoff high frequency variability generated by the 1 12 model was not nudged directly but was still modified by the low frequency changes of the background state this approach is suitable for climate projections of twl given three dimensional projections of temperature and salinity the optimization of the model was based on minimizing the number of vertical levels based on a set of sensitivity runs we chose a vertical grid with nine levels the computational cost of running this baroclinic model was only 10 higher than the cost of running the equivalent 2d barotropic model increasing the number of levels from 9 to 50 did not result in a significant increase in model skill the impact of adding baroclinicity was quantified at 211 tide gauges using observed hourly sea level from october 20 2019 to february 28 2021 increase in skill was found across the twl spectrum adding baroclinicity also improved the predictions of high and low water levels for example the errors in predicting annual twl maxima were reduced by up to 42 cm the tidal predictions were also improved most notably in the southeast asia region where we speculate the important physical process is the conversion of barotropic to baroclinic tidal energy the improvements in the predictions of tidal residuals were most noticeable at low frequencies where baroclinicity is known to make important contributions to sea level variability contributions include biennial changes associated with enso the seasonal cycle of steric level and the subseasonal variability associated with baroclinic rossby waves and ctws driven by equatorial waves in the synoptic band the addition of baroclinicity improved predicted peak surges up to 15 cm through its effect on the properties of ctws particularly over narrow shelves where internal kelvin waves are often observed improvements were also seen in the predictions of extreme tidal residuals the important role of baroclinically modified ctws in the subseasonal and synoptic frequency bands was illustrated for the west coast of north and south america ctws with characteristics of internal kelvin waves make contributions of 6 9 cm in low to mid latitudes ctws with characteristics of shelf waves were also modified up to 6 9 cm by baroclinicity the spatial scale of baroclinic effects on ctws can span thousands of kilometers due to the large distances they can propagate in terms of future work we are extending the study period from order one year to 38 years and thus quantify more accurately the effect of adding baroclinicity on twl maxima in different regions we plan to examine the effect of dominant modes of variability of the coupled atmosphere ocean system including enso on the predictability of coastal flooding we are also extending this global system to include sea ice effects by further taking advantage of forecasts provided by the ocean and ice components of gem nemo the goal is to improve forecasts in ice infested waters whilst keeping the computational cost sufficiently low to allow for ensemble forecasts credit authorship contribution statement pengcheng wang conceptualization methodology software validation formal analysis investigation writing original draft writing review editing visualization natacha b bernier conceptualization methodology formal analysis resources writing review editing supervision project administration funding acquisition keith r thompson conceptualization methodology formal analysis resources writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the tide gauge data used for model evaluation in this study are available from the university of hawaii sea level centre website https uhslc soest hawaii edu the authors thank three anonymous reviewers for their constructive comments appendix a impact of spatially smoothing the t and s nudges there is a potential mismatch in the spatial scales of predicted t and t f and s and s f due to the different horizontal resolution of the present model 1 1 2 and gem nemo 1 4 as a result the nudging may suppress the small scale baroclinic features generated by the present model in this appendix we evaluate the benefit of spatially smoothing t t f and s s f at each time step before feeding them into 4 and 5 the smoothing was achieved by spatially diffusing the nudges using the model s diffusion code this new run will henceforth be called run 9 bc sm where the sm subscript refers to spatial smoothing of the nudges for both run 9 bc and run 9 bc sm the nudging coefficient was set to r 0 2 d 1 the top two panels of fig a1 show time series of temperature t and the corresponding nudges t t f at a depth of 149 m near the shelf break close to suva fiji black circle in fig a2 this region has a narrow shelf and is thus more likely to be influenced by baroclinic kelvin waves section 1 the temperature time series top panel features two large events one in late december 2019 and the other in april 2020 two similar events are also evident in the tidal residuals observed by the suva tide gauge and predicted by the two baroclinic runs run 9 bc and run 9 bc sm lower panel note the barotropic model run 9 bt underestimates the residual by almost 15 cm highlighting the importance of allowing for baroclinicity when predicting these two events the close agreement of the temperatures and the tidal residuals predicted by run 9 bc and run 9 bc sm indicates spatial smoothing has a negligible effect during these two high frequency baroclinic events further insight into the effect of spatial smoothing is provided by fig a2 which shows maps of observed and predicted temperature during the first event in late december 2019 the temperature left column and the corresponding nudges middle left column predicted by run 9 bc suggest an internal kelvin wave propagating anti clockwise along the shelf break the corresponding nudges in run 9 bc sm middle right column are strongly smoothed as expected however this does not lead to significant differences in temperature predicted by run 9 bc and run 9 bc sm compare left and right columns suggesting the effect of spatial smoothing of the nudges is small consistent with fig a1 in summary the above results show the impact of spatial smoothing of the nudges is small with r 0 2 d 1 it is important to note this conclusion may not hold for stronger nudging higher r in this case spatial smoothing based on diffusing the nudges each time step may prove useful appendix b supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2022 102031 appendix b supplementary data the following is the supplementary material related to this article mmc s1 two figures related to evaluation of individual tidal constituents and sensitivity tests for nudging coefficients 
23841,operational flood forecast systems are typically based on barotropic models in order to limit computational cost in this study a computationally efficient way of adding spatial and temporal variations of water density henceforth adding baroclinicity to a global barotropic forecast system is described and evaluated the approach is illustrated using a global high resolution 1 12 model with an optimized vertical grid of nine ocean levels temperature t and salinity s for each layer are weakly nudged to forecast fields provided by a coarser resolution 1 4 data assimilative ocean model this adds realistic baroclinic variability with periods exceeding about 15 d to the 1 12 model while allowing the higher frequency variability to evolve freely the computational cost of running the new model is only 10 higher than the cost of running the two dimensional barotropic version of the model that forms the basis of the present total water level twl forecast system the value of adding baroclinicity is demonstrated across the sea level frequency spectrum using hourly observations of twl made between october 20 2019 and february 28 2021 by a global distribution of 211 tide gauges large improvements in the tidal residuals twl tide are shown for periods exceeding 15 d this is consistent with the known importance of baroclinic processes to sea level variability in this frequency range for periods between 10 h and 15 d baroclinicity also improves the predictions of extreme residuals by up to 15 cm with the largest improvements occurring on narrow shelves in terms of extremes adding baroclinicity improves predictions of the three largest positive tidal residuals for 2020 at 89 of the tide gauges with the largest improvements reaching 42 cm similar results were found for the three largest negative residuals for each tide gauge record the importance of modeling baroclinically modified coastal trapped waves is illustrated for the west coast of north and south america keywords baroclinic effect storm surge tide coastal trapped waves operational flood forecasting sea level 1 introduction flooding caused by extreme sea levels poses a serious threat to coastal communities worldwide and the associated costs are expected to increase significantly over the next century e g ipcc 2014 hinkel et al 2014 extreme low levels can also threaten marine navigation and result in the grounding of vessels in shallow waters e g bernier and thompson 2015 effective mitigation of the risk of coastal flooding and vessel grounding requires forecasts of total water level twl with lead times of order ten days decadal and longer timescale projections of twl are also required to assess the potential impact of climate change and variability on coastal flooding e g muis et al 2016 vousdoukas et al 2018 both short term forecasting of twl and the projection of twl on climate times scales require ensembles of model runs in order to quantify uncertainty e g flowerdew et al 2010 bernier and thompson 2015 palmer 2019 accurate forecasts of twl for many coastal regions require the model domain to be large enough to capture signals that may have been generated thousands of kilometers from the region of interest e g wang et al 2021 and references therein the model s horizontal resolution must also be sufficiently high to accurately represent local shelf processes and the propagation of remotely generated signals along coastal waveguides e g hughes et al 2019 particularly during extreme weather events including tropical cyclones and hurricanes e g bunya et al 2010 bloemendaal et al 2019 the above requirements present a major challenge in the development of a computationally viable forecast projection system for twl barotropic models have a long history of success in predicting tides and storm surges e g flather 2000 werner et al 2009 verlaan et al 2015 bernier and thompson 2007 2015 allen et al 2018 pringle et al 2021 wang et al 2021 given this success and their relatively low computational cost barotropic models are used in most of today s global and regional twl forecast systems however baroclinic processes can make important contributions to twl across the entire frequency spectrum for example the el niño southern oscillation enso the best known climate mode of the coupled atmosphere ocean system can contribute changes of order 30 cm to interannual changes of sea level in the western tropical pacific becker et al 2012 and 20 cm along the west coast of the u s hamlington et al 2015 on seasonal timescales steric changes contribute about 2 cm to the annual cycle of sea level averaged separately over the northern and southern hemispheres leuliette and willis 2011 the amplitude can be much larger if the averaging is performed over smaller regions e g it can reach several decimeters in the vicinity of river outflows tsimplis and woodworth 1994 on timescales of weeks to seasons equatorial kelvin waves 30 100 days excited by winds associated with the madden julian oscillation mjo madden and julian 1972 and rossby gravity yanai waves 1 2 weeks excited by meridional winds e g han et al 2008 can propagate great distances along the equatorial waveguide when these equatorial waves reach the eastern boundary they transform into coastal trapped waves ctws and westward propagating rossby waves moore 1968 this transformation is governed by a critical period t c such that for t p t c energy is trapped to the coast while for t p t c energy leaves the coast clarke and shi 1991 for nonmeridional boundaries the critical period is affected by the coastline orientation the more zonal a coastline the longer the critical period ctws transformed from equatorial waves have been used to describe sea level changes of order 10 cm along the eastern boundaries of the indian ocean and pacific ocean e g cornejo rodriguez and enfield 1987 oliver and thompson 2010 on timescales of weeks and less a significant part of observed twl variability can be explained in terms of ctws e g mysak 1980 brink 1991 hughes et al 2019 the characteristics of ctws are strongly dependent on vertical density stratification as parameterized by the burger number 1 b u n 2 h 2 f 2 l 2 l r 2 l 2 where n h and l are typical values of buoyancy frequency depth and shelf width respectively f is the coriolis parameter and l r is the internal rossby radius of deformation huthnance 1978 for b u 1 ctws approach barotropic shelf waves or topographic rossby waves for b u 1 a sloping sea floor near the coast serves approximately as a side wall and ctws can be approximated by internal kelvin waves this approximation is to be anticipated to hold in regions with strong stratification a narrow shelf or low latitude to illustrate baroclinic effects on storm surges of order 10 cm have been reported for the narrow shelf of southeast coast of africa kodaira et al 2016a based on a two layer model kitade and matsuyama 2000 qualitatively explained the sea level variability observed on timescales of days off the southeast coast of honshu japan using a combination of shelf and internal kelvin waves baroclinicity can also affect surges through changes in bottom friction and the tides through changes in the eddy viscosity profile müller 2012 and the conversion of energy from barotropic to baroclinic tides e g arbic et al 2010 the inclusion of baroclinic effects in an ocean model can lead to a substantial increase in computational cost recently kodaira et al 2016a evaluated a baroclinic model with a reduced vertical resolution 19 z levels model and temperature t and salinity s nudged to a climatological density field the model was able to capture important baroclinic effects on ctws we note however that variations of t and s about the climatological mean state were not considered and the model s configuration 1 12 resolution and 19 z levels is still computationally expensive for ensemble forecasting or making climate projections an alternative approach is to utilize t and s fields generated separately by a large scale data assimilative ocean model for example muis et al 2018 and zhai et al 2019 used the monthly means of ocean reanalysis products to account for low frequency baroclinic contributions to twl variability pringle et al 2019 used a more dynamically consistent approach by adding depth integrated baroclinic pressure gradients calculated from forecast fields of t and s to the right hand side of the barotropic momentum equation approaches such as these pose a challenge for the externally generated t and s fields their resolution in both space and time needs to be sufficiently high in order to resolve baroclinic variability on timescales of weeks and less and spatial variability over narrow shelves and near small scale topographic features such as islands environment and climate change canada eccc has already started to produce medium range ocean forecasts including three dimensional fields of t and s using a global coupled atmosphere ocean model gem nemo smith et al 2018 lin et al 2020 the ocean model has 50 vertical levels and uses the orca025 grid which has a nominal resolution of 1 4 it assimilates observations of sea surface temperature sea level anomaly and vertical profiles of t and s note that operational baroclinic models like gem nemo are usually not suitable for twl forecasting because they do not include tides and their horizontal resolution is too coarse to resolve for example baroclinically modified ctws propagating along narrow shelves the t and s fields are however useful in the present study in constraining low frequency large scale changes in t and s eccc has also recently developed a global twl forecast system wang et al 2021 with a nominal resolution of 1 12 eorca12 the model is barotropic and includes both storm surges and tides the present study outlines and evaluates an approach for including baroclinic effects in the global twl forecast model two overriding questions are addressed 1 what is the most efficient way of adding baroclinicity to the twl forecast model we will explore ways of taking advantage of the t and s forecasts produced by gem nemo and pay particular attention to the choice of vertical levels because their number is an important determinant of the computational cost of the system 2 what is the impact on the skill of the predictions of twl tides and the tidal residuals in addition to using standard metrics like the root mean square difference between observed and predicted hourly records of twl we will also quantify errors in extreme levels the structure of the paper is as follows the observations of coastal twl and tidal currents from the deep ocean used to constrain the model s tides are described in section 2 the ocean model its atmospheric forcing and the t and s forecasts from gem nemo are described in section 3 the optimization of the vertical grid is described in section 4 the impact of adding baroclinicity is quantified in section 5 and the importance of resolving baroclinically modified ctws is illustrated in section 6 the results are summarized and discussed in the final section 2 observations hourly twls observed by a global array of tide gauges between october 2019 and february 2021 inclusive were obtained from the university of hawaii sea level centre caldwell et al 2015 tide gauge stations were excluded if any of the following criteria were met 1 the proportion of missing observation exceeds 90 2 the station is more than 25 km from the nearest ocean model grid point 3 the station is shielded from the open ocean by barrier islands or located far inland on an estuary 4 the station is on an island that is too small to be resolved by the model 5 the statistical properties of the observed hourly record e g variance seasonal cycle datum change abruptly through time applying the five selection criteria resulted in a global distribution of 211 stations fig 1 the uneven global distribution of the 211 stations causes difficulty when attempting to plot the global distribution of point statistics such as root mean square error rmse for this reason we reordered the 211 stations taking into account the tendency of extended coastlines and adjacent shelves to act as coastal wave guides fig 1 shows the numbering of the reordered stations and their grouping into 6 subregions several figures in section 4 and section 5 show point statistics e g rmse as a function of station code grouped by subregion the depth averaged horizontal currents in deep water predicted by the model are tidally nudged kodaira et al 2019 wang et al 2021 and section 3 toward externally generated tidal current fields that are strongly constrained by observations the fields were calculated from the tidal amplitudes and phases of eight tidal constituents m 2 s 2 n 2 k 2 o 1 k 1 p 1 and q 1 generated by the tpxo8 model egbert and erofeeva 2002 the amplitudes and phases were obtained from oregon state university on a global grid with a spacing of 1 30 given the good agreement between tpxo8 tidal predictions and independent observations stammer et al 2014 the tpxo8 predictions will henceforth be treated as observations 3 the ocean model 3 1 governing equations the governing equations of the model are as follows 2 u h t u u h f u h h p a ρ 0 g 1 α s η g η a g z 0 ρ ρ 0 ρ 0 d z a h h 2 u h z a z u h z λ x u o b s u h 3 u 0 4 t t t u k h h 2 t z k z t z r t t f 5 s t s u k h h 2 s z k z s z r s s f subscript h refers to horizontal u h is the horizontal velocity vector u v and u is the full three dimensional velocity vector u v w η is the sea surface height η a is the gravitational tidal potential p a is atmospheric pressure at sea level and ρ 0 is a reference density 1025 kg m 3 the coefficient α s parameterizes self attraction and loading and following stepanov and hughes 2004 is depth dependent the last term on the right side of 2 denotes the nudging of modeled depth averaged horizontal current u h toward the observed current u o b s given by tpxo8 the angle brackets represent temporal filtering of the nudging term to isolate variability in selected tidal frequency bands kodaira et al 2019 wang et al 2021 λ x determines the spatially varying strength of the nudging at horizontal position x and its global distribution is given by wang et al 2021 r in 4 and 5 is a spatially uniform coefficient that controls the strength of the nudging of modeled t and s to operational forecasts t f and s f provided by gem nemo see section 3 3 for more detail constant values of lateral eddy viscosity and diffusivity coefficients a h 100 m2 s 1 and k h 10 m2 s 1 are used over the whole ocean vertical eddy viscosity and diffusivity coefficients a z and k z are computed based on the turbulent kinetic energy tke scheme of gaspar et al 1990 the prognostic equation for the tke e is given by 6 e t a z u z 2 v z 2 k z n 2 z a z e z c ε e 3 2 l ε 7 a z c k l k e k z a z p r t where n is the local buoyancy frequency the dissipation and mixing turbulent length scales take the same value l ε l k 2 e n and they are bounded by the assumption that vertical variations of the length scale cannot be larger than the variations of depth as stated in the user manual of nemo madec 2008 the prandtl number p r t is a function of the local richardson number following blanke and delecluse 1993 the constants c k 0 1 and c ε 2 2 are designed to handle vertical mixing at any depth the surface boundary conditions for 2 are 8 a z u h z z 0 τ s ρ 0 τ s ρ a c d s u 10 u 10 where τ s is the surface stress ρ a is the air density u 10 is wind velocity at 10 m following bernier and thompson 2007 the surface drag coefficient c d s equals 1 2 1 0 3 for wind speeds below 8 m s 1 and increases linearly with u 10 for higher wind speeds with a slope of 0 065 1 0 3 for every 1 m s 1 increase in u 10 the bottom boundary conditions for 2 are 9 a z u h z z h τ b ρ 0 τ b ρ 0 c d b u b u b where τ b is the bottom stress and u b is the bottom current velocity the bottom drag coefficient c d b is set equal to 2 5 1 0 3 in contrast to wang et al 2021 who used a barotropic version of the present model we do not include parameterized internal wave drag the reason is the present model is baroclinic and can explicitly resolve long internal tides via the baroclinic pressure gradient this means internal tides can be generated when barotropic tides push stratified water over topographic features e g baines 1973 sensitivity tests not presented show the inclusion of internal wave drag degraded model skill in some regions e g southeast asia presumably due to double counting we also note that kodaira et al 2016b found removal of internal wave drag from the baroclinic model had minimal effect on model skill in deep water the governing equations are solved numerically using the nemo modeling framework madec 2008 the model grid is the extended version of a tri polar orca grid eorca12 and covers the antarctic ice shelves it has a nominal resolution of 1 12 the bathymetry is derived from gebco 2014 weatherall et al 2015 local improvements were made in hudson bay and on the labrador and newfoundland shelf using bathymetric data kindly provided by f lyard personal communication the choice of vertical grid is discussed in section 4 mode splitting was used with a time step of 240 s for the internal mode and 6 s for the external mode 3 2 atmospheric forcing gridded fields of surface wind and air pressure were obtained from the assimilation component of the global deterministic prediction system gdps buehner et al 2015 developed and run operationally at eccc the gdps is used to produce hourly forecasts on a grid with a spacing of approximately 15 km note the present model is not forced by fluxes of heat and freshwater across the air sea interface or freshwater input from rivers their effect on ocean density is included implicitly by the nudging of temperature and salinity 3 3 temperature and salinity nudging temperature and salinity in governing equations 4 and 5 are weakly nudged to externally generated forecasts of t f and s f using a spatially uniform nudging coefficient r gridded forecasts of t f and s f were obtained from eccc s operational global ensemble prediction system based on gem nemo smith et al 2018 the atmospheric component of this coupled system has a horizontal resolution of approximately 39 km the sea ice component is based on cice with 10 ice thickness categories the ocean component has 50 vertical levels an eddy permitting horizontal resolution of 1 4 and uses a time step of 15 min it is initialized using analyses generated by the system d assimilation mercator version 2 sam2 developed by mercator océan tranchant et al 2008 more details on the coupling and initialization procedures are given by smith et al 2018 note the ocean component does not include the air pressure forcing and thus the inverse barometer effect its impact on t and s and the associated steric height anomaly is expected to be negligible as will be shown later the linear combination of the gem nemo forecast and the inverse barometer effect compares well with observed seasonal cycle of sea level the coupled system is run each week to produce a 32 day forecast we concatenated the first week of each 32 day forecast and thereby generated a continuous time sequence of three dimensional fields of t f and s f the latest version of the coupled system was implemented operationally at eccc in july 2019 three dimensional fields of t f and s f were available starting october 2019 the nudging coefficient was taken to be r 0 2 d 1 to interpret this value we note that for an idealized version of 4 of the form d t d t r t t f the frequency dependent gain of t with respect to t f exceeds 0 5 for periods exceeding t p 0 5 2 π 3 r 18 d priestley 1981 this implies the nudged model will be guided at low frequencies by the three dimensional fields of t f and s f generated by gem nemo which in turn are constrained by observed sea level anomalies sea surface temperature and vertical profiles of t and s sensitivity tests see fig s2 in the supplementary material show that r values that correspond to a t p 0 5 of about 18 days are reasonable choices halving or doubling a t p 0 5 of 18 days reduces overall model performance in the synoptic or subseasonal frequency bands there is a potential mismatch in the spatial scales of variability of t and t f and s and s f resulting from the differing horizontal resolution of the grids used by the present model and gem nemo this implies the nudging may suppress high wavenumber variability in t and s particularly for large values of r and that it may be worthwhile reducing high wavenumber variability in the nudges by spatially smoothing t t f and s s f before feeding them into 4 and 5 this is consistent with the philosophy of spectral nudging outlined by thompson et al 2006 sensitivity runs see appendix a show spatial smoothing is not required for the chosen value of r 3 4 evaluation of model skill power spectra of observed and predicted twl for the same tide gauge station are compared two forms of presentation are used in the standard form spectral density h ω is plotted on the y axis and ω is plotted on the x axis in the variance preserving form e g thomson and emery 2014 ω h ω is plotted on the y axis and log ω is plotted on the x axis for both forms of presentation area under the curve is proportional to twl variance in the selected frequency band the advantage of the variance preserving form is that it stretches the x axis as ω 0 thereby gives a more detailed view of the spectrum for low frequencies in accord with previous studies extensive use is made of root mean square error rmse in assessing model skill for individual tide gauge stations for comparison we also calculate the root mean square rms of the observations from each station to provide a global assessment of model skill we use the three quartiles of the set of 211 rmse values for all tide gauges the second quartile is thus the median of these rmse values and will henceforth be referred to as rmse 50 where the 50 refers to the 50th percentile note the arithmetic means of the observed and modeled records of twl for each tide gauge were removed prior to comparison the above statistics were calculated for twl tides and the tidal residuals tides were reconstructed using the t tide package of pawlowicz et al 2002 using the following tidal constituents m 2 s 2 n 2 k 2 o 1 k 1 p 1 and q 1 these are the eight constituents used to force the model and tidally nudge to the tpxo8 observations in order to resolve all eight constituents the evaluation of tides was only applied to stations with at least 6 months of data tidal residuals were obtained using all tidal constituents for a given record except the annual sa and semi annual ssa tides both of these long period tides are primarily meteorological in origin with only a small contribution several mm from gravitational forcing pugh and woodworth 2014 for this reason we chose to retain sa and ssa in the tidal residuals short period radiational tides e g s 1 and s 2 are unavoidably removed from the residuals by the tidal analysis to quantify model skill in predicting extreme levels we calculated the three largest positive values of an observed hourly record we required the largest values to be separated in time by more than one day in order to focus on individual events each extreme was then compared to the largest prediction made within three hours of the observed extreme this allows for small errors in the timing of the predicted extreme to obtain a single measure of fit from the three discrepancies we calculated the mean absolute error mae which is simply the arithmetic average of the absolute errors willmott and matsuura 2005 mean absolute errors were also calculated for the three largest negative values of each record 4 optimization of the vertical grid the number of vertical levels n z is an important determinant of the computational cost of our twl forecast system global ocean models generally require at least 50 vertical levels to resolve complex vertical dynamics it is possible to relax this requirement for our model because it is nudged toward realistic temperature and salinity fields generated by a more complex data assimilative model with 50 vertical levels section 3 3 however sufficient vertical levels are still required to resolve the main features of the density profile that will determine for example steric changes and the contribution of baroclinically modified ctws section 1 in this section we examine the trade off between model performance and computational cost for five vertical grids with n z 6 9 12 19 and 50 all of the runs described in this section are restricted to the period january to june 2020 the grids are shown in the left panels of fig 2 for each grid most levels are in the upper 300 m where baroclinic variability is expected to dominate maes and o kane 2014 partial steps are used for the bottom layer to more accurately represent the bathymetry for comparison runs were also performed with n z 2 the two dimensional barotropic configuration the right panel of fig 2 shows the run time of a 10 day forecast as a function of n z run time increases by only 10 as n z increases from 2 to 9 but by almost 100 as n z increases from 9 to 50 we note however that the full global operational ocean system with 50 levels is far more expensive and complex as it requires for example sophisticated data assimilation more complex lateral and vertical mixing schemes and coupling to advanced sea ice models all of which require a lot of effort to optimize the right panel of fig 2 also shows rmse 50 for twl tide and tidal residual as a function of n z for the tide rmse 50 decreases by 21 as n z increases from 2 to 6 further decreases by 5 from n z 6 to 19 and then increases slightly by 4 from n z 19 to 50 for both twl and the tidal residuals rmse 50 decreases by 20 and 32 respectively as n z increases from 2 to 9 with much smaller changes for n z 9 fig 3 shows the mae for extreme tidal residuals as a function of station code the two dimensional barotropic run n z 2 has the lowest skill for maxima it has the largest mae at 88 of the 181 stations and 80 of the stations for the minima the inclusion of baroclinicity n z 2 significantly improves model skill with the average of mae across all stations see numbers within parentheses in the legend approximately reduced by a half or a third for maxima or minima for individual stations the mae for n z 9 are very similar based on a trade off of model performance and computational cost we chose the vertical grid with n z 9 levels 5 impact of adding baroclinicity on predictions of sea level the impact of baroclinicity is now quantified by comparing results from the barotropic run 9 bt and baroclinic run 9 bc runs both runs use n z 9 levels and differ only in the way t and s are calculated for run 9 bt t and s are kept constant for run 9 bc t and s are weakly nudged to the daily means provided by gem nemo the study period is constrained by the availability of the gem nemo forecasts and covers the period september 7 2019 to february 28 2021 the first 43 days are discarded to allow for model spin up the model spin up time is determined mainly by the spin up time of the tidal nudging wang et al 2021 5 1 total water level we first compare the power spectra of observed and predicted twl at 11 stations fig 4 all of the stations excluding halifax hong kong and esperance border narrow or narrowing shelves where we anticipate baroclinic effects will be significant section 1 based on visual inspection of these spectra we focus the subsequent discussion on the frequency bands defined in table 1 the addition of baroclinicity improves the agreement between the observed and predicted spectra in the interseasonal and subseasonal frequency bands at all stations these improvements are mainly the result of the nudging of t and s in run 9 bc to the gem nemo forecasts which in turn are constrained by observations improvements are also evident in the low frequency synoptic band for stations in the tropics e g quepos dakar and benoa note that at these frequencies the model is less constrained by the nudging less than 50 section 3 3 the nudging also improves agreement in the high frequency synoptic band at dakar port elizabeth toyama benoa and suva even though the model is not nudged at these frequencies spectra for the high frequency band are shown in standard form in fig 5 sharp peaks centered on periods close to 8 h 6 h and 4 h are evident in the observed spectra these peaks are likely due to overtides resulting from nonlinear effects in shallow waters e g bernoulli setdown and quadratic bottom friction parker 1991 run 9 bt and run 9 bc underestimate or completely miss the observed peaks close to 6 h at many stations e g halifax andenes dakar port elizabeth and hong kong we assume this is due to the inability of the models to resolve the aforementioned nonlinear processes which are known to occur on small spatial scales it is interesting to note that both run 9 bt and run 9 bc are more successful in reproducing the observed peaks around 8 h this can be explained by a terdiurnal oscillation known to exist in surface air pressure ray and poulose 2005 and which is therefore included in the atmospheric forcing applied to both models in addition to sharp peaks some of the observed spectra e g crescent city halifax port elizabeth and esperance indicate more broadly distributed energy at high frequencies that is not evident in the run 9 bt and run 9 bc spectra we speculate this is the result of instrument errors e g sensor or clock malfunctions instability of the vertical datum of the tide gauge and seiches not resolved by the models the similarity of the run 9 bt and run 9 bc spectra shows that baroclinic effects in the high frequency band are insignificant we note however that pringle et al 2019 showed baroclinic coupling improved simulated high frequency 1 2 cycles per hour seiches on narrow island shelves using a very high resolution 30 m in coastal areas regional model investigation in this high frequency range requires high temporal resolution typically less than 15 min for both observations and model output this type of investigation was not possible in the present study which is based on hourly data the horizontal resolution of our global model is also too coarse to simulate such high frequency variability we now quantify the difference in observed and predicted twl using rmse section 3 4 fig 6a shows the quartiles of the rmse values for the 211 stations adding baroclinicity improves predicted twl at 93 of the stations and reduces the three quartiles of rmse values by 18 26 from a practical point of view the most important concerns are coastal flooding and vessel grounding caused by extremely high and low water levels section 1 we now focus on baroclinic effects on extreme water levels the upper left panel of fig 7 is a scatterplot of the observed and predicted annual twl maxima for 186 stations with at most 20 missing observations during the year 2020 the data points for run 9 bc appear slightly more concentrated to the 1 1 line than run 9 bt but it is not easy to see the differences due to the dominant contribution made by the tide at most stations to illustrate this the upper middle panel shows a scatterplot of the corresponding annual tidal maxima all tidal constituents except sa and ssa were included the two scatterplots are very similar confirming most of the variability in the twl maxima can be explained by the tidal contribution to allow for this we have referenced the twl maximum for each yearly record by subtracting the corresponding tidal maximum for the same period the referenced annual maxima are plotted as a function of station code in the middle panel of fig 7 and the scatterplot of referenced maxima is shown in the upper right panel the lower panel further shows the differences in the absolute errors for the referenced maxima between run 9 bt and run 9 bc these plots clearly show the substantial improvement in the prediction of the annual maxima resulting from the addition of baroclinicity the errors are reduced up to 42 cm at 78 of the 186 stations the corresponding results for the annual twl minima fig 8 are similar with reduced errors up to 20 cm occurring at 82 of the stations relatively large improvements greater than 10 cm are found in two subregions southeast asia and japan and indian ocean this is discussed in section 5 3 5 2 tides adding baroclinicity improves the predicted tide constructed using eight major constituents see section 3 4 at 78 of the 211 stations and leads to a modest reduction 13 18 in the quartiles of rmse values across all stations fig 6a rmse values for each station are shown in fig 9 the rms of the observed tide is shown in the bottom panel for reference large improvements 6 20 cm are seen at a few stations in the southeast asia and japan region further analysis of individual tidal constituents at the 211 stations see fig s1 in the supplementary material indicates that most of the improvements in tidal predictions are due to reductions in amplitude errors for m 2 s 2 and k 1 reductions in phase errors are relatively small less than 3 degrees for the semidiurnal tides m 2 and s 2 major reductions in rmse 3 17 cm occur in the vicinity of southeast and east asia and south of alaska for the diurnal tide k 1 major improvements 3 7 cm occur in the vicinity of southeast asia south of alaska and the northern adriatic sea most of these improvements are due to the correction of overestimated tidal amplitudes from run 9 bt sensitivity tests not presented show that adding the internal wave drag parameterization to run 9 bt leads to similar reductions in these regions this leads us to speculate that barotropic baroclinic energy conversion via the baroclinic pressure gradient is responsible for the improvements in run 9 bc tidal predictions this is the reason internal wave drag parameterization was not included in run 9 bc it avoids double counting however we note the importance of internal wave drag in global ocean models has been demonstrated extensively e g arbic et al 2010 shriver et al 2012 2014 ansong et al 2015 in addition to barotropic baroclinic energy conversion arbic et al 2010 and ansong et al 2015 have argued that internal wave drag can be employed to represent unresolved breaking of internal tides the best way to include internal wave drag in our baroclinic model is a complex issue requiring further investigation 5 3 tidal residuals adding baroclinicity improves the predicted residuals at 94 of the 211 stations and reduces the three quartiles of rmse values across all stations by 31 37 fig 6a individual rms and rmse values are plotted in fig 10 the barotropic run shows almost no skill in the tropics e g stations 142 211 bottom panel indicating the residual variability is mostly baroclinic relatively large improvements greater than 0 03 m are seen across the tropics west of north america and along the coasts of norway japan and australia middle and bottom panels we note that even small rmse differences of several centimeters can reflect large but highly intermittent twl differences of decimeters these improvements can be explained in large part by i interannual variability in the pacific associated with enso ii the relatively large annual cycle of steric sea level at most stations iii baroclinically modified ctws over narrow i e small burger number or narrowing shelves and iv the partition of energy of equatorial waves into components associated with ctws and reflected westward propagating baroclinic rossby waves at the coast see section 1 for background further discussion of the improvements in different frequency bands is given below we next examine the fit to the observed seasonal cycle sa and ssa fig 6b indicates the addition of baroclinicity results in reductions by approximately 50 in the three quartiles of rmse the observed and predicted amplitudes and phases of sa are shown in fig 11 as a function of station code note only results for sa are presented as improvements for sa and ssa are similar the results from gem nemo are included for comparison gem nemo does not include the inverse barometer effect and so we added the water level predicted by our barotropic model forced by air pressure alone the barotropic response of sa predicted by run 9 bt blue line in fig 11 is consistent with earlier studies e g fig 2a in ponte 2006 pattullo et al 1955 it has an overall poleward increase as expected with amplitudes exceeding 6 cm in the vicinity of the aleutian low in the north pacific stations 3 7 and in the northern north atlantic stations 66 71 75 79 80 large amplitudes were also found in the bay of bengal stations 101 102 and in the southeast asia and japan region stations 106 107 110 121 these barotropic responses can be explained mostly by the inverse barometer effect caused by the seasonal variation of air pressure this is supported by model results based on pressure forcing alone not presented only a few exceptions are found along the norwegian coast stations 73 76 in the north sea station 79 and in the vicinity of gulf of thailand stations 105 107 where local winds can explain about 50 of the variability the addition of baroclinicity run 9 bc red line in fig 11 leads to more realistic seasonal cycles again reflecting the quality of the gem nemo forecasts of t f and s f to which run 9 bc is nudged the nudging is not perfect run 9 bc shows relatively large discrepancies in sa amplitude in the laborador sea stations 63 65 66 and around the hawaiian islands stations 196 201 compared to gem nemo green line in fig 11 as expected we found this discrepancy can be reduced by increasing the nudging coefficient this indicates stronger nudging is likely required over these two regions to overcome model bias in predicted t and s reasons include i imperfect bathymetry and parameterizations of mixing and ii the lack of ice dynamics in the labrador sea fluxes of heat and freshwater across the air sea interface and river runoff we next examine the effect of adding baroclinicity in the interseasonal with sa and ssa removed subseasonal and synoptic frequency bands fig 6b shows adding baroclinicity improves predictions in all three bands with the three quartiles of rmse reduced by 28 30 23 25 and 13 14 respectively individual rms and rmse values are plotted as a function of station code in fig 12 significant improvements in the interseasonal band occur in the tropics e g indian ocean and pacific islands where baroclinic processes are dominant compare rms and rmse values in fig 12a large improvements are evident in the subseasonal band fig 12b in the eastern indian ocean stations 152 160 where the sea level variability associated with the mjo is known to be significant oliver and thompson 2010 improvements in the synoptic band fig 12c are relatively small in terms of reductions of rmse but we note that the impact on peak water levels can be much larger up to 15 cm see appendix a for an example in addition improvements across all three frequency bands are found along the west coast of north america stations 5 20 and the northwest coast of norway stations 70 75 to explain improvements over the two regions we consider the burger number b u l r l 2 on the west coast of north america the shelf width l is only about 30 km and the internal rossby radius of deformation l r varies from 10 100 km chelton et al 1998 this leads to quite large b u values in low latitudes and moderate b u values in mid latitudes suggesting strong baroclinic effects on ctws another factor that likely contributes further to the improvement is the relatively long critical periods t c 100 days clarke and shi 1991 along the southwest coast of north america south of 23 n associated with the more zonally inclined coastline as a result more incident energy is partitioned into ctws as opposed to westward propagating rossby waves the role of ctws over this region is discussed further in section 6 along the northwest coast of norway b u is much smaller b u 1 as l is about 40 200 km and l r is up to only 10 km however this region features abrupt narrowing shelves which are known to be subject to enhanced transmission of ctws with baroclinicity wilkin and chapman 1990 we now focus on baroclinic effects on extreme tidal residuals the top three panels of fig 13 show the three largest positive values of the observed and predicted tidal residuals for 2020 as a function of station code the addition of baroclinicity reduces the mae section 3 4 of the three largest positive residuals at 89 of the stations the average of the mae values across all stations is reduced by 46 from 13 9 cm to 7 5 cm the largest improvements up to 42 cm are found in the eastern indian ocean stations 152 160 consistent with large reductions in rmse values in the interseasonal and subseasonal bands over this region see fig 12 the improvements along the south coast of sumatra and java stations 155 160 can be explained by both the large burger numbers b u 1 with l of about 10 km and l r of 100 230 km and the long critical periods associated with zonally inclined coastlines both of which favor baroclinic ctws further investigation not presented confirms that large subseasonal ctws driven by eastward propagating equatorial waves are responsible for the substantial improvements at stations 155 160 toward the eastern end of this coastline energetic westward propagating rossby waves are continuously generated resulting in large improvements at the two deep water island stations 153 154 the corresponding results for the three largest negative residuals are shown in fig 14 adding baroclinicity improves the predictions of minima at 86 of the stations and reduces the average of mae values by 43 from 8 6 cm to 4 9 cm 6 the role of coastal trapped waves it is well known that ctws propagating along the west coast of north and south america have hybrid characteristics of shelf and internal kelvin waves and can be forced both locally and remotely including the equator allen and romea 1980 enfield and allen 1980 1983 enfield 1987 spillane et al 1987 in this section we examine the difference in tidal residuals predicted by run 9 bc and run 9 bt henceforth η b c b t for this coastline and physically interpret the difference in terms of locally and remotely forced ctws the contribution of sa and ssa has been removed from η b c b t to simplify the discussion we introduce the alongshore coordinate s defined by fig 15 the same figure also shows a snapshot of η b c b t for march 1 2020 fig 16a shows the variability of η b c b t along the coast as a function of time and distance from the equator changes in η b c b t approach 15 cm poleward propagation is evident on both sides of the equator it is also clear that the propagation speed is not spatially uniform for example there is a pronounced increase in speed moving north of about 35 n s 7200 km based on separate hovmöller diagrams for run 9 bt and run 9 bc not shown we conclude this increase is due to a switch from primarily baroclinic to barotropic ctws consistent with ctw theory allen and romea 1980 the rest of this section examines η b c b t in the interseasonal subseasonal and synoptic frequency bands table 1 interseasonal band fig 16b is dominated by a biennial cycle with an amplitude approaching 10 cm and phase speed of 1 5 3 0 m s 1 the cycle is coherent from 20 s to about 55 n based on an analysis of 25 years of monthly mean sea level enfield and allen 1980 identified sea level signals with periods of 2 to 5 years that propagate poleward from the equator with phase speeds of 0 7 1 2 m s 1 and are coherent over alongshore distances approaching 10 000 km this type of interannual variability is known to be coherent with the southern oscillation index quinn 1974 we speculate that the biennial cycle in fig 16b is related to the biennial component of enso rasmusson et al 1990 north of about 55 n baroclinic variability with a period of about four months and amplitude of 2 4 cm can be seen subseasonal band fig 16c shows ctws modified by baroclinicity propagating poleward from the equator with a phase speed of approximately 2 5 m s 1 this phase speed is consistent with the phase speed of freely propagating ctws associated with the lowest baroclinic mode enfield 1987 north of the equator there is a significant weakening of the poleward propagating signal near the mouth of the gulf of california 23 n s 5200 km previous studies spillane et al 1987 gutiérrez et al 2014 suggest that subseasonal ctws split into two parts at the mouth of the gulf of california one part enters the gulf and dissipates due to bottom friction and the other part appears to jump the mouth and continue to propagate poleward discontinuity in wave propagation is also visible at 16 n s 3200 km and 11 n s 2200 km a plausible explanation is the continuous generation of westward propagating rossby waves around these two latitudes see fig 15 north of 35 n s 7200 km baroclinicity appears to have increased the strength of the barotropic shelf waves synoptic band fig 16d shows the influence of baroclinicity on ctws as they propagate poleward at a speed of approximately 2 5 m s 1 it is interesting to note that some of these waves appear to be forced by yanai mixed rossby gravity waves due to their antisymmetric structure about the equator enfield et al 1987 have shown that equatorial yanai waves are responsible for observed free ctw activity off peru cornejo rodriguez and enfield 1987 further north these waves propagate into the gulf of california where they dissipate consistent with the study of martínez and allen 2004 north of the gulf of california locally forced barotropic shelf waves are only slightly modified by baroclinicity the above interpretation of η b c b t in terms of baroclinically modified ctws has two important implications for the design of models for predicting coastal sea level the grid spacing must be small enough to resolve the shelf and slope and the model domain must be large enough to capture the effect of remotely forced ctws which can propagate thousands of km 7 summary and conclusions the present study outlines and evaluates an approach for adding baroclinicity to a global twl forecast model two overriding questions were addressed 1 what is the most efficient way of including baroclinic effects in the twl forecast model 2 what is its impact on the skill of the model predictions of twl tides and the tidal residuals the approach is based on a baroclinic high resolution 1 12 model with an optimized vertical distribution of ocean layers temperature and salinity for each layer are weakly nudged to forecast fields provided by a coarser resolution 1 4 data assimilative ocean model the weak nudging allowed us to combine the advantages of both models realistic low frequency baroclinic changes from the 1 4 model were implicitly accounted for without need to specify fluxes of heat and freshwater across the air sea interface or river runoff high frequency variability generated by the 1 12 model was not nudged directly but was still modified by the low frequency changes of the background state this approach is suitable for climate projections of twl given three dimensional projections of temperature and salinity the optimization of the model was based on minimizing the number of vertical levels based on a set of sensitivity runs we chose a vertical grid with nine levels the computational cost of running this baroclinic model was only 10 higher than the cost of running the equivalent 2d barotropic model increasing the number of levels from 9 to 50 did not result in a significant increase in model skill the impact of adding baroclinicity was quantified at 211 tide gauges using observed hourly sea level from october 20 2019 to february 28 2021 increase in skill was found across the twl spectrum adding baroclinicity also improved the predictions of high and low water levels for example the errors in predicting annual twl maxima were reduced by up to 42 cm the tidal predictions were also improved most notably in the southeast asia region where we speculate the important physical process is the conversion of barotropic to baroclinic tidal energy the improvements in the predictions of tidal residuals were most noticeable at low frequencies where baroclinicity is known to make important contributions to sea level variability contributions include biennial changes associated with enso the seasonal cycle of steric level and the subseasonal variability associated with baroclinic rossby waves and ctws driven by equatorial waves in the synoptic band the addition of baroclinicity improved predicted peak surges up to 15 cm through its effect on the properties of ctws particularly over narrow shelves where internal kelvin waves are often observed improvements were also seen in the predictions of extreme tidal residuals the important role of baroclinically modified ctws in the subseasonal and synoptic frequency bands was illustrated for the west coast of north and south america ctws with characteristics of internal kelvin waves make contributions of 6 9 cm in low to mid latitudes ctws with characteristics of shelf waves were also modified up to 6 9 cm by baroclinicity the spatial scale of baroclinic effects on ctws can span thousands of kilometers due to the large distances they can propagate in terms of future work we are extending the study period from order one year to 38 years and thus quantify more accurately the effect of adding baroclinicity on twl maxima in different regions we plan to examine the effect of dominant modes of variability of the coupled atmosphere ocean system including enso on the predictability of coastal flooding we are also extending this global system to include sea ice effects by further taking advantage of forecasts provided by the ocean and ice components of gem nemo the goal is to improve forecasts in ice infested waters whilst keeping the computational cost sufficiently low to allow for ensemble forecasts credit authorship contribution statement pengcheng wang conceptualization methodology software validation formal analysis investigation writing original draft writing review editing visualization natacha b bernier conceptualization methodology formal analysis resources writing review editing supervision project administration funding acquisition keith r thompson conceptualization methodology formal analysis resources writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the tide gauge data used for model evaluation in this study are available from the university of hawaii sea level centre website https uhslc soest hawaii edu the authors thank three anonymous reviewers for their constructive comments appendix a impact of spatially smoothing the t and s nudges there is a potential mismatch in the spatial scales of predicted t and t f and s and s f due to the different horizontal resolution of the present model 1 1 2 and gem nemo 1 4 as a result the nudging may suppress the small scale baroclinic features generated by the present model in this appendix we evaluate the benefit of spatially smoothing t t f and s s f at each time step before feeding them into 4 and 5 the smoothing was achieved by spatially diffusing the nudges using the model s diffusion code this new run will henceforth be called run 9 bc sm where the sm subscript refers to spatial smoothing of the nudges for both run 9 bc and run 9 bc sm the nudging coefficient was set to r 0 2 d 1 the top two panels of fig a1 show time series of temperature t and the corresponding nudges t t f at a depth of 149 m near the shelf break close to suva fiji black circle in fig a2 this region has a narrow shelf and is thus more likely to be influenced by baroclinic kelvin waves section 1 the temperature time series top panel features two large events one in late december 2019 and the other in april 2020 two similar events are also evident in the tidal residuals observed by the suva tide gauge and predicted by the two baroclinic runs run 9 bc and run 9 bc sm lower panel note the barotropic model run 9 bt underestimates the residual by almost 15 cm highlighting the importance of allowing for baroclinicity when predicting these two events the close agreement of the temperatures and the tidal residuals predicted by run 9 bc and run 9 bc sm indicates spatial smoothing has a negligible effect during these two high frequency baroclinic events further insight into the effect of spatial smoothing is provided by fig a2 which shows maps of observed and predicted temperature during the first event in late december 2019 the temperature left column and the corresponding nudges middle left column predicted by run 9 bc suggest an internal kelvin wave propagating anti clockwise along the shelf break the corresponding nudges in run 9 bc sm middle right column are strongly smoothed as expected however this does not lead to significant differences in temperature predicted by run 9 bc and run 9 bc sm compare left and right columns suggesting the effect of spatial smoothing of the nudges is small consistent with fig a1 in summary the above results show the impact of spatial smoothing of the nudges is small with r 0 2 d 1 it is important to note this conclusion may not hold for stronger nudging higher r in this case spatial smoothing based on diffusing the nudges each time step may prove useful appendix b supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2022 102031 appendix b supplementary data the following is the supplementary material related to this article mmc s1 two figures related to evaluation of individual tidal constituents and sensitivity tests for nudging coefficients 
23842,an empirical method is developed to predict the counter wind south china sea warm current scswc using wind stress at a specific location that is built on the most dominant empirical orthogonal function eof mode of the sea surface height ssh i e the ekman mode yu et al 2021 based on the most dominant eof modes from a 22 year hybrid coordinate ocean model hycom reanalysis a rectangular box and a specific location are carefully chosen for ssh and wind stress respectively in the rectangular box specific location more than 90 of the ssh wind stress variance is explained by the most dominant eof mode ssh in the rectangular box is predicted from the wind stress at the specific location when the average cross shore pressure gradient force in the rectangular box is negative the scswc exists in the model solution the critical alongshore 38 to the north of east wind stress at the specific location is 0 117 n m2 the scswc occurs in the rectangular box when the wind further relaxes the accuracy of this method varies from 74 9 to 75 3 and the representativeness varies from 84 5 to 85 9 with time lags from 12 to 16 h when applying the method to predict the scswc during the 21 winters in hycom reanalysis keywords south china sea warm current ekman dynamics continental shelf wind stress empirical orthogonal function hycom reanalysis 1 introduction the south china sea scs is the largest marginal sea in southeast asia and its continental shelf is one of the widest in the world ocean guan and fang 2006 as shown in fig 1 the seasonally reversing east asia monsoon wind plays a prominent role in forcing the seasonally varying circulation in the scs wyrtki 1961 shaw and chao 1994 northeasterly winds prevail over the region in winter and thus it was thought that the currents over the continental shelf in the northern scs flow from northeast towards the southwest following the wind wyrtki 1961 the northeastward counter wind south china sea warm current scswc was first discovered in winter by guan and chen 1964 using hydrographic data obtained during the chinese national comprehensive oceanographic survey during 1958 to 1960 hu et al 2000 since then the existence of the scswc has been confirmed by repeated observations guan 1986 guan and fang 2006 and it was commonly described as a narrow and strong northeastward current persisting all winter long su and wang 1987 hu et al 2000 and originating from hainan island li et al 1992 hu et al 2000 guan and fang 2006 yang et al 2008 the scswc has been drawn much attention from the scientific community due to its nonintuitive counter wind property in winter seasons after its first observation 60 years ago the main proposed generation mechanism is kuroshio intrusion into the scs via luzon strait su and wang 1987 zhong 1990 li et al 1993 ye 1994 xue et al 2004 to elevate the sea surface height ssh near the shelf break another proposed generation mechanism is related to the alongshore ssh slope zeng et al 1989 li et al 1992 hsueh and zhong 2004 higher near hainan island and lower at taiwan strait besides the two main proposed mechanisms the following provide different points of view on the formation of the scswc zhai et al 2004 proposed that the anticyclonic wind stress curl in the northernmost scs could generate the scswc in winter the importance of taiwan strait was illustrated through numerical simulations by yang et al 2008 who demonstrated that the scswc vanishes when the taiwan strait is closed wang et al 2010 suggested the joint effect of baroclinicity and relief drives the scswc against the wind in winter from the wide variety of explanations it is fair to say that there still is no agreed upon consensus within the scientific community for the dynamics that controls the scswc chao et al 1995 were the first to suggest wind relaxation as a possible generation mechanism when the alongshore ssh slope exists their hypothesis was supported by chiang et al 2008 the appearance of the scswc in winter is well documented when winds relax but lacked a plausible explanation guan and fang 2006 yu et al 2021 performed an extended empirical orthogonal function eeof analysis of the hourly ssh and wind stress anomalies from a 22 year global hybrid coordinate ocean model hycom data assimilative reanalysis they also suggest that wind relaxation is the primary driving mechanism of the scswc but with an entirely different dynamical explanation than chiang et al 2008 there are two pathways direct and indirect via which the scswc is driven by the wind relaxation the direct pathway in the alongshore direction is that wind stress represents a weaker force when winds relax the indirect pathway is the offshore ekman transport anomaly associated with wind relaxation yu et al 2021 reveal that 1 the wind relaxation reverses the mean offshore pressure gradient force fig 2a solid green arrow to a favorable onshore pressure gradient force fig 2b solid green arrow over the continental shelf via offshore ekman transport anomaly and 2 the sum of the northeastward alongshore pressure gradient force and the southeastward alongshore kinematic wind stress is northeastward fig 2b dashed green arrow due to the dominance of the former over the latter when wind relaxes thus there is a need to have counter wind currents fig 2b dashed gray arrow in winter when the wind relaxes so that the bottom friction opposite to the current direction joins the relaxed northeasterly wind stress to balance the northeastward alongshore pressure gradient force the scswc is positioned between the southwestward guangdong coastal current fig 2b thin black arrow and the southwestward south china sea branch of kuroshio fig 2b heavy black arrow the opposite is true with the mean and strong monsoon wind scenario as currents move southwestward over the whole shelf fig 2a wind relaxation as the generation mechanism of the scswc implies that it cannot be persistent but rather is intermittent this agrees well with fang et al 2015 since they did not observe the persistent counter wind scswc over the continental shelf in the northern scs in 2006 and 2007 yu et al 2021 also conclude that the scswc originates in the area south of taiwan strait due to the dynamics mentioned above contrary to the commonly accepted origination near hainan island the wind relaxation mechanism proposed by yu et al 2021 suggests the two dominant parameters that control the generation of the scswc are ssh and wind stress thus it is possible to predict the appearance of the scswc using these two variables through either the cross shore dynamics threshold when the cross shore pressure gradient force is negative solid green arrow in fig 2b g s s h x 0 where g is gravitational parameter or the alongshore dynamics when the sum of alongshore pressure gradient force and alongshore wind stress is positive dashed green arrow in fig 2b g s s h y τ ρ o h 0 where τ is alongshore wind stress ρ o is a reference density for seawater and h is the water depth the goal of this research is to use the wind stress at a specific location to predict ssh which will lead to the scswc prediction based on either the cross shore or alongshore dynamics threshold in this work we present an empirical method to predict the scswc from wind stress based on the dynamics revealed by yu et al 2021 the method predicts ssh in a rectangular box 0 8 x 0 5 over the northern continental shelf of the scs fig 1 blue box at time t from the alongshore wind stress at t minus lag t lag where lag varies and is defined in section 3 at a specific location 118 e 22 5 n how to choose the rectangular box for ssh and the specific location for wind stress will be introduced in section 3 3 the predicted ssh is then used to calculate the two thresholds mentioned above to predict the existence of the scswc the method is easy to use and has high accuracy to predict the scswc this paper is organized as follows section 2 introduces the numerical model and data sets used for this research section 3 describes the empirical method developed from the ekman dynamics results are shown in section 4 which is followed by the conclusions and discussions in section 5 2 numerical model and data a 22 year global hycom reanalysis from 1994 to 2015 https www hycom org dataserver gofs 3pt1 reanalysis and four winter seasons december 2017 to february 2021 of daily operational global ocean forecast system gofs 3 1 7 5 day forecasts are used in this study the hycom reanalysis is used to calculate the empirical regression coefficient of mode 1 ssh empirical orthogonal function eof against the mode 1 alongshore wind stress eof in the 21 winter seasons in the rectangular box fig 1 both data sets are used to test the accuracy of the prediction method developed in section 3 hycom is the ocean model component for the present operational us navy gofs 3 1 metzger et al 2014 hycom is widely used in the ocean community https www hycom org and a detailed description of its physics is provided by bleck 2002 we briefly describe the model setup below with emphasis on the numerical aspects that are most relevant to this study there are no tides or surface waves in both the hycom reanalysis and operational gofs 3 1 2 1 model grids and output the global hycom horizontal resolution for both the reanalysis and gofs 3 1 is 0 08 1 12 5 that is 9 km at the equator and 8 2 km in the northern scs the grid is uniform cylindrical from 78 64 s 66 s mercator between 66 s 47 n and includes a bipolar patch north of 47 n providing 3 5 km grid spacing at the north pole three coordinates coexist in hycom vertically z coordinates in unstratified water sigma coordinates in shallow depths and isopycnal coordinates in the stratified ocean there are 41 hybrid coordinate layers vertically with potential density referenced to 2000 m the top 14 layers are always sigma z so that water shallower than 84 m is always in fixed coordinates for this study we use wind stress ssh and barotropic velocity output hourly instantaneous wind stress ssh and barotropic velocity fields are interpolated to a uniform 0 08 resolution 2 2 data assimilation both the hycom reanalysis and operational gofs 3 1 use the navy coupled ocean data assimilation ncoda methodology cummings and smedstad 2014 to assimilate remotely sea surface temperature ssh sea ice concentration and in situ observations of temperature and salinity an ncoda analysis relative to the 24 hour model forecast is valid at 12z hycom runs forward each day starting at 09z with the incremental analysis update bloom et al 1996 window between 09z 12z i e starting before the ncoda analysis time at 12z hycom has fully assimilated all the observational data and the nowcast time tau 000 and ncoda analysis time are synchronized the reanalysis then runs in forecast mode only long enough to get to the next cycle point 36 h whereas operational gofs 3 1 runs in forecast mode out to 7 5 days 2 3 surface forcing the wind stress formulation in both the hycom reanalysis and operational gofs 3 1 forecasts includes the ocean surface currents yu et al 2017 the wind stress is calculated at every time step taking into account the ocean surface currents as shown below 1 τ ρ a i r c d v 10 v o v 10 v o where ρ a i r is the air density at sea level c d is the drag coefficient and v 10 is the 10 m wind velocity and v o is the velocity of ocean surface currents at 1 m depth bold fonts in 1 represent vectors v 10 in the hycom reanalysis comes from the 0 3125 hourly national centers for environmental prediction ncep climate forecast system reanalysis cfsr saha et al 2010 before 2011 and the climate forecast system version 2 cfsv2 saha et al 2014 from 2011 to 2015 operational gofs 3 1 uses 3 hourly v 10 from the 0 28125 navy global environmental model navgem hogan et al 2014 hycom interpolates the cfsr cfsv2 and navgem from their native grids to the hycom grid and linearly interpolates the hourly and 3 hourly v 10 at each time step 3 method in this section we develop an empirical method to predict the scswc based on the linear dynamics revealed by yu et al 2021 the authors demonstrated that the most dominant ssh mode in the northern scs continental shelf is an ekman mode through an eeof analysis of the hourly ssh and wind stress data over 21 winter seasons from the hycom reanalysis in the cross shore direction it is mainly governed by geostrophy when alongshore wind stress is less than the alongshore pressure gradient force due to wind relaxation friction generated by the counter wind scswc is required to balance the alongshore pressure gradient force with the alongshore wind stress the empirical method is developed based on the ekman mode the most dominant ssh mode since the ekman mode is not a propagating mode an eof analysis is used instead of an eeof for simplicity because the ssh over the open ocean is mainly driven by wind stress curl the ekman mode is only important over the continental shelf fig 7 yu et al 2021 thus our analysis will only be performed over the shelf with the ssh and wind stress masked out in deep water where the bathymetry is more than 200 m 3 1 empirical orthogonal function of the reanalysis results from december 1994 to february 1995 fig 3 are shown as an example to be consistent with yu et al 2021 and the coordinates are chosen so that the y axis alongshore runs approximately parallel to the coast positive towards the northeast and the positive x axis points offshore the orientation of the y axis is estimated to be 38 to the north of east the most dominant mode indicates that lower ssh anomaly fig 3a is generated by the positive alongshore wind stress anomaly fig 3c which is wind relaxation since the mean wind stress is southwestward yu et al 2021 their principle component time series are highly correlated with a correlation coefficient of 0 94 and significant to the 99 confidence level fig 3b the time lag lag as mentioned first in section 1 associated with this correlation is 14 h with the variation of alongshore wind stress leading the ssh variation in the 1995 winter season december 1994 to february 1995 the most dominant mode explains 85 and 74 of the total variance of the ssh and alongshore wind stress respectively in the 21 winter seasons the total variance explained by the dominant mode varies from 79 to 87 fig 4 solid line for the ssh and 62 to 81 for the alongshore wind stress fig 4 dashed line the most dominant mode explains more ssh variations than alongshore wind stress in each of the 21 winter seasons in each of the 21 winter seasons the principle component time series of the dominant mode for the ssh and alongshore wind stress are correlated significant to the 99 confidence level as in 1995 the highest correlation coefficient varies from 0 83 to 0 94 fig 5a solid line during the 21 winter seasons the time lag lag associated with these highest correlations varies from 12 to 16 hours fig 5b applying these time lags to the corresponding principle component time series of the dominant mode we can calculate the linear regression coefficient lrc between them since they are highly correlated the lrc of the mode 1 ssh principle component time series against the mode 1 alongshore wind stress principle component time series varies from 0 71 to 0 90 fig 5a dashed line during the first 21 winter seasons and is 0 88 in 1995 the intercepts are negligible this suggests that at any time instance t we can estimate the principle component time series of the dominant ssh mode s s h t s 1 t as 2 s s h t s 1 t l r c τ t s 1 t l a g where τ t s 1 is the mode 1 alongshore wind stress principle component time series 3 2 empirical method we can use the eofs to reconstruct the most dominant mode of the ssh and alongshore wind stress anomalies at time instance t and location i j using the ssh and wind stress principle component time series as given in eq 2 as 3 s s h a 1 i j t s s h e o f 1 i j s s h t s 1 t and 4 τ a 1 i j t τ e o f 1 i j τ t s 1 t where s s h a 1 is the ssh anomaly reconstructed from the most dominant ssh mode s s h e o f 1 and τ a 1 is the alongshore wind stress anomaly reconstructed from the mode dominant alongshore wind stress mode τ e o f 1 divide eq 3 by 4 and rearrange to give 5 s s h a 1 i j t s s h e o f 1 i j τ e o f 1 i j s s h t s 1 t τ t s 1 t τ a 1 i j t for wind stress at a specific location i τ j τ and time instance t l a g after substitution of eq 2 eq 5 becomes 6 s s h a 1 i j t s s h e o f 1 i j τ e o f 1 i τ j τ l r c τ a 1 i τ j τ t l a g if we define a regression coefficient of the mode 1 ssh eof anomaly against the mode 1 alongshore wind stress anomaly rc i j as 7 r c i j s s h e o f 1 i j τ e o f 1 i τ j τ l r c then we can predict ssha1 i j t from τ a 1 i τ j τ t l a g once r c i j is given however when we only have a time series of wind stress forecasts we do not have enough information to calculate the mode 1 alongshore wind stress anomaly τ a 1 details on how to solve this problem are given in section 3 5 furthermore for the predicted mode 1 ssh anomaly we do not have other ssh modes to reconstruct a reliable ssh field to solve this we need to define an area where the ssh alongshore wind stress anomaly is dominated by the corresponding mode 1 anomaly and thus we can use alongshore wind stress at a specific location to predict ssh in the chosen area 3 3 how to choose the area for ssh predictions fig 4 demonstrates that the most dominant mode explains more than 79 62 of the total ssh alongshore wind stress variance in all the 21 winter seasons but this does not mean that the local variance explained by the most dominant mode is the same as the total variance explained at some locations the local variance explained by the most dominant mode can be much higher or lower than the total variance explained by the same mode in this section we calculate maps of the local variance explained by the most dominant mode in the area where more than 90 of the local variance is explained by the most dominant mode we assume the anomaly in the area is purely the mode 1 anomaly i e s s h a s s h a 1 to calculate the map of the local variance explained by the most dominant mode we first calculate the most dominant mode homogeneouscorrelation map which is defined as a map of the correlation coefficient between the most dominant mode principal component time series fig 3b of ssh alongshore wind stress and their corresponding original time series at each grid point this is a useful indicator of the spatial localization of the co varying part between the data and its most dominant mode and the square of this variable represents the local variance explained by the most dominant mode the red dashed solid lines in fig 1 represent the contours of the 90 local ssh alongshore wind stress variance explained by the dominant mode during the 21 winter seasons for ssh the ekman mode explains more than 90 of the local variation in most of the areas shallower than 100 m to the south of 23 n for the alongshore wind stress the area is much smaller and mainly located at the northeastern continental shelf to the southwest of taiwan strait fig 1 please note that the maximum local alongshore wind stress variance explained by the most dominant mode in 2005 is 88 9 slightly less than 90 criterion the specific location for wind stress should be located within the common border of all the 90 local variance contours there are 4 grid points that fall within these boundaries and they all give the same less than 0 1 difference results the green x at 118 e 22 5 n is one of the 4 grid points that falls within these boundaries fig 1 thus this location is chosen as i τ j τ where the alongshore wind stress is used to predict the scswc and will be referred to as location x hereafter the sensitivity of the location outside of the common border of all the 90 local variance contours was examined and we found that location x gives the best results for the scswc prediction results get worse when the location is farther away from the common border of all the 90 local variance contours to choose the area for ssh predictions two more conditions have to be satisfied in addition to the threshold of the 90 local variance explained through ekman dynamics yu et al 2021 demonstrate that the scswc originates southwest of taiwan strait their figure 12 and 8b instead of near hainan island thus the area for ssh predictions should not be in the southwestern part of the domain in fig 1 the second condition is that this area needs to be away from the coast since the scswc is positioned between the nearshore southwestward guangdong coastal currents and the southward currents along the shelf break that are related to the wind driven cyclonic gyre in the scs qiu et al 1985 guan 1993 figures 12c and d in yu et al 2021 i e the scs branch of the kuroshio for these reasons we choose a 0 8 x 0 5 rectangular area from 115 0 to 116 3 e and 22 1 to 22 6 n fig 1 blue box hereafter referred to as the rectangular box for ssh predictions and thus the scswc detection 3 4 regression coefficient of the mode 1 ssh eof anomaly against the mode 1 alongshore wind stress anomaly the lrc in eq 7 is a constant for any individual winter season but varies every winter season fig 5a dashed line the ratio s s h e o f 1 i j τ e o f 1 i τ j τ in eq 7 is also a constant at any location i j in the rectangular box in each of the 21 winter seasons and also varies every winter season thus r c i j varies every winter season if the standard deviation of r c i j is much smaller than its 21 year mean we replace r c i j with its mean and make it interannually independent the mean values of r c i j in the 21 winter seasons of the hycom reanalysis in the rectangular box a 6 x 10 matrix are calculated and shown in table 1 they are always negative as ssh decreases over the continental shelf when alongshore winds relax i e positive alongshore wind anomaly table 1 shows that ssh in the rectangular box fig 1 decreases from 0 45 m at the deeper southeast corner to 0 86 m at the shallower northwest corner after the alongshore wind stress relaxes by 1 n m2at location x the standard deviation of r c i j is listed in table 2 as a ratio to the corresponding 21 season mean since the variation is within 8 of the mean r c i j can be considered to have no interannual dependency to the leading order and we replace r c i j in eq 7 with its mean value given in table 1 3 5 scswc prediction in section 3 4 we demonstrate that r c i j is treated as a constant over the 21 winter seasons thus eq 6 simply states that mode 1 ssh anomaly s s h a 1 i j t in the rectangular box fig 1 varies linearly with mode 1 alongshore wind stress anomaly at location x l a g hours earlier τ a 1 i τ j τ t l a g and in section 3 3 the ssh alongshore wind stress variation in the rectangular box at the location x in fig 1 can be treated purely as the mode 1 anomaly but the monthly mean is still needed to calculate the anomaly to predict the scswc from an operational forecast system neither the monthly mean ssh nor the alongshore wind stress are known below we show how to use the r c i j in the rectangular box to predict ssh from the alongshore wind stress at location x for each winter season the ssh or wind stress anomaly is defined as the departure to the monthly mean value are shown below 8a s s h a s s h s s h 8b τ a τ τ where the overbar represents the monthly mean rewriting eq 6 by replacing the mode 1 anomalies with eqs 8a and 8b we obtain 9 s s h i j t s s h i j r c i j τ i τ j τ t l a g τ i τ j τ rearranging eq 9 gives 10 s s h i j t r c i j τ i τ j τ t l a g i n t i j where the intercept i n t i j is defined as 11 i n t i j s s h i j r c i j τ i τ j τ for each month of the 21 winter seasons i n t i j is calculated with its corresponding r c i j monthly mean ssh in the rectangular box and the monthly mean alongshore wind stress at location x the 21 year mean of i n t i j is listed in table 3 and the corresponding standard deviation is listed in table 4 as a ratio to the corresponding mean value the standard deviation is less than 7 of the mean value so i n t i j has no interannual dependency to the leading order either thus eq 10 can be used to predict ssh in the rectangular box from alongshore wind stress at location x using values in tables 1 and 3 4 results eq 10 is applied to both the 21 year hycom reanalysis and the gofs 3 1 7 5 day forecasts to predict ssh in the rectangular box lag varies from 12 to 16 h and both thresholds mentioned in section 1 are calculated the first threshold area average negative cross shore pressure gradient force gives much better results than the second one because the cross shore velocities are smaller than the alongshore velocities the non linear terms in the alongshore direction are bigger than those in the cross shore direction this makes the linear dynamics more robust in cross shore direction than the alongshore direction we speculate this is why the cross shore threshold gives better results than the alongshore threshold in addition the alongshore threshold also requires additional wind stress information in the rectangular box fig 1 thus the negative cross shore pressure gradient force is a much better scswc predictor and the results are limited to this 4 1 critical wind stress at location x from eq 10 we can calculate the critical wind stress at location x the critical wind stress is defined as the wind stress at location x when the area average cross shore pressure gradient force by its induced ssh eq 10 equals to 0 from eq 10 this requires 12 m c s g r c τ i τ j τ t l a g m c s g i n t 0 where mcsg denotes the mean cross shore gradient the critical alongshore wind stress at location x calculated from tables 1 and 3 is 0 117 n m2 while the 21 winter season mean alongshore wind stress at location x is 0 233 n m2 the critical value is 50 2 of the mean wind stress at location x thus the scswc occurs in the rectangular box lag hours later if the wind stress at location x relaxes more than 49 8 of its mean value the scswc can also be predicted to the south of the rectangular area when wind relaxes more than the critical value since the scswc extends southwestwards as in yu et al 2021 and is shown below ssh over the whole continental shelf is predicted with eq 10 using r c and i n t over the whole shelf not shown and are shown in fig 6 for the following cases wind burst fig 6a τ 0 350 n m2 mean wind fig 6b τ 0 233 n m2 critical wind stress fig 6c τ 0 117 n m2 and zero alongshore wind stress fig 6d the wind burst case is defined as the alongshore wind stress at location x that is 50 stronger than the 21 winter season mean ssh from the reanalysis that are 14 h after the alongshore wind stress at location x that correspond to the four cases are shown in figures 7a wind burst 7b mean wind 7c critical wind stress and 7d zero alongshore wind stress fig 6a indicates that the southwestward geostrophic currents associated with the predicted ssh during a wind burst are stronger than those from the mean wind stress fig 6b there are weak negative positive alongshore geostrophic currents in the northwest southeast portion of the rectangular box fig 6c from the predicted ssh using critical wind stress but the area average alongshore geostrophic current is zero in the box when wind further relaxes there are positive alongshore geostrophic currents everywhere in the rectangular box and most of the shelf to the south of the box fig 6d all of these are in good agreement with the reanalysis fig 7 4 2 performance of the method the prediction is compared with the hycom outputs the occurrence of the scswc is defined as a positive mean hycom alongshore barotropic velocity in the rectangular box two criteria define the performance of the method the first shows the accuracy which is defined as the ratio that the prediction is consistent with the occurrence of the scswc the second criterion shows the representativeness defined as how many of the total occurrences of the scswc are represented by the prediction the method accuracy and representativeness are given in table 5 for all predictions using eq 10 or the 0 117 n m2 critical alongshore wind stress at location x with time lags vary from 12 to 16 h when predicting the scswc using the wind stress from the 4 years of gofs 3 1 7 5 day forecasts at the location x the mean accuracy of this method varies from 69 2 to 69 7 table 5 with different lag the mean representativeness varies from 86 2 to 88 0 with different lag when applying the method to predict the scswc for the 21 winters on wind stress data from the hycom reanalysis the mean accuracy varies from 74 9 to 75 3 table 5 during the 21 winter seasons with difference lag which is slightly higher than those from the operational gofs 3 1 forecasts but the mean representativeness is slightly lower and varies from 84 5 to 85 9 with different lag during the 21 winter seasons this difference will be discussed in section 5 1 in both the hycom reanalysis and gofs 3 1 forecasts the time lag lag does not make a big difference to the performance so any of the 5 time lags from 12 to 16 h can be used to predict the scswc depending on the temporal frequency of the wind stress data 5 conclusions and discussions in this study we developed an empirical method to predict the counter wind scswc in the rectangular area using wind stress at location x the method is built on the ekman mode the most dominant eof mode of the ssh over the scs continental shelf the method predicts ssh from the alongshore wind stress at location x when the area average cross shore pressure gradient force in the rectangular area is negative the method predicts the occurrence of the scswc in the rectangular area the critical alongshore wind stress at location x is calculated as 0 117 n m2 applying the method to the hycom reanalysis shows accuracy of 75 3 and representativeness of 85 3 with 14 hour time lag for the 4 years of gofs 3 1 7 5 day forecasts the method shows a 69 7 accuracy and 87 4 representativeness with the same time lag 5 1 why the method has better accuracy and worse representativeness on hycom reanalysis than the gofs 3 1 forecasts one might expect to have better accuracy when applying the method to the hycom reanalysis since the method is derived from it but why does the method shows a lower representativeness on hycom reanalysis than gofs 3 1 forecasts the reason is the different time frame the hycom reanalysis covers 21 winter seasons from 1995 to 2015 while the gofs 3 1 forecasts are for 4 winter seasons from 2018 to 2021 the mean representativeness of each individual winter season from the hycom reanalysis with 14 hour lag actually varies from 68 1 1997 to 97 8 2013 since the gofs 3 1 forecasts are outside the reanalysis time frame it is possible that these 4 winter seasons have higher representativeness the different time frame also affects the calculation of int in eq 10 please note that the r c i j in eq 10 represents the dynamics of the most dominant ssh mode the ekman mode which is independent of the source of the wind forcing over the continental shelf of the scs but int is monthly mean ssh and τ dependent according to eq 11 thus int depends on the source of the wind forcing cfsr hycom reanalysis vs navgem gofs 3 1 reanalysis and time duration the 4 winter season mean alongshore wind stress in gofs 3 1 forecasts at location x is 0 203 n m2 which is 87 of the hycom reanalysis mean the critical alongshore wind stress 0 117 n m2 represents a 42 4 wind relaxation instead of 49 8 as in hycom reanalysis this implies a looser threshold to detect scswc in gofs 3 1 forecasts which means the method captures more scswc events in gofs 3 1 forecasts more representativeness but also more false predictions less accuracy 5 2 positive alongshore wind stress in the rectangular box the positive mean alongshore wind stress represents a special case of the alongshore dynamics it happens when the wind relaxes so much that it actually reverses its direction from southwestward to northeastward in the same direction with the scswc yu et al 2021 have shown that the wind relaxation enhances the positive alongshore pressure gradient force their fig 7b thus the positive alongshore wind stress automatically satisfies the alongshore scswc dynamics threshold so when the mean wind stress in the rectangular box is positive northeastward we predict there is scswc for the 21 winter seasons in reanalysis and the 4 winter seasons in the gofs 3 1 7 5 day forecasts positive mean alongshore wind stress in the rectangular box occurs just about 2 of the time and the accuracy of the predicted scswc occurrence in both products is about 96 so the scswc is almost guaranteed to occur when the mean alongshore wind stress is positive in the rectangular box fig 1 the dynamics behind this is that both alongshore pressure gradient force and wind stress are positive which requires negative friction positive alongshore currents the scswc and coriolis force cross shore outflow to balance the force 5 3 linear regression of ssh on alongshore wind stress the method introduced above is similar to calculating the regression coefficient and intercept of ssh in the rectangular box against the alongshore wind stress at location x but they are slightly different the difference mainly comes from the time lag at each winter season the time lag associated with the maximum correlation coefficient between ssh at each location in the rectangular box and wind stress at location x is space dependent instead of a constant value as in eof analysis these time lags vary from 4 h to 14 h in the rectangular box if we use the space dependent time lag to calculate the regression coefficients and intercepts the scswc prediction accuracy is 3 2 less than the results shown in section 4 1 but the representativeness is almost the same 5 4 sources of prediction error as mentioned above this method is easy to use and performs reasonably well but there are different sources of errors below we discuss where the errors mainly come from we first discuss the dynamics the empirical method is built on the linear dynamics revealed by yu et al 2021 the cross shore dynamics threshold is the negative mean cross shore pressure gradient force in the rectangular box so that the mean alongshore geostrophic current is northeastward this assumes steady state and totally ignores the horizontal advection nonlinearity in reality the cross shore pressure gradient can also be balanced by the time tendency of the alongshore currents and horizontal advection over the 21 winter seasons of the hycom reanalysis 1 1 of the mean positive alongshore barotropic velocity in the rectangular box are associated with positive cross shore pressure gradient force and when the mean cross shore pressure gradient force is negative in the rectangular box 29 7 of the time the mean alongshore barotropic currents in the box are negative by our definition this represents 70 3 of accuracy and 98 9 of representativeness the second source of errors comes from building the method on ekman dynamics which is the leading mode of the ssh eofs there are other dynamical modes that explain up to 10 of the ssh variations in the rectangular box if we reconstruct the ssh field with the leading ssh mode and apply the dynamic threshold to the rectangular box the corresponding accuracy is 76 2 and the representativeness is 88 3 these two numbers represent the ceiling of the empirical method thirdly we ignore the variation of the regression coefficient and intercept based on a less than 10 standard deviation sections 3 4 and 3 5 we use the mean values so that eq 10 can be applied to any given winter season and provide the best overall prediction but doing so also generates error comparing the performance of the method over the hycom reanalysis table 5 with the ceilings of this method last paragraph we lose 1 0 of the accuracy and 4 0 of the representativeness declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors thank the editor and three anonymous reviewers for their input to improve the original manuscript financial support for z yu and e j metzger is provided by the 6 1 south china sea dynamics project sponsored by the office of naval research under program element 0601153n y fan is funded by the 6 2 turbulent mixing in ncom and hycom project sponsored by the office of naval research under program element 062435n computer time was provided by the department of defense dod high performance computing modernization program and the simulations were performed on the cray xc40 conrad at the navy dod supercomputing resources center stennis space center ms the output used in the research are served at https www hycom org this is nrl contribution nrl ja 7320 22 5447 it has been approved for public release and distribution is unlimited 
23842,an empirical method is developed to predict the counter wind south china sea warm current scswc using wind stress at a specific location that is built on the most dominant empirical orthogonal function eof mode of the sea surface height ssh i e the ekman mode yu et al 2021 based on the most dominant eof modes from a 22 year hybrid coordinate ocean model hycom reanalysis a rectangular box and a specific location are carefully chosen for ssh and wind stress respectively in the rectangular box specific location more than 90 of the ssh wind stress variance is explained by the most dominant eof mode ssh in the rectangular box is predicted from the wind stress at the specific location when the average cross shore pressure gradient force in the rectangular box is negative the scswc exists in the model solution the critical alongshore 38 to the north of east wind stress at the specific location is 0 117 n m2 the scswc occurs in the rectangular box when the wind further relaxes the accuracy of this method varies from 74 9 to 75 3 and the representativeness varies from 84 5 to 85 9 with time lags from 12 to 16 h when applying the method to predict the scswc during the 21 winters in hycom reanalysis keywords south china sea warm current ekman dynamics continental shelf wind stress empirical orthogonal function hycom reanalysis 1 introduction the south china sea scs is the largest marginal sea in southeast asia and its continental shelf is one of the widest in the world ocean guan and fang 2006 as shown in fig 1 the seasonally reversing east asia monsoon wind plays a prominent role in forcing the seasonally varying circulation in the scs wyrtki 1961 shaw and chao 1994 northeasterly winds prevail over the region in winter and thus it was thought that the currents over the continental shelf in the northern scs flow from northeast towards the southwest following the wind wyrtki 1961 the northeastward counter wind south china sea warm current scswc was first discovered in winter by guan and chen 1964 using hydrographic data obtained during the chinese national comprehensive oceanographic survey during 1958 to 1960 hu et al 2000 since then the existence of the scswc has been confirmed by repeated observations guan 1986 guan and fang 2006 and it was commonly described as a narrow and strong northeastward current persisting all winter long su and wang 1987 hu et al 2000 and originating from hainan island li et al 1992 hu et al 2000 guan and fang 2006 yang et al 2008 the scswc has been drawn much attention from the scientific community due to its nonintuitive counter wind property in winter seasons after its first observation 60 years ago the main proposed generation mechanism is kuroshio intrusion into the scs via luzon strait su and wang 1987 zhong 1990 li et al 1993 ye 1994 xue et al 2004 to elevate the sea surface height ssh near the shelf break another proposed generation mechanism is related to the alongshore ssh slope zeng et al 1989 li et al 1992 hsueh and zhong 2004 higher near hainan island and lower at taiwan strait besides the two main proposed mechanisms the following provide different points of view on the formation of the scswc zhai et al 2004 proposed that the anticyclonic wind stress curl in the northernmost scs could generate the scswc in winter the importance of taiwan strait was illustrated through numerical simulations by yang et al 2008 who demonstrated that the scswc vanishes when the taiwan strait is closed wang et al 2010 suggested the joint effect of baroclinicity and relief drives the scswc against the wind in winter from the wide variety of explanations it is fair to say that there still is no agreed upon consensus within the scientific community for the dynamics that controls the scswc chao et al 1995 were the first to suggest wind relaxation as a possible generation mechanism when the alongshore ssh slope exists their hypothesis was supported by chiang et al 2008 the appearance of the scswc in winter is well documented when winds relax but lacked a plausible explanation guan and fang 2006 yu et al 2021 performed an extended empirical orthogonal function eeof analysis of the hourly ssh and wind stress anomalies from a 22 year global hybrid coordinate ocean model hycom data assimilative reanalysis they also suggest that wind relaxation is the primary driving mechanism of the scswc but with an entirely different dynamical explanation than chiang et al 2008 there are two pathways direct and indirect via which the scswc is driven by the wind relaxation the direct pathway in the alongshore direction is that wind stress represents a weaker force when winds relax the indirect pathway is the offshore ekman transport anomaly associated with wind relaxation yu et al 2021 reveal that 1 the wind relaxation reverses the mean offshore pressure gradient force fig 2a solid green arrow to a favorable onshore pressure gradient force fig 2b solid green arrow over the continental shelf via offshore ekman transport anomaly and 2 the sum of the northeastward alongshore pressure gradient force and the southeastward alongshore kinematic wind stress is northeastward fig 2b dashed green arrow due to the dominance of the former over the latter when wind relaxes thus there is a need to have counter wind currents fig 2b dashed gray arrow in winter when the wind relaxes so that the bottom friction opposite to the current direction joins the relaxed northeasterly wind stress to balance the northeastward alongshore pressure gradient force the scswc is positioned between the southwestward guangdong coastal current fig 2b thin black arrow and the southwestward south china sea branch of kuroshio fig 2b heavy black arrow the opposite is true with the mean and strong monsoon wind scenario as currents move southwestward over the whole shelf fig 2a wind relaxation as the generation mechanism of the scswc implies that it cannot be persistent but rather is intermittent this agrees well with fang et al 2015 since they did not observe the persistent counter wind scswc over the continental shelf in the northern scs in 2006 and 2007 yu et al 2021 also conclude that the scswc originates in the area south of taiwan strait due to the dynamics mentioned above contrary to the commonly accepted origination near hainan island the wind relaxation mechanism proposed by yu et al 2021 suggests the two dominant parameters that control the generation of the scswc are ssh and wind stress thus it is possible to predict the appearance of the scswc using these two variables through either the cross shore dynamics threshold when the cross shore pressure gradient force is negative solid green arrow in fig 2b g s s h x 0 where g is gravitational parameter or the alongshore dynamics when the sum of alongshore pressure gradient force and alongshore wind stress is positive dashed green arrow in fig 2b g s s h y τ ρ o h 0 where τ is alongshore wind stress ρ o is a reference density for seawater and h is the water depth the goal of this research is to use the wind stress at a specific location to predict ssh which will lead to the scswc prediction based on either the cross shore or alongshore dynamics threshold in this work we present an empirical method to predict the scswc from wind stress based on the dynamics revealed by yu et al 2021 the method predicts ssh in a rectangular box 0 8 x 0 5 over the northern continental shelf of the scs fig 1 blue box at time t from the alongshore wind stress at t minus lag t lag where lag varies and is defined in section 3 at a specific location 118 e 22 5 n how to choose the rectangular box for ssh and the specific location for wind stress will be introduced in section 3 3 the predicted ssh is then used to calculate the two thresholds mentioned above to predict the existence of the scswc the method is easy to use and has high accuracy to predict the scswc this paper is organized as follows section 2 introduces the numerical model and data sets used for this research section 3 describes the empirical method developed from the ekman dynamics results are shown in section 4 which is followed by the conclusions and discussions in section 5 2 numerical model and data a 22 year global hycom reanalysis from 1994 to 2015 https www hycom org dataserver gofs 3pt1 reanalysis and four winter seasons december 2017 to february 2021 of daily operational global ocean forecast system gofs 3 1 7 5 day forecasts are used in this study the hycom reanalysis is used to calculate the empirical regression coefficient of mode 1 ssh empirical orthogonal function eof against the mode 1 alongshore wind stress eof in the 21 winter seasons in the rectangular box fig 1 both data sets are used to test the accuracy of the prediction method developed in section 3 hycom is the ocean model component for the present operational us navy gofs 3 1 metzger et al 2014 hycom is widely used in the ocean community https www hycom org and a detailed description of its physics is provided by bleck 2002 we briefly describe the model setup below with emphasis on the numerical aspects that are most relevant to this study there are no tides or surface waves in both the hycom reanalysis and operational gofs 3 1 2 1 model grids and output the global hycom horizontal resolution for both the reanalysis and gofs 3 1 is 0 08 1 12 5 that is 9 km at the equator and 8 2 km in the northern scs the grid is uniform cylindrical from 78 64 s 66 s mercator between 66 s 47 n and includes a bipolar patch north of 47 n providing 3 5 km grid spacing at the north pole three coordinates coexist in hycom vertically z coordinates in unstratified water sigma coordinates in shallow depths and isopycnal coordinates in the stratified ocean there are 41 hybrid coordinate layers vertically with potential density referenced to 2000 m the top 14 layers are always sigma z so that water shallower than 84 m is always in fixed coordinates for this study we use wind stress ssh and barotropic velocity output hourly instantaneous wind stress ssh and barotropic velocity fields are interpolated to a uniform 0 08 resolution 2 2 data assimilation both the hycom reanalysis and operational gofs 3 1 use the navy coupled ocean data assimilation ncoda methodology cummings and smedstad 2014 to assimilate remotely sea surface temperature ssh sea ice concentration and in situ observations of temperature and salinity an ncoda analysis relative to the 24 hour model forecast is valid at 12z hycom runs forward each day starting at 09z with the incremental analysis update bloom et al 1996 window between 09z 12z i e starting before the ncoda analysis time at 12z hycom has fully assimilated all the observational data and the nowcast time tau 000 and ncoda analysis time are synchronized the reanalysis then runs in forecast mode only long enough to get to the next cycle point 36 h whereas operational gofs 3 1 runs in forecast mode out to 7 5 days 2 3 surface forcing the wind stress formulation in both the hycom reanalysis and operational gofs 3 1 forecasts includes the ocean surface currents yu et al 2017 the wind stress is calculated at every time step taking into account the ocean surface currents as shown below 1 τ ρ a i r c d v 10 v o v 10 v o where ρ a i r is the air density at sea level c d is the drag coefficient and v 10 is the 10 m wind velocity and v o is the velocity of ocean surface currents at 1 m depth bold fonts in 1 represent vectors v 10 in the hycom reanalysis comes from the 0 3125 hourly national centers for environmental prediction ncep climate forecast system reanalysis cfsr saha et al 2010 before 2011 and the climate forecast system version 2 cfsv2 saha et al 2014 from 2011 to 2015 operational gofs 3 1 uses 3 hourly v 10 from the 0 28125 navy global environmental model navgem hogan et al 2014 hycom interpolates the cfsr cfsv2 and navgem from their native grids to the hycom grid and linearly interpolates the hourly and 3 hourly v 10 at each time step 3 method in this section we develop an empirical method to predict the scswc based on the linear dynamics revealed by yu et al 2021 the authors demonstrated that the most dominant ssh mode in the northern scs continental shelf is an ekman mode through an eeof analysis of the hourly ssh and wind stress data over 21 winter seasons from the hycom reanalysis in the cross shore direction it is mainly governed by geostrophy when alongshore wind stress is less than the alongshore pressure gradient force due to wind relaxation friction generated by the counter wind scswc is required to balance the alongshore pressure gradient force with the alongshore wind stress the empirical method is developed based on the ekman mode the most dominant ssh mode since the ekman mode is not a propagating mode an eof analysis is used instead of an eeof for simplicity because the ssh over the open ocean is mainly driven by wind stress curl the ekman mode is only important over the continental shelf fig 7 yu et al 2021 thus our analysis will only be performed over the shelf with the ssh and wind stress masked out in deep water where the bathymetry is more than 200 m 3 1 empirical orthogonal function of the reanalysis results from december 1994 to february 1995 fig 3 are shown as an example to be consistent with yu et al 2021 and the coordinates are chosen so that the y axis alongshore runs approximately parallel to the coast positive towards the northeast and the positive x axis points offshore the orientation of the y axis is estimated to be 38 to the north of east the most dominant mode indicates that lower ssh anomaly fig 3a is generated by the positive alongshore wind stress anomaly fig 3c which is wind relaxation since the mean wind stress is southwestward yu et al 2021 their principle component time series are highly correlated with a correlation coefficient of 0 94 and significant to the 99 confidence level fig 3b the time lag lag as mentioned first in section 1 associated with this correlation is 14 h with the variation of alongshore wind stress leading the ssh variation in the 1995 winter season december 1994 to february 1995 the most dominant mode explains 85 and 74 of the total variance of the ssh and alongshore wind stress respectively in the 21 winter seasons the total variance explained by the dominant mode varies from 79 to 87 fig 4 solid line for the ssh and 62 to 81 for the alongshore wind stress fig 4 dashed line the most dominant mode explains more ssh variations than alongshore wind stress in each of the 21 winter seasons in each of the 21 winter seasons the principle component time series of the dominant mode for the ssh and alongshore wind stress are correlated significant to the 99 confidence level as in 1995 the highest correlation coefficient varies from 0 83 to 0 94 fig 5a solid line during the 21 winter seasons the time lag lag associated with these highest correlations varies from 12 to 16 hours fig 5b applying these time lags to the corresponding principle component time series of the dominant mode we can calculate the linear regression coefficient lrc between them since they are highly correlated the lrc of the mode 1 ssh principle component time series against the mode 1 alongshore wind stress principle component time series varies from 0 71 to 0 90 fig 5a dashed line during the first 21 winter seasons and is 0 88 in 1995 the intercepts are negligible this suggests that at any time instance t we can estimate the principle component time series of the dominant ssh mode s s h t s 1 t as 2 s s h t s 1 t l r c τ t s 1 t l a g where τ t s 1 is the mode 1 alongshore wind stress principle component time series 3 2 empirical method we can use the eofs to reconstruct the most dominant mode of the ssh and alongshore wind stress anomalies at time instance t and location i j using the ssh and wind stress principle component time series as given in eq 2 as 3 s s h a 1 i j t s s h e o f 1 i j s s h t s 1 t and 4 τ a 1 i j t τ e o f 1 i j τ t s 1 t where s s h a 1 is the ssh anomaly reconstructed from the most dominant ssh mode s s h e o f 1 and τ a 1 is the alongshore wind stress anomaly reconstructed from the mode dominant alongshore wind stress mode τ e o f 1 divide eq 3 by 4 and rearrange to give 5 s s h a 1 i j t s s h e o f 1 i j τ e o f 1 i j s s h t s 1 t τ t s 1 t τ a 1 i j t for wind stress at a specific location i τ j τ and time instance t l a g after substitution of eq 2 eq 5 becomes 6 s s h a 1 i j t s s h e o f 1 i j τ e o f 1 i τ j τ l r c τ a 1 i τ j τ t l a g if we define a regression coefficient of the mode 1 ssh eof anomaly against the mode 1 alongshore wind stress anomaly rc i j as 7 r c i j s s h e o f 1 i j τ e o f 1 i τ j τ l r c then we can predict ssha1 i j t from τ a 1 i τ j τ t l a g once r c i j is given however when we only have a time series of wind stress forecasts we do not have enough information to calculate the mode 1 alongshore wind stress anomaly τ a 1 details on how to solve this problem are given in section 3 5 furthermore for the predicted mode 1 ssh anomaly we do not have other ssh modes to reconstruct a reliable ssh field to solve this we need to define an area where the ssh alongshore wind stress anomaly is dominated by the corresponding mode 1 anomaly and thus we can use alongshore wind stress at a specific location to predict ssh in the chosen area 3 3 how to choose the area for ssh predictions fig 4 demonstrates that the most dominant mode explains more than 79 62 of the total ssh alongshore wind stress variance in all the 21 winter seasons but this does not mean that the local variance explained by the most dominant mode is the same as the total variance explained at some locations the local variance explained by the most dominant mode can be much higher or lower than the total variance explained by the same mode in this section we calculate maps of the local variance explained by the most dominant mode in the area where more than 90 of the local variance is explained by the most dominant mode we assume the anomaly in the area is purely the mode 1 anomaly i e s s h a s s h a 1 to calculate the map of the local variance explained by the most dominant mode we first calculate the most dominant mode homogeneouscorrelation map which is defined as a map of the correlation coefficient between the most dominant mode principal component time series fig 3b of ssh alongshore wind stress and their corresponding original time series at each grid point this is a useful indicator of the spatial localization of the co varying part between the data and its most dominant mode and the square of this variable represents the local variance explained by the most dominant mode the red dashed solid lines in fig 1 represent the contours of the 90 local ssh alongshore wind stress variance explained by the dominant mode during the 21 winter seasons for ssh the ekman mode explains more than 90 of the local variation in most of the areas shallower than 100 m to the south of 23 n for the alongshore wind stress the area is much smaller and mainly located at the northeastern continental shelf to the southwest of taiwan strait fig 1 please note that the maximum local alongshore wind stress variance explained by the most dominant mode in 2005 is 88 9 slightly less than 90 criterion the specific location for wind stress should be located within the common border of all the 90 local variance contours there are 4 grid points that fall within these boundaries and they all give the same less than 0 1 difference results the green x at 118 e 22 5 n is one of the 4 grid points that falls within these boundaries fig 1 thus this location is chosen as i τ j τ where the alongshore wind stress is used to predict the scswc and will be referred to as location x hereafter the sensitivity of the location outside of the common border of all the 90 local variance contours was examined and we found that location x gives the best results for the scswc prediction results get worse when the location is farther away from the common border of all the 90 local variance contours to choose the area for ssh predictions two more conditions have to be satisfied in addition to the threshold of the 90 local variance explained through ekman dynamics yu et al 2021 demonstrate that the scswc originates southwest of taiwan strait their figure 12 and 8b instead of near hainan island thus the area for ssh predictions should not be in the southwestern part of the domain in fig 1 the second condition is that this area needs to be away from the coast since the scswc is positioned between the nearshore southwestward guangdong coastal currents and the southward currents along the shelf break that are related to the wind driven cyclonic gyre in the scs qiu et al 1985 guan 1993 figures 12c and d in yu et al 2021 i e the scs branch of the kuroshio for these reasons we choose a 0 8 x 0 5 rectangular area from 115 0 to 116 3 e and 22 1 to 22 6 n fig 1 blue box hereafter referred to as the rectangular box for ssh predictions and thus the scswc detection 3 4 regression coefficient of the mode 1 ssh eof anomaly against the mode 1 alongshore wind stress anomaly the lrc in eq 7 is a constant for any individual winter season but varies every winter season fig 5a dashed line the ratio s s h e o f 1 i j τ e o f 1 i τ j τ in eq 7 is also a constant at any location i j in the rectangular box in each of the 21 winter seasons and also varies every winter season thus r c i j varies every winter season if the standard deviation of r c i j is much smaller than its 21 year mean we replace r c i j with its mean and make it interannually independent the mean values of r c i j in the 21 winter seasons of the hycom reanalysis in the rectangular box a 6 x 10 matrix are calculated and shown in table 1 they are always negative as ssh decreases over the continental shelf when alongshore winds relax i e positive alongshore wind anomaly table 1 shows that ssh in the rectangular box fig 1 decreases from 0 45 m at the deeper southeast corner to 0 86 m at the shallower northwest corner after the alongshore wind stress relaxes by 1 n m2at location x the standard deviation of r c i j is listed in table 2 as a ratio to the corresponding 21 season mean since the variation is within 8 of the mean r c i j can be considered to have no interannual dependency to the leading order and we replace r c i j in eq 7 with its mean value given in table 1 3 5 scswc prediction in section 3 4 we demonstrate that r c i j is treated as a constant over the 21 winter seasons thus eq 6 simply states that mode 1 ssh anomaly s s h a 1 i j t in the rectangular box fig 1 varies linearly with mode 1 alongshore wind stress anomaly at location x l a g hours earlier τ a 1 i τ j τ t l a g and in section 3 3 the ssh alongshore wind stress variation in the rectangular box at the location x in fig 1 can be treated purely as the mode 1 anomaly but the monthly mean is still needed to calculate the anomaly to predict the scswc from an operational forecast system neither the monthly mean ssh nor the alongshore wind stress are known below we show how to use the r c i j in the rectangular box to predict ssh from the alongshore wind stress at location x for each winter season the ssh or wind stress anomaly is defined as the departure to the monthly mean value are shown below 8a s s h a s s h s s h 8b τ a τ τ where the overbar represents the monthly mean rewriting eq 6 by replacing the mode 1 anomalies with eqs 8a and 8b we obtain 9 s s h i j t s s h i j r c i j τ i τ j τ t l a g τ i τ j τ rearranging eq 9 gives 10 s s h i j t r c i j τ i τ j τ t l a g i n t i j where the intercept i n t i j is defined as 11 i n t i j s s h i j r c i j τ i τ j τ for each month of the 21 winter seasons i n t i j is calculated with its corresponding r c i j monthly mean ssh in the rectangular box and the monthly mean alongshore wind stress at location x the 21 year mean of i n t i j is listed in table 3 and the corresponding standard deviation is listed in table 4 as a ratio to the corresponding mean value the standard deviation is less than 7 of the mean value so i n t i j has no interannual dependency to the leading order either thus eq 10 can be used to predict ssh in the rectangular box from alongshore wind stress at location x using values in tables 1 and 3 4 results eq 10 is applied to both the 21 year hycom reanalysis and the gofs 3 1 7 5 day forecasts to predict ssh in the rectangular box lag varies from 12 to 16 h and both thresholds mentioned in section 1 are calculated the first threshold area average negative cross shore pressure gradient force gives much better results than the second one because the cross shore velocities are smaller than the alongshore velocities the non linear terms in the alongshore direction are bigger than those in the cross shore direction this makes the linear dynamics more robust in cross shore direction than the alongshore direction we speculate this is why the cross shore threshold gives better results than the alongshore threshold in addition the alongshore threshold also requires additional wind stress information in the rectangular box fig 1 thus the negative cross shore pressure gradient force is a much better scswc predictor and the results are limited to this 4 1 critical wind stress at location x from eq 10 we can calculate the critical wind stress at location x the critical wind stress is defined as the wind stress at location x when the area average cross shore pressure gradient force by its induced ssh eq 10 equals to 0 from eq 10 this requires 12 m c s g r c τ i τ j τ t l a g m c s g i n t 0 where mcsg denotes the mean cross shore gradient the critical alongshore wind stress at location x calculated from tables 1 and 3 is 0 117 n m2 while the 21 winter season mean alongshore wind stress at location x is 0 233 n m2 the critical value is 50 2 of the mean wind stress at location x thus the scswc occurs in the rectangular box lag hours later if the wind stress at location x relaxes more than 49 8 of its mean value the scswc can also be predicted to the south of the rectangular area when wind relaxes more than the critical value since the scswc extends southwestwards as in yu et al 2021 and is shown below ssh over the whole continental shelf is predicted with eq 10 using r c and i n t over the whole shelf not shown and are shown in fig 6 for the following cases wind burst fig 6a τ 0 350 n m2 mean wind fig 6b τ 0 233 n m2 critical wind stress fig 6c τ 0 117 n m2 and zero alongshore wind stress fig 6d the wind burst case is defined as the alongshore wind stress at location x that is 50 stronger than the 21 winter season mean ssh from the reanalysis that are 14 h after the alongshore wind stress at location x that correspond to the four cases are shown in figures 7a wind burst 7b mean wind 7c critical wind stress and 7d zero alongshore wind stress fig 6a indicates that the southwestward geostrophic currents associated with the predicted ssh during a wind burst are stronger than those from the mean wind stress fig 6b there are weak negative positive alongshore geostrophic currents in the northwest southeast portion of the rectangular box fig 6c from the predicted ssh using critical wind stress but the area average alongshore geostrophic current is zero in the box when wind further relaxes there are positive alongshore geostrophic currents everywhere in the rectangular box and most of the shelf to the south of the box fig 6d all of these are in good agreement with the reanalysis fig 7 4 2 performance of the method the prediction is compared with the hycom outputs the occurrence of the scswc is defined as a positive mean hycom alongshore barotropic velocity in the rectangular box two criteria define the performance of the method the first shows the accuracy which is defined as the ratio that the prediction is consistent with the occurrence of the scswc the second criterion shows the representativeness defined as how many of the total occurrences of the scswc are represented by the prediction the method accuracy and representativeness are given in table 5 for all predictions using eq 10 or the 0 117 n m2 critical alongshore wind stress at location x with time lags vary from 12 to 16 h when predicting the scswc using the wind stress from the 4 years of gofs 3 1 7 5 day forecasts at the location x the mean accuracy of this method varies from 69 2 to 69 7 table 5 with different lag the mean representativeness varies from 86 2 to 88 0 with different lag when applying the method to predict the scswc for the 21 winters on wind stress data from the hycom reanalysis the mean accuracy varies from 74 9 to 75 3 table 5 during the 21 winter seasons with difference lag which is slightly higher than those from the operational gofs 3 1 forecasts but the mean representativeness is slightly lower and varies from 84 5 to 85 9 with different lag during the 21 winter seasons this difference will be discussed in section 5 1 in both the hycom reanalysis and gofs 3 1 forecasts the time lag lag does not make a big difference to the performance so any of the 5 time lags from 12 to 16 h can be used to predict the scswc depending on the temporal frequency of the wind stress data 5 conclusions and discussions in this study we developed an empirical method to predict the counter wind scswc in the rectangular area using wind stress at location x the method is built on the ekman mode the most dominant eof mode of the ssh over the scs continental shelf the method predicts ssh from the alongshore wind stress at location x when the area average cross shore pressure gradient force in the rectangular area is negative the method predicts the occurrence of the scswc in the rectangular area the critical alongshore wind stress at location x is calculated as 0 117 n m2 applying the method to the hycom reanalysis shows accuracy of 75 3 and representativeness of 85 3 with 14 hour time lag for the 4 years of gofs 3 1 7 5 day forecasts the method shows a 69 7 accuracy and 87 4 representativeness with the same time lag 5 1 why the method has better accuracy and worse representativeness on hycom reanalysis than the gofs 3 1 forecasts one might expect to have better accuracy when applying the method to the hycom reanalysis since the method is derived from it but why does the method shows a lower representativeness on hycom reanalysis than gofs 3 1 forecasts the reason is the different time frame the hycom reanalysis covers 21 winter seasons from 1995 to 2015 while the gofs 3 1 forecasts are for 4 winter seasons from 2018 to 2021 the mean representativeness of each individual winter season from the hycom reanalysis with 14 hour lag actually varies from 68 1 1997 to 97 8 2013 since the gofs 3 1 forecasts are outside the reanalysis time frame it is possible that these 4 winter seasons have higher representativeness the different time frame also affects the calculation of int in eq 10 please note that the r c i j in eq 10 represents the dynamics of the most dominant ssh mode the ekman mode which is independent of the source of the wind forcing over the continental shelf of the scs but int is monthly mean ssh and τ dependent according to eq 11 thus int depends on the source of the wind forcing cfsr hycom reanalysis vs navgem gofs 3 1 reanalysis and time duration the 4 winter season mean alongshore wind stress in gofs 3 1 forecasts at location x is 0 203 n m2 which is 87 of the hycom reanalysis mean the critical alongshore wind stress 0 117 n m2 represents a 42 4 wind relaxation instead of 49 8 as in hycom reanalysis this implies a looser threshold to detect scswc in gofs 3 1 forecasts which means the method captures more scswc events in gofs 3 1 forecasts more representativeness but also more false predictions less accuracy 5 2 positive alongshore wind stress in the rectangular box the positive mean alongshore wind stress represents a special case of the alongshore dynamics it happens when the wind relaxes so much that it actually reverses its direction from southwestward to northeastward in the same direction with the scswc yu et al 2021 have shown that the wind relaxation enhances the positive alongshore pressure gradient force their fig 7b thus the positive alongshore wind stress automatically satisfies the alongshore scswc dynamics threshold so when the mean wind stress in the rectangular box is positive northeastward we predict there is scswc for the 21 winter seasons in reanalysis and the 4 winter seasons in the gofs 3 1 7 5 day forecasts positive mean alongshore wind stress in the rectangular box occurs just about 2 of the time and the accuracy of the predicted scswc occurrence in both products is about 96 so the scswc is almost guaranteed to occur when the mean alongshore wind stress is positive in the rectangular box fig 1 the dynamics behind this is that both alongshore pressure gradient force and wind stress are positive which requires negative friction positive alongshore currents the scswc and coriolis force cross shore outflow to balance the force 5 3 linear regression of ssh on alongshore wind stress the method introduced above is similar to calculating the regression coefficient and intercept of ssh in the rectangular box against the alongshore wind stress at location x but they are slightly different the difference mainly comes from the time lag at each winter season the time lag associated with the maximum correlation coefficient between ssh at each location in the rectangular box and wind stress at location x is space dependent instead of a constant value as in eof analysis these time lags vary from 4 h to 14 h in the rectangular box if we use the space dependent time lag to calculate the regression coefficients and intercepts the scswc prediction accuracy is 3 2 less than the results shown in section 4 1 but the representativeness is almost the same 5 4 sources of prediction error as mentioned above this method is easy to use and performs reasonably well but there are different sources of errors below we discuss where the errors mainly come from we first discuss the dynamics the empirical method is built on the linear dynamics revealed by yu et al 2021 the cross shore dynamics threshold is the negative mean cross shore pressure gradient force in the rectangular box so that the mean alongshore geostrophic current is northeastward this assumes steady state and totally ignores the horizontal advection nonlinearity in reality the cross shore pressure gradient can also be balanced by the time tendency of the alongshore currents and horizontal advection over the 21 winter seasons of the hycom reanalysis 1 1 of the mean positive alongshore barotropic velocity in the rectangular box are associated with positive cross shore pressure gradient force and when the mean cross shore pressure gradient force is negative in the rectangular box 29 7 of the time the mean alongshore barotropic currents in the box are negative by our definition this represents 70 3 of accuracy and 98 9 of representativeness the second source of errors comes from building the method on ekman dynamics which is the leading mode of the ssh eofs there are other dynamical modes that explain up to 10 of the ssh variations in the rectangular box if we reconstruct the ssh field with the leading ssh mode and apply the dynamic threshold to the rectangular box the corresponding accuracy is 76 2 and the representativeness is 88 3 these two numbers represent the ceiling of the empirical method thirdly we ignore the variation of the regression coefficient and intercept based on a less than 10 standard deviation sections 3 4 and 3 5 we use the mean values so that eq 10 can be applied to any given winter season and provide the best overall prediction but doing so also generates error comparing the performance of the method over the hycom reanalysis table 5 with the ceilings of this method last paragraph we lose 1 0 of the accuracy and 4 0 of the representativeness declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors thank the editor and three anonymous reviewers for their input to improve the original manuscript financial support for z yu and e j metzger is provided by the 6 1 south china sea dynamics project sponsored by the office of naval research under program element 0601153n y fan is funded by the 6 2 turbulent mixing in ncom and hycom project sponsored by the office of naval research under program element 062435n computer time was provided by the department of defense dod high performance computing modernization program and the simulations were performed on the cray xc40 conrad at the navy dod supercomputing resources center stennis space center ms the output used in the research are served at https www hycom org this is nrl contribution nrl ja 7320 22 5447 it has been approved for public release and distribution is unlimited 
23843,a downscaled reanalysis for the california current system is used to construct a low dimensional linear stochastic emulator of the 3 dimensional time evolving ocean circulation the approach used is based on balanced truncation which simultaneously draws on information from the empirical orthogonal functions eofs and stochastic optimals of the ocean state vector in this way balanced truncation faithfully preserves the inherent stability properties of the data unlike the more traditional approaches based on truncation using eofs alone since balanced truncation is predicated on singular value decomposition formal error bounds on the accuracy of the reduced dimension system can be computed in addition linear stochastic emulators that target different physical processes can also be constructed and examples that focus on a region dominated by coastal upwelling are presented linear stochastic emulators such as that developed here can be exploited to generate very long simulations or large ensembles at high resolution that can be used to establish a statistical baseline for important oceanic processes calculations that would otherwise be very challenging by direct numerical integration an example is presented keywords nonnormality balanced truncation california current system 1 introduction linear inverse modeling of time series data has become very popular during the last two decades or so in the atmosphere ocean and climate sciences due mainly to the influential works of hasselmann 1988 penland and sardeshmukh 1995 and von storch et al 1995 a goal of linear inverse modeling is to identify a low order empirically derived approximation for the dynamical operator that describes the time evolution of time series data specifically capturing the slow timescales while representing the fast timescales as noise while linear inverse models lims have been most widely used in conjunction with observed time series they also provide a useful and compact description of time series from complex numerical models lims are also efficient forecasting tools and have been employed in this capacity on timescales ranging from seasonal to decadal e g winkler et al 2001 alexander et al 2008 hawkins and sutton 2009 aiken et al 2013 cavanaugh et al 2015 huddart et al 2017 newman and sardeshmukh 2017 dias et al 2019 to name but a few at the heart of a lim is the assumption that the system under consideration can be described by a set of linear stochastically forced differential equations while this turns out to be a good approximation in many instances there are situations where nonlinearities turn out to be important e g madja et al 1999 however the inverse model paradigm is not restricted to linear descriptions and more general nonlinear frameworks are also available e g hasselmann 1988 kondrashov et al 2013 in any case the nature and properties of the stochastic forcing diagnosed from such models is also of interest see martinez villalobos et al 2018 for a good discussion and there is considerable interest too in the role of stochastic forcing as a way of accounting for missing processes in models e g berner et al 2017 martinez villalobos et al 2018 provide an excellent review and summary of lim approaches and many recent applications in general lims provide a low order description of a dynamical system and the focus of this study will be the state of the ocean provided by a regional model two aspects of this work set it apart from most previous applications first we seek a low order approximation of the full 3 dimensional 3d multivariate state of the ocean and second the approach used to identify such a model differs from that most commonly used the focus region for this study is the california current system ccs an important eastern boundary current in the north east pacific this work builds on previous studies by crawford et al 2016 2018 2019 who also considered lims of the 3d ocean state derived from a data assimilative reanalysis spanning three decades the approach generally employed in most lim studies is predicated on dimension reduction based on the empirical orthogonal functions eofs of the covariance matrix of the time series data however previous studies in which the true dynamical operators are known have revealed that order reduction based on eof truncation alone is not guaranteed to preserve the stability properties of the system e g farrell and ioannou 2001a and can lead to very erroneous conclusions about the underlying dynamics of the system e g moore and kleeman 2001 such deficiencies arise because the leading eofs account only for the variance of the state and do not capture the small amplitude stochastically induced perturbations that can rapidly amplify and which maintain the variance captured by the leading eofs in the present study we seek a low order approximation of the circulation using the approach of balanced truncation that is commonly employed in dynamical systems theory antoulas 2005 by design order reduction by balanced truncation preserves the stability properties of the original system by simultaneously accounting for the leading modes of stochastically induced variance and the precursors of this variance in the sequel the reduced order linear statistical model based on balanced truncation developed here will be referred to as an emulator to distinguish it from the more traditional eof based lim approach the foundation of balanced truncation is singular value decomposition svd a powerful tool that identifies the fundamental sub spaces occupied by a dynamical system excellent and insightful reviews of svd can be found in lanczos 1961 and klema and laub 1980 specifically the schmidt eckart young mirsky theorem states that a reduced rank approximation a to a matrix a can be identified based on svd of a such that min rank a k a a 2 σ k 1 where σ i are the singular values of a antoulas 2005 and k rank a one important application of lims is to establish a statistical baseline for dynamical variability in relation to climate change scenarios e g newman 2013 thus a motivation for the current work is to build a reliable low order approximation of a 3d high resolution model simulation of an eastern boundary current upwelling environment that can be used to establish a long statistical baseline for important circulation features such as localized upwelling centers and episodes of ocean acidification and low oxygen that develop along the california coast fiechter et al 2018 cheresh and fiechter 2020 specifically the emulator developed here will be used to establish the statistical significance and quantify the extent to which important features of the circulation simulated by the model vary on different time scales this paper is primarily dedicated to a description of the formulation and properties of the emulator and a future study will document in more detail the results of baseline calculations the numerical model used to create the linear stochastic emulator is based on the regional ocean modeling system roms configured for the ccs the roms configuration is introduced in section 2 a brief review of linear inverse modeling is presented in section 3 from the viewpoint of dynamical systems theory where the important ideas that underpin the method of balanced truncation are also reviewed the efficacy of the emulator derived from balanced truncation and lims is presented in section 4 section 5 explores the mechanics of stochastically induced variance focusing on two specific aspects of the ccs circulation namely sea surface temperature sst and coastal upwelling a discussion of the results of this work is presented in section 6 and a summary follows in section 7 there are also three appendices that provide supporting results and ancillary information 2 the roms configuration the basis for the data used to construct the emulator described here is roms roms is a free surface hydrostatic primitive equation ocean model that uses stretched terrain following coordinates in the vertical and generalized orthogonal curvilinear coordinates in the horizontal haidvogel et al 2000 such a coordinate system allows for increased resolution where needed such as in areas with complex bathymetry or in the thermocline and bottom boundary layers roms uses a split explicit time stepping scheme to solve the momentum equations where there is coupling between barotropic fast and baroclinic slow modes shchepetkin and mcwilliams 2003 the roms configuration used here is shown in fig 1 and comprises 2 one way nested grids the outer most grid g1 has a horizontal resolution of 1 10 th degree 10 km while the inner most grid g2 has a horizontal resolution of 1 30 th 3 km both grids have 42 terrain following σ levels in the vertical with 7 100 m resolution in deep water and 0 3 8 m resolution on the continental shelf g1 captures well the large scale and mesoscale circulation environment of the ccs but is only marginally adequate for capturing nearshore coastal upwelling the latter however is well resolved by g2 grid g1 has been used by neveu et al 2016 to compute a sequence of ocean state estimates a so called reanalysis spanning the period 1980 2010 using 4 dimensional variational data assimilation 4d var it is not practical however to run 4d var on g2 to compute best estimates of the circulation for the same period therefore an alternative downscaling approach was adopted here to study the details of coastal upwelling by using the reanalysis fields from g1 to constrain the open boundaries of g2 during a forward run of the nonlinear roms in this way the circulation in g2 benefits from observations assimilated into g1 in this case the period considered here is the shorter time interval jan 1988 dec 2009 surface fluxes of momentum heat and freshwater fluxes adjusted by data assimilation in g1 were used as the forcing for g2 for the period considered surface atmospheric forcing for g1 was based on the cross calibrated multi platform winds of atlas et al 2011 and the ecmwf era40 1988 2001 and era interim 2002 2010 products for all other variables sea level pressure air temperature rainfall etc a detailed description of the g1 g2 nested configuration is provided in fiechter et al 2018 as noted in section 1 the primary motivation for the g2 roms configuration is to simulate in detail alongshore variations in the circulation associated with localized upwelling centers such centers of action are also often harbingers of episodes of ocean acidification and low oxygen that significantly impact local marine ecosystems and fisheries fiechter et al 2018 cheresh and fiechter 2020 in order to establish how climate change might influence the frequency of such events it is important to reliably establish their statistics under current climate conditions however the duration of the roms g2 simulations is limited by the availability of reliable high resolution surface and open boundary conditions and it is by no means clear whether the 22 year roms time series is adequate for establishing the statistical significance of the alongshore circulation variability in the following we demonstrate how these data can be used to develop a linear approximation of the roms simulations from which much longer time series and large ensembles can be computed at very low computational cost 3 linear inverse modeling 3 1 description of a dynamical system as noted in section 1 a goal of linear inverse modeling is to construct a low order approximation of a high dimensional system characterized by slow and fast timescales such a low order approximation is particularly useful in the case of time series data derived from numerical models in the present study we will be concerned with time series of 3d multivariate fields of temperature salinity two components of horizontal velocity and sea surface elevation sampled from the roms configuration described in section 2 thus we will denote by x t the n 1 column vector of the n grid point values of the roms state vector at time t in the sequel and without loss of generality t will simply represent a counter to distinguish each realization of x furthermore we will consider anomalies δ x t about a climatology so that δ x t x t x where x denotes the mean seasonal cycle with this in mind consider a time series comprising m realizations of the anomalies δ x t where t 1 m since δ x is multivariate the physical units of the elements will vary across the state variables e g c for temperature ms 1 for velocity etc in later sections it will be necessary to perform a coordinate transformation on δ x which yields a common unit so that δ x t l δ x t the transformation matrix l used here will be discussed further in section 3 2 in addition and for convenience we will arrange the δ x t as the columns of the n m matrix x for most geophysical systems of interest m n so that the covariance matrix of the time series data m 1 x x t will be at most of rank m therefore it is generally much more convenient to work in the space spanned by the m eigenvectors of m 1 x x t since this will be a space of much smaller dimension than that of the state vector these eigenvectors are the eofs of the state vector and provided that we retain all m eofs no covariance information about the time series δ x t will be sacrificed the assumption here of course is that δ x is described by a linear gaussian system so that all the information about system is captured by the covariance matrix the validity of this assumption for the ccs roms simulation is discussed in appendix b the eof description of the time series is also complete in the sense that we can express any single realization as a linear combination of the eofs according to δ x t k 1 m u k t v k where v k denote the eofs and u k t are the time series of eof amplitudes also known as the principal component pc time series a convenient approach to linear inverse modeling is then to identify a low order approximation for the pc time series u t u k t which is a m 1 column vector comprising the amplitudes of all eofs at time t penland 1989 penland and sardeshmukh 1995 in this study we employ the approach of balanced truncation which is commonly used in dynamical systems theory antoulas 2005 therefore to introduce the formulation of balanced truncation we will recast the problem in the input output framework commonly employed by the dynamical systems community a glossary of mathematical symbols used and their definition is provided after section 7 as an aid to the reader specifically we assume that the vector of pc time series u t can be described by the following system of discrete linear equations 1 u t 1 a u t b ξ t 2 y t 1 c u t 1 where a is the transition matrix for the pc time series that advances u t by one time step and ξ t is an input forcing with properties described by b a common approach in geophysical linear inverse modeling is to assume that a describes the slow time scales of the system which are influenced by the fast timescales represented by b ξ t it is common therefore to treat ξ t as a white noise stochastic forcing in time such that e ξ t ξ t t i where e is the expectation operator and b b t describes the covariance of the stochastic forcing in space e g von storch et al 1995 penland and sardeshmukh 1995 thus eq 1 describes how the state u t evolves in time dynamical systems theory recognizes that the output of the system may not represent the state itself but rather a subset of the state or a linear function of the state with this in mind the vector y t 1 in 2 represents the observed output defined by the matrix c that operates on u t 1 for example while collectively the pc time series u t describe the entire ocean state vector y might comprise only the sea surface height in the sequel we will assume that ξ t is a white noise stochastic forcing in this case if we right multiply the discrete stochastic difference equation 1 by u t t it is easy to show that 3 a φ 1 φ 0 1 where φ 1 e u t 1 u t t and φ 0 e u t u t t are respectively the lag 1 and lag 0 autocovariance matrices of the anomalies and in deriving 3 it is assumed that e ξ t u t t 0 i e u is a non anticipating function of the stochastic forcing in that u at time t does not depend on the future stochastic forcing gardiner 1985 from the orthogonality properties of the pc time series it is easy to show that φ 0 d i a g λ k 2 where λ k 2 are the eigenvalues of the state vector covariance matrix m 1 x x t and represent the fraction of the variance in δ x that is explained by eof v k in general terms the dynamical system can be viewed as a series of inputs ξ t and a series of outputs or observations y t this basic view is referred to as the external description of the system alternatively the same system can be described in terms of the state u t by 1 and 2 which is referred to as the internal description transforming from the external description to the internal description is challenging and is referred to as the realization problem e g feldman and heinig 1996 solving the realization problem amounts to finding the combination of matrices a b and c with the smallest possible dimension that describes the system and is a goal of linear inverse modeling given the nature of the system considered in this study a can be identified as an approximation of the linearized primitive equations see section 4 2 where b describes the statistical properties of the non linear interaction terms we will consider initially the situation where c is the identity matrix in which case the system output considered is the equivalent to the entire ocean state vector other choices of c that target specific aspects of the circulation will be considered in section 5 2 3 2 application to roms as noted in sections 1 and 2 our goal is to construct a low order approximation of a roms solution that can be used to emulate the behavior of the system over much longer time intervals or equivalently to generate large ensembles than can typically be achieved through direct integration of roms per se following crawford et al 2019 we choose the transformation matrix l introduced in section 3 1 so that δ x t δ x δ x t l t l δ x yields the total perturbation energy density see appendix a for details in the present example the dimension n of δ x is o 106 107 and the eofs of the lag 0 autocovariance matrix m 1 x x t were computed using svd specifically we can write m 1 2 x v λ s t 1 1 the vector j th column of s represents the pc time series u j t t 1 m of eof v j while the i th row of s represents the vector u t of all eof amplitudes at a single time t where v is the n m matrix of eofs v i also known as the left singular vectors s is the m m matrix of principal component time series s i u i t for t 1 m also known as the right singular vectors and λ d i a g λ i is the diagonal matrix of m singular values λ i the left and right singular vectors are related according to 4 m 1 2 x s i λ i v i 5 m 1 2 x t v i λ i s i from which it follows that m 1 x t x s i λ i 2 s i since x t x is a m m matrix and typically m n it is more expeditious to solve for the right singular vectors s i and use 4 to compute the associated 3d multi variate eofs v i the focus here is a physical ocean circulation that has reached a statistically steady state in which case φ 1 and φ 0 in 3 are stationary leading to an autonomous i e time independent transition matrix a which is implied a priori in the above development as a consequence of stationarity 1 represents a stable linear system meaning that the eigenvalues μ of a are such that μ 1 and variance in the system is maintained by the stochastic forcing b ξ t 3 3 reachable and observable states as noted in section 1 it is common practice to reduce the dimension of the linear system 1 by retaining only the leading m m n eofs when computing a according to 3 the criterion used to determine the appropriate choice of m is the percentage of state vector variance that is retained however as we will demonstrate truncating the system based on the number of eofs can radically alter the stability properties of the transition matrix a and can be detrimental therefore we employ here the approach of balanced truncation which is commonly used in dynamical systems theory antoulas 2005 the solution of 1 is given by u t 1 a t u 1 n 1 t a t n b ξ n in the case where 1 is described by an asymptotically stable system as here then as t the contribution of the initial condition u 1 becomes negligible and u t 1 is determined by the evolution through time of perturbations introduced by the stochastic forcing ξ the stochastic forcing can be viewed as a sequence of impulses and the matrices h n 1 ca n b referred to as the markov parameters describe how each impulse contributes to the output y t 1 in 2 more specifically y t 1 ca t u 1 h 1 ξ t h 2 ξ t 1 h k ξ t 1 k which can be viewed more generally in terms of a hankel operator which maps past forcing ξ t for t 1 τ to the outputs y τ 1 where τ 1 t antoulas 2005 for the discrete system 1 and 2 the hankel operator can be expressed as a block hankel matrix h comprising the markov parameters and takes the form 6 h cb cab cab c a 2 b c a 2 b c a 3 b c a 2 b c a 3 b c a 4 b which becomes doubly infinite in dimension as t the singular values of h are called the hankel singular values svs and are invariant for any linear invertible transformation of the system 1 and 2 therefore any attempt to reduce the dimension of the system should be based on the hankel svs which is the foundation of balanced truncation glover 1984 this in contrast to the approach usually adopted in a traditional lim where dimension reduction is based solely on the eigenvalues of the covariance matrix φ 0 as described next rather than working directly with the hankel matrix which is very large and cumbersome the hankel svs and appropriate balanced truncation are computed from two related matrices of much smaller dimension that contain the same information as h the influence of the forcing ξ t on the system state can be quantified in terms of the covariance of u which as t can be expressed as 7 p n 0 a n b b t a n t the covariance matrix p is also referred to as the reachability gramian 2 2 if w w i is the matrix comprising column vectors w i the gramian is the name given to the matrix of inner products w t w and captures the sub space of the system that is reachable given the inputs ξ t for an asymptotically stable system p is the solution of the discrete lyapunov equation see glover 1984 8 p a p a t b b t 0 and plays a central role in linear stochastic dynamical systems theory since it provides information about the set of states u that can be reached by manipulating the stochastic forcing ξ t alone since p is a covariance matrix for the system it provides information about all the states that have been visited or that were reachable in the past under the action of forcing alone i e u 1 0 then for all possible forcings b ξ t the minimum energy 3 3 the term energy is used here in a general sense to represent the l2 norm regardless of the units more generally this can be viewed as the variance of the quantity under investigation required to steer the system to the state u r is given u r t p 1 u r thus p 1 determines the minimum amount of energy required to reach a particular state therefore the eigenvectors of p can be identified as the semi major axes of a hyper ellipse that encompasses all states that can be reached by input energy 1 moore 1981 if the hypotheses about nature of the stochastic forcing and the gaussian nature of δ x that underpin 1 and 2 are correct then p will be given by φ 0 in general these hypotheses will not be satisfied exactly in which case p represents an approximation of φ 0 for the present case the degree of consistency between p and φ 0 is rather good as discussed in appendix b 1 however to avoid confusion we will denote the covariance matrix of u arising from 1 and 2 as p consider now the output of the system y t 1 given by 2 in the case when ξ t 0 or equivalently where the system is stochastically forced over some time interval and then the stochastic forcing is removed and the system allowed to freely evolve at future times the time integrated squared energy of the output i e the total variance due to the initial input u 1 is given by u t 1 q u 1 where q is the so called the observability gramian given by 9 q n 0 a n t c t c a n for an asymptotically stable system q is the solution of the discrete lyapunov equation glover 1984 10 a t q a q c t c 0 the matrix q also plays a central role in linear stochastic dynamical systems theory and provides information about the set of outputs y that can be observed by manipulating u 1 alone or more generally by manipulating an impulse forcing at a single time step a useful result here is that the maximum observation energy that can be generated by the initial state u 1 u 0 is given by u 0 t q u 0 the eigenvectors of q can then be identified as the semi major axes of a hyper ellipse that defines all unit energy observation states moore 1981 the interpretation of the gramians p and q in terms of the energy or more generally input variance required to reach a particular state and the energy or variance of the output provides a useful reference point going forward for example the most difficult states to reach require a large input of energy cf a large variance in b ξ t and are associated with the smallest eigenvalues of p similarly the states that are most difficult to observe are those with small output energy i e small output variance and are associated with the smallest eigenvalues of q therefore when constructing a reduced dimension approximation of 1 and 2 it might be prudent to eliminate states that are difficult to reach and difficult to observe however these two aspects of the system are often at odds with one another in that the states that are easy to reach may be difficult to observe and vice versa i e the eigenvectors of p and q may be close to orthogonal to each other this can lead to serious difficulties when attempting to reduce the dimension of 1 and 2 this is in fact an important and perhaps ubiquitous property of systems for which a in 1 is nonnormal i e is described by non orthogonal eigenmodes the properties of nonnormal operators in geophysical fluid dynamics have been explored in detail by farrell and ioannou 1996a b the eigenvectors of p are the familiar eofs of the system and describe the patterns of stochastically induced variance ordered according the associated eigenvalues the eigenvectors of q are referred to as the stochastic optimals farrell and ioannou 1996a and represent the patterns of stochastic forcing that account for different fractions of the stochastically induced variance when ordered according the associated eigenvalues a simple but highly illuminating 2 dimensional example of these important and fundamental ideas is presented in appendix c readers who are unfamiliar with these ideas are encouraged to review appendix c before moving on 3 4 balanced truncation as the example of appendix c illustrates any attempt to reduce the dimension of the system described by 1 and 2 must simultaneously retain information not only about the eofs that account for the largest fractions for variance but also information about the input forcing that can excite them what is required is a balancing transformation in which the states that are easy to reach also correspond to the states that are easy to observe in such a system the reachability and observability gramians p and q are simultaneously diagonalized and are identical and given by the matrix σ d i a g σ i of singular values of the block hankel matrix h in 6 practically the hankel svs σ i can be computed from the product pq which has eigenvalues given by σ i 2 the balancing transformation can be exploited for dimension reduction of the system in a procedure referred to as balanced truncation of which there are several variants as described by antoulas 2005 here we follow the approach originally developed by moore 1981 and which has been applied in meteorological applications by farrell and ioannou 2001a b specifically consider the transformation φ t u where 1 and 2 become 11 φ t 1 a φ t b ξ t 12 y t 1 c φ t 1 where a t a t 1 b t b and c c t 1 indeed as shown by glover 1984 the eigenvalues σ 2 d i a g σ i 2 of tpq t 1 are invariant under the transformation and represent an appropriate premise on which to reduce the dimension of the system the transformation t is thus chosen so that the corresponding reachability and observability gramians for 11 and 12 are p tp t t σ and q t 1 t q t 1 σ respectively the transformation matrix that simultaneously diagonalizes p and q in this way can be identified as follows 1 compute the cholesky factorization i e square root of p p 1 2 p 1 2 t 2 compute the eigendecomposition of p 1 2 t q p 1 2 k σ 2 k t 3 compute the balancing transformation and its inverse according to t σ 1 2 k t p 1 2 and t 1 p 1 2 k σ 1 2 where p 1 2 denotes the inverse of the cholesky factorization from step 1 dimension reduction of the system is then achieved by retaining only the leading hankel svs of the diagonal matrix p q σ which has eigenvectors given by the columns e i of the identity matrix in other words the eofs and stochastic optimals of the transformed system are identical truncating the system based on the hankel svs partitions a b c and φ according to 13 a a 11 a 12 a 21 a 22 b b 1 b 2 c c 1 c 2 φ φ 1 φ 2 specifically t is an m m matrix and if the leading k hankel svs are retained the reduced variable φ 1 t 1 u where t 1 is the k m matrix comprising the first k rows of t and t 1 1 is the m k matrix comprising the first k columns of t 1 the resulting truncated transition matrix a 11 in 13 is then the submatrix comprised of the first k rows and k columns of a and the reduced system is described by 14 φ 1 t 1 a 11 φ 1 t b 1 ξ t 15 y 1 t 1 c 1 φ 1 t 1 where b 1 t 1 b and c 1 c t 1 1 balanced truncation in this way has the important property of preserving the stability properties of the original transition matrix a it is important to note that since the truncation is based on the hankel svs and not on the state vector eofs the balanced reduced system potentially draws information from all of the eofs 4 a roms emulator before proceeding a comment on the limited extent of the time series used here is appropriate our time series span the 22 year period jan 1988 dec 2009 and clearly it is not possible to unambiguously identify potential modes of variability in the circulation with periods longer than this this of course is self evident and will become clear from the eigenmode analysis of a presented in section 4 2 however the stochastic nature of 1 does not preclude the presence of variability on time scales longer than 22 years at each time step the stochastic forcing will randomly excite the eigenmodes of a with time varying amplitudes and quite naturally periods of enhanced variability and suppressed variability will arise in long time series generated by the emulator as we shall see the duration of these periods of high and low variance are not tied to the length of the original roms time series in any obvious way and can most certainly exceed the period of the lowest frequency eigenmode of a that can be resolved as noted in section 1 a motivation for the emulator presented here is to establish a statistical baseline for high impact circulation events along the california coast as simulated by a high resolution ocean model our focus therefore is not on the problem of ocean prediction or predictability where the length of the original model time series is an important consideration see for example zanna 2012 wunsch 2013 however an implicit assumption made in the following sections is that the matrix a derived from the covariance of the 22 year roms time series according to 3 and the covariance of the diagnosed stochastic forcing b b t in 1 are time invariant and representative of a much longer period nonetheless as noted later sub samples of the simulations made with the emulator for time intervals longer in duration than the original roms time series can be viewed as ensembles of state vector realizations arising from different initial conditions 4 1 eofs of the roms ccs the focus of this study is circulation variability on timescales ranging from seasonal to interannual as such we use monthly averaged fields from roms to define the ocean state vector x t introduced in section 3 1 variability on shorter sub seasonal timescales will be the topic of a separate study with this in mind δ x t represents departures of the monthly mean fields from a seasonally varying climatology the period jan 1988 dec 2009 therefore represents a total of m 264 samples of state vector anomalies δ x t as discussed in section 3 2 the state vector anomalies are rescaled according to δ x l δ x where l defines the square root of the perturbation energy density as described in appendix a within the predominantly quasi geostrophic regime considered here the available potential energy is larger than the kinetic energy so the temperature and salinity fields receive a larger weight than the velocity field nonetheless it is important to include all fields in the definition of δ x in light of the role that small variance fields can play in controlling the non normal behavior of the system see appendix c the rescaled anomalies δ x are arranged to form the columns of the n m matrix x where n 7 911 743 the total number of ocean grid point variables in g2 4 4 in practice ocean points within 90 km of the open boundaries were ignored when computing the eofs so as to eliminate unwanted influences of imperfect boundary conditions since m n only the leading m eofs of the covariance matrix of the roms state vector can be estimated as described in section 3 2 svd was used to identify the eofs and fig 2a shows the spectrum of eigenvalues λ i 2 i e the squared singular values the eigenvalues represent the contribution of each eof to the total energy density e δ x t δ x e δ x t l t l δ x t r φ 0 fig 2a shows that the eigenvalues span 4 orders of magnitude the cumulative percentage energy density explained by the eofs is shown in fig 2b and indicates that first eof explains 20 of the energy density while the leading 50 eofs collectively account for 87 this increases to 95 and 98 for the first 100 and 150 eofs respectively in practice only the leading 230 eofs were used in the calculations presented here so as to improve the numerical conditioning of the calculations the leading 230 eofs account for 99 7 of the total energy density so the information that is lost by discarding the trailing 34 members of the eigen spectrum is very small the sea surface height ssh sea surface temperature sst and sea surface salinity sss associated with the leading 3d multivariate eofs are shown in fig 3 the structures of the eofs are varied and spatially coherent for example the eof 1 sst fig 3b is characterized by anomalies of the same sign across the entire g2 domain these anomalies extend to depths of between 100 m and 300 m as illustrated in figs 4a and 4c which show vertical sections of eof1 temperature over the upper water column along zonal sections at the latitudes of cape mendocino 40 4 n and point conception 34 4 n conversely the eof 1 sss fig 3c changes sign around 124 w at cape mendocino fig 4b the salinity anomaly occupies the upper 250 300 m of the water column offshore and shoals near the coast while at point conception fig 4d the anomalies display a weak quadrupole structure in the case of ssh eof 1 exhibits anomalies of largely the same sign over much of the domain with elevated values along the coast fig 3a the principal component pc time series s i associated with the leading 3 eofs are shown in fig 5 all 3 eofs display significant inter annual variations and s 1 in particular exhibits a low frequency component 4 2 a 1 st order markov model following 1 the pc time series for each eof were modeled as a stochastically forced system since the eofs are based on δ x sampled every month the time step implied in 1 is also one month following section 3 1 the stochastic forcing b ξ t in 1 represents the rectified effect of variability on timescales much shorter than one month and was assumed to be white noise in time so it is important to first test the validity of this assumption the transition matrix a was computed from the lag 1 and lag 0 autocovariance matrices according to 3 and b ξ t was estimated as the residual u t 1 a u t the autocorrelation function of the stochastic forcing averaged over all m pc time series is shown in fig 6 white noise in time decorrelates over a single time step but as fig 6 shows that associated with b ξ t tends to overshoot at lag 1 and lag 2 before approaching zero this perhaps suggests that a higher order markov model may be appropriate however as we will demonstrate the assumption of a 1st order model subject to white noise forcing nonetheless performs very well having diagnosed the stochastic forcing b ξ t as described above the forcing covariance f b e ξ t ξ t t b t b b t where the last equality follows from the requirement that e ξ t ξ t t i therefore a cholesky factorization f b b t yields the b matrix in 1 the efficacy and implications of this approach are discussed in appendix b 1 the choice of c in 2 will be discussed shortly while 1 and 2 are a mathematical construct before proceeding it is appropriate to comment on the physical nature of the stochastic forcing b ξ t in the context of the present study the system described by 1 essentially represents a 1st order linearization of the primitive equations since the primitive equations are nonlinear to 2nd order only it is the nonlinear interaction between anomalies that have been ignored in 1 thus we can view the stochastic forcing b ξ t as representing the nonlinear backscatter of energy in the space spanned by the eofs into the linear components of the flow in the ocean however we also have to contend with surface fluxes of momentum heat and freshwater in which case b ξ t will contain some expression of stochastic variations in the atmospheric marine boundary layer on timescales shorter than one month in addition since our attention is confined to a limited region of the ne pacific stochastic variations in the open boundary conditions will also contribute to b ξ t while most of these stochastic processes will have time scales shorter than the monthly time step employed here in 1 the degree of separation of the fast and slow time scales that are being modeled by 1 deserves further investigation the eigenvectors of a provide important information about the response of the system to stochastic forcing these eigenmodes are also referred to as the principal oscillation patterns pops hasselmann 1988 and are empirical approximations of the normal modes of the dynamical system pedlosky 1979 even though a is a real matrix its eigenvalues and eigenvectors in general take the form of complex conjugate pairs the complex eigenvalue spectrum μ i of a derived from 3 is shown in fig 7a as noted in section 3 2 since a is constructed from statistically stationary time series of δ x it is asymptotically stable in that a t 0 as t which means that μ i 1 for all eigenvalues fig 7a shows that this is indeed the case where all of the μ i lie within a unit circle on the complex plane by expressing the eigenvalues in the form μ j a j e i σ j the oscillatory nature of each eigenvector becomes apparent where log a j is the decay rate of the corresponding eigenvector and 2 π σ j is the eigenvector oscillation period the period and decay rates of the pops of a are shown in fig 7b where the stable nature of each pop is very evident fig 7b indicates that there are several slowly decaying pops with low frequencies and periods of 21 0 048 years 1 10 0 1 years 1 7 0 14 years 1 5 4 0 16 years 1 and 4 0 25 years 1 years a discussion of the physical interpretation of the leading pops is postponed until section 6 after we have explored how well they can be recovered by balanced truncation 4 3 balanced truncation as discussed in section 1 a common approach to linear inverse modeling is to reduce the dimension of the system based on an eof truncation of 3 however such an approach can severely alter the stability properties of the system and potentially lead to erroneous behavior to illustrate a reduced dimension approximation of the transition matrix a in 1 was constructed by retaining the leading 50 state vector eofs of m 1 2 x which account for 87 of the energy density of the roms monthly mean circulation anomalies cf fig 2b fig 7a shows the complex eigenvalue spectrum for the resulting lim and indicates that the spectrum is dramatically different to that of the original system as required the reduced dimension lim is still stable but the period and decay rate of the resulting pops depart significantly from those of the original system as shown in fig 7b like the original system there are still low frequency pops but they decay very rapidly in the reduced dimension system the situation is similar when different numbers of eofs are retained in the lim not shown balanced truncation described in section 3 4 is an alternative approach for constructing a reduced dimension model that preserves the stability properties of the original system the truncation depends on the choice of c in 2 i e on the aspect of the system that is being observed we will consider first the case where c i the m m identity matrix which is equivalent to the case where the entire state vector anomaly δ x constitutes the observed output additional cases of interest for the ccs will be considered in section 4 the reachability gramian p and observability gramian q were computed by solving the lyapunov equations 8 and 10 respectively 5 5 in practice p and q can also be computed directly from 7 and 9 for a sufficiently large number of time steps n for the stable system considered here a n approaches zero quite quickly as n increases and for n 1000 the directly computed estimates of p and q based on 7 and 9 agree with the solutions of 8 and 10 as discussed by antoulas 2005 there are other alternative methods for directly computing p and q the eigenpairs of p and q will be denoted by α i c p i and α i o q i respectively and fig 8a shows both eigenvalue spectra for the case c i in both cases the spectra span 2 3 orders of magnitude and apart from a short steep tail at the ends of the spectra the eigenvalues decrease relatively slowly in between as discussed in section 3 3 α i c 1 2 p i represent the semi major axes of a hyper ellipse whose surface represents all the states u of the system that can be reached by stochastic forcing b ξ with a variance 1 moore 1981 since p is the covariance matrix of u the eigenvectors p i represent the eofs of u however we will generally refrain from referring to them as such here so as to avoid confusion with the state vector eofs v i of section 3 2 used to compute a in a similar vein α i o 1 2 q i represent the semi major axes of a hyper ellipse whose surface represents all of the outputs y that arise from all unit norm initial conditions u 1 the singular values of the corresponding block hankel matrix h 6 are shown in fig 8b as described in section 3 4 balanced truncation is based on reducing the dimension of a in 11 by retaining the leading hankel svs leading to 14 and 15 in accordance with the schmidt eckart young mirsky theorem mentioned in section 1 the formal error in the truncated approximation of the system described by 1 and 2 decreases as the number of hankel singular values retained increases the decision on where to truncate the hankel singular value spectrum will depend on the application under consideration and will be discussed further in section 6 for now and to illustrate the efficacy of the approach we will mainly consider here a truncation based on the leading 50 hankel svs with this in mind fig 7a shows the eigenvalue spectrum for a 11 based on the leading 50 hankel svs while there is no formal requirement for a and a 11 to share any of the same eigenvalues fig 7a clearly indicates that the balanced truncation is very effective at maintaining the stability of the original system by capturing the least damped eigenvectors this is further illustrated in fig 7b which shows the frequency and decay rate of the pops of a 11 and indicates that the long period least damped pops of the original system 1 are well represented the pops of a 11 with lowest frequencies have periods of 21 10 7 3 5 3 and 4 1 years for this choice of truncation which are very close to those of a fig 7 indicates that a 11 has a single errant pop which recall occur in complex conjugate pairs which departs significantly from the original spectrum this particular pop however is not robust and other choices for the level of truncation based on the number of retained hankel svs eliminate it not shown however for transparency we continue with an analysis of the truncated system based on 50 hankel svs one measure of the efficacy of the reduced system is illustrated in fig 9a which shows time series of the energy density y t y from a 100 year integration of the original system 1 and 2 and y 1 t y 1 from the reduced system 14 and 15 the expected variance of the output y can be computed directly from p and q according to 16 t r y t y t t t r c p c t t r b t q b t r q b b t also shown in fig 9a is the expected energy density of 2 based on t r b t q b and of 15 based on t r b 1 t q 1 b 1 while the truncated system described by a 11 underestimates the energy density by 38 the correlation between the time series is 0 86 most of the missing variance in the reduced system is associated with variations on decadal time scales as indicated in fig 9b which shows the power spectra computed from t r g t z g z where g z c z i a 1 b is the transfer function and z e i ω where ω is the frequency the percentage energy density captured by 16 versus different levels of truncation is shown in fig 9c it is important to note that fig 9c is distinct from fig 2b in balanced truncation information from all of the state vector eofs v i is potentially retained regardless of the level of truncation the error in the reduced system can be expressed in terms of g z according to σ k 1 g 1 z g z h 2 i k 1 m σ i where g 1 z represents the transfer function of the reduced system obtained by retaining the leading k hankel svs σ i and h denotes a hardy norm and is the maximum singular value for all possible z 0 2 π the origin of the upper bound 2 i k 1 m σ i is discussed by glover 1984 while the lower bound of σ k 1 is a direct consequence of the schmidt eckart young mirsky theorem as discussed by farrell and ioannou 2001a following glover 1984 lemma 9 5 and zhou and doyle 1998 section 4 2 the expected error in g 1 z can be evaluated according to g 1 z g z h max re z 0 σ c z i a 1 b where the right hand side represents the maximum singular value of the expression in the square braces and a a 11 0 0 a b b 1 b c c 1 c fig 9d shows the expected error g 1 z g z h as a function of the number of hankel svs retained in the balanced truncation for the case c i also shown are the expected upper and lower bounds on g 1 z g z h while the upper and lower bounds generally span a wide range fig 9d shows that the expected error g 1 z g z h is always close to the lower bound σ k 1 formally the transfer function g z is defined as the ratio of the z transform of the output y t and the z transform of a constant frequency harmonic forcing therefore g 1 z g z h can be interpreted in terms of the frequency component of the stochastic forcing ξ t that yields the largest error in the output y t glover 1984 with this in mind fig 9d also shows the period of the forcing frequency associated with g 1 z g z h and indicates that in general the expected error is associated with higher frequency forcing i e shorter periods as the number of hankel svs retained increases a discussion of the appropriate level of truncation will be postponed until section 6 5 stochastically induced variability in this section we will focus on the mechanics of the stochastically induced variability in the reduced system from balanced truncation described by 14 and 15 with a focus later on coastal upwelling 5 1 stochastic optimals figs 9a and 9b indicate that variability occurs in the system on a wide range of timescales despite the stochastic nature of the forcing in 1 and 14 it is of interest therefore to explore how this variability arises particularly in the case of the low frequency variability which is so evident in fig 9a according to 16 the stochastically induced variance in the output y in 2 can be expressed as e e y t y t r b t q b and similarly for 15 e 1 t r b 1 t q 1 b 1 since q and b b t are symmetric matrices the variance can also be expressed as 17 e i 1 m j 1 m α i o f j q i t f j 2 where α i o q i are the eigenpairs of q introduced in section 4 3 and f j f j are the eigenpairs of f b b t the covariance matrix of the stochastic forcing the latter therefore represent the eofs and explained variance of the stochastic forcing as noted in section 3 3 and discussed in appendix c the eigenvectors q i are called the stochastic optimals following farrell and ioannou 1996a when ordered according to descending eigenvalues α i o the stochastic optimals q i represent in order of importance the spatial structures of the stochastic forcing that are most effective at inducing variance in the system thus 17 demonstrates that the stochastically induced variance is determined by the weighted sum of the projection of the stochastic forcing eofs onto the stochastic optimals i e q i t f j as the simple 2 2 example presented in appendix c illustrates the stochastic optimals provide insight into how the eofs of the system response i e p i can be maintained indeed as illustrated by the same example the degree of non normality of the transition matrix a plays a central role in the process whereby low energy inputs can yield very large amplitude outputs the fraction of e 1 accounted for by each stochastic optimal of the system 14 and 15 based on the leading 50 hankel singular values is shown in fig 10 stochastic optimal q 1 yields 16 of the stochastically induced variance and the leading seven stochastic optimals account for 50 of e 1 it follows from 17 that the stochastic forcing b 1 ξ t in 14 can also be expressed as a linear combination of the stochastic optimals therefore at each time step t a perturbation will be introduced into the system with the structure of a stochastic optimal to elucidate further the role that the leading stochastic optimal q 1 plays in promoting variance we will therefore explore the time evolution of a unit amplitude perturbation with the structure of q 1 by considering the initial value problem for 14 corresponding to u 1 1 t 1 1 φ 1 1 q 1 and ξ t 0 where the labeling of u 1 conforms with the convention adopted in 13 fig 11a shows a time series of the energy density e 1 t u 1 t t u 1 t of the perturbation u 1 t t 1 1 φ 1 t for the case initialized with u 1 1 q 1 and integrated for 30 years with ξ t 0 initially e 1 grows rapidly and reaches a peak after about 4 years after which time there is a decline in energy while the perturbation will project onto all of the state vector eofs the evolution is dominated by the leading eof as illustrated in fig 11a which shows time series of the amplitude u i t of the leading five state vector eofs v i the amplitudes of the other eofs components are small however while the time evolution of the perturbation is clearly dominated by v 1 the initial contributions of the other eofs are critically important as we shall see recall that a 11 is asymptotically stable cf fig 7 so one might wonder how the energy growth in fig 11a is possible at all the example in appendix c provides the answer while it is the case that the system must approach a state of rest as t the energy density e t can nonetheless undergo transient growth due to the interference of the non orthogonal pops of t 1 1 a 11 t 1 the solution of the truncated system 14 can be represented as a linear superposition of the pops according to u 1 t t 1 1 φ 1 t j 1 k γ j μ j t 1 ψ j where μ j ψ j are the eigenpairs associated with each pop and k is the number of hankel singular values retained the coefficients γ j represent the projection of u 1 t onto each pop and for the initial value problem considered here are given by q 1 t ψ j where ψ j are the eigenvectors of t 1 1 a 11 t 1 t 6 6 this result follows from that fact the eigenvectors of t 1 1 a 11 t 1 and t 1 1 a 11 t 1 are biorthogonal such that ψ i h ψ j δ i j where the superscript h denotes the hermitian transpose therefore the γ j represent the projection of the leading stochastic optimal q 1 onto each pop fig 11b shows γ j as a function of the oscillation frequency of each pop in the example shown here a 11 is a 50 50 matrix so there will be 50 available pops however the pops occur in complex conjugate pairs μ j ψ j and μ j ψ j in which case that there will only be 25 distinct values of projection modulus γ j as shown fig 11b fig 11b indicates that q 1 projects most on to the lowest frequency conjugate pop pair which we will refer to as ψ 1 and ψ 1 because the pops are not orthogonal to each other the large amplitude projection of u 1 1 q 1 on ψ 1 and ψ 1 can be masked by other rapidly decaying members of the pop spectrum then as the perturbation evolves the combined real combination of ψ 1 and ψ 1 very quickly emerges and e t grows rapidly as evident in fig 11a this process can be visualized physically by mapping the perturbation back to the physical state variables as shown next in addition fig 11a indicates that much of the structure of ψ 1 is associated with the leading state vector eof v 1 this is illustrated in fig 12 which shows the time evolution of ssh sst and sss for the initial value problem u 1 1 q 1 and ξ t 0 the initial time fields figs 12a 12b and 12c therefore represent the structure of the leading stochastic optimal q 1 recall however that the q 1 are 3d multivariate fields so figs 12a b c show only the surface field components although they are representative of the structure in the upper water column not shown nonetheless figs 12a b c indicate that q 1 exhibits a great deal of quasi random coherent structure with horizontal length scales characteristic of mesoscale circulations that obscure underlying larger scale features over time the mesoscale features give way to the larger scales as shown in figs 12d 12e and 12f after 1 year by year 7 the negative signature of the leading state vector eof v 1 of fig 3 has emerged figs 12g 12h and 12i in agreement with the peak negative amplitude of u 1 in fig 11a by year 17 fig 11a shows that u 1 reaches its peak positive amplitude and the positive phase of eof v 1 is very evident in figs 12j 12k and 12l at this time while we have focused here on the role of q 1 in promoting stochastically induced variance a qualitatively similar picture emerges for the other stochastic optimals not shown for example q 2 projects most on the pop with 10 year period while q 3 and q 4 generally favor the pops with periods 2 5 years the picture that emerges then is one in which the stochastic forcing in 1 and of course 14 introduces perturbations into the system which can undergo rapid transient growth by projecting with a large amplitude onto the least damped pops it is these pops that persist through time and which account for much of the variance however the high frequency and perhaps rapidly decaying pops clearly play a crucial role in the process also since it is these pops that hide the contribution of the low frequency pops to the perturbations that are introduced at each time step by the stochastic forcing as illustrated in the example of appendix c it is the nonnormal character of a that leads to this behavior while transient perturbation growth is a well known feature of stable non normal operators such growth is norm dependent in the present study the measure of perturbation growth and stochastically induced variance is determined by c in that the variance of the output y t t y t from 2 is given by u t t c t c u t in the example above c i and the transient growth evident in fig 11a is based on the l2 norm of u t which recall corresponds to the perturbation energy density other norms will be considered in section 5 2 while for autonomous systems it is possible to identify a transformation of variable that will render a normal the resulting variance norm may not correspond to anything physically relevant furthermore any attempt to quantify the variance of the system requires choice of a physically motivated norm thus the choice of a norm is unavoidable and the influence of the fundamental non normal behavior of a on variance induced in the chosen norm will be a principal concern indeed it is this very non normal property of a that necessitates the need for balanced truncation as clearly illustrated by the example presented in appendix c with this in mind the degree of nonnormality of the transition matrix a can be quantified by computing the pseudospectra which is given by the largest singular value of the resolvent r ω e i ω i a 1 where ω is the complex frequency trefethen and embree 2005 formally the largest singular value of the resolvent represents r ω 2 for a normal system in which all of the pops are orthogonal the pseudospectra is described by d ω 1 d i s t e i ω λ a where d i s t e i ω λ a is the shortest distance in the complex plane between e i ω and the eigen spectrum λ a according to the transfer function if b ξ t in 1 is replaced by i e i ω t the response of the system to a constant harmonic forcing of frequency ω is proportional to r ω 2 for a non normal system and to d ω for a normal system specifically d ω r ω 2 κ ψ d ω trefethen et al 1993 where κ ψ is the condition number of the matrix ψ ψ i comprising the pops of a if a is normal the pops are orthogonal cf appendix c fig c 1a κ ψ 1 and r ω 2 d ω conversely if a is nonnormal the pops are linearly dependent cf appendix c figs c 1b and c 1c and κ ψ can be very large for a normal system the condition r ω 2 d ω simply describes the phenomena of classical resonance when the forcing frequency approaches the eigen frequency of a pop in the case of a non normal system the response gets an extra boost from linear interference of the non orthogonal pops aka pseudo resonance therefore the extent to which r ω 2 differs from d ω is a measure of the non normal influence of the pops on the stochastically induced variance fig 13 shows r ω 2 versus ω for the physically relevant case where ω is restricted to real values pseudospectra are shown for the original system described by a in 1 and the truncated system t 1 1 a 11 t 1 based on 50 hankel svs for comparison fig 13 also shows the inverse distance function d ω for the two systems the pseudospectra indicate that the pseudo resonant response of both systems can be significantly larger than the classical resonant response expected based on d ω furthermore fig 13 indicates that the truncated system retains the non normal characteristics of the original system as discussed in section 4 3 it is common practice to construct a lim by retaining only the leading eofs of the state vector the pseudospectra for a lim based on retaining the leading 50 state vector eofs of m 1 2 x is also shown in fig 13 and clearly does not capture the non normal characteristics of the original system 1 5 2 coastal upwelling thus far we have been concerned with the case where c i in 2 in which case the output y t corresponds to the full state vector however the input output system described by 1 and 2 can be tailored for output associated with a particular process in this and the next section we will focus on coastal upwelling specifically we will consider two different choices for c one based on sst and another based on vertical velocity the target region chosen is shown in fig 1 and extends from cape mendocino to point conception and from the coast to 50 km offshore which is 1 5 times the 1st baroclinic mode radius of deformation based on the stratification chelton et al 1998 the extent to which sst and vertical velocities in this region are described by a gaussian distribution one of the assumptions underpinning 1 and 2 is discussed in appendix b 2 with this in mind let l s s t represent a matrix such that r l s s t δ x isolates the roms sst grid point values in the target region in this case e r t r is the expected total variance of sst over the target region thus we can define c s s t according to the cholesky factorization c s s t c s s t t m 1 x t l s s t t l s s t x it is well established that coastal sst along the central california coast is strongly controlled by upwelling and downwelling e g checkley and barth 2009 to focus on this process we can similarly let l w represent a matrix such that w l w δ x isolates the roms vertical velocity at grid point values in the same target region shown in fig 1 since roms is a hydrostatic model w is computed as a diagnostic variable using the continuity equation thus the matrix l w represents the vertical integral of the divergence of the horizontal velocity here we consider vertical velocity at a depth of 40 m and in the same way we can define c w according to c w c w t m 1 x t l w t l w x in this case e w t w is the expected total variance of the 40 m vertical velocity over the target region according to 9 the observability gramian q depends on the choice of c and so too will the hankel singular values of h however the eigenvalue spectra of q and singular value spectra of h for the cases c c s s t and c c w are qualitatively similar to those in fig 8 not shown the percentage variance of the output y as a function of the number of hankel singular values retained is shown in fig 9c for the cases c c s s t and c c w compared to the case where the entire state vector is observed c i fewer more hankel singular values are required to capture the same fraction of output variance for the case c c s s t c c w the expected error in the transfer function g 1 z g z h for both cases not shown exhibit qualitatively similar behavior to that for c i shown in fig 9d fig 14a shows a time series of the root mean square rms sst anomaly r t r n p 1 2 from a 300 year integration of 1 and 14 where n p is the number of sst grid point values within the target region in the case of the truncated system 14 the leading 50 hankel svs are retained in fig 14a a 3 year running mean has been applied to the time series in order to highlight the low frequency variability the rms sst of the truncated and original system are very similar and the sst variance of the truncated system is only marginally lower than the original system in this case the leading stochastic optimal q 1 accounts for 30 of the stochastically induced variance of sst as shown in fig 14b the structure of q 1 is very similar to that shown in fig 12a c for the case c i and a perturbation with the structure of q 1 evolves in much the same way through time not shown in the c s s t case q 1 projects almost exclusively on the state vector eof v 1 not shown this is perhaps not too surprising since fig 12 shows that the stochastic optimals of the c i case produce a large sst response in the target region fig 14c shows a time series of the 3 year running mean rms 40 m vertical velocity anomaly w t w n p 1 2 from a 300 year integration of 1 and 14 two truncated cases are shown for 14 corresponding to the leading 50 and 100 hankel svs in the former case the level of variance is about half that of the original system a significant additional fraction of the variance can be recovered by increasing the number of hankel svs to 100 as indicated in fig 14c the vertical velocity variance accounted for by the stochastic optimals is shown in fig 14d for the 50 hankel sv truncation in this case the leading stochastic optimal q 1 accounts for only 8 of the variance in w the more even distribution of variance amongst the stochastic optimals in the c w case indicates that many state vector eofs are needed to capture the variability due to the high degree of spatial inhomogeneity and intermittent nature of coastal upwelling figs 14a and 14c illustrate very clearly the advantages of the truncated system as an emulator of the california current circulation the low pass time series reveal that central california coastal sst is punctuated by variability on interdecadal to decadal time scales occasionally there are extended periods of elevated variance as in the interval years 60 80 and 235 245 in fig 14a during such periods the stochastic forcing is such that eof v 1 persists for several years with an elevated amplitude fig 14b on the other hand does not exhibit abnormal vertical velocities during these same periods suggesting that factors other than variations in the rate of upwelling and downwelling are responsible for the variability in sst 5 3 circulation variability a reduced dimension emulator represents a very useful tool for studying the occurrence of extreme conditions in the ocean and for establishing a high resolution baseline against which future climate change scenarios can be compared for example very long emulator simulations can be used to quantify the probability of occurrence of anomalous conditions along the coast such as extended periods of warming or cooling and their relationship to mechanistic circulation indicators such as coastal upwelling to illustrate further fig 15 shows the probability density of sst anomalies along the central california coast computed from a 1000 year simulation using the balanced truncation emulator based on 50 hankel svs for the case c c s s t the probability density was computed for data bins with a dimension of 0 05 of latitude and extending from the coast to 50 km offshore between point conception in the south and cape mendocino in the north cf fig 1 the emulator is able to capture well the probability density of the original 22 year roms time series as demonstrated in appendix b 3 so this gives us confidence in the outcome of the longer emulator simulations presented here however given the very large sample size available from the emulator the statistical significance of the resulting probability density will be far more significant than that derived from the original roms simulation or from observed satellite data which both span just a few decades the probability density for high pass filtered periods less than 3 years and low pass filtered periods greater than 3 years sst are shown separately in fig 15 of particular interest here are the tails of the distributions associated with extreme events which are accentuated in figs 15a and 15b by deep red colors while there is little variation in the shape of pdf along the coast the tails of the high pass pdfs fig 15a are longer than those of the low pass pdfs fig 15b which is reflected in the standard deviations of the two distributions with the low pass pdf being narrower the emulator also allows us to explore variations in the pdf through time as illustrated in fig 15c which shows the pdf of all sst anomalies between point conception and cape mendocino for consecutive 3 year windows through time temporal shifts in the mean of the pdf reflecting anomalously warm and cool periods are very evident on decadal time scales and with peak coast wide ssts reaching 4 c not shown recalling that the original roms simulation spans a period 20 years the statistics of the very long emulator simulation can be used to assess the extent to which the original roms simulation is representative of the alongshore natural variability the standard deviation of the separate 20 year time series that make up the 1000 year emulator simulation i e 50 samples in total was computed and the range i e max and min of values is indicated in figs 15a and 15b for the high pass and low pass filtered sst while the relative latitudinal variations are robust during any given 20 year period the sst standard deviation at any latitude varies considerably between samples thus the original 22 year roms simulation is probably not sufficient to establish a reliable baseline for sst variability along the coast the probability density of vertical velocity anomalies w at 40 m along the same stretch of the california coast is shown in fig 16 from a 1000 year simulation for the case c c w from the emulator based on 100 hankel singular values guided by the findings in fig 14c the geographic bins used were the same as those used for the sst pdfs in fig 15 as shown in appendix b 2 the roms vertical velocities depart significantly from a gaussian distribution in the case of large amplitude upwelling and downwelling events as a result the emulator under estimates the variance in vertical velocity of the original 22 year roms time series as shown in appendix b 3 nonetheless the alongshore variations in the vertical velocity pdfs are faithfully reproduced the 1000 year pdfs in fig 16 associated with high pass filtered variability are broader than the low pass counterpart by up to an order of magnitude at some locations when measured in terms of the standard deviation the pdfs of high pass w vary considerably with latitude along the coast with elevated variance near 38 n point reyes 39 n point arena and 40 n cape mendocino the low pass w on the other hand exhibit less variability and are only markedly elevated near 39 n variations in the coastwide 3 year pdf of w through time are shown in fig 16c unlike the case of sst the pdf of w exhibits much less in the way of interdecadal variations and most of the variation is associated with changes in the width of the pdf i e the standard deviation the range in the standard deviation of w computed from the separate 20 year time series is also shown in figs 16a and 16b for the high pass and low pass filtered time series in contrast to sst upwelling variability along the coast is relatively robust and stable through time at most latitudes as indicated by the standard deviation which varies little from decade to decade the largest interdecadal variations in standard deviation occur near the aforementioned promontories and capes as noted above appendix b 3 indicates that while pdf variance in vertical velocity from the emulator is probably underestimated the relative alongshore variations are most likely reliable 6 discussion while the formal error of balanced truncation decreases as the number of hankel svs retained increases there is considerable flexibility in the level of truncation that may be tolerated here without much justification we have concentrated primarily on reduced dimension systems based on the leading 50 hankel svs mainly to illustrate the efficacy of the approach there is no formal guidance as to the correct choice of the number of hankel svs that should be retained just as there is no formal guidance for how many eofs to retain in a traditional lim as in any empirical statistically based procedure such as this there is some degree of trial and error and informed judgement based on experience a decision on where to truncate the system could be made based on fig 9c which shows the fraction of the variance in the output y t versus the level of truncation for three different choices of c the more variance of the original system that is desired the larger the number of hankel svs that need to be retained this is similar to the same subjective criteria employed in traditional lims when deciding how many eofs should be retained another possibility for deciding on how to truncate the emulator would be to use the expected error in the transfer function shown in fig 9d which in the system considered here is always close to the theoretical lower bound while this information is perhaps less intuitive fig 9d provides information about the frequency of the forcing and the response at which the largest errors are expected taken together figs 9c and 9d provide complementary information that could be used in combination to make an informed decision on what level of balanced truncation would be appropriate for the problem at hand while lower error and a larger fraction of the stochastically induced variance can be expected by increasing the number of hankel svs retained this comes at the expense of increased dimension while the added dimension might not appear large there are however a number of practical advantages to keeping the dimension as low as possible even though some information is inevitably lost for example low dimension translates into fewer degrees of freedom of the system allowing for more transparency in interpreting the dynamics of the response for instance applying the bilinear transformation 7 7 if g z and f s represent the transfer functions for the equivalent discrete and continuous systems respectively then the bilinear transformation that converts from the discrete system to the continuous system is given by s z 1 z 1 conversely the transformation from the continuous system to the discrete system is given by z 1 s 1 s see for example antoulas 2005 section 4 3 3 to 1 reveals that a i 1 a i and 2 a i 1 b represent an example of a continuous multivariate ornstein uhlenbeck stochastic differential equation since the properties of such systems are very well known gardiner 1985 low dimensional descriptions of complex ocean circulations such as those considered here may offer deeper insights by capitalizing on the arsenal of powerful theoretical and algebraic results pertaining to this class of stochastic processes furthermore the probability density function pdf of the system is described by the fokker planck equation where a i 1 a i controls the so called the drift of the mean and 2 a i 1 b is responsible for diffusion of the pdf in addition the elements of a i 1 a i and 2 a i 1 b collectively define the probability current responsible for the flow of probability information between each component of the system these important properties of the system can therefore be more efficiently diagnosed for some components in very low dimension descriptions of the system moreover as demonstrated in sections 5 2 and 5 3 specific oceanographic processes can also be targeted through a judicious choice of c in 2 it is also worth noting that the emulator can be readily extended to include other essential ocean variables for example the roms configuration used here to inform the emulator also includes a biogeochemical component for ocean ph and dissolved oxygen therefore the emulator can be extended to explore the frequency of occurrence of extreme ph and low oxygen events establishing an important statistical baseline for such events under current climate conditions other potential applications of the emulator could include interannual prediction and as discussed in section 1 lims have been used extensively for prediction on a range of time scales while many lim forecasts are based on limited information such as surface fields only the emulator presented here possesses the added advantage that it provides the full 3d circulation fields the linear system 14 in fact provides a natural framework for generating an ensemble of predictions where each ensemble member results from a different realization of the stochastic forcing ξ t however a moment of reflection shows that the time evolution of the ensemble mean is simply given by 14 with ξ t 0 for a system described by gaussian errors the ensemble mean represents the most likely state of the system if the ensemble is reliable then the variance of the ensemble about the ensemble mean is a measure of the uncertainty in the ensemble mean see grimit and mass 2007 for a review furthermore the covariance of the expected error in the ensemble mean γ τ at forecast lead time τ is given by γ τ φ 0 a τ φ 0 a τ t where φ 0 is the zero lag covariance matrix defined in section 3 2 see penland 1989 as expected γ τ φ 0 the climatological covariance as τ since asymptotic stability demands that simultaneously a τ 0 thus all that is required to make a prediction of the ensemble mean and expected error is a single unforced integration of 14 initialized with today s u 1 which can be provided by a real time ocean analysis system such as the west coast ocean forecasting system wcofs https tidesandcurrents noaa gov ofs dev wcofs wcofs info html the efficacy of this approach will be the subject of a future study until now we have dodged any discussion of the physical interpretation of the pops of the emulator section 5 1 though shows that the pops that dominate the stochastically induced response are those that decay slowly in time and that are characterized by interannual to interdecadal timescales it is therefore natural to inquire about the physical nature of these modes as discussed in section 2 reanalyses derived from data assimilation solutions on g1 were used to constrain the open boundaries of the g2 solutions used to inform the emulator using a conventional lim crawford et al 2019 have performed an extensive analysis of the pops derived from the g1 reanalysis fields and showed that they can be identified with the regional expression of well documented climate modes of variability associated with the el niño southern oscillation the pacific decadal oscillation and the north pacific gyre oscillation therefore some of the low frequency variability in g2 will be in response to variations in the boundary conditions low frequency variations in the local surface forcing will also contribute that said however because of the relatively small geographical extent of the g2 grid we should probably not place a too much emphasis on the physical interpretation of an individual pop in the emulator instead what is important is that the pops collectively and faithfully capture the variability present in the original roms time series see appendix b while not shown here the properties of the leading pops were found to be insensitive to the degree of balanced truncation of the emulator as such the pseudo resonant response of the balanced truncation emulator based on a 11 to stochastic forcing will be robust across a wide range of truncation levels so too the behavior and structure of the leading stochastic optimals cf figs 11 and 12 explored on section 5 1 were also found to be insensitive to the number of hankel singular values retained based on experience we also note that there are a number of pitfalls of which the unwary can unwittingly run afoul when dealing with matrices of large dimension one important consideration is that the model time series data used to estimate a in 1 must be archived to 64 bit precision the condition number of the various matrix operations involved in the balanced truncation procedure is also an important consideration especially in situations where eigenvalues and singular values span many orders of magnitude thus matrix inverse calculations should be avoided if at all possible while some inverse calculations are unavoidable others can be circumvented by alternative algorithms antoulas 2005 section 7 3 presents several alternative but equivalent approaches to performing balanced truncation that may be better conditioned than steps 1 3 outlined in section 3 4 the calculations presented in this study were repeated using some of these alternative approaches and the results presented here found to be robust while many of the tools described here are available in matlab wherever possible these authors chose to write much of their own code for greater algorithm transparency this was found to be particularly important when computing the eigen spectra and singular value spectra of large dimension matrices iterative techniques based on the lanczos method golub and van loan 1989 are particularly robust for very large dimension problems and the efficacy of our results was demonstrated in this way also perhaps the weakest of all the assumptions embodied in 1 and 2 is that of white noise stochastic forcing in time fig 6 shows that the stochastic forcing diagnosed from 1 does not possess the autocorrelation properties expected of white noise and the implications of this deserve further investigation fig 6 may suggest that other choices of model might be more appropriate such as a higher order markov model a nonlinear model e g hasselmann 1988 or a system subject to multiplicative stochastic forcing e g martinez villalobos et al 2018 as opposed to the case of additive forcing considered here the nature of the time series from roms necessitates formulation of the emulator in the discrete time form given by 1 there is of course a parallel formulation of all the same ideas presented in section 3 as they apply to time continuous systems some of the important results and theorems that apply to system reduction are more readily derived for continuous systems while others are more transparent when considering a discrete time system the aforementioned bilinear transformation allows results derived for time continuous systems to be reformulated for discrete time systems and vice versa see glover 1984 for an excellent discussion since the resulting discrete and continuous systems are equivalent they have identical gramians p and q the same hankel singular values and the frequency response to forcing is the same lastly we reiterate that an important central theme of this study is the role played by non normal transient growth of stochastically induced perturbations in maintaining the variance associated with low frequency modes of variability however as fig 12 very clearly illustrates the perturbations that are optimal for exciting the low frequency modes are characterized by mesoscale structures that yield over time to the larger scale low frequency modes while this idea is not new our results highlight the fact that if this same behavior carries over into the roms analysis forecast system currently used for the ccs as the recent work of moore and arango 2021 suggests is likely to be the case then significant potential exists for the up scale growth of forecast errors from the ocean mesoscale to the broader scale circulation of the region therefore there is potentially much that can be learned about the dynamics of forecast error growth and the predictability of the ocean from the large samples available from an emulator 7 summary in this study we present results from a low dimensional linear stochastic emulator of the california current system derived from the time evolving 3d circulation fields of a high resolution configuration of roms the model circulation is constrained at the open boundaries by a data assimilative ocean state estimate derived from a lower resolution roms grid the emulator is based on a linear inverse model and balanced truncation which has the advantage that it reliably represents the behavior and stability properties captured by the original time series this is in contrast to the common practice in linear inverse modeling of reducing the dimension based on the leading eofs which does not always faithfully preserve all of the important stability properties of the original system the emulator has a dimension that is 5 orders of magnitude less than the dimension of the ocean state vector and close to an order of magnitude less than the number of state realizations that make up the time series in the present study monthly averaged fields are used so while the number of realizations of the state is relatively modest 102 this study demonstrates that the potential of the approach is significant for example if daily average fields were used instead the number of state realizations would increase to 104 so even a reduction by two orders of magnitude is substantial the eofs of the state vector for such a large problem can be computed using an iterative lanczos algorithm and svd so application to much larger problems is feasible the emulator is driven by stochastic forcing with covariance properties that are diagnosed from the original roms data variance is maintained in the emulator by the stochastic excitation of the pops of the transition matrix which is a linear empirically derived approximation of the underlying dynamical operators that govern roms the evolution of stochastically induced perturbations is controlled by non normal growth a property that is preserved by balanced truncation while this is a proof of concept study the focus here has been on coastal sst and upwelling and demonstrates how emulators can be developed that target specific circulation features associated with both prognostic and diagnostic model variables one important application of the emulator and a motivation for its development is to establish a statistical baseline for variability in the coastal circulation many of the important mesoscale coastal circulation features associated with the california current system can only be resolved using relatively high resolution models which presents a challenge for generating large ensembles of solutions furthermore reliable high resolution ocean surface forcing fields are only available that span limited time periods a linear stochastic emulator such as that developed here provides a way for generating very long time series or large ensembles of the circulation fields at a very small fraction of the cost of the nonlinear model while at the same time preserving the stability properties of the modes of the original system as captured by the data the examples presented here illustrate how the emulator can be used to establish the extent to which the alongshore variations in sst and vertical velocity from the original nonlinear roms simulation can be considered as reliable the utility of the emulator for modeling and forecasting the circulation along the california coast on seasonal to interannual time scales will but the subject of a future study glossary the following is a list of symbols used throughout the manuscript a the time invariant transition matrix for the state vector principal components a the transformed transition matrix given by t a t 1 a 11 the balance truncated transition matrix comprised of the first k rows and k columns of a b the matrix that describes the structure of the stochastic forcing b the transformed b matrix given by t b b 1 the balance truncated matrix comprised of the first k rows of b c the output matrix c the transformed output matrix given by c t 1 c 1 the balance truncated matrix comprised of the first k columns of c d ω the inverse of the distance function in the complex frequency plane e the expectation operator f the covariance matrix of the stochastic forcing ξ f i the eigenvectors of f b b t associated with the stochastic forcing ξ g z the transfer function of the system for frequency z h the block hankel matrix κ the condition number of a matrix l the scaling matrix for δ x p the reachability gramian p i the eigenvectors of p q the observability gramian q i the eigenvectors of q also known as the stochastic optimals r ω the resolvent matrix for frequency ω s the matrix of right singular vectors of the state vector covariance matrix t the balanced truncation transformation matrix that simultaneously diagonalizes p and q t 1 the balanced truncation operator comprising the first k rows of t v the matrix of left singular vectors of the state vector covariance matrix i e eofs x the state vector δ x the departure of the state vector from the mean seasonal cycle δ x the rescaled δ x x the matrix with columns δ x t y the output vector u k t the principal component time series of each eof u t the vector of principal component time series of the eofs υ k the eofs of the state vector λ i the singular values of m 1 x x t μ i the principal oscillation patterns pops eigenvalues of a 11 λ the diagonal matrix of singular values ξ t the vector of white noise stochastic forcing σ the diagonal matrix of hankel singular values φ t the lag t covariance matrix of u ψ i the principal oscillation patterns pops of a 11 credit authorship contribution statement andrew m moore conceptualization methodology writing original draft writing review editing software validation formal analysis jérôme fiechter conceptualization methodology writing original draft writing review editing validation formal analysis investigation data curation investigation resources project administration christopher a edwards writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this material is based upon work supported by the national science foundation under grant no oce 1635315 any opinions findings and conclusions or recommendations expressed in this material are those of the authors and do not necessarily reflect the views of the national science foundation the authors are grateful to the three anonymous reviewers who provided helpful and stimulating comments on an earlier draft of the manuscript appendix a energy scaling for the roms state vector as in section 3 1 we denote by δ x the vector of grid point values of anomalies in free surface elevation δ ζ the horizontal components of velocity δ u and δ v temperature δ t and salinity δ s following moore et al 2006 the state vector transformation matrix l is defined such that e δ x t l t l δ x is the total perturbation energy density of the anomalies given by a 1 e g ρ 0 2 a i j δ ζ i j 2 d a i j v 1 ρ 0 2 i j k δ u i j k 2 δ v i j k 2 h i j k d a i j ρ 0 2 g n 0 2 i j k α δ t i j 2 β δ s i j 2 h i j k d a i j where g is the acceleration due to gravity ρ 0 1025 kg m 3 is the mean ocean density α 1 6 1 0 4 k 1 is the thermal expansion coefficient of sea water β 7 6 1 0 4 is the salinity expansion coefficient of sea water n 0 3 2 1 0 3 s 1 is a representative value of the brunt väisälä frequency and a and v are the total ocean area and volume respectively enclosed by grid g2 the summations are performed over all roms ocean grid cells in the horizontal i j and in the vertical k where d a i j is the horizontal grid cell area and h i j k is the grid cell thickness the first term in a1 represents the perturbation potential energy associated with anomalies in surface elevation the second term is the perturbation kinetic energy due to anomalies in the horizontal velocity and the last term is the available perturbation potential energy associated with anomalies in the density δ ρ which are approximated in the derivation of a 1 using the linear equation of state as δ ρ ρ 0 β δ s α δ t appendix b some consistency checks as noted in section 3 the underlying hypotheses for eqs 1 and 2 are h 1 the data in the form of monthly mean fields from roms can be described by a linear stochastic system driven by noise forcing that is white in time and h 2 the data is completely characterized by the covariance matrix of the state vector u i e the state vector is a gaussian distributed variable e g eq 3 here we attempt to validate these hypotheses and connect the linear stochastic emulator to the data from the original nonlinear model b 1 the stochastic forcing covariance matrix as described in section 3 the roms state is described in the emulator by the pc time series of the eofs of the autocovariance matrix φ 0 therefore if h 1 and h 2 are correct the reachability gramian p given by the lyapunov equation 8 should be identical to φ 0 one might wonder then why we need solve 8 at all the problem of course is that h 1 and h 2 are not satisfied exactly and this can create inconsistencies to illustrate the covariance matrix f of the stochastic forcing could be diagnosed from 8 according to f φ 0 a φ 0 a t however because of deficiencies in h 1 and h 2 the resulting matrix f is invariably not positive definite and cannot therefore be considered as a covariance matrix this issue is discussed in detail by penland 1989 penland and matrasova 1994 and penland and sardeshmukh 1995 who attribute the occurrence of negative eigenvalues of f to nonlinearities in the system that cannot be treated as stochastic forcing thus partially violating h 1 to remedy the problem penland and matrasova 1994 advocate neglecting the eofs of f associated with any negative eigenvalues the alternative approach used here is to estimate f from the residual of 1 using 3 perform the cholesky decomposition f b b t and solve 8 for p the resulting f is by construction positive definite and a comparison of p and φ 0 provides an indication of the validity of our hypotheses with this in mind fig b 1a shows a comparison of the diagonal elements i e the pc time series variances of p and φ 0 derived from the roms data and the agreement is clearly very good unlike φ 0 however the resulting p has non zero off diagonal elements fig b 1b shows log10 of the absolute value of all elements of p and reveals that the off diagonal elements are very small thus indicating that the implied cross covariances between pc time series are negligible while the presence of non zero off diagonal elements in p indicates some degree of failure of the aforementioned hypotheses the fact that the implied cross covariances are very small gives us confidence that p and f are reasonable choices for the problem at hand nonetheless in the absence of complete adherence to h 1 and h 2 some pragmatic decisions must be made such as jettisoning the negative eigenvalues of f as in penland and matrasova 1994 or introducing very weak cross covariances as in the approach used here another plausible approach might be to use only the diagonal elements of p in which case 1 would only approximately satisfy the lyapunov equation 8 this and other possible alternatives clearly warrant further investigation b 2 how gaussian are the target data to explore the extent to which the monthly anomalies from roms are gaussian and satisfy h 2 we will focus on central california sst and vertical velocity anomalies within the target region identified in fig 1 since these are considered in detail in section 5 3 fig b 2a shows a quantile quantile plot qq plot for the sst anomalies within the target region from the 22 year roms simulation and a gaussian distribution with the same mean and standard deviation as the roms data the qq plot follows the 1 1 line over much of the range of the data indicating that the monthly mean central california sst anomalies are generally gaussian the departures of the data from the 1 1 line indicate that the cold warm tails of the roms sst anomalies tend to be somewhat shorter longer than those of a gaussian the qq plot of vertical velocity anomalies at 40 m depth is shown in fig b 2b in this case moderate upwelling and downwelling rates in the range 2 to 2 m day 1 are described well by a gaussian distribution on the other hand the significant departures of the data from the 1 1 line indicate that the tails of the distribution are more heavily populated than a normal distribution in that high vertical velocities occur more frequently than would be expected from a gaussian distribution based on fig b 2a we might therefore expect the emulator to perform well for sst anomalies whereas in light of fig b 2b the emulator will likely under estimate the number of large amplitude upwelling and downwelling events this will be explored in the next section b 3 ability of the emulator to recover probability density of original data in this section we will quantify the ability of the emulator to capture the variability in the original roms time series data as in appendix b 2 we will focus on central california sst and vertical velocity anomalies in light of the results presented in section 5 3 fig b 3a and b3b show the probability density of sst anomalies along the central california coast computed directly from 22 year roms simulation as in section 5 3 the probability density was computed for data bins with a dimension of 0 05 of latitude and extending from the coast to 50 km in the target region identified in fig 1 between point conception 34 8 n and cape mendocino 40 n the probability density for high pass filtered periods less than 3 years and low pass filtered periods greater than 3 years sst are shown separately in figs b 3a and b 3b respectively the pdfs of the high pass filtered sst fig b 3a are quite noisy but exhibit little variation in the overall shape of pdf along the coast the pdfs of the low pass filtered sst fig b 3b on the other hand exhibit considerable variations in shape along the coast of particular interest here are the tails of the distributions associated with extreme events which are accentuated in figs b 3a and b 3b by deep red colors fig b 3b shows that the pdfs of the low pass filtered sst generally have a longer tail for negative anomalies although the distribution for all data are less dispersed than a gaussian the probability density of vertical velocity anomalies w at 40 m along the same stretch of the central california coast computed directly from the 22 year roms simulation is also shown in fig b 3 the geographic bins used were the same as those used for the sst pdfs and the pdfs associated with high pass filtered variability and low pass filtered variability are shown separately in figs b 3c and b 3d respectively the standard deviation of the high pass filtered variability is in some locations almost an order of magnitude larger than the that the low pass component the pdfs of high pass filtered w vary considerably with latitude along the coast with elevated variance near large capes and promontories such as point reyes 38 n point arena 39 n and cape mendocino 40 n the pdfs for the high pass and low pass sst and vertical velocity anomalies simulated by emulators for the same 22 year period are shown in figs b 3e f and b 3g h respectively in the case of sst the emulator is based on c c s s t and 50 hankel svs while in the case of vertical velocity the emulator uses c c w and 100 hankel svs a comparison of figs b 3e f with b 3a b shows that the emulator is able to reproduce well the alongshore variations in the sst pdf at this level of truncation the emulator tends to under estimate a little the standard deviation of the distribution and the length of the tails however increasing the number of hankel svs retained leads to an improvement in these aspects of pdf this is illustrated in fig b 2c which shows the cumulative probability distribution function cdf for sst at the latitude of point arena where vertical velocity variance is high in fig b 3c from emulators based on 50 100 and 200 hankel svs compared to the cdf of the original roms data the steepness of the cdf is reduced by including additional hankel svs which is associated with a broadening of the pdf comparing fig b 3g h with fig b 3c d shows that while the emulator is able to successfully capture the alongshore variations in the pdf of vertical velocity the standard deviation is generally underestimated as are the tails of the high frequency variations this is consistent with the result of fig b 2b as in the case of sst increasing the number of hankel svs retained by the emulator improves the shape of the pdf as illustrated in fig b 2d at point arena as evidenced by a reduction in the steepness of the cdf associated with a broadening of the pdf appendix c a 2 dimensional illustrative example the following example is a variation of those presented in farrell and ioannou 2001a and antoulas 2005 section 7 1 following chhak et al 2006 consider the time continuous system u t a u t ξ t governed by the 2 2 matrix c 1 a μ 1 μ 2 μ 1 cot δ 0 μ 2 where μ 1 and μ 2 are the eigenvalues of a and δ is the angle subtended by the corresponding eigenvectors in this example a time continuous system is chosen rather than a discrete time case for illustrative convenience and ease of interpretation the angle δ controls the degree of nonnormality of a and the system is normal when δ π 2 as in fig c 1a the eigenvalues are chosen so that μ 0 5 and μ 2 10 μ 1 in which case both eigenvectors decay in time according to e μ i t and the system is asymptotically stable as required for convenience the stochastic forcing is assumed to be white in time with covariance given by e ξ t ξ t t i and the observed output y u for the time continuous case the reachability gramian p i e the covariance matrix of the stochastically induced response in u and the observability gramian q are solutions of the lyapunov equations a p p a t i and a t q q a i respectively as discussed in section 4 2 the eigenvectors of an empirically derived transition matrix a are referred to as principal oscillation patterns pops even though a in c1 is algebraic we will adopt the pop terminology from the outset as discussed in section 3 2 the eigenvalues and eigenvectors α i c p i of p and α i o q i of q play an important role in deciding how to reduce the dimension of the system based on energy considerations the eigenvectors p i are the eofs of the stochastically induced response u with an associated variance α i c the eigenvectors q i are called the stochastic optimals farrell and ioannou 1996a and as demonstrated in section 5 1 represent the patterns of stochastic forcing that account in this case for the fraction α i o of stochastically induced variance for the simple example considered here the eigenvalues p and q are the same but this will not generally be the case for a normal system δ π 2 and the pops eofs and stochastic optimals coincide as illustrated in fig c 1a in this case the stochastically induced variance t r p 11 is fairly modest and the leading eof p 1 accounts for 91 of the variance which is exclusively associated with pop1 the leading stochastic optimal q 1 is also aligned with pop1 and p 1 indicating that the stochastic forcing with a structure that is identical to pop1 is the most effective way of generating variance in u the remaining 9 of the variance is accounted for by p 2 which is exclusively aligned with pop2 and q 2 departures of δ from π 2 describe a non normal system and fig c 1b illustrates the case where δ 0 8 π and the pops are thus linearly dependent in this case the total variance t r p 24 9 is higher and the leading eof p 1 which accounts for 96 of the variance is still closely aligned with pop1 the leading stochastic optimal q 1 however which also accounts for 96 of the variance now departs considerably from pop1 and p 1 showing that the stochastic forcing that excites the majority of the variance has a structure that is very different to the structure of the leading pop and eof the disparity between q 1 and p 1 increases with degree of non normality as illustrated in fig c 1c which illustrates the case for δ 0 95 π in this case the pops are almost anti parallel and the total variance rises to t r p 304 9 which is almost exclusively 99 7 accounted for by p 1 however q 1 which recall explains the same fraction of variance is almost orthogonal to p 1 and as such is more closely aligned with p 2 variations in the dot product q 1 t p 2 with δ are shown in fig c 1d which illustrates that the alignment of q 1 and p 2 increases as δ π or δ 0 while they are orthogonal for the normal case δ π 2 therefore even though the elements of the state vector u aligned with p 2 account for a vanishingly small fraction of the variance as δ π or δ 0 stochastically induced perturbations aligned with p 2 become increasingly more effective at maintaining the large variance accounted for by p 1 perturbations with the structure of q 1 in fact evolve very quickly into pop1 see chhak et al 2006 fig c 1d also shows that the stochastically induced variance α 1 c α 1 o accounted for by p 1 and q 1 approaches infinity as δ π or δ 0 conversely the variance α 2 c α 2 o associated with p 2 and q 2 is always close to 1 irrespective of the value of δ not shown it is tempting therefore to reduce the dimension of the system described by c 1 by retaining only the leading eof especially in the case of a highly non normal system since p 1 almost exclusively accounts for all of the stochastically induced variance in u eof p 2 represents the most difficult state of u to reach i e it requires the largest amount of energy to reach so it may be beneficial to reject it however in discarding p 2 fig c 1 shows that for a highly nonnormal system we will jettison stochastically induced perturbations associated with the leading stochastic optimal q 1 which is in fact responsible for all of the variance explained by p 1 in other words q 1 is associated with the easiest i e lowest energy state u that can be observed 
23843,a downscaled reanalysis for the california current system is used to construct a low dimensional linear stochastic emulator of the 3 dimensional time evolving ocean circulation the approach used is based on balanced truncation which simultaneously draws on information from the empirical orthogonal functions eofs and stochastic optimals of the ocean state vector in this way balanced truncation faithfully preserves the inherent stability properties of the data unlike the more traditional approaches based on truncation using eofs alone since balanced truncation is predicated on singular value decomposition formal error bounds on the accuracy of the reduced dimension system can be computed in addition linear stochastic emulators that target different physical processes can also be constructed and examples that focus on a region dominated by coastal upwelling are presented linear stochastic emulators such as that developed here can be exploited to generate very long simulations or large ensembles at high resolution that can be used to establish a statistical baseline for important oceanic processes calculations that would otherwise be very challenging by direct numerical integration an example is presented keywords nonnormality balanced truncation california current system 1 introduction linear inverse modeling of time series data has become very popular during the last two decades or so in the atmosphere ocean and climate sciences due mainly to the influential works of hasselmann 1988 penland and sardeshmukh 1995 and von storch et al 1995 a goal of linear inverse modeling is to identify a low order empirically derived approximation for the dynamical operator that describes the time evolution of time series data specifically capturing the slow timescales while representing the fast timescales as noise while linear inverse models lims have been most widely used in conjunction with observed time series they also provide a useful and compact description of time series from complex numerical models lims are also efficient forecasting tools and have been employed in this capacity on timescales ranging from seasonal to decadal e g winkler et al 2001 alexander et al 2008 hawkins and sutton 2009 aiken et al 2013 cavanaugh et al 2015 huddart et al 2017 newman and sardeshmukh 2017 dias et al 2019 to name but a few at the heart of a lim is the assumption that the system under consideration can be described by a set of linear stochastically forced differential equations while this turns out to be a good approximation in many instances there are situations where nonlinearities turn out to be important e g madja et al 1999 however the inverse model paradigm is not restricted to linear descriptions and more general nonlinear frameworks are also available e g hasselmann 1988 kondrashov et al 2013 in any case the nature and properties of the stochastic forcing diagnosed from such models is also of interest see martinez villalobos et al 2018 for a good discussion and there is considerable interest too in the role of stochastic forcing as a way of accounting for missing processes in models e g berner et al 2017 martinez villalobos et al 2018 provide an excellent review and summary of lim approaches and many recent applications in general lims provide a low order description of a dynamical system and the focus of this study will be the state of the ocean provided by a regional model two aspects of this work set it apart from most previous applications first we seek a low order approximation of the full 3 dimensional 3d multivariate state of the ocean and second the approach used to identify such a model differs from that most commonly used the focus region for this study is the california current system ccs an important eastern boundary current in the north east pacific this work builds on previous studies by crawford et al 2016 2018 2019 who also considered lims of the 3d ocean state derived from a data assimilative reanalysis spanning three decades the approach generally employed in most lim studies is predicated on dimension reduction based on the empirical orthogonal functions eofs of the covariance matrix of the time series data however previous studies in which the true dynamical operators are known have revealed that order reduction based on eof truncation alone is not guaranteed to preserve the stability properties of the system e g farrell and ioannou 2001a and can lead to very erroneous conclusions about the underlying dynamics of the system e g moore and kleeman 2001 such deficiencies arise because the leading eofs account only for the variance of the state and do not capture the small amplitude stochastically induced perturbations that can rapidly amplify and which maintain the variance captured by the leading eofs in the present study we seek a low order approximation of the circulation using the approach of balanced truncation that is commonly employed in dynamical systems theory antoulas 2005 by design order reduction by balanced truncation preserves the stability properties of the original system by simultaneously accounting for the leading modes of stochastically induced variance and the precursors of this variance in the sequel the reduced order linear statistical model based on balanced truncation developed here will be referred to as an emulator to distinguish it from the more traditional eof based lim approach the foundation of balanced truncation is singular value decomposition svd a powerful tool that identifies the fundamental sub spaces occupied by a dynamical system excellent and insightful reviews of svd can be found in lanczos 1961 and klema and laub 1980 specifically the schmidt eckart young mirsky theorem states that a reduced rank approximation a to a matrix a can be identified based on svd of a such that min rank a k a a 2 σ k 1 where σ i are the singular values of a antoulas 2005 and k rank a one important application of lims is to establish a statistical baseline for dynamical variability in relation to climate change scenarios e g newman 2013 thus a motivation for the current work is to build a reliable low order approximation of a 3d high resolution model simulation of an eastern boundary current upwelling environment that can be used to establish a long statistical baseline for important circulation features such as localized upwelling centers and episodes of ocean acidification and low oxygen that develop along the california coast fiechter et al 2018 cheresh and fiechter 2020 specifically the emulator developed here will be used to establish the statistical significance and quantify the extent to which important features of the circulation simulated by the model vary on different time scales this paper is primarily dedicated to a description of the formulation and properties of the emulator and a future study will document in more detail the results of baseline calculations the numerical model used to create the linear stochastic emulator is based on the regional ocean modeling system roms configured for the ccs the roms configuration is introduced in section 2 a brief review of linear inverse modeling is presented in section 3 from the viewpoint of dynamical systems theory where the important ideas that underpin the method of balanced truncation are also reviewed the efficacy of the emulator derived from balanced truncation and lims is presented in section 4 section 5 explores the mechanics of stochastically induced variance focusing on two specific aspects of the ccs circulation namely sea surface temperature sst and coastal upwelling a discussion of the results of this work is presented in section 6 and a summary follows in section 7 there are also three appendices that provide supporting results and ancillary information 2 the roms configuration the basis for the data used to construct the emulator described here is roms roms is a free surface hydrostatic primitive equation ocean model that uses stretched terrain following coordinates in the vertical and generalized orthogonal curvilinear coordinates in the horizontal haidvogel et al 2000 such a coordinate system allows for increased resolution where needed such as in areas with complex bathymetry or in the thermocline and bottom boundary layers roms uses a split explicit time stepping scheme to solve the momentum equations where there is coupling between barotropic fast and baroclinic slow modes shchepetkin and mcwilliams 2003 the roms configuration used here is shown in fig 1 and comprises 2 one way nested grids the outer most grid g1 has a horizontal resolution of 1 10 th degree 10 km while the inner most grid g2 has a horizontal resolution of 1 30 th 3 km both grids have 42 terrain following σ levels in the vertical with 7 100 m resolution in deep water and 0 3 8 m resolution on the continental shelf g1 captures well the large scale and mesoscale circulation environment of the ccs but is only marginally adequate for capturing nearshore coastal upwelling the latter however is well resolved by g2 grid g1 has been used by neveu et al 2016 to compute a sequence of ocean state estimates a so called reanalysis spanning the period 1980 2010 using 4 dimensional variational data assimilation 4d var it is not practical however to run 4d var on g2 to compute best estimates of the circulation for the same period therefore an alternative downscaling approach was adopted here to study the details of coastal upwelling by using the reanalysis fields from g1 to constrain the open boundaries of g2 during a forward run of the nonlinear roms in this way the circulation in g2 benefits from observations assimilated into g1 in this case the period considered here is the shorter time interval jan 1988 dec 2009 surface fluxes of momentum heat and freshwater fluxes adjusted by data assimilation in g1 were used as the forcing for g2 for the period considered surface atmospheric forcing for g1 was based on the cross calibrated multi platform winds of atlas et al 2011 and the ecmwf era40 1988 2001 and era interim 2002 2010 products for all other variables sea level pressure air temperature rainfall etc a detailed description of the g1 g2 nested configuration is provided in fiechter et al 2018 as noted in section 1 the primary motivation for the g2 roms configuration is to simulate in detail alongshore variations in the circulation associated with localized upwelling centers such centers of action are also often harbingers of episodes of ocean acidification and low oxygen that significantly impact local marine ecosystems and fisheries fiechter et al 2018 cheresh and fiechter 2020 in order to establish how climate change might influence the frequency of such events it is important to reliably establish their statistics under current climate conditions however the duration of the roms g2 simulations is limited by the availability of reliable high resolution surface and open boundary conditions and it is by no means clear whether the 22 year roms time series is adequate for establishing the statistical significance of the alongshore circulation variability in the following we demonstrate how these data can be used to develop a linear approximation of the roms simulations from which much longer time series and large ensembles can be computed at very low computational cost 3 linear inverse modeling 3 1 description of a dynamical system as noted in section 1 a goal of linear inverse modeling is to construct a low order approximation of a high dimensional system characterized by slow and fast timescales such a low order approximation is particularly useful in the case of time series data derived from numerical models in the present study we will be concerned with time series of 3d multivariate fields of temperature salinity two components of horizontal velocity and sea surface elevation sampled from the roms configuration described in section 2 thus we will denote by x t the n 1 column vector of the n grid point values of the roms state vector at time t in the sequel and without loss of generality t will simply represent a counter to distinguish each realization of x furthermore we will consider anomalies δ x t about a climatology so that δ x t x t x where x denotes the mean seasonal cycle with this in mind consider a time series comprising m realizations of the anomalies δ x t where t 1 m since δ x is multivariate the physical units of the elements will vary across the state variables e g c for temperature ms 1 for velocity etc in later sections it will be necessary to perform a coordinate transformation on δ x which yields a common unit so that δ x t l δ x t the transformation matrix l used here will be discussed further in section 3 2 in addition and for convenience we will arrange the δ x t as the columns of the n m matrix x for most geophysical systems of interest m n so that the covariance matrix of the time series data m 1 x x t will be at most of rank m therefore it is generally much more convenient to work in the space spanned by the m eigenvectors of m 1 x x t since this will be a space of much smaller dimension than that of the state vector these eigenvectors are the eofs of the state vector and provided that we retain all m eofs no covariance information about the time series δ x t will be sacrificed the assumption here of course is that δ x is described by a linear gaussian system so that all the information about system is captured by the covariance matrix the validity of this assumption for the ccs roms simulation is discussed in appendix b the eof description of the time series is also complete in the sense that we can express any single realization as a linear combination of the eofs according to δ x t k 1 m u k t v k where v k denote the eofs and u k t are the time series of eof amplitudes also known as the principal component pc time series a convenient approach to linear inverse modeling is then to identify a low order approximation for the pc time series u t u k t which is a m 1 column vector comprising the amplitudes of all eofs at time t penland 1989 penland and sardeshmukh 1995 in this study we employ the approach of balanced truncation which is commonly used in dynamical systems theory antoulas 2005 therefore to introduce the formulation of balanced truncation we will recast the problem in the input output framework commonly employed by the dynamical systems community a glossary of mathematical symbols used and their definition is provided after section 7 as an aid to the reader specifically we assume that the vector of pc time series u t can be described by the following system of discrete linear equations 1 u t 1 a u t b ξ t 2 y t 1 c u t 1 where a is the transition matrix for the pc time series that advances u t by one time step and ξ t is an input forcing with properties described by b a common approach in geophysical linear inverse modeling is to assume that a describes the slow time scales of the system which are influenced by the fast timescales represented by b ξ t it is common therefore to treat ξ t as a white noise stochastic forcing in time such that e ξ t ξ t t i where e is the expectation operator and b b t describes the covariance of the stochastic forcing in space e g von storch et al 1995 penland and sardeshmukh 1995 thus eq 1 describes how the state u t evolves in time dynamical systems theory recognizes that the output of the system may not represent the state itself but rather a subset of the state or a linear function of the state with this in mind the vector y t 1 in 2 represents the observed output defined by the matrix c that operates on u t 1 for example while collectively the pc time series u t describe the entire ocean state vector y might comprise only the sea surface height in the sequel we will assume that ξ t is a white noise stochastic forcing in this case if we right multiply the discrete stochastic difference equation 1 by u t t it is easy to show that 3 a φ 1 φ 0 1 where φ 1 e u t 1 u t t and φ 0 e u t u t t are respectively the lag 1 and lag 0 autocovariance matrices of the anomalies and in deriving 3 it is assumed that e ξ t u t t 0 i e u is a non anticipating function of the stochastic forcing in that u at time t does not depend on the future stochastic forcing gardiner 1985 from the orthogonality properties of the pc time series it is easy to show that φ 0 d i a g λ k 2 where λ k 2 are the eigenvalues of the state vector covariance matrix m 1 x x t and represent the fraction of the variance in δ x that is explained by eof v k in general terms the dynamical system can be viewed as a series of inputs ξ t and a series of outputs or observations y t this basic view is referred to as the external description of the system alternatively the same system can be described in terms of the state u t by 1 and 2 which is referred to as the internal description transforming from the external description to the internal description is challenging and is referred to as the realization problem e g feldman and heinig 1996 solving the realization problem amounts to finding the combination of matrices a b and c with the smallest possible dimension that describes the system and is a goal of linear inverse modeling given the nature of the system considered in this study a can be identified as an approximation of the linearized primitive equations see section 4 2 where b describes the statistical properties of the non linear interaction terms we will consider initially the situation where c is the identity matrix in which case the system output considered is the equivalent to the entire ocean state vector other choices of c that target specific aspects of the circulation will be considered in section 5 2 3 2 application to roms as noted in sections 1 and 2 our goal is to construct a low order approximation of a roms solution that can be used to emulate the behavior of the system over much longer time intervals or equivalently to generate large ensembles than can typically be achieved through direct integration of roms per se following crawford et al 2019 we choose the transformation matrix l introduced in section 3 1 so that δ x t δ x δ x t l t l δ x yields the total perturbation energy density see appendix a for details in the present example the dimension n of δ x is o 106 107 and the eofs of the lag 0 autocovariance matrix m 1 x x t were computed using svd specifically we can write m 1 2 x v λ s t 1 1 the vector j th column of s represents the pc time series u j t t 1 m of eof v j while the i th row of s represents the vector u t of all eof amplitudes at a single time t where v is the n m matrix of eofs v i also known as the left singular vectors s is the m m matrix of principal component time series s i u i t for t 1 m also known as the right singular vectors and λ d i a g λ i is the diagonal matrix of m singular values λ i the left and right singular vectors are related according to 4 m 1 2 x s i λ i v i 5 m 1 2 x t v i λ i s i from which it follows that m 1 x t x s i λ i 2 s i since x t x is a m m matrix and typically m n it is more expeditious to solve for the right singular vectors s i and use 4 to compute the associated 3d multi variate eofs v i the focus here is a physical ocean circulation that has reached a statistically steady state in which case φ 1 and φ 0 in 3 are stationary leading to an autonomous i e time independent transition matrix a which is implied a priori in the above development as a consequence of stationarity 1 represents a stable linear system meaning that the eigenvalues μ of a are such that μ 1 and variance in the system is maintained by the stochastic forcing b ξ t 3 3 reachable and observable states as noted in section 1 it is common practice to reduce the dimension of the linear system 1 by retaining only the leading m m n eofs when computing a according to 3 the criterion used to determine the appropriate choice of m is the percentage of state vector variance that is retained however as we will demonstrate truncating the system based on the number of eofs can radically alter the stability properties of the transition matrix a and can be detrimental therefore we employ here the approach of balanced truncation which is commonly used in dynamical systems theory antoulas 2005 the solution of 1 is given by u t 1 a t u 1 n 1 t a t n b ξ n in the case where 1 is described by an asymptotically stable system as here then as t the contribution of the initial condition u 1 becomes negligible and u t 1 is determined by the evolution through time of perturbations introduced by the stochastic forcing ξ the stochastic forcing can be viewed as a sequence of impulses and the matrices h n 1 ca n b referred to as the markov parameters describe how each impulse contributes to the output y t 1 in 2 more specifically y t 1 ca t u 1 h 1 ξ t h 2 ξ t 1 h k ξ t 1 k which can be viewed more generally in terms of a hankel operator which maps past forcing ξ t for t 1 τ to the outputs y τ 1 where τ 1 t antoulas 2005 for the discrete system 1 and 2 the hankel operator can be expressed as a block hankel matrix h comprising the markov parameters and takes the form 6 h cb cab cab c a 2 b c a 2 b c a 3 b c a 2 b c a 3 b c a 4 b which becomes doubly infinite in dimension as t the singular values of h are called the hankel singular values svs and are invariant for any linear invertible transformation of the system 1 and 2 therefore any attempt to reduce the dimension of the system should be based on the hankel svs which is the foundation of balanced truncation glover 1984 this in contrast to the approach usually adopted in a traditional lim where dimension reduction is based solely on the eigenvalues of the covariance matrix φ 0 as described next rather than working directly with the hankel matrix which is very large and cumbersome the hankel svs and appropriate balanced truncation are computed from two related matrices of much smaller dimension that contain the same information as h the influence of the forcing ξ t on the system state can be quantified in terms of the covariance of u which as t can be expressed as 7 p n 0 a n b b t a n t the covariance matrix p is also referred to as the reachability gramian 2 2 if w w i is the matrix comprising column vectors w i the gramian is the name given to the matrix of inner products w t w and captures the sub space of the system that is reachable given the inputs ξ t for an asymptotically stable system p is the solution of the discrete lyapunov equation see glover 1984 8 p a p a t b b t 0 and plays a central role in linear stochastic dynamical systems theory since it provides information about the set of states u that can be reached by manipulating the stochastic forcing ξ t alone since p is a covariance matrix for the system it provides information about all the states that have been visited or that were reachable in the past under the action of forcing alone i e u 1 0 then for all possible forcings b ξ t the minimum energy 3 3 the term energy is used here in a general sense to represent the l2 norm regardless of the units more generally this can be viewed as the variance of the quantity under investigation required to steer the system to the state u r is given u r t p 1 u r thus p 1 determines the minimum amount of energy required to reach a particular state therefore the eigenvectors of p can be identified as the semi major axes of a hyper ellipse that encompasses all states that can be reached by input energy 1 moore 1981 if the hypotheses about nature of the stochastic forcing and the gaussian nature of δ x that underpin 1 and 2 are correct then p will be given by φ 0 in general these hypotheses will not be satisfied exactly in which case p represents an approximation of φ 0 for the present case the degree of consistency between p and φ 0 is rather good as discussed in appendix b 1 however to avoid confusion we will denote the covariance matrix of u arising from 1 and 2 as p consider now the output of the system y t 1 given by 2 in the case when ξ t 0 or equivalently where the system is stochastically forced over some time interval and then the stochastic forcing is removed and the system allowed to freely evolve at future times the time integrated squared energy of the output i e the total variance due to the initial input u 1 is given by u t 1 q u 1 where q is the so called the observability gramian given by 9 q n 0 a n t c t c a n for an asymptotically stable system q is the solution of the discrete lyapunov equation glover 1984 10 a t q a q c t c 0 the matrix q also plays a central role in linear stochastic dynamical systems theory and provides information about the set of outputs y that can be observed by manipulating u 1 alone or more generally by manipulating an impulse forcing at a single time step a useful result here is that the maximum observation energy that can be generated by the initial state u 1 u 0 is given by u 0 t q u 0 the eigenvectors of q can then be identified as the semi major axes of a hyper ellipse that defines all unit energy observation states moore 1981 the interpretation of the gramians p and q in terms of the energy or more generally input variance required to reach a particular state and the energy or variance of the output provides a useful reference point going forward for example the most difficult states to reach require a large input of energy cf a large variance in b ξ t and are associated with the smallest eigenvalues of p similarly the states that are most difficult to observe are those with small output energy i e small output variance and are associated with the smallest eigenvalues of q therefore when constructing a reduced dimension approximation of 1 and 2 it might be prudent to eliminate states that are difficult to reach and difficult to observe however these two aspects of the system are often at odds with one another in that the states that are easy to reach may be difficult to observe and vice versa i e the eigenvectors of p and q may be close to orthogonal to each other this can lead to serious difficulties when attempting to reduce the dimension of 1 and 2 this is in fact an important and perhaps ubiquitous property of systems for which a in 1 is nonnormal i e is described by non orthogonal eigenmodes the properties of nonnormal operators in geophysical fluid dynamics have been explored in detail by farrell and ioannou 1996a b the eigenvectors of p are the familiar eofs of the system and describe the patterns of stochastically induced variance ordered according the associated eigenvalues the eigenvectors of q are referred to as the stochastic optimals farrell and ioannou 1996a and represent the patterns of stochastic forcing that account for different fractions of the stochastically induced variance when ordered according the associated eigenvalues a simple but highly illuminating 2 dimensional example of these important and fundamental ideas is presented in appendix c readers who are unfamiliar with these ideas are encouraged to review appendix c before moving on 3 4 balanced truncation as the example of appendix c illustrates any attempt to reduce the dimension of the system described by 1 and 2 must simultaneously retain information not only about the eofs that account for the largest fractions for variance but also information about the input forcing that can excite them what is required is a balancing transformation in which the states that are easy to reach also correspond to the states that are easy to observe in such a system the reachability and observability gramians p and q are simultaneously diagonalized and are identical and given by the matrix σ d i a g σ i of singular values of the block hankel matrix h in 6 practically the hankel svs σ i can be computed from the product pq which has eigenvalues given by σ i 2 the balancing transformation can be exploited for dimension reduction of the system in a procedure referred to as balanced truncation of which there are several variants as described by antoulas 2005 here we follow the approach originally developed by moore 1981 and which has been applied in meteorological applications by farrell and ioannou 2001a b specifically consider the transformation φ t u where 1 and 2 become 11 φ t 1 a φ t b ξ t 12 y t 1 c φ t 1 where a t a t 1 b t b and c c t 1 indeed as shown by glover 1984 the eigenvalues σ 2 d i a g σ i 2 of tpq t 1 are invariant under the transformation and represent an appropriate premise on which to reduce the dimension of the system the transformation t is thus chosen so that the corresponding reachability and observability gramians for 11 and 12 are p tp t t σ and q t 1 t q t 1 σ respectively the transformation matrix that simultaneously diagonalizes p and q in this way can be identified as follows 1 compute the cholesky factorization i e square root of p p 1 2 p 1 2 t 2 compute the eigendecomposition of p 1 2 t q p 1 2 k σ 2 k t 3 compute the balancing transformation and its inverse according to t σ 1 2 k t p 1 2 and t 1 p 1 2 k σ 1 2 where p 1 2 denotes the inverse of the cholesky factorization from step 1 dimension reduction of the system is then achieved by retaining only the leading hankel svs of the diagonal matrix p q σ which has eigenvectors given by the columns e i of the identity matrix in other words the eofs and stochastic optimals of the transformed system are identical truncating the system based on the hankel svs partitions a b c and φ according to 13 a a 11 a 12 a 21 a 22 b b 1 b 2 c c 1 c 2 φ φ 1 φ 2 specifically t is an m m matrix and if the leading k hankel svs are retained the reduced variable φ 1 t 1 u where t 1 is the k m matrix comprising the first k rows of t and t 1 1 is the m k matrix comprising the first k columns of t 1 the resulting truncated transition matrix a 11 in 13 is then the submatrix comprised of the first k rows and k columns of a and the reduced system is described by 14 φ 1 t 1 a 11 φ 1 t b 1 ξ t 15 y 1 t 1 c 1 φ 1 t 1 where b 1 t 1 b and c 1 c t 1 1 balanced truncation in this way has the important property of preserving the stability properties of the original transition matrix a it is important to note that since the truncation is based on the hankel svs and not on the state vector eofs the balanced reduced system potentially draws information from all of the eofs 4 a roms emulator before proceeding a comment on the limited extent of the time series used here is appropriate our time series span the 22 year period jan 1988 dec 2009 and clearly it is not possible to unambiguously identify potential modes of variability in the circulation with periods longer than this this of course is self evident and will become clear from the eigenmode analysis of a presented in section 4 2 however the stochastic nature of 1 does not preclude the presence of variability on time scales longer than 22 years at each time step the stochastic forcing will randomly excite the eigenmodes of a with time varying amplitudes and quite naturally periods of enhanced variability and suppressed variability will arise in long time series generated by the emulator as we shall see the duration of these periods of high and low variance are not tied to the length of the original roms time series in any obvious way and can most certainly exceed the period of the lowest frequency eigenmode of a that can be resolved as noted in section 1 a motivation for the emulator presented here is to establish a statistical baseline for high impact circulation events along the california coast as simulated by a high resolution ocean model our focus therefore is not on the problem of ocean prediction or predictability where the length of the original model time series is an important consideration see for example zanna 2012 wunsch 2013 however an implicit assumption made in the following sections is that the matrix a derived from the covariance of the 22 year roms time series according to 3 and the covariance of the diagnosed stochastic forcing b b t in 1 are time invariant and representative of a much longer period nonetheless as noted later sub samples of the simulations made with the emulator for time intervals longer in duration than the original roms time series can be viewed as ensembles of state vector realizations arising from different initial conditions 4 1 eofs of the roms ccs the focus of this study is circulation variability on timescales ranging from seasonal to interannual as such we use monthly averaged fields from roms to define the ocean state vector x t introduced in section 3 1 variability on shorter sub seasonal timescales will be the topic of a separate study with this in mind δ x t represents departures of the monthly mean fields from a seasonally varying climatology the period jan 1988 dec 2009 therefore represents a total of m 264 samples of state vector anomalies δ x t as discussed in section 3 2 the state vector anomalies are rescaled according to δ x l δ x where l defines the square root of the perturbation energy density as described in appendix a within the predominantly quasi geostrophic regime considered here the available potential energy is larger than the kinetic energy so the temperature and salinity fields receive a larger weight than the velocity field nonetheless it is important to include all fields in the definition of δ x in light of the role that small variance fields can play in controlling the non normal behavior of the system see appendix c the rescaled anomalies δ x are arranged to form the columns of the n m matrix x where n 7 911 743 the total number of ocean grid point variables in g2 4 4 in practice ocean points within 90 km of the open boundaries were ignored when computing the eofs so as to eliminate unwanted influences of imperfect boundary conditions since m n only the leading m eofs of the covariance matrix of the roms state vector can be estimated as described in section 3 2 svd was used to identify the eofs and fig 2a shows the spectrum of eigenvalues λ i 2 i e the squared singular values the eigenvalues represent the contribution of each eof to the total energy density e δ x t δ x e δ x t l t l δ x t r φ 0 fig 2a shows that the eigenvalues span 4 orders of magnitude the cumulative percentage energy density explained by the eofs is shown in fig 2b and indicates that first eof explains 20 of the energy density while the leading 50 eofs collectively account for 87 this increases to 95 and 98 for the first 100 and 150 eofs respectively in practice only the leading 230 eofs were used in the calculations presented here so as to improve the numerical conditioning of the calculations the leading 230 eofs account for 99 7 of the total energy density so the information that is lost by discarding the trailing 34 members of the eigen spectrum is very small the sea surface height ssh sea surface temperature sst and sea surface salinity sss associated with the leading 3d multivariate eofs are shown in fig 3 the structures of the eofs are varied and spatially coherent for example the eof 1 sst fig 3b is characterized by anomalies of the same sign across the entire g2 domain these anomalies extend to depths of between 100 m and 300 m as illustrated in figs 4a and 4c which show vertical sections of eof1 temperature over the upper water column along zonal sections at the latitudes of cape mendocino 40 4 n and point conception 34 4 n conversely the eof 1 sss fig 3c changes sign around 124 w at cape mendocino fig 4b the salinity anomaly occupies the upper 250 300 m of the water column offshore and shoals near the coast while at point conception fig 4d the anomalies display a weak quadrupole structure in the case of ssh eof 1 exhibits anomalies of largely the same sign over much of the domain with elevated values along the coast fig 3a the principal component pc time series s i associated with the leading 3 eofs are shown in fig 5 all 3 eofs display significant inter annual variations and s 1 in particular exhibits a low frequency component 4 2 a 1 st order markov model following 1 the pc time series for each eof were modeled as a stochastically forced system since the eofs are based on δ x sampled every month the time step implied in 1 is also one month following section 3 1 the stochastic forcing b ξ t in 1 represents the rectified effect of variability on timescales much shorter than one month and was assumed to be white noise in time so it is important to first test the validity of this assumption the transition matrix a was computed from the lag 1 and lag 0 autocovariance matrices according to 3 and b ξ t was estimated as the residual u t 1 a u t the autocorrelation function of the stochastic forcing averaged over all m pc time series is shown in fig 6 white noise in time decorrelates over a single time step but as fig 6 shows that associated with b ξ t tends to overshoot at lag 1 and lag 2 before approaching zero this perhaps suggests that a higher order markov model may be appropriate however as we will demonstrate the assumption of a 1st order model subject to white noise forcing nonetheless performs very well having diagnosed the stochastic forcing b ξ t as described above the forcing covariance f b e ξ t ξ t t b t b b t where the last equality follows from the requirement that e ξ t ξ t t i therefore a cholesky factorization f b b t yields the b matrix in 1 the efficacy and implications of this approach are discussed in appendix b 1 the choice of c in 2 will be discussed shortly while 1 and 2 are a mathematical construct before proceeding it is appropriate to comment on the physical nature of the stochastic forcing b ξ t in the context of the present study the system described by 1 essentially represents a 1st order linearization of the primitive equations since the primitive equations are nonlinear to 2nd order only it is the nonlinear interaction between anomalies that have been ignored in 1 thus we can view the stochastic forcing b ξ t as representing the nonlinear backscatter of energy in the space spanned by the eofs into the linear components of the flow in the ocean however we also have to contend with surface fluxes of momentum heat and freshwater in which case b ξ t will contain some expression of stochastic variations in the atmospheric marine boundary layer on timescales shorter than one month in addition since our attention is confined to a limited region of the ne pacific stochastic variations in the open boundary conditions will also contribute to b ξ t while most of these stochastic processes will have time scales shorter than the monthly time step employed here in 1 the degree of separation of the fast and slow time scales that are being modeled by 1 deserves further investigation the eigenvectors of a provide important information about the response of the system to stochastic forcing these eigenmodes are also referred to as the principal oscillation patterns pops hasselmann 1988 and are empirical approximations of the normal modes of the dynamical system pedlosky 1979 even though a is a real matrix its eigenvalues and eigenvectors in general take the form of complex conjugate pairs the complex eigenvalue spectrum μ i of a derived from 3 is shown in fig 7a as noted in section 3 2 since a is constructed from statistically stationary time series of δ x it is asymptotically stable in that a t 0 as t which means that μ i 1 for all eigenvalues fig 7a shows that this is indeed the case where all of the μ i lie within a unit circle on the complex plane by expressing the eigenvalues in the form μ j a j e i σ j the oscillatory nature of each eigenvector becomes apparent where log a j is the decay rate of the corresponding eigenvector and 2 π σ j is the eigenvector oscillation period the period and decay rates of the pops of a are shown in fig 7b where the stable nature of each pop is very evident fig 7b indicates that there are several slowly decaying pops with low frequencies and periods of 21 0 048 years 1 10 0 1 years 1 7 0 14 years 1 5 4 0 16 years 1 and 4 0 25 years 1 years a discussion of the physical interpretation of the leading pops is postponed until section 6 after we have explored how well they can be recovered by balanced truncation 4 3 balanced truncation as discussed in section 1 a common approach to linear inverse modeling is to reduce the dimension of the system based on an eof truncation of 3 however such an approach can severely alter the stability properties of the system and potentially lead to erroneous behavior to illustrate a reduced dimension approximation of the transition matrix a in 1 was constructed by retaining the leading 50 state vector eofs of m 1 2 x which account for 87 of the energy density of the roms monthly mean circulation anomalies cf fig 2b fig 7a shows the complex eigenvalue spectrum for the resulting lim and indicates that the spectrum is dramatically different to that of the original system as required the reduced dimension lim is still stable but the period and decay rate of the resulting pops depart significantly from those of the original system as shown in fig 7b like the original system there are still low frequency pops but they decay very rapidly in the reduced dimension system the situation is similar when different numbers of eofs are retained in the lim not shown balanced truncation described in section 3 4 is an alternative approach for constructing a reduced dimension model that preserves the stability properties of the original system the truncation depends on the choice of c in 2 i e on the aspect of the system that is being observed we will consider first the case where c i the m m identity matrix which is equivalent to the case where the entire state vector anomaly δ x constitutes the observed output additional cases of interest for the ccs will be considered in section 4 the reachability gramian p and observability gramian q were computed by solving the lyapunov equations 8 and 10 respectively 5 5 in practice p and q can also be computed directly from 7 and 9 for a sufficiently large number of time steps n for the stable system considered here a n approaches zero quite quickly as n increases and for n 1000 the directly computed estimates of p and q based on 7 and 9 agree with the solutions of 8 and 10 as discussed by antoulas 2005 there are other alternative methods for directly computing p and q the eigenpairs of p and q will be denoted by α i c p i and α i o q i respectively and fig 8a shows both eigenvalue spectra for the case c i in both cases the spectra span 2 3 orders of magnitude and apart from a short steep tail at the ends of the spectra the eigenvalues decrease relatively slowly in between as discussed in section 3 3 α i c 1 2 p i represent the semi major axes of a hyper ellipse whose surface represents all the states u of the system that can be reached by stochastic forcing b ξ with a variance 1 moore 1981 since p is the covariance matrix of u the eigenvectors p i represent the eofs of u however we will generally refrain from referring to them as such here so as to avoid confusion with the state vector eofs v i of section 3 2 used to compute a in a similar vein α i o 1 2 q i represent the semi major axes of a hyper ellipse whose surface represents all of the outputs y that arise from all unit norm initial conditions u 1 the singular values of the corresponding block hankel matrix h 6 are shown in fig 8b as described in section 3 4 balanced truncation is based on reducing the dimension of a in 11 by retaining the leading hankel svs leading to 14 and 15 in accordance with the schmidt eckart young mirsky theorem mentioned in section 1 the formal error in the truncated approximation of the system described by 1 and 2 decreases as the number of hankel singular values retained increases the decision on where to truncate the hankel singular value spectrum will depend on the application under consideration and will be discussed further in section 6 for now and to illustrate the efficacy of the approach we will mainly consider here a truncation based on the leading 50 hankel svs with this in mind fig 7a shows the eigenvalue spectrum for a 11 based on the leading 50 hankel svs while there is no formal requirement for a and a 11 to share any of the same eigenvalues fig 7a clearly indicates that the balanced truncation is very effective at maintaining the stability of the original system by capturing the least damped eigenvectors this is further illustrated in fig 7b which shows the frequency and decay rate of the pops of a 11 and indicates that the long period least damped pops of the original system 1 are well represented the pops of a 11 with lowest frequencies have periods of 21 10 7 3 5 3 and 4 1 years for this choice of truncation which are very close to those of a fig 7 indicates that a 11 has a single errant pop which recall occur in complex conjugate pairs which departs significantly from the original spectrum this particular pop however is not robust and other choices for the level of truncation based on the number of retained hankel svs eliminate it not shown however for transparency we continue with an analysis of the truncated system based on 50 hankel svs one measure of the efficacy of the reduced system is illustrated in fig 9a which shows time series of the energy density y t y from a 100 year integration of the original system 1 and 2 and y 1 t y 1 from the reduced system 14 and 15 the expected variance of the output y can be computed directly from p and q according to 16 t r y t y t t t r c p c t t r b t q b t r q b b t also shown in fig 9a is the expected energy density of 2 based on t r b t q b and of 15 based on t r b 1 t q 1 b 1 while the truncated system described by a 11 underestimates the energy density by 38 the correlation between the time series is 0 86 most of the missing variance in the reduced system is associated with variations on decadal time scales as indicated in fig 9b which shows the power spectra computed from t r g t z g z where g z c z i a 1 b is the transfer function and z e i ω where ω is the frequency the percentage energy density captured by 16 versus different levels of truncation is shown in fig 9c it is important to note that fig 9c is distinct from fig 2b in balanced truncation information from all of the state vector eofs v i is potentially retained regardless of the level of truncation the error in the reduced system can be expressed in terms of g z according to σ k 1 g 1 z g z h 2 i k 1 m σ i where g 1 z represents the transfer function of the reduced system obtained by retaining the leading k hankel svs σ i and h denotes a hardy norm and is the maximum singular value for all possible z 0 2 π the origin of the upper bound 2 i k 1 m σ i is discussed by glover 1984 while the lower bound of σ k 1 is a direct consequence of the schmidt eckart young mirsky theorem as discussed by farrell and ioannou 2001a following glover 1984 lemma 9 5 and zhou and doyle 1998 section 4 2 the expected error in g 1 z can be evaluated according to g 1 z g z h max re z 0 σ c z i a 1 b where the right hand side represents the maximum singular value of the expression in the square braces and a a 11 0 0 a b b 1 b c c 1 c fig 9d shows the expected error g 1 z g z h as a function of the number of hankel svs retained in the balanced truncation for the case c i also shown are the expected upper and lower bounds on g 1 z g z h while the upper and lower bounds generally span a wide range fig 9d shows that the expected error g 1 z g z h is always close to the lower bound σ k 1 formally the transfer function g z is defined as the ratio of the z transform of the output y t and the z transform of a constant frequency harmonic forcing therefore g 1 z g z h can be interpreted in terms of the frequency component of the stochastic forcing ξ t that yields the largest error in the output y t glover 1984 with this in mind fig 9d also shows the period of the forcing frequency associated with g 1 z g z h and indicates that in general the expected error is associated with higher frequency forcing i e shorter periods as the number of hankel svs retained increases a discussion of the appropriate level of truncation will be postponed until section 6 5 stochastically induced variability in this section we will focus on the mechanics of the stochastically induced variability in the reduced system from balanced truncation described by 14 and 15 with a focus later on coastal upwelling 5 1 stochastic optimals figs 9a and 9b indicate that variability occurs in the system on a wide range of timescales despite the stochastic nature of the forcing in 1 and 14 it is of interest therefore to explore how this variability arises particularly in the case of the low frequency variability which is so evident in fig 9a according to 16 the stochastically induced variance in the output y in 2 can be expressed as e e y t y t r b t q b and similarly for 15 e 1 t r b 1 t q 1 b 1 since q and b b t are symmetric matrices the variance can also be expressed as 17 e i 1 m j 1 m α i o f j q i t f j 2 where α i o q i are the eigenpairs of q introduced in section 4 3 and f j f j are the eigenpairs of f b b t the covariance matrix of the stochastic forcing the latter therefore represent the eofs and explained variance of the stochastic forcing as noted in section 3 3 and discussed in appendix c the eigenvectors q i are called the stochastic optimals following farrell and ioannou 1996a when ordered according to descending eigenvalues α i o the stochastic optimals q i represent in order of importance the spatial structures of the stochastic forcing that are most effective at inducing variance in the system thus 17 demonstrates that the stochastically induced variance is determined by the weighted sum of the projection of the stochastic forcing eofs onto the stochastic optimals i e q i t f j as the simple 2 2 example presented in appendix c illustrates the stochastic optimals provide insight into how the eofs of the system response i e p i can be maintained indeed as illustrated by the same example the degree of non normality of the transition matrix a plays a central role in the process whereby low energy inputs can yield very large amplitude outputs the fraction of e 1 accounted for by each stochastic optimal of the system 14 and 15 based on the leading 50 hankel singular values is shown in fig 10 stochastic optimal q 1 yields 16 of the stochastically induced variance and the leading seven stochastic optimals account for 50 of e 1 it follows from 17 that the stochastic forcing b 1 ξ t in 14 can also be expressed as a linear combination of the stochastic optimals therefore at each time step t a perturbation will be introduced into the system with the structure of a stochastic optimal to elucidate further the role that the leading stochastic optimal q 1 plays in promoting variance we will therefore explore the time evolution of a unit amplitude perturbation with the structure of q 1 by considering the initial value problem for 14 corresponding to u 1 1 t 1 1 φ 1 1 q 1 and ξ t 0 where the labeling of u 1 conforms with the convention adopted in 13 fig 11a shows a time series of the energy density e 1 t u 1 t t u 1 t of the perturbation u 1 t t 1 1 φ 1 t for the case initialized with u 1 1 q 1 and integrated for 30 years with ξ t 0 initially e 1 grows rapidly and reaches a peak after about 4 years after which time there is a decline in energy while the perturbation will project onto all of the state vector eofs the evolution is dominated by the leading eof as illustrated in fig 11a which shows time series of the amplitude u i t of the leading five state vector eofs v i the amplitudes of the other eofs components are small however while the time evolution of the perturbation is clearly dominated by v 1 the initial contributions of the other eofs are critically important as we shall see recall that a 11 is asymptotically stable cf fig 7 so one might wonder how the energy growth in fig 11a is possible at all the example in appendix c provides the answer while it is the case that the system must approach a state of rest as t the energy density e t can nonetheless undergo transient growth due to the interference of the non orthogonal pops of t 1 1 a 11 t 1 the solution of the truncated system 14 can be represented as a linear superposition of the pops according to u 1 t t 1 1 φ 1 t j 1 k γ j μ j t 1 ψ j where μ j ψ j are the eigenpairs associated with each pop and k is the number of hankel singular values retained the coefficients γ j represent the projection of u 1 t onto each pop and for the initial value problem considered here are given by q 1 t ψ j where ψ j are the eigenvectors of t 1 1 a 11 t 1 t 6 6 this result follows from that fact the eigenvectors of t 1 1 a 11 t 1 and t 1 1 a 11 t 1 are biorthogonal such that ψ i h ψ j δ i j where the superscript h denotes the hermitian transpose therefore the γ j represent the projection of the leading stochastic optimal q 1 onto each pop fig 11b shows γ j as a function of the oscillation frequency of each pop in the example shown here a 11 is a 50 50 matrix so there will be 50 available pops however the pops occur in complex conjugate pairs μ j ψ j and μ j ψ j in which case that there will only be 25 distinct values of projection modulus γ j as shown fig 11b fig 11b indicates that q 1 projects most on to the lowest frequency conjugate pop pair which we will refer to as ψ 1 and ψ 1 because the pops are not orthogonal to each other the large amplitude projection of u 1 1 q 1 on ψ 1 and ψ 1 can be masked by other rapidly decaying members of the pop spectrum then as the perturbation evolves the combined real combination of ψ 1 and ψ 1 very quickly emerges and e t grows rapidly as evident in fig 11a this process can be visualized physically by mapping the perturbation back to the physical state variables as shown next in addition fig 11a indicates that much of the structure of ψ 1 is associated with the leading state vector eof v 1 this is illustrated in fig 12 which shows the time evolution of ssh sst and sss for the initial value problem u 1 1 q 1 and ξ t 0 the initial time fields figs 12a 12b and 12c therefore represent the structure of the leading stochastic optimal q 1 recall however that the q 1 are 3d multivariate fields so figs 12a b c show only the surface field components although they are representative of the structure in the upper water column not shown nonetheless figs 12a b c indicate that q 1 exhibits a great deal of quasi random coherent structure with horizontal length scales characteristic of mesoscale circulations that obscure underlying larger scale features over time the mesoscale features give way to the larger scales as shown in figs 12d 12e and 12f after 1 year by year 7 the negative signature of the leading state vector eof v 1 of fig 3 has emerged figs 12g 12h and 12i in agreement with the peak negative amplitude of u 1 in fig 11a by year 17 fig 11a shows that u 1 reaches its peak positive amplitude and the positive phase of eof v 1 is very evident in figs 12j 12k and 12l at this time while we have focused here on the role of q 1 in promoting stochastically induced variance a qualitatively similar picture emerges for the other stochastic optimals not shown for example q 2 projects most on the pop with 10 year period while q 3 and q 4 generally favor the pops with periods 2 5 years the picture that emerges then is one in which the stochastic forcing in 1 and of course 14 introduces perturbations into the system which can undergo rapid transient growth by projecting with a large amplitude onto the least damped pops it is these pops that persist through time and which account for much of the variance however the high frequency and perhaps rapidly decaying pops clearly play a crucial role in the process also since it is these pops that hide the contribution of the low frequency pops to the perturbations that are introduced at each time step by the stochastic forcing as illustrated in the example of appendix c it is the nonnormal character of a that leads to this behavior while transient perturbation growth is a well known feature of stable non normal operators such growth is norm dependent in the present study the measure of perturbation growth and stochastically induced variance is determined by c in that the variance of the output y t t y t from 2 is given by u t t c t c u t in the example above c i and the transient growth evident in fig 11a is based on the l2 norm of u t which recall corresponds to the perturbation energy density other norms will be considered in section 5 2 while for autonomous systems it is possible to identify a transformation of variable that will render a normal the resulting variance norm may not correspond to anything physically relevant furthermore any attempt to quantify the variance of the system requires choice of a physically motivated norm thus the choice of a norm is unavoidable and the influence of the fundamental non normal behavior of a on variance induced in the chosen norm will be a principal concern indeed it is this very non normal property of a that necessitates the need for balanced truncation as clearly illustrated by the example presented in appendix c with this in mind the degree of nonnormality of the transition matrix a can be quantified by computing the pseudospectra which is given by the largest singular value of the resolvent r ω e i ω i a 1 where ω is the complex frequency trefethen and embree 2005 formally the largest singular value of the resolvent represents r ω 2 for a normal system in which all of the pops are orthogonal the pseudospectra is described by d ω 1 d i s t e i ω λ a where d i s t e i ω λ a is the shortest distance in the complex plane between e i ω and the eigen spectrum λ a according to the transfer function if b ξ t in 1 is replaced by i e i ω t the response of the system to a constant harmonic forcing of frequency ω is proportional to r ω 2 for a non normal system and to d ω for a normal system specifically d ω r ω 2 κ ψ d ω trefethen et al 1993 where κ ψ is the condition number of the matrix ψ ψ i comprising the pops of a if a is normal the pops are orthogonal cf appendix c fig c 1a κ ψ 1 and r ω 2 d ω conversely if a is nonnormal the pops are linearly dependent cf appendix c figs c 1b and c 1c and κ ψ can be very large for a normal system the condition r ω 2 d ω simply describes the phenomena of classical resonance when the forcing frequency approaches the eigen frequency of a pop in the case of a non normal system the response gets an extra boost from linear interference of the non orthogonal pops aka pseudo resonance therefore the extent to which r ω 2 differs from d ω is a measure of the non normal influence of the pops on the stochastically induced variance fig 13 shows r ω 2 versus ω for the physically relevant case where ω is restricted to real values pseudospectra are shown for the original system described by a in 1 and the truncated system t 1 1 a 11 t 1 based on 50 hankel svs for comparison fig 13 also shows the inverse distance function d ω for the two systems the pseudospectra indicate that the pseudo resonant response of both systems can be significantly larger than the classical resonant response expected based on d ω furthermore fig 13 indicates that the truncated system retains the non normal characteristics of the original system as discussed in section 4 3 it is common practice to construct a lim by retaining only the leading eofs of the state vector the pseudospectra for a lim based on retaining the leading 50 state vector eofs of m 1 2 x is also shown in fig 13 and clearly does not capture the non normal characteristics of the original system 1 5 2 coastal upwelling thus far we have been concerned with the case where c i in 2 in which case the output y t corresponds to the full state vector however the input output system described by 1 and 2 can be tailored for output associated with a particular process in this and the next section we will focus on coastal upwelling specifically we will consider two different choices for c one based on sst and another based on vertical velocity the target region chosen is shown in fig 1 and extends from cape mendocino to point conception and from the coast to 50 km offshore which is 1 5 times the 1st baroclinic mode radius of deformation based on the stratification chelton et al 1998 the extent to which sst and vertical velocities in this region are described by a gaussian distribution one of the assumptions underpinning 1 and 2 is discussed in appendix b 2 with this in mind let l s s t represent a matrix such that r l s s t δ x isolates the roms sst grid point values in the target region in this case e r t r is the expected total variance of sst over the target region thus we can define c s s t according to the cholesky factorization c s s t c s s t t m 1 x t l s s t t l s s t x it is well established that coastal sst along the central california coast is strongly controlled by upwelling and downwelling e g checkley and barth 2009 to focus on this process we can similarly let l w represent a matrix such that w l w δ x isolates the roms vertical velocity at grid point values in the same target region shown in fig 1 since roms is a hydrostatic model w is computed as a diagnostic variable using the continuity equation thus the matrix l w represents the vertical integral of the divergence of the horizontal velocity here we consider vertical velocity at a depth of 40 m and in the same way we can define c w according to c w c w t m 1 x t l w t l w x in this case e w t w is the expected total variance of the 40 m vertical velocity over the target region according to 9 the observability gramian q depends on the choice of c and so too will the hankel singular values of h however the eigenvalue spectra of q and singular value spectra of h for the cases c c s s t and c c w are qualitatively similar to those in fig 8 not shown the percentage variance of the output y as a function of the number of hankel singular values retained is shown in fig 9c for the cases c c s s t and c c w compared to the case where the entire state vector is observed c i fewer more hankel singular values are required to capture the same fraction of output variance for the case c c s s t c c w the expected error in the transfer function g 1 z g z h for both cases not shown exhibit qualitatively similar behavior to that for c i shown in fig 9d fig 14a shows a time series of the root mean square rms sst anomaly r t r n p 1 2 from a 300 year integration of 1 and 14 where n p is the number of sst grid point values within the target region in the case of the truncated system 14 the leading 50 hankel svs are retained in fig 14a a 3 year running mean has been applied to the time series in order to highlight the low frequency variability the rms sst of the truncated and original system are very similar and the sst variance of the truncated system is only marginally lower than the original system in this case the leading stochastic optimal q 1 accounts for 30 of the stochastically induced variance of sst as shown in fig 14b the structure of q 1 is very similar to that shown in fig 12a c for the case c i and a perturbation with the structure of q 1 evolves in much the same way through time not shown in the c s s t case q 1 projects almost exclusively on the state vector eof v 1 not shown this is perhaps not too surprising since fig 12 shows that the stochastic optimals of the c i case produce a large sst response in the target region fig 14c shows a time series of the 3 year running mean rms 40 m vertical velocity anomaly w t w n p 1 2 from a 300 year integration of 1 and 14 two truncated cases are shown for 14 corresponding to the leading 50 and 100 hankel svs in the former case the level of variance is about half that of the original system a significant additional fraction of the variance can be recovered by increasing the number of hankel svs to 100 as indicated in fig 14c the vertical velocity variance accounted for by the stochastic optimals is shown in fig 14d for the 50 hankel sv truncation in this case the leading stochastic optimal q 1 accounts for only 8 of the variance in w the more even distribution of variance amongst the stochastic optimals in the c w case indicates that many state vector eofs are needed to capture the variability due to the high degree of spatial inhomogeneity and intermittent nature of coastal upwelling figs 14a and 14c illustrate very clearly the advantages of the truncated system as an emulator of the california current circulation the low pass time series reveal that central california coastal sst is punctuated by variability on interdecadal to decadal time scales occasionally there are extended periods of elevated variance as in the interval years 60 80 and 235 245 in fig 14a during such periods the stochastic forcing is such that eof v 1 persists for several years with an elevated amplitude fig 14b on the other hand does not exhibit abnormal vertical velocities during these same periods suggesting that factors other than variations in the rate of upwelling and downwelling are responsible for the variability in sst 5 3 circulation variability a reduced dimension emulator represents a very useful tool for studying the occurrence of extreme conditions in the ocean and for establishing a high resolution baseline against which future climate change scenarios can be compared for example very long emulator simulations can be used to quantify the probability of occurrence of anomalous conditions along the coast such as extended periods of warming or cooling and their relationship to mechanistic circulation indicators such as coastal upwelling to illustrate further fig 15 shows the probability density of sst anomalies along the central california coast computed from a 1000 year simulation using the balanced truncation emulator based on 50 hankel svs for the case c c s s t the probability density was computed for data bins with a dimension of 0 05 of latitude and extending from the coast to 50 km offshore between point conception in the south and cape mendocino in the north cf fig 1 the emulator is able to capture well the probability density of the original 22 year roms time series as demonstrated in appendix b 3 so this gives us confidence in the outcome of the longer emulator simulations presented here however given the very large sample size available from the emulator the statistical significance of the resulting probability density will be far more significant than that derived from the original roms simulation or from observed satellite data which both span just a few decades the probability density for high pass filtered periods less than 3 years and low pass filtered periods greater than 3 years sst are shown separately in fig 15 of particular interest here are the tails of the distributions associated with extreme events which are accentuated in figs 15a and 15b by deep red colors while there is little variation in the shape of pdf along the coast the tails of the high pass pdfs fig 15a are longer than those of the low pass pdfs fig 15b which is reflected in the standard deviations of the two distributions with the low pass pdf being narrower the emulator also allows us to explore variations in the pdf through time as illustrated in fig 15c which shows the pdf of all sst anomalies between point conception and cape mendocino for consecutive 3 year windows through time temporal shifts in the mean of the pdf reflecting anomalously warm and cool periods are very evident on decadal time scales and with peak coast wide ssts reaching 4 c not shown recalling that the original roms simulation spans a period 20 years the statistics of the very long emulator simulation can be used to assess the extent to which the original roms simulation is representative of the alongshore natural variability the standard deviation of the separate 20 year time series that make up the 1000 year emulator simulation i e 50 samples in total was computed and the range i e max and min of values is indicated in figs 15a and 15b for the high pass and low pass filtered sst while the relative latitudinal variations are robust during any given 20 year period the sst standard deviation at any latitude varies considerably between samples thus the original 22 year roms simulation is probably not sufficient to establish a reliable baseline for sst variability along the coast the probability density of vertical velocity anomalies w at 40 m along the same stretch of the california coast is shown in fig 16 from a 1000 year simulation for the case c c w from the emulator based on 100 hankel singular values guided by the findings in fig 14c the geographic bins used were the same as those used for the sst pdfs in fig 15 as shown in appendix b 2 the roms vertical velocities depart significantly from a gaussian distribution in the case of large amplitude upwelling and downwelling events as a result the emulator under estimates the variance in vertical velocity of the original 22 year roms time series as shown in appendix b 3 nonetheless the alongshore variations in the vertical velocity pdfs are faithfully reproduced the 1000 year pdfs in fig 16 associated with high pass filtered variability are broader than the low pass counterpart by up to an order of magnitude at some locations when measured in terms of the standard deviation the pdfs of high pass w vary considerably with latitude along the coast with elevated variance near 38 n point reyes 39 n point arena and 40 n cape mendocino the low pass w on the other hand exhibit less variability and are only markedly elevated near 39 n variations in the coastwide 3 year pdf of w through time are shown in fig 16c unlike the case of sst the pdf of w exhibits much less in the way of interdecadal variations and most of the variation is associated with changes in the width of the pdf i e the standard deviation the range in the standard deviation of w computed from the separate 20 year time series is also shown in figs 16a and 16b for the high pass and low pass filtered time series in contrast to sst upwelling variability along the coast is relatively robust and stable through time at most latitudes as indicated by the standard deviation which varies little from decade to decade the largest interdecadal variations in standard deviation occur near the aforementioned promontories and capes as noted above appendix b 3 indicates that while pdf variance in vertical velocity from the emulator is probably underestimated the relative alongshore variations are most likely reliable 6 discussion while the formal error of balanced truncation decreases as the number of hankel svs retained increases there is considerable flexibility in the level of truncation that may be tolerated here without much justification we have concentrated primarily on reduced dimension systems based on the leading 50 hankel svs mainly to illustrate the efficacy of the approach there is no formal guidance as to the correct choice of the number of hankel svs that should be retained just as there is no formal guidance for how many eofs to retain in a traditional lim as in any empirical statistically based procedure such as this there is some degree of trial and error and informed judgement based on experience a decision on where to truncate the system could be made based on fig 9c which shows the fraction of the variance in the output y t versus the level of truncation for three different choices of c the more variance of the original system that is desired the larger the number of hankel svs that need to be retained this is similar to the same subjective criteria employed in traditional lims when deciding how many eofs should be retained another possibility for deciding on how to truncate the emulator would be to use the expected error in the transfer function shown in fig 9d which in the system considered here is always close to the theoretical lower bound while this information is perhaps less intuitive fig 9d provides information about the frequency of the forcing and the response at which the largest errors are expected taken together figs 9c and 9d provide complementary information that could be used in combination to make an informed decision on what level of balanced truncation would be appropriate for the problem at hand while lower error and a larger fraction of the stochastically induced variance can be expected by increasing the number of hankel svs retained this comes at the expense of increased dimension while the added dimension might not appear large there are however a number of practical advantages to keeping the dimension as low as possible even though some information is inevitably lost for example low dimension translates into fewer degrees of freedom of the system allowing for more transparency in interpreting the dynamics of the response for instance applying the bilinear transformation 7 7 if g z and f s represent the transfer functions for the equivalent discrete and continuous systems respectively then the bilinear transformation that converts from the discrete system to the continuous system is given by s z 1 z 1 conversely the transformation from the continuous system to the discrete system is given by z 1 s 1 s see for example antoulas 2005 section 4 3 3 to 1 reveals that a i 1 a i and 2 a i 1 b represent an example of a continuous multivariate ornstein uhlenbeck stochastic differential equation since the properties of such systems are very well known gardiner 1985 low dimensional descriptions of complex ocean circulations such as those considered here may offer deeper insights by capitalizing on the arsenal of powerful theoretical and algebraic results pertaining to this class of stochastic processes furthermore the probability density function pdf of the system is described by the fokker planck equation where a i 1 a i controls the so called the drift of the mean and 2 a i 1 b is responsible for diffusion of the pdf in addition the elements of a i 1 a i and 2 a i 1 b collectively define the probability current responsible for the flow of probability information between each component of the system these important properties of the system can therefore be more efficiently diagnosed for some components in very low dimension descriptions of the system moreover as demonstrated in sections 5 2 and 5 3 specific oceanographic processes can also be targeted through a judicious choice of c in 2 it is also worth noting that the emulator can be readily extended to include other essential ocean variables for example the roms configuration used here to inform the emulator also includes a biogeochemical component for ocean ph and dissolved oxygen therefore the emulator can be extended to explore the frequency of occurrence of extreme ph and low oxygen events establishing an important statistical baseline for such events under current climate conditions other potential applications of the emulator could include interannual prediction and as discussed in section 1 lims have been used extensively for prediction on a range of time scales while many lim forecasts are based on limited information such as surface fields only the emulator presented here possesses the added advantage that it provides the full 3d circulation fields the linear system 14 in fact provides a natural framework for generating an ensemble of predictions where each ensemble member results from a different realization of the stochastic forcing ξ t however a moment of reflection shows that the time evolution of the ensemble mean is simply given by 14 with ξ t 0 for a system described by gaussian errors the ensemble mean represents the most likely state of the system if the ensemble is reliable then the variance of the ensemble about the ensemble mean is a measure of the uncertainty in the ensemble mean see grimit and mass 2007 for a review furthermore the covariance of the expected error in the ensemble mean γ τ at forecast lead time τ is given by γ τ φ 0 a τ φ 0 a τ t where φ 0 is the zero lag covariance matrix defined in section 3 2 see penland 1989 as expected γ τ φ 0 the climatological covariance as τ since asymptotic stability demands that simultaneously a τ 0 thus all that is required to make a prediction of the ensemble mean and expected error is a single unforced integration of 14 initialized with today s u 1 which can be provided by a real time ocean analysis system such as the west coast ocean forecasting system wcofs https tidesandcurrents noaa gov ofs dev wcofs wcofs info html the efficacy of this approach will be the subject of a future study until now we have dodged any discussion of the physical interpretation of the pops of the emulator section 5 1 though shows that the pops that dominate the stochastically induced response are those that decay slowly in time and that are characterized by interannual to interdecadal timescales it is therefore natural to inquire about the physical nature of these modes as discussed in section 2 reanalyses derived from data assimilation solutions on g1 were used to constrain the open boundaries of the g2 solutions used to inform the emulator using a conventional lim crawford et al 2019 have performed an extensive analysis of the pops derived from the g1 reanalysis fields and showed that they can be identified with the regional expression of well documented climate modes of variability associated with the el niño southern oscillation the pacific decadal oscillation and the north pacific gyre oscillation therefore some of the low frequency variability in g2 will be in response to variations in the boundary conditions low frequency variations in the local surface forcing will also contribute that said however because of the relatively small geographical extent of the g2 grid we should probably not place a too much emphasis on the physical interpretation of an individual pop in the emulator instead what is important is that the pops collectively and faithfully capture the variability present in the original roms time series see appendix b while not shown here the properties of the leading pops were found to be insensitive to the degree of balanced truncation of the emulator as such the pseudo resonant response of the balanced truncation emulator based on a 11 to stochastic forcing will be robust across a wide range of truncation levels so too the behavior and structure of the leading stochastic optimals cf figs 11 and 12 explored on section 5 1 were also found to be insensitive to the number of hankel singular values retained based on experience we also note that there are a number of pitfalls of which the unwary can unwittingly run afoul when dealing with matrices of large dimension one important consideration is that the model time series data used to estimate a in 1 must be archived to 64 bit precision the condition number of the various matrix operations involved in the balanced truncation procedure is also an important consideration especially in situations where eigenvalues and singular values span many orders of magnitude thus matrix inverse calculations should be avoided if at all possible while some inverse calculations are unavoidable others can be circumvented by alternative algorithms antoulas 2005 section 7 3 presents several alternative but equivalent approaches to performing balanced truncation that may be better conditioned than steps 1 3 outlined in section 3 4 the calculations presented in this study were repeated using some of these alternative approaches and the results presented here found to be robust while many of the tools described here are available in matlab wherever possible these authors chose to write much of their own code for greater algorithm transparency this was found to be particularly important when computing the eigen spectra and singular value spectra of large dimension matrices iterative techniques based on the lanczos method golub and van loan 1989 are particularly robust for very large dimension problems and the efficacy of our results was demonstrated in this way also perhaps the weakest of all the assumptions embodied in 1 and 2 is that of white noise stochastic forcing in time fig 6 shows that the stochastic forcing diagnosed from 1 does not possess the autocorrelation properties expected of white noise and the implications of this deserve further investigation fig 6 may suggest that other choices of model might be more appropriate such as a higher order markov model a nonlinear model e g hasselmann 1988 or a system subject to multiplicative stochastic forcing e g martinez villalobos et al 2018 as opposed to the case of additive forcing considered here the nature of the time series from roms necessitates formulation of the emulator in the discrete time form given by 1 there is of course a parallel formulation of all the same ideas presented in section 3 as they apply to time continuous systems some of the important results and theorems that apply to system reduction are more readily derived for continuous systems while others are more transparent when considering a discrete time system the aforementioned bilinear transformation allows results derived for time continuous systems to be reformulated for discrete time systems and vice versa see glover 1984 for an excellent discussion since the resulting discrete and continuous systems are equivalent they have identical gramians p and q the same hankel singular values and the frequency response to forcing is the same lastly we reiterate that an important central theme of this study is the role played by non normal transient growth of stochastically induced perturbations in maintaining the variance associated with low frequency modes of variability however as fig 12 very clearly illustrates the perturbations that are optimal for exciting the low frequency modes are characterized by mesoscale structures that yield over time to the larger scale low frequency modes while this idea is not new our results highlight the fact that if this same behavior carries over into the roms analysis forecast system currently used for the ccs as the recent work of moore and arango 2021 suggests is likely to be the case then significant potential exists for the up scale growth of forecast errors from the ocean mesoscale to the broader scale circulation of the region therefore there is potentially much that can be learned about the dynamics of forecast error growth and the predictability of the ocean from the large samples available from an emulator 7 summary in this study we present results from a low dimensional linear stochastic emulator of the california current system derived from the time evolving 3d circulation fields of a high resolution configuration of roms the model circulation is constrained at the open boundaries by a data assimilative ocean state estimate derived from a lower resolution roms grid the emulator is based on a linear inverse model and balanced truncation which has the advantage that it reliably represents the behavior and stability properties captured by the original time series this is in contrast to the common practice in linear inverse modeling of reducing the dimension based on the leading eofs which does not always faithfully preserve all of the important stability properties of the original system the emulator has a dimension that is 5 orders of magnitude less than the dimension of the ocean state vector and close to an order of magnitude less than the number of state realizations that make up the time series in the present study monthly averaged fields are used so while the number of realizations of the state is relatively modest 102 this study demonstrates that the potential of the approach is significant for example if daily average fields were used instead the number of state realizations would increase to 104 so even a reduction by two orders of magnitude is substantial the eofs of the state vector for such a large problem can be computed using an iterative lanczos algorithm and svd so application to much larger problems is feasible the emulator is driven by stochastic forcing with covariance properties that are diagnosed from the original roms data variance is maintained in the emulator by the stochastic excitation of the pops of the transition matrix which is a linear empirically derived approximation of the underlying dynamical operators that govern roms the evolution of stochastically induced perturbations is controlled by non normal growth a property that is preserved by balanced truncation while this is a proof of concept study the focus here has been on coastal sst and upwelling and demonstrates how emulators can be developed that target specific circulation features associated with both prognostic and diagnostic model variables one important application of the emulator and a motivation for its development is to establish a statistical baseline for variability in the coastal circulation many of the important mesoscale coastal circulation features associated with the california current system can only be resolved using relatively high resolution models which presents a challenge for generating large ensembles of solutions furthermore reliable high resolution ocean surface forcing fields are only available that span limited time periods a linear stochastic emulator such as that developed here provides a way for generating very long time series or large ensembles of the circulation fields at a very small fraction of the cost of the nonlinear model while at the same time preserving the stability properties of the modes of the original system as captured by the data the examples presented here illustrate how the emulator can be used to establish the extent to which the alongshore variations in sst and vertical velocity from the original nonlinear roms simulation can be considered as reliable the utility of the emulator for modeling and forecasting the circulation along the california coast on seasonal to interannual time scales will but the subject of a future study glossary the following is a list of symbols used throughout the manuscript a the time invariant transition matrix for the state vector principal components a the transformed transition matrix given by t a t 1 a 11 the balance truncated transition matrix comprised of the first k rows and k columns of a b the matrix that describes the structure of the stochastic forcing b the transformed b matrix given by t b b 1 the balance truncated matrix comprised of the first k rows of b c the output matrix c the transformed output matrix given by c t 1 c 1 the balance truncated matrix comprised of the first k columns of c d ω the inverse of the distance function in the complex frequency plane e the expectation operator f the covariance matrix of the stochastic forcing ξ f i the eigenvectors of f b b t associated with the stochastic forcing ξ g z the transfer function of the system for frequency z h the block hankel matrix κ the condition number of a matrix l the scaling matrix for δ x p the reachability gramian p i the eigenvectors of p q the observability gramian q i the eigenvectors of q also known as the stochastic optimals r ω the resolvent matrix for frequency ω s the matrix of right singular vectors of the state vector covariance matrix t the balanced truncation transformation matrix that simultaneously diagonalizes p and q t 1 the balanced truncation operator comprising the first k rows of t v the matrix of left singular vectors of the state vector covariance matrix i e eofs x the state vector δ x the departure of the state vector from the mean seasonal cycle δ x the rescaled δ x x the matrix with columns δ x t y the output vector u k t the principal component time series of each eof u t the vector of principal component time series of the eofs υ k the eofs of the state vector λ i the singular values of m 1 x x t μ i the principal oscillation patterns pops eigenvalues of a 11 λ the diagonal matrix of singular values ξ t the vector of white noise stochastic forcing σ the diagonal matrix of hankel singular values φ t the lag t covariance matrix of u ψ i the principal oscillation patterns pops of a 11 credit authorship contribution statement andrew m moore conceptualization methodology writing original draft writing review editing software validation formal analysis jérôme fiechter conceptualization methodology writing original draft writing review editing validation formal analysis investigation data curation investigation resources project administration christopher a edwards writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this material is based upon work supported by the national science foundation under grant no oce 1635315 any opinions findings and conclusions or recommendations expressed in this material are those of the authors and do not necessarily reflect the views of the national science foundation the authors are grateful to the three anonymous reviewers who provided helpful and stimulating comments on an earlier draft of the manuscript appendix a energy scaling for the roms state vector as in section 3 1 we denote by δ x the vector of grid point values of anomalies in free surface elevation δ ζ the horizontal components of velocity δ u and δ v temperature δ t and salinity δ s following moore et al 2006 the state vector transformation matrix l is defined such that e δ x t l t l δ x is the total perturbation energy density of the anomalies given by a 1 e g ρ 0 2 a i j δ ζ i j 2 d a i j v 1 ρ 0 2 i j k δ u i j k 2 δ v i j k 2 h i j k d a i j ρ 0 2 g n 0 2 i j k α δ t i j 2 β δ s i j 2 h i j k d a i j where g is the acceleration due to gravity ρ 0 1025 kg m 3 is the mean ocean density α 1 6 1 0 4 k 1 is the thermal expansion coefficient of sea water β 7 6 1 0 4 is the salinity expansion coefficient of sea water n 0 3 2 1 0 3 s 1 is a representative value of the brunt väisälä frequency and a and v are the total ocean area and volume respectively enclosed by grid g2 the summations are performed over all roms ocean grid cells in the horizontal i j and in the vertical k where d a i j is the horizontal grid cell area and h i j k is the grid cell thickness the first term in a1 represents the perturbation potential energy associated with anomalies in surface elevation the second term is the perturbation kinetic energy due to anomalies in the horizontal velocity and the last term is the available perturbation potential energy associated with anomalies in the density δ ρ which are approximated in the derivation of a 1 using the linear equation of state as δ ρ ρ 0 β δ s α δ t appendix b some consistency checks as noted in section 3 the underlying hypotheses for eqs 1 and 2 are h 1 the data in the form of monthly mean fields from roms can be described by a linear stochastic system driven by noise forcing that is white in time and h 2 the data is completely characterized by the covariance matrix of the state vector u i e the state vector is a gaussian distributed variable e g eq 3 here we attempt to validate these hypotheses and connect the linear stochastic emulator to the data from the original nonlinear model b 1 the stochastic forcing covariance matrix as described in section 3 the roms state is described in the emulator by the pc time series of the eofs of the autocovariance matrix φ 0 therefore if h 1 and h 2 are correct the reachability gramian p given by the lyapunov equation 8 should be identical to φ 0 one might wonder then why we need solve 8 at all the problem of course is that h 1 and h 2 are not satisfied exactly and this can create inconsistencies to illustrate the covariance matrix f of the stochastic forcing could be diagnosed from 8 according to f φ 0 a φ 0 a t however because of deficiencies in h 1 and h 2 the resulting matrix f is invariably not positive definite and cannot therefore be considered as a covariance matrix this issue is discussed in detail by penland 1989 penland and matrasova 1994 and penland and sardeshmukh 1995 who attribute the occurrence of negative eigenvalues of f to nonlinearities in the system that cannot be treated as stochastic forcing thus partially violating h 1 to remedy the problem penland and matrasova 1994 advocate neglecting the eofs of f associated with any negative eigenvalues the alternative approach used here is to estimate f from the residual of 1 using 3 perform the cholesky decomposition f b b t and solve 8 for p the resulting f is by construction positive definite and a comparison of p and φ 0 provides an indication of the validity of our hypotheses with this in mind fig b 1a shows a comparison of the diagonal elements i e the pc time series variances of p and φ 0 derived from the roms data and the agreement is clearly very good unlike φ 0 however the resulting p has non zero off diagonal elements fig b 1b shows log10 of the absolute value of all elements of p and reveals that the off diagonal elements are very small thus indicating that the implied cross covariances between pc time series are negligible while the presence of non zero off diagonal elements in p indicates some degree of failure of the aforementioned hypotheses the fact that the implied cross covariances are very small gives us confidence that p and f are reasonable choices for the problem at hand nonetheless in the absence of complete adherence to h 1 and h 2 some pragmatic decisions must be made such as jettisoning the negative eigenvalues of f as in penland and matrasova 1994 or introducing very weak cross covariances as in the approach used here another plausible approach might be to use only the diagonal elements of p in which case 1 would only approximately satisfy the lyapunov equation 8 this and other possible alternatives clearly warrant further investigation b 2 how gaussian are the target data to explore the extent to which the monthly anomalies from roms are gaussian and satisfy h 2 we will focus on central california sst and vertical velocity anomalies within the target region identified in fig 1 since these are considered in detail in section 5 3 fig b 2a shows a quantile quantile plot qq plot for the sst anomalies within the target region from the 22 year roms simulation and a gaussian distribution with the same mean and standard deviation as the roms data the qq plot follows the 1 1 line over much of the range of the data indicating that the monthly mean central california sst anomalies are generally gaussian the departures of the data from the 1 1 line indicate that the cold warm tails of the roms sst anomalies tend to be somewhat shorter longer than those of a gaussian the qq plot of vertical velocity anomalies at 40 m depth is shown in fig b 2b in this case moderate upwelling and downwelling rates in the range 2 to 2 m day 1 are described well by a gaussian distribution on the other hand the significant departures of the data from the 1 1 line indicate that the tails of the distribution are more heavily populated than a normal distribution in that high vertical velocities occur more frequently than would be expected from a gaussian distribution based on fig b 2a we might therefore expect the emulator to perform well for sst anomalies whereas in light of fig b 2b the emulator will likely under estimate the number of large amplitude upwelling and downwelling events this will be explored in the next section b 3 ability of the emulator to recover probability density of original data in this section we will quantify the ability of the emulator to capture the variability in the original roms time series data as in appendix b 2 we will focus on central california sst and vertical velocity anomalies in light of the results presented in section 5 3 fig b 3a and b3b show the probability density of sst anomalies along the central california coast computed directly from 22 year roms simulation as in section 5 3 the probability density was computed for data bins with a dimension of 0 05 of latitude and extending from the coast to 50 km in the target region identified in fig 1 between point conception 34 8 n and cape mendocino 40 n the probability density for high pass filtered periods less than 3 years and low pass filtered periods greater than 3 years sst are shown separately in figs b 3a and b 3b respectively the pdfs of the high pass filtered sst fig b 3a are quite noisy but exhibit little variation in the overall shape of pdf along the coast the pdfs of the low pass filtered sst fig b 3b on the other hand exhibit considerable variations in shape along the coast of particular interest here are the tails of the distributions associated with extreme events which are accentuated in figs b 3a and b 3b by deep red colors fig b 3b shows that the pdfs of the low pass filtered sst generally have a longer tail for negative anomalies although the distribution for all data are less dispersed than a gaussian the probability density of vertical velocity anomalies w at 40 m along the same stretch of the central california coast computed directly from the 22 year roms simulation is also shown in fig b 3 the geographic bins used were the same as those used for the sst pdfs and the pdfs associated with high pass filtered variability and low pass filtered variability are shown separately in figs b 3c and b 3d respectively the standard deviation of the high pass filtered variability is in some locations almost an order of magnitude larger than the that the low pass component the pdfs of high pass filtered w vary considerably with latitude along the coast with elevated variance near large capes and promontories such as point reyes 38 n point arena 39 n and cape mendocino 40 n the pdfs for the high pass and low pass sst and vertical velocity anomalies simulated by emulators for the same 22 year period are shown in figs b 3e f and b 3g h respectively in the case of sst the emulator is based on c c s s t and 50 hankel svs while in the case of vertical velocity the emulator uses c c w and 100 hankel svs a comparison of figs b 3e f with b 3a b shows that the emulator is able to reproduce well the alongshore variations in the sst pdf at this level of truncation the emulator tends to under estimate a little the standard deviation of the distribution and the length of the tails however increasing the number of hankel svs retained leads to an improvement in these aspects of pdf this is illustrated in fig b 2c which shows the cumulative probability distribution function cdf for sst at the latitude of point arena where vertical velocity variance is high in fig b 3c from emulators based on 50 100 and 200 hankel svs compared to the cdf of the original roms data the steepness of the cdf is reduced by including additional hankel svs which is associated with a broadening of the pdf comparing fig b 3g h with fig b 3c d shows that while the emulator is able to successfully capture the alongshore variations in the pdf of vertical velocity the standard deviation is generally underestimated as are the tails of the high frequency variations this is consistent with the result of fig b 2b as in the case of sst increasing the number of hankel svs retained by the emulator improves the shape of the pdf as illustrated in fig b 2d at point arena as evidenced by a reduction in the steepness of the cdf associated with a broadening of the pdf appendix c a 2 dimensional illustrative example the following example is a variation of those presented in farrell and ioannou 2001a and antoulas 2005 section 7 1 following chhak et al 2006 consider the time continuous system u t a u t ξ t governed by the 2 2 matrix c 1 a μ 1 μ 2 μ 1 cot δ 0 μ 2 where μ 1 and μ 2 are the eigenvalues of a and δ is the angle subtended by the corresponding eigenvectors in this example a time continuous system is chosen rather than a discrete time case for illustrative convenience and ease of interpretation the angle δ controls the degree of nonnormality of a and the system is normal when δ π 2 as in fig c 1a the eigenvalues are chosen so that μ 0 5 and μ 2 10 μ 1 in which case both eigenvectors decay in time according to e μ i t and the system is asymptotically stable as required for convenience the stochastic forcing is assumed to be white in time with covariance given by e ξ t ξ t t i and the observed output y u for the time continuous case the reachability gramian p i e the covariance matrix of the stochastically induced response in u and the observability gramian q are solutions of the lyapunov equations a p p a t i and a t q q a i respectively as discussed in section 4 2 the eigenvectors of an empirically derived transition matrix a are referred to as principal oscillation patterns pops even though a in c1 is algebraic we will adopt the pop terminology from the outset as discussed in section 3 2 the eigenvalues and eigenvectors α i c p i of p and α i o q i of q play an important role in deciding how to reduce the dimension of the system based on energy considerations the eigenvectors p i are the eofs of the stochastically induced response u with an associated variance α i c the eigenvectors q i are called the stochastic optimals farrell and ioannou 1996a and as demonstrated in section 5 1 represent the patterns of stochastic forcing that account in this case for the fraction α i o of stochastically induced variance for the simple example considered here the eigenvalues p and q are the same but this will not generally be the case for a normal system δ π 2 and the pops eofs and stochastic optimals coincide as illustrated in fig c 1a in this case the stochastically induced variance t r p 11 is fairly modest and the leading eof p 1 accounts for 91 of the variance which is exclusively associated with pop1 the leading stochastic optimal q 1 is also aligned with pop1 and p 1 indicating that the stochastic forcing with a structure that is identical to pop1 is the most effective way of generating variance in u the remaining 9 of the variance is accounted for by p 2 which is exclusively aligned with pop2 and q 2 departures of δ from π 2 describe a non normal system and fig c 1b illustrates the case where δ 0 8 π and the pops are thus linearly dependent in this case the total variance t r p 24 9 is higher and the leading eof p 1 which accounts for 96 of the variance is still closely aligned with pop1 the leading stochastic optimal q 1 however which also accounts for 96 of the variance now departs considerably from pop1 and p 1 showing that the stochastic forcing that excites the majority of the variance has a structure that is very different to the structure of the leading pop and eof the disparity between q 1 and p 1 increases with degree of non normality as illustrated in fig c 1c which illustrates the case for δ 0 95 π in this case the pops are almost anti parallel and the total variance rises to t r p 304 9 which is almost exclusively 99 7 accounted for by p 1 however q 1 which recall explains the same fraction of variance is almost orthogonal to p 1 and as such is more closely aligned with p 2 variations in the dot product q 1 t p 2 with δ are shown in fig c 1d which illustrates that the alignment of q 1 and p 2 increases as δ π or δ 0 while they are orthogonal for the normal case δ π 2 therefore even though the elements of the state vector u aligned with p 2 account for a vanishingly small fraction of the variance as δ π or δ 0 stochastically induced perturbations aligned with p 2 become increasingly more effective at maintaining the large variance accounted for by p 1 perturbations with the structure of q 1 in fact evolve very quickly into pop1 see chhak et al 2006 fig c 1d also shows that the stochastically induced variance α 1 c α 1 o accounted for by p 1 and q 1 approaches infinity as δ π or δ 0 conversely the variance α 2 c α 2 o associated with p 2 and q 2 is always close to 1 irrespective of the value of δ not shown it is tempting therefore to reduce the dimension of the system described by c 1 by retaining only the leading eof especially in the case of a highly non normal system since p 1 almost exclusively accounts for all of the stochastically induced variance in u eof p 2 represents the most difficult state of u to reach i e it requires the largest amount of energy to reach so it may be beneficial to reject it however in discarding p 2 fig c 1 shows that for a highly nonnormal system we will jettison stochastically induced perturbations associated with the leading stochastic optimal q 1 which is in fact responsible for all of the variance explained by p 1 in other words q 1 is associated with the easiest i e lowest energy state u that can be observed 
23844,using a set of direct numerical simulations dns we investigate the circulation of a buoyancy driven experiment in a circular rotating tank the initial density structure is a two layer stable stratification the water is densified at 32 points at the upslope side of a circular incline and flows downward as a gravity current before it intrudes to the interior along the interface between the two layers the water above recirculates to the densification points when the buoyancy production is lower than the maximal ekman transport the gravity current proceeds in the laminar ekman layer in the opposite case the water cascades down the incline in a no stationary dynamics turbulent transport becomes important and the boundary layer is thickened the thermal wind relation applied to the tangential velocity averaged along the slope predicts the density structure averaged along the slope in the domain when the densified water arrives at the interface it flows along the slope in the cyclonic direction in a geostrophically adjusted deep boundary current the distance of the boundary current from the slope is given by inertial overshoot of the ekman current due to the self advection by the inertia when this distance is small the boundary current is close to the slope and subject to boundary friction in the opposite case the boundary current evolves detached from the boundary the intrusion along the interface in the negative radial direction is slow as the intruding distance is proportional to the square root of time the recirculation in the upper layer is close to a geostrophic equilibrium its quasi geostrophic evolution is due to the compression of the water column caused by the gravity and intruding currents below this leads to a large scale anti cyclonic circulation in the upper layer when the associated geostrophic surface pressure gradient exceeds the pressured gradient due to the dense water on the slope the ekman transport is upslope a special emphasis is put on the interactions of the three phases of the circulation gravity current intrusion and recirculation the circulation and the mixing of density and momentum in the gravity current determine the water mass properties in the deep boundary current both determine the recirculation the recirculation leads to an increasing anti cyclonic circulation above the gravity current which through the corresponding surface pressure gradient reduces and finally blocs the downslope movement in the ekman layer keywords rotating gravity current slope current intrusion recirculation 1 introduction density differences in fluids created through differential heating by the sun or other heat sources are combined with the gravitational acceleration the major source of motion in environmental fluids the lighter fluid is accelerated upward and heavier fluid downward the vertical acceleration and buoyancy transport leads to horizontal pressure gradients and horizontal motion when the vertically moving fluid encounters a solid boundary a gravity current is created here we discuss only descending dense gravity currents the physics of rising buoyant gravity currents is identical when density differences are small when the boussinesq approximation applies the gravity current moves along the boundary until its downward motion is halted by the bottom or by a fluid of higher density and its motion is redirected to horizontal the circulation is influenced by turbulence which mixes density and momentum bottom friction the rotation of the earth and many other processes simpson 1982 griffiths 1986 wåhlin and walin 2001 monaghan 2007 baines 2008 wirth 2009 the difference between atmospheric and oceanic gravity currents is that the former evolve mostly on time scales shorter than a day while the descend of the latter is slower takes several days and the rotation of the earth plays a governing role oceanic gravity currents have been extensively studied in the past these studies were mostly concerned with the downward motion and its arrest at the ocean floor most oceanic gravity currents are however halted in their downward propagation by a denser water mass and do not reach the ocean floor observed examples are the outflows at gibraltar baringer and price 1999 bab el mandeb johns and sofianos 2012 the strait of hormus pous et al 2004 into the baltic sea umlauf et al 2007 or the overflows at the denmark strait käse et al 2003 and in the faroe bank channel fer et al 2010 as well as the gravity currents in the gulf of lions flexas et al 2002 laboratory experiments on rotating gravity currents have been performed by griffiths 1986 shapiro and zatsepin 1997 cenedese et al 2004 davarpanah jazi et al 2020 rubino et al 2020 and many others numerical simulations of idealised and observed gravity currents are numerous see i e chang et al 2008 legg et al 2009 laanaia et al 2010 yankovsky and legg 2019 and references therein the laboratory experiments and the numerical simulations mentioned do not consider the intrusion of rotating gravity currents while the observed gravity currents mentioned above are all intruding at one point stop their downward motion along the slope in the present work we are concerned with a gravity current its intrusion when the downslope propagation is arrested by a layer of dense water and the recirculation in the water above as well as the interaction of these three phases to this end we have envisioned a physical model which is realised on the coriolis platform at legi grenoble france and use a mathematical model thereof the hydrostatic equations of geophysical fluid dynamics which are integrated numerically using the croco ocean code the aim is to set up a hierarchy of experimental mathematical and numerical models to further our understanding of the average circulation of oceanic gravity currents that flow downslope into a stratified environment intrude into the interior and lead to a recirculation of the superposing water masses the emphasis in the present work is on the large scale circulation leaving the dynamics of the turbulent fluctuations for future publications such separation between an averaged circulation and fluctuations in a non statistically stationary dynamics is made possible by the circular symmetry of the experiment which allows for averaging along the angle ϕ see fig 1 note that the present configuration is substantially different from a lock release gravity current in a rotating frame on a flat ground see i e dai and wu 2016 2018 we densify the water continuously with no initial shock or loss of balance neither hydrostatic nor geostrophic in our experiment balance is mainly broken by small scale friction processes the radius at which the injection sites are placed is large and plays a subdominant role indeed the geometry is chosen so that the process approaches an infinitely long gravity current dominated by hydrostatic and geostrophic balance the results from the laboratory experiment will be presented elsewhere negretti et al 2021 the goal of the numerical simulations is to perform controlled experiments that help to understand the more involved less controlled and only partially observed phenomena in the laboratory experiments rather than creating a numerical twin the here discussed numerical simulations are therefore a component of the hierarchy of models discussed above connecting in a systematic way analytic solutions to eddying simulations to laboratory experiments and environmental observations 2 experiment and qualitative description a top and a side view of the experiment is presented in figs 1 and 2 respectively the tank performs a uniform rotation with the coriolis frequency f 2 ω 4 π t where t is the period of rotation initially there are two water masses the upper of density ρ 1 and layer thickness of h 1 superposes a denser bottom layer of density ρ 2 and thickness h 2 see table 1 for values at 32 source points marked by black dots in figs 1 and 2 equidistantly distributed at a distance of 6 25 m from the centre the water is accelerated along the inclined plane of slope α 0 1 at an angle of ς 45 with respect to the down slope direction the acceleration force is constant in time and equal in all experiments expx2 it is tenfold smaller in exp01 and a hundred fold smaller in exp000 the oblique acceleration rather than a downslope acceleration is used to speed up geostrophic adjustment of the resulting rotating gravity current the volume of the pushed water is m s the density of the source water is given as usually done in oceanography by its dimensionless sigma value σ s ρ s 1000 where ρ s is measured in kg m 3 it is increased by δ ρ s 10 kg m 3 that is δ s 10 at the source points leading to an overall buoyancy production rate 1 b s m s g ρ s ρ 1 ρ s where g is gravity the total sigma value of a water mass that has a certain concentration of source water and water form layer 1 and 2 is σ σ s σ 2 note that σ 1 0 the density in kg m 3 is therefore ρ 1000 σ s σ 2 please note that for numerical reasons see section 4 no water is added during the experiments the total volume stays constant throughout the experiments this differs from the laboratory experiments presented in negretti et al 2021 where dense water is injected the circulation is governed by the large scale mass fluxes through convergence and divergence and is therefore different between the numerical results presented here and the laboratory experiments presented in negretti et al 2021 more precisely the dynamics above the gravity current is governed by the recirculation of the water masses in both the laboratory experiment and the numerical experiment the recirculation is different in the laboratory experiment due to the injection of water smaller scale processes are relatively more independent of the large scale balances and the corresponding numerical results will be compared to the laboratory experiments elsewhere the source water flows as a gravity current towards the centre along the topography and is further deviated to the right by the coriolis force leading to a cyclonic circulation when it encounters the bottom layer the downslope motion stops and the source water intrudes along the interface and forms a boundary current proceeding cyclonically along the slope instabilities of this intruding boundary current might lead to intermittent intrusions of source water towards the centre of the domain when the source water proceeds towards the centre as it travels downslope and intrudes it compresses the water column above leading to an outward flow towards the source points in the upper layer called recirculation see fig 2 this recirculating flow is deviated by the coriolis force to the right leading to an anti cyclonic circulation the circulation is therefore separated in three phases operating in different areas the gravity current on the slope the intrusion at the interface and the recirculation above the gravity current and the intrusion making this qualitative description quantitative is hampered by the presence of turbulent fluxes of mass and momentum that cannot be related to the average quantities in a straight forward way a problematic which is referred to as the closure problem due to the periodicity of the experiment along concentric circles with 32 repetitions averages can be taken along the angle ϕ the almost homogeneous direction in the experiment this allows to distinguish between a spatial average along ϕ called circulation which is a function of the radius r the vertical coordinate z and time t the deviations from this average are called fluctuations the origin of fluctuations can be either due to the discreteness of the point sources or appear spontaneously or is a combination of both it is seen in the laminar and turbulent experiments that with the downslope distance from the source sites the gravity current evolves towards statistical homogeneity in the ϕ direction forgets about the periodicity and details of the source determining the evolution of the circulation is the purpose of this communication the dynamics does not reach a statistically stationary state as both the circulation and the moments of fluctuating quantities averaged along ϕ are evolving in time for numerical reasons we do not analyse the current around the 32 sites where dense water is generated as the mode of generation mimics the source of the laboratory experiment as closely as possible but is not identical and furthermore has no correspondence in oceanic context in the environment the densification of air and water happens over large areas orders of magnitude larger than the area of the gravity current which is a small scale phenomena in the global ocean circulation in laboratory and numerical experiments dedicated to the dynamics of gravity currents we do not have the space available to closely mimic the densification we therefore focus on the common features of gravity currents the downslope motion and the intrusion and restrict our analysis to a region within a radius of 5 5 m 3 theory we use a polar coordinate system where all variables depend on the radius angle height and time respectively r ϕ z t the unit vector in the local radial direction is r ˆ and ϕ ˆ is the unit vector in the locally tangential direction to the platform centre the velocity components in the polar coordinates are denoted by u r u ϕ ˆ w the almost homogeneity of the experiment along the angle ϕ allows to separate the dynamics in a circulation and fluctuations to this end we denote the averages over a circle of a given radius of any variable a by a z r t a z r ϕ t ϕ this averaging allows to obtain the circulation a z r t in the experiment the fluctuations are then a z r ϕ t a z r ϕ t a z r t of which we analyse the moments by again averaging along the angle ϕ notice that the circulation and the statistics of the fluctuations moments of fluctuating quantities evolve in time the dynamics does not reach a statistically stationary state but the homogeneity along ϕ allows for averaging over turbulent fluctuations and obtaining an averaged circulation and average turbulent fluxes as described above we can distinguish three phases in the circulation gravity current intrusion and recirculation the theory necessary to describe each of the phases will be discussed in the following subsections 3 1 gravity current on its downslope propagation the gravity current continuously adjusts to the rotating frame passes from a non rotating downslope gravity current to a cross slope rotating gravity current in geostrophic equilibrium see shapiro and zatsepin 1997 wåhlin and walin 2001 and wirth 2009 when a laminar gravity current of density ρ s is flowing through an inert ocean of density ρ 1 its circulation approaches geostrophic equilibrium in which the cross slope velocity u ϕ ˆ is obtained by a balance between the downslope acceleration which is given by the product of the topographic slope α and the reduced gravity b s g ρ s ρ 1 ρ s 9 71 1 0 2 m s 2 and the inverse of the coriolis acceleration this balance allows to define a geostrophic velocity associated to the slope and the density difference 2 u g u ϕ ˆ α b s f 0 9 25 1 0 2 ms 1 where the numerical value corresponds to the reference experiment exp02 in our experiments the water above the gravity current is in motion and the density varies smoothly for such case the geostrophic equilibrium generalises to the thermal wind relation 3 z u ϕ ˆ g g r ρ f ρ 4 z u r g g ϕ ˆ ρ f ρ the thermal wind relation is used in section 6 1 to show that the tangential component of the circulation is always close to geostrophic equilibrium even within the gravity current when the thermal wind relation applies to the circulation it has no radial or downslope velocity u r g ϕ 0 this follows from eq 4 as the average along ϕ of the r h s vanishes and u r g ϕ 0 at the centre by definition it follows that for a downslope propagation of dense water we need and or fluctuations friction non linearity time dependence due to bottom friction an ekman layer appears at the bottom of the gravity current in which dense water is transported downward the structure of the gravity current is composed of a thick vein superposing a thin frictional ekman layer as shown in shapiro and zatsepin 1997 wåhlin and walin 2001 and wirth 2009 in the ekman layer the cross slope velocity is reduced by friction the coriolis force no longer balances the downslope acceleration and the dense water descends when the velocity above the gravity current vanishes the downslope transport is proportional to the shear force at the slope the thick part of the gravity current not directly subject to frictional forces is called the vein it is influenced by the ekman layer dynamics from below through ekman pumping wåhlin and walin 2001 wirth 2009 derived parameters for a constant viscosity law are the thickness of the ekman layer δ ek the shear vector τ the downslope ekman transport t ek the total downslope ekman transport m ek in the experiment and the total downslope buoyancy transport b ek 5 δ ek 2 ν f 0 4 37 1 0 3 m 6 τ τ r τ ϕ ˆ ν u g δ ek 1 1 ν 2 f α b s 1 1 7 t ek τ r f δ ek 2 u g α b s ν 2 f 3 8 m ek l t ek 2 π r α b s ν 2 f 3 6 35 1 0 3 m 3 s 1 9 b ek σ s m ek 6 35 1 0 2 kg s 1 where numerical values refer to the reference exp02 for which f f 0 see tables 1 and 2 the values of m ek and b ek give the maximal amount of volume and kg of salt that can be transported downslope by the ekman layer the value for the maximal buoyancy transport does not take into account the mixing and diffusion at the source and on the way down the incline the ekman layer is subject to diffusion so its downslope buoyancy anomaly reduces over a characteristic length scale 10 l e k u g δ e k 2 κ 2 ν α b s f 2 κ 1 4 m the determining parameter is the flux ekman number d e k b ek b s comparing the buoyancy the ekman dynamics can transport downward to the source buoyancy anomaly b s see eq 1 when the source rate exceeds the value d e k 1 buoyancy accumulates and the thickness of the vein increases when the vein becomes unstable other time and space dependent processes can lead to a downward buoyancy transport in this case the transport happens at a thick boundary layer it is turbulent and it cascades down the incline the thickening of an accelerating boundary layer in a rotating frame was analytically shown by huthnance 2009 for an idealised case for a discussion of cascading in the ocean from observations and its representation in realistic numerical simulations i refer to luneva et al 2020 for the arctic and to rubino et al 2012 for the mediterranean both works emphasise the importance of the topographic structure on the cascading a subject that is not considered here 3 2 intruding current due to the periodicity in the ϕ direction there is no average pressure gradient in this direction and therefore also no geostrophic radial circulation u r g ϕ 0 non linearity or friction can relax the geostrophic constraint and allow for a circulation in the radial direction non linearity allows for an inertial overshoot while friction leads to a radial circulation on the slope in ekman layers and between water masses of different densities in interfacial ekman layers when the gravity current water arrives at the interface it has a density anomaly b in if the downward transport given by eq 7 is done by the ekman layer the corresponding downslope velocity in the negative r direction is u b in 2 if the current performs an inertial overshoot it penetrates a maximal distance 11 l iner u b in 2 f α b in 2 f 2 into the interior while turning anti cyclonically the numerical integrations discussed below show that dense water follows the slope it resembles a deep boundary current that grows in breadth and thickness due to a constant supply of dense water by the gravity current the thermal wind relation of eq 3 relates slope of the pycnocline in the radial direction to the velocity of the deep boundary current and therefore to b in when the deep boundary current grows in breadth extending away from the boundary it also has to increase its vertical extension a constant influx of dense water then leads to an intrusion where the square of the intruding distance is proportional to time x in 2 γ t where γ is a constant note that a proportionality of the intrusion to the square root of time does not mean that the intrusion is done by diffusive processes it occurs when the cross section of the deep current preserves its shape while being supplied by a constant influx of dense water 3 3 recirculation in the upper layer which is not directly subject to strong frictional forces the dynamics can be described by the conservation of potential vorticity q 12 d d t q t u r r u ϕ ˆ ϕ ˆ ζ f h 0 13 ζ u ϕ ˆ r r u ϕ ˆ ϕ ˆ u r where ζ is the vorticity when we consider the potential vorticity of the circulation by averaging along ϕ ϕ the advection of potential vorticity along ϕ disappears note that it is in the ϕ direction that we have the strongest large scale advection when we further neglect the radial advection an approximation which will be justified by the data analysis in section 6 3 eq 12 simplifies to a balance between the local change of vorticity and the local vortex stretching 14 t ζ ϕ ζ f h t h ϕ we further average the dynamics in a surface layer down to a depth h 0 0 1 m by using the average ζ h 0 and obtain a relation between the change of vorticity and the vertical velocity w h 0 vortex stretching 15 t ζ ϕ h 0 r t ζ ϕ h 0 f h 0 w h 0 ϕ where we used w h 0 t h h 0 which measures the negative vortex stretching of the above water column the recirculation dynamics is forced by vortex stretching represented by the vertical velocity which is measured in the experiments when horizontal advection of potential vorticity is neglected we obtain integrating eq 15 in time and using eq 13 16 u ϕ ˆ ϕ h 0 r t r r u ϕ ˆ ϕ h 0 r t f δ h r t h 0 17 with x x x x x x x x x δ h r t 0 t w h 0 ϕ h 0 d t this shows that in the recirculation area a clockwise circulation grows constantly in time when turbulent fluxes are neglected the ekman transport becomes upslope at a time t up when u ϕ ˆ t u g that is when the geostrophic surface pressure gradient pushing the water upslope exceeds the downslope gravitational acceleration of the gravity current water 3 4 turbulent parameters non dimensional geometric parameters are the slope α and the stretching parameter γ α l d where l is length of the slope and d the average depth the prandtl number compares viscosity to diffusivity p r ν κ 20 3 the turbulent regimes are usually characterised by the reynolds number r e the richardson number r i the froude number f r and the rayleigh number r a if we base these numbers on the ekman layer thickness δ ek they are related 18 r e u g δ ek ν 2 b s f 3 ν 416 19 r i δ b s u g 2 2 ν f 3 α b s 2 α r e f r 2 4 82 1 0 4 20 r a b s δ ek 3 ν κ 2 r e p r 5545 where numerical numbers correspond to the reference experiment exp02 note that with increasing coriolis parameter both the geostrophic velocity and the ekman layer thickness decrease and so does the reynolds number based on ekman dynamics the ekman number e k is the square of the thickness of the ekman layer divided by the square of the thickness of the gravity current 4 direct numerical simulations dns the model used is the hydrostatic version of croco https www croco ocean org which solves the free surface primitive equations its dynamical kernel is described in shchepetkin and mcwilliams 2009 the simulations of the domain are performed at a horizontal resolution of 13 5 m 1024 2 and there are 64 σ levels in the vertical finest resolution of the first level varies from 1 mm at the upper part of the incline to 5 mm at the deepest part of the domain the boundary condition at the bottom is no slip the time step is δ t 3 1 0 3 s since we found that increasing the volume by injecting fluid as it is done in the experiments on the coriolis platform leads to a numerical instability at the free surface except for very weak injection rates therefore we choose to accelerate the water above the source points 32 grid points at r 6 25 m in the lower 2 5 cm at an angle of 45 to the radial direction the acceleration force is constant in time and equal in the experiments expx2 x 0 1 2 3 4 the total accelerated water mass is increased by a density of 10 kg m 3 the resulting buoyancy flux is given below for each experiment no water is injected and the total volume stays constant throughout the experiments the acceleration and densification procedure cannot be easily implemented in the laboratory experiment and the laboratory experiment and the numerical experiment differ in this aspect we emphasise that such kind of forcing can be implemented at high financial costs in a laboratory experiment by putting pumps and adding salt at the source points by changing the injection mode in the numerical experiments with a low injection rate no dependence of averaged quantities on the injection mode was observed further downstream of the injection points the advection scheme are 5th order in space for tracers and momentum in the horizontal and vertical direction we performed direct numerical simulations dns using the molecular values of water for the viscosity ν 1 1 0 6 m 2 s 1 and the thermal diffusivity κ 1 5 1 0 7 m 2 s 1 we are aware that the numerical diffusion may exceed the explicit values but as the implementation of the equations in the croco code is consistent the solutions will converge as the resolution in space and time is refined 5 experiments performed we performed seven experiments all extending over a time interval of at least t 3000 s the physical parameters of the reference experiment exp02 are given in table 1 the parameters varied between experiments are the source rate and the rotation rate for experiments exp00 and exp01 we reduced the source rate by a factor of 100 and 10 respectively the low source rates lead to an almost linear evolution of the dynamics the other experiments all have a high source rate but different rotation periods of t 30 exp32 60 exp12 120 exp02 and 240 exp42 experiment exp22 has no rotation that is t the early evolution of the density structure in the first grid point above topography is given in fig 3 for the low and the very high rotation cases in the centre of the domain the water mass of density ρ 2 is seen in all experiments and at all times in the low rotation rate experiment the oblique injection is seen at the source and the dense water moves down in the ekman layer at all times during the experiment in the highest rotation case the coriolis force deviates the flow to the right and the dense water turns upslope before moving principally along the slope due to geostrophic adjustment at later times the dynamics is turbulent down to the lower boundary the parameters varied as well as the geostrophic velocity and the ekman layer thickness using formulas from section 3 are given in table 2 6 results we distinguish four different areas of the dynamics in our experiment one is the source region around the injection points the mode of source implemented in the numerical model is close to the injection in the laboratory experiment performed on the coriolis platform which differs from the source of gravity currents in the natural environment see section 2 the strongly turbulent dynamics in this area consisting of mostly cyclonic eddies depends on the details of the source lacks generality and will not be discussed here we will consider the downslope movement of the dense water in a gravity current on the slope at a distance from the source sites when the dynamics has forgotten about the details of the densification process this area starts about half a metre downslope from the sources and extents down to the interface at which the dense water intrudes to the interior along the interface the downslope and intruding current pushes away the surrounding water that recirculates to the source region above the gravity current as shown in fig 2 the three phases considered gravity current intrusion and recirculation take place in distinct areas of the experiment the circulation in each of the phases is analysed in the following subsections using data from the numerical experiments 6 1 gravity current the density in the lowest level above the bottom is given in fig 3 for the low exp42 and the very high rotation exp32 cases while in the low rotation case the laminar ekman dynamics prevails during the experiment the bottom boundary layer becomes turbulent in the very high rotation case in fig 4 right column the total radial buoyancy transport t s z u r σ s ϕ is plotted for three values of the radius over the slope at t 3000 s as a function of the vertical direction z for three different experiments for the low rotation the downward transport is performed by the thin ekman layer as seen in exp02 and exp42 upper and middle right panel of fig 4 called ekman case in the sequel the downward and inward transport depends on the shear force exerted by the bottom boundary es described in section 3 just above the gravity current there is a counter flow and the detrained salty water flows upward and outward leading to an upward and outward transport of dense water see fig 4 the upslope transport also shows that the gravity current is detraining which leads to a decrease of the downslope buoyancy transport with the downslope direction which can be seen in the same figure looking at profiles for different values of the radius r the total buoyancy transport can be separated into a part due to the circulation t s c z u r ϕ σ s ϕ and a fluctuating part t s f z t s z t s c z for the ekman dynamics the fluctuating part is negligible which shows that the dynamics is close to laminar fig 4 and that the homogeneity due to the 32 source points decreases in the downslope direction and has almost disappeared 1 m downslope of the source sites using the thermal wind relation eq 3 the density structure averaged along the angle ϕ can be obtained from the tangential velocity averaged along the angle ϕ as can be seen in the middle column of fig 4 note that the thermal wind relation does not apply to non averaged quantities due to the presence of inertia gravity waves in the very high rotation case exp32 the anti cyclonic circulation in the recirculation area becomes so strong that also near the bottom the circulation is anti cyclonic and therefore the ekman transport is upslope this can be seen in the lower right panel of fig 4 and in fig 6 where at the upslope location r 5 53 m the tangential velocity u ϕ ˆ averaged along the angle ϕ is always negative which leads to an upslope ekman transport in terms of the thermal wind relation this means that the horizontal density variations in the fluid are not strong enough to counter balance the geostrophic pressure gradient at the surface when the volume of the water densified at the source per time exceeds the downward ekman transport the dense water accumulates for some time at the upper part of the incline until it proceeds downward above the ekman layer as can be seen for exp32 in fig 4 no laminar solution is available and the fluctuating buoyancy transport is performed in a thick turbulent boundary layer this behaviour will be called cascade dynamics in the sequel in the same figure we also see that the turbulent transport is always down slope the cascade dynamics has a turbulent transport which is strongly increased the downward transport is very intermittent in time and consists of avalanches or bursts not shown note that also in the cascading dynamics the circulation part of the downslope transport is confined to the bottom ekman layer this can be seen by looking at the difference of the full line and the dashed line in the lower right panel of fig 4 6 2 intruding current for the lowest rotation case the density anomaly of the source water σ s ϕ as well as the isolines of u ϕ ˆ ϕ are given in fig 5 the intrusion towards the interior of the source water leaving the incline is clearly visible the cyclonically progressing deep boundary current is seen by the isolines of the tangential velocity u ϕ ˆ ϕ note that the distance of the centre of the current is located at a horizontal distance of about l deep 70 cm from the intrusion point which is much larger than l iner 91 cm where we used eq 11 and b in 5 1 0 2 m s 2 see fig 5 and the deep current be explained by an inertial overshoot it is also interesting to note that the deep boundary current of exp42 is not squeezed to the boundary there are no strong velocity gradients or boundary layers associated to it this indicates that the boundary current is not subject to strong frictional processes a friction time can be estimated as t deep l deep 2 ν 5 1 0 5 s much longer than the duration of the experiment the interfacial friction is however strong enough to sustain an interfacial ekman layer responsible for the intrusion this is clearly visible in fig 5 where the bottom ekman layer leaves the boundary and proceeds in the interior as an interfacial ekman layer the velocities in the interfacial ekman layer are almost an order of magnitude smaller than in the bottom ekman layer and its strength decreases as it penetrates to the interior at the top of the intruding current there is another ekman layer in which the transport is directed towards the boundary the averaged radial velocities u r ϕ are small typically two orders of magnitude smaller than the averaged tangential velocities u ϕ ˆ ϕ the persistence of the interfacial ekman layer does not contradict the findings of wirth 2011 where it was shown that ekman layers disappear when the system is freely evolving that is far from a boundary for the highest rotation case l iner 1 4 cm and the deep boundary current is squeezed against the boundary and the ekman layer does not separate from the boundary see fig 6 we observe that the square of the intruding distance along the interface is proportional to time x 2 t as demonstrated in figs 7 and 8 where a clear scaling is observed for at least one decade for all experiments with rotation in both figures the time is counted from the arrival of the corresponding s value at the point from which the current intrudes the scaling is illustrated in fig 7 for exp02 using different values of σ s in fig 8 results from experiments for one value of σ s for each experiment performed is presented the non rotating case exp22 also shows the scaling behaviour due to the oblique injection at 45 the fluid is rotating and the dynamics has an effective coriolis frequency which is however low and varies in space and time for the faster rotating cases exp12 and exp32 the scaling is no longer observed for approximately t 1000 s as the gravity current changes from ekman layer dynamics to cascading more precisely the intruding current proceeds faster than x t resembling a linear growth x t for exp032 from t 1000 to 2000 s see fig 8 in section 3 we showed that not only the increase of the intrusion scales with time but also the rate of increase the offset of the graphs corresponding to different experiments in fig 8 has a dimensional scaling of γ f 1 this scaling is observed between the two lower rotation cases but breaks down when considering the faster rotating cases this is no surprise as we have seen that the downslope regime changes qualitatively with the rotation rate for the higher rotation cases going from ekman dynamics to cascading scaling behaviours can only be expected when the same dynamic regime prevails 6 3 recirculation the dynamics extending from above the gravity current to the surface is not subject to frictional processes and turbulent fluxes are negligible when the gravity current circulation is sub critical furthermore the abundant internal waves have only a weak direct influence on the recirculation a maximal rossby number of the recirculation can be calculated by calculating ε max 2 u ϕ ˆ ϕ f r for r 6 m in all experiments with rotation and for the duration of the experiments investigated we have ε 0 2 well within the regime of quasi geostrophy this is demonstrated by fig 9 which shows that the conservation of potential vorticity using averaged variables only allows to explain the recirculation the figure gives the approximated potential vorticity balance of eq 15 neglecting the horizontal advection of potential vorticity last term in the equation more precisely the layer between a depth of 0 15 m and 0 01 m is considered in this figure the l h s of eq 15 and the spatial averaged r h s superpose within statistical error for exp02 at t 1500 s and 3000 s for 0 r 5 5 m this shows that this part is well described by the conservation of potential vorticity and that fluctuations and turbulent fluxes can be neglected the noisiness of the black line is due to the sensitivity of the vertical velocity to gravity waves which leave their signature even in the averages w h 0 ϕ for higher values of r 5 2 m the approximation fails due to the strong eddy activity and the associated turbulent fluxes furthermore in the vicinity of the source points strong downward velocities occur and the concept of shallow water potential vorticity is no longer applicable comparing both panels in fig 9 shows that the magnitude of the tangential velocity increases with time as predicted for a continuous forcing by the vertical velocity the recirculation does not attain a stationary state when the negative tangential velocity becomes smaller than the negative of the geostrophic velocity just above the ekman layer as seen at t 3000 and r 5 m in exp32 green line in left lower panel of fig 4 the transport in the ekman layer is directed upslope see discussion in the previous subsection the approximation for the potential vorticity conservation is observed for the lower rotation rates for the times of the integration but breaks down when the rotation rate is increased or at later integration times due to the intermittent cascading dynamics influencing the recirculation 6 4 interaction of gravity current intrusion and recirculation the gravity current dynamics decides on the downward volume and buoyancy transport the amount of volume and buoyancy that arrives at the intrusion point governs the dynamics of the deep boundary current both the gravity current and the intruding dynamics lead to a compression of the super posing water column the water above recirculates outward and turns anti cyclonically at an increasing rate during this process the thermal wind balance prevails when the tangential velocity above the gravity current exceeds the geostrophic velocity the geostrophic pressure gradient pushes the water upslope in the ekman layer this can be seen in lower right panel of fig 4 where at r 5 m the ekman transport is clearly inverted upslope the downward buoyancy transport passes from a laminar ekman dynamics to cascading down the incline above the ekman layer 7 discussions we have performed a series of numerical experiments on a configuration of buoyancy driven flows varying the densification rate and the rotating rate the circular symmetry and the high number of sources allow for averaging along the angle ϕ and mathematically separating the dynamics in a circulation and fluctuations where both are evolving in time the purpose of the experiment is to not only describe the different processes involved gravity current intrusion and recirculation but also their interaction we found a qualitative change in the gravity current going from the ekman dynamics when the buoyancy production rate is lower than the maximal buoyancy ekman transport to the cascade dynamics when it is higher this prevents a clear scaling of the observed quantities with the rotation rate and the buoyancy production rate when the gravity current water reaches the interface it intrudes along the interface between a denser and a lighter water mass the intrusion can be explained by an inertial overshoot and leads to a deep boundary current that is well separated from the incline in the lower rotation case while it stays attached to the boundary in the fast rotating cases in the former case the dynamics of the deep boundary current is not subject to strong boundary friction over at least one decade in time the intrusion of the gravity current water proceeds at a rate that is proportional to t for the rotating cases in the faster rotating cases the scaling behaviour disappears when the cascading reaches the interface and the propagation increases resembling a linear scaling for the fastest rotation this can probably be explained by the appearance of coherent dipole structures that resemble hetons hogg and stommel 1985 transporting buoyancy anomalies in a ballistic way away from the incline research with simulations dedicated to this subject will be performed in the near future the intrusion of source water does not proceed at a constant velocity and can be called non intruding when the buoyancy transport is performed by the ekman transport the recirculation leads to a continuous increase of the anti cyclonic tangential velocity in the upper layer which results in a blockage of the buoyancy transport in the ekman layer below and the gravity current dynamics passes to a cascade dynamics in our configuration with a continuous densification the dynamics will at one point become a cascade dynamics and turbulent due to the retro action of the recirculation dynamics on the gravity current a counter current at the surface at the downslope side of the gravity current can lead to an upslope ekman transport and the gravity current cascades down the incline in a thickened bottom boundary layer the dynamics in the experiment is rich due to the interaction of the different phases it is important to note that in the case without rotation the oblique acceleration at the source points leads to a cyclonic circulation in most of the domain and the circulation has an effective f which is however small strongly varying in space and time the circulation is qualitatively different as rotation does not constraint the thickness of the downslope gravity current and it descends as a non rotating gravity current the intruding current is not confined to the slope and the recirculation of the water above is not influenced by rotation 8 conclusions the dynamics in the present experiment evolves on a large range of scales from basin scale circulation to the synoptic eddies the sub mesoscale processes that approach a 3d turbulent behaviour mixing diffusion and down to the ekman dynamics due to viscous friction at the smallest scales the dynamics also shows an abundance of internal waves which are not discussed here for the experiments evolving in a rotating frame we showed that the basin wide circulation is always close to geostrophic away from the boundaries but this does not mean that the evolution is quasi geostrophic quasi geostrophy relies on the conservation of potential vorticity it is the dynamics that is observed when the geostrophy is perturbed by non linearity a spatially varying coriolis parameter small variations of topography and variations in the vertical stratification see vallis 2017 these perturbations act from the basin scale to the synoptic scale in the here presented circulation however the evolution of the geostrophic equilibrium is determined by sub mesoscale 3d turbulent and diffusive processes when these diabatic processes perturb the geostrophic equilibrium potential vorticity is not conserved and the dynamics is not quasi geostrophic it is a circulation which we here call sub quasi geostrophic we refer the reader to morel et al 2019 for a rigorous discussion of the effect of diabatic processes on the potential vorticity more precisely it is important to note that the circulation of the tangential velocity and the radial density gradient observe the thermal wind relation away from the boundaries while the dynamics in the radial dynamics is governed by 3d turbulence and friction it is the radial dynamics which is neither geostrophic nor quasi geostrophic that determines the temporal evolution of the circulation the experiment allows the separation in tangential and radial part and the averaging along a homogeneous direction ϕ this permits to evaluate the effect of sub quasi geostrophic processes on the geostrophic circulation credit authorship contribution statement achim wirth science writing of the paper numerical simulations data analysis maria eletta negretti science writing of the paper declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we are grateful to francis auclair lucie bordois and franck dumas for discussion the work was funded by shom contract n 20cp03 
23844,using a set of direct numerical simulations dns we investigate the circulation of a buoyancy driven experiment in a circular rotating tank the initial density structure is a two layer stable stratification the water is densified at 32 points at the upslope side of a circular incline and flows downward as a gravity current before it intrudes to the interior along the interface between the two layers the water above recirculates to the densification points when the buoyancy production is lower than the maximal ekman transport the gravity current proceeds in the laminar ekman layer in the opposite case the water cascades down the incline in a no stationary dynamics turbulent transport becomes important and the boundary layer is thickened the thermal wind relation applied to the tangential velocity averaged along the slope predicts the density structure averaged along the slope in the domain when the densified water arrives at the interface it flows along the slope in the cyclonic direction in a geostrophically adjusted deep boundary current the distance of the boundary current from the slope is given by inertial overshoot of the ekman current due to the self advection by the inertia when this distance is small the boundary current is close to the slope and subject to boundary friction in the opposite case the boundary current evolves detached from the boundary the intrusion along the interface in the negative radial direction is slow as the intruding distance is proportional to the square root of time the recirculation in the upper layer is close to a geostrophic equilibrium its quasi geostrophic evolution is due to the compression of the water column caused by the gravity and intruding currents below this leads to a large scale anti cyclonic circulation in the upper layer when the associated geostrophic surface pressure gradient exceeds the pressured gradient due to the dense water on the slope the ekman transport is upslope a special emphasis is put on the interactions of the three phases of the circulation gravity current intrusion and recirculation the circulation and the mixing of density and momentum in the gravity current determine the water mass properties in the deep boundary current both determine the recirculation the recirculation leads to an increasing anti cyclonic circulation above the gravity current which through the corresponding surface pressure gradient reduces and finally blocs the downslope movement in the ekman layer keywords rotating gravity current slope current intrusion recirculation 1 introduction density differences in fluids created through differential heating by the sun or other heat sources are combined with the gravitational acceleration the major source of motion in environmental fluids the lighter fluid is accelerated upward and heavier fluid downward the vertical acceleration and buoyancy transport leads to horizontal pressure gradients and horizontal motion when the vertically moving fluid encounters a solid boundary a gravity current is created here we discuss only descending dense gravity currents the physics of rising buoyant gravity currents is identical when density differences are small when the boussinesq approximation applies the gravity current moves along the boundary until its downward motion is halted by the bottom or by a fluid of higher density and its motion is redirected to horizontal the circulation is influenced by turbulence which mixes density and momentum bottom friction the rotation of the earth and many other processes simpson 1982 griffiths 1986 wåhlin and walin 2001 monaghan 2007 baines 2008 wirth 2009 the difference between atmospheric and oceanic gravity currents is that the former evolve mostly on time scales shorter than a day while the descend of the latter is slower takes several days and the rotation of the earth plays a governing role oceanic gravity currents have been extensively studied in the past these studies were mostly concerned with the downward motion and its arrest at the ocean floor most oceanic gravity currents are however halted in their downward propagation by a denser water mass and do not reach the ocean floor observed examples are the outflows at gibraltar baringer and price 1999 bab el mandeb johns and sofianos 2012 the strait of hormus pous et al 2004 into the baltic sea umlauf et al 2007 or the overflows at the denmark strait käse et al 2003 and in the faroe bank channel fer et al 2010 as well as the gravity currents in the gulf of lions flexas et al 2002 laboratory experiments on rotating gravity currents have been performed by griffiths 1986 shapiro and zatsepin 1997 cenedese et al 2004 davarpanah jazi et al 2020 rubino et al 2020 and many others numerical simulations of idealised and observed gravity currents are numerous see i e chang et al 2008 legg et al 2009 laanaia et al 2010 yankovsky and legg 2019 and references therein the laboratory experiments and the numerical simulations mentioned do not consider the intrusion of rotating gravity currents while the observed gravity currents mentioned above are all intruding at one point stop their downward motion along the slope in the present work we are concerned with a gravity current its intrusion when the downslope propagation is arrested by a layer of dense water and the recirculation in the water above as well as the interaction of these three phases to this end we have envisioned a physical model which is realised on the coriolis platform at legi grenoble france and use a mathematical model thereof the hydrostatic equations of geophysical fluid dynamics which are integrated numerically using the croco ocean code the aim is to set up a hierarchy of experimental mathematical and numerical models to further our understanding of the average circulation of oceanic gravity currents that flow downslope into a stratified environment intrude into the interior and lead to a recirculation of the superposing water masses the emphasis in the present work is on the large scale circulation leaving the dynamics of the turbulent fluctuations for future publications such separation between an averaged circulation and fluctuations in a non statistically stationary dynamics is made possible by the circular symmetry of the experiment which allows for averaging along the angle ϕ see fig 1 note that the present configuration is substantially different from a lock release gravity current in a rotating frame on a flat ground see i e dai and wu 2016 2018 we densify the water continuously with no initial shock or loss of balance neither hydrostatic nor geostrophic in our experiment balance is mainly broken by small scale friction processes the radius at which the injection sites are placed is large and plays a subdominant role indeed the geometry is chosen so that the process approaches an infinitely long gravity current dominated by hydrostatic and geostrophic balance the results from the laboratory experiment will be presented elsewhere negretti et al 2021 the goal of the numerical simulations is to perform controlled experiments that help to understand the more involved less controlled and only partially observed phenomena in the laboratory experiments rather than creating a numerical twin the here discussed numerical simulations are therefore a component of the hierarchy of models discussed above connecting in a systematic way analytic solutions to eddying simulations to laboratory experiments and environmental observations 2 experiment and qualitative description a top and a side view of the experiment is presented in figs 1 and 2 respectively the tank performs a uniform rotation with the coriolis frequency f 2 ω 4 π t where t is the period of rotation initially there are two water masses the upper of density ρ 1 and layer thickness of h 1 superposes a denser bottom layer of density ρ 2 and thickness h 2 see table 1 for values at 32 source points marked by black dots in figs 1 and 2 equidistantly distributed at a distance of 6 25 m from the centre the water is accelerated along the inclined plane of slope α 0 1 at an angle of ς 45 with respect to the down slope direction the acceleration force is constant in time and equal in all experiments expx2 it is tenfold smaller in exp01 and a hundred fold smaller in exp000 the oblique acceleration rather than a downslope acceleration is used to speed up geostrophic adjustment of the resulting rotating gravity current the volume of the pushed water is m s the density of the source water is given as usually done in oceanography by its dimensionless sigma value σ s ρ s 1000 where ρ s is measured in kg m 3 it is increased by δ ρ s 10 kg m 3 that is δ s 10 at the source points leading to an overall buoyancy production rate 1 b s m s g ρ s ρ 1 ρ s where g is gravity the total sigma value of a water mass that has a certain concentration of source water and water form layer 1 and 2 is σ σ s σ 2 note that σ 1 0 the density in kg m 3 is therefore ρ 1000 σ s σ 2 please note that for numerical reasons see section 4 no water is added during the experiments the total volume stays constant throughout the experiments this differs from the laboratory experiments presented in negretti et al 2021 where dense water is injected the circulation is governed by the large scale mass fluxes through convergence and divergence and is therefore different between the numerical results presented here and the laboratory experiments presented in negretti et al 2021 more precisely the dynamics above the gravity current is governed by the recirculation of the water masses in both the laboratory experiment and the numerical experiment the recirculation is different in the laboratory experiment due to the injection of water smaller scale processes are relatively more independent of the large scale balances and the corresponding numerical results will be compared to the laboratory experiments elsewhere the source water flows as a gravity current towards the centre along the topography and is further deviated to the right by the coriolis force leading to a cyclonic circulation when it encounters the bottom layer the downslope motion stops and the source water intrudes along the interface and forms a boundary current proceeding cyclonically along the slope instabilities of this intruding boundary current might lead to intermittent intrusions of source water towards the centre of the domain when the source water proceeds towards the centre as it travels downslope and intrudes it compresses the water column above leading to an outward flow towards the source points in the upper layer called recirculation see fig 2 this recirculating flow is deviated by the coriolis force to the right leading to an anti cyclonic circulation the circulation is therefore separated in three phases operating in different areas the gravity current on the slope the intrusion at the interface and the recirculation above the gravity current and the intrusion making this qualitative description quantitative is hampered by the presence of turbulent fluxes of mass and momentum that cannot be related to the average quantities in a straight forward way a problematic which is referred to as the closure problem due to the periodicity of the experiment along concentric circles with 32 repetitions averages can be taken along the angle ϕ the almost homogeneous direction in the experiment this allows to distinguish between a spatial average along ϕ called circulation which is a function of the radius r the vertical coordinate z and time t the deviations from this average are called fluctuations the origin of fluctuations can be either due to the discreteness of the point sources or appear spontaneously or is a combination of both it is seen in the laminar and turbulent experiments that with the downslope distance from the source sites the gravity current evolves towards statistical homogeneity in the ϕ direction forgets about the periodicity and details of the source determining the evolution of the circulation is the purpose of this communication the dynamics does not reach a statistically stationary state as both the circulation and the moments of fluctuating quantities averaged along ϕ are evolving in time for numerical reasons we do not analyse the current around the 32 sites where dense water is generated as the mode of generation mimics the source of the laboratory experiment as closely as possible but is not identical and furthermore has no correspondence in oceanic context in the environment the densification of air and water happens over large areas orders of magnitude larger than the area of the gravity current which is a small scale phenomena in the global ocean circulation in laboratory and numerical experiments dedicated to the dynamics of gravity currents we do not have the space available to closely mimic the densification we therefore focus on the common features of gravity currents the downslope motion and the intrusion and restrict our analysis to a region within a radius of 5 5 m 3 theory we use a polar coordinate system where all variables depend on the radius angle height and time respectively r ϕ z t the unit vector in the local radial direction is r ˆ and ϕ ˆ is the unit vector in the locally tangential direction to the platform centre the velocity components in the polar coordinates are denoted by u r u ϕ ˆ w the almost homogeneity of the experiment along the angle ϕ allows to separate the dynamics in a circulation and fluctuations to this end we denote the averages over a circle of a given radius of any variable a by a z r t a z r ϕ t ϕ this averaging allows to obtain the circulation a z r t in the experiment the fluctuations are then a z r ϕ t a z r ϕ t a z r t of which we analyse the moments by again averaging along the angle ϕ notice that the circulation and the statistics of the fluctuations moments of fluctuating quantities evolve in time the dynamics does not reach a statistically stationary state but the homogeneity along ϕ allows for averaging over turbulent fluctuations and obtaining an averaged circulation and average turbulent fluxes as described above we can distinguish three phases in the circulation gravity current intrusion and recirculation the theory necessary to describe each of the phases will be discussed in the following subsections 3 1 gravity current on its downslope propagation the gravity current continuously adjusts to the rotating frame passes from a non rotating downslope gravity current to a cross slope rotating gravity current in geostrophic equilibrium see shapiro and zatsepin 1997 wåhlin and walin 2001 and wirth 2009 when a laminar gravity current of density ρ s is flowing through an inert ocean of density ρ 1 its circulation approaches geostrophic equilibrium in which the cross slope velocity u ϕ ˆ is obtained by a balance between the downslope acceleration which is given by the product of the topographic slope α and the reduced gravity b s g ρ s ρ 1 ρ s 9 71 1 0 2 m s 2 and the inverse of the coriolis acceleration this balance allows to define a geostrophic velocity associated to the slope and the density difference 2 u g u ϕ ˆ α b s f 0 9 25 1 0 2 ms 1 where the numerical value corresponds to the reference experiment exp02 in our experiments the water above the gravity current is in motion and the density varies smoothly for such case the geostrophic equilibrium generalises to the thermal wind relation 3 z u ϕ ˆ g g r ρ f ρ 4 z u r g g ϕ ˆ ρ f ρ the thermal wind relation is used in section 6 1 to show that the tangential component of the circulation is always close to geostrophic equilibrium even within the gravity current when the thermal wind relation applies to the circulation it has no radial or downslope velocity u r g ϕ 0 this follows from eq 4 as the average along ϕ of the r h s vanishes and u r g ϕ 0 at the centre by definition it follows that for a downslope propagation of dense water we need and or fluctuations friction non linearity time dependence due to bottom friction an ekman layer appears at the bottom of the gravity current in which dense water is transported downward the structure of the gravity current is composed of a thick vein superposing a thin frictional ekman layer as shown in shapiro and zatsepin 1997 wåhlin and walin 2001 and wirth 2009 in the ekman layer the cross slope velocity is reduced by friction the coriolis force no longer balances the downslope acceleration and the dense water descends when the velocity above the gravity current vanishes the downslope transport is proportional to the shear force at the slope the thick part of the gravity current not directly subject to frictional forces is called the vein it is influenced by the ekman layer dynamics from below through ekman pumping wåhlin and walin 2001 wirth 2009 derived parameters for a constant viscosity law are the thickness of the ekman layer δ ek the shear vector τ the downslope ekman transport t ek the total downslope ekman transport m ek in the experiment and the total downslope buoyancy transport b ek 5 δ ek 2 ν f 0 4 37 1 0 3 m 6 τ τ r τ ϕ ˆ ν u g δ ek 1 1 ν 2 f α b s 1 1 7 t ek τ r f δ ek 2 u g α b s ν 2 f 3 8 m ek l t ek 2 π r α b s ν 2 f 3 6 35 1 0 3 m 3 s 1 9 b ek σ s m ek 6 35 1 0 2 kg s 1 where numerical values refer to the reference exp02 for which f f 0 see tables 1 and 2 the values of m ek and b ek give the maximal amount of volume and kg of salt that can be transported downslope by the ekman layer the value for the maximal buoyancy transport does not take into account the mixing and diffusion at the source and on the way down the incline the ekman layer is subject to diffusion so its downslope buoyancy anomaly reduces over a characteristic length scale 10 l e k u g δ e k 2 κ 2 ν α b s f 2 κ 1 4 m the determining parameter is the flux ekman number d e k b ek b s comparing the buoyancy the ekman dynamics can transport downward to the source buoyancy anomaly b s see eq 1 when the source rate exceeds the value d e k 1 buoyancy accumulates and the thickness of the vein increases when the vein becomes unstable other time and space dependent processes can lead to a downward buoyancy transport in this case the transport happens at a thick boundary layer it is turbulent and it cascades down the incline the thickening of an accelerating boundary layer in a rotating frame was analytically shown by huthnance 2009 for an idealised case for a discussion of cascading in the ocean from observations and its representation in realistic numerical simulations i refer to luneva et al 2020 for the arctic and to rubino et al 2012 for the mediterranean both works emphasise the importance of the topographic structure on the cascading a subject that is not considered here 3 2 intruding current due to the periodicity in the ϕ direction there is no average pressure gradient in this direction and therefore also no geostrophic radial circulation u r g ϕ 0 non linearity or friction can relax the geostrophic constraint and allow for a circulation in the radial direction non linearity allows for an inertial overshoot while friction leads to a radial circulation on the slope in ekman layers and between water masses of different densities in interfacial ekman layers when the gravity current water arrives at the interface it has a density anomaly b in if the downward transport given by eq 7 is done by the ekman layer the corresponding downslope velocity in the negative r direction is u b in 2 if the current performs an inertial overshoot it penetrates a maximal distance 11 l iner u b in 2 f α b in 2 f 2 into the interior while turning anti cyclonically the numerical integrations discussed below show that dense water follows the slope it resembles a deep boundary current that grows in breadth and thickness due to a constant supply of dense water by the gravity current the thermal wind relation of eq 3 relates slope of the pycnocline in the radial direction to the velocity of the deep boundary current and therefore to b in when the deep boundary current grows in breadth extending away from the boundary it also has to increase its vertical extension a constant influx of dense water then leads to an intrusion where the square of the intruding distance is proportional to time x in 2 γ t where γ is a constant note that a proportionality of the intrusion to the square root of time does not mean that the intrusion is done by diffusive processes it occurs when the cross section of the deep current preserves its shape while being supplied by a constant influx of dense water 3 3 recirculation in the upper layer which is not directly subject to strong frictional forces the dynamics can be described by the conservation of potential vorticity q 12 d d t q t u r r u ϕ ˆ ϕ ˆ ζ f h 0 13 ζ u ϕ ˆ r r u ϕ ˆ ϕ ˆ u r where ζ is the vorticity when we consider the potential vorticity of the circulation by averaging along ϕ ϕ the advection of potential vorticity along ϕ disappears note that it is in the ϕ direction that we have the strongest large scale advection when we further neglect the radial advection an approximation which will be justified by the data analysis in section 6 3 eq 12 simplifies to a balance between the local change of vorticity and the local vortex stretching 14 t ζ ϕ ζ f h t h ϕ we further average the dynamics in a surface layer down to a depth h 0 0 1 m by using the average ζ h 0 and obtain a relation between the change of vorticity and the vertical velocity w h 0 vortex stretching 15 t ζ ϕ h 0 r t ζ ϕ h 0 f h 0 w h 0 ϕ where we used w h 0 t h h 0 which measures the negative vortex stretching of the above water column the recirculation dynamics is forced by vortex stretching represented by the vertical velocity which is measured in the experiments when horizontal advection of potential vorticity is neglected we obtain integrating eq 15 in time and using eq 13 16 u ϕ ˆ ϕ h 0 r t r r u ϕ ˆ ϕ h 0 r t f δ h r t h 0 17 with x x x x x x x x x δ h r t 0 t w h 0 ϕ h 0 d t this shows that in the recirculation area a clockwise circulation grows constantly in time when turbulent fluxes are neglected the ekman transport becomes upslope at a time t up when u ϕ ˆ t u g that is when the geostrophic surface pressure gradient pushing the water upslope exceeds the downslope gravitational acceleration of the gravity current water 3 4 turbulent parameters non dimensional geometric parameters are the slope α and the stretching parameter γ α l d where l is length of the slope and d the average depth the prandtl number compares viscosity to diffusivity p r ν κ 20 3 the turbulent regimes are usually characterised by the reynolds number r e the richardson number r i the froude number f r and the rayleigh number r a if we base these numbers on the ekman layer thickness δ ek they are related 18 r e u g δ ek ν 2 b s f 3 ν 416 19 r i δ b s u g 2 2 ν f 3 α b s 2 α r e f r 2 4 82 1 0 4 20 r a b s δ ek 3 ν κ 2 r e p r 5545 where numerical numbers correspond to the reference experiment exp02 note that with increasing coriolis parameter both the geostrophic velocity and the ekman layer thickness decrease and so does the reynolds number based on ekman dynamics the ekman number e k is the square of the thickness of the ekman layer divided by the square of the thickness of the gravity current 4 direct numerical simulations dns the model used is the hydrostatic version of croco https www croco ocean org which solves the free surface primitive equations its dynamical kernel is described in shchepetkin and mcwilliams 2009 the simulations of the domain are performed at a horizontal resolution of 13 5 m 1024 2 and there are 64 σ levels in the vertical finest resolution of the first level varies from 1 mm at the upper part of the incline to 5 mm at the deepest part of the domain the boundary condition at the bottom is no slip the time step is δ t 3 1 0 3 s since we found that increasing the volume by injecting fluid as it is done in the experiments on the coriolis platform leads to a numerical instability at the free surface except for very weak injection rates therefore we choose to accelerate the water above the source points 32 grid points at r 6 25 m in the lower 2 5 cm at an angle of 45 to the radial direction the acceleration force is constant in time and equal in the experiments expx2 x 0 1 2 3 4 the total accelerated water mass is increased by a density of 10 kg m 3 the resulting buoyancy flux is given below for each experiment no water is injected and the total volume stays constant throughout the experiments the acceleration and densification procedure cannot be easily implemented in the laboratory experiment and the laboratory experiment and the numerical experiment differ in this aspect we emphasise that such kind of forcing can be implemented at high financial costs in a laboratory experiment by putting pumps and adding salt at the source points by changing the injection mode in the numerical experiments with a low injection rate no dependence of averaged quantities on the injection mode was observed further downstream of the injection points the advection scheme are 5th order in space for tracers and momentum in the horizontal and vertical direction we performed direct numerical simulations dns using the molecular values of water for the viscosity ν 1 1 0 6 m 2 s 1 and the thermal diffusivity κ 1 5 1 0 7 m 2 s 1 we are aware that the numerical diffusion may exceed the explicit values but as the implementation of the equations in the croco code is consistent the solutions will converge as the resolution in space and time is refined 5 experiments performed we performed seven experiments all extending over a time interval of at least t 3000 s the physical parameters of the reference experiment exp02 are given in table 1 the parameters varied between experiments are the source rate and the rotation rate for experiments exp00 and exp01 we reduced the source rate by a factor of 100 and 10 respectively the low source rates lead to an almost linear evolution of the dynamics the other experiments all have a high source rate but different rotation periods of t 30 exp32 60 exp12 120 exp02 and 240 exp42 experiment exp22 has no rotation that is t the early evolution of the density structure in the first grid point above topography is given in fig 3 for the low and the very high rotation cases in the centre of the domain the water mass of density ρ 2 is seen in all experiments and at all times in the low rotation rate experiment the oblique injection is seen at the source and the dense water moves down in the ekman layer at all times during the experiment in the highest rotation case the coriolis force deviates the flow to the right and the dense water turns upslope before moving principally along the slope due to geostrophic adjustment at later times the dynamics is turbulent down to the lower boundary the parameters varied as well as the geostrophic velocity and the ekman layer thickness using formulas from section 3 are given in table 2 6 results we distinguish four different areas of the dynamics in our experiment one is the source region around the injection points the mode of source implemented in the numerical model is close to the injection in the laboratory experiment performed on the coriolis platform which differs from the source of gravity currents in the natural environment see section 2 the strongly turbulent dynamics in this area consisting of mostly cyclonic eddies depends on the details of the source lacks generality and will not be discussed here we will consider the downslope movement of the dense water in a gravity current on the slope at a distance from the source sites when the dynamics has forgotten about the details of the densification process this area starts about half a metre downslope from the sources and extents down to the interface at which the dense water intrudes to the interior along the interface the downslope and intruding current pushes away the surrounding water that recirculates to the source region above the gravity current as shown in fig 2 the three phases considered gravity current intrusion and recirculation take place in distinct areas of the experiment the circulation in each of the phases is analysed in the following subsections using data from the numerical experiments 6 1 gravity current the density in the lowest level above the bottom is given in fig 3 for the low exp42 and the very high rotation exp32 cases while in the low rotation case the laminar ekman dynamics prevails during the experiment the bottom boundary layer becomes turbulent in the very high rotation case in fig 4 right column the total radial buoyancy transport t s z u r σ s ϕ is plotted for three values of the radius over the slope at t 3000 s as a function of the vertical direction z for three different experiments for the low rotation the downward transport is performed by the thin ekman layer as seen in exp02 and exp42 upper and middle right panel of fig 4 called ekman case in the sequel the downward and inward transport depends on the shear force exerted by the bottom boundary es described in section 3 just above the gravity current there is a counter flow and the detrained salty water flows upward and outward leading to an upward and outward transport of dense water see fig 4 the upslope transport also shows that the gravity current is detraining which leads to a decrease of the downslope buoyancy transport with the downslope direction which can be seen in the same figure looking at profiles for different values of the radius r the total buoyancy transport can be separated into a part due to the circulation t s c z u r ϕ σ s ϕ and a fluctuating part t s f z t s z t s c z for the ekman dynamics the fluctuating part is negligible which shows that the dynamics is close to laminar fig 4 and that the homogeneity due to the 32 source points decreases in the downslope direction and has almost disappeared 1 m downslope of the source sites using the thermal wind relation eq 3 the density structure averaged along the angle ϕ can be obtained from the tangential velocity averaged along the angle ϕ as can be seen in the middle column of fig 4 note that the thermal wind relation does not apply to non averaged quantities due to the presence of inertia gravity waves in the very high rotation case exp32 the anti cyclonic circulation in the recirculation area becomes so strong that also near the bottom the circulation is anti cyclonic and therefore the ekman transport is upslope this can be seen in the lower right panel of fig 4 and in fig 6 where at the upslope location r 5 53 m the tangential velocity u ϕ ˆ averaged along the angle ϕ is always negative which leads to an upslope ekman transport in terms of the thermal wind relation this means that the horizontal density variations in the fluid are not strong enough to counter balance the geostrophic pressure gradient at the surface when the volume of the water densified at the source per time exceeds the downward ekman transport the dense water accumulates for some time at the upper part of the incline until it proceeds downward above the ekman layer as can be seen for exp32 in fig 4 no laminar solution is available and the fluctuating buoyancy transport is performed in a thick turbulent boundary layer this behaviour will be called cascade dynamics in the sequel in the same figure we also see that the turbulent transport is always down slope the cascade dynamics has a turbulent transport which is strongly increased the downward transport is very intermittent in time and consists of avalanches or bursts not shown note that also in the cascading dynamics the circulation part of the downslope transport is confined to the bottom ekman layer this can be seen by looking at the difference of the full line and the dashed line in the lower right panel of fig 4 6 2 intruding current for the lowest rotation case the density anomaly of the source water σ s ϕ as well as the isolines of u ϕ ˆ ϕ are given in fig 5 the intrusion towards the interior of the source water leaving the incline is clearly visible the cyclonically progressing deep boundary current is seen by the isolines of the tangential velocity u ϕ ˆ ϕ note that the distance of the centre of the current is located at a horizontal distance of about l deep 70 cm from the intrusion point which is much larger than l iner 91 cm where we used eq 11 and b in 5 1 0 2 m s 2 see fig 5 and the deep current be explained by an inertial overshoot it is also interesting to note that the deep boundary current of exp42 is not squeezed to the boundary there are no strong velocity gradients or boundary layers associated to it this indicates that the boundary current is not subject to strong frictional processes a friction time can be estimated as t deep l deep 2 ν 5 1 0 5 s much longer than the duration of the experiment the interfacial friction is however strong enough to sustain an interfacial ekman layer responsible for the intrusion this is clearly visible in fig 5 where the bottom ekman layer leaves the boundary and proceeds in the interior as an interfacial ekman layer the velocities in the interfacial ekman layer are almost an order of magnitude smaller than in the bottom ekman layer and its strength decreases as it penetrates to the interior at the top of the intruding current there is another ekman layer in which the transport is directed towards the boundary the averaged radial velocities u r ϕ are small typically two orders of magnitude smaller than the averaged tangential velocities u ϕ ˆ ϕ the persistence of the interfacial ekman layer does not contradict the findings of wirth 2011 where it was shown that ekman layers disappear when the system is freely evolving that is far from a boundary for the highest rotation case l iner 1 4 cm and the deep boundary current is squeezed against the boundary and the ekman layer does not separate from the boundary see fig 6 we observe that the square of the intruding distance along the interface is proportional to time x 2 t as demonstrated in figs 7 and 8 where a clear scaling is observed for at least one decade for all experiments with rotation in both figures the time is counted from the arrival of the corresponding s value at the point from which the current intrudes the scaling is illustrated in fig 7 for exp02 using different values of σ s in fig 8 results from experiments for one value of σ s for each experiment performed is presented the non rotating case exp22 also shows the scaling behaviour due to the oblique injection at 45 the fluid is rotating and the dynamics has an effective coriolis frequency which is however low and varies in space and time for the faster rotating cases exp12 and exp32 the scaling is no longer observed for approximately t 1000 s as the gravity current changes from ekman layer dynamics to cascading more precisely the intruding current proceeds faster than x t resembling a linear growth x t for exp032 from t 1000 to 2000 s see fig 8 in section 3 we showed that not only the increase of the intrusion scales with time but also the rate of increase the offset of the graphs corresponding to different experiments in fig 8 has a dimensional scaling of γ f 1 this scaling is observed between the two lower rotation cases but breaks down when considering the faster rotating cases this is no surprise as we have seen that the downslope regime changes qualitatively with the rotation rate for the higher rotation cases going from ekman dynamics to cascading scaling behaviours can only be expected when the same dynamic regime prevails 6 3 recirculation the dynamics extending from above the gravity current to the surface is not subject to frictional processes and turbulent fluxes are negligible when the gravity current circulation is sub critical furthermore the abundant internal waves have only a weak direct influence on the recirculation a maximal rossby number of the recirculation can be calculated by calculating ε max 2 u ϕ ˆ ϕ f r for r 6 m in all experiments with rotation and for the duration of the experiments investigated we have ε 0 2 well within the regime of quasi geostrophy this is demonstrated by fig 9 which shows that the conservation of potential vorticity using averaged variables only allows to explain the recirculation the figure gives the approximated potential vorticity balance of eq 15 neglecting the horizontal advection of potential vorticity last term in the equation more precisely the layer between a depth of 0 15 m and 0 01 m is considered in this figure the l h s of eq 15 and the spatial averaged r h s superpose within statistical error for exp02 at t 1500 s and 3000 s for 0 r 5 5 m this shows that this part is well described by the conservation of potential vorticity and that fluctuations and turbulent fluxes can be neglected the noisiness of the black line is due to the sensitivity of the vertical velocity to gravity waves which leave their signature even in the averages w h 0 ϕ for higher values of r 5 2 m the approximation fails due to the strong eddy activity and the associated turbulent fluxes furthermore in the vicinity of the source points strong downward velocities occur and the concept of shallow water potential vorticity is no longer applicable comparing both panels in fig 9 shows that the magnitude of the tangential velocity increases with time as predicted for a continuous forcing by the vertical velocity the recirculation does not attain a stationary state when the negative tangential velocity becomes smaller than the negative of the geostrophic velocity just above the ekman layer as seen at t 3000 and r 5 m in exp32 green line in left lower panel of fig 4 the transport in the ekman layer is directed upslope see discussion in the previous subsection the approximation for the potential vorticity conservation is observed for the lower rotation rates for the times of the integration but breaks down when the rotation rate is increased or at later integration times due to the intermittent cascading dynamics influencing the recirculation 6 4 interaction of gravity current intrusion and recirculation the gravity current dynamics decides on the downward volume and buoyancy transport the amount of volume and buoyancy that arrives at the intrusion point governs the dynamics of the deep boundary current both the gravity current and the intruding dynamics lead to a compression of the super posing water column the water above recirculates outward and turns anti cyclonically at an increasing rate during this process the thermal wind balance prevails when the tangential velocity above the gravity current exceeds the geostrophic velocity the geostrophic pressure gradient pushes the water upslope in the ekman layer this can be seen in lower right panel of fig 4 where at r 5 m the ekman transport is clearly inverted upslope the downward buoyancy transport passes from a laminar ekman dynamics to cascading down the incline above the ekman layer 7 discussions we have performed a series of numerical experiments on a configuration of buoyancy driven flows varying the densification rate and the rotating rate the circular symmetry and the high number of sources allow for averaging along the angle ϕ and mathematically separating the dynamics in a circulation and fluctuations where both are evolving in time the purpose of the experiment is to not only describe the different processes involved gravity current intrusion and recirculation but also their interaction we found a qualitative change in the gravity current going from the ekman dynamics when the buoyancy production rate is lower than the maximal buoyancy ekman transport to the cascade dynamics when it is higher this prevents a clear scaling of the observed quantities with the rotation rate and the buoyancy production rate when the gravity current water reaches the interface it intrudes along the interface between a denser and a lighter water mass the intrusion can be explained by an inertial overshoot and leads to a deep boundary current that is well separated from the incline in the lower rotation case while it stays attached to the boundary in the fast rotating cases in the former case the dynamics of the deep boundary current is not subject to strong boundary friction over at least one decade in time the intrusion of the gravity current water proceeds at a rate that is proportional to t for the rotating cases in the faster rotating cases the scaling behaviour disappears when the cascading reaches the interface and the propagation increases resembling a linear scaling for the fastest rotation this can probably be explained by the appearance of coherent dipole structures that resemble hetons hogg and stommel 1985 transporting buoyancy anomalies in a ballistic way away from the incline research with simulations dedicated to this subject will be performed in the near future the intrusion of source water does not proceed at a constant velocity and can be called non intruding when the buoyancy transport is performed by the ekman transport the recirculation leads to a continuous increase of the anti cyclonic tangential velocity in the upper layer which results in a blockage of the buoyancy transport in the ekman layer below and the gravity current dynamics passes to a cascade dynamics in our configuration with a continuous densification the dynamics will at one point become a cascade dynamics and turbulent due to the retro action of the recirculation dynamics on the gravity current a counter current at the surface at the downslope side of the gravity current can lead to an upslope ekman transport and the gravity current cascades down the incline in a thickened bottom boundary layer the dynamics in the experiment is rich due to the interaction of the different phases it is important to note that in the case without rotation the oblique acceleration at the source points leads to a cyclonic circulation in most of the domain and the circulation has an effective f which is however small strongly varying in space and time the circulation is qualitatively different as rotation does not constraint the thickness of the downslope gravity current and it descends as a non rotating gravity current the intruding current is not confined to the slope and the recirculation of the water above is not influenced by rotation 8 conclusions the dynamics in the present experiment evolves on a large range of scales from basin scale circulation to the synoptic eddies the sub mesoscale processes that approach a 3d turbulent behaviour mixing diffusion and down to the ekman dynamics due to viscous friction at the smallest scales the dynamics also shows an abundance of internal waves which are not discussed here for the experiments evolving in a rotating frame we showed that the basin wide circulation is always close to geostrophic away from the boundaries but this does not mean that the evolution is quasi geostrophic quasi geostrophy relies on the conservation of potential vorticity it is the dynamics that is observed when the geostrophy is perturbed by non linearity a spatially varying coriolis parameter small variations of topography and variations in the vertical stratification see vallis 2017 these perturbations act from the basin scale to the synoptic scale in the here presented circulation however the evolution of the geostrophic equilibrium is determined by sub mesoscale 3d turbulent and diffusive processes when these diabatic processes perturb the geostrophic equilibrium potential vorticity is not conserved and the dynamics is not quasi geostrophic it is a circulation which we here call sub quasi geostrophic we refer the reader to morel et al 2019 for a rigorous discussion of the effect of diabatic processes on the potential vorticity more precisely it is important to note that the circulation of the tangential velocity and the radial density gradient observe the thermal wind relation away from the boundaries while the dynamics in the radial dynamics is governed by 3d turbulence and friction it is the radial dynamics which is neither geostrophic nor quasi geostrophic that determines the temporal evolution of the circulation the experiment allows the separation in tangential and radial part and the averaging along a homogeneous direction ϕ this permits to evaluate the effect of sub quasi geostrophic processes on the geostrophic circulation credit authorship contribution statement achim wirth science writing of the paper numerical simulations data analysis maria eletta negretti science writing of the paper declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we are grateful to francis auclair lucie bordois and franck dumas for discussion the work was funded by shom contract n 20cp03 
