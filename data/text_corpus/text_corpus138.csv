index,text
690,in this study an efficient numerical model is proposed to simulate the hydro mechanical coupling in the fractured vuggy porous media containing multi scale fractures and vugs specifically an improved equivalent continuum model ecm which is obtained through the asymptotic homogenization method is applied to model micro fractures and vugs while macro fractures are modeled explicitly by using the embedded discrete fracture model edfm and non matching grids as an important feature of the explicit representment the effects of fillings and fluid pressure on preventing macro fractures from closing can be considered after that the new mixed space discretization i e mimetic finite difference mfd method for flow and stabilized extended finite element method xfem for geomechanics and fully coupled methods are applied to solve the proposed model the mixed space discretization can deal with complex heterogeneous properties e g full tensor permeability and yields the benefits of local mass conservation and numerical stability in space finally we demonstrate the accuracy and application of the proposed model to capture the coupled hydro mechanical impacts of multiscale fractures and vugs on fluid flow in fractured porous media keywords fractured vuggy porous media hydro mechanical coupling equivalent continuum model homogenization method embedded discrete fracture model 1 introduction in the past few years the numerical simulation of fluid flow in fractured vuggy porous media has received much attention because many fractured vuggy reservoirs have been found worldwide that can significantly contribute to hydrocarbon reserves and production roehl and choquette 2012 hidajat et al 2004 rivas gomez et al 2001 generally naturally fractured vuggy porous media consist of porous matrix fractures and vugs zhang et al 2017 yan et al 2016 zhang et al 2018 2016 and these fractures and vugs significantly increase the effective permeability and affect the flow paths thus they must be accurately represented however numerical simulation of fluid flow in these fractured vuggy porous media is challenging especially when the geomechanics effect cannot be ignored during the production of reservoirs zhang et al 2017 significant efforts have been made to develop appropriate models to model fluid flow in fractured vuggy porous media in recent decades and three categories are commonly used 1 the ecm arbogast and lehr 2006 huang et al 2011 huang et al 2013 2 multiple continuum model wu et al 2006 camacho velazquez et al 2002 wu et al 2011 3 discrete fracture vug network model zhang et al 2018 2016 yao et al 2010 zhu et al 2016 16 in ecm matrix fractures and vugs are represented as a single continuum and the advantages of ecm are its simple data requirement and low computational costs but it usually underestimates the effect of macro fractures and neglects the interaction between matrix fractures and vugs the multiple continuum model in which matrix fractures and vugs are treated as two or more superimposed and interacting continua seem more reasonable for the porous media with dense fractures and vugs however this model still underestimates the effect of macro fractures and it is inappropriate for disconnected fractures and vugs the discrete fracture vug network model incorporates the effects of fractures and vugs explicitly and provides more realistic representation of fractured vuggy porous media but it is inappropriate for the porous media with lots of fractures and vugs due to its high computational costs it has been demonstrated that the geomechanical effect plays an important role in the production of fractured vuggy reservoir zhang et al 2017 thus it is necessary to couple flow and geomechanics to capture the effect of geomechanics on the production although the mentioned models have been applied in some practical cases few of them include the geomechanical effect lewandowska et al developed a macroscopic ecm for hydro mechanical coupling in the porous media containing single isolated fracture vug lewandowska and auriault 2013 in their study biot model biot 1941 1955 is applied for porous media domain while stokes equations batchelor 2000 is assumed for fracture vug domain then they applied the asymptotic homogenization method hornung 1997 auriault et al 2009 to develop the ecm which possesses the same mathematical structure as classic biot model in addition the definitions and auxiliary equations of equivalent parameters were also provided however the definition and auxiliary equations of equivalent permeability are limited and inappropriate for multiple isolated fractures and vugs on the other hand wan et al used the average field theory to formulate an analogous continuum description of hydro mechanical coupling for fractured porous media wan and eghbalian 2016 but their model arises some errors in the porous media with circular vugs recently zhang et al developed a numerical method for modeling hydro mechanical coupling in fractured vuggy reservoirs zhang et al 2017 in their method vugs are modeled as virtual volumes in which the pressure drop is negligible and fractures are modeled by use of refined grids although the geomechanical effect is considered in their study it is only appropriate for the reservoirs with finite number of fractures and vugs due to its high computational costs associated with refined grids generally naturally fractured vuggy porous media include multi scale fractures and vugs yan et al 2016 zhang et al 2016 wu et al 2006 for them none of the mentioned models can accurately and efficiently simulate the hydro mechanical coupling process in this context the hybrid models yan et al 2016 zhang et al 2018 24 khoei et al 2016 in which macro fractures are explicitly modeled and effects of micro fractures vugs are implicitly represented appear to be promising however the existing hybrid models either ignore the geomechanical effect yan et al 2016 zhang et al 2018 or do not consider vugs yan et al 2018a khoei et al 2016 and they cannot be straightly applied to simulate hydro mechanical coupling in the fractured vuggy porous media include multi scale fractures and vugs in this study an improved ecm is developed based on the asymptotic homogenization method in which new auxiliary equations of equivalent permeability are proposed and the improved ecm is appropriate for multiple isolated fractures and vugs then an efficient hybrid model is proposed to simulate the hydro mechanical coupling in the fractured vuggy porous media containing multi scale fractures and vugs specifically the improved ecm is applied to model micro fractures and vugs while macro fractures are modeled explicitly by use of the non matching grids and edfm moinfar et al 2012 yan et al 2016 after that the new mixed space discretization i e the mfd method yan et al 2016 brezzi et al 2005 huang et al 2014 lipnikov et al 2014 for flow and stabilized xfem yan et al 2018a 2018b for geomechanics and fully coupled formulation are applied to solve the hybrid model and the time discretization is fully implicit the proposed method includes the effect of macro fractures explicitly without requiring grids to conform to fracture geometry and avoids explicit representation of micro fractures and vugs this paper is organized as follows the hybrid model combining the improved ecm and edfm are presented in section 2 in section 3 the mixed formulation combining the mfd and stabilized xfem is utilized for space discretization and a fully coupled method is applied to solve the hybrid model finally several numerical examples of hydro mechanical coupling are presented in section 4 to demonstrate the accuracy and applicability of the proposed method 2 model description in this study we focus on the fractured vuggy porous media including multi scale fractures and vugs and we assume there are macro fractures and rock matrix which consists of porous matrix micro fractures and vugs at macro scale as shown in fig 1 the improved ecm based on homogenization upscaling is used for rock matrix and its equivalent parameters are obtained by solving some auxiliary equations on the representative elementary volume rev of rock matrix then the macro fractures are modeled explicitly by use of the edfm 2 1 equivalent continuum model in this section we develop an improved ecm for the rev element of rock matrix based on the asymptotic homogenization method and provide auxiliary equations to calculate all equivalent parameters during the homogenization process fluid is assumed to be viscous newtonian and incompressible fillings in micro fractures and vugs are ignored and these micro fractures and vugs are considered open all the time during the small deformation 2 1 1 local rev model the biot model is used for the deformable porous matrix 1 σ m 0 σ m σ s α p m i σ s ce u s 2 β p m t α e i i u s t v p ϕ p u s t 0 3 v p ϕ p u s t k m μ p m where σ m and σ s are total stress tensor and effective stress tensor respectively p m is pore pressure α is biot coefficient i is identity tensor c is fourth rank elastic tensor u s is the displacement of solid β is compression coefficient t is time v p is the average fluid velocity in micro pore ϕ p ωp ωm is micro porosity k m is the permeability of porous matrix µ is fluid viscosity the strain tensor e u s is defined by 4 e u s 1 2 u s u s t the incompressible newtonian fluid flow in micro fractures and vugs can be described by using stokes equations however the coupling of darcy stokes model is too complicated since additional interface conditions have to be introduced to couple the porous flow and free flow regions nield 2009 arbogast and gomez 2009 as an alternate approach the darcy brinkman model is often used for this coupling flow problem ng and wang 2010 yan et al 2016 which provides a unified equation with continuous variable coefficients in two different flow regions therefore it is not necessary to introduce specific interface conditions any more the brinkman equations used to describe the low velocity free flow in micro fractures and vugs are 5 σ b μ k b v b 0 σ b 2 μ eff e v b p b i 6 v b 0 where σ b v b k b and p b are stress tensor fluid velocity permeability and fluid pressure in micro fractures and vugs respectively µ eff µ ϕ b is the effective viscosity and µ eff µ is used in this study on the inner boundary г we have the continuity of the total stress and pressure 7 σ m n σ b n p m p b where n is the unit normal to г exterior to ωm besides the average velocities in ωm and ωb are equal lewandowska and auriault 2013 auriault and boutin 1992 8 v p ϕ p u s t u s t v b it is noted that the governing equations in micro fractures and vugs are all the same and there is no essential difference between micro fractures and vugs except for their geometrical shapes we consider a macroscopic medium of characteristic size l made of a large number of periodic rev elements ω of characteristic size l and ε l l l p l 1 where l p is the micro pore characteristic size the same assumption which was made in lewandowska s work lewandowska and auriault 2013 is applied here σ s p m and p b are of similar order of magnitude v p u s t and v b are also considered of similar order of magnitude recall that permeability k m is of the order o l p 2 and permeability k b is of the order o l 2 from eq 3 we have 9 v p o l p 2 p m μ l then the ratios of pressure and diffusion terms to viscous term in eq 5 can be evaluated at the macroscopic level as 10 p b 2 μ eff e v b l o p b l 2 μ μ l l p 2 p m o ε 4 μ k b v b 2 μ eff e v b l o μ l 2 2 μ l 2 o ε 2 finally we keep the similar notations for dimensionless physical quantities then obtain the dimensionless local rev model in the following form in porous matrix ωm 11 σ m 0 σ m σ s α p m i σ s ce u s 12 β p m t α e i i u s t v p ϕ p u s t 0 13 v p ϕ p u s t k m μ p m in micro fractures and vugs ωb 14 σ b μ k b ε 2 v b 0 σ b 2 ε 4 μ e v b p b i 15 v b 0 on inner boundary г 16 σ m n σ b n p m p b 17 v p 1 ϕ p u s t v b 2 1 3 equivalent macroscopic model by following the classical asymptotic expansions we look for u s p m v p v b and p b in the form 18 φ φ 0 x y t ε φ 1 x y t ε 2 φ 2 x y t where y x ε y is the local coordinates at the rev scale l while x shows the macroscopic variations at scale l φ i s are ω periodic with respect to y in addition by the chain rule we can get 19 x ε 1 y 2 x 2 2 ε 1 y x ε 2 y 2 then we substitute eqs 18 and 19 into eqs 11 17 and equal the terms appearing at successive orders of ε after the analysis of each problem more details can be found in appendix a we can obtain the equivalent macroscopic model in the following form 20 σ hm 0 σ hm c equ e u hm α equ p hm 21 β equ p hm t γ equ e u hm t v hm 0 22 v hm k equ μ p hm where the subscript hm means the homogenized rock matrix it can be seen that the emc model i e eqs 20 22 presents the same form as classical biot model however the equivalent parameters c equ α equ β equ γ equ and k equ are modified due to the presence of micro fractures and vugs and they are defined as 23 c i j k l equ c i j k l c i j m n e y m n ξ k l m 24 α i j equ ϕ b 1 ϕ b α i i j 1 α c i j k l e y k l η m 25 β equ β 1 ϕ b 1 α 2 e y i i η m 26 γ i j equ ϕ b α 1 ϕ b i i j 1 α e y l l ξ i j m 27 k i j equ k m 1 ω ω y i i j l τ j y l n l d s where ϕ b ωb ω is the volumetric fraction of micro fractures and vugs in the rev element the symbol stands for the volume average the proof of α i j equ γ i j equ can be found in the reference lewandowska and auriault 2013 the ω periodic vector ξ pq of zero volume average over ωm is the solution of 28 y c i j k l e y k l ξ p q 0 in ω m 29 c i j k l e y k l ξ p q n c i j k l e k l n on γ where the tensor e k l δ k p δ l q δkp and δlq are kronecker symbols the ω periodic vector η of zero volume average over ωm is the solution of 30 y c i j k l e y k l η 0 in ω m 31 c i j k l e y k l η n i n on γ and the ω periodic component τj of zero volume average over ωm is the solution of 32 y k m μ δ i j τ j y i 0 in ω m 33 y π j e j in ω b 34 τ j π j on γ where πj is an unknown quantity in ωb e j is the standard cartesian basis vector in jth direction please note that above auxiliary equations of τj are in complete form and different from those of lewandowska and auriault 2013 which are based on the assumption that the pressure is continuous in all micro fractures and vugs i e single isolated fracture vug or all fractures and vugs are connected thus they cannot be used for the disconnected micro fractures and vugs 2 2 embedded discrete fracture model the ecm of rock matrix has been developed in previous section then edfm is used to model macro fractures explicitly we assume the fluid flow is isothermal single phase and slightly compressible with constant fluid viscosity and all properties of homogenized rock matrix e g permeability and porosity are constant 2 2 1 flow equations in homogenized rock matrix 35 v hm k equ μ p hm ρ l g 36 v hm β equ ϕ equ c l p hm t α equ e u hm t q hm q mf v hm δ mf in macro fractures 37 v f k f μ p f ρ l g 38 v f c l p f t 1 d f 0 d f t q f q mf q ff δ ff v f on outer boundary 39 v hm n q q on γ q p hm p on γ p where v hm and v f are the darcy velocities in homogenized matrix and macro fractures respectively k f is the permeability of macro fractures ϕ equ ϕ b 1 ϕ b ϕ p ρ l and c l are the density and compressibility of fluid respectively q hm q f and v hm v f are the source terms and element volumes in homogenized rock matrix and macro fractures respectively d f0 and d f are the initial and present aperture of macro fractures q mf is the exchange flux between homogenized rock matrix and macro fractures q ff is the exchange flux between macro fractures г q and г p are the flux boundary and pressure boundary the detailed expressions of q mf q ff δ mf and δ ff can be found in the reference yan et al 2016 2 2 2 geomechanics equations 40 σ hm ρ hm g 0 41 σ hm c equ e u hm α equ p hm 42 σ hm n t t on γ t u hm u on γ u 43 σ hm n f p f p s n f on γ f where σ hm is total stress tensor ρ hm is bulk density t and u are prescribed traction and displacement on г t and г u respectively as shown in fig 2 n t is the normal vector of boundary г t the fluid pressure in macro fracture p f is exerted on inner fracture boundary гf n f is unit normal vector on boundary гf pointing to ω with n f n f n f n f and n f are two unit outer normal vectors on fracture faces p s is the force exerted on fracture faces created by the compression of fillings in macro fractures and it can be written as 44 p s e s u hm n f d f 0 u hm n f 0 0 u hm n f 0 where e s is the young s modulus of fillings u hm u hm u hm represents the displacement difference between macro fracture interfaces note that above formula of p s is based on the linear elastic assumption of fillings one may choose different formulas of p s that can be more suitable for specific cases please note that each macro fracture is represented by using two parallel smooth plates which is commonly adopted in discreted fracture modeling yan et al 2018a b khoei et al 2016 ren et al 2018 thus the shear stiffness is assumed to be zero and the shear dilation is ignored in this study experimental and theoretical works have established that flow in fractures is very closely governed by the darcy s law witherspoon et al 1980 with permeability k f proportional to the square of fracture aperture d f therefore the dynamic permeability of macro fractures can be written as yan et al 2018a b 45 k f k f 0 d f d f 0 2 the displacement difference between macro fracture interfaces can be calculated by the stabilized xfem in this study therefore fracture aperture d f can be obtained 46 d f d f 0 u n f 3 numerical schemes a new mixed space discretization is developed in this study the mfd method is employed for fluid flow where pressure is located at element and boundary centers on the other hand space discretization for geomechanics is by use of the stabilized xfem in which the displacement vector is located at grid vertices the mixed space discretization can deal with complex heterogeneous properties e g full tensor permeability and yields the benefits such as local mass conservation and numerical stability in space 3 1 discretization 3 1 1 geometry model the edfm and stabilized xfem do not need the grids to be matching with macro fractures and can achieve high accuracy without requiring highly refined grids thus orthogonal grids are used for geometry discretization and macro fractures are discretized according to the intersections of macro fractures and orthogonal grids as illustrated in fig 3 therefore the challenges associated with matching refined grids are bypassed entirely 3 1 2 flow equations with mfd taking the grids ωhm i and ωhm j for example ak is the interface between them n k denotes the area weighted normal vector of interface and x ik is the vector pointing from grid centroid to face centroid p hm i e and p hm k f are the fluid pressures at cell centroid x i and face centroid x k respectively the total flux normal to the interfaces can be written as 47 v hm f t hm i e i p hm i e p hm f where t hm i is the transmissivity matrix of grid ωhm i and its definition can be found in the reference yan et al 2016 v hm f v hm i 1 v hm i 2 v hm in t n is the face number e i 1 1 t then using the divergence theorem on the integral form of eq 36 48 k 1 n v h m k f ω i β equ ϕ equ c l p hm t α equ e u hm t d ω ω i q hm i d ω q mf δ mf by augmenting eqs 47 and 48 with flux continuity across grid interfaces we can obtain the following linear system 49 b hm c hm d hm c hm t 0 0 d hm t 0 0 v hm p hm π hm 0 f hm q hm 0 where v hm p hm and π hm are the arrays of interface velocity grid center pressure and interface center pressure respectively q hm q mfi δ mfi the first row corresponds to darcy s law the second row represents the mass conservation of each grid and the third row expresses the flux continuity of grid interfaces 50 b hm t hm 1 1 t hm n e 1 c hm e 1 e n e d hm i 1 i n e f hm i ω hm i q hm i β equ ϕ equ c l p hm i t α equ e u hm i t d ω where n e is the total number of homogenized rock matrix grids i i e n the implicit difference method is used to discrete macro facture and eq 38 can be scattered as 51 t ξ i 1 2 p f i 1 p f i t ξ i 1 2 p f i p f i 1 v f i c l p f i t v f i d f 0 i d f i t v f i q f i q mf i q ff i δ ff i where 52 t ξ i 1 2 k f μ d f i 0 5 δ ξ i 1 δ ξ i by augmenting eq 49 with eq 51 we can obtain the general formulation for flow equations here we take two macro fractures for example 53 b hm c hm d hm 0 0 c hm t t mf 1 t mf 2 0 t mf 1 t mf 2 d hm t 0 0 0 0 0 t mf 1 0 t f 1 t mf 1 t ff t ff 0 t mf 2 0 t ff t f 2 t mf 2 t ff v hm p hm π hm p f 1 p f 2 0 f hm 0 f f 1 f f 2 where t mf i is the transmissivity matrix between matrix and macro fractures t ff is the transmissivity matrix between two intersecting macro fractures and their definitions can be found in the reference yan et al 2016 f f i v f i q f i v f i c l p f i t v f i d f 0 i d f i t t f i and p f i denote transmissivity matrix and pressure array of macro fractures respectively note that the time derivative terms will be put on the left side in section 3 2 3 1 3 geomechanics equations with stabilized xfem in order to derive the xfem formulation for geomechanics model with macro fractures strong discontinuity the divergence theorem is employed into the integral formulation of eq 40 to obtain its weak form then we substitute eqs 41 and 43 into the weak form after that a stabilizing term is added to the weak form to address the displacement oscillation at macro fracture faces and the stabilized equation takes the form yan et al 2018a b 54 ω δ ɛ c equ ɛ d ω ω δ ɛ α equ p hm d ω γ f δ u hm p f p s n f d γ ω δ u hm ρ hm g d ω γ t δ u hm t d γ γ f τ ε n 2 2 m δ u hm π δ u hm n f n f u hm π u hm d γ whereτ 0 is a stabilization parameter and has a dimensionless value on the order 1 0 ε n and m are the penalty parameter and bulk modulus and equals to es d f0 and bulk modulus of matrix in this study for linear displacement interpolation the projection operatorπmay be evaluated from the volume mean 55 π u hm 1 v ω u hm d ω applying the enriched displacement field together with the test functions of displacement field which is defined in the same enriched approximating space as the approximate displacement fields and satisfying the necessity that the weak form should hold for all kinematically admissible test functions therefore the discretized form of the stabilized integral equation eq 54 can be written as 56 k u u k u a k u b k u c k a u k a a k a b k a c k b u k b a k b b k b c k c u k c a k c b k c c u a b c q hm u q hm a q hm b q hm c p hm q f u q f a q f b q f c p f f u ext f a ext f b ext f c ext where the stiffness matrix k including filling and stabilizing terms coupling matrix q hm and q f and external force vectors f ext are defined as followings 57 k α β ω b u α t c equ b u β d ω γ f n u α t e fill n u β d γ filling term γ f n u α π n u α t e stab n u β π n u β d γ stabilizing term 58 q hm α ω b u α t α equ d ω q f α γ f n u α t n f d γ 59 f α ext ω n u α t ρ hm g d ω γ t n u α t t d γ where e fill e s d f 0 n f n f t e stab τ ε n 2 2 m n f n f t α β u a b c α equ α 11 equ α 22 equ 0 t note that the filling and stabilizing terms will be disappeared when u n f 0 3 2 fully coupled formulation in order to solve the hydro mechanical process accurately there are two strategies named fully coupled hu et al 2013 huang et al 2015 winterfeld and wu 2016 and sequential implicit methods yan et al 2018a b kim et al 2012 kim et al 2011 the fully coupled method provides unconditional stability and high accuracy therefore it is applied to solve the hybrid model in this study specifically we simultaneously solve the geomechanics equations and flow equations by augmenting eq 56 with eq 53 60 ax b d x d t f 61 a k q hm q f 0 k hm t mf 0 t mf k f b 0 0 0 q hm t s hm 0 q f t 0 s f 62 x x u x hm x f t f f u f hm f f t where the expressions of k q hm and q f can be found in eqs 57 and 58 and the expressions of k hm k f and t mf can be found in eq 53 s hm and s f are the compressibility matrices of homogenized matrix and macro fractures respectively and they can be obtained by putting the time derivatives of pressure in f hm and f f i on the left side x u x hm and x f are the dofs in eqs 56 and 53 f u f hm and f f are the external force terms in eq 56 and the source terms in eq 53 using the fully implicit time discretization scheme eq 60 can be written as 63 a d t b x n t 1 b x n t f d t where nt is the number of time step and dt is time step 4 numerical examples to examine the accuracy and application of the proposed method for simulating hydro mechanical coupling in the fractured vuggy porous media containing multi scale fractures and vugs several relevant numerical examples are presented in this section firstly we verify the ecm by comparing the equivalent parameters obtained from different methods and the geometric dependences of equivalent parameters are also analyzed then we introduce a consolidation problem in a fractured porous medium to assess the performance of edfm in simulating hydro mechanical coupling please note the results of standard finite element model sfem in which fractures are modeled as rectangle voids are used as references the refined grids and fully coupled fully implicit scheme are used in the sfem implemented by the comsol multiphysics comsol september 2005 finally the proposed method is applied to simulate elastic production of fractured vuggy reservoirs and several influencing factors of production are analyzed 4 1 equivalent continuum model 4 1 1 model verification to verify the ecm and numerical method for calculating equivalent parameters a periodic medium 1 m 1 m with a circular vug is considered as shown in fig 4 and the matrix is assumed to be isotropic and homogeneous we study the impacts of poisson s ratio of matrix and volumetric fraction of the vug on equivalent biot coefficient α eff with two cases in case 1 the matrix is assumed to be non porous which is the same as the work of lydzba and shao 2000 and the young modulus and biot coefficient α of matrix are 1 gpa and 0 respectively in case 2 the matrix is assumed to be porous and the parameters are given as follows young modulus e 1 gpa porosity ϕ p 0 126 biot coefficient α 0 334 biot coefficient β 0 218 gpa 1 due to the symmetries of the porous medium it yields an isotropic macroscopic model firstly we keep the volumetric fraction of vug as a constant 0 126 while changing the poisson s ratio of matrix to different values then we keep the poisson s ratio as a constant 0 2 while changing the volumetric fraction of vug to different values fig 4 shows the solutions of the problems i e eqs 26 29 the α 11 eff obtained for different situations are plotted in fig 5 and excellent agreements between the results of current work for non porous matrix and the references lydzba and shao 2000 can be seen in addition it also shows that the α 11 eff of porous matrix is increased by comparing with that of non porous matrix which means the hydro mechanical coupling becomes stronger while this enhancement feature becomes less marked with the increase of the poisson s ratio and volumetric fraction of vug to check the validity of current work for calculating equivalent permeability the same porous medium as above example with different vug radius is considered and the matrix permeability is 10 md the isotropic equivalent permeability for different vug radius is presented in table 1 and results of current model are compared with those of huang et al 2011 and wan and eghbalian 2016 as shown in table 1 the equivalent permeability obviously increases with the increase in vug radius and it is in excellent agreement with the reference results in addition a porous medium with a penny shaped fracture is also used to verify current work the semi axes of the fracture are 0 2 m in the x direction and 0 002 m in the y direction and the parameters are the same as case 2 the equivalent biot s coefficients are reported by lewandowska and auriault 2013 and wan and eghbalian 2016 as α 11 eff 0 404 α 22 eff 0 497 and α 11 eff 0 394 α 22 eff 0 490 respectively and the corresponding values of current work are α 11 eff 0 404 and α 22 eff 0 497 it can be seen that the results of current work are the same as those of lewandowska and auriault 2013 while there is a slight error in the results of wan and eghbalian 2016 and this error will increase when the shape of vug becomes circular it is because of the simplify assumptions made by wan to obtain the closed form solutions 4 1 2 geometric dependences of equivalent parameters in this section the evaluations of the geometric dependences of equivalent parameters are carried out with three situations which are shown in fig 6 the size and parameters of the periodic media are the same as above example i e case 2 in section 4 1 1 with poisson s ratio 0 25 in addition the volume fraction of vugs is 7 07 in all examples 1 impacts of vug shape we first study the impacts of vug shapes on equivalent parameters by comparing the results of various aspect ratio a b fig 6a i e the long axis to short axis length ratio the normalized equivalent parameters the equivalent parameters to matrix parameters are shown in fig 7 it can be seen all the equivalent parameters are affected by the vug shape and the poroelastic components i e α 22 and c 2222 in the direction normal to the long axis change more quickly and are almost linear functions of aspect ratio while the permeability component i e k 11 in the direction parallel to the long axis changes more quickly and is a non linear function of the aspect ratio these results suggest that the impacts of the vug shape on equivalent parameters are remarkable 2 impacts of vug position the normalized equivalent parameters of a base cell with a vug a b 6 at various positions the vug rotates around the center with different angle θ fig 6b are shown in fig 8 it can be seen that α 11 c 2222 and k 22 increase with rotation angle while α 22 c 1111 and k 11 decrease with rotation angle and at θ 45 the horizontal and vertical components give the same value the numerical results indicate that the equivalent parameters are also affected by the vug position however this impact on equivalent parameter β is negligible 3 impacts of vug distribution here the vug distribution means that the vug is divided into several parts with the same size and uniform distribution within the base cell as illustrated in fig 6c the initial aspect ratio i e one vug is 6 then we keep the long axis as constant while changing the short axis to different values according to the vug number fig 9 presents the variations of equivalent parameters due to vug distribution changing the numerical results indicate that the impact of the vug distribution on k 11 is remarkable while the vug distribution has less influence on other equivalent parameters 4 2 embedded discrete fracture model 4 2 1 model verification the 2d consolidation problem in a fractured porous medium 10 m 20 m fig 10 is introduced here to assess the performance of the edfm in simulating the hm process the top boundary is permeable on which the fluid pressure is zero and other boundaries are undrained a uniform constant force is applied on the top boundary initially and maintained throughout the simulation the left and right boundaries are fixed in the x direction and the bottom boundary is fixed in the y direction the initial displacements and fluid pressure are zero the filling in fracture is considered and the permeabilities of matrix and fracture are assumed to be constant the model parameters are given in table 2 the pressure observation point a x a 0 2 m and y a 0 2 m is located at the bottom the computational grids used for the sfem and edfm are shown in fig 10 the vicinity of fracture tips is refined in the sfem while a uniform grid with 25 50 meshes is used in the edfm in order to verify that the full tensor permeability can be accurately simulated in the edfm three cases with different matrix permeabilities m2 are used for analysis case 1 2 0 e 15 0 9 e 15 0 9 e 15 1 0 e 15 case 2 2 0 e 15 0 9 e 15 0 9 e 15 1 0 e 15 case 3 2 0 e 15 0 0 1 0 e 15 the comparisons of pressure at point a calculated by using the sfem and edfm for different cases are shown in fig 11 and the excellent agreement between these results can be seen it also shows that the same instantaneous pressure is built up for these cases while the pressure decreases with different speed due to different matrix permeabilities in addition the comparison of residual aperture for case 3 is given in fig 11 the residual apertures for three cases are almost the same it can be seen that the result of edfm is in good agreement with the result of sfem this example indicates that the edfm can accurately simulate the hm process in fractured porous media with full tensor matrix permeability and filled fractures 4 3 hybrid model 4 3 1 model verification fig 12 shows a 2d fractured reservoir 150 m 150 m with 225 micro fractures and one macro fracture the semi axes of the micro fracture are 0 01 m in x direction and 3 m in y direction and the length and aperture of the macro fracture are 70 m and 0 001 m respectively for flow we have no flow at boundaries and a constant pressure 10 mpa is applied at the production well left bottom for geomechanics constant forces are applied on the top and right boundaries and the left and bottom boundaries are fixed in x direction and y direction respectively the initial pressure is 20 mpa other parameters are provided in table 3 and the equivalent parameters used in hybrid model can be calculated by using eqs 23 27 the computational grids for the sfem and hybrid model are shown in fig 12 the sfem and hybrid model are used to model the elastic production in above fractured reservoir case 1 with micro fractures in addition the production simulation of another reservoir with only one macro fracture case 2 without micro fractures is carried out by using the sfem for comparison in these simulations the filling in macro fracture is ignored and the permeabilities of matrix and fracture are assumed to be constant the pressure fields after 1 year and x displacement fields after 5 years are shown in fig 13 we can see that the results of the sfem and hybrid model for case 1 are qualitatively close while there are significant differences between the results of case 1 and case 2 the comparisons of cumulative production and relative displacement between fracture faces for different situations are plotted in fig 14 and the acceptable agreement between results of the hybrid model and sfem for case l can be seen the average errors of cumulative production and relative displacement are 3 23 and 4 15 respectively however the cumulative production and relative displacement for case 2 are different and this is because that the micro fractures can increase the effective permeability and reduce the matrix strength 4 3 2 application and discussion in this section we first test the calculation methods of equivalent permeability presented in lewandowska s and current work for different rev elements then study the impact of micro fracture vug network on the production in fractured vuggy reservoir after that the hybrid model is applied to model the production in some complex fractured vuggy reservoirs and the grid sensitivity and some influence factors of production are studied 1 2d simple fractured vuggy reservoir fig 15 a shows a 2d fractured vuggy reservoir with one macro fracture and the model parameters initial and boundary conditions are the same as those given in previous example except for the rev elements specifically two different rev elements case 1 with isolate micro vugs case 2 with micro fracture vug network and the aperture of micro fracture is 2 mm are considered in this example fig 15 the equivalent parameters of rev elements can be obtained according to eqs 23 27 the equivalent permeabilities of these two rev elements calculated from different methods which are presented in current work huang et al 2011 and lewandowska and auriault 2013 are given in table 4 for case 1 our result is almost the same as that of huang s method but there is a significant difference in the result of lewandowska s method this is because that lewandowska s method is based on the assumption that the pressure is continuous in all micro fractures and vugs i e all micro fractures and vugs are connected thus it overestimates the equivalent permeability of the rev element with disconnected micro fractures and vugs for case 2 the equivalent permeability obviously increases compared with that of case 1 and results of three methods are almost the same this is because that case 2 with micro fracture vug network meets the assumption of lewandowska s method the hybrid model is used to model the elastic production in above fractured vuggy reservoir and the computational grids are shown in fig 12 in these simulations the filling in macro fracture is ignored and the permeabilities of matrix and fracture are assumed to be constant the comparisons of cumulative production and production rate for different situations are plotted in fig 16 it can be seen that the micro fracture vug network can increase the cumulative production and production rate in early period because it enhances the effective compressibility and permeability of matrix we can also see that the cumulative production of case 1 calculated by using lewandowska s method is obviously overestimated and its production rate in early period is almost the same as that of case 2 this is because that lewandowska s method assumes that all micro fractures and vugs are connected during calculating equivalent permeability so the difference between equivalent permeabilities of case 1 and case 2 is negligible 2 2d complex fractured vuggy reservoir 1 fig 17 shows a 2d complex fractured vuggy reservoir which consists of 6 macro fractures and 4 different types of rev elements for flow we have no flow at boundaries the initial pressure is 20 mpa and a constant pressure 10 mpa is applied at production well which is placed on fractures for geomechanics a uniform constant force is applied on the top and right boundaries and the left and bottom boundaries are fixed in x direction and y direction respectively the model parameters are provided in table 5 then the equivalent parameters of each rev element can be obtained from eqs 23 27 and the equivalent permeabilities are given in table 6 to assess the grid sensitivity of hybrid model the elastic production are simulated based on three different grids i e 20 20 40 40 and 50 50 as shown in fig 18 in the following simulations the filling in macro fractures is considered and the dynamic permeability of macro fractures is adopted while the matrix permeability is assumed to be constant the cumulative production and production rate curves are plotted in fig 19 and the excellent agreements between results of 40 40 grids and 50 50 grids can be seen while the results of 20 20 grids are slight different form them this means that 40 40 grids are suitable for this example so they will be applied to the following simulations which are used to analyze some influence factors on elastic production in this fractured vuggy reservoir firstly we investigate the effect of macro fracture properties i e young s modulus of filling e s and initial permeability of macro fractures k f0 on elastic production and four cases case 1 e s 20 mpa k f0 1e 9m2 case 2 e s 40 mpa k f0 1e 9m2 case 3 e s 20 mpa k f0 1e 10 m2 case 4 e s 40 mpa k f0 1e 10 m2 are carried out fig 20 shows the cumulative production and production rate curves of these cases it can be seen that these two properties both have significant influence on production and the influence of e s is more obvious when k f0 is low then we study the effect of micro fractures and vugs i e equivalent parameters on elastic production by comparing results of three cases in case 1 all equivalent parameters are applied to the hybrid model while the equivalent permeability tensor k equ and equivalent elasticity tensor c equ are ignored in case 2 and case 3 respectively the cumulative production and production rate for these cases are shown in fig 21 and the results show that the elastic production is affected by micro fractures and vugs specifically micro fractures and vugs can increase the production rate and cumulative production because they enhance equivalent permeability and reduce matrix strength 3 2d complex fractured vuggy reservoir 2 in this example we apply our approach to simulate the elastic production of a more general 2d fractured vuggy reservoir as shown in fig 22 there are 6 intersecting macro fractures and lots of micro fractures and vugs in this reservoir and its size is 200 m 200 m the model parameters initial and boundary conditions are the same as those given in previous example and the production well is placed on fractures this reservoir is discretized with 20 20 orthogonal grids and the equivalent parameters of each grid is obtained according to eqs 23 27 in fig 23 the distributions of equivalent permeabilities are presented in the x and y directions we can see that the micro fractures and vugs have an important influence on the equivalent permeabilities and they are the main factors for the heterogeneity of formation we study the effect of macro fractures and micro fractures and vugs on elastic production by comparing results of three cases in this example in case 1 macro fractures and micro fractures and vugs are both considered while the macro fractures and micro fractures and vugs are ignored in case 2 and case 3 respectively the cumulative production and production rate curves are plotted in fig 24 it can be seen that macro fractures and micro fractures and vugs both have significant influence on elastic production and their effect can be considered by using the proposed method 1 3d fractured vuggy reservoir fig 25 shows a 3d fractured vuggy reservoir 500 m 250 m 30 m and its rev element this reservoir contains eight intersecting macro fractures and one isolated macro fracture the initial permeability of macro fractures is 1 10 9m2 and the other parameters are the same as those provided in table 5 for flow we have no flow at boundaries the initial pressure is 20 mpa and a constant pressure 10 mpa is applied at the production well which is placed at three different locations as shown in fig 25 for geomechanics a uniform constant force 20 mpa is applied on top right and front boundaries and the other boundaries are fixed in their normal direction respectively the equivalent parameters of rev element can be obtained from eqs 23 27 and the equivalent permeability tensor is 64 k eff 1 662 0 093 0 010 0 093 1 705 0 089 0 010 0 089 1 694 10 16 m 2 in this example the effect of well location on elastic production are studied by comparing results of three cases the production well is placed on intersecting fractures case 1 isolated fracture case 2 and matrix case 3 respectively this reservoir is discretized with 50 25 3 orthogonal grids and the pressure fields after 1 year and z displacement fields after 10 years of three different cases are shown in fig 26 and then the comparisons of cumulative production and production rate for these cases are plotted in fig 27 it can be seen that the well location has significant influence on elastic production and in order to obtain high production the production well should be placed on intersecting fractures we can also find that the formation subsidence has been caused from elastic production and it becomes more obvious as fluid pressure decreases 5 conclusion the main contribution of this study is that we developed an efficient hybrid model which includes the effect of each macro fracture explicitly with non matching grids and represents the effect of micro fractures and vugs implicitly to simulate the hm process in fractured vuggy porous media with multi scale fractures and vugs in the hybrid model micro fractures and vugs are modeled by use of the improved ecm which can accurately represent the effect of micro fractures and vugs on the hm process at macro scale while macro fractures with fillings are modeled explicitly through the edfm then the mixed space discretization i e the mfd for flow and stabilized xfem for geomechanics and fully coupled formulation are applied to solve the hybrid model finally the accuracy and application of the proposed method are demonstrated through several numerical examples and the results indicate that the proposed method can be applied to 3d problems and macro fractures and micro fractures and vugs both have large effects on the elastic production of fractured vuggy porous media the proposed method does not need grids to match with fractures and vugs and can achieve high accuracy without requiring highly refined grids which are necessary for the sfem therefore computational costs can be reduced greatly there is no limit to the number of fractures in the proposed model however there are still several limits at present 1 the improved ecm is developed for single phase flow and it will be extended to multiphase flow in our future study 2 we assume that the rev elements undergo small deformation and the geometry structures of micro fractures and vugs keep constant during the upscaling process thus the equivalent permeability tensor is static if we want to get the dynamic equivalent permeability tensor by using the proposed method some ancillary physical or numerical experiments should be carried out to obtain the geometry structures of rev elements under different effective stress conditions acknowledgments this work was supported by the national natural science foundation of china grant nos 51490654 51804325 61573018 the shandong provincial natural science foundation china grant no zr2015el014 and the innovative project of china university of petroleum grant no ycxj2016015 we would like to thank the china scholarship council for supporting our work appendix a homogenization upscaling in this appendix the homogenization procedure of the improved ecm is derived we now substitute eq 18 into eqs 11 17 apply eq 19 and collect terms with like powers of ε the ε 1 term of eq 14 yields a 1 y p b 0 0 thus p b 0 p b 0 x t eq 12 at the ε 2 order and eq 16 at the ε 0 order give a 2 y k m μ y p m 0 0 in ω m p m 0 p b 0 on γ it can be deduced that a 3 p m 0 p b 0 p 0 x t eq 11 at the ε 2 order and eq 16 at the ε 1 order give a 4 y c e y u s 0 0 i n ω m c e y u s 0 n 0 on γ thus a 5 u s 0 u s 0 x t eq 11 at the ε 1 order and eq 16 at the ε 0 order give a 6 y c e x u s 0 e y u s 1 0 in ω m a 7 c e x u s 0 e y u s 1 n 1 α p 0 i n on γ therefore u s 1 can be written in the form a 8 u s 1 ξ y e x u s 0 η y 1 α p 0 u s 1 x t where u s 1 x t is an y independent arbitrary displacement the ω periodic vectors ξ pq and η of zero volume average over ωm are the solutions of eqs 28 31 respectively the pressure p b 1 is obtained from eq 14 at the order ε 0 a 9 x p 0 y p b 1 0 thus p b 1 π y x p 0 p b 1 x t where p b 1 x t is a y independent arbitrary function the pressure p m 1 is the solution of eq 12 at the order ε 1 with eq 16 at the ε order a 10 y k m μ x p 0 y p m 1 0 in ω m a 11 p m 1 p b 1 π y x p 0 p b 1 x t on γ that gives a 12 p m 1 τ y x p 0 p m 1 x t where p m 1 x t is a y independent arbitrary function and a 13 p b 1 x t p m 1 x t p 1 x t the ω periodic component τj of zero volume average over ωm and πj are the solutions of eqs 32 34 consider eqs 11 and 14 at the ε 0 order a 14 x c e x u s 0 e y u s 1 α p 0 i y c e x u s 1 e y u s 2 α p m 1 i 0 in ω m a 15 x p 0 y p b 1 0 in ω b let us integrate eq a 14 on ωm and eq a 15 on ωb respectively and apply the divergence theorem then we obtain a 16 x c e x u s 0 e y u s 1 α p 0 i m 1 ω γ c e x u s 1 e y u s 2 α p m 1 i n d γ a 17 x p 0 b 1 ω γ p b 1 n d γ where ω denotes the volume of ω and the symbol a n stands for the volume average of a a 18 a n 1 ω ω n a d ω eq 16 at the ε order gives a 19 c e x u s 1 e y u s 2 α p m 1 i n p b 1 i n on γ we now substitute eq a 19 to eq a 16 and apply eq a 17 then obtain the macroscopic momentum balance in the form a 20 x σ 0 0 σ 0 c equ e x u s 0 α equ p 0 where the equivalent tensors c equ and α equ are defined as a 21 c i j k l equ c i j k l c i j m n e y m n ξ k l m a 22 α i j equ ϕ b 1 ϕ b α i i j 1 α c i j k l e y k l η m where ϕ b ωb ω is the volumetric fraction of micro fractures and vugs eq 13 at the order ε 0 gives a 23 v p 0 ϕ p u s 0 t k m μ x p m 0 y p m 1 for a parallelepipedic period with surfaces perpendicular to the axes the surface average fluid flow v p 0 s through any of the period surface s i normal to yi can be written as a 24 v p i 0 s 1 ω ω y i v p k 0 n k d s we apply the surface average to eq a 23 and use eq a 12 then obtain the macroscopic flow law a 25 v 0 v p 0 s ϕ p u s 0 t k equ μ x p 0 where v 0 is the first order darcy velocity and the equivalent permeability k equ is defined as a 26 k equ k m 1 ω ω y i i y τ n ds eqs 12 and 15 at the order ε 0 give a 27 β p 0 t α e x i i u s 0 e y i i u s 1 t x v p 0 ϕ p u s 0 t y v p 1 ϕ p u s 1 t 0 in ω m a 28 x v b 0 y v b 1 0 in ω b let us average above two equations on their respective domain and add member to member the resulting relations we obtain a 29 x a b β 1 ϕ b p 0 t α y u s 1 t m 1 ϕ b ϕ p α e x i i u s 0 t where a 30 a v p 0 m v b 0 b b y v b 1 b y v p 1 ϕ p u s 1 t m eqs 12 and 15 at the order ε 1 write a 31 y v p 0 0 y v b 0 0 therefore a 32 ω a ω m y yv p 0 d ω ω b y yv b 0 d ω ω y v p 0 n ds γ y v p 0 v b 0 n ds we apply eq a 24 and use eq 17 at the order ε 0 to the right side of eq a 32 then obtain a 33 ω a ω v p 0 s γ y ϕ p 1 u s 0 t n d s ω v p 0 s 1 ϕ p ω b y y u s 0 t d ω a 34 a v p 0 s 1 ϕ p ϕ b u s 0 t on another hand by using the periodic boundary a 35 ω b γ v p 1 ϕ p u s 1 t v b 1 n ds after using eq 17 at the ε order and eq a 8 we obtain a 36 ω b γ u s 1 t n ds ω m e y i i u s 1 t d ω a 37 b e y i i ξ m e x u s 0 t e y i i η m 1 α p 0 t introducing eqs a 34 and a 37 into eq a 29 and using eq a 25 yield the first order macroscopic mass balance in the form a 38 β equ p 0 t γ equ e x u s 0 t x k equ μ x p 0 0 where a 39 β equ β 1 ϕ b 1 α 2 e y i i η m γ equ ϕ b α 1 ϕ b i 1 α e y i i ξ m finally we return the quantities to dimensional form and substitute subscript hm for superscript 0 then the equivalent macroscopic model can be written as eqs 20 22 
690,in this study an efficient numerical model is proposed to simulate the hydro mechanical coupling in the fractured vuggy porous media containing multi scale fractures and vugs specifically an improved equivalent continuum model ecm which is obtained through the asymptotic homogenization method is applied to model micro fractures and vugs while macro fractures are modeled explicitly by using the embedded discrete fracture model edfm and non matching grids as an important feature of the explicit representment the effects of fillings and fluid pressure on preventing macro fractures from closing can be considered after that the new mixed space discretization i e mimetic finite difference mfd method for flow and stabilized extended finite element method xfem for geomechanics and fully coupled methods are applied to solve the proposed model the mixed space discretization can deal with complex heterogeneous properties e g full tensor permeability and yields the benefits of local mass conservation and numerical stability in space finally we demonstrate the accuracy and application of the proposed model to capture the coupled hydro mechanical impacts of multiscale fractures and vugs on fluid flow in fractured porous media keywords fractured vuggy porous media hydro mechanical coupling equivalent continuum model homogenization method embedded discrete fracture model 1 introduction in the past few years the numerical simulation of fluid flow in fractured vuggy porous media has received much attention because many fractured vuggy reservoirs have been found worldwide that can significantly contribute to hydrocarbon reserves and production roehl and choquette 2012 hidajat et al 2004 rivas gomez et al 2001 generally naturally fractured vuggy porous media consist of porous matrix fractures and vugs zhang et al 2017 yan et al 2016 zhang et al 2018 2016 and these fractures and vugs significantly increase the effective permeability and affect the flow paths thus they must be accurately represented however numerical simulation of fluid flow in these fractured vuggy porous media is challenging especially when the geomechanics effect cannot be ignored during the production of reservoirs zhang et al 2017 significant efforts have been made to develop appropriate models to model fluid flow in fractured vuggy porous media in recent decades and three categories are commonly used 1 the ecm arbogast and lehr 2006 huang et al 2011 huang et al 2013 2 multiple continuum model wu et al 2006 camacho velazquez et al 2002 wu et al 2011 3 discrete fracture vug network model zhang et al 2018 2016 yao et al 2010 zhu et al 2016 16 in ecm matrix fractures and vugs are represented as a single continuum and the advantages of ecm are its simple data requirement and low computational costs but it usually underestimates the effect of macro fractures and neglects the interaction between matrix fractures and vugs the multiple continuum model in which matrix fractures and vugs are treated as two or more superimposed and interacting continua seem more reasonable for the porous media with dense fractures and vugs however this model still underestimates the effect of macro fractures and it is inappropriate for disconnected fractures and vugs the discrete fracture vug network model incorporates the effects of fractures and vugs explicitly and provides more realistic representation of fractured vuggy porous media but it is inappropriate for the porous media with lots of fractures and vugs due to its high computational costs it has been demonstrated that the geomechanical effect plays an important role in the production of fractured vuggy reservoir zhang et al 2017 thus it is necessary to couple flow and geomechanics to capture the effect of geomechanics on the production although the mentioned models have been applied in some practical cases few of them include the geomechanical effect lewandowska et al developed a macroscopic ecm for hydro mechanical coupling in the porous media containing single isolated fracture vug lewandowska and auriault 2013 in their study biot model biot 1941 1955 is applied for porous media domain while stokes equations batchelor 2000 is assumed for fracture vug domain then they applied the asymptotic homogenization method hornung 1997 auriault et al 2009 to develop the ecm which possesses the same mathematical structure as classic biot model in addition the definitions and auxiliary equations of equivalent parameters were also provided however the definition and auxiliary equations of equivalent permeability are limited and inappropriate for multiple isolated fractures and vugs on the other hand wan et al used the average field theory to formulate an analogous continuum description of hydro mechanical coupling for fractured porous media wan and eghbalian 2016 but their model arises some errors in the porous media with circular vugs recently zhang et al developed a numerical method for modeling hydro mechanical coupling in fractured vuggy reservoirs zhang et al 2017 in their method vugs are modeled as virtual volumes in which the pressure drop is negligible and fractures are modeled by use of refined grids although the geomechanical effect is considered in their study it is only appropriate for the reservoirs with finite number of fractures and vugs due to its high computational costs associated with refined grids generally naturally fractured vuggy porous media include multi scale fractures and vugs yan et al 2016 zhang et al 2016 wu et al 2006 for them none of the mentioned models can accurately and efficiently simulate the hydro mechanical coupling process in this context the hybrid models yan et al 2016 zhang et al 2018 24 khoei et al 2016 in which macro fractures are explicitly modeled and effects of micro fractures vugs are implicitly represented appear to be promising however the existing hybrid models either ignore the geomechanical effect yan et al 2016 zhang et al 2018 or do not consider vugs yan et al 2018a khoei et al 2016 and they cannot be straightly applied to simulate hydro mechanical coupling in the fractured vuggy porous media include multi scale fractures and vugs in this study an improved ecm is developed based on the asymptotic homogenization method in which new auxiliary equations of equivalent permeability are proposed and the improved ecm is appropriate for multiple isolated fractures and vugs then an efficient hybrid model is proposed to simulate the hydro mechanical coupling in the fractured vuggy porous media containing multi scale fractures and vugs specifically the improved ecm is applied to model micro fractures and vugs while macro fractures are modeled explicitly by use of the non matching grids and edfm moinfar et al 2012 yan et al 2016 after that the new mixed space discretization i e the mfd method yan et al 2016 brezzi et al 2005 huang et al 2014 lipnikov et al 2014 for flow and stabilized xfem yan et al 2018a 2018b for geomechanics and fully coupled formulation are applied to solve the hybrid model and the time discretization is fully implicit the proposed method includes the effect of macro fractures explicitly without requiring grids to conform to fracture geometry and avoids explicit representation of micro fractures and vugs this paper is organized as follows the hybrid model combining the improved ecm and edfm are presented in section 2 in section 3 the mixed formulation combining the mfd and stabilized xfem is utilized for space discretization and a fully coupled method is applied to solve the hybrid model finally several numerical examples of hydro mechanical coupling are presented in section 4 to demonstrate the accuracy and applicability of the proposed method 2 model description in this study we focus on the fractured vuggy porous media including multi scale fractures and vugs and we assume there are macro fractures and rock matrix which consists of porous matrix micro fractures and vugs at macro scale as shown in fig 1 the improved ecm based on homogenization upscaling is used for rock matrix and its equivalent parameters are obtained by solving some auxiliary equations on the representative elementary volume rev of rock matrix then the macro fractures are modeled explicitly by use of the edfm 2 1 equivalent continuum model in this section we develop an improved ecm for the rev element of rock matrix based on the asymptotic homogenization method and provide auxiliary equations to calculate all equivalent parameters during the homogenization process fluid is assumed to be viscous newtonian and incompressible fillings in micro fractures and vugs are ignored and these micro fractures and vugs are considered open all the time during the small deformation 2 1 1 local rev model the biot model is used for the deformable porous matrix 1 σ m 0 σ m σ s α p m i σ s ce u s 2 β p m t α e i i u s t v p ϕ p u s t 0 3 v p ϕ p u s t k m μ p m where σ m and σ s are total stress tensor and effective stress tensor respectively p m is pore pressure α is biot coefficient i is identity tensor c is fourth rank elastic tensor u s is the displacement of solid β is compression coefficient t is time v p is the average fluid velocity in micro pore ϕ p ωp ωm is micro porosity k m is the permeability of porous matrix µ is fluid viscosity the strain tensor e u s is defined by 4 e u s 1 2 u s u s t the incompressible newtonian fluid flow in micro fractures and vugs can be described by using stokes equations however the coupling of darcy stokes model is too complicated since additional interface conditions have to be introduced to couple the porous flow and free flow regions nield 2009 arbogast and gomez 2009 as an alternate approach the darcy brinkman model is often used for this coupling flow problem ng and wang 2010 yan et al 2016 which provides a unified equation with continuous variable coefficients in two different flow regions therefore it is not necessary to introduce specific interface conditions any more the brinkman equations used to describe the low velocity free flow in micro fractures and vugs are 5 σ b μ k b v b 0 σ b 2 μ eff e v b p b i 6 v b 0 where σ b v b k b and p b are stress tensor fluid velocity permeability and fluid pressure in micro fractures and vugs respectively µ eff µ ϕ b is the effective viscosity and µ eff µ is used in this study on the inner boundary г we have the continuity of the total stress and pressure 7 σ m n σ b n p m p b where n is the unit normal to г exterior to ωm besides the average velocities in ωm and ωb are equal lewandowska and auriault 2013 auriault and boutin 1992 8 v p ϕ p u s t u s t v b it is noted that the governing equations in micro fractures and vugs are all the same and there is no essential difference between micro fractures and vugs except for their geometrical shapes we consider a macroscopic medium of characteristic size l made of a large number of periodic rev elements ω of characteristic size l and ε l l l p l 1 where l p is the micro pore characteristic size the same assumption which was made in lewandowska s work lewandowska and auriault 2013 is applied here σ s p m and p b are of similar order of magnitude v p u s t and v b are also considered of similar order of magnitude recall that permeability k m is of the order o l p 2 and permeability k b is of the order o l 2 from eq 3 we have 9 v p o l p 2 p m μ l then the ratios of pressure and diffusion terms to viscous term in eq 5 can be evaluated at the macroscopic level as 10 p b 2 μ eff e v b l o p b l 2 μ μ l l p 2 p m o ε 4 μ k b v b 2 μ eff e v b l o μ l 2 2 μ l 2 o ε 2 finally we keep the similar notations for dimensionless physical quantities then obtain the dimensionless local rev model in the following form in porous matrix ωm 11 σ m 0 σ m σ s α p m i σ s ce u s 12 β p m t α e i i u s t v p ϕ p u s t 0 13 v p ϕ p u s t k m μ p m in micro fractures and vugs ωb 14 σ b μ k b ε 2 v b 0 σ b 2 ε 4 μ e v b p b i 15 v b 0 on inner boundary г 16 σ m n σ b n p m p b 17 v p 1 ϕ p u s t v b 2 1 3 equivalent macroscopic model by following the classical asymptotic expansions we look for u s p m v p v b and p b in the form 18 φ φ 0 x y t ε φ 1 x y t ε 2 φ 2 x y t where y x ε y is the local coordinates at the rev scale l while x shows the macroscopic variations at scale l φ i s are ω periodic with respect to y in addition by the chain rule we can get 19 x ε 1 y 2 x 2 2 ε 1 y x ε 2 y 2 then we substitute eqs 18 and 19 into eqs 11 17 and equal the terms appearing at successive orders of ε after the analysis of each problem more details can be found in appendix a we can obtain the equivalent macroscopic model in the following form 20 σ hm 0 σ hm c equ e u hm α equ p hm 21 β equ p hm t γ equ e u hm t v hm 0 22 v hm k equ μ p hm where the subscript hm means the homogenized rock matrix it can be seen that the emc model i e eqs 20 22 presents the same form as classical biot model however the equivalent parameters c equ α equ β equ γ equ and k equ are modified due to the presence of micro fractures and vugs and they are defined as 23 c i j k l equ c i j k l c i j m n e y m n ξ k l m 24 α i j equ ϕ b 1 ϕ b α i i j 1 α c i j k l e y k l η m 25 β equ β 1 ϕ b 1 α 2 e y i i η m 26 γ i j equ ϕ b α 1 ϕ b i i j 1 α e y l l ξ i j m 27 k i j equ k m 1 ω ω y i i j l τ j y l n l d s where ϕ b ωb ω is the volumetric fraction of micro fractures and vugs in the rev element the symbol stands for the volume average the proof of α i j equ γ i j equ can be found in the reference lewandowska and auriault 2013 the ω periodic vector ξ pq of zero volume average over ωm is the solution of 28 y c i j k l e y k l ξ p q 0 in ω m 29 c i j k l e y k l ξ p q n c i j k l e k l n on γ where the tensor e k l δ k p δ l q δkp and δlq are kronecker symbols the ω periodic vector η of zero volume average over ωm is the solution of 30 y c i j k l e y k l η 0 in ω m 31 c i j k l e y k l η n i n on γ and the ω periodic component τj of zero volume average over ωm is the solution of 32 y k m μ δ i j τ j y i 0 in ω m 33 y π j e j in ω b 34 τ j π j on γ where πj is an unknown quantity in ωb e j is the standard cartesian basis vector in jth direction please note that above auxiliary equations of τj are in complete form and different from those of lewandowska and auriault 2013 which are based on the assumption that the pressure is continuous in all micro fractures and vugs i e single isolated fracture vug or all fractures and vugs are connected thus they cannot be used for the disconnected micro fractures and vugs 2 2 embedded discrete fracture model the ecm of rock matrix has been developed in previous section then edfm is used to model macro fractures explicitly we assume the fluid flow is isothermal single phase and slightly compressible with constant fluid viscosity and all properties of homogenized rock matrix e g permeability and porosity are constant 2 2 1 flow equations in homogenized rock matrix 35 v hm k equ μ p hm ρ l g 36 v hm β equ ϕ equ c l p hm t α equ e u hm t q hm q mf v hm δ mf in macro fractures 37 v f k f μ p f ρ l g 38 v f c l p f t 1 d f 0 d f t q f q mf q ff δ ff v f on outer boundary 39 v hm n q q on γ q p hm p on γ p where v hm and v f are the darcy velocities in homogenized matrix and macro fractures respectively k f is the permeability of macro fractures ϕ equ ϕ b 1 ϕ b ϕ p ρ l and c l are the density and compressibility of fluid respectively q hm q f and v hm v f are the source terms and element volumes in homogenized rock matrix and macro fractures respectively d f0 and d f are the initial and present aperture of macro fractures q mf is the exchange flux between homogenized rock matrix and macro fractures q ff is the exchange flux between macro fractures г q and г p are the flux boundary and pressure boundary the detailed expressions of q mf q ff δ mf and δ ff can be found in the reference yan et al 2016 2 2 2 geomechanics equations 40 σ hm ρ hm g 0 41 σ hm c equ e u hm α equ p hm 42 σ hm n t t on γ t u hm u on γ u 43 σ hm n f p f p s n f on γ f where σ hm is total stress tensor ρ hm is bulk density t and u are prescribed traction and displacement on г t and г u respectively as shown in fig 2 n t is the normal vector of boundary г t the fluid pressure in macro fracture p f is exerted on inner fracture boundary гf n f is unit normal vector on boundary гf pointing to ω with n f n f n f n f and n f are two unit outer normal vectors on fracture faces p s is the force exerted on fracture faces created by the compression of fillings in macro fractures and it can be written as 44 p s e s u hm n f d f 0 u hm n f 0 0 u hm n f 0 where e s is the young s modulus of fillings u hm u hm u hm represents the displacement difference between macro fracture interfaces note that above formula of p s is based on the linear elastic assumption of fillings one may choose different formulas of p s that can be more suitable for specific cases please note that each macro fracture is represented by using two parallel smooth plates which is commonly adopted in discreted fracture modeling yan et al 2018a b khoei et al 2016 ren et al 2018 thus the shear stiffness is assumed to be zero and the shear dilation is ignored in this study experimental and theoretical works have established that flow in fractures is very closely governed by the darcy s law witherspoon et al 1980 with permeability k f proportional to the square of fracture aperture d f therefore the dynamic permeability of macro fractures can be written as yan et al 2018a b 45 k f k f 0 d f d f 0 2 the displacement difference between macro fracture interfaces can be calculated by the stabilized xfem in this study therefore fracture aperture d f can be obtained 46 d f d f 0 u n f 3 numerical schemes a new mixed space discretization is developed in this study the mfd method is employed for fluid flow where pressure is located at element and boundary centers on the other hand space discretization for geomechanics is by use of the stabilized xfem in which the displacement vector is located at grid vertices the mixed space discretization can deal with complex heterogeneous properties e g full tensor permeability and yields the benefits such as local mass conservation and numerical stability in space 3 1 discretization 3 1 1 geometry model the edfm and stabilized xfem do not need the grids to be matching with macro fractures and can achieve high accuracy without requiring highly refined grids thus orthogonal grids are used for geometry discretization and macro fractures are discretized according to the intersections of macro fractures and orthogonal grids as illustrated in fig 3 therefore the challenges associated with matching refined grids are bypassed entirely 3 1 2 flow equations with mfd taking the grids ωhm i and ωhm j for example ak is the interface between them n k denotes the area weighted normal vector of interface and x ik is the vector pointing from grid centroid to face centroid p hm i e and p hm k f are the fluid pressures at cell centroid x i and face centroid x k respectively the total flux normal to the interfaces can be written as 47 v hm f t hm i e i p hm i e p hm f where t hm i is the transmissivity matrix of grid ωhm i and its definition can be found in the reference yan et al 2016 v hm f v hm i 1 v hm i 2 v hm in t n is the face number e i 1 1 t then using the divergence theorem on the integral form of eq 36 48 k 1 n v h m k f ω i β equ ϕ equ c l p hm t α equ e u hm t d ω ω i q hm i d ω q mf δ mf by augmenting eqs 47 and 48 with flux continuity across grid interfaces we can obtain the following linear system 49 b hm c hm d hm c hm t 0 0 d hm t 0 0 v hm p hm π hm 0 f hm q hm 0 where v hm p hm and π hm are the arrays of interface velocity grid center pressure and interface center pressure respectively q hm q mfi δ mfi the first row corresponds to darcy s law the second row represents the mass conservation of each grid and the third row expresses the flux continuity of grid interfaces 50 b hm t hm 1 1 t hm n e 1 c hm e 1 e n e d hm i 1 i n e f hm i ω hm i q hm i β equ ϕ equ c l p hm i t α equ e u hm i t d ω where n e is the total number of homogenized rock matrix grids i i e n the implicit difference method is used to discrete macro facture and eq 38 can be scattered as 51 t ξ i 1 2 p f i 1 p f i t ξ i 1 2 p f i p f i 1 v f i c l p f i t v f i d f 0 i d f i t v f i q f i q mf i q ff i δ ff i where 52 t ξ i 1 2 k f μ d f i 0 5 δ ξ i 1 δ ξ i by augmenting eq 49 with eq 51 we can obtain the general formulation for flow equations here we take two macro fractures for example 53 b hm c hm d hm 0 0 c hm t t mf 1 t mf 2 0 t mf 1 t mf 2 d hm t 0 0 0 0 0 t mf 1 0 t f 1 t mf 1 t ff t ff 0 t mf 2 0 t ff t f 2 t mf 2 t ff v hm p hm π hm p f 1 p f 2 0 f hm 0 f f 1 f f 2 where t mf i is the transmissivity matrix between matrix and macro fractures t ff is the transmissivity matrix between two intersecting macro fractures and their definitions can be found in the reference yan et al 2016 f f i v f i q f i v f i c l p f i t v f i d f 0 i d f i t t f i and p f i denote transmissivity matrix and pressure array of macro fractures respectively note that the time derivative terms will be put on the left side in section 3 2 3 1 3 geomechanics equations with stabilized xfem in order to derive the xfem formulation for geomechanics model with macro fractures strong discontinuity the divergence theorem is employed into the integral formulation of eq 40 to obtain its weak form then we substitute eqs 41 and 43 into the weak form after that a stabilizing term is added to the weak form to address the displacement oscillation at macro fracture faces and the stabilized equation takes the form yan et al 2018a b 54 ω δ ɛ c equ ɛ d ω ω δ ɛ α equ p hm d ω γ f δ u hm p f p s n f d γ ω δ u hm ρ hm g d ω γ t δ u hm t d γ γ f τ ε n 2 2 m δ u hm π δ u hm n f n f u hm π u hm d γ whereτ 0 is a stabilization parameter and has a dimensionless value on the order 1 0 ε n and m are the penalty parameter and bulk modulus and equals to es d f0 and bulk modulus of matrix in this study for linear displacement interpolation the projection operatorπmay be evaluated from the volume mean 55 π u hm 1 v ω u hm d ω applying the enriched displacement field together with the test functions of displacement field which is defined in the same enriched approximating space as the approximate displacement fields and satisfying the necessity that the weak form should hold for all kinematically admissible test functions therefore the discretized form of the stabilized integral equation eq 54 can be written as 56 k u u k u a k u b k u c k a u k a a k a b k a c k b u k b a k b b k b c k c u k c a k c b k c c u a b c q hm u q hm a q hm b q hm c p hm q f u q f a q f b q f c p f f u ext f a ext f b ext f c ext where the stiffness matrix k including filling and stabilizing terms coupling matrix q hm and q f and external force vectors f ext are defined as followings 57 k α β ω b u α t c equ b u β d ω γ f n u α t e fill n u β d γ filling term γ f n u α π n u α t e stab n u β π n u β d γ stabilizing term 58 q hm α ω b u α t α equ d ω q f α γ f n u α t n f d γ 59 f α ext ω n u α t ρ hm g d ω γ t n u α t t d γ where e fill e s d f 0 n f n f t e stab τ ε n 2 2 m n f n f t α β u a b c α equ α 11 equ α 22 equ 0 t note that the filling and stabilizing terms will be disappeared when u n f 0 3 2 fully coupled formulation in order to solve the hydro mechanical process accurately there are two strategies named fully coupled hu et al 2013 huang et al 2015 winterfeld and wu 2016 and sequential implicit methods yan et al 2018a b kim et al 2012 kim et al 2011 the fully coupled method provides unconditional stability and high accuracy therefore it is applied to solve the hybrid model in this study specifically we simultaneously solve the geomechanics equations and flow equations by augmenting eq 56 with eq 53 60 ax b d x d t f 61 a k q hm q f 0 k hm t mf 0 t mf k f b 0 0 0 q hm t s hm 0 q f t 0 s f 62 x x u x hm x f t f f u f hm f f t where the expressions of k q hm and q f can be found in eqs 57 and 58 and the expressions of k hm k f and t mf can be found in eq 53 s hm and s f are the compressibility matrices of homogenized matrix and macro fractures respectively and they can be obtained by putting the time derivatives of pressure in f hm and f f i on the left side x u x hm and x f are the dofs in eqs 56 and 53 f u f hm and f f are the external force terms in eq 56 and the source terms in eq 53 using the fully implicit time discretization scheme eq 60 can be written as 63 a d t b x n t 1 b x n t f d t where nt is the number of time step and dt is time step 4 numerical examples to examine the accuracy and application of the proposed method for simulating hydro mechanical coupling in the fractured vuggy porous media containing multi scale fractures and vugs several relevant numerical examples are presented in this section firstly we verify the ecm by comparing the equivalent parameters obtained from different methods and the geometric dependences of equivalent parameters are also analyzed then we introduce a consolidation problem in a fractured porous medium to assess the performance of edfm in simulating hydro mechanical coupling please note the results of standard finite element model sfem in which fractures are modeled as rectangle voids are used as references the refined grids and fully coupled fully implicit scheme are used in the sfem implemented by the comsol multiphysics comsol september 2005 finally the proposed method is applied to simulate elastic production of fractured vuggy reservoirs and several influencing factors of production are analyzed 4 1 equivalent continuum model 4 1 1 model verification to verify the ecm and numerical method for calculating equivalent parameters a periodic medium 1 m 1 m with a circular vug is considered as shown in fig 4 and the matrix is assumed to be isotropic and homogeneous we study the impacts of poisson s ratio of matrix and volumetric fraction of the vug on equivalent biot coefficient α eff with two cases in case 1 the matrix is assumed to be non porous which is the same as the work of lydzba and shao 2000 and the young modulus and biot coefficient α of matrix are 1 gpa and 0 respectively in case 2 the matrix is assumed to be porous and the parameters are given as follows young modulus e 1 gpa porosity ϕ p 0 126 biot coefficient α 0 334 biot coefficient β 0 218 gpa 1 due to the symmetries of the porous medium it yields an isotropic macroscopic model firstly we keep the volumetric fraction of vug as a constant 0 126 while changing the poisson s ratio of matrix to different values then we keep the poisson s ratio as a constant 0 2 while changing the volumetric fraction of vug to different values fig 4 shows the solutions of the problems i e eqs 26 29 the α 11 eff obtained for different situations are plotted in fig 5 and excellent agreements between the results of current work for non porous matrix and the references lydzba and shao 2000 can be seen in addition it also shows that the α 11 eff of porous matrix is increased by comparing with that of non porous matrix which means the hydro mechanical coupling becomes stronger while this enhancement feature becomes less marked with the increase of the poisson s ratio and volumetric fraction of vug to check the validity of current work for calculating equivalent permeability the same porous medium as above example with different vug radius is considered and the matrix permeability is 10 md the isotropic equivalent permeability for different vug radius is presented in table 1 and results of current model are compared with those of huang et al 2011 and wan and eghbalian 2016 as shown in table 1 the equivalent permeability obviously increases with the increase in vug radius and it is in excellent agreement with the reference results in addition a porous medium with a penny shaped fracture is also used to verify current work the semi axes of the fracture are 0 2 m in the x direction and 0 002 m in the y direction and the parameters are the same as case 2 the equivalent biot s coefficients are reported by lewandowska and auriault 2013 and wan and eghbalian 2016 as α 11 eff 0 404 α 22 eff 0 497 and α 11 eff 0 394 α 22 eff 0 490 respectively and the corresponding values of current work are α 11 eff 0 404 and α 22 eff 0 497 it can be seen that the results of current work are the same as those of lewandowska and auriault 2013 while there is a slight error in the results of wan and eghbalian 2016 and this error will increase when the shape of vug becomes circular it is because of the simplify assumptions made by wan to obtain the closed form solutions 4 1 2 geometric dependences of equivalent parameters in this section the evaluations of the geometric dependences of equivalent parameters are carried out with three situations which are shown in fig 6 the size and parameters of the periodic media are the same as above example i e case 2 in section 4 1 1 with poisson s ratio 0 25 in addition the volume fraction of vugs is 7 07 in all examples 1 impacts of vug shape we first study the impacts of vug shapes on equivalent parameters by comparing the results of various aspect ratio a b fig 6a i e the long axis to short axis length ratio the normalized equivalent parameters the equivalent parameters to matrix parameters are shown in fig 7 it can be seen all the equivalent parameters are affected by the vug shape and the poroelastic components i e α 22 and c 2222 in the direction normal to the long axis change more quickly and are almost linear functions of aspect ratio while the permeability component i e k 11 in the direction parallel to the long axis changes more quickly and is a non linear function of the aspect ratio these results suggest that the impacts of the vug shape on equivalent parameters are remarkable 2 impacts of vug position the normalized equivalent parameters of a base cell with a vug a b 6 at various positions the vug rotates around the center with different angle θ fig 6b are shown in fig 8 it can be seen that α 11 c 2222 and k 22 increase with rotation angle while α 22 c 1111 and k 11 decrease with rotation angle and at θ 45 the horizontal and vertical components give the same value the numerical results indicate that the equivalent parameters are also affected by the vug position however this impact on equivalent parameter β is negligible 3 impacts of vug distribution here the vug distribution means that the vug is divided into several parts with the same size and uniform distribution within the base cell as illustrated in fig 6c the initial aspect ratio i e one vug is 6 then we keep the long axis as constant while changing the short axis to different values according to the vug number fig 9 presents the variations of equivalent parameters due to vug distribution changing the numerical results indicate that the impact of the vug distribution on k 11 is remarkable while the vug distribution has less influence on other equivalent parameters 4 2 embedded discrete fracture model 4 2 1 model verification the 2d consolidation problem in a fractured porous medium 10 m 20 m fig 10 is introduced here to assess the performance of the edfm in simulating the hm process the top boundary is permeable on which the fluid pressure is zero and other boundaries are undrained a uniform constant force is applied on the top boundary initially and maintained throughout the simulation the left and right boundaries are fixed in the x direction and the bottom boundary is fixed in the y direction the initial displacements and fluid pressure are zero the filling in fracture is considered and the permeabilities of matrix and fracture are assumed to be constant the model parameters are given in table 2 the pressure observation point a x a 0 2 m and y a 0 2 m is located at the bottom the computational grids used for the sfem and edfm are shown in fig 10 the vicinity of fracture tips is refined in the sfem while a uniform grid with 25 50 meshes is used in the edfm in order to verify that the full tensor permeability can be accurately simulated in the edfm three cases with different matrix permeabilities m2 are used for analysis case 1 2 0 e 15 0 9 e 15 0 9 e 15 1 0 e 15 case 2 2 0 e 15 0 9 e 15 0 9 e 15 1 0 e 15 case 3 2 0 e 15 0 0 1 0 e 15 the comparisons of pressure at point a calculated by using the sfem and edfm for different cases are shown in fig 11 and the excellent agreement between these results can be seen it also shows that the same instantaneous pressure is built up for these cases while the pressure decreases with different speed due to different matrix permeabilities in addition the comparison of residual aperture for case 3 is given in fig 11 the residual apertures for three cases are almost the same it can be seen that the result of edfm is in good agreement with the result of sfem this example indicates that the edfm can accurately simulate the hm process in fractured porous media with full tensor matrix permeability and filled fractures 4 3 hybrid model 4 3 1 model verification fig 12 shows a 2d fractured reservoir 150 m 150 m with 225 micro fractures and one macro fracture the semi axes of the micro fracture are 0 01 m in x direction and 3 m in y direction and the length and aperture of the macro fracture are 70 m and 0 001 m respectively for flow we have no flow at boundaries and a constant pressure 10 mpa is applied at the production well left bottom for geomechanics constant forces are applied on the top and right boundaries and the left and bottom boundaries are fixed in x direction and y direction respectively the initial pressure is 20 mpa other parameters are provided in table 3 and the equivalent parameters used in hybrid model can be calculated by using eqs 23 27 the computational grids for the sfem and hybrid model are shown in fig 12 the sfem and hybrid model are used to model the elastic production in above fractured reservoir case 1 with micro fractures in addition the production simulation of another reservoir with only one macro fracture case 2 without micro fractures is carried out by using the sfem for comparison in these simulations the filling in macro fracture is ignored and the permeabilities of matrix and fracture are assumed to be constant the pressure fields after 1 year and x displacement fields after 5 years are shown in fig 13 we can see that the results of the sfem and hybrid model for case 1 are qualitatively close while there are significant differences between the results of case 1 and case 2 the comparisons of cumulative production and relative displacement between fracture faces for different situations are plotted in fig 14 and the acceptable agreement between results of the hybrid model and sfem for case l can be seen the average errors of cumulative production and relative displacement are 3 23 and 4 15 respectively however the cumulative production and relative displacement for case 2 are different and this is because that the micro fractures can increase the effective permeability and reduce the matrix strength 4 3 2 application and discussion in this section we first test the calculation methods of equivalent permeability presented in lewandowska s and current work for different rev elements then study the impact of micro fracture vug network on the production in fractured vuggy reservoir after that the hybrid model is applied to model the production in some complex fractured vuggy reservoirs and the grid sensitivity and some influence factors of production are studied 1 2d simple fractured vuggy reservoir fig 15 a shows a 2d fractured vuggy reservoir with one macro fracture and the model parameters initial and boundary conditions are the same as those given in previous example except for the rev elements specifically two different rev elements case 1 with isolate micro vugs case 2 with micro fracture vug network and the aperture of micro fracture is 2 mm are considered in this example fig 15 the equivalent parameters of rev elements can be obtained according to eqs 23 27 the equivalent permeabilities of these two rev elements calculated from different methods which are presented in current work huang et al 2011 and lewandowska and auriault 2013 are given in table 4 for case 1 our result is almost the same as that of huang s method but there is a significant difference in the result of lewandowska s method this is because that lewandowska s method is based on the assumption that the pressure is continuous in all micro fractures and vugs i e all micro fractures and vugs are connected thus it overestimates the equivalent permeability of the rev element with disconnected micro fractures and vugs for case 2 the equivalent permeability obviously increases compared with that of case 1 and results of three methods are almost the same this is because that case 2 with micro fracture vug network meets the assumption of lewandowska s method the hybrid model is used to model the elastic production in above fractured vuggy reservoir and the computational grids are shown in fig 12 in these simulations the filling in macro fracture is ignored and the permeabilities of matrix and fracture are assumed to be constant the comparisons of cumulative production and production rate for different situations are plotted in fig 16 it can be seen that the micro fracture vug network can increase the cumulative production and production rate in early period because it enhances the effective compressibility and permeability of matrix we can also see that the cumulative production of case 1 calculated by using lewandowska s method is obviously overestimated and its production rate in early period is almost the same as that of case 2 this is because that lewandowska s method assumes that all micro fractures and vugs are connected during calculating equivalent permeability so the difference between equivalent permeabilities of case 1 and case 2 is negligible 2 2d complex fractured vuggy reservoir 1 fig 17 shows a 2d complex fractured vuggy reservoir which consists of 6 macro fractures and 4 different types of rev elements for flow we have no flow at boundaries the initial pressure is 20 mpa and a constant pressure 10 mpa is applied at production well which is placed on fractures for geomechanics a uniform constant force is applied on the top and right boundaries and the left and bottom boundaries are fixed in x direction and y direction respectively the model parameters are provided in table 5 then the equivalent parameters of each rev element can be obtained from eqs 23 27 and the equivalent permeabilities are given in table 6 to assess the grid sensitivity of hybrid model the elastic production are simulated based on three different grids i e 20 20 40 40 and 50 50 as shown in fig 18 in the following simulations the filling in macro fractures is considered and the dynamic permeability of macro fractures is adopted while the matrix permeability is assumed to be constant the cumulative production and production rate curves are plotted in fig 19 and the excellent agreements between results of 40 40 grids and 50 50 grids can be seen while the results of 20 20 grids are slight different form them this means that 40 40 grids are suitable for this example so they will be applied to the following simulations which are used to analyze some influence factors on elastic production in this fractured vuggy reservoir firstly we investigate the effect of macro fracture properties i e young s modulus of filling e s and initial permeability of macro fractures k f0 on elastic production and four cases case 1 e s 20 mpa k f0 1e 9m2 case 2 e s 40 mpa k f0 1e 9m2 case 3 e s 20 mpa k f0 1e 10 m2 case 4 e s 40 mpa k f0 1e 10 m2 are carried out fig 20 shows the cumulative production and production rate curves of these cases it can be seen that these two properties both have significant influence on production and the influence of e s is more obvious when k f0 is low then we study the effect of micro fractures and vugs i e equivalent parameters on elastic production by comparing results of three cases in case 1 all equivalent parameters are applied to the hybrid model while the equivalent permeability tensor k equ and equivalent elasticity tensor c equ are ignored in case 2 and case 3 respectively the cumulative production and production rate for these cases are shown in fig 21 and the results show that the elastic production is affected by micro fractures and vugs specifically micro fractures and vugs can increase the production rate and cumulative production because they enhance equivalent permeability and reduce matrix strength 3 2d complex fractured vuggy reservoir 2 in this example we apply our approach to simulate the elastic production of a more general 2d fractured vuggy reservoir as shown in fig 22 there are 6 intersecting macro fractures and lots of micro fractures and vugs in this reservoir and its size is 200 m 200 m the model parameters initial and boundary conditions are the same as those given in previous example and the production well is placed on fractures this reservoir is discretized with 20 20 orthogonal grids and the equivalent parameters of each grid is obtained according to eqs 23 27 in fig 23 the distributions of equivalent permeabilities are presented in the x and y directions we can see that the micro fractures and vugs have an important influence on the equivalent permeabilities and they are the main factors for the heterogeneity of formation we study the effect of macro fractures and micro fractures and vugs on elastic production by comparing results of three cases in this example in case 1 macro fractures and micro fractures and vugs are both considered while the macro fractures and micro fractures and vugs are ignored in case 2 and case 3 respectively the cumulative production and production rate curves are plotted in fig 24 it can be seen that macro fractures and micro fractures and vugs both have significant influence on elastic production and their effect can be considered by using the proposed method 1 3d fractured vuggy reservoir fig 25 shows a 3d fractured vuggy reservoir 500 m 250 m 30 m and its rev element this reservoir contains eight intersecting macro fractures and one isolated macro fracture the initial permeability of macro fractures is 1 10 9m2 and the other parameters are the same as those provided in table 5 for flow we have no flow at boundaries the initial pressure is 20 mpa and a constant pressure 10 mpa is applied at the production well which is placed at three different locations as shown in fig 25 for geomechanics a uniform constant force 20 mpa is applied on top right and front boundaries and the other boundaries are fixed in their normal direction respectively the equivalent parameters of rev element can be obtained from eqs 23 27 and the equivalent permeability tensor is 64 k eff 1 662 0 093 0 010 0 093 1 705 0 089 0 010 0 089 1 694 10 16 m 2 in this example the effect of well location on elastic production are studied by comparing results of three cases the production well is placed on intersecting fractures case 1 isolated fracture case 2 and matrix case 3 respectively this reservoir is discretized with 50 25 3 orthogonal grids and the pressure fields after 1 year and z displacement fields after 10 years of three different cases are shown in fig 26 and then the comparisons of cumulative production and production rate for these cases are plotted in fig 27 it can be seen that the well location has significant influence on elastic production and in order to obtain high production the production well should be placed on intersecting fractures we can also find that the formation subsidence has been caused from elastic production and it becomes more obvious as fluid pressure decreases 5 conclusion the main contribution of this study is that we developed an efficient hybrid model which includes the effect of each macro fracture explicitly with non matching grids and represents the effect of micro fractures and vugs implicitly to simulate the hm process in fractured vuggy porous media with multi scale fractures and vugs in the hybrid model micro fractures and vugs are modeled by use of the improved ecm which can accurately represent the effect of micro fractures and vugs on the hm process at macro scale while macro fractures with fillings are modeled explicitly through the edfm then the mixed space discretization i e the mfd for flow and stabilized xfem for geomechanics and fully coupled formulation are applied to solve the hybrid model finally the accuracy and application of the proposed method are demonstrated through several numerical examples and the results indicate that the proposed method can be applied to 3d problems and macro fractures and micro fractures and vugs both have large effects on the elastic production of fractured vuggy porous media the proposed method does not need grids to match with fractures and vugs and can achieve high accuracy without requiring highly refined grids which are necessary for the sfem therefore computational costs can be reduced greatly there is no limit to the number of fractures in the proposed model however there are still several limits at present 1 the improved ecm is developed for single phase flow and it will be extended to multiphase flow in our future study 2 we assume that the rev elements undergo small deformation and the geometry structures of micro fractures and vugs keep constant during the upscaling process thus the equivalent permeability tensor is static if we want to get the dynamic equivalent permeability tensor by using the proposed method some ancillary physical or numerical experiments should be carried out to obtain the geometry structures of rev elements under different effective stress conditions acknowledgments this work was supported by the national natural science foundation of china grant nos 51490654 51804325 61573018 the shandong provincial natural science foundation china grant no zr2015el014 and the innovative project of china university of petroleum grant no ycxj2016015 we would like to thank the china scholarship council for supporting our work appendix a homogenization upscaling in this appendix the homogenization procedure of the improved ecm is derived we now substitute eq 18 into eqs 11 17 apply eq 19 and collect terms with like powers of ε the ε 1 term of eq 14 yields a 1 y p b 0 0 thus p b 0 p b 0 x t eq 12 at the ε 2 order and eq 16 at the ε 0 order give a 2 y k m μ y p m 0 0 in ω m p m 0 p b 0 on γ it can be deduced that a 3 p m 0 p b 0 p 0 x t eq 11 at the ε 2 order and eq 16 at the ε 1 order give a 4 y c e y u s 0 0 i n ω m c e y u s 0 n 0 on γ thus a 5 u s 0 u s 0 x t eq 11 at the ε 1 order and eq 16 at the ε 0 order give a 6 y c e x u s 0 e y u s 1 0 in ω m a 7 c e x u s 0 e y u s 1 n 1 α p 0 i n on γ therefore u s 1 can be written in the form a 8 u s 1 ξ y e x u s 0 η y 1 α p 0 u s 1 x t where u s 1 x t is an y independent arbitrary displacement the ω periodic vectors ξ pq and η of zero volume average over ωm are the solutions of eqs 28 31 respectively the pressure p b 1 is obtained from eq 14 at the order ε 0 a 9 x p 0 y p b 1 0 thus p b 1 π y x p 0 p b 1 x t where p b 1 x t is a y independent arbitrary function the pressure p m 1 is the solution of eq 12 at the order ε 1 with eq 16 at the ε order a 10 y k m μ x p 0 y p m 1 0 in ω m a 11 p m 1 p b 1 π y x p 0 p b 1 x t on γ that gives a 12 p m 1 τ y x p 0 p m 1 x t where p m 1 x t is a y independent arbitrary function and a 13 p b 1 x t p m 1 x t p 1 x t the ω periodic component τj of zero volume average over ωm and πj are the solutions of eqs 32 34 consider eqs 11 and 14 at the ε 0 order a 14 x c e x u s 0 e y u s 1 α p 0 i y c e x u s 1 e y u s 2 α p m 1 i 0 in ω m a 15 x p 0 y p b 1 0 in ω b let us integrate eq a 14 on ωm and eq a 15 on ωb respectively and apply the divergence theorem then we obtain a 16 x c e x u s 0 e y u s 1 α p 0 i m 1 ω γ c e x u s 1 e y u s 2 α p m 1 i n d γ a 17 x p 0 b 1 ω γ p b 1 n d γ where ω denotes the volume of ω and the symbol a n stands for the volume average of a a 18 a n 1 ω ω n a d ω eq 16 at the ε order gives a 19 c e x u s 1 e y u s 2 α p m 1 i n p b 1 i n on γ we now substitute eq a 19 to eq a 16 and apply eq a 17 then obtain the macroscopic momentum balance in the form a 20 x σ 0 0 σ 0 c equ e x u s 0 α equ p 0 where the equivalent tensors c equ and α equ are defined as a 21 c i j k l equ c i j k l c i j m n e y m n ξ k l m a 22 α i j equ ϕ b 1 ϕ b α i i j 1 α c i j k l e y k l η m where ϕ b ωb ω is the volumetric fraction of micro fractures and vugs eq 13 at the order ε 0 gives a 23 v p 0 ϕ p u s 0 t k m μ x p m 0 y p m 1 for a parallelepipedic period with surfaces perpendicular to the axes the surface average fluid flow v p 0 s through any of the period surface s i normal to yi can be written as a 24 v p i 0 s 1 ω ω y i v p k 0 n k d s we apply the surface average to eq a 23 and use eq a 12 then obtain the macroscopic flow law a 25 v 0 v p 0 s ϕ p u s 0 t k equ μ x p 0 where v 0 is the first order darcy velocity and the equivalent permeability k equ is defined as a 26 k equ k m 1 ω ω y i i y τ n ds eqs 12 and 15 at the order ε 0 give a 27 β p 0 t α e x i i u s 0 e y i i u s 1 t x v p 0 ϕ p u s 0 t y v p 1 ϕ p u s 1 t 0 in ω m a 28 x v b 0 y v b 1 0 in ω b let us average above two equations on their respective domain and add member to member the resulting relations we obtain a 29 x a b β 1 ϕ b p 0 t α y u s 1 t m 1 ϕ b ϕ p α e x i i u s 0 t where a 30 a v p 0 m v b 0 b b y v b 1 b y v p 1 ϕ p u s 1 t m eqs 12 and 15 at the order ε 1 write a 31 y v p 0 0 y v b 0 0 therefore a 32 ω a ω m y yv p 0 d ω ω b y yv b 0 d ω ω y v p 0 n ds γ y v p 0 v b 0 n ds we apply eq a 24 and use eq 17 at the order ε 0 to the right side of eq a 32 then obtain a 33 ω a ω v p 0 s γ y ϕ p 1 u s 0 t n d s ω v p 0 s 1 ϕ p ω b y y u s 0 t d ω a 34 a v p 0 s 1 ϕ p ϕ b u s 0 t on another hand by using the periodic boundary a 35 ω b γ v p 1 ϕ p u s 1 t v b 1 n ds after using eq 17 at the ε order and eq a 8 we obtain a 36 ω b γ u s 1 t n ds ω m e y i i u s 1 t d ω a 37 b e y i i ξ m e x u s 0 t e y i i η m 1 α p 0 t introducing eqs a 34 and a 37 into eq a 29 and using eq a 25 yield the first order macroscopic mass balance in the form a 38 β equ p 0 t γ equ e x u s 0 t x k equ μ x p 0 0 where a 39 β equ β 1 ϕ b 1 α 2 e y i i η m γ equ ϕ b α 1 ϕ b i 1 α e y i i ξ m finally we return the quantities to dimensional form and substitute subscript hm for superscript 0 then the equivalent macroscopic model can be written as eqs 20 22 
691,optimal management of water resources depends on the prediction capability of process based hydrological models new generation richards equation based distributed models provide detailed descriptions of hydrological processes that however depend highly on the proper assessment of the spatial variability of soil hydraulic properties shps field surveys and sampling campaigns commonly provide sparse local scale measurements of shps nevertheless the challenge is to transfer this information from the observation scale to the model scale by increasing as much as possible the prediction efficiency with affordable practical burdens the performances of two parameterization approaches are compared in this study in terms of outputs of water budget simulated by the hydrogeosphere hgs model in a small catchment the first approach relies on knowledge of soil hydraulic data from soil cores centimeter scale collected in many locations of the study site and the application of the miller miller scaling technique enabling the spatial variability of the so called aggregated shps to be described over the spatial domain of interest the second approach instead estimates a set of equivalent shps through the numerical inversion of geophysical data measured with the electrical resistivity tomography ert during an infiltration experiment meter scale performed in only one plot transect of the study catchment the shps obtained by these two approaches are then assigned to each numerical grid cell in hgs to simulate the catchment scale soil water budget at daily time resolution within the framework of a functional evaluation we compare the performance of these two soil hydraulic parameterization approaches in terms of streamflow viewed as a lumped flux and near surface soil effective saturation patterns viewed as distributed state variables better comparisons between observed and simulated streamflow values are obtained when the study site is parameterized using the equivalent shps conversely the hgs water budget simulations using the aggregated shps are more effective when one should describe the spatial patterns of near surface soil moisture values this study highlights the pros and cons and potential flaws when choosing two different parameterization techniques in spatially distributed modeling applications keywords soil hydraulic properties scale transfer soil moisture infiltration streamflow dreamzs hydrogeosphere 1 introduction optimal management of water resources at catchment scale depends on the prediction capability of process based hydrological models the key to obtain successful simulations is to implement an optimal parameterization of the soil hydraulic behavior in the modeled flow domain a single set of soil hydraulic parameters is often calibrated and validated by comparing observed and simulated lumped water fluxes lamparter et al 2018 shiferaw et al 2018 demirel et al 2018 this parameterization practice can be effective when bucket type models are used enabling the catchment behavior to be reproduced in a spatially lumped manner nonetheless realistic distributed hydrological response of a catchment is obtained only by using spatially distributed or semi distributed hydrological models pringle et al 2007 richards equation based distributed models reproduce the spatial domain under study through a numerical grid of small sized cells roth et al 1999 therefore a detailed description of the hydrological processes highly depends on the proper assessment of spatial organization of the soil hydraulic properties shps namely the soil water retention wrf and unsaturated hydraulic conductivity hcf functions neuweiler and vogel 2007 kreye and meon 2016 field surveys and sampling campaigns usually provide sparse information on shps that then has to be generalized over the flow domain of interest and often transferred into the numerical grid of a spatially distributed hydrological model assessing soil attributes and then assigning them to each numerical grid cell is a critical step in catchment hydrology beven et al 2015 godoy et al 2018 the challenge is to obtain the highest prediction efficiency by using affordable experimental efforts or in other words the lowest model uncertainty by reducing time and costs for field measurements vereecken et al 2007 presented two main approaches to parameterize a non uniform soil domain i the forward approach and ii the inverse modeling approach the forward approach also referred to as the upscaling approach employs scaling and geostatistical methods to interpolate the known sparse point scale shps and distribute the estimates over the unsampled locations of the grid kabat et al 1997 unfortunately this approach is effective only if based on several soil samples by entailing considerable investments in terms of time and costs although laboratory experiments have the advantage of being accurate the measurement soil volume centimeter scale can lead to shps that are not well representative of the study area alternatively the inverse modeling approach retrieves the soil hydraulic properties so that the model simulations enable the observed monitored distributed hydrological behavior to be reproduced as closely as possible for specific sets of boundary conditions nasta and romano 2016 in many cases especially for larger and or ungauged catchments there is little information available on distributed state variables soil characteristics and especially lower boundary conditions and therefore the field scale or even catchment scale inverse modeling method might suffer from ill posedness by causing non uniqueness of shps beven 2006 romano and santini 1999 affordable inverse modeling approaches have been recently proposed that refer to relatively faster and cost effective plot scale experiments monitored by noninvasive electrical resistivity tomography ert e g beaujean et al 2014 and electromagnetic induction emi e g lesch et al 1995 methods or time lapse techniques e g robinson et al 2009 through a variety of increasingly complex applications e g robinson et al 2008 huang et al 2014 brogi et al 2019 often employing inversion of emi multi coil or multi frequency data huang et al 2015 shanahan et al 2015 koganti et al 2018 boaga et al 2018 based on novel inversion tools e g mester et al 2011 triantafilis et al 2013 deidda et al 2014 the aforementioned geophysical experiments are at the meter scale with much larger spatial resolution than that of the laboratory experiments for this reason many researchers assume as we did in the present study that shps retrieved from plot scale inverse modeling approaches might approximate field scale effective parameters we would conclude this brief review of methods by also mentioning that with the recent improvement of non invasive geophysical techniques and related reduction in costs and efforts with their usage these techniques are being employed increasingly to provide proxy information that correlates with soil properties of interest so as to map the spatial variations of soil attributes in a fairly efficient way to comply with the forward parameterization approach in this study undisturbed soil cores were collected near the ground surface at a number of sparse locations in a 5 hectares experimental catchment which were then subjected to laboratory experiments to determine the soil physical and hydraulic properties in contrast to perform an inverse modeling parameterization approach an infiltration experiment was carried out just at one location along a representative hillslope of this study area to inversely estimate the unsaturated soil hydraulic properties by monitoring the process through the ert technique a first problem we pose is the transfer of the information about the shps gained from either the soil cores or the ert based infiltration experiment the so called observation scale to each regularly spaced cell of the numerical grid the so called model scale implemented in hydrogeosphere hgs glaser et al 2019 hgs is a fully integrated hydrological model that solves the 3d richards equation for subsurface flow and uses the 2d and 1d diffusion wave approximations of the de saint venant equation to describe the surface and channel flow respectively therrien et al 2005 davison et al 2018 the transfer of knowledge from the physical domain to the numerical domain can be viewed as upscaling from the observation scale to the model scale and in the present paper was carried out by the following two different parameterization procedures 1 by using a similar media scaling method which is commonly used in soil hydrology to reconstruct the soil hydraulic behavior over a study area from sparse soil core sampling 2 by an inverse modeling approach that uses the ert dataset gathered during the in situ infiltration experiment that was performed in a single location of the study area given the above considerations we posit the following the soil hydraulic parametric functions obtained by the scaling method are here defined as aggregated shps from the knowledge of conversion factors i e the so called scaling factors which relate the local property to the reference property we are able to describe approximately the spatial variations exhibited in the study catchment by the soil hydraulic properties and then to assign them to each cell of the model grid by using ordinary kriging which is a commonly used technique in these analyses the soil hydraulic properties obtained by inversion of the ert data measured during the in situ infiltration experiment meter scale are denoted as plot scale equivalent shps the dreamzs toolbox is used to estimate the posterior probability density functions of the soil hydraulic parameters vrugt 2016 we assume that plot scale parametric uncertainty is scale invariant and only one set of soil hydraulic parameters is randomly generated using the dreamzs output in each grid cell of the numerical grid from the above mentioned formulation of the problem it is evident that scale and scale transfer become key concepts within the framework of the present study the similar media scaling method coupled with geostatistical theory is recognized as being an appropriate and well validated tool to be used when the soil hydraulic properties are estimated from experiments carried out in the laboratory on relatively small soil cores these soil properties aggregated properties will be spatially interpolated at unsampled locations hopmans et al 2002a on the other hand in the case of the field infiltration experiment the scale of the observations is closer to the scale of the grid cells and it is our belief that the inverse modeling approach coupled with a stochastic simulation is an effective tool to simulate a set of equivalent soil hydraulic properties at the model scale hopmans et al 2002b a major goal of our study is to compare the outcomes of these two techniques not only in terms of the estimated parametric hydraulic curves but also and more importantly from certain viewpoints by performing functional evaluations to ascertain the advantages and limitations of the two aforementioned approaches for characterizing the spatial variability of shps the objective of the present study is twofold a to compare the scaling based aggregated and the inversion based equivalent soil hydraulic properties and b to assess the effectiveness of these two approaches in modeling distributed hydrological behavior through a functional evaluation approach when estimating spatially lumped or distributed hydrologic response at the scale of a small catchment 2 experimental works and methods 2 1 study site and measurements the research investigations were carried out in an experimental catchment denoted as mfc1 located near the village of monteforte cilento in southern italy romano et al 2018 the mfc1 has a drainage area of approximately 5 0 hectares and belongs to the upper alento river catchment nasta et al 2013b 2017 fig 1 illustrates the soil sampling points the positions where the soil water contents were measured by the tdr and the experimental plot where the infiltration experiment was carried out in this figure there are also the positions of the weather station and the streamflow measurement device streamflow q m3 s 1 was monitored from april 2006 by using a capacitance probe odyssey dataflow systems ltd new zealand to measure the water level of the stream flowing through a 90 v notch weir positioned at the catchment outlet an automatic weather station has been operational since 2006 to record rainfall r air temperature and humidity wind speed and direction and net solar radiation with a four component sensor a portable time domain reflectometry tdr device tdr100 campbell scientific inc usa with a 3 rod probe 15 cm in rod length manufactured at the laboratory of soil hydrology of the university of napoli federico ii was used to measure near surface soil moisture θ in cm3 cm 3 on a regular square grid 25 m 25 m see fig 1 of 94 measuring points over 13 sampling campaigns from september 1st 2006 to april 24th 2008 nasta et al 2018a sometimes we were not able to fulfill all 94 soil moisture measurements 01 sep 2006 22 sep 06 11 may 2007 and 09 jul 2009 because either the land owners denied access in the fields during tillage operations or the tdr signal was rather poor during relatively drier weather conditions table 1 lists the descriptive statistics relevant to all 13 sampling campaigns it is worth noting that during seasonal transition periods i e from dry to wet or from wet to dry season as well as during the wet seasons the presence of a negative value for skewness highlights drier than average soil moisture values that can alter a typical unimodal distribution of these data nasta et al 2018b the lilliefors tests suggest that normality should be rejected at a 0 05 level of significance for three distributions out of thirteen belonging to the seasonal transition phases disturbed soil samples and undisturbed soil cores steel cylinder of 7 2 cm inner diameter 7 0 cm height hence 285 cm3 core volume were collected near the soil surface vertical sampling at soil depth of 10 17 cm in 44 points open circles of the sampling grid and transported to the laboratory to determine particle size distribution soil texture oven dry soil bulk density ρb in g cm 3 saturated soil water content θs in cm3 cm 3 and saturated soil hydraulic conductivity ks in cm d 1 for each soil core soil water retention data pairs soil water content and matric pressure head denoted by the symbols θ in cm3 cm 3 and h in cm respectively were measured by using suction tables romano et al 2002 and pressure plates bittelli and flury 2009 the measured h θ data pairs were fitted to the parametric water retention function wrf proposed by van genuchten 1980 1 s e h θ h θ r θ s θ r 1 α h n m from which the relative hydraulic conductivity kr function hcf can be estimated from the measured saturated hydraulic conductivity ks through the following relation 2 k r s e k s e k s s e l 1 1 s e 1 m m 2 where θs and θr are the saturated and residual volumetric soil water contents respectively α cm 1 n and m 1 1 n are the shape parameters of wrf and l is the pore connectivity parameter of hcf assumed here to be equal to 0 5 soil effective saturation se varies between 0 when θ θr and 1 when θ θs table 2 lists the statistics for all measured soil physical characteristics and the estimated soil hydraulic parameters soil texture in mfc1 spans from clay to silty clay loam classes and the spatial variability as expressed by the coefficient of variation cv in percent is very high for residual water content and saturated hydraulic conductivity two pits were excavated for sampling soil cores along the soil profile see the locations depicted in fig 1 to determine the soil physical and hydraulic properties at selected soil depths see table 3 we observe an increase in the clay content values and a decrease in ks values in the deepest soil layers of the soil profile in november 2014 an infiltration experiment was performed within a 1 1 m wooden box the position was chosen such that soil texture and bulk density parameters were as close as possible to the spatial average values table 2 about 600 l corresponding approximately to 0 6 m3 of water were poured into the box by imposing a water head of approximately 15 cm the experiment lasted 4 5 h in this paper we focus on the monitoring results from ert that is a geo electrical method based on current injection and voltage measurements it exploits the capabilities of modern instruments and computational power to produce tomographic images starting from a large number of quadripole measurements binley and kemna 2005 the ert method when data are acquired in a time lapse mode is particularly effective to monitor changes in soil moisture using a variety of configurations from surface to cross borehole geometries and from meter to decimeter scales e g daily et al 1992 binley et al 2002 singha and gorelick 2005 deiana et al 2008 cassiani et al 2009 koch et al 2009 wallin et al 2013 meyerhoff et al 2014 therefore ert is one of the most commonly used methods in hydro geophysical applications see e g binley et al 2010 for an overview with a recent increase in high resolution soil monitoring including studies on the effects of root water uptake e g garré et al 2011 boaga et al 2014 vanella et al 2018 noninvasive ert data were acquired both along a surface line and using a 3d setup similar to those employed for small scale root water uptake monitoring e g cassiani et al 2015 2016 the latter data provide small scale information about infiltration patterns but this is not fully relevant to the present study where we focus on the intermediate scale processes indicatively above 1 m in length therefore in the following we will present use and discuss only the results of surface ert acquisitions the latter were performed using a 48 electrode line with electrode spacing equal to 0 3 m for a total length of 14 1 m the resulting depth of investigation is in the 3 m range the conversion of resistivity values to soil moisture content or soil effective saturation is usually performed by using constitutive relationships e g archie 1942 waxman and smits 1968 that need to be calibrated via laboratory or in situ experiments e g monego et al 2010 the acquisition scheme was a skip zero dipole dipole configuration i e a configuration where the electrodes of both current and potential dipoles have the minimum possible distance this set up ensures maximal spatial resolution provided that the signal to noise ratio is high enough the time for current injection was set to 250 ms with total number of cycles per measurement equal to 3 to 6 depending on the repeatability check the data quality was assessed by acquiring both direct and reciprocal measurements the principle of reciprocity for example see parasnis 1988 or binley et al 1995 ensures that the current and potential electrodes can theoretically be interchanged without affecting the measured resistance provided that linearity is honored i e ohm s law is valid however real data show discrepancies between direct and reciprocal measurements often due to current injection difficulties because of poor electrode contacts therefore the reciprocity error is a good measurement of data accuracy a total of roughly 2100 measurements were collected during each ert acquisition using a syscal pro72 resistivimeter iris instruments a reciprocal error threshold of 5 was used for all acquisitions and the same error level was used in the occam approach implemented in the ert inversion code profiler binley 2018 the ert line location is shown in fig 1 red dashed line it is important to mention that the ert line was not centered around the infiltration plot but elongated downhill in order to capture the patterns of soil water flow along the hillslope see the dashed line of the ert electrode line in fig 1 as this appears to be very limited in the presentation and analysis of results we will focus on the portion of the ert line centered on the infiltration box measurements of electrical resistivity were acquired at time 0 initial condition and after 2 h 2 5 h 3 5 and 4 5 h the conversion of bulk electrical resistivity as measured by ert into estimated soil effective saturation relies on archie s law archie 1942 3 ρ a ε b s e c ρ w where ρ is the bulk electrical resistivity e g as measured by ert ρw is the electrical resistivity of the pore water ε is porosity whereas a b and c are material parameters to be calibrated on a case by case basis we conducted laboratory calibration of archie s law parameters using soil samples taken from the infiltration area the estimated values of the parameters featuring in eq 3 are the following a 0 43 b 1 43 and c 0 91 note that archie s law is particularly effective when se changes have to be estimated from knowledge of electrical resistivity changes over time and under the reasonable assumption that pore water resistivity does not change over short lapses of time in the present study water was taken from a local source in the same mountain region with moderate electrical conductivity 4 s e 1 s e 2 ρ 1 ρ 2 1 c where the subscripts 1 and 2 refer to different time lapses once soil effective saturation is estimated at the initial time via laboratory porosity measurement and in situ soil water content tdr determinations the changes are directly derived from time lapse ert 2 2 comparison between ert and scaling based approaches the schematic representation depicted in fig 2 illustrates the various steps established to compare the two approaches employed to characterize the spatial variability of shps in the study catchment the two parameterization approaches will be evaluated by comparing simulated and observed streamflow and near surface soil moisture patterns converted in soil effective saturation values the approach based on the in situ infiltration experiment has been already described above in sub section 2 1 the ert method is used for monitoring soil effective saturation along the soil profile during the infiltration process this information is exploited to estimate the equivalent shps through the inverse modeling of the numerical infiltration process by combining hydrogeosphere hgs model therrien et al 2005 with the differential evolution adaptive metropolis algorithm dreamzs coupled to the efficient markov chain monte carlo sampling scheme vrugt 2016 the optimization routine sets the objective function of for minimizing the discrepancy between observed and simulated soil effective saturation values the setup of the forward simulation of the infiltration experiment in hgs is based on the 2 d grid slice with 8 m length with 20 rectangles in the x direction and 1 m length in the y direction with one single rectangle the 3 d mesh replicates the 2d slice along 3 m depth in the z direction discretized in 30 rectangles boundary conditions are set to no flux throughout the soil domain except the 1 m 1 m block on soil surface corresponding to the area delimited by the wooden box this part of the grid is subjected to constant pressure head of 15 cm initial conditions mimic as close as possible the initial t 0 h 2 d image of soil effective saturation retrieved by the ert method even though we recall that discrepancies between observed and simulated soil effective saturation values are evaluated only within the wetting zone of the virtual soil profile below vertical movement of water and around radial movement of water the location of the wooden box the duration of the forward simulation is 4 5 h and five images of the soil profile are stored to retrieve the simulated soil effective saturation corresponding to the observed snapshots the ert based parameterization of the numerical grid is graphically illustrated in fig 3 within a bayesian framework dreamzs provides the posterior probability density functions pdf of the optimized ert based shps intertwined by a covariance matrix under these circumstances we assume marginal posterior pdfs of the optimized soil hydraulic parameters as the parametric uncertainty of the plot scale equivalent shps the assumption here is that the equivalent shps obtained by a meter scale field experiment do not vary in space and are representative for the entire sub catchment this is a sort of fully lumped position that is justified by the relatively high burden associated with an in situ experiment monitored by an ert technique the other approach is based on soil sampling and subsequent determination of sparse 44 soil water retention and hydraulic conductivity functions fig 4 this approach generates aggregated shps through the similar media scaling method proposed by clausnitzer et al 1992 by assuming the validity of microscopic geometric similarity among soils miller and miller 1956 sadeghi et al 2016 pachepsky and hill 2017 sparse point scale measured soil hydraulic functions coalesce into a single set of aggregated shps also termed reference wrf and reference hcf through a set of scaling factors δ which are commonly distributed according to a log normal probability density function nasta et al 2013a the spatial variation of the soil hydraulic properties is described by the scaling method through the reference spatial average soil water retention h θ and hydraulic conductivity k θ functions and the set of scaling factors δ for each ith sampling location the reference wrf and hcf refer to the homogeneous soil domain while the scaling factors represent the spatial variability of the heterogeneous spatial domain in this study we used a single set of scaling factors derived from the soil water retention function only however we caution the readers that scaling outcomes might falsify the basic hypothesis of microscopic geometric similarity following the procedure described in clausnitzer et al 1992 the relations linking the scaling factors to the reference wrf and hcf are defined as follows 5 h i s e h s e δ i and 6 k i s e δ i 2 k s e the aggregated shps of the homogeneous soil together with the scaling factors δi of each grid block are determined by assuming that θ s and ln k s are equal to the respective mean values of θ s i and ln k s i the remaining parameters of the reference wrf and scaling factors δi of each sampling location are obtained through the optimization criterion corresponding to case a of clausnitzer et al 1992 the main advantage of this relationship is that new scaling factors are able to generate shps to be assigned to the cells of the numerical grid the new scaling factors can be either stochastically generated nasta et al 2013b or interpolated by using geostatistical methods hengl et al 2004 in this study we used ordinary kriging to generate a map of scaling factors at mfc1 goovaerts 2001 we remind that kriging is an optimal estimator but is able to generate only one map of a soil attribute and provides a sort of incomplete measure of local accuracy to perform a functional evaluation of the two above described approaches the shps were used to parameterize the hydrogeosphere hgs model to determine the daily water budget of the mfc1 cornelissen et al 2014 fang et al 2015 the evaluation is carried out by comparing simulated and observed streamflow lumped hydrologic information and near surface soil moisture patterns distributed hydrologic information pokhrel et al 2011 noh et al 2015 the spatial domain of mfc1 is discretized with uniform grid blocks the 2 d grid slice is 400 m length with 86 rectangles in the x direction and 240 m length with 52 rectangles in the y direction obtaining a total 4472 grid cells size 4 6 m 4 6 m the 3 d mesh is generated by defining the elevation through a 5 m digital elevation model the flow domain in the vertical direction is divided into 30 rectangles based also on visual inspection of the pedological layering of the soil profile and on the information retrieved from the two pedological pits table 3 we functionally split the entire soil depth of the catchment into a horizontally heterogeneous top layer of 0 60 m thickness and a horizontally homogeneous bottom layer below the soil depth of 0 60 m therefore shps are assigned to a 3d grid block size of 4 6 m 4 6 m 0 60 m whereas the bottom layer is characterized by a single set of shps obtained as an average of the soil hydraulic properties determined below the soil depth of 0 60 m for comparison between simulated and observed soil moisture values we assume that the meter scale grid cell volume can be roughly compared to the sub meter scale soil volume in which local tdr measurements take place romano 2014 hgs couples the surface and variably saturated subsurface water flow regimes with interactions the coupling length coefficient regulates the exchange of flow between surface and subsurface domains daily values of measured rainfall r and estimated allen et al 1998 reference potential evapotranspiration et0 are set as the upper boundary condition while no flux is set as lower and lateral boundary conditions this hypothesis is formulated by considering the quasi impermeable clayey layer at approximately 3 0 m depth and the presence of a road drainage system almost entirely surrounding mfc1 nasta et al 2013b during the dry season we observed dry patterns of soil moisture see table 1 and absence of overland flow in other words infiltration generated by even large episodic rainfall events was depleted by high evapotranspiration demand in summer nasta et al 2018a runoff occurred when soil moisture storage started replenishment during the dry to wet transition period i e moving from summer to fall season with the concurrent increase in the water levels recorded in four stone cased wells at mfc1 romano et al 2018 during winter and under conditions of fully saturated soil in most parts of the study area we observed that the groundwater levels reached the soil surface and consequently moderate to high runoff rates were generated during the subsequent wet to dry transition period i e moving from winter to spring season soil moisture storage capacity decreased rapidly with a concurrent lowering of water levels in the stony wells based on this behavior of the study area the saturation excess overland flow dunne overland flow was definitely assumed to be the dominant runoff generation mechanism consequently and also in order to reduce somehow the computational efforts the use of a daily resolution rainfall seemed appropriate for our modeling purposes hearman and hinz 2007 specifically addressed the issue of the possible effects that rainfall resolution exerts on surface runoff predictions by a conceptual bucket model and among other things argued that largest uncertainties in surface runoff prediction should be expected when this process is dominated by the infiltration excess mechanism hortonian overland flow within a study about preferential flow predictions at catchment scale glaser et al 2019 also dealt with this question and concluded that the use of a daily temporal resolution for their input data did not impact too much on catchment runoff predictions in general particular attention should be paid to checking how runoff generates in a catchment before starting a computer modeling simulation since especially under mediterranean climate conditions and for certain soil types the hortonian overland flow can be instead the most important runoff generation mechanism that would require rainfall data at hourly or even at sub hourly time resolution the critical depth boundary condition of hgs is assigned to the node at the outlet of the catchment to generate the simulated streamflow the numerical simulation starts on 1st january 2006 with hydraulic equilibrium and ends on 24th april 2008 last soil moisture sampling campaign the time period spanning from 1st january 2006 to 31st august 2006 represents a warm up time whereas the time interval from 1st september to 24th april 2008 represents the validation range same as the soil moisture measurements campaign we recall that the validation range for streamflow is shorter from 1st january 2007 to 24th april 2008 due to sensor malfunctioning 3 results results are organized by following the schematic overview of fig 2 first equivalent and aggregated shps are presented in section 3 1 as retrieved from the ert based and scaling based approaches respectively section 3 2 then provides the parametric comparisons while section 3 3 deals with the functional evaluation by comparing observed and simulated monthly time series of streamflow and near surface soil effective saturation patterns taken in the 13 sampling days 3 1 ert based and scaling based approaches the ert based shps are retrieved from the infiltration experiment described in section 2 1 the calibration results fig 5 illustrate the difference between the observed left panel and simulated right panel soil effective saturation data along the soil profile during the infiltration process the y axis is stretched to better show the vertical variation of soil effective saturation table 4 reports the most probable ert based shps and their uncertainty bands with the average and standard deviation values in parenthesis of parametric posterior density distributions the discrepancy between observed and predicted soil effective saturation values is expressed through the root mean squared deviation rmsd we observe a general agreement between the left and right panels despite the relatively high rmsd of 21 note that the ert results fairly reflect the actual soil heterogeneities as captured by the inversion procedure employed in this study nonetheless the numerical simulation reproduces very similar wetting fronts advancing downward along a vertical distance of about 80 cm the scaling based shps are obtained by using the 44 soil samples the spatial variability of aggregated shps is expressed by the descriptive statistics reported in table 4 scaling based saturated water content θs residual water content θr and saturated hydraulic conductivity expressed in decimal logarithm scale log10 ks refer to spatial average values whereas water retention shape parameters log10 α and n pertain to the reference wrf the spatial variability of wrfs is quantified by applying eq 5 where the scaling factors lnδ refer to each known sampling position the scaling factors are log normally distributed with zero mean and standard deviation σ equal to 0 21 table 4 we observe that the spatial variability of the soil water retention characteristic as depicted by the standard deviation of scaling factors is significantly lower than that of the hydraulic conductivity in other words the scaling factors retrieved from the soil water retention function only fail to fully describe the spatial variability of the hydraulic conductivity function this drawback may have negative repercussion when simulating soil water flow processes warrick et al 1977 the scaling factors were interpolated in the spatial domain by using ordinary kriging the map of scaling factors is shown in fig 6 therefore the interpolated scaling factors and the reference shps generate new shps in the cells of the numerical grid green denotes the zero mean of the scaling factors indicating that the wrfs are quite close to the reference wrf conversely blue and red denote under and over estimations respectively compared to the reference wrf underestimations might be related to tillage free zones with a high degree of soil compaction 3 2 parametric evaluation of the two approaches the shps pertaining to the two approaches are presented in fig 7 the plots on the left show the wrfs fig 7a and c whereas the plots on the right show the hcfs fig 7b and d with the bold lines depicting the shps relative to the homogeneous domain and colored bands representing the spatial variability of the heterogeneous spatial domain the upper plots show the shps in relative terms namely se h and kr h whereas the bottom plots show the reference shps in absolute terms namely θ h and k h we remind that the spatial variability of shps is described by a single set of scaling factors for both wrf and hcf green bands the water retention functions wrfs estimated by the two approaches show notable differences the equivalent wrf has the typical shape of a poorly structured soil shape parameter n 1 79 instead the aggregated wrf shows rather the typical pattern of a well graded porous medium shape parameter n 1 13 since the spatial average saturated water contents are quite similar for the two approaches see table 4 the observed discrepancy between the two wrfs should not be attributed to differences in attaining the full saturation condition rather the soil of the study catchment has a relatively high clay content see table 2 and hence the ert based equivalent wrf might have been affected by hydraulic nonequilibrium during the transient infiltration experiment weller and vogel 2012 hannes et al 2016 tzavaras et al 2017 instead the soil cores laid on the suction tables released water during steps of hydrostatic drainage equilibria romano et al 2002 and no phenomena of hydraulic nonequilibrium are expected for these types of laboratory tests moreover it is also important to mention the fact that the aggregated wrfs benefit from retention data points measured in the dry range using the pressure plate apparatus namely at 3000 cm 6000 cm and 12 000 cm pressure head allowances should also be made for the different measurement resolution between the two methods mertens et al 2005 soil cores provide centimeter scale measurements of the main drying soil water retention curve while the ert based infiltration is a wetting process under highly transient conditions in the meter scale range the spatial resolution of the second approach should better describe the soil structure this allows to properly capture the aggregation of soil pores and water retention dynamics induced by swelling and shrinkage wetting and drying and tillage operations herbrich and gerke 2017 the observed discrepancies between the two hydraulic conductivity functions hcfs shown in fig 7b and d result mainly from the difference in the values of the water retention shape parameters to conclude the discussion about the observed differences in the parametric comparisons between the aggregated and equivalent shps we believe that the primary reasons for the pronounced offset between the two sets of shps should be attributed to the different information content of input data obtained when performing the two different experiments as well as to some dynamic nonequilibrium effects likely occurring during the in situ infiltration test such as those discussed by diamantopoulos and durner 2012 what is now interesting is to examine how these discrepancies can affect the outcomes of a hydrological model through a functional evaluation approach this aspect will be presented and discussed in the next section 3 3 functional evaluation of the two approaches the performance metrics for the functional analysis is based on the statistical indices described below the nash sutcliffe efficiency nse index nash and sutcliffe 1970 is used as the main goodness of fit metric and represents the complement to unity of the ratio between the mean square error of observed against predicted values and the variance of the observations the index is quantified as follows 7 n s e 1 i 1 n o i p i 2 i 1 n o i o i 2 where oi and pi represent observed and model simulated variables respectively n is the total number of available measurements i 1 2 n and o is the mean of the observed values the nse spans from null fit to 1 perfect fit nse 0 suggests that the mean of the observed values is a better predictor than the evaluated model itself ritter and muñoz carpena 2013 introduced the nt index expressing the number of times the standard deviation sd of observations is greater than the rmsd the nt index is obtained as follows 8 n t s d r m s d 1 model efficiency can be established according to the values of nt and nse four model efficiency classes unsatisfactory acceptable good and very good are reported in table 1 in ritter and muñoz carpena 2013 minimum values for very good model performance should be equal to 2 2 and 0 90 for nt and nse respectively finally as recently done by romano and nasta 2016 model performance can also be tested by the refined version of willmott s index of agreement d r willmott et al 2012 9 d r 1 i 1 n p i o i 2 i 1 n o i o w h e n i 1 n p i o i 2 i 1 n o i o 2 i 1 n o i o i 1 n p i o i 1 w h e n i 1 n p i o i 2 i 1 n o i o the dimensionless index d r 1 0 dr 1 0 expresses null and perfect fit for dr 1 and dr 1 respectively this index is particularly useful for making cross comparisons between models because it is bounded to 1 instead of on the lower limit fig 8 shows daily observed and simulated streamflow response to daily boundary forcing data in the numerical simulations both approaches satisfactorily capture the overall dynamics without specific calibration of runoff properties nonetheless it is clear that ert based shps generate runoff which is significantly higher than that generated by scaling based shps especially during the wet season from late fall to early spring this is explained by the difference in terms of water retention functions see fig 8a in which ert based wrf is characterized by a steep wetting phase whilst scaling based wrf is clay type herbrich and gerke 2017 the model performance on streamflow is calculated on untransformed and logarithmic monthly discharge sums table 5 moriasi et al 2007 in the context of the present study we are not interested in sub monthly flow dynamics without site specific calibration of parameters relating to subsurface and surface flow ert based shps provide better lumped model performance than scaling based shps yet logarithmic transformation gives more emphasis on low flows and scaling based shps notably improve their performance in this case although they remain lower than in the other approach according to the efficiency metric introduced by ritter and muñoz carpena 2013 both methods are affected by unsatisfactory results for untransformed monthly discharge sums logarithmic transformations slightly improve ert based and scaling based performance leading to good and acceptable model simulations respectively however this performance metric highlights the need to calibrate the parameters controlling surface flow in future studies as indicated by the recommendations given by stisen et al 2011 discharge is only a lumped measure of model performance and does not provide sensitivity to spatially distributed shps qu et al 2015 in this regard we test model performance by comparing the 13 tdr observed and simulated soil effective saturation patterns to do so we show the first 12 soil effective saturation maps generated by ert based fig 9 a and scaling based fig 9b shps table 6 lists the descriptive statistics and expresses the discrepancy between observed and simulated values through the rmsd and dr values the scaling based shps provide better performance than ert based shps in expressing the spatial variability of soil effective saturation recently nasta et al 2018a found that soil effective saturation patterns at mfc1 are mainly controlled by evapotranspiration the accuracy of the scaling based shps increases under drier conditions as depicted by lower values of rmsd and dr associated to low spatial average soil effective saturation s e values it is worth noting that for scaling based model predictions dr values decrease also for more negative skewness values table 6 sciuto and diekkgrüger 2010 used the kappa statistics to compare observed and simulated soil moisture patterns in the wüstebach catchment size of about 27 ha in germany and demonstrated that the resolution of the spatial discretization has a dominant impact on hgs model performance rather than the aggregation of the soil properties recently koch et al 2016 confirmed that 3d models perform well in terms of discharge but their ability to reproduce simulated soil moisture patterns depends on adequate soil spatial parameterization the ert based soil effective saturation maps show quite low values for all the 13 measurement campaigns this behavior can be mostly attributed to the typical patterns of the ert estimated wrf see plots 7a or b relevant to a typical poorly graded soil the soil effective saturation maps generated by scaling based shps provide higher performance than the ert based ones fig 10 compares the spatial average fig 10a and standard deviation fig 10b of observed and simulated soil effective saturation values and demonstrates that scaling based shps are effective at capturing the catchment behavior in contrast both spatial average and standard deviation of soil saturation values generated by ert based shps underestimate the corresponding observations the rmsd soil effective saturation values halve and if converted in terms of soil moisture scaling based rmsd are lower than rmsd obtained by nasta et al 2018a that combined a bucket model with a topography based estimator 4 conclusions in this study we critically evaluated the pros and cons of two approaches for distributing soil hydraulic properties across the numerical grid of a 3d richards based hydrological model hgs model we tested the sensitivity of the hgs model to spatial variability of shps that are derived by using either a the results of an in situ ert monitored infiltration experiment or b laboratory analysis on undisturbed soil cores the results are dramatically different in terms of both parametric and functional evaluations this study shows deficiencies related to the parameterization in hgs in terms of catchment response under prescribed forcing conditions when hgs is run by using the equivalent ert based shps lumped water fluxes such as streamflow values are acceptably predicted but state variables such as simulated near surface soil effective saturation patterns are consistently mismatched conversely aggregated shps provide good performance in terms of soil effective saturation patterns and poor results in terms of streamflow simulations the two measurement techniques differ because the ert based is affected by hydraulic nonequilibrium during transient conditions the parameterization of a numerical grid in a richards based model is a matter of debate in catchment hydrology the choice between the two approaches presented in this study might be dictated mainly by the experience and expertise of the research group but may also depend on the trade off between practical limitations of the experimental work and model efficiency requirements in regard to the scaling method it is definitely better to identify a single set of scaling factors by simultaneously optimizing water retention and hydraulic conductivity functions the scaling factors derived from the water retention function only are unable to fully capture the spatial variability of the soil hydraulic response in order to properly assess the spatial variability of the equivalent shps more ert based infiltration experiments will be run in other positions of the study area at cost of increasing experimental efforts the observational set of soil effective saturation patterns will undoubtedly be integrated and improved by installing sensor networks providing dense information on spatio temporal soil moisture dynamics across the upper alento river catchment romano et al 2018 additional sparse observations on vegetation characteristics and groundwater levels will be integrated in order to offer realistic or at least pseudo realistic numerical simulations by using high complex 3 d modeling approaches this step forward will serve to run future modeling simulations within scenario based approaches for evaluating the impact of climate and land use change on catchment scale water budget components acknowledgements the study was partly supported by the miur prin project innovative methods for water resources management under hydro climatic uncertainty scenarios grant 2010jhf437 the eu fp7 project globaqua managing the effects of multiple stressors on aquatic ecosystems under water scarcity grant number 603629 and project hydro geophysical monitoring and modelling for the earth s critical zone funded by the university of padua prot cpda147114 the authors are grateful to benedetto sica and giuseppe speranza for their assistance during the field campaigns and laboratory measurements we specifically thank benedetto sica for his work in designing and fabricating the tdr probes anonymous referees generously made valuable comments and suggestions that improved not only the general readability of our paper but also a few key points deserving clarifications supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 02 014 appendix supplementary materials image application 1 
691,optimal management of water resources depends on the prediction capability of process based hydrological models new generation richards equation based distributed models provide detailed descriptions of hydrological processes that however depend highly on the proper assessment of the spatial variability of soil hydraulic properties shps field surveys and sampling campaigns commonly provide sparse local scale measurements of shps nevertheless the challenge is to transfer this information from the observation scale to the model scale by increasing as much as possible the prediction efficiency with affordable practical burdens the performances of two parameterization approaches are compared in this study in terms of outputs of water budget simulated by the hydrogeosphere hgs model in a small catchment the first approach relies on knowledge of soil hydraulic data from soil cores centimeter scale collected in many locations of the study site and the application of the miller miller scaling technique enabling the spatial variability of the so called aggregated shps to be described over the spatial domain of interest the second approach instead estimates a set of equivalent shps through the numerical inversion of geophysical data measured with the electrical resistivity tomography ert during an infiltration experiment meter scale performed in only one plot transect of the study catchment the shps obtained by these two approaches are then assigned to each numerical grid cell in hgs to simulate the catchment scale soil water budget at daily time resolution within the framework of a functional evaluation we compare the performance of these two soil hydraulic parameterization approaches in terms of streamflow viewed as a lumped flux and near surface soil effective saturation patterns viewed as distributed state variables better comparisons between observed and simulated streamflow values are obtained when the study site is parameterized using the equivalent shps conversely the hgs water budget simulations using the aggregated shps are more effective when one should describe the spatial patterns of near surface soil moisture values this study highlights the pros and cons and potential flaws when choosing two different parameterization techniques in spatially distributed modeling applications keywords soil hydraulic properties scale transfer soil moisture infiltration streamflow dreamzs hydrogeosphere 1 introduction optimal management of water resources at catchment scale depends on the prediction capability of process based hydrological models the key to obtain successful simulations is to implement an optimal parameterization of the soil hydraulic behavior in the modeled flow domain a single set of soil hydraulic parameters is often calibrated and validated by comparing observed and simulated lumped water fluxes lamparter et al 2018 shiferaw et al 2018 demirel et al 2018 this parameterization practice can be effective when bucket type models are used enabling the catchment behavior to be reproduced in a spatially lumped manner nonetheless realistic distributed hydrological response of a catchment is obtained only by using spatially distributed or semi distributed hydrological models pringle et al 2007 richards equation based distributed models reproduce the spatial domain under study through a numerical grid of small sized cells roth et al 1999 therefore a detailed description of the hydrological processes highly depends on the proper assessment of spatial organization of the soil hydraulic properties shps namely the soil water retention wrf and unsaturated hydraulic conductivity hcf functions neuweiler and vogel 2007 kreye and meon 2016 field surveys and sampling campaigns usually provide sparse information on shps that then has to be generalized over the flow domain of interest and often transferred into the numerical grid of a spatially distributed hydrological model assessing soil attributes and then assigning them to each numerical grid cell is a critical step in catchment hydrology beven et al 2015 godoy et al 2018 the challenge is to obtain the highest prediction efficiency by using affordable experimental efforts or in other words the lowest model uncertainty by reducing time and costs for field measurements vereecken et al 2007 presented two main approaches to parameterize a non uniform soil domain i the forward approach and ii the inverse modeling approach the forward approach also referred to as the upscaling approach employs scaling and geostatistical methods to interpolate the known sparse point scale shps and distribute the estimates over the unsampled locations of the grid kabat et al 1997 unfortunately this approach is effective only if based on several soil samples by entailing considerable investments in terms of time and costs although laboratory experiments have the advantage of being accurate the measurement soil volume centimeter scale can lead to shps that are not well representative of the study area alternatively the inverse modeling approach retrieves the soil hydraulic properties so that the model simulations enable the observed monitored distributed hydrological behavior to be reproduced as closely as possible for specific sets of boundary conditions nasta and romano 2016 in many cases especially for larger and or ungauged catchments there is little information available on distributed state variables soil characteristics and especially lower boundary conditions and therefore the field scale or even catchment scale inverse modeling method might suffer from ill posedness by causing non uniqueness of shps beven 2006 romano and santini 1999 affordable inverse modeling approaches have been recently proposed that refer to relatively faster and cost effective plot scale experiments monitored by noninvasive electrical resistivity tomography ert e g beaujean et al 2014 and electromagnetic induction emi e g lesch et al 1995 methods or time lapse techniques e g robinson et al 2009 through a variety of increasingly complex applications e g robinson et al 2008 huang et al 2014 brogi et al 2019 often employing inversion of emi multi coil or multi frequency data huang et al 2015 shanahan et al 2015 koganti et al 2018 boaga et al 2018 based on novel inversion tools e g mester et al 2011 triantafilis et al 2013 deidda et al 2014 the aforementioned geophysical experiments are at the meter scale with much larger spatial resolution than that of the laboratory experiments for this reason many researchers assume as we did in the present study that shps retrieved from plot scale inverse modeling approaches might approximate field scale effective parameters we would conclude this brief review of methods by also mentioning that with the recent improvement of non invasive geophysical techniques and related reduction in costs and efforts with their usage these techniques are being employed increasingly to provide proxy information that correlates with soil properties of interest so as to map the spatial variations of soil attributes in a fairly efficient way to comply with the forward parameterization approach in this study undisturbed soil cores were collected near the ground surface at a number of sparse locations in a 5 hectares experimental catchment which were then subjected to laboratory experiments to determine the soil physical and hydraulic properties in contrast to perform an inverse modeling parameterization approach an infiltration experiment was carried out just at one location along a representative hillslope of this study area to inversely estimate the unsaturated soil hydraulic properties by monitoring the process through the ert technique a first problem we pose is the transfer of the information about the shps gained from either the soil cores or the ert based infiltration experiment the so called observation scale to each regularly spaced cell of the numerical grid the so called model scale implemented in hydrogeosphere hgs glaser et al 2019 hgs is a fully integrated hydrological model that solves the 3d richards equation for subsurface flow and uses the 2d and 1d diffusion wave approximations of the de saint venant equation to describe the surface and channel flow respectively therrien et al 2005 davison et al 2018 the transfer of knowledge from the physical domain to the numerical domain can be viewed as upscaling from the observation scale to the model scale and in the present paper was carried out by the following two different parameterization procedures 1 by using a similar media scaling method which is commonly used in soil hydrology to reconstruct the soil hydraulic behavior over a study area from sparse soil core sampling 2 by an inverse modeling approach that uses the ert dataset gathered during the in situ infiltration experiment that was performed in a single location of the study area given the above considerations we posit the following the soil hydraulic parametric functions obtained by the scaling method are here defined as aggregated shps from the knowledge of conversion factors i e the so called scaling factors which relate the local property to the reference property we are able to describe approximately the spatial variations exhibited in the study catchment by the soil hydraulic properties and then to assign them to each cell of the model grid by using ordinary kriging which is a commonly used technique in these analyses the soil hydraulic properties obtained by inversion of the ert data measured during the in situ infiltration experiment meter scale are denoted as plot scale equivalent shps the dreamzs toolbox is used to estimate the posterior probability density functions of the soil hydraulic parameters vrugt 2016 we assume that plot scale parametric uncertainty is scale invariant and only one set of soil hydraulic parameters is randomly generated using the dreamzs output in each grid cell of the numerical grid from the above mentioned formulation of the problem it is evident that scale and scale transfer become key concepts within the framework of the present study the similar media scaling method coupled with geostatistical theory is recognized as being an appropriate and well validated tool to be used when the soil hydraulic properties are estimated from experiments carried out in the laboratory on relatively small soil cores these soil properties aggregated properties will be spatially interpolated at unsampled locations hopmans et al 2002a on the other hand in the case of the field infiltration experiment the scale of the observations is closer to the scale of the grid cells and it is our belief that the inverse modeling approach coupled with a stochastic simulation is an effective tool to simulate a set of equivalent soil hydraulic properties at the model scale hopmans et al 2002b a major goal of our study is to compare the outcomes of these two techniques not only in terms of the estimated parametric hydraulic curves but also and more importantly from certain viewpoints by performing functional evaluations to ascertain the advantages and limitations of the two aforementioned approaches for characterizing the spatial variability of shps the objective of the present study is twofold a to compare the scaling based aggregated and the inversion based equivalent soil hydraulic properties and b to assess the effectiveness of these two approaches in modeling distributed hydrological behavior through a functional evaluation approach when estimating spatially lumped or distributed hydrologic response at the scale of a small catchment 2 experimental works and methods 2 1 study site and measurements the research investigations were carried out in an experimental catchment denoted as mfc1 located near the village of monteforte cilento in southern italy romano et al 2018 the mfc1 has a drainage area of approximately 5 0 hectares and belongs to the upper alento river catchment nasta et al 2013b 2017 fig 1 illustrates the soil sampling points the positions where the soil water contents were measured by the tdr and the experimental plot where the infiltration experiment was carried out in this figure there are also the positions of the weather station and the streamflow measurement device streamflow q m3 s 1 was monitored from april 2006 by using a capacitance probe odyssey dataflow systems ltd new zealand to measure the water level of the stream flowing through a 90 v notch weir positioned at the catchment outlet an automatic weather station has been operational since 2006 to record rainfall r air temperature and humidity wind speed and direction and net solar radiation with a four component sensor a portable time domain reflectometry tdr device tdr100 campbell scientific inc usa with a 3 rod probe 15 cm in rod length manufactured at the laboratory of soil hydrology of the university of napoli federico ii was used to measure near surface soil moisture θ in cm3 cm 3 on a regular square grid 25 m 25 m see fig 1 of 94 measuring points over 13 sampling campaigns from september 1st 2006 to april 24th 2008 nasta et al 2018a sometimes we were not able to fulfill all 94 soil moisture measurements 01 sep 2006 22 sep 06 11 may 2007 and 09 jul 2009 because either the land owners denied access in the fields during tillage operations or the tdr signal was rather poor during relatively drier weather conditions table 1 lists the descriptive statistics relevant to all 13 sampling campaigns it is worth noting that during seasonal transition periods i e from dry to wet or from wet to dry season as well as during the wet seasons the presence of a negative value for skewness highlights drier than average soil moisture values that can alter a typical unimodal distribution of these data nasta et al 2018b the lilliefors tests suggest that normality should be rejected at a 0 05 level of significance for three distributions out of thirteen belonging to the seasonal transition phases disturbed soil samples and undisturbed soil cores steel cylinder of 7 2 cm inner diameter 7 0 cm height hence 285 cm3 core volume were collected near the soil surface vertical sampling at soil depth of 10 17 cm in 44 points open circles of the sampling grid and transported to the laboratory to determine particle size distribution soil texture oven dry soil bulk density ρb in g cm 3 saturated soil water content θs in cm3 cm 3 and saturated soil hydraulic conductivity ks in cm d 1 for each soil core soil water retention data pairs soil water content and matric pressure head denoted by the symbols θ in cm3 cm 3 and h in cm respectively were measured by using suction tables romano et al 2002 and pressure plates bittelli and flury 2009 the measured h θ data pairs were fitted to the parametric water retention function wrf proposed by van genuchten 1980 1 s e h θ h θ r θ s θ r 1 α h n m from which the relative hydraulic conductivity kr function hcf can be estimated from the measured saturated hydraulic conductivity ks through the following relation 2 k r s e k s e k s s e l 1 1 s e 1 m m 2 where θs and θr are the saturated and residual volumetric soil water contents respectively α cm 1 n and m 1 1 n are the shape parameters of wrf and l is the pore connectivity parameter of hcf assumed here to be equal to 0 5 soil effective saturation se varies between 0 when θ θr and 1 when θ θs table 2 lists the statistics for all measured soil physical characteristics and the estimated soil hydraulic parameters soil texture in mfc1 spans from clay to silty clay loam classes and the spatial variability as expressed by the coefficient of variation cv in percent is very high for residual water content and saturated hydraulic conductivity two pits were excavated for sampling soil cores along the soil profile see the locations depicted in fig 1 to determine the soil physical and hydraulic properties at selected soil depths see table 3 we observe an increase in the clay content values and a decrease in ks values in the deepest soil layers of the soil profile in november 2014 an infiltration experiment was performed within a 1 1 m wooden box the position was chosen such that soil texture and bulk density parameters were as close as possible to the spatial average values table 2 about 600 l corresponding approximately to 0 6 m3 of water were poured into the box by imposing a water head of approximately 15 cm the experiment lasted 4 5 h in this paper we focus on the monitoring results from ert that is a geo electrical method based on current injection and voltage measurements it exploits the capabilities of modern instruments and computational power to produce tomographic images starting from a large number of quadripole measurements binley and kemna 2005 the ert method when data are acquired in a time lapse mode is particularly effective to monitor changes in soil moisture using a variety of configurations from surface to cross borehole geometries and from meter to decimeter scales e g daily et al 1992 binley et al 2002 singha and gorelick 2005 deiana et al 2008 cassiani et al 2009 koch et al 2009 wallin et al 2013 meyerhoff et al 2014 therefore ert is one of the most commonly used methods in hydro geophysical applications see e g binley et al 2010 for an overview with a recent increase in high resolution soil monitoring including studies on the effects of root water uptake e g garré et al 2011 boaga et al 2014 vanella et al 2018 noninvasive ert data were acquired both along a surface line and using a 3d setup similar to those employed for small scale root water uptake monitoring e g cassiani et al 2015 2016 the latter data provide small scale information about infiltration patterns but this is not fully relevant to the present study where we focus on the intermediate scale processes indicatively above 1 m in length therefore in the following we will present use and discuss only the results of surface ert acquisitions the latter were performed using a 48 electrode line with electrode spacing equal to 0 3 m for a total length of 14 1 m the resulting depth of investigation is in the 3 m range the conversion of resistivity values to soil moisture content or soil effective saturation is usually performed by using constitutive relationships e g archie 1942 waxman and smits 1968 that need to be calibrated via laboratory or in situ experiments e g monego et al 2010 the acquisition scheme was a skip zero dipole dipole configuration i e a configuration where the electrodes of both current and potential dipoles have the minimum possible distance this set up ensures maximal spatial resolution provided that the signal to noise ratio is high enough the time for current injection was set to 250 ms with total number of cycles per measurement equal to 3 to 6 depending on the repeatability check the data quality was assessed by acquiring both direct and reciprocal measurements the principle of reciprocity for example see parasnis 1988 or binley et al 1995 ensures that the current and potential electrodes can theoretically be interchanged without affecting the measured resistance provided that linearity is honored i e ohm s law is valid however real data show discrepancies between direct and reciprocal measurements often due to current injection difficulties because of poor electrode contacts therefore the reciprocity error is a good measurement of data accuracy a total of roughly 2100 measurements were collected during each ert acquisition using a syscal pro72 resistivimeter iris instruments a reciprocal error threshold of 5 was used for all acquisitions and the same error level was used in the occam approach implemented in the ert inversion code profiler binley 2018 the ert line location is shown in fig 1 red dashed line it is important to mention that the ert line was not centered around the infiltration plot but elongated downhill in order to capture the patterns of soil water flow along the hillslope see the dashed line of the ert electrode line in fig 1 as this appears to be very limited in the presentation and analysis of results we will focus on the portion of the ert line centered on the infiltration box measurements of electrical resistivity were acquired at time 0 initial condition and after 2 h 2 5 h 3 5 and 4 5 h the conversion of bulk electrical resistivity as measured by ert into estimated soil effective saturation relies on archie s law archie 1942 3 ρ a ε b s e c ρ w where ρ is the bulk electrical resistivity e g as measured by ert ρw is the electrical resistivity of the pore water ε is porosity whereas a b and c are material parameters to be calibrated on a case by case basis we conducted laboratory calibration of archie s law parameters using soil samples taken from the infiltration area the estimated values of the parameters featuring in eq 3 are the following a 0 43 b 1 43 and c 0 91 note that archie s law is particularly effective when se changes have to be estimated from knowledge of electrical resistivity changes over time and under the reasonable assumption that pore water resistivity does not change over short lapses of time in the present study water was taken from a local source in the same mountain region with moderate electrical conductivity 4 s e 1 s e 2 ρ 1 ρ 2 1 c where the subscripts 1 and 2 refer to different time lapses once soil effective saturation is estimated at the initial time via laboratory porosity measurement and in situ soil water content tdr determinations the changes are directly derived from time lapse ert 2 2 comparison between ert and scaling based approaches the schematic representation depicted in fig 2 illustrates the various steps established to compare the two approaches employed to characterize the spatial variability of shps in the study catchment the two parameterization approaches will be evaluated by comparing simulated and observed streamflow and near surface soil moisture patterns converted in soil effective saturation values the approach based on the in situ infiltration experiment has been already described above in sub section 2 1 the ert method is used for monitoring soil effective saturation along the soil profile during the infiltration process this information is exploited to estimate the equivalent shps through the inverse modeling of the numerical infiltration process by combining hydrogeosphere hgs model therrien et al 2005 with the differential evolution adaptive metropolis algorithm dreamzs coupled to the efficient markov chain monte carlo sampling scheme vrugt 2016 the optimization routine sets the objective function of for minimizing the discrepancy between observed and simulated soil effective saturation values the setup of the forward simulation of the infiltration experiment in hgs is based on the 2 d grid slice with 8 m length with 20 rectangles in the x direction and 1 m length in the y direction with one single rectangle the 3 d mesh replicates the 2d slice along 3 m depth in the z direction discretized in 30 rectangles boundary conditions are set to no flux throughout the soil domain except the 1 m 1 m block on soil surface corresponding to the area delimited by the wooden box this part of the grid is subjected to constant pressure head of 15 cm initial conditions mimic as close as possible the initial t 0 h 2 d image of soil effective saturation retrieved by the ert method even though we recall that discrepancies between observed and simulated soil effective saturation values are evaluated only within the wetting zone of the virtual soil profile below vertical movement of water and around radial movement of water the location of the wooden box the duration of the forward simulation is 4 5 h and five images of the soil profile are stored to retrieve the simulated soil effective saturation corresponding to the observed snapshots the ert based parameterization of the numerical grid is graphically illustrated in fig 3 within a bayesian framework dreamzs provides the posterior probability density functions pdf of the optimized ert based shps intertwined by a covariance matrix under these circumstances we assume marginal posterior pdfs of the optimized soil hydraulic parameters as the parametric uncertainty of the plot scale equivalent shps the assumption here is that the equivalent shps obtained by a meter scale field experiment do not vary in space and are representative for the entire sub catchment this is a sort of fully lumped position that is justified by the relatively high burden associated with an in situ experiment monitored by an ert technique the other approach is based on soil sampling and subsequent determination of sparse 44 soil water retention and hydraulic conductivity functions fig 4 this approach generates aggregated shps through the similar media scaling method proposed by clausnitzer et al 1992 by assuming the validity of microscopic geometric similarity among soils miller and miller 1956 sadeghi et al 2016 pachepsky and hill 2017 sparse point scale measured soil hydraulic functions coalesce into a single set of aggregated shps also termed reference wrf and reference hcf through a set of scaling factors δ which are commonly distributed according to a log normal probability density function nasta et al 2013a the spatial variation of the soil hydraulic properties is described by the scaling method through the reference spatial average soil water retention h θ and hydraulic conductivity k θ functions and the set of scaling factors δ for each ith sampling location the reference wrf and hcf refer to the homogeneous soil domain while the scaling factors represent the spatial variability of the heterogeneous spatial domain in this study we used a single set of scaling factors derived from the soil water retention function only however we caution the readers that scaling outcomes might falsify the basic hypothesis of microscopic geometric similarity following the procedure described in clausnitzer et al 1992 the relations linking the scaling factors to the reference wrf and hcf are defined as follows 5 h i s e h s e δ i and 6 k i s e δ i 2 k s e the aggregated shps of the homogeneous soil together with the scaling factors δi of each grid block are determined by assuming that θ s and ln k s are equal to the respective mean values of θ s i and ln k s i the remaining parameters of the reference wrf and scaling factors δi of each sampling location are obtained through the optimization criterion corresponding to case a of clausnitzer et al 1992 the main advantage of this relationship is that new scaling factors are able to generate shps to be assigned to the cells of the numerical grid the new scaling factors can be either stochastically generated nasta et al 2013b or interpolated by using geostatistical methods hengl et al 2004 in this study we used ordinary kriging to generate a map of scaling factors at mfc1 goovaerts 2001 we remind that kriging is an optimal estimator but is able to generate only one map of a soil attribute and provides a sort of incomplete measure of local accuracy to perform a functional evaluation of the two above described approaches the shps were used to parameterize the hydrogeosphere hgs model to determine the daily water budget of the mfc1 cornelissen et al 2014 fang et al 2015 the evaluation is carried out by comparing simulated and observed streamflow lumped hydrologic information and near surface soil moisture patterns distributed hydrologic information pokhrel et al 2011 noh et al 2015 the spatial domain of mfc1 is discretized with uniform grid blocks the 2 d grid slice is 400 m length with 86 rectangles in the x direction and 240 m length with 52 rectangles in the y direction obtaining a total 4472 grid cells size 4 6 m 4 6 m the 3 d mesh is generated by defining the elevation through a 5 m digital elevation model the flow domain in the vertical direction is divided into 30 rectangles based also on visual inspection of the pedological layering of the soil profile and on the information retrieved from the two pedological pits table 3 we functionally split the entire soil depth of the catchment into a horizontally heterogeneous top layer of 0 60 m thickness and a horizontally homogeneous bottom layer below the soil depth of 0 60 m therefore shps are assigned to a 3d grid block size of 4 6 m 4 6 m 0 60 m whereas the bottom layer is characterized by a single set of shps obtained as an average of the soil hydraulic properties determined below the soil depth of 0 60 m for comparison between simulated and observed soil moisture values we assume that the meter scale grid cell volume can be roughly compared to the sub meter scale soil volume in which local tdr measurements take place romano 2014 hgs couples the surface and variably saturated subsurface water flow regimes with interactions the coupling length coefficient regulates the exchange of flow between surface and subsurface domains daily values of measured rainfall r and estimated allen et al 1998 reference potential evapotranspiration et0 are set as the upper boundary condition while no flux is set as lower and lateral boundary conditions this hypothesis is formulated by considering the quasi impermeable clayey layer at approximately 3 0 m depth and the presence of a road drainage system almost entirely surrounding mfc1 nasta et al 2013b during the dry season we observed dry patterns of soil moisture see table 1 and absence of overland flow in other words infiltration generated by even large episodic rainfall events was depleted by high evapotranspiration demand in summer nasta et al 2018a runoff occurred when soil moisture storage started replenishment during the dry to wet transition period i e moving from summer to fall season with the concurrent increase in the water levels recorded in four stone cased wells at mfc1 romano et al 2018 during winter and under conditions of fully saturated soil in most parts of the study area we observed that the groundwater levels reached the soil surface and consequently moderate to high runoff rates were generated during the subsequent wet to dry transition period i e moving from winter to spring season soil moisture storage capacity decreased rapidly with a concurrent lowering of water levels in the stony wells based on this behavior of the study area the saturation excess overland flow dunne overland flow was definitely assumed to be the dominant runoff generation mechanism consequently and also in order to reduce somehow the computational efforts the use of a daily resolution rainfall seemed appropriate for our modeling purposes hearman and hinz 2007 specifically addressed the issue of the possible effects that rainfall resolution exerts on surface runoff predictions by a conceptual bucket model and among other things argued that largest uncertainties in surface runoff prediction should be expected when this process is dominated by the infiltration excess mechanism hortonian overland flow within a study about preferential flow predictions at catchment scale glaser et al 2019 also dealt with this question and concluded that the use of a daily temporal resolution for their input data did not impact too much on catchment runoff predictions in general particular attention should be paid to checking how runoff generates in a catchment before starting a computer modeling simulation since especially under mediterranean climate conditions and for certain soil types the hortonian overland flow can be instead the most important runoff generation mechanism that would require rainfall data at hourly or even at sub hourly time resolution the critical depth boundary condition of hgs is assigned to the node at the outlet of the catchment to generate the simulated streamflow the numerical simulation starts on 1st january 2006 with hydraulic equilibrium and ends on 24th april 2008 last soil moisture sampling campaign the time period spanning from 1st january 2006 to 31st august 2006 represents a warm up time whereas the time interval from 1st september to 24th april 2008 represents the validation range same as the soil moisture measurements campaign we recall that the validation range for streamflow is shorter from 1st january 2007 to 24th april 2008 due to sensor malfunctioning 3 results results are organized by following the schematic overview of fig 2 first equivalent and aggregated shps are presented in section 3 1 as retrieved from the ert based and scaling based approaches respectively section 3 2 then provides the parametric comparisons while section 3 3 deals with the functional evaluation by comparing observed and simulated monthly time series of streamflow and near surface soil effective saturation patterns taken in the 13 sampling days 3 1 ert based and scaling based approaches the ert based shps are retrieved from the infiltration experiment described in section 2 1 the calibration results fig 5 illustrate the difference between the observed left panel and simulated right panel soil effective saturation data along the soil profile during the infiltration process the y axis is stretched to better show the vertical variation of soil effective saturation table 4 reports the most probable ert based shps and their uncertainty bands with the average and standard deviation values in parenthesis of parametric posterior density distributions the discrepancy between observed and predicted soil effective saturation values is expressed through the root mean squared deviation rmsd we observe a general agreement between the left and right panels despite the relatively high rmsd of 21 note that the ert results fairly reflect the actual soil heterogeneities as captured by the inversion procedure employed in this study nonetheless the numerical simulation reproduces very similar wetting fronts advancing downward along a vertical distance of about 80 cm the scaling based shps are obtained by using the 44 soil samples the spatial variability of aggregated shps is expressed by the descriptive statistics reported in table 4 scaling based saturated water content θs residual water content θr and saturated hydraulic conductivity expressed in decimal logarithm scale log10 ks refer to spatial average values whereas water retention shape parameters log10 α and n pertain to the reference wrf the spatial variability of wrfs is quantified by applying eq 5 where the scaling factors lnδ refer to each known sampling position the scaling factors are log normally distributed with zero mean and standard deviation σ equal to 0 21 table 4 we observe that the spatial variability of the soil water retention characteristic as depicted by the standard deviation of scaling factors is significantly lower than that of the hydraulic conductivity in other words the scaling factors retrieved from the soil water retention function only fail to fully describe the spatial variability of the hydraulic conductivity function this drawback may have negative repercussion when simulating soil water flow processes warrick et al 1977 the scaling factors were interpolated in the spatial domain by using ordinary kriging the map of scaling factors is shown in fig 6 therefore the interpolated scaling factors and the reference shps generate new shps in the cells of the numerical grid green denotes the zero mean of the scaling factors indicating that the wrfs are quite close to the reference wrf conversely blue and red denote under and over estimations respectively compared to the reference wrf underestimations might be related to tillage free zones with a high degree of soil compaction 3 2 parametric evaluation of the two approaches the shps pertaining to the two approaches are presented in fig 7 the plots on the left show the wrfs fig 7a and c whereas the plots on the right show the hcfs fig 7b and d with the bold lines depicting the shps relative to the homogeneous domain and colored bands representing the spatial variability of the heterogeneous spatial domain the upper plots show the shps in relative terms namely se h and kr h whereas the bottom plots show the reference shps in absolute terms namely θ h and k h we remind that the spatial variability of shps is described by a single set of scaling factors for both wrf and hcf green bands the water retention functions wrfs estimated by the two approaches show notable differences the equivalent wrf has the typical shape of a poorly structured soil shape parameter n 1 79 instead the aggregated wrf shows rather the typical pattern of a well graded porous medium shape parameter n 1 13 since the spatial average saturated water contents are quite similar for the two approaches see table 4 the observed discrepancy between the two wrfs should not be attributed to differences in attaining the full saturation condition rather the soil of the study catchment has a relatively high clay content see table 2 and hence the ert based equivalent wrf might have been affected by hydraulic nonequilibrium during the transient infiltration experiment weller and vogel 2012 hannes et al 2016 tzavaras et al 2017 instead the soil cores laid on the suction tables released water during steps of hydrostatic drainage equilibria romano et al 2002 and no phenomena of hydraulic nonequilibrium are expected for these types of laboratory tests moreover it is also important to mention the fact that the aggregated wrfs benefit from retention data points measured in the dry range using the pressure plate apparatus namely at 3000 cm 6000 cm and 12 000 cm pressure head allowances should also be made for the different measurement resolution between the two methods mertens et al 2005 soil cores provide centimeter scale measurements of the main drying soil water retention curve while the ert based infiltration is a wetting process under highly transient conditions in the meter scale range the spatial resolution of the second approach should better describe the soil structure this allows to properly capture the aggregation of soil pores and water retention dynamics induced by swelling and shrinkage wetting and drying and tillage operations herbrich and gerke 2017 the observed discrepancies between the two hydraulic conductivity functions hcfs shown in fig 7b and d result mainly from the difference in the values of the water retention shape parameters to conclude the discussion about the observed differences in the parametric comparisons between the aggregated and equivalent shps we believe that the primary reasons for the pronounced offset between the two sets of shps should be attributed to the different information content of input data obtained when performing the two different experiments as well as to some dynamic nonequilibrium effects likely occurring during the in situ infiltration test such as those discussed by diamantopoulos and durner 2012 what is now interesting is to examine how these discrepancies can affect the outcomes of a hydrological model through a functional evaluation approach this aspect will be presented and discussed in the next section 3 3 functional evaluation of the two approaches the performance metrics for the functional analysis is based on the statistical indices described below the nash sutcliffe efficiency nse index nash and sutcliffe 1970 is used as the main goodness of fit metric and represents the complement to unity of the ratio between the mean square error of observed against predicted values and the variance of the observations the index is quantified as follows 7 n s e 1 i 1 n o i p i 2 i 1 n o i o i 2 where oi and pi represent observed and model simulated variables respectively n is the total number of available measurements i 1 2 n and o is the mean of the observed values the nse spans from null fit to 1 perfect fit nse 0 suggests that the mean of the observed values is a better predictor than the evaluated model itself ritter and muñoz carpena 2013 introduced the nt index expressing the number of times the standard deviation sd of observations is greater than the rmsd the nt index is obtained as follows 8 n t s d r m s d 1 model efficiency can be established according to the values of nt and nse four model efficiency classes unsatisfactory acceptable good and very good are reported in table 1 in ritter and muñoz carpena 2013 minimum values for very good model performance should be equal to 2 2 and 0 90 for nt and nse respectively finally as recently done by romano and nasta 2016 model performance can also be tested by the refined version of willmott s index of agreement d r willmott et al 2012 9 d r 1 i 1 n p i o i 2 i 1 n o i o w h e n i 1 n p i o i 2 i 1 n o i o 2 i 1 n o i o i 1 n p i o i 1 w h e n i 1 n p i o i 2 i 1 n o i o the dimensionless index d r 1 0 dr 1 0 expresses null and perfect fit for dr 1 and dr 1 respectively this index is particularly useful for making cross comparisons between models because it is bounded to 1 instead of on the lower limit fig 8 shows daily observed and simulated streamflow response to daily boundary forcing data in the numerical simulations both approaches satisfactorily capture the overall dynamics without specific calibration of runoff properties nonetheless it is clear that ert based shps generate runoff which is significantly higher than that generated by scaling based shps especially during the wet season from late fall to early spring this is explained by the difference in terms of water retention functions see fig 8a in which ert based wrf is characterized by a steep wetting phase whilst scaling based wrf is clay type herbrich and gerke 2017 the model performance on streamflow is calculated on untransformed and logarithmic monthly discharge sums table 5 moriasi et al 2007 in the context of the present study we are not interested in sub monthly flow dynamics without site specific calibration of parameters relating to subsurface and surface flow ert based shps provide better lumped model performance than scaling based shps yet logarithmic transformation gives more emphasis on low flows and scaling based shps notably improve their performance in this case although they remain lower than in the other approach according to the efficiency metric introduced by ritter and muñoz carpena 2013 both methods are affected by unsatisfactory results for untransformed monthly discharge sums logarithmic transformations slightly improve ert based and scaling based performance leading to good and acceptable model simulations respectively however this performance metric highlights the need to calibrate the parameters controlling surface flow in future studies as indicated by the recommendations given by stisen et al 2011 discharge is only a lumped measure of model performance and does not provide sensitivity to spatially distributed shps qu et al 2015 in this regard we test model performance by comparing the 13 tdr observed and simulated soil effective saturation patterns to do so we show the first 12 soil effective saturation maps generated by ert based fig 9 a and scaling based fig 9b shps table 6 lists the descriptive statistics and expresses the discrepancy between observed and simulated values through the rmsd and dr values the scaling based shps provide better performance than ert based shps in expressing the spatial variability of soil effective saturation recently nasta et al 2018a found that soil effective saturation patterns at mfc1 are mainly controlled by evapotranspiration the accuracy of the scaling based shps increases under drier conditions as depicted by lower values of rmsd and dr associated to low spatial average soil effective saturation s e values it is worth noting that for scaling based model predictions dr values decrease also for more negative skewness values table 6 sciuto and diekkgrüger 2010 used the kappa statistics to compare observed and simulated soil moisture patterns in the wüstebach catchment size of about 27 ha in germany and demonstrated that the resolution of the spatial discretization has a dominant impact on hgs model performance rather than the aggregation of the soil properties recently koch et al 2016 confirmed that 3d models perform well in terms of discharge but their ability to reproduce simulated soil moisture patterns depends on adequate soil spatial parameterization the ert based soil effective saturation maps show quite low values for all the 13 measurement campaigns this behavior can be mostly attributed to the typical patterns of the ert estimated wrf see plots 7a or b relevant to a typical poorly graded soil the soil effective saturation maps generated by scaling based shps provide higher performance than the ert based ones fig 10 compares the spatial average fig 10a and standard deviation fig 10b of observed and simulated soil effective saturation values and demonstrates that scaling based shps are effective at capturing the catchment behavior in contrast both spatial average and standard deviation of soil saturation values generated by ert based shps underestimate the corresponding observations the rmsd soil effective saturation values halve and if converted in terms of soil moisture scaling based rmsd are lower than rmsd obtained by nasta et al 2018a that combined a bucket model with a topography based estimator 4 conclusions in this study we critically evaluated the pros and cons of two approaches for distributing soil hydraulic properties across the numerical grid of a 3d richards based hydrological model hgs model we tested the sensitivity of the hgs model to spatial variability of shps that are derived by using either a the results of an in situ ert monitored infiltration experiment or b laboratory analysis on undisturbed soil cores the results are dramatically different in terms of both parametric and functional evaluations this study shows deficiencies related to the parameterization in hgs in terms of catchment response under prescribed forcing conditions when hgs is run by using the equivalent ert based shps lumped water fluxes such as streamflow values are acceptably predicted but state variables such as simulated near surface soil effective saturation patterns are consistently mismatched conversely aggregated shps provide good performance in terms of soil effective saturation patterns and poor results in terms of streamflow simulations the two measurement techniques differ because the ert based is affected by hydraulic nonequilibrium during transient conditions the parameterization of a numerical grid in a richards based model is a matter of debate in catchment hydrology the choice between the two approaches presented in this study might be dictated mainly by the experience and expertise of the research group but may also depend on the trade off between practical limitations of the experimental work and model efficiency requirements in regard to the scaling method it is definitely better to identify a single set of scaling factors by simultaneously optimizing water retention and hydraulic conductivity functions the scaling factors derived from the water retention function only are unable to fully capture the spatial variability of the soil hydraulic response in order to properly assess the spatial variability of the equivalent shps more ert based infiltration experiments will be run in other positions of the study area at cost of increasing experimental efforts the observational set of soil effective saturation patterns will undoubtedly be integrated and improved by installing sensor networks providing dense information on spatio temporal soil moisture dynamics across the upper alento river catchment romano et al 2018 additional sparse observations on vegetation characteristics and groundwater levels will be integrated in order to offer realistic or at least pseudo realistic numerical simulations by using high complex 3 d modeling approaches this step forward will serve to run future modeling simulations within scenario based approaches for evaluating the impact of climate and land use change on catchment scale water budget components acknowledgements the study was partly supported by the miur prin project innovative methods for water resources management under hydro climatic uncertainty scenarios grant 2010jhf437 the eu fp7 project globaqua managing the effects of multiple stressors on aquatic ecosystems under water scarcity grant number 603629 and project hydro geophysical monitoring and modelling for the earth s critical zone funded by the university of padua prot cpda147114 the authors are grateful to benedetto sica and giuseppe speranza for their assistance during the field campaigns and laboratory measurements we specifically thank benedetto sica for his work in designing and fabricating the tdr probes anonymous referees generously made valuable comments and suggestions that improved not only the general readability of our paper but also a few key points deserving clarifications supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 02 014 appendix supplementary materials image application 1 
692,this paper presents a novel coupled flow vegetation interaction model capable to resolve the flow and motion of flexible vegetation with large deflections simultaneously on a hybrid eulerian lagrangian grid the hydrodynamics model is based on a navier stokes flow solver with the volume of fluid surface capturing method in openfoam the deforming and moving vegetation are tracked through a series of lagrangian grids attached to the vegetation and embedded in the computational domain of openfoam the governing equations for the flexible vegetation motion are based on a slender rod theory and are solved by a finite element method on a vegetation following lagrangian grid the hydrodynamics and vegetation models are coupled through the vegetation induced hydrodynamic forces using a novel diffused immersed boundary method to avoid excessive fluid grid refinements around the vegetation the standard two equation k ε turbulence model is extended for vegetated flow by incorporating additional closure terms of vegetation effects the newly developed coupled flow vegetation model is validated against experiments for both individual single stem vegetation and a vegetation patch in a large scale wave flume model results of asymmetric displacement of the vegetation motion wave height decay and wave kinematics within and outside the vegetation patch are in good agreement with measurements the drastical change in wave radiation stress by the presence of vegetation patch leads to a strong current jet near the top of vegetation patch which in turn drives a local circulation pattern around the vegetation patch the effect of vegetation bending stiffness on the model results and empirical drag and inertia coefficients for calculating the hydrodynamic forces are examined in detail maximum turbulence energy is observed close to the bed and the top of vegetation patch just before and after the wave crest trough where the relative flow velocity to vegetation is large keywords flexible vegetation rans vof finite element method immersed boundary method fluid structure interaction openfoam 1 introduction coastal vegetation such as seagrasses salt marshes kelp forests and mangroves provide a wide range of ecosystem services they play a key role in the resilience of estuarine ecosystem to severe storms by reducing currents damping waves stabilizing seabed providing habitats and improving water quality nepf 2012 guannel et al 2015 novel coupled flow vegetation models complement laboratory studies to provide insights into the complex interactions between waves currents turbulent flow vegetation and sediment and particulate transport abdolahpour et al 2018 beudin et al 2017 fundamental understandings of the small scale processes thus obtained may be used for empirical parametrizations of these processes required in large scale model applications to field conditions e g suzuki et al 2012 marsooli et al 2016 as one of the core coastal protection services provided by the vegetation attenuation of wave height has received renewed interests in light of climate change and sea level rise the presence of vegetation dissipates the wave energy by doing work against the fluid motion and generating turbulence in the stem scale wakes and canopy scale vortices nepf 2012 at the scale of vegetation stem the rate of energy dissipation is dependent on the relative motion between fluid and vegetation the drag coefficient is mainly a function of vegetation geometry and flow conditions henry et al 2015 at canopy scale the rate of energy dissipation also depends on the population density and interaction among vegetation and canopy scale vortices at the interface of vegetated and non vegetated regions thus the bulk drag coefficient is affected by these processes not necessarily equal to the drag coefficient for individual vegetation mattis et al 2015 in the past decade much laboratory studies have been dedicated to quantifying the wave dissipation by rigid and flexible vegetation lowe et al 2005 augustin et al 2009 stratigaki et al 2011 manca et al 2012 koftis et al 2013 ozeren et al 2013 anderson and smith 2014 wu and cox 2015 paul et al 2016 luhar et al 2017 the impact of current on wave dissipation was also recently examined paul et al 2012 hu et al 2014 henry et al 2015 maza et al 2015b the bulk drag coefficient is calibrated using the analytical theory based on energy flux conservation dalrymple et al 1984 mendez and losada 2004 losada et al 2016 or momentum conservation asano et al 1992 kobayashi et al 1993 mendez et al 1999 a number of empirical formulations have been proposed for the bulk drag coefficient as a function of reynolds number or keulegan carpenter kc number see henry et al 2015 for a comprehensive review significant variations exist in the length and velocity scales and formulations for drag force calculation the calibration of bulk drag coefficient may also need to account for the heterogeneous distribution of vegetation augustin et al 2009 blackmar et al 2013 maza et al 2015a wu et al 2016 a few field measurements have been conducted to study the wave dissipation by kelp forests gaylord et al 2003 seagrass meadow bradley and houser 2009 and salt marsh vegetation jadhav et al 2013 riffe et al 2011 although almost all vegetation exhibits certain degree of flexibility and rigid vegetation is scarce in the real world majority numerical models incorporate the vegetation effect using the morison equation morison et al 1950 and treat the vegetation as vertically rigid cylinders chakrabarti et al 2016 chen et al 2019 li and yan 2007 li and zhang 2010 ma et al 2013 marsooli and wu 2014 tang et al 2015 wu et al 2016 however it is well recognized that vegetation flexibility decreases wave dissipation by allowing the vegetation to move with the flow and thereby reducing the relative velocity between flow and vegetation mullarney and henderson 2010 riffe et al 2011 houser et al 2015 rupprecht et al 2015 a number of numerical studies account for vegetation flexibility by solving a force balance equation for the vegetation motion which includes buoyancy damping bending stiffness and gravity as restoring forces and drag and inertia as driving forces ikeda et al 2001 maza et al 2013 zhu and chen 2015 ikeda et al 2001 solved for the tip displacement of the vegetation stem by assuming an exponential velocity profile and deflection along the stem while maza et al 2013 assumed a linear variation of deflection and obtained the velocity field directly by a navier stokes flow solver mullarney and henderson 2010 derived an analytical relationship between single stem vegetation and wave motion using the euler bernoulli beam equation for a cantilever beam with constant and tapered diameters the fluid drag force is linearized and balanced by the elastic restoring force due to bending neglecting the buoyancy and inertia forces zhu and chen 2015 solved the complete force balance equation with a finite element method fem and coupled the vegetation model with a non hydrostatic phase resolving wave model nhwave ma et al 2012 these vegetation models are however only suitable for small deflections for highly flexible vegetation with large deflections a number of numerical models have been developed to determine the vegetation deflections in the presence of steady currents and the current profile changes due to the vegetation abdelrhman 2007 dijkstra and uittenbogaard 2010 li and xie 2011 luhar and nepf 2011 kubrak et al 2012 marjoribanks et al 2014 mattis et al 2015 relatively few models examined the vegetation deflections in the presence of waves luhar and nepf 2016 zeller et al 2014 two approaches are adopted to tackle the geometrically nonlinear large vegetation displacement problem the first approach starts with the euler bernoulli equation in a coordinate along the length of the vegetation li and xie 2011 mattis et al 2015 2019 or by including a higher order curvature term kubrak et al 2012 the other approach divides the vegetation into a number of finite length segments and obtains the governing equation from a local force balance for each segment abdelrhman 2007 dijkstra and uittenbogaard 2010 luhar and nepf 2011 marjoribanks et al 2014 the latter approach is designated as the n pendula model in marjoribanks et al 2014 and differs from the first approach that is based on a global differential equation for the vegetation deflection the n pendula model was recently applied to study the flexible vegetation motion subject to waves only luhar and nepf 2016 and waves plus currents zeller et al 2014 another component of a coupled wave vegetation interaction model is wave hydrodynamics model augustin et al 2009 and blackmar et al 2013 applied a boussinesq equation based wave model to calibrate the vegetation enhanced bottom friction factor majority of other wave models however use the morison type drag formulation to represent the vegetation damping as a function of vegetation density and stem width and height examples include the mild slope equation wave model tang et al 2015 and the nearshore spectral wave model swan suzuki et al 2012 beudin et al 2017 suzuki et al 2012 implemented a multilayer schematization to account for the vertical variation of different vegetation species in swan chen et al 2019 applied a non hydrostatic wave flow model swash simulating waves till shore zijlema et al 2011 and identified a strong negative wave driven current jet at the bottom of a suspended canopy in the opposite direction of the wave for flexible vegetation the drag force may be reduced due to the reduced frontal area since the vegetation will be deflected as a result of flow induced bending this drag reduction was incorporated by beudin et al 2017 using the concept of effective blade length proposed by luhar and nepf 2011 the same concept has been used by losada et al 2016 to derive the drag formulations in the presence of waves and currents compared with the wave models mentioned above navier stokes equations based wave hydrodynamics models provide more detailed flow features in the presence of vegetation the vegetation alters the flow field and generates turbulence around the vegetation stems the turbulent interactions between waves and vegetation can be examined by solving the reynolds averaged navier stokes rans equations along with a turbulence closure model e g chen et al 2019 li and yan 2007 li and zhang 2010 ma et al 2013 zhu and chen 2015 the vegetation induced resisting force and turbulence can be incorporated as an additional source term in the momentum and turbulent energy transport equations the rans flow solver coupled with a volume of fluid vof surface capturing method is capable to resolve the process of wave breaking chakrabarti et al 2016 maza et al 2013 2015a marsooli and wu 2014 the objective of this paper is to construct a two way coupled wave vegetation interaction model for flexible vegetation with large deflections which is ubiquitous in the nearshore environment the wave hydrodynamics model is based on a rans vof flow solver with realistic wave generation and absorption components higuera et al 2013 the flexible vegetation model is based on an elastic rod theory with a complete force balance equation solved by finite element method fem garrett 1982 chen et al 2011a b the fem based vegetation model is applicable to flexible vegetation with large deflections and is inherently robust in incorporating spatial variations of geometric and mechanical properties of the vegetation augustin et al 2009 feagin et al 2011 rupprecht et al 2015 wu et al 2016 the hydrodynamics and vegetation models are coupled through the vegetation induced hydrodynamic forces calculated by the morison equation morison et al 1950 the drag and inertia forces are included as source terms in the momentum equation of the rans vof flow model and drive the vegetation model at the same time the flow velocity and acceleration input for the vegetation model are obtained from the rans vof flow model instead of the experiments as in zeller et al 2014 and luhar and nepf 2016 the standard two equation k ε turbulence model launder and spalding 1974 is modified to include the effect of vegetation following lopez and garcia 2001 the present model couples the flow and vegetation motion using an immersed boundary approach peskin 2002 mattis et al 2015 instead of porous media approach e g maza et al 2013 2015a zhu and chen 2015 two sets of grids are used in the coupled flow vegetation model the flow motion is solved in the eulerian grid while the vegetation motion is solved in the lagrangian grid applying the hybrid eulerian lagrangian grid to wave vegetation interaction is one of the novelties of this paper the governing equations of vegetation motion used a coordinate system conformed to the deformation of the vegetation which is robust to resolve structural dynamics in the presence of large deformation the rest of the paper is structured as follows section 2 presents the four components of the coupled wave vegetation model 1 the rans vof wave model 2 the finite element model of flexible vegetation 3 the k ε turbulence model modified to account for the effect of vegetation on turbulence and 4 the coupling procedure between the flow and vegetation motion using the immersed boundary method in section 3 the flexible vegetation model is first validated against a largely deflected cantilever beam the coupled wave vegetation model is then validated against single stem vegetation subject to wave motion the modified turbulence model for vegetation flow is validated against vegetated open channel flows in section 4 the coupled wave vegetation model is applied to a vegetation patch in a large scale flume experiment the vegetation motion wave height decay wave kinematics circulation pattern and turbulence within and outside the vegetation patch and the effect of vegetation flexibility are examined conclusions and discussions are summarized in section 5 2 model development 2 1 rans vof flow solver the reynolds averaged navier stokes solver coupled with a volume of fluid surface capturing scheme hirt and nichols 1981 has been used extensively to solve wave hydrodynamics problems with and without breaking lin and liu 1998 lara et al 2008 wang et al 2009 lv et al 2010 the rans vof model adopted by the present study is the two phase flow solver interfoam in the open source cfd toolbox openfoam which uses a collocated unstructured grid finite volume method and vof surface capturing method jasak 1996 rusche 2002 weller 2002 the model solves the pressure and velocity fields from the continuity and momentum equations for an incompressible fluid 1 u 0 2 ρ u t ρ u μ e f f u p g x ρ u μ e f f f hd and the volume of fluid vof field from the advection equation 3 α t u α u r α 1 α 0 where u is the velocity vector ρ the fluid density p p ρg x the pseudo dynamic pressure g the acceleration due to gravity x the position vector and μ e f f μ ρ υ t is the effective dynamic viscosity which takes into account of the molecular dynamic viscosity μ and the turbulent eddy viscosity υ t α is the vof indicator to mark the location of the air water interface note that in eq 3 an extra convective term u r α 1 α is added to the classic vof advection equation to limit the smearing of the interface weller 2002 the last term in eq 2 f hd represents the hydrodynamic forces exerted on the flow by the vegetation which will be described in the following sections to adapt the openfoam solver for coastal engineering applications higuera et al 2013 developed active wave generation and absorption boundary conditions in the present study we use this extended solver ihfoam as the wave model 2 2 elastic rod model for flexible vegetation we treat the flexible vegetation as a slender elastic rod in a 3d cartesian coordinate system as shown in fig 1 b the centerline of the rod in deformed state can be expressed by a position vector r s t which is a function of arc length s measured along the centerline curve and time t assuming that there is no torque or twisting moment one can derive a linear momentum conservation equation with respect to the position vector garrett 1982 4 2 s 2 e i 2 r s 2 s λ r s q m v 2 r t 2 5 1 2 r s r s 1 λ e a where ei is the bending stiffness of the vegetation stem mv the vegetation mass per unit length λ te eiκ2 with te being local effective tension and κ r rod curvature and q is the external distributed load on unit length of rod eq 5 states that the rod is elastic and extensible where ea is the axial stiffness the vegetation stem the scalar variable λ can be considered as a lagrangian multiplier eqs 4 and 5 combined with initial and boundary conditions are sufficient to determine the dependent variables r s t and λ s t in coastal and nearshore environments where vegetation abounds the applied force on the vegetation stem q w f hs f hd consists of gravity force w hydrostatic force f hs and hydrodynamic force f hd from the surrounding fluid while the hydrostatic buoyancy force is incorporated into the effective tension following paulling and webster 1986 the hydrodynamic force is calculated using morison equation and is decomposed into 3 components drag force f d inertia force f i and added mass morison et al 1950 6 f hd 0 5 ρ c d b v u n r n u n r n ρ v v u ρ a v c a u n r n f d f i ρ a v c a r n 7 f d 0 5 ρ c d b v u n r n u n r n 8 f i ρ v v u ρ a v c a u n where cd ca are the drag and added mass coefficients bv av vv the width and area of the cross section and volume per unit length of the rod u u fluid velocity and acceleration and r r are the rod velocity and acceleration the superscript n in eqs 6 8 indicates the respective normal components perpendicular to the rod tangent r the normal component of fluid velocity u for example can be obtained by 9 u n u u r r nu where n i r r is the transformation matrix and i is the identity matrix the hydrodynamic force exerted by the vegetation on the flow is f hd which is to be incorporated in section 2 4 as a source term in the fluid momentum equation eq 2 the finite element method is used to discretize the governing equations of motion eqs 4 5 for an element of length l we approximate ri s t and λ s t by 10 r i s t l 1 4 a l s u i l t 11 λ s t m 1 3 p m s λ m t where al and pm are shape functions defined in terms of ξ s l 12 a 1 1 3 ξ 2 2 ξ 3 a 2 ξ 2 ξ 2 ξ 3 a 3 3 ξ 2 2 ξ 3 a 4 ξ 2 ξ 3 13 p 1 ξ 1 2 ξ 1 p 2 4 ξ 1 ξ p 3 ξ 2 ξ 1 and uil λ m are nodal variables to be solved 14 u i 1 r i 0 t u i 2 l r i 0 t u i 3 r i l t u i 4 l r i l t 15 λ 1 λ 0 t λ 2 λ l 2 t λ 3 λ l t thus the unknown variable uil are the position ri and the tangent r i at two nodes of the element the unknown variable λ m are the tension at two nodes and the midpoint of the element using galerkin s method and eqs 10 11 the equations of motion for one element may be written in matrix form as 16 m i j l k m i j l k a u j k k i j l k 1 λ n k n i j l k 2 u j k f i l 0 where mijlk is the consistent mass matrix m i j l k a the added mass matrix k i j l k 1 the stiffness matrix due to bending resistance and k n i j l k 2 is the stiffness matrix arising from the rod tension and curvature the extensibility condition may be written as 17 g m a m i l u k i u k l b m c m n λ n 0 the matrices and force vectors in eqs 16 17 are listed in appendix a as the added mass stiffness and external loads in turn are functions of the unknown variables uil λ m special numerical treatment is needed to solve the equations the newton raphson method is used for static problems such as vegetation reconfiguration under steady current good initial guess and incremental loading help to achieve fast convergence of solution for large deflections for cantilevered vegetation stems studied in this paper an unstressed initial state is appropriate initial guess to obtain a convergent solution with a single step loading in the presence of small current under strong current however it is advisable to apply the total current loading through several small load increments for the first load increment an unstressed state is appropriate initial guess to obtain a converged solution which then serves as an initial state for the next load increment with this technique the model results would converge quickly for highly flexible vegetation a mixture of implicit and explicit time differencing scheme is used for dynamic problems involving transient wave motion readers should refer to garret 1982 and ran 2000 for more details 2 3 turbulence modeling in presence of vegetation various turbulence models have been proposed to study vegetated open channel flows shimizu and tsujimoto 1994 lopez and garcia 2001 hiraoka and ohashi 2008 and wave vegetation interactions li and yan 2007 li and zhang 2010 ma et al 2013 maza et al 2013 2015a in this study the standard k ε model in openfoam is adapted to simulate turbulent flows within the vegetation canopy by incorporating two additional terms related to vegetation effects in the transport equations for turbulence energy k and dissipation rate ε the turbulence production due to the presence of vegetation is related to the drag force by 18 p v f d u n r n 0 5 ρ c d a u n r n 3 where a bvn is the vegetation density measured as frontal area per unit volume thus having a unit of length 1 and n is the number of stems per unit area note that the normal relative velocity u n r n is used to be consistent with the drag force formulation in eq 7 vegetation induced turbulence is therefore proportional to the cube of the normal flow velocity relative to the vegetation the modified k ε model including vegetation induced turbulence is given by 19 ρ k t ρ u k μ μ t σ k k p k ρ ε c k p p v 20 ρ ε t ρ u ε μ μ t σ ε ε ε k c 1 ε p k c ε p p v c 2 ε ρ ε where μ t ρν t ρc μ k 2 ε is the dynamic eddy viscosity linking the k ε model with the fluid momentum eq 2 σ k σε c 1ε c 2ε c μ are the standard closure coefficients launder and spalding 1974 and ckp c εp are the two new coefficients to be calibrated the new term in eq 19 ckppv represents the parameterization of the work of mean velocity against drag forces lopez and garcia 2001 suggested based on a theoretical argument that the two new coefficients are so related that ckp 1 0 and c εp c 2ε c 1ε ckp 1 33 2 4 coupling of vegetation motion with flow an immersed boundary approach is adopted to couple the wave hydrodynamics with the flexible vegetation motion the immersed boundary method is a robust technique to simulate the flow interaction with structures especially the moving structures zhang et al 2010 ha et al 2014 lin et al 2016 peng et al 2018 in this method the fluid model is defined in eulerian grids while the structure model is defined in lagrangian coordinates the immersed structure i e flexible vegetation is represented as a collection of one dimensional lines whose behavior r s t is determined by the external line force f hd r and the restoring mechanisms such as elastic bending the force exerted by the structure on the fluid is then integrated as a source term in the fluid momentum equation eq 2 using 21 f hd x γ f hd r δ x r d s where x is the position vector within the fluid grid δ x r is the dirac delta function and γ is the lagrangian structural grid correspondingly the force acting on the structure by the fluid can be determined using the inverse integral transform 22 f hd r ω f hd x δ x r d x where ω is the eulerian fluid domain eqs 21 and 22 ensure that the momentum of the coupled fluid structure system is conserved mattis et al 2015 in a similar manner the turbulence production due to the single stem vegetation with n 1 in eq 18 should be integrated over a region enclosing the vegetation stem 23 p v x γ p v r δ x r d s by doing so the vegetation induced turbulence will be smoothly distributed among the surrounding fluid cells in the fluid structure interaction approach eq 23 constitutes the vegetation induced source term in the turbulence transport equations eqs 19 and 20 because the structure grid does not generally coincide with the cell centers of the eulerian grid the forcing and turbulence at each lagrangian point along the vegetation is distributed over a band of neighboring fluid cells see fig 2 thus the sharp delta function is replaced by a smoother distribution function which is suitable for use on a discrete mesh mittal and iaccarino 2005 the fluid velocity in morison equation eq 6 can also be obtained through the same smoothing function the following smoothed approximation to the dirac delta function is used peskin 2002 24 δ h x 1 h 3 ϕ x 1 h ϕ x 2 h ϕ x 3 h where h is the eulerian grid size x 1 x 2 x 3 are the three components of vector x and 25 φ ς 1 4 1 cos π ς 2 f o r ς 2 0 o t h e r w i s e fig 3 illustrates the flow chart of solving the coupled wave vegetation model in which an interface module is developed to exchange information between the wave and vegetation model components at each time step of the computation the vegetation motion is solved first with the flow velocities output of the wave hydrodynamics model the velocity and acceleration at cell centers of the fluid grid are interpolated to the structure s grid point after solving the vegetation motion the hydrodynamic force at each structure s grid point is smoothly distributed to the surrounding fluid cells using eq 21 the smoothed vegetation force acts as a source term in the fluid momentum equation eq 2 of the rans vof solver then the standard step of a rans vof flow solver follows i e vof advection and piso loop coupling pressure with velocity similarly the vegetation induced turbulence production term at each structure s grid point is smoothly distributed to the surrounding fluid cells using eq 23 the smoothed turbulence production is added to the transport equations eqs 19 and 20 for the k ε turbulence model which is solved next the new flow velocities will then be used to solve the vegetation motion at the next time step 3 model validation in this section both the individual model components and the coupled wave vegetation model are validated against the available experiments since the ihfoam wave model has been validated extensively by higuera et al 2013 the fem model for flexible vegetation is validated using the measurements for a cantilever beam and single stem vegetation the modified k ε turbulence model is calibrated using one set of experiments for vegetated channel flows shimizu and tsujimoto 1994 3 1 elastic rod model we first test our vegetation model by a cantilever beam with large deflections belendez et al 2003 considered a flexible steel beam of rectangular cross section deflections of the beam were measured under a uniformly distributed load due to gravity q 0 758 n m and a concentrated load applied at the free end f 0 0 588 n the beam length is 0 4 m and the bending stiffness is ei 0 02591 nm2 in our model simulation 20 elements were used to discretize the beam starting from an unstressed state and applying the gravity and tip load within a single step the model converged with as few as 5 7 iterations for all the cases the predicted and measured deflections for 3 tip loads are shown in fig 4 and also tabulated in table 1 with all the other concentrated loads it is seen that the model predictions agree very well with the measured deflections the differences between the two sets of results are within 2 with an average value of 0 8 note that our model results are almost identical to the ansys model results by belendez et al 2003 3 2 wave interaction with single stem vegetation maza et al 2013 measured the magnitude of vegetation bending under wave action the vegetation mimics were composed of four pvc strips one pair 54 cm long and another pair 27 5 cm the pvc strips have a cross section of 1 mm thick and 1 cm wide a young s modulus e 0 9 gpa and a density ρ v 700 kg m3 since there is no binding between the four stem vegetation mimics it s difficult to predict each mimic s response to the wave action to simplify model simulation an equivalent single stem vegetation is used and some calibration is thus required to determine the geometric and mechanical properties of the equivalent vegetation stem a 50 m long and 1 2 m deep numerical flume is setup with the vegetation stem positioned at x 20 m downstream from the wavemaker at the inlet where a 10th order stream function wave theory is specified to generate the waves the fluid grid size is uniformly 0 04 m in the horizontal x direction and 0 01 m in the vertical z direction the vegetation stem is discretized by 10 equal segments for vertically standing vegetation stems the static equilibrium achieved under gravity and buoyancy without external loading is used to initialize the vegetation motion simulation the time step in the coupled flow vegetation model is solely determined by the courant number limit in the flow solver which varies between 0 003 0 006 s significantly smaller than the time step required by the vegetation structural solver no iteration is thus performed in a time step of flow solver for the vegetation motion solver the coupled wave vegetation model is run for 32 s which took about 2 h on a single intel core i5 cpu a ramping function with a buildup period of 4 s is applied to smoothly adding the loading to the vegetation which soon reaches an equilibrium state of highly periodic wave and vegetation motion fig 5 presents the predicted instantaneous configurations for the flexible vegetation over one wave period the drag coefficient for flat plates cd 1 95 luhar and nepf 2011 2016 is used the bending stiffness calibrated ei 0 006 nm2 is equivalent to that of 2 pvc strips bond together to resist the wave motion the two extreme displacements curves b d in fig 5 are in good agreement with the measurements squares by maza et al 2013 due to the asymmetry of wave kinematics and the vegetation flexibility and nonlinear interaction between wave motion and vegetation displacement the vegetation displaces more under wave crest 25 cm than under trough 17 cm however the maximum displacements do not occur exactly at the crest and trough there are certain phase lags between the instants of maximum displacement and the crest trough this finding is consistent with another set of experiment presented in maza 2015c see their fig 9 1 confirming the present model s capability to resolve the large deflections of flexible vegetation 3 3 turbulence model in the presence of rigid vegetation the extended k ε turbulence model is calibrated against a laboratory experiment of fully developed open channel flows over submerged vegetation case r31 and r32 in shimizu and tsujimoto 1994 for case r31 the water depth and depth averaged current velocity were 6 31 cm and 11 21 cm s respectively the flume bottom was covered with rigid vegetation of 10 000 stems m2 height 4 1 cm and stem diameter 0 1 cm the frontal area per unit volume is thus 0 1 cm 1 to examine the fully developed current profile a 2d numerical model is developed to mimic only a short segment of the open channel flow the computational domain is 0 1 m long and 0 11 m high and is discretized uniformly using 20 and 40 grids respectively in the horizontal and vertical directions periodic boundary conditions are specified at the inlet and outlet boundaries of this short flume which maps the model results of flow and turbulence variables at the outlet of the flume back to the inlet once the simulation is run long enough the fully developed current profile and turbulence quantities are achieved the model was run 40 s and completed within half a minute wall time which ensured that fully developed conditions were obtained we used the same drag coefficient cd 1 2 as in ma et al 2013 and marsooli et al 2016 fig 6 a shows the model data comparisons for case r31 of the vertical distributions of mean current velocity u and reynolds shear stress u w υ t u z which are normalized by the depth averaged mean current velocity u0 it is seen that the flow within the vegetation is noticeably suppressed there appears an inflection point in the velocity profile near the top of the canopy the faster flow above the vegetation and the slower flow below form a shear layer at the interface of fluid and vegetation canopy where the kelvin helmholtz kh instabilities may develop ghisalberti and nepf 2002 the reynolds stress peaks near the top of the vegetation and decays to nearly zero both downward into the canopy and upward to the free surface based on the context of exchange with surrounding water nepf and vivoni 2000 divided the submerged canopy into two zones in the longitudinal exchange zone z h 0 4 the vertical turbulent transport of momentum is negligible i e u w 0 in the vertical exchange zone z h 0 4 the vertical turbulent transport is dominant over the longitudinal exchange fig 6 indicates that good model data comparisons were achieved by using ckp 1 0 and c εp 1 28 the sensitivity of the model results to the coefficients c εp and cd was investigated in general the model results are more sensitive to c εp than to cd consistent with the findings in ma et al 2013 the c εp 1 28 produces reasonable agreements with both cases r31 and r32 in shimizu and tsujimoto 1994 and is therefore used in the following studies 4 wave interaction with a vegetation patch the coupled wave vegetation model is validated by a large scale flume experiment by stratigaki et al 2011 this experiment has been used to validate a then state of the art coupled flow vegetation model by maza et al 2013 and a wave rigid vegetation model by marsooli and wu 2014 maza et al 2013 assumed a linear deformation for the vegetation stem and coupled the vegetation motion with the flow field through a porous medium approach the present model extends their approach by 1 developing a large deformation vegetation model 2 coupling the wave motion and the vegetation motion using an immersed boundary approach based on the same set of experiment the vegetation motion wave height decay sensitivity of model results to vegetation flexibility and the flow structures outside and within the vegetation patch are investigated 4 1 model setup fig 7 shows the model setup simulating a regular wave t 3 5 s and h 0 5 m propagating through a vegetation patch the water depth is 2 4 m at the wavemaker boundary and 1 7 m at the onshore boundary and between the two sections is a 12 m long 1 17 sandy slope a 10 7 m long artificial vegetation meadow was placed over the flat sandy bottom starting at x 38 36 m from the wave paddle fig 8 shows a zoom in view of the vegetation patch in fig 7 along with the three locations at which velocity profiles outside and inside the vegetation were measured in stratigaki et al 2011 a uniform grid of 0 04 m by 0 02 m in the horizontal and vertical directions spans the entire computational domain this base mesh is then intersected with the bathymetry using the snappyhexmesh utility in openfoam the remaining sandy beach beyond the vegetation patch is ignored in the simulation which avoids resolving the computationally intensive wave breaking process in the surf zone and thus may produce a partial standing wave pattern different from the experiment see fig 10 below the fifth order stokes wave theory is specified at the wavemaker the waves propagating through the vegetation field are absorbed at outlet by using the ihfoam absorbing boundary conditions developed by higuera et al 2013 each vegetation stem is discretized using 6 elements of equal length of 0 09 m the static equilibrium achieved for each stem under gravity and buoyancy without external loading is used to initialize the vegetation patch the initial and boundary conditions for the turbulence model are specified following lin and liu 1998 the model is first run 30 s without activating the vegetation module after the wave is fully developed in the flume the vegetation module is switched on with the driving force from the wave motion smoothly ramped up within one wave period the coupled wave vegetation model is then run for another 30 s which took about 16 h on a single intel core i5 cpu the time step in the coupled model is determined by the maximum courant number of 0 3 in the flow solver no iteration is performed in a time step of flow solver for the vegetation motion solver the following results are obtained by averaging over the last 6 wave periods grid convergence study in appendix b shows that the above grid is adequate in resolving the vegetation dynamics and the wave kinematics in the presence of the vegetation patch 4 2 effects of vegetation flexibility the vegetation mimics used in this experiment were the same as described in section 3 2 for single stem vegetation maza et al 2013 except that the vegetation in this case is packed with greater density n 180 stems m2 and over a length of 10 7 m we take the bending stiffness calibrated for single stem vegetation as the basis value ei 0 006 nm2 and investigate the effect of vegetation flexibility on wave attenuation and wave kinematics within the vegetation patch 4 2 1 vegetation motion fig 9 shows the effect of bending stiffness on the extreme configurations of a representative vegetation stem similar to the single stem vegetation in section 3 2 the vegetation motion exhibits vertically asymmetric displacements relative to the un deformed state the vegetation displaces more under the half cycle of wave crest than that of the wave trough as the bending stiffness increases the vegetation shows increasingly smaller motion more so for the tip vertical displacement in fig 9c note that the instant at which the extreme displacement occurs in fig 9b is shifted depending on the bending stiffness see also zhu and chen 2015 4 2 2 wave height decay fig 10 shows the wave height evolution for bending stiffness of ei 10 ei and 50 ei where ei 0 006 nm2 it is seen that the smallest stiffness ei leads to the least wave dissipation increasing the bending stiffness from ei to 10 ei significantly increases the wave attenuation while increasing further from 10 ei to 50 ei has little effect on the wave attenuation this observation confirms that larger vegetation flexibility leads to less dissipation since greater flexibility allows the vegetation to move more with the flow thereby reducing the relative velocity between flow and vegetation motion see eq 7 the above observation however may not apply if the interaction between neighboring vegetation stems becomes significant the present coupled wave vegetation model does not take into account the possible contact between largely deflected vegetation which may cause additional damping of the wave energy it s likely that while increasing flexibility would decrease the wave damping due to flow resistance the large deflections resulting from the large flexibility may cause the vegetation to collide with each other thereby increasing the wave damping through the collision it is observed in fig 10 that an oscillation pattern appears in the wave height evolutions predicted by the present and previous models and observed in the experiments although the magnitude of oscillation predicted by maza et al 2013 is less pronounced than that of the measurements the phase shift of their prediction relative to the measurement is smaller than the present model the wave height oscillation in the flume may arise from the nonlinear wave wave interactions starting from the wavemaker in which case the location of the wavemaker is critical to the oscillation patterns downstream in addition the interaction between the incident and the reflected waves at the rear end of the physical flume by the sandy beach which is not captured by the present model may also contribute to the oscillation pattern both maza et al 2013 and marsooli and wu 2014 attributed the discrepancies between their model results and measurements to the unknown reflection patterns in the physical flume the spatial shift between the predicted partial standing wave patterns and the measurement is due to the exclusion of the sloping sandy beach in the present model setup as demonstrated by swash model results of wave interactions with vegetation canopy where sponge layers were used to dissipate incoming waves and minimize the wave reflection see fig 4 in chen et al 2019 the location where the waves start to be artificially damped and the phase of the reflected waves relative to the incident waves are dependent on the thickness of the sponge layer they in turn lead to different spatial oscillation patterns of the wave amplitude above the vegetation patch since both model predictions and the measurements show significant oscillations the fitted linear decay rate is adequate to quantify the accuracy of the model among the 3 sets of results the prediction with the intermediate stiffness 10 ei is in closest agreement with the measurement 4 2 3 wave kinematics fig 11 shows the effect of vegetation bending stiffness on the vertical distributions of wave kinematics and mean current at one location within the vegetation patch it is seen that the predictions using 10 ei and 50 ei are consistent with the measurement by stratigaki et al 2011 the wave kinematics is obviously altered by the presence of the vegetation a mean current flowing in the wave propagation direction the maximum velocity being about 20 of wave orbital velocity appears at the top of the vegetation for the predictions using relatively small bending stiffness ei a mean current in opposite direction to the wave propagation appears which is inconsistent with other experimental observations for flexible vegetation canopies luhar et al 2010 abdolahpour et al 2017 this indicates that the flow field for this case may not be predicted well by the coupled model although the model for vegetation with small bending stiffness ei predicts the observed wave height decay reasonably well fig 10 it predicts the wave averaged current in the opposite direction as the measurements this contradiction suggests that some model assumptions might not be valid for highly flexible vegetation the coupled flow vegetation model employs empirical formulas to account for the fluid forces acting on the vegetation and thus the feedback of vegetation motion to the flow field the drag and inertia coefficients in the morison equation eq 6 are assumed to be constant along the vegetation stem and over time these assumptions however are highly questionable for flexible vegetation behaving like either a cantilever or a whip dijkstra and uittenbogaard 2010 paul et al 2012 luhar and nepf 2016 in particular the empirical inertia added mass coefficient in the morison equation accounts for the additional fluid inertia perturbed by the vegetation stem s motion which might affect the mass conservation in the vegetated flume it was noticed that as the vegetation stem becomes increasingly flexible the water mass variation in the flume becomes slightly larger mainly due to the lower limit of water mass within one wave cycle the specific reason for the larger mass variation and the reverse current warrants further fluid structure interaction studies resolving the structure vegetation stem geometries 4 3 wave induced mean current since the bending stiffness of 10 ei predicts the observed wave height decay fig 10 and wave kinematics within the vegetation patch fig 11 reasonably well it is used in the following plots to examine the generation mechanism of vegetation induced mean current fig 12 shows a sequence of snapshots of the horizontal velocity field along with the instantaneous configuration of the vegetation stems the most significant flow perturbation by the vegetation occurs at the top of the vegetation patch beneath the wave crest there appears a sharp increase of horizontal velocity across the free surface this is due to the wave averaged current which changes a lot across the mean water level and the top of the vegetation patch see fig 15a due to the numerical treatment at the air water interface vof surface capturing density jump the model may produce inaccurate results in the vicinity of the interface the flow velocities near the interface is known to subject to spurious air velocities larsen et al 2018 this openfoam s limits of simulating highly nonlinear shallow water waves may also play a role here ransley et al 2017 the instantaneous configuration of each stem in the vegetation patch in fig 12 is largely in accordance with the observations of single stem vegetation presented in section 3 2 the maximum minimum displacements do not occur exactly beneath the wave crest trough the vegetation tends to deflect more under the crest than under the trough as the flow velocity is larger underneath wave crest as shown in fig 12 fig 13 shows a comparison of the horizontal velocity profile outside and within the vegetation patch before entering the vegetation patch fig 13a at location profile 1 indicated in fig 8 the horizontal velocity is uniform across the lower water column consistent with the shallow water wave theory after entering the vegetation patch fig 13b c at location profile 2 and 3 indicated in fig 8 the horizontal velocity is altered around the top of the vegetation see also snapshots in fig 12 both the model predictions and the measurements by stratigaki et al 2011 show an increase of maximum horizontal velocity above the vegetation field as a result there appears a mean current in the direction of the wave propagation luhar et al 2010 observed a similar mean current within a model seagrass meadow and attributed it to the nonzero wave stress which is responsible for the streaming observed in the wave bottom boundary layers zou et al 2006 fig 14 shows the spatial evolution of the mean current phase shift between wave horizontal and vertical velocities and wave shear stress from profile 1 to profile 2 and profile 3 locations illustrated in fig 8 at 0 7 m upstream the vegetation patch profile 1 the mean current has a rather small magnitude with a positive velocity near the bed and a negative velocity over a large portion of the upper water column this velocity structure resembles a typical mean current profile observed in a closed laboratory flume where the stokes drift transported above the wave trough is compensated by a returning flow underneath at this location the phase difference between the wave horizontal u and vertical w velocities is close to 90 the theoretical value of an inviscid irrotational flow solution the wave shear stress uw is therefore approximately zero due to the returning flow and wave height variation see fig 10 in the numerical flume u and w are no longer in quadrature so that wave stress is no longer zero within the vegetation patch profile 2 3 a positive mean current appears around the top of the vegetation canopy the phase difference between u and w departs significantly from 90 as in the wave bottom turbulent boundary layer due to turbulent friction observed by zou and hay 2003 and zou et al 2003 leading to a nonzero wave stress across the height of the vegetation the wave stress change its sign at the top of the vegetation the wave stress at downstream location profile 3 is larger than that upstream profile 2 the discontinuity in the drag force between the vegetation patch and the flow above is believed to the main driving force for the nonzero wave stress the appearance of a mean current at the vegetation interface creates a local circulation pattern fig 15 a shows a spatial distribution of the mean current around the vegetation patch the flow pattern far away from both upstream and downstream the vegetation patch seems to be unaffected by the mean current generated at the top of the vegetation patch except for some disturbances in the immediate vicinity the mean current is established within a short distance 1 m into the vegetation patch and restores to its original upstream state after a similar distance downstream the patch the mean current generated at the top layer of the vegetation is diverted both upward and downward at the downstream end of the meadow while at the start of the meadow the recirculated current converges towards the top of the vegetation the predicted circulation pattern is consistent with the flow measurements around a model seagrass meadow by luhar et al 2010 fig 15b c show the spatial distribution of the wave radiation stress uu and uw respectively around and within the vegetation patch noticeably the presence of the vegetation patch alters the vertical profiles of both wave normal and shear stress both wave radiation stresses uu and uw change rapidly across the interface between the vegetation patch and the flow around it which drives the strong jet like current at the interface 4 4 time evolution of turbulence within vegetation patch fig 16 shows the instantaneous distribution of turbulence energy and dissipation within the vegetation corresponding to the same time instants as in fig 12 for the horizontal velocity contours these figures indicate that significant turbulence energy is generated close to the bed underneath the wave crest and trough this observation is consistent with the vegetation induced turbulence as formulated in eq 18 which is proportional to the cube of the normal flow velocity relative to the vegetation since the vegetation motion close to the bed is constrained the relative velocity is therefore approximately equal to the wave velocity which is positive under the wave crest and negative under the wave trough see the right column in fig 16 significant turbulence is also generated in the upper portion of the vegetation patch where the relative velocity between the flow and vegetation motion is large the relative velocity is amplified whenever the vegetation moves in a direction opposite to the wave velocity or the vegetation is at a maximum displacement such that the relative velocity is again equal to the wave velocity although the maximum displacement does not occur exactly under a wave crest trough referring to section 3 2 for details the wave velocities at the time of maximum displacement are still appreciable leading to significant turbulence generations 5 conclusions and discussion a rans vof navier stokes flow solver is coupled with a finite element vegetation model to investigate the wave vegetation interaction the wave hydrodynamics is simulated by a rans vof model based on openfoam the vegetation motion is described by a slender rod theory using a finite element method which is applicable to flexible vegetation with either small or large deflections the flow and vegetation motion is coupled through hydrodynamic forces using a novel diffused immersed boundary method on a hybrid eulerian lagrangian grid the two equation k ε turbulence model in openfoam is extended to account for the influence of vegetation on turbulence the flexible vegetation model is in a good agreement with the experiments for a largely deflected cantilever beam and single stem vegetation then the coupled flow vegetation model was validated by a large scale flume experiment of a wave propagating though a vegetation patch the effect of vegetation flexibility on the model results is also examined to highlight the limits of constant empirical coefficients adopted in the coupling of flow and vegetation model it was observed that a strong current jet was generated around the top of the vegetation patch this jet may reach about 20 of the wave orbital velocity and is correlated with a nonzero wave radiation stress the presence of vegetation creates a drag discontinuity at the interface of vegetation with the flow above and drastically changes the vertical profiles of the wave radiation stress across the interface the vegetation flexibility plays an important role in the vertical distribution of flow and dictates how far the flow disturbance by vegetation penetrates into the vegetation patch as a result of the current jet in the wave direction at the top of the vegetation patch a circulation pattern is formed around the vegetation patch the predicted circulation pattern is consistent with that observed around a model seagrass meadow by luhar et al 2010 that at the top of a suspended vegetation canopy predicted by the swash model by chen et al 2019 and that predicted by a rans vof model by garcia et al 2004 for waves propagating over a low crested permeable breakwater maximum turbulence energy is observed close to the bed and the top of vegetation patch just before and after the wave crest trough where the flow velocity relative to vegetation is large the predicted complex circulation and turbulence pattern around vegetation patch has strong implications on the net transport and mixing of the nutrient pollutant and sediment in vegetated coastal habitat the proposed model couples the high fidelity rans vof wave model with a finite element flexible vegetation model using a novel diffused immersed boundary approach the geometry of the vegetation stem is not resolved the coupling between the two models is achieved through a morison type force using empirical drag and inertia coefficients to save cpu time without any tuning of the drag coefficient however the coupled model captures adequately the asymmetric displacement of the vegetation motion the rapid variation of wave kinematics around the flow and vegetation interface and the complex circulation pattern around the vegetation patch once the displacement of the vegetation stem is predicted the distribution of fluid forces on the stem can be obtained from the morison equation and used to investigate stem breakage as well as wave attenuation during storms möller et al 2014 vuik et al 2018 our model results indicate that the wave kinematics in particular is sensitive to the vegetation flexibility i e bending stiffness of the vegetation stem calibration is thus required to determine the appropriate bending stiffness and possibly the drag and inertia coefficients as well in the present study the drag inertia coefficient is assumed to be constant along the vegetation stem and over time this assumption may not be valid for flexible vegetation behaving like either a cantilever or a whip dijkstra and uittenbogaard 2010 paul et al 2012 luhar and nepf 2016 it is tempting to propose a spatially and time varying drag inertia coefficient but this warrants significant additional experimental and analytical work luhar et al 2010 nevertheless it is straightforward to incorporate this modification in the present model in the future since the fem vegetation model is robust in accounting for the spatial variations of geometric and mechanical properties of the vegetation stem this sensitivity of model results to the vegetation flexibility may be partly associated with the limitation of the coupling between wave and vegetation model mattis et al 2015 which does not resolve the geometry of the vegetation stem but resorts to empirical drag and inertia coefficients to obtain the hydrodynamic force on the vegetation considering the magnitude difference between the fluid grid o 2 cm and the stem s cross section o 0 1 cm it requires a lot of cpus to conduct a direct simulation such as those by maza et al 2015a and chakrabarti et al 2016 to resolve the geometry of each stem within the vegetation patch the high resolution coupled flow vegetation model complements experimental studies to examine the flow turbulence and mixing in coastal canopies e g abdolahpour et al 2018 in addition the possible contact and wake interactions between neighboring stems are not considered by the present model which may also affect the model performance the stem interactions may be accounted for by adding a damping term in the governing equations of vegetation motion and then calibrate the unknown damping coefficient against the observed vegetation motion acknowledgements the authors gratefully acknowledge the support of the physical oceanography program of national science foundation under award 1436642 the first author is indebted to the correll and the george caterina sakellaris graduate fellowship for supporting part of his phd study the authors wish to thank mr stephen cousins and advanced computing group in the university of maine system for the computational support the second author was supported by nerc grant ne e0002129 1 appendix a matrices and force vectors in the fem formulation a1 m i j l k 0 l ρ v a l a k δ i j d s a2 m i j l k a ρ a v c a 0 l a l a k δ i j d s 0 l a l a k a s a t d s u i t u j s a3 k i j l k 1 0 l e i a l a k δ i j d s a4 k n i j l k 2 0 l p n a l a k δ i j d s a5 f i l 0 l w i f i d a l d s a6 a m i l 1 2 0 l p m a i a l d s a7 b m 1 2 0 l p m d s a8 c m n 1 e a 0 l p m p n d s where mijlk is the consistent mass matrix m i j l k a the added mass matrix k i j l k 1 the stiffness matrix due to bending resistance k n i j l k 2 the stiffness matrix arising from the rod tension and curvature δ ij the kronecker delta function w i the net weight of the rod and f i d is the hydrodynamic force excluding the added mass effect which is incorporated into the added mass matrix m i j l k a appendix b grid size effect on vegetation motion and wave kinematics grid convergence study has been conducted to assess the grid size requirement for the coupled wave vegetation model the computational domain shown in fig 7 is first meshed uniformly with a base grid and then refined with finer grids in the vicinity of the free surface as listed in table b1 three sets of fluid grids are used and the total number of cells for the fluid domain is approximately 170 k 324 k and 649 k respectively each stem of the vegetation is discretized uniformly with elements of equal length 9 cm and 4 5 cm for grid sets 1 2 and 3 which correspondingly leads to 6 and 12 elements for each stem the bending stiffness for each vegetation stem is assumed to be 0 06 nm2 10 ei as assessed in section 4 2 fig b1 shows the grid size effect on extreme configurations and tip displacement history of a representative vegetation stem fig b2 shows the grid size effect on the vertical distribution of wave kinematics and mean current at x 40 36 m it can be observed in both figures that these results are not very sensitive to the grid size tested therefore the grid set 2 is selected considering the balance between accuracy and computational time 
692,this paper presents a novel coupled flow vegetation interaction model capable to resolve the flow and motion of flexible vegetation with large deflections simultaneously on a hybrid eulerian lagrangian grid the hydrodynamics model is based on a navier stokes flow solver with the volume of fluid surface capturing method in openfoam the deforming and moving vegetation are tracked through a series of lagrangian grids attached to the vegetation and embedded in the computational domain of openfoam the governing equations for the flexible vegetation motion are based on a slender rod theory and are solved by a finite element method on a vegetation following lagrangian grid the hydrodynamics and vegetation models are coupled through the vegetation induced hydrodynamic forces using a novel diffused immersed boundary method to avoid excessive fluid grid refinements around the vegetation the standard two equation k ε turbulence model is extended for vegetated flow by incorporating additional closure terms of vegetation effects the newly developed coupled flow vegetation model is validated against experiments for both individual single stem vegetation and a vegetation patch in a large scale wave flume model results of asymmetric displacement of the vegetation motion wave height decay and wave kinematics within and outside the vegetation patch are in good agreement with measurements the drastical change in wave radiation stress by the presence of vegetation patch leads to a strong current jet near the top of vegetation patch which in turn drives a local circulation pattern around the vegetation patch the effect of vegetation bending stiffness on the model results and empirical drag and inertia coefficients for calculating the hydrodynamic forces are examined in detail maximum turbulence energy is observed close to the bed and the top of vegetation patch just before and after the wave crest trough where the relative flow velocity to vegetation is large keywords flexible vegetation rans vof finite element method immersed boundary method fluid structure interaction openfoam 1 introduction coastal vegetation such as seagrasses salt marshes kelp forests and mangroves provide a wide range of ecosystem services they play a key role in the resilience of estuarine ecosystem to severe storms by reducing currents damping waves stabilizing seabed providing habitats and improving water quality nepf 2012 guannel et al 2015 novel coupled flow vegetation models complement laboratory studies to provide insights into the complex interactions between waves currents turbulent flow vegetation and sediment and particulate transport abdolahpour et al 2018 beudin et al 2017 fundamental understandings of the small scale processes thus obtained may be used for empirical parametrizations of these processes required in large scale model applications to field conditions e g suzuki et al 2012 marsooli et al 2016 as one of the core coastal protection services provided by the vegetation attenuation of wave height has received renewed interests in light of climate change and sea level rise the presence of vegetation dissipates the wave energy by doing work against the fluid motion and generating turbulence in the stem scale wakes and canopy scale vortices nepf 2012 at the scale of vegetation stem the rate of energy dissipation is dependent on the relative motion between fluid and vegetation the drag coefficient is mainly a function of vegetation geometry and flow conditions henry et al 2015 at canopy scale the rate of energy dissipation also depends on the population density and interaction among vegetation and canopy scale vortices at the interface of vegetated and non vegetated regions thus the bulk drag coefficient is affected by these processes not necessarily equal to the drag coefficient for individual vegetation mattis et al 2015 in the past decade much laboratory studies have been dedicated to quantifying the wave dissipation by rigid and flexible vegetation lowe et al 2005 augustin et al 2009 stratigaki et al 2011 manca et al 2012 koftis et al 2013 ozeren et al 2013 anderson and smith 2014 wu and cox 2015 paul et al 2016 luhar et al 2017 the impact of current on wave dissipation was also recently examined paul et al 2012 hu et al 2014 henry et al 2015 maza et al 2015b the bulk drag coefficient is calibrated using the analytical theory based on energy flux conservation dalrymple et al 1984 mendez and losada 2004 losada et al 2016 or momentum conservation asano et al 1992 kobayashi et al 1993 mendez et al 1999 a number of empirical formulations have been proposed for the bulk drag coefficient as a function of reynolds number or keulegan carpenter kc number see henry et al 2015 for a comprehensive review significant variations exist in the length and velocity scales and formulations for drag force calculation the calibration of bulk drag coefficient may also need to account for the heterogeneous distribution of vegetation augustin et al 2009 blackmar et al 2013 maza et al 2015a wu et al 2016 a few field measurements have been conducted to study the wave dissipation by kelp forests gaylord et al 2003 seagrass meadow bradley and houser 2009 and salt marsh vegetation jadhav et al 2013 riffe et al 2011 although almost all vegetation exhibits certain degree of flexibility and rigid vegetation is scarce in the real world majority numerical models incorporate the vegetation effect using the morison equation morison et al 1950 and treat the vegetation as vertically rigid cylinders chakrabarti et al 2016 chen et al 2019 li and yan 2007 li and zhang 2010 ma et al 2013 marsooli and wu 2014 tang et al 2015 wu et al 2016 however it is well recognized that vegetation flexibility decreases wave dissipation by allowing the vegetation to move with the flow and thereby reducing the relative velocity between flow and vegetation mullarney and henderson 2010 riffe et al 2011 houser et al 2015 rupprecht et al 2015 a number of numerical studies account for vegetation flexibility by solving a force balance equation for the vegetation motion which includes buoyancy damping bending stiffness and gravity as restoring forces and drag and inertia as driving forces ikeda et al 2001 maza et al 2013 zhu and chen 2015 ikeda et al 2001 solved for the tip displacement of the vegetation stem by assuming an exponential velocity profile and deflection along the stem while maza et al 2013 assumed a linear variation of deflection and obtained the velocity field directly by a navier stokes flow solver mullarney and henderson 2010 derived an analytical relationship between single stem vegetation and wave motion using the euler bernoulli beam equation for a cantilever beam with constant and tapered diameters the fluid drag force is linearized and balanced by the elastic restoring force due to bending neglecting the buoyancy and inertia forces zhu and chen 2015 solved the complete force balance equation with a finite element method fem and coupled the vegetation model with a non hydrostatic phase resolving wave model nhwave ma et al 2012 these vegetation models are however only suitable for small deflections for highly flexible vegetation with large deflections a number of numerical models have been developed to determine the vegetation deflections in the presence of steady currents and the current profile changes due to the vegetation abdelrhman 2007 dijkstra and uittenbogaard 2010 li and xie 2011 luhar and nepf 2011 kubrak et al 2012 marjoribanks et al 2014 mattis et al 2015 relatively few models examined the vegetation deflections in the presence of waves luhar and nepf 2016 zeller et al 2014 two approaches are adopted to tackle the geometrically nonlinear large vegetation displacement problem the first approach starts with the euler bernoulli equation in a coordinate along the length of the vegetation li and xie 2011 mattis et al 2015 2019 or by including a higher order curvature term kubrak et al 2012 the other approach divides the vegetation into a number of finite length segments and obtains the governing equation from a local force balance for each segment abdelrhman 2007 dijkstra and uittenbogaard 2010 luhar and nepf 2011 marjoribanks et al 2014 the latter approach is designated as the n pendula model in marjoribanks et al 2014 and differs from the first approach that is based on a global differential equation for the vegetation deflection the n pendula model was recently applied to study the flexible vegetation motion subject to waves only luhar and nepf 2016 and waves plus currents zeller et al 2014 another component of a coupled wave vegetation interaction model is wave hydrodynamics model augustin et al 2009 and blackmar et al 2013 applied a boussinesq equation based wave model to calibrate the vegetation enhanced bottom friction factor majority of other wave models however use the morison type drag formulation to represent the vegetation damping as a function of vegetation density and stem width and height examples include the mild slope equation wave model tang et al 2015 and the nearshore spectral wave model swan suzuki et al 2012 beudin et al 2017 suzuki et al 2012 implemented a multilayer schematization to account for the vertical variation of different vegetation species in swan chen et al 2019 applied a non hydrostatic wave flow model swash simulating waves till shore zijlema et al 2011 and identified a strong negative wave driven current jet at the bottom of a suspended canopy in the opposite direction of the wave for flexible vegetation the drag force may be reduced due to the reduced frontal area since the vegetation will be deflected as a result of flow induced bending this drag reduction was incorporated by beudin et al 2017 using the concept of effective blade length proposed by luhar and nepf 2011 the same concept has been used by losada et al 2016 to derive the drag formulations in the presence of waves and currents compared with the wave models mentioned above navier stokes equations based wave hydrodynamics models provide more detailed flow features in the presence of vegetation the vegetation alters the flow field and generates turbulence around the vegetation stems the turbulent interactions between waves and vegetation can be examined by solving the reynolds averaged navier stokes rans equations along with a turbulence closure model e g chen et al 2019 li and yan 2007 li and zhang 2010 ma et al 2013 zhu and chen 2015 the vegetation induced resisting force and turbulence can be incorporated as an additional source term in the momentum and turbulent energy transport equations the rans flow solver coupled with a volume of fluid vof surface capturing method is capable to resolve the process of wave breaking chakrabarti et al 2016 maza et al 2013 2015a marsooli and wu 2014 the objective of this paper is to construct a two way coupled wave vegetation interaction model for flexible vegetation with large deflections which is ubiquitous in the nearshore environment the wave hydrodynamics model is based on a rans vof flow solver with realistic wave generation and absorption components higuera et al 2013 the flexible vegetation model is based on an elastic rod theory with a complete force balance equation solved by finite element method fem garrett 1982 chen et al 2011a b the fem based vegetation model is applicable to flexible vegetation with large deflections and is inherently robust in incorporating spatial variations of geometric and mechanical properties of the vegetation augustin et al 2009 feagin et al 2011 rupprecht et al 2015 wu et al 2016 the hydrodynamics and vegetation models are coupled through the vegetation induced hydrodynamic forces calculated by the morison equation morison et al 1950 the drag and inertia forces are included as source terms in the momentum equation of the rans vof flow model and drive the vegetation model at the same time the flow velocity and acceleration input for the vegetation model are obtained from the rans vof flow model instead of the experiments as in zeller et al 2014 and luhar and nepf 2016 the standard two equation k ε turbulence model launder and spalding 1974 is modified to include the effect of vegetation following lopez and garcia 2001 the present model couples the flow and vegetation motion using an immersed boundary approach peskin 2002 mattis et al 2015 instead of porous media approach e g maza et al 2013 2015a zhu and chen 2015 two sets of grids are used in the coupled flow vegetation model the flow motion is solved in the eulerian grid while the vegetation motion is solved in the lagrangian grid applying the hybrid eulerian lagrangian grid to wave vegetation interaction is one of the novelties of this paper the governing equations of vegetation motion used a coordinate system conformed to the deformation of the vegetation which is robust to resolve structural dynamics in the presence of large deformation the rest of the paper is structured as follows section 2 presents the four components of the coupled wave vegetation model 1 the rans vof wave model 2 the finite element model of flexible vegetation 3 the k ε turbulence model modified to account for the effect of vegetation on turbulence and 4 the coupling procedure between the flow and vegetation motion using the immersed boundary method in section 3 the flexible vegetation model is first validated against a largely deflected cantilever beam the coupled wave vegetation model is then validated against single stem vegetation subject to wave motion the modified turbulence model for vegetation flow is validated against vegetated open channel flows in section 4 the coupled wave vegetation model is applied to a vegetation patch in a large scale flume experiment the vegetation motion wave height decay wave kinematics circulation pattern and turbulence within and outside the vegetation patch and the effect of vegetation flexibility are examined conclusions and discussions are summarized in section 5 2 model development 2 1 rans vof flow solver the reynolds averaged navier stokes solver coupled with a volume of fluid surface capturing scheme hirt and nichols 1981 has been used extensively to solve wave hydrodynamics problems with and without breaking lin and liu 1998 lara et al 2008 wang et al 2009 lv et al 2010 the rans vof model adopted by the present study is the two phase flow solver interfoam in the open source cfd toolbox openfoam which uses a collocated unstructured grid finite volume method and vof surface capturing method jasak 1996 rusche 2002 weller 2002 the model solves the pressure and velocity fields from the continuity and momentum equations for an incompressible fluid 1 u 0 2 ρ u t ρ u μ e f f u p g x ρ u μ e f f f hd and the volume of fluid vof field from the advection equation 3 α t u α u r α 1 α 0 where u is the velocity vector ρ the fluid density p p ρg x the pseudo dynamic pressure g the acceleration due to gravity x the position vector and μ e f f μ ρ υ t is the effective dynamic viscosity which takes into account of the molecular dynamic viscosity μ and the turbulent eddy viscosity υ t α is the vof indicator to mark the location of the air water interface note that in eq 3 an extra convective term u r α 1 α is added to the classic vof advection equation to limit the smearing of the interface weller 2002 the last term in eq 2 f hd represents the hydrodynamic forces exerted on the flow by the vegetation which will be described in the following sections to adapt the openfoam solver for coastal engineering applications higuera et al 2013 developed active wave generation and absorption boundary conditions in the present study we use this extended solver ihfoam as the wave model 2 2 elastic rod model for flexible vegetation we treat the flexible vegetation as a slender elastic rod in a 3d cartesian coordinate system as shown in fig 1 b the centerline of the rod in deformed state can be expressed by a position vector r s t which is a function of arc length s measured along the centerline curve and time t assuming that there is no torque or twisting moment one can derive a linear momentum conservation equation with respect to the position vector garrett 1982 4 2 s 2 e i 2 r s 2 s λ r s q m v 2 r t 2 5 1 2 r s r s 1 λ e a where ei is the bending stiffness of the vegetation stem mv the vegetation mass per unit length λ te eiκ2 with te being local effective tension and κ r rod curvature and q is the external distributed load on unit length of rod eq 5 states that the rod is elastic and extensible where ea is the axial stiffness the vegetation stem the scalar variable λ can be considered as a lagrangian multiplier eqs 4 and 5 combined with initial and boundary conditions are sufficient to determine the dependent variables r s t and λ s t in coastal and nearshore environments where vegetation abounds the applied force on the vegetation stem q w f hs f hd consists of gravity force w hydrostatic force f hs and hydrodynamic force f hd from the surrounding fluid while the hydrostatic buoyancy force is incorporated into the effective tension following paulling and webster 1986 the hydrodynamic force is calculated using morison equation and is decomposed into 3 components drag force f d inertia force f i and added mass morison et al 1950 6 f hd 0 5 ρ c d b v u n r n u n r n ρ v v u ρ a v c a u n r n f d f i ρ a v c a r n 7 f d 0 5 ρ c d b v u n r n u n r n 8 f i ρ v v u ρ a v c a u n where cd ca are the drag and added mass coefficients bv av vv the width and area of the cross section and volume per unit length of the rod u u fluid velocity and acceleration and r r are the rod velocity and acceleration the superscript n in eqs 6 8 indicates the respective normal components perpendicular to the rod tangent r the normal component of fluid velocity u for example can be obtained by 9 u n u u r r nu where n i r r is the transformation matrix and i is the identity matrix the hydrodynamic force exerted by the vegetation on the flow is f hd which is to be incorporated in section 2 4 as a source term in the fluid momentum equation eq 2 the finite element method is used to discretize the governing equations of motion eqs 4 5 for an element of length l we approximate ri s t and λ s t by 10 r i s t l 1 4 a l s u i l t 11 λ s t m 1 3 p m s λ m t where al and pm are shape functions defined in terms of ξ s l 12 a 1 1 3 ξ 2 2 ξ 3 a 2 ξ 2 ξ 2 ξ 3 a 3 3 ξ 2 2 ξ 3 a 4 ξ 2 ξ 3 13 p 1 ξ 1 2 ξ 1 p 2 4 ξ 1 ξ p 3 ξ 2 ξ 1 and uil λ m are nodal variables to be solved 14 u i 1 r i 0 t u i 2 l r i 0 t u i 3 r i l t u i 4 l r i l t 15 λ 1 λ 0 t λ 2 λ l 2 t λ 3 λ l t thus the unknown variable uil are the position ri and the tangent r i at two nodes of the element the unknown variable λ m are the tension at two nodes and the midpoint of the element using galerkin s method and eqs 10 11 the equations of motion for one element may be written in matrix form as 16 m i j l k m i j l k a u j k k i j l k 1 λ n k n i j l k 2 u j k f i l 0 where mijlk is the consistent mass matrix m i j l k a the added mass matrix k i j l k 1 the stiffness matrix due to bending resistance and k n i j l k 2 is the stiffness matrix arising from the rod tension and curvature the extensibility condition may be written as 17 g m a m i l u k i u k l b m c m n λ n 0 the matrices and force vectors in eqs 16 17 are listed in appendix a as the added mass stiffness and external loads in turn are functions of the unknown variables uil λ m special numerical treatment is needed to solve the equations the newton raphson method is used for static problems such as vegetation reconfiguration under steady current good initial guess and incremental loading help to achieve fast convergence of solution for large deflections for cantilevered vegetation stems studied in this paper an unstressed initial state is appropriate initial guess to obtain a convergent solution with a single step loading in the presence of small current under strong current however it is advisable to apply the total current loading through several small load increments for the first load increment an unstressed state is appropriate initial guess to obtain a converged solution which then serves as an initial state for the next load increment with this technique the model results would converge quickly for highly flexible vegetation a mixture of implicit and explicit time differencing scheme is used for dynamic problems involving transient wave motion readers should refer to garret 1982 and ran 2000 for more details 2 3 turbulence modeling in presence of vegetation various turbulence models have been proposed to study vegetated open channel flows shimizu and tsujimoto 1994 lopez and garcia 2001 hiraoka and ohashi 2008 and wave vegetation interactions li and yan 2007 li and zhang 2010 ma et al 2013 maza et al 2013 2015a in this study the standard k ε model in openfoam is adapted to simulate turbulent flows within the vegetation canopy by incorporating two additional terms related to vegetation effects in the transport equations for turbulence energy k and dissipation rate ε the turbulence production due to the presence of vegetation is related to the drag force by 18 p v f d u n r n 0 5 ρ c d a u n r n 3 where a bvn is the vegetation density measured as frontal area per unit volume thus having a unit of length 1 and n is the number of stems per unit area note that the normal relative velocity u n r n is used to be consistent with the drag force formulation in eq 7 vegetation induced turbulence is therefore proportional to the cube of the normal flow velocity relative to the vegetation the modified k ε model including vegetation induced turbulence is given by 19 ρ k t ρ u k μ μ t σ k k p k ρ ε c k p p v 20 ρ ε t ρ u ε μ μ t σ ε ε ε k c 1 ε p k c ε p p v c 2 ε ρ ε where μ t ρν t ρc μ k 2 ε is the dynamic eddy viscosity linking the k ε model with the fluid momentum eq 2 σ k σε c 1ε c 2ε c μ are the standard closure coefficients launder and spalding 1974 and ckp c εp are the two new coefficients to be calibrated the new term in eq 19 ckppv represents the parameterization of the work of mean velocity against drag forces lopez and garcia 2001 suggested based on a theoretical argument that the two new coefficients are so related that ckp 1 0 and c εp c 2ε c 1ε ckp 1 33 2 4 coupling of vegetation motion with flow an immersed boundary approach is adopted to couple the wave hydrodynamics with the flexible vegetation motion the immersed boundary method is a robust technique to simulate the flow interaction with structures especially the moving structures zhang et al 2010 ha et al 2014 lin et al 2016 peng et al 2018 in this method the fluid model is defined in eulerian grids while the structure model is defined in lagrangian coordinates the immersed structure i e flexible vegetation is represented as a collection of one dimensional lines whose behavior r s t is determined by the external line force f hd r and the restoring mechanisms such as elastic bending the force exerted by the structure on the fluid is then integrated as a source term in the fluid momentum equation eq 2 using 21 f hd x γ f hd r δ x r d s where x is the position vector within the fluid grid δ x r is the dirac delta function and γ is the lagrangian structural grid correspondingly the force acting on the structure by the fluid can be determined using the inverse integral transform 22 f hd r ω f hd x δ x r d x where ω is the eulerian fluid domain eqs 21 and 22 ensure that the momentum of the coupled fluid structure system is conserved mattis et al 2015 in a similar manner the turbulence production due to the single stem vegetation with n 1 in eq 18 should be integrated over a region enclosing the vegetation stem 23 p v x γ p v r δ x r d s by doing so the vegetation induced turbulence will be smoothly distributed among the surrounding fluid cells in the fluid structure interaction approach eq 23 constitutes the vegetation induced source term in the turbulence transport equations eqs 19 and 20 because the structure grid does not generally coincide with the cell centers of the eulerian grid the forcing and turbulence at each lagrangian point along the vegetation is distributed over a band of neighboring fluid cells see fig 2 thus the sharp delta function is replaced by a smoother distribution function which is suitable for use on a discrete mesh mittal and iaccarino 2005 the fluid velocity in morison equation eq 6 can also be obtained through the same smoothing function the following smoothed approximation to the dirac delta function is used peskin 2002 24 δ h x 1 h 3 ϕ x 1 h ϕ x 2 h ϕ x 3 h where h is the eulerian grid size x 1 x 2 x 3 are the three components of vector x and 25 φ ς 1 4 1 cos π ς 2 f o r ς 2 0 o t h e r w i s e fig 3 illustrates the flow chart of solving the coupled wave vegetation model in which an interface module is developed to exchange information between the wave and vegetation model components at each time step of the computation the vegetation motion is solved first with the flow velocities output of the wave hydrodynamics model the velocity and acceleration at cell centers of the fluid grid are interpolated to the structure s grid point after solving the vegetation motion the hydrodynamic force at each structure s grid point is smoothly distributed to the surrounding fluid cells using eq 21 the smoothed vegetation force acts as a source term in the fluid momentum equation eq 2 of the rans vof solver then the standard step of a rans vof flow solver follows i e vof advection and piso loop coupling pressure with velocity similarly the vegetation induced turbulence production term at each structure s grid point is smoothly distributed to the surrounding fluid cells using eq 23 the smoothed turbulence production is added to the transport equations eqs 19 and 20 for the k ε turbulence model which is solved next the new flow velocities will then be used to solve the vegetation motion at the next time step 3 model validation in this section both the individual model components and the coupled wave vegetation model are validated against the available experiments since the ihfoam wave model has been validated extensively by higuera et al 2013 the fem model for flexible vegetation is validated using the measurements for a cantilever beam and single stem vegetation the modified k ε turbulence model is calibrated using one set of experiments for vegetated channel flows shimizu and tsujimoto 1994 3 1 elastic rod model we first test our vegetation model by a cantilever beam with large deflections belendez et al 2003 considered a flexible steel beam of rectangular cross section deflections of the beam were measured under a uniformly distributed load due to gravity q 0 758 n m and a concentrated load applied at the free end f 0 0 588 n the beam length is 0 4 m and the bending stiffness is ei 0 02591 nm2 in our model simulation 20 elements were used to discretize the beam starting from an unstressed state and applying the gravity and tip load within a single step the model converged with as few as 5 7 iterations for all the cases the predicted and measured deflections for 3 tip loads are shown in fig 4 and also tabulated in table 1 with all the other concentrated loads it is seen that the model predictions agree very well with the measured deflections the differences between the two sets of results are within 2 with an average value of 0 8 note that our model results are almost identical to the ansys model results by belendez et al 2003 3 2 wave interaction with single stem vegetation maza et al 2013 measured the magnitude of vegetation bending under wave action the vegetation mimics were composed of four pvc strips one pair 54 cm long and another pair 27 5 cm the pvc strips have a cross section of 1 mm thick and 1 cm wide a young s modulus e 0 9 gpa and a density ρ v 700 kg m3 since there is no binding between the four stem vegetation mimics it s difficult to predict each mimic s response to the wave action to simplify model simulation an equivalent single stem vegetation is used and some calibration is thus required to determine the geometric and mechanical properties of the equivalent vegetation stem a 50 m long and 1 2 m deep numerical flume is setup with the vegetation stem positioned at x 20 m downstream from the wavemaker at the inlet where a 10th order stream function wave theory is specified to generate the waves the fluid grid size is uniformly 0 04 m in the horizontal x direction and 0 01 m in the vertical z direction the vegetation stem is discretized by 10 equal segments for vertically standing vegetation stems the static equilibrium achieved under gravity and buoyancy without external loading is used to initialize the vegetation motion simulation the time step in the coupled flow vegetation model is solely determined by the courant number limit in the flow solver which varies between 0 003 0 006 s significantly smaller than the time step required by the vegetation structural solver no iteration is thus performed in a time step of flow solver for the vegetation motion solver the coupled wave vegetation model is run for 32 s which took about 2 h on a single intel core i5 cpu a ramping function with a buildup period of 4 s is applied to smoothly adding the loading to the vegetation which soon reaches an equilibrium state of highly periodic wave and vegetation motion fig 5 presents the predicted instantaneous configurations for the flexible vegetation over one wave period the drag coefficient for flat plates cd 1 95 luhar and nepf 2011 2016 is used the bending stiffness calibrated ei 0 006 nm2 is equivalent to that of 2 pvc strips bond together to resist the wave motion the two extreme displacements curves b d in fig 5 are in good agreement with the measurements squares by maza et al 2013 due to the asymmetry of wave kinematics and the vegetation flexibility and nonlinear interaction between wave motion and vegetation displacement the vegetation displaces more under wave crest 25 cm than under trough 17 cm however the maximum displacements do not occur exactly at the crest and trough there are certain phase lags between the instants of maximum displacement and the crest trough this finding is consistent with another set of experiment presented in maza 2015c see their fig 9 1 confirming the present model s capability to resolve the large deflections of flexible vegetation 3 3 turbulence model in the presence of rigid vegetation the extended k ε turbulence model is calibrated against a laboratory experiment of fully developed open channel flows over submerged vegetation case r31 and r32 in shimizu and tsujimoto 1994 for case r31 the water depth and depth averaged current velocity were 6 31 cm and 11 21 cm s respectively the flume bottom was covered with rigid vegetation of 10 000 stems m2 height 4 1 cm and stem diameter 0 1 cm the frontal area per unit volume is thus 0 1 cm 1 to examine the fully developed current profile a 2d numerical model is developed to mimic only a short segment of the open channel flow the computational domain is 0 1 m long and 0 11 m high and is discretized uniformly using 20 and 40 grids respectively in the horizontal and vertical directions periodic boundary conditions are specified at the inlet and outlet boundaries of this short flume which maps the model results of flow and turbulence variables at the outlet of the flume back to the inlet once the simulation is run long enough the fully developed current profile and turbulence quantities are achieved the model was run 40 s and completed within half a minute wall time which ensured that fully developed conditions were obtained we used the same drag coefficient cd 1 2 as in ma et al 2013 and marsooli et al 2016 fig 6 a shows the model data comparisons for case r31 of the vertical distributions of mean current velocity u and reynolds shear stress u w υ t u z which are normalized by the depth averaged mean current velocity u0 it is seen that the flow within the vegetation is noticeably suppressed there appears an inflection point in the velocity profile near the top of the canopy the faster flow above the vegetation and the slower flow below form a shear layer at the interface of fluid and vegetation canopy where the kelvin helmholtz kh instabilities may develop ghisalberti and nepf 2002 the reynolds stress peaks near the top of the vegetation and decays to nearly zero both downward into the canopy and upward to the free surface based on the context of exchange with surrounding water nepf and vivoni 2000 divided the submerged canopy into two zones in the longitudinal exchange zone z h 0 4 the vertical turbulent transport of momentum is negligible i e u w 0 in the vertical exchange zone z h 0 4 the vertical turbulent transport is dominant over the longitudinal exchange fig 6 indicates that good model data comparisons were achieved by using ckp 1 0 and c εp 1 28 the sensitivity of the model results to the coefficients c εp and cd was investigated in general the model results are more sensitive to c εp than to cd consistent with the findings in ma et al 2013 the c εp 1 28 produces reasonable agreements with both cases r31 and r32 in shimizu and tsujimoto 1994 and is therefore used in the following studies 4 wave interaction with a vegetation patch the coupled wave vegetation model is validated by a large scale flume experiment by stratigaki et al 2011 this experiment has been used to validate a then state of the art coupled flow vegetation model by maza et al 2013 and a wave rigid vegetation model by marsooli and wu 2014 maza et al 2013 assumed a linear deformation for the vegetation stem and coupled the vegetation motion with the flow field through a porous medium approach the present model extends their approach by 1 developing a large deformation vegetation model 2 coupling the wave motion and the vegetation motion using an immersed boundary approach based on the same set of experiment the vegetation motion wave height decay sensitivity of model results to vegetation flexibility and the flow structures outside and within the vegetation patch are investigated 4 1 model setup fig 7 shows the model setup simulating a regular wave t 3 5 s and h 0 5 m propagating through a vegetation patch the water depth is 2 4 m at the wavemaker boundary and 1 7 m at the onshore boundary and between the two sections is a 12 m long 1 17 sandy slope a 10 7 m long artificial vegetation meadow was placed over the flat sandy bottom starting at x 38 36 m from the wave paddle fig 8 shows a zoom in view of the vegetation patch in fig 7 along with the three locations at which velocity profiles outside and inside the vegetation were measured in stratigaki et al 2011 a uniform grid of 0 04 m by 0 02 m in the horizontal and vertical directions spans the entire computational domain this base mesh is then intersected with the bathymetry using the snappyhexmesh utility in openfoam the remaining sandy beach beyond the vegetation patch is ignored in the simulation which avoids resolving the computationally intensive wave breaking process in the surf zone and thus may produce a partial standing wave pattern different from the experiment see fig 10 below the fifth order stokes wave theory is specified at the wavemaker the waves propagating through the vegetation field are absorbed at outlet by using the ihfoam absorbing boundary conditions developed by higuera et al 2013 each vegetation stem is discretized using 6 elements of equal length of 0 09 m the static equilibrium achieved for each stem under gravity and buoyancy without external loading is used to initialize the vegetation patch the initial and boundary conditions for the turbulence model are specified following lin and liu 1998 the model is first run 30 s without activating the vegetation module after the wave is fully developed in the flume the vegetation module is switched on with the driving force from the wave motion smoothly ramped up within one wave period the coupled wave vegetation model is then run for another 30 s which took about 16 h on a single intel core i5 cpu the time step in the coupled model is determined by the maximum courant number of 0 3 in the flow solver no iteration is performed in a time step of flow solver for the vegetation motion solver the following results are obtained by averaging over the last 6 wave periods grid convergence study in appendix b shows that the above grid is adequate in resolving the vegetation dynamics and the wave kinematics in the presence of the vegetation patch 4 2 effects of vegetation flexibility the vegetation mimics used in this experiment were the same as described in section 3 2 for single stem vegetation maza et al 2013 except that the vegetation in this case is packed with greater density n 180 stems m2 and over a length of 10 7 m we take the bending stiffness calibrated for single stem vegetation as the basis value ei 0 006 nm2 and investigate the effect of vegetation flexibility on wave attenuation and wave kinematics within the vegetation patch 4 2 1 vegetation motion fig 9 shows the effect of bending stiffness on the extreme configurations of a representative vegetation stem similar to the single stem vegetation in section 3 2 the vegetation motion exhibits vertically asymmetric displacements relative to the un deformed state the vegetation displaces more under the half cycle of wave crest than that of the wave trough as the bending stiffness increases the vegetation shows increasingly smaller motion more so for the tip vertical displacement in fig 9c note that the instant at which the extreme displacement occurs in fig 9b is shifted depending on the bending stiffness see also zhu and chen 2015 4 2 2 wave height decay fig 10 shows the wave height evolution for bending stiffness of ei 10 ei and 50 ei where ei 0 006 nm2 it is seen that the smallest stiffness ei leads to the least wave dissipation increasing the bending stiffness from ei to 10 ei significantly increases the wave attenuation while increasing further from 10 ei to 50 ei has little effect on the wave attenuation this observation confirms that larger vegetation flexibility leads to less dissipation since greater flexibility allows the vegetation to move more with the flow thereby reducing the relative velocity between flow and vegetation motion see eq 7 the above observation however may not apply if the interaction between neighboring vegetation stems becomes significant the present coupled wave vegetation model does not take into account the possible contact between largely deflected vegetation which may cause additional damping of the wave energy it s likely that while increasing flexibility would decrease the wave damping due to flow resistance the large deflections resulting from the large flexibility may cause the vegetation to collide with each other thereby increasing the wave damping through the collision it is observed in fig 10 that an oscillation pattern appears in the wave height evolutions predicted by the present and previous models and observed in the experiments although the magnitude of oscillation predicted by maza et al 2013 is less pronounced than that of the measurements the phase shift of their prediction relative to the measurement is smaller than the present model the wave height oscillation in the flume may arise from the nonlinear wave wave interactions starting from the wavemaker in which case the location of the wavemaker is critical to the oscillation patterns downstream in addition the interaction between the incident and the reflected waves at the rear end of the physical flume by the sandy beach which is not captured by the present model may also contribute to the oscillation pattern both maza et al 2013 and marsooli and wu 2014 attributed the discrepancies between their model results and measurements to the unknown reflection patterns in the physical flume the spatial shift between the predicted partial standing wave patterns and the measurement is due to the exclusion of the sloping sandy beach in the present model setup as demonstrated by swash model results of wave interactions with vegetation canopy where sponge layers were used to dissipate incoming waves and minimize the wave reflection see fig 4 in chen et al 2019 the location where the waves start to be artificially damped and the phase of the reflected waves relative to the incident waves are dependent on the thickness of the sponge layer they in turn lead to different spatial oscillation patterns of the wave amplitude above the vegetation patch since both model predictions and the measurements show significant oscillations the fitted linear decay rate is adequate to quantify the accuracy of the model among the 3 sets of results the prediction with the intermediate stiffness 10 ei is in closest agreement with the measurement 4 2 3 wave kinematics fig 11 shows the effect of vegetation bending stiffness on the vertical distributions of wave kinematics and mean current at one location within the vegetation patch it is seen that the predictions using 10 ei and 50 ei are consistent with the measurement by stratigaki et al 2011 the wave kinematics is obviously altered by the presence of the vegetation a mean current flowing in the wave propagation direction the maximum velocity being about 20 of wave orbital velocity appears at the top of the vegetation for the predictions using relatively small bending stiffness ei a mean current in opposite direction to the wave propagation appears which is inconsistent with other experimental observations for flexible vegetation canopies luhar et al 2010 abdolahpour et al 2017 this indicates that the flow field for this case may not be predicted well by the coupled model although the model for vegetation with small bending stiffness ei predicts the observed wave height decay reasonably well fig 10 it predicts the wave averaged current in the opposite direction as the measurements this contradiction suggests that some model assumptions might not be valid for highly flexible vegetation the coupled flow vegetation model employs empirical formulas to account for the fluid forces acting on the vegetation and thus the feedback of vegetation motion to the flow field the drag and inertia coefficients in the morison equation eq 6 are assumed to be constant along the vegetation stem and over time these assumptions however are highly questionable for flexible vegetation behaving like either a cantilever or a whip dijkstra and uittenbogaard 2010 paul et al 2012 luhar and nepf 2016 in particular the empirical inertia added mass coefficient in the morison equation accounts for the additional fluid inertia perturbed by the vegetation stem s motion which might affect the mass conservation in the vegetated flume it was noticed that as the vegetation stem becomes increasingly flexible the water mass variation in the flume becomes slightly larger mainly due to the lower limit of water mass within one wave cycle the specific reason for the larger mass variation and the reverse current warrants further fluid structure interaction studies resolving the structure vegetation stem geometries 4 3 wave induced mean current since the bending stiffness of 10 ei predicts the observed wave height decay fig 10 and wave kinematics within the vegetation patch fig 11 reasonably well it is used in the following plots to examine the generation mechanism of vegetation induced mean current fig 12 shows a sequence of snapshots of the horizontal velocity field along with the instantaneous configuration of the vegetation stems the most significant flow perturbation by the vegetation occurs at the top of the vegetation patch beneath the wave crest there appears a sharp increase of horizontal velocity across the free surface this is due to the wave averaged current which changes a lot across the mean water level and the top of the vegetation patch see fig 15a due to the numerical treatment at the air water interface vof surface capturing density jump the model may produce inaccurate results in the vicinity of the interface the flow velocities near the interface is known to subject to spurious air velocities larsen et al 2018 this openfoam s limits of simulating highly nonlinear shallow water waves may also play a role here ransley et al 2017 the instantaneous configuration of each stem in the vegetation patch in fig 12 is largely in accordance with the observations of single stem vegetation presented in section 3 2 the maximum minimum displacements do not occur exactly beneath the wave crest trough the vegetation tends to deflect more under the crest than under the trough as the flow velocity is larger underneath wave crest as shown in fig 12 fig 13 shows a comparison of the horizontal velocity profile outside and within the vegetation patch before entering the vegetation patch fig 13a at location profile 1 indicated in fig 8 the horizontal velocity is uniform across the lower water column consistent with the shallow water wave theory after entering the vegetation patch fig 13b c at location profile 2 and 3 indicated in fig 8 the horizontal velocity is altered around the top of the vegetation see also snapshots in fig 12 both the model predictions and the measurements by stratigaki et al 2011 show an increase of maximum horizontal velocity above the vegetation field as a result there appears a mean current in the direction of the wave propagation luhar et al 2010 observed a similar mean current within a model seagrass meadow and attributed it to the nonzero wave stress which is responsible for the streaming observed in the wave bottom boundary layers zou et al 2006 fig 14 shows the spatial evolution of the mean current phase shift between wave horizontal and vertical velocities and wave shear stress from profile 1 to profile 2 and profile 3 locations illustrated in fig 8 at 0 7 m upstream the vegetation patch profile 1 the mean current has a rather small magnitude with a positive velocity near the bed and a negative velocity over a large portion of the upper water column this velocity structure resembles a typical mean current profile observed in a closed laboratory flume where the stokes drift transported above the wave trough is compensated by a returning flow underneath at this location the phase difference between the wave horizontal u and vertical w velocities is close to 90 the theoretical value of an inviscid irrotational flow solution the wave shear stress uw is therefore approximately zero due to the returning flow and wave height variation see fig 10 in the numerical flume u and w are no longer in quadrature so that wave stress is no longer zero within the vegetation patch profile 2 3 a positive mean current appears around the top of the vegetation canopy the phase difference between u and w departs significantly from 90 as in the wave bottom turbulent boundary layer due to turbulent friction observed by zou and hay 2003 and zou et al 2003 leading to a nonzero wave stress across the height of the vegetation the wave stress change its sign at the top of the vegetation the wave stress at downstream location profile 3 is larger than that upstream profile 2 the discontinuity in the drag force between the vegetation patch and the flow above is believed to the main driving force for the nonzero wave stress the appearance of a mean current at the vegetation interface creates a local circulation pattern fig 15 a shows a spatial distribution of the mean current around the vegetation patch the flow pattern far away from both upstream and downstream the vegetation patch seems to be unaffected by the mean current generated at the top of the vegetation patch except for some disturbances in the immediate vicinity the mean current is established within a short distance 1 m into the vegetation patch and restores to its original upstream state after a similar distance downstream the patch the mean current generated at the top layer of the vegetation is diverted both upward and downward at the downstream end of the meadow while at the start of the meadow the recirculated current converges towards the top of the vegetation the predicted circulation pattern is consistent with the flow measurements around a model seagrass meadow by luhar et al 2010 fig 15b c show the spatial distribution of the wave radiation stress uu and uw respectively around and within the vegetation patch noticeably the presence of the vegetation patch alters the vertical profiles of both wave normal and shear stress both wave radiation stresses uu and uw change rapidly across the interface between the vegetation patch and the flow around it which drives the strong jet like current at the interface 4 4 time evolution of turbulence within vegetation patch fig 16 shows the instantaneous distribution of turbulence energy and dissipation within the vegetation corresponding to the same time instants as in fig 12 for the horizontal velocity contours these figures indicate that significant turbulence energy is generated close to the bed underneath the wave crest and trough this observation is consistent with the vegetation induced turbulence as formulated in eq 18 which is proportional to the cube of the normal flow velocity relative to the vegetation since the vegetation motion close to the bed is constrained the relative velocity is therefore approximately equal to the wave velocity which is positive under the wave crest and negative under the wave trough see the right column in fig 16 significant turbulence is also generated in the upper portion of the vegetation patch where the relative velocity between the flow and vegetation motion is large the relative velocity is amplified whenever the vegetation moves in a direction opposite to the wave velocity or the vegetation is at a maximum displacement such that the relative velocity is again equal to the wave velocity although the maximum displacement does not occur exactly under a wave crest trough referring to section 3 2 for details the wave velocities at the time of maximum displacement are still appreciable leading to significant turbulence generations 5 conclusions and discussion a rans vof navier stokes flow solver is coupled with a finite element vegetation model to investigate the wave vegetation interaction the wave hydrodynamics is simulated by a rans vof model based on openfoam the vegetation motion is described by a slender rod theory using a finite element method which is applicable to flexible vegetation with either small or large deflections the flow and vegetation motion is coupled through hydrodynamic forces using a novel diffused immersed boundary method on a hybrid eulerian lagrangian grid the two equation k ε turbulence model in openfoam is extended to account for the influence of vegetation on turbulence the flexible vegetation model is in a good agreement with the experiments for a largely deflected cantilever beam and single stem vegetation then the coupled flow vegetation model was validated by a large scale flume experiment of a wave propagating though a vegetation patch the effect of vegetation flexibility on the model results is also examined to highlight the limits of constant empirical coefficients adopted in the coupling of flow and vegetation model it was observed that a strong current jet was generated around the top of the vegetation patch this jet may reach about 20 of the wave orbital velocity and is correlated with a nonzero wave radiation stress the presence of vegetation creates a drag discontinuity at the interface of vegetation with the flow above and drastically changes the vertical profiles of the wave radiation stress across the interface the vegetation flexibility plays an important role in the vertical distribution of flow and dictates how far the flow disturbance by vegetation penetrates into the vegetation patch as a result of the current jet in the wave direction at the top of the vegetation patch a circulation pattern is formed around the vegetation patch the predicted circulation pattern is consistent with that observed around a model seagrass meadow by luhar et al 2010 that at the top of a suspended vegetation canopy predicted by the swash model by chen et al 2019 and that predicted by a rans vof model by garcia et al 2004 for waves propagating over a low crested permeable breakwater maximum turbulence energy is observed close to the bed and the top of vegetation patch just before and after the wave crest trough where the flow velocity relative to vegetation is large the predicted complex circulation and turbulence pattern around vegetation patch has strong implications on the net transport and mixing of the nutrient pollutant and sediment in vegetated coastal habitat the proposed model couples the high fidelity rans vof wave model with a finite element flexible vegetation model using a novel diffused immersed boundary approach the geometry of the vegetation stem is not resolved the coupling between the two models is achieved through a morison type force using empirical drag and inertia coefficients to save cpu time without any tuning of the drag coefficient however the coupled model captures adequately the asymmetric displacement of the vegetation motion the rapid variation of wave kinematics around the flow and vegetation interface and the complex circulation pattern around the vegetation patch once the displacement of the vegetation stem is predicted the distribution of fluid forces on the stem can be obtained from the morison equation and used to investigate stem breakage as well as wave attenuation during storms möller et al 2014 vuik et al 2018 our model results indicate that the wave kinematics in particular is sensitive to the vegetation flexibility i e bending stiffness of the vegetation stem calibration is thus required to determine the appropriate bending stiffness and possibly the drag and inertia coefficients as well in the present study the drag inertia coefficient is assumed to be constant along the vegetation stem and over time this assumption may not be valid for flexible vegetation behaving like either a cantilever or a whip dijkstra and uittenbogaard 2010 paul et al 2012 luhar and nepf 2016 it is tempting to propose a spatially and time varying drag inertia coefficient but this warrants significant additional experimental and analytical work luhar et al 2010 nevertheless it is straightforward to incorporate this modification in the present model in the future since the fem vegetation model is robust in accounting for the spatial variations of geometric and mechanical properties of the vegetation stem this sensitivity of model results to the vegetation flexibility may be partly associated with the limitation of the coupling between wave and vegetation model mattis et al 2015 which does not resolve the geometry of the vegetation stem but resorts to empirical drag and inertia coefficients to obtain the hydrodynamic force on the vegetation considering the magnitude difference between the fluid grid o 2 cm and the stem s cross section o 0 1 cm it requires a lot of cpus to conduct a direct simulation such as those by maza et al 2015a and chakrabarti et al 2016 to resolve the geometry of each stem within the vegetation patch the high resolution coupled flow vegetation model complements experimental studies to examine the flow turbulence and mixing in coastal canopies e g abdolahpour et al 2018 in addition the possible contact and wake interactions between neighboring stems are not considered by the present model which may also affect the model performance the stem interactions may be accounted for by adding a damping term in the governing equations of vegetation motion and then calibrate the unknown damping coefficient against the observed vegetation motion acknowledgements the authors gratefully acknowledge the support of the physical oceanography program of national science foundation under award 1436642 the first author is indebted to the correll and the george caterina sakellaris graduate fellowship for supporting part of his phd study the authors wish to thank mr stephen cousins and advanced computing group in the university of maine system for the computational support the second author was supported by nerc grant ne e0002129 1 appendix a matrices and force vectors in the fem formulation a1 m i j l k 0 l ρ v a l a k δ i j d s a2 m i j l k a ρ a v c a 0 l a l a k δ i j d s 0 l a l a k a s a t d s u i t u j s a3 k i j l k 1 0 l e i a l a k δ i j d s a4 k n i j l k 2 0 l p n a l a k δ i j d s a5 f i l 0 l w i f i d a l d s a6 a m i l 1 2 0 l p m a i a l d s a7 b m 1 2 0 l p m d s a8 c m n 1 e a 0 l p m p n d s where mijlk is the consistent mass matrix m i j l k a the added mass matrix k i j l k 1 the stiffness matrix due to bending resistance k n i j l k 2 the stiffness matrix arising from the rod tension and curvature δ ij the kronecker delta function w i the net weight of the rod and f i d is the hydrodynamic force excluding the added mass effect which is incorporated into the added mass matrix m i j l k a appendix b grid size effect on vegetation motion and wave kinematics grid convergence study has been conducted to assess the grid size requirement for the coupled wave vegetation model the computational domain shown in fig 7 is first meshed uniformly with a base grid and then refined with finer grids in the vicinity of the free surface as listed in table b1 three sets of fluid grids are used and the total number of cells for the fluid domain is approximately 170 k 324 k and 649 k respectively each stem of the vegetation is discretized uniformly with elements of equal length 9 cm and 4 5 cm for grid sets 1 2 and 3 which correspondingly leads to 6 and 12 elements for each stem the bending stiffness for each vegetation stem is assumed to be 0 06 nm2 10 ei as assessed in section 4 2 fig b1 shows the grid size effect on extreme configurations and tip displacement history of a representative vegetation stem fig b2 shows the grid size effect on the vertical distribution of wave kinematics and mean current at x 40 36 m it can be observed in both figures that these results are not very sensitive to the grid size tested therefore the grid set 2 is selected considering the balance between accuracy and computational time 
693,we investigated the high schmidt number mass transfer of dissolved oxygen do from turbulent flows to a permeable microbial sediment bed by large eddy simulations over the schmidt number range of 100 sc 690 the three dimensional open channel flows were numerically obtained using a fractional step finite difference method for a friction reynolds number of re τ 180 the bottom sediment layer populated with do absorbing bacteria was described by a generalized darcy brinkman forcheimer model coupled with a biogeochemical model the dependence of the mass transfer on the intrinsic variable of the sediment bed permeability porosity and microbial biomass were analyzed using the statistical turbulent quantities including the mean velocity mean concentration turbulent intensity and instantaneous flow and scalar characteristics such as the fluctuating velocity and do concentration fields especially near the sediment water interface this study revealed that the role of turbulence in the do transfer process increases with the darcy number and with increasing porosities of the permeable sediment bed concerning do transport from turbulent flows to a highly permeable sediment bed the turbulent diffusion by large scale motion is more important than viscous diffusion in the mass transfer process near the sediment water interface this process can be further accelerated with an increase in the turbulence intensity an increase in the microbial biomass and a reduction in the schmidt number leads to an enhanced sediment oxygen demand keywords mass transfer high schmidt number porous sediment layer dissolved oxygen large eddy simulation nomenclature c resolved concentration in the water body cs do concentration in the sediment layer c concentration fluctuation horizontal as well as time averaging c saturated concentration da darcy number ds molecular diffusivity in the sediment layer g sgs model coefficient h height of the channel j do vertical flux of molecular diffusion κ permeability k mass transfer coefficient k o 2 dimensionless half saturated coefficient k o 2 dimensional half saturated coefficient p resolved modified pressure qi sgs scalar flux re τ reynolds number s i j resolved strain rate tensor sc schmidt number in the water layer scs schmidt number in the sediment layer sct sgs model coefficient do dissolved oxygen sod sediment oxygen demand swi sediment water interface t time u i resolved velocity in the water body u i velocity fluctuating component u τ friction velocity x y z streamwise vertical and spanwise coordinates y vertical coordinate normalized by friction velocity yc effective yield for do utilization greek δ sediment layer thickness δ p do penetration depth δ i1 driven pressure gradient τ ij sgs stress tensor ρ fluid density ν molecular kinematic viscosity χ dimensionless microbial biomass χ dimensional microbial biomass ϕ porosity δ size of the grid filter δ size of the test filter subscripts rms root mean square superscript sa superficial volume average ia interstitial volume average 1 introduction dissolved oxygen do is significant for the survival and reproduction of organism in rivers lakes and oceans do comes from the supply of oxygen in the air and photosynthesis of phytoplankton the complex phenomena of do are high schmidt number passive scalar transports which is connected with the salinity barometric pressure and especially temperature the oxygen content in freshwater exceeds that in seawater the do content decrease with an increase in water temperature and a decrease in atmospheric pressure oxygen is also consumed by organic matter decomposition of do absorbing bacteria in the sediment layer and the respiration of aerobilet and reducing substances such as sulfide nitrite and ferrous ion once the oxygen uptake becomes unsustainable for an aquatic organism anoxic dead zones diaz and rosenberg 2008 rabalais et al 2009 are formed that result in excessive propagation of anaerobic bacteria furthermore the water quality will deteriorate and the local ecosystem will be threatened due to the imbalance of the oxygen content therefore the amount of do is an essential measurement criterion for the self purification ability of a water body because of the significance of monitoring the do for an ecotope and its aquaculture it is necessary to understand how do transfers through the sediment water interface swi and how much do is consumed by do absorbing microbes in the sediment layer some researchers have paid special attentions to studying do transport in the sediment layer diffusion advection and dispersion of boundary layer turbulence across the swi by field observation laboratory experiments and numerical simulations lorke et al 2003 carried out field observations in lake alpnach switzerland where the porosity of the sediment layer is greater than 0 95 the results showed how periodically varying turbulence flows change the thickness of the diffusive boundary layer and the do vertical flux at the swi later bryant et al 2010a b also performed situ measurements at the same location and analyzed the relationships among the turbulent intensity the do vertical distribution the do vertical flux and the sediment oxygen demand sod at the swi steinberger and hondzo 1999 experimentally measured the vertical distributions of the velocity and do concentration in a closed loop recirculating square duct with an artificial or a natural sediment at different reynolds numbers from 0 to 7000 they analyzed the influence of the turbulent velocity field on the thickness of the diffusive boundary layer on the sherwood number and on the do vertical flux at the swi and obtained the empirical relationships using a laboratory recirculating flume and open channel o connor and hondzo 2008 designed five cases for different temperatures corresponding to varying reynolds numbers and schmidt number the authors evaluated the relationship among the reynolds number the schmidt number and the sherwood number using thin film and surface renewal theories that coincided highly with a s semi analytical similarity model the transfer of do from fluid flows to organic sediment beds has also been numerically investigated some researchers ditoro et al 1992 nakamura and stefan 1994 boudreau and jorgensen 2001 house 2003 adopted the monod equation to describe microbial do absorbing processes in sediment and to estimate the sod which displayed a high degree of agreement with the experimental data fair et al 1941 boynton et al 1981 house 2003 consequently higashino et al 2004 first performed a numerical simulation to solve the unsteady do diffusion and absorption equation coupled with the monod equation and found a one dimensional solution for the reynolds averaged equations for the water layer transport by applying the crank nicolson finite difference form for strong biochemical activities in the sediment and for a high shear velocity the sod is greater and approaches steady state faster than for low values higashino et al 2009 described the pore water flow with a two dimensional continuity equation and darcy s law they simulated the oscillatory fluid motions induced by periodic pressure fluctuations above the swi scalo et al 2012 investigated the mechanisms involved in the do transfer from a turbulent flow to an underlying organic sediment bed populated with do absorbing bacteria by large eddy simulation les they found that there are three distinct transport processes turbulent transport within the viscous sublayer molecular mass transport across the diffusive sublayer and transport within the sediment layer usually a sediment bed can be approximately treated as the homogeneous and isotropic porous medium in numerical studies higashino et al 2004 higashino et al 2009 scalo et al 2012 a porous medium is mainly characterized by the permeability and porosity as far as the do transfer and consumption process are concerned most of the aforementioned numerical investigations assumed that the typical sediment bed has a low permeability and they assumed the flow state in the sediment bed is steady or very slow it was reasonable to apply darcy s law for low permeability in those studies to simulate the interstitial flow which depended mainly on the permeability however in other cases the sedimentary layer is composed of fine gravels or sands rather than cohesive silt the flow overlying sediment is turbulence with higher reynolds number and the interstitial velocity underlying bed is faster than that in lowly permeable bed the velocity is not linearly dependent on the hydraulic gradient thus darcy s law is not applicable to describe the kind of the flow of the sediment bed bear 1972 this is why we apply a more generalized model of porous flow that was derived from the darcy brinkman forchheimer dbf model nithiarasu et al 1997 tang et al 2014 to describe the flow in a highly permeable sediment bed breugem et al 2006 verified that the volume averaged navier stokes vans equations can be used for an accurate simulation of the turbulent flow over and through a permeable wall these equations were solved in a dns of a turbulent channel flow with a lower permeable wall consisting of a three dimensional cartesian grid of cubes this gave us confidence in using the vans equations with the dbf model in the present study in which we again consider the flow in a plane channel with a more permeable wall in this paper the large eddy simulation les technique was employed to investigate the turbulence for high wall permeability at which there is exchange of momentum and a scalar across the swi the three dimensionally resolved incompressible navier stokes equations and the do concentration equation were simultaneously solved by the fractional step method dong et al 2002 the dynamic models germano et al al 1991 for sgs stresses and scalar fluxes were used to close these equations this work focuses on the properties of the fluctuating concentration field and its relation to the velocity fluctuations in the swi region as well as the dependence of mass transfer on the intrinsic variable of a sediment bed the validations of the present numerical model were tested by comparison with the typical experiment and the simulation results given by komori et al 1993 nagano and shimada 1996 handler et al 1999 wang et al 2005 and o connor and hondzo 2008 these results confirmed that les is reliable for predicting statistical quantities of a turbulent flow and for a high schmidt number scalar field and do concentration near swi the remainder of the paper is organized as follows the governing equations and dynamic subgrid scale model for the turbulent stresses and mass fluxes in the water layer and sediment are described in section 2 the numerical method is briefly given in section 3 in section 4 some relevant quantities including the mean and fluctuating resolved velocity concentrations and flow structures based on the velocity vorticity and concentration fluctuations are discussed finally we present the study s conclusions in section 5 2 mathematical formulations in this study we consider the flow geometry as sketched in fig 1 the upper boundary is a free surface the lower wall is a microbial sediment bed the lower side of the sediment bed is bound by a solid wall and then we distinguish between two regions a the fluid region is between y δ and y h in which the porosity is equal to unity b the homogeneous sediment region between y 0 and y δ with a constant porosity in this work the continuum approach has the flow inside the permeable sediment bed modeled as a continuum which is coupled to the flow over the swi below we discuss how the flow is described in each region as already mentioned in section 1 the approach followed here has been successfully validated in breugem et al 2006 and tang et al 2014 2 1 governing equations in the water region mathematical formulations are determined by simultaneously solving the three dimensional time dependent filtered incompressible navier stokes equations and oxygen concentration conservation equation simultaneously with no significant surface deformations or buoyancy effects to nondimensionalize the governing equations as exhibited diagrammatically in fig 1 height hof the open channel is applied as the length scale the wall friction velocity u τ is defined as the velocity scale and the difference of the do concentration between the upper surface and lower wall δc is defined as the concentration scale accordingly the nondimensional governing equations are given as 1 u i x i 0 2 u i t x j u i u j p x i 1 r e τ 2 u i x j x j τ i j x j δ i 1 3 c t x j c u j 1 r e τ s c 2 c x j x j q j x j where τ i j r i j δ i j r k k 3 r i j u i u j u i u j q i c u j c u j and overbar represents a resolved component by applying a spatial filtering operator the filter used is a top hat filter composed of three one dimensional 3 point discrete filters moin and kim 1982 breugem et al 2006 δ i1 is the nondimensionalized constant pressure gradient imposed in the streamwise direction it means one kind of body force to supply momentum to the fluid and to maintain the flow in the streamwise direction the reynolds number re τ is defined as r e τ u τ h ν the schmidt number sc as s c ν d w where ν is the kinematic viscosity and dw is the molecular diffusivity of do in the water in the problem of do transfer by fluid flow the schmidt number can be up to hundreds for do in water and the do in the fluid behaves as a passive scalar that does not influence the flow dynamics with a very low molecular diffusivity compared to the kinematic viscosity p is the resolved modified pressure which contains the term rkk 3 the resolved velocity u i i 1 2 3 for writing convenience is represented as u v and w in the streamwise x spanwise y and vertical z directions respectively in eqs 2 and 3 τ ij and qi represent the subgrid scale sgs stress and scalar flux to close the governing equations and are respectively given as 4 τ i j 2 g δ 2 s s i j 5 q j g δ 2 s c t s c x j where s i j 1 2 u i x j u j x i is the filtered strain rate tensor and its magnitude is s 2 s i j s i j 1 2 one major drawback of the eddy viscosity sgs stress models used in les is their inability to represent correctly in sheared flows near solid walls we applied a dynamic sgs model proposed by germano et al 1991 to alleviate these drawbacks the coefficients g and sct in eqs 4 and 5 need be dynamically determined by a least square approach as presented in detail in germano et al 1991 and dong et al 2003 after introducing test filtering with a filter width of δ to eqs 1 3 in this equation α δ δ is given as 2 2 2 governing equations in the sediment bed the sediment bed is set to a depth of δ 0 08 h which is treated as the homogeneous porous bed shown in fig 1 for an accurate description of flow over a permeable wall at high permeability the flow inside the sediment itself also has to be described by means of a volume averaged continuity and momentum equations that are valid everywhere in the system composed of a porous medium and the overlying fluid flow the dimensionless volume averaged navier stokes vans equations breugem et al 2006 in the sediment region are given as follows according to the modified darcy brinkman forcheimer dbf model 6 u i s a x i 0 7 u i s a t x j u i s a u j s a φ φ p s a x i 1 re τ 2 u i s a x j x j 1 φ τ i j x j φ δ i 1 φ r e τ d a u i s a b a u i s a u s a 2 j j d a φ where superscript sa represents a component by applying superficial volume average which acts as a spatial filter the last two terms on the right hand side of the eq 8 are the matrix drag per unit volume of the porous medium ergun 1952 constants a 150 and b 1 75 are given by ergun s empirical formulas ϕ is the porosity of the medium and darcy number d a κ h 2 represents the effect of permeability κ in eq 7 moreover eqs 6 and 7 are equivalent to the standard navier stokes equations in the fluid domain when the porosity tends to be unity and the permeability is approximately infinite to solve the vans equations closures are required for the subfilter scale stress and the drag force in terms of volume averaged quantities this is the meaning of the overbar for the variables strictly speaking parameterization for drag has been proposed and validated for steady state flow through porous media so in terms of time averaged velocities however as we have addressed fully developed turbulent open channel flow which reaches a statistically steady state when the equations are integrated forward in time meantime the turbulent flow is homogeneous in the streamwise and spanwise directions therefore the parameterization for drag used here is reasonable with spatially averaged the horizontally averaged as well as time averaged instantaneous velocities the scalar transport equation which adopts monod type kinetics for do uptake is written as 8 c s t x j c s u j i a 1 r e τ s c s 2 c s x j x j q j x j 1 y c μ χ c s k o 2 c s χ where cs is the normalized do concentration in the sediment layer the volume average of the concentration quantity the superscript ia represents a component by applying interstitial volume average and then u j i a is the jth component of the interstitial velocity according to the definitions of the superficial volume average and the interstitial volume average breugem et al 2006 the two averages are related as u j i a u j s a φ the schmidt number scs in the sediment is defined as 9 s c s ν d s where the relationship between molecular diffusivity ds in the sediment bed and dw in the water boudreau 1996 boudreau and jorgensen 2001 is 10 d s φ 2 d w for φ 0 7 11 d s φ 3 d w for 0 7 φ 1 the third term in eq 9 is the sink term which represents the do absorption by organic matter and is parameterized as 12 k o 2 k o 2 c μ χ μ χ h u τ χ χ c where μ χ is the maximum specific do utilization rate in day 1 k o 2 is the half saturation coefficient for do utilization in mgl 1 yc is the effective yield for the microbial utilization of do and χ is the biomass concentration of oxygen absorbing organisms in mgl 1 the values for these constants as suggested by higashino et al 2008 are shown in table 1 2 3 initial boundary and interface conditions the initial velocity field used in the present work was interpolated onto the present collocation points from the large eddy simulation of dong et al 2003 the velocity field then integrated forward in time until the flow reaches a statistically steady state once the velocity field reaches the statistically steady state the statistical sample was further increased by averaging over horizontal planes homogeneous directions in this paper the statistical quantities for example the mean velocity and mean concentration indicate a time and spatial averaging over x z and t the sediment layer is bounded by an impermeable bed where the no slip and no penetration boundary conditions apply hence at the bottom wall y 0 we have 13 u 0 v 0 w 0 the boundary condition imposed on a top free surface at y 1 is shear free with no deformation 14 v 0 u y w y 0 both the flow and the concentration field are assumed to be statistically homogeneous in the streamwise x and spanwise z directions thus periodic boundary conditions are applied in both directions two different constant concentrations are imposed on the free surface and on the bottom wall respectively 15 c 1 at y 1 16 c 0 at y 0 the mass transfer computation was started after the flow field reached a fully developed turbulent state the initial concentration field was set to be a linear distribution along the y direction and homogeneous in the horizontal planes in general at the sediment fluid interface the total stress carried by a fluid freely flowing over the interface equals the sum of the stresses transferred to the fluid within the sediment bed and that transferred to the sediment material a momentum transfer conditions based on a momentum transfer coefficient α as suggested by rosti et al 2015 model the transfer of stress at the interface 17 κ u y 1 ɛ u y α u 18 κ w y 1 ɛ w y α w in eqs 17 and 18 a negative α quantifies the amount of stress transferred from the free fluid to the porous matrix a positive α quantifies the amount of stress transferred from the porous matrix to the free fluid in this study we assumed that the total stress carried by the water freely flowing over the interface is fully transferred to the fluid within a highly permeable sediment bed which is composed of fine gravels rather than cohesive silt we assumed that the total stress carried by the water freely flowing over the interface within a highly permeable sediment bed which is composed of fine gravels rather than cohesive silt based on this assumption the stress carried by the free fluid is fully transferred to the fluid i e α 0 then the continuity condition and stress balance in at the porous fluid interface reduces to a fully continuity condition as the eqs 20 and 22 19 u u v v w w 20 u y 1 φ u y 21 w y 1 φ w y 3 numerical method and grid parameters to carry out this les a fractional step method developed by kim and moin 1985 and verzicco and orlandi 1996 was applied to solve the governing equations for turbulent open channel flow the time advancement scheme was the three step runge kutta scheme for the convective term and the crank nicolson scheme for the viscous terms spatial derivatives were discretized by a second order central difference in our calculation the reynolds number re τ is 180 the computational domain was 2πh h πh with corresponding grid numbers of 128 192 128 in the x yand zdirections respectively the selective computation domain ensured that the two point correlations separated by these length scales were negligibly small the grid convergence test was performed in advance it was uniform for grids along the xand zdirections the resolutions of which were δ x u τ δ x ν 8 84 and δ z u τ δ z ν 4 42 to increase the grid resolution of the vertical direction y near the wall and the free surface the mesh size δy was in the range of 0 10 to 2 11 which was stretched following a classical coordinate transformation moin and kim 1982 that was sufficient to resolve the viscous sublayer and diffusive sublayer near the swi and other boundary zones 4 results and discussion 4 1 validations first a simulation of passive scalar transport in a fully developed turbulent open channel flow with a smooth impermeable wall was carried out at re τ 180 and was compared with the typical experiment and the simulation results given by komori et al 1993 handler et al 1999 and wang et al 2005 the setup of present case was shown in section 3 fig 2 shows the mean velocity profile u unless otherwise stated in this section indicates horizontal as well as time averaging for all cases reported in this paper the calculated mean velocity profiles are in good agreement with each other as well as with the aforementioned experimental data and the dns les results fig 3 shows the profile of the mean concentration normalized c by the frictional concentration for high schmidt number mass transfer experimental and computational data by nagano and shimada 1996 and with the les data by wang et al 2005 with the same reynolds number are given in fig 3 the mean concentration coincides well with both results are still in good agreement with each other through the above verifications the reliability of our procedure was confirmed to predict the statistical quantities of the turbulent open channel flow and mass transfer at high schmidt numbers then considered the presence of the sediment layer the our numerical study and in particular the range of parameters used is designed to allow a comparison to the laboratory data from o connor and hondzo 2008 table 2 shows the flow parameters of the numerical simulation for three water temperatures 15 c 25 c 30 c with the corresponding schmidt numbers of 690 373 291 respectively of note sc increases for lower temperatures the height of the channel flow is h 10 cm in the simulations the statistical parameters at different darcy numbers and porosities at 25 c are shown in table 4 we now compare predictions of the present numerical model with the experimental results reported by o connor and hondzo 2008 in fig 4 we present the comparison between one present case and the experimental data for exp 2 under the condition which the physical parameters are mostly same to each other except sc 373 set here but sc 358 in their experiment we shift the location of the swi to y 0 08 to normalize the coordinates between the simulation case and the exp 2 the mean concentration profile computed in good agreement with those from the experiments according to the comparison and the validation above it can be confirmed that the present model and code are reliable for the prediction of statistical quantities of oxygen transfer to organic sediment beds in the turbulent flow this agreement gives also an additional support to the experimental and numerical results and experimental data of higashino et al 2008 for oxygen transfer from flowing water to organic sediment bed this will be evident in the discussion presented in 4 2 and 4 3 4 2 effects of the sediment bed s intrinsic properties on the do concentration fields we investigated the relationship between the transport of momentum and the do scalar concentration at the swi with the sediment bed s intrinsic permeability and porosity which are denoted as da and ϕ respectively in table 3 δ p represents the depth of do penetration from the swi to the maximum depth where c is greater than 10 2 sod sediment oxygen demand is a component of the do balance of natural water bodies such as a river section or a lake the dimensionless sod is expressed by 22 sod 0 δ 1 y c μ χ c k o 2 c χ d y the do transfer in the vertical direction is divided into two terms viscous diffusion which is separately represented as j d w c y or d s c y using fick s first law of diffusion and turbulent mass flux which is represented as c v the fluxes of do at the swi are described respectively as j δ d w c y y δ and c v δ to examine the dynamics of do transport the mean do concentration normalized by the friction concentration at the shear free surface is defined as 23 c c y c f τ where c f τ is defined as 24 c f τ d w u τ c y y h the mass transfer coefficient at the free surface and swi are defined respectively as 25 k f d w c u τ c y y h 26 k δ d w c u τ c y y δ in this section the black vertical dashed lines in all figures represent the swi which is located on y 0 08 or y 14 4 with wall unit fig 5 displays the streamwise velocity profiles of the time averaged and the horizontally averaged which is normalized by the bulk mean velocity ub the mean velocity still obeys the law of wall which is not affected by the presence of the sediment layer in fig 5a a zoomed view of the velocity profile near the interface between the fluid region and the sediment layer is shown in the fig 5b the velocity profile on the two sides of the interface has different slopes and the velocity decreases with a decrease in da and ϕ in the sediment layer shown by the arrow this suggests that with a lower permeability of the sediment the flow in the bed will be slower fig 6 shows the rms intensity of velocity fluctuations and the reynolds stresses as a function of y the presence of velocity fluctuations demonstrates that strictly speaking the vans filtered flow inside the sediment slab is not fully laminar although the magnitude of the fluctuations is small this also exhibits that the sediment bed leads to a significant increase in the wall normal and spanwise rms velocities as da and ϕ increase effect whereas the streamwise rms velocity remains unchanged the above trends of rms velocity and intensity are in good agreement with the fig 12 in breugem et al 2006 in the case e95 in which the permeable wall is highly permeable to examine the above phenomena we provide the instantaneous streamwise vortices near the swi with the q criterion hunt et al 1988 as shown in fig 7 these energetic eddies form high speed streaks in the region near the swi the vortex structures reduce and the turbulence motion is more moderate at the sediment layer as the darcy number or porosity decreases as shown from the above results the impact of permeability on the mean velocity and on the vortices is more significant than that of the porosity in agreement with breugem et al 2006 it can be inferred that the near wall structure of the turbulent flow is affected too as this peak is connected with the presence of high and low velocity streaks fig 8 shows the effects of the sediment bed s permeability and porosity on do concentration the concentration increases in the sediment bed but decreases far away from the swi y 0 when da or ϕ increases as shown in fig 8a this trend is consistent with the instantaneous streamwise vortices near the swi as shown in fig 7 this leads to a faster do consumption and more do demand from the air when the flow velocity is slower peaks in the concentration fluctuation near the swi move along the direction from the sediment layer to the water layer as shown in fig 8b although diffusion and advection both affect the mean and rms do concentration in the sediment layer there are some different behaviors between them there is a local extremum of the concentration fluctuation hidden in the sedimentary layer at approximately 10 y 15 then the rms values rapidly weakens at the water side as shown in fig 8b however there are no such peak values for the mean concentration that increases monotonously from the sediment bed to the water body as shown in fig 8a the concentration fluctuations near the free surface at different da or ϕ show little change of which the peak values are approximately half of the maximal values near the swi not shown here do turbulent diffusion is denoted by a quicker concentration flux increases accordingly due to the enhanced vertical velocity fluctuation as shown in fig 8c and do penetrates more deeply as shown in table 4 because the turbulent intensities are stronger as shown in fig 6 this suggests that the turbulent diffusion is the dominant mechanism in the mass transfer and an order of magnitude greater than viscous diffusion when dissolved oxygen transports from across the sediment water interface to the bed due to the vertical turbulent fluctuation moreover fig 9 shows the contours of the instantaneous streamwise velocity fluctuation and do concentration fluctuation in a wall parallel plane under the swi y 12 for different darcy numbers in which the effects of permeability of the bed on the instantaneous flow and concentration fields are clearly observed including organized streaks for the low and high fluctuation this implies that wall permeability alters the structure of turbulence and the scalar field exhibits the same elongated structure in the streamwise direction that these behaviors were reported by scalo et al 2012 and tang et al 2014 the patterns notably illustrate the evolution of concentration fluctuation with absent and dense streaky structures for different darcy numbers this behavior is consistent with the profiles of the concentration fluctuation in fig 8b nearby the sediment layer dense and long streaky structures appear in fig 9a at a high darcy number however no streaky structures are visible at a low darcy number as shown in fig 9c 4 3 effects of schmidt number and microbial biomass on the do concentration field the oxygen concentration field is modeled typically as a high schmidt number passive scalar where the schmidt number may be up to hundreds in water according to the different local temperatures for a better understanding of the mechanisms affecting the turbulent mass transfer from the swi it is helpful to simultaneously examine the concentration and velocity fluctuations and their correlations in fig 10 a and b the mean do concentration profiles and rms fluctuations are shown for schmidt numbers of 291 373 and 690 corresponding to the local temperatures of 30 c 25 c and 15 c respectively at different schmidt numbers the logarithmic law still exists asc 2 12ln y α sc ref kader et al 1972 a lower temperature corresponding to a higher schmidt number results in a do concentration and its fluctuation in the whole channel becoming higher than in high temperature environment this indicates that more intense do transport and more do consumption appear both inside the sediment bed and near the bed region for lower schmidt number although the previous comparisons are encouraging the best test for validating the scalar part of our simulations lies in the prediction of the mass transfer coefficient in fig 10c we give the schmidt number dependence of turbulent mass transfer coefficients at the free surface as well as at swi the slope of the lines at the interface and free surface reported here are approximately parallel to the correlation between k f or k δ and sc of the literatures corresponding to theoretical and experimental results kader et al 1972 rashidi et al 1991 lorke et al 2003 o connor and hondzo 2008 shaw and hanratty 2010 in the presence of an organic mass absorbing sediment layer shaw and hanratty 2010 performed experiments and found k δ β r e s c 0 704 at the interface and o connor and hondzo 2008 suggested the scdependence of k f as k δ β r e s c 2 3 on the other hand kader et al 1972 proposed theoretically k f β r e s c 1 2 near the free surface for sc thus the good agreement obtained with various experimental results allows us to conclude that the present les approach is able to predict quantitatively mass transfer at the free surface and the interface even at high schmidt number to clearly depict the effects of the schmidt number on the do transfer some typical statistical quantities shown in table 4 and were analyzed which include the normal fluxes of viscous diffusion and turbulent diffusion c v δ and jδ uτc at the swi and at the free surface the do penetration depth δ p the dimensionless friction concentration c f τ c and the sod for a higher temperature the do penetration is deeper despite the more intense do transport and higher do consumption most of the aforementioned statistical parameters obviously negatively correlate with schmidt number and positively correlate with the temperature we now examine the relationship between the dissolved oxygen concentration and the microbial biomass concentration of oxygen absorbing organisms the oxygen consumption rate at the sediment water interface is dependent on the biomass concentration of oxygen absorbing bacteria we need to understand how the bacterial population χ impacts the variation of do at the swi in these simulations the microbial concentrations were chosen to be 300 500 700 and 1000 mgl 1 the sediment oxygen demand and do penetration depth display nearly a linear relationship with bacterial concentration as shown in fig 11 thus the turbulent diffusion animates strong biochemical activities characterized by the high value of χ consuming large amounts of dissolved oxygen in addition c in the sediment bed falls off and further leads to a greater supply of oxygen from the air therefore the reproduction of aerobic bacteria has a significant influence on the entire channel moreover the statistical parameters including the normal fluxes of the viscous diffusion and turbulent mass flux due to the turbulent diffusion c v δ and jδ uτc at the swi the do penetration depth δ p the dimensionless friction concentration c f τ c and the sod are shown in table 5 different microbial concentrations χ of 300 500 700 and 1000 mgl 1 most of the aforementioned statistical parameters have an obviously positive correlation with the microbial biomass concentration except for the do penetration depth this indicates that increasing the bacterial population χ determines the enhancement the sod and results in a smaller penetration depth in the sediment layer 5 conclusion in this paper we presented the dependence of a high schmidt number dissolved oxygen distribution of on the material properties of sediment bed permeability porosities and on microbial biomass in turbulent flows these properties were obtained by solving the dimensionless navier stokes equations and concentration equation in an open channel across the swi configuration with schmidt numbers sc increasing from 100 to 690 using large eddy simulations the new model strategy is that the underlying permeable sediment is described by a darcy brinkman forcheimer model combined with a biogeochemical model dynamic sgs models for the turbulent stresses and mass fluxes were used to close the governing equations in this paper we aim to reveal the interactions among the processes involved in do transfer across the sediment water interface swi and absorption by a highly permeable sediment bed the instantaneous and time averaged flow and do concentration fields were investigated which showed that the turbulent diffusion is the major mechanisms to do transport the flow speeds up in the sediment layer as the darcy number da and porosity φ increases and large amplitudes of velocity fluctuations are associated with an increased oxygen concentration and fluctuations a higher temperature lower sc results in a lower do concentration a more intense do diffusion and more do consumption strong microbial activities in the sediment layer produce a greater sod shallower do penetration and a stronger do diffusion increase in the concentration fluctuation near the swi follow move along the direction from the sediment layer to the water layer when the flow velocity is slower for a large permeability the wall is classified as a highly permeable wall near which viscous effects are of minor importance therefore turbulent diffusion is the prime mechanism of do transfer and it is an order of magnitude greater than viscous diffusion the supply of do is faster from the atmosphere because of more do demand and a stronger diffusion acknowledgments the project was supported by the national natural science foundation of china nos 11572183 91852111 and 11825204 
693,we investigated the high schmidt number mass transfer of dissolved oxygen do from turbulent flows to a permeable microbial sediment bed by large eddy simulations over the schmidt number range of 100 sc 690 the three dimensional open channel flows were numerically obtained using a fractional step finite difference method for a friction reynolds number of re τ 180 the bottom sediment layer populated with do absorbing bacteria was described by a generalized darcy brinkman forcheimer model coupled with a biogeochemical model the dependence of the mass transfer on the intrinsic variable of the sediment bed permeability porosity and microbial biomass were analyzed using the statistical turbulent quantities including the mean velocity mean concentration turbulent intensity and instantaneous flow and scalar characteristics such as the fluctuating velocity and do concentration fields especially near the sediment water interface this study revealed that the role of turbulence in the do transfer process increases with the darcy number and with increasing porosities of the permeable sediment bed concerning do transport from turbulent flows to a highly permeable sediment bed the turbulent diffusion by large scale motion is more important than viscous diffusion in the mass transfer process near the sediment water interface this process can be further accelerated with an increase in the turbulence intensity an increase in the microbial biomass and a reduction in the schmidt number leads to an enhanced sediment oxygen demand keywords mass transfer high schmidt number porous sediment layer dissolved oxygen large eddy simulation nomenclature c resolved concentration in the water body cs do concentration in the sediment layer c concentration fluctuation horizontal as well as time averaging c saturated concentration da darcy number ds molecular diffusivity in the sediment layer g sgs model coefficient h height of the channel j do vertical flux of molecular diffusion κ permeability k mass transfer coefficient k o 2 dimensionless half saturated coefficient k o 2 dimensional half saturated coefficient p resolved modified pressure qi sgs scalar flux re τ reynolds number s i j resolved strain rate tensor sc schmidt number in the water layer scs schmidt number in the sediment layer sct sgs model coefficient do dissolved oxygen sod sediment oxygen demand swi sediment water interface t time u i resolved velocity in the water body u i velocity fluctuating component u τ friction velocity x y z streamwise vertical and spanwise coordinates y vertical coordinate normalized by friction velocity yc effective yield for do utilization greek δ sediment layer thickness δ p do penetration depth δ i1 driven pressure gradient τ ij sgs stress tensor ρ fluid density ν molecular kinematic viscosity χ dimensionless microbial biomass χ dimensional microbial biomass ϕ porosity δ size of the grid filter δ size of the test filter subscripts rms root mean square superscript sa superficial volume average ia interstitial volume average 1 introduction dissolved oxygen do is significant for the survival and reproduction of organism in rivers lakes and oceans do comes from the supply of oxygen in the air and photosynthesis of phytoplankton the complex phenomena of do are high schmidt number passive scalar transports which is connected with the salinity barometric pressure and especially temperature the oxygen content in freshwater exceeds that in seawater the do content decrease with an increase in water temperature and a decrease in atmospheric pressure oxygen is also consumed by organic matter decomposition of do absorbing bacteria in the sediment layer and the respiration of aerobilet and reducing substances such as sulfide nitrite and ferrous ion once the oxygen uptake becomes unsustainable for an aquatic organism anoxic dead zones diaz and rosenberg 2008 rabalais et al 2009 are formed that result in excessive propagation of anaerobic bacteria furthermore the water quality will deteriorate and the local ecosystem will be threatened due to the imbalance of the oxygen content therefore the amount of do is an essential measurement criterion for the self purification ability of a water body because of the significance of monitoring the do for an ecotope and its aquaculture it is necessary to understand how do transfers through the sediment water interface swi and how much do is consumed by do absorbing microbes in the sediment layer some researchers have paid special attentions to studying do transport in the sediment layer diffusion advection and dispersion of boundary layer turbulence across the swi by field observation laboratory experiments and numerical simulations lorke et al 2003 carried out field observations in lake alpnach switzerland where the porosity of the sediment layer is greater than 0 95 the results showed how periodically varying turbulence flows change the thickness of the diffusive boundary layer and the do vertical flux at the swi later bryant et al 2010a b also performed situ measurements at the same location and analyzed the relationships among the turbulent intensity the do vertical distribution the do vertical flux and the sediment oxygen demand sod at the swi steinberger and hondzo 1999 experimentally measured the vertical distributions of the velocity and do concentration in a closed loop recirculating square duct with an artificial or a natural sediment at different reynolds numbers from 0 to 7000 they analyzed the influence of the turbulent velocity field on the thickness of the diffusive boundary layer on the sherwood number and on the do vertical flux at the swi and obtained the empirical relationships using a laboratory recirculating flume and open channel o connor and hondzo 2008 designed five cases for different temperatures corresponding to varying reynolds numbers and schmidt number the authors evaluated the relationship among the reynolds number the schmidt number and the sherwood number using thin film and surface renewal theories that coincided highly with a s semi analytical similarity model the transfer of do from fluid flows to organic sediment beds has also been numerically investigated some researchers ditoro et al 1992 nakamura and stefan 1994 boudreau and jorgensen 2001 house 2003 adopted the monod equation to describe microbial do absorbing processes in sediment and to estimate the sod which displayed a high degree of agreement with the experimental data fair et al 1941 boynton et al 1981 house 2003 consequently higashino et al 2004 first performed a numerical simulation to solve the unsteady do diffusion and absorption equation coupled with the monod equation and found a one dimensional solution for the reynolds averaged equations for the water layer transport by applying the crank nicolson finite difference form for strong biochemical activities in the sediment and for a high shear velocity the sod is greater and approaches steady state faster than for low values higashino et al 2009 described the pore water flow with a two dimensional continuity equation and darcy s law they simulated the oscillatory fluid motions induced by periodic pressure fluctuations above the swi scalo et al 2012 investigated the mechanisms involved in the do transfer from a turbulent flow to an underlying organic sediment bed populated with do absorbing bacteria by large eddy simulation les they found that there are three distinct transport processes turbulent transport within the viscous sublayer molecular mass transport across the diffusive sublayer and transport within the sediment layer usually a sediment bed can be approximately treated as the homogeneous and isotropic porous medium in numerical studies higashino et al 2004 higashino et al 2009 scalo et al 2012 a porous medium is mainly characterized by the permeability and porosity as far as the do transfer and consumption process are concerned most of the aforementioned numerical investigations assumed that the typical sediment bed has a low permeability and they assumed the flow state in the sediment bed is steady or very slow it was reasonable to apply darcy s law for low permeability in those studies to simulate the interstitial flow which depended mainly on the permeability however in other cases the sedimentary layer is composed of fine gravels or sands rather than cohesive silt the flow overlying sediment is turbulence with higher reynolds number and the interstitial velocity underlying bed is faster than that in lowly permeable bed the velocity is not linearly dependent on the hydraulic gradient thus darcy s law is not applicable to describe the kind of the flow of the sediment bed bear 1972 this is why we apply a more generalized model of porous flow that was derived from the darcy brinkman forchheimer dbf model nithiarasu et al 1997 tang et al 2014 to describe the flow in a highly permeable sediment bed breugem et al 2006 verified that the volume averaged navier stokes vans equations can be used for an accurate simulation of the turbulent flow over and through a permeable wall these equations were solved in a dns of a turbulent channel flow with a lower permeable wall consisting of a three dimensional cartesian grid of cubes this gave us confidence in using the vans equations with the dbf model in the present study in which we again consider the flow in a plane channel with a more permeable wall in this paper the large eddy simulation les technique was employed to investigate the turbulence for high wall permeability at which there is exchange of momentum and a scalar across the swi the three dimensionally resolved incompressible navier stokes equations and the do concentration equation were simultaneously solved by the fractional step method dong et al 2002 the dynamic models germano et al al 1991 for sgs stresses and scalar fluxes were used to close these equations this work focuses on the properties of the fluctuating concentration field and its relation to the velocity fluctuations in the swi region as well as the dependence of mass transfer on the intrinsic variable of a sediment bed the validations of the present numerical model were tested by comparison with the typical experiment and the simulation results given by komori et al 1993 nagano and shimada 1996 handler et al 1999 wang et al 2005 and o connor and hondzo 2008 these results confirmed that les is reliable for predicting statistical quantities of a turbulent flow and for a high schmidt number scalar field and do concentration near swi the remainder of the paper is organized as follows the governing equations and dynamic subgrid scale model for the turbulent stresses and mass fluxes in the water layer and sediment are described in section 2 the numerical method is briefly given in section 3 in section 4 some relevant quantities including the mean and fluctuating resolved velocity concentrations and flow structures based on the velocity vorticity and concentration fluctuations are discussed finally we present the study s conclusions in section 5 2 mathematical formulations in this study we consider the flow geometry as sketched in fig 1 the upper boundary is a free surface the lower wall is a microbial sediment bed the lower side of the sediment bed is bound by a solid wall and then we distinguish between two regions a the fluid region is between y δ and y h in which the porosity is equal to unity b the homogeneous sediment region between y 0 and y δ with a constant porosity in this work the continuum approach has the flow inside the permeable sediment bed modeled as a continuum which is coupled to the flow over the swi below we discuss how the flow is described in each region as already mentioned in section 1 the approach followed here has been successfully validated in breugem et al 2006 and tang et al 2014 2 1 governing equations in the water region mathematical formulations are determined by simultaneously solving the three dimensional time dependent filtered incompressible navier stokes equations and oxygen concentration conservation equation simultaneously with no significant surface deformations or buoyancy effects to nondimensionalize the governing equations as exhibited diagrammatically in fig 1 height hof the open channel is applied as the length scale the wall friction velocity u τ is defined as the velocity scale and the difference of the do concentration between the upper surface and lower wall δc is defined as the concentration scale accordingly the nondimensional governing equations are given as 1 u i x i 0 2 u i t x j u i u j p x i 1 r e τ 2 u i x j x j τ i j x j δ i 1 3 c t x j c u j 1 r e τ s c 2 c x j x j q j x j where τ i j r i j δ i j r k k 3 r i j u i u j u i u j q i c u j c u j and overbar represents a resolved component by applying a spatial filtering operator the filter used is a top hat filter composed of three one dimensional 3 point discrete filters moin and kim 1982 breugem et al 2006 δ i1 is the nondimensionalized constant pressure gradient imposed in the streamwise direction it means one kind of body force to supply momentum to the fluid and to maintain the flow in the streamwise direction the reynolds number re τ is defined as r e τ u τ h ν the schmidt number sc as s c ν d w where ν is the kinematic viscosity and dw is the molecular diffusivity of do in the water in the problem of do transfer by fluid flow the schmidt number can be up to hundreds for do in water and the do in the fluid behaves as a passive scalar that does not influence the flow dynamics with a very low molecular diffusivity compared to the kinematic viscosity p is the resolved modified pressure which contains the term rkk 3 the resolved velocity u i i 1 2 3 for writing convenience is represented as u v and w in the streamwise x spanwise y and vertical z directions respectively in eqs 2 and 3 τ ij and qi represent the subgrid scale sgs stress and scalar flux to close the governing equations and are respectively given as 4 τ i j 2 g δ 2 s s i j 5 q j g δ 2 s c t s c x j where s i j 1 2 u i x j u j x i is the filtered strain rate tensor and its magnitude is s 2 s i j s i j 1 2 one major drawback of the eddy viscosity sgs stress models used in les is their inability to represent correctly in sheared flows near solid walls we applied a dynamic sgs model proposed by germano et al 1991 to alleviate these drawbacks the coefficients g and sct in eqs 4 and 5 need be dynamically determined by a least square approach as presented in detail in germano et al 1991 and dong et al 2003 after introducing test filtering with a filter width of δ to eqs 1 3 in this equation α δ δ is given as 2 2 2 governing equations in the sediment bed the sediment bed is set to a depth of δ 0 08 h which is treated as the homogeneous porous bed shown in fig 1 for an accurate description of flow over a permeable wall at high permeability the flow inside the sediment itself also has to be described by means of a volume averaged continuity and momentum equations that are valid everywhere in the system composed of a porous medium and the overlying fluid flow the dimensionless volume averaged navier stokes vans equations breugem et al 2006 in the sediment region are given as follows according to the modified darcy brinkman forcheimer dbf model 6 u i s a x i 0 7 u i s a t x j u i s a u j s a φ φ p s a x i 1 re τ 2 u i s a x j x j 1 φ τ i j x j φ δ i 1 φ r e τ d a u i s a b a u i s a u s a 2 j j d a φ where superscript sa represents a component by applying superficial volume average which acts as a spatial filter the last two terms on the right hand side of the eq 8 are the matrix drag per unit volume of the porous medium ergun 1952 constants a 150 and b 1 75 are given by ergun s empirical formulas ϕ is the porosity of the medium and darcy number d a κ h 2 represents the effect of permeability κ in eq 7 moreover eqs 6 and 7 are equivalent to the standard navier stokes equations in the fluid domain when the porosity tends to be unity and the permeability is approximately infinite to solve the vans equations closures are required for the subfilter scale stress and the drag force in terms of volume averaged quantities this is the meaning of the overbar for the variables strictly speaking parameterization for drag has been proposed and validated for steady state flow through porous media so in terms of time averaged velocities however as we have addressed fully developed turbulent open channel flow which reaches a statistically steady state when the equations are integrated forward in time meantime the turbulent flow is homogeneous in the streamwise and spanwise directions therefore the parameterization for drag used here is reasonable with spatially averaged the horizontally averaged as well as time averaged instantaneous velocities the scalar transport equation which adopts monod type kinetics for do uptake is written as 8 c s t x j c s u j i a 1 r e τ s c s 2 c s x j x j q j x j 1 y c μ χ c s k o 2 c s χ where cs is the normalized do concentration in the sediment layer the volume average of the concentration quantity the superscript ia represents a component by applying interstitial volume average and then u j i a is the jth component of the interstitial velocity according to the definitions of the superficial volume average and the interstitial volume average breugem et al 2006 the two averages are related as u j i a u j s a φ the schmidt number scs in the sediment is defined as 9 s c s ν d s where the relationship between molecular diffusivity ds in the sediment bed and dw in the water boudreau 1996 boudreau and jorgensen 2001 is 10 d s φ 2 d w for φ 0 7 11 d s φ 3 d w for 0 7 φ 1 the third term in eq 9 is the sink term which represents the do absorption by organic matter and is parameterized as 12 k o 2 k o 2 c μ χ μ χ h u τ χ χ c where μ χ is the maximum specific do utilization rate in day 1 k o 2 is the half saturation coefficient for do utilization in mgl 1 yc is the effective yield for the microbial utilization of do and χ is the biomass concentration of oxygen absorbing organisms in mgl 1 the values for these constants as suggested by higashino et al 2008 are shown in table 1 2 3 initial boundary and interface conditions the initial velocity field used in the present work was interpolated onto the present collocation points from the large eddy simulation of dong et al 2003 the velocity field then integrated forward in time until the flow reaches a statistically steady state once the velocity field reaches the statistically steady state the statistical sample was further increased by averaging over horizontal planes homogeneous directions in this paper the statistical quantities for example the mean velocity and mean concentration indicate a time and spatial averaging over x z and t the sediment layer is bounded by an impermeable bed where the no slip and no penetration boundary conditions apply hence at the bottom wall y 0 we have 13 u 0 v 0 w 0 the boundary condition imposed on a top free surface at y 1 is shear free with no deformation 14 v 0 u y w y 0 both the flow and the concentration field are assumed to be statistically homogeneous in the streamwise x and spanwise z directions thus periodic boundary conditions are applied in both directions two different constant concentrations are imposed on the free surface and on the bottom wall respectively 15 c 1 at y 1 16 c 0 at y 0 the mass transfer computation was started after the flow field reached a fully developed turbulent state the initial concentration field was set to be a linear distribution along the y direction and homogeneous in the horizontal planes in general at the sediment fluid interface the total stress carried by a fluid freely flowing over the interface equals the sum of the stresses transferred to the fluid within the sediment bed and that transferred to the sediment material a momentum transfer conditions based on a momentum transfer coefficient α as suggested by rosti et al 2015 model the transfer of stress at the interface 17 κ u y 1 ɛ u y α u 18 κ w y 1 ɛ w y α w in eqs 17 and 18 a negative α quantifies the amount of stress transferred from the free fluid to the porous matrix a positive α quantifies the amount of stress transferred from the porous matrix to the free fluid in this study we assumed that the total stress carried by the water freely flowing over the interface is fully transferred to the fluid within a highly permeable sediment bed which is composed of fine gravels rather than cohesive silt we assumed that the total stress carried by the water freely flowing over the interface within a highly permeable sediment bed which is composed of fine gravels rather than cohesive silt based on this assumption the stress carried by the free fluid is fully transferred to the fluid i e α 0 then the continuity condition and stress balance in at the porous fluid interface reduces to a fully continuity condition as the eqs 20 and 22 19 u u v v w w 20 u y 1 φ u y 21 w y 1 φ w y 3 numerical method and grid parameters to carry out this les a fractional step method developed by kim and moin 1985 and verzicco and orlandi 1996 was applied to solve the governing equations for turbulent open channel flow the time advancement scheme was the three step runge kutta scheme for the convective term and the crank nicolson scheme for the viscous terms spatial derivatives were discretized by a second order central difference in our calculation the reynolds number re τ is 180 the computational domain was 2πh h πh with corresponding grid numbers of 128 192 128 in the x yand zdirections respectively the selective computation domain ensured that the two point correlations separated by these length scales were negligibly small the grid convergence test was performed in advance it was uniform for grids along the xand zdirections the resolutions of which were δ x u τ δ x ν 8 84 and δ z u τ δ z ν 4 42 to increase the grid resolution of the vertical direction y near the wall and the free surface the mesh size δy was in the range of 0 10 to 2 11 which was stretched following a classical coordinate transformation moin and kim 1982 that was sufficient to resolve the viscous sublayer and diffusive sublayer near the swi and other boundary zones 4 results and discussion 4 1 validations first a simulation of passive scalar transport in a fully developed turbulent open channel flow with a smooth impermeable wall was carried out at re τ 180 and was compared with the typical experiment and the simulation results given by komori et al 1993 handler et al 1999 and wang et al 2005 the setup of present case was shown in section 3 fig 2 shows the mean velocity profile u unless otherwise stated in this section indicates horizontal as well as time averaging for all cases reported in this paper the calculated mean velocity profiles are in good agreement with each other as well as with the aforementioned experimental data and the dns les results fig 3 shows the profile of the mean concentration normalized c by the frictional concentration for high schmidt number mass transfer experimental and computational data by nagano and shimada 1996 and with the les data by wang et al 2005 with the same reynolds number are given in fig 3 the mean concentration coincides well with both results are still in good agreement with each other through the above verifications the reliability of our procedure was confirmed to predict the statistical quantities of the turbulent open channel flow and mass transfer at high schmidt numbers then considered the presence of the sediment layer the our numerical study and in particular the range of parameters used is designed to allow a comparison to the laboratory data from o connor and hondzo 2008 table 2 shows the flow parameters of the numerical simulation for three water temperatures 15 c 25 c 30 c with the corresponding schmidt numbers of 690 373 291 respectively of note sc increases for lower temperatures the height of the channel flow is h 10 cm in the simulations the statistical parameters at different darcy numbers and porosities at 25 c are shown in table 4 we now compare predictions of the present numerical model with the experimental results reported by o connor and hondzo 2008 in fig 4 we present the comparison between one present case and the experimental data for exp 2 under the condition which the physical parameters are mostly same to each other except sc 373 set here but sc 358 in their experiment we shift the location of the swi to y 0 08 to normalize the coordinates between the simulation case and the exp 2 the mean concentration profile computed in good agreement with those from the experiments according to the comparison and the validation above it can be confirmed that the present model and code are reliable for the prediction of statistical quantities of oxygen transfer to organic sediment beds in the turbulent flow this agreement gives also an additional support to the experimental and numerical results and experimental data of higashino et al 2008 for oxygen transfer from flowing water to organic sediment bed this will be evident in the discussion presented in 4 2 and 4 3 4 2 effects of the sediment bed s intrinsic properties on the do concentration fields we investigated the relationship between the transport of momentum and the do scalar concentration at the swi with the sediment bed s intrinsic permeability and porosity which are denoted as da and ϕ respectively in table 3 δ p represents the depth of do penetration from the swi to the maximum depth where c is greater than 10 2 sod sediment oxygen demand is a component of the do balance of natural water bodies such as a river section or a lake the dimensionless sod is expressed by 22 sod 0 δ 1 y c μ χ c k o 2 c χ d y the do transfer in the vertical direction is divided into two terms viscous diffusion which is separately represented as j d w c y or d s c y using fick s first law of diffusion and turbulent mass flux which is represented as c v the fluxes of do at the swi are described respectively as j δ d w c y y δ and c v δ to examine the dynamics of do transport the mean do concentration normalized by the friction concentration at the shear free surface is defined as 23 c c y c f τ where c f τ is defined as 24 c f τ d w u τ c y y h the mass transfer coefficient at the free surface and swi are defined respectively as 25 k f d w c u τ c y y h 26 k δ d w c u τ c y y δ in this section the black vertical dashed lines in all figures represent the swi which is located on y 0 08 or y 14 4 with wall unit fig 5 displays the streamwise velocity profiles of the time averaged and the horizontally averaged which is normalized by the bulk mean velocity ub the mean velocity still obeys the law of wall which is not affected by the presence of the sediment layer in fig 5a a zoomed view of the velocity profile near the interface between the fluid region and the sediment layer is shown in the fig 5b the velocity profile on the two sides of the interface has different slopes and the velocity decreases with a decrease in da and ϕ in the sediment layer shown by the arrow this suggests that with a lower permeability of the sediment the flow in the bed will be slower fig 6 shows the rms intensity of velocity fluctuations and the reynolds stresses as a function of y the presence of velocity fluctuations demonstrates that strictly speaking the vans filtered flow inside the sediment slab is not fully laminar although the magnitude of the fluctuations is small this also exhibits that the sediment bed leads to a significant increase in the wall normal and spanwise rms velocities as da and ϕ increase effect whereas the streamwise rms velocity remains unchanged the above trends of rms velocity and intensity are in good agreement with the fig 12 in breugem et al 2006 in the case e95 in which the permeable wall is highly permeable to examine the above phenomena we provide the instantaneous streamwise vortices near the swi with the q criterion hunt et al 1988 as shown in fig 7 these energetic eddies form high speed streaks in the region near the swi the vortex structures reduce and the turbulence motion is more moderate at the sediment layer as the darcy number or porosity decreases as shown from the above results the impact of permeability on the mean velocity and on the vortices is more significant than that of the porosity in agreement with breugem et al 2006 it can be inferred that the near wall structure of the turbulent flow is affected too as this peak is connected with the presence of high and low velocity streaks fig 8 shows the effects of the sediment bed s permeability and porosity on do concentration the concentration increases in the sediment bed but decreases far away from the swi y 0 when da or ϕ increases as shown in fig 8a this trend is consistent with the instantaneous streamwise vortices near the swi as shown in fig 7 this leads to a faster do consumption and more do demand from the air when the flow velocity is slower peaks in the concentration fluctuation near the swi move along the direction from the sediment layer to the water layer as shown in fig 8b although diffusion and advection both affect the mean and rms do concentration in the sediment layer there are some different behaviors between them there is a local extremum of the concentration fluctuation hidden in the sedimentary layer at approximately 10 y 15 then the rms values rapidly weakens at the water side as shown in fig 8b however there are no such peak values for the mean concentration that increases monotonously from the sediment bed to the water body as shown in fig 8a the concentration fluctuations near the free surface at different da or ϕ show little change of which the peak values are approximately half of the maximal values near the swi not shown here do turbulent diffusion is denoted by a quicker concentration flux increases accordingly due to the enhanced vertical velocity fluctuation as shown in fig 8c and do penetrates more deeply as shown in table 4 because the turbulent intensities are stronger as shown in fig 6 this suggests that the turbulent diffusion is the dominant mechanism in the mass transfer and an order of magnitude greater than viscous diffusion when dissolved oxygen transports from across the sediment water interface to the bed due to the vertical turbulent fluctuation moreover fig 9 shows the contours of the instantaneous streamwise velocity fluctuation and do concentration fluctuation in a wall parallel plane under the swi y 12 for different darcy numbers in which the effects of permeability of the bed on the instantaneous flow and concentration fields are clearly observed including organized streaks for the low and high fluctuation this implies that wall permeability alters the structure of turbulence and the scalar field exhibits the same elongated structure in the streamwise direction that these behaviors were reported by scalo et al 2012 and tang et al 2014 the patterns notably illustrate the evolution of concentration fluctuation with absent and dense streaky structures for different darcy numbers this behavior is consistent with the profiles of the concentration fluctuation in fig 8b nearby the sediment layer dense and long streaky structures appear in fig 9a at a high darcy number however no streaky structures are visible at a low darcy number as shown in fig 9c 4 3 effects of schmidt number and microbial biomass on the do concentration field the oxygen concentration field is modeled typically as a high schmidt number passive scalar where the schmidt number may be up to hundreds in water according to the different local temperatures for a better understanding of the mechanisms affecting the turbulent mass transfer from the swi it is helpful to simultaneously examine the concentration and velocity fluctuations and their correlations in fig 10 a and b the mean do concentration profiles and rms fluctuations are shown for schmidt numbers of 291 373 and 690 corresponding to the local temperatures of 30 c 25 c and 15 c respectively at different schmidt numbers the logarithmic law still exists asc 2 12ln y α sc ref kader et al 1972 a lower temperature corresponding to a higher schmidt number results in a do concentration and its fluctuation in the whole channel becoming higher than in high temperature environment this indicates that more intense do transport and more do consumption appear both inside the sediment bed and near the bed region for lower schmidt number although the previous comparisons are encouraging the best test for validating the scalar part of our simulations lies in the prediction of the mass transfer coefficient in fig 10c we give the schmidt number dependence of turbulent mass transfer coefficients at the free surface as well as at swi the slope of the lines at the interface and free surface reported here are approximately parallel to the correlation between k f or k δ and sc of the literatures corresponding to theoretical and experimental results kader et al 1972 rashidi et al 1991 lorke et al 2003 o connor and hondzo 2008 shaw and hanratty 2010 in the presence of an organic mass absorbing sediment layer shaw and hanratty 2010 performed experiments and found k δ β r e s c 0 704 at the interface and o connor and hondzo 2008 suggested the scdependence of k f as k δ β r e s c 2 3 on the other hand kader et al 1972 proposed theoretically k f β r e s c 1 2 near the free surface for sc thus the good agreement obtained with various experimental results allows us to conclude that the present les approach is able to predict quantitatively mass transfer at the free surface and the interface even at high schmidt number to clearly depict the effects of the schmidt number on the do transfer some typical statistical quantities shown in table 4 and were analyzed which include the normal fluxes of viscous diffusion and turbulent diffusion c v δ and jδ uτc at the swi and at the free surface the do penetration depth δ p the dimensionless friction concentration c f τ c and the sod for a higher temperature the do penetration is deeper despite the more intense do transport and higher do consumption most of the aforementioned statistical parameters obviously negatively correlate with schmidt number and positively correlate with the temperature we now examine the relationship between the dissolved oxygen concentration and the microbial biomass concentration of oxygen absorbing organisms the oxygen consumption rate at the sediment water interface is dependent on the biomass concentration of oxygen absorbing bacteria we need to understand how the bacterial population χ impacts the variation of do at the swi in these simulations the microbial concentrations were chosen to be 300 500 700 and 1000 mgl 1 the sediment oxygen demand and do penetration depth display nearly a linear relationship with bacterial concentration as shown in fig 11 thus the turbulent diffusion animates strong biochemical activities characterized by the high value of χ consuming large amounts of dissolved oxygen in addition c in the sediment bed falls off and further leads to a greater supply of oxygen from the air therefore the reproduction of aerobic bacteria has a significant influence on the entire channel moreover the statistical parameters including the normal fluxes of the viscous diffusion and turbulent mass flux due to the turbulent diffusion c v δ and jδ uτc at the swi the do penetration depth δ p the dimensionless friction concentration c f τ c and the sod are shown in table 5 different microbial concentrations χ of 300 500 700 and 1000 mgl 1 most of the aforementioned statistical parameters have an obviously positive correlation with the microbial biomass concentration except for the do penetration depth this indicates that increasing the bacterial population χ determines the enhancement the sod and results in a smaller penetration depth in the sediment layer 5 conclusion in this paper we presented the dependence of a high schmidt number dissolved oxygen distribution of on the material properties of sediment bed permeability porosities and on microbial biomass in turbulent flows these properties were obtained by solving the dimensionless navier stokes equations and concentration equation in an open channel across the swi configuration with schmidt numbers sc increasing from 100 to 690 using large eddy simulations the new model strategy is that the underlying permeable sediment is described by a darcy brinkman forcheimer model combined with a biogeochemical model dynamic sgs models for the turbulent stresses and mass fluxes were used to close the governing equations in this paper we aim to reveal the interactions among the processes involved in do transfer across the sediment water interface swi and absorption by a highly permeable sediment bed the instantaneous and time averaged flow and do concentration fields were investigated which showed that the turbulent diffusion is the major mechanisms to do transport the flow speeds up in the sediment layer as the darcy number da and porosity φ increases and large amplitudes of velocity fluctuations are associated with an increased oxygen concentration and fluctuations a higher temperature lower sc results in a lower do concentration a more intense do diffusion and more do consumption strong microbial activities in the sediment layer produce a greater sod shallower do penetration and a stronger do diffusion increase in the concentration fluctuation near the swi follow move along the direction from the sediment layer to the water layer when the flow velocity is slower for a large permeability the wall is classified as a highly permeable wall near which viscous effects are of minor importance therefore turbulent diffusion is the prime mechanism of do transfer and it is an order of magnitude greater than viscous diffusion the supply of do is faster from the atmosphere because of more do demand and a stronger diffusion acknowledgments the project was supported by the national natural science foundation of china nos 11572183 91852111 and 11825204 
694,the scale and complexity of environmental and earth systems introduce an array of uncertainties that need to be systematically addressed in numerical modeling the ever increasing complexity of representation of these systems confounds our ability to resolve relevant uncertainties specifically the numerical representation of the governing processes involve many inputs and parameters that have been traditionally treated as deterministic considering them as uncertain introduces a large computational burden stemming from the requirement of a prohibitive number of model simulations furthermore within hydrology most catchments are sparsely monitored and there are limited heterogeneous types of data available to confirm the model s behavior here we present a blueprint of a general approach to uncertainty quantification for complex hydrologic models taking advantage of recent methodological developments we rely on polynomial chaos machinery to construct accurate surrogates that can be efficiently sampled for the ecohydrologic model tribs veggie to mimic its behavior with respect to a selected set of quantities of interest the use of the bayesian compressive sensing technique allows for fewer evaluations of the computationally expensive tribs veggie the approach enables inference of model parameters using a set of observed hydrologic quantities including stream discharge water table depth evapotranspiration and soil moisture from the asu experimental catchment near manaus brazil the results demonstrate the flexibility of the framework for hydrologic inference in watersheds with sparse irregular observations of varying accuracy significant computational savings imply that problems of greater computational complexity and dimension can be addressed using accurate computationally cheap surrogates for complex hydrologic models this will ultimately yield probabilistic representation of model behavior robust parameter inference and sensitivity analysis without the need for greater investment in computational resources keywords ecohydrology hydrologic modeling uncertainty quantification sensitivity parameter inference bayesian compressive sensing 1 introduction in research areas of physical hydrology and ecohydrology computational models are used to improve the understanding and predictions of watershed and ecosystem dynamics recent developments towards these objectives include modeling at higher resolutions and investigating sensitivities of hydrologic response to watershed properties and climate forcings e g getirana et al 2014 guan et al 2015 kim and ivanov 2015 krakauer et al 2014 ringeval et al 2014 rudorff et al 2014 likewise in climate assessment studies resolving complex systems and associated feedbacks requires the representation of relevant dynamics at commensurate spatial and temporal scales abril et al 2014 brown and lugo 1982 cramer et al 2004 detwiler and hall 1988 tackling this complexity calls for models that rely on details of mechanistic interactions and therefore demand large computational resources to provide more robust assessments and predictions bisht et al 2017 estimates from computational models are affected by a number of uncertainty sources that can be partitioned into reducible and irreducible uncertainties beven 2013 beven et al 2016 de rocquigny 2012 these uncertainties can be amplified due to the complexity and nonlinearity of addressed problems therefore it is prudent to apply a formal uncertainty quantification uq machinery to evaluate them more broadly one needs a holistic approach to uq to seamlessly encapsulate all uncertainties of computer simulations within their specific contexts this is a valuable pursuit for many computational sciences not just hydrology and as such uq has emerged in the last two decades as an active research field which has incorporated applied mathematics engineering and physical sciences e g ghanem and doostan 2006 gilbert et al 2016 knio and le maître 2006 najm 2009 sargsyan et al 2014 xiu and tartakovsky 2004 the overarching goal of uq is to provide improvements in predictions and understanding of key sources and magnitudes of uncertainty which can inform decision making and control for management of natural and engineered systems ascough ii et al 2008 da cruz et al 1999 garcía et al 2015 morss et al 2005 the quantification of uncertainties related to a prediction of a physical system involves two associated problems 1 the estimation of model input variables e g parameterization constants input forcings addressed by comparing model simulations with available observational data or data products i e synthesized data and model estimates and 2 the forward propagation of uncertainty from input variables to output quantities of interest qois quantifying uncertainties has long been a goal in hydrologic modeling beven 1993 beven and westerberg 2011 renard et al 2010 inference of input parameters is common e g abbaspour et al 2004 mclaughlin and townley 1996 vrugt et al 2008 however robust quantification of uncertainties for complex models remains an area of acute interest beven et al 2015 chen et al 2011 hall et al 2014 krzysztofowicz 2001 firstly traditional uq methods carry computational burden that makes working with models of higher complexity difficult secondly simpler lumped models in hydrology cannot provide information on variables that originate from physically rich solutions they therefore cannot take the full advantage of heterogeneous in terms of space time coverage or target variables observational data sets that are typical of sparsely monitored watersheds many uq studies have used conceptual rainfall runoff models e g renard et al 2010 vrugt et al 2008 that permit fast computation and use of variations of markov chain monte carlo mcmc sampling gilks et al 1995 hastings 1970 for uq complex integrated models of hydrology e g kollet et al 2017 maxwell et al 2014 however require much greater computational resources making the tens of thousands of simulations required via mcmc analysis computationally prohibitive an approach to reduce this computational burden is to construct a surrogate or metamodel to approximate the behavior of the complex hydrologic model e g elsheikh et al 2014 razavi et al 2012 recent advancements in uq applications have examples of comprehensive fully integrated surface and subsurface flow models gilbert et al 2016 miller et al 2018 the methodologies used in these studies still required hundreds of simulations in order to accomplish rigorous uncertainty assessments in the case where wall clock simulation time for a larger scale watershed is considerable e g days to weeks more efficient methods are required this study offers an approach with a uq framework applied to a quasi three dimensional hydrologic model with surface and variably saturated subsurface flows as well as vegetation biophysics that resolves energy budgets this framework allows the likelihood based estimation of input parameters using a diverse set of observations to display the abilities of the framework in a setting of real world challenges the study domain is a small sparsely monitored tropical catchment in the amazon rainforest previously large scale studies of the amazon have been undertaken to understand the importance of how hydrology and carbon cycles interact e g fan and miguez macho 2010 lin et al 2015 miguez macho and fan 2012a miguez macho and fan 2012b pokhrel et al 2013 many of these studies have simulated the entire amazon region using grid cell discretization of o 10 km e g beighley et al 2009 coe et al 2008 yamazaki et al 2011 or somewhat finer miguez macho and fan 2012a 2012b however as has been previously shown e g miguez macho and fan 2012b this discretization does not resolve the basic functional hydrologic units hillslopes and as a result the lateral mass fluxes from higher elevation areas to the valleys of the drainage network ignoring the connection between upstream recharge areas and downstream discharge regions can have important consequences on robustness of studies that depend on understanding space time variability of the hydrologic regime kim et al 1999 salvucci and entekhabi 1995 important ecohydrologic processes occur in these upstream lower order headwater catchments richey et al 2011 2009 vital smaller scale studies of these upland areas have been undertaken e g cuartas et al 2012 fang et al 2017 fleischbein et al 2006 nobre et al 2011 but no thorough uncertainty assessments were performed limited sensitivity experiments performed carried out in fang et al 2017 vertessy and elsenbeer 1999 were applied to these catchments however a sufficiently general framework of uncertainty quantification and sensitivity analysis of hydrologic response of watersheds with scarce data is still absent in the literature the objective of this study is to demonstrate a novel approach to the representation and propagation of model input uncertainties by implementing what has been termed non intrusive spectral projection le maître and knio 2010 to construct a surrogate model to emulate the behavior of a complex hydrologic model this methodology allows us to model at high spatial resolutions the ecohydrologic interaction between groundwater and surface water in a small upland catchment in amazonia it also permits a general approach to account for uncertainties in model parameters and initial conditions of the groundwater surface specifically this work focuses on quantifying uncertainty in the soil parameterizations of the asu research catchment e g cuartas et al 2012 tomasella et al 2008 focusing on the challenge of probabilistic estimates of bulk soil properties in this sparsely monitored watershed in the methodology section we introduce i the mechanistic model for this study tribs veggie tin based real time integrated basin simulator vegetation generator for interactive evolution ii construction of a surrogate model for tribs veggie through polynomial chaos expansions pces iii dimensionality reduction methods to more efficiently construct the pce surrogate model and iv accelerated inference of tribs veggie model parameterizations using pce surrogates the case study of the asu watershed demonstrates the construction of a surrogate model representation and sensitivity analysis carried out with it this representation is then used to perform parametric inference highlighting the flexibility of the framework to identify uncertainties and use diverse observational data for parameter estimation the parameters obtained from inference are then used to compute hydrologic output from tribs veggie the benefits and limitations of this framework are addressed in the end with a focus on issues in hydrologic modeling that benefit from an uncertainty quantification approach 2 methods and study design this study provides a framework to derive uncertain model parameters for a sparsely gauged catchment using a physically rich model tribs veggie and its simplified mathematical representation i e a surrogate model the sparse availability of groundwater soil properties and streamflow data in the watershed is recognized and accounted for in the designs so that different data types can be used to inform the model s behavior this section describes the data available in the catchment and reports an approach for dealing with the lack of observational data available within the modeling and uncertainty quantification framework 2 1 simulation setup the watershed domain is located approximately 76 km northwest of manaus brazil fig 1 a the watershed is part of activities carried under the large scale biosphere atmosphere lba experiment in amazonia managed by the national institute of amazonian research inpa this location was chosen due to the long record of available atmospheric forcing data from a flux tower installed in 1999 as well as the availability of relevant data from streamflow gauges soil moisture sensors and groundwater piezometers this catchment is one of the most instrumented catchments in the amazon basin surrounded by undisturbed rainforest this region is characterized by a tropical monsoonal climate with average annual rainfall of approximately 2400 mm average annual temperature of 26 c and a wet season from november may and dry season from june october cuartas et al 2007 2012 nobre et al 2011 2 1 1 representation of simulation domain the simulation domain the asu watershed fig 1b c represents a zero to third order basin in amazonia previously detailed in cuartas et al 2007 2012 nobre et al 2011 the total area is 12 4 km2 and the watershed has varying soil thickness with a maximum between 40 and 50 m cuartas et al 2012 to represent its subsurface domain the layer thickness is fixed at 40 m using 35 irregularly resolved mesh layers increasing from 0 04 m for the surface layer to 2 5 m for the layers between 5 and 40 m the thickness of the layers increase following a geometric series such that as the soil depth increases each layer is some fraction r thicker than the previous layer δ z i 1 δ z i 1 r up to the depth z i 5 m for this domain we chose r 0 296 which allows for smaller soil layers near the surface and larger layers towards the bottom of the soil domain this discretization enables the capture of the dynamics of infiltration and lateral water movement in the vadose zone while maintaining computational efficiency in the horizontal plane the domain is represented using 3 arc second 90 90 m spacing from the srtm digital elevation model jarvis et al 2008 resulting in 1554 square voronoi cells overall this gives 1 554 35 54 390 computational nodes in the domain 2 1 2 soil type and land cover previous classification of soils for this site have been undertaken in cuartas et al 2012 fang et al 2017 tomasella et al 2008 but focused on the near surface soil properties at few locations that are hard to interpret in terms of their changes with depth see also fang et al 2017 the detailed soil classification such as the one given in cuartas et al 2012 can be useful but understanding effective watershed scale properties i e that represent the catchment as a whole is frequently of more relevance since the vast majority of basins are ungauged and have little to no data on soil properties in the context of a sparsely gauged watershed it can also be useful to know how changes in model parameterizations within the watershed affect the simulation results of important hydrologic variables such as streamflow water table depth evapotranspiration etc recently fang et al 2017 also used a bulk soil properties case instead of the finer detailed properties available in cuartas et al 2012 consequently while in no way required by the applied uq framework section 2 3 this study assumes that there is a single soil type in the watershed whose effective physical characteristics need to be estimated inversely we represent soil properties with a high degree of uncertainty taking into account the full ranges of soil property values used in previous studies cuartas et al 2012 fang et al 2017 specifically the uncertain parameterizations used for soil properties are calculated using the pedotransfer function for brazilian soils from tomasella et al 2000 this study used multivariate linear regression relying on texture percentages of sand silt and clay organic carbon moisture equivalent and bulk density to fit a second order polynomial for the dependent variables of α n θr and θs of the van genuchten soil water retention and model van genuchten 1980 furthermore the study of broedel et al 2017 provides data on texture and bulk density for the asu catchment up to a depth of 14 3 m and the estimate for moisture equivalent is given in tomasella et al 2000 the two classes of vegetation present in the catchment are a terra firme forest on the plateau and sloped areas and b campinarana forest ranzani 1980 in the valleys and ecotone areas of the watershed fig 1b the type a forest has dense evergreen tropical vegetation with heights of approximately 30 m the type b forest is less dense with tree heights typically around 20 25 m cuartas et al 2012 the parameterizations for these vegetation types followed cuartas et al 2012 2 1 3 climate forcing climate forcing data are available at hourly intervals for 26 300 h from january 1 2003 to january 1 2006 the region exhibits wet and dry seasons spanning from approximately november may and june october respectively aggregated time series of data used for forcing the model are shown in fig 2 restrepo coupe et al 2013 these data are spatially uniform across the watershed 2 1 4 initial and boundary conditions for solving subsurface flow dynamics the flux neumann boundary condition was specified at the surface net rainfall and bottom zero flux of the domain allowing for infiltration runoff and exfiltration fluxes for surface flow an open boundary in the form of free outfall was assumed at the downstream end kim et al 2016a the watershed was delineated from the downstream end therefore for all other boundaries of the watershed the no flux solid slip wall boundary condition was specified 2 1 5 quantities of interest within uncertainty quantification a quantity of interest qoi is an output from a numerical model whose response to uncertain inputs is evaluated each qoi needs to be a scalar but many qois can be considered such that one can examine temporal or spatial responses in practice thousands of qois can be defined such as a time series of the model s output or a single qoi may be selected if it is believed to carry significant information about the phenomenon being studied e g the mean water table depth for this study a mix of targeted quantities of interest is selected to include domain aggregated quantities of interest and time series of both domain aggregated and point location qois which are provided in table 1 these qois include daily and monthly streamflow daily streamflow in the 95th percentile mean monthly soil water content in the top 1 m evapotranspiration mean monthly evapotranspiration and depth to water table for six wells or group of wells the data available in the watershed means that some qois can be used to infer model parameters section 2 4 those qois that coincide with observations are used for parameter estimation denoted in the inference column of table 1 and those that are not are only used for estimation the number of scalars belonging to each group of qois is given in the fourth column of the table 1 with a total of 499 qois for this study those qois used in inference were constrained to periods where data were available e g the soil moisture data in the study area only exist for january october of 2005 see fig 4 at a single soil pit location adjacent to the flux tower at the study site restrepo coupe et al 2013 therefore the construction of a time series of monthly mean soil water content leads to ten qois although these soil moisture data are only representative of the hydrologic behavior in the upland area near the flux tower it can still be included as a quantity of interest and used in inference outlet streamflow was collected starting december 2004 and running through december 2005 however these data were only sampled once daily often with several days or sometimes periods of weeks between sampling due to the absence of continuous observed streamflow monthly aggregated mean streamflow was used as a qoi to construct the surrogate model water table data in the watershed were sampled between 2012 2015 outside the time period for this study additionally they were sampled at irregular periods with days or weeks between readings while twelve well locations were sampled not each location was sampled during both the wet and dry season and several wells were in close proximity to each other due to these issues wells that had at least ten recordings in both the wet and dry seasons were kept for analysis after exclusion the remaining ten wells were aggregated into groups based on their location within computational cells in tribs veggie i e if two or more well locations were in the same computational cell of 90 m 90 m the data from these locations were combined into a group for analysis after this aggregation six well groups remained with water table depths between 0 5 and 5 m fig 4 even in the absence of data representative of the entire spatial and temporal domain of the study all i e any available data can be included for analysis with the uq framework their inclusion provides data for inference section 2 4 a strength in this approach is that one is not constrained to a single hydrologic process or specific data type such as the time series or mean quantities when performing inference any data available that can be represented in the hydrologic model are suitable for use with the uq machinery outlined in section 2 3 in table 1 the distinction for the dry period for ts e t dry refers to a month exhibiting a cumulative water deficit cwd 1 c w d i j 1 d p j e t j if j 1 d p j e t j 0 0 if j 1 d p j e t j 0 where pj and etj are the daily accumulated daily precipitation and evapotranspiration respectively where j denotes the day in month i the time period for all reported qois are the year 2005 and during this period there was a negative cwd in august september and october of 2005 of 49 1 80 6 and 87 5 mm respectively to construct computationally efficient surrogate model representations for each qoi one generates a set of training and validation samples from the uncertain parameters x in table 2 each parameter xi is scaled to a standard uniform variable for computational input ξ i 1 1 these are then run in a set of training simulations through m to construct the computationally efficient surrogate as detailed in section 2 3 1 finally the performance of the surrogate is evaluated using the set of validation simulations 2 2 hydrologic model the representation of the hydrologic response of a tropical catchment strongly depends on reliable modeling of subsurface flows tribs veggie ivanov et al 2008 2010 emulates essential processes of water and energy dynamics over the complex topography of a river basin each computational element has a canopy layer that contains two big leaves sunlit and shaded representing the canopy above ground processes are coupled to a multi layer soil model that computes soil moisture root water uptake and heat transport using the one dimensional richards equation hillel 1980 and the heat diffusion equation in the direction normal to the element s surface gravity driven flow for the unsaturated lateral exchange is assumed and the dupuit forchheimer approximation bear 1979 for the saturated lateral exchange is implemented subsurface flows are routed using the d flow routing algorithm tarboton 1997 and the flow directions change dynamically for the saturated zone leading to spatial dynamics that reproduce the three dimensional numerical solutions hopp et al 2015 in this study vegetation dynamics are not simulated only the biochemical model of photosynthesis and canopy stomatal behavior collatz et al 1991 farquhar et al 1980 leuning 1990 1995 is used to simulate the response of latent heat flux to above and below ground conditions the amount of leaf area as well as other structural characteristics of vegetation are imposed as pre determined model input see section 2 1 1 2 2 1 selection of uncertain inputs one source for hydrologic uncertainties in the amazon is the presence of deep soils which give rise to fluctuating groundwater across climes and seasons cuartas et al 2012 miguez macho and fan 2012b due to difficulties in instrumenting and measuring groundwater data are sparse and even experimental catchments have few wells drilled for measuring water table depth the spatial distribution and initial states of groundwater can impact hydrologic models such as spin up performance of the model e g ajami et al 2014 seck et al 2015 or providing better estimates of the impacts on below surface processes to earth system models clark et al 2015 riley et al 2011 additionally accurate representation of groundwater processes at smaller scales can provide valuable information to larger scale groundwater processes and their impacts on earth system processes fan 2015 fan et al 2013 krakauer et al 2014 riley and shen 2014 the large soil column depths in the amazon mean that the parameterizations of soil properties in a hydrologic model may have a large effect on the simulated groundwater and vadose zone dynamics some field or lab measurements may exist for the soil properties through core testing or well pump tests but these are limited to accessible areas and may not necessarily represent bulk soil properties in the catchment kowalsky et al 2004 russo and bouton 1992 in this study soil parameterizations are selected as uncertain inputs into tribs veggie the soil properties that represent the uncertain model parameters x are treated as random variables with distributions provided in table 2 to represent uncertainty in the soil water retention curve characteristics of the soil the parameters for the pedotransfer function fc fs αcs me ρb see section 2 1 2 are treated as uncertain values for the saturated conductivity ks and the anisotropy ratio ar were not a part of this pedotransfer function but represent the infiltration and lateral transport characteristics of the soil these are therefore also treated as uncertain with value ranges estimated using the studies of cuartas et al 2012 and fang et al 2017 2 2 2 water table initializations given soil parameter uncertainty given that the soil parameterizations are treated as uncertain water table initializations that adequately represent the initial state of the water table within the watershed are required for example a shallow water table will result under a simulation with a soil type with a low hydraulic conductivity and a deeper water table will result with a higher hydraulic conductivity setting the water table to some fixed value for the entire basin then allowing steady flow conditions to develop for a given soil type through forcing and draining requires computational resources e g seck et al 2015 which would be a detriment to the desired efficiency from the uq approach in this paper groundwater well data for the watershed e g cuartas et al 2012 fang et al 2017 are available only for a few locations along a transect in the watershed this limitation in both spatial and topographic spaces e g elevation height above nearest drainage slope etc implies that the available data are inadequate to create meaningful realizations of initial depth to water table to be used in simulations however groundwater plays an important role in seasonal flooding and et dynamics of the amazon miguez macho and fan 2012a 2012b it must be accounted for in any comprehensive hydrologic modeling and therefore some uncertainty should be associated with the water table initialization in this work uncertainty in the initial depth to water table is propagated through parametric uncertainty using a subset of the uncertain parameters in table 2 specifically the initial water table depth is estimated using an adapted mapping function from sivapalan et al 1987 this method supposes that there is a steady state groundwater profile throughout the basin and that the streamflow at initialization time q t 0 is derived from a constant spatially uniform recharge to the groundwater furthermore each location in the basin has a contribution qi defined by its position in the watershed drainage network 2 q i a c q a where qi is the saturated lateral flow ac is the surface contributing area of a computational cell q is the semi steady state discharge at the basin outlet and a is the total basin area this approach also assumes that the water table is parallel to the soil surface so the subsurface drainage aligns with the topographical gradient the water table depth for a single computational cell is given by 3 n iwt 1 f ln f a c q a k 0 a r w tan s 0 where n iwt is the initial local water table depth k 0 is the surface saturated hydraulic conductivity f is the exponential decay parameter of k 0 with depth beven 1982 ar is the soil anisotropy ratio ivanov et al 2004 w is the width of the saturated flow between cells and s 0 is the surface slope the decay parameter f is not used in the representation of the soil hydraulic model in this work however the rest of the parameters of eq 3 are known and therefore a value of f can be solved for a given set of soil parameters and local watershed characteristics at any location specifically the water table depths n iwt are derived by taking the temporal average of water table depths for each observation location described in section 2 1 5 the values of k 0 and ar are treated as uncertain and obtained from sampling see table 2 and the rest of the variables in eq 3 are derived from the basin topography this leaves f as the only unknown of the equation and therefore f can be derived for each soil type in the uq framework through least squares optimization to fit the data to the model in eq 3 the estimated value of f for each soil type used in the uq procedure enables the generation of an initial spatial distribution of water table specific to the soil parameterization used in the simulation the initial water table fields generated through this process were checked for their consistency and magnitudes with the mean and variability in the initial water table fields given in fig s1 the use of the outlined approach provides a realistic representation of the water table depth and also offers an initialization tuned to the uncertain soil parameters 2 3 uncertainty quantification framework tribs veggie has a large set of inputs that could be treated as uncertain these are closures for certain approximations to physical laws or parameters describing a property of a medium for example important for the movement of water in the domain e g saturated conductivity for different soil types present in the domain in addition to these parameters there are input fields that describe spatial or temporal states of the simulation watershed these parameters and fields represent the assumptions made about the makeup and behavior of the domain they are inherently uncertain since it is not possible to have perfect information about the system being modeled and this is especially true for natural systems therefore instead of encoding assumptions into single estimates about the system in question we embrace the uncertainty in our knowledge and attempt to quantify the consequences of this uncertainty on simulation results in this study only parametric inputs to tribs veggie will be treated as uncertain to focus on the application of the uq methodology with a discussion of the use of spatial input fields for uq in section 4 2 3 1 surrogate modeling let s consider a model m i e tribs veggie in this study with inputs x where x x 1 x 2 x m e g m 7 for this study this model is used to predict some output quantity of interest qoi y r where y can be assumed to be a scalar quantity for now but it can and will be used for multiple qois in this work this model can be viewed as a simple function that maps uncertain inputs to an uncertain output 4 y m x we assume that m is a deterministic model that can scale in complexity depending on the problem being solved e g in its simplest form it could be m x x i where uncertainty quantification becomes interesting is when m is complex such as the numerical solutions to the governing equations of fluid flow it is not uncommon for investigations of fluid flow to make single evaluations of the model represented by eq 4 and treat it as a black box i e the internal model dynamics are assumed unknown and only a relationship between model inputs and outputs is analyzed the only requirement that is imposed on the model is that it must be executable i e provided its inputs x the model produces its output y if we believe that the model m adequately captures the dynamics of the system being modeled then we can also believe that the output y m x we receive from the model gives an accurate prediction when the values of the input parameters variables x are known however a typical case for the majority of models of environmental systems is that input values are uncertain either due to natural variability in the system e g kim et al 2016b kim et al 2016c or inadequate knowledge of parameter values in general in this case it is appropriate to represent these input parameters as uncertain so they follow a random vector 5 x π x where x x 1 x 2 x m and π x is a vector of marginal and therefore independent probability density functions pdf describing the variability in each of the m uncertain variables in x which are known and defined prior to modeling random input variables to the model result in qois that can also be treated as a random i e 6 y m x with uncertainty propagation we are interested in determining the probability distribution of y for example if y roughly follows a gaussian distribution the mean and variance of y could be considered as estimates of the location and scale of the distribution however with complex interactions occurring within the model m the distribution of y could be multi modal or have large skewness or kurtosis making conventional methods relying on the assumption of gaussian behavior a poor approximation as an illustration consider that if the model output of interest has a similar variability as the prediction quantity y in fig 3 one cannot describe the output distribution through its first moments and the full characterization of the density function is required in order to investigate uncertainties and sensitivities of model outputs to its inputs many model runs must be performed this has traditionally been done using collocation methods taking a sample from the input distribution and identifying the output value resulting from that sample allowing for the construction of a probability density function of the model s outputs this is often done using monte carlo methods but the computational expense of monte carlo methods quickly scales with the complexity of the model and is prohibitive when multivariate problems are considered blatman and sudret 2011 marzouk and xiu 2009 an alternative approach is to approximate the fully deterministic model with a polynomial expansion used to create a surrogate model also known as metamodel e g miller et al 2018 najm 2009 ricciuto et al 2018 xiu and tartakovsky 2004 the approach of metamodeling is used to offset the cost of forward computationally expensive deterministic simulations by approximating the latter with inexpensive surrogate models polynomial chaos expansions pces represent one such metamodeling technique that provides an approximation to a computer model through its spectral representation on a basis of polynomial functions elsheikh et al 2014 najm 2009 specifically if we have a set of relationships as described in eqs 4 6 we wish to approximate the deterministic model m with a suitable polynomial expansion the expansion relies on polynomial basis terms ψm x that are orthogonal with respect to the distribution of x meaning ψ m x ψ n x π x d x 0 for all m n where m and n denote indices of a polynomial sequence and the integral represents the inner product of polynomials with a weighting function π x the model output can then be approximated with le maître and knio 2010 xiu and karniadakis 2002 7 y m x α n m c α ψ α x the uncertain input x will have an associated polynomial ψ α where α α 1 α 2 α m is a multi index introduced to simplify notation and represents the ordering of terms in the polynomial an illustration of the multi index and how it leads to the construction of a pce is included in the supplementary materials s 2 one typically models the stochastic dimension m to be equal to the number of uncertain variables x x 1 x m the parameters cα are deterministic polynomial expansion coefficients and ψα x are multivariate polynomials orthogonal with respect to the random variables x the multivariate polynomials ψα x in eq 7 are defined as products of univariate polynomials le maître and knio 2010 app c 8 ψ α x i 1 m ψ i α i x i based on the marginal distributions of random variables in x different polynomial bases are used xiu and karniadakis 2002 examples of continuous orthogonal polynomials are provided in table s1 the property of orthogonality implies that the first two moments of uncertain quantity of interest y can be extracted analytically from the expansion coefficients c α enabling very efficient moment evaluation see s 2 for an example in practice the right hand side of eq 7 is a finite sum through a truncated pce lin and karniadakis 2009 xiu and karniadakis 2002 9 y m x m pc x j 0 p c j ψ j x where j is a count of the multiindices α with a predefined order this is discussed further in the supplementary materials there are a number p 1 polynomial basis functions a typical truncation rule a total degree truncation of degree p i e i 1 m α i p leads to see xiu and karniadakis 2002 10 p 1 m p m p we select a finite number of terms by only including those with a total degree of polynomials from eq 8 smaller than a certain value p once the selection of uncertain input variables and the polynomial basis table s1 has been made one can solve the polynomial chaos expansion eq 9 non intrusively meaning that the pre and post processing of model inputs and outputs takes place without having to make any changes to the mechanistic model m to do this one treats the fully deterministic model m as a heuristic black box model to inform the metamodel m pc constructed through the polynomial chaos expansion the goal is to obtain the right hand side of eq 9 where cj are deterministic weighting coefficients and ψj are the polynomial expansions of the order associated with the index j for realized sampled values of x the values for the coefficients c c 0 c 1 c p allow the calculation of the distribution of model output y as it was induced from the model input x these coefficients are calculated by solving eq 9 through either gaussian quadrature smolyak 1963 regression berveiller et al 2006 blatman and sudret 2008 2011 tibshirani 1996 or bayesian approaches doostan and owhadi 2011 sargsyan et al 2014 the next step is to estimate the distribution of model output y as informed by the uncertain but pre defined through marginal pdfs model input x the approximate response of y is obtained through sampling often markov chain monte carlo mcmc haario et al 2001 because the constructed surrogate model in eq 9 is much cheaper computationally than a complex original deterministic model m the surrogate model m pc is assessed using samples of the random vector x these samples can be taken via e g random uniform stratified or latin hypercube sampling mckay et al 1979 where the latter is used in this work the above considerations result in the feasibility of calculating a polynomial chaos expansion of the model response by using monte carlo or other sampling techniques eldred and burkardt 2009 marzouk and xiu 2009 in addition to the convenience of numerical approximation the first two moments of the model output are obtained from the coefficients of the constructed pce such that the mean μ and variance σ 2 of a scalar model output can be calculated as in le maître and knio 2010 11 μ p c e m p c x c 0 12 σ 2 p c var m p c x e m p c x μ p c 2 j 1 p c j 2 the previous section was undertaken with a single qoi y for multiple qois y y i i 1 k the preceding process is carried out for each qoi i e each qoi is a scalar valued output of m which can be represented by a surrogate the remainder of the methodology assumes a single qoi unless otherwise noted 2 3 2 bayesian compressive sensing for pce construction the limiting factor in the surrogate modeling approach to uncertainty quantification is the amount of model simulations one can perform with the expensive deterministic model m in order to solve for the coefficients in eq 9 there may be a large number m of uncertain variables x to address in the model which may result in the curse of dimensionality caflisch 1998 davis and rabinowitz 2007 i e it is not feasible to adequately sample the high dimensional input variables to construct the surrogate model m pc x techniques that have been used to address this issue include sparse regression techniques e g blatman and sudret 2008 blatman and sudret 2011 vidaurre et al 2013 and the bayesian compressive sensing bcs approach for the pc framework introduced by sargsyan et al 2014 bayesian compressive sensing bcs ji et al 2008 sargsyan et al 2014 aims to identify a sparse set of the coefficients cj to satisfy eq 9 this is in contrast to other truncation methods used for pces such as total degree tensor product or hyperbolic cross see sargsyan et al 2014 which treat each dimension input variable equally or truncate the expansion a priori one would like to select a basis set containing terms that convey meaningful contributions to model output y while discarding terms that do not for example if one chooses uncertain input variables that do not have a dependence relation to each other in the hydrologic qoi then one would expect basis terms that account for the interaction of these variables to be zero including these terms provides no further information or variance in the hydrologic process of interest with this motivation this study uses bayesian compressive sensing bcs babacan et al 2010 ji et al 2008 sargsyan et al 2014 to find a sparse set of coefficients to satisfy eq 9 details of this approach are left to sargsyan et al 2014 with a brief overview provided in appendix a the practical implications of employing the bcs technique is that it can greatly reduce the size of the basis set required to construct the surrogate model therefore the technique limits the impact of the curse of dimensionality stemming from treating a large number of parameters as uncertain the amount of this reduction is problem and model dependent but generally grows relative with the number of uncertain input variables due to the number of higher order interaction terms that arise for example a problem with 20 uncertain model parameters will have a larger percentage reduction in required simulations of the model m than a problem with five uncertain parameters 2 3 3 sensitivity analysis once the surrogate model 9 has been constructed the use of monte carlo methods allows the computation of sobol indices for global sensitivity analysis of the model to its input uncertain variables saltelli 2002 sobol 2001 sudret 2008 in the context of pce surrogate models estimates of sobol indices is gained directly from the pc surrogate offering a convenient and computationally efficient way to determine the relative importance of uncertain inputs to the variability of the quantities of interest sobol indices are split into main and joint sensitivities where the former measures the fraction of variance in the output that can be attributed to the uncertain model input variable xi 13 s i var e m c pc x x i var m c pc x where e and var are operators for expectation and variance respectively similarly the joint sensitivity measures the fraction of variance in the output that can be explained by to the joint contribution of variables xi and xj and is defined as 14 s i j var e m c pc x x i x j var m c pc x s i s j an additional benefit of using pce machinery for the surrogate model is that the sobol sensitivities in equations 13 and 14 can be calculated directly from the coefficients of the pce using the relations from eqs 11 and 12 one can write the main and joint sobol indices in terms of the pce coefficients this yields an estimate for the main effect index s i main as 15 s i main α a i main c α 2 ψ α 2 α a α 0 c α 2 ψ α 2 where a i main α a α i 0 α i j 0 similarly one can use the pce coefficients to account for the variance contribution between interactions of xi and xj through the estimate of the total effect index s i total 16 s i total α a i total c α 2 ψ α 2 α a α 0 c α 2 ψ α 2 where a i total α a α i 0 the benefit of eqs 15 and 16 is that once the pce surrogate m pc is constructed global sensitivity analysis via sobol indices can be conveniently gained by performing simple arithmetic on the coefficients of the pce surrogate for both the main and joint sensitivities the posterior distribution of the pc coefficients c are available it is possible to calculate uncertainty in the sensitivity indices by sampling from the posterior distribution of c to calculate eqs 13 16 but this study will use only the mean estimates of the coefficients for sensitivity calculations 2 4 parameter inference given a suite of results from a mechanistic model m and its constructed polynomial surrogate m pc one can infer which values of uncertain input parameters x are most likely to provide results that match an observed quantity an advantage of the approach outlined here is that m pc enables very efficient inverse analysis marzouk and xiu 2009 more generally inverse problems occur when there are related observations but they are not necessarily the ultimate quantity of interest within hydrology and particularly in sparsely monitored basins there is a long history of parameter identification through some form of inversion e g kirchner 2009 mclaughlin and townley 1996 neuman et al 1980 yeh 1986 the use of surrogate models with dimension reduction as outlined in the previous sections provides a novel approach enabling faster computation inversion and the ability to solve the inverse problem on a larger set of uncertain model parameters as an example take u to be a vector of observed data such as streamflow and x x 1 x 2 x m be the vector of uncertain model input parameters such as soil hydraulic properties we further assume that the model gives an adequate approximation of the observed streamflow u m x the use of bayes rule allows for the computation of the posterior parameter values conditioned on the observed data 17 π x u l u x p x where p x is the prior distribution l u x is the likelihood function which represents the probability of obtaining the data given the set of parameters and π x u is the posterior distribution for x which represents the probability of having the parameter values given the observed data to formulate a likelihood function one must represent the discrepancy between the model and observations η u m assuming that the components of η are independent and identically distributed random variables with some marginal density pη the likelihood function can be written as 18 l u x d 1 d p η u d m d x where there are d conditions e g time snapshots of measured streamflow monthly evapotranspiration etc that are being used for inference if one assumes as in this study that the errors ηd are independent and normally distributed ηd n 0 σ 2 eq 18 can be written as 19 l u x 1 2 π σ 2 d d 1 d exp u d m d x 2 2 σ 2 where the logarithm of this likelihood function corresponds to the least squares form of the objective function often used for deterministic parameter estimation sargsyan et al 2015 if measurements are taken at different times for the observed data series e g streamflow the variance in error may not be the same at each sampling time and almost surely will not be equal due to temporal variations of streamflow due to hydrologic seasonality therefore it can be valuable to introduce σ 2 as a scalar hyper parameter for the likelihood sargsyan et al 2015 and rewrite the joint posterior distribution of eq 17 as 20 π x σ 2 u 1 2 π σ 2 d exp u d m d x 2 2 σ 2 p x 1 p x n p σ 2 the prior distribution for the model parameters p xi are based on their a priori knowledge e g that the parameters are uniform within a range or normally distributed with some mean and variance as the variance of the error noise σ 2 must be positive we therefore use a jeffreys prior jaynes and bretthorst 2003 21 p σ 2 1 σ 2 for σ 2 0 0 otherwise to infer values for uncertain model parameters the posterior distribution from eq 20 needs to be sampled using methods such as the metropolis hastings mcmc mackay 1998 note that sampling from posterior distribution requires repeated evaluation of the likelihood implying multiple evaluations of the model m this tends to be computationally expensive and it is therefore expeditious to replace the model m with its pce surrogate m pc in this way the methodology outlined previously in this section can be combined with those in sections 2 3 1 and 2 3 2 to create a computationally efficient flexible framework to infer uncertain parameter values for a complex process based hydrologic model with multiple inputs applied to sparsely monitored watershed as in this study the methodology is able to answer the question of inverse inference what is the likely distribution of the model s uncertain parameters given observed data importantly it is also able to address the question of what are the possible outcomes for specific quantities of interest given the uncertainty in the model s inputs 2 5 summary of uq framework sections 2 3 2 4 presents a general framework of high flexibility to infer model parameters for a hydrologic model in a computationally efficient manner by using polynomial surrogates fig 3 provides a diagram outlining this framework generally one uses a hydrologic model to construct a polynomial surrogate model box a that allows for fast computation of output quantities of interest from the hydrologic model in the case of many uncertain input parameters dimensionality reduction tools such as bcs are used to alleviate the burden of multi dimensionality of uncertain inputs for constructing the surrogate models after a surrogate has been constructed one can then use it for accelerated computationally inexpensive inference of the uncertain parameters for the hydrologic model provided that there are available data matching a quantity of interest box b once the posterior distributions of the uncertain parameters have been calculated they can then be used within a model g x in theory g x can be any model that uses the parameters x but it is prudent to use the posterior values in the same model used for inference within this study g x is going to be tribs veggie m in order to estimate other quantities of interest section 2 1 5 a methodological step that accounts for model error is not shown in fig 3 and therefore is not accounted for in this study more specifically the likelihood function in box b accounts for data error but does not consider the structural error of tribs veggie accounting for model error is an active ongoing area of research within uq e g sargsyan et al 2018 but is beyond the scope of this study the strength of this approach in the context of uncertainty quantification is the relationship between qois as discussed in section 2 3 1 and observational data any qoi can be used for inference as long as one has a preconstructed pce surrogate for it if one can relate observational data to the qoi being addressed through m pc then accelerated inference for diverse outputs e g hydrologic hydraulic ecologic biogeochemical etc is possible within complex hydrologic models 3 results this section provides an overview of the results of the construction of the surrogate model from section 2 3 uses the performance of the surrogate model against observations table 1 inference column to infer parameter values and relies on the latter to investigate the response of hydrologic variables of interest within the catchment the data used to construct the surrogate and perform inference are summarized in fig 4 the figure for discharge shows that the model training simulations underestimate the aggregated observed discharge with a small amount of uncertainty associated with the tribs veggie simulations water table data are aggregated into groups based on observed well locations section 2 1 5 although the simulations generally underestimate water table depth the uncertainty from the training simulations overlap with the observed data simulated evapotranspiration falls within the uncertainty bounds of the observed data with a slight overestimation of et during the wet season lastly soil water content is generally overestimated but the uncertainty in the training simulation overlaps the observed data ideally one would like the training simulations to overlap the observed values used for inference but this is not the case for all qois especially those in the discharge and water table groups however section 3 2 shows how this can be overcome using the inference techniques to better confirm tribs veggie with the observed data 3 1 surrogate construction the polynomial chaos surrogates m pc were constructed as in eq 9 for the qois in table 1 to have a well performing surrogate m pc should match the simulations of the mechanistic model tribs veggie m in fig 5 the absolute errors between the constructed surrogate m pc and training simulations of tribs veggie m are shown as illustration simulation results used for training purposes of constructing the surrogate are shown also shown are the results corresponding to validation of the surrogate i e a comparison of the forward tribs veggie model simulations and outputs of the trained surrogate for the same qois a quantitative error measure of the surrogate accuracy is the relative l 2 norm as a representation of error defined as 22 l 2 rel i 1 n s m i pc m i 2 i 1 n s m i 2 1 2 where ns is the number of training or validation simulations performed the value used for ns depends on the computational expense of the model and one would like to have at least 3 4 samples in each uncertain parameter dimension which in this study would result in at least 3 7 2 187 runs of tribs veggie to summarize surrogate performance the qois are aggregated into streamflow water table depth evapotranspiration and soil moisture groups these groups are used to illustrate the relative surrogate error as a function of pc order in fig 6 which shows that for training simulations the decrease in l 2 rel is muted after a pc order of 5 or 6 we selected a surrogate order p 6 for m pc as the optimal order that leads to a sufficiently accurate surrogate without overfitting given the seven uncertain input parameters table 2 eq 10 gives a required p 1 1 716 basis terms in m pc only 100 training tribs veggie simulations were used for bcs to construct the surrogate an additional 10 simulations were used to validate that the constructed surrogate accurately represented the qois from tribs veggie for both the training and validation cases simulation points were selected via latin hypercube sampling mckay et al 1979 qualitatively figs 5 and 6 a both show that the surrogates performs slightly better i e lower values of l 2 rel in fig 6 using training rather than validation results this is the desired behavior as it means that the stopping criteria ϵ from the bcs method section 2 3 2 appendix a are chosen correctly in the case where reducing ϵ improves the performance reduction in l 2 rel at the training set but at the expense of performance at the validation set overfitting has occurred in surrogate training this means that the surrogate is being trained to only capture the behavior near the parameter samples at the training locations and will not accurately capture the behavior at a significant distance away from these training samples evidence of overfitting would be that l 2 rel decreases with training data but remains the same or increases in the validation data set this is what occurs if higher order terms in the expansion are retained for most groups of qois 3 1 1 sensitivity analysis using a constructed pce model allows for efficient computation of the main and joint effect sensitivity indices from equations 13 and 14 one can assess the sensitivity contributions for a single qoi or for uncertain parameters across multiple qois for the first instance the main and joint sensitivities of the uncertain parameters for the qois of water table group 5 and evapotranspiration in april 2004 are shown in fig 6c and d respectively the main effect sensitivities the fraction of variance described by changing each uncertain parameter in isolation averaged over the input distribution of the other parameters are given on the diagonal of these figures for the water table and evapotranspiration groups one sees that k sat is the dominant contributor in the variation of the qois shown this displays that the model is qualitatively consistent as a higher value of saturated conductivity allows faster drainage from the soil and impacts water available for vegetation transpiration in the case of fig 6d the lower diagonal on fig 6c and d represents the joint effect sensitivities e g in fig 6c terms in the expansion containing both ks and ar account for approximately 9 5 of the variability seen in the fifth water table group while the equivalent contribution from terms containing both ar and fc is approximately 0 45 recalling from eqs 15 and 16 these sensitivities are computed directly from the pce coefficients so sparsity or very low values in the lower diagonal e g fig 6c represents zero or near zero values of the coefficients multiplying terms containing the uncertain parameters the implication of this sparsity is that interaction between those parameters in the model have an insignificant impact on the resultant value of the qoi these indices are computed for each qoi and summarized sensitivities across all qois are given in fig 6b based on the contributions to the variances of the qois it is clear that k sat is the uncertain parameter with the largest impact on model sensitivity for the identified qois this confirms intuition since values of k sat control both infiltration excess runoff as well as impact of lateral flows in the hydrologic system which is not included in the pedotransfer function of tomasella et al 2000 those parameters which are included in the pedotransfer function change the shape of soil water retention curve therefore sensitivity to these parameters fc fs αcs me ρb indicates sensitivity of qois to the water retention characteristics of the soil 3 2 inference of soil properties after the surrogate model is obtained it is possible to calculate the posterior distribution of model parameters through mcmc sampling as described in section 2 4 by replacing m with m pc this enables faster computation and benefits hydrologic models that take more than a few minutes to perform a single simulation the marginal and pairwise marginal posterior distributions of the hydrologic parameters in table 2 are shown in fig 7 these marginal posterior distributions are summarized in table 3 by their moments maximum a posteriori map estimate i e the mode of the posterior distribution and the coefficient of variation ratio of standard deviation to the mean value these posterior distributions provide information about the bulk soil properties of the watershed e g that the soil is mostly clay and silt with a saturated conductivity around 20 mm h and an accompanying anisotropy ratio of approximately 1 25 these values are in agreement with previous studies of the catchment e g cuartas et al 2012 tomasella et al 2008 which found four different soil types within the watershed the clay contents for these four soil types below 1 m ranged between 5 and 90 clay where the soil type with 80 90 clay accounting for 45 of the catchment and the soil type with 5 clay accounting for 30 of the catchment using a single soil type in the catchment represents an aggregation of the physical properties whereby the posterior mean for clay content of 56 is reasonable based on the observed properties the other parameters of the pedotransfer function fall within ranges given in tomasella et al 2000 with additional qualitative agreement between the textural classification shown for manaus located south of the case study asu watershed the hydraulic properties of ks and ar in cuartas et al 2012 have sixteen classifications based on landscape classes and depth with the inferred values in this study indicating a soil type similar to the plateau or slope landscape which are at least 15 m above the nearest stream node accounting for approximately 45 of the catchment area similarly fang et al 2017 contains hydraulic properties with a single landscape classification at four depths where ks is approximately between 9 and 15 mm h with a r 1 which qualitatively agrees to the inferred value of 15 8 mm h additionally one can assess the pairwise correlations between parameters using fig 7 e g that the anisotropy ratio ar is negatively correlated with saturated conductivity ks posterior predictions of the qois are demonstrated in fig 8 here the joint posterior distribution from fig 7 is sampled in order to calculate the qoi values using the surrogates constructed in section 3 1 a comparison can then be made between the posterior qoi values and the observed data values one sees that the posterior qois for et and soil moisture match the data better than for discharge and depth to water table there are two main factors contributing to this 1 the simulated using m et and soil moisture match the corresponding observations better than the simulated discharges and water table depths see fig 4 and 2 data noise for these qois are much lower than those for discharge nonetheless one may attempt to improve the skill if it is deemed unacceptably low if one were interested in getting a better fit to the data for a set of qois one could i select a larger training set to have more chances for the simulation results of m to match observations ii perform inference using a subset of the observed data and qois in an attempt to exclusively fit for that subset of data e g see a discussion below in relation to fig 9 or iii attempt to collect more data to constrain the data noise in the cases of options ii and iii the pce framework provides a benefit of not needing to rerun simulations of the computationally expensive m but also allows fine tuning of model parameters for investigations into specific qois modeling factors impacting the difference between and the uncertainty of simulated and observed quantities include spatial resolution and soil property variability the watershed used in this study has a steep transition between the plateau and lowland areas chauvel et al 1987 cuartas et al 2012 the slopes caused by this transition in conjunction with the 90 m spatial discretization end up creating a resolution effect for quantities such as ground water the horizontal position of the water table well within the computational cell can impact its agreement to observed water table depths additionally the channel is represented within the model using the 90 m cells and the lack of an incised channel means that drainage from the saturated zone to the channel is less efficient all quantities also could have been affected by the lack of spatial variability in soil properties four soil types are reported for this watershed in cuartas et al 2012 with one representative soil type being used in this study as a result quantities that are measured at specific locations water table depth evapotranspiration and soil moisture content are likely affected by this modeling choice the posterior qois as a result of performing inference separately on each group of qois i e only data of a given group are used to infer the entire set of parameters in table 2 are shown in fig 9 in this figure the data noise σ 2 in eq 20 was set as a hyper parameter and was also inferred because it provides a better fit of the mean prediction of m pc to the data this was done to illustrate an approach that can be undertaken when data noise is large to the point of observations becoming uninformative e g in the case of discharge and et data in this case a jefferys prior eq 21 is used for σ 2 performing inference on each group of qois is done at the expense that the parameter posterior distributions become specific for each separate group of qois the posterior distribution in fig 9 for the variables xi contain other important details about the information that can be gained with inference for example the marginal posterior distribution for the bulk density ρb is very close to the uniform prior distribution for most groups of qois since this parameter is not informed by the available data except for soil moisture whether one takes the approach shown in fig 8 or 9 will depend on the questions being investigated generally the bayesian framework prefers including all data to perform inference as long as the data are informative in the case where data come from disparate sources e g sporadic sampling of discharge vs hourly evapotranspiration measurements one may want to separate the inference using these data or incorporate more detailed structure in the data noise representation among groups of qois to better inform their impact on inference 3 3 computing qois from posteriors with the framework presented in this study one can construct a surrogate model for quantities that have been observed section 3 1 and use this surrogate to confirm the model s behavior section 3 2 this allows one to investigate a wide variety of model behaviors such as higher frequency or aggregated quantities at coarser or finer temporal spatial intervals in this work the parameter posterior distribution from fig 9 resulted in a chain of 19 000 posterior values for each parameter in table 2 which can be directly sampled and used as input to a constructed surrogate box c in fig 3 from table 1 the qois held out from inference were q 95 the 95th percentile of daily averaged discharge during 2005 representing the probability that 18 days during the year have a mean daily discharge larger than q 95 ts q the daily time series of streamflow in 2005 and ts e t dry daily evapotranspiration in months with cumulative water deficit as defined in eq 1 illustration plots and sensitivity information for these qois are given in fig 10 note that the surrogates for these higher frequency and aggregated qois were not constructed in section 3 1 but doing so is straightforward and follows the methodology of section 2 3 1 these results are provided to illustrate the flexibility of the uq framework the benefits of the approach include that one can investigate hydrologic response at higher temporal and spatial resolutions for example one can see the pattern of discharge in fig 10 follows that of fig 9 but unlike the original data sourced in fig 4 the illustration provides daily estimates of discharge 4 discussion despite recent advances in computational power simulation times for complex process rich hydrologic models even for low order catchments can be significant when a large number of uncertain parameters or generally uncertain model inputs are used thousands of model simulations may be required to perform robust comprehensive uncertainty quantification parameter inference and sensitivity assessment even reduced order simulation approaches recently introduced to earth system and environmental modeling would be prone to computational issues this study addresses this challenge and adopts an efficient methodology to enable uncertainty quantification and stochastic simulation with deterministic process based hydrologic models of higher complexity this work applies recent developments that combine reduced order modeling based on polynomial chaos expansions with bayesian compressive sensing to construct computationally cheap surrogate formulations of the complex hydrologic model while significantly reducing the number of required simulations the surrogate representation enables bayesian inversion and calibration of uncertain model variables for any model output that can be compared to observable data even when these are sporadic and have time varying accuracy furthermore surrogate formulation can be used to propagate uncertainty through a hydrologic model for any of the model s outputs enabling one to estimate uncertainties of qois that are difficult or too costly to measure a limitation of this study is the intentionally constrained nature of possible sources of input uncertainty included in the analysis as mentioned in section 2 3 one can use both parametric and input spatial field uncertainty within the uq framework the parametric type was chosen to display a clear presentation of how uncertainty can be addressed using a complex model this approach however does not limit an extension of the analysis to other uncertain variables or spatial fields for instance the incorporation of the uncertainty in spatial or temporal fields is important to determine hydrologic response kim et al 2019 an approach to address this uncertainty within the framework includes creating a stochastic model of the uncertain field using a karhunen loéve expansion karhunen 1946 zheng and dai 2017 this decomposes the uncertainty in the spatial field into a parametric stochastic model where the uncertain parameters can be included into x following this philosophy uncertain soil moisture precipitation or water table fields could be propagated through a hydrologic model this is beyond the scope of the current study and will be addressed in future research furthermore there is evidence suggesting that multiple soil types are present in the study domain e g cuartas et al 2012 tomasella et al 2008 while a single soil type was used in this work this design choice was undertaken for two reasons i to represent the more typical case in hydrology of not having detailed soil data available and ii for an unobscured clean presentation of the methodology without extraneous details that would arise from using multiple soil parameter sets if finer detail of soil representation were included one would expect inference and sensitivity to be weighted to the spatial coverage of soil types for example the hydraulic conductivity of a soil type controlling infiltration of precipitation into the subsurface would have a greater contribution to the variation of streamflow if the soil type covered 50 rather than 10 of the watershed another limitation is the current version of the model used in this study tribs veggie has a limited capability to incorporate vertical heterogeneity to the soil column the approach is flexible and relies on a priori identification of input variables of high impact before modeling this means that although one can change the qois being investigated by working with the model s output one cannot change the parameters that are treated as uncertain without having to rerun training and validation simulations given the reduction in computational expense due to the use of the bayesian compressive sensing methodology it is possible to treat dozens of model parameters as uncertain ricciuto et al 2018 sargsyan et al 2014 essentially assuming no a priori knowledge of impactful variables however in most cases in hydrology it is beneficial to constrain the number of uncertain parameters using expert knowledge about the governing processes controlling qois and the respective variables impacting these processes alternatively one can do an initial screening of model parameters with bayesian compressive sensing this will not produce an accurate surrogate but will yield accurate sensitivities so the parameter space can be reduced and the procedure repeated to gain a more accurate surrogate given the scale and complexity of environmental systems one must include uncertainty if one hopes to capture or discover complex hydrologic behavior uncertainties are ubiquitous within the field of hydrology e g a measurement of a basin aggregated metric such as streamflow fig 4 is subject to uncertainty within the catchment or there may be interactions with model input variables meaning that to best capture reducible uncertainty about variables description through probability densities fig 7 is preferred over scalar deterministic values in either case the presented approach offers a novel sufficiently general way forward to address uncertainties in hydrology reducing or defining the uncertainties of model inputs generally the framework outlined in this study provides flexibility to address computationally expensive problems in hydrology e g high resolution modeling of soil moisture ivanov et al 2010 krasnosel skii and pokrovskii 1989 representation of macroporosity e g beven and germann 1982 etc by enabling high fidelity simulations under uncertainty in the cases where these simulations are highly sensitive to input parameters and forcings the presented approach can be applied to high dimensional parameterized input x relevant software tools have been developed in recent years so that the hydrologist need not also be an expert in uncertainty quantification to apply these methodological approaches those that are freely available for research use and actively developed include the uncertainty quantification toolkit uqtk debusschere et al 2017 version 3 0 4 used in this study uqlab marelli and sudret 2014 and the mit uncertainty quantification library parno et al 2014 acknowledgments the study was funded by the national science foundation grant ear 1151443 career a multi scale approach to assessment of climate change impacts on hydrologic and geomorphic response of watershed systems within an uncertainty framework the doe office of science graduate student research award 33165 doe award de sc0011078 understanding the response of photosynthetic metabolism in tropical forests to seasonal climate variation the catalyst program of the michigan institute for computational discovery and engineering at the university of michigan and by the nsf grant 1725654 to v ivanov j kim was supported by a grant 19awmp b127554 03 from the water management research program funded by ministry of land infrastructure and transport of the korean government special thanks to sandia national laboratories and the uncertainty quantification group for their help with navigating uq and uqtk sandia national laboratories is a multimission laboratory managed and operated by national technology and engineering solutions of sandia llc a wholly owned subsidiary of honeywell international inc for the u s department of energy s national nuclear security administration under contract de na 0003525 the u s department of energy office of biological and environmental research supported the next generation ecosystem experiment ngee tropics project that provided the data used for model simulations available through the pacific northwest national laboratory we would like to acknowledge the generous support of the large scale biosphere atmosphere lba program in the amazon by the national institute for amazonian research inpa we also would like to thank marciel jose ferreira and bruce nelson at the department of forest sciences federal university of amazonas manaus amazonas brazil the authors are thankful to two anonymous reviewers for their constructive comments that significantly improved the manuscript appendix a bayesian compressive sensing for surrogate construction the bcs approach provides marginal posterior probability distributions of the vector of coefficients in the pce model c c 0 c 1 c p given available data d bayes formula jaynes and bretthorst 2003 for this situation can be written as a 1 q c l d c p c where q c is the posterior distribution p c is the distribution representing prior information on the pc coefficient vector c and l d c is the likelihood function i e a measure of goodness of fit for the pce surrogate model m pc from eq 9 to the fully deterministic model m assuming a gaussian noise model with a standard deviation σ representing a tolerance of the discrepancy between m pc and m for the likelihood a 2 l d c 2 π σ 2 n 2 exp k 1 n m k m c pc x k 2 2 σ 2 where k 1 n correspond to realizations of the random input parameters x note that eq a 2 implies independence of marginal likelihood functions the prior distribution p c represents prior information on the pc coefficient vector c the posterior distribution q c is the outcome of the inference given the data set d in the case of pces the prior information of c should be flat so no knowledge is assumed in the calculation of the posterior distribution for c a flat prior distribution is preferred because the use of bcs motivates that many of the terms in c will be very close to zero leading to a lower number of polynomial basis terms that give valuable information for the expansion in eq 9 achieving a sparse posterior distribution is strongly supported by sparse priors that give vanishing values for the coefficients unless there is strong evidence to the contrary as such this study uses the sparse laplace prior babacan et al 2010 that assumes coefficient independence a 3 p c β 2 p 1 exp β j 0 p c j where β is a positive shape parameter that also controls the optimization problem in eq a 4 the vector c that maximizes the posterior distribution q c is given by the solution to a 4 a r g m a x c log l d c β c 1 which is the compressive sensing algorithm used in signal processing candès et al 2006 where the β c 1 term is due to the l 1 norm based regularization approach in bcs the regularization approach is used to reduce overfitting while learning the coefficients c different approaches would lead to different regularization terms in eq a 4 details of the implementation of this approach are left to sargsyan et al 2014 but one of the key points is the selection of stopping criterion specifically the algorithm iterates finding the basis terms c until it reaches a stopping criterion ϵ comparing the relative change in the maximal value of the evidence e the integrated likelihood the stopping criterion is defined as e n e n 1 e n e 1 ϵ where n is the iteration number as ϵ decreases more iterations are required meaning that fewer basis terms are retained in the final polynomial surrogate a discussion on the selection of ϵ is included in section 3 1 for example in sargsyan et al 2014 the community land model with carbon nitrogen cycling thornton et al 2007 was modeled with 79 uncertain input parameters where second third and fourth order polynomials lead to order 103 105 and 106 basis terms respectively using 10 000 model simulations the bcs methodology demonstrated an excellent performance skill for a very large uncertain parameter set by avoiding the calculation of all these basis terms and selecting only those relevant to the qois during testing 17 model simulations failed resulting in 9983 simulations used for training the surrogate model this displays another advantage of the bcs method as failed simulations do not limit the solution of the coefficients as it would in quadrature methods the methodology also allows additional simulations to be added if an initial simulation set is determined to be insufficient to train the surrogate model supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 01 002 appendix b supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
694,the scale and complexity of environmental and earth systems introduce an array of uncertainties that need to be systematically addressed in numerical modeling the ever increasing complexity of representation of these systems confounds our ability to resolve relevant uncertainties specifically the numerical representation of the governing processes involve many inputs and parameters that have been traditionally treated as deterministic considering them as uncertain introduces a large computational burden stemming from the requirement of a prohibitive number of model simulations furthermore within hydrology most catchments are sparsely monitored and there are limited heterogeneous types of data available to confirm the model s behavior here we present a blueprint of a general approach to uncertainty quantification for complex hydrologic models taking advantage of recent methodological developments we rely on polynomial chaos machinery to construct accurate surrogates that can be efficiently sampled for the ecohydrologic model tribs veggie to mimic its behavior with respect to a selected set of quantities of interest the use of the bayesian compressive sensing technique allows for fewer evaluations of the computationally expensive tribs veggie the approach enables inference of model parameters using a set of observed hydrologic quantities including stream discharge water table depth evapotranspiration and soil moisture from the asu experimental catchment near manaus brazil the results demonstrate the flexibility of the framework for hydrologic inference in watersheds with sparse irregular observations of varying accuracy significant computational savings imply that problems of greater computational complexity and dimension can be addressed using accurate computationally cheap surrogates for complex hydrologic models this will ultimately yield probabilistic representation of model behavior robust parameter inference and sensitivity analysis without the need for greater investment in computational resources keywords ecohydrology hydrologic modeling uncertainty quantification sensitivity parameter inference bayesian compressive sensing 1 introduction in research areas of physical hydrology and ecohydrology computational models are used to improve the understanding and predictions of watershed and ecosystem dynamics recent developments towards these objectives include modeling at higher resolutions and investigating sensitivities of hydrologic response to watershed properties and climate forcings e g getirana et al 2014 guan et al 2015 kim and ivanov 2015 krakauer et al 2014 ringeval et al 2014 rudorff et al 2014 likewise in climate assessment studies resolving complex systems and associated feedbacks requires the representation of relevant dynamics at commensurate spatial and temporal scales abril et al 2014 brown and lugo 1982 cramer et al 2004 detwiler and hall 1988 tackling this complexity calls for models that rely on details of mechanistic interactions and therefore demand large computational resources to provide more robust assessments and predictions bisht et al 2017 estimates from computational models are affected by a number of uncertainty sources that can be partitioned into reducible and irreducible uncertainties beven 2013 beven et al 2016 de rocquigny 2012 these uncertainties can be amplified due to the complexity and nonlinearity of addressed problems therefore it is prudent to apply a formal uncertainty quantification uq machinery to evaluate them more broadly one needs a holistic approach to uq to seamlessly encapsulate all uncertainties of computer simulations within their specific contexts this is a valuable pursuit for many computational sciences not just hydrology and as such uq has emerged in the last two decades as an active research field which has incorporated applied mathematics engineering and physical sciences e g ghanem and doostan 2006 gilbert et al 2016 knio and le maître 2006 najm 2009 sargsyan et al 2014 xiu and tartakovsky 2004 the overarching goal of uq is to provide improvements in predictions and understanding of key sources and magnitudes of uncertainty which can inform decision making and control for management of natural and engineered systems ascough ii et al 2008 da cruz et al 1999 garcía et al 2015 morss et al 2005 the quantification of uncertainties related to a prediction of a physical system involves two associated problems 1 the estimation of model input variables e g parameterization constants input forcings addressed by comparing model simulations with available observational data or data products i e synthesized data and model estimates and 2 the forward propagation of uncertainty from input variables to output quantities of interest qois quantifying uncertainties has long been a goal in hydrologic modeling beven 1993 beven and westerberg 2011 renard et al 2010 inference of input parameters is common e g abbaspour et al 2004 mclaughlin and townley 1996 vrugt et al 2008 however robust quantification of uncertainties for complex models remains an area of acute interest beven et al 2015 chen et al 2011 hall et al 2014 krzysztofowicz 2001 firstly traditional uq methods carry computational burden that makes working with models of higher complexity difficult secondly simpler lumped models in hydrology cannot provide information on variables that originate from physically rich solutions they therefore cannot take the full advantage of heterogeneous in terms of space time coverage or target variables observational data sets that are typical of sparsely monitored watersheds many uq studies have used conceptual rainfall runoff models e g renard et al 2010 vrugt et al 2008 that permit fast computation and use of variations of markov chain monte carlo mcmc sampling gilks et al 1995 hastings 1970 for uq complex integrated models of hydrology e g kollet et al 2017 maxwell et al 2014 however require much greater computational resources making the tens of thousands of simulations required via mcmc analysis computationally prohibitive an approach to reduce this computational burden is to construct a surrogate or metamodel to approximate the behavior of the complex hydrologic model e g elsheikh et al 2014 razavi et al 2012 recent advancements in uq applications have examples of comprehensive fully integrated surface and subsurface flow models gilbert et al 2016 miller et al 2018 the methodologies used in these studies still required hundreds of simulations in order to accomplish rigorous uncertainty assessments in the case where wall clock simulation time for a larger scale watershed is considerable e g days to weeks more efficient methods are required this study offers an approach with a uq framework applied to a quasi three dimensional hydrologic model with surface and variably saturated subsurface flows as well as vegetation biophysics that resolves energy budgets this framework allows the likelihood based estimation of input parameters using a diverse set of observations to display the abilities of the framework in a setting of real world challenges the study domain is a small sparsely monitored tropical catchment in the amazon rainforest previously large scale studies of the amazon have been undertaken to understand the importance of how hydrology and carbon cycles interact e g fan and miguez macho 2010 lin et al 2015 miguez macho and fan 2012a miguez macho and fan 2012b pokhrel et al 2013 many of these studies have simulated the entire amazon region using grid cell discretization of o 10 km e g beighley et al 2009 coe et al 2008 yamazaki et al 2011 or somewhat finer miguez macho and fan 2012a 2012b however as has been previously shown e g miguez macho and fan 2012b this discretization does not resolve the basic functional hydrologic units hillslopes and as a result the lateral mass fluxes from higher elevation areas to the valleys of the drainage network ignoring the connection between upstream recharge areas and downstream discharge regions can have important consequences on robustness of studies that depend on understanding space time variability of the hydrologic regime kim et al 1999 salvucci and entekhabi 1995 important ecohydrologic processes occur in these upstream lower order headwater catchments richey et al 2011 2009 vital smaller scale studies of these upland areas have been undertaken e g cuartas et al 2012 fang et al 2017 fleischbein et al 2006 nobre et al 2011 but no thorough uncertainty assessments were performed limited sensitivity experiments performed carried out in fang et al 2017 vertessy and elsenbeer 1999 were applied to these catchments however a sufficiently general framework of uncertainty quantification and sensitivity analysis of hydrologic response of watersheds with scarce data is still absent in the literature the objective of this study is to demonstrate a novel approach to the representation and propagation of model input uncertainties by implementing what has been termed non intrusive spectral projection le maître and knio 2010 to construct a surrogate model to emulate the behavior of a complex hydrologic model this methodology allows us to model at high spatial resolutions the ecohydrologic interaction between groundwater and surface water in a small upland catchment in amazonia it also permits a general approach to account for uncertainties in model parameters and initial conditions of the groundwater surface specifically this work focuses on quantifying uncertainty in the soil parameterizations of the asu research catchment e g cuartas et al 2012 tomasella et al 2008 focusing on the challenge of probabilistic estimates of bulk soil properties in this sparsely monitored watershed in the methodology section we introduce i the mechanistic model for this study tribs veggie tin based real time integrated basin simulator vegetation generator for interactive evolution ii construction of a surrogate model for tribs veggie through polynomial chaos expansions pces iii dimensionality reduction methods to more efficiently construct the pce surrogate model and iv accelerated inference of tribs veggie model parameterizations using pce surrogates the case study of the asu watershed demonstrates the construction of a surrogate model representation and sensitivity analysis carried out with it this representation is then used to perform parametric inference highlighting the flexibility of the framework to identify uncertainties and use diverse observational data for parameter estimation the parameters obtained from inference are then used to compute hydrologic output from tribs veggie the benefits and limitations of this framework are addressed in the end with a focus on issues in hydrologic modeling that benefit from an uncertainty quantification approach 2 methods and study design this study provides a framework to derive uncertain model parameters for a sparsely gauged catchment using a physically rich model tribs veggie and its simplified mathematical representation i e a surrogate model the sparse availability of groundwater soil properties and streamflow data in the watershed is recognized and accounted for in the designs so that different data types can be used to inform the model s behavior this section describes the data available in the catchment and reports an approach for dealing with the lack of observational data available within the modeling and uncertainty quantification framework 2 1 simulation setup the watershed domain is located approximately 76 km northwest of manaus brazil fig 1 a the watershed is part of activities carried under the large scale biosphere atmosphere lba experiment in amazonia managed by the national institute of amazonian research inpa this location was chosen due to the long record of available atmospheric forcing data from a flux tower installed in 1999 as well as the availability of relevant data from streamflow gauges soil moisture sensors and groundwater piezometers this catchment is one of the most instrumented catchments in the amazon basin surrounded by undisturbed rainforest this region is characterized by a tropical monsoonal climate with average annual rainfall of approximately 2400 mm average annual temperature of 26 c and a wet season from november may and dry season from june october cuartas et al 2007 2012 nobre et al 2011 2 1 1 representation of simulation domain the simulation domain the asu watershed fig 1b c represents a zero to third order basin in amazonia previously detailed in cuartas et al 2007 2012 nobre et al 2011 the total area is 12 4 km2 and the watershed has varying soil thickness with a maximum between 40 and 50 m cuartas et al 2012 to represent its subsurface domain the layer thickness is fixed at 40 m using 35 irregularly resolved mesh layers increasing from 0 04 m for the surface layer to 2 5 m for the layers between 5 and 40 m the thickness of the layers increase following a geometric series such that as the soil depth increases each layer is some fraction r thicker than the previous layer δ z i 1 δ z i 1 r up to the depth z i 5 m for this domain we chose r 0 296 which allows for smaller soil layers near the surface and larger layers towards the bottom of the soil domain this discretization enables the capture of the dynamics of infiltration and lateral water movement in the vadose zone while maintaining computational efficiency in the horizontal plane the domain is represented using 3 arc second 90 90 m spacing from the srtm digital elevation model jarvis et al 2008 resulting in 1554 square voronoi cells overall this gives 1 554 35 54 390 computational nodes in the domain 2 1 2 soil type and land cover previous classification of soils for this site have been undertaken in cuartas et al 2012 fang et al 2017 tomasella et al 2008 but focused on the near surface soil properties at few locations that are hard to interpret in terms of their changes with depth see also fang et al 2017 the detailed soil classification such as the one given in cuartas et al 2012 can be useful but understanding effective watershed scale properties i e that represent the catchment as a whole is frequently of more relevance since the vast majority of basins are ungauged and have little to no data on soil properties in the context of a sparsely gauged watershed it can also be useful to know how changes in model parameterizations within the watershed affect the simulation results of important hydrologic variables such as streamflow water table depth evapotranspiration etc recently fang et al 2017 also used a bulk soil properties case instead of the finer detailed properties available in cuartas et al 2012 consequently while in no way required by the applied uq framework section 2 3 this study assumes that there is a single soil type in the watershed whose effective physical characteristics need to be estimated inversely we represent soil properties with a high degree of uncertainty taking into account the full ranges of soil property values used in previous studies cuartas et al 2012 fang et al 2017 specifically the uncertain parameterizations used for soil properties are calculated using the pedotransfer function for brazilian soils from tomasella et al 2000 this study used multivariate linear regression relying on texture percentages of sand silt and clay organic carbon moisture equivalent and bulk density to fit a second order polynomial for the dependent variables of α n θr and θs of the van genuchten soil water retention and model van genuchten 1980 furthermore the study of broedel et al 2017 provides data on texture and bulk density for the asu catchment up to a depth of 14 3 m and the estimate for moisture equivalent is given in tomasella et al 2000 the two classes of vegetation present in the catchment are a terra firme forest on the plateau and sloped areas and b campinarana forest ranzani 1980 in the valleys and ecotone areas of the watershed fig 1b the type a forest has dense evergreen tropical vegetation with heights of approximately 30 m the type b forest is less dense with tree heights typically around 20 25 m cuartas et al 2012 the parameterizations for these vegetation types followed cuartas et al 2012 2 1 3 climate forcing climate forcing data are available at hourly intervals for 26 300 h from january 1 2003 to january 1 2006 the region exhibits wet and dry seasons spanning from approximately november may and june october respectively aggregated time series of data used for forcing the model are shown in fig 2 restrepo coupe et al 2013 these data are spatially uniform across the watershed 2 1 4 initial and boundary conditions for solving subsurface flow dynamics the flux neumann boundary condition was specified at the surface net rainfall and bottom zero flux of the domain allowing for infiltration runoff and exfiltration fluxes for surface flow an open boundary in the form of free outfall was assumed at the downstream end kim et al 2016a the watershed was delineated from the downstream end therefore for all other boundaries of the watershed the no flux solid slip wall boundary condition was specified 2 1 5 quantities of interest within uncertainty quantification a quantity of interest qoi is an output from a numerical model whose response to uncertain inputs is evaluated each qoi needs to be a scalar but many qois can be considered such that one can examine temporal or spatial responses in practice thousands of qois can be defined such as a time series of the model s output or a single qoi may be selected if it is believed to carry significant information about the phenomenon being studied e g the mean water table depth for this study a mix of targeted quantities of interest is selected to include domain aggregated quantities of interest and time series of both domain aggregated and point location qois which are provided in table 1 these qois include daily and monthly streamflow daily streamflow in the 95th percentile mean monthly soil water content in the top 1 m evapotranspiration mean monthly evapotranspiration and depth to water table for six wells or group of wells the data available in the watershed means that some qois can be used to infer model parameters section 2 4 those qois that coincide with observations are used for parameter estimation denoted in the inference column of table 1 and those that are not are only used for estimation the number of scalars belonging to each group of qois is given in the fourth column of the table 1 with a total of 499 qois for this study those qois used in inference were constrained to periods where data were available e g the soil moisture data in the study area only exist for january october of 2005 see fig 4 at a single soil pit location adjacent to the flux tower at the study site restrepo coupe et al 2013 therefore the construction of a time series of monthly mean soil water content leads to ten qois although these soil moisture data are only representative of the hydrologic behavior in the upland area near the flux tower it can still be included as a quantity of interest and used in inference outlet streamflow was collected starting december 2004 and running through december 2005 however these data were only sampled once daily often with several days or sometimes periods of weeks between sampling due to the absence of continuous observed streamflow monthly aggregated mean streamflow was used as a qoi to construct the surrogate model water table data in the watershed were sampled between 2012 2015 outside the time period for this study additionally they were sampled at irregular periods with days or weeks between readings while twelve well locations were sampled not each location was sampled during both the wet and dry season and several wells were in close proximity to each other due to these issues wells that had at least ten recordings in both the wet and dry seasons were kept for analysis after exclusion the remaining ten wells were aggregated into groups based on their location within computational cells in tribs veggie i e if two or more well locations were in the same computational cell of 90 m 90 m the data from these locations were combined into a group for analysis after this aggregation six well groups remained with water table depths between 0 5 and 5 m fig 4 even in the absence of data representative of the entire spatial and temporal domain of the study all i e any available data can be included for analysis with the uq framework their inclusion provides data for inference section 2 4 a strength in this approach is that one is not constrained to a single hydrologic process or specific data type such as the time series or mean quantities when performing inference any data available that can be represented in the hydrologic model are suitable for use with the uq machinery outlined in section 2 3 in table 1 the distinction for the dry period for ts e t dry refers to a month exhibiting a cumulative water deficit cwd 1 c w d i j 1 d p j e t j if j 1 d p j e t j 0 0 if j 1 d p j e t j 0 where pj and etj are the daily accumulated daily precipitation and evapotranspiration respectively where j denotes the day in month i the time period for all reported qois are the year 2005 and during this period there was a negative cwd in august september and october of 2005 of 49 1 80 6 and 87 5 mm respectively to construct computationally efficient surrogate model representations for each qoi one generates a set of training and validation samples from the uncertain parameters x in table 2 each parameter xi is scaled to a standard uniform variable for computational input ξ i 1 1 these are then run in a set of training simulations through m to construct the computationally efficient surrogate as detailed in section 2 3 1 finally the performance of the surrogate is evaluated using the set of validation simulations 2 2 hydrologic model the representation of the hydrologic response of a tropical catchment strongly depends on reliable modeling of subsurface flows tribs veggie ivanov et al 2008 2010 emulates essential processes of water and energy dynamics over the complex topography of a river basin each computational element has a canopy layer that contains two big leaves sunlit and shaded representing the canopy above ground processes are coupled to a multi layer soil model that computes soil moisture root water uptake and heat transport using the one dimensional richards equation hillel 1980 and the heat diffusion equation in the direction normal to the element s surface gravity driven flow for the unsaturated lateral exchange is assumed and the dupuit forchheimer approximation bear 1979 for the saturated lateral exchange is implemented subsurface flows are routed using the d flow routing algorithm tarboton 1997 and the flow directions change dynamically for the saturated zone leading to spatial dynamics that reproduce the three dimensional numerical solutions hopp et al 2015 in this study vegetation dynamics are not simulated only the biochemical model of photosynthesis and canopy stomatal behavior collatz et al 1991 farquhar et al 1980 leuning 1990 1995 is used to simulate the response of latent heat flux to above and below ground conditions the amount of leaf area as well as other structural characteristics of vegetation are imposed as pre determined model input see section 2 1 1 2 2 1 selection of uncertain inputs one source for hydrologic uncertainties in the amazon is the presence of deep soils which give rise to fluctuating groundwater across climes and seasons cuartas et al 2012 miguez macho and fan 2012b due to difficulties in instrumenting and measuring groundwater data are sparse and even experimental catchments have few wells drilled for measuring water table depth the spatial distribution and initial states of groundwater can impact hydrologic models such as spin up performance of the model e g ajami et al 2014 seck et al 2015 or providing better estimates of the impacts on below surface processes to earth system models clark et al 2015 riley et al 2011 additionally accurate representation of groundwater processes at smaller scales can provide valuable information to larger scale groundwater processes and their impacts on earth system processes fan 2015 fan et al 2013 krakauer et al 2014 riley and shen 2014 the large soil column depths in the amazon mean that the parameterizations of soil properties in a hydrologic model may have a large effect on the simulated groundwater and vadose zone dynamics some field or lab measurements may exist for the soil properties through core testing or well pump tests but these are limited to accessible areas and may not necessarily represent bulk soil properties in the catchment kowalsky et al 2004 russo and bouton 1992 in this study soil parameterizations are selected as uncertain inputs into tribs veggie the soil properties that represent the uncertain model parameters x are treated as random variables with distributions provided in table 2 to represent uncertainty in the soil water retention curve characteristics of the soil the parameters for the pedotransfer function fc fs αcs me ρb see section 2 1 2 are treated as uncertain values for the saturated conductivity ks and the anisotropy ratio ar were not a part of this pedotransfer function but represent the infiltration and lateral transport characteristics of the soil these are therefore also treated as uncertain with value ranges estimated using the studies of cuartas et al 2012 and fang et al 2017 2 2 2 water table initializations given soil parameter uncertainty given that the soil parameterizations are treated as uncertain water table initializations that adequately represent the initial state of the water table within the watershed are required for example a shallow water table will result under a simulation with a soil type with a low hydraulic conductivity and a deeper water table will result with a higher hydraulic conductivity setting the water table to some fixed value for the entire basin then allowing steady flow conditions to develop for a given soil type through forcing and draining requires computational resources e g seck et al 2015 which would be a detriment to the desired efficiency from the uq approach in this paper groundwater well data for the watershed e g cuartas et al 2012 fang et al 2017 are available only for a few locations along a transect in the watershed this limitation in both spatial and topographic spaces e g elevation height above nearest drainage slope etc implies that the available data are inadequate to create meaningful realizations of initial depth to water table to be used in simulations however groundwater plays an important role in seasonal flooding and et dynamics of the amazon miguez macho and fan 2012a 2012b it must be accounted for in any comprehensive hydrologic modeling and therefore some uncertainty should be associated with the water table initialization in this work uncertainty in the initial depth to water table is propagated through parametric uncertainty using a subset of the uncertain parameters in table 2 specifically the initial water table depth is estimated using an adapted mapping function from sivapalan et al 1987 this method supposes that there is a steady state groundwater profile throughout the basin and that the streamflow at initialization time q t 0 is derived from a constant spatially uniform recharge to the groundwater furthermore each location in the basin has a contribution qi defined by its position in the watershed drainage network 2 q i a c q a where qi is the saturated lateral flow ac is the surface contributing area of a computational cell q is the semi steady state discharge at the basin outlet and a is the total basin area this approach also assumes that the water table is parallel to the soil surface so the subsurface drainage aligns with the topographical gradient the water table depth for a single computational cell is given by 3 n iwt 1 f ln f a c q a k 0 a r w tan s 0 where n iwt is the initial local water table depth k 0 is the surface saturated hydraulic conductivity f is the exponential decay parameter of k 0 with depth beven 1982 ar is the soil anisotropy ratio ivanov et al 2004 w is the width of the saturated flow between cells and s 0 is the surface slope the decay parameter f is not used in the representation of the soil hydraulic model in this work however the rest of the parameters of eq 3 are known and therefore a value of f can be solved for a given set of soil parameters and local watershed characteristics at any location specifically the water table depths n iwt are derived by taking the temporal average of water table depths for each observation location described in section 2 1 5 the values of k 0 and ar are treated as uncertain and obtained from sampling see table 2 and the rest of the variables in eq 3 are derived from the basin topography this leaves f as the only unknown of the equation and therefore f can be derived for each soil type in the uq framework through least squares optimization to fit the data to the model in eq 3 the estimated value of f for each soil type used in the uq procedure enables the generation of an initial spatial distribution of water table specific to the soil parameterization used in the simulation the initial water table fields generated through this process were checked for their consistency and magnitudes with the mean and variability in the initial water table fields given in fig s1 the use of the outlined approach provides a realistic representation of the water table depth and also offers an initialization tuned to the uncertain soil parameters 2 3 uncertainty quantification framework tribs veggie has a large set of inputs that could be treated as uncertain these are closures for certain approximations to physical laws or parameters describing a property of a medium for example important for the movement of water in the domain e g saturated conductivity for different soil types present in the domain in addition to these parameters there are input fields that describe spatial or temporal states of the simulation watershed these parameters and fields represent the assumptions made about the makeup and behavior of the domain they are inherently uncertain since it is not possible to have perfect information about the system being modeled and this is especially true for natural systems therefore instead of encoding assumptions into single estimates about the system in question we embrace the uncertainty in our knowledge and attempt to quantify the consequences of this uncertainty on simulation results in this study only parametric inputs to tribs veggie will be treated as uncertain to focus on the application of the uq methodology with a discussion of the use of spatial input fields for uq in section 4 2 3 1 surrogate modeling let s consider a model m i e tribs veggie in this study with inputs x where x x 1 x 2 x m e g m 7 for this study this model is used to predict some output quantity of interest qoi y r where y can be assumed to be a scalar quantity for now but it can and will be used for multiple qois in this work this model can be viewed as a simple function that maps uncertain inputs to an uncertain output 4 y m x we assume that m is a deterministic model that can scale in complexity depending on the problem being solved e g in its simplest form it could be m x x i where uncertainty quantification becomes interesting is when m is complex such as the numerical solutions to the governing equations of fluid flow it is not uncommon for investigations of fluid flow to make single evaluations of the model represented by eq 4 and treat it as a black box i e the internal model dynamics are assumed unknown and only a relationship between model inputs and outputs is analyzed the only requirement that is imposed on the model is that it must be executable i e provided its inputs x the model produces its output y if we believe that the model m adequately captures the dynamics of the system being modeled then we can also believe that the output y m x we receive from the model gives an accurate prediction when the values of the input parameters variables x are known however a typical case for the majority of models of environmental systems is that input values are uncertain either due to natural variability in the system e g kim et al 2016b kim et al 2016c or inadequate knowledge of parameter values in general in this case it is appropriate to represent these input parameters as uncertain so they follow a random vector 5 x π x where x x 1 x 2 x m and π x is a vector of marginal and therefore independent probability density functions pdf describing the variability in each of the m uncertain variables in x which are known and defined prior to modeling random input variables to the model result in qois that can also be treated as a random i e 6 y m x with uncertainty propagation we are interested in determining the probability distribution of y for example if y roughly follows a gaussian distribution the mean and variance of y could be considered as estimates of the location and scale of the distribution however with complex interactions occurring within the model m the distribution of y could be multi modal or have large skewness or kurtosis making conventional methods relying on the assumption of gaussian behavior a poor approximation as an illustration consider that if the model output of interest has a similar variability as the prediction quantity y in fig 3 one cannot describe the output distribution through its first moments and the full characterization of the density function is required in order to investigate uncertainties and sensitivities of model outputs to its inputs many model runs must be performed this has traditionally been done using collocation methods taking a sample from the input distribution and identifying the output value resulting from that sample allowing for the construction of a probability density function of the model s outputs this is often done using monte carlo methods but the computational expense of monte carlo methods quickly scales with the complexity of the model and is prohibitive when multivariate problems are considered blatman and sudret 2011 marzouk and xiu 2009 an alternative approach is to approximate the fully deterministic model with a polynomial expansion used to create a surrogate model also known as metamodel e g miller et al 2018 najm 2009 ricciuto et al 2018 xiu and tartakovsky 2004 the approach of metamodeling is used to offset the cost of forward computationally expensive deterministic simulations by approximating the latter with inexpensive surrogate models polynomial chaos expansions pces represent one such metamodeling technique that provides an approximation to a computer model through its spectral representation on a basis of polynomial functions elsheikh et al 2014 najm 2009 specifically if we have a set of relationships as described in eqs 4 6 we wish to approximate the deterministic model m with a suitable polynomial expansion the expansion relies on polynomial basis terms ψm x that are orthogonal with respect to the distribution of x meaning ψ m x ψ n x π x d x 0 for all m n where m and n denote indices of a polynomial sequence and the integral represents the inner product of polynomials with a weighting function π x the model output can then be approximated with le maître and knio 2010 xiu and karniadakis 2002 7 y m x α n m c α ψ α x the uncertain input x will have an associated polynomial ψ α where α α 1 α 2 α m is a multi index introduced to simplify notation and represents the ordering of terms in the polynomial an illustration of the multi index and how it leads to the construction of a pce is included in the supplementary materials s 2 one typically models the stochastic dimension m to be equal to the number of uncertain variables x x 1 x m the parameters cα are deterministic polynomial expansion coefficients and ψα x are multivariate polynomials orthogonal with respect to the random variables x the multivariate polynomials ψα x in eq 7 are defined as products of univariate polynomials le maître and knio 2010 app c 8 ψ α x i 1 m ψ i α i x i based on the marginal distributions of random variables in x different polynomial bases are used xiu and karniadakis 2002 examples of continuous orthogonal polynomials are provided in table s1 the property of orthogonality implies that the first two moments of uncertain quantity of interest y can be extracted analytically from the expansion coefficients c α enabling very efficient moment evaluation see s 2 for an example in practice the right hand side of eq 7 is a finite sum through a truncated pce lin and karniadakis 2009 xiu and karniadakis 2002 9 y m x m pc x j 0 p c j ψ j x where j is a count of the multiindices α with a predefined order this is discussed further in the supplementary materials there are a number p 1 polynomial basis functions a typical truncation rule a total degree truncation of degree p i e i 1 m α i p leads to see xiu and karniadakis 2002 10 p 1 m p m p we select a finite number of terms by only including those with a total degree of polynomials from eq 8 smaller than a certain value p once the selection of uncertain input variables and the polynomial basis table s1 has been made one can solve the polynomial chaos expansion eq 9 non intrusively meaning that the pre and post processing of model inputs and outputs takes place without having to make any changes to the mechanistic model m to do this one treats the fully deterministic model m as a heuristic black box model to inform the metamodel m pc constructed through the polynomial chaos expansion the goal is to obtain the right hand side of eq 9 where cj are deterministic weighting coefficients and ψj are the polynomial expansions of the order associated with the index j for realized sampled values of x the values for the coefficients c c 0 c 1 c p allow the calculation of the distribution of model output y as it was induced from the model input x these coefficients are calculated by solving eq 9 through either gaussian quadrature smolyak 1963 regression berveiller et al 2006 blatman and sudret 2008 2011 tibshirani 1996 or bayesian approaches doostan and owhadi 2011 sargsyan et al 2014 the next step is to estimate the distribution of model output y as informed by the uncertain but pre defined through marginal pdfs model input x the approximate response of y is obtained through sampling often markov chain monte carlo mcmc haario et al 2001 because the constructed surrogate model in eq 9 is much cheaper computationally than a complex original deterministic model m the surrogate model m pc is assessed using samples of the random vector x these samples can be taken via e g random uniform stratified or latin hypercube sampling mckay et al 1979 where the latter is used in this work the above considerations result in the feasibility of calculating a polynomial chaos expansion of the model response by using monte carlo or other sampling techniques eldred and burkardt 2009 marzouk and xiu 2009 in addition to the convenience of numerical approximation the first two moments of the model output are obtained from the coefficients of the constructed pce such that the mean μ and variance σ 2 of a scalar model output can be calculated as in le maître and knio 2010 11 μ p c e m p c x c 0 12 σ 2 p c var m p c x e m p c x μ p c 2 j 1 p c j 2 the previous section was undertaken with a single qoi y for multiple qois y y i i 1 k the preceding process is carried out for each qoi i e each qoi is a scalar valued output of m which can be represented by a surrogate the remainder of the methodology assumes a single qoi unless otherwise noted 2 3 2 bayesian compressive sensing for pce construction the limiting factor in the surrogate modeling approach to uncertainty quantification is the amount of model simulations one can perform with the expensive deterministic model m in order to solve for the coefficients in eq 9 there may be a large number m of uncertain variables x to address in the model which may result in the curse of dimensionality caflisch 1998 davis and rabinowitz 2007 i e it is not feasible to adequately sample the high dimensional input variables to construct the surrogate model m pc x techniques that have been used to address this issue include sparse regression techniques e g blatman and sudret 2008 blatman and sudret 2011 vidaurre et al 2013 and the bayesian compressive sensing bcs approach for the pc framework introduced by sargsyan et al 2014 bayesian compressive sensing bcs ji et al 2008 sargsyan et al 2014 aims to identify a sparse set of the coefficients cj to satisfy eq 9 this is in contrast to other truncation methods used for pces such as total degree tensor product or hyperbolic cross see sargsyan et al 2014 which treat each dimension input variable equally or truncate the expansion a priori one would like to select a basis set containing terms that convey meaningful contributions to model output y while discarding terms that do not for example if one chooses uncertain input variables that do not have a dependence relation to each other in the hydrologic qoi then one would expect basis terms that account for the interaction of these variables to be zero including these terms provides no further information or variance in the hydrologic process of interest with this motivation this study uses bayesian compressive sensing bcs babacan et al 2010 ji et al 2008 sargsyan et al 2014 to find a sparse set of coefficients to satisfy eq 9 details of this approach are left to sargsyan et al 2014 with a brief overview provided in appendix a the practical implications of employing the bcs technique is that it can greatly reduce the size of the basis set required to construct the surrogate model therefore the technique limits the impact of the curse of dimensionality stemming from treating a large number of parameters as uncertain the amount of this reduction is problem and model dependent but generally grows relative with the number of uncertain input variables due to the number of higher order interaction terms that arise for example a problem with 20 uncertain model parameters will have a larger percentage reduction in required simulations of the model m than a problem with five uncertain parameters 2 3 3 sensitivity analysis once the surrogate model 9 has been constructed the use of monte carlo methods allows the computation of sobol indices for global sensitivity analysis of the model to its input uncertain variables saltelli 2002 sobol 2001 sudret 2008 in the context of pce surrogate models estimates of sobol indices is gained directly from the pc surrogate offering a convenient and computationally efficient way to determine the relative importance of uncertain inputs to the variability of the quantities of interest sobol indices are split into main and joint sensitivities where the former measures the fraction of variance in the output that can be attributed to the uncertain model input variable xi 13 s i var e m c pc x x i var m c pc x where e and var are operators for expectation and variance respectively similarly the joint sensitivity measures the fraction of variance in the output that can be explained by to the joint contribution of variables xi and xj and is defined as 14 s i j var e m c pc x x i x j var m c pc x s i s j an additional benefit of using pce machinery for the surrogate model is that the sobol sensitivities in equations 13 and 14 can be calculated directly from the coefficients of the pce using the relations from eqs 11 and 12 one can write the main and joint sobol indices in terms of the pce coefficients this yields an estimate for the main effect index s i main as 15 s i main α a i main c α 2 ψ α 2 α a α 0 c α 2 ψ α 2 where a i main α a α i 0 α i j 0 similarly one can use the pce coefficients to account for the variance contribution between interactions of xi and xj through the estimate of the total effect index s i total 16 s i total α a i total c α 2 ψ α 2 α a α 0 c α 2 ψ α 2 where a i total α a α i 0 the benefit of eqs 15 and 16 is that once the pce surrogate m pc is constructed global sensitivity analysis via sobol indices can be conveniently gained by performing simple arithmetic on the coefficients of the pce surrogate for both the main and joint sensitivities the posterior distribution of the pc coefficients c are available it is possible to calculate uncertainty in the sensitivity indices by sampling from the posterior distribution of c to calculate eqs 13 16 but this study will use only the mean estimates of the coefficients for sensitivity calculations 2 4 parameter inference given a suite of results from a mechanistic model m and its constructed polynomial surrogate m pc one can infer which values of uncertain input parameters x are most likely to provide results that match an observed quantity an advantage of the approach outlined here is that m pc enables very efficient inverse analysis marzouk and xiu 2009 more generally inverse problems occur when there are related observations but they are not necessarily the ultimate quantity of interest within hydrology and particularly in sparsely monitored basins there is a long history of parameter identification through some form of inversion e g kirchner 2009 mclaughlin and townley 1996 neuman et al 1980 yeh 1986 the use of surrogate models with dimension reduction as outlined in the previous sections provides a novel approach enabling faster computation inversion and the ability to solve the inverse problem on a larger set of uncertain model parameters as an example take u to be a vector of observed data such as streamflow and x x 1 x 2 x m be the vector of uncertain model input parameters such as soil hydraulic properties we further assume that the model gives an adequate approximation of the observed streamflow u m x the use of bayes rule allows for the computation of the posterior parameter values conditioned on the observed data 17 π x u l u x p x where p x is the prior distribution l u x is the likelihood function which represents the probability of obtaining the data given the set of parameters and π x u is the posterior distribution for x which represents the probability of having the parameter values given the observed data to formulate a likelihood function one must represent the discrepancy between the model and observations η u m assuming that the components of η are independent and identically distributed random variables with some marginal density pη the likelihood function can be written as 18 l u x d 1 d p η u d m d x where there are d conditions e g time snapshots of measured streamflow monthly evapotranspiration etc that are being used for inference if one assumes as in this study that the errors ηd are independent and normally distributed ηd n 0 σ 2 eq 18 can be written as 19 l u x 1 2 π σ 2 d d 1 d exp u d m d x 2 2 σ 2 where the logarithm of this likelihood function corresponds to the least squares form of the objective function often used for deterministic parameter estimation sargsyan et al 2015 if measurements are taken at different times for the observed data series e g streamflow the variance in error may not be the same at each sampling time and almost surely will not be equal due to temporal variations of streamflow due to hydrologic seasonality therefore it can be valuable to introduce σ 2 as a scalar hyper parameter for the likelihood sargsyan et al 2015 and rewrite the joint posterior distribution of eq 17 as 20 π x σ 2 u 1 2 π σ 2 d exp u d m d x 2 2 σ 2 p x 1 p x n p σ 2 the prior distribution for the model parameters p xi are based on their a priori knowledge e g that the parameters are uniform within a range or normally distributed with some mean and variance as the variance of the error noise σ 2 must be positive we therefore use a jeffreys prior jaynes and bretthorst 2003 21 p σ 2 1 σ 2 for σ 2 0 0 otherwise to infer values for uncertain model parameters the posterior distribution from eq 20 needs to be sampled using methods such as the metropolis hastings mcmc mackay 1998 note that sampling from posterior distribution requires repeated evaluation of the likelihood implying multiple evaluations of the model m this tends to be computationally expensive and it is therefore expeditious to replace the model m with its pce surrogate m pc in this way the methodology outlined previously in this section can be combined with those in sections 2 3 1 and 2 3 2 to create a computationally efficient flexible framework to infer uncertain parameter values for a complex process based hydrologic model with multiple inputs applied to sparsely monitored watershed as in this study the methodology is able to answer the question of inverse inference what is the likely distribution of the model s uncertain parameters given observed data importantly it is also able to address the question of what are the possible outcomes for specific quantities of interest given the uncertainty in the model s inputs 2 5 summary of uq framework sections 2 3 2 4 presents a general framework of high flexibility to infer model parameters for a hydrologic model in a computationally efficient manner by using polynomial surrogates fig 3 provides a diagram outlining this framework generally one uses a hydrologic model to construct a polynomial surrogate model box a that allows for fast computation of output quantities of interest from the hydrologic model in the case of many uncertain input parameters dimensionality reduction tools such as bcs are used to alleviate the burden of multi dimensionality of uncertain inputs for constructing the surrogate models after a surrogate has been constructed one can then use it for accelerated computationally inexpensive inference of the uncertain parameters for the hydrologic model provided that there are available data matching a quantity of interest box b once the posterior distributions of the uncertain parameters have been calculated they can then be used within a model g x in theory g x can be any model that uses the parameters x but it is prudent to use the posterior values in the same model used for inference within this study g x is going to be tribs veggie m in order to estimate other quantities of interest section 2 1 5 a methodological step that accounts for model error is not shown in fig 3 and therefore is not accounted for in this study more specifically the likelihood function in box b accounts for data error but does not consider the structural error of tribs veggie accounting for model error is an active ongoing area of research within uq e g sargsyan et al 2018 but is beyond the scope of this study the strength of this approach in the context of uncertainty quantification is the relationship between qois as discussed in section 2 3 1 and observational data any qoi can be used for inference as long as one has a preconstructed pce surrogate for it if one can relate observational data to the qoi being addressed through m pc then accelerated inference for diverse outputs e g hydrologic hydraulic ecologic biogeochemical etc is possible within complex hydrologic models 3 results this section provides an overview of the results of the construction of the surrogate model from section 2 3 uses the performance of the surrogate model against observations table 1 inference column to infer parameter values and relies on the latter to investigate the response of hydrologic variables of interest within the catchment the data used to construct the surrogate and perform inference are summarized in fig 4 the figure for discharge shows that the model training simulations underestimate the aggregated observed discharge with a small amount of uncertainty associated with the tribs veggie simulations water table data are aggregated into groups based on observed well locations section 2 1 5 although the simulations generally underestimate water table depth the uncertainty from the training simulations overlap with the observed data simulated evapotranspiration falls within the uncertainty bounds of the observed data with a slight overestimation of et during the wet season lastly soil water content is generally overestimated but the uncertainty in the training simulation overlaps the observed data ideally one would like the training simulations to overlap the observed values used for inference but this is not the case for all qois especially those in the discharge and water table groups however section 3 2 shows how this can be overcome using the inference techniques to better confirm tribs veggie with the observed data 3 1 surrogate construction the polynomial chaos surrogates m pc were constructed as in eq 9 for the qois in table 1 to have a well performing surrogate m pc should match the simulations of the mechanistic model tribs veggie m in fig 5 the absolute errors between the constructed surrogate m pc and training simulations of tribs veggie m are shown as illustration simulation results used for training purposes of constructing the surrogate are shown also shown are the results corresponding to validation of the surrogate i e a comparison of the forward tribs veggie model simulations and outputs of the trained surrogate for the same qois a quantitative error measure of the surrogate accuracy is the relative l 2 norm as a representation of error defined as 22 l 2 rel i 1 n s m i pc m i 2 i 1 n s m i 2 1 2 where ns is the number of training or validation simulations performed the value used for ns depends on the computational expense of the model and one would like to have at least 3 4 samples in each uncertain parameter dimension which in this study would result in at least 3 7 2 187 runs of tribs veggie to summarize surrogate performance the qois are aggregated into streamflow water table depth evapotranspiration and soil moisture groups these groups are used to illustrate the relative surrogate error as a function of pc order in fig 6 which shows that for training simulations the decrease in l 2 rel is muted after a pc order of 5 or 6 we selected a surrogate order p 6 for m pc as the optimal order that leads to a sufficiently accurate surrogate without overfitting given the seven uncertain input parameters table 2 eq 10 gives a required p 1 1 716 basis terms in m pc only 100 training tribs veggie simulations were used for bcs to construct the surrogate an additional 10 simulations were used to validate that the constructed surrogate accurately represented the qois from tribs veggie for both the training and validation cases simulation points were selected via latin hypercube sampling mckay et al 1979 qualitatively figs 5 and 6 a both show that the surrogates performs slightly better i e lower values of l 2 rel in fig 6 using training rather than validation results this is the desired behavior as it means that the stopping criteria ϵ from the bcs method section 2 3 2 appendix a are chosen correctly in the case where reducing ϵ improves the performance reduction in l 2 rel at the training set but at the expense of performance at the validation set overfitting has occurred in surrogate training this means that the surrogate is being trained to only capture the behavior near the parameter samples at the training locations and will not accurately capture the behavior at a significant distance away from these training samples evidence of overfitting would be that l 2 rel decreases with training data but remains the same or increases in the validation data set this is what occurs if higher order terms in the expansion are retained for most groups of qois 3 1 1 sensitivity analysis using a constructed pce model allows for efficient computation of the main and joint effect sensitivity indices from equations 13 and 14 one can assess the sensitivity contributions for a single qoi or for uncertain parameters across multiple qois for the first instance the main and joint sensitivities of the uncertain parameters for the qois of water table group 5 and evapotranspiration in april 2004 are shown in fig 6c and d respectively the main effect sensitivities the fraction of variance described by changing each uncertain parameter in isolation averaged over the input distribution of the other parameters are given on the diagonal of these figures for the water table and evapotranspiration groups one sees that k sat is the dominant contributor in the variation of the qois shown this displays that the model is qualitatively consistent as a higher value of saturated conductivity allows faster drainage from the soil and impacts water available for vegetation transpiration in the case of fig 6d the lower diagonal on fig 6c and d represents the joint effect sensitivities e g in fig 6c terms in the expansion containing both ks and ar account for approximately 9 5 of the variability seen in the fifth water table group while the equivalent contribution from terms containing both ar and fc is approximately 0 45 recalling from eqs 15 and 16 these sensitivities are computed directly from the pce coefficients so sparsity or very low values in the lower diagonal e g fig 6c represents zero or near zero values of the coefficients multiplying terms containing the uncertain parameters the implication of this sparsity is that interaction between those parameters in the model have an insignificant impact on the resultant value of the qoi these indices are computed for each qoi and summarized sensitivities across all qois are given in fig 6b based on the contributions to the variances of the qois it is clear that k sat is the uncertain parameter with the largest impact on model sensitivity for the identified qois this confirms intuition since values of k sat control both infiltration excess runoff as well as impact of lateral flows in the hydrologic system which is not included in the pedotransfer function of tomasella et al 2000 those parameters which are included in the pedotransfer function change the shape of soil water retention curve therefore sensitivity to these parameters fc fs αcs me ρb indicates sensitivity of qois to the water retention characteristics of the soil 3 2 inference of soil properties after the surrogate model is obtained it is possible to calculate the posterior distribution of model parameters through mcmc sampling as described in section 2 4 by replacing m with m pc this enables faster computation and benefits hydrologic models that take more than a few minutes to perform a single simulation the marginal and pairwise marginal posterior distributions of the hydrologic parameters in table 2 are shown in fig 7 these marginal posterior distributions are summarized in table 3 by their moments maximum a posteriori map estimate i e the mode of the posterior distribution and the coefficient of variation ratio of standard deviation to the mean value these posterior distributions provide information about the bulk soil properties of the watershed e g that the soil is mostly clay and silt with a saturated conductivity around 20 mm h and an accompanying anisotropy ratio of approximately 1 25 these values are in agreement with previous studies of the catchment e g cuartas et al 2012 tomasella et al 2008 which found four different soil types within the watershed the clay contents for these four soil types below 1 m ranged between 5 and 90 clay where the soil type with 80 90 clay accounting for 45 of the catchment and the soil type with 5 clay accounting for 30 of the catchment using a single soil type in the catchment represents an aggregation of the physical properties whereby the posterior mean for clay content of 56 is reasonable based on the observed properties the other parameters of the pedotransfer function fall within ranges given in tomasella et al 2000 with additional qualitative agreement between the textural classification shown for manaus located south of the case study asu watershed the hydraulic properties of ks and ar in cuartas et al 2012 have sixteen classifications based on landscape classes and depth with the inferred values in this study indicating a soil type similar to the plateau or slope landscape which are at least 15 m above the nearest stream node accounting for approximately 45 of the catchment area similarly fang et al 2017 contains hydraulic properties with a single landscape classification at four depths where ks is approximately between 9 and 15 mm h with a r 1 which qualitatively agrees to the inferred value of 15 8 mm h additionally one can assess the pairwise correlations between parameters using fig 7 e g that the anisotropy ratio ar is negatively correlated with saturated conductivity ks posterior predictions of the qois are demonstrated in fig 8 here the joint posterior distribution from fig 7 is sampled in order to calculate the qoi values using the surrogates constructed in section 3 1 a comparison can then be made between the posterior qoi values and the observed data values one sees that the posterior qois for et and soil moisture match the data better than for discharge and depth to water table there are two main factors contributing to this 1 the simulated using m et and soil moisture match the corresponding observations better than the simulated discharges and water table depths see fig 4 and 2 data noise for these qois are much lower than those for discharge nonetheless one may attempt to improve the skill if it is deemed unacceptably low if one were interested in getting a better fit to the data for a set of qois one could i select a larger training set to have more chances for the simulation results of m to match observations ii perform inference using a subset of the observed data and qois in an attempt to exclusively fit for that subset of data e g see a discussion below in relation to fig 9 or iii attempt to collect more data to constrain the data noise in the cases of options ii and iii the pce framework provides a benefit of not needing to rerun simulations of the computationally expensive m but also allows fine tuning of model parameters for investigations into specific qois modeling factors impacting the difference between and the uncertainty of simulated and observed quantities include spatial resolution and soil property variability the watershed used in this study has a steep transition between the plateau and lowland areas chauvel et al 1987 cuartas et al 2012 the slopes caused by this transition in conjunction with the 90 m spatial discretization end up creating a resolution effect for quantities such as ground water the horizontal position of the water table well within the computational cell can impact its agreement to observed water table depths additionally the channel is represented within the model using the 90 m cells and the lack of an incised channel means that drainage from the saturated zone to the channel is less efficient all quantities also could have been affected by the lack of spatial variability in soil properties four soil types are reported for this watershed in cuartas et al 2012 with one representative soil type being used in this study as a result quantities that are measured at specific locations water table depth evapotranspiration and soil moisture content are likely affected by this modeling choice the posterior qois as a result of performing inference separately on each group of qois i e only data of a given group are used to infer the entire set of parameters in table 2 are shown in fig 9 in this figure the data noise σ 2 in eq 20 was set as a hyper parameter and was also inferred because it provides a better fit of the mean prediction of m pc to the data this was done to illustrate an approach that can be undertaken when data noise is large to the point of observations becoming uninformative e g in the case of discharge and et data in this case a jefferys prior eq 21 is used for σ 2 performing inference on each group of qois is done at the expense that the parameter posterior distributions become specific for each separate group of qois the posterior distribution in fig 9 for the variables xi contain other important details about the information that can be gained with inference for example the marginal posterior distribution for the bulk density ρb is very close to the uniform prior distribution for most groups of qois since this parameter is not informed by the available data except for soil moisture whether one takes the approach shown in fig 8 or 9 will depend on the questions being investigated generally the bayesian framework prefers including all data to perform inference as long as the data are informative in the case where data come from disparate sources e g sporadic sampling of discharge vs hourly evapotranspiration measurements one may want to separate the inference using these data or incorporate more detailed structure in the data noise representation among groups of qois to better inform their impact on inference 3 3 computing qois from posteriors with the framework presented in this study one can construct a surrogate model for quantities that have been observed section 3 1 and use this surrogate to confirm the model s behavior section 3 2 this allows one to investigate a wide variety of model behaviors such as higher frequency or aggregated quantities at coarser or finer temporal spatial intervals in this work the parameter posterior distribution from fig 9 resulted in a chain of 19 000 posterior values for each parameter in table 2 which can be directly sampled and used as input to a constructed surrogate box c in fig 3 from table 1 the qois held out from inference were q 95 the 95th percentile of daily averaged discharge during 2005 representing the probability that 18 days during the year have a mean daily discharge larger than q 95 ts q the daily time series of streamflow in 2005 and ts e t dry daily evapotranspiration in months with cumulative water deficit as defined in eq 1 illustration plots and sensitivity information for these qois are given in fig 10 note that the surrogates for these higher frequency and aggregated qois were not constructed in section 3 1 but doing so is straightforward and follows the methodology of section 2 3 1 these results are provided to illustrate the flexibility of the uq framework the benefits of the approach include that one can investigate hydrologic response at higher temporal and spatial resolutions for example one can see the pattern of discharge in fig 10 follows that of fig 9 but unlike the original data sourced in fig 4 the illustration provides daily estimates of discharge 4 discussion despite recent advances in computational power simulation times for complex process rich hydrologic models even for low order catchments can be significant when a large number of uncertain parameters or generally uncertain model inputs are used thousands of model simulations may be required to perform robust comprehensive uncertainty quantification parameter inference and sensitivity assessment even reduced order simulation approaches recently introduced to earth system and environmental modeling would be prone to computational issues this study addresses this challenge and adopts an efficient methodology to enable uncertainty quantification and stochastic simulation with deterministic process based hydrologic models of higher complexity this work applies recent developments that combine reduced order modeling based on polynomial chaos expansions with bayesian compressive sensing to construct computationally cheap surrogate formulations of the complex hydrologic model while significantly reducing the number of required simulations the surrogate representation enables bayesian inversion and calibration of uncertain model variables for any model output that can be compared to observable data even when these are sporadic and have time varying accuracy furthermore surrogate formulation can be used to propagate uncertainty through a hydrologic model for any of the model s outputs enabling one to estimate uncertainties of qois that are difficult or too costly to measure a limitation of this study is the intentionally constrained nature of possible sources of input uncertainty included in the analysis as mentioned in section 2 3 one can use both parametric and input spatial field uncertainty within the uq framework the parametric type was chosen to display a clear presentation of how uncertainty can be addressed using a complex model this approach however does not limit an extension of the analysis to other uncertain variables or spatial fields for instance the incorporation of the uncertainty in spatial or temporal fields is important to determine hydrologic response kim et al 2019 an approach to address this uncertainty within the framework includes creating a stochastic model of the uncertain field using a karhunen loéve expansion karhunen 1946 zheng and dai 2017 this decomposes the uncertainty in the spatial field into a parametric stochastic model where the uncertain parameters can be included into x following this philosophy uncertain soil moisture precipitation or water table fields could be propagated through a hydrologic model this is beyond the scope of the current study and will be addressed in future research furthermore there is evidence suggesting that multiple soil types are present in the study domain e g cuartas et al 2012 tomasella et al 2008 while a single soil type was used in this work this design choice was undertaken for two reasons i to represent the more typical case in hydrology of not having detailed soil data available and ii for an unobscured clean presentation of the methodology without extraneous details that would arise from using multiple soil parameter sets if finer detail of soil representation were included one would expect inference and sensitivity to be weighted to the spatial coverage of soil types for example the hydraulic conductivity of a soil type controlling infiltration of precipitation into the subsurface would have a greater contribution to the variation of streamflow if the soil type covered 50 rather than 10 of the watershed another limitation is the current version of the model used in this study tribs veggie has a limited capability to incorporate vertical heterogeneity to the soil column the approach is flexible and relies on a priori identification of input variables of high impact before modeling this means that although one can change the qois being investigated by working with the model s output one cannot change the parameters that are treated as uncertain without having to rerun training and validation simulations given the reduction in computational expense due to the use of the bayesian compressive sensing methodology it is possible to treat dozens of model parameters as uncertain ricciuto et al 2018 sargsyan et al 2014 essentially assuming no a priori knowledge of impactful variables however in most cases in hydrology it is beneficial to constrain the number of uncertain parameters using expert knowledge about the governing processes controlling qois and the respective variables impacting these processes alternatively one can do an initial screening of model parameters with bayesian compressive sensing this will not produce an accurate surrogate but will yield accurate sensitivities so the parameter space can be reduced and the procedure repeated to gain a more accurate surrogate given the scale and complexity of environmental systems one must include uncertainty if one hopes to capture or discover complex hydrologic behavior uncertainties are ubiquitous within the field of hydrology e g a measurement of a basin aggregated metric such as streamflow fig 4 is subject to uncertainty within the catchment or there may be interactions with model input variables meaning that to best capture reducible uncertainty about variables description through probability densities fig 7 is preferred over scalar deterministic values in either case the presented approach offers a novel sufficiently general way forward to address uncertainties in hydrology reducing or defining the uncertainties of model inputs generally the framework outlined in this study provides flexibility to address computationally expensive problems in hydrology e g high resolution modeling of soil moisture ivanov et al 2010 krasnosel skii and pokrovskii 1989 representation of macroporosity e g beven and germann 1982 etc by enabling high fidelity simulations under uncertainty in the cases where these simulations are highly sensitive to input parameters and forcings the presented approach can be applied to high dimensional parameterized input x relevant software tools have been developed in recent years so that the hydrologist need not also be an expert in uncertainty quantification to apply these methodological approaches those that are freely available for research use and actively developed include the uncertainty quantification toolkit uqtk debusschere et al 2017 version 3 0 4 used in this study uqlab marelli and sudret 2014 and the mit uncertainty quantification library parno et al 2014 acknowledgments the study was funded by the national science foundation grant ear 1151443 career a multi scale approach to assessment of climate change impacts on hydrologic and geomorphic response of watershed systems within an uncertainty framework the doe office of science graduate student research award 33165 doe award de sc0011078 understanding the response of photosynthetic metabolism in tropical forests to seasonal climate variation the catalyst program of the michigan institute for computational discovery and engineering at the university of michigan and by the nsf grant 1725654 to v ivanov j kim was supported by a grant 19awmp b127554 03 from the water management research program funded by ministry of land infrastructure and transport of the korean government special thanks to sandia national laboratories and the uncertainty quantification group for their help with navigating uq and uqtk sandia national laboratories is a multimission laboratory managed and operated by national technology and engineering solutions of sandia llc a wholly owned subsidiary of honeywell international inc for the u s department of energy s national nuclear security administration under contract de na 0003525 the u s department of energy office of biological and environmental research supported the next generation ecosystem experiment ngee tropics project that provided the data used for model simulations available through the pacific northwest national laboratory we would like to acknowledge the generous support of the large scale biosphere atmosphere lba program in the amazon by the national institute for amazonian research inpa we also would like to thank marciel jose ferreira and bruce nelson at the department of forest sciences federal university of amazonas manaus amazonas brazil the authors are thankful to two anonymous reviewers for their constructive comments that significantly improved the manuscript appendix a bayesian compressive sensing for surrogate construction the bcs approach provides marginal posterior probability distributions of the vector of coefficients in the pce model c c 0 c 1 c p given available data d bayes formula jaynes and bretthorst 2003 for this situation can be written as a 1 q c l d c p c where q c is the posterior distribution p c is the distribution representing prior information on the pc coefficient vector c and l d c is the likelihood function i e a measure of goodness of fit for the pce surrogate model m pc from eq 9 to the fully deterministic model m assuming a gaussian noise model with a standard deviation σ representing a tolerance of the discrepancy between m pc and m for the likelihood a 2 l d c 2 π σ 2 n 2 exp k 1 n m k m c pc x k 2 2 σ 2 where k 1 n correspond to realizations of the random input parameters x note that eq a 2 implies independence of marginal likelihood functions the prior distribution p c represents prior information on the pc coefficient vector c the posterior distribution q c is the outcome of the inference given the data set d in the case of pces the prior information of c should be flat so no knowledge is assumed in the calculation of the posterior distribution for c a flat prior distribution is preferred because the use of bcs motivates that many of the terms in c will be very close to zero leading to a lower number of polynomial basis terms that give valuable information for the expansion in eq 9 achieving a sparse posterior distribution is strongly supported by sparse priors that give vanishing values for the coefficients unless there is strong evidence to the contrary as such this study uses the sparse laplace prior babacan et al 2010 that assumes coefficient independence a 3 p c β 2 p 1 exp β j 0 p c j where β is a positive shape parameter that also controls the optimization problem in eq a 4 the vector c that maximizes the posterior distribution q c is given by the solution to a 4 a r g m a x c log l d c β c 1 which is the compressive sensing algorithm used in signal processing candès et al 2006 where the β c 1 term is due to the l 1 norm based regularization approach in bcs the regularization approach is used to reduce overfitting while learning the coefficients c different approaches would lead to different regularization terms in eq a 4 details of the implementation of this approach are left to sargsyan et al 2014 but one of the key points is the selection of stopping criterion specifically the algorithm iterates finding the basis terms c until it reaches a stopping criterion ϵ comparing the relative change in the maximal value of the evidence e the integrated likelihood the stopping criterion is defined as e n e n 1 e n e 1 ϵ where n is the iteration number as ϵ decreases more iterations are required meaning that fewer basis terms are retained in the final polynomial surrogate a discussion on the selection of ϵ is included in section 3 1 for example in sargsyan et al 2014 the community land model with carbon nitrogen cycling thornton et al 2007 was modeled with 79 uncertain input parameters where second third and fourth order polynomials lead to order 103 105 and 106 basis terms respectively using 10 000 model simulations the bcs methodology demonstrated an excellent performance skill for a very large uncertain parameter set by avoiding the calculation of all these basis terms and selecting only those relevant to the qois during testing 17 model simulations failed resulting in 9983 simulations used for training the surrogate model this displays another advantage of the bcs method as failed simulations do not limit the solution of the coefficients as it would in quadrature methods the methodology also allows additional simulations to be added if an initial simulation set is determined to be insufficient to train the surrogate model supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 01 002 appendix b supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
