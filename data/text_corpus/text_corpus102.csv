index,text
510,in gerhard et al 2015a a new class of adaptive discontinuous galerkin schemes has been introduced for shallow water equations including the particular necessary properties such as well balancing and wetting drying treatments the adaptivity strategy is based on multiresolution analysis using multiwavelets in order to encode information across different mesh resolution levels in this work we follow up on the previous proof of concept to thoroughly explore the performance capabilities and weaknesses of the adaptive numerical scheme in the two dimensional shallow water setting under complex and realistic problems to do so we simulate three well known and frequently used experimental benchmark tests in the context of flood modelling ranging from laboratory to field scale the real and complex topographies result in complex flow fields which pose a greater challenge to the adaptive numerical scheme and are computationally more ambitious thus requiring a parallelised version of the aforementioned scheme the benchmark tests allow to examine in depth the resulting adaptive meshes and the hydrodynamic performance of the scheme we show that the scheme presented by gerhard et al 2015a is accurate i e allows to capture simultaneously large and very small flow structures is robust i e local grid refinement is controlled by just one parmeter that is auotmatically chosen and is more efficient in terms of the adaptive meshes than other shallow water adaptive schemes achieving higher resolution with less cells keywords dynamic adaptive meshing multiresolution analysis high order schemes shallow water equation discontinuous galerkin multiwavelets 1 introduction the shallow water equations swe are widely accepted as the appropriate model for the simulation of complex flood flows over realistic terrains garcía navarro et al 2019 robust shallow water solvers are now available mostly based on well established godunov type solvers and primarily based on first order finite volume fv schemes with explicit time integration kesserwani and wang 2014 teng et al 2017 toro and garcía navarro 2007 it is also clear and well established that a certain set of properties must be ensured by the numerical scheme for the solution to be accurate and efficient under complex and realistic flow conditions bermudez and vázquez 1994 caleffi and valiani 2017 díaz et al 2007 li et al 2018 liang et al 2015 murillo and garcía navarro 2010 noelle et al 2007 i mass conservative ii c property iii well balanced iv positivity preserving and v shock capturing there is a trend within the research community to pursue higher order solutions of the swe by muscl reconstructions hou et al 2015 liang and borthwick 2009 reis et al 2018 zhao et al 2019 weno schemes caleffi 2010 lakhlifi et al 2018 navas montilla and murillo 2016 noelle et al 2006 parna et al 2018 and of primary interest herein discontinuous galerkin dg schemes dg has been increasingly and successfully applied to discretise the swe for many applications araud et al 2012 bonev et al 2018 caviedes voullième and kesserwani 2015 duran and marche 2014 escalante et al 2019 kesserwani and liang 2011 kesserwani and wang 2014 kubatko et al 2009 marras et al 2018 neupane and dawson 2015 qian et al 2018 rannabauer et al 2018 schwanenberg and harms 2004 tassi et al 2007 vater et al 2019 wirasaet et al 2015 xing et al 2010 xing 2014 the dg method generalises the concept of the fv method while relying on the finite element fe notion of projecting the solution onto a space of trial functions but without the restriction of keeping the functions continuous therefore the piecewise discontinuous description of the solution allows to achieve high order accuracy while keeping locality this is in clear contrast to weno schemes which require non local information this in turn makes dg schemes highly parallelisable while also shifting computational effort to arithmetic rather than memory transfer a desirable and very convenient property for high performance computing brus et al 2016 rannabauer et al 2018 wintermeyer et al 2018 dg swe solvers are currently still experimental as there are still unresolved issues relating to optimal limiters li and zhang 2017 treatment of source term discontinuities caleffi et al 2016 kesserwani 2013 which relates to well balancing and positivity preservation caviedes voullième and kesserwani 2015 kesserwani et al 2018 and their increased computational cost compared to well established and mature fv solvers kesserwani and wang 2014 the solution to the latter issue i e reducing computational time without penalising accuracy is essential for swe solvers in particular dg swe solvers to be applicable in the context of large scale and high resolution flood simulation and water resources simulation in general miller et al 2013 many paths and their combinations towards this objective are being explored for such purpose in the broad swe modelling community i parallel and gpu computing dazzi et al 2018 lacasta et al 2014 liang and smith 2015 parna et al 2018 sætra et al 2015 sanders and schubert 2019 vacondio et al 2014 wintermeyer et al 2018 ii local dazzi et al 2018 hoang et al 2019 kesserwani and liang 2015 trahan and dawson 2012 and large morales hernández et al 2014 time stepping iii subgrid and porosity modelling bruwier et al 2017 ferrari et al 2019 li and hodges 2019 özgen et al 2015 iv adaptive mesh refinement amr either a topography driven fixed famr caviedes voullième et al 2012 hou et al 2018 vacondio et al 2017 or b flow driven dynamic damr arpaia and ricchiuto 2018 donat et al 2014 haleem et al 2015 lakhlifi et al 2018 liang and borthwick 2009 kesserwani and liang 2012a mandli and dawson 2014 sætra et al 2015 this work is concerned with 2d damr dg swe several amr schemes have been proposed and applied in the context of swe achieving speed up in the order of 20 donat et al 2014 liang and borthwick 2009 mandli and dawson 2014 tate et al 2006 very importantly the properties required from numerical schemes conservation well balancing etc should be preserved by the amr strategy a potentially non trivial task from which limitations regarding conservation and well balancing appear donat et al 2014 liang et al 2015 hou et al 2018 mandli and dawson 2014 further limitations have been identified regarding amr strategies requiring meshes which are bounded by proper grading alternatively proper nesting in swe literature of neighbors typically 2 1 berger et al 2011 kesserwani and liang 2012a liang and marche 2009 hou et al 2018 sætra et al 2015 vacondio et al 2017 ad hoc gradient threshold for coarsening and refinement kesserwani and liang 2012a inefficient block based refinement george 2010 and increased errors for high froude numbers liang and marche 2009 with the goal of avoiding and solving the aforementioned limitations in this work the swe are solved by a dg scheme enriched by multiwavelets mw to produce a multiresolution mwdg scheme which drives the damr strategy in recent years the concept of multiscale based mesh adaptivity quite successful with fv solvers for compressible fluid flow müller 2003 2009 and references therein as well as for other hyperbolic equations guo and cheng 2017 has been applied to the framework of dg schemes the mwdg concepts were first investigated analytically and numerically for one dimensional scalar conservation laws hovhannisyan et al 2014 the method was then extended to multidimensional scalar conservation laws gerhard and müller 2016 and to the euler equations gerhard et al 2015b in gerhard et al 2015a it was further developed and analysed for the solution of swe it was shown that the required properties of the base numerical solver can be transferred to the adaptive solver and proof of concept swe solution were presented the methodology has been further explored in terms of hydraulic and computational performance but restricted to the one dimensional setting caviedes voullième and kesserwani 2015 kesserwani et al 2015 showing good performance under steady states dam breaks and compared to both 1d analytical and experimental benchmarks in this paper we explore the application of the mwdg swe solver proposed in gerhard et al 2015a to complex 2d problems with significantly more complex and realistic topographies and hydrodynamics and therefore also computationally more ambitious this requires also to address implementation aspects such as an efficient initialization and a parallelization strategy to distribute the work load the aim is to explore the following research questions i does the mwdg scheme perform well for realistic and complex 2d swe test cases ii are there relevant limitations or open issues which complicate the solutions of such problems iii how can mwdg swe solvers enable further research of shallow flows the paper is organised as follows section 2 summarises the base dg swe scheme and its properties in section 3 this scheme is combined with a multiresolution analysis to dynamically trigger local grid refinement section 4 presents challenging numerical tests and their results and finally conclusions are summarised in section 5 2 discontinuous galerkin schemes for shallow water equations in this section we briefly summarize the main ideas of the runge kutta dg rkdg schemes applied to the shallow water equations including the modifications to achieve well balancing and positivity preserving for details the reader is refered to gerhard et al 2015a the shallow water equations can be written as 1 u t f u s x u on ω 0 t with a spatial domain ω r d d 1 2 and conserved quantities u h h v r m m d 1 fluxes f h v h v v 0 5 g h 2 i and source terms s 0 g h z σ let h m be water depth v m s velocity z m represent topography and g m s2 is the gravitational acceleration i is a 2 2 identity matrix the friction term σ is approximated using the glaucker manning model σ n σ 2 v 2 h 4 3 with roughness coefficient n σ s m 1 3 these equations are supplemented with initial data u 0 u 0 and appropriate boundary conditions we discretize the domain ω by a finite number of cells vλ denoting by g v λ λ i the computational mesh on this mesh we introduce the dg space of cell wise polynomials of total degree less than p 2 s f l 2 ω f v λ π p 1 v λ λ i in order to derive the variational formulation of the dg scheme we first rewrite 1 in a weak formulation by multiplying 1 by a test function w h s m and integrating over a cell vλ then we perform integration by parts and introduce numerical fluxes f approximating the flux f n in direction n this results in the semi discrete dg formulation find u h t s m t 0 t such that for all w h s m and λ i 3 v λ u h t w h d x v λ f u h w h s x u h w h d x v λ f w h d s 0 where a b a b r m denotes the standard inner product and for a b r m d we define the product a b i j aijbij the numerical flux f depends on the inner and outer value of u h at the boundary of vλ and on the outward pointing unit normal vector a number of formulations exist and have been used for the numerical flux in swe caviedes voullième and kesserwani 2015 murillo and garcía navarro 2012 tassi et al 2007 two formulations are implemented and are used in this work a local lax friedrichs numerical flux following gerhard et al 2015a and as is common in the dg context and roe linearisation roe 1997 as is it frequently used in fv swe schemes martins et al 2017 murillo and navas montilla 2016 the weak formulation of the dg scheme leads to a system of ordinary differential equations which is integrated in time with an explicit runge kutta rk scheme in order to guarantee the stability of the fully discrete scheme limiting of the high order coefficients is warranted after each rk stage of the runge kutta scheme in order to prevent spurious oscillations gibbs phenomenon a number of methods are available for this e g cockburn and shu 1998 li and zhang 2017 without any clear best approach especially in the swe context since the limiter also interacts with well balancing and positivity an and yu 2014 caviedes voullième and kesserwani 2015 vater et al 2019 the commonly used tvb limiter by cockburn and shu 1998 applied on the local characteristic variables is selected here several strategies bollermann et al 2013 kesserwani and liang 2012b qian et al 2018 vater et al 2015 xing et al 2010 have been proposed to ensure well balancing wb and positivity preservation pp here we follow the flux modification strategy proposed by xing et al 2010 as it is generic and widely used this strategy allows to natively project the bottom topography z to the same dg space as the solution u h contrary to alternative approaches which require an edge continuous projection of z or are restricted to linear dg2 approximations kesserwani and liang 2012b kesserwani et al 2018 vater et al 2015 this native property of the wb pp strategy of xing et al 2010 is convenient in the adaptive context since continuity of the projected topography is not ensured by neither the dg projection nor the adaptive scheme nonetheless it is relevant to point out that the xing et al 2010 strategy is not without flaws caviedes voullième and kesserwani 2015 kesserwani et al 2018 regarding momentum conservation at wet dry fronts on steep bed slopes an issue related to the various treatments of steep bed slopes in the dg swe context caleffi et al 2016 ern et al 2008 in this work we do not attempt to solve any of the flaws of xing et al 2010 strategy as it is not the focus of this paper finally in order to achieve the well balancing property the local characteristic variables are based on h z h v instead of h h v for the purposes of limiting for details we refer to gerhard et al 2015a 3 multiwavelet based grid adaptation the dg discretization operates on an array of coefficients which effectively describe the polynomial representation of the solution the underlying idea of the mwdg adaptive strategy is to perform a multiresolution analysis of the polynomial coefficients on a hierarchy of nested grids that determine a nested sequence of dg spaces this provides local information on the difference in the solutions supported at successive refinement levels such differences may become negligibly small in regions where the solution is locally smooth under such conditions applying hard thresholding allows to compress the data and the dg spaces respectively thereby triggering local mesh adaptativity a brief summary of the multiwavelet based grid adaptation is presented here for a detailed description the reader is referred to hovhannisyan et al 2014 and gerhard et al 2015a b multiresolution analysis the starting point for a multiresolution analysis is a hierarchy of nested grids g ℓ v λ λ i ℓ for increasing number of refinement levels ℓ the index set m λ i ℓ 1 denotes the refinement set of cell vλ and for μ i ℓ let λ μ i ℓ 1 denote the parent cell on level ℓ 1 thus it holds that v λ μ m λ v μ on each level ℓ of this hierarchy we define the dg space s ℓ analogously to 2 obviously these spaces inherit the nestedness from the underlying grid hierarchy and form a multiresolution sequence 4 s 0 s 1 s ℓ s ℓ 1 l 2 ω the nestedness of the discretization spaces implies that there exist orthogonal complement spaces w ℓ such that s ℓ 1 s ℓ w ℓ for a fixed level l applying this two scale relation yields 5 s l s 0 w 0 w l 1 to perform the multi scale decomposition of the single scale space sl in 5 we introduce a basis ϕ i i i ℓ s for the single scale spaces s ℓ and a basis ψ i i i ℓ w for the complement spaces w ℓ for the sake of efficiency we assume that the support of these basis functions is a single cell if follows that the index i of ϕ i and ψ i can be decomposed in a spatial and a polynomial part i λ i i e i ℓ s i ℓ p and i ℓ w i ℓ p where p and p characterize the local degrees of freedom of s ℓ and w ℓ respectively in order to exploit the potential of data compression we make use of the multi scale transformation 5 and determine a local two scale representation of u s ℓ m 6 u v λ μ m λ i p u μ i ϕ μ i i p u λ i ϕ λ i i p d λ i ψ λ i λ i ℓ 1 fig 1 illustrates the local two scale representation 6 applying this local two scale decomposition recursively we obtain the multi scale representation of w sl m 7 w i i l s u i ϕ i i i 0 s u i ϕ i ℓ 0 l 1 i i ℓ w d i ψ i where d i are defined as the detail coefficients and u i the single scale cofficients furthermore the arrays with the local degrees of freedom in a cell vλ are denoted as u λ w u λ i i p and d λ w d λ i i p a detailed description of the construction of the basis functions and the efficient implementation of the transformations is provided by gerhard et al 2015b in particular in 1d the legendre polynomials are chosen for single scale basis functions ϕ i on each cell vλ the correspomding multi scale basis functions ψ i so called multiwavelets are determined similar to alpert s construction alpert et al 2002 these bases are extended to higher spatial dimensions by tensor products the advantage of the multi scale representation 7 is that the detail coefficients provide information on the difference between two successive refinement levels in regions where the underlying function is smooth enough the detail coefficients may become negligibly small and therefore their contribution is small this information is then used to determine an adaptive grid by sparsening the multi scale representation 7 thresholding and grid adaptation thresholding i e filtering out irrelevant details requires the definition of level dependent threshold values εℓ 0 a detail coefficient d i on level l i is significant if it is larger than a level dependent threshold value εℓ i allowing to define the index set of significant detail coefficients by 8 d ε w i ℓ 0 l 1 i ℓ w max 1 k m c ψ i k d i k ε ℓ i where the constant c ψ i k depends on the normalization of the multiwavelet function ψ i and the magnitude of the kth conserved quantity gerhard et al 2015a thereby we can find a sparser representation for w w ε i i 0 s u i ϕ i ℓ 0 l 1 i d ε w d i ψ i if d ε w is a tree then w ε is a projection of w to a coarser grid g ε w gerhard et al 2015a this grid can be determined efficiently by d ε w proceeding from coarse to fine a cell is refined whenever a significant detail coefficient exists in fig 2 this is illustrated for l 2 gerhard and müller 2016 prediction by hard thresholding we are able to coarsen the mesh we emphasize that the above multiresolution analysis operates on data corresponding to arbitrary but fixed time thus the adaptive grid determined by hard thresholding can only appropriately identify features in the solution on this time level however the data evolve in time due to the evolution eq 1 to ensure that during the evolution process all solution features are adequately resolved for both the old and the new time level i e significant details at the new time level are not missed we need to perform the multiresolution analysis for both time levels for this purpose the data at the new time level must be known but they are not yet available to avoid a costly iteration process on the evolution step harten 1995 suggested to determine a prediction set d ℓ n 1 d ℓ w n d ℓ w n 1 accounting for the hyperbolic character of the underlying partial differential eq 1 we follow harten s heuristic idea which mainly consists of two steps gerhard et al 2015b 2015a i since information may be transported details in a local neighborhood may get significant ii due to formation of shocks additional details on higher levels might get significant fig 3 illustrates the refinement strategy via prediction on the detail coefficients for a one dimensional example in the following algorithm we summarize one timestep of the adaptive scheme algorithm 1 timestep of adaptive scheme 1 refine the grid via prediction on detail coefficients on h z h v t 2 compute the evolution with the dg scheme on h h v t 3 coarsen the grid via thresholding on h z h v t bottom topography to start the computation we need to generate the intial adaptive grid by means of the initial data u 0 and the bottom topography b typically the bottom topography is given as a data set of discrete points x i zi or as a function z x from the given information we need to determine a projection zh s init sl in case of a given function we can use cell wise a standard l 2 projection in case of a discrete data set we have to solve a least squares problem resulting from an overdetermined interpolation problem on each cell to find the projection zh since the dg space s ℓ is defined locally and the well balancing strategy does not require continuity we can perform this projection locally as well in the following we consider the projection to π p 1 on a single cell vλ let bλ denote the index set of all tuples x i zi which are located in vλ or on vλ the projection zh on vλ is defined by the following linear least squares problem 9 z i z h x i i b λ 2 min well balancing and positivity preserving recall that the single scale rkdg scheme is well balanced and positivity preserving by the strategy from xing et al 2010 these properties are carried into the mwdg scheme as shown by gerhard et al 2015a by ensuring a few conditions the bed topography z is projected onto the same dg space as the solution u h since in the adaptive scheme the mesh g n is dynamically changing and thus the discretization space sn is changing as well therefore it is necessary to ensure that zh is in sn at each discrete time tn which will carry the wb and the pp property of the base rkdg scheme gerhard et al 2015a in practice and for the sake of efficiency a locally refined mesh is derived with the initial projection of z into the dg space during the adaptive process it is ensured that such a mesh or alternatively its corresponding significant details is always included in the dynamic computational mesh adapted for the solution therefore the efficiency of the adaptive scheme depends on the choice of the adaptive mesh for the bed topography nonetheless the strategy and criteria to generate this topography based adaptive mesh is identical to those used to adapt the mesh to the transient flow fields we simply do not recalculate it at every time step caviedes voullième and kesserwani 2015 gerhard et al 2015a finally to avoid stability problems at wet dry interfaces we ensure that cells at these interfaces are refined up to the highest discretization level choice of threshold value when performing hard thresholding we introduce an error in order to control this error i e to ensure that this error is bounded by a given threshold value ε 0 it is sufficient to choose ε ℓ 2 ℓ l ε as is proven in gerhard 2017 the efficiency and the accuracy of the adaptive mwdg essentially relies on the choice of the threshold value ε note that the adaptive grid becomes coarser with larger threshold values and thus the adaptive schemes becomes faster but less accurate vice versa smaller threshold values provide higher accuracy but at the expense of higher computational cost therefore an ideal strategy aims to balance the discretization error i e difference between the exact solution and the base scheme and the perturbation error i e the difference of the base scheme and the adaptive scheme in hovhannisyan et al 2014 a rigorous analysis of the perturbation error for nonlinear scalar conservation laws in 1d suggests to choose the threshold value in the order of the discretization error of the base scheme i e ε c t h r h l β with β p for smooth solutions and β 1 for discontinuous solutions in practice this choice is typically too pessimistic because it accounts for the worst case that all non significant details are of size εℓ therefore in gerhard et al 2015b a heuristic strategy is investigated 10 ε c t h r h l β numerous computations presented in gerhard et al 2015b gerhard and müller 2016 and gerhard 2017 verified that the error of the adaptive scheme is asymptotically the same as the error for the base scheme and the adaptive scheme is more efficient i e a target accuracy is reached at significantly reduced computational cost the constant cthr is typically chosen as 1 except when the problem at hand exhibits a wide range of scales where cthr should be chosen as the ratio of the smallest and largest scale for our computations we apply the heuristic threshold strategy to conclude this discussion we would like to emphasize that with regard to efficiency and accuracy the threshold value ε is not a user specified parameter as is suggested for instance in kesserwani et al 2019 limiting for stability reasons we perform limiting after each stage of the runge kutta scheme since by limiting the order of accuracy is decreasing locally this should become effective only at discontinuities numerous strategies have been developed see for instance krivodonova et al 2004 vuik and ryan 2016 aiming to detect such cells we would like to point out that the multiresolution analysis provides a reliable detector if the number of refinement level is sufficiently large i e discontinuities inherently trigger refinement to the highest level thus we apply the limiter only in cells on the highest refinement level 4 numerical results in this section we present numerical results for three well known and widely used test cases for which measured data for validation is available i experimental tsunami run up onto a beach ii experimental dam break flow over an idealized city and iii field scale malpasset dam break the general simulation parameters unless stated otherwise are the following computations have been performed using a third order dg3 scheme i e p 3 with piecewise quadratic polynomials for time discretization an explicit third order ssp rk method with three stages and c cfl 0 1 is used we consider a shu constant of m 50 for the limiter in order to avoid limiting in smooth regions of the solution this is in practice not particularly relevant since the limiter is only applied at the highest resolution level which only exists on non smooth areas numerical fluxes are approximated using the local lax friedrichs flux llf the computations have been performed in parallel using space filling curves for the load balancing and the redistribution of the workload in the adaptive scheme for details we refer to gerhard 2017 and brix et al 2009 we highlight that although we perform a benchmark analysis the goal of it is not only to show the validity of the proposed adaptive numerical solver in fact the approach has been previously verified with exact solutions in 1d caviedes voullième and kesserwani 2015 kesserwani et al 2015 and 2d gerhard et al 2015a the focus here is show and discuss how mra and the mwdg swe harvest the multicale nature of the problem into an efficient adaptive mesh we also study the properties and suitability of the adaptation to the flow conditions 4 1 tsunami run up onto a beach in 1993 an off shore earthquake in the sea of japan caused a tsunami wave the tsunami wave reached okushiri island in the hokkaidō prefecture and caused serious damage near the village of monai the small offshore island muen caused an unexpected high run up of 31 7 m in a coastal valley behind the island whereas the run up heights on the beaches directly exposed to the tsunami wave were only around 25 m in order to investigate this phenomenon the central research institute for electric power industry criepi in abiko japan performed 1 400 scale experiments of the run up in this area using a tank of 205 m length and 3 4 m width matsuyama and tanaka 2001 the coastal region of the experimental setup is shown in fig 6 a experimental measurements are available third international workshop on long wave runup models 2004 for the position of the highest run up and the temporal evolution of the water surface h z at three control points between muen island and the shore the computational domain locations of these control points and the bathymetry z x y are depicted in fig 4 this experimental setup is of interest for model testing and validation and has been widely used arpaia and ricchiuto 2018 hou et al 2015 2018 kesserwani and liang 2012a morales hernández et al 2014 murillo et al 2009 murillo and garcía navarro 2012 vater et al 2019 we select this test case to assess the overall performance of the adaptive scheme under a smooth yet complex natural topography forced by transient boundary conditions and to assess the performance of the wet dry strategy under damr for the computation we focus on the scale experiment instead of the real tsunami event focusing only on the coastal area since the inflow wave was recorded near the cost thus the simulation of the very long channel can be avoided and the computational domain covers only a domain ω 0 5 488 0 3 402 m the incoming tsunami wave at the sea boundary at x 0 m is an h z t function third international workshop on long wave runup models 2004 and is shown in fig 5 from the surface wave we compute momentum h v at x 0 by using riemann invariants such that h h v corresponds to a simple incoming wave gonzàlez et al 2011 the water surface and momentum are prescribed at the inflow boundary x 0 m as characteristic boundary conditions coinciding with the experiment we consider reflecting wall boundary conditions at all other boundaries the domain is initialised with quiescent initial conditions i e h z 0 m and v 0 m s 1 as shown in fig 6 in a 3d view and a profile at y 2 m of the bathymetry z and the initial water surface h z the multiresolution problem setup consists of 8 5 40 cells at the coarsest grid resolution level 0 simulations were run with l 5 and l 6 levels of refinement which would result in 256 160 n l 5 40 960 and 512 320 n l 6 163 840 cells respectively the bathymetry is given by a discrete set of 97 857 points from which we determine via interpolation and thresholding an adaptive representation of the bathymetry in terms of piecewise quadratic polynomials the dry tolerance in the wetting and drying strategy was set to 10 4 m e g vater et al 2019 manning s coefficient was set to 0 01 sm 1 3 kesserwani and liang 2012a morales hernández et al 2014 murillo et al 2009 the threshold parameter was chosen using the heuristic strategy as ε l c thr h l here the amplitude of the inflow wave is in the order of 10 2 m whereas the quantity h z is in the order of 1 m fig 5 thus the wave is 100 times smaller than the order of magnitude of h z consequently in order to resolve the wave structures caused by the tsunami we have chosen the factor c thr as 1 100 the boundary condition forces an incoming wave moving towards the shoreline thereby the water is first retracting from the shoreline before the following tsunami wave is eventually flooding the dried up regions and the coastal area afterwards the reflecting wave at the shoreline causes wave structures moving away from the coast fig 7 compares simulated only l 6 for clarity water surface h z to experimental results at the three gauge points shown in fig 4 between muen island and the shore good overall agreement can be seen both in terms of the water surface elevation h z and the wave dynamics and timing the results are similar in quality to previously reported simulations computed with other numerical schemes gonzàlez et al 2011 hou et al 2015 morales hernández et al 2014 murillo et al 2009 murillo and garcía navarro 2012 vater et al 2019 including adaptive ones arpaia and ricchiuto 2018 hou et al 2018 kesserwani and liang 2012a the largest differences between experimental and simulated water surface occur systematically for t 10 s in which the simulations show unperturbated water at rest this is the case in all aforementioned results reported in the literature this difference is attributed to experimental issues the start of the receeding water t 10 s is well captured as is the arrival of the tsunami wave at all three locations minor differences area are observed in the comparisons related to experimental error and limitations of the swe model table 1 shows a comparison of the maximum run up of the tsunami wave in terms of its height position x y and time of occurence results from l 6 adaptive simulations are compared to experimental observations matsuyama and tanaka 2001 and numerical results of the geoclaw solver gonzàlez et al 2011 are listed for comparison next we focus on the maximum run up of the tsunami wave to this end we have determined the maximum height its position and time of occurrence in our adaptive computations when comparing our results with the experimental data and the results using geoclaw we conclude that our adaptive solver can identify the maximum run up height and its position of occurrence very accurately moreover we note that the l 6 computation is more accurate than the one with l 5 the time of occurrence of the maximum run up in our computation is similar to the one from the geoclaw solver gonzàlez et al 2011 the instant of the highest run up is shown in fig 10 a summarizing we infer from the validation results obtained with the mwdg3 scheme are as accurate as the results available in the literature it has been pointed out arpaia and ricchiuto 2018 that the gauge results in this test case are not very sensitive to mesh resolution in fact accurate solutions have been reported with very coarse meshes murillo et al 2009 for different numerical solutions from different numerical and adaptive schemes to be formally comparable it would be necessary to compare formal accuracy resolution and degrees of freedom however for experimental problems such as the ones presented here accuracy metrices are often fuzzy and many previous papers do not report formally accuracy nonetheless is is well accepted that higher resolution will result in higher accuracy it follows that adaptive solutions achieving higher resolution will be in principle more accurate if it also does so with less cells we consider the scheme to be more spatially efficient i e in terms of the mesh it must be highlighted though that because of cfl restrictions across different formulations computational time may behave differently we highlight that the interest here is weighted towards assessing the adaptive performance of the scheme given that the solution is accurate to do so consider fig 8 showing the evolution of the adaptive mesh and table 2 showing a comparison of the computational effort in terms of computational cells to solutions reported in the literature since several of the solutions analysed are adaptive we define mesh efficiency η 1 n a n l where na is the maximum number of adaptive cells and nl is the number of cells at the uniform fully refined highest resolution for the sake of fair comparisons we additionally define an efficiency relative to our l 6 solution so that η n a n l 6 and a resolution normalised relative efficiency η η δ x δ x l 6 where δx is the finest adaptive or not resolution of a particular mesh note that for non adaptive cases n a n l the rationale behind using these type of metrics instead of the more typical computational time is as follows on the same uniform and fixed grid fv solvers will most likely be faster than dg schemes the main reason for this is that the cfl restriction is increasingly more stringent as polynomial order increases for the dg scheme even if the cost of a time step were the same the cost of a single time step is however also larger for the dg scheme as more than one runge kutta stage is required and a larger number of riemann problems and numerical fluxes must be computed comparing first order fv schemes to dg on such uniform meshes will result in lower computational time for fv schemes but at a lower accuracy for higher order a fv scheme of the same accuracy as a dg scheme it is also likely that the fv scheme will have a lower cost cfl fewer riemann problems less numerical flux computations however in the context of parallel computing fv schemes of the same accuracy higher than first order will be inefficient as their stencil extends beyond the immediately local neighbors whereas dg schemes are strictly local on the immediate neighboring cells independt of the polynomial order this difference increases as computational implementation moves from shared to distributed memory systems as the cost of data transfer and non local data transfer grows quickly possibly even overshadowing the cost of arithmetics finally these arguments point out the need of adaptive grids to achieve dg solutions at lower cost which is why the concept of mesh efficiency becomes relevant table 2 shows two groups adaptive solutions followed by non adaptive ones in chronological order firstly it is relevant to highlight that for l 6 the adaptive mesh peaks at 18 139 cells resulting in a very efficient mesh with η 0 89 all but three of the solutions reported in table 2 have a maximum resolution that is coarser than the l 6 solution and for those three η 1 showing that they are comparably more expensive in terms of cell numbers than the l 6 solution of those with coarser cells all but one the very coarse solution by murillo et al 2009 have an η larger than 0 11 the value obtained for l 6 this means that all but one simulation reported in the literature can be considered more expensive in terms of number of cells this clearly shows how the mwdg swe strategy produces a damr in which the number of computational cells is significantly reduced without compromising the accuracy of the highest resolution the comparison to adaptive solutions is somewhat more complex in terms of our approach the method by kesserwani and liang 2012a is closest and easiest to compare as the table shows they obtained η 0 56 meaning that such an adaptive strategy is considerably less efficient than the mwdg2 η 0 89 furthermore normalised by resolution kesserwani and liang 2012a achieve η 0 33 i e approximately three times more expensive than our l 6 for the same resolution figs 9 and 10 show the numerical solutions and the corresponding adaptive grids using l 6 l 5 is not shown for brevity the damr can be observed as the mesh refinement tracks the arising waves whereas in regions with small variations the grid remains coarse the initial refinement shows already the reasons for high efficiency wet dry fronts are refined to the highest resolution as is the step like bed feature at x 2 m but a large portion of the domain remains on levels 2 and 3 with roughly 15 of the domain still at the coarsest level at t 13 5 s the receeding water produces dry areas at x 4 triggering adaptivity note how the rest of the domain remains with a very similar mesh as the initial one as the tsunami wave propagates past the island t 14 3 s it triggers refinement to the highest level and as it reaches the coast line t 15 s the mesh coarsens behind the tsunami wave as the dry areas disappear note how the mesh for x 3 m remains fundamentally unchanged from the initial one from this time onwards the amr tracks the reflections of the tsunami wave t 16 5 s and flooding the island t 19 5 s which because of its steep slopes remains highly refined finally as the reflection moves past the island back into the sea mesh refinement is triggered for x 2 m while the regions between the island and the coast are again coarsened fig 8 shows that the computational meshes for both l 5 and l 6 remain rather undisturbed from the topography based initial refinement during the first 10 s a time at which the tsunami wave is already incoming fig 5 after this time the mesh starts to be refined and by comparing fig 9 a and b it can be seen that the increase of cells is caused by drying between the coast and the island then onwards there is an overall growing trend during the simulation with instantaneous refinement peaks at t 14 s and t 18 s corresponding to the arrival of the tsunami wave at the coast fig 9 c and the expanding reflection back into the ocean fig 10 b the fact that these are instantaneous maxima shows how the damr maintained a very localised refinement tracking the incoming waves and the initial reflections the global maxima is obtained at t 21 5 s when the complex reflections moving back into the sea flood the domain as seen in fig 10 c qualitative comparisons can be made with other adaptive solutions of this problem the initial mesh reported by kesserwani and liang 2012a requires much finer cells than the mesh reported here and their final mesh t 25 s is strongly refined in regions were the amr of fig 10 c shows less refinement 3 x 4 5 an issue which is also observed in the famr mesh reported by hou et al 2018 the coastline is refined to the highest resolution in both hou et al 2018 and kesserwani and liang 2012a but also a very wide area around it clearly the number of allowed refinement levels is an advantage of the mwdg strategy enabling a more aggressive transition from coarse to fine 4 2 dam break flow through an idealised city an experimental dam break flow through an idealised city in a 2d laboratory flume with a horizontal bed was reported by soares frazão and zech 2008 this is a well known benchmark problem widely used for model validation and testing ginting 2019 hartanto et al 2011 jeong et al 2012 özgen et al 2015 petaccia et al 2010 soares frazão and zech 2008 wang et al 2017 the setup is shown in fig 11 a gate located 7 15 m from the left boundary allows to fill a tank upon a sudden gate opening a dam break phenomenon is simulated 25 obstacles of 0 3 0 3 m represent buildings in the experimental model that are always above the water surface during the experiment the streets between them have a width of 0 1 m soares frazão and zech 2008 performed simulations of this case using a first order finite volume scheme with a uniform mesh where the obstacles were represented as holes in the domain therefore their walls where boundaries in contrast the obstacles are here included in the mesh to purposely include a discontinuous bed topography the hydrodynamics of the test case is complex and exhibits flow structures on different scales soares frazão and zech 2008 a large dam break shock wave moves downstream a hydraulic jump then develops with a length similar to that of the urban structure small scale flow structures also develop within the urban structure this significant difference in scales makes this configuration ideal for testing and analysing the performance of the multiresolution damr strategy the computational setup is as follows the coarsest level level 0 consists of 90 9 810 cells two maximum number of refinement levels were selected 6 and 7 which would generate 5 760 576 3 317 760 cells for l 6 and 11 520 1 152 13 271 040 cells for l 7 respectively this corresponds to 19 906 560 79 626 240 degrees of freedom for such meshes with a dg3 scheme 6 degrees of freedom per cell the simulation was run until t 10 s manning s roughness coefficient was set as 0 01 s m 1 3 soares frazão and zech 2008 the initial conditions are an initially wet channel with h 0 011 m and a reservoir water depth of h 0 40 m upstream from the gate as in the experiment boundary conditions were all closed except for the downstream boundary which was set as transmissive the dry tolerance was set as 10 4 m the threshold parameters were chosen for both l 6 and l 7 simulations as c t h r 0 2 and β 1 computations were performed in parallel on an intel xeon cluster with an infiniband network using 320 work units in the experiment the water surface was measured at 64 control points inside the urban area as shown in fig 12 in order to validate the results the water surface along the control points at y 1 2 1 6 2 2 4 are compared in figs 13 16 for selected times and both mesh setups similar to soares frazão and zech 2008 there is an overall very good agreement between experimental and simulated results to the same extent as previously reported numerical solutions moreover the two simulations l 6 and l 7 produce very similar results the largest differences between simulations and experiments occur roughly at x 12 m where the simulations tend to underestimate the height of the hydraulic jump the results suggest that resolution plays no role in this underestimation it is likely that the underestimation comes from the fundamental incapacity of the swe to capture the vertical velocities generated by the impact of the wave analogous to other fast moving highly inertia flows agains obstacles compared by martínez aranda et al 2018 in contrast to previously reported simulations ginting 2019 soares frazão et al 2008 wang et al 2017 the high resolution and high order solution in the streets results in more jagged profiles perhaps resolving flow structures smaller than the widths of the streets which are otherwise not captured in lower resolution and lower order models another benchmark is shown in fig 17 which compares experimental and simulated water surface evolution at four gauge points along y 2 overall there is a good agreement the upstream point a shows the dam break wave passing through followed by its wake and at t 5 s registers the hydraulic jump note that the simulated results show a much more instantaneous jump the high backwater effect is well captured at point b just upstream of the urban area shows good agreement except around t 5 s in which both numerical solutions show a depression not observed in the experimental data this is likely to be related to reduced dissipation in the simulation we discuss this topic below together with the analysis of the hydrodynamic fields the simulated results at points c and d are noisy but represent rather well the experimental signal figs 18 26 show the evolution of the water depth field and the computational mesh for both mesh setups additionally fig 25 shows velocity and froude number for t 7 s and l 7 only in general it is clear how the adaptive mesh tracks the transient wave structures whereas in regions with small variations the mesh is coarse at t 1 s the initial dam break wave progresses forward with a characteristic shock wave shape the wave front is very sharply captured by the highest level of mesh resolution it is remarkable that the resolution required to capture the wave front transitions is within the width of a single level 0 cell all the way to the coarsest resolution a secondary structure just upstream of the shock can also be observed to be highly resolved two depressions are observed detaching from the reservoir walls also warranting for high resolution fig 18 also allows to appreciate the initial bed projection and the mesh adapted to it note how the horizontal channel is meshed by the coarsest level cells level 0 except near the side edges where both a side slope is present and a wet dry front exists because of the latter the mesh is refined to the highest level at such locations it is also noteworthy that the mesh transitions over one edge from level 0 to 4 for l 6 i e 8 cells from level 4 share an edge with a single level 0 cell 8 1 ratio this is significantly different and more efficient in comparison to other amr strategies berger et al 2011 kesserwani and liang 2012a liang and marche 2009 hou et al 2018 sætra et al 2015 vacondio et al 2017 which require proper grading of neighbors that is a 2 1 ratio furthermore the l 7 case allows for an even sharper transition across resolutions to describe this initial wet dry front the cores of the buildings are represented by coarse level 2 cells whereas the outer ring of the buildings and the streets require level 3 cells this is only necessary to capture the discontinuous topography described by the building note that the vertical walls of the buildings i e physical discontinuities in the z x y function are aligned with cell edges this means that the walls are exactly captured by the discontinuous representation of the bed across two cells the mesh has been designed in this way to avoid the vertical walls laying in the middle of a level 2 cell if that were the case the projection of the bed onto the dg space would result in a very steep slope this in itself is not problematic however two issues arise first this would trigger adaptivity to very high resolution arguably reducing mesh efficiency second and most importantly the inherent flaws in the reference dg swe scheme related to the wb pp strategy xing et al 2010 can generate spurious momentum waves in the presence of wet dry fronts on such steep slopes thereon these waves because of the lack of numerical viscosity of the dg3 scheme are not dampened and travel through the domain further triggering adaptivity this flaw of the reference scheme is therefore avoided by ensuring that the discontinuities do not generate steep slopes but instead are exactly captured by the discretisation this pragmatically eliminates the problem for the objectives of this paper but we do not pursue to solve the inherent flaws in the wb pp strategy of xing et al 2010 at t 2 s the shock wave has reached the side slopes of the channel remaining very sharp and with no diffusion appreciated moving wet dry fronts develop at the side slopes which are clearly observed in the highest mesh resolution observe how the kink in the bed where the side slope meets the flat flume bed requires level 5 cells although the wet dry front is now elsewhere interesting wake like structures are seen trailing the shock wave reflection from the side slopes for these structures the l 7 shows an even sharper resolution in the gate channel supercritical wave reflections are very well captured at t 3 s the dam break wave has reached the city a violent hydraulic jump develops upstream of the first set of buildings with a width of roughly half a building the structure of the depth field outside of the urban area is a clear progression from that one at t 2 s with highly resolved tracking of shocks wet dry fronts and reflections the mesh refinement patterns for both l values differ somewhat more than at previous times when the water flows into the streets refinement is triggered within them up to the highest level recall that for l 6 up to 16 cells can be included in the street and up to 32 for l 7 this adapted mesh allows to resolve very local flow structures such as secondary hydraulic jumps in the second line of buildings and diagonal supercritical reflections at t 4 s and afterwards the mwdg scheme shows its full capabilities in resolving very complex flow structures complex interactions inside the streets can be observed wakes and wave stem out of the vertices of buildings back into the surrounding flow two vortex like depressions develop within the hydraulic jump structure the l 7 shows considerably sharper structures at this stage interestingly in the l 6 case an asymmetric dry spot appears at x 8 triggering mesh refinement this is not the case for l 7 at t 5 s the wave has surpassed the urban area downstream of the buildings stagnant wakes and supercritical jets can be seen to develop the depressions at x 12 m are clearly seen and the supercritical reflections and very complex wave structure inside the streets is fully developed in terms of the adaptive mesh observe how the dry areas of the domain buildings and the reservoir blocks remain at their original resolution as well as the unperturbed regions at x 16 m with level 0 cells the region upstream from the hydraulic jump remains at level 1 l 6 or 2 l 7 by t 6 s the entire domain is affected by the dam break at t 7 s the l 6 adaptive mesh shows how the regions upstream from the hydraulic jump are again discretised by level 0 cells and the development of the hydraulic jump in the wake of the urban area for this time velocity and froude number is shown in fig 25 it is interesting to observe how the mesh tracks all transcritical shocks as well as supercritical reflections this is a natural consequence of including information of all conserved variables in the multiresolution analysis that is although the amr strategy does not receive froude number as information its behaviour is natively captured by the strategy suggesting that the underlying hydrodynamics are well treated by both the multiresolution analysis and the amr prodecure the velocity field shows complex recirculations and flow patterns inside the urban area and rotating vortices outside of it e g x 10 s the wake downstream of the urban area is clearly captured by the low x component of velocity as well as by the subcritical froude number finally t 10 s shows a chain of some rather interesting finely resolved depressions vortices of kelvin helmholz instabilities lingering in the backwater but this can be extended as an interesting behaviour overall in the hydrodynamic fields the fields throughout the simulation exhibit highly resolved very small flow structures and some particular fluid phenomena such as rotating vortices vortex shedding and kelvin helmholz instabilities these structures are only possible to resolve with the combination of spatial resolution with cells significantly smaller than the structure and a high order solver which ensures very low numerical viscosity and numerical dissipation note for example how some of the smallest vortices are not clear in the l 6 solution but are sharp in l 7 e g at t 6 s 8 x 12 m many of these structures are not observable and most likely not present in the physical experiment for example as previously highlighted in fig 17 b the simulations show a depression at t 5 s which is not present in the experimental data this gauge point b is just upstream of the buildings where travelling vortices pass near these simulated structures are responsible for the lower water depth in the experimental results it is likely that three dimensional turbulence which is obviously not solved for here associated to the hydraulic jump introduces additional dissipation and thus washes out these flow structures this is not an issue in lower resolution or lower order solvers since the numerical viscosity performs that role moreover this suggests that the mwdg3 swe scheme is capable of resolving turbulence scales which manifest as 2d turbulent structures but would require to include additional dissipation to account for the smaller unresolved turbulence effects similar phenomena and reasoning have been reported with other high order schemes on shallow flows navas montilla and murillo 2018 navas montilla et al 2019 the need for a turbulence model for this particular test case has been raised soares frazão and zech 2008 özgen et al 2015 although our results show that numerical viscosity of coarse low order solution may already mimic turbulent dissipation with increasing resolution numerical dissipation would be smaller and even more with increasing order of accuracy as in our case to assess the performance efficiency of the adaptive strategy fig 27 summarises the damr process throughout the simulations for both l 6 and l 7 cases fig 27 a shows clearly how the evolution of the number of computational cells for l 7 requires up to three times more cells than for l 6 the difference is initially smaller roughly twice as many cells but increases quickly during 2 t 5 s the l 6 case does not exhibit a large growth of cell numbers these cell counts represent a maximum of 7 l 6 and almost 5 l 7 of the cells contained in the highest resolution meshes as shown in fig 27 b it is interesting to observe that although the ratio of number of cells between both cases increases from 2 to 3 the percentages have a parallel behaviour suggesting that both cases are equally efficient in their use of fine resolution but that the choice of number of levels will affect the total number of cells and therefore computational time previously published solutions have been computed with anywhere between 14 000 to 193 774 cells typically with unstructured triangular meshes often with refinement around the urban area such meshes have cells of lengths roughly between 0 05 m and 0 005 m in comparison the smallest cells in our simulations are of length 0 00625 m for l 6 and 0 003125 m for l 7 that is on the fine side of previous solutions the maximum number of cells obtained in these simulations is larger than those of previous solutions but with significantly better tracking of shocks and flow structures especially outside of the urban which has often been not refined in fixed meshes 4 3 malpasset dam break the malpasset dam was located in south east france on the reyran river valley on december 2 1959 the 66 5 m high concrete arch failed allowing the sudden and violent outflow of the nearly full reservoir down the gorge and into the fréjus gulf the dam break wave traveled from the dam location to the mediterranean sea killing more than 430 people hervouet and petitjean 1999 this event is one of the few catastrophic concrete dam failures recorded in history it is of particular interest to hydraulic modelers since some field survey data is available useful to validate numerical results the fréjus police surveyed high water levels at 17 locations p1 p17 as shown in fig 28 together with the topography of the valley and the location of the dam black line additionally 3 electric transformers a b c were destroyed by the travelling wave an experimental 1 400 scale model was built and tested afterwards at the french laboratoire national d hydraulique in 1964 providing additional water elevation data at 14 locations of which we only include the nine probes s1 s9 downstream of the dam note that these probes are named s6 s14 in hervouet and petitjean 1999 this problem has been widely studied as a field scale benchmark test in hydraulic modelling literature solutions have been presented with a broad range of methods and it remains a popular test case for benchmarking an et al 2015 brodtkorb et al 2012 brufau et al 2004 duran et al 2013 george 2010 hervouet and petitjean 1999 hou et al 2013 kesserwani and liang 2012a kim et al 2014 liang et al 2007 sætra et al 2015 schwanenberg and harms 2004 smith and liang 2013 valiani et al 2002 xia et al 2011 wang et al 2011 zhou et al 2013 zhao et al 2019 some of these works have presented adaptive mesh solutions an et al 2015 george 2010 kesserwani and liang 2012a sætra et al 2015 numerical results have in general matched reasonably well the available field data this test is arguably not the most stringent challenge on current solvers it is less demanding on the numerical scheme than the previous test and there are arguably less scales involved than in the previous case it is nonetheless relevant since it is real scale field case with natural topography and a strongly hyperbolic flow the initial water level in the reservoir has been estimated at 100 m 0 5 m hervouet and petitjean 1999 and thus has been set to 100 m in the computations presented herein the gauckler manning coefficient was originally recommended in the range of 0 025 0 033 s m 1 3 hervouet and petitjean 1999 although 0 033 s m 1 3 has been argued to provide best results schwanenberg and harms 2004 and is ubiquitously used an et al 2015 brufau et al 2004 kesserwani and liang 2012a schwanenberg and harms 2004 valiani et al 2002 wang et al 2011 water elevation at the mediterranean sea is assumed to be zero boundary conditions are reflective since the open sea boundary has no effect on the dam break wave propagation the base data for topography is a set of 13541 points these points were bi linearly re sampled to a constant resolution of 5 m which represent just over two million points in the computational domain this 5 5 interpolation was then used as the surface topography which is then projected into the dg space this case was solved with a dg2 p 2 scheme with piecewise linear solutions the computational domain is within a rectangle discretised with a coarsest grid of 27 15 405 cells a maximum number of levels l 7 was used resulting in the finest grid of 3456 1920 6635520 cells cell sizes range from 640 424 m 271360 m2 to 5 3 m 15 m2 for comparison this case was also computed with a well established finite volume fv solver murillo and garcía navarro 2010 on a gpu implementation lacasta et al 2014 with several unstructured triangular meshes ranging from a very coarse mesh 80546 cells cell area range 254 1000 m 2 to a very fine one 1150556 cells cell area range 9 70 m 2 no amr was applied to these meshes thus generating a rather uniform cellsize distribution fig 29 shows the simulated results with the mwdg scheme and the fv solver compared against the reference data from field and scaled up experimental observations fig 30 shows the same results as fig 29 but geolocalised at the experimental gauge and field data locations fig 30 a shows that maximum water elevation at the experimental probes is somewhat overestimated for all but two probes and mostly in the range of 10 of the experimental data the numerical predictions also slightly overestimate field markers fig 30 b shows the arrival time ratio numerical arrival time divided by experimental arrival time the largest error is recorded at the experimental probe closest to the dam break arrival times recorder by transformers in the actual event are well reproduced with arrival times for b and c being slightly faster in the simulation experimental arrival times in the main channel are all overestimated by the numerical solution it is seen that the upper part and the lower part of the valley result in smaller underestimations but the central part is where largest deviations are recorded fig 31 shows the evolution of hydrodynamic fields depth velocity and froude number the corresponding adaptive meshes are shown in fig 32 the initial dam break wave can be seen at t 50 s propagating downstream at 35 m s 1 and with sharp transcritical shocks as the wave moves downstream the complex features of the topography manifest strongly in highly heterogeneous hydrodynamic fields and a multitude of transcritical moving shocks by t 500 s a large portion of the valley is flooded generating an extensive wet dry front by t 1000 s the wave reaches the end of the valley and starts spreading out both the depth and velocity fields allow to see the stream channel and how the flood extends outwards fig 32 shows the evolution of the adaptive mesh in terms of a color coded resolution level across all times it can be seen that large parts of the coastal plain and of the sea are meshed at very coarse resolution similarly the wet dry front at the coast is always refined to the highest resolution as is the domain boundary in the valley gorge where the boundary geometry is complex it is also clear that the gorge x 7000 m and the river itself require high resolution to accurately describe the topography reason for which at t 50 and t 100 s it is difficult to observe mesh adaptivity in response to hydrodynamics by t 100 s the flood wave can be appreciated in the refined wetting fronts and more clear at t 500 s at this time and after it it is interesting to note how the leading flood wave is highly refined at the wetting front comparing refinement to the flood extent in fig 31 but not in the interior of the flooded region where it is no more refined than as required by the topography it is necessary to highlight that the triangular structures seen in fig 32 show high refinement along such triangular patterns this is the response of the adaptive strategy to the interpolated topography that is because the topography has been interpolated between data points intersections of planes exist in the interpolated topography although such intersections are artifacts of the interpolation the adaptive strategy percieves this as a significant change in the slope of topography thus triggering adaptivity this results in a somewhat less efficient mesh this behaviour highlights the need of better topography data which nowadays is often more available in which such artifacts are avoided in terms of the adaptive performance the maximum number of cells was 659823 at t 2792 57 s with η 0 9 for comparison many non adaptive solutions have been reported using anywhere between 4100 cells with cell size of approximately 350 m valiani et al 2002 to around 1 8 million cells on 10 10 m discretisation smith and liang 2013 and the finest reported 5 5 cartesian mesh with 2 07 million cells kim et al 2014 with many solutions with intermediate numbers brufau et al 2004 duran et al 2013 liang et al 2007 xia et al 2011 wang et al 2011 all with similar accuracy it is worth noting that the coarsest resolution in our computations is roughly twice as coarse as the coarsest reported mesh while the finest resolution matches that of the finest reported solutions to achieve the same resolution we require roughly 31 of the cells required by kim et al 2014 adaptive results have also been reported for this case although comparative analysis is difficult due to lack of reported information in most cases george 2010 achieved very high resolution 3 2 3 2 m but in a nested block wise refinement that is highly inefficient an et al 2015 presented a damr solution spanning resolutions between 33 and 2125 m but little information on the amr performance was reported similarly sætra et al 2015 performed damr a simulation with little insight into the performance of the amr but pointing out that they adapt the mesh not on every time step but every 50 zhou et al 2013 performed a damr solution on a triangular mesh with an initial resolution of 75 m resulting in adaptive cell sizes in the range of 13 335 m finally kesserwani and liang 2012a presented several damr solution with the rkdg2 scheme with a coarsest resolution around 160 m and finest resolution up to 50 m with maximum number of cells in the order of 37000 65000 depending on the particular setup which translate into efficiencies compared to their finest grids of 0 85 η 0 92 relative to our finest resolution this means 26 η 46 showing how with the strategy used by kesserwani and liang 2012a achieving a 5 m resolution would require at least 26 times more cells than the mwdg in comparison to all these adaptive solutions the mwdg2 swe computation presented here achieves a maximum resolution comparable to that of george 2010 but is significantly more efficient as the highest resolution is only localised at wet dry fronts and shocks moreover the coarsest resolution in our simulation is only second to the coarsest cells in the simulations by an et al 2015 no other simulations span seven levels of refinement and most require a relatively fine base resolution coarsest level 5 conclusion in this paper a 2d multiresolution multiwavelet based adaptive discontinuous galerkin scheme originally proposed by gerhard et al 2015a has been tested against complex realistic and challenging 2d shallow water benchmarks the selected tests are well known widely used and challenging for a variety of reasons from the simulations reported here we conclude i the mwdg scheme can accurately solve complex 2d shallow water problems ii the simulation of shallow flows which typically require domains considerably larger than the smallest features of interest can greatly benefit from the multiresolution amr process embedded in the mwdg solver iii the numerical results give empirical evidence supporting the formal proofs presented by gerhard et al 2015a that the mwdg strategy transparently incorporates the features of the reference numerical scheme conservation c property well balancing positivity under the complex benchmark tests performed iv the combination of high order and high local refinement allows to observe small and sharp flow features otherwise unlikely possible to compute particular technical insights can also be highlighted i the mwdg amr strategy used here is not restricted by proper grading alternatively proper nesting in some literature of neighbor cells this results in very sharp and localised transitions from coarse to fine resolution the end result is a more efficiently refined mesh than other amr schemes ii the strategy allows to use very coarse cells in the lowest resolution level coarsest mesh this is in clear contrast to previously proposed amr strategies which require a fine enough initial mesh to guarantee accurate results iii the large number of resolution levels together with the freedom from proper grading and thanks to the consistent assessment of significant details allows damr which allow the coarsest and the finest levels to coexist in the adapted multiresolution mesh this feature is not present in other strategies iv the hyperbolic structure and flow regimes as signalled by the froude number are very well captured by the adaptive mesh transcritical regions which imply sharp changes in the hydrodynamic regimes become refined in the adaptive mesh although this is not strictly enforced by the strategy this is particularly helpful since the high local resolution ensures that the propagation of characteristic information goes in the right direction v the mwdg swe solver can be applied at ad hoc order of accuracy as chosen by the modeller results shown here have been computed with dg2 and dg3 linear and quadratic approximations contrary to other strategies relying on linear projections our formulation keeps the flexibility of the generic dg scheme opens up possibilities to hp adaptivity and also keeps open the possibility of exploiting parallelisation benefits of higher order schemes the mwdg swe scheme assimilates the desirable properties of the reference dg swe scheme but also inherits its deficiencies and limitations some of these deficiencies can become painfully obvious when performing mwdg swe adaptive computations i spurious momentum generated by the positivity preserving limiter of xing et al 2010 in the presence of wet dry fronts over steep topography can be captured and tracked by the multiresolution analysis as significant details these waves are thus interpreted as physically meaningful which require and trigger mesh adaptation these highly resolved yet spurious momentum waves do not decay quickly due to both the high resolution and the high order of the method which together strongly limit the dampening dissipative effects of numerical viscosity ii the reference rkdg swe scheme suffers from a high computational cost per cell and per time step which quickly increases with order of accuracy together with a reduction of the cfl number and its consequent increase on the number of time steps although higher order dg approximations allow for coarser and more efficient adaptive meshes than lower order this remains a strong limitation on applicability it is possible that through hp adaptivity it is possible to overcome this limitation nonetheless improved stability of the reference scheme is an open challenge which would also translate into the mwdg solution these limitations clearly call for improvements in the reference dg swe scheme and the numerical fluxes necessary to ensure the correct and desirable properties of the scheme from a positive point of view the advantage of mwdg swe is that once the issue is solved in the reference scheme it will be assimilated transparently into the adaptive mwdg swe scheme credit authorship contribution statement daniel caviedes voullième conceptualization methodology investigation validation writing original draft writing review editing nils gerhard conceptualization formal analysis investigation methodology software writing original draft writing review editing aleksey sikstel investigation validation siegfried müller conceptualization formal analysis methodology supervision writing original draft writing review editing declaration of competing interest the authors declare that they do not have any financial or nonfinancial conflict of interests 
510,in gerhard et al 2015a a new class of adaptive discontinuous galerkin schemes has been introduced for shallow water equations including the particular necessary properties such as well balancing and wetting drying treatments the adaptivity strategy is based on multiresolution analysis using multiwavelets in order to encode information across different mesh resolution levels in this work we follow up on the previous proof of concept to thoroughly explore the performance capabilities and weaknesses of the adaptive numerical scheme in the two dimensional shallow water setting under complex and realistic problems to do so we simulate three well known and frequently used experimental benchmark tests in the context of flood modelling ranging from laboratory to field scale the real and complex topographies result in complex flow fields which pose a greater challenge to the adaptive numerical scheme and are computationally more ambitious thus requiring a parallelised version of the aforementioned scheme the benchmark tests allow to examine in depth the resulting adaptive meshes and the hydrodynamic performance of the scheme we show that the scheme presented by gerhard et al 2015a is accurate i e allows to capture simultaneously large and very small flow structures is robust i e local grid refinement is controlled by just one parmeter that is auotmatically chosen and is more efficient in terms of the adaptive meshes than other shallow water adaptive schemes achieving higher resolution with less cells keywords dynamic adaptive meshing multiresolution analysis high order schemes shallow water equation discontinuous galerkin multiwavelets 1 introduction the shallow water equations swe are widely accepted as the appropriate model for the simulation of complex flood flows over realistic terrains garcía navarro et al 2019 robust shallow water solvers are now available mostly based on well established godunov type solvers and primarily based on first order finite volume fv schemes with explicit time integration kesserwani and wang 2014 teng et al 2017 toro and garcía navarro 2007 it is also clear and well established that a certain set of properties must be ensured by the numerical scheme for the solution to be accurate and efficient under complex and realistic flow conditions bermudez and vázquez 1994 caleffi and valiani 2017 díaz et al 2007 li et al 2018 liang et al 2015 murillo and garcía navarro 2010 noelle et al 2007 i mass conservative ii c property iii well balanced iv positivity preserving and v shock capturing there is a trend within the research community to pursue higher order solutions of the swe by muscl reconstructions hou et al 2015 liang and borthwick 2009 reis et al 2018 zhao et al 2019 weno schemes caleffi 2010 lakhlifi et al 2018 navas montilla and murillo 2016 noelle et al 2006 parna et al 2018 and of primary interest herein discontinuous galerkin dg schemes dg has been increasingly and successfully applied to discretise the swe for many applications araud et al 2012 bonev et al 2018 caviedes voullième and kesserwani 2015 duran and marche 2014 escalante et al 2019 kesserwani and liang 2011 kesserwani and wang 2014 kubatko et al 2009 marras et al 2018 neupane and dawson 2015 qian et al 2018 rannabauer et al 2018 schwanenberg and harms 2004 tassi et al 2007 vater et al 2019 wirasaet et al 2015 xing et al 2010 xing 2014 the dg method generalises the concept of the fv method while relying on the finite element fe notion of projecting the solution onto a space of trial functions but without the restriction of keeping the functions continuous therefore the piecewise discontinuous description of the solution allows to achieve high order accuracy while keeping locality this is in clear contrast to weno schemes which require non local information this in turn makes dg schemes highly parallelisable while also shifting computational effort to arithmetic rather than memory transfer a desirable and very convenient property for high performance computing brus et al 2016 rannabauer et al 2018 wintermeyer et al 2018 dg swe solvers are currently still experimental as there are still unresolved issues relating to optimal limiters li and zhang 2017 treatment of source term discontinuities caleffi et al 2016 kesserwani 2013 which relates to well balancing and positivity preservation caviedes voullième and kesserwani 2015 kesserwani et al 2018 and their increased computational cost compared to well established and mature fv solvers kesserwani and wang 2014 the solution to the latter issue i e reducing computational time without penalising accuracy is essential for swe solvers in particular dg swe solvers to be applicable in the context of large scale and high resolution flood simulation and water resources simulation in general miller et al 2013 many paths and their combinations towards this objective are being explored for such purpose in the broad swe modelling community i parallel and gpu computing dazzi et al 2018 lacasta et al 2014 liang and smith 2015 parna et al 2018 sætra et al 2015 sanders and schubert 2019 vacondio et al 2014 wintermeyer et al 2018 ii local dazzi et al 2018 hoang et al 2019 kesserwani and liang 2015 trahan and dawson 2012 and large morales hernández et al 2014 time stepping iii subgrid and porosity modelling bruwier et al 2017 ferrari et al 2019 li and hodges 2019 özgen et al 2015 iv adaptive mesh refinement amr either a topography driven fixed famr caviedes voullième et al 2012 hou et al 2018 vacondio et al 2017 or b flow driven dynamic damr arpaia and ricchiuto 2018 donat et al 2014 haleem et al 2015 lakhlifi et al 2018 liang and borthwick 2009 kesserwani and liang 2012a mandli and dawson 2014 sætra et al 2015 this work is concerned with 2d damr dg swe several amr schemes have been proposed and applied in the context of swe achieving speed up in the order of 20 donat et al 2014 liang and borthwick 2009 mandli and dawson 2014 tate et al 2006 very importantly the properties required from numerical schemes conservation well balancing etc should be preserved by the amr strategy a potentially non trivial task from which limitations regarding conservation and well balancing appear donat et al 2014 liang et al 2015 hou et al 2018 mandli and dawson 2014 further limitations have been identified regarding amr strategies requiring meshes which are bounded by proper grading alternatively proper nesting in swe literature of neighbors typically 2 1 berger et al 2011 kesserwani and liang 2012a liang and marche 2009 hou et al 2018 sætra et al 2015 vacondio et al 2017 ad hoc gradient threshold for coarsening and refinement kesserwani and liang 2012a inefficient block based refinement george 2010 and increased errors for high froude numbers liang and marche 2009 with the goal of avoiding and solving the aforementioned limitations in this work the swe are solved by a dg scheme enriched by multiwavelets mw to produce a multiresolution mwdg scheme which drives the damr strategy in recent years the concept of multiscale based mesh adaptivity quite successful with fv solvers for compressible fluid flow müller 2003 2009 and references therein as well as for other hyperbolic equations guo and cheng 2017 has been applied to the framework of dg schemes the mwdg concepts were first investigated analytically and numerically for one dimensional scalar conservation laws hovhannisyan et al 2014 the method was then extended to multidimensional scalar conservation laws gerhard and müller 2016 and to the euler equations gerhard et al 2015b in gerhard et al 2015a it was further developed and analysed for the solution of swe it was shown that the required properties of the base numerical solver can be transferred to the adaptive solver and proof of concept swe solution were presented the methodology has been further explored in terms of hydraulic and computational performance but restricted to the one dimensional setting caviedes voullième and kesserwani 2015 kesserwani et al 2015 showing good performance under steady states dam breaks and compared to both 1d analytical and experimental benchmarks in this paper we explore the application of the mwdg swe solver proposed in gerhard et al 2015a to complex 2d problems with significantly more complex and realistic topographies and hydrodynamics and therefore also computationally more ambitious this requires also to address implementation aspects such as an efficient initialization and a parallelization strategy to distribute the work load the aim is to explore the following research questions i does the mwdg scheme perform well for realistic and complex 2d swe test cases ii are there relevant limitations or open issues which complicate the solutions of such problems iii how can mwdg swe solvers enable further research of shallow flows the paper is organised as follows section 2 summarises the base dg swe scheme and its properties in section 3 this scheme is combined with a multiresolution analysis to dynamically trigger local grid refinement section 4 presents challenging numerical tests and their results and finally conclusions are summarised in section 5 2 discontinuous galerkin schemes for shallow water equations in this section we briefly summarize the main ideas of the runge kutta dg rkdg schemes applied to the shallow water equations including the modifications to achieve well balancing and positivity preserving for details the reader is refered to gerhard et al 2015a the shallow water equations can be written as 1 u t f u s x u on ω 0 t with a spatial domain ω r d d 1 2 and conserved quantities u h h v r m m d 1 fluxes f h v h v v 0 5 g h 2 i and source terms s 0 g h z σ let h m be water depth v m s velocity z m represent topography and g m s2 is the gravitational acceleration i is a 2 2 identity matrix the friction term σ is approximated using the glaucker manning model σ n σ 2 v 2 h 4 3 with roughness coefficient n σ s m 1 3 these equations are supplemented with initial data u 0 u 0 and appropriate boundary conditions we discretize the domain ω by a finite number of cells vλ denoting by g v λ λ i the computational mesh on this mesh we introduce the dg space of cell wise polynomials of total degree less than p 2 s f l 2 ω f v λ π p 1 v λ λ i in order to derive the variational formulation of the dg scheme we first rewrite 1 in a weak formulation by multiplying 1 by a test function w h s m and integrating over a cell vλ then we perform integration by parts and introduce numerical fluxes f approximating the flux f n in direction n this results in the semi discrete dg formulation find u h t s m t 0 t such that for all w h s m and λ i 3 v λ u h t w h d x v λ f u h w h s x u h w h d x v λ f w h d s 0 where a b a b r m denotes the standard inner product and for a b r m d we define the product a b i j aijbij the numerical flux f depends on the inner and outer value of u h at the boundary of vλ and on the outward pointing unit normal vector a number of formulations exist and have been used for the numerical flux in swe caviedes voullième and kesserwani 2015 murillo and garcía navarro 2012 tassi et al 2007 two formulations are implemented and are used in this work a local lax friedrichs numerical flux following gerhard et al 2015a and as is common in the dg context and roe linearisation roe 1997 as is it frequently used in fv swe schemes martins et al 2017 murillo and navas montilla 2016 the weak formulation of the dg scheme leads to a system of ordinary differential equations which is integrated in time with an explicit runge kutta rk scheme in order to guarantee the stability of the fully discrete scheme limiting of the high order coefficients is warranted after each rk stage of the runge kutta scheme in order to prevent spurious oscillations gibbs phenomenon a number of methods are available for this e g cockburn and shu 1998 li and zhang 2017 without any clear best approach especially in the swe context since the limiter also interacts with well balancing and positivity an and yu 2014 caviedes voullième and kesserwani 2015 vater et al 2019 the commonly used tvb limiter by cockburn and shu 1998 applied on the local characteristic variables is selected here several strategies bollermann et al 2013 kesserwani and liang 2012b qian et al 2018 vater et al 2015 xing et al 2010 have been proposed to ensure well balancing wb and positivity preservation pp here we follow the flux modification strategy proposed by xing et al 2010 as it is generic and widely used this strategy allows to natively project the bottom topography z to the same dg space as the solution u h contrary to alternative approaches which require an edge continuous projection of z or are restricted to linear dg2 approximations kesserwani and liang 2012b kesserwani et al 2018 vater et al 2015 this native property of the wb pp strategy of xing et al 2010 is convenient in the adaptive context since continuity of the projected topography is not ensured by neither the dg projection nor the adaptive scheme nonetheless it is relevant to point out that the xing et al 2010 strategy is not without flaws caviedes voullième and kesserwani 2015 kesserwani et al 2018 regarding momentum conservation at wet dry fronts on steep bed slopes an issue related to the various treatments of steep bed slopes in the dg swe context caleffi et al 2016 ern et al 2008 in this work we do not attempt to solve any of the flaws of xing et al 2010 strategy as it is not the focus of this paper finally in order to achieve the well balancing property the local characteristic variables are based on h z h v instead of h h v for the purposes of limiting for details we refer to gerhard et al 2015a 3 multiwavelet based grid adaptation the dg discretization operates on an array of coefficients which effectively describe the polynomial representation of the solution the underlying idea of the mwdg adaptive strategy is to perform a multiresolution analysis of the polynomial coefficients on a hierarchy of nested grids that determine a nested sequence of dg spaces this provides local information on the difference in the solutions supported at successive refinement levels such differences may become negligibly small in regions where the solution is locally smooth under such conditions applying hard thresholding allows to compress the data and the dg spaces respectively thereby triggering local mesh adaptativity a brief summary of the multiwavelet based grid adaptation is presented here for a detailed description the reader is referred to hovhannisyan et al 2014 and gerhard et al 2015a b multiresolution analysis the starting point for a multiresolution analysis is a hierarchy of nested grids g ℓ v λ λ i ℓ for increasing number of refinement levels ℓ the index set m λ i ℓ 1 denotes the refinement set of cell vλ and for μ i ℓ let λ μ i ℓ 1 denote the parent cell on level ℓ 1 thus it holds that v λ μ m λ v μ on each level ℓ of this hierarchy we define the dg space s ℓ analogously to 2 obviously these spaces inherit the nestedness from the underlying grid hierarchy and form a multiresolution sequence 4 s 0 s 1 s ℓ s ℓ 1 l 2 ω the nestedness of the discretization spaces implies that there exist orthogonal complement spaces w ℓ such that s ℓ 1 s ℓ w ℓ for a fixed level l applying this two scale relation yields 5 s l s 0 w 0 w l 1 to perform the multi scale decomposition of the single scale space sl in 5 we introduce a basis ϕ i i i ℓ s for the single scale spaces s ℓ and a basis ψ i i i ℓ w for the complement spaces w ℓ for the sake of efficiency we assume that the support of these basis functions is a single cell if follows that the index i of ϕ i and ψ i can be decomposed in a spatial and a polynomial part i λ i i e i ℓ s i ℓ p and i ℓ w i ℓ p where p and p characterize the local degrees of freedom of s ℓ and w ℓ respectively in order to exploit the potential of data compression we make use of the multi scale transformation 5 and determine a local two scale representation of u s ℓ m 6 u v λ μ m λ i p u μ i ϕ μ i i p u λ i ϕ λ i i p d λ i ψ λ i λ i ℓ 1 fig 1 illustrates the local two scale representation 6 applying this local two scale decomposition recursively we obtain the multi scale representation of w sl m 7 w i i l s u i ϕ i i i 0 s u i ϕ i ℓ 0 l 1 i i ℓ w d i ψ i where d i are defined as the detail coefficients and u i the single scale cofficients furthermore the arrays with the local degrees of freedom in a cell vλ are denoted as u λ w u λ i i p and d λ w d λ i i p a detailed description of the construction of the basis functions and the efficient implementation of the transformations is provided by gerhard et al 2015b in particular in 1d the legendre polynomials are chosen for single scale basis functions ϕ i on each cell vλ the correspomding multi scale basis functions ψ i so called multiwavelets are determined similar to alpert s construction alpert et al 2002 these bases are extended to higher spatial dimensions by tensor products the advantage of the multi scale representation 7 is that the detail coefficients provide information on the difference between two successive refinement levels in regions where the underlying function is smooth enough the detail coefficients may become negligibly small and therefore their contribution is small this information is then used to determine an adaptive grid by sparsening the multi scale representation 7 thresholding and grid adaptation thresholding i e filtering out irrelevant details requires the definition of level dependent threshold values εℓ 0 a detail coefficient d i on level l i is significant if it is larger than a level dependent threshold value εℓ i allowing to define the index set of significant detail coefficients by 8 d ε w i ℓ 0 l 1 i ℓ w max 1 k m c ψ i k d i k ε ℓ i where the constant c ψ i k depends on the normalization of the multiwavelet function ψ i and the magnitude of the kth conserved quantity gerhard et al 2015a thereby we can find a sparser representation for w w ε i i 0 s u i ϕ i ℓ 0 l 1 i d ε w d i ψ i if d ε w is a tree then w ε is a projection of w to a coarser grid g ε w gerhard et al 2015a this grid can be determined efficiently by d ε w proceeding from coarse to fine a cell is refined whenever a significant detail coefficient exists in fig 2 this is illustrated for l 2 gerhard and müller 2016 prediction by hard thresholding we are able to coarsen the mesh we emphasize that the above multiresolution analysis operates on data corresponding to arbitrary but fixed time thus the adaptive grid determined by hard thresholding can only appropriately identify features in the solution on this time level however the data evolve in time due to the evolution eq 1 to ensure that during the evolution process all solution features are adequately resolved for both the old and the new time level i e significant details at the new time level are not missed we need to perform the multiresolution analysis for both time levels for this purpose the data at the new time level must be known but they are not yet available to avoid a costly iteration process on the evolution step harten 1995 suggested to determine a prediction set d ℓ n 1 d ℓ w n d ℓ w n 1 accounting for the hyperbolic character of the underlying partial differential eq 1 we follow harten s heuristic idea which mainly consists of two steps gerhard et al 2015b 2015a i since information may be transported details in a local neighborhood may get significant ii due to formation of shocks additional details on higher levels might get significant fig 3 illustrates the refinement strategy via prediction on the detail coefficients for a one dimensional example in the following algorithm we summarize one timestep of the adaptive scheme algorithm 1 timestep of adaptive scheme 1 refine the grid via prediction on detail coefficients on h z h v t 2 compute the evolution with the dg scheme on h h v t 3 coarsen the grid via thresholding on h z h v t bottom topography to start the computation we need to generate the intial adaptive grid by means of the initial data u 0 and the bottom topography b typically the bottom topography is given as a data set of discrete points x i zi or as a function z x from the given information we need to determine a projection zh s init sl in case of a given function we can use cell wise a standard l 2 projection in case of a discrete data set we have to solve a least squares problem resulting from an overdetermined interpolation problem on each cell to find the projection zh since the dg space s ℓ is defined locally and the well balancing strategy does not require continuity we can perform this projection locally as well in the following we consider the projection to π p 1 on a single cell vλ let bλ denote the index set of all tuples x i zi which are located in vλ or on vλ the projection zh on vλ is defined by the following linear least squares problem 9 z i z h x i i b λ 2 min well balancing and positivity preserving recall that the single scale rkdg scheme is well balanced and positivity preserving by the strategy from xing et al 2010 these properties are carried into the mwdg scheme as shown by gerhard et al 2015a by ensuring a few conditions the bed topography z is projected onto the same dg space as the solution u h since in the adaptive scheme the mesh g n is dynamically changing and thus the discretization space sn is changing as well therefore it is necessary to ensure that zh is in sn at each discrete time tn which will carry the wb and the pp property of the base rkdg scheme gerhard et al 2015a in practice and for the sake of efficiency a locally refined mesh is derived with the initial projection of z into the dg space during the adaptive process it is ensured that such a mesh or alternatively its corresponding significant details is always included in the dynamic computational mesh adapted for the solution therefore the efficiency of the adaptive scheme depends on the choice of the adaptive mesh for the bed topography nonetheless the strategy and criteria to generate this topography based adaptive mesh is identical to those used to adapt the mesh to the transient flow fields we simply do not recalculate it at every time step caviedes voullième and kesserwani 2015 gerhard et al 2015a finally to avoid stability problems at wet dry interfaces we ensure that cells at these interfaces are refined up to the highest discretization level choice of threshold value when performing hard thresholding we introduce an error in order to control this error i e to ensure that this error is bounded by a given threshold value ε 0 it is sufficient to choose ε ℓ 2 ℓ l ε as is proven in gerhard 2017 the efficiency and the accuracy of the adaptive mwdg essentially relies on the choice of the threshold value ε note that the adaptive grid becomes coarser with larger threshold values and thus the adaptive schemes becomes faster but less accurate vice versa smaller threshold values provide higher accuracy but at the expense of higher computational cost therefore an ideal strategy aims to balance the discretization error i e difference between the exact solution and the base scheme and the perturbation error i e the difference of the base scheme and the adaptive scheme in hovhannisyan et al 2014 a rigorous analysis of the perturbation error for nonlinear scalar conservation laws in 1d suggests to choose the threshold value in the order of the discretization error of the base scheme i e ε c t h r h l β with β p for smooth solutions and β 1 for discontinuous solutions in practice this choice is typically too pessimistic because it accounts for the worst case that all non significant details are of size εℓ therefore in gerhard et al 2015b a heuristic strategy is investigated 10 ε c t h r h l β numerous computations presented in gerhard et al 2015b gerhard and müller 2016 and gerhard 2017 verified that the error of the adaptive scheme is asymptotically the same as the error for the base scheme and the adaptive scheme is more efficient i e a target accuracy is reached at significantly reduced computational cost the constant cthr is typically chosen as 1 except when the problem at hand exhibits a wide range of scales where cthr should be chosen as the ratio of the smallest and largest scale for our computations we apply the heuristic threshold strategy to conclude this discussion we would like to emphasize that with regard to efficiency and accuracy the threshold value ε is not a user specified parameter as is suggested for instance in kesserwani et al 2019 limiting for stability reasons we perform limiting after each stage of the runge kutta scheme since by limiting the order of accuracy is decreasing locally this should become effective only at discontinuities numerous strategies have been developed see for instance krivodonova et al 2004 vuik and ryan 2016 aiming to detect such cells we would like to point out that the multiresolution analysis provides a reliable detector if the number of refinement level is sufficiently large i e discontinuities inherently trigger refinement to the highest level thus we apply the limiter only in cells on the highest refinement level 4 numerical results in this section we present numerical results for three well known and widely used test cases for which measured data for validation is available i experimental tsunami run up onto a beach ii experimental dam break flow over an idealized city and iii field scale malpasset dam break the general simulation parameters unless stated otherwise are the following computations have been performed using a third order dg3 scheme i e p 3 with piecewise quadratic polynomials for time discretization an explicit third order ssp rk method with three stages and c cfl 0 1 is used we consider a shu constant of m 50 for the limiter in order to avoid limiting in smooth regions of the solution this is in practice not particularly relevant since the limiter is only applied at the highest resolution level which only exists on non smooth areas numerical fluxes are approximated using the local lax friedrichs flux llf the computations have been performed in parallel using space filling curves for the load balancing and the redistribution of the workload in the adaptive scheme for details we refer to gerhard 2017 and brix et al 2009 we highlight that although we perform a benchmark analysis the goal of it is not only to show the validity of the proposed adaptive numerical solver in fact the approach has been previously verified with exact solutions in 1d caviedes voullième and kesserwani 2015 kesserwani et al 2015 and 2d gerhard et al 2015a the focus here is show and discuss how mra and the mwdg swe harvest the multicale nature of the problem into an efficient adaptive mesh we also study the properties and suitability of the adaptation to the flow conditions 4 1 tsunami run up onto a beach in 1993 an off shore earthquake in the sea of japan caused a tsunami wave the tsunami wave reached okushiri island in the hokkaidō prefecture and caused serious damage near the village of monai the small offshore island muen caused an unexpected high run up of 31 7 m in a coastal valley behind the island whereas the run up heights on the beaches directly exposed to the tsunami wave were only around 25 m in order to investigate this phenomenon the central research institute for electric power industry criepi in abiko japan performed 1 400 scale experiments of the run up in this area using a tank of 205 m length and 3 4 m width matsuyama and tanaka 2001 the coastal region of the experimental setup is shown in fig 6 a experimental measurements are available third international workshop on long wave runup models 2004 for the position of the highest run up and the temporal evolution of the water surface h z at three control points between muen island and the shore the computational domain locations of these control points and the bathymetry z x y are depicted in fig 4 this experimental setup is of interest for model testing and validation and has been widely used arpaia and ricchiuto 2018 hou et al 2015 2018 kesserwani and liang 2012a morales hernández et al 2014 murillo et al 2009 murillo and garcía navarro 2012 vater et al 2019 we select this test case to assess the overall performance of the adaptive scheme under a smooth yet complex natural topography forced by transient boundary conditions and to assess the performance of the wet dry strategy under damr for the computation we focus on the scale experiment instead of the real tsunami event focusing only on the coastal area since the inflow wave was recorded near the cost thus the simulation of the very long channel can be avoided and the computational domain covers only a domain ω 0 5 488 0 3 402 m the incoming tsunami wave at the sea boundary at x 0 m is an h z t function third international workshop on long wave runup models 2004 and is shown in fig 5 from the surface wave we compute momentum h v at x 0 by using riemann invariants such that h h v corresponds to a simple incoming wave gonzàlez et al 2011 the water surface and momentum are prescribed at the inflow boundary x 0 m as characteristic boundary conditions coinciding with the experiment we consider reflecting wall boundary conditions at all other boundaries the domain is initialised with quiescent initial conditions i e h z 0 m and v 0 m s 1 as shown in fig 6 in a 3d view and a profile at y 2 m of the bathymetry z and the initial water surface h z the multiresolution problem setup consists of 8 5 40 cells at the coarsest grid resolution level 0 simulations were run with l 5 and l 6 levels of refinement which would result in 256 160 n l 5 40 960 and 512 320 n l 6 163 840 cells respectively the bathymetry is given by a discrete set of 97 857 points from which we determine via interpolation and thresholding an adaptive representation of the bathymetry in terms of piecewise quadratic polynomials the dry tolerance in the wetting and drying strategy was set to 10 4 m e g vater et al 2019 manning s coefficient was set to 0 01 sm 1 3 kesserwani and liang 2012a morales hernández et al 2014 murillo et al 2009 the threshold parameter was chosen using the heuristic strategy as ε l c thr h l here the amplitude of the inflow wave is in the order of 10 2 m whereas the quantity h z is in the order of 1 m fig 5 thus the wave is 100 times smaller than the order of magnitude of h z consequently in order to resolve the wave structures caused by the tsunami we have chosen the factor c thr as 1 100 the boundary condition forces an incoming wave moving towards the shoreline thereby the water is first retracting from the shoreline before the following tsunami wave is eventually flooding the dried up regions and the coastal area afterwards the reflecting wave at the shoreline causes wave structures moving away from the coast fig 7 compares simulated only l 6 for clarity water surface h z to experimental results at the three gauge points shown in fig 4 between muen island and the shore good overall agreement can be seen both in terms of the water surface elevation h z and the wave dynamics and timing the results are similar in quality to previously reported simulations computed with other numerical schemes gonzàlez et al 2011 hou et al 2015 morales hernández et al 2014 murillo et al 2009 murillo and garcía navarro 2012 vater et al 2019 including adaptive ones arpaia and ricchiuto 2018 hou et al 2018 kesserwani and liang 2012a the largest differences between experimental and simulated water surface occur systematically for t 10 s in which the simulations show unperturbated water at rest this is the case in all aforementioned results reported in the literature this difference is attributed to experimental issues the start of the receeding water t 10 s is well captured as is the arrival of the tsunami wave at all three locations minor differences area are observed in the comparisons related to experimental error and limitations of the swe model table 1 shows a comparison of the maximum run up of the tsunami wave in terms of its height position x y and time of occurence results from l 6 adaptive simulations are compared to experimental observations matsuyama and tanaka 2001 and numerical results of the geoclaw solver gonzàlez et al 2011 are listed for comparison next we focus on the maximum run up of the tsunami wave to this end we have determined the maximum height its position and time of occurrence in our adaptive computations when comparing our results with the experimental data and the results using geoclaw we conclude that our adaptive solver can identify the maximum run up height and its position of occurrence very accurately moreover we note that the l 6 computation is more accurate than the one with l 5 the time of occurrence of the maximum run up in our computation is similar to the one from the geoclaw solver gonzàlez et al 2011 the instant of the highest run up is shown in fig 10 a summarizing we infer from the validation results obtained with the mwdg3 scheme are as accurate as the results available in the literature it has been pointed out arpaia and ricchiuto 2018 that the gauge results in this test case are not very sensitive to mesh resolution in fact accurate solutions have been reported with very coarse meshes murillo et al 2009 for different numerical solutions from different numerical and adaptive schemes to be formally comparable it would be necessary to compare formal accuracy resolution and degrees of freedom however for experimental problems such as the ones presented here accuracy metrices are often fuzzy and many previous papers do not report formally accuracy nonetheless is is well accepted that higher resolution will result in higher accuracy it follows that adaptive solutions achieving higher resolution will be in principle more accurate if it also does so with less cells we consider the scheme to be more spatially efficient i e in terms of the mesh it must be highlighted though that because of cfl restrictions across different formulations computational time may behave differently we highlight that the interest here is weighted towards assessing the adaptive performance of the scheme given that the solution is accurate to do so consider fig 8 showing the evolution of the adaptive mesh and table 2 showing a comparison of the computational effort in terms of computational cells to solutions reported in the literature since several of the solutions analysed are adaptive we define mesh efficiency η 1 n a n l where na is the maximum number of adaptive cells and nl is the number of cells at the uniform fully refined highest resolution for the sake of fair comparisons we additionally define an efficiency relative to our l 6 solution so that η n a n l 6 and a resolution normalised relative efficiency η η δ x δ x l 6 where δx is the finest adaptive or not resolution of a particular mesh note that for non adaptive cases n a n l the rationale behind using these type of metrics instead of the more typical computational time is as follows on the same uniform and fixed grid fv solvers will most likely be faster than dg schemes the main reason for this is that the cfl restriction is increasingly more stringent as polynomial order increases for the dg scheme even if the cost of a time step were the same the cost of a single time step is however also larger for the dg scheme as more than one runge kutta stage is required and a larger number of riemann problems and numerical fluxes must be computed comparing first order fv schemes to dg on such uniform meshes will result in lower computational time for fv schemes but at a lower accuracy for higher order a fv scheme of the same accuracy as a dg scheme it is also likely that the fv scheme will have a lower cost cfl fewer riemann problems less numerical flux computations however in the context of parallel computing fv schemes of the same accuracy higher than first order will be inefficient as their stencil extends beyond the immediately local neighbors whereas dg schemes are strictly local on the immediate neighboring cells independt of the polynomial order this difference increases as computational implementation moves from shared to distributed memory systems as the cost of data transfer and non local data transfer grows quickly possibly even overshadowing the cost of arithmetics finally these arguments point out the need of adaptive grids to achieve dg solutions at lower cost which is why the concept of mesh efficiency becomes relevant table 2 shows two groups adaptive solutions followed by non adaptive ones in chronological order firstly it is relevant to highlight that for l 6 the adaptive mesh peaks at 18 139 cells resulting in a very efficient mesh with η 0 89 all but three of the solutions reported in table 2 have a maximum resolution that is coarser than the l 6 solution and for those three η 1 showing that they are comparably more expensive in terms of cell numbers than the l 6 solution of those with coarser cells all but one the very coarse solution by murillo et al 2009 have an η larger than 0 11 the value obtained for l 6 this means that all but one simulation reported in the literature can be considered more expensive in terms of number of cells this clearly shows how the mwdg swe strategy produces a damr in which the number of computational cells is significantly reduced without compromising the accuracy of the highest resolution the comparison to adaptive solutions is somewhat more complex in terms of our approach the method by kesserwani and liang 2012a is closest and easiest to compare as the table shows they obtained η 0 56 meaning that such an adaptive strategy is considerably less efficient than the mwdg2 η 0 89 furthermore normalised by resolution kesserwani and liang 2012a achieve η 0 33 i e approximately three times more expensive than our l 6 for the same resolution figs 9 and 10 show the numerical solutions and the corresponding adaptive grids using l 6 l 5 is not shown for brevity the damr can be observed as the mesh refinement tracks the arising waves whereas in regions with small variations the grid remains coarse the initial refinement shows already the reasons for high efficiency wet dry fronts are refined to the highest resolution as is the step like bed feature at x 2 m but a large portion of the domain remains on levels 2 and 3 with roughly 15 of the domain still at the coarsest level at t 13 5 s the receeding water produces dry areas at x 4 triggering adaptivity note how the rest of the domain remains with a very similar mesh as the initial one as the tsunami wave propagates past the island t 14 3 s it triggers refinement to the highest level and as it reaches the coast line t 15 s the mesh coarsens behind the tsunami wave as the dry areas disappear note how the mesh for x 3 m remains fundamentally unchanged from the initial one from this time onwards the amr tracks the reflections of the tsunami wave t 16 5 s and flooding the island t 19 5 s which because of its steep slopes remains highly refined finally as the reflection moves past the island back into the sea mesh refinement is triggered for x 2 m while the regions between the island and the coast are again coarsened fig 8 shows that the computational meshes for both l 5 and l 6 remain rather undisturbed from the topography based initial refinement during the first 10 s a time at which the tsunami wave is already incoming fig 5 after this time the mesh starts to be refined and by comparing fig 9 a and b it can be seen that the increase of cells is caused by drying between the coast and the island then onwards there is an overall growing trend during the simulation with instantaneous refinement peaks at t 14 s and t 18 s corresponding to the arrival of the tsunami wave at the coast fig 9 c and the expanding reflection back into the ocean fig 10 b the fact that these are instantaneous maxima shows how the damr maintained a very localised refinement tracking the incoming waves and the initial reflections the global maxima is obtained at t 21 5 s when the complex reflections moving back into the sea flood the domain as seen in fig 10 c qualitative comparisons can be made with other adaptive solutions of this problem the initial mesh reported by kesserwani and liang 2012a requires much finer cells than the mesh reported here and their final mesh t 25 s is strongly refined in regions were the amr of fig 10 c shows less refinement 3 x 4 5 an issue which is also observed in the famr mesh reported by hou et al 2018 the coastline is refined to the highest resolution in both hou et al 2018 and kesserwani and liang 2012a but also a very wide area around it clearly the number of allowed refinement levels is an advantage of the mwdg strategy enabling a more aggressive transition from coarse to fine 4 2 dam break flow through an idealised city an experimental dam break flow through an idealised city in a 2d laboratory flume with a horizontal bed was reported by soares frazão and zech 2008 this is a well known benchmark problem widely used for model validation and testing ginting 2019 hartanto et al 2011 jeong et al 2012 özgen et al 2015 petaccia et al 2010 soares frazão and zech 2008 wang et al 2017 the setup is shown in fig 11 a gate located 7 15 m from the left boundary allows to fill a tank upon a sudden gate opening a dam break phenomenon is simulated 25 obstacles of 0 3 0 3 m represent buildings in the experimental model that are always above the water surface during the experiment the streets between them have a width of 0 1 m soares frazão and zech 2008 performed simulations of this case using a first order finite volume scheme with a uniform mesh where the obstacles were represented as holes in the domain therefore their walls where boundaries in contrast the obstacles are here included in the mesh to purposely include a discontinuous bed topography the hydrodynamics of the test case is complex and exhibits flow structures on different scales soares frazão and zech 2008 a large dam break shock wave moves downstream a hydraulic jump then develops with a length similar to that of the urban structure small scale flow structures also develop within the urban structure this significant difference in scales makes this configuration ideal for testing and analysing the performance of the multiresolution damr strategy the computational setup is as follows the coarsest level level 0 consists of 90 9 810 cells two maximum number of refinement levels were selected 6 and 7 which would generate 5 760 576 3 317 760 cells for l 6 and 11 520 1 152 13 271 040 cells for l 7 respectively this corresponds to 19 906 560 79 626 240 degrees of freedom for such meshes with a dg3 scheme 6 degrees of freedom per cell the simulation was run until t 10 s manning s roughness coefficient was set as 0 01 s m 1 3 soares frazão and zech 2008 the initial conditions are an initially wet channel with h 0 011 m and a reservoir water depth of h 0 40 m upstream from the gate as in the experiment boundary conditions were all closed except for the downstream boundary which was set as transmissive the dry tolerance was set as 10 4 m the threshold parameters were chosen for both l 6 and l 7 simulations as c t h r 0 2 and β 1 computations were performed in parallel on an intel xeon cluster with an infiniband network using 320 work units in the experiment the water surface was measured at 64 control points inside the urban area as shown in fig 12 in order to validate the results the water surface along the control points at y 1 2 1 6 2 2 4 are compared in figs 13 16 for selected times and both mesh setups similar to soares frazão and zech 2008 there is an overall very good agreement between experimental and simulated results to the same extent as previously reported numerical solutions moreover the two simulations l 6 and l 7 produce very similar results the largest differences between simulations and experiments occur roughly at x 12 m where the simulations tend to underestimate the height of the hydraulic jump the results suggest that resolution plays no role in this underestimation it is likely that the underestimation comes from the fundamental incapacity of the swe to capture the vertical velocities generated by the impact of the wave analogous to other fast moving highly inertia flows agains obstacles compared by martínez aranda et al 2018 in contrast to previously reported simulations ginting 2019 soares frazão et al 2008 wang et al 2017 the high resolution and high order solution in the streets results in more jagged profiles perhaps resolving flow structures smaller than the widths of the streets which are otherwise not captured in lower resolution and lower order models another benchmark is shown in fig 17 which compares experimental and simulated water surface evolution at four gauge points along y 2 overall there is a good agreement the upstream point a shows the dam break wave passing through followed by its wake and at t 5 s registers the hydraulic jump note that the simulated results show a much more instantaneous jump the high backwater effect is well captured at point b just upstream of the urban area shows good agreement except around t 5 s in which both numerical solutions show a depression not observed in the experimental data this is likely to be related to reduced dissipation in the simulation we discuss this topic below together with the analysis of the hydrodynamic fields the simulated results at points c and d are noisy but represent rather well the experimental signal figs 18 26 show the evolution of the water depth field and the computational mesh for both mesh setups additionally fig 25 shows velocity and froude number for t 7 s and l 7 only in general it is clear how the adaptive mesh tracks the transient wave structures whereas in regions with small variations the mesh is coarse at t 1 s the initial dam break wave progresses forward with a characteristic shock wave shape the wave front is very sharply captured by the highest level of mesh resolution it is remarkable that the resolution required to capture the wave front transitions is within the width of a single level 0 cell all the way to the coarsest resolution a secondary structure just upstream of the shock can also be observed to be highly resolved two depressions are observed detaching from the reservoir walls also warranting for high resolution fig 18 also allows to appreciate the initial bed projection and the mesh adapted to it note how the horizontal channel is meshed by the coarsest level cells level 0 except near the side edges where both a side slope is present and a wet dry front exists because of the latter the mesh is refined to the highest level at such locations it is also noteworthy that the mesh transitions over one edge from level 0 to 4 for l 6 i e 8 cells from level 4 share an edge with a single level 0 cell 8 1 ratio this is significantly different and more efficient in comparison to other amr strategies berger et al 2011 kesserwani and liang 2012a liang and marche 2009 hou et al 2018 sætra et al 2015 vacondio et al 2017 which require proper grading of neighbors that is a 2 1 ratio furthermore the l 7 case allows for an even sharper transition across resolutions to describe this initial wet dry front the cores of the buildings are represented by coarse level 2 cells whereas the outer ring of the buildings and the streets require level 3 cells this is only necessary to capture the discontinuous topography described by the building note that the vertical walls of the buildings i e physical discontinuities in the z x y function are aligned with cell edges this means that the walls are exactly captured by the discontinuous representation of the bed across two cells the mesh has been designed in this way to avoid the vertical walls laying in the middle of a level 2 cell if that were the case the projection of the bed onto the dg space would result in a very steep slope this in itself is not problematic however two issues arise first this would trigger adaptivity to very high resolution arguably reducing mesh efficiency second and most importantly the inherent flaws in the reference dg swe scheme related to the wb pp strategy xing et al 2010 can generate spurious momentum waves in the presence of wet dry fronts on such steep slopes thereon these waves because of the lack of numerical viscosity of the dg3 scheme are not dampened and travel through the domain further triggering adaptivity this flaw of the reference scheme is therefore avoided by ensuring that the discontinuities do not generate steep slopes but instead are exactly captured by the discretisation this pragmatically eliminates the problem for the objectives of this paper but we do not pursue to solve the inherent flaws in the wb pp strategy of xing et al 2010 at t 2 s the shock wave has reached the side slopes of the channel remaining very sharp and with no diffusion appreciated moving wet dry fronts develop at the side slopes which are clearly observed in the highest mesh resolution observe how the kink in the bed where the side slope meets the flat flume bed requires level 5 cells although the wet dry front is now elsewhere interesting wake like structures are seen trailing the shock wave reflection from the side slopes for these structures the l 7 shows an even sharper resolution in the gate channel supercritical wave reflections are very well captured at t 3 s the dam break wave has reached the city a violent hydraulic jump develops upstream of the first set of buildings with a width of roughly half a building the structure of the depth field outside of the urban area is a clear progression from that one at t 2 s with highly resolved tracking of shocks wet dry fronts and reflections the mesh refinement patterns for both l values differ somewhat more than at previous times when the water flows into the streets refinement is triggered within them up to the highest level recall that for l 6 up to 16 cells can be included in the street and up to 32 for l 7 this adapted mesh allows to resolve very local flow structures such as secondary hydraulic jumps in the second line of buildings and diagonal supercritical reflections at t 4 s and afterwards the mwdg scheme shows its full capabilities in resolving very complex flow structures complex interactions inside the streets can be observed wakes and wave stem out of the vertices of buildings back into the surrounding flow two vortex like depressions develop within the hydraulic jump structure the l 7 shows considerably sharper structures at this stage interestingly in the l 6 case an asymmetric dry spot appears at x 8 triggering mesh refinement this is not the case for l 7 at t 5 s the wave has surpassed the urban area downstream of the buildings stagnant wakes and supercritical jets can be seen to develop the depressions at x 12 m are clearly seen and the supercritical reflections and very complex wave structure inside the streets is fully developed in terms of the adaptive mesh observe how the dry areas of the domain buildings and the reservoir blocks remain at their original resolution as well as the unperturbed regions at x 16 m with level 0 cells the region upstream from the hydraulic jump remains at level 1 l 6 or 2 l 7 by t 6 s the entire domain is affected by the dam break at t 7 s the l 6 adaptive mesh shows how the regions upstream from the hydraulic jump are again discretised by level 0 cells and the development of the hydraulic jump in the wake of the urban area for this time velocity and froude number is shown in fig 25 it is interesting to observe how the mesh tracks all transcritical shocks as well as supercritical reflections this is a natural consequence of including information of all conserved variables in the multiresolution analysis that is although the amr strategy does not receive froude number as information its behaviour is natively captured by the strategy suggesting that the underlying hydrodynamics are well treated by both the multiresolution analysis and the amr prodecure the velocity field shows complex recirculations and flow patterns inside the urban area and rotating vortices outside of it e g x 10 s the wake downstream of the urban area is clearly captured by the low x component of velocity as well as by the subcritical froude number finally t 10 s shows a chain of some rather interesting finely resolved depressions vortices of kelvin helmholz instabilities lingering in the backwater but this can be extended as an interesting behaviour overall in the hydrodynamic fields the fields throughout the simulation exhibit highly resolved very small flow structures and some particular fluid phenomena such as rotating vortices vortex shedding and kelvin helmholz instabilities these structures are only possible to resolve with the combination of spatial resolution with cells significantly smaller than the structure and a high order solver which ensures very low numerical viscosity and numerical dissipation note for example how some of the smallest vortices are not clear in the l 6 solution but are sharp in l 7 e g at t 6 s 8 x 12 m many of these structures are not observable and most likely not present in the physical experiment for example as previously highlighted in fig 17 b the simulations show a depression at t 5 s which is not present in the experimental data this gauge point b is just upstream of the buildings where travelling vortices pass near these simulated structures are responsible for the lower water depth in the experimental results it is likely that three dimensional turbulence which is obviously not solved for here associated to the hydraulic jump introduces additional dissipation and thus washes out these flow structures this is not an issue in lower resolution or lower order solvers since the numerical viscosity performs that role moreover this suggests that the mwdg3 swe scheme is capable of resolving turbulence scales which manifest as 2d turbulent structures but would require to include additional dissipation to account for the smaller unresolved turbulence effects similar phenomena and reasoning have been reported with other high order schemes on shallow flows navas montilla and murillo 2018 navas montilla et al 2019 the need for a turbulence model for this particular test case has been raised soares frazão and zech 2008 özgen et al 2015 although our results show that numerical viscosity of coarse low order solution may already mimic turbulent dissipation with increasing resolution numerical dissipation would be smaller and even more with increasing order of accuracy as in our case to assess the performance efficiency of the adaptive strategy fig 27 summarises the damr process throughout the simulations for both l 6 and l 7 cases fig 27 a shows clearly how the evolution of the number of computational cells for l 7 requires up to three times more cells than for l 6 the difference is initially smaller roughly twice as many cells but increases quickly during 2 t 5 s the l 6 case does not exhibit a large growth of cell numbers these cell counts represent a maximum of 7 l 6 and almost 5 l 7 of the cells contained in the highest resolution meshes as shown in fig 27 b it is interesting to observe that although the ratio of number of cells between both cases increases from 2 to 3 the percentages have a parallel behaviour suggesting that both cases are equally efficient in their use of fine resolution but that the choice of number of levels will affect the total number of cells and therefore computational time previously published solutions have been computed with anywhere between 14 000 to 193 774 cells typically with unstructured triangular meshes often with refinement around the urban area such meshes have cells of lengths roughly between 0 05 m and 0 005 m in comparison the smallest cells in our simulations are of length 0 00625 m for l 6 and 0 003125 m for l 7 that is on the fine side of previous solutions the maximum number of cells obtained in these simulations is larger than those of previous solutions but with significantly better tracking of shocks and flow structures especially outside of the urban which has often been not refined in fixed meshes 4 3 malpasset dam break the malpasset dam was located in south east france on the reyran river valley on december 2 1959 the 66 5 m high concrete arch failed allowing the sudden and violent outflow of the nearly full reservoir down the gorge and into the fréjus gulf the dam break wave traveled from the dam location to the mediterranean sea killing more than 430 people hervouet and petitjean 1999 this event is one of the few catastrophic concrete dam failures recorded in history it is of particular interest to hydraulic modelers since some field survey data is available useful to validate numerical results the fréjus police surveyed high water levels at 17 locations p1 p17 as shown in fig 28 together with the topography of the valley and the location of the dam black line additionally 3 electric transformers a b c were destroyed by the travelling wave an experimental 1 400 scale model was built and tested afterwards at the french laboratoire national d hydraulique in 1964 providing additional water elevation data at 14 locations of which we only include the nine probes s1 s9 downstream of the dam note that these probes are named s6 s14 in hervouet and petitjean 1999 this problem has been widely studied as a field scale benchmark test in hydraulic modelling literature solutions have been presented with a broad range of methods and it remains a popular test case for benchmarking an et al 2015 brodtkorb et al 2012 brufau et al 2004 duran et al 2013 george 2010 hervouet and petitjean 1999 hou et al 2013 kesserwani and liang 2012a kim et al 2014 liang et al 2007 sætra et al 2015 schwanenberg and harms 2004 smith and liang 2013 valiani et al 2002 xia et al 2011 wang et al 2011 zhou et al 2013 zhao et al 2019 some of these works have presented adaptive mesh solutions an et al 2015 george 2010 kesserwani and liang 2012a sætra et al 2015 numerical results have in general matched reasonably well the available field data this test is arguably not the most stringent challenge on current solvers it is less demanding on the numerical scheme than the previous test and there are arguably less scales involved than in the previous case it is nonetheless relevant since it is real scale field case with natural topography and a strongly hyperbolic flow the initial water level in the reservoir has been estimated at 100 m 0 5 m hervouet and petitjean 1999 and thus has been set to 100 m in the computations presented herein the gauckler manning coefficient was originally recommended in the range of 0 025 0 033 s m 1 3 hervouet and petitjean 1999 although 0 033 s m 1 3 has been argued to provide best results schwanenberg and harms 2004 and is ubiquitously used an et al 2015 brufau et al 2004 kesserwani and liang 2012a schwanenberg and harms 2004 valiani et al 2002 wang et al 2011 water elevation at the mediterranean sea is assumed to be zero boundary conditions are reflective since the open sea boundary has no effect on the dam break wave propagation the base data for topography is a set of 13541 points these points were bi linearly re sampled to a constant resolution of 5 m which represent just over two million points in the computational domain this 5 5 interpolation was then used as the surface topography which is then projected into the dg space this case was solved with a dg2 p 2 scheme with piecewise linear solutions the computational domain is within a rectangle discretised with a coarsest grid of 27 15 405 cells a maximum number of levels l 7 was used resulting in the finest grid of 3456 1920 6635520 cells cell sizes range from 640 424 m 271360 m2 to 5 3 m 15 m2 for comparison this case was also computed with a well established finite volume fv solver murillo and garcía navarro 2010 on a gpu implementation lacasta et al 2014 with several unstructured triangular meshes ranging from a very coarse mesh 80546 cells cell area range 254 1000 m 2 to a very fine one 1150556 cells cell area range 9 70 m 2 no amr was applied to these meshes thus generating a rather uniform cellsize distribution fig 29 shows the simulated results with the mwdg scheme and the fv solver compared against the reference data from field and scaled up experimental observations fig 30 shows the same results as fig 29 but geolocalised at the experimental gauge and field data locations fig 30 a shows that maximum water elevation at the experimental probes is somewhat overestimated for all but two probes and mostly in the range of 10 of the experimental data the numerical predictions also slightly overestimate field markers fig 30 b shows the arrival time ratio numerical arrival time divided by experimental arrival time the largest error is recorded at the experimental probe closest to the dam break arrival times recorder by transformers in the actual event are well reproduced with arrival times for b and c being slightly faster in the simulation experimental arrival times in the main channel are all overestimated by the numerical solution it is seen that the upper part and the lower part of the valley result in smaller underestimations but the central part is where largest deviations are recorded fig 31 shows the evolution of hydrodynamic fields depth velocity and froude number the corresponding adaptive meshes are shown in fig 32 the initial dam break wave can be seen at t 50 s propagating downstream at 35 m s 1 and with sharp transcritical shocks as the wave moves downstream the complex features of the topography manifest strongly in highly heterogeneous hydrodynamic fields and a multitude of transcritical moving shocks by t 500 s a large portion of the valley is flooded generating an extensive wet dry front by t 1000 s the wave reaches the end of the valley and starts spreading out both the depth and velocity fields allow to see the stream channel and how the flood extends outwards fig 32 shows the evolution of the adaptive mesh in terms of a color coded resolution level across all times it can be seen that large parts of the coastal plain and of the sea are meshed at very coarse resolution similarly the wet dry front at the coast is always refined to the highest resolution as is the domain boundary in the valley gorge where the boundary geometry is complex it is also clear that the gorge x 7000 m and the river itself require high resolution to accurately describe the topography reason for which at t 50 and t 100 s it is difficult to observe mesh adaptivity in response to hydrodynamics by t 100 s the flood wave can be appreciated in the refined wetting fronts and more clear at t 500 s at this time and after it it is interesting to note how the leading flood wave is highly refined at the wetting front comparing refinement to the flood extent in fig 31 but not in the interior of the flooded region where it is no more refined than as required by the topography it is necessary to highlight that the triangular structures seen in fig 32 show high refinement along such triangular patterns this is the response of the adaptive strategy to the interpolated topography that is because the topography has been interpolated between data points intersections of planes exist in the interpolated topography although such intersections are artifacts of the interpolation the adaptive strategy percieves this as a significant change in the slope of topography thus triggering adaptivity this results in a somewhat less efficient mesh this behaviour highlights the need of better topography data which nowadays is often more available in which such artifacts are avoided in terms of the adaptive performance the maximum number of cells was 659823 at t 2792 57 s with η 0 9 for comparison many non adaptive solutions have been reported using anywhere between 4100 cells with cell size of approximately 350 m valiani et al 2002 to around 1 8 million cells on 10 10 m discretisation smith and liang 2013 and the finest reported 5 5 cartesian mesh with 2 07 million cells kim et al 2014 with many solutions with intermediate numbers brufau et al 2004 duran et al 2013 liang et al 2007 xia et al 2011 wang et al 2011 all with similar accuracy it is worth noting that the coarsest resolution in our computations is roughly twice as coarse as the coarsest reported mesh while the finest resolution matches that of the finest reported solutions to achieve the same resolution we require roughly 31 of the cells required by kim et al 2014 adaptive results have also been reported for this case although comparative analysis is difficult due to lack of reported information in most cases george 2010 achieved very high resolution 3 2 3 2 m but in a nested block wise refinement that is highly inefficient an et al 2015 presented a damr solution spanning resolutions between 33 and 2125 m but little information on the amr performance was reported similarly sætra et al 2015 performed damr a simulation with little insight into the performance of the amr but pointing out that they adapt the mesh not on every time step but every 50 zhou et al 2013 performed a damr solution on a triangular mesh with an initial resolution of 75 m resulting in adaptive cell sizes in the range of 13 335 m finally kesserwani and liang 2012a presented several damr solution with the rkdg2 scheme with a coarsest resolution around 160 m and finest resolution up to 50 m with maximum number of cells in the order of 37000 65000 depending on the particular setup which translate into efficiencies compared to their finest grids of 0 85 η 0 92 relative to our finest resolution this means 26 η 46 showing how with the strategy used by kesserwani and liang 2012a achieving a 5 m resolution would require at least 26 times more cells than the mwdg in comparison to all these adaptive solutions the mwdg2 swe computation presented here achieves a maximum resolution comparable to that of george 2010 but is significantly more efficient as the highest resolution is only localised at wet dry fronts and shocks moreover the coarsest resolution in our simulation is only second to the coarsest cells in the simulations by an et al 2015 no other simulations span seven levels of refinement and most require a relatively fine base resolution coarsest level 5 conclusion in this paper a 2d multiresolution multiwavelet based adaptive discontinuous galerkin scheme originally proposed by gerhard et al 2015a has been tested against complex realistic and challenging 2d shallow water benchmarks the selected tests are well known widely used and challenging for a variety of reasons from the simulations reported here we conclude i the mwdg scheme can accurately solve complex 2d shallow water problems ii the simulation of shallow flows which typically require domains considerably larger than the smallest features of interest can greatly benefit from the multiresolution amr process embedded in the mwdg solver iii the numerical results give empirical evidence supporting the formal proofs presented by gerhard et al 2015a that the mwdg strategy transparently incorporates the features of the reference numerical scheme conservation c property well balancing positivity under the complex benchmark tests performed iv the combination of high order and high local refinement allows to observe small and sharp flow features otherwise unlikely possible to compute particular technical insights can also be highlighted i the mwdg amr strategy used here is not restricted by proper grading alternatively proper nesting in some literature of neighbor cells this results in very sharp and localised transitions from coarse to fine resolution the end result is a more efficiently refined mesh than other amr schemes ii the strategy allows to use very coarse cells in the lowest resolution level coarsest mesh this is in clear contrast to previously proposed amr strategies which require a fine enough initial mesh to guarantee accurate results iii the large number of resolution levels together with the freedom from proper grading and thanks to the consistent assessment of significant details allows damr which allow the coarsest and the finest levels to coexist in the adapted multiresolution mesh this feature is not present in other strategies iv the hyperbolic structure and flow regimes as signalled by the froude number are very well captured by the adaptive mesh transcritical regions which imply sharp changes in the hydrodynamic regimes become refined in the adaptive mesh although this is not strictly enforced by the strategy this is particularly helpful since the high local resolution ensures that the propagation of characteristic information goes in the right direction v the mwdg swe solver can be applied at ad hoc order of accuracy as chosen by the modeller results shown here have been computed with dg2 and dg3 linear and quadratic approximations contrary to other strategies relying on linear projections our formulation keeps the flexibility of the generic dg scheme opens up possibilities to hp adaptivity and also keeps open the possibility of exploiting parallelisation benefits of higher order schemes the mwdg swe scheme assimilates the desirable properties of the reference dg swe scheme but also inherits its deficiencies and limitations some of these deficiencies can become painfully obvious when performing mwdg swe adaptive computations i spurious momentum generated by the positivity preserving limiter of xing et al 2010 in the presence of wet dry fronts over steep topography can be captured and tracked by the multiresolution analysis as significant details these waves are thus interpreted as physically meaningful which require and trigger mesh adaptation these highly resolved yet spurious momentum waves do not decay quickly due to both the high resolution and the high order of the method which together strongly limit the dampening dissipative effects of numerical viscosity ii the reference rkdg swe scheme suffers from a high computational cost per cell and per time step which quickly increases with order of accuracy together with a reduction of the cfl number and its consequent increase on the number of time steps although higher order dg approximations allow for coarser and more efficient adaptive meshes than lower order this remains a strong limitation on applicability it is possible that through hp adaptivity it is possible to overcome this limitation nonetheless improved stability of the reference scheme is an open challenge which would also translate into the mwdg solution these limitations clearly call for improvements in the reference dg swe scheme and the numerical fluxes necessary to ensure the correct and desirable properties of the scheme from a positive point of view the advantage of mwdg swe is that once the issue is solved in the reference scheme it will be assimilated transparently into the adaptive mwdg swe scheme credit authorship contribution statement daniel caviedes voullième conceptualization methodology investigation validation writing original draft writing review editing nils gerhard conceptualization formal analysis investigation methodology software writing original draft writing review editing aleksey sikstel investigation validation siegfried müller conceptualization formal analysis methodology supervision writing original draft writing review editing declaration of competing interest the authors declare that they do not have any financial or nonfinancial conflict of interests 
511,the phenomenon of virtual water flows vwfs reveals the remote pressure on local water resources on one hand and provides the possibility of global water saving if vwfs from water rich places of higher water use efficiencies to water poor or lower water use efficiencies regions on the other hand a vwf is marked as efficient when at least half of the water footprint wf in producing the traded products is below the corresponding wf benchmark whereas the vwf is marked as sustainable when flowing from the places where the water consumption did not exceed local sustainable renewable water availability however most attention has been taken to the sustainability of vwfs ignoring their efficiency and spatial temporal variations here we taking inter provincial crop related vwfs of twenty major crops in the mainland china over 2004 2013 as a study case analysing the efficiency of vwfs and the sustainability of blue vwfs as well as their mutual relationship results show that over the study period although inter provincial crop related vwfs increased slightly by 2 the north to south vwfs and blue vwfs increased by 41 and 2 5 times respectively the weight of inefficient inter provincial vwfs reduced to 75 in 2013 from 94 in 2004 whereas the unsustainable blue vwfs increased by 8 trade offs between the efficiency and sustainability of vwfs existed in five provinces wheat rice maize and cotton were the main contributors to inefficient and unsustainable vwfs assessments in vwfs should account for local water resources conditions considering both efficiency and sustainability to determine hotspots and critical products and allow appropriate management of crop production and water allocation graphical abstract image graphical abstract keywords water footprint virtual water flow sustainability efficiency trade off 1 introduction water resources are vital basis for human survival and important material for food and energy production also essential for modern civilization liu et al 2016 postel et al 1996 qin et al 2019 zhang et al 2019 with socio economic developments and rapid population growth pressures on global water resources are rising with many countries facing water shortage stress liu et al 2017 2018 perrone and hornberger 2014 pastor et al 2019 two thirds of the global population face severe water scarcity at least one month in a year and half a billion people face severe blue water scarcity all year round mekonnen and hoekstra 2016 with the expansions in international and inter provincial trade in commodities the intensity of virtual water flows vwfs gradually increases redistributing water resources d odorico et al 2019 oki et al 2006 zhao et al 2015 the idea of the virtual water strategy allan 1993 1998 provide a new perspective for solving water resource problems rosa et al 2019 appropriate vwfs from water rich to water scarce regions can effectively alleviate stress on regional water resources chapagain et al 2006 dalin et al 2012 liu et al 2018 mekonnen and hoekstra 2010 on the contrary unreasonable vwfs from low water productive places to higher productive places or from water scarce places to water rich places can aggravate water scarcity in exporting areas feng et al 2014 kampman et al 2008 zhao et al 2018 the rationality of water resources allocation means environmental sustainability resource efficiency and social equity hoekstra 2014 in regard to crop production the unsustainable water consumption refers to the unsustainable irrigation i e unsustainable blue water footprints wf irrigation practices are classified as unsustainable when their water consumption exceeds local renewable water availability and irrigation depletes groundwater stocks or environmental flows rosa et al 2018 the inefficient water consumption in crop production means the water footprint per unit mass of a crop exceeds the local benchmark level hoekstra 2014 therefore a sustainable crop related blue vwf is happened if the blue wfs in producing the traded crops is sustainable hoekstra and mekonnen 2016 rosa et al 2019 whereas an efficient crop related vwf is defined as that at least half of the wfs in crop production in the exporting regions is below the corresponding wf benchmark levels hoekstra and mekonnen 2016 the evaluation on sustainability of vwfs have been focused by considerable researches e g brindha 2017 cai et al 2019 liu et al 2019 wang et al 2020 zhao et al 2020 it has two quantitative methods at present pfister et al 2009 proposed a water stress index wsi that qualifies the sustainability of water resources by combining water resources utilisation with environmental impact the wsi ranges from 0 to 1 indicating the portion of consumptive water use that deprives other users of freshwater pfister et al 2009 proved the applicability of this method using the global cotton production life cycle assessment as an example and demonstrated that the impact of water resources utilisation varies regionally hoekstra et al 2011 2012 proposed the blue water scarcity bws evaluation method which comprises the ratio of total blue water footprint to total blue water availability they analysed the bws of 405 watersheds worldwide from 1996 to 2005 and found that 2 67 billion people in 201 basins faced serious water scarcity for at least one month in a year hoekstra et al 2012 however few studies have focused on the efficiency of vwfs which refers to that the vwf is efficient when at least half of the water footprint wf of crop production within the exporting areas is below the corresponding crop wf benchmark hoekstra and mekonnen 2016 hoekstra and mekonnen 2016 conducted the only exist study on evaluating the efficiency and sustainability of british international vwfs in source countries by introducing the approach using the wf benchmark and bws index respectively the wf benchmark referring to a target for wf reduction can be used to assess water resources consumption and vwf efficiency hoekstra 2013 2014 they found that about half of the global consumptive wf of the uk s direct and indirect crop consumption is inefficient inefficient and unsustainable vwfs exist in source countries including pakistan iran and spain hoekstra and mekonnen 2016 vwfs have regional scale effects however there is currently no research yet focusing on both the efficiency and sustainability in intra national vwfs which is crucial for determining hotspots and critical crops and improving allocation of regional water resources in this study we aim to taking inter provincial crop related vwfs within the mainland china over 2004 2013 as a study case analysing the efficiency of vwfs and the sustainability of blue vwfs as well as their mutual relationship and exploring the impact of intra national vwfs on water resources selecting twenty main crops as listed in table 1 that cover 92 of the country s total harvest area nbsc 2019 we determined crop wf benchmarks in arid and humid zones based on grid level crop wf accounting and then quantified inter provincial crop related vwfs combined with annual inter provincial crop related trade flows we assessed the efficiency of inter provincial crop related vwfs by comparing annual wf of crop production in each province with crop wf benchmarks and evaluated the sustainability of blue vwfs through bws to identify hotspots and critical crops following the approaches in hoekstra and mekonnen 2016 the current study chose the inter provincial crop related vwfs in mainland china as the case for the following reasons china is a large agricultural country agriculture accounts for more than 60 of total water withdrawal in 2013 kang et al 2016 ministry of water resources prc 2019 inter provincial crop related vwfs have always existed and are expanding in scale since 1990 agricultural the north to the south water diversion virtual engineering has occurred the annual transfer of vw is much larger than the current transfer scale of the the south the north water transfer project dalin et al 2014 wu et al 2010 zhao et al 2015 zhuo et al 2016a secondly inter provincial crop related vwfs of mainland china go against the vw strategy allan 2002 exacerbating internal water resources problems many studies have considered the sustainability of inter provincial vwfs in china e g feng et al 2014 zhuo et al 2016a zhao et al 2018 dalin et al 2014 analysed the international and inter provincial vw trade network of four main crops corn rice soy and wheat and three livestock products ruminants pork and poultry in china in 2005 and found that vwfs in china is from dry heavily irrigated provinces to humid regions zhao et al 2015 quantified chinese physical water transfer vw transfer and water stress in each province vwfs accounted for more than a third of the country s water supply in 2007 flowing from underdeveloped less populated western regions to richer more densely populated eastern coastal regions increasing water pressure in exporting provinces wang et al 2014 calculated the grain related vwfs amongst provinces of china in 2010 and found that grain related vw usually flows from water deficient areas to water rich areas and from areas with high grain production efficiency to areas with low efficiency feng et al 2014 combined wsi with an indicator for ecosystem damage to evaluate the sustainability of vwfs of 30 provinces in mainland china and found that consumption of coastal developed provinces relies heavily on water resources from the northern water poor provinces e g xinjiang hebei inner mongolia water stress was aggravated in exporting areas where large exports of vw wf can be an effective policy tool to alleviate water shortage only combined with water scarcity zhao et al 2018 used the wsi combined with multi regional input output tables to assess scarce water saving loss through inter provincial trade within china and found that xinjiang was the largest net virtual scarce water exporter taking regional water scarcity and water productivity into account to identify key connections of scarce water saving can help alleviate water stress these studies have shown that inter provincial vwfs in china are not sustainable however the efficiency of inter provincial crop related vwfs in china has not yet been studied and there is no analysis of spatial temporal evolution of the sustainability and efficiency bennett et al 2009 introduced the word trade off which refers to the situations in which one service increases and another one decreases in describing the relationships opposite to synergy amongst ecosystem services similarly the trade off between efficiency and sustainability of a vwf refers to situations in which the vwf is sustainable while inefficient or is unsustainable while efficient research on the trade offs between efficiency and sustainability of vwfs is also relatively limited the main originalities of the current study are taking case for china i estimate both efficiency and sustainability of crop related vwfs at intra national level considering annual variations for the first time and ii further look at the existing trade offs between the efficiency and sustainability of the vwfs 2 method and data 2 1 estimating virtual water flows inter provincial crop vwfs are determined by crop trade flows and wf per unit of a crop in exporting areas eq 1 within a country the gross inter provincial vwfs equals to the total inter provincial vw exports which also equals to the total inter provincial vw imports 1 v w i j p t i j p w f i p where the vw i j p m³ y 1 represents the vwfs of crop p from province i to province j in the corresponding year t i j p t y 1 represents trade flow of crop p from province i wf i p m³ y 1 is the wf per unit of p in province i based on the blue and green wfs m³ y 1 of crop production in 2008 blue and green wfs m³ y 1 of crop production from 2009 to 2013 were obtained using fast track method tuninetti et al 2017 fast track is a fast method based on the principle that the wf per unit of a crop exhibits a negative linear correlation with unit yield it uses the wf of crop production in a specific year to calculate multi year wf of crop production expressed by the following formula eq 2 2 u w f t u w f t y t y t where uwf t and uwf t m³ t 1 are the wf per unit of a crop in years t and t respectively and y t t ha 1 and y t t ha 1 are the yield in a unit area of the crop in years t and t tuninetti et al 2017 verified that the error of this method falls within 10 through global scale uncertainty analysis with its low computational cost and its easy and fast applicability tuninetti et al 2017 this method has been widely applied e g cazcarro et al 2015 dalin et al 2012 duarte et al 2016 wu et al 2019 due to the data of crop trade flows is generally derived from faostat database fao 2019 at national level liu et al 2018 there is no available data on intra national scale in china the trade flows are estimated based on the net balance of regional trade generally accepted methods include the input output method zhao et al 2018 proximity principle method zhuo et al 2016a estimated based on supply and demand wang et al 2014 and minimum transportation cost method dalin et al 2014 in this study minimum transportation cost which are widely accepted and used in published researches e g dalin et al 2014 wu et al 2019 zhuo et al 2019 was adopted to quantify the vwf based on the annual balance of supply and demand of production of each crop in each province and considering crop trade flows between international and domestic provinces the lowest transportation cost is taken as the constraint and the corresponding inter provincial crop trade flows t y 1 obtained by linear programming zhuo et al 2019 minimize 3 t c p i 1 j 1 h 1 i 31 j 31 h 4 t int i h p c i h t int h j p c h j i 1 j 1 i 31 j 31 t l o c i j p c i j subject to i j 1 31 and h 1 4 4 i 1 j 1 i 31 j 31 t l o c i j p i 1 h 1 i 31 h 4 t int i h p p i p d i p if p i p d i p j 1 i 1 j 31 i 31 i j p j 1 h 1 j 31 h 4 t int h j p d j p p j p if p j p d j p i 1 h 1 i 31 h 4 t int i h p e int p h 1 j 1 h 4 j 31 t int h j p i int p t l o c i j p 0 t int i h p 0 t int h j p 0 in which tc p in cny y 1 refers to the total transport cost of the inter provincial trade in product p tint i h p the foreign export volume from province i through harbour province h tint h j p t y 1 the foreign import volume through harbour province h to province j tloc i j p t y 1 the net trade of product p from province i to province j c i h c h j and c i j cny t 1 the unit costs of transport between provinces p i p t y 1 the production of p in province i d i p t y 1 the total demand of product p in province i eint p china s total international export of product p and iint p t y 1 china s total international import of product p 2 2 assessment of virtual water flow efficiency the wf benchmark can be used as a reference and target for farmers when the actual wf of production is higher than the standard hoekstra 2014 the total wf m3 y 1 in crop production within a region is considered to be efficient when at least half of the wf is for crops whose unit wfs m3 t 1 are below the corresponding crop wf benchmarks hoekstra and mekonnen 2016 the arid index ai is defined as the ratio of precipitation to reference evapotranspiration middleton and thomas 1992 1997 the whole country was divided into arid and humid zones see si when ai 0 5 and ai 0 5 zhuo et al 2016b following mekonnen and hoekstra 2014 the wf benchmark was calculated separately for arid and humid zones zhuo et al 2016b according to the total wf of production m³ y 1 and the yield kg ha 1 of each crop from 2004 to 2013 in a grid cell the wf per unit m³ t 1 of each grid cell was obtained the annual production wf of the 25 of producers with the highest water productivity in the country was set as the annual wf benchmark for the crop and these values were averaged across 10 years to provide a wf benchmark for the study period 2 3 assessment of blue virtual water flow sustainability following hoekstra and mekonnen 2016 the blue vw exports of each province were obtained from inter provincial crop trade flows and the blue wf of crop production in each province and then the sustainability of blue vwfs was evaluated in traditional water scarcity evaluation indices environmental flow and the return flow of water are not considered bws addresses this issue hoekstra et al 2012 the monthly bws is calculated as the ratio of the total blue wf consumption m3 month 1 to the total blue water availability m3 month 1 total blue water availability m3 month 1 equals the sum of runoff generated minus the environmental flow requirements efr hoekstra et al 2012 mekonnen and hoekstra 2016 the efr is considered account for 80 of the natural runoff richter et al 2012 bws is called low when bws 1 blue water in the region is considered sustainable moderate when 1 bws 1 5 and significant when 1 5 bws 2 when bws 2 it is called severe blue water shows severe scarcity hoekstra et al 2012 mekonnen and hoekstra 2016 the blue wf located in places of low bws is treated as sustainable mekonnen and hoekstra 2016 in this study the ratio of sustainable to unsustainable blue vwfs related to a crop from a province equals to the ratio of sustainable to unstainable total blue wfs in the crop in the exporting province 2 4 data the blue wf m³ y 1 and green wf m³ y 1 of crop production and crop yield kg ha 1 in grid cells in mainland china from 2004 to 2008 were obtained from zhuo et al 2016a statistical population data crop yield harvest area and crop production of all provinces from 2004 to 2013 were taken from the national bureau of statistics of china nbsc 2019 for fast tracking the crop wfs for 2009 2013 we made use of the relative changes in annual crop yield at provincial levels to the grid level crop yield data in the reference year from zhuo et al 2016a annual international trade data for each crop were obtained from fao 2019 data for vegetable were used in place of cabbage because the food balance sheets and commodity balances crops primary equivalent in faostat data do not include cabbage the multi year average precipitation and reference evapotranspiration for 1961 2008 were measured by cru ts 3 24 dataset and used to identify arid and humid zones ceda 2018 harris et al 2014 when evaluating the sustainability of crop related blue vwf global bws data at 30 30 arc minute resolution was acquired from mekonnen and hoekstra 2016 re sampled at 5 5 arc minute resolution for the current analysis and transferred from a raster to points to obtain bws in mainland china 3 results 3 1 spatial temporal variability of inter provincial crop related virtual water flows fig 1 depicts the trend in crop related gross vwfs in mainland china from 2004 to 2013 gross vwfs increased by 1 9 from 269 gm³ y 1 in 2004 to 274 gm³ y 1 in 2013 amongst the 20 crops the vwfs of rice wheat and maize account for a relatively large proportion of gross vwf on average 24 24 and 18 respectively fig 2 the national trade flows of the 20 crops increased by 30 from 400 mt y 1 in 2004 to 520 mt y 1 in 2013 while the wf of cabbage barley and rice decreased gross vwfs remained constant from 2004 to 2013 for example the wf of cabbage decreased by 28 in guangdong province wf of barley in inner mongolia decreased by 66 and wf of rice in jiangsu province decreased by 14 green and blue vwfs show the same trends as gross vwf blue vwfs increased by 2 from 51 gm³ y 1 in 2004 to 52 gm³ y 1 in 2013 accounting for 20 of gross vwfs on average green vwfs increased from 219 gm³ y 1 in 2004 to 223 gm³ y 1 in 2013 an increase of 2 accounting for 80 of gross vwfs on average the amplitude of change in all vwfs is relatively low over the decade studied fig 1 fig 3 a depicts the spatial variability of crop related net gross vw export in china in 2004 and 2013 positive values indicate that vwfs is a net export and negative values indicate that it is a net import the net export of gross vw of crops in the period 2004 2013 was north to south water transfer and the import and export situation of most provinces remained unchanged in 2013 net gross vw exports in the north increased by 41 compared with that in 2004 three provinces changed significantly shanxi and guangxi changed from net import to net export and gansu changed from net export to net import fig 3 b depicts the spatial change in the net blue vwfs export of crops in china in 2004 and 2013 the flow direction of net blue vw export is still north to south water transfer in comparison with that in 2004 the net export of blue vw in northern china increased by 2 5 times in 2013 mainly because blue vw export in xinjiang heilongjiang and shandong increased by 47 42 and 22 respectively it was also led by increases in the export of cotton from xinjiang rice from heilongjiang and wheat from shandong ningxia changed from net export of blue vw to net import while shandong and heilongjiang changed from net import to net export during the study period 3 2 efficiency of inter provincial crop related virtual water flows fig 4 shows the evolution over time of inter provincial crop related inefficient vwfs in china inefficiency decreased from 223 gm³ y 1 in 2004 accounting for 94 of gross vwf to 205 gm³ y 11 in 2013 accounting for 75 of gross vwf during the decade rice wheat and maize accounted for the largest share of inefficient vwfs averaging 25 22 and 16 respectively henan heilongjiang hunan and hebei have the largest proportion of inefficient vwfs respectively accounting for 13 12 8 and 8 on average in 2004 the export of inefficient vw was highest in henan up to 30 gm³ y 1 followed by heilongjiang and hebei accounting for 12 9 and 8 of gross inefficient vwfs respectively in 2013 heilongjiang exported the most inefficient vw up to 31 gm³ y 1 followed by henan and hunan accounting for 15 13 and 9 of gross inefficient vwfs respectively inefficient vwfs in hebei are mainly caused by wheat maize and cabbage in heilongjiang by soybean maize and rice in henan by wheat peanut and barley and in hunan by rice at the intra national scale crop related inefficient vwfs gradually decrease over time mainly due to gradual improvements in the water efficiency of each crop beijing tianjin shanghai and tibet had almost no exports while vw exports in eight provinces chongqing guangxi heilongjiang hubei hunan qinghai shanxi and zhejiang are almost always inefficient shandong sichuan and anhui always had efficient vws exports while other provinces have efficient vwfs in certain years see si in 2004 the exports of crop related vws in most provinces were inefficient only the vw exports of wheat in shandong and rice in anhui and sichuan were efficient subsequently crops with improved production efficiency gradually increased by 2013 inefficient vwfs had decreased the most in jilin shandong and jiangsu accounting for 98 80 and 36 of gross vwfs in these provinces respectively fig 5 china s central state council issued the national file no 1 named several opinions on strengthening agricultural infrastructure to further promote agricultural development and farmers income in 2008 the national file proposed to develop water saving irrigation continue to take the water saving transformation in large scale irrigation districts and achieve the goal of completing water saving reconstruction tasks by 2020 ministry of agriculture prc 2019 since 2009 state investment in water conservation has grown linearly liu et al 2012 many provinces have made great efforts to build water conservation projects improving supporting measures and water saving irrigation technology in irrigation districts which can gradually improve crop water efficiency and reduce inefficient vwfs 3 3 sustainability of virtual water flows in exporting provinces fig 6 illustrates the evolution over time of crop related blue vwfs and unsustainable blue vwfs from 2004 to 2013 unsustainable blue vwfs increased by 8 from 40 gm³ y 1 in 2004 to 43 gm³ y 1 in 2013 accounting for an increasing weight from 78 to 83 in gross blue vw wheat rice and cotton account for the largest proportion of unsustainable blue vwf respectively accounting for 37 32 and 15 fig 7 shows the scarcity of water resources in major crop growing areas in china and the proportion of crops in the major provinces exporting unsustainable blue vws during the study period there is a severe scarcity of blue water in the north and the northwest china while low scarcity of blue water exists in other areas from 2004 to 2013 all provinces had unsustainable blue vw exports amongst which xinjiang hebei and shandong had the greatest with average annual exports of 9 2 gm³ y 1 6 1 gm³ y 1 and 6 1 gm³ y 1 respectively although xinjiang hebei and shandong had extremely scarce water resources exports of unsustainable blue vws had increased which exacerbated water stress from 2004 to 2013 unsustainable blue vw exported from xinjiang had increased by 47 flowing mostly to sichuan guangdong and qinghai and mainly consumed by cotton wheat and barley which respectively account for 65 23 and 8 of unsustainable blue vw in 2013 compared with 2004 the ratio of barley increased in 2013 exports of unsustainable blue vw from hebei increased by 0 14 where wheat maize and cabbage were the main contributors accounting for 65 25 and 7 of provincial unsustainable blue vw in 2013 unsustainable blue vw from hebei mainly flowed to heilongjiang liaoning and sichuan compared to 2004 the ratio of maize increased in 2013 exports of unsustainable blue vw from shandong increased by 21 mainly caused by wheat maize and cabbage that account for 79 14 and 4 of unsustainable blue vw mainly flowing to zhejiang hunan and yunnan unsustainable blue vws mainly flowed from water poor areas to areas with relatively abundant water resources and the flow showed an upward trend aggravating water scarcity in exporting areas 3 4 discussion this study represents for the first time the spatial temporal variabilities in efficiency and sustainability of crop related vwfs on an intra national scale results indicate that provinces xinjiang shandong hebei and henan have become hotspots due to their large vw exports and scarcity of water resources a trade off between efficiency and sustainability of crop related vwfs exists in provinces hunan heilongjiang hubei zhejiang and guangxi where water resources are relatively abundant but water utilisation is excessive and crop water efficiency is low from a geographical viewpoint regions with greater total wf and overexploitation of water resources are the most vulnerable places in the system however from the perspective of production regions with low water productivity and high wf of unit production are the weak links of the production system hoekstra 2013 after improving water use efficiency in many provinces the water savings were used to expand production offsetting savings made and leading to additional consumption resulting in a rebound effect grafton et al 2018 hoekstra 2013 sorrell et al 2009 general water conservation recommendations have focused on improving crop productivity and water efficiency researches taking local water resources condition into account are limited feng et al 2014 hoekstra and mekonnen 2016 zhao et al 2018 selecting appropriate crops and excellent crop varieties adopting reasonable irrigation measures and strengthening water management levels are recommended to reduce the wf of production and water consumption meanwhile reducing the wf of production to improve the water efficiency a wf cap should be set to avoid the rebound effect previous studies have quantified inter provincial vwfs in china based on different models and methods and found that vws usually flow from water scarce areas to water rich areas which is not sustainable e g zhao et al 2018 feng et al 2014 in the study period crop related blue vw was basically unchanged however unsustainable blue vw increased mainly due to increasing consumption of wheat and cotton wheat is mainly cultivated in shandong hebei henan jiangsu and anhui where water resources are very scarce although crop water efficiency had gradually increased exports had also increased by 41 over ten years leading to an increase in unsustainable blue vw of 9 aggravating local water scarcity cotton cultivation is widespread in xinjiang has low crop water efficiency and exports are increasing 6 6 gm³ y 1 unsustainable blue vw was consumed by cotton annually accounting for 73 of total export of unsustainable blue vw from xinjiang the blue wf of cotton in xinjiang was 1844 m³ t 1 and the export is 2952 kt y 1 in 2004 while blue wf reduced to 1011 m³ t 1 and exports increased to 6804 kt y 1 in 2013 leading to unsustainable blue vw exports increasing by 1 43 gm³ y 1 or 26 over the decade cotton consumption of unsustainable blue vw accounted for 99 3 rice is mainly cultivated in jiangxi jiangsu hunan and hubei where water resources are relatively abundant but unevenly distributed also exports from hunan and hubei were almost always inefficient leading to high consumption of unsustainable blue vw although unsustainable blue vw export of rice fell by 3 over the ten years the total was still as high as 13 7 gm³ y 1 in 2013 wheat rice and maize were the main contributors to inefficient vwfs heilongjiang hebei henan and hunan had the highest values for inefficient vwfs export in addition to beijing tianjin shanghai and tibet which had negligible exports 18 provinces shandong sichuan anhui shaanxi ningxia inner mongolia guangdong hebei liaoning jilin henan jiangsu fujian gansu yunnan guizhou jiangxi xinjiang improved water efficiency in 2013 leading to a reduction in inefficient vwfs most water poor provinces located in arid and semi arid regions e g shandong hebei and henan had more efficient crops being produced gradually however water rich provinces e g hunan heilongjiang were improving in efficiency more slowly mainly because rich water resources and unlimited water use did not motivate improvements in water efficiency the current results show that majority of crop related vw exports from eight provinces were always inefficient even though the crop yield increased and per unit crop wf decreased in most of the provinces for instance the biggest contributor in inefficient vw exports of zhejiang province was rice the unit wf of rice reduced by 11 over the study period but still 3 3 times higher than the corresponding wf benchmark level the phenomena indicate that there were still gaps for water saving water efficiency improving at crop fields or crop yield enhancement towards the corresponding crop wf benchmarks in these regions china plays a big role in global unsustainable crop water consumption as well as global unsustainable crop related vw trades rosa et al 2019 based on the recent global estimations by rosa et al 2019 china currently contributes 16 91 gm3 y 1 of global unsustainable irrigation consumption in global vw network china is the biggest unsustainable vw importer 19 of global total while decreasing its unsustainable vw exports by 38 over 2000 2015 to other countries moreover the current results reveal that the country redistributes almost half of its unsustainable irrigation consumption intra nationally amongst provinces and the amount is increasing it shows that with big and growing population changing consumption patterns and increasing crop demands china had ate one of the largest amounts of unsustainable water consumption through crop production and trade china should be on the alert for its role in enhancing the unsustainability of water consumed at fields not only by reducing the water stress at its own irrigated lands but also modify the international trades or optimize consumption patterns towards less crop demand of intense unsustainable wfs the efficiency of crop related vwfs was evaluated based on the crop wf benchmarks we adopted the method proposed by mekonnen and hoekstra 2014 which was also applied in zhuo et al 2016b and wang et al 2019 twenty crop benchmarks in arid and humid zones are shown in table 1 compared with the global crop wf benchmarks calculated by mekonnen and hoekstra 2014 all crops have lower benchmarks than global levels except maize potato sweet potato rapeseed sugar beet grape and tea this is mainly because the current study is based at the intra national scale while mekonnen and hoekstra 2014 is at a national scale with no climatic distinction due to different study periods the more recent period indicates higher crop yield leading to lower wf and wf benchmarks fast track method is a fast method to obtain the wf of the crop from the point of view of temporal variability it verified the wf of crop production mainly driven by yield variations and the standard deviation of the error by comparing to the wf assessment manual method was around 0 1 at global scale tuninetti et al 2017 to estimate the uncertainties or probable errors through fast track method for china s case we compared the fast tracked crop wfs over 2004 2007 using 2008 as reference year to the estimated crop wfs by zhuo et al 2016a at provincial levels which were used in the current study for the first few years till 2008 the differences in the unit total green blue wfs per crop were within the range of 20 fig 8 which is acceptable the currently study shows the capability of the fast track method at intra national analysis zhuo et al 2016b calculated that the wf of winter wheat from 1961 to 2008 in the arid and humid zones was 1224 125 m³ t 1 and 841 66 m³ t 1 respectively which is higher than values obtained in this study also we found that the wf was higher in the humid than arid zones as similar phenomenon shown in wang et al 2019 because we also considered spring wheat which is mostly cultivated in humid areas environmental sustainability social equity and resource efficiency are the three pillars for rational allocation and sustainable utilisation of water resources hoekstra 2014 this paper presents the sustainability of blue wf through bws which is only one aspect of environmental sustainability evaluation to comprehensively evaluate the sustainability of water resources multiple evaluations should be conducted of green wf sustainability grey wf sustainability social sustainability and economic sustainability hoekstra 2011 likewise the rational allocation of water resources from the perspective of water resources only has some limitations many other key aspects should be considered because water resources utilisation is comprehensively affected by economic social ecological and other factors in fact production in a specific region may be used for export and the rest for provincial consumption however such data cannot be obtained so that the efficiency of vwfs in each province was evaluated with the wfs of crop production at a grid cell resolution in this study 4 conclusion in the current study the spatial and temporal variations in efficiency and sustainability of crop related inter provincial vwfs in china over 2004 2013 were evaluated during the decade study period net vwfs from the north to the south increased by 41 and net blue vwfs from the north to the south increased by 2 5 times although the gross vwfs across provinces slightly increased by 2 inter provincial crop related inefficient vwfs accounted for 94 of gross vwfs in 2004 reducing to 75 in 2013 wheat rice and maize were the main contributors henan hebei heilongjiang and hunan were the most inefficient vwfs export regions eighteen provinces had efficient vwfs by 2013 wheat rice and cotton were the main contributors to unsustainable blue vwfs xinjiang hebei and shandong were the largest export areas of unsustainable blue vwfs and flows show an upward trend as a result the above mentioned areas have been designated as hotspots and critical crops have been determined xinjiang shandong hebei and henan are key crop cultivation areas and show extreme scarcity in water resources high exports lead to a rise in unsustainable blue vw consumption exacerbating local water scarcity and making water consumption unsustainable in heilongjiang and hunan a lot of water is wasted because of inefficient production and water abundance which leads to unlimited water utilisation and failure to consider crop water efficiency improvements apparently assessment of vwfs should be combined with local water resources conditions considering both efficiency and sustainability to determine hotspots and critical products according to the current results we suggest that at the intra national level each province should make efforts on seeking the highly efficient production structures to sustainably use the limited water resources optimizing the production structure and reducing exports from water scarce areas can optimize vwfs simultaneously promoting the production of crops adapted to the local climate and making efficient use of local green water resources can reduce the need for irrigation credit authorship contribution statement jie gao conceptualization writing review editing supervision la zhuo software methodology validation formal analysis writing original draft yilin liu visualization data curation pengxuan xie visualization data curation wei wang visualization data curation meng li visualization data curation xuerui gao writing review editing pute wu supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work falls under the umbrella of the panta rhei research initiative of the international association of hydrological sciences iahs this work was financially supported by the national natural science foundation of china grants 51809215 shaanxi natural science foundation grants 2018jq4020 the technology foundation for selected overseas chinese scholars in shaanxi province 2017034 and the fundamental research funds for the central universities 2452017181 
511,the phenomenon of virtual water flows vwfs reveals the remote pressure on local water resources on one hand and provides the possibility of global water saving if vwfs from water rich places of higher water use efficiencies to water poor or lower water use efficiencies regions on the other hand a vwf is marked as efficient when at least half of the water footprint wf in producing the traded products is below the corresponding wf benchmark whereas the vwf is marked as sustainable when flowing from the places where the water consumption did not exceed local sustainable renewable water availability however most attention has been taken to the sustainability of vwfs ignoring their efficiency and spatial temporal variations here we taking inter provincial crop related vwfs of twenty major crops in the mainland china over 2004 2013 as a study case analysing the efficiency of vwfs and the sustainability of blue vwfs as well as their mutual relationship results show that over the study period although inter provincial crop related vwfs increased slightly by 2 the north to south vwfs and blue vwfs increased by 41 and 2 5 times respectively the weight of inefficient inter provincial vwfs reduced to 75 in 2013 from 94 in 2004 whereas the unsustainable blue vwfs increased by 8 trade offs between the efficiency and sustainability of vwfs existed in five provinces wheat rice maize and cotton were the main contributors to inefficient and unsustainable vwfs assessments in vwfs should account for local water resources conditions considering both efficiency and sustainability to determine hotspots and critical products and allow appropriate management of crop production and water allocation graphical abstract image graphical abstract keywords water footprint virtual water flow sustainability efficiency trade off 1 introduction water resources are vital basis for human survival and important material for food and energy production also essential for modern civilization liu et al 2016 postel et al 1996 qin et al 2019 zhang et al 2019 with socio economic developments and rapid population growth pressures on global water resources are rising with many countries facing water shortage stress liu et al 2017 2018 perrone and hornberger 2014 pastor et al 2019 two thirds of the global population face severe water scarcity at least one month in a year and half a billion people face severe blue water scarcity all year round mekonnen and hoekstra 2016 with the expansions in international and inter provincial trade in commodities the intensity of virtual water flows vwfs gradually increases redistributing water resources d odorico et al 2019 oki et al 2006 zhao et al 2015 the idea of the virtual water strategy allan 1993 1998 provide a new perspective for solving water resource problems rosa et al 2019 appropriate vwfs from water rich to water scarce regions can effectively alleviate stress on regional water resources chapagain et al 2006 dalin et al 2012 liu et al 2018 mekonnen and hoekstra 2010 on the contrary unreasonable vwfs from low water productive places to higher productive places or from water scarce places to water rich places can aggravate water scarcity in exporting areas feng et al 2014 kampman et al 2008 zhao et al 2018 the rationality of water resources allocation means environmental sustainability resource efficiency and social equity hoekstra 2014 in regard to crop production the unsustainable water consumption refers to the unsustainable irrigation i e unsustainable blue water footprints wf irrigation practices are classified as unsustainable when their water consumption exceeds local renewable water availability and irrigation depletes groundwater stocks or environmental flows rosa et al 2018 the inefficient water consumption in crop production means the water footprint per unit mass of a crop exceeds the local benchmark level hoekstra 2014 therefore a sustainable crop related blue vwf is happened if the blue wfs in producing the traded crops is sustainable hoekstra and mekonnen 2016 rosa et al 2019 whereas an efficient crop related vwf is defined as that at least half of the wfs in crop production in the exporting regions is below the corresponding wf benchmark levels hoekstra and mekonnen 2016 the evaluation on sustainability of vwfs have been focused by considerable researches e g brindha 2017 cai et al 2019 liu et al 2019 wang et al 2020 zhao et al 2020 it has two quantitative methods at present pfister et al 2009 proposed a water stress index wsi that qualifies the sustainability of water resources by combining water resources utilisation with environmental impact the wsi ranges from 0 to 1 indicating the portion of consumptive water use that deprives other users of freshwater pfister et al 2009 proved the applicability of this method using the global cotton production life cycle assessment as an example and demonstrated that the impact of water resources utilisation varies regionally hoekstra et al 2011 2012 proposed the blue water scarcity bws evaluation method which comprises the ratio of total blue water footprint to total blue water availability they analysed the bws of 405 watersheds worldwide from 1996 to 2005 and found that 2 67 billion people in 201 basins faced serious water scarcity for at least one month in a year hoekstra et al 2012 however few studies have focused on the efficiency of vwfs which refers to that the vwf is efficient when at least half of the water footprint wf of crop production within the exporting areas is below the corresponding crop wf benchmark hoekstra and mekonnen 2016 hoekstra and mekonnen 2016 conducted the only exist study on evaluating the efficiency and sustainability of british international vwfs in source countries by introducing the approach using the wf benchmark and bws index respectively the wf benchmark referring to a target for wf reduction can be used to assess water resources consumption and vwf efficiency hoekstra 2013 2014 they found that about half of the global consumptive wf of the uk s direct and indirect crop consumption is inefficient inefficient and unsustainable vwfs exist in source countries including pakistan iran and spain hoekstra and mekonnen 2016 vwfs have regional scale effects however there is currently no research yet focusing on both the efficiency and sustainability in intra national vwfs which is crucial for determining hotspots and critical crops and improving allocation of regional water resources in this study we aim to taking inter provincial crop related vwfs within the mainland china over 2004 2013 as a study case analysing the efficiency of vwfs and the sustainability of blue vwfs as well as their mutual relationship and exploring the impact of intra national vwfs on water resources selecting twenty main crops as listed in table 1 that cover 92 of the country s total harvest area nbsc 2019 we determined crop wf benchmarks in arid and humid zones based on grid level crop wf accounting and then quantified inter provincial crop related vwfs combined with annual inter provincial crop related trade flows we assessed the efficiency of inter provincial crop related vwfs by comparing annual wf of crop production in each province with crop wf benchmarks and evaluated the sustainability of blue vwfs through bws to identify hotspots and critical crops following the approaches in hoekstra and mekonnen 2016 the current study chose the inter provincial crop related vwfs in mainland china as the case for the following reasons china is a large agricultural country agriculture accounts for more than 60 of total water withdrawal in 2013 kang et al 2016 ministry of water resources prc 2019 inter provincial crop related vwfs have always existed and are expanding in scale since 1990 agricultural the north to the south water diversion virtual engineering has occurred the annual transfer of vw is much larger than the current transfer scale of the the south the north water transfer project dalin et al 2014 wu et al 2010 zhao et al 2015 zhuo et al 2016a secondly inter provincial crop related vwfs of mainland china go against the vw strategy allan 2002 exacerbating internal water resources problems many studies have considered the sustainability of inter provincial vwfs in china e g feng et al 2014 zhuo et al 2016a zhao et al 2018 dalin et al 2014 analysed the international and inter provincial vw trade network of four main crops corn rice soy and wheat and three livestock products ruminants pork and poultry in china in 2005 and found that vwfs in china is from dry heavily irrigated provinces to humid regions zhao et al 2015 quantified chinese physical water transfer vw transfer and water stress in each province vwfs accounted for more than a third of the country s water supply in 2007 flowing from underdeveloped less populated western regions to richer more densely populated eastern coastal regions increasing water pressure in exporting provinces wang et al 2014 calculated the grain related vwfs amongst provinces of china in 2010 and found that grain related vw usually flows from water deficient areas to water rich areas and from areas with high grain production efficiency to areas with low efficiency feng et al 2014 combined wsi with an indicator for ecosystem damage to evaluate the sustainability of vwfs of 30 provinces in mainland china and found that consumption of coastal developed provinces relies heavily on water resources from the northern water poor provinces e g xinjiang hebei inner mongolia water stress was aggravated in exporting areas where large exports of vw wf can be an effective policy tool to alleviate water shortage only combined with water scarcity zhao et al 2018 used the wsi combined with multi regional input output tables to assess scarce water saving loss through inter provincial trade within china and found that xinjiang was the largest net virtual scarce water exporter taking regional water scarcity and water productivity into account to identify key connections of scarce water saving can help alleviate water stress these studies have shown that inter provincial vwfs in china are not sustainable however the efficiency of inter provincial crop related vwfs in china has not yet been studied and there is no analysis of spatial temporal evolution of the sustainability and efficiency bennett et al 2009 introduced the word trade off which refers to the situations in which one service increases and another one decreases in describing the relationships opposite to synergy amongst ecosystem services similarly the trade off between efficiency and sustainability of a vwf refers to situations in which the vwf is sustainable while inefficient or is unsustainable while efficient research on the trade offs between efficiency and sustainability of vwfs is also relatively limited the main originalities of the current study are taking case for china i estimate both efficiency and sustainability of crop related vwfs at intra national level considering annual variations for the first time and ii further look at the existing trade offs between the efficiency and sustainability of the vwfs 2 method and data 2 1 estimating virtual water flows inter provincial crop vwfs are determined by crop trade flows and wf per unit of a crop in exporting areas eq 1 within a country the gross inter provincial vwfs equals to the total inter provincial vw exports which also equals to the total inter provincial vw imports 1 v w i j p t i j p w f i p where the vw i j p m³ y 1 represents the vwfs of crop p from province i to province j in the corresponding year t i j p t y 1 represents trade flow of crop p from province i wf i p m³ y 1 is the wf per unit of p in province i based on the blue and green wfs m³ y 1 of crop production in 2008 blue and green wfs m³ y 1 of crop production from 2009 to 2013 were obtained using fast track method tuninetti et al 2017 fast track is a fast method based on the principle that the wf per unit of a crop exhibits a negative linear correlation with unit yield it uses the wf of crop production in a specific year to calculate multi year wf of crop production expressed by the following formula eq 2 2 u w f t u w f t y t y t where uwf t and uwf t m³ t 1 are the wf per unit of a crop in years t and t respectively and y t t ha 1 and y t t ha 1 are the yield in a unit area of the crop in years t and t tuninetti et al 2017 verified that the error of this method falls within 10 through global scale uncertainty analysis with its low computational cost and its easy and fast applicability tuninetti et al 2017 this method has been widely applied e g cazcarro et al 2015 dalin et al 2012 duarte et al 2016 wu et al 2019 due to the data of crop trade flows is generally derived from faostat database fao 2019 at national level liu et al 2018 there is no available data on intra national scale in china the trade flows are estimated based on the net balance of regional trade generally accepted methods include the input output method zhao et al 2018 proximity principle method zhuo et al 2016a estimated based on supply and demand wang et al 2014 and minimum transportation cost method dalin et al 2014 in this study minimum transportation cost which are widely accepted and used in published researches e g dalin et al 2014 wu et al 2019 zhuo et al 2019 was adopted to quantify the vwf based on the annual balance of supply and demand of production of each crop in each province and considering crop trade flows between international and domestic provinces the lowest transportation cost is taken as the constraint and the corresponding inter provincial crop trade flows t y 1 obtained by linear programming zhuo et al 2019 minimize 3 t c p i 1 j 1 h 1 i 31 j 31 h 4 t int i h p c i h t int h j p c h j i 1 j 1 i 31 j 31 t l o c i j p c i j subject to i j 1 31 and h 1 4 4 i 1 j 1 i 31 j 31 t l o c i j p i 1 h 1 i 31 h 4 t int i h p p i p d i p if p i p d i p j 1 i 1 j 31 i 31 i j p j 1 h 1 j 31 h 4 t int h j p d j p p j p if p j p d j p i 1 h 1 i 31 h 4 t int i h p e int p h 1 j 1 h 4 j 31 t int h j p i int p t l o c i j p 0 t int i h p 0 t int h j p 0 in which tc p in cny y 1 refers to the total transport cost of the inter provincial trade in product p tint i h p the foreign export volume from province i through harbour province h tint h j p t y 1 the foreign import volume through harbour province h to province j tloc i j p t y 1 the net trade of product p from province i to province j c i h c h j and c i j cny t 1 the unit costs of transport between provinces p i p t y 1 the production of p in province i d i p t y 1 the total demand of product p in province i eint p china s total international export of product p and iint p t y 1 china s total international import of product p 2 2 assessment of virtual water flow efficiency the wf benchmark can be used as a reference and target for farmers when the actual wf of production is higher than the standard hoekstra 2014 the total wf m3 y 1 in crop production within a region is considered to be efficient when at least half of the wf is for crops whose unit wfs m3 t 1 are below the corresponding crop wf benchmarks hoekstra and mekonnen 2016 the arid index ai is defined as the ratio of precipitation to reference evapotranspiration middleton and thomas 1992 1997 the whole country was divided into arid and humid zones see si when ai 0 5 and ai 0 5 zhuo et al 2016b following mekonnen and hoekstra 2014 the wf benchmark was calculated separately for arid and humid zones zhuo et al 2016b according to the total wf of production m³ y 1 and the yield kg ha 1 of each crop from 2004 to 2013 in a grid cell the wf per unit m³ t 1 of each grid cell was obtained the annual production wf of the 25 of producers with the highest water productivity in the country was set as the annual wf benchmark for the crop and these values were averaged across 10 years to provide a wf benchmark for the study period 2 3 assessment of blue virtual water flow sustainability following hoekstra and mekonnen 2016 the blue vw exports of each province were obtained from inter provincial crop trade flows and the blue wf of crop production in each province and then the sustainability of blue vwfs was evaluated in traditional water scarcity evaluation indices environmental flow and the return flow of water are not considered bws addresses this issue hoekstra et al 2012 the monthly bws is calculated as the ratio of the total blue wf consumption m3 month 1 to the total blue water availability m3 month 1 total blue water availability m3 month 1 equals the sum of runoff generated minus the environmental flow requirements efr hoekstra et al 2012 mekonnen and hoekstra 2016 the efr is considered account for 80 of the natural runoff richter et al 2012 bws is called low when bws 1 blue water in the region is considered sustainable moderate when 1 bws 1 5 and significant when 1 5 bws 2 when bws 2 it is called severe blue water shows severe scarcity hoekstra et al 2012 mekonnen and hoekstra 2016 the blue wf located in places of low bws is treated as sustainable mekonnen and hoekstra 2016 in this study the ratio of sustainable to unsustainable blue vwfs related to a crop from a province equals to the ratio of sustainable to unstainable total blue wfs in the crop in the exporting province 2 4 data the blue wf m³ y 1 and green wf m³ y 1 of crop production and crop yield kg ha 1 in grid cells in mainland china from 2004 to 2008 were obtained from zhuo et al 2016a statistical population data crop yield harvest area and crop production of all provinces from 2004 to 2013 were taken from the national bureau of statistics of china nbsc 2019 for fast tracking the crop wfs for 2009 2013 we made use of the relative changes in annual crop yield at provincial levels to the grid level crop yield data in the reference year from zhuo et al 2016a annual international trade data for each crop were obtained from fao 2019 data for vegetable were used in place of cabbage because the food balance sheets and commodity balances crops primary equivalent in faostat data do not include cabbage the multi year average precipitation and reference evapotranspiration for 1961 2008 were measured by cru ts 3 24 dataset and used to identify arid and humid zones ceda 2018 harris et al 2014 when evaluating the sustainability of crop related blue vwf global bws data at 30 30 arc minute resolution was acquired from mekonnen and hoekstra 2016 re sampled at 5 5 arc minute resolution for the current analysis and transferred from a raster to points to obtain bws in mainland china 3 results 3 1 spatial temporal variability of inter provincial crop related virtual water flows fig 1 depicts the trend in crop related gross vwfs in mainland china from 2004 to 2013 gross vwfs increased by 1 9 from 269 gm³ y 1 in 2004 to 274 gm³ y 1 in 2013 amongst the 20 crops the vwfs of rice wheat and maize account for a relatively large proportion of gross vwf on average 24 24 and 18 respectively fig 2 the national trade flows of the 20 crops increased by 30 from 400 mt y 1 in 2004 to 520 mt y 1 in 2013 while the wf of cabbage barley and rice decreased gross vwfs remained constant from 2004 to 2013 for example the wf of cabbage decreased by 28 in guangdong province wf of barley in inner mongolia decreased by 66 and wf of rice in jiangsu province decreased by 14 green and blue vwfs show the same trends as gross vwf blue vwfs increased by 2 from 51 gm³ y 1 in 2004 to 52 gm³ y 1 in 2013 accounting for 20 of gross vwfs on average green vwfs increased from 219 gm³ y 1 in 2004 to 223 gm³ y 1 in 2013 an increase of 2 accounting for 80 of gross vwfs on average the amplitude of change in all vwfs is relatively low over the decade studied fig 1 fig 3 a depicts the spatial variability of crop related net gross vw export in china in 2004 and 2013 positive values indicate that vwfs is a net export and negative values indicate that it is a net import the net export of gross vw of crops in the period 2004 2013 was north to south water transfer and the import and export situation of most provinces remained unchanged in 2013 net gross vw exports in the north increased by 41 compared with that in 2004 three provinces changed significantly shanxi and guangxi changed from net import to net export and gansu changed from net export to net import fig 3 b depicts the spatial change in the net blue vwfs export of crops in china in 2004 and 2013 the flow direction of net blue vw export is still north to south water transfer in comparison with that in 2004 the net export of blue vw in northern china increased by 2 5 times in 2013 mainly because blue vw export in xinjiang heilongjiang and shandong increased by 47 42 and 22 respectively it was also led by increases in the export of cotton from xinjiang rice from heilongjiang and wheat from shandong ningxia changed from net export of blue vw to net import while shandong and heilongjiang changed from net import to net export during the study period 3 2 efficiency of inter provincial crop related virtual water flows fig 4 shows the evolution over time of inter provincial crop related inefficient vwfs in china inefficiency decreased from 223 gm³ y 1 in 2004 accounting for 94 of gross vwf to 205 gm³ y 11 in 2013 accounting for 75 of gross vwf during the decade rice wheat and maize accounted for the largest share of inefficient vwfs averaging 25 22 and 16 respectively henan heilongjiang hunan and hebei have the largest proportion of inefficient vwfs respectively accounting for 13 12 8 and 8 on average in 2004 the export of inefficient vw was highest in henan up to 30 gm³ y 1 followed by heilongjiang and hebei accounting for 12 9 and 8 of gross inefficient vwfs respectively in 2013 heilongjiang exported the most inefficient vw up to 31 gm³ y 1 followed by henan and hunan accounting for 15 13 and 9 of gross inefficient vwfs respectively inefficient vwfs in hebei are mainly caused by wheat maize and cabbage in heilongjiang by soybean maize and rice in henan by wheat peanut and barley and in hunan by rice at the intra national scale crop related inefficient vwfs gradually decrease over time mainly due to gradual improvements in the water efficiency of each crop beijing tianjin shanghai and tibet had almost no exports while vw exports in eight provinces chongqing guangxi heilongjiang hubei hunan qinghai shanxi and zhejiang are almost always inefficient shandong sichuan and anhui always had efficient vws exports while other provinces have efficient vwfs in certain years see si in 2004 the exports of crop related vws in most provinces were inefficient only the vw exports of wheat in shandong and rice in anhui and sichuan were efficient subsequently crops with improved production efficiency gradually increased by 2013 inefficient vwfs had decreased the most in jilin shandong and jiangsu accounting for 98 80 and 36 of gross vwfs in these provinces respectively fig 5 china s central state council issued the national file no 1 named several opinions on strengthening agricultural infrastructure to further promote agricultural development and farmers income in 2008 the national file proposed to develop water saving irrigation continue to take the water saving transformation in large scale irrigation districts and achieve the goal of completing water saving reconstruction tasks by 2020 ministry of agriculture prc 2019 since 2009 state investment in water conservation has grown linearly liu et al 2012 many provinces have made great efforts to build water conservation projects improving supporting measures and water saving irrigation technology in irrigation districts which can gradually improve crop water efficiency and reduce inefficient vwfs 3 3 sustainability of virtual water flows in exporting provinces fig 6 illustrates the evolution over time of crop related blue vwfs and unsustainable blue vwfs from 2004 to 2013 unsustainable blue vwfs increased by 8 from 40 gm³ y 1 in 2004 to 43 gm³ y 1 in 2013 accounting for an increasing weight from 78 to 83 in gross blue vw wheat rice and cotton account for the largest proportion of unsustainable blue vwf respectively accounting for 37 32 and 15 fig 7 shows the scarcity of water resources in major crop growing areas in china and the proportion of crops in the major provinces exporting unsustainable blue vws during the study period there is a severe scarcity of blue water in the north and the northwest china while low scarcity of blue water exists in other areas from 2004 to 2013 all provinces had unsustainable blue vw exports amongst which xinjiang hebei and shandong had the greatest with average annual exports of 9 2 gm³ y 1 6 1 gm³ y 1 and 6 1 gm³ y 1 respectively although xinjiang hebei and shandong had extremely scarce water resources exports of unsustainable blue vws had increased which exacerbated water stress from 2004 to 2013 unsustainable blue vw exported from xinjiang had increased by 47 flowing mostly to sichuan guangdong and qinghai and mainly consumed by cotton wheat and barley which respectively account for 65 23 and 8 of unsustainable blue vw in 2013 compared with 2004 the ratio of barley increased in 2013 exports of unsustainable blue vw from hebei increased by 0 14 where wheat maize and cabbage were the main contributors accounting for 65 25 and 7 of provincial unsustainable blue vw in 2013 unsustainable blue vw from hebei mainly flowed to heilongjiang liaoning and sichuan compared to 2004 the ratio of maize increased in 2013 exports of unsustainable blue vw from shandong increased by 21 mainly caused by wheat maize and cabbage that account for 79 14 and 4 of unsustainable blue vw mainly flowing to zhejiang hunan and yunnan unsustainable blue vws mainly flowed from water poor areas to areas with relatively abundant water resources and the flow showed an upward trend aggravating water scarcity in exporting areas 3 4 discussion this study represents for the first time the spatial temporal variabilities in efficiency and sustainability of crop related vwfs on an intra national scale results indicate that provinces xinjiang shandong hebei and henan have become hotspots due to their large vw exports and scarcity of water resources a trade off between efficiency and sustainability of crop related vwfs exists in provinces hunan heilongjiang hubei zhejiang and guangxi where water resources are relatively abundant but water utilisation is excessive and crop water efficiency is low from a geographical viewpoint regions with greater total wf and overexploitation of water resources are the most vulnerable places in the system however from the perspective of production regions with low water productivity and high wf of unit production are the weak links of the production system hoekstra 2013 after improving water use efficiency in many provinces the water savings were used to expand production offsetting savings made and leading to additional consumption resulting in a rebound effect grafton et al 2018 hoekstra 2013 sorrell et al 2009 general water conservation recommendations have focused on improving crop productivity and water efficiency researches taking local water resources condition into account are limited feng et al 2014 hoekstra and mekonnen 2016 zhao et al 2018 selecting appropriate crops and excellent crop varieties adopting reasonable irrigation measures and strengthening water management levels are recommended to reduce the wf of production and water consumption meanwhile reducing the wf of production to improve the water efficiency a wf cap should be set to avoid the rebound effect previous studies have quantified inter provincial vwfs in china based on different models and methods and found that vws usually flow from water scarce areas to water rich areas which is not sustainable e g zhao et al 2018 feng et al 2014 in the study period crop related blue vw was basically unchanged however unsustainable blue vw increased mainly due to increasing consumption of wheat and cotton wheat is mainly cultivated in shandong hebei henan jiangsu and anhui where water resources are very scarce although crop water efficiency had gradually increased exports had also increased by 41 over ten years leading to an increase in unsustainable blue vw of 9 aggravating local water scarcity cotton cultivation is widespread in xinjiang has low crop water efficiency and exports are increasing 6 6 gm³ y 1 unsustainable blue vw was consumed by cotton annually accounting for 73 of total export of unsustainable blue vw from xinjiang the blue wf of cotton in xinjiang was 1844 m³ t 1 and the export is 2952 kt y 1 in 2004 while blue wf reduced to 1011 m³ t 1 and exports increased to 6804 kt y 1 in 2013 leading to unsustainable blue vw exports increasing by 1 43 gm³ y 1 or 26 over the decade cotton consumption of unsustainable blue vw accounted for 99 3 rice is mainly cultivated in jiangxi jiangsu hunan and hubei where water resources are relatively abundant but unevenly distributed also exports from hunan and hubei were almost always inefficient leading to high consumption of unsustainable blue vw although unsustainable blue vw export of rice fell by 3 over the ten years the total was still as high as 13 7 gm³ y 1 in 2013 wheat rice and maize were the main contributors to inefficient vwfs heilongjiang hebei henan and hunan had the highest values for inefficient vwfs export in addition to beijing tianjin shanghai and tibet which had negligible exports 18 provinces shandong sichuan anhui shaanxi ningxia inner mongolia guangdong hebei liaoning jilin henan jiangsu fujian gansu yunnan guizhou jiangxi xinjiang improved water efficiency in 2013 leading to a reduction in inefficient vwfs most water poor provinces located in arid and semi arid regions e g shandong hebei and henan had more efficient crops being produced gradually however water rich provinces e g hunan heilongjiang were improving in efficiency more slowly mainly because rich water resources and unlimited water use did not motivate improvements in water efficiency the current results show that majority of crop related vw exports from eight provinces were always inefficient even though the crop yield increased and per unit crop wf decreased in most of the provinces for instance the biggest contributor in inefficient vw exports of zhejiang province was rice the unit wf of rice reduced by 11 over the study period but still 3 3 times higher than the corresponding wf benchmark level the phenomena indicate that there were still gaps for water saving water efficiency improving at crop fields or crop yield enhancement towards the corresponding crop wf benchmarks in these regions china plays a big role in global unsustainable crop water consumption as well as global unsustainable crop related vw trades rosa et al 2019 based on the recent global estimations by rosa et al 2019 china currently contributes 16 91 gm3 y 1 of global unsustainable irrigation consumption in global vw network china is the biggest unsustainable vw importer 19 of global total while decreasing its unsustainable vw exports by 38 over 2000 2015 to other countries moreover the current results reveal that the country redistributes almost half of its unsustainable irrigation consumption intra nationally amongst provinces and the amount is increasing it shows that with big and growing population changing consumption patterns and increasing crop demands china had ate one of the largest amounts of unsustainable water consumption through crop production and trade china should be on the alert for its role in enhancing the unsustainability of water consumed at fields not only by reducing the water stress at its own irrigated lands but also modify the international trades or optimize consumption patterns towards less crop demand of intense unsustainable wfs the efficiency of crop related vwfs was evaluated based on the crop wf benchmarks we adopted the method proposed by mekonnen and hoekstra 2014 which was also applied in zhuo et al 2016b and wang et al 2019 twenty crop benchmarks in arid and humid zones are shown in table 1 compared with the global crop wf benchmarks calculated by mekonnen and hoekstra 2014 all crops have lower benchmarks than global levels except maize potato sweet potato rapeseed sugar beet grape and tea this is mainly because the current study is based at the intra national scale while mekonnen and hoekstra 2014 is at a national scale with no climatic distinction due to different study periods the more recent period indicates higher crop yield leading to lower wf and wf benchmarks fast track method is a fast method to obtain the wf of the crop from the point of view of temporal variability it verified the wf of crop production mainly driven by yield variations and the standard deviation of the error by comparing to the wf assessment manual method was around 0 1 at global scale tuninetti et al 2017 to estimate the uncertainties or probable errors through fast track method for china s case we compared the fast tracked crop wfs over 2004 2007 using 2008 as reference year to the estimated crop wfs by zhuo et al 2016a at provincial levels which were used in the current study for the first few years till 2008 the differences in the unit total green blue wfs per crop were within the range of 20 fig 8 which is acceptable the currently study shows the capability of the fast track method at intra national analysis zhuo et al 2016b calculated that the wf of winter wheat from 1961 to 2008 in the arid and humid zones was 1224 125 m³ t 1 and 841 66 m³ t 1 respectively which is higher than values obtained in this study also we found that the wf was higher in the humid than arid zones as similar phenomenon shown in wang et al 2019 because we also considered spring wheat which is mostly cultivated in humid areas environmental sustainability social equity and resource efficiency are the three pillars for rational allocation and sustainable utilisation of water resources hoekstra 2014 this paper presents the sustainability of blue wf through bws which is only one aspect of environmental sustainability evaluation to comprehensively evaluate the sustainability of water resources multiple evaluations should be conducted of green wf sustainability grey wf sustainability social sustainability and economic sustainability hoekstra 2011 likewise the rational allocation of water resources from the perspective of water resources only has some limitations many other key aspects should be considered because water resources utilisation is comprehensively affected by economic social ecological and other factors in fact production in a specific region may be used for export and the rest for provincial consumption however such data cannot be obtained so that the efficiency of vwfs in each province was evaluated with the wfs of crop production at a grid cell resolution in this study 4 conclusion in the current study the spatial and temporal variations in efficiency and sustainability of crop related inter provincial vwfs in china over 2004 2013 were evaluated during the decade study period net vwfs from the north to the south increased by 41 and net blue vwfs from the north to the south increased by 2 5 times although the gross vwfs across provinces slightly increased by 2 inter provincial crop related inefficient vwfs accounted for 94 of gross vwfs in 2004 reducing to 75 in 2013 wheat rice and maize were the main contributors henan hebei heilongjiang and hunan were the most inefficient vwfs export regions eighteen provinces had efficient vwfs by 2013 wheat rice and cotton were the main contributors to unsustainable blue vwfs xinjiang hebei and shandong were the largest export areas of unsustainable blue vwfs and flows show an upward trend as a result the above mentioned areas have been designated as hotspots and critical crops have been determined xinjiang shandong hebei and henan are key crop cultivation areas and show extreme scarcity in water resources high exports lead to a rise in unsustainable blue vw consumption exacerbating local water scarcity and making water consumption unsustainable in heilongjiang and hunan a lot of water is wasted because of inefficient production and water abundance which leads to unlimited water utilisation and failure to consider crop water efficiency improvements apparently assessment of vwfs should be combined with local water resources conditions considering both efficiency and sustainability to determine hotspots and critical products according to the current results we suggest that at the intra national level each province should make efforts on seeking the highly efficient production structures to sustainably use the limited water resources optimizing the production structure and reducing exports from water scarce areas can optimize vwfs simultaneously promoting the production of crops adapted to the local climate and making efficient use of local green water resources can reduce the need for irrigation credit authorship contribution statement jie gao conceptualization writing review editing supervision la zhuo software methodology validation formal analysis writing original draft yilin liu visualization data curation pengxuan xie visualization data curation wei wang visualization data curation meng li visualization data curation xuerui gao writing review editing pute wu supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work falls under the umbrella of the panta rhei research initiative of the international association of hydrological sciences iahs this work was financially supported by the national natural science foundation of china grants 51809215 shaanxi natural science foundation grants 2018jq4020 the technology foundation for selected overseas chinese scholars in shaanxi province 2017034 and the fundamental research funds for the central universities 2452017181 
512,although discretizations of the shallow water equations swe based on the discontinuous galerkin dg method are well established their computational performance still generally lags behind that of the finite volume discretizations in explicit and semi implicit time stepping schemes commonly used in connection with the swe models the most computationally expensive parts of a dg algorithm are the element and edge integrals computed via loops over quadrature points we propose a quadrature free dg formulation for the swe that replaces quadrature integrations by analytical evaluations the method is implemented within the code generation framework of the exastencils project using the sympy python library the new formulation uses block structured triangular meshes automatically generated for a given number of blocks keywords local discontinuous galerkin method ldg shallow water equations quadrature free formulation code generation domain specific languages dsl python sympy block structured mesh 1 introduction recent advances in computer hardware technology make more realistic ocean atmosphere and climate simulations feasible however this progress has a price on the one hand the growing complexity of the physical and mathematical models requires the development of new and efficient numerical methods on the other the trend towards heterogeneous and highly parallel architectures increases the programming effort necessary to implement develop and maintain these models more difficulties arise from the fact that the lifetime of such modeling packages often exceeds that of the computing architecture they were originally developed for additional challenges specific to this particular class of application are long simulation times and very large geometrically complex domains requiring numerical methods with high accuracy local conservation of important physical quantities low numerical diffusion capability to accurately represent complicated geometries and good parallelization properties complicated domain geometries usually necessitate unstructured meshes and numerical methods that work on them e g finite elements finite volumes however unstructured mesh discretizations often incur a significant computational overhead compared to structured mesh schemes gmeiner et al 2016 hülsemann et al 2003 mostly due to an indirect addressing necessitated by irregular approximation stencils typical for unstructured meshes white et al 2005 this performance penalty may reach an order of magnitude for classical finite elements finite volumes ringler et al 2013 and even more for the discontinuous galerkin dg method kubatko et al 2009 therefore there is a strong interest in approaches that show potential to significantly reduce this disadvantage koldunov et al 2019 one such promising technique involves block structured grids armstrong et al 2015 the main focus of this work is to present and investigate several techniques that aim to substantially improve the computational performance of ocean models in this vein we propose a new quadrature free discontinuous galerkin scheme for the shallow water equations swe that is derived from the method implemented in our two dimensional utbest solver dawson and aizinger 2002 aizinger and dawson 2002 also see a matlab gnu octave implementation of the same discretization in hajduk et al 2018 hajduk et al 2020 reuter et al 2019 later extended to three dimensions in utbest3d dawson and aizinger 2005 aizinger et al 2013 to increase the productivity of numerical model development workflows and ease porting to current and future computing architectures the new scheme is not manually implemented instead its code is generated automatically from a mathematical model description for that we extend our existing code generation toolchain developed within the exastencils 1 1 http www exastencils org project by adding support for symbolic math like specifications of discrete problems within python we also attempt to address the performance shortcomings of unstructured meshes by constructing and evaluating block structured meshes for realistic ocean domains using the approach first proposed in zint et al 2019 the paper is structured as follows the remainder of section 1 provides a brief overview of related work in section 2 we describe the continuous problem its dg discretization and the algebraic representation of element integrals followed by their mapping to an executable code via python and the exastencils code generation framework in section 3 generation of block structured meshes for realistic ocean domains is discussed in section 4 numerical verification of the generated code including some performance results is presented in section 5 1 1 quadrature free dg discretization in a quadrature free dg scheme all element and face integrals are evaluated analytically instead of using quadrature rules rao et al use in rao and morris 2003 a basis made up of any polynomial functions without numerical quadrature this approach reduces the computational time for boundary integrations marchandise et al 2006 presents a quadrature free dg method for the solution of the level set equation in the context of interface capturing methods that uses for efficiency the blas library the advantage of a quadrature free vs a quadrature integration is the fact that the former eliminates the innermost loop over the quadrature points offering thereby a better code optimization potential this approach is not new see atkins and shu 1998 lockard and atkins 1999 however until now it has been exclusively applied to linear della ratta rinaldi et al 2012 or product type nonlinear operators e g advection terms in euler equations hillewaert et al 2006 integrals involved in dg discretization of such problems only contain multidimensional polynomials and can be trivially evaluated analytically in the case of the shallow water equations the advective terms in the momentum equations formulated in the conservative unknowns contain fraction type nonlinearities that make analytical evaluation of integrals very challenging if possible at all in an attempt to circumvent this difficulty nair in nair 2015 used the velocity instead of momentum as the primary unknown for atmospheric swe avoiding thereby fraction type terms the same approach was also utilized by rannabauer et al 2018 for an ader dg implementation of oceanic swe the use of conservative form of the swe has however important advantages not least due to their ability to conserve key physical properties of the system by exploiting one of the main strengths of the local dg ldg method namely mixed re formulation of the original pdes we modify the swe system making it amenable to the quadrature free methodology in spite of the presence of fraction type nonlinearities whereas in the original ldg framework cockburn and shu 1998 a mixed formulation was employed to replace higher order derivatives by lower order ones we took this technique one step further in bungert et al 2017 aizinger et al 2018 to handle nonlinearities in the pde for mean curvature flow a similar idea is used in the current work to deal with the fraction terms in the swe the proposed approach can be generalized to certain other types of nonlinear operators and therefore allows to exploit the advantages of the quadrature free methodology for wider classes of nonlinear problems quadrature free dg formulations are an alternative to tensor product dg formulations see e g müthing et al 2017 the latter schemes evaluate multidimensional integrals as products of one dimensional ones achieving in this way a higher computational intensity particularly for high order discretizations while very efficient for element shapes naturally represented in a tensor product fashion quads hexahedra this approach is less popular for simplicial elements triangles tets although such generalization are possible e g dubiner bases dubiner 1991 1 2 code generation next to classical software libraries such as e g petsc balay et al 1997 hypre falgout et al 2006 deal ii bangerth et al 2007 dune blatt et al 2016 and ug4 vogel et al 2013 code generation techniques in conjunction with domain specific languages dsls become increasingly popular in computational science and engineering applications they enable application scientists to describe numerical models using abstract formulations which are semi automatically translated into efficient code specialized for the target hardware two particularly relevant approaches in this field are firedrake rathgeber et al 2016 and stella gysi et al 2015 firedrake is an automated toolchain for solving partial differential equations pdes specified in the unified form language ufl alnæs et al 2014 a dsl embedded in python stella targets stencil codes on structured meshes and uses an internal dsl embedded into c based on template meta programming see kuckuk 2019 for a detailed overview of related work in this field in this work we focus on utilizing and extending the exastencils code generation framework lengauer et al 2019 it provides its own multi layered external dsl called exaslang which is geared towards the development of numerical models for various applications that involve the solution of pdes kuckuk 2019 it does not rely on other simulation software packages but instead generates the whole simulation program from input data application parameters and problem descriptions formulated in exaslang its output is a highly optimized and massively parallel code that can be executed on a range of hardware platforms such as cpu kuckuk and köstler 2016 schmitt et al 2014 and gpu kuckuk and köstler 2018 lengauer et al 2019 clusters architectures used less frequently in hpc e g arm kuckuk et al 2017b and fpgas schmitt et al 2018 have been evaluated as well exaslang itself offers different levels of abstraction on layer 1 of exaslang users may specify a continuous problem description including functions operators governing equations and boundary conditions whereas layer 2 targets their discretized counterparts specific solver algorithms can be expressed on layer 3 in a mathematical notation layer 4 completes the pipeline by allowing specialization of data structures data communication data in and output and visualization exaslang has been used successfully for cfd kuckuk et al 2017a kuckuk and köstler 2018 and image processing schmitt et al 2016 kronawitter et al 2018 applications as well as others lengauer et al 2019 2 quadrature free dg formulation for the shallow water equations 2 1 governing equations we start with the classical 2d swe given by 1 t ξ q 0 2 t q qq t h τ bf q 0 f c f c 0 q gh ξ f they are defined on some 2d domain ω and ξ represents the elevation of the free water surface with respect to some datum e g the mean sea level by h h b ξ we denote the total fluid depth with hb representing the bathymetric depth q u v t is the depth integrated horizontal velocity field fc the coriolis coefficient g the gravitational acceleration and τ bf the bottom friction coefficient effects of variable atmospheric pressure and tidal potential are expressed through the body force f denoting c ξ u v t system 1 2 is given in the following compact form 3 t c a r c where 4 a u v u 2 h g h 2 h b 2 2 u v h u v h v 2 h g h 2 h b 2 2 r c 0 τ bf u f c v g ξ x h b f x τ bf v f c u g ξ y h b f y this work uses the following types of boundary conditions for the swe note that following the standard approach the unknowns not prescribed at a domain boundary are free and their values are calculated using the numerical solution evaluated at the corresponding boundary dirichlet boundary at a dirichlet boundary all unknowns are specified denotes a prescribed value for the corresponding unknown 5 q q ξ ξ land boundary at a land boundary we assume 6 q n 0 open sea boundary as an open sea boundary condition we set 7 ξ ξ in addition initial conditions for the elevation and velocity fields are provided 8 ξ x 0 ξ 0 x q x 0 q 0 x 2 2 discretization using a quadrature free dg method as already mentioned our discretization of the swe system 3 generally follows that of the utbest solver outlined in dawson and aizinger 2002 aizinger and dawson 2002 but instead of a standard quadrature based evaluation of integrals we modify the pde system to avoid fracture type nonlinearities in order to permit a quadrature free dg formulation for this purpose we introduce the depth averaged velocity u u v t related to q by q u h and replace system 3 by 9 t c a r c 10 u h q where h 2 h b 2 ξ 2 2 h b ξ h b 2 h b 2 ξ h h b and thus 11 a u v u u g ξ h h b 2 u v v u v v g ξ h h b 2 note that a in 11 has no fraction type nonlinearities as opposed to a in 4 let t δ δ 0 be a family of triangulations of ω r 2 and let ω e e 0 e be elements of t δ we obtain the variational formulation of system 9 10 by multiplication with sufficiently smooth test functions ϕ and ψ and integration by parts on each element ω e t δ which yields 12 t c ϕ ω e a ϕ ω e a n ϕ ω e r c ϕ ω e 13 u h ψ ω e q ψ ω e writing ω e and ω e for the l 2 scalar products on elements and edges denoting by p k ω e the polynomial space of order k on ω e the initial conditions for the semi discrete problem are generated using an l 2 projection of 8 into the corresponding discrete space the discrete formulation is then obtained from 12 13 by replacing c and u by finite dimensional functions c δ u δ and utilizing test functions ϕ δ p k ω e 3 ψ δ p k ω e 2 14 t c δ ϕ δ ω e a c δ u δ ϕ δ ω e a c δ u δ c δ u δ n ϕ δ ω e r c δ u δ ϕ δ ω e 15 u δ h δ ψ δ ω e q δ ψ δ ω e where n denotes an exterior unit normal to ω e and a n is approximated on ω e by a numerical flux a c δ u δ c δ u δ n that depends on discontinuous values of the solution on element ω e without superscript and on its edge neighbors superscript on exterior domain boundaries the specified boundary values of the elevation and velocity are utilized in the flux computation in this work we use the lax friedrichs flux hajduk et al 2018 defined as 16 a c δ u δ c δ u δ n 1 2 a c δ u δ a c δ u δ n λ c δ c δ where λ denotes the largest in absolute value eigenvalue of c a c n giving λ h u u n g h in the quadrature based scheme realized in utbest λ h u is used in this place where h and u are evaluated in each quadrature point using the roe pike averaging described in hajduk et al 2018 the nonlinearity of the expression for λ makes a straightforward adoption of this approach for the quadrature free formulation rather difficult to justify our alternative is motivated by the following consideration λ in the lax friedrichs solver given in 16 plays the role of the coefficient in front of the penalty term generally increasing the value of this coefficient does not negatively affect the stability of the scheme although it may result in an increase of numerical diffusion in the quadrature free formulation used in this study we use a single value of λ e for each edge e of t δ thus permitting an analytical evaluation of integrals involving a defined in 16 denoting by x e the midpoint of edge e we use the following approximation 17 λ e max ω e x e ω e u δ ω e x e n max ω e x e ω e g h δ ω e x e given φ e i x i 1 k k a basis of p k ω e c δ and u δ can be represented as 18 c δ t x ω e ξ δ u δ v δ t t x j 1 3 i 1 k k c e i j φ e i x e j 19 u δ t x ω e u δ v δ t t x j 1 2 i 1 k k u e i j φ e i x e j with e j denoting the j th unit vector in r 3 in 18 or r 2 in 19 a basis of p k ω e is defined via a mapping from the corresponding reference basis on ω φ e i x φ i f e 1 x x ω e 0 otherwise i 1 k k where f e ω ω e x x b e x a e 1 is the affine linear transformation see fig 1 from the reference triangle onto triangle ω e with b e b 1 1 e b 1 2 e b 2 1 e b 2 2 e a e 2 a e 1 a e 3 a e 1 and a e1 a e2 a e3 denoting the vertex coordinates of ω e the number of basis functions k k is dependent on the respective polynomial space and has the following values in r 2 k 0 1 k 1 3 k 2 6 and k 3 10 the reference basis functions employed in our implementation are orthonormal with respect to the l 2 scalar product on ω and given by φ 1 x 2 p 0 ω φ 2 x 2 6 x φ 3 x 12 1 x 2 y p 1 ω φ 4 x 6 1 8 x 10 x 2 φ 5 x 3 1 4 x 5 x 2 12 y 15 y 2 φ 6 x 45 1 4 x 3 x 2 4 y 8 x y 3 y 2 p 2 ω φ 7 x 8 1 15 x 45 x 2 35 x 3 φ 8 x 24 1 13 x 33 x 2 21 x 3 2 y 24 x y 42 x 2 y φ 9 x 40 1 9 x 15 x 2 7 x 3 6 y 48 x y 42 x 2 y 6 y 2 42 x y 2 φ 10 x 56 1 3 x 3 x 2 x 3 12 y 24 x y 12 x 2 y 30 y 2 30 x y 2 20 y 3 p 3 ω 2 3 algebraic representation of element integrals for compactness we show an algebraic representation of our discrete scheme only for element integrals inserting the basis representations 18 19 into system 14 15 and testing the first equation with ϕ δ φ e p e 1 we obtain for p 1 k k 20 a c δ u δ φ e p e 1 ω e i 1 k k c e i 2 ω e φ e p x φ e i d x c e i 3 ω e φ e p y φ e i d x i 1 k k c e i 2 det b e b 2 2 e ω φ p x φ i d x b 2 1 e ω φ p y φ i d x c e i 3 det b e b 1 2 e ω φ p x φ i d x b 1 1 e ω φ p y φ i d x for ϕ δ φ e p e 2 and p 1 k k we get a c δ u δ φ e p e 2 ω e i m 1 k k c e i 2 u e m 1 ω e φ e p x φ e i φ e m d x c e i 2 u e m 2 ω e φ e p y φ e i φ e m d x i m 1 k k g 2 c e i 1 c e m 1 ω e φ e p x φ e i φ e m d x i 1 k k g h b c e i 1 ω e φ e p x φ e i d x i m 1 k k c e i 2 u e m 1 det b e 3 2 b 2 2 e ω φ p x φ i φ m d x b 2 1 e ω φ p y φ i φ m d x c e i 2 u e m 2 det b e 3 2 b 1 2 e ω φ p x φ i φ m d x b 1 1 e ω φ p y φ i φ m d x i m 1 k k g 2 det b e 3 2 c e i 1 c e m 1 b 2 2 e ω φ p x φ i φ m d x b 2 1 e ω φ p y φ i φ m d x i 1 k k g h b c e i 1 det b e b 2 2 e ω φ p x φ i d x b 2 1 e ω φ p y φ i d x with a similar expression for ϕ δ φ e p e 3 and rather trivial representations for element integrals arising from 15 3 mapping to code in the exastencils framework the main steps of our approach to map a mathematical model described by a system of pdes to an efficient simulation code are sketched in this section where we describe each of them in detail 3 1 mapping math to python the original exastencils toolchain does not directly support higher order discretizations such as the quadrature free dg formulation detailed above thus our first step was to find the best strategy to integrate this new discretization for this abstract representations for the terms used should be on the one hand as close as possible to the mathematical expression and on the other easy to transform to efficient code another requirement is to find a format or an environment of the abstract representation accepted by the user community to meet all these requirements we have chosen to use the sympy package 2 2 https www sympy org within python as the starting point python is one of the most often used languages currently and sympy is a symbolic algebra package in python with a rich functionality as such this is a better option than adapting our code generation framework directly to this end we implemented a dedicated python package called ghoddess generation of higher order discretizations deployed as exaslang specifications its main task is to translate our dg scheme implemented in form of a series of symbolic sympy expressions to exaslang working with ghoddess is facilitated by already provided basic abstractions for e g basis functions just as classes representing triangles and data fields currently exastencils and in extension also ghoddess is restricted to quadrilateral meshes we address this by logically dividing each element into two differently oriented triangles lower and upper in order to obtain a triangular mesh these special meshes are produced by our mesh generator cf section 4 the algebraic representations of the discrete scheme shown in section 2 3 exemplarily for element integrals are implemented manually in our framework as an example we consider the first part of the element integral for ξ from 20 21 i 1 k k c e i 2 det b e b 2 2 e ω φ p x φ i d x b 2 1 e ω φ p y φ i d x which can be implemented as shown in listing 1 in ghoddess information about the triangles such as the orientation or the determinant of the mapping from the reference triangle and its reciprocal are stored in tri sympy is then used to evaluate integrals and derivatives analytically theoretically it can also be used to simplify the resulting expressions this however increases execution times tremendously and has only limited effect in practice since the exastencils code generator is also capable of performing many of the underlying optimization steps 3 2 mapping python to exaslang to allow a mapping from the symbolic representation to exaslang sympy expressions are enriched with a few required abstractions such as field symbols that correspond to accesses to exaslang fields storing quantities defined on the computational domain ghoddess then creates an auxiliary knowledge file holding parameters that guide the generation process as well as exaslang specifications to be precise we target layer 4 cf fig 2 since this requires only a single back end more information on the exaslang concept and its layers can be found in kuckuk 2019 consider as an example once again the implementation of listing 1 depending on the chosen order this expression will be evaluated differently for linear order and the second degree of freedom i e d 3 and p 2 the underlying sum over the integrals can be evaluated analytically as ω 6 2 d x ω 12 36 x d x ω 6 12 1 x 2 y d x 3 2 using the basis formulation from section 2 2 together with the remaining terms this representation can then be mapped to exaslang ignoring other contributions such as the second half of the element integral edge integrals and the right hand side would result in a code similar to the one shown in listing 2 where it has been embedded in a corresponding update kernel frequently used sub expressions such as parts of the transformation matrix b and the reciprocal of its determinant are stored in designated data fields e g blower 3 and invdetblower 0 respectively note that this kernel only updates triangles with lower orientation and that in practice an equivalent kernel updating the remaining upper triangles is generated for higher order dg approximations the number and complexity of the generated expressions grows significantly the size of the resulting layer 4 file can thus easily exceed several mb and such configurations frequently take more than one hour to generate the main reason for that are symbolic integral evaluations in the quadrature free scheme resulting in unrolling of all loops e g over basis functions with increasing order of the dg method the size of the expressions increases cubically in the number of local basis functions thus one easily ends up with several million nodes in the abstract syntax tree ast resulting in a noticeable slow down in all routines that need to traverse it we plan to address this in on going work by optimizing our generator for performance and also by parallelizing ast traversals 3 3 mapping exaslang to code the exastencils code generator is capable of parsing the emitted exaslang code applying code transformations and certain optimizations and finally outputting a c or cuda code combined with mpi for distributed memory parallelism currently both the exastencils code generator and the target code compiler e g gcc take more than one hour for higher order dg discretizations due to the large size of the expressions the overall runtime of a simulation can be in a similar range depending on the size of the computational mesh and the number of time steps required however larger meshes do not require more time for the code generation following the example from the previous paragraph we can now generate compilable c code similar to the one depicted in listing 3 as evident no optimizations were carried out in order to produce clean code aimed at giving developers insight enabling such optimizations generates better performing but less readable code as demonstrated in listing 4 4 generation of block structured meshes for ocean domains applying simulation methods designed for block structured meshes to complex domains such as oceans is rarely done due to the fact that no automatic generation of block structured meshes for such domains was possible until recently in zint et al 2019 we presented an approach allowing to generate automatically block structured meshes for ocean domains the proposed methodology starts from an initial two dimensional unstructured triangular mesh and produces block structured meshes which consist of either triangle or quadrilateral blocks the two main processing steps are as follows generate a block structure and uniformly refine it to create the structured meshes within the blocks adapt the exterior boundary and element sizes subject to element quality constraints the generation of the blocks is realized by simplifying the provided unstructured triangular mesh using the method of garland and heckbert 1997 garland and zhou 2005 by iteratively removing edges the mesh is modified in a very controlled manner that allows to stop the simplification procedure once a certain number of elements is reached if quadrilateral blocks are desired a conversion from triangles to quadrilaterals finalizes the block generation e g using the method of rank et al 1993 to assure the quality of the generated block structure a smoothing postprocessing like freitag 1997 freitag et al 1999 may be applied as well a discrete mesh optimization procedure is used for boundary and element size adaption zint and grosso 2019 utilizing an appropriate quality metric see zint et al 2019 for details this method improves the mesh quality by iteratively repositioning vertices for each vertex a set of candidate positions is selected and the vertex is repositioned at the candidate position with the highest quality 5 numerical results in this section we present the results of our numerical tests and compare the results of the ghoddess implementation to those of utbest the main goals of these comparisons can be summarized as follows demonstrate that the accuracy and the stability of our quadrature free formulation is closely comparable to that of the swe solver that uses a standard quadrature based dg scheme test our block structured mesh methodology using realistic problems give a preliminary evaluation of the computational performance of the new swe solver developed within the exastencils framework the following numerical tests use meshes unless noted otherwise designed using a block structured topology required by the exastencils framework 5 1 analytical convergence test on a randomly perturbed regular mesh for the first test a rectangular domain ω 0 r 1000 r 0 r 1000 r is used where r is a randomly generated perturbation of up to 20 of the edge length cf fig 3 with the bathymetry specified as h b 1 1 1000 x 2 1000 y the convergence studies are conducted using an artificially manufactured analytical solution given by ξ x t 2 a 2 c a sin π x y c t t 600 u x t 2 a c a c t sin π x y c t t 600 v x t a c a c t sin π x y c t t 600 that is also used to provide suitable initial and dirichlet boundary conditions simulations were run for t 0 1 500 with the time step δ t 0 5 for piecewise constants and linears and δ t 0 01 for piecewise quadratics and cubics this time step was selected as sufficiently small to make the time discretization errors negligible compared to those of the spatial discretization the remaining parameters were chosen as follows c a 0 2 c t 0 2 a 0 3 fig 3 illustrates the mesh and the initial condition left and the final solution on the coarsest level 2 middle and level 6 right mesh for the piecewise linear k 1 dg discretization the errors for dg discretization spaces ranging from piecewise constants k 0 to piecewise cubics k 3 and the corresponding experimental convergence rates are listed in table 1 and plotted in fig 4 the expected convergence rates are demonstrated for all primary unknowns surface elevation and depth integrated velocity components due to increasing computational and code generation costs runs for higher order dg discretizations stop at coarser mesh resolutions than the low order runs nevertheless the absolute l 2 errors for higher order approximations are much smaller 5 2 supercritical flow in a constricted channel to demonstrate the robustness of our quadrature free implementation on a problem with a discontinuous solution we simulate supercritical flow in a constricted channel with constant bathymetry based on the configuration proposed by zienkiewicz and ortiz in zienkiewicz and ortiz 1995 the lateral channel boundary walls are constricted on both sides with constriction angle of 5 degrees producing reflective cross wave patterns flow is induced through the inflow bottom boundary the inlet froude number fr is defined by f r u g h where u and h are the axial velocity and water depth at the inlet respectively choosing for our test f r 2 5 the flow clearly is in a supercritical regime this problem can be solved analytically using methods presented by ippen in ippen 1951 the discontinuous analytical solution projected on the finest mesh ca 230 000 elements is plotted in fig 5 top right fig 5 top left displays the unstructured mesh with 3 155 elements and a block structured mesh with 3 584 elements generated for the ghoddess framework is shown in fig 5 top middle for our simulations the runs are started with constant elevation ξ 0 and constant velocity axial velocity equal to the inlet velocity cross flow velocity equal to zero and continued until a stationary state is reached at the lateral wall boundaries we impose the land no normal flow boundary conditions free surface elevation and velocity are specified at the inlet boundary and no boundary conditions are prescribed at the outlet boundary the results of our quadrature free implementation agree very well for all tested discretization orders k 0 1 2 with those produced by utbest on both unstructured and block structured meshes for comparison we present the steady state results for piecewise linear k 1 dg approximation in fig 5 for ghoddess quadrature free on the block structured mesh bottom left utbest quadrature based on the block structured mesh bottom middle and utbest quadrature based on the unstructured mesh bottom right in particular the important characteristics of the solution namely the shock positions and the plateau levels agree very well among all runs and do not display any sensitivity to either the mesh structure dg discretization order or quadrature based quadrature free type of the scheme since no slope limiting of any sort was used in our runs the solutions for the piecewise linear as well as for any higher order dg approximation display overshoots at the discontinuities however the shown results represent the converged steady state solutions and the overshoots do not pose any stability difficulties for either quadrature based or quadrature free scheme 5 3 tidal flow around bahamas our realistic example considers the tide driven flow at the bahamas islands the domain geometry and the bathymetry as well as the approximate positions of four recording stations for the free surface elevation and velocity with exact coordinates in meters 38 667 49 333 56 098 9 613 41 263 29 776 and 59 594 41 149 are illustrated in fig 6 right fig 6 left shows the original unstructured utbest finite element mesh consisting of 1 696 elements next to the block structured mesh generated for ghoddess framework containing 2 624 elements in fig 6 middle the bottom friction was given via a standard quadratic friction law τ bf c f u see e g vreugdenhil 1994 with coefficient c f 0 009 and the constant coriolis parameter was set to 3 19 10 5 s 1 the tidal forcing was prescribed at the open boundary consisting of five tidal components o1 k1 n2 m2 s2 given analytically by 22 ξ t 0 075 cos t 25 82 3 40 0 095 cos t 23 94 3 60 0 100 cos t 12 66 5 93 0 395 cos t 12 42 0 00 0 060 cos t 12 00 0 75 with t hours denoting the time elapsed from the beginning of the simulation and ξ meters the specified tidal elevation at the open sea boundary in real life ocean simulations the initial conditions are often unknown or very difficult to obtain therefore a so called cold start initialization was performed the fluid domain is assumed to be at rest initially ξ 0 0 q 0 0 and the boundary condition tidal elevation in this case was applied gradually over a period of two days using ramping a coefficient multiplying the amplitude of the tidal forcing set to zero at the beginning of the simulation and linearly increasing to one at the end of day two the ten day simulations were run with a constant time step of 15 seconds for the piecewise constant and piecewise linear dg discretization k 0 1 and of 10 seconds for the piecewise quadratic one k 2 the simulation results were compared to those obtained using the utbest model of aizinger and dawson the latter model had been validated for the bahamas test case by comparison to the adcirc 3 3 https adcirc org and station measurement results in aizinger and dawson 2002 fig 7 displays the exemplarily chosen station comparisons here we intentionally selected stations with the largest discrepancies between runs the other station results display similar or better agreement for the surface elevation at station 1 top the depth averaged x velocity at station 2 middle and the depth averaged y velocity at station 4 bottom using the station comparisons we aim to address several open questions concerning our approach quantify the effects of the modifications in the dg discretization necessitated by a quadrature free scheme and clarify the influence of block structured meshes on the simulation results the comparisons in fig 7 demonstrate excellent agreement for the surface elevation top plot for all different runs utbest quadrature based scheme for k 1 on the original unstructured mesh given in fig 6 left utbest quadrature based scheme for k 0 1 2 on the block structured mesh displayed in fig 6 middle and ghoddess quadrature free scheme for k 0 1 2 on the same block structured mesh using a zoom in of the last elevation minimum one can clearly see that the differences between the results for various discretization orders are much greater than the differences due to the quadrature integration or due to the mesh type the depth averaged velocities shown in the middle and bottom graphs of fig 7 display somewhat more sensitivity this finding is fully consistent with the station comparisons performed in aizinger and dawson 2002 one should also note that the absolute deviations in the x and y velocities are similar however the x velocity plot for station 2 presented in fig 7 exaggerates those differences due to the much smaller x velocity amplitude and correspondingly the much finer scale of the vertical axis a more elaborate comparison between the quadrature based results produced by utbest and quadrature free simulations obtained using ghoddess on the same block structured mesh is shown in fig 8 for the elevation field at the end of day 10 of the simulation displayed in fig 8 top left we calculate the difference plots between the utbest and the ghoddess results for the piecewise constant fig 8 top right piecewise linear fig 8 bottom left and piecewise quadratic fig 8 bottom right dg discretizations note that the effects of the quadrature free scheme increase with the order of the discretization this finding is hardly surprising and caused by the evaluation of edge fluxes that in the piecewise constant case leads to nearly identical discrete expressions with the rising order of the discretization the number of edge quadrature points grows and so do the differences in the edge flux computation between the quadrature based and quadrature free scheme see 17 and the corresponding discussion in section 2 2 nevertheless these differences are very small and even in the worst case k 2 do not exceed 1 of the calculated value of the surface elevation last but not least two properties of our quadrature free discretization have to be mentioned here that play an important role for the shallow water equations the local conservation of all primary unknowns and the well balancedness for zero velocity conditions similarly to the original dg scheme realized in utbest these properties hold for the new quadrature free implementation since the modifications only concern the evaluation of the element and edge integrals whereas no balance or conservation relationships have been affected and no artificial terms have been introduced the latter property was explicitly verified by running the bahamas test case in a lake at rest configuration not shown here the former property can be shown analytically by choosing a discrete test function equal to one on a single element and zero otherwise 5 4 performance results and comparison to a quadrature based implementation to asses the performance of our implementation we show serial and parallel execution times and compare those to the timings of the serial quadrature based implementation of utbest described in dawson and aizinger 2002 and aizinger and dawson 2002 measurements were carried out on a single workstation featuring two intel xeon gold 5122 cpus with 4 cores each running at 3 60 ghz we consider two test cases first we evaluate the analytical example described in section 5 1 on the square domain with a randomly perturbed mesh it consists of between 128 and 32 768 triangular elements for refinement levels between three and seven respectively second we consider the tide driven flow on a realistic domain described in section 5 3 represented by a block structured mesh with 82 blocks containing between 32 and 2 048 triangular elements each for refinement levels between two and five respectively for a total number of elements ranging from 2 634 to 167 936 both scenarios are evaluated for piecewise constant k 0 linear k 1 and quadratic k 2 dg discretizations for parallel runs we use a pure openmp parallelization with 16 threads which is automatically generated by the exastencils framework in addition to already discussed points the key differences between the utbest and ghoddess implementations are utbest is a hybrid fortran 77 c code with the main numerical parts implemented in c utbest performs all calculations in the single floating point accuracy whereas ghoddess generated solvers use the double precision ghoddess generated solvers allow timing the actual solving routine whereas only timing the whole program execution is possible for utbest we address this by averaged measured times over 1 000 time steps for the bahamas test with k 2 and 10 000 time steps for all other cases thereby rendering initialization overhead negligible table 2 summarizes obtained execution times per time step in ms comparing the serial performance of utbest and ghoddess we find that the new code generation approach performs better in almost all cases as described previously it can be parallelized automatically which in the present case improves performance considerably as long as enough work is available for smaller meshes the overhead of the openmp synchronization outweighs the potential speed up this could be addressed by using fewer threads utilizing only one socket or switching to a different openmp implementation such optimization are however the focus of future work just as an in depth scalability test of our generated solvers 6 conclusion and outlook this work introduced for the first time the quadrature free functionality for a swe model based on a discontinuous galerkin discretization the proposed scheme has been implemented in our novel ghoddess python package that naturally extends the exastencils code generation toolchain this allows re using already implemented optimizations strategies for automatic parallelization and now also automatically generated block structured meshes the new approach shows a considerable performance improvement compared to that of the swe solver that uses a standard quadrature based dg scheme while achieving comparable accuracy and stability in our future work we consider transferring our techniques to 3d coastal ocean models such as the one implemented in utbest3d dawson and aizinger 2005 aizinger et al 2013 reuter et al 2015 to complete the code generation pipeline we plan to provide and incorporate the ufl unified form language as alternative mode of input for ghoddess we also work on restructuring parts of our python implementation to speed up the generation process as well as on evaluating and if necessary improving node level performance and scalability on a range of different hardware architectures finally we will further compare the quality of block structured and unstructured meshes in order to improve the solution quality and performance of our automatically generated block structured meshes credit authorship contribution statement sara faghih naini software validation formal analysis investigation visualization writing original draft data curation sebastian kuckuk methodology software investigation writing original draft data curation vadym aizinger conceptualization methodology software writing original draft visualization supervision project administration funding acquisition daniel zint software methodology data curation writing original draft roberto grosso conceptualization methodology project administration funding acquisition supervision harald köstler conceptualization methodology project administration funding acquisition supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors acknowledge financial support by the german research foundation dfg through grants ai 117 6 1 ko 4641 1 1 and gr 1107 3 1 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103552 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
512,although discretizations of the shallow water equations swe based on the discontinuous galerkin dg method are well established their computational performance still generally lags behind that of the finite volume discretizations in explicit and semi implicit time stepping schemes commonly used in connection with the swe models the most computationally expensive parts of a dg algorithm are the element and edge integrals computed via loops over quadrature points we propose a quadrature free dg formulation for the swe that replaces quadrature integrations by analytical evaluations the method is implemented within the code generation framework of the exastencils project using the sympy python library the new formulation uses block structured triangular meshes automatically generated for a given number of blocks keywords local discontinuous galerkin method ldg shallow water equations quadrature free formulation code generation domain specific languages dsl python sympy block structured mesh 1 introduction recent advances in computer hardware technology make more realistic ocean atmosphere and climate simulations feasible however this progress has a price on the one hand the growing complexity of the physical and mathematical models requires the development of new and efficient numerical methods on the other the trend towards heterogeneous and highly parallel architectures increases the programming effort necessary to implement develop and maintain these models more difficulties arise from the fact that the lifetime of such modeling packages often exceeds that of the computing architecture they were originally developed for additional challenges specific to this particular class of application are long simulation times and very large geometrically complex domains requiring numerical methods with high accuracy local conservation of important physical quantities low numerical diffusion capability to accurately represent complicated geometries and good parallelization properties complicated domain geometries usually necessitate unstructured meshes and numerical methods that work on them e g finite elements finite volumes however unstructured mesh discretizations often incur a significant computational overhead compared to structured mesh schemes gmeiner et al 2016 hülsemann et al 2003 mostly due to an indirect addressing necessitated by irregular approximation stencils typical for unstructured meshes white et al 2005 this performance penalty may reach an order of magnitude for classical finite elements finite volumes ringler et al 2013 and even more for the discontinuous galerkin dg method kubatko et al 2009 therefore there is a strong interest in approaches that show potential to significantly reduce this disadvantage koldunov et al 2019 one such promising technique involves block structured grids armstrong et al 2015 the main focus of this work is to present and investigate several techniques that aim to substantially improve the computational performance of ocean models in this vein we propose a new quadrature free discontinuous galerkin scheme for the shallow water equations swe that is derived from the method implemented in our two dimensional utbest solver dawson and aizinger 2002 aizinger and dawson 2002 also see a matlab gnu octave implementation of the same discretization in hajduk et al 2018 hajduk et al 2020 reuter et al 2019 later extended to three dimensions in utbest3d dawson and aizinger 2005 aizinger et al 2013 to increase the productivity of numerical model development workflows and ease porting to current and future computing architectures the new scheme is not manually implemented instead its code is generated automatically from a mathematical model description for that we extend our existing code generation toolchain developed within the exastencils 1 1 http www exastencils org project by adding support for symbolic math like specifications of discrete problems within python we also attempt to address the performance shortcomings of unstructured meshes by constructing and evaluating block structured meshes for realistic ocean domains using the approach first proposed in zint et al 2019 the paper is structured as follows the remainder of section 1 provides a brief overview of related work in section 2 we describe the continuous problem its dg discretization and the algebraic representation of element integrals followed by their mapping to an executable code via python and the exastencils code generation framework in section 3 generation of block structured meshes for realistic ocean domains is discussed in section 4 numerical verification of the generated code including some performance results is presented in section 5 1 1 quadrature free dg discretization in a quadrature free dg scheme all element and face integrals are evaluated analytically instead of using quadrature rules rao et al use in rao and morris 2003 a basis made up of any polynomial functions without numerical quadrature this approach reduces the computational time for boundary integrations marchandise et al 2006 presents a quadrature free dg method for the solution of the level set equation in the context of interface capturing methods that uses for efficiency the blas library the advantage of a quadrature free vs a quadrature integration is the fact that the former eliminates the innermost loop over the quadrature points offering thereby a better code optimization potential this approach is not new see atkins and shu 1998 lockard and atkins 1999 however until now it has been exclusively applied to linear della ratta rinaldi et al 2012 or product type nonlinear operators e g advection terms in euler equations hillewaert et al 2006 integrals involved in dg discretization of such problems only contain multidimensional polynomials and can be trivially evaluated analytically in the case of the shallow water equations the advective terms in the momentum equations formulated in the conservative unknowns contain fraction type nonlinearities that make analytical evaluation of integrals very challenging if possible at all in an attempt to circumvent this difficulty nair in nair 2015 used the velocity instead of momentum as the primary unknown for atmospheric swe avoiding thereby fraction type terms the same approach was also utilized by rannabauer et al 2018 for an ader dg implementation of oceanic swe the use of conservative form of the swe has however important advantages not least due to their ability to conserve key physical properties of the system by exploiting one of the main strengths of the local dg ldg method namely mixed re formulation of the original pdes we modify the swe system making it amenable to the quadrature free methodology in spite of the presence of fraction type nonlinearities whereas in the original ldg framework cockburn and shu 1998 a mixed formulation was employed to replace higher order derivatives by lower order ones we took this technique one step further in bungert et al 2017 aizinger et al 2018 to handle nonlinearities in the pde for mean curvature flow a similar idea is used in the current work to deal with the fraction terms in the swe the proposed approach can be generalized to certain other types of nonlinear operators and therefore allows to exploit the advantages of the quadrature free methodology for wider classes of nonlinear problems quadrature free dg formulations are an alternative to tensor product dg formulations see e g müthing et al 2017 the latter schemes evaluate multidimensional integrals as products of one dimensional ones achieving in this way a higher computational intensity particularly for high order discretizations while very efficient for element shapes naturally represented in a tensor product fashion quads hexahedra this approach is less popular for simplicial elements triangles tets although such generalization are possible e g dubiner bases dubiner 1991 1 2 code generation next to classical software libraries such as e g petsc balay et al 1997 hypre falgout et al 2006 deal ii bangerth et al 2007 dune blatt et al 2016 and ug4 vogel et al 2013 code generation techniques in conjunction with domain specific languages dsls become increasingly popular in computational science and engineering applications they enable application scientists to describe numerical models using abstract formulations which are semi automatically translated into efficient code specialized for the target hardware two particularly relevant approaches in this field are firedrake rathgeber et al 2016 and stella gysi et al 2015 firedrake is an automated toolchain for solving partial differential equations pdes specified in the unified form language ufl alnæs et al 2014 a dsl embedded in python stella targets stencil codes on structured meshes and uses an internal dsl embedded into c based on template meta programming see kuckuk 2019 for a detailed overview of related work in this field in this work we focus on utilizing and extending the exastencils code generation framework lengauer et al 2019 it provides its own multi layered external dsl called exaslang which is geared towards the development of numerical models for various applications that involve the solution of pdes kuckuk 2019 it does not rely on other simulation software packages but instead generates the whole simulation program from input data application parameters and problem descriptions formulated in exaslang its output is a highly optimized and massively parallel code that can be executed on a range of hardware platforms such as cpu kuckuk and köstler 2016 schmitt et al 2014 and gpu kuckuk and köstler 2018 lengauer et al 2019 clusters architectures used less frequently in hpc e g arm kuckuk et al 2017b and fpgas schmitt et al 2018 have been evaluated as well exaslang itself offers different levels of abstraction on layer 1 of exaslang users may specify a continuous problem description including functions operators governing equations and boundary conditions whereas layer 2 targets their discretized counterparts specific solver algorithms can be expressed on layer 3 in a mathematical notation layer 4 completes the pipeline by allowing specialization of data structures data communication data in and output and visualization exaslang has been used successfully for cfd kuckuk et al 2017a kuckuk and köstler 2018 and image processing schmitt et al 2016 kronawitter et al 2018 applications as well as others lengauer et al 2019 2 quadrature free dg formulation for the shallow water equations 2 1 governing equations we start with the classical 2d swe given by 1 t ξ q 0 2 t q qq t h τ bf q 0 f c f c 0 q gh ξ f they are defined on some 2d domain ω and ξ represents the elevation of the free water surface with respect to some datum e g the mean sea level by h h b ξ we denote the total fluid depth with hb representing the bathymetric depth q u v t is the depth integrated horizontal velocity field fc the coriolis coefficient g the gravitational acceleration and τ bf the bottom friction coefficient effects of variable atmospheric pressure and tidal potential are expressed through the body force f denoting c ξ u v t system 1 2 is given in the following compact form 3 t c a r c where 4 a u v u 2 h g h 2 h b 2 2 u v h u v h v 2 h g h 2 h b 2 2 r c 0 τ bf u f c v g ξ x h b f x τ bf v f c u g ξ y h b f y this work uses the following types of boundary conditions for the swe note that following the standard approach the unknowns not prescribed at a domain boundary are free and their values are calculated using the numerical solution evaluated at the corresponding boundary dirichlet boundary at a dirichlet boundary all unknowns are specified denotes a prescribed value for the corresponding unknown 5 q q ξ ξ land boundary at a land boundary we assume 6 q n 0 open sea boundary as an open sea boundary condition we set 7 ξ ξ in addition initial conditions for the elevation and velocity fields are provided 8 ξ x 0 ξ 0 x q x 0 q 0 x 2 2 discretization using a quadrature free dg method as already mentioned our discretization of the swe system 3 generally follows that of the utbest solver outlined in dawson and aizinger 2002 aizinger and dawson 2002 but instead of a standard quadrature based evaluation of integrals we modify the pde system to avoid fracture type nonlinearities in order to permit a quadrature free dg formulation for this purpose we introduce the depth averaged velocity u u v t related to q by q u h and replace system 3 by 9 t c a r c 10 u h q where h 2 h b 2 ξ 2 2 h b ξ h b 2 h b 2 ξ h h b and thus 11 a u v u u g ξ h h b 2 u v v u v v g ξ h h b 2 note that a in 11 has no fraction type nonlinearities as opposed to a in 4 let t δ δ 0 be a family of triangulations of ω r 2 and let ω e e 0 e be elements of t δ we obtain the variational formulation of system 9 10 by multiplication with sufficiently smooth test functions ϕ and ψ and integration by parts on each element ω e t δ which yields 12 t c ϕ ω e a ϕ ω e a n ϕ ω e r c ϕ ω e 13 u h ψ ω e q ψ ω e writing ω e and ω e for the l 2 scalar products on elements and edges denoting by p k ω e the polynomial space of order k on ω e the initial conditions for the semi discrete problem are generated using an l 2 projection of 8 into the corresponding discrete space the discrete formulation is then obtained from 12 13 by replacing c and u by finite dimensional functions c δ u δ and utilizing test functions ϕ δ p k ω e 3 ψ δ p k ω e 2 14 t c δ ϕ δ ω e a c δ u δ ϕ δ ω e a c δ u δ c δ u δ n ϕ δ ω e r c δ u δ ϕ δ ω e 15 u δ h δ ψ δ ω e q δ ψ δ ω e where n denotes an exterior unit normal to ω e and a n is approximated on ω e by a numerical flux a c δ u δ c δ u δ n that depends on discontinuous values of the solution on element ω e without superscript and on its edge neighbors superscript on exterior domain boundaries the specified boundary values of the elevation and velocity are utilized in the flux computation in this work we use the lax friedrichs flux hajduk et al 2018 defined as 16 a c δ u δ c δ u δ n 1 2 a c δ u δ a c δ u δ n λ c δ c δ where λ denotes the largest in absolute value eigenvalue of c a c n giving λ h u u n g h in the quadrature based scheme realized in utbest λ h u is used in this place where h and u are evaluated in each quadrature point using the roe pike averaging described in hajduk et al 2018 the nonlinearity of the expression for λ makes a straightforward adoption of this approach for the quadrature free formulation rather difficult to justify our alternative is motivated by the following consideration λ in the lax friedrichs solver given in 16 plays the role of the coefficient in front of the penalty term generally increasing the value of this coefficient does not negatively affect the stability of the scheme although it may result in an increase of numerical diffusion in the quadrature free formulation used in this study we use a single value of λ e for each edge e of t δ thus permitting an analytical evaluation of integrals involving a defined in 16 denoting by x e the midpoint of edge e we use the following approximation 17 λ e max ω e x e ω e u δ ω e x e n max ω e x e ω e g h δ ω e x e given φ e i x i 1 k k a basis of p k ω e c δ and u δ can be represented as 18 c δ t x ω e ξ δ u δ v δ t t x j 1 3 i 1 k k c e i j φ e i x e j 19 u δ t x ω e u δ v δ t t x j 1 2 i 1 k k u e i j φ e i x e j with e j denoting the j th unit vector in r 3 in 18 or r 2 in 19 a basis of p k ω e is defined via a mapping from the corresponding reference basis on ω φ e i x φ i f e 1 x x ω e 0 otherwise i 1 k k where f e ω ω e x x b e x a e 1 is the affine linear transformation see fig 1 from the reference triangle onto triangle ω e with b e b 1 1 e b 1 2 e b 2 1 e b 2 2 e a e 2 a e 1 a e 3 a e 1 and a e1 a e2 a e3 denoting the vertex coordinates of ω e the number of basis functions k k is dependent on the respective polynomial space and has the following values in r 2 k 0 1 k 1 3 k 2 6 and k 3 10 the reference basis functions employed in our implementation are orthonormal with respect to the l 2 scalar product on ω and given by φ 1 x 2 p 0 ω φ 2 x 2 6 x φ 3 x 12 1 x 2 y p 1 ω φ 4 x 6 1 8 x 10 x 2 φ 5 x 3 1 4 x 5 x 2 12 y 15 y 2 φ 6 x 45 1 4 x 3 x 2 4 y 8 x y 3 y 2 p 2 ω φ 7 x 8 1 15 x 45 x 2 35 x 3 φ 8 x 24 1 13 x 33 x 2 21 x 3 2 y 24 x y 42 x 2 y φ 9 x 40 1 9 x 15 x 2 7 x 3 6 y 48 x y 42 x 2 y 6 y 2 42 x y 2 φ 10 x 56 1 3 x 3 x 2 x 3 12 y 24 x y 12 x 2 y 30 y 2 30 x y 2 20 y 3 p 3 ω 2 3 algebraic representation of element integrals for compactness we show an algebraic representation of our discrete scheme only for element integrals inserting the basis representations 18 19 into system 14 15 and testing the first equation with ϕ δ φ e p e 1 we obtain for p 1 k k 20 a c δ u δ φ e p e 1 ω e i 1 k k c e i 2 ω e φ e p x φ e i d x c e i 3 ω e φ e p y φ e i d x i 1 k k c e i 2 det b e b 2 2 e ω φ p x φ i d x b 2 1 e ω φ p y φ i d x c e i 3 det b e b 1 2 e ω φ p x φ i d x b 1 1 e ω φ p y φ i d x for ϕ δ φ e p e 2 and p 1 k k we get a c δ u δ φ e p e 2 ω e i m 1 k k c e i 2 u e m 1 ω e φ e p x φ e i φ e m d x c e i 2 u e m 2 ω e φ e p y φ e i φ e m d x i m 1 k k g 2 c e i 1 c e m 1 ω e φ e p x φ e i φ e m d x i 1 k k g h b c e i 1 ω e φ e p x φ e i d x i m 1 k k c e i 2 u e m 1 det b e 3 2 b 2 2 e ω φ p x φ i φ m d x b 2 1 e ω φ p y φ i φ m d x c e i 2 u e m 2 det b e 3 2 b 1 2 e ω φ p x φ i φ m d x b 1 1 e ω φ p y φ i φ m d x i m 1 k k g 2 det b e 3 2 c e i 1 c e m 1 b 2 2 e ω φ p x φ i φ m d x b 2 1 e ω φ p y φ i φ m d x i 1 k k g h b c e i 1 det b e b 2 2 e ω φ p x φ i d x b 2 1 e ω φ p y φ i d x with a similar expression for ϕ δ φ e p e 3 and rather trivial representations for element integrals arising from 15 3 mapping to code in the exastencils framework the main steps of our approach to map a mathematical model described by a system of pdes to an efficient simulation code are sketched in this section where we describe each of them in detail 3 1 mapping math to python the original exastencils toolchain does not directly support higher order discretizations such as the quadrature free dg formulation detailed above thus our first step was to find the best strategy to integrate this new discretization for this abstract representations for the terms used should be on the one hand as close as possible to the mathematical expression and on the other easy to transform to efficient code another requirement is to find a format or an environment of the abstract representation accepted by the user community to meet all these requirements we have chosen to use the sympy package 2 2 https www sympy org within python as the starting point python is one of the most often used languages currently and sympy is a symbolic algebra package in python with a rich functionality as such this is a better option than adapting our code generation framework directly to this end we implemented a dedicated python package called ghoddess generation of higher order discretizations deployed as exaslang specifications its main task is to translate our dg scheme implemented in form of a series of symbolic sympy expressions to exaslang working with ghoddess is facilitated by already provided basic abstractions for e g basis functions just as classes representing triangles and data fields currently exastencils and in extension also ghoddess is restricted to quadrilateral meshes we address this by logically dividing each element into two differently oriented triangles lower and upper in order to obtain a triangular mesh these special meshes are produced by our mesh generator cf section 4 the algebraic representations of the discrete scheme shown in section 2 3 exemplarily for element integrals are implemented manually in our framework as an example we consider the first part of the element integral for ξ from 20 21 i 1 k k c e i 2 det b e b 2 2 e ω φ p x φ i d x b 2 1 e ω φ p y φ i d x which can be implemented as shown in listing 1 in ghoddess information about the triangles such as the orientation or the determinant of the mapping from the reference triangle and its reciprocal are stored in tri sympy is then used to evaluate integrals and derivatives analytically theoretically it can also be used to simplify the resulting expressions this however increases execution times tremendously and has only limited effect in practice since the exastencils code generator is also capable of performing many of the underlying optimization steps 3 2 mapping python to exaslang to allow a mapping from the symbolic representation to exaslang sympy expressions are enriched with a few required abstractions such as field symbols that correspond to accesses to exaslang fields storing quantities defined on the computational domain ghoddess then creates an auxiliary knowledge file holding parameters that guide the generation process as well as exaslang specifications to be precise we target layer 4 cf fig 2 since this requires only a single back end more information on the exaslang concept and its layers can be found in kuckuk 2019 consider as an example once again the implementation of listing 1 depending on the chosen order this expression will be evaluated differently for linear order and the second degree of freedom i e d 3 and p 2 the underlying sum over the integrals can be evaluated analytically as ω 6 2 d x ω 12 36 x d x ω 6 12 1 x 2 y d x 3 2 using the basis formulation from section 2 2 together with the remaining terms this representation can then be mapped to exaslang ignoring other contributions such as the second half of the element integral edge integrals and the right hand side would result in a code similar to the one shown in listing 2 where it has been embedded in a corresponding update kernel frequently used sub expressions such as parts of the transformation matrix b and the reciprocal of its determinant are stored in designated data fields e g blower 3 and invdetblower 0 respectively note that this kernel only updates triangles with lower orientation and that in practice an equivalent kernel updating the remaining upper triangles is generated for higher order dg approximations the number and complexity of the generated expressions grows significantly the size of the resulting layer 4 file can thus easily exceed several mb and such configurations frequently take more than one hour to generate the main reason for that are symbolic integral evaluations in the quadrature free scheme resulting in unrolling of all loops e g over basis functions with increasing order of the dg method the size of the expressions increases cubically in the number of local basis functions thus one easily ends up with several million nodes in the abstract syntax tree ast resulting in a noticeable slow down in all routines that need to traverse it we plan to address this in on going work by optimizing our generator for performance and also by parallelizing ast traversals 3 3 mapping exaslang to code the exastencils code generator is capable of parsing the emitted exaslang code applying code transformations and certain optimizations and finally outputting a c or cuda code combined with mpi for distributed memory parallelism currently both the exastencils code generator and the target code compiler e g gcc take more than one hour for higher order dg discretizations due to the large size of the expressions the overall runtime of a simulation can be in a similar range depending on the size of the computational mesh and the number of time steps required however larger meshes do not require more time for the code generation following the example from the previous paragraph we can now generate compilable c code similar to the one depicted in listing 3 as evident no optimizations were carried out in order to produce clean code aimed at giving developers insight enabling such optimizations generates better performing but less readable code as demonstrated in listing 4 4 generation of block structured meshes for ocean domains applying simulation methods designed for block structured meshes to complex domains such as oceans is rarely done due to the fact that no automatic generation of block structured meshes for such domains was possible until recently in zint et al 2019 we presented an approach allowing to generate automatically block structured meshes for ocean domains the proposed methodology starts from an initial two dimensional unstructured triangular mesh and produces block structured meshes which consist of either triangle or quadrilateral blocks the two main processing steps are as follows generate a block structure and uniformly refine it to create the structured meshes within the blocks adapt the exterior boundary and element sizes subject to element quality constraints the generation of the blocks is realized by simplifying the provided unstructured triangular mesh using the method of garland and heckbert 1997 garland and zhou 2005 by iteratively removing edges the mesh is modified in a very controlled manner that allows to stop the simplification procedure once a certain number of elements is reached if quadrilateral blocks are desired a conversion from triangles to quadrilaterals finalizes the block generation e g using the method of rank et al 1993 to assure the quality of the generated block structure a smoothing postprocessing like freitag 1997 freitag et al 1999 may be applied as well a discrete mesh optimization procedure is used for boundary and element size adaption zint and grosso 2019 utilizing an appropriate quality metric see zint et al 2019 for details this method improves the mesh quality by iteratively repositioning vertices for each vertex a set of candidate positions is selected and the vertex is repositioned at the candidate position with the highest quality 5 numerical results in this section we present the results of our numerical tests and compare the results of the ghoddess implementation to those of utbest the main goals of these comparisons can be summarized as follows demonstrate that the accuracy and the stability of our quadrature free formulation is closely comparable to that of the swe solver that uses a standard quadrature based dg scheme test our block structured mesh methodology using realistic problems give a preliminary evaluation of the computational performance of the new swe solver developed within the exastencils framework the following numerical tests use meshes unless noted otherwise designed using a block structured topology required by the exastencils framework 5 1 analytical convergence test on a randomly perturbed regular mesh for the first test a rectangular domain ω 0 r 1000 r 0 r 1000 r is used where r is a randomly generated perturbation of up to 20 of the edge length cf fig 3 with the bathymetry specified as h b 1 1 1000 x 2 1000 y the convergence studies are conducted using an artificially manufactured analytical solution given by ξ x t 2 a 2 c a sin π x y c t t 600 u x t 2 a c a c t sin π x y c t t 600 v x t a c a c t sin π x y c t t 600 that is also used to provide suitable initial and dirichlet boundary conditions simulations were run for t 0 1 500 with the time step δ t 0 5 for piecewise constants and linears and δ t 0 01 for piecewise quadratics and cubics this time step was selected as sufficiently small to make the time discretization errors negligible compared to those of the spatial discretization the remaining parameters were chosen as follows c a 0 2 c t 0 2 a 0 3 fig 3 illustrates the mesh and the initial condition left and the final solution on the coarsest level 2 middle and level 6 right mesh for the piecewise linear k 1 dg discretization the errors for dg discretization spaces ranging from piecewise constants k 0 to piecewise cubics k 3 and the corresponding experimental convergence rates are listed in table 1 and plotted in fig 4 the expected convergence rates are demonstrated for all primary unknowns surface elevation and depth integrated velocity components due to increasing computational and code generation costs runs for higher order dg discretizations stop at coarser mesh resolutions than the low order runs nevertheless the absolute l 2 errors for higher order approximations are much smaller 5 2 supercritical flow in a constricted channel to demonstrate the robustness of our quadrature free implementation on a problem with a discontinuous solution we simulate supercritical flow in a constricted channel with constant bathymetry based on the configuration proposed by zienkiewicz and ortiz in zienkiewicz and ortiz 1995 the lateral channel boundary walls are constricted on both sides with constriction angle of 5 degrees producing reflective cross wave patterns flow is induced through the inflow bottom boundary the inlet froude number fr is defined by f r u g h where u and h are the axial velocity and water depth at the inlet respectively choosing for our test f r 2 5 the flow clearly is in a supercritical regime this problem can be solved analytically using methods presented by ippen in ippen 1951 the discontinuous analytical solution projected on the finest mesh ca 230 000 elements is plotted in fig 5 top right fig 5 top left displays the unstructured mesh with 3 155 elements and a block structured mesh with 3 584 elements generated for the ghoddess framework is shown in fig 5 top middle for our simulations the runs are started with constant elevation ξ 0 and constant velocity axial velocity equal to the inlet velocity cross flow velocity equal to zero and continued until a stationary state is reached at the lateral wall boundaries we impose the land no normal flow boundary conditions free surface elevation and velocity are specified at the inlet boundary and no boundary conditions are prescribed at the outlet boundary the results of our quadrature free implementation agree very well for all tested discretization orders k 0 1 2 with those produced by utbest on both unstructured and block structured meshes for comparison we present the steady state results for piecewise linear k 1 dg approximation in fig 5 for ghoddess quadrature free on the block structured mesh bottom left utbest quadrature based on the block structured mesh bottom middle and utbest quadrature based on the unstructured mesh bottom right in particular the important characteristics of the solution namely the shock positions and the plateau levels agree very well among all runs and do not display any sensitivity to either the mesh structure dg discretization order or quadrature based quadrature free type of the scheme since no slope limiting of any sort was used in our runs the solutions for the piecewise linear as well as for any higher order dg approximation display overshoots at the discontinuities however the shown results represent the converged steady state solutions and the overshoots do not pose any stability difficulties for either quadrature based or quadrature free scheme 5 3 tidal flow around bahamas our realistic example considers the tide driven flow at the bahamas islands the domain geometry and the bathymetry as well as the approximate positions of four recording stations for the free surface elevation and velocity with exact coordinates in meters 38 667 49 333 56 098 9 613 41 263 29 776 and 59 594 41 149 are illustrated in fig 6 right fig 6 left shows the original unstructured utbest finite element mesh consisting of 1 696 elements next to the block structured mesh generated for ghoddess framework containing 2 624 elements in fig 6 middle the bottom friction was given via a standard quadratic friction law τ bf c f u see e g vreugdenhil 1994 with coefficient c f 0 009 and the constant coriolis parameter was set to 3 19 10 5 s 1 the tidal forcing was prescribed at the open boundary consisting of five tidal components o1 k1 n2 m2 s2 given analytically by 22 ξ t 0 075 cos t 25 82 3 40 0 095 cos t 23 94 3 60 0 100 cos t 12 66 5 93 0 395 cos t 12 42 0 00 0 060 cos t 12 00 0 75 with t hours denoting the time elapsed from the beginning of the simulation and ξ meters the specified tidal elevation at the open sea boundary in real life ocean simulations the initial conditions are often unknown or very difficult to obtain therefore a so called cold start initialization was performed the fluid domain is assumed to be at rest initially ξ 0 0 q 0 0 and the boundary condition tidal elevation in this case was applied gradually over a period of two days using ramping a coefficient multiplying the amplitude of the tidal forcing set to zero at the beginning of the simulation and linearly increasing to one at the end of day two the ten day simulations were run with a constant time step of 15 seconds for the piecewise constant and piecewise linear dg discretization k 0 1 and of 10 seconds for the piecewise quadratic one k 2 the simulation results were compared to those obtained using the utbest model of aizinger and dawson the latter model had been validated for the bahamas test case by comparison to the adcirc 3 3 https adcirc org and station measurement results in aizinger and dawson 2002 fig 7 displays the exemplarily chosen station comparisons here we intentionally selected stations with the largest discrepancies between runs the other station results display similar or better agreement for the surface elevation at station 1 top the depth averaged x velocity at station 2 middle and the depth averaged y velocity at station 4 bottom using the station comparisons we aim to address several open questions concerning our approach quantify the effects of the modifications in the dg discretization necessitated by a quadrature free scheme and clarify the influence of block structured meshes on the simulation results the comparisons in fig 7 demonstrate excellent agreement for the surface elevation top plot for all different runs utbest quadrature based scheme for k 1 on the original unstructured mesh given in fig 6 left utbest quadrature based scheme for k 0 1 2 on the block structured mesh displayed in fig 6 middle and ghoddess quadrature free scheme for k 0 1 2 on the same block structured mesh using a zoom in of the last elevation minimum one can clearly see that the differences between the results for various discretization orders are much greater than the differences due to the quadrature integration or due to the mesh type the depth averaged velocities shown in the middle and bottom graphs of fig 7 display somewhat more sensitivity this finding is fully consistent with the station comparisons performed in aizinger and dawson 2002 one should also note that the absolute deviations in the x and y velocities are similar however the x velocity plot for station 2 presented in fig 7 exaggerates those differences due to the much smaller x velocity amplitude and correspondingly the much finer scale of the vertical axis a more elaborate comparison between the quadrature based results produced by utbest and quadrature free simulations obtained using ghoddess on the same block structured mesh is shown in fig 8 for the elevation field at the end of day 10 of the simulation displayed in fig 8 top left we calculate the difference plots between the utbest and the ghoddess results for the piecewise constant fig 8 top right piecewise linear fig 8 bottom left and piecewise quadratic fig 8 bottom right dg discretizations note that the effects of the quadrature free scheme increase with the order of the discretization this finding is hardly surprising and caused by the evaluation of edge fluxes that in the piecewise constant case leads to nearly identical discrete expressions with the rising order of the discretization the number of edge quadrature points grows and so do the differences in the edge flux computation between the quadrature based and quadrature free scheme see 17 and the corresponding discussion in section 2 2 nevertheless these differences are very small and even in the worst case k 2 do not exceed 1 of the calculated value of the surface elevation last but not least two properties of our quadrature free discretization have to be mentioned here that play an important role for the shallow water equations the local conservation of all primary unknowns and the well balancedness for zero velocity conditions similarly to the original dg scheme realized in utbest these properties hold for the new quadrature free implementation since the modifications only concern the evaluation of the element and edge integrals whereas no balance or conservation relationships have been affected and no artificial terms have been introduced the latter property was explicitly verified by running the bahamas test case in a lake at rest configuration not shown here the former property can be shown analytically by choosing a discrete test function equal to one on a single element and zero otherwise 5 4 performance results and comparison to a quadrature based implementation to asses the performance of our implementation we show serial and parallel execution times and compare those to the timings of the serial quadrature based implementation of utbest described in dawson and aizinger 2002 and aizinger and dawson 2002 measurements were carried out on a single workstation featuring two intel xeon gold 5122 cpus with 4 cores each running at 3 60 ghz we consider two test cases first we evaluate the analytical example described in section 5 1 on the square domain with a randomly perturbed mesh it consists of between 128 and 32 768 triangular elements for refinement levels between three and seven respectively second we consider the tide driven flow on a realistic domain described in section 5 3 represented by a block structured mesh with 82 blocks containing between 32 and 2 048 triangular elements each for refinement levels between two and five respectively for a total number of elements ranging from 2 634 to 167 936 both scenarios are evaluated for piecewise constant k 0 linear k 1 and quadratic k 2 dg discretizations for parallel runs we use a pure openmp parallelization with 16 threads which is automatically generated by the exastencils framework in addition to already discussed points the key differences between the utbest and ghoddess implementations are utbest is a hybrid fortran 77 c code with the main numerical parts implemented in c utbest performs all calculations in the single floating point accuracy whereas ghoddess generated solvers use the double precision ghoddess generated solvers allow timing the actual solving routine whereas only timing the whole program execution is possible for utbest we address this by averaged measured times over 1 000 time steps for the bahamas test with k 2 and 10 000 time steps for all other cases thereby rendering initialization overhead negligible table 2 summarizes obtained execution times per time step in ms comparing the serial performance of utbest and ghoddess we find that the new code generation approach performs better in almost all cases as described previously it can be parallelized automatically which in the present case improves performance considerably as long as enough work is available for smaller meshes the overhead of the openmp synchronization outweighs the potential speed up this could be addressed by using fewer threads utilizing only one socket or switching to a different openmp implementation such optimization are however the focus of future work just as an in depth scalability test of our generated solvers 6 conclusion and outlook this work introduced for the first time the quadrature free functionality for a swe model based on a discontinuous galerkin discretization the proposed scheme has been implemented in our novel ghoddess python package that naturally extends the exastencils code generation toolchain this allows re using already implemented optimizations strategies for automatic parallelization and now also automatically generated block structured meshes the new approach shows a considerable performance improvement compared to that of the swe solver that uses a standard quadrature based dg scheme while achieving comparable accuracy and stability in our future work we consider transferring our techniques to 3d coastal ocean models such as the one implemented in utbest3d dawson and aizinger 2005 aizinger et al 2013 reuter et al 2015 to complete the code generation pipeline we plan to provide and incorporate the ufl unified form language as alternative mode of input for ghoddess we also work on restructuring parts of our python implementation to speed up the generation process as well as on evaluating and if necessary improving node level performance and scalability on a range of different hardware architectures finally we will further compare the quality of block structured and unstructured meshes in order to improve the solution quality and performance of our automatically generated block structured meshes credit authorship contribution statement sara faghih naini software validation formal analysis investigation visualization writing original draft data curation sebastian kuckuk methodology software investigation writing original draft data curation vadym aizinger conceptualization methodology software writing original draft visualization supervision project administration funding acquisition daniel zint software methodology data curation writing original draft roberto grosso conceptualization methodology project administration funding acquisition supervision harald köstler conceptualization methodology project administration funding acquisition supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors acknowledge financial support by the german research foundation dfg through grants ai 117 6 1 ko 4641 1 1 and gr 1107 3 1 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103552 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
513,this article presents numerical investigations on accuracy and convergence properties of several numerical approaches for simulating steady state flows in heterogeneous aquifers finite difference finite element discontinuous galerkin spectral and random walk methods are tested on two dimensional benchmark flow problems realizations of log normal hydraulic conductivity fields are generated by kraichnan algorithms in closed form as finite sums of random periodic modes which allow direct code verification by comparisons with manufactured reference solutions the quality of the methods is assessed for increasing number of random modes and for increasing variance of the log hydraulic conductivity fields with gaussian and exponential correlation experimental orders of convergence are calculated from successive refinements of the grid the numerical methods are further validated by comparisons between statistical inferences obtained from monte carlo ensembles of numerical solutions and theoretical first order perturbation results it is found that while for gaussian correlation of the log conductivity field all the methods perform well in the exponential case their accuracy deteriorates and for large variance and number of modes the benchmark problems are practically not solvable with reasonably large computing resources for all the methods considered in this study keywords darcy flow accuracy convergence computational feasibility finite difference finite element discontinuous galerkin spectral methods global random walk msc 65n06 65n30 65n35 65n12 76s05 86a05 1 introduction solving the flow problem is the first step in modeling contaminant transport in natural porous media formations since typical parameters for aquifers often lead to advection dominated transport problems dagan 1989 accurate flow solutions are essential for reliable simulations of the effective dispersion of the solute plumes the numerical feasibility of the flow problem in realistic conditions has been addressed in a pioneering work by ababou et al 1989 who pointed out that the discretization steps must be much smaller than the heterogeneity scale which in turn is much smaller than the dimension of the computational domain such order relations also served as guidelines for implementing solutions with finite difference methods fdm de dreuzy et al 2007 kurbanmuradov and sabelfeld 2010 trefry et al 2003 or finite element methods fem bellin et al 1992 radu et al 2011 salandin and fiorotto 1998 used in monte carlo simulations in spectral approaches gotovac et al 2007 li and mclaughlin 1991 or probabilistic collocation and chaos expansion approaches li and zhang 2007 li et al 2009 the spatial resolution is also related to the number of terms in the series representation of the coefficients and of the solution of the flow problem despite the advances in numerical methods computing accurate flow solutions for highly heterogeneous formations faces computational challenges in terms of code efficiency and computational resources see e g gotovac et al 2009 li and zhang 2007 field experiments show a broad range of heterogeneities of the aquifer systems characterized by variances σ 2 of the log hydraulic conductivity from less than one for instance at borden site ontario rajaram and gelhar 1991 ritzi and soltanian 2015 up to variances between σ 2 3 4 and σ 2 8 7 at the macrodispersion experiment made site in columbus mississippi bohling et al 2016 rehfeldt et al 1992 the geostatistical interpretation of the measured conductivity data is often based on a log normal probability distribution with an assumed exponential correlation model bohling et al 2016 gelhar 1986 rehfeldt et al 1992 but since dispersion coefficients do not depend on the shape of the correlation function dagan 1989 and are essentially determined by the correlation scale rajaram and gelhar 1991 a gaussian model can be chosen as well kurbanmuradov and sabelfeld 2010 trefry et al 2003 moreover experimental data from borden made and other sites can be reinterpreted by using a multifractal analysis and power law correlations liu and molz 1997 molz and boman 1995 molz et al 1997 random fields with power law correlations can be generated as linear combinations of random modes with either exponential or gaussian correlation di federico and neuman 1997 suciu et al 2015 therefore the influence of the correlation structure on the accuracy of the numerical solutions of the flow problem can be generally analyzed by considering gaussian and exponential correlations of the log conductivity field numerical simulations of flow and transport in groundwater were carried out with a fem for increasing log conductivity variance from small to moderate values e g up to σ 2 1 6 by bellin et al 1992 similar investigations were performed with fdms for variances as high as σ 2 9 in de dreuzy et al 2007 or σ 2 16 in kurbanmuradov and sabelfeld 2010 though an exponential shape of the log conductivity correlation is considered in most cases a gaussian shape which yields smoother fields could be preferred for numerical reasons trefry et al 2003 different approaches were validated through comparisons with linear theoretical approximations of first order in σ 2 and the numerical methods were further used to explore the limits of the first order theory a direct validation of the flow solver by comparisons with analytical manufactured solutions has been done by kurbanmuradov and sabelfeld 2010 for both gaussian and exponential correlations with the same variance σ 2 1 of the log conductivity field accurate fems were developed to ensure the consistency of the numerical fluxes with darcy s law putti and cordes 1998 cordes and putti 2001 the mass conservation of the numerical scheme radu et al 2017 and the head continuity at the interface between two materials with contrasting hydraulic properties cainelli et al 2012 with focus on satisfying the refraction law at the interfaces between blocks with different hydraulic conductivity cainelli et al 2012 used advanced fem and velocity postprocessing approaches to solve the flow problem for weak and moderately heterogeneous aquifer structures the convergence of the numerical schemes is assessed by comparisons with analytical solutions for block constant hydraulic conductivity with sharp contrast for further validation the convergence to the same velocity variances of the predictions obtained with different numerical schemes was investigated through a monte carlo approach while almost no discrepancy was observed for the gaussian correlation model for the exponential model one obtains large relative differences for the variance of both longitudinal and transverse velocity in the case of the largest variance of the log hydraulic conductivity considered in their study σ 2 2 serious challenges are posed by exponential correlation models with higher variances when conductivity differences may span several orders of magnitude using a spectral collocation approach based on expansions of the solution in series of compactly supported and infinitely differentiable atomic functions gotovac et al 2009 tested the flow solver for variances up to σ 2 8 the accuracy of the solution was assessed with mass balance errors between control planes the criterion of small grid péclet number defined with advection velocities given by the derivatives of the log hydraulic conductivity and constant unit diffusion coefficient highlighted by expanding the second order derivatives in the flow equation as well as by corrections of the solution induced by the increase of the number of collocation points it was found that increasing the resolution of the log hydraulic conductivity requires increasing the resolution of the solution to fulfill the accuracy criteria while for gaussian correlation of the log hydraulic conductivity the desired accuracy is achieved for σ 2 up to 8 with relatively small number of collocation points per integral scale in the case of the exponential correlation which requires increasing resolution with increasing σ 2 the required resolution of the solution may lead to problem dimensions which exceed the available computational resources gotovac et al 2009 section 5 2 in line with the investigations discussed above we present in this article a comparative study of several numerical schemes for the darcy flow equations based on different concepts the schemes will be tested in terms of accuracy and convergence behavior on benchmark problems designed for a broad range of parameters describing the variance and the spectral complexity of the log hydraulic conductivity fields with both gaussian and exponential correlation structures used as models for heterogeneous aquifers comparisons of numerical schemes for flow problems have been made for constant hydraulic parameters the goal being to solve nonlinear reactive transport problems carrayrou et al 2010a 2010b for constant parameters on sub domains and complex geometry in order to simulate flow in fractured porous media de dreuzy et al 2013 flemisch et al 2018 by considering functional dependence of the hydraulic conductivity on temperature for coupled flow and heat transport grenier et al 2018 or in the case of heterogeneous hydraulic conductivity fields with low variability radu et al 2011 such comparative studies use benchmark problems and code intercomparison for the validation of the numerical methods carrayrou et al 2010a or whenever available comparisons with analytical solutions for the purpose of code verification e g grenier et al 2018 in the present study we adopt a different strategy the hydraulic conductivity is generated as a realization of a kraichnan random field kraichnan 1970 in a closed form consisting of finite sums of cosine random modes with a robust randomization method kramer et al 2007 kurbanmuradov and sabelfeld 2010 unlike in turning bands mantoglou and wilson 1982 or hydro gen bellin and rubin 1996 methods the kraichnan approach allows a direct control of the accuracy of the field by increasing the number of modes and of its variability through the variance of the log hydraulic conductivity random field moreover the explicit analytical form of the generated field allows the computation of the source term occurring when a manufactured analytical solution is forced to verify the flow equation brunner et al 2012 frank et al 2015 kurbanmuradov and sabelfeld 2010 oberkampf and blottner 1998 radu et al 2011 roache 2002 roy 2005 a realization of the hydraulic conductivity and the source term are computed by summing up cosine modes with parameters given by a fixed realization of the wave numbers and phases produced by the randomization method these parameters are computed with c codes and stored as data files codes written in different programming languages for instance matlab c or python load the same data files to construct precisely the same manufactured solution to be used in code verifications one obtains in this way a benchmark to evaluate the performance of different numerical methods for a wide range of variances of the log hydraulic conductivity and of the number of random modes considering beside the variance of the log conductivity the influence of the number of modes is crucial for several reasons this quantity controls the accuracy of the generated hydraulic conductivity fields and thus ensures accurate statistical simulations of the solutions of the partial differential equations which govern the darcy flow it also affects the ergodicity properties kramer et al 2007 kurbanmuradov et al 2013 of the simulation methods which infer statistics by performing spatial averages suciu et al 2016 the number of modes in randomization methods increases with the order of magnitude of the ratio between the maximum and the minimum length scales of the random field structure which has to be captured in numerical simulations while the maximum length scale should be larger than the correlation length of the random field and is practically given by the scale of the simulation the minimum scale is a smoothness microscale determined by the correlation length of the spatial increments of the field which is an analogous correlation length for the gradient of the random field e g kramer et al 2007 section 2 the relation between the number of modes and the scale ratio is determined by the correlation structure of the random field for instance for power law correlations it has been shown analytically that this relation is logarithmic or at most linear depending on the details of the randomization method kramer et al 2007 in the case of an exponential correlation and a small variance of the log hydraulic field it has been demonstrated by numerical investigations that in order to ensure the self averaging behavior of the simulated transport process the number of modes in the kraichnan routine has to be of the order of the number of correlation lengths traveled by the solute plume eberhard et al 2007 fig 4 hence while the variance characterizes the spatial heterogeneity of the aquifer system the number of modes used in the kraichnan randomization method to obtain accurate approximations of the hydraulic conductivity increases with the spatial scale of the flow and transport problem we compare the accuracy of the fdm the fem the discontinuous galerkin method dgm the chebyshev collocation spectral method csm and a newly developed global random walk method grw by solving two dimensional problems a galerkin spectral method gsm is tested only in the one dimensional case code verification is done by evaluating the errors with respect to manufactured analytical hydraulic head solutions for combinations of parameters of the kraichnan routine i e variances σ 2 of the log hydraulic conductivity between 0 1 and 6 and two different number of modes n 10 2 and n 10 3 estimations of the convergence order are obtained numerically by successive refinements of the discretization the codes verified in this way are further used to solve the homogeneous equation for the hydraulic head and to compute the darcy velocity ensembles of 100 realizations of the flow solution are computed and used in monte carlo inferences of the statistics of the hydraulic head and of the components of the darcy velocity the numerical methods are validated by comparisons with first order theoretical results bakr et al 1978 dagan 1989 mizell et al 1982 in order to test the numerical methods in conditions of hydraulic conductivity with increasing variability comparisons are done for log hydraulic conductivities with exponential and gaussian correlations testing the numerical schemes for these correlation models is highly relevant from the point of view the numerical difficulty of solving the flow problem indeed while the gaussian correlation ensures the smoothness of the generated hydraulic conductivity samples in the case of the exponential correlation the smoothness significantly deteriorates with the increase of the number of modes the generated samples approaching non differentiable functions in the limit of an infinite number of modes suciu 2010 2019 the remainder of this paper is organized as follows section 2 presents the benchmark problems the kraichnan randomization method and some considerations about the sample smoothness of the generated hydraulic conductivity fields with gaussian and exponential correlation the numerical schemes considered in this study are described in section 3 the results of the code verification by manufactured solutions are presented in section 4 1 and the convergence results in section 4 2 section 5 presents monte carlo inferences and comparisons with first order theory finally some conclusions of the present study are drawn in section 6 appendix a presents the computation of the manufactured solutions and appendix b contains tables with estimated order of convergence supplementary materials s1 s4 associated with this article are available in the online version 2 benchmark flow problems we consider the two dimensional steady state velocity field in saturated porous media with constant porosity determined by the gradient of the hydraulic head h x y according to darcy s law dagan 1989 1 v x k h x v y k h y where k x y is an isotropic hydraulic conductivity consisting of a fixed realization of a spatial random function the velocity solves a conservation equation v x x v y y 0 which after the substitution of the velocity components 1 gives the following equation for the hydraulic head 2 x k h x y k h y 0 we are looking for numerical solutions of the equations 1 2 in a rectangular domain x y ω 0 l x 0 l y subject to boundary conditions given by 3 h 0 y h h l x y 0 y 0 l y 4 h y x 0 h y x l y 0 x 0 l x where h is a constant head the hydraulic conductivity fields k considered in this study are isotropic log normally distributed with exponential and gaussian correlations the random log hydraulic conductivity field y ln k is specified by the ensemble mean y the variance σ 2 and the correlation length λ the kraichnan algorithm kraichnan 1970 used to generate samples of fluctuating part of the log hydraulic conductivity field y y y is a randomized spectral representation of statistically homogeneous gaussian fields kramer et al 2007 a general randomization formula valid for both exponential and gaussian correlation types is given by a finite sum of n cosine functions 5 y x y σ 2 n i 1 n cos ϕ i 2 π k i 1 x k i 2 y the probability density of the random vector k i 1 k i 2 is given by the fourier transform of the correlation function of the statistically homogeneous random field y divided by the variance σ 2 and the phases ϕi are random numbers uniformly distributed in 0 2π kurbanmuradov and sabelfeld 2010 eq 22 the smoothness of the k field is essentially determined by the correlation of the random field y sufficient conditions for sample smoothness are given by the existence of higher order derivatives of the correlation function c r y x y x r for instance in the one dimensional case if c r has a second order derivative at r 0 then the one dimensional field y x is equivalent to a field with samples that are continuous with probability one in every finite interval moreover if the fourth derivative c 4 0 exists y x is equivalent to a field the sample functions of which have with probability one continuous derivatives in every finite interval these sufficient conditions can hardly be relaxed and one expects that they are very close to the necessary conditions cramér and leadbetter 1967 yaglom 1987 the smoothness conditions of cramér and leadbetter 1967 are fulfilled for instance if the correlation of y has a gaussian shape c r e r 2 and is infinitely differentiable which results in a random field 5 with continuous sample derivatives a counterexample is the field y with an exponential correlation c r e r which is not differentiable at the origin since rigorously speaking the differentiability of c r at the origin is only a sufficient condition we proceed with numerical investigations on the sample smoothness of the k field for gaussian and exponential correlations of the log hydraulic conductivity y with λ 1 and σ 2 0 1 the estimations of the spatial derivative dk dx of a given realization of the numerically generated one dimensional k field with n 10 2 random modes in 5 computed at x 1 i δ x i 1 100 are presented in figs 1 and 2 in the case of the gaussian correlation the estimations approach the exact value of dk dx at x 1 obtained by differentiating the expression a 3 with y 1 fixed in the case of the exponential correlation of y the realization of the k field apparently approaches a non differentiable function for δx 102 then by further decreasing δx one observes a smooth behavior and the approach to the true value of dk dx at x 1 the impact of increasing the number of modes is illustrated by the convergence behavior of the numerical estimates of dk dx presented in figs 3 and 4 one remarks that while for gaussian correlation the number of modes has no impact the convergence towards the exact value of the derivative being practically achieved for δ x 10 2 for exponential correlation the resolution has to be increased four orders of magnitude δ x 10 6 to obtain an accurate approximation of the derivative when n increases one order of magnitude in order to investigate the robustness and the limits of applicability of the numerical schemes tested in this study we consider highly oscillating coefficients k generated by 5 for isotropic correlations of the random field y c r y x y y x r x y r y where r r x 2 r y 2 1 2 as correlation functions we consider the two extreme cases presented above i e the gaussian correlation 6 c r σ 2 exp r 2 λ 2 which yields analytical samples of y and respectively the exponential correlation 7 c r σ 2 exp r λ which in the limit of infinite number of modes n produces non smooth samples to compute the hydraulic conductivity k exp y exp y exp y the geometric mean k g exp y has to be specified either from experimental data or through its relation with other parameters of the flow problem such as the mean slope of the hydraulic head h l x j and the mean velocity u in this study we consider the second approach according to the boundary conditions 3 and 4 the mean velocity u 0 is aligned to the longitudinal axis x as an input in the field generator we use a mean hydraulic conductivity k related according to darcy s law 1 to the mean velocity and the mean slope by u k j further as far as we do not compare velocity fields for different σ 2 we generate random conductivity fields by using the relation between the arithmetic and the geometric mean of the log normal distribution k k g exp σ 2 2 the arithmetic mean approximates the effective hydraulic conductivity kh j if σ 2 1 gelhar 1986 zhang et al 2007 higher order corrections were also derived as asymptotic approximations for small σ 2 deng and cushman 1995 but our numerical tests have shown that neither of these corrections is appropriate for statistical inferences because they lead to underestimations of the mean velocity therefore to compare results obtained with different values of the parameter σ 2 presented in section 5 we normalize the velocity components by kgj see also kurbanmuradov and sabelfeld 2010 the mean hydraulic conductivity is fixed to k 15 m day a value representative for gravel or coarse sand aquifers dagan 1989 the correlation length λ in 6 and 7 is set to λ 1 m and the dimensions of the spatial domain are given in λ units in order to compare the results obtained by different schemes for a given realization of the field k the sets of wavenumbers k i 1 k i 2 and phases ϕi are computed with the algorithms for gaussian and exponential correlation functions described in kurbanmuradov and sabelfeld 2010 sects 5 2 and 5 3 implemented as c codes these coefficients computed for n m a x 10 4 modes i are stored as data files samples of the k field are further constructed for the desired numbers of modes n nmax and values of the variance σ 2 according to 5 the same numerical parameters can be used in either matlab c or python codes to ensure identical values of the k fields in the limit of double precision irrespective of the programming language for the purpose of statistical inferences ensembles of solutions of the flow equations are computed with the same algorithms implemented as functions in each particular scheme the longitudinal dimension of the domain lx has to be tens of times larger than λ for instance ababou et al 1989 recommend l x λ 25 constrained by considerations of computational tractability we fix the dimensions of the domain to l x 20 and l y 10 the constant head at the inflow boundary is fixed to h 1 to enable comparisons of the two dimensional solutions obtained with the fdm fem dgm and grw numerical schemes tested in the present benchmark the number of discretization points is set to n x 10 3 1 in the longitudinal direction and to n y 5 10 2 1 in the transverse direction consequently the space steps are fixed at δ x δ y 2 10 2 which for unit correlation length considered in this study gives λ δ x 50 this value is larger than the resolution of the log conductivity field usually considered in similar finite difference element approaches reported in the literature see e g bellin and rubin 1996 cainelli et al 2012 de dreuzy et al 2007 kurbanmuradov and sabelfeld 2010 the fixed resolution considered in this study is appropriate for flow solutions in the case of the gaussian correlation of the ln k field but could be too coarse in the case of the exponential correlation see figs 1 4 in the case of spectral approaches the number of collocation points for both csm and gsm schemes is chosen after preliminary tests as large as necessary possible optimal to ensure the desired accuracy see section 3 4 the codes based on the numerical schemes considered in this study are first verified by comparisons with manufactured solutions the approach consists of choosing analytical functions of the dependent variables h x y on which one applies the differential operator from the left hand side of eq 2 the result being a source term f hence h x y is an exact solutions of eq 2 with a source term f added in the right hand side and modified boundary functions according to the chosen manufactured solution e g roache 2002 roache 1998 an example of choosing the appropriate manufactured solution for the flow solver within a numerical setting similar to that of the present study can be found in kurbanmuradov and sabelfeld 2010 appendix b in order to test the numerical approximations of the differential operators in the flow eq 2 the manufactured solutions used in this study are simple but not trivial analytical functions with non vanishing derivatives up to the highest order of differentiation the construction of the manufactured solution and of the source term f is presented in appendix a for the purpose of code verification we chose 10 parameter pairs formed with σ 2 0 1 1 2 4 6 and the two numbers of modes considered in figs 3 and 4 n 10 2 and n 10 3 a larger set of 21 parameter pairs also including σ 2 8 σ 2 10 and n 10 4 has been considered in the extended version of this study alecsa et al 2020a note that the two values of n considered here are relevant for practical applications of the numerical codes a number of modes of the order 102 is required to obtain accurate simulations of the transport process over tens of correlation scales even for a small variance σ 2 0 1 and a linearized solution of the flow equation eberhard et al 2007 the larger number of modes n 10 3 is needed in the same conditions for simulation lengths of hundreds of correlation scales in the latter case the small spatial domain ω considered above can be thought of as a subdomain in a domain decomposition approach on the other hand the problem is linear and the correlation of the log hydraulic conductivity only depends on spatial lags scaled by the correlation length thus the results presented in this benchmark study also can represent solutions to problems with spatial dimensions scaled by the correlation length the code verification is completed by convergence tests aiming at comparing the computational order of convergence with the theoretical one for the fdm fem dgm and grw schemes computational orders of convergence are estimated by computing error norms of the solutions obtained by successively halving the spatial discretization step with respect to a reference solution obtained with the finest discretization see e g roy 2003 lord et al 2014 the approach is different in the case of spectral methods where the convergence is indicated by the decrease towards the round off plateau of the coefficients of the spectral representation aurentz and trefethen 2017 convergence tests are performed for n 10 2 10 3 and a larger range of variances σ 2 0 1 4 10 validations tests are finally conducted by comparing mean values and variances of the velocity components inferred from ensembles of 100 realizations of the solution of the homogeneous boundary value problem 1 4 for σ 2 0 1 0 5 1 1 5 2 and fixed n 10 2 with theoretical and numerical results given in the literature the formulation of the benchmark problems data files numerical codes and functions are given in a git repository alecsa et al 2020b which can help the interested readers to test their numerical methods for flows in highly heterogeneous aquifers 3 numerical methods in this section we describe the methods on which the codes participating in the present benchmark study are based for the fdm fem and dgm approaches based on well established finite difference element methods only a few aspects relevant for the construction of the numerical scheme will be summarized in the following the spectral approaches csm and gsm adapted to this benchmark as well as the grw algorithm using computational particles proposed in this article will be presented in more detail 3 1 finite difference method the finite difference method is known to be one of the most feasible and easily implementable numerical methods for partial differential equations larsson and thomée 2009 the inhomogeneous version of the flow problem 2 4 for the hydraulic head used in code verification tests consisting of comparisons with manufactured solutions presented in section 4 1 as well as the homogeneous problem 1 4 used to compute ensembles of velocity fields used for the validation purposes in section 5 are solved with the fdm of li et al 2017 the method leads to a linear system with a band matrix which is further solved with the mldivide function in our matlab implementation of the fdm codes the codes are based on the following discretization scheme 8 a i j h i 1 j b i j h i j 1 c i j h i j d i j h i 1 j e i j h i j 1 f i j where f i j i 1 n x j 1 n y represents the data f at the grid points xi yj and h i j is the value of the numerical solution at the same grid points in formula 8 we have used the following notations a i j 1 δ x 2 k x i δ x 2 y j b i j 1 δ y 2 k x i y j δ y 2 d i j 1 δ x 2 k x i δ x 2 y j e i j 1 δ y 2 k x i y j δ y 2 c i j a i j b i j d i j e i j 3 2 finite element method we consider the piecewise affine finite element method fem see e g knabner and angermann 2003 segerlind 1987 implemented in fenics alnæs et al 2015 the conductivity k and the source term f are interpolated into finite element spaces as well for this interpolation we consider piecewise quadratic elements better approximations can be obtained by taking higher order finite element spaces for k and f let us denote by γ1 0 lx 0 ly the part of the boundary where dirichlet conditions are imposed and by γ2 0 lx 0 ly the part of the boundary where neumann conditions are given consider a friedrichs keller triangulation t δ x where δ x δ y denotes the length of a short side of each isosceles right triangle the trial space contains continuous functions that are piecewise affine on each triangle and that satisfy the dirichlet boundary condition on γ1 the test space consists of continuous piecewise affine functions that vanish on γ1 for the non homogeneous eq 2 with right hand side f the linear fem solves for a trial function h δx such that for any test function φδx the following weak formulation is satisfied t δ x k h δ x φ δ x dx dy t δ x f φ δ x dx dy γ 2 k φ δ x h δ x ν ds where ν is the unit outward normal the assembled linear system of equations is solved with the default solver in fenics which is umfpack s unsymmetric multifrontal method 3 3 discontinuous galerkin method another method participating in the benchmark is the non symmetric interior penalty dgm we consider the same friedrichs keller triangulation t δ x as in the previous subsection assuming that the test and trial functions are element wise polynomials of degree at most p element wise multiplication of eq 2 with right hand side f by local test functions φδx with support only on t t δ x integration over t integration by parts and selection of suitable numerical fluxes yield the following equation for all t t δ x that are not adjacent to the domain s boundary t k h δ x φ δ x dx dy f f t f k φ δ x h δ x ν k h δ x φ δ x ν η δ x h δ x ν φ δ x ν d s t f φ δ x dx dy here f t denotes the set of faces of t ν is the unit outward normal with respect to t and η 0 is a stabilization parameter since the test and trial functions are discontinuous the numerical fluxes contain averages of functions the average of a function at a common interface f t t of elements t and t is component wise given as the arithmetic mean of the traces of this function the correct way to employ boundary conditions and precise definitions of the corresponding terms can be found in di pietro and ern 2012 riviere 2008 rupp 2019 the following simulations are carried out utilizing piecewise linear test and trial functions i e p 1 the implementation was made using the matlab octave toolbox festung frank et al 2015 the used dgm is known to be of convergence order 2 if the mesh is regular which holds in our case note that the dgm approach induces significantly larger linear systems of equations than a classical fem approximation of equal order on the same mesh this is due to the fact that for dgm schemes all elements contain three degrees of freedom dofs while for fem the corresponding dofs are shared across element boundaries this is illustrated in fig 5 where a coarse mesh is illustrated the center point is associated with six dofs in dgm while it is associated with a single dof in a fem approximation hence the size of the corresponding linear system of equations for dgm is approximately six times the size of the fem approximation when neglecting the boundary dofs where the ratio is only 3 1 and the corner dofs where the ratio is 2 1 or 1 1 as a consequence dgm approximations are more costly than fem approximations when performed on the same mesh but they also pose some advantages such as local mass conservation feasibility for local mesh and p adaptivity as well as an intuitive treatment of hanging nodes the linear systems of equations is solved with matlab s direct solver mldivide 3 4 spectral methods as an alternative to finite difference element methods we propose in the following the technique of collocation and galerkin spectral methods in order to solve one and two dimensional flow problems we refer to aurentz and trefethen 2017 weideman and reddy 2000 for a detailed description of the chebyshev collocation spectral method in our implementation of the csm schemes we use the explicit analytical expression a 3 of the two dimensional hydraulic conductivity field k x y for the one dimensional cases k x is obtained by setting y 1 in the expression a 3 of the two dimensional field these allow us to compute the derivatives k x x k x y and y k x y to avoid the need to know the analytical expression of the coefficients k we also adapt the algorithm of shen et al 2016 to construct a gsm approach for one dimensional flow problems 3 4 1 chebyshev collocation spectral methods we consider for the beginning the one dimensional problem 9 k h f x 0 l h 0 h h l 0 where f is a source sink term numerical solutions of the problem 9 are computed for a fixed length of the domain of l 200 for the beginning we homogenize the problem 9 by using the transformation 10 v x h x h l h 0 l x h 0 x 0 l replacing h x in 9 by 10 one obtains k x v x k x v x f x h l h 0 l k x x 0 l v 0 0 v l 0 further in order to apply the chebyshev spectral collocation we use the change of variables t 2 l x 1 to transform the flow problem from 0 l to 1 1 as follows 2 l k t v t 2 l 2 k t v t f t h l h 0 l k x t 1 1 v 1 0 v 1 0 where v t v l 2 t 1 k t k l 2 t 1 and k t k l 2 t 1 f t f l 2 t 1 the flow equation written in matrix form is given by 11 2 l diag k d 1 2 l diag k d 2 v f h l h 0 l k where d 1 and d 2 are the first and second order chebyshev differentiation matrices where we deleted the first and last rows and columns in order to incorporate the boundary conditions the matrices d 1 d 2 are generated with chebdif function given in weideman and reddy 2000 in the eq 11 k k and f are column vectors that contain the values of k k and f on the chebyshev nodes with the exception of the first and last points to establish the number of collocation points necessary to obtain the highest accuracy we first investigate the structure of the numerical solution of the non homogeneous version of the problem 9 in a scenario with extremely large parameters σ 2 10 and n 10 4 for gaussian correlation of the ln k field the source term and the dirichlet boundary conditions are obtained similarly to the procedure described in appendix a for the manufactured solution f x 3 sin x x 0 l in fig 6 we represent the absolute values of the coefficients of the solution s expansion in the phase space computed with the fast chebyshev transform versus the degree of the chebyshev polynomial we observe that for n 150 chebyshev points the coefficients reach the roundoff plateau since due to the accumulation of the truncation errors large numbers of points could result in an increased error we also compute the l error norm to establish the optimal value of n for gaussian and exponential correlation scenarios note that the analysis differs from case to case see alecsa et al 2020a tables 30 and 31 we also investigate the structure of the solution and the convergence for the homogeneous one dimensional problem f 0 in 9 for gaussian correlation of the ln k field and much smaller parameters σ 2 0 1 and n 10 2 see fig 7 in absence of an analytical solution of the homogeneous boundary value problem reaching the roundoff plateau is a guarantee that the numerical solution is highly accurate aurentz and trefethen 2017 we remark that at least n 2500 collocation points are needed to reach the roundoff plateau of the coefficients the much larger value of n is due to the spatial variability of the homogeneous solution see supplementary material s1 which cannot be represented by relatively small n as in the case of the simple manufactured solution of the non homogeneous problem in order to apply the chebyshev collocation method in the two dimensional case we reformulate the flow problem 2 4 into the square 1 1 2 similarly to the procedure used in the one dimensional case and we transform the boundary conditions by following the approach of hoepffner 2007 the optimal number of chebyshev points for the inhomogeneous problem is established similarly to the one dimensional case by increasing n from 44 to 64 in both directions and by computing the l error for combinations of parameters n and σ 2 in both gaussian and exponential scenarios see alecsa et al 2020a tables 34 and 35 in the case of the homogeneous two dimensional problem the roundoff plateau is reached with about n y 130 points in the y direction but a significantly larger number nx of points would be necessary in the x direction alecsa et al 2020a figs 8 and 9 since according to the discretization scheme 11 the dimension of the problem increases as n x 2 n y 2 solving homogeneous two dimensional problems with csm schemes requires much larger memory usage than finite difference element schemes 3 5 chebyshev galerkin spectral method for one dimensional flow problems the flow equation in 9 is a particular case of that considered in the gsm approach of shen et al 2016 α x u β x u f x x a b corresponding to α x 0 and β x k x the chebyshev galerkin spectral method of shen et al 2016 will be used in section 4 1 to solve one dimensional test problems unlike the csm schemes presented above the gsm approach avoids the need to compute the derivative of k by using the weak formulation of the problem the gsm approach can be applied to more general situations where an analytical form of the k field is not available 3 6 global random walk method grw algorithms solve parabolic partial differential equations by moving computational particles on regular lattices suciu 2014 2019 vamoş et al 2003 solutions of the elliptic equation for the hydraulic head with time independent boundary conditions can be obtained by solving the associated nonstationary equation with grw algorithms on staggered grids c vamoş 2016 unpublished following this idea we look for a solution of the flow eq 2 with a source term in the right hand side given by the steady state limit of the solution of the explicit staggered finite difference scheme 12 1 a δ t h i j k 1 h i j k 1 δ x 2 k i 1 2 j h i 1 j k h i j k k i 1 2 j h i j k h i 1 j k 1 δ y 2 k i j 1 2 h i j 1 k h i j k k i j 1 2 h i j k h i j 1 k f where a is a constant equal to a unit length the field of hydraulic head is further approximated with a system of n random walkers on the regular lattice of the finite difference scheme as h i δ x k δ t n i k a n considering in 12 δ x δ y as in section 2 the hydraulic conductivity the time step δt and the space step δx are related by the dimensionless parameter 13 r i j k i δ x j δ x a δ t δ x 2 with these the staggered scheme 12 becomes 14 n i j k 1 1 r i 1 2 j r i 1 2 j r i j 1 2 r i j 1 2 n i j k r i 1 2 j n i 1 j k r i 1 2 j n i 1 j k r i j 1 2 n i j 1 k r i j 1 2 n i j 1 k n f δ t where the source term is approximated by using the floor function the contributions to lattice sites i j from neighboring sites summed up in 14 are obtained with the grw algorithm which moves particles from sites l m to first neighbor sites according to 15 n l m k δ n l m l m k δ n l 1 m l m k δ n l 1 m l m k δ n l m 1 l m k δ n l m 1 l m k for consistency with eq 14 the stochastic averages of the quantities δ in 15 verify 16 δ n l m k 1 r l 1 2 m r l 1 2 m r l m 1 2 r l m 1 2 n l m k δ n l 1 m l m k r l 1 2 m n l m k δ n l m 1 l m k r l m 1 2 n l m k the parameters r defined by 13 are jump probabilities which as follows from 16 are restricted by 0 r 1 4 the δ terms in 15 are binomial random variables they are efficiently approximated by applying the relation for averages 16 to the actual numbers of particles at lattice sites next the reminders of multiplication by r and of the floor function applied to n f δ t are summed up and a particle is allocated to the lattice site where the sum of reminders reaches the unity see suciu 2019 section 3 3 2 2 giving up the particle indivisibility and representing n by real numbers one obtains a deterministic grw algorithm where the numbers of particles jumping to neighbor sites or remaining at the same site are exactly given by the relations 16 without average preliminary tests indicate that the grw algorithm with particles requires fewer time iterations to reach the steady state but the deterministic version which preforms fewer arithmetical operations per iteration step is overall faster therefore in the following we use the deterministic grw algorithm implemented in matlab or c codes to solve the flow equation by the grw algorithm 13 16 the boundary conditions 3 and 4 have to be completed by appropriate initial conditions the homogeneous problem f 0 is solved for an initial condition given by the mean slope of the pressure head determined by the dirichlet boundary conditions for comparison with analytical manufactured solutions the inhomogeneous problem f 0 is solved for an initial condition given be the analytical solution itself for an arbitrary initial condition one obtains a transitory non stationary grw solution which approaches the stationary solution after a number of time iterations depending on the level of difficulty of the particular problem the steady state is indicated by a constant number of particles or in the case of the deterministic grw by the total mass defined as integral of the solution over the lattice normalized by the final mass as illustrated in figs 8 and 9 for different solutions of the homogeneous problem the iterations needed to obtain stationary solutions require considerably large computing time from 10 minutes for 2 106 iterations to 2 5 hours for 2 107 iterations faster computations can be designed by using a domain decomposition parallelization of each iteration most of the computations were carried out with a matlab implementation of the grw code for the comparisons with manufactured solutions in the case of the exponential correlation of the ln k field which take very long time we use an executable mex function of a c implementation of the flow solver this procedure speeds up the computation by a factor of 1 5 4 benchmark tests 4 1 code verification by manufactured solutions the non homogeneous problem problem 2 4 with source term given by a 4 and modified dirichlet and neumann boundary conditions a 2 is solved on the two dimensional domain described in section 2 the problem is parameterized by using the sets of wavenumbers and phases for a fixed realizations of the ln k field stored in the git repository flowbenchmark alecsa et al 2020b the fdm fem dgm and grw schemes are constructed on uniform grids with step sizes δ x δ y 2 10 2 in all cases excepting those of grw solutions for gaussian correlation where δ x δ y 10 1 and the errors of the numerical solutions h i j with respect to the manufactured solution h xi yj given by a 1 are quantified by the discrete l 2 norm the csm solutions are computed for the optimal number of chebyshev points identified by preliminary tests as explained in section 3 4 1 above and the errors at collocation points are quantified by the vector l norm the code verification results for the two values of n and increasing variances of the ln k field are presented in tables 1 4 as shown in table 1 all the methods solve the test problems in the gaussian cases with n 10 2 with a good or at least an acceptable accuracy the increase of the number of modes to n 10 3 table 2 affects the accuracy of the fdm and grw schemes which produce errors larger that one i e 50 from the maximum value of the manufactured solution a 1 for σ 2 6 fdm and σ 2 2 grw there are also significant differences among the methods the accuracy of the dgm scheme is one and two orders of magnitude better than that of the fdm and fem schemes and the precision of the csm scheme is close to the roundoff plateau the grw solutions computed on a coarser grid are still accurate up to n 10 3 and σ 2 1 since the time needed to reach steady state grw solutions ranges from a few minutes to a couple of hours for the cases shown in these tables the cases with σ 2 2 were not investigated with the grw method for exponential correlation of the ln k field excepting csm the accuracy of all the other schemes is affected by the increase of n and σ 2 tables 3 and 4 for the fdm and the fem schemes the errors become larger than one for n 10 2 with σ 2 1 and σ 2 2 respectively and take huge values of the order 103 and 102 respectively for n 10 3 and σ 2 6 accurate dgm solutions are realizable for σ 2 2 in case n 10 2 and for σ 2 1 in case n 10 3 for the same resolution of the grid δ x δ y 2 10 2 stationary grw solutions in exponential cases can be obtained after considerable large numbers of iterations from 106 to more than 108 which require computing times from hours to days note that in the cases n 10 3 with σ 2 1 and σ 2 2 the grw solutions are not yet strictly stationary and the corresponding l 2 values have to be regarded as lower bound errors in these circumstances accurate grw solutions are feasible for n 10 2 and σ 2 1 or for n 10 3 and σ 2 0 1 the extremely small errors of the csm solutions should not be surprising for a fixed realization of the random field k the coefficients and their derivatives used in the csm schemes are analytical functions see section 3 4 1 the source function a 4 is an analytical function as well since all these functions are evaluated at the collocation points with the machine precision the only source of errors can be the limited number of points used to represent the solution this number is relatively small in the case of the smooth analytical solution a 4 if the same problem is solved with the gsm scheme which does not use the derivative of the coefficients a much larger number of points is needed to resolve the structure of the k and f fields this situation is illustrated by the comparison of the csm and gsm errors in table 5 which shows that accurate gsm solutions are obtained by increasing the density of the collocation points by one order of magnitude in the case of the gaussian correlation of the ln k field and by two orders of magnitude in the exponential case 4 2 convergence results numerically estimated orders of convergence eoc of the fdm fem dgm and grw schemes for combinations of parameters n and σ 2 are presented in appendix b they are computed from numerical solutions of the homogeneous problem obtained for successive refinements of the grid according to formula b 1 for the non stationary grw scheme the eoc values are computed from solutions on refined grids after the first temporal iteration in the gaussian case the eoc values are close to the theoretical convergence order 2 for all schemes see tables b 1 b 3 b 5 and b 7 the situation is different in the case of the exponential correlation of the ln k field the results for the fdm scheme presented in table b 2 show an irregular behavior of the eoc values negative values corresponding to non monotonous decrease of the error and the lack of a general decreasing trend of the errors for almost all combinations of n and σ 2 for the other three schemes there are no negative eoc values but the order of convergence deteriorates to 1 or 1 5 in most cases see tables b 4 b 6 and b 8 hence the convergence behavior is strongly influenced by the shape of the correlation function but there is no evidence for a dependence on n and σ 2 the convergence of the csm scheme can be assessed indirectly by verifying the behavior of the chebyshev coefficients as we have seen in section 3 4 1 the convergence of the csm scheme for homogeneous problems requires much larger numbers of collocation points than in the inhomogeneous cases with the maximum number of 160 points on both spatial directions permitted by the computational constraints the solutions for n 10 2 and σ 2 0 1 are accurate enough to be used in monte carlo simulations only for gaussian correlation of the ln k field with the same parameters and exponential correlation function the csm scheme may produce quite inaccurate solutions for some realizations of the k field see section 5 below 5 statistical inferences ensembles of numerical solutions of the flow problem are often used for the purpose of validation of the numerical schemes through comparisons with first order approximation results e g bellin et al 1992 de dreuzy et al 2007 salandin and fiorotto 1998 srzic et al 2013 the latter are obtained by perturbation expansions truncated at the first order in σ 2 equivalent to a linearization of the flow problem 1 4 e g dagan 1989 gelhar and axness 1983 here we consider first order approximations of the velocity field numerically generated with a kraichnan procedure based on proportionality of the spectral densities of the random velocity and that of the ln k field suciu et al 2016 appendix a the number of random periodic modes used in the kraichnan generators of the hydraulic conductivity and of the velocity field in the case of the linear approximation is set to n 100 validation tests of the five schemes are performed for ln k fields with gaussian and exponential correlations and a fixed small variance σ 2 0 1 the deviation from the predictions of the linear approximation is further investigated with the fdm fem dgm and grw schemes for increasing σ 2 of 0 5 1 1 5 and 2 the number of realizations in all cases investigated here is fixed to r 100 numerical investigations indicate that the chosen values of the parameters n and r ensure unbiased statistical estimations of the dispersion of a passive scalar transported over tens of correlation lengths in heterogeneous aquifers characterized by a small variance σ 2 0 1 of the ln k field eberhard et al 2007 the homogenous problem 1 4 is solved in the same two dimensional domain with l x 20 and l y 10 as that used for code verification tests in the previous section graphical illustrations and analysis of numerical solutions are given in supplementary materials s1 to s4 the ensemble of realizations were computed for space steps δ x δ y 0 02 with the fdm scheme and to reduce the computational effort for larger steps δ x δ y 0 05 with the fem and dgm schemes and δ x δ y 0 1 with the grw scheme constrained by the maximum matlab array size allowed on the computer used to obtain csm solutions we use a limited number of 160 chebyshev collocation points in both x and y directions even though a larger number of points in x direction is required to obtain accurate solutions see alecsa et al 2020a fig 9 sample solutions obtained with fdm are illustrated in supplementary material s1 fem dgm and grw solutions not shown in s1 have a similar appearance instead among the realizations of the csm solution for exponential correlation of the ln k field there also are unacceptable solutions with extremely large and irregular variations therefore we selected an ensemble of 100 valid realizations by disregarding the bad solutions after the visual inspection of the larger initial ensemble of solutions as illustrated in supplementary material s2 the issue of bad realizations is common in situations where due to computational constraints numerical simulations have to be conducted on relatively coarse grids we already encountered this issue during the preparation of the transport simulations presented in radu et al 2011 suciu et al 2013 monte carlo inferences of the mean and variance are obtained by computing averages over the ensembles of r realizations followed by spatial averages suciu et al 2006 appendix b3 error bounds of the ensemble space averages are given by standard deviations of the ensemble averages at grid points estimated by spatial averages the spatial averaging domain is an inner region of the computational domain unaffected by the boundary conditions approximately delimited by visual inspection of the variances estimated on longitudinal and transverse sections through the computation domain presented in supplementary materials s3 and s4 see also bellin et al 1992 kurbanmuradov and sabelfeld 2010 theoretical investigations indicate that the variance of the hydraulic head is much smaller than that of the hydraulic conductivity spectral perturbation approaches for flow in two and three dimensions predict variances of the order σ h 2 σ λ j 2 ababou et al 1989 bakr et al 1978 mizell et al 1982 the estimated variances presented in table 6 show an acceptable agreement with the spectral theory which for our numerical parameters predict σ h 2 10 4 the first order approximate relations between the variance of the velocity components σ v x 2 and σ v y 2 and the variance σ 2 of the ln k field are given by σ v x 2 3 8 σ 2 u and σ v y 2 1 8 σ 2 u respectively dagan 1989 eq 3 7 27 note that these relations do not depend on the shape of the correlation function of the ln k field since as mentioned in section 2 for the purpose of statistical inferences we use dimensionless velocities u 1 then with the smallest variance of the ln k field considered in this study σ 2 0 1 the velocity variances predicted by the linear theory are σ v x 2 3 75 10 2 and σ v y 2 1 25 10 2 respectively the estimated mean values and variances of the velocity components are presented in tables 7 and 8 fdm fem dgm and grw results are generally close to the theoretical first order predictions within a range of less than 10 for the fdm fem dgm and grw approaches excepting fem estimated variance of the transverse velocity in the gaussian case which deviates with about 30 csm results show deviations of about 30 for the variance of the transverse velocity in the gaussian case and deviations even larger than 100 for both velocity variances in the exponential case these differences can be again attributed to the limited number of collocation points used in the csm approach the results obtained with the fdm fem dgm and grw approaches for larger σ 2 are shown in figs 10 and 11 we remark that the velocity variances progressively increase above the trend predicted by the linear theory similarly to the monte carlo results presented in the literature e g bellin et al 1992 kurbanmuradov and sabelfeld 2010 salandin and fiorotto 1998 the differences between the results obtained with the three methods remain within the estimated error bounds determined by the present numerical setup number of realizations resolution and dimension of the computational domain for σ 2 0 5 the estimated variances practically coincide with the first order predictions within this range velocity fields can be quite well approximated by the linearized solution of the flow problem and simulations of solute transport in groundwater can be carried out with kraichnan generated velocity fields at lower computational costs suciu et al 2006 suciu 2014 suciu et al 2016 we conclude this section with a remark about the grw results the ensembles of grw simulations were computed for 106 iterations in all cases excepting the gaussian case with σ 2 2 where the number of iterations was set to 5 106 as indicated by figs 8 and 9 as well as by supplementary materials s3 and s4 these numbers of iterations are not large enough to ensure the convergence of the solution for homogeneous problems surprisingly the variance estimates from tables 7 and 8 deviate with maximum 10 from the predictions of the first order theory for small σ 2 for larger σ 2 the grw results are also close to those obtained with the fdm fem and dgm schemes for σ 2 2 in gaussian case fig 10 and for σ 2 0 5 in exponential case fig 11 6 discussion and conclusions the numerical approaches tested in the present benchmark study passed at least partially the validation test consisting of comparisons of the numerical solutions obtained for σ 2 0 1 and n 100 with theoretical results provided by first order perturbation approaches for larger variances up to σ 2 2 the statistical inferences performed by averaging over monte carlo ensembles of solutions given by the fdm fem dgm and grw schemes were close to those obtained by simulations with similar numerical setup reported in the literature however these encouraging results are not a guarantee for the accuracy of the numerical method for higher values of σ 2 and n needed to solve the flow problem for highly heterogeneous aquifers and large spatial scales this is indicated for instance by the situation of the grw ensembles of solutions for gaussian correlation of the ln k field which provide satisfactory statistical estimates even though they are not yet convergent see section 5 and cannot be used for single realization approaches in subsurface hydrology for gaussian correlation of the ln k field the code verification tests were accurately solved with the exception of the fdm solution for n 10 3 and σ 2 6 and that of the grw solutions for n 10 3 and σ 2 2 instead in the case of the exponential correlation for all the schemes excepting the csm scheme there are ranges of parameters for which accurate solutions are not realizable n 102 σ 2 1 for fdm n 102 σ 2 2 for fem n 10 2 σ 2 4 and n 10 3 σ 2 2 for dgm n 10 2 σ 2 2 and n 10 3 σ 2 1 for grw the limited solvability of the flow problem in the exponential case found in our benchmark study for a resolution of the numerical solution which is one order of magnitude higher than usually recommended see e g ababou et al 1989 de dreuzy et al 2007 completes similar results presented in the literature for instance cainelli et al 2012 report difficulties to obtain the convergence of their numerical schemes for exponential correlation of the ln k field with σ 2 2 and gotovac et al 2009 show that for high resolution of the exponentially correlated ln k field with σ 2 2 the required discretization of the hydraulic head solution exceeds the limit of the available computing resources the observed large errors produced by the three related discretization schemes fdm fem and dgm in the test scenarios with exponential correlation and large values of the parameters n and σ 2 cf tables 3 and 4 may be explained as follows the listed errors consist of the discretization error of the respective numerical scheme and the error of the linear solver in practice the latter one cannot be computed however the observed high condition numbers and the computed residuals indicate that the error of the linear solver grows when using the above mentioned parameters in fact the product of condition number and residual is an upper bound for the arithmetic error kelley 1995 more precisely we found that the condition number increases with σ 2 in a comparable way for both gaussian and exponential correlation models and for both numbers of modes the residuals remain almost unchanged in the gaussian case but in exponential case the increase of σ 2 and n cause the increase of the residuals and consequently the increase of the error bound alecsa et al 2020a section 9 regarding the linear solver for the fdm and dgm schemes we used matlab s direct solver mldivide which for our system matrices calls umfpack s unsymmetric multifrontal method davis 2006 and for the fenics implementation of the fem scheme we used the default solver in fenics which calls umfpack as well we also tested various other solvers e g umfpack s spqr davis 2011 and ilupack s amg solver bollhöfer et al 2011 however a smaller residual was not producible in exponential cases of large n and σ 2 the coefficients k contain large numbers of periodic modes with amplitudes spanning over several orders of magnitude the high resolution necessary to prevent the occurrence of ill conditioned matrices and large residuals leads to extremely large degrees of freedom of the linear system of equations which render impractical from the point of view of computational resources the use of direct flow solvers such as fdm fem and dgm considered in this study a possible remedy could be provided by numerical upscaling techniques developed for problems with rough coefficients which capture the effect of small scales on large scales without resolving the small scale details calo et al 2011 hou et al 1999 kornhuber et al 2018 csm schemes verify the manufactured analytical solutions with extremely small errors in both one and two dimensional cases this high precision is rendered possible by the use of the analytical expressions of the derivatives of the k field given by the kraichnan algorithm the convergence is demonstrated by the decrease of chebyshev coefficients towards the roundoff plateau the non homogeneous flow problem can be solved with relatively small numbers of collocation points less than 100 points on both spatial directions which are enough for the spectral representation of the simple smooth manufactured solutions chosen for the purpose of code verification but in the case of highly oscillating solutions of the homogeneous problem for exponential correlation of the ln k field a much larger number of points is required which increases the dimension of the problem beyond the limit of the available memory due to this constraint the maximum number of collocation points in each direction has been fixed to 160 which did not ensure reliable solutions for all the realizations of ln k the gsm scheme has been proposed to avoid the use of the analytical derivative of the hydraulic conductivity k and has been used only in solving the one dimensional non homogeneous problem for comparisons with manufactured solutions the errors are again very small in the gaussian case but extremely large in the exponential case some tests made in the attempt to improve the precision indicate that exceedingly large computing resources would be necessary to render the problem computationally feasible see table 5 the grw scheme is a transitory scheme using computational particles which is accurate and unconditionally stable the drawback is the large number of time iterations needed to reach the stationary state corresponding to the steady state solution of the flow problem in the gaussian case approximations with satisfactory accuracy of the manufactured solution can be obtained with a coarse discretization in reasonable computing times from minutes to hours in the exponential case a much finer discretization is needed and the computing time increases from hours to days the numerical schemes tested so far on benchmark problems have their own strengths which make them useful in specific applications depending on the objective pursued fdm schemes are appropriate for fast computations of monte carlo ensembles in case of moderate aquifer heterogeneity fem and dgm schemes are appropriate to cope with higher heterogeneity in either single realization or monte carlo approaches grw is rather appropriate for single realization flow problems with heterogeneous coefficients and csm gsm approaches could be useful in solving problems with heterogeneous coefficients and source terms given by smooth functions we have seen that all the schemes tested in this study face the issue of computational feasibility in the case of the exponential structure of the log conductivity field it is therefore recommendable that unless well documented by experimental data for a specific problem the exponential correlation model should be avoided instead gaussian models can be used to account for effective dispersion associated with an integral scale dagan 1989 trefry et al 2003 as well as in flow and transport simulations for fractal aquifer structures e g di federico and neuman 1997 declaration of competing interests the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper credit authorship contribution statement cristian d alecsa methodology writing review editing imre boros writing review editing florian frank writing review editing peter knabner supervision mihai nechita writing review editing alexander prechtel formal analysis writing review editing andreas rupp writing review editing nicolae suciu conceptualization writing review editing acknowledgements the authors are grateful to dr maria crăciun for her help in testing the random field generators and to dr emil cătinaş for carefully reading the manuscript andreas rupp acknowledges the financial support of the deutsche forschungsgemeinschaft dfg german research foundation under grants ru 2179 251268514 mad soil microaggregates formation and turnover of the structural building blocks of soils and exc 2181 390900948 structures a unifying approach to emergent phenomena in the physical world mathematics and complex data the work of nicolae suciu was supported by the dfg grant su 415 4 1 405338726 integrated global random walk model for reactive transport in groundwater adapted to measurement spatio temporal scales appendix a manufactured solutions we consider the following smooth manufactured solution a 1 h x y 1 sin 2 x y with x 0 l x and y 0 l y along with the dirichlet and neumann boundary conditions a 2 h 0 y 1 sin y y 0 l y h l x y 1 sin 2 l x y y 0 l y h y x 0 cos 2 x x 0 l x h y x l y cos 2 x l y x 0 l x the function k is given by a 3 k x y c 1 exp c 2 i 1 n cos ϕ i 2 π k i 1 x k i 2 y where we use the shorthand notations c 1 k exp σ 2 2 and c 2 σ 2 n after inserting a 1 and a 3 in eq 2 one obtains a source term f where f has the following form a 4 f x y 2 c 1 c 2 i 1 n 2 π k i 1 sin ϕ i 2 x k i 1 y k i 2 π exp c 2 i 1 n cos ϕ i 2 x k i 1 y k i 2 π cos 2 x y 5 c 1 exp c 2 i 1 n cos ϕ i 2 x k i 1 y k i 2 π sin 2 x y c 1 c 2 i 1 n 2 π k j 2 sin ϕ i 2 x k i 1 y k i 2 π exp c 2 i 1 n cos ϕ i 2 x k i 1 y k i 2 π cos 2 x y appendix b estimated order of convergence the convergence of the numerical schemes is investigated numerically by solving the homogeneous problem 2 4 for successive refinements of the grid see e g lord et al 2014 the hydraulic conductivity fields k are computed for each pair of parameters n and σ 2 with the same sets of wavenumbers and phases as those used above for the code verification procedure in section 4 1 we start with δ x δ y 10 1 and obtain 5 refinements of the grid by successively halving the space steps up to δ x δ y 3 125 10 3 in the case of fdm and grw schemes and with refinements from δ x δ y 4 10 1 to δ x δ y 1 25 10 3 for fem and dgm schemes the corresponding solutions are denoted by h k k 1 6 the estimated order of convergence that describes the decrease in logarithmic scale of the error quantified by the vector norm ε k h k h 6 l 2 is computed according to b 1 e o c log ε k ε k 1 log 2 k 1 4 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103558 appendix c supplementary materials image application 1 image application 2 image application 3 image application 4 ababou mclaughlin gelhar tompson 1989 r ababou d mclaughlin l w gelhar a f tompson numerical simulation of three dimensional saturated flow in randomly heterogeneous porous media transp porous media 4 6 1989 549 565 10 1007 bf00223627 ababou r mclaughlin d gelhar l w tompson a f 1989 numerical simulation of three dimensional saturated flow in randomly heterogeneous porous media transp porous media 4 6 549 565 10 1007 bf00223627 alecsa et al 2020 alecsa c d boros i frank f knabner p nechita m prechtel a rupp a suciu n 2020a benchmark for numerical solutions of fow in heterogeneous groundwater formations arxiv 1911 10774 alecsa et al 2020b alecsa c d boros i frank f knabner p nechita m prechtel a rupp a suciu n 2020b git repository https github com pmflow flowbenchmark doi 10 5281 zenodo 3662401 alnæs blechta hake johansson kehlet logg richardson ring rognes wells 2015 m s alnæs j blechta j hake a johansson b kehlet a logg c richardson j ring m e rognes g n wells the fenics project version 1 5 arch numer softw 3 100 2015 9 23 10 11588 ans 2015 100 20553 alnæs m s blechta j hake j johansson a kehlet b logg a richardson c ring j rognes m e wells g n 2015 the fenics project version 1 5 archive of numerical software 3 100 9 23 10 11588 ans 2015 100 20553 aurentz trefethen 2017 j l aurentz l n trefethen chopping a chebyshev series acm trans math softw toms 43 4 2017 33 10 1145 2998442 aurentz j l trefethen l n 2017 chopping a chebyshev series acm transactions on mathematical software toms 43 4 33 10 1145 2998442 bakr gelhar gutjahr macmillan 1978 a a bakr l w gelhar a l gutjahr j r macmillan stochastic analysis of spatial variability in subsurface flows 1 comparison of one and three dimensional flows water resour res 14 2 1978 263 271 10 1029 wr014i002p00263 bakr a a gelhar l w gutjahr a l macmillan j r 1978 stochastic analysis of spatial variability in subsurface flows 1 comparison of one and three dimensional flows water resour res 14 2 263 271 10 1029 wr014i002p00263 bellin rubin 1996 a bellin y rubin hydro gen a spatially distributed random field generator for correlated properties stoch hydrol hydraul 10 4 1996 253 278 10 1007 bf01581869 bellin a rubin y 1996 hydro gen a spatially distributed random field generator for correlated properties stoch hydrol hydraul 10 4 253 278 10 1007 bf01581869 bellin salandin rinaldo 1992 a bellin p salandin a rinaldo simulation of dispersion in heterogeneous porous formations statistics first order theories convergence of computations water resour res 28 9 1992 2211 2227 10 1029 92wr00578 bellin a salandin p rinaldo a 1992 simulation of dispersion in heterogeneous porous formations statistics first order theories convergence of computations water resour res 28 9 2211 2227 10 1029 92wr00578 bohling liu dietrich butler 2016 g c bohling g liu p dietrich j j butler reassessing the made direct push hydraulic conductivity data using a revised calibration procedure water resour res 52 11 2016 8970 8985 10 1002 2016wr019008 bohling g c liu g dietrich p butler j j 2016 reassessing the made direct push hydraulic conductivity data using a revised calibration procedure water resour res 52 11 8970 8985 10 1002 2016wr019008 bollhöfer aliaga martín quintana ortí 2011 m bollhöfer j i aliaga a f martín e s quintana ortí ilupack in padua d a ed encyclopedia of parallel computing 2011 springer new york 917 926 10 1007 978 0 387 09766 4 513 bollhöfer m aliaga j i martín a f quintana ortí e s 2011 ilupack in padua d a ed in encyclopedia of parallel computing springer new york pp 917 926 10 1007 978 0 387 09766 4 513 brunner radu bause knabner 2012 f brunner f a radu m bause p knabner optimal order convergence of a modified bdm1 mixed finite element scheme for reactive transport in porous media adv water resour 35 2012 163 171 10 1016 j advwatres 2011 10 001 brunner f radu f a bause m knabner p 2012 optimal order convergence of a modified bdm1 mixed finite element scheme for reactive transport in porous media adv water resour 35 163 171 10 1016 j advwatres 2011 10 001 cainelli bellin putti 2012 o cainelli a bellin m putti on the accuracy of classic numerical schemes for modeling flow in saturated heterogeneous formations adv water resour 47 2012 43 55 10 1016 j advwatres 2012 06 016 cainelli o bellin a putti m 2012 on the accuracy of classic numerical schemes for modeling flow in saturated heterogeneous formations adv water resour 47 43 55 10 1016 j advwatres 2012 06 016 calo efendiev galvis 2011 v calo y efendiev j galvis a note on variational multiscale methods for high contrast heterogeneous porous media flows with rough source terms adv water resour 34 9 2011 1177 1185 10 1016 j advwatres 2010 12 011 calo v efendiev y galvis j 2011 a note on variational multiscale methods for high contrast heterogeneous porous media flows with rough source terms adv water resour 34 9 1177 1185 10 1016 j advwatres 2010 12 011 carrayrou et al 2010a j carrayrou j hoffmann p knabner s kräutle c de dieuleveult j erhel j van der lee v lagneau k u mayer k t macquarrie comparison of numerical methods for simulating strongly nonlinear and heterogeneous reactive transport problems the momas benchmark case comput geosci 14 3 2010 483 502 10 1007 s10596 010 9178 2 carrayrou j hoffmann j knabner p krä utle s de dieuleveult c erhel j van der lee j lagneau v mayer k u macquarrie k t 2010a comparison of numerical methods for simulating strongly nonlinear and heterogeneous reactive transport problems the momas benchmark case comput geosci 14 3 483 502 10 1007 s10596 010 9178 2 carrayrou kern knabner 2010b j carrayrou m kern p knabner reactive transport benchmark of momas comput geosci 14 3 2010 385 392 10 1007 s10596 009 9157 7 carrayrou j kern m knabner p 2010b reactive transport benchmark of momas comput geosci 14 3 385 392 10 1007 s10596 009 9157 7 cordes putti 2001 c cordes m putti accuracy of galerkin finite elements for groundwater flow simulations in two and three dimensional triangulations int j numer meth eng 52 4 2001 371 387 10 1002 nme 194 cordes c putti m 2001 accuracy of galerkin finite elements for groundwater flow simulations in two and three dimensional triangulations int j numer meth eng 52 4 371 387 10 1002 nme 194 cramér leadbetter 1967 h cramér m r leadbetter stationary and related stochastic processes 1967 john wiley sons new york cramér h leadbetter m r 1967 stationary and related stochastic processes john wiley sons new york dagan 1989 g dagan flow and transport in porous formations 1989 springer berlin dagan g 1989 flow and transport in porous formations springer berlin davis 2006 t a davis direct methods for sparse linear systems siam 2 2006 10 1137 1 9780898718881 davis t a 2006 direct methods for sparse linear systems siam 2 10 1137 1 9780898718881 davis 2011 t a davis algorithm 915 suitesparseqr multifrontal multithreaded rank revealing sparse qr factorization acm trans math softw 38 1 2011 10 1145 2049662 2049670 davis t a 2011 algorithm 915 suitesparseqr multifrontal multithreaded rank revealing sparse qr factorization acm trans math softw 38 1 article 8 10 1145 2049662 2049670 article 8 deng cushman 1995 f w deng j h cushman on higher order corrections to the flow velocity covariance tensor water resour res 31 7 1995 1659 1672 10 1029 94wr02974 deng f w cushman j h 1995 on higher order corrections to the flow velocity covariance tensor water resour res 31 7 1659 1672 10 1029 94wr02974 di federico neuman 1997 v di federico s p neuman scaling of random fields by means of truncated power variograms and associated spectra water resour res 33 1997 1075 1085 10 1029 97wr00299 di federico v neuman s p 1997 scaling of random fields by means of truncated power variograms and associated spectra water resour res 33 1075 1085 10 1029 97wr00299 di pietro ern 2012 d a di pietro a ern mathematical aspects of discontinuous galerkin methods 2012 springer heidelberg di pietro d a ern a 2012 mathematical aspects of discontinuous galerkin methods springer heidelberg de dreuzy beaudoin erhel 2007 j r de dreuzy a beaudoin j erhel asymptotic dispersion in 2d heterogeneous porous media determined by parallel numerical simulations water resour res 43 2007 w10439 10 1029 2006wr005394 de dreuzy j r beaudoin a erhel j 2007 asymptotic dispersion in 2d heterogeneous porous media determined by parallel numerical simulations water resour res 43 w10439 10 1029 2006wr005394 de dreuzy pichot poirriez erhel 2013 j r de dreuzy g pichot b poirriez j erhel synthetic benchmark for modeling flow in 3d fractured media comput geosci 50 2013 59 71 10 1016 j cageo 2012 07 025 de dreuzy j r pichot g poirriez b erhel j 2013 synthetic benchmark for modeling flow in 3d fractured media comput geosci 50 59 71 10 1016 j cageo 2012 07 025 eberhard suciu vamos 2007 j p eberhard n suciu c vamos on the self averaging of dispersion for transport in quasiperiodic random media j phys a 40 4 2007 597 610 10 1088 1751 8113 40 4 002 eberhard j p suciu n vamos c 2007 on the self averaging of dispersion for transport in quasiperiodic random media j phys a 40 4 597 610 10 1088 1751 8113 40 4 002 flemisch berre boon fumagalli schwenck scotti stefansson tatomir 2018 b flemisch i berre w boon a fumagalli n schwenck a scotti i stefansson a tatomir benchmarks for single phase flow in fractured porous media adv water resour 111 2018 239 258 10 1016 j advwatres 2017 10 036 flemisch b berre i boon w fumagalli a schwenck n scotti a stefansson i tatomir a 2018 benchmarks for single phase flow in fractured porous media adv water resour 111 239 258 10 1016 j advwatres 2017 10 036 frank reuter aizinger knabner 2015 f frank b reuter v aizinger p knabner festung a matlab gnu octave toolbox for the discontinuous galerkin method part i diffusion operator comput math appl 70 1 2015 11 46 10 1016 j camwa 2015 04 013 frank f reuter b aizinger v knabner p 2015 festung a matlab gnu octave toolbox for the discontinuous galerkin method part i diffusion operator comput math appl 70 1 11 46 10 1016 j camwa 2015 04 013 gelhar 1986 l w gelhar stochastic subsurface hydrology from theory to applications water resour res 22 9s 1986 s135s 145s 10 1029 wr022i09sp0135s gelhar l w 1986 stochastic subsurface hydrology from theory to applications water resour res 22 9s s135s 145s 10 1029 wr022i09sp0135s gelhar axness 1983 l w gelhar c axness three dimensional stochastic analysis of macrodispersion in aquifers water resour res 19 1 1983 161 180 10 1029 wr019i001p00161 gelhar l w axness c 1983 three dimensional stochastic analysis of macrodispersion in aquifers water resour res 19 1 161 180 10 1029 wr019i001p00161 gotovac andričevicć gotovac 2007 h gotovac r andričevicć b gotovac multi resolution adaptive modeling of groundwater flow and transport adv water resour 30 5 2007 1105 1126 10 1016 j advwatres 2006 10 007 gotovac h andričevicć r gotovac b 2007 multi resolution adaptive modeling of groundwater flow and transport adv water resour 30 5 1105 1126 10 1016 j advwatres 2006 10 007 gotovac cvetković andričevicć 2009 h gotovac v cvetković r andričevicć adaptive fup multi resolution approach to flow and advective transport in highly heterogeneous porous media methodology accuracy and convergence adv water resour 32 6 2009 885 905 10 1016 j advwatres 2009 02 013 gotovac h cvetković v andričevicć r 2009 adaptive fup multi resolution approach to flow and advective transport in highly heterogeneous porous media methodology accuracy and convergence adv water resour 32 6 885 905 10 1016 j advwatres 2009 02 013 grenier anbergen bense chanzy coon collier costard ferry frampton frederick gonçalvès holmén jost kokh kurylyk mckenzie molson mouche orgogozo pannetier rivière roux rühaak scheidegger selroos therrien vidstrand voss 2018 c grenier h anbergen v bense q chanzy e coon n collier f costard m ferry a frampton j frederick j gonçalvès j holmén a jost s kokh b kurylyk j mckenzie j molson e mouche l orgogozo r pannetier a rivière n roux w rühaak j scheidegger j o selroos r therrien p vidstrand c voss groundwater flow and heat transport for systems undergoing freeze thaw intercomparison of numerical simulators for 2d test cases adv water resour 114 2018 196 218 10 1016 j advwatres 2018 02 001 grenier c anbergen h bense v chanzy q coon e collier n costard f ferry m frampton a frederick j gonçalvès j holmén j jost a kokh s kurylyk b mckenzie j molson j mouche e orgogozo l pannetier r rivière a roux n rühaak w scheidegger j selroos j o therrien r vidstrand p voss c 2018 groundwater flow and heat transport for systems undergoing freeze thaw intercomparison of numerical simulators for 2d test cases advances in water resources 114 196 218 10 1016 j advwatres 2018 02 001 hoepffner hoepffner j 2007 implementation of boundary conditions http www lmm jussieu fr hoepffner boundarycondition pdf hou wu cai 1999 t hou x h wu z cai convergence of a multiscale finite element method for elliptic problems with rapidly oscillating coefficients math comput 68 227 1999 913 943 10 1090 s0025 5718 99 01077 7 hou t wu x h cai z 1999 convergence of a multiscale finite element method for elliptic problems with rapidly oscillating coefficients math comput 68 227 913 943 10 1090 s0025 5718 99 01077 7 kelley 1995 c t kelley iterative methods for linear and nonlinear equations siam philadelphia 16 1995 kelley c t 1995 iterative methods for linear and nonlinear equations siam philadelphia knabner angermann 2003 p knabner l angermann numerical methods for elliptic and parabolic partial differential equations 2003 springer new york knabner p angermann l 2003 numerical methods for elliptic and parabolic partial differential equations springer new york kornhuber peterseim yserentant 2018 r kornhuber d peterseim h yserentant an analysis of a class of variational multiscale methods based on subspace decomposition math comput 87 314 2018 2765 2774 10 1090 mcom 3302 kornhuber r peterseim d yserentant h 2018 an analysis of a class of variational multiscale methods based on subspace decomposition math comput 87 314 2765 2774 10 1090 mcom 3302 kraichnan 1970 r h kraichnan diffusion by a random velocity field phys fluids 13 1 1970 22 31 10 1063 1 1692799 kraichnan r h 1970 diffusion by a random velocity field phys fluids 13 1 22 31 10 1063 1 1692799 kramer kurbanmuradov sabelfeld 2007 p r kramer o kurbanmuradov k sabelfeld comparative analysis of multiscale gaussian random field simulation algorithms j comp phys 226 2007 897 924 10 1016 j jcp 2007 05 002 kramer p r kurbanmuradov o sabelfeld k 2007 comparative analysis of multiscale gaussian random field simulation algorithms j comp phys 226 897 924 10 1016 j jcp 2007 05 002 kurbanmuradov sabelfeld kramer 2013 o kurbanmuradov k sabelfeld p r kramer randomized spectral and fourier wavelet methods for multidimensional gaussian random vector fields j comp phys 245 2013 218 234 10 1016 j jcp 2013 03 021 kurbanmuradov o sabelfeld k kramer p r 2013 randomized spectral and fourier wavelet methods for multidimensional gaussian random vector fields j comp phys 245 218 234 10 1016 j jcp 2013 03 021 kurbanmuradov sabelfeld 2010 o a kurbanmuradov k k sabelfeld stochastic flow simulation and particle transport in a 2d layer of random porous medium transp porous media 85 2010 347 373 10 1007 s11242 010 9567 y kurbanmuradov o a sabelfeld k k 2010 stochastic flow simulation and particle transport in a 2d layer of random porous medium transp porous media 85 347 373 10 1007 s11242 010 9567 y larsson thomée 2009 s larsson v thomée partial differential equations with numerical methods 2009 springer berlin heidelberg 10 1007 978 3 540 88706 5 larsson s thomée v 2009 partial differential equations with numerical methods springer berlin heidelberg 10 1007 978 3 540 88706 5 li zhang 2007 h li d zhang probabilistic collocation method for flow in porous media comparisons with other stochastic methods water resour res 43 2007 w09409 10 1029 2006wr005673 li h zhang d 2007 probabilistic collocation method for flow in porous media comparisons with other stochastic methods water resour res 43 w09409 10 1029 2006wr005673 li mclaughlin 1991 s li d b mclaughlin a nonstationary spectral method for solving stochastic groundwater problems unconditional analysis water resour res 27 7 1991 1589 1605 10 1029 91wr00881 li s mclaughlin d b 1991 a nonstationary spectral method for solving stochastic groundwater problems unconditional analysis water resour res 27 7 1589 1605 10 1029 91wr00881 li lu zhang 2009 w li z lu d zhang stochastic analysis of unsaturated flow with probabilistic collocation method water resour res 45 2009 w08425 10 1029 2008wr007530 li w lu z zhang d 2009 stochastic analysis of unsaturated flow with probabilistic collocation method water resour res 45 w08425 10 1029 2008wr007530 li qiao tang 2017 z li z qiao t tang numerical solution of differential equations introduction to finite difference and finite element methods 2017 cambridge university press 10 1017 9781316678725 li z qiao z tang t 2017 numerical solution of differential equations introduction to finite difference and finite element methods cambridge university press 10 1017 9781316678725 liu molz 1997 h a liu f j molz multifractal analyses of hydraulic conductivity distributions water resour res 33 11 1997 2483 2488 10 1029 97wr02188 liu h a molz f j 1997 multifractal analyses of hydraulic conductivity distributions water resour res 33 11 2483 2488 10 1029 97wr02188 lord powell shardlow 2014 g j lord c e powell t shardlow an introduction to computational stochastic pdes 2014 cambridge university press lord g j powell c e shardlow t 2014 an introduction to computational stochastic pdes cambridge university press mantoglou wilson 1982 a mantoglou j l wilson the turning bands method for simulation of random fields using line generation by a spectral method water resour res 18 5 1982 1379 1394 10 1029 wr018i005p01379 mantoglou a wilson j l 1982 the turning bands method for simulation of random fields using line generation by a spectral method water resour res 18 5 1379 1394 10 1029 wr018i005p01379 mizell gutjahr gelhar 1982 s a mizell a l gutjahr l w gelhar stochastic analysis of spatial variability in two dimensional steady groundwater flow assuming stationary and nonstationary heads water resour res 18 4 1982 1053 1067 10 1029 wr018i004p01053 mizell s a gutjahr a l gelhar l w 1982 stochastic analysis of spatial variability in two dimensional steady groundwater flow assuming stationary and nonstationary heads water resources research 18 4 1053 1067 10 1029 wr018i004p01053 molz boman 1995 f j molz g k boman further evidence of fractal structure in hydraulic conductivity distributions geophys res lett 22 18 1995 2545 2548 10 1029 95gl02548 molz f j boman g k 1995 further evidence of fractal structure in hydraulic conductivity distributions geophys res lett 22 18 2545 2548 10 1029 95gl02548 molz liu szulga 1997 f j molz h h liu j szulga fractional brownian motion and fractional gaussian noise in subsurface hydrology a review presentation of fundamental properties and extensions water resour res 33 10 1997 2273 2286 10 1029 97wr01982 molz f j liu h h szulga j 1997 fractional brownian motion and fractional gaussian noise in subsurface hydrology a review presentation of fundamental properties and extensions water resour res 33 10 2273 2286 10 1029 97wr01982 oberkampf blottner 1998 w l oberkampf f g blottner issues in computational fluid dynamics code verification and validation aiaa j 36 5 1998 687 695 10 2514 2 456 oberkampf w l blottner f g 1998 issues in computational fluid dynamics code verification and validation aiaa j 36 5 687 695 10 2514 2 456 putti cordes 1998 m putti c cordes finite element approximation of the diffusion operator on tetrahedra siam j sci comput 19 4 1998 1154 1168 10 1137 s1064827595290711 putti m cordes c 1998 finite element approximation of the diffusion operator on tetrahedra siam j sci comput 19 4 1154 1168 10 1137 s1064827595290711 radu kumar nordbotten pop 2017 f a radu k kumar j m nordbotten i s pop a robust mass conservative scheme for two phase flow in porous media including hölder continuous nonlinearities ima j numer anal 38 2 2017 884 920 10 1093 imanum drx032 radu f a kumar k nordbotten j m pop i s 2017 a robust mass conservative scheme for two phase flow in porous media including hölder continuous nonlinearities ima j numer anal 38 2 884 920 10 1093 imanum drx032 radu suciu hoffmann vogel kolditz park attinger 2011 f a radu n suciu j hoffmann a vogel o kolditz c h park s attinger accuracy of numerical simulations of contaminant transport in heterogeneous aquifers a comparative study adv water resour 34 2011 47 61 10 1016 j advwatres 2010 09 012 radu f a suciu n hoffmann j vogel a kolditz o park c h attinger s 2011 accuracy of numerical simulations of contaminant transport in heterogeneous aquifers a comparative study adv water resour 34 47 61 10 1016 j advwatres 2010 09 012 rajaram gelhar 1991 h rajaram l w gelhar three dimensional spatial moments analysis of the borden tracer test water resour res 27 6 1991 1239 1251 10 1029 91wr00326 rajaram h gelhar l w 1991 three dimensional spatial moments analysis of the borden tracer test water resour res 27 6 1239 1251 10 1029 91wr00326 rehfeldt boggs gelhar 1992 k r rehfeldt j m boggs l w gelhar field study of dispersion in a heterogeneous aquifer 3 geostatistical analysis of hydraulic conductivity water resour res 28 12 1992 3309 3324 10 1029 92wr01758 rehfeldt k r boggs j m gelhar l w 1992 field study of dispersion in a heterogeneous aquifer 3 geostatistical analysis of hydraulic conductivity water resour res 28 12 3309 3324 10 1029 92wr01758 ritzi jr soltanian 2015 r w ritzijr m r soltanian what have we learned from deterministic geostatistics at highly resolved field sites as relevant to mass transport processes in sedimentary aquifers j hydrol 531 2015 31 39 10 1016 j jhydrol 2015 07 049 ritzi jr r w soltanian m r 2015 what have we learned from deterministic geostatistics at highly resolved field sites as relevant to mass transport processes in sedimentary aquifers j hydrol 531 31 39 10 1016 j jhydrol 2015 07 049 riviere 2008 b riviere discontinuous galerkin methods for solving elliptic and parabolic equations theory and implementation 2008 siam philadelphia 10 1137 1 9780898717440 fm riviere b 2008 discontinuous galerkin methods for solving elliptic and parabolic equations theory and implementation siam philadelphia https doi org 10 1137 1 9780898717440 fm roache 1998 p j roache verification and validation in computational science and engineering 1998 hermosa publishers new mexico roache p j 1998 verification and validation in computational science and engineering hermosa publishers new mexico roache 2002 p j roache code verification by the method of manufactured solutions j fluids eng 124 1 2002 4 10 10 1115 1 1436090 roache p j 2002 code verification by the method of manufactured solutions j fluids eng 124 1 4 10 10 1115 1 1436090 roy 2003 c j roy grid convergence error analysis for mixed order numerical schemes aiaa j 41 4 2003 595 604 10 2514 2 2013 roy c j 2003 grid convergence error analysis for mixed order numerical schemes aiaa journal 41 4 595 604 10 2514 2 2013 roy 2005 c j roy review of code and solution verification procedures for computational simulation j comput phys 205 2005 131 156 10 1016 j jcp 2004 10 036 roy c j 2005 review of code and solution verification procedures for computational simulation j comput phys 205 131 156 10 1016 j jcp 2004 10 036 rupp 2019 a rupp simulating structure formation in soils across scales using discontinuous galerkin methods shaker düren 2019 rupp a 2019 simulating structure formation in soils across scales using discontinuous galerkin methods shaker düren salandin fiorotto 1998 p salandin v fiorotto solute transport in highly heterogeneous aquifers water resour res 34 5 1998 949 961 10 1029 98wr00219 salandin p fiorotto v 1998 solute transport in highly heterogeneous aquifers water resour res 34 5 949 961 10 1029 98wr00219 segerlind 1987 l j segerlind applied finite element analysis 1987 j wiley and sons new york segerlind l j 1987 applied finite element analysis j wiley and sons new york shen wang xia 2016 j shen y wang j xia fast structured direct spectral methods for differential equations with variable coefficients i the one dimensional case siam j sci comput 38 1 2016 a28 a54 10 1137 140986815 shen j wang y xia j 2016 fast structured direct spectral methods for differential equations with variable coefficients i the one dimensional case siam j sci comput 38 1 a28 a54 10 1137 140986815 srzic cvetkovic andricevic gotovac 2013 v srzic v cvetkovic r andricevic h gotovac impact of aquifer heterogeneity structure and local scale dispersion on solute concentration uncertainty water resour res 49 6 2013 3712 3728 10 1002 wrcr 20314 srzic v cvetkovic v andricevic r gotovac h 2013 impact of aquifer heterogeneity structure and local scale dispersion on solute concentration uncertainty water resour res 49 6 3712 3728 10 1002 wrcr 20314 suciu 2010 n suciu spatially inhomogeneous transition probabilities as memory effects for diffusion in statistically homogeneous random velocity fields phys rev e 81 2010 056301 10 1103 physreve 81 056301 suciu n 2010 spatially inhomogeneous transition probabilities as memory effects for diffusion in statistically homogeneous random velocity fields phys rev e 81 056301 10 1103 physreve 81 056301 suciu 2014 n suciu diffusion in random velocity fields with applications to contaminant transport in groundwater adv water resour 69 2014 114 133 10 1016 j advwatres 2014 04 002 suciu n 2014 diffusion in random velocity fields with applications to contaminant transport in groundwater adv water resour 69 114 133 10 1016 j advwatres 2014 04 002 suciu 2019 n suciu diffusion in random fields applications to transport in groundwater birkhäuser cham 2019 10 1007 978 3 030 15081 5 suciu n 2019 diffusion in random fields applications to transport in groundwater birkhäuser cham 10 1007 978 3 030 15081 5 suciu attinger radu vamoş vanderborght vereecken knabner 2015 n suciu s attinger f a radu c vamoş j vanderborght h vereecken p knabner solute transport in aquifers with evolving scale heterogeneity an sti u ovid co mat 23 3 2015 167 186 10 1515 auom 2015 0054 suciu n attinger s radu f a vamoş c vanderborght j vereecken h knabner p 2015 solute transport in aquifers with evolving scale heterogeneity an sti u ovid co mat 23 3 167 186 10 1515 auom 2015 0054 suciu radu prechtel knabner 2013 n suciu f a radu a prechtel p knabner a coupled finite element global random walk approach to advection dominated transport in porous media with random hydraulic conductivity j comput appl math 246 2013 27 37 10 1016 j cam 2012 06 027 suciu n radu f a prechtel a knabner p 2013 a coupled finite element global random walk approach to advection dominated transport in porous media with random hydraulic conductivity j comput appl math 246 27 37 10 1016 j cam 2012 06 027 suciu schüler attinger knabner 2016 n suciu l schüler s attinger p knabner towards a filtered density function approach for reactive transport in groundwater adv water resour 90 2016 83 98 10 1016 j advwatres 2016 02 016 suciu n schüler l attinger s knabner p 2016 towards a filtered density function approach for reactive transport in groundwater adv water resour 90 83 98 10 1016 j advwatres 2016 02 016 suciu vamoş vanderborght hardelauf vereecken 2006 n suciu c vamoş j vanderborght h hardelauf h vereecken numerical investigations on ergodicity of solute transport in heterogeneous aquifers water resour res 42 2006 w04409 10 1029 2005wr004546 suciu n vamoş c vanderborght j hardelauf h vereecken h 2006 numerical investigations on ergodicity of solute transport in heterogeneous aquifers water resour res 42 w04409 10 1029 2005wr004546 trefry ruan mclaughlin 2003 m g trefry f p ruan d mclaughlin numerical simulations of preasimptotic transport in hetoregenous porous media departures from the gaussian limit water resour res 39 3 2003 1063 1077 10 1029 2001wr001101 trefry m g ruan f p mclaughlin d 2003 numerical simulations of preasimptotic transport in hetoregenous porous media departures from the gaussian limit water resour res 39 3 1063 1077 10 1029 2001wr001101 vamoş suciu vereecken 2003 c vamoş n suciu h vereecken generalized random walk algorithm for the numerical modeling of complex diffusion processes j comput phys 186 2003 527 544 10 1016 s0021 9991 03 00073 1 vamoş c suciu n vereecken h 2003 generalized random walk algorithm for the numerical modeling of complex diffusion processes j comput phys 186 527 544 10 1016 s0021 9991 03 00073 1 weideman reddy 2000 j a weideman s c reddy a matlab differentiation matrix suite acm trans math software 26 4 2000 465 519 10 1145 365723 365727 weideman j a reddy s c 2000 a matlab differentiation matrix suite acm trans math software 26 4 465 519 10 1145 365723 365727 yaglom 1987 a m yaglom correlation theory of stationary and related random functions vol 2 supplementary notes and 1987 springer new york yaglom a m 1987 correlation theory of stationary and related random functions in vol 2 supplementary notes and 
513,this article presents numerical investigations on accuracy and convergence properties of several numerical approaches for simulating steady state flows in heterogeneous aquifers finite difference finite element discontinuous galerkin spectral and random walk methods are tested on two dimensional benchmark flow problems realizations of log normal hydraulic conductivity fields are generated by kraichnan algorithms in closed form as finite sums of random periodic modes which allow direct code verification by comparisons with manufactured reference solutions the quality of the methods is assessed for increasing number of random modes and for increasing variance of the log hydraulic conductivity fields with gaussian and exponential correlation experimental orders of convergence are calculated from successive refinements of the grid the numerical methods are further validated by comparisons between statistical inferences obtained from monte carlo ensembles of numerical solutions and theoretical first order perturbation results it is found that while for gaussian correlation of the log conductivity field all the methods perform well in the exponential case their accuracy deteriorates and for large variance and number of modes the benchmark problems are practically not solvable with reasonably large computing resources for all the methods considered in this study keywords darcy flow accuracy convergence computational feasibility finite difference finite element discontinuous galerkin spectral methods global random walk msc 65n06 65n30 65n35 65n12 76s05 86a05 1 introduction solving the flow problem is the first step in modeling contaminant transport in natural porous media formations since typical parameters for aquifers often lead to advection dominated transport problems dagan 1989 accurate flow solutions are essential for reliable simulations of the effective dispersion of the solute plumes the numerical feasibility of the flow problem in realistic conditions has been addressed in a pioneering work by ababou et al 1989 who pointed out that the discretization steps must be much smaller than the heterogeneity scale which in turn is much smaller than the dimension of the computational domain such order relations also served as guidelines for implementing solutions with finite difference methods fdm de dreuzy et al 2007 kurbanmuradov and sabelfeld 2010 trefry et al 2003 or finite element methods fem bellin et al 1992 radu et al 2011 salandin and fiorotto 1998 used in monte carlo simulations in spectral approaches gotovac et al 2007 li and mclaughlin 1991 or probabilistic collocation and chaos expansion approaches li and zhang 2007 li et al 2009 the spatial resolution is also related to the number of terms in the series representation of the coefficients and of the solution of the flow problem despite the advances in numerical methods computing accurate flow solutions for highly heterogeneous formations faces computational challenges in terms of code efficiency and computational resources see e g gotovac et al 2009 li and zhang 2007 field experiments show a broad range of heterogeneities of the aquifer systems characterized by variances σ 2 of the log hydraulic conductivity from less than one for instance at borden site ontario rajaram and gelhar 1991 ritzi and soltanian 2015 up to variances between σ 2 3 4 and σ 2 8 7 at the macrodispersion experiment made site in columbus mississippi bohling et al 2016 rehfeldt et al 1992 the geostatistical interpretation of the measured conductivity data is often based on a log normal probability distribution with an assumed exponential correlation model bohling et al 2016 gelhar 1986 rehfeldt et al 1992 but since dispersion coefficients do not depend on the shape of the correlation function dagan 1989 and are essentially determined by the correlation scale rajaram and gelhar 1991 a gaussian model can be chosen as well kurbanmuradov and sabelfeld 2010 trefry et al 2003 moreover experimental data from borden made and other sites can be reinterpreted by using a multifractal analysis and power law correlations liu and molz 1997 molz and boman 1995 molz et al 1997 random fields with power law correlations can be generated as linear combinations of random modes with either exponential or gaussian correlation di federico and neuman 1997 suciu et al 2015 therefore the influence of the correlation structure on the accuracy of the numerical solutions of the flow problem can be generally analyzed by considering gaussian and exponential correlations of the log conductivity field numerical simulations of flow and transport in groundwater were carried out with a fem for increasing log conductivity variance from small to moderate values e g up to σ 2 1 6 by bellin et al 1992 similar investigations were performed with fdms for variances as high as σ 2 9 in de dreuzy et al 2007 or σ 2 16 in kurbanmuradov and sabelfeld 2010 though an exponential shape of the log conductivity correlation is considered in most cases a gaussian shape which yields smoother fields could be preferred for numerical reasons trefry et al 2003 different approaches were validated through comparisons with linear theoretical approximations of first order in σ 2 and the numerical methods were further used to explore the limits of the first order theory a direct validation of the flow solver by comparisons with analytical manufactured solutions has been done by kurbanmuradov and sabelfeld 2010 for both gaussian and exponential correlations with the same variance σ 2 1 of the log conductivity field accurate fems were developed to ensure the consistency of the numerical fluxes with darcy s law putti and cordes 1998 cordes and putti 2001 the mass conservation of the numerical scheme radu et al 2017 and the head continuity at the interface between two materials with contrasting hydraulic properties cainelli et al 2012 with focus on satisfying the refraction law at the interfaces between blocks with different hydraulic conductivity cainelli et al 2012 used advanced fem and velocity postprocessing approaches to solve the flow problem for weak and moderately heterogeneous aquifer structures the convergence of the numerical schemes is assessed by comparisons with analytical solutions for block constant hydraulic conductivity with sharp contrast for further validation the convergence to the same velocity variances of the predictions obtained with different numerical schemes was investigated through a monte carlo approach while almost no discrepancy was observed for the gaussian correlation model for the exponential model one obtains large relative differences for the variance of both longitudinal and transverse velocity in the case of the largest variance of the log hydraulic conductivity considered in their study σ 2 2 serious challenges are posed by exponential correlation models with higher variances when conductivity differences may span several orders of magnitude using a spectral collocation approach based on expansions of the solution in series of compactly supported and infinitely differentiable atomic functions gotovac et al 2009 tested the flow solver for variances up to σ 2 8 the accuracy of the solution was assessed with mass balance errors between control planes the criterion of small grid péclet number defined with advection velocities given by the derivatives of the log hydraulic conductivity and constant unit diffusion coefficient highlighted by expanding the second order derivatives in the flow equation as well as by corrections of the solution induced by the increase of the number of collocation points it was found that increasing the resolution of the log hydraulic conductivity requires increasing the resolution of the solution to fulfill the accuracy criteria while for gaussian correlation of the log hydraulic conductivity the desired accuracy is achieved for σ 2 up to 8 with relatively small number of collocation points per integral scale in the case of the exponential correlation which requires increasing resolution with increasing σ 2 the required resolution of the solution may lead to problem dimensions which exceed the available computational resources gotovac et al 2009 section 5 2 in line with the investigations discussed above we present in this article a comparative study of several numerical schemes for the darcy flow equations based on different concepts the schemes will be tested in terms of accuracy and convergence behavior on benchmark problems designed for a broad range of parameters describing the variance and the spectral complexity of the log hydraulic conductivity fields with both gaussian and exponential correlation structures used as models for heterogeneous aquifers comparisons of numerical schemes for flow problems have been made for constant hydraulic parameters the goal being to solve nonlinear reactive transport problems carrayrou et al 2010a 2010b for constant parameters on sub domains and complex geometry in order to simulate flow in fractured porous media de dreuzy et al 2013 flemisch et al 2018 by considering functional dependence of the hydraulic conductivity on temperature for coupled flow and heat transport grenier et al 2018 or in the case of heterogeneous hydraulic conductivity fields with low variability radu et al 2011 such comparative studies use benchmark problems and code intercomparison for the validation of the numerical methods carrayrou et al 2010a or whenever available comparisons with analytical solutions for the purpose of code verification e g grenier et al 2018 in the present study we adopt a different strategy the hydraulic conductivity is generated as a realization of a kraichnan random field kraichnan 1970 in a closed form consisting of finite sums of cosine random modes with a robust randomization method kramer et al 2007 kurbanmuradov and sabelfeld 2010 unlike in turning bands mantoglou and wilson 1982 or hydro gen bellin and rubin 1996 methods the kraichnan approach allows a direct control of the accuracy of the field by increasing the number of modes and of its variability through the variance of the log hydraulic conductivity random field moreover the explicit analytical form of the generated field allows the computation of the source term occurring when a manufactured analytical solution is forced to verify the flow equation brunner et al 2012 frank et al 2015 kurbanmuradov and sabelfeld 2010 oberkampf and blottner 1998 radu et al 2011 roache 2002 roy 2005 a realization of the hydraulic conductivity and the source term are computed by summing up cosine modes with parameters given by a fixed realization of the wave numbers and phases produced by the randomization method these parameters are computed with c codes and stored as data files codes written in different programming languages for instance matlab c or python load the same data files to construct precisely the same manufactured solution to be used in code verifications one obtains in this way a benchmark to evaluate the performance of different numerical methods for a wide range of variances of the log hydraulic conductivity and of the number of random modes considering beside the variance of the log conductivity the influence of the number of modes is crucial for several reasons this quantity controls the accuracy of the generated hydraulic conductivity fields and thus ensures accurate statistical simulations of the solutions of the partial differential equations which govern the darcy flow it also affects the ergodicity properties kramer et al 2007 kurbanmuradov et al 2013 of the simulation methods which infer statistics by performing spatial averages suciu et al 2016 the number of modes in randomization methods increases with the order of magnitude of the ratio between the maximum and the minimum length scales of the random field structure which has to be captured in numerical simulations while the maximum length scale should be larger than the correlation length of the random field and is practically given by the scale of the simulation the minimum scale is a smoothness microscale determined by the correlation length of the spatial increments of the field which is an analogous correlation length for the gradient of the random field e g kramer et al 2007 section 2 the relation between the number of modes and the scale ratio is determined by the correlation structure of the random field for instance for power law correlations it has been shown analytically that this relation is logarithmic or at most linear depending on the details of the randomization method kramer et al 2007 in the case of an exponential correlation and a small variance of the log hydraulic field it has been demonstrated by numerical investigations that in order to ensure the self averaging behavior of the simulated transport process the number of modes in the kraichnan routine has to be of the order of the number of correlation lengths traveled by the solute plume eberhard et al 2007 fig 4 hence while the variance characterizes the spatial heterogeneity of the aquifer system the number of modes used in the kraichnan randomization method to obtain accurate approximations of the hydraulic conductivity increases with the spatial scale of the flow and transport problem we compare the accuracy of the fdm the fem the discontinuous galerkin method dgm the chebyshev collocation spectral method csm and a newly developed global random walk method grw by solving two dimensional problems a galerkin spectral method gsm is tested only in the one dimensional case code verification is done by evaluating the errors with respect to manufactured analytical hydraulic head solutions for combinations of parameters of the kraichnan routine i e variances σ 2 of the log hydraulic conductivity between 0 1 and 6 and two different number of modes n 10 2 and n 10 3 estimations of the convergence order are obtained numerically by successive refinements of the discretization the codes verified in this way are further used to solve the homogeneous equation for the hydraulic head and to compute the darcy velocity ensembles of 100 realizations of the flow solution are computed and used in monte carlo inferences of the statistics of the hydraulic head and of the components of the darcy velocity the numerical methods are validated by comparisons with first order theoretical results bakr et al 1978 dagan 1989 mizell et al 1982 in order to test the numerical methods in conditions of hydraulic conductivity with increasing variability comparisons are done for log hydraulic conductivities with exponential and gaussian correlations testing the numerical schemes for these correlation models is highly relevant from the point of view the numerical difficulty of solving the flow problem indeed while the gaussian correlation ensures the smoothness of the generated hydraulic conductivity samples in the case of the exponential correlation the smoothness significantly deteriorates with the increase of the number of modes the generated samples approaching non differentiable functions in the limit of an infinite number of modes suciu 2010 2019 the remainder of this paper is organized as follows section 2 presents the benchmark problems the kraichnan randomization method and some considerations about the sample smoothness of the generated hydraulic conductivity fields with gaussian and exponential correlation the numerical schemes considered in this study are described in section 3 the results of the code verification by manufactured solutions are presented in section 4 1 and the convergence results in section 4 2 section 5 presents monte carlo inferences and comparisons with first order theory finally some conclusions of the present study are drawn in section 6 appendix a presents the computation of the manufactured solutions and appendix b contains tables with estimated order of convergence supplementary materials s1 s4 associated with this article are available in the online version 2 benchmark flow problems we consider the two dimensional steady state velocity field in saturated porous media with constant porosity determined by the gradient of the hydraulic head h x y according to darcy s law dagan 1989 1 v x k h x v y k h y where k x y is an isotropic hydraulic conductivity consisting of a fixed realization of a spatial random function the velocity solves a conservation equation v x x v y y 0 which after the substitution of the velocity components 1 gives the following equation for the hydraulic head 2 x k h x y k h y 0 we are looking for numerical solutions of the equations 1 2 in a rectangular domain x y ω 0 l x 0 l y subject to boundary conditions given by 3 h 0 y h h l x y 0 y 0 l y 4 h y x 0 h y x l y 0 x 0 l x where h is a constant head the hydraulic conductivity fields k considered in this study are isotropic log normally distributed with exponential and gaussian correlations the random log hydraulic conductivity field y ln k is specified by the ensemble mean y the variance σ 2 and the correlation length λ the kraichnan algorithm kraichnan 1970 used to generate samples of fluctuating part of the log hydraulic conductivity field y y y is a randomized spectral representation of statistically homogeneous gaussian fields kramer et al 2007 a general randomization formula valid for both exponential and gaussian correlation types is given by a finite sum of n cosine functions 5 y x y σ 2 n i 1 n cos ϕ i 2 π k i 1 x k i 2 y the probability density of the random vector k i 1 k i 2 is given by the fourier transform of the correlation function of the statistically homogeneous random field y divided by the variance σ 2 and the phases ϕi are random numbers uniformly distributed in 0 2π kurbanmuradov and sabelfeld 2010 eq 22 the smoothness of the k field is essentially determined by the correlation of the random field y sufficient conditions for sample smoothness are given by the existence of higher order derivatives of the correlation function c r y x y x r for instance in the one dimensional case if c r has a second order derivative at r 0 then the one dimensional field y x is equivalent to a field with samples that are continuous with probability one in every finite interval moreover if the fourth derivative c 4 0 exists y x is equivalent to a field the sample functions of which have with probability one continuous derivatives in every finite interval these sufficient conditions can hardly be relaxed and one expects that they are very close to the necessary conditions cramér and leadbetter 1967 yaglom 1987 the smoothness conditions of cramér and leadbetter 1967 are fulfilled for instance if the correlation of y has a gaussian shape c r e r 2 and is infinitely differentiable which results in a random field 5 with continuous sample derivatives a counterexample is the field y with an exponential correlation c r e r which is not differentiable at the origin since rigorously speaking the differentiability of c r at the origin is only a sufficient condition we proceed with numerical investigations on the sample smoothness of the k field for gaussian and exponential correlations of the log hydraulic conductivity y with λ 1 and σ 2 0 1 the estimations of the spatial derivative dk dx of a given realization of the numerically generated one dimensional k field with n 10 2 random modes in 5 computed at x 1 i δ x i 1 100 are presented in figs 1 and 2 in the case of the gaussian correlation the estimations approach the exact value of dk dx at x 1 obtained by differentiating the expression a 3 with y 1 fixed in the case of the exponential correlation of y the realization of the k field apparently approaches a non differentiable function for δx 102 then by further decreasing δx one observes a smooth behavior and the approach to the true value of dk dx at x 1 the impact of increasing the number of modes is illustrated by the convergence behavior of the numerical estimates of dk dx presented in figs 3 and 4 one remarks that while for gaussian correlation the number of modes has no impact the convergence towards the exact value of the derivative being practically achieved for δ x 10 2 for exponential correlation the resolution has to be increased four orders of magnitude δ x 10 6 to obtain an accurate approximation of the derivative when n increases one order of magnitude in order to investigate the robustness and the limits of applicability of the numerical schemes tested in this study we consider highly oscillating coefficients k generated by 5 for isotropic correlations of the random field y c r y x y y x r x y r y where r r x 2 r y 2 1 2 as correlation functions we consider the two extreme cases presented above i e the gaussian correlation 6 c r σ 2 exp r 2 λ 2 which yields analytical samples of y and respectively the exponential correlation 7 c r σ 2 exp r λ which in the limit of infinite number of modes n produces non smooth samples to compute the hydraulic conductivity k exp y exp y exp y the geometric mean k g exp y has to be specified either from experimental data or through its relation with other parameters of the flow problem such as the mean slope of the hydraulic head h l x j and the mean velocity u in this study we consider the second approach according to the boundary conditions 3 and 4 the mean velocity u 0 is aligned to the longitudinal axis x as an input in the field generator we use a mean hydraulic conductivity k related according to darcy s law 1 to the mean velocity and the mean slope by u k j further as far as we do not compare velocity fields for different σ 2 we generate random conductivity fields by using the relation between the arithmetic and the geometric mean of the log normal distribution k k g exp σ 2 2 the arithmetic mean approximates the effective hydraulic conductivity kh j if σ 2 1 gelhar 1986 zhang et al 2007 higher order corrections were also derived as asymptotic approximations for small σ 2 deng and cushman 1995 but our numerical tests have shown that neither of these corrections is appropriate for statistical inferences because they lead to underestimations of the mean velocity therefore to compare results obtained with different values of the parameter σ 2 presented in section 5 we normalize the velocity components by kgj see also kurbanmuradov and sabelfeld 2010 the mean hydraulic conductivity is fixed to k 15 m day a value representative for gravel or coarse sand aquifers dagan 1989 the correlation length λ in 6 and 7 is set to λ 1 m and the dimensions of the spatial domain are given in λ units in order to compare the results obtained by different schemes for a given realization of the field k the sets of wavenumbers k i 1 k i 2 and phases ϕi are computed with the algorithms for gaussian and exponential correlation functions described in kurbanmuradov and sabelfeld 2010 sects 5 2 and 5 3 implemented as c codes these coefficients computed for n m a x 10 4 modes i are stored as data files samples of the k field are further constructed for the desired numbers of modes n nmax and values of the variance σ 2 according to 5 the same numerical parameters can be used in either matlab c or python codes to ensure identical values of the k fields in the limit of double precision irrespective of the programming language for the purpose of statistical inferences ensembles of solutions of the flow equations are computed with the same algorithms implemented as functions in each particular scheme the longitudinal dimension of the domain lx has to be tens of times larger than λ for instance ababou et al 1989 recommend l x λ 25 constrained by considerations of computational tractability we fix the dimensions of the domain to l x 20 and l y 10 the constant head at the inflow boundary is fixed to h 1 to enable comparisons of the two dimensional solutions obtained with the fdm fem dgm and grw numerical schemes tested in the present benchmark the number of discretization points is set to n x 10 3 1 in the longitudinal direction and to n y 5 10 2 1 in the transverse direction consequently the space steps are fixed at δ x δ y 2 10 2 which for unit correlation length considered in this study gives λ δ x 50 this value is larger than the resolution of the log conductivity field usually considered in similar finite difference element approaches reported in the literature see e g bellin and rubin 1996 cainelli et al 2012 de dreuzy et al 2007 kurbanmuradov and sabelfeld 2010 the fixed resolution considered in this study is appropriate for flow solutions in the case of the gaussian correlation of the ln k field but could be too coarse in the case of the exponential correlation see figs 1 4 in the case of spectral approaches the number of collocation points for both csm and gsm schemes is chosen after preliminary tests as large as necessary possible optimal to ensure the desired accuracy see section 3 4 the codes based on the numerical schemes considered in this study are first verified by comparisons with manufactured solutions the approach consists of choosing analytical functions of the dependent variables h x y on which one applies the differential operator from the left hand side of eq 2 the result being a source term f hence h x y is an exact solutions of eq 2 with a source term f added in the right hand side and modified boundary functions according to the chosen manufactured solution e g roache 2002 roache 1998 an example of choosing the appropriate manufactured solution for the flow solver within a numerical setting similar to that of the present study can be found in kurbanmuradov and sabelfeld 2010 appendix b in order to test the numerical approximations of the differential operators in the flow eq 2 the manufactured solutions used in this study are simple but not trivial analytical functions with non vanishing derivatives up to the highest order of differentiation the construction of the manufactured solution and of the source term f is presented in appendix a for the purpose of code verification we chose 10 parameter pairs formed with σ 2 0 1 1 2 4 6 and the two numbers of modes considered in figs 3 and 4 n 10 2 and n 10 3 a larger set of 21 parameter pairs also including σ 2 8 σ 2 10 and n 10 4 has been considered in the extended version of this study alecsa et al 2020a note that the two values of n considered here are relevant for practical applications of the numerical codes a number of modes of the order 102 is required to obtain accurate simulations of the transport process over tens of correlation scales even for a small variance σ 2 0 1 and a linearized solution of the flow equation eberhard et al 2007 the larger number of modes n 10 3 is needed in the same conditions for simulation lengths of hundreds of correlation scales in the latter case the small spatial domain ω considered above can be thought of as a subdomain in a domain decomposition approach on the other hand the problem is linear and the correlation of the log hydraulic conductivity only depends on spatial lags scaled by the correlation length thus the results presented in this benchmark study also can represent solutions to problems with spatial dimensions scaled by the correlation length the code verification is completed by convergence tests aiming at comparing the computational order of convergence with the theoretical one for the fdm fem dgm and grw schemes computational orders of convergence are estimated by computing error norms of the solutions obtained by successively halving the spatial discretization step with respect to a reference solution obtained with the finest discretization see e g roy 2003 lord et al 2014 the approach is different in the case of spectral methods where the convergence is indicated by the decrease towards the round off plateau of the coefficients of the spectral representation aurentz and trefethen 2017 convergence tests are performed for n 10 2 10 3 and a larger range of variances σ 2 0 1 4 10 validations tests are finally conducted by comparing mean values and variances of the velocity components inferred from ensembles of 100 realizations of the solution of the homogeneous boundary value problem 1 4 for σ 2 0 1 0 5 1 1 5 2 and fixed n 10 2 with theoretical and numerical results given in the literature the formulation of the benchmark problems data files numerical codes and functions are given in a git repository alecsa et al 2020b which can help the interested readers to test their numerical methods for flows in highly heterogeneous aquifers 3 numerical methods in this section we describe the methods on which the codes participating in the present benchmark study are based for the fdm fem and dgm approaches based on well established finite difference element methods only a few aspects relevant for the construction of the numerical scheme will be summarized in the following the spectral approaches csm and gsm adapted to this benchmark as well as the grw algorithm using computational particles proposed in this article will be presented in more detail 3 1 finite difference method the finite difference method is known to be one of the most feasible and easily implementable numerical methods for partial differential equations larsson and thomée 2009 the inhomogeneous version of the flow problem 2 4 for the hydraulic head used in code verification tests consisting of comparisons with manufactured solutions presented in section 4 1 as well as the homogeneous problem 1 4 used to compute ensembles of velocity fields used for the validation purposes in section 5 are solved with the fdm of li et al 2017 the method leads to a linear system with a band matrix which is further solved with the mldivide function in our matlab implementation of the fdm codes the codes are based on the following discretization scheme 8 a i j h i 1 j b i j h i j 1 c i j h i j d i j h i 1 j e i j h i j 1 f i j where f i j i 1 n x j 1 n y represents the data f at the grid points xi yj and h i j is the value of the numerical solution at the same grid points in formula 8 we have used the following notations a i j 1 δ x 2 k x i δ x 2 y j b i j 1 δ y 2 k x i y j δ y 2 d i j 1 δ x 2 k x i δ x 2 y j e i j 1 δ y 2 k x i y j δ y 2 c i j a i j b i j d i j e i j 3 2 finite element method we consider the piecewise affine finite element method fem see e g knabner and angermann 2003 segerlind 1987 implemented in fenics alnæs et al 2015 the conductivity k and the source term f are interpolated into finite element spaces as well for this interpolation we consider piecewise quadratic elements better approximations can be obtained by taking higher order finite element spaces for k and f let us denote by γ1 0 lx 0 ly the part of the boundary where dirichlet conditions are imposed and by γ2 0 lx 0 ly the part of the boundary where neumann conditions are given consider a friedrichs keller triangulation t δ x where δ x δ y denotes the length of a short side of each isosceles right triangle the trial space contains continuous functions that are piecewise affine on each triangle and that satisfy the dirichlet boundary condition on γ1 the test space consists of continuous piecewise affine functions that vanish on γ1 for the non homogeneous eq 2 with right hand side f the linear fem solves for a trial function h δx such that for any test function φδx the following weak formulation is satisfied t δ x k h δ x φ δ x dx dy t δ x f φ δ x dx dy γ 2 k φ δ x h δ x ν ds where ν is the unit outward normal the assembled linear system of equations is solved with the default solver in fenics which is umfpack s unsymmetric multifrontal method 3 3 discontinuous galerkin method another method participating in the benchmark is the non symmetric interior penalty dgm we consider the same friedrichs keller triangulation t δ x as in the previous subsection assuming that the test and trial functions are element wise polynomials of degree at most p element wise multiplication of eq 2 with right hand side f by local test functions φδx with support only on t t δ x integration over t integration by parts and selection of suitable numerical fluxes yield the following equation for all t t δ x that are not adjacent to the domain s boundary t k h δ x φ δ x dx dy f f t f k φ δ x h δ x ν k h δ x φ δ x ν η δ x h δ x ν φ δ x ν d s t f φ δ x dx dy here f t denotes the set of faces of t ν is the unit outward normal with respect to t and η 0 is a stabilization parameter since the test and trial functions are discontinuous the numerical fluxes contain averages of functions the average of a function at a common interface f t t of elements t and t is component wise given as the arithmetic mean of the traces of this function the correct way to employ boundary conditions and precise definitions of the corresponding terms can be found in di pietro and ern 2012 riviere 2008 rupp 2019 the following simulations are carried out utilizing piecewise linear test and trial functions i e p 1 the implementation was made using the matlab octave toolbox festung frank et al 2015 the used dgm is known to be of convergence order 2 if the mesh is regular which holds in our case note that the dgm approach induces significantly larger linear systems of equations than a classical fem approximation of equal order on the same mesh this is due to the fact that for dgm schemes all elements contain three degrees of freedom dofs while for fem the corresponding dofs are shared across element boundaries this is illustrated in fig 5 where a coarse mesh is illustrated the center point is associated with six dofs in dgm while it is associated with a single dof in a fem approximation hence the size of the corresponding linear system of equations for dgm is approximately six times the size of the fem approximation when neglecting the boundary dofs where the ratio is only 3 1 and the corner dofs where the ratio is 2 1 or 1 1 as a consequence dgm approximations are more costly than fem approximations when performed on the same mesh but they also pose some advantages such as local mass conservation feasibility for local mesh and p adaptivity as well as an intuitive treatment of hanging nodes the linear systems of equations is solved with matlab s direct solver mldivide 3 4 spectral methods as an alternative to finite difference element methods we propose in the following the technique of collocation and galerkin spectral methods in order to solve one and two dimensional flow problems we refer to aurentz and trefethen 2017 weideman and reddy 2000 for a detailed description of the chebyshev collocation spectral method in our implementation of the csm schemes we use the explicit analytical expression a 3 of the two dimensional hydraulic conductivity field k x y for the one dimensional cases k x is obtained by setting y 1 in the expression a 3 of the two dimensional field these allow us to compute the derivatives k x x k x y and y k x y to avoid the need to know the analytical expression of the coefficients k we also adapt the algorithm of shen et al 2016 to construct a gsm approach for one dimensional flow problems 3 4 1 chebyshev collocation spectral methods we consider for the beginning the one dimensional problem 9 k h f x 0 l h 0 h h l 0 where f is a source sink term numerical solutions of the problem 9 are computed for a fixed length of the domain of l 200 for the beginning we homogenize the problem 9 by using the transformation 10 v x h x h l h 0 l x h 0 x 0 l replacing h x in 9 by 10 one obtains k x v x k x v x f x h l h 0 l k x x 0 l v 0 0 v l 0 further in order to apply the chebyshev spectral collocation we use the change of variables t 2 l x 1 to transform the flow problem from 0 l to 1 1 as follows 2 l k t v t 2 l 2 k t v t f t h l h 0 l k x t 1 1 v 1 0 v 1 0 where v t v l 2 t 1 k t k l 2 t 1 and k t k l 2 t 1 f t f l 2 t 1 the flow equation written in matrix form is given by 11 2 l diag k d 1 2 l diag k d 2 v f h l h 0 l k where d 1 and d 2 are the first and second order chebyshev differentiation matrices where we deleted the first and last rows and columns in order to incorporate the boundary conditions the matrices d 1 d 2 are generated with chebdif function given in weideman and reddy 2000 in the eq 11 k k and f are column vectors that contain the values of k k and f on the chebyshev nodes with the exception of the first and last points to establish the number of collocation points necessary to obtain the highest accuracy we first investigate the structure of the numerical solution of the non homogeneous version of the problem 9 in a scenario with extremely large parameters σ 2 10 and n 10 4 for gaussian correlation of the ln k field the source term and the dirichlet boundary conditions are obtained similarly to the procedure described in appendix a for the manufactured solution f x 3 sin x x 0 l in fig 6 we represent the absolute values of the coefficients of the solution s expansion in the phase space computed with the fast chebyshev transform versus the degree of the chebyshev polynomial we observe that for n 150 chebyshev points the coefficients reach the roundoff plateau since due to the accumulation of the truncation errors large numbers of points could result in an increased error we also compute the l error norm to establish the optimal value of n for gaussian and exponential correlation scenarios note that the analysis differs from case to case see alecsa et al 2020a tables 30 and 31 we also investigate the structure of the solution and the convergence for the homogeneous one dimensional problem f 0 in 9 for gaussian correlation of the ln k field and much smaller parameters σ 2 0 1 and n 10 2 see fig 7 in absence of an analytical solution of the homogeneous boundary value problem reaching the roundoff plateau is a guarantee that the numerical solution is highly accurate aurentz and trefethen 2017 we remark that at least n 2500 collocation points are needed to reach the roundoff plateau of the coefficients the much larger value of n is due to the spatial variability of the homogeneous solution see supplementary material s1 which cannot be represented by relatively small n as in the case of the simple manufactured solution of the non homogeneous problem in order to apply the chebyshev collocation method in the two dimensional case we reformulate the flow problem 2 4 into the square 1 1 2 similarly to the procedure used in the one dimensional case and we transform the boundary conditions by following the approach of hoepffner 2007 the optimal number of chebyshev points for the inhomogeneous problem is established similarly to the one dimensional case by increasing n from 44 to 64 in both directions and by computing the l error for combinations of parameters n and σ 2 in both gaussian and exponential scenarios see alecsa et al 2020a tables 34 and 35 in the case of the homogeneous two dimensional problem the roundoff plateau is reached with about n y 130 points in the y direction but a significantly larger number nx of points would be necessary in the x direction alecsa et al 2020a figs 8 and 9 since according to the discretization scheme 11 the dimension of the problem increases as n x 2 n y 2 solving homogeneous two dimensional problems with csm schemes requires much larger memory usage than finite difference element schemes 3 5 chebyshev galerkin spectral method for one dimensional flow problems the flow equation in 9 is a particular case of that considered in the gsm approach of shen et al 2016 α x u β x u f x x a b corresponding to α x 0 and β x k x the chebyshev galerkin spectral method of shen et al 2016 will be used in section 4 1 to solve one dimensional test problems unlike the csm schemes presented above the gsm approach avoids the need to compute the derivative of k by using the weak formulation of the problem the gsm approach can be applied to more general situations where an analytical form of the k field is not available 3 6 global random walk method grw algorithms solve parabolic partial differential equations by moving computational particles on regular lattices suciu 2014 2019 vamoş et al 2003 solutions of the elliptic equation for the hydraulic head with time independent boundary conditions can be obtained by solving the associated nonstationary equation with grw algorithms on staggered grids c vamoş 2016 unpublished following this idea we look for a solution of the flow eq 2 with a source term in the right hand side given by the steady state limit of the solution of the explicit staggered finite difference scheme 12 1 a δ t h i j k 1 h i j k 1 δ x 2 k i 1 2 j h i 1 j k h i j k k i 1 2 j h i j k h i 1 j k 1 δ y 2 k i j 1 2 h i j 1 k h i j k k i j 1 2 h i j k h i j 1 k f where a is a constant equal to a unit length the field of hydraulic head is further approximated with a system of n random walkers on the regular lattice of the finite difference scheme as h i δ x k δ t n i k a n considering in 12 δ x δ y as in section 2 the hydraulic conductivity the time step δt and the space step δx are related by the dimensionless parameter 13 r i j k i δ x j δ x a δ t δ x 2 with these the staggered scheme 12 becomes 14 n i j k 1 1 r i 1 2 j r i 1 2 j r i j 1 2 r i j 1 2 n i j k r i 1 2 j n i 1 j k r i 1 2 j n i 1 j k r i j 1 2 n i j 1 k r i j 1 2 n i j 1 k n f δ t where the source term is approximated by using the floor function the contributions to lattice sites i j from neighboring sites summed up in 14 are obtained with the grw algorithm which moves particles from sites l m to first neighbor sites according to 15 n l m k δ n l m l m k δ n l 1 m l m k δ n l 1 m l m k δ n l m 1 l m k δ n l m 1 l m k for consistency with eq 14 the stochastic averages of the quantities δ in 15 verify 16 δ n l m k 1 r l 1 2 m r l 1 2 m r l m 1 2 r l m 1 2 n l m k δ n l 1 m l m k r l 1 2 m n l m k δ n l m 1 l m k r l m 1 2 n l m k the parameters r defined by 13 are jump probabilities which as follows from 16 are restricted by 0 r 1 4 the δ terms in 15 are binomial random variables they are efficiently approximated by applying the relation for averages 16 to the actual numbers of particles at lattice sites next the reminders of multiplication by r and of the floor function applied to n f δ t are summed up and a particle is allocated to the lattice site where the sum of reminders reaches the unity see suciu 2019 section 3 3 2 2 giving up the particle indivisibility and representing n by real numbers one obtains a deterministic grw algorithm where the numbers of particles jumping to neighbor sites or remaining at the same site are exactly given by the relations 16 without average preliminary tests indicate that the grw algorithm with particles requires fewer time iterations to reach the steady state but the deterministic version which preforms fewer arithmetical operations per iteration step is overall faster therefore in the following we use the deterministic grw algorithm implemented in matlab or c codes to solve the flow equation by the grw algorithm 13 16 the boundary conditions 3 and 4 have to be completed by appropriate initial conditions the homogeneous problem f 0 is solved for an initial condition given by the mean slope of the pressure head determined by the dirichlet boundary conditions for comparison with analytical manufactured solutions the inhomogeneous problem f 0 is solved for an initial condition given be the analytical solution itself for an arbitrary initial condition one obtains a transitory non stationary grw solution which approaches the stationary solution after a number of time iterations depending on the level of difficulty of the particular problem the steady state is indicated by a constant number of particles or in the case of the deterministic grw by the total mass defined as integral of the solution over the lattice normalized by the final mass as illustrated in figs 8 and 9 for different solutions of the homogeneous problem the iterations needed to obtain stationary solutions require considerably large computing time from 10 minutes for 2 106 iterations to 2 5 hours for 2 107 iterations faster computations can be designed by using a domain decomposition parallelization of each iteration most of the computations were carried out with a matlab implementation of the grw code for the comparisons with manufactured solutions in the case of the exponential correlation of the ln k field which take very long time we use an executable mex function of a c implementation of the flow solver this procedure speeds up the computation by a factor of 1 5 4 benchmark tests 4 1 code verification by manufactured solutions the non homogeneous problem problem 2 4 with source term given by a 4 and modified dirichlet and neumann boundary conditions a 2 is solved on the two dimensional domain described in section 2 the problem is parameterized by using the sets of wavenumbers and phases for a fixed realizations of the ln k field stored in the git repository flowbenchmark alecsa et al 2020b the fdm fem dgm and grw schemes are constructed on uniform grids with step sizes δ x δ y 2 10 2 in all cases excepting those of grw solutions for gaussian correlation where δ x δ y 10 1 and the errors of the numerical solutions h i j with respect to the manufactured solution h xi yj given by a 1 are quantified by the discrete l 2 norm the csm solutions are computed for the optimal number of chebyshev points identified by preliminary tests as explained in section 3 4 1 above and the errors at collocation points are quantified by the vector l norm the code verification results for the two values of n and increasing variances of the ln k field are presented in tables 1 4 as shown in table 1 all the methods solve the test problems in the gaussian cases with n 10 2 with a good or at least an acceptable accuracy the increase of the number of modes to n 10 3 table 2 affects the accuracy of the fdm and grw schemes which produce errors larger that one i e 50 from the maximum value of the manufactured solution a 1 for σ 2 6 fdm and σ 2 2 grw there are also significant differences among the methods the accuracy of the dgm scheme is one and two orders of magnitude better than that of the fdm and fem schemes and the precision of the csm scheme is close to the roundoff plateau the grw solutions computed on a coarser grid are still accurate up to n 10 3 and σ 2 1 since the time needed to reach steady state grw solutions ranges from a few minutes to a couple of hours for the cases shown in these tables the cases with σ 2 2 were not investigated with the grw method for exponential correlation of the ln k field excepting csm the accuracy of all the other schemes is affected by the increase of n and σ 2 tables 3 and 4 for the fdm and the fem schemes the errors become larger than one for n 10 2 with σ 2 1 and σ 2 2 respectively and take huge values of the order 103 and 102 respectively for n 10 3 and σ 2 6 accurate dgm solutions are realizable for σ 2 2 in case n 10 2 and for σ 2 1 in case n 10 3 for the same resolution of the grid δ x δ y 2 10 2 stationary grw solutions in exponential cases can be obtained after considerable large numbers of iterations from 106 to more than 108 which require computing times from hours to days note that in the cases n 10 3 with σ 2 1 and σ 2 2 the grw solutions are not yet strictly stationary and the corresponding l 2 values have to be regarded as lower bound errors in these circumstances accurate grw solutions are feasible for n 10 2 and σ 2 1 or for n 10 3 and σ 2 0 1 the extremely small errors of the csm solutions should not be surprising for a fixed realization of the random field k the coefficients and their derivatives used in the csm schemes are analytical functions see section 3 4 1 the source function a 4 is an analytical function as well since all these functions are evaluated at the collocation points with the machine precision the only source of errors can be the limited number of points used to represent the solution this number is relatively small in the case of the smooth analytical solution a 4 if the same problem is solved with the gsm scheme which does not use the derivative of the coefficients a much larger number of points is needed to resolve the structure of the k and f fields this situation is illustrated by the comparison of the csm and gsm errors in table 5 which shows that accurate gsm solutions are obtained by increasing the density of the collocation points by one order of magnitude in the case of the gaussian correlation of the ln k field and by two orders of magnitude in the exponential case 4 2 convergence results numerically estimated orders of convergence eoc of the fdm fem dgm and grw schemes for combinations of parameters n and σ 2 are presented in appendix b they are computed from numerical solutions of the homogeneous problem obtained for successive refinements of the grid according to formula b 1 for the non stationary grw scheme the eoc values are computed from solutions on refined grids after the first temporal iteration in the gaussian case the eoc values are close to the theoretical convergence order 2 for all schemes see tables b 1 b 3 b 5 and b 7 the situation is different in the case of the exponential correlation of the ln k field the results for the fdm scheme presented in table b 2 show an irregular behavior of the eoc values negative values corresponding to non monotonous decrease of the error and the lack of a general decreasing trend of the errors for almost all combinations of n and σ 2 for the other three schemes there are no negative eoc values but the order of convergence deteriorates to 1 or 1 5 in most cases see tables b 4 b 6 and b 8 hence the convergence behavior is strongly influenced by the shape of the correlation function but there is no evidence for a dependence on n and σ 2 the convergence of the csm scheme can be assessed indirectly by verifying the behavior of the chebyshev coefficients as we have seen in section 3 4 1 the convergence of the csm scheme for homogeneous problems requires much larger numbers of collocation points than in the inhomogeneous cases with the maximum number of 160 points on both spatial directions permitted by the computational constraints the solutions for n 10 2 and σ 2 0 1 are accurate enough to be used in monte carlo simulations only for gaussian correlation of the ln k field with the same parameters and exponential correlation function the csm scheme may produce quite inaccurate solutions for some realizations of the k field see section 5 below 5 statistical inferences ensembles of numerical solutions of the flow problem are often used for the purpose of validation of the numerical schemes through comparisons with first order approximation results e g bellin et al 1992 de dreuzy et al 2007 salandin and fiorotto 1998 srzic et al 2013 the latter are obtained by perturbation expansions truncated at the first order in σ 2 equivalent to a linearization of the flow problem 1 4 e g dagan 1989 gelhar and axness 1983 here we consider first order approximations of the velocity field numerically generated with a kraichnan procedure based on proportionality of the spectral densities of the random velocity and that of the ln k field suciu et al 2016 appendix a the number of random periodic modes used in the kraichnan generators of the hydraulic conductivity and of the velocity field in the case of the linear approximation is set to n 100 validation tests of the five schemes are performed for ln k fields with gaussian and exponential correlations and a fixed small variance σ 2 0 1 the deviation from the predictions of the linear approximation is further investigated with the fdm fem dgm and grw schemes for increasing σ 2 of 0 5 1 1 5 and 2 the number of realizations in all cases investigated here is fixed to r 100 numerical investigations indicate that the chosen values of the parameters n and r ensure unbiased statistical estimations of the dispersion of a passive scalar transported over tens of correlation lengths in heterogeneous aquifers characterized by a small variance σ 2 0 1 of the ln k field eberhard et al 2007 the homogenous problem 1 4 is solved in the same two dimensional domain with l x 20 and l y 10 as that used for code verification tests in the previous section graphical illustrations and analysis of numerical solutions are given in supplementary materials s1 to s4 the ensemble of realizations were computed for space steps δ x δ y 0 02 with the fdm scheme and to reduce the computational effort for larger steps δ x δ y 0 05 with the fem and dgm schemes and δ x δ y 0 1 with the grw scheme constrained by the maximum matlab array size allowed on the computer used to obtain csm solutions we use a limited number of 160 chebyshev collocation points in both x and y directions even though a larger number of points in x direction is required to obtain accurate solutions see alecsa et al 2020a fig 9 sample solutions obtained with fdm are illustrated in supplementary material s1 fem dgm and grw solutions not shown in s1 have a similar appearance instead among the realizations of the csm solution for exponential correlation of the ln k field there also are unacceptable solutions with extremely large and irregular variations therefore we selected an ensemble of 100 valid realizations by disregarding the bad solutions after the visual inspection of the larger initial ensemble of solutions as illustrated in supplementary material s2 the issue of bad realizations is common in situations where due to computational constraints numerical simulations have to be conducted on relatively coarse grids we already encountered this issue during the preparation of the transport simulations presented in radu et al 2011 suciu et al 2013 monte carlo inferences of the mean and variance are obtained by computing averages over the ensembles of r realizations followed by spatial averages suciu et al 2006 appendix b3 error bounds of the ensemble space averages are given by standard deviations of the ensemble averages at grid points estimated by spatial averages the spatial averaging domain is an inner region of the computational domain unaffected by the boundary conditions approximately delimited by visual inspection of the variances estimated on longitudinal and transverse sections through the computation domain presented in supplementary materials s3 and s4 see also bellin et al 1992 kurbanmuradov and sabelfeld 2010 theoretical investigations indicate that the variance of the hydraulic head is much smaller than that of the hydraulic conductivity spectral perturbation approaches for flow in two and three dimensions predict variances of the order σ h 2 σ λ j 2 ababou et al 1989 bakr et al 1978 mizell et al 1982 the estimated variances presented in table 6 show an acceptable agreement with the spectral theory which for our numerical parameters predict σ h 2 10 4 the first order approximate relations between the variance of the velocity components σ v x 2 and σ v y 2 and the variance σ 2 of the ln k field are given by σ v x 2 3 8 σ 2 u and σ v y 2 1 8 σ 2 u respectively dagan 1989 eq 3 7 27 note that these relations do not depend on the shape of the correlation function of the ln k field since as mentioned in section 2 for the purpose of statistical inferences we use dimensionless velocities u 1 then with the smallest variance of the ln k field considered in this study σ 2 0 1 the velocity variances predicted by the linear theory are σ v x 2 3 75 10 2 and σ v y 2 1 25 10 2 respectively the estimated mean values and variances of the velocity components are presented in tables 7 and 8 fdm fem dgm and grw results are generally close to the theoretical first order predictions within a range of less than 10 for the fdm fem dgm and grw approaches excepting fem estimated variance of the transverse velocity in the gaussian case which deviates with about 30 csm results show deviations of about 30 for the variance of the transverse velocity in the gaussian case and deviations even larger than 100 for both velocity variances in the exponential case these differences can be again attributed to the limited number of collocation points used in the csm approach the results obtained with the fdm fem dgm and grw approaches for larger σ 2 are shown in figs 10 and 11 we remark that the velocity variances progressively increase above the trend predicted by the linear theory similarly to the monte carlo results presented in the literature e g bellin et al 1992 kurbanmuradov and sabelfeld 2010 salandin and fiorotto 1998 the differences between the results obtained with the three methods remain within the estimated error bounds determined by the present numerical setup number of realizations resolution and dimension of the computational domain for σ 2 0 5 the estimated variances practically coincide with the first order predictions within this range velocity fields can be quite well approximated by the linearized solution of the flow problem and simulations of solute transport in groundwater can be carried out with kraichnan generated velocity fields at lower computational costs suciu et al 2006 suciu 2014 suciu et al 2016 we conclude this section with a remark about the grw results the ensembles of grw simulations were computed for 106 iterations in all cases excepting the gaussian case with σ 2 2 where the number of iterations was set to 5 106 as indicated by figs 8 and 9 as well as by supplementary materials s3 and s4 these numbers of iterations are not large enough to ensure the convergence of the solution for homogeneous problems surprisingly the variance estimates from tables 7 and 8 deviate with maximum 10 from the predictions of the first order theory for small σ 2 for larger σ 2 the grw results are also close to those obtained with the fdm fem and dgm schemes for σ 2 2 in gaussian case fig 10 and for σ 2 0 5 in exponential case fig 11 6 discussion and conclusions the numerical approaches tested in the present benchmark study passed at least partially the validation test consisting of comparisons of the numerical solutions obtained for σ 2 0 1 and n 100 with theoretical results provided by first order perturbation approaches for larger variances up to σ 2 2 the statistical inferences performed by averaging over monte carlo ensembles of solutions given by the fdm fem dgm and grw schemes were close to those obtained by simulations with similar numerical setup reported in the literature however these encouraging results are not a guarantee for the accuracy of the numerical method for higher values of σ 2 and n needed to solve the flow problem for highly heterogeneous aquifers and large spatial scales this is indicated for instance by the situation of the grw ensembles of solutions for gaussian correlation of the ln k field which provide satisfactory statistical estimates even though they are not yet convergent see section 5 and cannot be used for single realization approaches in subsurface hydrology for gaussian correlation of the ln k field the code verification tests were accurately solved with the exception of the fdm solution for n 10 3 and σ 2 6 and that of the grw solutions for n 10 3 and σ 2 2 instead in the case of the exponential correlation for all the schemes excepting the csm scheme there are ranges of parameters for which accurate solutions are not realizable n 102 σ 2 1 for fdm n 102 σ 2 2 for fem n 10 2 σ 2 4 and n 10 3 σ 2 2 for dgm n 10 2 σ 2 2 and n 10 3 σ 2 1 for grw the limited solvability of the flow problem in the exponential case found in our benchmark study for a resolution of the numerical solution which is one order of magnitude higher than usually recommended see e g ababou et al 1989 de dreuzy et al 2007 completes similar results presented in the literature for instance cainelli et al 2012 report difficulties to obtain the convergence of their numerical schemes for exponential correlation of the ln k field with σ 2 2 and gotovac et al 2009 show that for high resolution of the exponentially correlated ln k field with σ 2 2 the required discretization of the hydraulic head solution exceeds the limit of the available computing resources the observed large errors produced by the three related discretization schemes fdm fem and dgm in the test scenarios with exponential correlation and large values of the parameters n and σ 2 cf tables 3 and 4 may be explained as follows the listed errors consist of the discretization error of the respective numerical scheme and the error of the linear solver in practice the latter one cannot be computed however the observed high condition numbers and the computed residuals indicate that the error of the linear solver grows when using the above mentioned parameters in fact the product of condition number and residual is an upper bound for the arithmetic error kelley 1995 more precisely we found that the condition number increases with σ 2 in a comparable way for both gaussian and exponential correlation models and for both numbers of modes the residuals remain almost unchanged in the gaussian case but in exponential case the increase of σ 2 and n cause the increase of the residuals and consequently the increase of the error bound alecsa et al 2020a section 9 regarding the linear solver for the fdm and dgm schemes we used matlab s direct solver mldivide which for our system matrices calls umfpack s unsymmetric multifrontal method davis 2006 and for the fenics implementation of the fem scheme we used the default solver in fenics which calls umfpack as well we also tested various other solvers e g umfpack s spqr davis 2011 and ilupack s amg solver bollhöfer et al 2011 however a smaller residual was not producible in exponential cases of large n and σ 2 the coefficients k contain large numbers of periodic modes with amplitudes spanning over several orders of magnitude the high resolution necessary to prevent the occurrence of ill conditioned matrices and large residuals leads to extremely large degrees of freedom of the linear system of equations which render impractical from the point of view of computational resources the use of direct flow solvers such as fdm fem and dgm considered in this study a possible remedy could be provided by numerical upscaling techniques developed for problems with rough coefficients which capture the effect of small scales on large scales without resolving the small scale details calo et al 2011 hou et al 1999 kornhuber et al 2018 csm schemes verify the manufactured analytical solutions with extremely small errors in both one and two dimensional cases this high precision is rendered possible by the use of the analytical expressions of the derivatives of the k field given by the kraichnan algorithm the convergence is demonstrated by the decrease of chebyshev coefficients towards the roundoff plateau the non homogeneous flow problem can be solved with relatively small numbers of collocation points less than 100 points on both spatial directions which are enough for the spectral representation of the simple smooth manufactured solutions chosen for the purpose of code verification but in the case of highly oscillating solutions of the homogeneous problem for exponential correlation of the ln k field a much larger number of points is required which increases the dimension of the problem beyond the limit of the available memory due to this constraint the maximum number of collocation points in each direction has been fixed to 160 which did not ensure reliable solutions for all the realizations of ln k the gsm scheme has been proposed to avoid the use of the analytical derivative of the hydraulic conductivity k and has been used only in solving the one dimensional non homogeneous problem for comparisons with manufactured solutions the errors are again very small in the gaussian case but extremely large in the exponential case some tests made in the attempt to improve the precision indicate that exceedingly large computing resources would be necessary to render the problem computationally feasible see table 5 the grw scheme is a transitory scheme using computational particles which is accurate and unconditionally stable the drawback is the large number of time iterations needed to reach the stationary state corresponding to the steady state solution of the flow problem in the gaussian case approximations with satisfactory accuracy of the manufactured solution can be obtained with a coarse discretization in reasonable computing times from minutes to hours in the exponential case a much finer discretization is needed and the computing time increases from hours to days the numerical schemes tested so far on benchmark problems have their own strengths which make them useful in specific applications depending on the objective pursued fdm schemes are appropriate for fast computations of monte carlo ensembles in case of moderate aquifer heterogeneity fem and dgm schemes are appropriate to cope with higher heterogeneity in either single realization or monte carlo approaches grw is rather appropriate for single realization flow problems with heterogeneous coefficients and csm gsm approaches could be useful in solving problems with heterogeneous coefficients and source terms given by smooth functions we have seen that all the schemes tested in this study face the issue of computational feasibility in the case of the exponential structure of the log conductivity field it is therefore recommendable that unless well documented by experimental data for a specific problem the exponential correlation model should be avoided instead gaussian models can be used to account for effective dispersion associated with an integral scale dagan 1989 trefry et al 2003 as well as in flow and transport simulations for fractal aquifer structures e g di federico and neuman 1997 declaration of competing interests the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper credit authorship contribution statement cristian d alecsa methodology writing review editing imre boros writing review editing florian frank writing review editing peter knabner supervision mihai nechita writing review editing alexander prechtel formal analysis writing review editing andreas rupp writing review editing nicolae suciu conceptualization writing review editing acknowledgements the authors are grateful to dr maria crăciun for her help in testing the random field generators and to dr emil cătinaş for carefully reading the manuscript andreas rupp acknowledges the financial support of the deutsche forschungsgemeinschaft dfg german research foundation under grants ru 2179 251268514 mad soil microaggregates formation and turnover of the structural building blocks of soils and exc 2181 390900948 structures a unifying approach to emergent phenomena in the physical world mathematics and complex data the work of nicolae suciu was supported by the dfg grant su 415 4 1 405338726 integrated global random walk model for reactive transport in groundwater adapted to measurement spatio temporal scales appendix a manufactured solutions we consider the following smooth manufactured solution a 1 h x y 1 sin 2 x y with x 0 l x and y 0 l y along with the dirichlet and neumann boundary conditions a 2 h 0 y 1 sin y y 0 l y h l x y 1 sin 2 l x y y 0 l y h y x 0 cos 2 x x 0 l x h y x l y cos 2 x l y x 0 l x the function k is given by a 3 k x y c 1 exp c 2 i 1 n cos ϕ i 2 π k i 1 x k i 2 y where we use the shorthand notations c 1 k exp σ 2 2 and c 2 σ 2 n after inserting a 1 and a 3 in eq 2 one obtains a source term f where f has the following form a 4 f x y 2 c 1 c 2 i 1 n 2 π k i 1 sin ϕ i 2 x k i 1 y k i 2 π exp c 2 i 1 n cos ϕ i 2 x k i 1 y k i 2 π cos 2 x y 5 c 1 exp c 2 i 1 n cos ϕ i 2 x k i 1 y k i 2 π sin 2 x y c 1 c 2 i 1 n 2 π k j 2 sin ϕ i 2 x k i 1 y k i 2 π exp c 2 i 1 n cos ϕ i 2 x k i 1 y k i 2 π cos 2 x y appendix b estimated order of convergence the convergence of the numerical schemes is investigated numerically by solving the homogeneous problem 2 4 for successive refinements of the grid see e g lord et al 2014 the hydraulic conductivity fields k are computed for each pair of parameters n and σ 2 with the same sets of wavenumbers and phases as those used above for the code verification procedure in section 4 1 we start with δ x δ y 10 1 and obtain 5 refinements of the grid by successively halving the space steps up to δ x δ y 3 125 10 3 in the case of fdm and grw schemes and with refinements from δ x δ y 4 10 1 to δ x δ y 1 25 10 3 for fem and dgm schemes the corresponding solutions are denoted by h k k 1 6 the estimated order of convergence that describes the decrease in logarithmic scale of the error quantified by the vector norm ε k h k h 6 l 2 is computed according to b 1 e o c log ε k ε k 1 log 2 k 1 4 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103558 appendix c supplementary materials image application 1 image application 2 image application 3 image application 4 ababou mclaughlin gelhar tompson 1989 r ababou d mclaughlin l w gelhar a f tompson numerical simulation of three dimensional saturated flow in randomly heterogeneous porous media transp porous media 4 6 1989 549 565 10 1007 bf00223627 ababou r mclaughlin d gelhar l w tompson a f 1989 numerical simulation of three dimensional saturated flow in randomly heterogeneous porous media transp porous media 4 6 549 565 10 1007 bf00223627 alecsa et al 2020 alecsa c d boros i frank f knabner p nechita m prechtel a rupp a suciu n 2020a benchmark for numerical solutions of fow in heterogeneous groundwater formations arxiv 1911 10774 alecsa et al 2020b alecsa c d boros i frank f knabner p nechita m prechtel a rupp a suciu n 2020b git repository https github com pmflow flowbenchmark doi 10 5281 zenodo 3662401 alnæs blechta hake johansson kehlet logg richardson ring rognes wells 2015 m s alnæs j blechta j hake a johansson b kehlet a logg c richardson j ring m e rognes g n wells the fenics project version 1 5 arch numer softw 3 100 2015 9 23 10 11588 ans 2015 100 20553 alnæs m s blechta j hake j johansson a kehlet b logg a richardson c ring j rognes m e wells g n 2015 the fenics project version 1 5 archive of numerical software 3 100 9 23 10 11588 ans 2015 100 20553 aurentz trefethen 2017 j l aurentz l n trefethen chopping a chebyshev series acm trans math softw toms 43 4 2017 33 10 1145 2998442 aurentz j l trefethen l n 2017 chopping a chebyshev series acm transactions on mathematical software toms 43 4 33 10 1145 2998442 bakr gelhar gutjahr macmillan 1978 a a bakr l w gelhar a l gutjahr j r macmillan stochastic analysis of spatial variability in subsurface flows 1 comparison of one and three dimensional flows water resour res 14 2 1978 263 271 10 1029 wr014i002p00263 bakr a a gelhar l w gutjahr a l macmillan j r 1978 stochastic analysis of spatial variability in subsurface flows 1 comparison of one and three dimensional flows water resour res 14 2 263 271 10 1029 wr014i002p00263 bellin rubin 1996 a bellin y rubin hydro gen a spatially distributed random field generator for correlated properties stoch hydrol hydraul 10 4 1996 253 278 10 1007 bf01581869 bellin a rubin y 1996 hydro gen a spatially distributed random field generator for correlated properties stoch hydrol hydraul 10 4 253 278 10 1007 bf01581869 bellin salandin rinaldo 1992 a bellin p salandin a rinaldo simulation of dispersion in heterogeneous porous formations statistics first order theories convergence of computations water resour res 28 9 1992 2211 2227 10 1029 92wr00578 bellin a salandin p rinaldo a 1992 simulation of dispersion in heterogeneous porous formations statistics first order theories convergence of computations water resour res 28 9 2211 2227 10 1029 92wr00578 bohling liu dietrich butler 2016 g c bohling g liu p dietrich j j butler reassessing the made direct push hydraulic conductivity data using a revised calibration procedure water resour res 52 11 2016 8970 8985 10 1002 2016wr019008 bohling g c liu g dietrich p butler j j 2016 reassessing the made direct push hydraulic conductivity data using a revised calibration procedure water resour res 52 11 8970 8985 10 1002 2016wr019008 bollhöfer aliaga martín quintana ortí 2011 m bollhöfer j i aliaga a f martín e s quintana ortí ilupack in padua d a ed encyclopedia of parallel computing 2011 springer new york 917 926 10 1007 978 0 387 09766 4 513 bollhöfer m aliaga j i martín a f quintana ortí e s 2011 ilupack in padua d a ed in encyclopedia of parallel computing springer new york pp 917 926 10 1007 978 0 387 09766 4 513 brunner radu bause knabner 2012 f brunner f a radu m bause p knabner optimal order convergence of a modified bdm1 mixed finite element scheme for reactive transport in porous media adv water resour 35 2012 163 171 10 1016 j advwatres 2011 10 001 brunner f radu f a bause m knabner p 2012 optimal order convergence of a modified bdm1 mixed finite element scheme for reactive transport in porous media adv water resour 35 163 171 10 1016 j advwatres 2011 10 001 cainelli bellin putti 2012 o cainelli a bellin m putti on the accuracy of classic numerical schemes for modeling flow in saturated heterogeneous formations adv water resour 47 2012 43 55 10 1016 j advwatres 2012 06 016 cainelli o bellin a putti m 2012 on the accuracy of classic numerical schemes for modeling flow in saturated heterogeneous formations adv water resour 47 43 55 10 1016 j advwatres 2012 06 016 calo efendiev galvis 2011 v calo y efendiev j galvis a note on variational multiscale methods for high contrast heterogeneous porous media flows with rough source terms adv water resour 34 9 2011 1177 1185 10 1016 j advwatres 2010 12 011 calo v efendiev y galvis j 2011 a note on variational multiscale methods for high contrast heterogeneous porous media flows with rough source terms adv water resour 34 9 1177 1185 10 1016 j advwatres 2010 12 011 carrayrou et al 2010a j carrayrou j hoffmann p knabner s kräutle c de dieuleveult j erhel j van der lee v lagneau k u mayer k t macquarrie comparison of numerical methods for simulating strongly nonlinear and heterogeneous reactive transport problems the momas benchmark case comput geosci 14 3 2010 483 502 10 1007 s10596 010 9178 2 carrayrou j hoffmann j knabner p krä utle s de dieuleveult c erhel j van der lee j lagneau v mayer k u macquarrie k t 2010a comparison of numerical methods for simulating strongly nonlinear and heterogeneous reactive transport problems the momas benchmark case comput geosci 14 3 483 502 10 1007 s10596 010 9178 2 carrayrou kern knabner 2010b j carrayrou m kern p knabner reactive transport benchmark of momas comput geosci 14 3 2010 385 392 10 1007 s10596 009 9157 7 carrayrou j kern m knabner p 2010b reactive transport benchmark of momas comput geosci 14 3 385 392 10 1007 s10596 009 9157 7 cordes putti 2001 c cordes m putti accuracy of galerkin finite elements for groundwater flow simulations in two and three dimensional triangulations int j numer meth eng 52 4 2001 371 387 10 1002 nme 194 cordes c putti m 2001 accuracy of galerkin finite elements for groundwater flow simulations in two and three dimensional triangulations int j numer meth eng 52 4 371 387 10 1002 nme 194 cramér leadbetter 1967 h cramér m r leadbetter stationary and related stochastic processes 1967 john wiley sons new york cramér h leadbetter m r 1967 stationary and related stochastic processes john wiley sons new york dagan 1989 g dagan flow and transport in porous formations 1989 springer berlin dagan g 1989 flow and transport in porous formations springer berlin davis 2006 t a davis direct methods for sparse linear systems siam 2 2006 10 1137 1 9780898718881 davis t a 2006 direct methods for sparse linear systems siam 2 10 1137 1 9780898718881 davis 2011 t a davis algorithm 915 suitesparseqr multifrontal multithreaded rank revealing sparse qr factorization acm trans math softw 38 1 2011 10 1145 2049662 2049670 davis t a 2011 algorithm 915 suitesparseqr multifrontal multithreaded rank revealing sparse qr factorization acm trans math softw 38 1 article 8 10 1145 2049662 2049670 article 8 deng cushman 1995 f w deng j h cushman on higher order corrections to the flow velocity covariance tensor water resour res 31 7 1995 1659 1672 10 1029 94wr02974 deng f w cushman j h 1995 on higher order corrections to the flow velocity covariance tensor water resour res 31 7 1659 1672 10 1029 94wr02974 di federico neuman 1997 v di federico s p neuman scaling of random fields by means of truncated power variograms and associated spectra water resour res 33 1997 1075 1085 10 1029 97wr00299 di federico v neuman s p 1997 scaling of random fields by means of truncated power variograms and associated spectra water resour res 33 1075 1085 10 1029 97wr00299 di pietro ern 2012 d a di pietro a ern mathematical aspects of discontinuous galerkin methods 2012 springer heidelberg di pietro d a ern a 2012 mathematical aspects of discontinuous galerkin methods springer heidelberg de dreuzy beaudoin erhel 2007 j r de dreuzy a beaudoin j erhel asymptotic dispersion in 2d heterogeneous porous media determined by parallel numerical simulations water resour res 43 2007 w10439 10 1029 2006wr005394 de dreuzy j r beaudoin a erhel j 2007 asymptotic dispersion in 2d heterogeneous porous media determined by parallel numerical simulations water resour res 43 w10439 10 1029 2006wr005394 de dreuzy pichot poirriez erhel 2013 j r de dreuzy g pichot b poirriez j erhel synthetic benchmark for modeling flow in 3d fractured media comput geosci 50 2013 59 71 10 1016 j cageo 2012 07 025 de dreuzy j r pichot g poirriez b erhel j 2013 synthetic benchmark for modeling flow in 3d fractured media comput geosci 50 59 71 10 1016 j cageo 2012 07 025 eberhard suciu vamos 2007 j p eberhard n suciu c vamos on the self averaging of dispersion for transport in quasiperiodic random media j phys a 40 4 2007 597 610 10 1088 1751 8113 40 4 002 eberhard j p suciu n vamos c 2007 on the self averaging of dispersion for transport in quasiperiodic random media j phys a 40 4 597 610 10 1088 1751 8113 40 4 002 flemisch berre boon fumagalli schwenck scotti stefansson tatomir 2018 b flemisch i berre w boon a fumagalli n schwenck a scotti i stefansson a tatomir benchmarks for single phase flow in fractured porous media adv water resour 111 2018 239 258 10 1016 j advwatres 2017 10 036 flemisch b berre i boon w fumagalli a schwenck n scotti a stefansson i tatomir a 2018 benchmarks for single phase flow in fractured porous media adv water resour 111 239 258 10 1016 j advwatres 2017 10 036 frank reuter aizinger knabner 2015 f frank b reuter v aizinger p knabner festung a matlab gnu octave toolbox for the discontinuous galerkin method part i diffusion operator comput math appl 70 1 2015 11 46 10 1016 j camwa 2015 04 013 frank f reuter b aizinger v knabner p 2015 festung a matlab gnu octave toolbox for the discontinuous galerkin method part i diffusion operator comput math appl 70 1 11 46 10 1016 j camwa 2015 04 013 gelhar 1986 l w gelhar stochastic subsurface hydrology from theory to applications water resour res 22 9s 1986 s135s 145s 10 1029 wr022i09sp0135s gelhar l w 1986 stochastic subsurface hydrology from theory to applications water resour res 22 9s s135s 145s 10 1029 wr022i09sp0135s gelhar axness 1983 l w gelhar c axness three dimensional stochastic analysis of macrodispersion in aquifers water resour res 19 1 1983 161 180 10 1029 wr019i001p00161 gelhar l w axness c 1983 three dimensional stochastic analysis of macrodispersion in aquifers water resour res 19 1 161 180 10 1029 wr019i001p00161 gotovac andričevicć gotovac 2007 h gotovac r andričevicć b gotovac multi resolution adaptive modeling of groundwater flow and transport adv water resour 30 5 2007 1105 1126 10 1016 j advwatres 2006 10 007 gotovac h andričevicć r gotovac b 2007 multi resolution adaptive modeling of groundwater flow and transport adv water resour 30 5 1105 1126 10 1016 j advwatres 2006 10 007 gotovac cvetković andričevicć 2009 h gotovac v cvetković r andričevicć adaptive fup multi resolution approach to flow and advective transport in highly heterogeneous porous media methodology accuracy and convergence adv water resour 32 6 2009 885 905 10 1016 j advwatres 2009 02 013 gotovac h cvetković v andričevicć r 2009 adaptive fup multi resolution approach to flow and advective transport in highly heterogeneous porous media methodology accuracy and convergence adv water resour 32 6 885 905 10 1016 j advwatres 2009 02 013 grenier anbergen bense chanzy coon collier costard ferry frampton frederick gonçalvès holmén jost kokh kurylyk mckenzie molson mouche orgogozo pannetier rivière roux rühaak scheidegger selroos therrien vidstrand voss 2018 c grenier h anbergen v bense q chanzy e coon n collier f costard m ferry a frampton j frederick j gonçalvès j holmén a jost s kokh b kurylyk j mckenzie j molson e mouche l orgogozo r pannetier a rivière n roux w rühaak j scheidegger j o selroos r therrien p vidstrand c voss groundwater flow and heat transport for systems undergoing freeze thaw intercomparison of numerical simulators for 2d test cases adv water resour 114 2018 196 218 10 1016 j advwatres 2018 02 001 grenier c anbergen h bense v chanzy q coon e collier n costard f ferry m frampton a frederick j gonçalvès j holmén j jost a kokh s kurylyk b mckenzie j molson j mouche e orgogozo l pannetier r rivière a roux n rühaak w scheidegger j selroos j o therrien r vidstrand p voss c 2018 groundwater flow and heat transport for systems undergoing freeze thaw intercomparison of numerical simulators for 2d test cases advances in water resources 114 196 218 10 1016 j advwatres 2018 02 001 hoepffner hoepffner j 2007 implementation of boundary conditions http www lmm jussieu fr hoepffner boundarycondition pdf hou wu cai 1999 t hou x h wu z cai convergence of a multiscale finite element method for elliptic problems with rapidly oscillating coefficients math comput 68 227 1999 913 943 10 1090 s0025 5718 99 01077 7 hou t wu x h cai z 1999 convergence of a multiscale finite element method for elliptic problems with rapidly oscillating coefficients math comput 68 227 913 943 10 1090 s0025 5718 99 01077 7 kelley 1995 c t kelley iterative methods for linear and nonlinear equations siam philadelphia 16 1995 kelley c t 1995 iterative methods for linear and nonlinear equations siam philadelphia knabner angermann 2003 p knabner l angermann numerical methods for elliptic and parabolic partial differential equations 2003 springer new york knabner p angermann l 2003 numerical methods for elliptic and parabolic partial differential equations springer new york kornhuber peterseim yserentant 2018 r kornhuber d peterseim h yserentant an analysis of a class of variational multiscale methods based on subspace decomposition math comput 87 314 2018 2765 2774 10 1090 mcom 3302 kornhuber r peterseim d yserentant h 2018 an analysis of a class of variational multiscale methods based on subspace decomposition math comput 87 314 2765 2774 10 1090 mcom 3302 kraichnan 1970 r h kraichnan diffusion by a random velocity field phys fluids 13 1 1970 22 31 10 1063 1 1692799 kraichnan r h 1970 diffusion by a random velocity field phys fluids 13 1 22 31 10 1063 1 1692799 kramer kurbanmuradov sabelfeld 2007 p r kramer o kurbanmuradov k sabelfeld comparative analysis of multiscale gaussian random field simulation algorithms j comp phys 226 2007 897 924 10 1016 j jcp 2007 05 002 kramer p r kurbanmuradov o sabelfeld k 2007 comparative analysis of multiscale gaussian random field simulation algorithms j comp phys 226 897 924 10 1016 j jcp 2007 05 002 kurbanmuradov sabelfeld kramer 2013 o kurbanmuradov k sabelfeld p r kramer randomized spectral and fourier wavelet methods for multidimensional gaussian random vector fields j comp phys 245 2013 218 234 10 1016 j jcp 2013 03 021 kurbanmuradov o sabelfeld k kramer p r 2013 randomized spectral and fourier wavelet methods for multidimensional gaussian random vector fields j comp phys 245 218 234 10 1016 j jcp 2013 03 021 kurbanmuradov sabelfeld 2010 o a kurbanmuradov k k sabelfeld stochastic flow simulation and particle transport in a 2d layer of random porous medium transp porous media 85 2010 347 373 10 1007 s11242 010 9567 y kurbanmuradov o a sabelfeld k k 2010 stochastic flow simulation and particle transport in a 2d layer of random porous medium transp porous media 85 347 373 10 1007 s11242 010 9567 y larsson thomée 2009 s larsson v thomée partial differential equations with numerical methods 2009 springer berlin heidelberg 10 1007 978 3 540 88706 5 larsson s thomée v 2009 partial differential equations with numerical methods springer berlin heidelberg 10 1007 978 3 540 88706 5 li zhang 2007 h li d zhang probabilistic collocation method for flow in porous media comparisons with other stochastic methods water resour res 43 2007 w09409 10 1029 2006wr005673 li h zhang d 2007 probabilistic collocation method for flow in porous media comparisons with other stochastic methods water resour res 43 w09409 10 1029 2006wr005673 li mclaughlin 1991 s li d b mclaughlin a nonstationary spectral method for solving stochastic groundwater problems unconditional analysis water resour res 27 7 1991 1589 1605 10 1029 91wr00881 li s mclaughlin d b 1991 a nonstationary spectral method for solving stochastic groundwater problems unconditional analysis water resour res 27 7 1589 1605 10 1029 91wr00881 li lu zhang 2009 w li z lu d zhang stochastic analysis of unsaturated flow with probabilistic collocation method water resour res 45 2009 w08425 10 1029 2008wr007530 li w lu z zhang d 2009 stochastic analysis of unsaturated flow with probabilistic collocation method water resour res 45 w08425 10 1029 2008wr007530 li qiao tang 2017 z li z qiao t tang numerical solution of differential equations introduction to finite difference and finite element methods 2017 cambridge university press 10 1017 9781316678725 li z qiao z tang t 2017 numerical solution of differential equations introduction to finite difference and finite element methods cambridge university press 10 1017 9781316678725 liu molz 1997 h a liu f j molz multifractal analyses of hydraulic conductivity distributions water resour res 33 11 1997 2483 2488 10 1029 97wr02188 liu h a molz f j 1997 multifractal analyses of hydraulic conductivity distributions water resour res 33 11 2483 2488 10 1029 97wr02188 lord powell shardlow 2014 g j lord c e powell t shardlow an introduction to computational stochastic pdes 2014 cambridge university press lord g j powell c e shardlow t 2014 an introduction to computational stochastic pdes cambridge university press mantoglou wilson 1982 a mantoglou j l wilson the turning bands method for simulation of random fields using line generation by a spectral method water resour res 18 5 1982 1379 1394 10 1029 wr018i005p01379 mantoglou a wilson j l 1982 the turning bands method for simulation of random fields using line generation by a spectral method water resour res 18 5 1379 1394 10 1029 wr018i005p01379 mizell gutjahr gelhar 1982 s a mizell a l gutjahr l w gelhar stochastic analysis of spatial variability in two dimensional steady groundwater flow assuming stationary and nonstationary heads water resour res 18 4 1982 1053 1067 10 1029 wr018i004p01053 mizell s a gutjahr a l gelhar l w 1982 stochastic analysis of spatial variability in two dimensional steady groundwater flow assuming stationary and nonstationary heads water resources research 18 4 1053 1067 10 1029 wr018i004p01053 molz boman 1995 f j molz g k boman further evidence of fractal structure in hydraulic conductivity distributions geophys res lett 22 18 1995 2545 2548 10 1029 95gl02548 molz f j boman g k 1995 further evidence of fractal structure in hydraulic conductivity distributions geophys res lett 22 18 2545 2548 10 1029 95gl02548 molz liu szulga 1997 f j molz h h liu j szulga fractional brownian motion and fractional gaussian noise in subsurface hydrology a review presentation of fundamental properties and extensions water resour res 33 10 1997 2273 2286 10 1029 97wr01982 molz f j liu h h szulga j 1997 fractional brownian motion and fractional gaussian noise in subsurface hydrology a review presentation of fundamental properties and extensions water resour res 33 10 2273 2286 10 1029 97wr01982 oberkampf blottner 1998 w l oberkampf f g blottner issues in computational fluid dynamics code verification and validation aiaa j 36 5 1998 687 695 10 2514 2 456 oberkampf w l blottner f g 1998 issues in computational fluid dynamics code verification and validation aiaa j 36 5 687 695 10 2514 2 456 putti cordes 1998 m putti c cordes finite element approximation of the diffusion operator on tetrahedra siam j sci comput 19 4 1998 1154 1168 10 1137 s1064827595290711 putti m cordes c 1998 finite element approximation of the diffusion operator on tetrahedra siam j sci comput 19 4 1154 1168 10 1137 s1064827595290711 radu kumar nordbotten pop 2017 f a radu k kumar j m nordbotten i s pop a robust mass conservative scheme for two phase flow in porous media including hölder continuous nonlinearities ima j numer anal 38 2 2017 884 920 10 1093 imanum drx032 radu f a kumar k nordbotten j m pop i s 2017 a robust mass conservative scheme for two phase flow in porous media including hölder continuous nonlinearities ima j numer anal 38 2 884 920 10 1093 imanum drx032 radu suciu hoffmann vogel kolditz park attinger 2011 f a radu n suciu j hoffmann a vogel o kolditz c h park s attinger accuracy of numerical simulations of contaminant transport in heterogeneous aquifers a comparative study adv water resour 34 2011 47 61 10 1016 j advwatres 2010 09 012 radu f a suciu n hoffmann j vogel a kolditz o park c h attinger s 2011 accuracy of numerical simulations of contaminant transport in heterogeneous aquifers a comparative study adv water resour 34 47 61 10 1016 j advwatres 2010 09 012 rajaram gelhar 1991 h rajaram l w gelhar three dimensional spatial moments analysis of the borden tracer test water resour res 27 6 1991 1239 1251 10 1029 91wr00326 rajaram h gelhar l w 1991 three dimensional spatial moments analysis of the borden tracer test water resour res 27 6 1239 1251 10 1029 91wr00326 rehfeldt boggs gelhar 1992 k r rehfeldt j m boggs l w gelhar field study of dispersion in a heterogeneous aquifer 3 geostatistical analysis of hydraulic conductivity water resour res 28 12 1992 3309 3324 10 1029 92wr01758 rehfeldt k r boggs j m gelhar l w 1992 field study of dispersion in a heterogeneous aquifer 3 geostatistical analysis of hydraulic conductivity water resour res 28 12 3309 3324 10 1029 92wr01758 ritzi jr soltanian 2015 r w ritzijr m r soltanian what have we learned from deterministic geostatistics at highly resolved field sites as relevant to mass transport processes in sedimentary aquifers j hydrol 531 2015 31 39 10 1016 j jhydrol 2015 07 049 ritzi jr r w soltanian m r 2015 what have we learned from deterministic geostatistics at highly resolved field sites as relevant to mass transport processes in sedimentary aquifers j hydrol 531 31 39 10 1016 j jhydrol 2015 07 049 riviere 2008 b riviere discontinuous galerkin methods for solving elliptic and parabolic equations theory and implementation 2008 siam philadelphia 10 1137 1 9780898717440 fm riviere b 2008 discontinuous galerkin methods for solving elliptic and parabolic equations theory and implementation siam philadelphia https doi org 10 1137 1 9780898717440 fm roache 1998 p j roache verification and validation in computational science and engineering 1998 hermosa publishers new mexico roache p j 1998 verification and validation in computational science and engineering hermosa publishers new mexico roache 2002 p j roache code verification by the method of manufactured solutions j fluids eng 124 1 2002 4 10 10 1115 1 1436090 roache p j 2002 code verification by the method of manufactured solutions j fluids eng 124 1 4 10 10 1115 1 1436090 roy 2003 c j roy grid convergence error analysis for mixed order numerical schemes aiaa j 41 4 2003 595 604 10 2514 2 2013 roy c j 2003 grid convergence error analysis for mixed order numerical schemes aiaa journal 41 4 595 604 10 2514 2 2013 roy 2005 c j roy review of code and solution verification procedures for computational simulation j comput phys 205 2005 131 156 10 1016 j jcp 2004 10 036 roy c j 2005 review of code and solution verification procedures for computational simulation j comput phys 205 131 156 10 1016 j jcp 2004 10 036 rupp 2019 a rupp simulating structure formation in soils across scales using discontinuous galerkin methods shaker düren 2019 rupp a 2019 simulating structure formation in soils across scales using discontinuous galerkin methods shaker düren salandin fiorotto 1998 p salandin v fiorotto solute transport in highly heterogeneous aquifers water resour res 34 5 1998 949 961 10 1029 98wr00219 salandin p fiorotto v 1998 solute transport in highly heterogeneous aquifers water resour res 34 5 949 961 10 1029 98wr00219 segerlind 1987 l j segerlind applied finite element analysis 1987 j wiley and sons new york segerlind l j 1987 applied finite element analysis j wiley and sons new york shen wang xia 2016 j shen y wang j xia fast structured direct spectral methods for differential equations with variable coefficients i the one dimensional case siam j sci comput 38 1 2016 a28 a54 10 1137 140986815 shen j wang y xia j 2016 fast structured direct spectral methods for differential equations with variable coefficients i the one dimensional case siam j sci comput 38 1 a28 a54 10 1137 140986815 srzic cvetkovic andricevic gotovac 2013 v srzic v cvetkovic r andricevic h gotovac impact of aquifer heterogeneity structure and local scale dispersion on solute concentration uncertainty water resour res 49 6 2013 3712 3728 10 1002 wrcr 20314 srzic v cvetkovic v andricevic r gotovac h 2013 impact of aquifer heterogeneity structure and local scale dispersion on solute concentration uncertainty water resour res 49 6 3712 3728 10 1002 wrcr 20314 suciu 2010 n suciu spatially inhomogeneous transition probabilities as memory effects for diffusion in statistically homogeneous random velocity fields phys rev e 81 2010 056301 10 1103 physreve 81 056301 suciu n 2010 spatially inhomogeneous transition probabilities as memory effects for diffusion in statistically homogeneous random velocity fields phys rev e 81 056301 10 1103 physreve 81 056301 suciu 2014 n suciu diffusion in random velocity fields with applications to contaminant transport in groundwater adv water resour 69 2014 114 133 10 1016 j advwatres 2014 04 002 suciu n 2014 diffusion in random velocity fields with applications to contaminant transport in groundwater adv water resour 69 114 133 10 1016 j advwatres 2014 04 002 suciu 2019 n suciu diffusion in random fields applications to transport in groundwater birkhäuser cham 2019 10 1007 978 3 030 15081 5 suciu n 2019 diffusion in random fields applications to transport in groundwater birkhäuser cham 10 1007 978 3 030 15081 5 suciu attinger radu vamoş vanderborght vereecken knabner 2015 n suciu s attinger f a radu c vamoş j vanderborght h vereecken p knabner solute transport in aquifers with evolving scale heterogeneity an sti u ovid co mat 23 3 2015 167 186 10 1515 auom 2015 0054 suciu n attinger s radu f a vamoş c vanderborght j vereecken h knabner p 2015 solute transport in aquifers with evolving scale heterogeneity an sti u ovid co mat 23 3 167 186 10 1515 auom 2015 0054 suciu radu prechtel knabner 2013 n suciu f a radu a prechtel p knabner a coupled finite element global random walk approach to advection dominated transport in porous media with random hydraulic conductivity j comput appl math 246 2013 27 37 10 1016 j cam 2012 06 027 suciu n radu f a prechtel a knabner p 2013 a coupled finite element global random walk approach to advection dominated transport in porous media with random hydraulic conductivity j comput appl math 246 27 37 10 1016 j cam 2012 06 027 suciu schüler attinger knabner 2016 n suciu l schüler s attinger p knabner towards a filtered density function approach for reactive transport in groundwater adv water resour 90 2016 83 98 10 1016 j advwatres 2016 02 016 suciu n schüler l attinger s knabner p 2016 towards a filtered density function approach for reactive transport in groundwater adv water resour 90 83 98 10 1016 j advwatres 2016 02 016 suciu vamoş vanderborght hardelauf vereecken 2006 n suciu c vamoş j vanderborght h hardelauf h vereecken numerical investigations on ergodicity of solute transport in heterogeneous aquifers water resour res 42 2006 w04409 10 1029 2005wr004546 suciu n vamoş c vanderborght j hardelauf h vereecken h 2006 numerical investigations on ergodicity of solute transport in heterogeneous aquifers water resour res 42 w04409 10 1029 2005wr004546 trefry ruan mclaughlin 2003 m g trefry f p ruan d mclaughlin numerical simulations of preasimptotic transport in hetoregenous porous media departures from the gaussian limit water resour res 39 3 2003 1063 1077 10 1029 2001wr001101 trefry m g ruan f p mclaughlin d 2003 numerical simulations of preasimptotic transport in hetoregenous porous media departures from the gaussian limit water resour res 39 3 1063 1077 10 1029 2001wr001101 vamoş suciu vereecken 2003 c vamoş n suciu h vereecken generalized random walk algorithm for the numerical modeling of complex diffusion processes j comput phys 186 2003 527 544 10 1016 s0021 9991 03 00073 1 vamoş c suciu n vereecken h 2003 generalized random walk algorithm for the numerical modeling of complex diffusion processes j comput phys 186 527 544 10 1016 s0021 9991 03 00073 1 weideman reddy 2000 j a weideman s c reddy a matlab differentiation matrix suite acm trans math software 26 4 2000 465 519 10 1145 365723 365727 weideman j a reddy s c 2000 a matlab differentiation matrix suite acm trans math software 26 4 465 519 10 1145 365723 365727 yaglom 1987 a m yaglom correlation theory of stationary and related random functions vol 2 supplementary notes and 1987 springer new york yaglom a m 1987 correlation theory of stationary and related random functions in vol 2 supplementary notes and 
514,post pumping seawater intrusion at the field scale implications for coastal aquifer management marc walther conceptualization data curation formal analysis investigation methodology resources software validation visualization writing original draft writing review editing a b leonard stoeckl conceptualization formal analysis investigation methodology validation visualization writing original draft writing review editing c leanne k morgan conceptualization formal analysis investigation methodology validation visualization writing original draft writing review editing d a helmholtz centre for environmental research ufz permoserstr 15 04318 leipzig germany helmholtz centre for environmental research ufz permoserstr 15 leipzig 04318 germany ahelmholtz centre for environmental research ufz permoserstr 15 04318 leipzig germany b technische universität dresden 01069 dresden germany technische universität dresden dresden 01069 germany btechnische universität dresden 01069 dresden germany c federal institute for geosciences and natural resources bgr stilleweg 2 30655 hannover germany federal institute for geosciences and natural resources bgr stilleweg 2 hannover 30655 germany cfederal institute for geosciences and natural resources bgr stilleweg 2 30655 hannover germany d university of canterbury christchurch 8140 new zealand university of canterbury christchurch 8140 new zealand duniversity of canterbury christchurch 8140 new zealand corresponding author post pumping seawater intrusion pp swi is the phenomenon of seawater intruding further inland than the location of a well after pumping has ceased recent work by stoeckl et al 2019 assessed pp swi at the laboratory scale using physical and numerical modeling confirming it as a physical phenomenon and linking it to disequilibrium in the flow field following the cessation of pumping this work extends that of stoeckl et al 2019 by systematically evaluating sensitivity of the pp swi phenomenon to two aquifer management parameters i e pump distance from coast and pump rate the analysis is carried out at the field scale using variable density numerical modeling the numerical simulations show that pp swi and derived aquifer usage measures e g cumulative water abstraction time for the saltwater to reach the pump i e active pumping time have a non linear relation to pump rate and pump distance from coast pp swi does not occur below a minimum pump rate hinting at sustainable pumping rates under certain conditions but may reach hundreds of years in some cases i e swi continues for hundreds of years after pumping has ceased most importantly the results did not reveal a clear relation between pump distance from coast and the occurrence nor extent of pp swi for real world aquifer management and monitoring this implies that groundwater salinity measurements at different wells with different distances from the coast may not provide sufficient information for managing pp swi our work indicates that a better measure to estimate pp swi is the ratio of pump rate versus the inflow from upstream recharge where inflow estimates could be drawn from lysimeter measurements a regional water balance or different types of hydraulic models keywords seawater intrusion transience aquifer management variable density modeling opengeosys 1 introduction seawater intrusion swi is the landward movement of seawater into fresh coastal aquifers swi is recognized as a global and significant problem as it can make coastal aquifers unusable and negatively impact ecosystems and soils werner et al 2013 tully et al 2019 there is a growing need for sustainable use of freshwater in coastal zones due to rising coastal populations and predicted changes in coastal zone hydrology associated with climate change michael et al 2017 morgan and werner 2015 the link between groundwater pumping and swi has been recognized for more than a century houben and post 2017 and considerable research has been carried out into the prediction of pumping induced swi and up coning e g shi et al 2011 jakovovic et al 2016 as well as pumping optimization techniques for swi management e g ketabchi and ataie ashtiani 2015 ebeling et al 2019 however the conceptualization of pumping induced swi is largely based on steady state assumptions such as constant pumping rates and there is a paucity of studies that systematically assess swi under transient pumping conditions this is despite that swi is a complicated transient process that can result in non intuitive phenomena as an example morgan et al 2013 2015 describe an overshoot in transient swi whereby the interface moves beyond the final steady state condition following sea level rise effective management of coastal groundwater resources usually requires that the position of the interface between freshwater and seawater is reasonably well characterized as such coastal aquifer management generally involves monitoring of salinity within observation i e sentinel wells or within pumping wells fao 1997 an increase in salinity is an indication that swi is occurring and will generally result in the cessation of pumping and in some cases the inland movement of pumping wells barlow and reichard 2010 however recent work by walther et al 2014 and stoeckl et al 2019 suggest that this approach may not be appropriate in some circumstances due to transient swi processes table of symbols description symbol dimension active pumping period τp t deactivated pump period τd t reactivation time τr τp τd t pump rate q p l2 t inflow rate q in l2 t land surface recharge q z l2 t ratio of pump rate vs inflow rate r q q p q in natural swi toe length x nswi l pump distance from natural swi toe x pswi l ratio of pump distance from natural swi toe to natural swi toe length r x x pswi x nswi pump distance from coast x pc x nswi x pswi l maximum pp swi toe length inland of the pump x ppswi l half horizontal drawdown d x0 5 l half vertical drawdown d z0 5 l ratio of horizontal drawdown to vertical drawdown r d d x0 5 d z0 5 maximum drawdown at inflow boundary d qin l abstraction volume during active pumping period v p l2 concentration relative to seawater c in a modeling study of the heavily exploited oman coastal aquifer system carried out by walther et al 2014 scenario calculations showed that salinities in some observation wells did not immediately drop after pumping stopped rather salinities in these wells increased for a period from years to decades indicating that seawater continued to move landward beyond the pumping well location after the cessation of pumping this phenomenon was recently termed post pumping seawater intrusion pp swi by stoeckl et al 2019 stoeckl et al 2019 carried out a laboratory scale investigation of the phenomenon and demonstrated that pp swi can be reproduced within physical experiments it was also shown using numerical modeling that pp swi is caused by disequilibrium in the flow field following the cessation of pumping specifically the cone of depression persisted after the cessation of pumping first moving inland and then retreating toward the coast which caused a lag in the reestablishment of fresh water flow toward the coast after pumping had stopped it was during this period of flow field disequilibrium that pp swi occurred stoeckl et al 2019 predicted that systems with larger postextraction disequilibrium will be most susceptible to pp swi and recommended future research to improve understanding of the relationship between hydrogeological parameters extraction rates well location and incidence of pp swi this paper adds to the investigation of stoeckl et al 2019 by investigating the pp swi phenomenon at the field scale using variable density numerical modeling the general characteristics of the oman coastal aquifer system as detailed by walther et al 2012 are used for the simulations in a synthetic setup with multiple scenarios the specific objective is to assess the impact of pump rate and pump location on the incidence and extent of pp swi implications for coastal aquifer management are also discussed 2 methods 2 1 conceptual model the conceptual model fig 1 consists of a vertical cross section of an aquifer with homogeneous isotropic properties and a total thickness of 100 m the setup is adopted from the study of walther et al 2012 and designed to represent a common situation for a coastal groundwater system with relevant parameters listed in table 1 in the following we are using relative concentrations from c 0 for freshwater to c 1 for seawater the boundary conditions are defined as constant water level 50 m and seawater concentration c 1 on the sea side constant inflow q in 1 2 10 6 m2 s and freshwater concentration c 0 on the land side representing an upstream recharge such that the average hydraulic gradient in the model is approximately 0 33 the latter corresponds to a common hydraulic gradient in unconfined aquifers see e g harter 2003 the increase of density from freshwater ρ f to seawater ρ s seawater freshwater density relation i e ρ s ρ f ρ s was defined as 0 025 no flow boundary conditions are set on the top and bottom of the domain except for the first 5000 m at the top of the model where a small recharge value q z 5 10 7 m2 s and freshwater concentration is applied to omit diffusive transport of salinity from the sea side boundary within the unsaturated part of the model this upper recharge boundary did not show a significant influence on the saturated flow as expected given that q z is equivalent to 1 10 10 m s i e the ratio of the recharge flux 5 10 7 m2 s and the length over which the recharge is applied 5000 m which is around 100 times smaller than typical recharge values e g mohan et al 2018 to represent the extraction of fresh groundwater within a well field that runs parallel to the coast and within a specific distance of the coast a horizontal source zone with a constant length of 500 m was defined at z 10 m for simplicity this feature is described using the term pump hereafter despite that it is representative of a number of pumps within a well field simulations were carried out without pumping to determine the steady state head and concentration distribution under no pumping conditions throughout this manuscript natural swi is the term used to describe the concentration distribution under no pumping the steady state head and concentration results from the no pumping simulation were used as initial conditions in the simulations that included pumping and assessed pp swi 2 2 numerical model we used the finite element open source toolbox opengeosys kolditz et al 2012 to simulate variable density flow and transport opengeosys has been benchmarked for transient unconfined groundwater flow he et al 2015 as well as for variable density flow walther et al 2015 magri et al 2018 and has been used for various coupled flow and transport simulations magri et al 2017 schulz et al 2017 volpi et al 2018 element sizes were adapted to regions of interest and varied between 0 7 m2 and 5 m2 for x 5 km and increased up to 100 m2 at x 7 km element sizes were kept constant for all simulations which omitted any influence from different degrees of numerical dispersion associated with element size on results a grid refinement test showed no significant deviations with smaller element sizes see also section results and discussion all simulations were run for a maximum simulation time of 1011 s 3200 a scenarios were implemented by changing the pump location within 500 m x pc 4500 m always with respect to the sea side tip of the pump as such the maximum distance of the landward edge of the pump was x 5000 m in all scenarios we considered setups with pump locations closer to the coast to be unreasonable as for these swi is expected to rapidly salinize the pumps additionally abstraction was varied between the pump rates 5 10 7 m2 s q p 2 7 10 4 m2 s 2 3 quantitative indicators in this study we only analyze situations where pp swi is present pp swi is assessed with respect to the time the pumps have to be shut down due to salinization as this time period is of relevance for management how long do i have to wait to use the pump again during the simulation the salinity concentration of the sea side tip of the pump was monitored and if a threshold value of c 0 05 i e 5 salinity was reached the pump was deactivated i e q p 0 we refer to the 5 salinity isoline as the interface hereafter this salinity threshold corresponds to the limit until which crops do not show any reduction in yield flipps 2017 nsw 2017 and lies below reported effects on taste who 2017 the time from the activation of the pump at the start of the simulation to the deactivation of the pump is termed active pumping period τp fig 2 the simulation was then continued with the pump deactivated until c 0 05 at the seaside tip of the horizontal well pump the time between pump deactivation and the end of the simulation is termed deactivated pump period τd the end of the simulation coincides with what would theoretically be the time when the pump could be reactivated because c 0 05 this reactivation time τr is equal to the sum of τp and τd simulations were also stopped when drawdown caused the groundwater level to drop below the height of the pump i e at z 10 m which would represent the situation where the pump went dry cases where this occurred are differentiated from situations where it did not as detailed in section 3 1 in the analysis of the simulation results we use the ratios r x and r q as values that may be useful to transfer the results of our study to similar cases r x is the ratio of the distance of the seaside tip of the pump from the natural swi toe x pswi versus the natural swi toe length x nswi here the swi toe refers to the intersection of the interface i e the 5 seawater isochlor and the aquifer base while the swi toe length refers to the distance from the coast to the swi toe r q is the ratio of the pump rate q p to the inflow from the inland boundary q in as such r x and r q relate variables that are generally accessible to water resource managers for the scenarios used in this study the variation in the distance of the pump from the coast resulted in r x values ranging between 5 5 and 57 the variation in the pump rate resulted in r q values ranging between 0 4 and 250 in the following analysis the adjectives qualitatively describe the results within our setting i e scenario and parameter definition and range of results i e occurrence of pp swi to investigate the shape and location of the pumping induced cone of depression we derived two metrics that quantify the horizontal d x0 5 and vertical extent d z0 5 of the drawdown as described in fig 3 here d z0 5 is half the maximum drawdown d x0 5 is the distance along the x axis between the location where maximum drawdown occurs and the location coastward of the pump where the drawdown is equal to d z0 5 additionally we define the ratio r d d x0 5 d z0 5 to quantify the horizontal to vertical extent of the cone of depression r d values correspond to the transient development state of the cone of depression where smaller r d values stand for early phases not well developed cones of depression and larger r d values for later near steady state phases 3 results and discussion 3 1 the pp swi phenomenon fig 4 shows the deactivated pump period τd due to pp swi as a function of the pump distance from the coast x pc and r x and the pump rate q p and r q furthermore fig 4 and most of the following figures shows all simulated scenarios as color coded dots where blue represents scenarios that did not show pp swi red shows those where pp swi was observed and green symbolizes scenarios for which the well fell dry unshaded regions show parameter combinations where pp swi was not observed overall the area of the pp swi phenomenon is defined by i upper boundary between red and green dots and ii lower q p boundary between blue and green dots as well as iii a maximum x pc for i a specific q p at a location x pc leads to a drawdown and a deficit of water which causes the pumps to fall dry such that the salinity threshold c 0 05 does not define the deactivation of the pumps anymore the boundaries ii and iii define such low q p and large x pc that the swi does not reach the pump in general higher pump rates q p lead to longer deactivated pump periods τd for q p 150 m2 a τd is not depending on the distance of the pump to the coast x pc but only on q p for q p 150 m2 a maximum τd occurs when x pc 1500 m with decreasing τd for both increasing and decreasing x pc this diverging behavior may be explained by the following considerations for low x pc pumps closer to coast the time that is available for the development of the drawdown is small in comparison to the time until the interface reaches the pump which leads to a shorter τd than if the pump was further inland for a pump located further inland the cone of depression has more time to develop as the interface takes longer to reach the pump due to the larger distance resulting in a longer τd the latter situation increases until for large x pc far inland the drawdown has to be significantly larger to cause the interface to reach the pump this is however limited by a maximum q p which is defined by the situation where the pumps are shut down due to a lack of water this observation i e that higher q p lead to a stronger pp swi phenomenon is in line with the laboratory scale physical experiment by stoeckl et al 2019 particularly they described that the persisting cone of depression after the cessation of pumping results in a continued swi i e the phenomenon of pp sw which is only reduced and eventually reversed when the drawdown is diminished by the replenishment from recharge c f also fig 5 and the associated discussion of the phases of the phenomenon below we carried out a grid refinement test for the scenario xpc 1500 m qp 8 9608 10 6 m2 s and the results show a difference of 1 5 and 0 05 in τd for element sizes that are 1 5 and 2 times smaller than the original respectively with such small deviations and a change in sign during stronger refinement we firstly consider the chosen mesh resolution to be sufficient and secondly interpret the observed differences as the numerical accuracy within this non linear system for the cases where the pump fell dry we stopped the simulation by default and did not assess pp swi as the scenario definition would not be consistent i e q p had to be reduced to continue the simulation extrapolating the generally increasing τd for higher q p we hypothesize that pp swi still happens in cases where the pump fell dry fig 5 shows a detailed analysis of the pp swi phenomenon for a selected scenario x pc 500 m q p 1773 m2 a and key time steps the pp swi process is governed by several phases which can clearly be delineated by the flow direction induced from the hydraulic gradient or variable density flow and transport the first time step t 15 5 a time t is always given with respect to the time when the pumps are deactivated shows the initial state where groundwater flows into the direction of the coast the passive swi werner 2017 is flowing due to density dependence against the natural groundwater flow direction and the pumps have just been started over the next two time steps t 14 1 a t 6 2 a a groundwater divide develops and moves towards the coast in turn the formerly passive swi changes into an active type causing saltwater to flow towards the pumps at the time when the critical salinity concentration has reached the pumps t 0 a the salt movement is governed by the hydraulic gradient that is enforced by the groundwater drawdown due to the pumping activity the next two time steps after the pump stop t 3 3 a t 22 3 a show a phase where the salinity continues to follow the hydraulic gradient towards the location of the pumps until at t 35 0 a a density dependent circulation typical for swi processes starts to develop with this the formerly active swi changes back to a passive one and the continued landward movement of the saltwater is governed by variable density flow time step t 79 4 a marks the time of maximum pp swi length from this time on the regime changes into one that is again driven by the hydraulic gradient which causes groundwater to flow entirely coastward pushing saltwater out of the study domain in comparison to active swi where salt transport is governed by a gradient induced landward groundwater flow we observe that the salt transport is controlled by a gradient induced coastward groundwater flow resulting in a retreating counter active swi this behavior can be observed until the end of our simulations i e when the salinity concentration at the coastward side of the pumps again falls below the threshold which coincides with the potential reactivation of the pumps again this is in line with the experimental observations in stoeckl et al 2019 for each scenario setup with different values for x pc and q p the state of the water table and salinity distribution at t 0 will be different for example we observed for scenarios where the pumps were located farther from the coast that the length of the transition zone between fresh and saltwater was larger than for those scenarios with pumps located closer to the coast for the former the second phase of density driven passive swi is shorter due to the reduced concentration gradient as a result of the wider transition zone in turn the pp swi will be governed by the distinctive configuration of the swi and drawdown at the time of the pump stop fig 6 compares the active pumping period τp blue isolines and reactivation time τr red isolines for the simulated values of deactivated pump period τd τr τp shown previously in fig 4 it can be seen that τp and τr increase with increasing x pc i e with increasing distance of the pump from the coast also τp decreases with increasing q p i e the active pumping period decreased as the pumping rate increased as expected the relationship between τr and q p is more complex however as τr is a result from the individual behavior of both τp and τd τr decreases with increasing q p for q p values below around 150 m2 a τr is largely independent of q p for values of q p in the approximate range of 150 m2 a to 300 m2 a and x pc less than around 2 5 km τr increases with increasing q p for q p values greater than around 300 m2 a the implications of these results are that for q p values less than around 150 m2 a large τp values i e longer active pumping period are associated with large τr i e longer times until pump reactivation and small τd i e deactivation pumping period for q p values greater than around 150 m2 a the relationship between τp τr and τd is complex and non linear regarding the drawdown fig 7 shows d x0 5 d z0 5 and the ratio r d at the time of pump stop τp it can be seen that d z0 5 increases with increasing x pc and q p with relatively equal contributions from each of these parameters it might be expected that the horizontal development of the cone of depression follows the vertical development however simulation results indicate that d x0 5 primarily depends on x pc and is only slightly influenced by q p moreover d x0 5 increases with decreasing q p as the horizontal development of the cone of depression requires a much longer time than the vertical one d x0 5 d z0 5 the former is limited by the arrival of the interface at the pump location with lower q p the horizontal extent of the drawdown and d x0 5 has more time to develop this is also shown by the ratio r d which decreases with increasing q p it is therefore interpreted that the non linear distribution of τd shown in fig 4 can be mainly attributed to insufficiently developed cones of depression in horizontal direction especially for increasing q p this observation firstly may seem counterintuitive and contradict the predictions by stoeckl et al 2019 who suspect systems with larger postextraction disequilibrium to have a higher vulnerability to pp swi however our simulations show that the temporal disequilibrium between the horizontal and vertical development of the cone of depression have strong influence on the magnitude of pp swi to exclude possible boundary effects we analyzed the drawdown at the inland bc d qin fig 8 with a total saturated thickness of around 85 m at the inflow boundary we noticed a maximum drawdown d qin 5 1 m 6 at τp for the scenario that showed the pp swi phenomenon with largest x pc and strongest q p i e x pc 4500 m and q p 217 m2 a the mean drawdown for all scenarios is d qin 0 6 m 0 7 and the majority of the simulated pp swi occurrence shows a d qin 0 5 m therefore we did not find a significant influence of d qin on the pp swi simulation results and consider the chosen domain length 15 km adequate for the simulations presented in this study 3 2 interpretation of management variables in addition to the quantitative indicators described above we derive a number of variables in this section to provide additional insight into the pp swi phenomenon for coastal aquifer water management fig 9 a shows the maximum distance beyond the pump that the swi toe reached during pp swi x ppswi for q p values greater than around 300 m2 a x ppswi increases with higher q p reaching a maximum of 350 m and is largely insensitive to x pc for q p less than around 150 m2 a x ppswi increases with increasing x pc and is largely insensitive to q p fig 9b presents the water volume v p extracted by the pumps during τp v p generally increases with increasing x pc at any defined x pc the smallest v p occurs for medium q p 150 m2 a while for both larger and smaller q p v p increases we explain this divergent behavior in the following way for stronger q p the cone of depression shows a lower r d such that any region that is affected by a drawdown will drain for most of the saturated aquifer thickness for medium q p r d becomes larger such that the drawdown affected regions do not immediately drain the total thickness finally for low q p the scenarios approach the area where the swi does not reach the pump no pp swi occurs and the pumps can run indefinitely and v p increases or even becomes infinite water management assessment commonly aims for sustainable water use and the optimal use of available resources therefore it is important to know the time period for which the water resources can be used τp in this study and how long they would be unavailable in case of overexploitation i e τp and τd respectively in this study in this regard it is important to strengthen our interpretation of the non linear behavior of τd shown in fig 4 the scenario with the maximum q p that does not show pp swi blue dots in fig 4 is located at the farthest distance x pc with q p 150 m2 a r q 4 at x pc 4 5 km r x 60 this scenario did neither stop due to increased salinity nor a too low water table during the simulation time 3200 a and we assume that it would run indefinitely as well as all other scenarios in blue for slightly higher q p 300 m2 a at the same location there is also no pp swi as the wells run dry symbolized by the green dot therefore somewhere in between these two points one should find the maximum sustainable pump rate which should be relatively independent from the distance to the coast if the influence from the coast bc is neglected if this pump rate is used to draw a horizontal line in fig 4 one can see that below this line q p 150 m2 a the increase of pp swi is increasing linearly and only with q p and above this line a non linear increase occurs for the latter we can find a complex interplay between the transient development of the depression cone and the intruding seawater the previous observation might furthermore imply that pumps need to be placed at a distance equivalent to r x 60 i e at a location that has a distance from the natural swi toe location which is 60 times larger than natural swi toe length such that no pp swi will occur this however would result in additional management efforts for the distribution of the freshwater to the regions where it is required and probably higher energy costs for pumping as inland groundwater tables tend to lie deeper below the ground surface than at the coast in terms of water management one might be able to explore a sustainable pump rate in a setup that simulates the phase after τr i e the time when our simulation is stopped and the pumps would have been reactivated preliminary simulations revealed an oscillatory on off behavior of the pumps which is caused by the repetitive intruding and retreating movement of the saltwater when the pumps are switched on and off respectively if managed correctly this observation may lead to a state where the swi interface could be kept just at the tip of the pumps and thus the salinity of the abstracted groundwater at a low concentration as the focus of this work is on the pp swi phenomenon we did not investigate this aspect further which might also occur for situations that do not show a pp swi phase 3 3 implications for monitoring swi fig 10 relates τd to r q and x pc plotting the former as a function of the latter two the figure reveals a strong correlation between τd and r q where τd increases with r q however the color coding shows no obvious correlation of τd with x pc for real world aquifer management and monitoring this implies that groundwater salinity measurements at different wells with different distances from the coast do not give information on the occurrence or extent of pp swi a better measure to estimate pp swi is the ratio of pump rate versus the inflow from upstream recharge where inflow estimates could be drawn from lysimeter measurements a regional water balance or different types of hydraulic models 4 conclusions we improved the understanding of the phenomenon of post pumping seawater intrusion which was recently investigated using a laboratory scale experimental setup by stoeckl et al 2019 and extended this to a regional scale model our findings can be summarized as follows 1 longest deactivated pump periods strongest pp swi τd have been observed at medium pump rates and medium pump distances to coast 2 large pump distances to coast or low pump rates show short deactivated pump periods τd short pump distances and high pump rates may also show elevated deactivated pump periods 3 pp swi is governed by a sequence of active passive and counter active swi phases the length of the individual phases is depending on the scenario configuration distance of pumps to coast x pc and pump rate q p resulting in a non linear behavior 4 we observed scenarios with pump rates where swi did not reach the well field and no pp swi occurred this may hint at sustainable pump rates under certain conditions which should be investigated with a case based evaluation 5 cumulative water abstraction volumes show a non linear behavior lowest volume at medium pump rates and generally increase with pump distances 6 in our simulations pump rates were more important than the pump distance for the deactivated pump period associated with pp swi which bears large implications for monitoring standards in coastal aquifers our findings are in line with observations of pp swi by walther et al 2014 fig 9 for a real world aquifer where upstream recharge i e flow through the inland boundary was defined as 7 107 m3 a and total pump rates reached up to 1 8 108 m3 a i e pumping is equivalent to up to three times flow through the inland boundary r q in our study the synthetic setup used here confirmed that for r q 3 an occurrence of pp swi is possible within an order of several tens of years stoeckl et al 2019 concluded that the numerical fitting of their experimental data was not fully in line with their laboratory observations and always showed faster swi recession this might hint at even longer pp swi phases in reality than simulated in the simplified setup here the faster swi recession in the physical experiment relative to the numerical experiment observed by stoeckl et al 2019 may be attributed to hysteresis during the rewetting of the unsaturated porous media in general our findings imply the following key messages for process understanding and management of these systems 1 with increasing availability of electrical pumps and less use of manual groundwater extraction groundwater use will move further inland where water tables are deeper and freshwater more abundant than close to the coast according to our first conclusion this however will also increase the risk of pp swi 2 the occurrence of the pp swi phenomenon is limited to a maximum distance to the coast which is specific to the individual study area yet the absence of pp swi does not imply the non existence of swi 3 management of coastal groundwater resources should consider water demand in terms of volume and temporal availability our results show that sustainable pump rates may exist and that abstraction volume is neither linearly related to pump rates nor to pump location 4 finally as we have shown that the pump distance to the coast is not a reliable measure to evaluate the occurrence of pp swi management practice should furthermore focus on the determination of the ratio of pump rates and inflow from upstream recharge as an extension to this work it might be reasonable to vary aquifer permeability or heterogeneity pumping depth saturated aquifer thickness or the relation of the two latter and to include upstream or land surface recharge variations or transient pump rates credit authorship contribution statement marc walther conceptualization data curation formal analysis investigation methodology resources software validation visualization writing original draft writing review editing leonard stoeckl conceptualization formal analysis investigation methodology validation visualization writing original draft writing review editing leanne k morgan conceptualization formal analysis investigation methodology validation visualization writing original draft writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements leanne morgan is partly supported by environment canterbury new zealand https www ecan govt nz the authors would like to thank the editor graham sander the associate editor and the three anonymous reviewers for their comments that helped to improve the manuscript 
514,post pumping seawater intrusion at the field scale implications for coastal aquifer management marc walther conceptualization data curation formal analysis investigation methodology resources software validation visualization writing original draft writing review editing a b leonard stoeckl conceptualization formal analysis investigation methodology validation visualization writing original draft writing review editing c leanne k morgan conceptualization formal analysis investigation methodology validation visualization writing original draft writing review editing d a helmholtz centre for environmental research ufz permoserstr 15 04318 leipzig germany helmholtz centre for environmental research ufz permoserstr 15 leipzig 04318 germany ahelmholtz centre for environmental research ufz permoserstr 15 04318 leipzig germany b technische universität dresden 01069 dresden germany technische universität dresden dresden 01069 germany btechnische universität dresden 01069 dresden germany c federal institute for geosciences and natural resources bgr stilleweg 2 30655 hannover germany federal institute for geosciences and natural resources bgr stilleweg 2 hannover 30655 germany cfederal institute for geosciences and natural resources bgr stilleweg 2 30655 hannover germany d university of canterbury christchurch 8140 new zealand university of canterbury christchurch 8140 new zealand duniversity of canterbury christchurch 8140 new zealand corresponding author post pumping seawater intrusion pp swi is the phenomenon of seawater intruding further inland than the location of a well after pumping has ceased recent work by stoeckl et al 2019 assessed pp swi at the laboratory scale using physical and numerical modeling confirming it as a physical phenomenon and linking it to disequilibrium in the flow field following the cessation of pumping this work extends that of stoeckl et al 2019 by systematically evaluating sensitivity of the pp swi phenomenon to two aquifer management parameters i e pump distance from coast and pump rate the analysis is carried out at the field scale using variable density numerical modeling the numerical simulations show that pp swi and derived aquifer usage measures e g cumulative water abstraction time for the saltwater to reach the pump i e active pumping time have a non linear relation to pump rate and pump distance from coast pp swi does not occur below a minimum pump rate hinting at sustainable pumping rates under certain conditions but may reach hundreds of years in some cases i e swi continues for hundreds of years after pumping has ceased most importantly the results did not reveal a clear relation between pump distance from coast and the occurrence nor extent of pp swi for real world aquifer management and monitoring this implies that groundwater salinity measurements at different wells with different distances from the coast may not provide sufficient information for managing pp swi our work indicates that a better measure to estimate pp swi is the ratio of pump rate versus the inflow from upstream recharge where inflow estimates could be drawn from lysimeter measurements a regional water balance or different types of hydraulic models keywords seawater intrusion transience aquifer management variable density modeling opengeosys 1 introduction seawater intrusion swi is the landward movement of seawater into fresh coastal aquifers swi is recognized as a global and significant problem as it can make coastal aquifers unusable and negatively impact ecosystems and soils werner et al 2013 tully et al 2019 there is a growing need for sustainable use of freshwater in coastal zones due to rising coastal populations and predicted changes in coastal zone hydrology associated with climate change michael et al 2017 morgan and werner 2015 the link between groundwater pumping and swi has been recognized for more than a century houben and post 2017 and considerable research has been carried out into the prediction of pumping induced swi and up coning e g shi et al 2011 jakovovic et al 2016 as well as pumping optimization techniques for swi management e g ketabchi and ataie ashtiani 2015 ebeling et al 2019 however the conceptualization of pumping induced swi is largely based on steady state assumptions such as constant pumping rates and there is a paucity of studies that systematically assess swi under transient pumping conditions this is despite that swi is a complicated transient process that can result in non intuitive phenomena as an example morgan et al 2013 2015 describe an overshoot in transient swi whereby the interface moves beyond the final steady state condition following sea level rise effective management of coastal groundwater resources usually requires that the position of the interface between freshwater and seawater is reasonably well characterized as such coastal aquifer management generally involves monitoring of salinity within observation i e sentinel wells or within pumping wells fao 1997 an increase in salinity is an indication that swi is occurring and will generally result in the cessation of pumping and in some cases the inland movement of pumping wells barlow and reichard 2010 however recent work by walther et al 2014 and stoeckl et al 2019 suggest that this approach may not be appropriate in some circumstances due to transient swi processes table of symbols description symbol dimension active pumping period τp t deactivated pump period τd t reactivation time τr τp τd t pump rate q p l2 t inflow rate q in l2 t land surface recharge q z l2 t ratio of pump rate vs inflow rate r q q p q in natural swi toe length x nswi l pump distance from natural swi toe x pswi l ratio of pump distance from natural swi toe to natural swi toe length r x x pswi x nswi pump distance from coast x pc x nswi x pswi l maximum pp swi toe length inland of the pump x ppswi l half horizontal drawdown d x0 5 l half vertical drawdown d z0 5 l ratio of horizontal drawdown to vertical drawdown r d d x0 5 d z0 5 maximum drawdown at inflow boundary d qin l abstraction volume during active pumping period v p l2 concentration relative to seawater c in a modeling study of the heavily exploited oman coastal aquifer system carried out by walther et al 2014 scenario calculations showed that salinities in some observation wells did not immediately drop after pumping stopped rather salinities in these wells increased for a period from years to decades indicating that seawater continued to move landward beyond the pumping well location after the cessation of pumping this phenomenon was recently termed post pumping seawater intrusion pp swi by stoeckl et al 2019 stoeckl et al 2019 carried out a laboratory scale investigation of the phenomenon and demonstrated that pp swi can be reproduced within physical experiments it was also shown using numerical modeling that pp swi is caused by disequilibrium in the flow field following the cessation of pumping specifically the cone of depression persisted after the cessation of pumping first moving inland and then retreating toward the coast which caused a lag in the reestablishment of fresh water flow toward the coast after pumping had stopped it was during this period of flow field disequilibrium that pp swi occurred stoeckl et al 2019 predicted that systems with larger postextraction disequilibrium will be most susceptible to pp swi and recommended future research to improve understanding of the relationship between hydrogeological parameters extraction rates well location and incidence of pp swi this paper adds to the investigation of stoeckl et al 2019 by investigating the pp swi phenomenon at the field scale using variable density numerical modeling the general characteristics of the oman coastal aquifer system as detailed by walther et al 2012 are used for the simulations in a synthetic setup with multiple scenarios the specific objective is to assess the impact of pump rate and pump location on the incidence and extent of pp swi implications for coastal aquifer management are also discussed 2 methods 2 1 conceptual model the conceptual model fig 1 consists of a vertical cross section of an aquifer with homogeneous isotropic properties and a total thickness of 100 m the setup is adopted from the study of walther et al 2012 and designed to represent a common situation for a coastal groundwater system with relevant parameters listed in table 1 in the following we are using relative concentrations from c 0 for freshwater to c 1 for seawater the boundary conditions are defined as constant water level 50 m and seawater concentration c 1 on the sea side constant inflow q in 1 2 10 6 m2 s and freshwater concentration c 0 on the land side representing an upstream recharge such that the average hydraulic gradient in the model is approximately 0 33 the latter corresponds to a common hydraulic gradient in unconfined aquifers see e g harter 2003 the increase of density from freshwater ρ f to seawater ρ s seawater freshwater density relation i e ρ s ρ f ρ s was defined as 0 025 no flow boundary conditions are set on the top and bottom of the domain except for the first 5000 m at the top of the model where a small recharge value q z 5 10 7 m2 s and freshwater concentration is applied to omit diffusive transport of salinity from the sea side boundary within the unsaturated part of the model this upper recharge boundary did not show a significant influence on the saturated flow as expected given that q z is equivalent to 1 10 10 m s i e the ratio of the recharge flux 5 10 7 m2 s and the length over which the recharge is applied 5000 m which is around 100 times smaller than typical recharge values e g mohan et al 2018 to represent the extraction of fresh groundwater within a well field that runs parallel to the coast and within a specific distance of the coast a horizontal source zone with a constant length of 500 m was defined at z 10 m for simplicity this feature is described using the term pump hereafter despite that it is representative of a number of pumps within a well field simulations were carried out without pumping to determine the steady state head and concentration distribution under no pumping conditions throughout this manuscript natural swi is the term used to describe the concentration distribution under no pumping the steady state head and concentration results from the no pumping simulation were used as initial conditions in the simulations that included pumping and assessed pp swi 2 2 numerical model we used the finite element open source toolbox opengeosys kolditz et al 2012 to simulate variable density flow and transport opengeosys has been benchmarked for transient unconfined groundwater flow he et al 2015 as well as for variable density flow walther et al 2015 magri et al 2018 and has been used for various coupled flow and transport simulations magri et al 2017 schulz et al 2017 volpi et al 2018 element sizes were adapted to regions of interest and varied between 0 7 m2 and 5 m2 for x 5 km and increased up to 100 m2 at x 7 km element sizes were kept constant for all simulations which omitted any influence from different degrees of numerical dispersion associated with element size on results a grid refinement test showed no significant deviations with smaller element sizes see also section results and discussion all simulations were run for a maximum simulation time of 1011 s 3200 a scenarios were implemented by changing the pump location within 500 m x pc 4500 m always with respect to the sea side tip of the pump as such the maximum distance of the landward edge of the pump was x 5000 m in all scenarios we considered setups with pump locations closer to the coast to be unreasonable as for these swi is expected to rapidly salinize the pumps additionally abstraction was varied between the pump rates 5 10 7 m2 s q p 2 7 10 4 m2 s 2 3 quantitative indicators in this study we only analyze situations where pp swi is present pp swi is assessed with respect to the time the pumps have to be shut down due to salinization as this time period is of relevance for management how long do i have to wait to use the pump again during the simulation the salinity concentration of the sea side tip of the pump was monitored and if a threshold value of c 0 05 i e 5 salinity was reached the pump was deactivated i e q p 0 we refer to the 5 salinity isoline as the interface hereafter this salinity threshold corresponds to the limit until which crops do not show any reduction in yield flipps 2017 nsw 2017 and lies below reported effects on taste who 2017 the time from the activation of the pump at the start of the simulation to the deactivation of the pump is termed active pumping period τp fig 2 the simulation was then continued with the pump deactivated until c 0 05 at the seaside tip of the horizontal well pump the time between pump deactivation and the end of the simulation is termed deactivated pump period τd the end of the simulation coincides with what would theoretically be the time when the pump could be reactivated because c 0 05 this reactivation time τr is equal to the sum of τp and τd simulations were also stopped when drawdown caused the groundwater level to drop below the height of the pump i e at z 10 m which would represent the situation where the pump went dry cases where this occurred are differentiated from situations where it did not as detailed in section 3 1 in the analysis of the simulation results we use the ratios r x and r q as values that may be useful to transfer the results of our study to similar cases r x is the ratio of the distance of the seaside tip of the pump from the natural swi toe x pswi versus the natural swi toe length x nswi here the swi toe refers to the intersection of the interface i e the 5 seawater isochlor and the aquifer base while the swi toe length refers to the distance from the coast to the swi toe r q is the ratio of the pump rate q p to the inflow from the inland boundary q in as such r x and r q relate variables that are generally accessible to water resource managers for the scenarios used in this study the variation in the distance of the pump from the coast resulted in r x values ranging between 5 5 and 57 the variation in the pump rate resulted in r q values ranging between 0 4 and 250 in the following analysis the adjectives qualitatively describe the results within our setting i e scenario and parameter definition and range of results i e occurrence of pp swi to investigate the shape and location of the pumping induced cone of depression we derived two metrics that quantify the horizontal d x0 5 and vertical extent d z0 5 of the drawdown as described in fig 3 here d z0 5 is half the maximum drawdown d x0 5 is the distance along the x axis between the location where maximum drawdown occurs and the location coastward of the pump where the drawdown is equal to d z0 5 additionally we define the ratio r d d x0 5 d z0 5 to quantify the horizontal to vertical extent of the cone of depression r d values correspond to the transient development state of the cone of depression where smaller r d values stand for early phases not well developed cones of depression and larger r d values for later near steady state phases 3 results and discussion 3 1 the pp swi phenomenon fig 4 shows the deactivated pump period τd due to pp swi as a function of the pump distance from the coast x pc and r x and the pump rate q p and r q furthermore fig 4 and most of the following figures shows all simulated scenarios as color coded dots where blue represents scenarios that did not show pp swi red shows those where pp swi was observed and green symbolizes scenarios for which the well fell dry unshaded regions show parameter combinations where pp swi was not observed overall the area of the pp swi phenomenon is defined by i upper boundary between red and green dots and ii lower q p boundary between blue and green dots as well as iii a maximum x pc for i a specific q p at a location x pc leads to a drawdown and a deficit of water which causes the pumps to fall dry such that the salinity threshold c 0 05 does not define the deactivation of the pumps anymore the boundaries ii and iii define such low q p and large x pc that the swi does not reach the pump in general higher pump rates q p lead to longer deactivated pump periods τd for q p 150 m2 a τd is not depending on the distance of the pump to the coast x pc but only on q p for q p 150 m2 a maximum τd occurs when x pc 1500 m with decreasing τd for both increasing and decreasing x pc this diverging behavior may be explained by the following considerations for low x pc pumps closer to coast the time that is available for the development of the drawdown is small in comparison to the time until the interface reaches the pump which leads to a shorter τd than if the pump was further inland for a pump located further inland the cone of depression has more time to develop as the interface takes longer to reach the pump due to the larger distance resulting in a longer τd the latter situation increases until for large x pc far inland the drawdown has to be significantly larger to cause the interface to reach the pump this is however limited by a maximum q p which is defined by the situation where the pumps are shut down due to a lack of water this observation i e that higher q p lead to a stronger pp swi phenomenon is in line with the laboratory scale physical experiment by stoeckl et al 2019 particularly they described that the persisting cone of depression after the cessation of pumping results in a continued swi i e the phenomenon of pp sw which is only reduced and eventually reversed when the drawdown is diminished by the replenishment from recharge c f also fig 5 and the associated discussion of the phases of the phenomenon below we carried out a grid refinement test for the scenario xpc 1500 m qp 8 9608 10 6 m2 s and the results show a difference of 1 5 and 0 05 in τd for element sizes that are 1 5 and 2 times smaller than the original respectively with such small deviations and a change in sign during stronger refinement we firstly consider the chosen mesh resolution to be sufficient and secondly interpret the observed differences as the numerical accuracy within this non linear system for the cases where the pump fell dry we stopped the simulation by default and did not assess pp swi as the scenario definition would not be consistent i e q p had to be reduced to continue the simulation extrapolating the generally increasing τd for higher q p we hypothesize that pp swi still happens in cases where the pump fell dry fig 5 shows a detailed analysis of the pp swi phenomenon for a selected scenario x pc 500 m q p 1773 m2 a and key time steps the pp swi process is governed by several phases which can clearly be delineated by the flow direction induced from the hydraulic gradient or variable density flow and transport the first time step t 15 5 a time t is always given with respect to the time when the pumps are deactivated shows the initial state where groundwater flows into the direction of the coast the passive swi werner 2017 is flowing due to density dependence against the natural groundwater flow direction and the pumps have just been started over the next two time steps t 14 1 a t 6 2 a a groundwater divide develops and moves towards the coast in turn the formerly passive swi changes into an active type causing saltwater to flow towards the pumps at the time when the critical salinity concentration has reached the pumps t 0 a the salt movement is governed by the hydraulic gradient that is enforced by the groundwater drawdown due to the pumping activity the next two time steps after the pump stop t 3 3 a t 22 3 a show a phase where the salinity continues to follow the hydraulic gradient towards the location of the pumps until at t 35 0 a a density dependent circulation typical for swi processes starts to develop with this the formerly active swi changes back to a passive one and the continued landward movement of the saltwater is governed by variable density flow time step t 79 4 a marks the time of maximum pp swi length from this time on the regime changes into one that is again driven by the hydraulic gradient which causes groundwater to flow entirely coastward pushing saltwater out of the study domain in comparison to active swi where salt transport is governed by a gradient induced landward groundwater flow we observe that the salt transport is controlled by a gradient induced coastward groundwater flow resulting in a retreating counter active swi this behavior can be observed until the end of our simulations i e when the salinity concentration at the coastward side of the pumps again falls below the threshold which coincides with the potential reactivation of the pumps again this is in line with the experimental observations in stoeckl et al 2019 for each scenario setup with different values for x pc and q p the state of the water table and salinity distribution at t 0 will be different for example we observed for scenarios where the pumps were located farther from the coast that the length of the transition zone between fresh and saltwater was larger than for those scenarios with pumps located closer to the coast for the former the second phase of density driven passive swi is shorter due to the reduced concentration gradient as a result of the wider transition zone in turn the pp swi will be governed by the distinctive configuration of the swi and drawdown at the time of the pump stop fig 6 compares the active pumping period τp blue isolines and reactivation time τr red isolines for the simulated values of deactivated pump period τd τr τp shown previously in fig 4 it can be seen that τp and τr increase with increasing x pc i e with increasing distance of the pump from the coast also τp decreases with increasing q p i e the active pumping period decreased as the pumping rate increased as expected the relationship between τr and q p is more complex however as τr is a result from the individual behavior of both τp and τd τr decreases with increasing q p for q p values below around 150 m2 a τr is largely independent of q p for values of q p in the approximate range of 150 m2 a to 300 m2 a and x pc less than around 2 5 km τr increases with increasing q p for q p values greater than around 300 m2 a the implications of these results are that for q p values less than around 150 m2 a large τp values i e longer active pumping period are associated with large τr i e longer times until pump reactivation and small τd i e deactivation pumping period for q p values greater than around 150 m2 a the relationship between τp τr and τd is complex and non linear regarding the drawdown fig 7 shows d x0 5 d z0 5 and the ratio r d at the time of pump stop τp it can be seen that d z0 5 increases with increasing x pc and q p with relatively equal contributions from each of these parameters it might be expected that the horizontal development of the cone of depression follows the vertical development however simulation results indicate that d x0 5 primarily depends on x pc and is only slightly influenced by q p moreover d x0 5 increases with decreasing q p as the horizontal development of the cone of depression requires a much longer time than the vertical one d x0 5 d z0 5 the former is limited by the arrival of the interface at the pump location with lower q p the horizontal extent of the drawdown and d x0 5 has more time to develop this is also shown by the ratio r d which decreases with increasing q p it is therefore interpreted that the non linear distribution of τd shown in fig 4 can be mainly attributed to insufficiently developed cones of depression in horizontal direction especially for increasing q p this observation firstly may seem counterintuitive and contradict the predictions by stoeckl et al 2019 who suspect systems with larger postextraction disequilibrium to have a higher vulnerability to pp swi however our simulations show that the temporal disequilibrium between the horizontal and vertical development of the cone of depression have strong influence on the magnitude of pp swi to exclude possible boundary effects we analyzed the drawdown at the inland bc d qin fig 8 with a total saturated thickness of around 85 m at the inflow boundary we noticed a maximum drawdown d qin 5 1 m 6 at τp for the scenario that showed the pp swi phenomenon with largest x pc and strongest q p i e x pc 4500 m and q p 217 m2 a the mean drawdown for all scenarios is d qin 0 6 m 0 7 and the majority of the simulated pp swi occurrence shows a d qin 0 5 m therefore we did not find a significant influence of d qin on the pp swi simulation results and consider the chosen domain length 15 km adequate for the simulations presented in this study 3 2 interpretation of management variables in addition to the quantitative indicators described above we derive a number of variables in this section to provide additional insight into the pp swi phenomenon for coastal aquifer water management fig 9 a shows the maximum distance beyond the pump that the swi toe reached during pp swi x ppswi for q p values greater than around 300 m2 a x ppswi increases with higher q p reaching a maximum of 350 m and is largely insensitive to x pc for q p less than around 150 m2 a x ppswi increases with increasing x pc and is largely insensitive to q p fig 9b presents the water volume v p extracted by the pumps during τp v p generally increases with increasing x pc at any defined x pc the smallest v p occurs for medium q p 150 m2 a while for both larger and smaller q p v p increases we explain this divergent behavior in the following way for stronger q p the cone of depression shows a lower r d such that any region that is affected by a drawdown will drain for most of the saturated aquifer thickness for medium q p r d becomes larger such that the drawdown affected regions do not immediately drain the total thickness finally for low q p the scenarios approach the area where the swi does not reach the pump no pp swi occurs and the pumps can run indefinitely and v p increases or even becomes infinite water management assessment commonly aims for sustainable water use and the optimal use of available resources therefore it is important to know the time period for which the water resources can be used τp in this study and how long they would be unavailable in case of overexploitation i e τp and τd respectively in this study in this regard it is important to strengthen our interpretation of the non linear behavior of τd shown in fig 4 the scenario with the maximum q p that does not show pp swi blue dots in fig 4 is located at the farthest distance x pc with q p 150 m2 a r q 4 at x pc 4 5 km r x 60 this scenario did neither stop due to increased salinity nor a too low water table during the simulation time 3200 a and we assume that it would run indefinitely as well as all other scenarios in blue for slightly higher q p 300 m2 a at the same location there is also no pp swi as the wells run dry symbolized by the green dot therefore somewhere in between these two points one should find the maximum sustainable pump rate which should be relatively independent from the distance to the coast if the influence from the coast bc is neglected if this pump rate is used to draw a horizontal line in fig 4 one can see that below this line q p 150 m2 a the increase of pp swi is increasing linearly and only with q p and above this line a non linear increase occurs for the latter we can find a complex interplay between the transient development of the depression cone and the intruding seawater the previous observation might furthermore imply that pumps need to be placed at a distance equivalent to r x 60 i e at a location that has a distance from the natural swi toe location which is 60 times larger than natural swi toe length such that no pp swi will occur this however would result in additional management efforts for the distribution of the freshwater to the regions where it is required and probably higher energy costs for pumping as inland groundwater tables tend to lie deeper below the ground surface than at the coast in terms of water management one might be able to explore a sustainable pump rate in a setup that simulates the phase after τr i e the time when our simulation is stopped and the pumps would have been reactivated preliminary simulations revealed an oscillatory on off behavior of the pumps which is caused by the repetitive intruding and retreating movement of the saltwater when the pumps are switched on and off respectively if managed correctly this observation may lead to a state where the swi interface could be kept just at the tip of the pumps and thus the salinity of the abstracted groundwater at a low concentration as the focus of this work is on the pp swi phenomenon we did not investigate this aspect further which might also occur for situations that do not show a pp swi phase 3 3 implications for monitoring swi fig 10 relates τd to r q and x pc plotting the former as a function of the latter two the figure reveals a strong correlation between τd and r q where τd increases with r q however the color coding shows no obvious correlation of τd with x pc for real world aquifer management and monitoring this implies that groundwater salinity measurements at different wells with different distances from the coast do not give information on the occurrence or extent of pp swi a better measure to estimate pp swi is the ratio of pump rate versus the inflow from upstream recharge where inflow estimates could be drawn from lysimeter measurements a regional water balance or different types of hydraulic models 4 conclusions we improved the understanding of the phenomenon of post pumping seawater intrusion which was recently investigated using a laboratory scale experimental setup by stoeckl et al 2019 and extended this to a regional scale model our findings can be summarized as follows 1 longest deactivated pump periods strongest pp swi τd have been observed at medium pump rates and medium pump distances to coast 2 large pump distances to coast or low pump rates show short deactivated pump periods τd short pump distances and high pump rates may also show elevated deactivated pump periods 3 pp swi is governed by a sequence of active passive and counter active swi phases the length of the individual phases is depending on the scenario configuration distance of pumps to coast x pc and pump rate q p resulting in a non linear behavior 4 we observed scenarios with pump rates where swi did not reach the well field and no pp swi occurred this may hint at sustainable pump rates under certain conditions which should be investigated with a case based evaluation 5 cumulative water abstraction volumes show a non linear behavior lowest volume at medium pump rates and generally increase with pump distances 6 in our simulations pump rates were more important than the pump distance for the deactivated pump period associated with pp swi which bears large implications for monitoring standards in coastal aquifers our findings are in line with observations of pp swi by walther et al 2014 fig 9 for a real world aquifer where upstream recharge i e flow through the inland boundary was defined as 7 107 m3 a and total pump rates reached up to 1 8 108 m3 a i e pumping is equivalent to up to three times flow through the inland boundary r q in our study the synthetic setup used here confirmed that for r q 3 an occurrence of pp swi is possible within an order of several tens of years stoeckl et al 2019 concluded that the numerical fitting of their experimental data was not fully in line with their laboratory observations and always showed faster swi recession this might hint at even longer pp swi phases in reality than simulated in the simplified setup here the faster swi recession in the physical experiment relative to the numerical experiment observed by stoeckl et al 2019 may be attributed to hysteresis during the rewetting of the unsaturated porous media in general our findings imply the following key messages for process understanding and management of these systems 1 with increasing availability of electrical pumps and less use of manual groundwater extraction groundwater use will move further inland where water tables are deeper and freshwater more abundant than close to the coast according to our first conclusion this however will also increase the risk of pp swi 2 the occurrence of the pp swi phenomenon is limited to a maximum distance to the coast which is specific to the individual study area yet the absence of pp swi does not imply the non existence of swi 3 management of coastal groundwater resources should consider water demand in terms of volume and temporal availability our results show that sustainable pump rates may exist and that abstraction volume is neither linearly related to pump rates nor to pump location 4 finally as we have shown that the pump distance to the coast is not a reliable measure to evaluate the occurrence of pp swi management practice should furthermore focus on the determination of the ratio of pump rates and inflow from upstream recharge as an extension to this work it might be reasonable to vary aquifer permeability or heterogeneity pumping depth saturated aquifer thickness or the relation of the two latter and to include upstream or land surface recharge variations or transient pump rates credit authorship contribution statement marc walther conceptualization data curation formal analysis investigation methodology resources software validation visualization writing original draft writing review editing leonard stoeckl conceptualization formal analysis investigation methodology validation visualization writing original draft writing review editing leanne k morgan conceptualization formal analysis investigation methodology validation visualization writing original draft writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements leanne morgan is partly supported by environment canterbury new zealand https www ecan govt nz the authors would like to thank the editor graham sander the associate editor and the three anonymous reviewers for their comments that helped to improve the manuscript 
