index,text
3180,a better understanding of phosphorus transfer process and influence factors at sediment water interface swi is essential to develop effective and efficient river managements strategies in this study overlying water pore water and riverbed sediment samples were collected in the huaihe river hr a highly polluted river in eastern china in may 2013 july 2013 and june 2016 respectively models were developed to analyze influence factors on phosphorus by bayesian networks bns which could describe complex interdependencies between dependent independent variables conveniently compared to traditional statistical models the transfer process and effects of land use on phosphorus at the swi were evaluated results indicated that phosphorus concentration decreased in overlying water and pore water similarly but increased in riverbed sediment from 2013 to 2016 the concentrations in overlying pore water reached a maximum at the middle of the research area while those in riverbed sediment increased from upstream to downstream phosphorus was transferred from overlying water to riverbed sediment through pore water mainly in a dissolved phase indicating that riverbed sediment could absorb contaminants and act as pollution sink in the hr upstream water and sediment were important sources of downstream phosphorus with the influence coefficients ranging from 0 294 to 0 491 land use within 1 km river buffer had most significant influence on total phosphorus in overlying water and 2 km river buffer to riverbed sediment while land use had the most noteworthy effects on particulate dissolved phosphorus in 2 km and 8 km river buffer respectively farmland urban and rural residential land were important sources of phosphorus at the swi and farmland contributed most 30 in the hr the study not only provides insights into phosphorus transfer process and influence factors at the swi in the hr but the proposed model also could be applicable in other polluted rivers keywords phosphorus sediment water interface transfer process spatial scales land use bayesian network data availability data will be made available on request 1 introduction phosphorus is an essential nutrient for all living organisms in river ecosystems david and schindler 2012 wang et al 2020b however excess phosphorus in water bodies arising from anthropogenic activities such as fertilization rapid urbanization and discharge of industrial wastewater and domestic sewage can lead to eutrophication and subsequent degradation of water quality doan et al 2018 mccrackin et al 2018 todeschini 2016 zhang et al 2017 sediment plays a crucial role in phosphorus transportation in aquatic ecosystem and acts as pollutant sink and or source fertilizer derived phosphorus accumulated in soil and then infiltrated into groundwater as a dissolved phase or transported into rivers by sediment bound particulate phase shen et al 2020 sediment especially fine sediment particles could act as contaminants sink by absorbing phosphorus in rivers and then depositing in riverbed gao et al 2020 wang et al 2018 wang et al 2020b however sediment resuspension may lead to the release of sediment bound phosphorus in response to physicochemical or biogeochemical changes and in this case sediment acts as a phosphorus source fatimah et al 2016 kraal et al 2013 shaughnessy et al 2019 previous research have pointed out that riverbed sediment has significant impact on phosphorus levels in rivers ding et al 2018 found that internal phosphorus source phosphorus released from sediment particles made more than half contribution for total phosphorus increase in water column in the lake taihu in china compared to the terrestrial source remobilized phosphorus releasing from sediment was a more important source of phosphorus in the chesapeake bay boynton 1996 joshi et al 2015 numerous studies reported the phenomenon that contaminants releasing from sediment particles could frustrate improvement of water quality after controlling external pollution sources alvarez et al 2012 liu et al 2016 macintosh et al 2018 yin et al 2016 the sediment water interface swi where mass transportation and energy exchange occurring plays a critical role in pollutant transfer in rivers newcomer et al 2018 many previous studies highlighted the importance of focusing on the dynamic distribution of phosphorus at the swi however in depth understanding of phosphorus transfer process is still limited in previous studies which needs to pay more attention to doan et al 2018 liao et al 2020 wijesiri et al 2019 the physicochemical properties such as water temperature and ph can significantly affect the adsorption capacity of sediment and consequently the transfer process of phosphorus at the swi especially during sediment resuspension process li et al 2018 zhang et al 2018 anthropogenic activities alongside waterbody producing considerable amount of pollutants is another key factor influencing phosphorus levels in rivers which could be evaluated by different types of land use gao et al 2020 jennett and zheng 2018 wen et al 2020 tudesque et al 2014 found that the strength of the relationship between land use and water chemistry increased from local to basin scales in france however mainali and chang 2018 found that land use in local scale had a greater explanatory power for water quality than that in sub watershed scale in south korea these studies indicated that the most relative spatial scales between land use and water pollution tended to be different the buffer zone between river and the surrounding territory has important effects on river environment ouyang et al 2013 thus different spatial scales alongside river buffers should be considered comprehensively to determine the most relative scales which was crucial in implementing effective and efficient water management strategies the transfer process of phosphorus at the swi and potential influencing factors could be evaluated by two methods one is to use coupled models consisting of hydrodynamics sediment and phosphorus transportation modules to describe sediment dynamics and phosphorus adsorption desorption process barrow 2015 huang et al 2015 another way is to use high resolution dialysis and diffusive gradients in thin films dgt to determine phosphorus transfer flux ding et al 2018 ren et al 2020 yu et al 2019 however these two methods are either computation consuming or process complex in the study a data driven model is proposed in which information can be extracted from data in a simple and direct way to determine direction of phosphorus transfer and evaluate influence factors on phosphorus distribution at the swi detenbeck et al 2016 li et al 2014 complex factors influence phosphorus concentration at the swi accordingly phosphorus concentration in water and riverbed sediment are determined by natural conditions and human activities in river basins besides these factors also affect phosphorus transfer process at the swi which in returns changes phosphorus distribution in water and sediment because of the complicated interdependencies the contribution rates of all influence factors on phosphorus at the swi are hard to describe and evaluate by traditional statistical models the bayesian network bn decomposing a global distribution into a set of local conditional distributions is a feasible choice for determining the transfer process of phosphorus at the swi and its influencing factors therefore the bn model was applied in our studies and the following analysis was based on it in this study physicochemical conditions and land use type were assumed to be potential factors affecting the distribution and transfer process of phosphorus at the swi as pore water is an important contributor to biogeochemical cycles between overlying water and riverbed sediment two possible directions that phosphorus transferred at the swi were assumed accordingly overlying water to riverbed sediment direction i or from riverbed sediment to overlying water direction ii through pore water cook et al 2018 wilson et al 2016 the potential transfer direction in the hr was determined by the model which had the best performance the main objectives of this study were to investigate 1 the spatial and temporal distributions of phosphorus at the swi 2 possible transfer direction of phosphorus at the swi based on the bn model and 3 the effects of physicochemical conditions and land use type on different forms of phosphorus at the swi based on the research transfer patterns and influence factors on phosphorus at the swi could be clarified moreover the sampling methods and modeling approaches in the paper are not only applicable in the hr but also in other polluted rivers worldwide 2 material and methods 2 1 study area the huaihe river hr 30 36 n 111 121 e is one of the most polluted rivers in eastern china fig 1 a the river originates from henan province and discharges into the hongze lake in jiangsu province with a catchment area of about 270 000 km2 and an altitude drop of 200 m jin et al 2020 xu et al 2019 the shaying river sr and guo river gr are two main tributaries flowing into the hr fig 1 b the hr is the transition zone of climate in china with wet and hot weather in summer while dry and cold weather in winter whose annual average temperature is about 11 16 c the annual precipitation in the huaihe river basin hrb is about 800 mm which has an uneven distribution among seasons and years for example more than 70 of precipitation occurs from april to september and the maximum annual precipitation could be 3 4 times of the minimum annual precipitation sun et al 2016 zhang et al 2016 thus large intra annual and inter annual variations of water resources exist in the hrb xu et al 2018 the hrb is one of the most important commodity grain production bases in china accounting for 13 of farmland area and 23 of annual grain production capacity in the country cao and zhu 2017 chen et al 2018 zhang and wang 2014 thus huge amount of agricultural fertilizers was consumed especially phosphate fertilizer which was 3 1 times greater than country standard liu 2015 zhang and huang 2011 however the utilization rate of fertilizer is only about 40 and more than half of fertilizers are released into rivers or groundwater causing severe water pollution in this area lin et al 2019 shen et al 2007 2 2 sampling experiments 2 2 1 sampling sites in the study fourteen typical sampling sites were selected in the hr to analyze the phosphorus distribution and influence factors at the swi fig 1 c the research area starts in zhengyangguan s1 which lies in the upstream before the sr flowing into the hr and ends in xiaoliuxiang s14 which is the last monitor site before the hr discharging into the hongze lake other sampling sites were set near significant sections such as industrial zones agricultural areas or cities because of serious pollution level in the gr bengbuzha s8 and wujiadu s9 were chosen to analyze the effects of tributaries on spatial distribution of phosphorus pollution at the swi the detailed information of all sampling sites was shown in table 1 2 2 2 samples collection water and riverbed sediment samples were collected in may 2013 july 2013 and june 2016 respectively which were dry days immediately after heavy rain during wet season in the hrb samples were scheduled to be collected at fourteen sites however some sites were excluded due to some unexpected reasons i e difficulty of anchoring the boat at the sampling site or collecting sufficient samples for analysis and only those at which overlying water pore water and riverbed sediment samples were successfully collected were included to analyze the distribution and transfer process of phosphorus at the swi finally samples were collected at 6 3 and 14 sampling sites in may 2013 july 2013 and june 2016 respectively table 1 water and sediment samples were collected at the left middle and right sides at each sampling site to avoid potential bias caused by accidental sampling the concentrations of phosphorus in samples were determined in laboratory and the average concentration values were used to indicate the pollution extent at each sampling site the overlying water samples were collected prior to the collection of riverbed sediment samples in order to avoid disturbance to bottom water water samples were collected using an organic glass water sampler and stored in brown glass bottles note that all bottles were cleaned and washed with chromic acid tap water and distilled water to avoid sample contamination in order to avoid the disturbance from other kinds of contaminant such as arsenate sulphuric acid was added into samples to maintain the ph 1 riverbed sediment samples together with porewater samplers were collected using a peterson sediment sampler hydro bios kiel altenholz germany at riverbed within 5 cm depth then the sediment samples were placed into a clean plastic basin and well mixed to separate into two parts one part was stored in brown glass bottles for extraction of pore water and the other part was stored in cloth bags and dried at room temperature all sample containers were labeled with sampling time and locations and shipped back to laboratory immediately after sampling 2 2 3 samples analysis the physicochemical properties of the overlying water such as water temperature dissolved oxygen and ph were measured by a ysi portable meter during the sampling pore water samples were centrifuged from riverbed sediment samples the forms of phosphorus in water and sediment samples were analyzed to evaluate the distribution patterns at the swi accordingly total phosphorus tp concentration in river sediment was measured based on environment protection standard hj632 2011 in china soil determination of total phosphorus by alkali fusion mo sb anti spectrophotometric method 2011 based on the standard all phosphorous compounds in sediment particles were converted to soluble orthophosphate after melting with sodium hydroxide and then converted phosphomolybdenum blue by reacting with mo sb vc chromogenic agent under acidic conditions the contents of tp in sediment samples were calculated by measuring absorbance at 700 nm wavelength following lambert beer law total phosphorus and dissolved phosphorus dp in water samples were measured following standard gb11893 89 and hj670 2013 water quality determination of orthophosphorus and total phosphorus continuous flow analysis cfa and ammonium molybdate spectrophotometry 2011 water quality determination of total phosphorus ammonium molybdate spectrophotometric method 2011 the detection limit of tp in sediment was 40 mg kg and that of tp and dp in water were both 0 1 mg l the accuracy and precision of tp and dp in water were measured by six laboratories in the standards which were greater than 97 and 95 and the accuracy and precision of tp in sediment were greater than 83 and 91 respectively 2 3 data collection and modeling 2 3 1 data collection the land use data in 2010 and 2015 were obtained from the data centre for resources and environmental science chinese academy of sciences resdc http www resdc cn in order to determine the influence of land use in different spatial scales on phosphorus transfer process six river buffer scales were considered including 1 km 2 km 5 km 8 km 10 km and 20 km width on each side of the river along the sampling area fig 1 d and e the types of land use analyzed in the research were woodland grassland water urban rural resident land and farmland the detailed inclusions in each type of land use were shown in table s1 the area percentage of each land use type was calculated by arcgis 10 5 esri company redlands california usa at the six scales under the gauss kruger projected coordinate system because of limited data availability the land use map in 2010 and 2015 were applied to match the sampling data in 2013 and 2016 respectively in order to eliminate errors caused by different sources and large variations of values all data used for model development were scaled following the method recommended by fijani et al 2019 the contaminant levels should be assessed in order to manage river environment more efficiently the phosphorus pollution level in surface water was evaluated based on the environmental quality standards for surface water in china gb 3838 2002 table s2 and the pollution level in riverbed sediment was assessed based on the sediment quality guidelines sqgs recommended by the ministry of environment and energy of canada persaud et al 1993 yang et al 2017 three pollution levels were specified in sqgs based on tp accordingly unpolluted or slightly polluted tp concentration 600 mg kg moderately polluted tp concentration 600 2000 mg kg and heavily polluted tp concentration 2000 mg kg 2 3 2 model development and evaluation the bayesian network bn is a kind of directed acyclic graphical dag model which is consisted by nodes and arrows accordingly nodes represent the variables analyzed in the model including continuous and discrete variables while arrows pointing from independent variables to dependent variables represent the probabilistic conditional dependencies between variables guo et al 2014 li 2014 wijesiri et al 2018b therefore bn can be simply represented by g p where g is the structure graph and p is the joint probability distribution p could be expressed by the following equation di et al 2014 geiger et al 1990 1 p x 1 x n p x 1 x 1 x 2 x 2 x n x n i 1 n p x i x i 1 x 1 i 1 n p x i π x i where x is the assemble of all variables x1 x2 xn the structure of a typical bn model is shown in fig s1 according to the markov property the joint probability distribution of these variables can be factorized into local probability distributions and only immediate parent variables are considered in the model thus the complex interdependencies could be expressed in a simple way wijesiri et al 2018a in this study the complex influence factors on phosphorus transfer process at the swi were described by bn models fig 2 here two potential transfer directions were assumed one potential direction is that phosphorus transferred from overlying water to riverbed sediment through pore water which also could be considered as sediment absorption direction i thus phosphorus concentrations in upstream overlying water physicochemical conditions of overlying water and land use types were considered as inputs of the overlying water model physicochemical conditions and phosphorus concentrations in overlying water were considered as inputs of the pore water model land use types physicochemical conditions and phosphorus concentrations in upstream pore water and riverbed sediment were considered as inputs of the riverbed sediment model another potential direction is that phosphorus transferred from riverbed sediment to overlying water through pore water which also could be considered as sediment release direction ii in the study bn models were developed based on the six spatial scales by the bnlearn package scutari 2010 in the r statistical computing platform r core team 2016 the goodness of fit was evaluated using pearson s correlation coefficient cor and nash sutcliffe efficiency coefficient nse nash and sutcliffe 1970 and the most relevant spatial scale was determined by the model with the best performance namely the largest cor and nse 3 results and discussion 3 1 phosphorus distribution at the swi 3 1 1 temporal distribution of phosphorus at the swi water samples were collected in may 2013 july 2013 and june 2016 respectively the maximum minimum average and standard deviation of physicochemical parameters and three phosphorus phases at the swi were determined and the differences among the sampling experiments were evaluated by t test xu et al 2018 the details of phosphorus concentration were shown in table 2 because of climate characteristics in the hrb the water temperature was different in may june and july which ranged from 23 0 c to 27 4 c in may and june while ranged from 31 7 c to 33 6 c in july the average ph ranged from 7 4 to 8 0 and differed substantially among the three sampling experiments water temperature was one of the most important causes of the differences in dissolved oxygen do between may and july according to the water quality standards the average do reached grade ii in may and grade iii in june and july table s2 three phosphorus phases were measured in 2016 including tp dp and particulate phosphorus pp concentration of pp values were greater than dp at all sampling sites because of pp were mainly in sediment bound which resuspended as a result of antecedent heavy rain the result indicated that phosphorus absorbed by sediment particles could not be ignored over wet period in the hr for the dp concentration no significant difference was found between samples in 2013 while significant differences existed between samples in 2013 and 2016 which could be attributed to the improvement of water quality in the hrb with the implementation of regional water pollution controlling policies xu et al 2018 however the tp concentration values was greater than grade iv table s2 implying that phosphorus pollution was still a serious problem in the hr basin similarly there was no significant difference in tp concentration in pore water between may 2013 and july 2013 but it was significantly decreased in june 2016 the distribution pattern of phosphorus in riverbed sediment differed substantially from that in overlying water and pore water the maximum and minimum tp concentration were both recorded in may 2013 and the average tp concentration in 2016 was greater than that in 2013 the pollution level of sediment in the hr become serious over time despite of surface water quality improving which indicates the importance of paying attention to polluted sediment particles in rivers 3 1 2 spatial distribution of phosphorus at the swi because samples were successfully collected only at three sites in july 2013 we compared phosphorus concentrations collected in may 2013 and june 2016 fig 3 the locally weighted regression smooths loess lines were applied to capture the spatial variations of phosphorus concentration values across sampling sites from upstream to downstream based on nonparametric regression the dp concentrations were greater in the downstream overlying water than that in the upstream overlying water except that they were slightly decreased from anji s12 to xiaoliuxiang s14 similar spatial distributions were found for tp and pp concentration in overlying water in june 2016 there was a decreasing trend from upstream to downstream and the largest concentration was found in river segment from huainanxia s7 to wujiadu s9 which were close to huainan city and bengbu city the result implied that anthropogenic activities in cities and industrial areas were important sources of phosphorus in the hrb the tp concentration in pore water remained stable in the hr except at wujiadu s9 where tp concentration was extremely high which indicated the contribution of the tributary the gr to the high pollution level in the hr the phosphorus concentration in riverbed sediment was decreased from upstream to downstream and reached the maximum at wujiadu s9 which was consistent with the distribution pattern of phosphorus in pore water in may 2013 however the opposite pattern was observed in june 2016 accordingly phosphorus concentration remained stable from zhengyangguan s1 to huainanshang s6 and increased greatly from huainanxia s7 to mohekou s10 after which it increased at a small rate the average tp concentrations in riverbed sediment at all sampling sites were smaller than 600 mg kg which indicated that the sediment was in unpolluted or slightly polluted level based on the sqgs 3 2 transfer of phosphorus at the swi 3 2 1 transfer process of phosphorus at the swi phosphorus could be transferred from overlying water to riverbed sediment direction i or from riverbed sediment to overlying water direction ii via pore water and the actual transfer direction was determined based on the goodness of fit values of models the observed versus predicted concentrations of phosphorus in pore water were shown in fig 4 where the red line indicated that the predicted concentration values were equal to the observed ones the cor and nse reached higher values for the model in which phosphorus was assumed to be transferred from overlying water to pore water according to the recommendation from moriasi et al 2007 the model was acceptable when the nse value was greater than 0 5 therefore only the model considering the influence of dp in overlying water on tp concentration in pore water was satisfactory nse 0 56 and cor 0 74 which implied that the transportation direction of phosphorus was from overlying water to riverbed sediment in a dissolved phase tang et al 2014 pointed out that dp in pore water played an important role in biochemical reaction between overlying water and riverbed sediment which was consistent with our results the field experiments indicated that sediment in the hr was capable of absorbing phosphorus our result was consistent with wijesiri et al 2019 whose research reported nutrients were more likely to be transferred from water to sediment and confirmed that river sediment could be an effective sink of nutrients in shenzhen river in china increasing flow velocity could increase absorption capacity of sediment particles and accelerate the absorption process which explained that why riverbed sediment absorbed phosphorus pollutants and acted as pollution sink at sampling experiments during wet seasons in the hr from may to august house et al 1995 zhang et al 2011 based on the previous study about the effects of resuspended sediment on phosphorus in surface water in the hrb sediment particles were an important source to tp contaminants in rivers especially during heavy rainfall periods jin et al 2020 despite riverbed sediment still have potentials to absorb phosphorus which seems to mitigate the polluted level however the riverbed sediment would resuspend into surface water during rainfall events then release the sediment bound phosphorus into rivers and cause degradation of water quality the legacy phosphorus stored in river bends or sediment could reduce the retention capacity of sediment and in this case sediment could act as a phosphorus source rather than a phosphorus sink kreiling et al 2020 van meter et al 2018 weigelhofer et al 2018 previous research has suggested the seasonal variability of the effect of sediment on contaminants in rivers ding et al 2018 in a 12 month field study in lake chaohu china yang et al 2020a found that less nutrients were transferred from sediment to overlying water in winter than in summer akbarzadeh et al 2018 found that sediment acted as a nitrite sink in august but as a nitrite source in october in the seine river france the seasonal variations of phosphite were also observed in the lake taihu china han et al 2013 in the study all samples were collected in wet seasons in the hrb from may to july however in order to better understand the potential seasonal effects of sediment on pollution fields samples should also be collected in the dry season in future research in a two year field study in carlyle lake illinois usa shaughnessy et al 2019 found that phosphorus was initially stored in lakebed sediment and then legacy phosphorus was released thus the phosphorus adsorbed by sediment in the hr may release into overlying water in the future which emphasizes the need for continuous field experiments and collection of more sediment samples in the hr in our following research moreover some researchers pointed out that the absorption capacity of sediment to phosphorus was not sufficient to provide buffers against water quality degradation liao et al 2020 more measures should be implemented to reduce the phosphorus concentration in riverbed sediment in the hr such as applying nutrient polluted sediment to produce fertilizers using aluminum modified clay as passivator to fix phosphorus on the sediment surface at the swi and reducing internal nutrient loads braga et al 2019 yang et al 2020b yao et al 2016 3 2 2 determine of the most relative spatial scales in order to determine the most relative spatial scales in which land use affected phosphorus at the swi the goodness of fit bn models direction i about different phases of phosphorus across six spatial scales were evaluated table 3 as land use was assumed to have no effect on pore water pore water models were not included here in summary all models could provide acceptable descriptions on different phosphorus forms in overlying water and riverbed sediment across six river buffer scales for three forms of phosphorus in overlying water the best models were obtained in various river buffer scales namely 1 km scale for tp 2 km for pp and 8 km for dp for tp in riverbed sediment the best explanation of land use to sediment contaminants levels was obtained in 2 km river buffer scale monteagudo et al 2012 declared that the 1 km buffer scale was the most adequate scale in detecting eutrophication in the central spanish rivers which was similar with our result 3 3 influence factors on phosphorus concentration at the swi 3 3 1 effects of natural factors on phosphorus the effects of natural factors including physicochemical conditions of water phosphorus distribution and contamination level in upstream water and sediment on phosphorus concentrations at the swi were analyzed using the models which assumed that phosphorus was transferred from overlying water to riverbed sediment through pore water direction i at the most relevant spatial scales figure s2 table 4 showed that water temperature had negative effects on phosphorus concentrations in overlying water but no effects in pore water and riverbed sediment thus water temperature was not considered in pore water and riverbed sediment models the results contradicted to previous findings that more nutrients could release from sediment at high water temperature zhou et al 2016 and warm weather led to larger and quicker phosphorus releasing from sediment to pore water in rivers wang et al 2013 a possible explanation why no significant effects of water temperature was found may be that all samples were collected in summer with mean water temperatures of 24 3 32 7 c in the study which were higher compared to previous studies 15 c 20 c and 25 c besides the narrow range of water temperature between three sampling experiments in summer could be another reason for no relationship had been captured between water temperature and phosphorus releasing from sediment for phosphorus in overlying water and pore water ph had significant positive influence however its influence on phosphorus in riverbed sediment was negative thus higher ph was favorable for the release of phosphorus from sediment similarly do also had negative effects on phosphorus concentrations in overlying water previous research revealed that aerobic conditions could significantly inhibit the release of nutrients from riverbed sediment to overlying water jingfu et al 2016 nausch et al 2009 studies pointed out that increasing the do level at the swi contributed to control the release of sedimentary contaminants or even turn phosphorus releasing in anaerobic condition to phosphorus absorbing in aerobic condition wang et al 2020a yiqun et al 2003 because of water flowing from upstream to downstream we assumed that phosphorus in overlying water was affected by upstream water moreover sediment would resuspend from riverbed and transport to downstream during flood periods therefore phosphorus in riverbed sediment was also assumed to be affected by contaminant levels in upstream sediment therefore water and sediment from upstream were considered to be potential influence factors in bn models table 4 upstream water was found to be an important source of phosphorus in overlying water especially for pp because of sediment bound phosphorus was the main form of pp it implied that sediment transportation with water was an unignored influence factors on water pollution in rivers thus riverbed sediment from upstream had significant effects on phosphorus polluted level in riverbed sediment of the lower reaches dp in overlying water had positive effects on tp in pore water similarly tp in pore water also had positive effects on phosphorus contaminants in riverbed sediment the result highlighted that sediment including resuspended sediment and riverbed sediment had important effect on phosphorus levels in rivers 3 3 2 effects of anthropogenic activities on phosphorus the effects of anthropogenic activities were evaluated based on land use types in the study we assumed that land use types had effects on phosphorus concentrations in overlying water and riverbed sediment in overlying water the concentrations of tp dp and pp were measured while only tp concentrations were measured in riverbed sediment samples fig 5 showed that farmland was the most important contributor to tp 33 1 in overlying water followed by water 23 3 and rural resident land 22 8 previous research also reported that agriculture derived phosphorus was the major cause of water degradation in rivers hoang et al 2019 mello et al 2018 monteagudo et al 2012 a promising solution to reduce phosphorus loss from farmland is to promote nutrients retention by using sediment trap management and two stage ditches davis et al 2015 kreiling et al 2018 because major part of domestic wastewater was discharged from rural resident land comparing to other kinds of land use human activities in resident land had considerable contribution to phosphorus pollution in rivers wijesiri et al 2019 however grassland and woodland made almost no contribution to tp in overlying water 0 6 and 2 0 farmland still contributed most to dp in overlying water 31 6 followed by urban 25 8 however previous research reported that urban land use was the primary non point pollution source tran et al 2010 xu et al 2020 and more nutrients were discharged into rivers with increasing urban area labeau et al 2014 the effects of grassland and woodland had a little increase and the contribution rates were 4 0 and 6 5 for pp in overlying water farmland was the major source with a contribution rate of about 34 2 which was similar with that for tp and dp in overlying water water and rural resident land were the third most important source with a contribution rate of about 17 the contribution rates of grassland and woodland were similar with that for tp in overlying water but less than that for dp in overlying water woodland and grassland had the potential to mitigate water deterioration because of their capacity to intercept contaminants especially sediment bound contaminants shen et al 2015 sliva and dudley williams 2001 villamizar et al 2020 for tp in riverbed sediment farmland and urban were two main pollution sources whose contribution rates were both greater than 30 it was different to the influence on phosphorus in overlying water where farmland was the most important pollution source and the contribution of urban was less than farmland the contribution of rural resident land to phosphorus in riverbed sediment was about 17 which shown the same influence patterns on phosphorus in overlying water grassland and woodland had the least contribution to phosphorus pollution in sediment 1 4 and 3 4 which were corresponding to results found in overlying water previous research reported similar results that phosphorus concentration in water and sediment particles had negative relationship to woodland in 2 25 km and 4 km river buffer scales respectively houlahan and findlay 2004 in summary farmland was the most important pollution source to three phases of phosphorus in the hr urban and rural residential land were the second and third most important sources of phosphorus in overlying water and riverbed sediment grassland and woodland made a negligible contribution to phosphorus pollution and instead they had the potential to intercept phosphorus transportation from land to waterbody 4 conclusions to better understand distribution patterns and influence factors of phosphorus transfer process at the swi in the hr water and sediment samples were collected in 2013 may 2013 july and 2016 june respectively physicochemical conditions in water and land use both affected phosphorus at the swi moreover phosphorus transfer process also made changes to its concentration values in water and sediment in order to quantify the complex relationship between influence factors and phosphorus contaminants at the swi the bn models were developed comprehensively considering two possible transfer directions the transfer process and most relative spatial scales were determined by models fitness and influence factors could be evaluated subsequently key findings are summarized as follows 1 phosphorus concentration displayed similar spatio temporal distribution patterns in overlying pore water but opposite patterns in riverbed sediment accordingly the concentration was significantly decreased in overlying pore water and increased in riverbed sediment from 2013 to 2016 the concentration reached the maximum around the middle section of sampling area in overlying pore water while it increased consistently from upstream to downstream in riverbed sediment 2 phosphorus was transferred from overlying water to riverbed sediment through pore water and phosphorus in a dissolved phase was the most important pollution source which shed light that sediment had potential to absorb phosphorus contaminates and work as pollution sink 3 upstream water and sediment were important sources of phosphorus in downstream with influence parameters from 0 294 to 0 491 which could not be ignored water temperature and dissolved oxygen had negative effects on phosphorus in water while ph had positive effects on phosphorus in water and negative effects in riverbed sediment 4 the most significant spatial scales that land use affected phosphorus pollution at the swi were different accordingly 1 km 2 km and 8 km river buffer scale for tp pp and dp in overlying water and 2 km river buffer scale for tp in riverbed sediment respectively the result implies that human activities in relatively local scales had more effects on phosphorus pollution in the hr 5 farmland urban and rural resident land were important source to phosphorus at the swi among which the contribution rates of farmland were largest and more than 30 for three phases of phosphorus considered in the study grassland and woodland had the potential to intercept phosphorus transportation from land into rivers especially pp these findings provide the depth understanding of phosphorus patterns at the swi in the hr despite riverbed sediment shown absorption process on phosphorus in our study water sediment samples should be collected in higher frequency especially during dry seasons in following research to analyzed potential seasonal patterns of phosphorus transfer process farmland urban and rural resident land were main pollution sources to phosphorus contaminants in water and sediment in the hr while grassland and woodland could mitigate phosphorus and work as pollution buffer alongside rivers although our study applied the bn models to analyzed phosphorus transfer patterns and influence factors in the hr the field sampling approach and model development process could also be applicable to analyze other kinds of contaminants in polluted rivers credit authorship contribution statement jing xu conceptualization data curation formal analysis funding acquisition investigation methodology software validation visualization writing original draft yuming mo investigation writing review editing hongwu tang funding acquisition project administration resources kun wang methodology software qingfeng ji methodology software pei zhang methodology software you gan wang investigation methodology supervision validation guangqiu jin funding acquisition supervision writing review editing ling li conceptualization supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was supported by the belt and road special foundation of the state key laboratory of hydrology water resources and hydraulic engineering 2021491811 and the natural science foundation of china 51239003 data used in the analysis presented in the paper can be obtained by sending a request to the corresponding author jingq hhu edu cn appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128079 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3180,a better understanding of phosphorus transfer process and influence factors at sediment water interface swi is essential to develop effective and efficient river managements strategies in this study overlying water pore water and riverbed sediment samples were collected in the huaihe river hr a highly polluted river in eastern china in may 2013 july 2013 and june 2016 respectively models were developed to analyze influence factors on phosphorus by bayesian networks bns which could describe complex interdependencies between dependent independent variables conveniently compared to traditional statistical models the transfer process and effects of land use on phosphorus at the swi were evaluated results indicated that phosphorus concentration decreased in overlying water and pore water similarly but increased in riverbed sediment from 2013 to 2016 the concentrations in overlying pore water reached a maximum at the middle of the research area while those in riverbed sediment increased from upstream to downstream phosphorus was transferred from overlying water to riverbed sediment through pore water mainly in a dissolved phase indicating that riverbed sediment could absorb contaminants and act as pollution sink in the hr upstream water and sediment were important sources of downstream phosphorus with the influence coefficients ranging from 0 294 to 0 491 land use within 1 km river buffer had most significant influence on total phosphorus in overlying water and 2 km river buffer to riverbed sediment while land use had the most noteworthy effects on particulate dissolved phosphorus in 2 km and 8 km river buffer respectively farmland urban and rural residential land were important sources of phosphorus at the swi and farmland contributed most 30 in the hr the study not only provides insights into phosphorus transfer process and influence factors at the swi in the hr but the proposed model also could be applicable in other polluted rivers keywords phosphorus sediment water interface transfer process spatial scales land use bayesian network data availability data will be made available on request 1 introduction phosphorus is an essential nutrient for all living organisms in river ecosystems david and schindler 2012 wang et al 2020b however excess phosphorus in water bodies arising from anthropogenic activities such as fertilization rapid urbanization and discharge of industrial wastewater and domestic sewage can lead to eutrophication and subsequent degradation of water quality doan et al 2018 mccrackin et al 2018 todeschini 2016 zhang et al 2017 sediment plays a crucial role in phosphorus transportation in aquatic ecosystem and acts as pollutant sink and or source fertilizer derived phosphorus accumulated in soil and then infiltrated into groundwater as a dissolved phase or transported into rivers by sediment bound particulate phase shen et al 2020 sediment especially fine sediment particles could act as contaminants sink by absorbing phosphorus in rivers and then depositing in riverbed gao et al 2020 wang et al 2018 wang et al 2020b however sediment resuspension may lead to the release of sediment bound phosphorus in response to physicochemical or biogeochemical changes and in this case sediment acts as a phosphorus source fatimah et al 2016 kraal et al 2013 shaughnessy et al 2019 previous research have pointed out that riverbed sediment has significant impact on phosphorus levels in rivers ding et al 2018 found that internal phosphorus source phosphorus released from sediment particles made more than half contribution for total phosphorus increase in water column in the lake taihu in china compared to the terrestrial source remobilized phosphorus releasing from sediment was a more important source of phosphorus in the chesapeake bay boynton 1996 joshi et al 2015 numerous studies reported the phenomenon that contaminants releasing from sediment particles could frustrate improvement of water quality after controlling external pollution sources alvarez et al 2012 liu et al 2016 macintosh et al 2018 yin et al 2016 the sediment water interface swi where mass transportation and energy exchange occurring plays a critical role in pollutant transfer in rivers newcomer et al 2018 many previous studies highlighted the importance of focusing on the dynamic distribution of phosphorus at the swi however in depth understanding of phosphorus transfer process is still limited in previous studies which needs to pay more attention to doan et al 2018 liao et al 2020 wijesiri et al 2019 the physicochemical properties such as water temperature and ph can significantly affect the adsorption capacity of sediment and consequently the transfer process of phosphorus at the swi especially during sediment resuspension process li et al 2018 zhang et al 2018 anthropogenic activities alongside waterbody producing considerable amount of pollutants is another key factor influencing phosphorus levels in rivers which could be evaluated by different types of land use gao et al 2020 jennett and zheng 2018 wen et al 2020 tudesque et al 2014 found that the strength of the relationship between land use and water chemistry increased from local to basin scales in france however mainali and chang 2018 found that land use in local scale had a greater explanatory power for water quality than that in sub watershed scale in south korea these studies indicated that the most relative spatial scales between land use and water pollution tended to be different the buffer zone between river and the surrounding territory has important effects on river environment ouyang et al 2013 thus different spatial scales alongside river buffers should be considered comprehensively to determine the most relative scales which was crucial in implementing effective and efficient water management strategies the transfer process of phosphorus at the swi and potential influencing factors could be evaluated by two methods one is to use coupled models consisting of hydrodynamics sediment and phosphorus transportation modules to describe sediment dynamics and phosphorus adsorption desorption process barrow 2015 huang et al 2015 another way is to use high resolution dialysis and diffusive gradients in thin films dgt to determine phosphorus transfer flux ding et al 2018 ren et al 2020 yu et al 2019 however these two methods are either computation consuming or process complex in the study a data driven model is proposed in which information can be extracted from data in a simple and direct way to determine direction of phosphorus transfer and evaluate influence factors on phosphorus distribution at the swi detenbeck et al 2016 li et al 2014 complex factors influence phosphorus concentration at the swi accordingly phosphorus concentration in water and riverbed sediment are determined by natural conditions and human activities in river basins besides these factors also affect phosphorus transfer process at the swi which in returns changes phosphorus distribution in water and sediment because of the complicated interdependencies the contribution rates of all influence factors on phosphorus at the swi are hard to describe and evaluate by traditional statistical models the bayesian network bn decomposing a global distribution into a set of local conditional distributions is a feasible choice for determining the transfer process of phosphorus at the swi and its influencing factors therefore the bn model was applied in our studies and the following analysis was based on it in this study physicochemical conditions and land use type were assumed to be potential factors affecting the distribution and transfer process of phosphorus at the swi as pore water is an important contributor to biogeochemical cycles between overlying water and riverbed sediment two possible directions that phosphorus transferred at the swi were assumed accordingly overlying water to riverbed sediment direction i or from riverbed sediment to overlying water direction ii through pore water cook et al 2018 wilson et al 2016 the potential transfer direction in the hr was determined by the model which had the best performance the main objectives of this study were to investigate 1 the spatial and temporal distributions of phosphorus at the swi 2 possible transfer direction of phosphorus at the swi based on the bn model and 3 the effects of physicochemical conditions and land use type on different forms of phosphorus at the swi based on the research transfer patterns and influence factors on phosphorus at the swi could be clarified moreover the sampling methods and modeling approaches in the paper are not only applicable in the hr but also in other polluted rivers worldwide 2 material and methods 2 1 study area the huaihe river hr 30 36 n 111 121 e is one of the most polluted rivers in eastern china fig 1 a the river originates from henan province and discharges into the hongze lake in jiangsu province with a catchment area of about 270 000 km2 and an altitude drop of 200 m jin et al 2020 xu et al 2019 the shaying river sr and guo river gr are two main tributaries flowing into the hr fig 1 b the hr is the transition zone of climate in china with wet and hot weather in summer while dry and cold weather in winter whose annual average temperature is about 11 16 c the annual precipitation in the huaihe river basin hrb is about 800 mm which has an uneven distribution among seasons and years for example more than 70 of precipitation occurs from april to september and the maximum annual precipitation could be 3 4 times of the minimum annual precipitation sun et al 2016 zhang et al 2016 thus large intra annual and inter annual variations of water resources exist in the hrb xu et al 2018 the hrb is one of the most important commodity grain production bases in china accounting for 13 of farmland area and 23 of annual grain production capacity in the country cao and zhu 2017 chen et al 2018 zhang and wang 2014 thus huge amount of agricultural fertilizers was consumed especially phosphate fertilizer which was 3 1 times greater than country standard liu 2015 zhang and huang 2011 however the utilization rate of fertilizer is only about 40 and more than half of fertilizers are released into rivers or groundwater causing severe water pollution in this area lin et al 2019 shen et al 2007 2 2 sampling experiments 2 2 1 sampling sites in the study fourteen typical sampling sites were selected in the hr to analyze the phosphorus distribution and influence factors at the swi fig 1 c the research area starts in zhengyangguan s1 which lies in the upstream before the sr flowing into the hr and ends in xiaoliuxiang s14 which is the last monitor site before the hr discharging into the hongze lake other sampling sites were set near significant sections such as industrial zones agricultural areas or cities because of serious pollution level in the gr bengbuzha s8 and wujiadu s9 were chosen to analyze the effects of tributaries on spatial distribution of phosphorus pollution at the swi the detailed information of all sampling sites was shown in table 1 2 2 2 samples collection water and riverbed sediment samples were collected in may 2013 july 2013 and june 2016 respectively which were dry days immediately after heavy rain during wet season in the hrb samples were scheduled to be collected at fourteen sites however some sites were excluded due to some unexpected reasons i e difficulty of anchoring the boat at the sampling site or collecting sufficient samples for analysis and only those at which overlying water pore water and riverbed sediment samples were successfully collected were included to analyze the distribution and transfer process of phosphorus at the swi finally samples were collected at 6 3 and 14 sampling sites in may 2013 july 2013 and june 2016 respectively table 1 water and sediment samples were collected at the left middle and right sides at each sampling site to avoid potential bias caused by accidental sampling the concentrations of phosphorus in samples were determined in laboratory and the average concentration values were used to indicate the pollution extent at each sampling site the overlying water samples were collected prior to the collection of riverbed sediment samples in order to avoid disturbance to bottom water water samples were collected using an organic glass water sampler and stored in brown glass bottles note that all bottles were cleaned and washed with chromic acid tap water and distilled water to avoid sample contamination in order to avoid the disturbance from other kinds of contaminant such as arsenate sulphuric acid was added into samples to maintain the ph 1 riverbed sediment samples together with porewater samplers were collected using a peterson sediment sampler hydro bios kiel altenholz germany at riverbed within 5 cm depth then the sediment samples were placed into a clean plastic basin and well mixed to separate into two parts one part was stored in brown glass bottles for extraction of pore water and the other part was stored in cloth bags and dried at room temperature all sample containers were labeled with sampling time and locations and shipped back to laboratory immediately after sampling 2 2 3 samples analysis the physicochemical properties of the overlying water such as water temperature dissolved oxygen and ph were measured by a ysi portable meter during the sampling pore water samples were centrifuged from riverbed sediment samples the forms of phosphorus in water and sediment samples were analyzed to evaluate the distribution patterns at the swi accordingly total phosphorus tp concentration in river sediment was measured based on environment protection standard hj632 2011 in china soil determination of total phosphorus by alkali fusion mo sb anti spectrophotometric method 2011 based on the standard all phosphorous compounds in sediment particles were converted to soluble orthophosphate after melting with sodium hydroxide and then converted phosphomolybdenum blue by reacting with mo sb vc chromogenic agent under acidic conditions the contents of tp in sediment samples were calculated by measuring absorbance at 700 nm wavelength following lambert beer law total phosphorus and dissolved phosphorus dp in water samples were measured following standard gb11893 89 and hj670 2013 water quality determination of orthophosphorus and total phosphorus continuous flow analysis cfa and ammonium molybdate spectrophotometry 2011 water quality determination of total phosphorus ammonium molybdate spectrophotometric method 2011 the detection limit of tp in sediment was 40 mg kg and that of tp and dp in water were both 0 1 mg l the accuracy and precision of tp and dp in water were measured by six laboratories in the standards which were greater than 97 and 95 and the accuracy and precision of tp in sediment were greater than 83 and 91 respectively 2 3 data collection and modeling 2 3 1 data collection the land use data in 2010 and 2015 were obtained from the data centre for resources and environmental science chinese academy of sciences resdc http www resdc cn in order to determine the influence of land use in different spatial scales on phosphorus transfer process six river buffer scales were considered including 1 km 2 km 5 km 8 km 10 km and 20 km width on each side of the river along the sampling area fig 1 d and e the types of land use analyzed in the research were woodland grassland water urban rural resident land and farmland the detailed inclusions in each type of land use were shown in table s1 the area percentage of each land use type was calculated by arcgis 10 5 esri company redlands california usa at the six scales under the gauss kruger projected coordinate system because of limited data availability the land use map in 2010 and 2015 were applied to match the sampling data in 2013 and 2016 respectively in order to eliminate errors caused by different sources and large variations of values all data used for model development were scaled following the method recommended by fijani et al 2019 the contaminant levels should be assessed in order to manage river environment more efficiently the phosphorus pollution level in surface water was evaluated based on the environmental quality standards for surface water in china gb 3838 2002 table s2 and the pollution level in riverbed sediment was assessed based on the sediment quality guidelines sqgs recommended by the ministry of environment and energy of canada persaud et al 1993 yang et al 2017 three pollution levels were specified in sqgs based on tp accordingly unpolluted or slightly polluted tp concentration 600 mg kg moderately polluted tp concentration 600 2000 mg kg and heavily polluted tp concentration 2000 mg kg 2 3 2 model development and evaluation the bayesian network bn is a kind of directed acyclic graphical dag model which is consisted by nodes and arrows accordingly nodes represent the variables analyzed in the model including continuous and discrete variables while arrows pointing from independent variables to dependent variables represent the probabilistic conditional dependencies between variables guo et al 2014 li 2014 wijesiri et al 2018b therefore bn can be simply represented by g p where g is the structure graph and p is the joint probability distribution p could be expressed by the following equation di et al 2014 geiger et al 1990 1 p x 1 x n p x 1 x 1 x 2 x 2 x n x n i 1 n p x i x i 1 x 1 i 1 n p x i π x i where x is the assemble of all variables x1 x2 xn the structure of a typical bn model is shown in fig s1 according to the markov property the joint probability distribution of these variables can be factorized into local probability distributions and only immediate parent variables are considered in the model thus the complex interdependencies could be expressed in a simple way wijesiri et al 2018a in this study the complex influence factors on phosphorus transfer process at the swi were described by bn models fig 2 here two potential transfer directions were assumed one potential direction is that phosphorus transferred from overlying water to riverbed sediment through pore water which also could be considered as sediment absorption direction i thus phosphorus concentrations in upstream overlying water physicochemical conditions of overlying water and land use types were considered as inputs of the overlying water model physicochemical conditions and phosphorus concentrations in overlying water were considered as inputs of the pore water model land use types physicochemical conditions and phosphorus concentrations in upstream pore water and riverbed sediment were considered as inputs of the riverbed sediment model another potential direction is that phosphorus transferred from riverbed sediment to overlying water through pore water which also could be considered as sediment release direction ii in the study bn models were developed based on the six spatial scales by the bnlearn package scutari 2010 in the r statistical computing platform r core team 2016 the goodness of fit was evaluated using pearson s correlation coefficient cor and nash sutcliffe efficiency coefficient nse nash and sutcliffe 1970 and the most relevant spatial scale was determined by the model with the best performance namely the largest cor and nse 3 results and discussion 3 1 phosphorus distribution at the swi 3 1 1 temporal distribution of phosphorus at the swi water samples were collected in may 2013 july 2013 and june 2016 respectively the maximum minimum average and standard deviation of physicochemical parameters and three phosphorus phases at the swi were determined and the differences among the sampling experiments were evaluated by t test xu et al 2018 the details of phosphorus concentration were shown in table 2 because of climate characteristics in the hrb the water temperature was different in may june and july which ranged from 23 0 c to 27 4 c in may and june while ranged from 31 7 c to 33 6 c in july the average ph ranged from 7 4 to 8 0 and differed substantially among the three sampling experiments water temperature was one of the most important causes of the differences in dissolved oxygen do between may and july according to the water quality standards the average do reached grade ii in may and grade iii in june and july table s2 three phosphorus phases were measured in 2016 including tp dp and particulate phosphorus pp concentration of pp values were greater than dp at all sampling sites because of pp were mainly in sediment bound which resuspended as a result of antecedent heavy rain the result indicated that phosphorus absorbed by sediment particles could not be ignored over wet period in the hr for the dp concentration no significant difference was found between samples in 2013 while significant differences existed between samples in 2013 and 2016 which could be attributed to the improvement of water quality in the hrb with the implementation of regional water pollution controlling policies xu et al 2018 however the tp concentration values was greater than grade iv table s2 implying that phosphorus pollution was still a serious problem in the hr basin similarly there was no significant difference in tp concentration in pore water between may 2013 and july 2013 but it was significantly decreased in june 2016 the distribution pattern of phosphorus in riverbed sediment differed substantially from that in overlying water and pore water the maximum and minimum tp concentration were both recorded in may 2013 and the average tp concentration in 2016 was greater than that in 2013 the pollution level of sediment in the hr become serious over time despite of surface water quality improving which indicates the importance of paying attention to polluted sediment particles in rivers 3 1 2 spatial distribution of phosphorus at the swi because samples were successfully collected only at three sites in july 2013 we compared phosphorus concentrations collected in may 2013 and june 2016 fig 3 the locally weighted regression smooths loess lines were applied to capture the spatial variations of phosphorus concentration values across sampling sites from upstream to downstream based on nonparametric regression the dp concentrations were greater in the downstream overlying water than that in the upstream overlying water except that they were slightly decreased from anji s12 to xiaoliuxiang s14 similar spatial distributions were found for tp and pp concentration in overlying water in june 2016 there was a decreasing trend from upstream to downstream and the largest concentration was found in river segment from huainanxia s7 to wujiadu s9 which were close to huainan city and bengbu city the result implied that anthropogenic activities in cities and industrial areas were important sources of phosphorus in the hrb the tp concentration in pore water remained stable in the hr except at wujiadu s9 where tp concentration was extremely high which indicated the contribution of the tributary the gr to the high pollution level in the hr the phosphorus concentration in riverbed sediment was decreased from upstream to downstream and reached the maximum at wujiadu s9 which was consistent with the distribution pattern of phosphorus in pore water in may 2013 however the opposite pattern was observed in june 2016 accordingly phosphorus concentration remained stable from zhengyangguan s1 to huainanshang s6 and increased greatly from huainanxia s7 to mohekou s10 after which it increased at a small rate the average tp concentrations in riverbed sediment at all sampling sites were smaller than 600 mg kg which indicated that the sediment was in unpolluted or slightly polluted level based on the sqgs 3 2 transfer of phosphorus at the swi 3 2 1 transfer process of phosphorus at the swi phosphorus could be transferred from overlying water to riverbed sediment direction i or from riverbed sediment to overlying water direction ii via pore water and the actual transfer direction was determined based on the goodness of fit values of models the observed versus predicted concentrations of phosphorus in pore water were shown in fig 4 where the red line indicated that the predicted concentration values were equal to the observed ones the cor and nse reached higher values for the model in which phosphorus was assumed to be transferred from overlying water to pore water according to the recommendation from moriasi et al 2007 the model was acceptable when the nse value was greater than 0 5 therefore only the model considering the influence of dp in overlying water on tp concentration in pore water was satisfactory nse 0 56 and cor 0 74 which implied that the transportation direction of phosphorus was from overlying water to riverbed sediment in a dissolved phase tang et al 2014 pointed out that dp in pore water played an important role in biochemical reaction between overlying water and riverbed sediment which was consistent with our results the field experiments indicated that sediment in the hr was capable of absorbing phosphorus our result was consistent with wijesiri et al 2019 whose research reported nutrients were more likely to be transferred from water to sediment and confirmed that river sediment could be an effective sink of nutrients in shenzhen river in china increasing flow velocity could increase absorption capacity of sediment particles and accelerate the absorption process which explained that why riverbed sediment absorbed phosphorus pollutants and acted as pollution sink at sampling experiments during wet seasons in the hr from may to august house et al 1995 zhang et al 2011 based on the previous study about the effects of resuspended sediment on phosphorus in surface water in the hrb sediment particles were an important source to tp contaminants in rivers especially during heavy rainfall periods jin et al 2020 despite riverbed sediment still have potentials to absorb phosphorus which seems to mitigate the polluted level however the riverbed sediment would resuspend into surface water during rainfall events then release the sediment bound phosphorus into rivers and cause degradation of water quality the legacy phosphorus stored in river bends or sediment could reduce the retention capacity of sediment and in this case sediment could act as a phosphorus source rather than a phosphorus sink kreiling et al 2020 van meter et al 2018 weigelhofer et al 2018 previous research has suggested the seasonal variability of the effect of sediment on contaminants in rivers ding et al 2018 in a 12 month field study in lake chaohu china yang et al 2020a found that less nutrients were transferred from sediment to overlying water in winter than in summer akbarzadeh et al 2018 found that sediment acted as a nitrite sink in august but as a nitrite source in october in the seine river france the seasonal variations of phosphite were also observed in the lake taihu china han et al 2013 in the study all samples were collected in wet seasons in the hrb from may to july however in order to better understand the potential seasonal effects of sediment on pollution fields samples should also be collected in the dry season in future research in a two year field study in carlyle lake illinois usa shaughnessy et al 2019 found that phosphorus was initially stored in lakebed sediment and then legacy phosphorus was released thus the phosphorus adsorbed by sediment in the hr may release into overlying water in the future which emphasizes the need for continuous field experiments and collection of more sediment samples in the hr in our following research moreover some researchers pointed out that the absorption capacity of sediment to phosphorus was not sufficient to provide buffers against water quality degradation liao et al 2020 more measures should be implemented to reduce the phosphorus concentration in riverbed sediment in the hr such as applying nutrient polluted sediment to produce fertilizers using aluminum modified clay as passivator to fix phosphorus on the sediment surface at the swi and reducing internal nutrient loads braga et al 2019 yang et al 2020b yao et al 2016 3 2 2 determine of the most relative spatial scales in order to determine the most relative spatial scales in which land use affected phosphorus at the swi the goodness of fit bn models direction i about different phases of phosphorus across six spatial scales were evaluated table 3 as land use was assumed to have no effect on pore water pore water models were not included here in summary all models could provide acceptable descriptions on different phosphorus forms in overlying water and riverbed sediment across six river buffer scales for three forms of phosphorus in overlying water the best models were obtained in various river buffer scales namely 1 km scale for tp 2 km for pp and 8 km for dp for tp in riverbed sediment the best explanation of land use to sediment contaminants levels was obtained in 2 km river buffer scale monteagudo et al 2012 declared that the 1 km buffer scale was the most adequate scale in detecting eutrophication in the central spanish rivers which was similar with our result 3 3 influence factors on phosphorus concentration at the swi 3 3 1 effects of natural factors on phosphorus the effects of natural factors including physicochemical conditions of water phosphorus distribution and contamination level in upstream water and sediment on phosphorus concentrations at the swi were analyzed using the models which assumed that phosphorus was transferred from overlying water to riverbed sediment through pore water direction i at the most relevant spatial scales figure s2 table 4 showed that water temperature had negative effects on phosphorus concentrations in overlying water but no effects in pore water and riverbed sediment thus water temperature was not considered in pore water and riverbed sediment models the results contradicted to previous findings that more nutrients could release from sediment at high water temperature zhou et al 2016 and warm weather led to larger and quicker phosphorus releasing from sediment to pore water in rivers wang et al 2013 a possible explanation why no significant effects of water temperature was found may be that all samples were collected in summer with mean water temperatures of 24 3 32 7 c in the study which were higher compared to previous studies 15 c 20 c and 25 c besides the narrow range of water temperature between three sampling experiments in summer could be another reason for no relationship had been captured between water temperature and phosphorus releasing from sediment for phosphorus in overlying water and pore water ph had significant positive influence however its influence on phosphorus in riverbed sediment was negative thus higher ph was favorable for the release of phosphorus from sediment similarly do also had negative effects on phosphorus concentrations in overlying water previous research revealed that aerobic conditions could significantly inhibit the release of nutrients from riverbed sediment to overlying water jingfu et al 2016 nausch et al 2009 studies pointed out that increasing the do level at the swi contributed to control the release of sedimentary contaminants or even turn phosphorus releasing in anaerobic condition to phosphorus absorbing in aerobic condition wang et al 2020a yiqun et al 2003 because of water flowing from upstream to downstream we assumed that phosphorus in overlying water was affected by upstream water moreover sediment would resuspend from riverbed and transport to downstream during flood periods therefore phosphorus in riverbed sediment was also assumed to be affected by contaminant levels in upstream sediment therefore water and sediment from upstream were considered to be potential influence factors in bn models table 4 upstream water was found to be an important source of phosphorus in overlying water especially for pp because of sediment bound phosphorus was the main form of pp it implied that sediment transportation with water was an unignored influence factors on water pollution in rivers thus riverbed sediment from upstream had significant effects on phosphorus polluted level in riverbed sediment of the lower reaches dp in overlying water had positive effects on tp in pore water similarly tp in pore water also had positive effects on phosphorus contaminants in riverbed sediment the result highlighted that sediment including resuspended sediment and riverbed sediment had important effect on phosphorus levels in rivers 3 3 2 effects of anthropogenic activities on phosphorus the effects of anthropogenic activities were evaluated based on land use types in the study we assumed that land use types had effects on phosphorus concentrations in overlying water and riverbed sediment in overlying water the concentrations of tp dp and pp were measured while only tp concentrations were measured in riverbed sediment samples fig 5 showed that farmland was the most important contributor to tp 33 1 in overlying water followed by water 23 3 and rural resident land 22 8 previous research also reported that agriculture derived phosphorus was the major cause of water degradation in rivers hoang et al 2019 mello et al 2018 monteagudo et al 2012 a promising solution to reduce phosphorus loss from farmland is to promote nutrients retention by using sediment trap management and two stage ditches davis et al 2015 kreiling et al 2018 because major part of domestic wastewater was discharged from rural resident land comparing to other kinds of land use human activities in resident land had considerable contribution to phosphorus pollution in rivers wijesiri et al 2019 however grassland and woodland made almost no contribution to tp in overlying water 0 6 and 2 0 farmland still contributed most to dp in overlying water 31 6 followed by urban 25 8 however previous research reported that urban land use was the primary non point pollution source tran et al 2010 xu et al 2020 and more nutrients were discharged into rivers with increasing urban area labeau et al 2014 the effects of grassland and woodland had a little increase and the contribution rates were 4 0 and 6 5 for pp in overlying water farmland was the major source with a contribution rate of about 34 2 which was similar with that for tp and dp in overlying water water and rural resident land were the third most important source with a contribution rate of about 17 the contribution rates of grassland and woodland were similar with that for tp in overlying water but less than that for dp in overlying water woodland and grassland had the potential to mitigate water deterioration because of their capacity to intercept contaminants especially sediment bound contaminants shen et al 2015 sliva and dudley williams 2001 villamizar et al 2020 for tp in riverbed sediment farmland and urban were two main pollution sources whose contribution rates were both greater than 30 it was different to the influence on phosphorus in overlying water where farmland was the most important pollution source and the contribution of urban was less than farmland the contribution of rural resident land to phosphorus in riverbed sediment was about 17 which shown the same influence patterns on phosphorus in overlying water grassland and woodland had the least contribution to phosphorus pollution in sediment 1 4 and 3 4 which were corresponding to results found in overlying water previous research reported similar results that phosphorus concentration in water and sediment particles had negative relationship to woodland in 2 25 km and 4 km river buffer scales respectively houlahan and findlay 2004 in summary farmland was the most important pollution source to three phases of phosphorus in the hr urban and rural residential land were the second and third most important sources of phosphorus in overlying water and riverbed sediment grassland and woodland made a negligible contribution to phosphorus pollution and instead they had the potential to intercept phosphorus transportation from land to waterbody 4 conclusions to better understand distribution patterns and influence factors of phosphorus transfer process at the swi in the hr water and sediment samples were collected in 2013 may 2013 july and 2016 june respectively physicochemical conditions in water and land use both affected phosphorus at the swi moreover phosphorus transfer process also made changes to its concentration values in water and sediment in order to quantify the complex relationship between influence factors and phosphorus contaminants at the swi the bn models were developed comprehensively considering two possible transfer directions the transfer process and most relative spatial scales were determined by models fitness and influence factors could be evaluated subsequently key findings are summarized as follows 1 phosphorus concentration displayed similar spatio temporal distribution patterns in overlying pore water but opposite patterns in riverbed sediment accordingly the concentration was significantly decreased in overlying pore water and increased in riverbed sediment from 2013 to 2016 the concentration reached the maximum around the middle section of sampling area in overlying pore water while it increased consistently from upstream to downstream in riverbed sediment 2 phosphorus was transferred from overlying water to riverbed sediment through pore water and phosphorus in a dissolved phase was the most important pollution source which shed light that sediment had potential to absorb phosphorus contaminates and work as pollution sink 3 upstream water and sediment were important sources of phosphorus in downstream with influence parameters from 0 294 to 0 491 which could not be ignored water temperature and dissolved oxygen had negative effects on phosphorus in water while ph had positive effects on phosphorus in water and negative effects in riverbed sediment 4 the most significant spatial scales that land use affected phosphorus pollution at the swi were different accordingly 1 km 2 km and 8 km river buffer scale for tp pp and dp in overlying water and 2 km river buffer scale for tp in riverbed sediment respectively the result implies that human activities in relatively local scales had more effects on phosphorus pollution in the hr 5 farmland urban and rural resident land were important source to phosphorus at the swi among which the contribution rates of farmland were largest and more than 30 for three phases of phosphorus considered in the study grassland and woodland had the potential to intercept phosphorus transportation from land into rivers especially pp these findings provide the depth understanding of phosphorus patterns at the swi in the hr despite riverbed sediment shown absorption process on phosphorus in our study water sediment samples should be collected in higher frequency especially during dry seasons in following research to analyzed potential seasonal patterns of phosphorus transfer process farmland urban and rural resident land were main pollution sources to phosphorus contaminants in water and sediment in the hr while grassland and woodland could mitigate phosphorus and work as pollution buffer alongside rivers although our study applied the bn models to analyzed phosphorus transfer patterns and influence factors in the hr the field sampling approach and model development process could also be applicable to analyze other kinds of contaminants in polluted rivers credit authorship contribution statement jing xu conceptualization data curation formal analysis funding acquisition investigation methodology software validation visualization writing original draft yuming mo investigation writing review editing hongwu tang funding acquisition project administration resources kun wang methodology software qingfeng ji methodology software pei zhang methodology software you gan wang investigation methodology supervision validation guangqiu jin funding acquisition supervision writing review editing ling li conceptualization supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was supported by the belt and road special foundation of the state key laboratory of hydrology water resources and hydraulic engineering 2021491811 and the natural science foundation of china 51239003 data used in the analysis presented in the paper can be obtained by sending a request to the corresponding author jingq hhu edu cn appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128079 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3181,nowadays there are many papers dealing with the analysis of the soil porous system through x ray computed tomography xct however a reduced number of studies focus on modeling the intrinsic permeability k of complex porous media such as soil based on three dimensional 3d high resolution images the determination of k is fundamental to understanding several processes taking place in soil such as water and air transmission thus this paper compares three xct based methods for estimating the k of the pore system of soil aggregates i finite volume based simulation apes absolute permeability experiment simulation ii image based parametrization of the kozeny carman ibp kc equation and iii pore network model pnm the 3d image considered in the comparison of methods was acquired at the x ray microtomography beamline at the brazilian synchrotron light facility with a voxel size of 1 64 μm apes was considered as a reference method for being less dependent on the configuration of sensitivity parameters apes and pnm demonstrated to be more time consuming than the ibp kc the first taking longer among all for the k computation pnm presented the drawback of higher sensitivity to thin pore ramifications resulting in unrealistic values of k and requiring disconnecting one thinner pore to yield permeabilities comparable to the ones obtained by apes this study demonstrated that a fine alternative to compute k for large image datasets is to calibrate faster methods e g ibp kc and pnm against a slower but more reliable reference method e g apes using at least one 3d image before applying the faster methods on the remaining images of the dataset keywords soil aggregates intrinsic permeability pore tortuosity simulations kozeny carman equation nomenclature symbols and acronyms apes absolute permeability experiment simulation ap surface pore area h length of the aggregate h hydraulic head gradient ibp kc image based parametrization of kozeny carman k intrinsic saturated permeability le curved length equivalent to the distance that would be traversed by fluid elements when moving from one end of a segment to another l chord length the direct distance between the ends of the segment mvp most voluminous pore pnm pore network model r mean segment radius r hydraulic radius µm volume occupied by the pore vp divided by its internal surface area ap vp ap svp sub volume of the image containing only the mvp sv sub volume of the image containing the isolated mvp in addition to the label of solids and background size and location equivalent to those of svp vp volume of the pore space in a given image sub volume va aggregate volume ϕsv sub volume porosity due to the mvp δp pressure drop δ h hydraulic head drop τ tortuosity of each segment le l β shape factor that depends on the geometry of the pore space dimensionless 1 introduction one of the most important resources of the soil is water which is essential for plant growth transport of nutrients and soil structure development without enough amounts of water the soil has no possibility of maintaining adequate crop yield regardless of the management system practices carried out before planting several factors affect the soil water dynamics but its pores characteristics are essential to allow healthy soil conditions hillel 2003 the transport of matter and energy through the soil profile is directly linked to its porous system the former is mainly related to the soil solution movement which contains organic matter gases and minerals javadinejad et al 2019 lal and shukla 2004 thus not only the characteristics of the porous media play an important role in the water dynamics but also the characteristics of the soil solution ostad ali askari et al 2018 kirkham 2014 soil solution viscosity and density will affect the water movement into the soil profile due to its interaction with the minerals and geometric arrangement of soil pores reichardt and timm 2020 the saturated hydraulic conductivity henceforth simply called hydraulic conductivity of the soil refers to its ability to conduct a fluid when all pores are filled with it lal and shukla 2004 this physical parameter is influenced by the attributes of both soil porosity distribution of pore sizes and tortuosity and fluid density and viscosity at specified temperature and pressure for this reason the hydraulic conductivity can sometimes be separated into two factors which are the intrinsic permeability of the soil k and the fluidity of the permeating liquid or gas hillel 2003 from this assumption k refers to the ease with which gases or liquids can pass through a porous material and is controlled by the pore geometry alone provided that the interaction between the fluid and soil matrix does not change the properties of either kilmer and hanson 2018 loll et al 1999 klute and dirksen 1986 on the other hand the fluidity varies with temperature and composition of the fluid if the hydraulic conductivity is given in terms of m s 1 lt 1 then k is in units of m2 l2 and the fluidity is in units of m 1 s 1 l 1t 1 when the fluidity effect is not considered in hydraulic conductivity we simply obtain k hillel 2003 the understanding of the water flow behavior can be obtained through detailed studies of hydraulic conductivity which is commonly employed to determine several phenomena such as infiltration rates drainage processes runoff generation etc gootman et al 2020 ostad ali askari and shayannejad 2020 zhuang et al 2001 traditionally the hydraulic conductivity is measured through different techniques at the lab and field conditions flow cells are utilized for measuring hydraulic conductivity using both the constant and the falling head technique at the lab in field experiments ring infiltrometers are typically employed and they provide a better representation of the soil conditions in the experimental field nevertheless the hydraulic conductivity can be determined from more easily obtainable soil properties such as k which can be estimated from measurements of air and water flow loll et al 1999 changes in soil k induced by cracks big macropores and compaction can significantly affect the water dynamics this happens since k is naturally influenced by both soil texture and structure which can combine to produce very slow to very rapid water infiltrations vanani et al 2017 sheikh and pak 2015 intrinsic permeability and hydraulic conductivity measurements have been usually carried out in disturbed and undisturbed samples with several centimeters in size which reflect mainly the water transport through inter aggregate pores reichardt and timm 2020 lal and shukla 2004 however it should be recognized that these properties vary across the soil profile and spatial scales and thus can be different in centimeter sized samples comprising inter and intra aggregate pores in relation to micro aggregate samples comprising only intra aggregate pores in this way intra aggregate pores play an important role in water transport and their geometrical characteristics will affect the water dynamics especially at the microscale ostad ali askari and shayannejad 2021 masís meléndez et al 2014 a side remark is that the importance of complementary research on the arrangement of pores and soil aggregation has been recently stressed by koestel et al 2021 nowadays with the advent and evolution of techniques of three dimensional 3d image acquisition such as x ray computed microtomography xct it is possible to obtain high quality images with reasonable resolutions that permit to study the soil pore architecture galdos et al 2020 ferreira et al 2019 ferreira et al 2018 the 3d characterization of the soil pore system allows identifying individual pores or bunches of pores that rule the water dynamics oliveira et al 2021 menon et al 2020 schlüter et al 2020b pires et al 2019 gharedaghloo et al 2018 the combination of the information obtained through image based analysis techniques associated with water dynamic concepts e g poiseuille darcy kozeny carman equations can help to understand different phenomena taking place in the soil as well as to measure important soil characteristics such as its k and hydraulic conductivity daly and roose 2014 although there are many studies reporting xct based k estimation for different porous media these types of investigations are still scarce in the porous media field at the microscale and they offer means for a better understanding of soil hydraulic properties across different scales zhang et al 2021 the need for understanding how microscopic pore scale scale of μm properties affect the macroscopic properties of the rhizosphere scale of mm has been highlighted years ago in roose at al 2016 more recently schnepf et al 2022 recognized that processes such as water and nutrient uptake rhizodeposition and microbial activity act on more than six orders of magnitude from the rhizosphere processes that typically occur between 1 µm and 1 mm to the management scale 1 m these authors presented different modelling scenarios using xct to integrate rhizosphere processes into a plant scale and soil profile scale modelling concept simulations can predict in combination with high quality images the water flow in different groups of connected pores schlüter et al 2020a gharedaghloo et al 2018 more specifically several studies can be found in which the k of a porous medium is computed by finite volume and lattice boltzmann based simulations gerke and karsanina 2021 zhang et al 2021 scheibe et al 2015 khan et al 2012 skeletonization algorithms can be used to derive the tortuosity of a porous medium soto gómez et al 2020 ngom et al 2011 which can in turn be used to estimate k based on the well known kozeny carman equation zhang and schaap 2019 yet algorithms of pore network modeling allow the k estimation based on numerical simulations applied on models of pore bodies and throats zhang et al 2019 the mentioned methods to derive k present the potential to be used in multiscale models focused on characterizing the transport of water in the soil however these methods vary in terms of accuracy and computational processing time for example in pore network modelling the computational cost and consequently the time compumption is reduced by assuming a simplified geometry of pores that may neglect important pore scale phenomena while direct simulations solve equations directly on the imaged geometry roose et al 2016 therefore when one wants to compute k for a large dataset of soil images e g large number of repetitions for different soil treatments targeting good statistics information some pros and cons of each method may be taken into account before deciding on one of them thus this study aimed at comparing three xct based methods to determine the k of the pore system of a soil aggregate which is remarkably heterogeneous i finite volume based simulation apes absolute permeability experiment simulation ii image based parametrization of kozeny carman ibp kc equation and iii pore network model pnm among the considered methods apes is the less dependent on the configuration of sensitivity parameters and for this reason was assumed as a reference method the relevance of the proposed study lies in the fact that it brings a way of calibrating less computational demanding and therefore faster methods ibp kc and pnm whose sensitivity parameters are non trivial to configure especially for heterogeneous porous media this allows simpler but accurate k computation which is important for analyses of large 3d image datasets including many repetitions and treatments the proposed comparison was accomplished through 3d synchrotron based x ray computed tomography srxct analyses at the micrometer scale 2 material and methods 2 1 sample collection the soil sample utilized in this study was collected in an experimental field in the agronomic institute of paraná farm located in the municipality of ponta grossa state of paraná brazil 25 09 s 50 09 w 875 m a s l the soil was classified as clayey 58 clay 28 silt and 14 sand according to the usda textural classification system hillel 2003 according to the classification presented by the soil survey staff 2013 the soil is a rhodic hapludox oxisol the experimental site of this study was initiated in 1981 and consisted of a no tillage management system borges et al 2019 passoni et al 2015 de moraes sá et al 2015 the area under no tillage was not submitted to soil disturbance the crops grown in this area were corn zea mays and soybeans glycine max in the summer period oats avena strigosa or wheat triticum aestivum l and vetch vicia sativa in winter for soil and crop management sowing and harvest were utilized tractors soil samples were collected at the topsoil 0 10 cm as small monoliths volumes between 50 and 100 cm3 prior to srxct analysis these samples were manually disaggregated carefully breaking them apart then the small aggregates were dry sieved through a 19 mm sieve for homogenization after that these aggregates were passed through a 4 mm sieve and retained on a 2 mm sieve in the present work one aggregate 3 mm diameter has been considered for 3d image acquisition and evaluation of the three computational methods for k estimation 2 2 image acquisition and segmentation a 3d image of the described soil aggregate was generated at the x ray microtomography beamline imx at the brazilian synchrotron light laboratory brazilian center for research in energy and materials lnls cnpem it is important to mention that this single aggregate is part of a larger set of aggregates coming from different management systems at the aforementioned farm that integrated an experimental proposal at imx beamline however given the objective of comparing three computational methods only one aggregate 3d image has been considered in the present study the sample was scanned using a 1 67 t bending magnet radiation source from the 1 37 gev uvx storage ring filtered by a 550 μm thick si filter and 1 024 projections were acquired over 180 rotation of the sample the detection system was composed of a 50 μm thick scintillator luag ce and a pco 2000 camera with a 5x objective the exposure time for each projection was 2 s and the total scan time per sample was 35 min the image reconstruction was performed by applying an in house filtered back projection based algorithm miqueles et al 2018 the reconstructed images were 16 bit raw type with a maximum array of 2 048 2 048 2 048 voxels and a voxel size of 1 64 μm resulting in image volumes of 3 36 3 36 3 36 mm3 each as a consequence of the projection imaging geometry the geometric resolution σr of the generated image can be defined as the variance of the point spread function psf of the imaging system according to eq 1 bartels 2013 gureyev et al 2008 1 σ r 1 1 m 2 σ s 2 1 m 2 σ d 2 where σs and σd represent the standard deviations of the source intensity distribution and the detector psf respectively which were considered here for simplicity as the nominal source size σs 919 228 µm2 horizontal vertical and the pixel size of the detector σd 1 64 µm respectively m is the geometric magnification m 1 z 2 z 1 which in turn depends on the source to sample z1 16 700 mm and sample to detector z2 40 mm distances for more detailed definitions please consult villarraga gómez and smith 2022 and stolfi et al 2017 in the present case the magnification is 1 due to the very large z1 and very small z2 distances therefore the influence of the source size on the geometric resolution is minor and the pixel size of the detector is the critical limitation it should be noted that the geometric magnification of the image varies with z1 and z2 distances because the x ray beam of imx beamline was quasi parallel i e it had a low divergence of 1 7 0 28 mrad thus the horizontal vertical estimated image resolution was 2 74 1 72 µm2 the image segmentation was based on machine learning allied with a traditional local segmentation for the machine learning steps an in house software named annotat3d was used which is based on high performance computing techniques spina et al 2018 vasconcelos et al 2018 in house software i e developed at lnls cnpem and currently accessed by lnls users only the following steps were conducted i image filtering to smooth noise non local means filter in gpu adaptive manifold 3d mode spatial standard deviation 1 intensity standard deviation 0 3 search window 10 voxels local neighborhood 5 voxels and enhance edges unsharp mask edge size 4 voxels edge contrast 0 7 brightness threshold 0 fig 1 a ii background segmentation using thresholding and erosion dilation tools until reaching seeds at the background and aggregate as in fig 1b followed by watershed method beucher and lantuejoul 1979 fig 1c iii choice of machine learning parameters feature extraction all filters selected superpixels seed spacing and compactness values were set to 3 and 10 respectively and classifier random forest with 200 trees vasconcelos et al 2018 iv declaring the phases background solid matrix and pores v adding annotations for the three phases in different slices of the srxct image fig 1d vi training and running the classifier and vii define seeds based on the labels resulting from this process fig 1e and run a final watershed segmentation fig 1f steps i ii and vii were performed using the avizo software v 2019 fei 2019 2 3 image analyses 2 3 1 preparation of image and general definitions the segmented image was first submitted to basic quantifications of pore areas and volumes and the identified pores are presented in fig 2 a with random association of colors after that the pores were colorized by volume resulting in a 3d rendering of the soil pore system with different pore volumes portrayed in a specific color code fig 2b the most voluminous pore mvp represented in blue in fig 2b was filtered from the remaining pores and a sub volume of the image containing only this pore henceforth named svp was extracted size in x y and z coordinates 1 948 2 796 1 760 µm3 fig 2c it is important to mention that the svp was selected such that its walls crossed the mvp at its edges in x y and z coordinates because this guarantees that there is pore continuity through the three orthogonal directions to support further analyses a map of local 3d thickness hildebrand and rüegsegger 1997 across the mvp was computed a sub volume equivalent to svp was selected containing the isolated mvp in addition to the label of solids and background sv fig 2d aiming to account for the correct porosity in sv the volumes associated with each label pore solids and background were computed the sv porosity due to the mvp ϕsv was then calculated as the ratio between the pore volume vp and the aggregate volume va the sum of the pore and solid volume contained in sv for the steps described in this section the avizo software s modules named label analysis colorize by measure sieve analysis volume fraction and thickness map were used 2 3 2 application of three different methods for the intrinsic permeability k estimation of a soil aggregate 2 3 2 1 finite volume based simulation the numerical simulation implemented in the avizo software as a module named absolute permeability experiment simulation apes determines the k associated with each flow direction kz y x of the porous medium under study in this case a soil aggregate the stokes equations are first solved by a finite volume method fei 2019 harlow and welch 1965 for velocities and pressures in the system v 0 2 μ 2 v p 0 where and 2 are divergence gradient and laplacian operators respectively p is the pressure v is the velocity and µ is the dynamic viscosity of the fluid this equation system is a simplification of the navier stokes equations and considers the following assumptions incompressible fluid i e constant density newtonian fluid i e constant dynamic viscosity steady state flow i e constant velocity over time and laminar flow i e the velocities are small enough not to produce turbulence once this equation system is solved darcy s law is applied to estimate k baychev et al 2019 fei 2019 darcy 1856 3 q s k μ δ p l where q is the global flow rate that goes through the porous medium m3 s 1 s is the cross section of the sample which the fluid goes through m2 k is the absolute permeability m2 µ is the dynamic viscosity pa s δ p is the pressure difference applied across the sample pa and l is the length of the sample in the flow direction m the boundary conditions for apes are i one voxel rigid walls are added on the faces of the image that are parallel to the main flow direction i e no flow out of the system occurs across the walls ii no slip condition at fluid solid interfaces iii experimental setups representing an inlet and an outlet are added on the faces of the image that are perpendicular to the main flow direction through which the fluid is injected and released respectively iv two among three conditions input pressure output pressure and flow rate can be chosen by the user the third being estimated from the previous two fei 2019 the great advantage of apes is that k is computed directly from the segmented binary image in this case svp provided that it presents pore continuity between the inlet and outlet of the flow the two chosen boundary conditions were the input and output pressures which were set to represent pressure drops δp of 860 1366 and 952 pa for the fluid flow directions z y and x respectively δp was defined so that a hydraulic head gradient h equal to 50 was stablished over the length of the aggregate h in each direction according to eq 4 4 h δ h h bh h b f o r b 50 where δ h represents the hydraulic head drop between the inlet and outlet of the flow in each direction as exemplified in fig 2e for the z direction thus δp corresponds to δh values m converted to pressure values pa as required by the simulation interface the considered fluid viscosity was that of the water 0 001 pa s and the convergence criterion henceforth called error for the simulation was set to 1 10 7 the max number of iterations in each direction was adjusted to reach a situation where the time derivatives of the unknown which are involved in the error computation would tend to be 0 fei 2019 the error computation at each iteration is based on the velocity vector the pressure field the time step and an artificial compressibility coefficient fei 2019 it is important to mention that the kz y x estimation by apes is independent from the boundary conditions pressure drops and from the fluid viscosity only the velocity and pressure fields are rescaled according to the indicated values fei 2019 therefore h 50 was an arbitrary choice aimed to provide consistent comparison of the velocity field among orthogonal flow directions considering that the error associated with the number of iterations is the only input parameter in the present method that actually affects the estimation of kz y x and that a criterion for that is well stablished apes was assumed as a reference method the mentioned criterion is that the number of iterations for each direction should be defined considering that the computation should not need more than 100 000 iterations and the oscillations should not remain beyond 500 iterations fei 2019 supplementary movie 1 and supplementary information 1 illustrate some of the methodological steps described so far gray scale image slicing 3d rendering of segmented pores mvp selection and apes analysis 2 3 2 2 image based parametrization of kozeny carman equation ibp kc the intrinsic permeability can be derived from the well known kozeny carman equation zhang and schaap 2019 brooks and corey 1966 carman 1937 kozeny 1927 5 k ϕ sv r 2 β τ 2 ϕ sv v p a p 2 β τ 2 where ϕsv is the sv porosity due to the mvp previously defined r is the hydraulic radius µm β is a shape factor that depends on the geometry of the pore space dimensionless and τ is the tortuosity of the medium r is originally defined as the cross sectional area normal to the flow through a straight tube divided by the wetted perimeter however if the pore space is thought for mathematical purposes as a tube of nonuniform cross sections the hydraulic radius is assumed to be the volume occupied by the tube divided by its internal surface area brooks and corey 1966 therefore for this analysis r was considered as the ratio of the pore volume vp to the surface pore area ap both properties were computed for the svp image using the label analysis module in avizo for irregular cross sections the numerical constant β should be between limit values of 2 and 3 which are valid for flow through a small capillary tube and for flow over an infinite flat plate thin film respectively brooks and corey 1966 therefore an average β of 2 5 was assumed for the present analysis the τ of the medium was derived by a skeletonization method briefly explained as follow the centerline tree module available in the avizo software is based on the teasar algorithm proposed by sato et al 2000 it reduces complex 3d structures of varying local thicknesses to a set of segments that represent the skeleton of such structure the input file for this module was the svp image fig 2c three valued parameters were adjusted slope and zeroval which are tube parameters were set to 5 and 4 respectively while the number of parts was set to 70 the choice on the values for the mentioned parameters aimed at achieving a pore skeleton that would visually resemble the original pore avoiding too many small branches exiting the main segments besides generating the graph containing the pore skeleton for visualization this module also provided the τ and mean radius associated with each segment of the skeleton the module computes the τ of each segment as the ratio between its curved length le equivalent to the distance that would be traversed by fluid elements when moving from one end of the segment to another and chord length l the direct distance between the ends of the segment 2 3 2 3 pore network model pnm the input file for a pnm algorithm is a pore space that has been geometrically partitioned separated youssef et al 2007 this pore separation should be efficient at delimiting the regions that better represent the pore bodies and pore throats the open source algorithm named pnextract which is based on distance map computation and medial axis transformation of the 3d pore space was applied to perform the pore separation bultreys et al 2018 raeini et al 2017 dong and blunt 2009 website for download https github com aliraeini pnextract the pnextract algorithm was configured to deliver the pore mvp in svp separation that was visually the most reasonable when compared with the original pore the sensitivity parameters used for this configuration are shown in table 1 according to the pnextract guide the parameter rmedsurfnoise is a measure of noise amplitude and increasing it decreases the number of separated pores the file resulting from the pore separation named velems tif extension was then loaded into avizo converted from 32 bit signed to 16 bit label and submitted to the pnm algorithm implemented in this software which was inspired by youssef et al 2007 the algorithm generates a lattice of spheres and cylinders representing a model of pore bodies and throats respectively in addition it determines the pore and throat radii frequency distribution with the image resolution limiting the lower detectable radii the coordination number i e number of connected neighbors and pore volumes by enabling the pnm s generate properties function a numerical simulation assuming laminar flow is performed leading to the computation of kx y z and τx y z of the extracted pore network model the pnm simulation assumes that the network is filled with only one phase and that the flow is laminar everywhere poiseuille flow under these conditions the relation between pressure drop and flow rate is linear 6 q ij g ij p i p j where q ij is the flow rate between pore i and j g ij is the hydraulic conductance of the throat between pore i and j p i and p j represent the pressure in pore i and j respectively mass conservation applies for each pore body and is described as 7 i j q ij 0 where the summation is performed on all pores j connected to the pore i in addition assuming that the conducting throats are represented by cylindrical pipes of radius r ij and length l ij g ij is given by poiseuille s law 8 g ij π 8 μ r ij 4 l ij where µ is the dynamic viscosity pa s as described before thus by imposing a pressure difference across the network a linear system of equations describing flow and pressure fields is numerically solved by an iterative bi conjugate gradient method for more details please consult fei 2019 youssef et al 2007 and laroche and vizika 2005 the global flow rate q across the pore network of length l is then calculated from the contributions of each throat q ij on a cross sectional area s and k is finally deduced from darcy s law eq 3 moreover the hydraulic tortuosity is computed by summing up the length of all velocities deduced from the k computation divided by the sum of the projection of the velocities along the flow direction fei 2019 the pnm module in avizo requires the selection of the flow direction z y x and δp inlet pressure outlet pressure as a parameter the considered δp values were the same as those assumed for the apes and in the present analysis the k estimation is also independent from the boundary conditions only flow rates are rescaled according to the indicated values fei 2019 the resulting kx y z values determined by the pnm were compared with the ones obtained by the apes to confirm that the sensitivity parameters considered when applying the pnextract algorithm worked well for the pore separation this is due to the fact that fei 2019 avizo user s guide recommends tuning the pnm to obtain the same value of k using another method such as apes on the same sample 3 results the values determined for vp va and ϕsv were 1 27 108 μm3 7 91 109 μm3 and 0 02 respectively the thickness map of the isolated pore mvp in svp is shown in fig 3 a c e within the limits imposed by the inlet and outlet openings from the apes which considers water injection in the z y and x directions respectively it is seen from these figures that only few thicker regions represented from red to yellow in the thickness scale exist through the pore with the majority of regions characterized by thin apertures represented from green to blue table 2 shows the parameters tested for apes as can be seen in fig 4 the error curves as function of the number of iterations resulting from apes vary among the tested flow directions for the z and y directions the first error stability 6 10 6 that remained over 500 iterations and provided realistic kz and ky values i e positive k values occurred with 107 000 iterations table 2 for the x direction this condition occurred with less iterations 84 000 according to the k values determined by apes the pore medium was more permeable in the x than in the y direction and the z direction was the less permeable of all although the values are just slightly different table 2 one of the apes outputs is the velocity field which is a part of the solution to the stokes equation system eq 2 solved in the geometry defined by svp fei 2019 the resulting velocity field for each flow direction is shown in fig 3b d f as can be seen from these figures the flow direction x that presented the highest k by apes table 2 also presented the lowest maximum velocity fig 3f on the other hand although k was higher for the y than for the z direction table 2 y has presented the highest maximum velocity among the three directions this is likely due to the very thin channel at the bottom of the y flow fig 3d which is the only flow entrance path fig 5 b shows the pore skeleton generated for the mvp in svp with a color code attributed to the mean segment radius the locations of the thicker segment regions and the radius scale resulting for the pore skeleton in fig 5b are in agreement with the thicker regions and thickness scale identified for the thickness map in fig 5a the values of ap r mean τ and k were respectively 2 06 107 µm2 6 14 µm and 1 63 which led to a k of 0 09 µm2 as determined by ibp kc the result of the pore separation is presented in fig 5c in which different colored regions delimit the separated pores within the original pore structure the kz value obtained via pnm in close proximity to the one found by apes table 2 for the x flow direction the pnm provided a lower kx than apes but in the same order of magnitude which was considered acceptable for the y flow direction the pnm provided a ky value much lower than apes indicating that the former simulation was more sensible to the very thin ramification at the right side of the pore shown in fig 5 to test this hypothesis the separated pore fig 5c was cropped only to eliminate the thin ramification and was re submitted to the pnm module resulting in similar values for kz and kx but in a much more comparable value of ky in relation to apes respective value table 2 pnm to make sure that this comparison was valid the same cropped pore was also re submitted to apes with flow in y direction and the result ky 0 024 µm2 was very close to the original one table 2 this is an evidence that the pore separation worked reasonably well from the τ frequency distribution determined by the skeletonization fig 6 a it is seen that the mean τ considered for the k estimation by ibp kc is close to the most frequent value with few segments presenting much more tortuous paths in addition the coordination number frequency distribution determined by the pnm fig 6a shows that the lowest and highest pore connectivity coordination number 0 and 8 respectively is achieved only by few pores a simple linear correlation analysis showed a positive relationship between the coordination number and pore eq radius data r 0 81 i e higher coordination numbers occurred for pores of larger eq radii which can also be visually identified from fig 5d in other words a few large pores constituting the considered porous structure are the ones governing the connectivity through the medium camargo et al 2022 lucas et al 2021 ferreira et al 2019 jarvis et al 2017 4 discussion 4 1 k values estimated by the three tested methods the mean k determined for the studied soil aggregate by apes 0 037 µm2 and pnm 0 034 µm2 methods were very close table 2 and slightly lower than the value determined by the ibp kc 0 090 µm2 moreover the mean τ determined by the pnm 1 64 table 2 and by the teasar algorithm for skeletonization 1 63 were in close agreement it should be noted that the convergence of the three applied methods was only possible because of the careful decision on the algorithms parameters apes method can be considered a more reliable method for k estimation for being less dependent on the configuration of sensitivity parameters i e k is computed directly from the segmented pore space without any intermediate manipulation of the image on the other hand both the pnm and the ibp kc methods depend on a step of image manipulation in this study only the parameters that led to convergent results among methods were presented e g table 1 for pore separation in pnm tube parameters and number of parts for skeletonization in ibp kc section 2 3 2 2 the separation of pores directly impacts the simulation performed in pnm to estimate k in general the visual comparison between fig 5c and fig 5a shows that a reasonable separation was achieved with the pnextract algorithm attempts were performed aiming to apply the separate objects module available in the avizo software for the same purpose of the pnextract algorithm however less realistic pore separation was obtained with the former approach no matter the sensitivity parameters used resulting in an over or under separation of pores with no resemblance with the visually identified pore bodies and throats in the original pore structure the skeletonization influences the τ values that are considered in eq 5 to calculate k the visual comparison of the resulting pore skeleton with the thickness map fig 5a b leads to conclude that the selection of the tube parameters and number of parts for the teasar algorithm was efficient at detecting a representative pore skeleton where remarkable loops of the pore were kept and the majority of the branches follow the original pore morphology zhang et al 2019 performed a similar investigation comparing three methods for k estimation of sandstone core samples and they found that apes results deviated above 1 µm2 from pnm s results the mentioned authors analyzed sandstone core samples which present much more homogeneous pore architecture than soil with a known average sand grain diameter this evidences the value of the convergent results among methods presented here it should be emphasized that only one soil aggregate was investigated here because the focus was to develop strategies to work with the three proposed methods in a compatible way to serve as an example for potential applications we do not intend to convey that a single aggregate represent the soil layer in which it has been collected in fact the comparison of methods presented is destined to those who desire to apply them or one of them to actual datasets containing repetitions and representing a soil or a specific scale of such soil moreover although the methods and calibration of its parameters have been tested for a single soil aggregate the strategies could well be performed for xct images of larger samples capturing inter aggregate pores instead of or in addition to intra aggregate ones depending on the spatial resolution however as recently recognized by zhang et al 2021 most macroscopic phenomena measured in soil emerge from biogeochemical and physical processes occurring at the microscopic scale which justifies the relevance of characterizing the water transport in soil aggregates as a complement to studies in bulk soils 4 2 pros and cons of the three tested methods in terms of advantages and disadvantages of each method it should be recognized that although apes is considered a more reliable method for k estimation for reasons stated before it is the most time consuming of all taking 48 h to reach the number of iterations presented in table 2 therefore it might be not feasible for a large dataset multiple images the step of pore separation pnextract that is required as input for pnm took 2 h thus testing different parameters table 1 until reaching a decent pore separation can become more time consuming than expected and still be impractical for large datasets the pnm itself which generates the lattice of pore bodies and throats and performs a numerical simulation on it to estimate k was quick with almost instantaneous return nevertheless the pnm presented the disadvantage of being more sensitive to thin ramifications of the pore system providing in this case unrealistic values of k and demanding further cropping of the image to avoid this undesirable effect the ibp kc was the quicker method taking only a few minutes to compute all required image derived data the teasar algorithm used for skeletonization in ibp kc which provided the τ values was fast and easy to test different input parameters however a downside of it is that the τ is found from a distribution of values associated with the identified segments of the skeleton i e it does not specify τ for a given direction the pnm in turn specifies τ for different directions and their values can be used in ibp kc according to the targeted analysis for reference the reported computation times for each method was accomplished in a high performance computing server model intel xeon gold 6130 cores 32 memory 512 gb although the pore separation performed by the open source algorithm pnextract relies on a medial axis transformation raeini et al 2017 which is a type of skeletonization the strategy is different from that used in the teasar algorithm tree structure extraction algorithm for skeletonization sato et al 2000 used to compute the tortuosity for the ibp kc nevertheless the distribution curves of the pore eq radius from pnm analysis and the mean segment radius from teasar algorithm for skeletonization show a similar shape with a tendency to a bimodal distribution fig 6b the similarity of the distributions between the methods shows that both analyses are sensitive to the physical characteristics of the pore system however pnm was more sensitive to macropores pore eq radius 50 μm which is probably related to the nature of each method of analysis pnm approaches the separated pores to spheres before determining their eq radius while the skeletonization based on teasar algorithm finds distances from pore boundaries to its defined tree structure skeleton 4 3 potential applications of the three tested methods according to klute and dirksen 1986 the k values obtained here in the order of 10 10 cm2 lie in the limit of applicability of the constant head experiment analogous to the apes simulation traditionally performed to measure soil hydraulic conductivity the 10 10 cm2 range is associated with mixtures of sand silt and clay typically loess loam material right between fine sand and structured clay material klute and dirksen 1986 moreover this range of k translates into the 10 5 cm s 1 hydraulic conductivity range which is classified as the limit between low and very low and typical of clayey soils klute and dirksen 1986 horn 1990 these are in accordance with the material considered in the present study which consists of a small soil aggregate from a clayey textured soil the average water velocity is a function of the flux density and the soil water content in no saturate conditions jury and horton 2004 thus changes in both these properties will influence the average water velocity as a function of k however the use of properties such as flux density porosity and soil water content cannot be alone good parameters to infer about the water dynamics in complex pore systems such as soils because differences in the pore architecture will have a greater impact on the velocity than the parameters aforementioned liu and jeng 2019 perfect and sukop 2001 as could be observed from the velocity fields resulting from apes fig 3b d f for example soils with numerous narrow pores can have lower permeabilities even having high porosities as compared to soils with lower porosities but comprised of larger pores giatman et al 2019 hillel 2003 therefore several other factors related to the architecture of the pores will affect the water flow such as the continuity size and shape distribution of the pores and tortuosity tötzke et al 2017 vogel and roth 2001 the pnm allowed having some insight into the internal characteristics of the soil pore system in 3d during water infiltration the transport of the water through the soil profile occurs in different directions inoue et al 2018 fang et al 2016 if we suppose that the unique directions possible for the water to flow are those of the cartesian coordinate system which is an approximation of the reality we can have an idea about the isotropy of the soil pore system when the water flux is analyzed in the x y and z directions pulido moncada et al 2021 hillel 2003 the results presented here table 2 show that the porous medium studied is anisotropic kx ky kz mainly due to the complexity of the pore size and shape distributions in clayey soils recently pires et al 2020 and galdos et al 2020 demonstrated through 3d image analysis the complexity of the soil pore system in terms of shape and size distributions of pores in clayey soils from tropical regions like the soil studied in our work these authors demonstrated that geometrical and topological soil pore properties are greatly influenced by changes in the soil pore system which have direct impact in water dynamics and root development they also investigated the degree of anisotropy and tortuosity in different directions to verify irregularities in the distribution of pores in tropical soils the bimodality tendency observed in the distribution curves presented in fig 6b can be an indication of the soil structure quality according to the study of kutílek 2004 aggregated soils are characterized by differences between textural and structural pores the latter being associated to the shape orientation and arrangement of soil aggregates thus when the soils have more than one peak in pore size distributions this is an indication of structured soils pires et al 2017 kutílek et al 2006 cássaro et al 2011 working with tropical soils from the same experimental site of the study presented here demonstrated the multimodality of the soil pore system for no tillage and conventional tillage systems based on experimental water retention curves corroborating our results based on 3d image analysis although the instructions of both apes and pnm stated clearly that the methods were independent of the boundary conditions tests were performed varying the δp values but indeed this did not change the resultant k values the sensibility to δp variation would be interesting however to evaluate the moment when the flux ceases to vary linearly with the hydraulic gradient condition for darcy s law validity where the slope of such linear relationship is the k that is the transition from laminar to turbulent flow klute and dirksen 1986 furthermore although traditional laboratory measurements were not performed for comparison it is known that aggregates tend to present lower k and hydraulic conductivities than bulk soil due to the hierarchical soil formation vogel 2019 horn 1990 this opens opportunity for studies aimed at linking information of k and hydraulic conductivity across scales this study raised some outstanding future perspectives given the latest technical and scientific advances for instance the substantial increase in spatial resolution coupled with zoom capability of srxct in 4th generation synchrotrons ferreira et al 2022 hesterberg et al 2022 are expected to aid in analyses such as those of fig 6b this figure shows high frequency of pores that are in the limit of the spatial resolution achieved in a 2nd generation synchrotron indicating that with higher resolution perhaps a peak would be defined improving the image based characterization of pore size distributions in addition higher spatial resolution could reveal that the mvps found with the current conditions are larger connected to other large pores through thin throats that were not captured here moreover associating high spatial and temporal resolutions high throughput opens paths to compare larger number of samples from different treatments e g soil managements which provides higher statistical confidence when comparing different treatments besides the high throughput capability also enables time resolved experiments meaning that the type of study performed here by means of computational simulations could be experimentally performed in the form of an in situ experiment at a srxct beamline in situ experiments in turn may provide richer information that can be applied to further improve fluid flow simulations and modelling 5 conclusions this study showed that it was possible to optimize the performance of three different computational methods to determine the intrinsic permeability k of the pore system of a soil aggregate the absolute permeability experiment simulation apes was considered as a reference method since it is less dependent on the configuration of sensitivity parameters in comparison with the image based parametrization of the kozeny carman ibp kc equation and pore network model pnm apes and pnm methods required higher computational power and were more time consuming in the case of the pnm the more time consuming step was the pore separation performed by the pnextract algorithm the pnm presented the disadvantage of being more sensitive to thin ramifications of the pore system providing in this case unrealistic values of k and demanding further cropping of the image to avoid this undesirable effect the ibp kc was found to be a quick and reliable method if carefully configured a good balance of accuracy and time consumption for xct srxct based k estimation in large image datasets is to first calibrate faster methods e g ibp kc and pnm against a reference method e g apes for one image and then rely on the faster methods for computation on the remaining images these faster methods favor xct based analyses of soil k that are targeted at large datasets of 3d i e many treatments and repetitions and 4d time plus space images moreover the steps presented here can be easily extended to studies of soil hydraulic conductivity since it can be determined from k and the fluid properties viscosity and density therefore we can conclude that although our analysis was carried out for only one pore system sample the steps presented here have great potential to understanding how the pore architecture influences dynamic processes in the soil credit authorship contribution statement talita r ferreira conceptualization methodology software validation formal analysis investigation data curation writing original draft writing review editing visualization nathaly l archilha conceptualization methodology resources writing review editing luiz f pires conceptualization methodology resources writing original draft writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research used facilities of the brazilian synchrotron light laboratory lnls part of the brazilian center for research in energy and materials cnpem a private non profit organization under the supervision of the brazilian ministry for science technology and innovations mcti proposal 20180217 the imx beamline staff is acknowledged for the assistance during the experiments and the tepui group is acknowledged for the assistance on the use of the high performance computers dr jocenei a t de oliveira dr tseng c ling and dr aline m h dos reis are acknowledged for their help in the image acquisition and dr jadir a rosa for his support in the experimental sites lfp would like to acknowledge the brazilian national council for scientific and technological development cnpq grants 304925 2019 5 and 404058 2021 3 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128024 appendix a supplementary data the following are the supplementary data to this article supplementary video 2 supplementary data 1 
3181,nowadays there are many papers dealing with the analysis of the soil porous system through x ray computed tomography xct however a reduced number of studies focus on modeling the intrinsic permeability k of complex porous media such as soil based on three dimensional 3d high resolution images the determination of k is fundamental to understanding several processes taking place in soil such as water and air transmission thus this paper compares three xct based methods for estimating the k of the pore system of soil aggregates i finite volume based simulation apes absolute permeability experiment simulation ii image based parametrization of the kozeny carman ibp kc equation and iii pore network model pnm the 3d image considered in the comparison of methods was acquired at the x ray microtomography beamline at the brazilian synchrotron light facility with a voxel size of 1 64 μm apes was considered as a reference method for being less dependent on the configuration of sensitivity parameters apes and pnm demonstrated to be more time consuming than the ibp kc the first taking longer among all for the k computation pnm presented the drawback of higher sensitivity to thin pore ramifications resulting in unrealistic values of k and requiring disconnecting one thinner pore to yield permeabilities comparable to the ones obtained by apes this study demonstrated that a fine alternative to compute k for large image datasets is to calibrate faster methods e g ibp kc and pnm against a slower but more reliable reference method e g apes using at least one 3d image before applying the faster methods on the remaining images of the dataset keywords soil aggregates intrinsic permeability pore tortuosity simulations kozeny carman equation nomenclature symbols and acronyms apes absolute permeability experiment simulation ap surface pore area h length of the aggregate h hydraulic head gradient ibp kc image based parametrization of kozeny carman k intrinsic saturated permeability le curved length equivalent to the distance that would be traversed by fluid elements when moving from one end of a segment to another l chord length the direct distance between the ends of the segment mvp most voluminous pore pnm pore network model r mean segment radius r hydraulic radius µm volume occupied by the pore vp divided by its internal surface area ap vp ap svp sub volume of the image containing only the mvp sv sub volume of the image containing the isolated mvp in addition to the label of solids and background size and location equivalent to those of svp vp volume of the pore space in a given image sub volume va aggregate volume ϕsv sub volume porosity due to the mvp δp pressure drop δ h hydraulic head drop τ tortuosity of each segment le l β shape factor that depends on the geometry of the pore space dimensionless 1 introduction one of the most important resources of the soil is water which is essential for plant growth transport of nutrients and soil structure development without enough amounts of water the soil has no possibility of maintaining adequate crop yield regardless of the management system practices carried out before planting several factors affect the soil water dynamics but its pores characteristics are essential to allow healthy soil conditions hillel 2003 the transport of matter and energy through the soil profile is directly linked to its porous system the former is mainly related to the soil solution movement which contains organic matter gases and minerals javadinejad et al 2019 lal and shukla 2004 thus not only the characteristics of the porous media play an important role in the water dynamics but also the characteristics of the soil solution ostad ali askari et al 2018 kirkham 2014 soil solution viscosity and density will affect the water movement into the soil profile due to its interaction with the minerals and geometric arrangement of soil pores reichardt and timm 2020 the saturated hydraulic conductivity henceforth simply called hydraulic conductivity of the soil refers to its ability to conduct a fluid when all pores are filled with it lal and shukla 2004 this physical parameter is influenced by the attributes of both soil porosity distribution of pore sizes and tortuosity and fluid density and viscosity at specified temperature and pressure for this reason the hydraulic conductivity can sometimes be separated into two factors which are the intrinsic permeability of the soil k and the fluidity of the permeating liquid or gas hillel 2003 from this assumption k refers to the ease with which gases or liquids can pass through a porous material and is controlled by the pore geometry alone provided that the interaction between the fluid and soil matrix does not change the properties of either kilmer and hanson 2018 loll et al 1999 klute and dirksen 1986 on the other hand the fluidity varies with temperature and composition of the fluid if the hydraulic conductivity is given in terms of m s 1 lt 1 then k is in units of m2 l2 and the fluidity is in units of m 1 s 1 l 1t 1 when the fluidity effect is not considered in hydraulic conductivity we simply obtain k hillel 2003 the understanding of the water flow behavior can be obtained through detailed studies of hydraulic conductivity which is commonly employed to determine several phenomena such as infiltration rates drainage processes runoff generation etc gootman et al 2020 ostad ali askari and shayannejad 2020 zhuang et al 2001 traditionally the hydraulic conductivity is measured through different techniques at the lab and field conditions flow cells are utilized for measuring hydraulic conductivity using both the constant and the falling head technique at the lab in field experiments ring infiltrometers are typically employed and they provide a better representation of the soil conditions in the experimental field nevertheless the hydraulic conductivity can be determined from more easily obtainable soil properties such as k which can be estimated from measurements of air and water flow loll et al 1999 changes in soil k induced by cracks big macropores and compaction can significantly affect the water dynamics this happens since k is naturally influenced by both soil texture and structure which can combine to produce very slow to very rapid water infiltrations vanani et al 2017 sheikh and pak 2015 intrinsic permeability and hydraulic conductivity measurements have been usually carried out in disturbed and undisturbed samples with several centimeters in size which reflect mainly the water transport through inter aggregate pores reichardt and timm 2020 lal and shukla 2004 however it should be recognized that these properties vary across the soil profile and spatial scales and thus can be different in centimeter sized samples comprising inter and intra aggregate pores in relation to micro aggregate samples comprising only intra aggregate pores in this way intra aggregate pores play an important role in water transport and their geometrical characteristics will affect the water dynamics especially at the microscale ostad ali askari and shayannejad 2021 masís meléndez et al 2014 a side remark is that the importance of complementary research on the arrangement of pores and soil aggregation has been recently stressed by koestel et al 2021 nowadays with the advent and evolution of techniques of three dimensional 3d image acquisition such as x ray computed microtomography xct it is possible to obtain high quality images with reasonable resolutions that permit to study the soil pore architecture galdos et al 2020 ferreira et al 2019 ferreira et al 2018 the 3d characterization of the soil pore system allows identifying individual pores or bunches of pores that rule the water dynamics oliveira et al 2021 menon et al 2020 schlüter et al 2020b pires et al 2019 gharedaghloo et al 2018 the combination of the information obtained through image based analysis techniques associated with water dynamic concepts e g poiseuille darcy kozeny carman equations can help to understand different phenomena taking place in the soil as well as to measure important soil characteristics such as its k and hydraulic conductivity daly and roose 2014 although there are many studies reporting xct based k estimation for different porous media these types of investigations are still scarce in the porous media field at the microscale and they offer means for a better understanding of soil hydraulic properties across different scales zhang et al 2021 the need for understanding how microscopic pore scale scale of μm properties affect the macroscopic properties of the rhizosphere scale of mm has been highlighted years ago in roose at al 2016 more recently schnepf et al 2022 recognized that processes such as water and nutrient uptake rhizodeposition and microbial activity act on more than six orders of magnitude from the rhizosphere processes that typically occur between 1 µm and 1 mm to the management scale 1 m these authors presented different modelling scenarios using xct to integrate rhizosphere processes into a plant scale and soil profile scale modelling concept simulations can predict in combination with high quality images the water flow in different groups of connected pores schlüter et al 2020a gharedaghloo et al 2018 more specifically several studies can be found in which the k of a porous medium is computed by finite volume and lattice boltzmann based simulations gerke and karsanina 2021 zhang et al 2021 scheibe et al 2015 khan et al 2012 skeletonization algorithms can be used to derive the tortuosity of a porous medium soto gómez et al 2020 ngom et al 2011 which can in turn be used to estimate k based on the well known kozeny carman equation zhang and schaap 2019 yet algorithms of pore network modeling allow the k estimation based on numerical simulations applied on models of pore bodies and throats zhang et al 2019 the mentioned methods to derive k present the potential to be used in multiscale models focused on characterizing the transport of water in the soil however these methods vary in terms of accuracy and computational processing time for example in pore network modelling the computational cost and consequently the time compumption is reduced by assuming a simplified geometry of pores that may neglect important pore scale phenomena while direct simulations solve equations directly on the imaged geometry roose et al 2016 therefore when one wants to compute k for a large dataset of soil images e g large number of repetitions for different soil treatments targeting good statistics information some pros and cons of each method may be taken into account before deciding on one of them thus this study aimed at comparing three xct based methods to determine the k of the pore system of a soil aggregate which is remarkably heterogeneous i finite volume based simulation apes absolute permeability experiment simulation ii image based parametrization of kozeny carman ibp kc equation and iii pore network model pnm among the considered methods apes is the less dependent on the configuration of sensitivity parameters and for this reason was assumed as a reference method the relevance of the proposed study lies in the fact that it brings a way of calibrating less computational demanding and therefore faster methods ibp kc and pnm whose sensitivity parameters are non trivial to configure especially for heterogeneous porous media this allows simpler but accurate k computation which is important for analyses of large 3d image datasets including many repetitions and treatments the proposed comparison was accomplished through 3d synchrotron based x ray computed tomography srxct analyses at the micrometer scale 2 material and methods 2 1 sample collection the soil sample utilized in this study was collected in an experimental field in the agronomic institute of paraná farm located in the municipality of ponta grossa state of paraná brazil 25 09 s 50 09 w 875 m a s l the soil was classified as clayey 58 clay 28 silt and 14 sand according to the usda textural classification system hillel 2003 according to the classification presented by the soil survey staff 2013 the soil is a rhodic hapludox oxisol the experimental site of this study was initiated in 1981 and consisted of a no tillage management system borges et al 2019 passoni et al 2015 de moraes sá et al 2015 the area under no tillage was not submitted to soil disturbance the crops grown in this area were corn zea mays and soybeans glycine max in the summer period oats avena strigosa or wheat triticum aestivum l and vetch vicia sativa in winter for soil and crop management sowing and harvest were utilized tractors soil samples were collected at the topsoil 0 10 cm as small monoliths volumes between 50 and 100 cm3 prior to srxct analysis these samples were manually disaggregated carefully breaking them apart then the small aggregates were dry sieved through a 19 mm sieve for homogenization after that these aggregates were passed through a 4 mm sieve and retained on a 2 mm sieve in the present work one aggregate 3 mm diameter has been considered for 3d image acquisition and evaluation of the three computational methods for k estimation 2 2 image acquisition and segmentation a 3d image of the described soil aggregate was generated at the x ray microtomography beamline imx at the brazilian synchrotron light laboratory brazilian center for research in energy and materials lnls cnpem it is important to mention that this single aggregate is part of a larger set of aggregates coming from different management systems at the aforementioned farm that integrated an experimental proposal at imx beamline however given the objective of comparing three computational methods only one aggregate 3d image has been considered in the present study the sample was scanned using a 1 67 t bending magnet radiation source from the 1 37 gev uvx storage ring filtered by a 550 μm thick si filter and 1 024 projections were acquired over 180 rotation of the sample the detection system was composed of a 50 μm thick scintillator luag ce and a pco 2000 camera with a 5x objective the exposure time for each projection was 2 s and the total scan time per sample was 35 min the image reconstruction was performed by applying an in house filtered back projection based algorithm miqueles et al 2018 the reconstructed images were 16 bit raw type with a maximum array of 2 048 2 048 2 048 voxels and a voxel size of 1 64 μm resulting in image volumes of 3 36 3 36 3 36 mm3 each as a consequence of the projection imaging geometry the geometric resolution σr of the generated image can be defined as the variance of the point spread function psf of the imaging system according to eq 1 bartels 2013 gureyev et al 2008 1 σ r 1 1 m 2 σ s 2 1 m 2 σ d 2 where σs and σd represent the standard deviations of the source intensity distribution and the detector psf respectively which were considered here for simplicity as the nominal source size σs 919 228 µm2 horizontal vertical and the pixel size of the detector σd 1 64 µm respectively m is the geometric magnification m 1 z 2 z 1 which in turn depends on the source to sample z1 16 700 mm and sample to detector z2 40 mm distances for more detailed definitions please consult villarraga gómez and smith 2022 and stolfi et al 2017 in the present case the magnification is 1 due to the very large z1 and very small z2 distances therefore the influence of the source size on the geometric resolution is minor and the pixel size of the detector is the critical limitation it should be noted that the geometric magnification of the image varies with z1 and z2 distances because the x ray beam of imx beamline was quasi parallel i e it had a low divergence of 1 7 0 28 mrad thus the horizontal vertical estimated image resolution was 2 74 1 72 µm2 the image segmentation was based on machine learning allied with a traditional local segmentation for the machine learning steps an in house software named annotat3d was used which is based on high performance computing techniques spina et al 2018 vasconcelos et al 2018 in house software i e developed at lnls cnpem and currently accessed by lnls users only the following steps were conducted i image filtering to smooth noise non local means filter in gpu adaptive manifold 3d mode spatial standard deviation 1 intensity standard deviation 0 3 search window 10 voxels local neighborhood 5 voxels and enhance edges unsharp mask edge size 4 voxels edge contrast 0 7 brightness threshold 0 fig 1 a ii background segmentation using thresholding and erosion dilation tools until reaching seeds at the background and aggregate as in fig 1b followed by watershed method beucher and lantuejoul 1979 fig 1c iii choice of machine learning parameters feature extraction all filters selected superpixels seed spacing and compactness values were set to 3 and 10 respectively and classifier random forest with 200 trees vasconcelos et al 2018 iv declaring the phases background solid matrix and pores v adding annotations for the three phases in different slices of the srxct image fig 1d vi training and running the classifier and vii define seeds based on the labels resulting from this process fig 1e and run a final watershed segmentation fig 1f steps i ii and vii were performed using the avizo software v 2019 fei 2019 2 3 image analyses 2 3 1 preparation of image and general definitions the segmented image was first submitted to basic quantifications of pore areas and volumes and the identified pores are presented in fig 2 a with random association of colors after that the pores were colorized by volume resulting in a 3d rendering of the soil pore system with different pore volumes portrayed in a specific color code fig 2b the most voluminous pore mvp represented in blue in fig 2b was filtered from the remaining pores and a sub volume of the image containing only this pore henceforth named svp was extracted size in x y and z coordinates 1 948 2 796 1 760 µm3 fig 2c it is important to mention that the svp was selected such that its walls crossed the mvp at its edges in x y and z coordinates because this guarantees that there is pore continuity through the three orthogonal directions to support further analyses a map of local 3d thickness hildebrand and rüegsegger 1997 across the mvp was computed a sub volume equivalent to svp was selected containing the isolated mvp in addition to the label of solids and background sv fig 2d aiming to account for the correct porosity in sv the volumes associated with each label pore solids and background were computed the sv porosity due to the mvp ϕsv was then calculated as the ratio between the pore volume vp and the aggregate volume va the sum of the pore and solid volume contained in sv for the steps described in this section the avizo software s modules named label analysis colorize by measure sieve analysis volume fraction and thickness map were used 2 3 2 application of three different methods for the intrinsic permeability k estimation of a soil aggregate 2 3 2 1 finite volume based simulation the numerical simulation implemented in the avizo software as a module named absolute permeability experiment simulation apes determines the k associated with each flow direction kz y x of the porous medium under study in this case a soil aggregate the stokes equations are first solved by a finite volume method fei 2019 harlow and welch 1965 for velocities and pressures in the system v 0 2 μ 2 v p 0 where and 2 are divergence gradient and laplacian operators respectively p is the pressure v is the velocity and µ is the dynamic viscosity of the fluid this equation system is a simplification of the navier stokes equations and considers the following assumptions incompressible fluid i e constant density newtonian fluid i e constant dynamic viscosity steady state flow i e constant velocity over time and laminar flow i e the velocities are small enough not to produce turbulence once this equation system is solved darcy s law is applied to estimate k baychev et al 2019 fei 2019 darcy 1856 3 q s k μ δ p l where q is the global flow rate that goes through the porous medium m3 s 1 s is the cross section of the sample which the fluid goes through m2 k is the absolute permeability m2 µ is the dynamic viscosity pa s δ p is the pressure difference applied across the sample pa and l is the length of the sample in the flow direction m the boundary conditions for apes are i one voxel rigid walls are added on the faces of the image that are parallel to the main flow direction i e no flow out of the system occurs across the walls ii no slip condition at fluid solid interfaces iii experimental setups representing an inlet and an outlet are added on the faces of the image that are perpendicular to the main flow direction through which the fluid is injected and released respectively iv two among three conditions input pressure output pressure and flow rate can be chosen by the user the third being estimated from the previous two fei 2019 the great advantage of apes is that k is computed directly from the segmented binary image in this case svp provided that it presents pore continuity between the inlet and outlet of the flow the two chosen boundary conditions were the input and output pressures which were set to represent pressure drops δp of 860 1366 and 952 pa for the fluid flow directions z y and x respectively δp was defined so that a hydraulic head gradient h equal to 50 was stablished over the length of the aggregate h in each direction according to eq 4 4 h δ h h bh h b f o r b 50 where δ h represents the hydraulic head drop between the inlet and outlet of the flow in each direction as exemplified in fig 2e for the z direction thus δp corresponds to δh values m converted to pressure values pa as required by the simulation interface the considered fluid viscosity was that of the water 0 001 pa s and the convergence criterion henceforth called error for the simulation was set to 1 10 7 the max number of iterations in each direction was adjusted to reach a situation where the time derivatives of the unknown which are involved in the error computation would tend to be 0 fei 2019 the error computation at each iteration is based on the velocity vector the pressure field the time step and an artificial compressibility coefficient fei 2019 it is important to mention that the kz y x estimation by apes is independent from the boundary conditions pressure drops and from the fluid viscosity only the velocity and pressure fields are rescaled according to the indicated values fei 2019 therefore h 50 was an arbitrary choice aimed to provide consistent comparison of the velocity field among orthogonal flow directions considering that the error associated with the number of iterations is the only input parameter in the present method that actually affects the estimation of kz y x and that a criterion for that is well stablished apes was assumed as a reference method the mentioned criterion is that the number of iterations for each direction should be defined considering that the computation should not need more than 100 000 iterations and the oscillations should not remain beyond 500 iterations fei 2019 supplementary movie 1 and supplementary information 1 illustrate some of the methodological steps described so far gray scale image slicing 3d rendering of segmented pores mvp selection and apes analysis 2 3 2 2 image based parametrization of kozeny carman equation ibp kc the intrinsic permeability can be derived from the well known kozeny carman equation zhang and schaap 2019 brooks and corey 1966 carman 1937 kozeny 1927 5 k ϕ sv r 2 β τ 2 ϕ sv v p a p 2 β τ 2 where ϕsv is the sv porosity due to the mvp previously defined r is the hydraulic radius µm β is a shape factor that depends on the geometry of the pore space dimensionless and τ is the tortuosity of the medium r is originally defined as the cross sectional area normal to the flow through a straight tube divided by the wetted perimeter however if the pore space is thought for mathematical purposes as a tube of nonuniform cross sections the hydraulic radius is assumed to be the volume occupied by the tube divided by its internal surface area brooks and corey 1966 therefore for this analysis r was considered as the ratio of the pore volume vp to the surface pore area ap both properties were computed for the svp image using the label analysis module in avizo for irregular cross sections the numerical constant β should be between limit values of 2 and 3 which are valid for flow through a small capillary tube and for flow over an infinite flat plate thin film respectively brooks and corey 1966 therefore an average β of 2 5 was assumed for the present analysis the τ of the medium was derived by a skeletonization method briefly explained as follow the centerline tree module available in the avizo software is based on the teasar algorithm proposed by sato et al 2000 it reduces complex 3d structures of varying local thicknesses to a set of segments that represent the skeleton of such structure the input file for this module was the svp image fig 2c three valued parameters were adjusted slope and zeroval which are tube parameters were set to 5 and 4 respectively while the number of parts was set to 70 the choice on the values for the mentioned parameters aimed at achieving a pore skeleton that would visually resemble the original pore avoiding too many small branches exiting the main segments besides generating the graph containing the pore skeleton for visualization this module also provided the τ and mean radius associated with each segment of the skeleton the module computes the τ of each segment as the ratio between its curved length le equivalent to the distance that would be traversed by fluid elements when moving from one end of the segment to another and chord length l the direct distance between the ends of the segment 2 3 2 3 pore network model pnm the input file for a pnm algorithm is a pore space that has been geometrically partitioned separated youssef et al 2007 this pore separation should be efficient at delimiting the regions that better represent the pore bodies and pore throats the open source algorithm named pnextract which is based on distance map computation and medial axis transformation of the 3d pore space was applied to perform the pore separation bultreys et al 2018 raeini et al 2017 dong and blunt 2009 website for download https github com aliraeini pnextract the pnextract algorithm was configured to deliver the pore mvp in svp separation that was visually the most reasonable when compared with the original pore the sensitivity parameters used for this configuration are shown in table 1 according to the pnextract guide the parameter rmedsurfnoise is a measure of noise amplitude and increasing it decreases the number of separated pores the file resulting from the pore separation named velems tif extension was then loaded into avizo converted from 32 bit signed to 16 bit label and submitted to the pnm algorithm implemented in this software which was inspired by youssef et al 2007 the algorithm generates a lattice of spheres and cylinders representing a model of pore bodies and throats respectively in addition it determines the pore and throat radii frequency distribution with the image resolution limiting the lower detectable radii the coordination number i e number of connected neighbors and pore volumes by enabling the pnm s generate properties function a numerical simulation assuming laminar flow is performed leading to the computation of kx y z and τx y z of the extracted pore network model the pnm simulation assumes that the network is filled with only one phase and that the flow is laminar everywhere poiseuille flow under these conditions the relation between pressure drop and flow rate is linear 6 q ij g ij p i p j where q ij is the flow rate between pore i and j g ij is the hydraulic conductance of the throat between pore i and j p i and p j represent the pressure in pore i and j respectively mass conservation applies for each pore body and is described as 7 i j q ij 0 where the summation is performed on all pores j connected to the pore i in addition assuming that the conducting throats are represented by cylindrical pipes of radius r ij and length l ij g ij is given by poiseuille s law 8 g ij π 8 μ r ij 4 l ij where µ is the dynamic viscosity pa s as described before thus by imposing a pressure difference across the network a linear system of equations describing flow and pressure fields is numerically solved by an iterative bi conjugate gradient method for more details please consult fei 2019 youssef et al 2007 and laroche and vizika 2005 the global flow rate q across the pore network of length l is then calculated from the contributions of each throat q ij on a cross sectional area s and k is finally deduced from darcy s law eq 3 moreover the hydraulic tortuosity is computed by summing up the length of all velocities deduced from the k computation divided by the sum of the projection of the velocities along the flow direction fei 2019 the pnm module in avizo requires the selection of the flow direction z y x and δp inlet pressure outlet pressure as a parameter the considered δp values were the same as those assumed for the apes and in the present analysis the k estimation is also independent from the boundary conditions only flow rates are rescaled according to the indicated values fei 2019 the resulting kx y z values determined by the pnm were compared with the ones obtained by the apes to confirm that the sensitivity parameters considered when applying the pnextract algorithm worked well for the pore separation this is due to the fact that fei 2019 avizo user s guide recommends tuning the pnm to obtain the same value of k using another method such as apes on the same sample 3 results the values determined for vp va and ϕsv were 1 27 108 μm3 7 91 109 μm3 and 0 02 respectively the thickness map of the isolated pore mvp in svp is shown in fig 3 a c e within the limits imposed by the inlet and outlet openings from the apes which considers water injection in the z y and x directions respectively it is seen from these figures that only few thicker regions represented from red to yellow in the thickness scale exist through the pore with the majority of regions characterized by thin apertures represented from green to blue table 2 shows the parameters tested for apes as can be seen in fig 4 the error curves as function of the number of iterations resulting from apes vary among the tested flow directions for the z and y directions the first error stability 6 10 6 that remained over 500 iterations and provided realistic kz and ky values i e positive k values occurred with 107 000 iterations table 2 for the x direction this condition occurred with less iterations 84 000 according to the k values determined by apes the pore medium was more permeable in the x than in the y direction and the z direction was the less permeable of all although the values are just slightly different table 2 one of the apes outputs is the velocity field which is a part of the solution to the stokes equation system eq 2 solved in the geometry defined by svp fei 2019 the resulting velocity field for each flow direction is shown in fig 3b d f as can be seen from these figures the flow direction x that presented the highest k by apes table 2 also presented the lowest maximum velocity fig 3f on the other hand although k was higher for the y than for the z direction table 2 y has presented the highest maximum velocity among the three directions this is likely due to the very thin channel at the bottom of the y flow fig 3d which is the only flow entrance path fig 5 b shows the pore skeleton generated for the mvp in svp with a color code attributed to the mean segment radius the locations of the thicker segment regions and the radius scale resulting for the pore skeleton in fig 5b are in agreement with the thicker regions and thickness scale identified for the thickness map in fig 5a the values of ap r mean τ and k were respectively 2 06 107 µm2 6 14 µm and 1 63 which led to a k of 0 09 µm2 as determined by ibp kc the result of the pore separation is presented in fig 5c in which different colored regions delimit the separated pores within the original pore structure the kz value obtained via pnm in close proximity to the one found by apes table 2 for the x flow direction the pnm provided a lower kx than apes but in the same order of magnitude which was considered acceptable for the y flow direction the pnm provided a ky value much lower than apes indicating that the former simulation was more sensible to the very thin ramification at the right side of the pore shown in fig 5 to test this hypothesis the separated pore fig 5c was cropped only to eliminate the thin ramification and was re submitted to the pnm module resulting in similar values for kz and kx but in a much more comparable value of ky in relation to apes respective value table 2 pnm to make sure that this comparison was valid the same cropped pore was also re submitted to apes with flow in y direction and the result ky 0 024 µm2 was very close to the original one table 2 this is an evidence that the pore separation worked reasonably well from the τ frequency distribution determined by the skeletonization fig 6 a it is seen that the mean τ considered for the k estimation by ibp kc is close to the most frequent value with few segments presenting much more tortuous paths in addition the coordination number frequency distribution determined by the pnm fig 6a shows that the lowest and highest pore connectivity coordination number 0 and 8 respectively is achieved only by few pores a simple linear correlation analysis showed a positive relationship between the coordination number and pore eq radius data r 0 81 i e higher coordination numbers occurred for pores of larger eq radii which can also be visually identified from fig 5d in other words a few large pores constituting the considered porous structure are the ones governing the connectivity through the medium camargo et al 2022 lucas et al 2021 ferreira et al 2019 jarvis et al 2017 4 discussion 4 1 k values estimated by the three tested methods the mean k determined for the studied soil aggregate by apes 0 037 µm2 and pnm 0 034 µm2 methods were very close table 2 and slightly lower than the value determined by the ibp kc 0 090 µm2 moreover the mean τ determined by the pnm 1 64 table 2 and by the teasar algorithm for skeletonization 1 63 were in close agreement it should be noted that the convergence of the three applied methods was only possible because of the careful decision on the algorithms parameters apes method can be considered a more reliable method for k estimation for being less dependent on the configuration of sensitivity parameters i e k is computed directly from the segmented pore space without any intermediate manipulation of the image on the other hand both the pnm and the ibp kc methods depend on a step of image manipulation in this study only the parameters that led to convergent results among methods were presented e g table 1 for pore separation in pnm tube parameters and number of parts for skeletonization in ibp kc section 2 3 2 2 the separation of pores directly impacts the simulation performed in pnm to estimate k in general the visual comparison between fig 5c and fig 5a shows that a reasonable separation was achieved with the pnextract algorithm attempts were performed aiming to apply the separate objects module available in the avizo software for the same purpose of the pnextract algorithm however less realistic pore separation was obtained with the former approach no matter the sensitivity parameters used resulting in an over or under separation of pores with no resemblance with the visually identified pore bodies and throats in the original pore structure the skeletonization influences the τ values that are considered in eq 5 to calculate k the visual comparison of the resulting pore skeleton with the thickness map fig 5a b leads to conclude that the selection of the tube parameters and number of parts for the teasar algorithm was efficient at detecting a representative pore skeleton where remarkable loops of the pore were kept and the majority of the branches follow the original pore morphology zhang et al 2019 performed a similar investigation comparing three methods for k estimation of sandstone core samples and they found that apes results deviated above 1 µm2 from pnm s results the mentioned authors analyzed sandstone core samples which present much more homogeneous pore architecture than soil with a known average sand grain diameter this evidences the value of the convergent results among methods presented here it should be emphasized that only one soil aggregate was investigated here because the focus was to develop strategies to work with the three proposed methods in a compatible way to serve as an example for potential applications we do not intend to convey that a single aggregate represent the soil layer in which it has been collected in fact the comparison of methods presented is destined to those who desire to apply them or one of them to actual datasets containing repetitions and representing a soil or a specific scale of such soil moreover although the methods and calibration of its parameters have been tested for a single soil aggregate the strategies could well be performed for xct images of larger samples capturing inter aggregate pores instead of or in addition to intra aggregate ones depending on the spatial resolution however as recently recognized by zhang et al 2021 most macroscopic phenomena measured in soil emerge from biogeochemical and physical processes occurring at the microscopic scale which justifies the relevance of characterizing the water transport in soil aggregates as a complement to studies in bulk soils 4 2 pros and cons of the three tested methods in terms of advantages and disadvantages of each method it should be recognized that although apes is considered a more reliable method for k estimation for reasons stated before it is the most time consuming of all taking 48 h to reach the number of iterations presented in table 2 therefore it might be not feasible for a large dataset multiple images the step of pore separation pnextract that is required as input for pnm took 2 h thus testing different parameters table 1 until reaching a decent pore separation can become more time consuming than expected and still be impractical for large datasets the pnm itself which generates the lattice of pore bodies and throats and performs a numerical simulation on it to estimate k was quick with almost instantaneous return nevertheless the pnm presented the disadvantage of being more sensitive to thin ramifications of the pore system providing in this case unrealistic values of k and demanding further cropping of the image to avoid this undesirable effect the ibp kc was the quicker method taking only a few minutes to compute all required image derived data the teasar algorithm used for skeletonization in ibp kc which provided the τ values was fast and easy to test different input parameters however a downside of it is that the τ is found from a distribution of values associated with the identified segments of the skeleton i e it does not specify τ for a given direction the pnm in turn specifies τ for different directions and their values can be used in ibp kc according to the targeted analysis for reference the reported computation times for each method was accomplished in a high performance computing server model intel xeon gold 6130 cores 32 memory 512 gb although the pore separation performed by the open source algorithm pnextract relies on a medial axis transformation raeini et al 2017 which is a type of skeletonization the strategy is different from that used in the teasar algorithm tree structure extraction algorithm for skeletonization sato et al 2000 used to compute the tortuosity for the ibp kc nevertheless the distribution curves of the pore eq radius from pnm analysis and the mean segment radius from teasar algorithm for skeletonization show a similar shape with a tendency to a bimodal distribution fig 6b the similarity of the distributions between the methods shows that both analyses are sensitive to the physical characteristics of the pore system however pnm was more sensitive to macropores pore eq radius 50 μm which is probably related to the nature of each method of analysis pnm approaches the separated pores to spheres before determining their eq radius while the skeletonization based on teasar algorithm finds distances from pore boundaries to its defined tree structure skeleton 4 3 potential applications of the three tested methods according to klute and dirksen 1986 the k values obtained here in the order of 10 10 cm2 lie in the limit of applicability of the constant head experiment analogous to the apes simulation traditionally performed to measure soil hydraulic conductivity the 10 10 cm2 range is associated with mixtures of sand silt and clay typically loess loam material right between fine sand and structured clay material klute and dirksen 1986 moreover this range of k translates into the 10 5 cm s 1 hydraulic conductivity range which is classified as the limit between low and very low and typical of clayey soils klute and dirksen 1986 horn 1990 these are in accordance with the material considered in the present study which consists of a small soil aggregate from a clayey textured soil the average water velocity is a function of the flux density and the soil water content in no saturate conditions jury and horton 2004 thus changes in both these properties will influence the average water velocity as a function of k however the use of properties such as flux density porosity and soil water content cannot be alone good parameters to infer about the water dynamics in complex pore systems such as soils because differences in the pore architecture will have a greater impact on the velocity than the parameters aforementioned liu and jeng 2019 perfect and sukop 2001 as could be observed from the velocity fields resulting from apes fig 3b d f for example soils with numerous narrow pores can have lower permeabilities even having high porosities as compared to soils with lower porosities but comprised of larger pores giatman et al 2019 hillel 2003 therefore several other factors related to the architecture of the pores will affect the water flow such as the continuity size and shape distribution of the pores and tortuosity tötzke et al 2017 vogel and roth 2001 the pnm allowed having some insight into the internal characteristics of the soil pore system in 3d during water infiltration the transport of the water through the soil profile occurs in different directions inoue et al 2018 fang et al 2016 if we suppose that the unique directions possible for the water to flow are those of the cartesian coordinate system which is an approximation of the reality we can have an idea about the isotropy of the soil pore system when the water flux is analyzed in the x y and z directions pulido moncada et al 2021 hillel 2003 the results presented here table 2 show that the porous medium studied is anisotropic kx ky kz mainly due to the complexity of the pore size and shape distributions in clayey soils recently pires et al 2020 and galdos et al 2020 demonstrated through 3d image analysis the complexity of the soil pore system in terms of shape and size distributions of pores in clayey soils from tropical regions like the soil studied in our work these authors demonstrated that geometrical and topological soil pore properties are greatly influenced by changes in the soil pore system which have direct impact in water dynamics and root development they also investigated the degree of anisotropy and tortuosity in different directions to verify irregularities in the distribution of pores in tropical soils the bimodality tendency observed in the distribution curves presented in fig 6b can be an indication of the soil structure quality according to the study of kutílek 2004 aggregated soils are characterized by differences between textural and structural pores the latter being associated to the shape orientation and arrangement of soil aggregates thus when the soils have more than one peak in pore size distributions this is an indication of structured soils pires et al 2017 kutílek et al 2006 cássaro et al 2011 working with tropical soils from the same experimental site of the study presented here demonstrated the multimodality of the soil pore system for no tillage and conventional tillage systems based on experimental water retention curves corroborating our results based on 3d image analysis although the instructions of both apes and pnm stated clearly that the methods were independent of the boundary conditions tests were performed varying the δp values but indeed this did not change the resultant k values the sensibility to δp variation would be interesting however to evaluate the moment when the flux ceases to vary linearly with the hydraulic gradient condition for darcy s law validity where the slope of such linear relationship is the k that is the transition from laminar to turbulent flow klute and dirksen 1986 furthermore although traditional laboratory measurements were not performed for comparison it is known that aggregates tend to present lower k and hydraulic conductivities than bulk soil due to the hierarchical soil formation vogel 2019 horn 1990 this opens opportunity for studies aimed at linking information of k and hydraulic conductivity across scales this study raised some outstanding future perspectives given the latest technical and scientific advances for instance the substantial increase in spatial resolution coupled with zoom capability of srxct in 4th generation synchrotrons ferreira et al 2022 hesterberg et al 2022 are expected to aid in analyses such as those of fig 6b this figure shows high frequency of pores that are in the limit of the spatial resolution achieved in a 2nd generation synchrotron indicating that with higher resolution perhaps a peak would be defined improving the image based characterization of pore size distributions in addition higher spatial resolution could reveal that the mvps found with the current conditions are larger connected to other large pores through thin throats that were not captured here moreover associating high spatial and temporal resolutions high throughput opens paths to compare larger number of samples from different treatments e g soil managements which provides higher statistical confidence when comparing different treatments besides the high throughput capability also enables time resolved experiments meaning that the type of study performed here by means of computational simulations could be experimentally performed in the form of an in situ experiment at a srxct beamline in situ experiments in turn may provide richer information that can be applied to further improve fluid flow simulations and modelling 5 conclusions this study showed that it was possible to optimize the performance of three different computational methods to determine the intrinsic permeability k of the pore system of a soil aggregate the absolute permeability experiment simulation apes was considered as a reference method since it is less dependent on the configuration of sensitivity parameters in comparison with the image based parametrization of the kozeny carman ibp kc equation and pore network model pnm apes and pnm methods required higher computational power and were more time consuming in the case of the pnm the more time consuming step was the pore separation performed by the pnextract algorithm the pnm presented the disadvantage of being more sensitive to thin ramifications of the pore system providing in this case unrealistic values of k and demanding further cropping of the image to avoid this undesirable effect the ibp kc was found to be a quick and reliable method if carefully configured a good balance of accuracy and time consumption for xct srxct based k estimation in large image datasets is to first calibrate faster methods e g ibp kc and pnm against a reference method e g apes for one image and then rely on the faster methods for computation on the remaining images these faster methods favor xct based analyses of soil k that are targeted at large datasets of 3d i e many treatments and repetitions and 4d time plus space images moreover the steps presented here can be easily extended to studies of soil hydraulic conductivity since it can be determined from k and the fluid properties viscosity and density therefore we can conclude that although our analysis was carried out for only one pore system sample the steps presented here have great potential to understanding how the pore architecture influences dynamic processes in the soil credit authorship contribution statement talita r ferreira conceptualization methodology software validation formal analysis investigation data curation writing original draft writing review editing visualization nathaly l archilha conceptualization methodology resources writing review editing luiz f pires conceptualization methodology resources writing original draft writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research used facilities of the brazilian synchrotron light laboratory lnls part of the brazilian center for research in energy and materials cnpem a private non profit organization under the supervision of the brazilian ministry for science technology and innovations mcti proposal 20180217 the imx beamline staff is acknowledged for the assistance during the experiments and the tepui group is acknowledged for the assistance on the use of the high performance computers dr jocenei a t de oliveira dr tseng c ling and dr aline m h dos reis are acknowledged for their help in the image acquisition and dr jadir a rosa for his support in the experimental sites lfp would like to acknowledge the brazilian national council for scientific and technological development cnpq grants 304925 2019 5 and 404058 2021 3 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128024 appendix a supplementary data the following are the supplementary data to this article supplementary video 2 supplementary data 1 
3182,the frequency and severity of floods have noticeably increased worldwide in the last decades due to climate change and urbanization this study aims to build an urban flood warning system for reducing the impact of flood disasters a great number of storm induced rainfall data were collected in taipei taiwan and the corresponding 2 d inundation maps were simulated for illustrating urban rainfall flood inundation processes we proposed a novel urban flood forecast methodology framed by machine learning and statistical techniques to mine the spatial temporal features between rainfall patterns and inundation maps for making multi step ahead regional flood inundation forecasts the proposed methodology pca som narx integrated the advantages of principal component analysis pca self organizing map som and nonlinear autoregressive with exogenous inputs narx pca was used to extract principal components representing the different spatial distributions of urban inundation som was used to cluster high dimensional inundation datasets to form a two dimensional topological feature map narx was used to establish multi step ahead flood forecast models for the next hour at a 10 minute scale the results show that the pca som narx approach not only produced more stable and accurate multi step ahead forecasts on flood inundation depth but was also more indicative of the spatial distribution of inundation caused by torrential rain events compared to the som narx approach the benchmark the results demonstrate the proposed methodology can adequately grasp the inundation status associated with different rainfall distributions to reliably and accurately forecast regional flood inundation depths which can help decision makers respond to flooding earlier and mitigate flood disasters keywords principal component analysis pca self organizing map som nonlinear autoregressive with exogenous inputs narx spatio temporal analysis of inundation urban flood forecasting 1 introduction the frequency of extreme hydrological events is increasing in many parts of the world due to climate change in recent decades flood disasters are more severe than ever and much suffering and many setbacks have to be endured hosseinzadehtalaei et al 2021 wang et al 2021 industrial development and facility construction during urbanization may change terrains and the environment and therefore lead to an increase in impervious areas and the destruction of river systems jamshed et al 2020 shih et al 2020 many cities are susceptible to storm events because they are located along coasts or in low lying areas adjacent to rivers chan et al 2021 therefore it is imperative to conduct in depth research on urban flood control to conquer the challenges raised by urbanization and climate change modeling urban flood inundation is very challenging due to the lack of monitoring data many scientists have been engaged in modeling urban flood inundation based on hydrodynamics theorems for instance hu et al 2018 developed a 2 d control volume and finite element flood model to capture the details of local flows as well as wetting and drying fronts bhola et al 2018 used a substantial number of pre calculated inundation maps to extract the most likely maps in real time for hydrodynamic based flood forecasting wang et al 2019 proposed a model that divided an irregular urban area into grid cells to reflect the frequent interactions of inflow and or outflow among grid cells for predicting urban floods under heavy precipitation conditions wu et al 2021 used the random forest algorithm to identify the urban rainstorm flood disaster sensitive indicators sobek is a widely used 2 d flood simulation model for revealing flood prone areas with corresponding inundation depths ex kaoje et al 2021 san et al 2020 yang et al 2018 the water resources agency in taiwan simulated flooding areas with inundation depths under different rainfall scenarios to provide the flood prone maps for disaster prevention although areas prone to flooding could be identified each simulated flood event bore great uncertainties and the actual flood may not correspond to the default scenario the flood simulation data used in previous studies were mostly designed based on the rainfall patterns obtained from long duration storm events or typhoon events design rainfall events are generally assumed to be uniformly distributed in space golian et al 2010 viglione et al 2010 it has been noticed that flood peaks for rarer flood events have increased across many parts of the world over the last decades and there has been a shift to shorter and intense rainfall events wasko et al 2021 thus the simulation of flooding areas and severity in response to real rainstorm events might not provide satisfactory results the simulation of urban flood inundation using 2 d models is computationally intensive therefore it would be difficult for 2 d simulation models to support real time urban flood forecasting at sufficiently high resolution when a rainfall occurs leading to insufficient emergency response time for flood defense resultantly real time urban flood prediction of detailed hydrodynamics is not yet a common practice in an operational forecasting system benefiting from recent advances in scientific and technological fields e g artificial intelligence machine learning the performance of urban flood forecasting has been significantly improved in the last decade chang et al 2019a artificial neural networks anns one type of machine learning with capability to solve complex nonlinear problems are broadly used in various hydrological fields such as rainfall runoff prediction nourani 2017 gao et al 2020 jahandideh tehrani et al 2021 molajou et al 2021 groundwater level prediction chang et al 2016 dinunno and granata 2020 streamflow prediction freire et al 2019 poul et al 2019 cheng et al 2020 kabir et al 2020 sea level prediction zhao et al 2019 muslim et al 2020 zubier and eyouni 2020 and flood inundation depth prediction chang et al 2019b 2020b kao et al 2020 2021 lin et al 2020b developed independent anns for real time flood inundation forecasting at specific time intervals where anns were trained by 120 synthetic flood events simulated by a 2d hydraulic model nevertheless machine learning and or ann techniques for regional inundation forecasts have been configured mostly based on flood data simulated by physically based models due to the lack of historical flood inundation data for instance chang et al 2014 used the som narx approach that combined the self organizing map som and the nonlinear autoregressive with exogenous inputs narx to predict urban floods based on flood simulation data from physically based models nguyen and bae 2020 predicted urban floods using deep learning models with inputs of flood data simulated by the 1d 2d urban hydrological model it is noted that plenty of previous studies explored various methods to reduce the dimensionality of flood data before establishing flood prediction models e g berkhahn et al 2019 chang et al 2010 kao et al 2021 principal component analysis pca is a statistical method applied to projecting data onto linear and uncorrelated variables components using an orthogonal transformation its principal components pcs can retain as much information in the data as possible and therefore is often used for data analysis and dimension reduction chang et al 2017 zhang et al 2021 lin et al 2020a developed a backpropagation network based on multiple inflow data to predict the maximum flood inundation at an urban area where the dimensionality of training data discharge curves of 50 dimensions was reduced to seven pcs with the cumulative variance explaining 97 of total variance by pca to fill the gaps between current research and practical application this study proposes a new method that integrates machine learning with pca to forecast urban flood inundation due to intense rainfall we first use sobek to simulate a large number of rainfall events with different temporal and spatial distributions and provide urban flood inundation maps we then integrate machine learning techniques with pca pca som narx to extract the main features pcs with the cumulative variance explaining 80 of total variance of these high dimensional urban flood inundation maps to make real time urban flood inundation nowcasts for the very near future the performance of the proposed forecasting system is evaluated and tested by 51 storm events across four catchments of taipei city in taiwan 2 study area and materials taipei city located downstream of the tamsui river on a low lying basin in northern taiwan is susceptible to flooding after torrential rainfall events being equipped with complete flood control facilities like revetments sewage systems and pumping stations taipei city has a great capability to protect residents from flooding the study area fig 1 a consists of the catchments of four pumping stations in taipei city including yuanshan zhongshan xinsheng and jianguo stations with areas of 317 481 525 and 658 ha respectively the terrain of the study area is rather flat except for higher terrain upstream of the xinsheng and jianguo stations the sewage systems drain water northward into the keelung river to facilitate flood forecast model construction grid maps of flood inundation depths were generated using sobek based on historical and design rainfall events table 1 summarized 12 historical rainfall events for use in this study the 12 historical events with 0 8 1 2 and 1 4 times of original rainfall amount form a suite of designed rainfall events i e 36 designed events in total along with three other design rainfall events there are three other design rainfall events the first design event with a normally distributed rainfall of 650 mm within a 24 hour duration illustrates a rainfall scenario covering the whole study area where the rainfall pattern was simulated based on the parameters of the horner formula moea 2017 in consideration of the 200 year return period of the taipei rainfall station the second design event that simulates the rainfall pattern of storm 20190703 illustrates a rainfall scenario around the zhongshan catchment located in the east part of the study area the third design event simulating the rainfall patterns of storm 20150723 and the storm 20190722 illustrates a rainfall scenario around yuanshan and xinsheng catchments located in the west part of the study area table 2 presents the attributes of the 51 rainfall events for use in this study there are 23 training events rainfall intensities 6 6 mm hr 76 3 mm hr 14 validation events rainfall intensities 8 2 mm hr 47 7 mm hr and 14 test events rainfall intensities 9 9 mm hr 77 3 mm hr the cumulative distribution function cdf of rainfall is shown in fig 1 b which indicates validation events have a smaller rainfall intensity range than training and test events 3 methodology to increase the diversity of training data when building flood forecast models this study adopts sobek to simulate flood inundation based on historical and design rainfall events a real time flood forecast model pca som narx that fuses pca som and narx is established to produce accurate multi step ahead regional urban inundation forecasts in consideration of different spatial temporal rainfall distributions for making responses to flooding as early as possible the pca and narx stages were coded with matlab r2020a and som was coded with c then the codes of pca som and narx were integrated to make regional inundation forecasts the pca som narx architecture is shown in fig 2 the implementation procedure of pca som narx is described as follows step 1 data collection a total of 12 historical rainfall events were collected and three rainfall events were designed to separately represent the rainfall scenarios of the whole study area and the east and the west parts of the study area step 2 flood inundation simulation the simulation of flood inundation 10 minute time interval is carried out by sobek based on 51 rainfall events 12 historical events with 0 8 1 0 1 2 and 1 4 times of original rainfall amount and 3 design events a total of 2047 flood datasets are obtained where each dataset contains 45 101 grid cells 10 10 m of flood inundation depths in the study area step 3 inundation analysis pca is conducted to reduce the high dimensionality of the simulated flood inundation depths where principal components pcs represent the characteristics of different spatial inundation distributions som is used to cluster the simulated flood inundation depths into a topological map that displays the spatial distribution of different flood inundation depths step 4 forecast model construction narx is adopted to establish forecast models of the average inundation depth aid and four pcs for the next 10 up to 60 min model inputs initially consist of rainfall data from 15 gauge stations and the feedback of model outputs joins as extra inputs due to the recurrent architecture of narx that is to say the forecasts of aid and four pcs at the previous time step can be used to facilitate forecasting at the next time step step 5 regional inundation depth forecast a selection strategy is carried out at first to select winning neurons from the topological map for the first pc 10 som neurons with their first pc values the closest to the first pc forecast from narx are selected and the same selection criterion is applied to the second up to the fourth pcs next a weight assignment strategy is implemented to distribute the overall weight value of 100 among the selected neurons for the first pc a weight value of 20 is assigned to the neuron with its first pc value the closest to the corresponding narx forecast the same assignment rule is applied to the other three pcs the accumulated weight value already assigned thus accounts for 80 at this moment then the remaining weight value 20 is equally distributed among the neurons with the highest number of times being selected consequently the inundation depth forecast of each grid cell is given through adaptively adjusting the aid forecast from narx with the average of the weighted sums of the selected neurons for the next 10 to 60 min for the benchmark model som narx narx only produces the forecast of aid similarly with the recurrent architecture of narx the aid forecast at the previous time step can be used as extra input to facilitate forecasting at the next time step then its winning neuron selection strategy selects the neuron with aid the closest to the aid forecast from narx consequently the aid of each grid cell in the winning neuron is adaptively adjusted by the aid forecast from narx for obtaining regional inundation depth forecasts for the next 10 to 60 min 3 1 flood inundation simulation sobek sobek implements a one dimensional channel algorithm where the de saint venant equation is solved by the explicit finite difference method besides that a two dimensional surface overland flow algorithm that is developed based on a one dimensional shallow water flow equation considers the interactions between the river the sewage system and the overland flow the basic assumptions and calculation of sobek used in this study are given below a1 rainfall conditions refer to actual rainfall events a2 the upper lower boundary conditions of the downstream tidal level of a year are the averages of high low tidal levels of the tamsui river estuary from july to october in the previous year a3 it is assumed that all hydraulic facilities flood control and drainage facilities as well as sewer systems are free from damage a4 flood control and drainage facilities operate in accordance with the existing operating rules when no operating rules available a facility operates according to the relationship between the internal and external water levels of the facility a5 it requires considering the water passages that are blocked by urban buildings and the drainage system is assumed to be free from siltation more details of sobek can be found in li 2010 and reggiani et al 2016 3 2 principal component analysis pca pca proposed by karl pearson in 1901 is a multivariate statistical method widely used for data analysis and dimension reduction gocic and trajkovic 2014 zhu et al 2017 żelazny et al 2018 baghanam et al 2020 in this study the flood inundation depths simulated by sobek correspond to 45 101 grid cells 10 10 m covering the whole study area due to the curse of dimensionality it is difficult for a single model to directly forecast the flood inundation depths of all grid cells at the same time therefore prior to flood inundation forecasting pca is used to reduce the dimensionality of the simulated inundation depths from 45 101 grid cells to 4 pcs where the four pcs represent the different spatial distributions of urban inundation and the eigenvector is regarded as the weight of linear transformation 3 3 self organizing map som som proposed by kohonen kohonen 1982 clusters data into a topological map for reflecting the topology of the input vector distribution where neurons of the map compete with each other according to their similarity with each input vector while neighboring neurons possess relatively similar characteristics som is widely used in hydrological and environmental fields nourani et al 2013 nguyen et al 2015 chen et al 2018 guntu et al 2020 chang et al 2020a this study will feed the simulated flood inundation depths in all grid cells into a som algorithm to form a topological map showing the spatial temporal distribution of inundation 3 4 nonlinear autoregressive with exogenous inputs narx narx is a supervised neural network with dynamic feedback connections to deal with temporal problems particularly for time series forecasting chang et al 2016 wunsch et al 2018 yang et al 2019 dinunno and granata 2020 narx has three types of architectures shen and chang 2013 the first type is a static neural network where the target output is used as an input item in the training and testing phases the second type has a serial parallel configuration where the target output is used as an input item in the training phase while the output value is fed back as an input in the testing phase therefore narx produces good performance in the training phase but commonly faces poor performance in the testing phase the third type has a parallel configuration where the network feeds back the output value as an input during training and testing phases leading to strong fault tolerance this study establishes multi step ahead forecast models of aid and pcs using narx with a parallel configuration the architectures of the narx models adopted in som narx and pca som narx approaches are shown in fig 3 a total of 51 rainfall events 2047 datasets are allocated for model construction with 23 events 919 datasets for training 14 events 564 datasets for validation and 14 events 564 datasets for testing table 2 4 results and discussion 4 1 pca dimension reduction results pca can find the best summary of the data by geometrically projecting the data onto a lower dimension i e pc with the aim of preserving as much information as possible pca is conducted on the simulated flood inundation depths of 45 101 grid cells in the study area to obtain several pcs that retain the key features of highly dimensional datasets an eigenvector with a positive negative value indicates a positive negative correlation of the variable with the pc while an eigenvalue indicates the relative importance of the corresponding eigenvector fig 4 shows the pca results corresponding to the cumulative percentages of variance explained by the first ten pcs the percentages of variance explained by the first two pcs achieve 54 71 and 15 8 respectively which are relatively large subsequent percentages are smaller than 10 the first four pcs can explain more than 80 of the total variance of flood inundation data and therefore they are used to express the characteristics of different spatial distributions of flood inundation depths fig 5 shows the values of eigenvectors associated with the first four pcs in each grid cell in fig 5 a it is clear that all the values of eigenvectors are greater than 0 suggesting that the first pc might represent inundation depths the value is larger in places where severe floods occurred more frequently while the value is smaller in places where severe floods occurred less frequently locations with larger values are mostly concentrated near sewer pipelines and the downstream of the jianguo and the yuanshan catchments fig 5 b indicates that negative values are mostly concentrated near sewer pipelines while positive values are sparsely distributed implying the second pc might represent the initial and recession stages of rainfall events under such conditions water flows through sewer pipelines smoothly areas prone to inundation show positive values while areas less prone to inundation show negative values fig 5 c shows that the values of the study area are mostly negative larger negative values are primarily concentrated in the downstream regions and places near sewer pipelines positive values are concentrated in places with high terrains the third pc might therefore represent a smooth operation of the drainage system and inundation occurred in some places between high terrain and low terrain fig 5 d shows that positive values are mostly concentrated in the yuanshan catchment and the downstream of jianguo and zhongshan catchments values in the xinsheng catchment are mostly negative these imply the fourth pc might represent the condition that water flows from upstream to downstream with downstream inundation occurring due to insufficient drainage of rainwater at confluences pca som narx approach uses four pcs to represent the flooding characteristics which is more representative of the spatial distribution of flood inundation than som narx approach uses the aid 4 2 som clustering results som that groups datasets with similar flood characteristics into the same neuron forms a topological map to reflect the spatial temporal distribution of inundation three som map sizes 8 8 9 9 and 10 10 are testedand compared to identify the most suitable map size chang et al 2021 concluded that the comparatively high coverage ratio along the training process indicated the suitability of the som map size where the coverage ratio represented the coverage of the maximum and minimum weights of neurons as a percentage of the training data therefore we calculate the coverage ratios of the first four pcs that represent the characteristics of different spatial distributions the average coverage ratios of 8 8 9 9 and 10 10 som maps are 87 3 95 6 and 95 9 respectively the 9 9 som map appears to contain a sufficient percentage of the flood inundation data and therefore is determined to be the most suitable map size fig 6 shows the results of 9 9 som map where the flood inundation depth tends to increase from the bottom left corner neuron 72 to the top right corner neuron 9 fig 7 presents the different spatial distributions of inundation in the four catchments of each som neuron through the ratio of the total inundation depths in each catchment to the total inundation depths of the four catchments fig 8 further illustrates the occurrence ratio o c c u r r e n c e t i m e o f a d a t a t o t a l d u r a t i o n o f t h e f l o o d e v e n t c o n t a i n i n g t h e d a t a of each som neuron to analyze the temporal characteristics of the topological map where inundation data are sorted in ascending order according to occurrence ratio taking neuron 9 as an example there are four inundation data with 33 3 38 9 44 4 and 50 occurrence ratios indicating inundation occurred mostly during the rising limb of flooding it is noted that no events are clustered into neurons 1 13 14 29 37 40 47 and 50 leading to no temporal distribution of inundation available in them we next explore the pathway of winning neurons over time in the topological map for rainfall events the pathway diagrams of selected rainfall events are shown in fig 9 fig 9 a shows three design rainfall events fig 9 b shows two extreme rainfall events associated with storm 20150723 and storm 20180908 fig 9 c shows rainfall events of typhoon soudelor and storm 20190703 for each historical event the pathways corresponding to rainfall amount the original rainfall amount vs 1 4 times of the original rainfall amount are compared the color of the dot in each subfigure corresponds to the occurrence ratio of data the values corresponding to the initial and final stages of a flooding process are set to be 0 dark blue and 1 dark red respectively it can be found that the initial stage of the flooding process for each selected event is roughly located on the lower left part fig 9 a and 9 b indicate the design and extreme events have similar pathways i e the lower left part the lower right part the upper right part the upper left part moves in a counterclockwise direction fig 9 c indicates the pathways of slight events either start in the lower left part and end in the lower right part or fall within the lower left part only 4 3 narx forecast results narx is used to make multi step ahead forecasts of four pcs and aid with dynamic feedback connections narx can learn the relationship between two consecutive time steps under different rainfall amounts and spatial distributions flood inundation depths over time constitute time series where flood inundation depths at two consecutive time steps are closely related to each other therefore rainfall and the flood inundation depth at the previous time step are the two most important factors affecting inundation forecasts the narx forecast model takes observed data of 15 rain gauge stations around the study area as inputs and feeds back the output of the previous step to the input layer for producing the output of the next time step the forecast results of the som narx approach in terms of r2 and rmse are shown in table 3 it is observed that all the r2 values exceed 0 7 at t 1 up to t 5 in training validation and testing phases rmse values are small due to the small aids of simulated flood events besides the rmse value increases as the forecast horizon increases the results indicate narx can suitably represent the trend of the aid the forecast results of the pca som narx approach in terms of r2 and rmse are shown in table 3 it appears that narx can suitably grasp the trends at each horizon and the rmse values of pcs are larger than those of the aid the reason is that the standard deviations of the first up to the fourth pcs are 714 383 254 and 195 cm respectively whereas the standard deviation of the aid is 2 cm only 4 4 regional inundation forecast results for the pca som narx approach the regional flood inundation forecasts can be obtained by matching narx forecast results and som clustering results according to winning neuron selection and weight assignment strategies the results of winning neuron selection are displayed in fig 10 a 10 d where for each pc the neuron with its value the closest to the narx forecast is colored in dark red and the remaining 9 selected neurons are colored in red fig 10 e displays all the neurons that are selected and neurons with the highest number of times being selected 2 in our case are marked with blue squares the result of weight assignment is shown in fig 10 f where the overall weight value of 100 is allocated among the neurons marked with dark red and blue squares neurons marked with dark red is assigned a weight of 20 while neurons marked with blue squares equally share the weight value of 20 consequently the inundation depth forecast of each grid cell over the study area is given through adjusting the aid forecast from narx with the average of the weighted sums of all selected neurons fig 10 f for the next 10 to 60 min during model construction pca consumes 13 s to reduce the dimensionality from 45 101 grid cells to 4 pcs som consumes 25 740 s to cluster flood inundation depths 2047 simulated flood inundation depths of 45 101 grid cells and narx consumes 13 s to model the interdependence of rainfall with 4 pcs and aid for each time step after the pca som narx model is constructed the overall run time of each step ahead forecasting 10 minute based is 0 02 s for each sample input data for the som narx approach benchmark the neuron with aid the closest to the aid forecast from narx is selected then the aid of each grid cell in the selected neuron is adjusted by the aid forecast from narx for obtaining regional inundation depth forecasts for the next 10 to 60 min we next compare the regional inundation forecasts of som narx and pca som narx at t 1 up to t 6 in terms of rmse based on 51 rainfall events as shown in table 4 in general the rmse value increases as the time step increases at training validation and testing phases for both approaches it can be observed that pca som narx produces significantly smaller rmse values at each time step than som narx the results demonstrate pca som narx can make more accurate forecasts on flood inundation depth of each grid cell in the study area we next evaluate the spatial distribution of flood inundation depth forecasts made by som narx and pca som narx taking storm 20190722 1 4 as an example fig 11 shows the simulation results of sobek and the t 6 forecast results of both approaches at the 70th and the 110th minutes in the perspective of t the 70th minute it was the time the flood peak occurred and flood inundation was concentrated in upstream of the xinsheng catchment fig 11 a1 som narx obviously underestimated inundation depths fig 11 a2 pca som narx rmse 7 14 cm fig 11 a3 produces much more accurate forecasts than som narx rmse 14 52 cm in the perspective of t the 110th minute it was the time the recession limb began fig 11 b1 som narx obviously overestimated in the northwest part but underestimated in the south part fig 11 b2 whereas pca som narx only slightly underestimates and also produces more accurate forecasts fig 11 b3 pca som narx rmse 4 48 cm also produces much more accurate forecasts than som narx rmse 11 81 cm in sum pca som narx can reliably and accurately grasp the spatial distribution of flood inundation in the near future 5 conclusions urban flood inundation forecasting can be very beneficial for disaster mitigation by providing real time accurate inundation maps and flood early warnings to the public we combine pca som and narx to establish a reliable and accurate real time urban flood inundation forecast model pca som narx the proposed pca som narx approach can instantly offer high resolution forecasts of urban flooding processes extending from rainfall to inundation the som narx approach serves as the comparative benchmark the major findings are summarized as follows pca extracts the spatial distribution of urban inundation through four principal components with cumulative percentages explaining more than 80 of the total variance on inundation data the som topological map visualizes the spatial distributions of flood inundation the pathways of winning neurons indicate that the initial stage of the flooding process mainly occurs in the neurons located in the lower left corner of the topological map and such path moves in a counterclockwise direction over time in the topological map narx produces 10 minute flood inundation depth forecasts for the next hour t 1 t 6 with r2 reaching 0 82 at t 1 narx with feedback connections learns the relationship of aid between two consecutive time steps under different rainfall amounts and spatial distributions pca som narx performs better than som narx with rmse values fall within 2 25 cm 3 42 cm and improvement rates over the som narx model reaching 11 up to 21 for t 1 up to t 6 this is accredited to the integration of pca dimensionality reduction som feature map clustering and narx multi step ahead forecasting as well as the winning neuron selection strategy that can better recognize the spatial distribution of flood inundation the proposed pca som narx methodology can reliably and accurately make regional flood inundation forecasts through adequately grasping the inundation status induced by different rainfall patterns the results can support residents and government authorities for real time flood disaster management credit authorship contribution statement li chiu chang conceptualization methodology validation writing original draft jia yi liou data curation visualization software writing original draft fi john chang funding acquisition investigation supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was partly supported by the ministry of science and technology taiwan most 110 2625 m 002 018 and 110 2313 b 002 034 my3 the authors would like to thank the editors and anonymous reviewers for their constructive comments that greatly enrich the manuscript 
3182,the frequency and severity of floods have noticeably increased worldwide in the last decades due to climate change and urbanization this study aims to build an urban flood warning system for reducing the impact of flood disasters a great number of storm induced rainfall data were collected in taipei taiwan and the corresponding 2 d inundation maps were simulated for illustrating urban rainfall flood inundation processes we proposed a novel urban flood forecast methodology framed by machine learning and statistical techniques to mine the spatial temporal features between rainfall patterns and inundation maps for making multi step ahead regional flood inundation forecasts the proposed methodology pca som narx integrated the advantages of principal component analysis pca self organizing map som and nonlinear autoregressive with exogenous inputs narx pca was used to extract principal components representing the different spatial distributions of urban inundation som was used to cluster high dimensional inundation datasets to form a two dimensional topological feature map narx was used to establish multi step ahead flood forecast models for the next hour at a 10 minute scale the results show that the pca som narx approach not only produced more stable and accurate multi step ahead forecasts on flood inundation depth but was also more indicative of the spatial distribution of inundation caused by torrential rain events compared to the som narx approach the benchmark the results demonstrate the proposed methodology can adequately grasp the inundation status associated with different rainfall distributions to reliably and accurately forecast regional flood inundation depths which can help decision makers respond to flooding earlier and mitigate flood disasters keywords principal component analysis pca self organizing map som nonlinear autoregressive with exogenous inputs narx spatio temporal analysis of inundation urban flood forecasting 1 introduction the frequency of extreme hydrological events is increasing in many parts of the world due to climate change in recent decades flood disasters are more severe than ever and much suffering and many setbacks have to be endured hosseinzadehtalaei et al 2021 wang et al 2021 industrial development and facility construction during urbanization may change terrains and the environment and therefore lead to an increase in impervious areas and the destruction of river systems jamshed et al 2020 shih et al 2020 many cities are susceptible to storm events because they are located along coasts or in low lying areas adjacent to rivers chan et al 2021 therefore it is imperative to conduct in depth research on urban flood control to conquer the challenges raised by urbanization and climate change modeling urban flood inundation is very challenging due to the lack of monitoring data many scientists have been engaged in modeling urban flood inundation based on hydrodynamics theorems for instance hu et al 2018 developed a 2 d control volume and finite element flood model to capture the details of local flows as well as wetting and drying fronts bhola et al 2018 used a substantial number of pre calculated inundation maps to extract the most likely maps in real time for hydrodynamic based flood forecasting wang et al 2019 proposed a model that divided an irregular urban area into grid cells to reflect the frequent interactions of inflow and or outflow among grid cells for predicting urban floods under heavy precipitation conditions wu et al 2021 used the random forest algorithm to identify the urban rainstorm flood disaster sensitive indicators sobek is a widely used 2 d flood simulation model for revealing flood prone areas with corresponding inundation depths ex kaoje et al 2021 san et al 2020 yang et al 2018 the water resources agency in taiwan simulated flooding areas with inundation depths under different rainfall scenarios to provide the flood prone maps for disaster prevention although areas prone to flooding could be identified each simulated flood event bore great uncertainties and the actual flood may not correspond to the default scenario the flood simulation data used in previous studies were mostly designed based on the rainfall patterns obtained from long duration storm events or typhoon events design rainfall events are generally assumed to be uniformly distributed in space golian et al 2010 viglione et al 2010 it has been noticed that flood peaks for rarer flood events have increased across many parts of the world over the last decades and there has been a shift to shorter and intense rainfall events wasko et al 2021 thus the simulation of flooding areas and severity in response to real rainstorm events might not provide satisfactory results the simulation of urban flood inundation using 2 d models is computationally intensive therefore it would be difficult for 2 d simulation models to support real time urban flood forecasting at sufficiently high resolution when a rainfall occurs leading to insufficient emergency response time for flood defense resultantly real time urban flood prediction of detailed hydrodynamics is not yet a common practice in an operational forecasting system benefiting from recent advances in scientific and technological fields e g artificial intelligence machine learning the performance of urban flood forecasting has been significantly improved in the last decade chang et al 2019a artificial neural networks anns one type of machine learning with capability to solve complex nonlinear problems are broadly used in various hydrological fields such as rainfall runoff prediction nourani 2017 gao et al 2020 jahandideh tehrani et al 2021 molajou et al 2021 groundwater level prediction chang et al 2016 dinunno and granata 2020 streamflow prediction freire et al 2019 poul et al 2019 cheng et al 2020 kabir et al 2020 sea level prediction zhao et al 2019 muslim et al 2020 zubier and eyouni 2020 and flood inundation depth prediction chang et al 2019b 2020b kao et al 2020 2021 lin et al 2020b developed independent anns for real time flood inundation forecasting at specific time intervals where anns were trained by 120 synthetic flood events simulated by a 2d hydraulic model nevertheless machine learning and or ann techniques for regional inundation forecasts have been configured mostly based on flood data simulated by physically based models due to the lack of historical flood inundation data for instance chang et al 2014 used the som narx approach that combined the self organizing map som and the nonlinear autoregressive with exogenous inputs narx to predict urban floods based on flood simulation data from physically based models nguyen and bae 2020 predicted urban floods using deep learning models with inputs of flood data simulated by the 1d 2d urban hydrological model it is noted that plenty of previous studies explored various methods to reduce the dimensionality of flood data before establishing flood prediction models e g berkhahn et al 2019 chang et al 2010 kao et al 2021 principal component analysis pca is a statistical method applied to projecting data onto linear and uncorrelated variables components using an orthogonal transformation its principal components pcs can retain as much information in the data as possible and therefore is often used for data analysis and dimension reduction chang et al 2017 zhang et al 2021 lin et al 2020a developed a backpropagation network based on multiple inflow data to predict the maximum flood inundation at an urban area where the dimensionality of training data discharge curves of 50 dimensions was reduced to seven pcs with the cumulative variance explaining 97 of total variance by pca to fill the gaps between current research and practical application this study proposes a new method that integrates machine learning with pca to forecast urban flood inundation due to intense rainfall we first use sobek to simulate a large number of rainfall events with different temporal and spatial distributions and provide urban flood inundation maps we then integrate machine learning techniques with pca pca som narx to extract the main features pcs with the cumulative variance explaining 80 of total variance of these high dimensional urban flood inundation maps to make real time urban flood inundation nowcasts for the very near future the performance of the proposed forecasting system is evaluated and tested by 51 storm events across four catchments of taipei city in taiwan 2 study area and materials taipei city located downstream of the tamsui river on a low lying basin in northern taiwan is susceptible to flooding after torrential rainfall events being equipped with complete flood control facilities like revetments sewage systems and pumping stations taipei city has a great capability to protect residents from flooding the study area fig 1 a consists of the catchments of four pumping stations in taipei city including yuanshan zhongshan xinsheng and jianguo stations with areas of 317 481 525 and 658 ha respectively the terrain of the study area is rather flat except for higher terrain upstream of the xinsheng and jianguo stations the sewage systems drain water northward into the keelung river to facilitate flood forecast model construction grid maps of flood inundation depths were generated using sobek based on historical and design rainfall events table 1 summarized 12 historical rainfall events for use in this study the 12 historical events with 0 8 1 2 and 1 4 times of original rainfall amount form a suite of designed rainfall events i e 36 designed events in total along with three other design rainfall events there are three other design rainfall events the first design event with a normally distributed rainfall of 650 mm within a 24 hour duration illustrates a rainfall scenario covering the whole study area where the rainfall pattern was simulated based on the parameters of the horner formula moea 2017 in consideration of the 200 year return period of the taipei rainfall station the second design event that simulates the rainfall pattern of storm 20190703 illustrates a rainfall scenario around the zhongshan catchment located in the east part of the study area the third design event simulating the rainfall patterns of storm 20150723 and the storm 20190722 illustrates a rainfall scenario around yuanshan and xinsheng catchments located in the west part of the study area table 2 presents the attributes of the 51 rainfall events for use in this study there are 23 training events rainfall intensities 6 6 mm hr 76 3 mm hr 14 validation events rainfall intensities 8 2 mm hr 47 7 mm hr and 14 test events rainfall intensities 9 9 mm hr 77 3 mm hr the cumulative distribution function cdf of rainfall is shown in fig 1 b which indicates validation events have a smaller rainfall intensity range than training and test events 3 methodology to increase the diversity of training data when building flood forecast models this study adopts sobek to simulate flood inundation based on historical and design rainfall events a real time flood forecast model pca som narx that fuses pca som and narx is established to produce accurate multi step ahead regional urban inundation forecasts in consideration of different spatial temporal rainfall distributions for making responses to flooding as early as possible the pca and narx stages were coded with matlab r2020a and som was coded with c then the codes of pca som and narx were integrated to make regional inundation forecasts the pca som narx architecture is shown in fig 2 the implementation procedure of pca som narx is described as follows step 1 data collection a total of 12 historical rainfall events were collected and three rainfall events were designed to separately represent the rainfall scenarios of the whole study area and the east and the west parts of the study area step 2 flood inundation simulation the simulation of flood inundation 10 minute time interval is carried out by sobek based on 51 rainfall events 12 historical events with 0 8 1 0 1 2 and 1 4 times of original rainfall amount and 3 design events a total of 2047 flood datasets are obtained where each dataset contains 45 101 grid cells 10 10 m of flood inundation depths in the study area step 3 inundation analysis pca is conducted to reduce the high dimensionality of the simulated flood inundation depths where principal components pcs represent the characteristics of different spatial inundation distributions som is used to cluster the simulated flood inundation depths into a topological map that displays the spatial distribution of different flood inundation depths step 4 forecast model construction narx is adopted to establish forecast models of the average inundation depth aid and four pcs for the next 10 up to 60 min model inputs initially consist of rainfall data from 15 gauge stations and the feedback of model outputs joins as extra inputs due to the recurrent architecture of narx that is to say the forecasts of aid and four pcs at the previous time step can be used to facilitate forecasting at the next time step step 5 regional inundation depth forecast a selection strategy is carried out at first to select winning neurons from the topological map for the first pc 10 som neurons with their first pc values the closest to the first pc forecast from narx are selected and the same selection criterion is applied to the second up to the fourth pcs next a weight assignment strategy is implemented to distribute the overall weight value of 100 among the selected neurons for the first pc a weight value of 20 is assigned to the neuron with its first pc value the closest to the corresponding narx forecast the same assignment rule is applied to the other three pcs the accumulated weight value already assigned thus accounts for 80 at this moment then the remaining weight value 20 is equally distributed among the neurons with the highest number of times being selected consequently the inundation depth forecast of each grid cell is given through adaptively adjusting the aid forecast from narx with the average of the weighted sums of the selected neurons for the next 10 to 60 min for the benchmark model som narx narx only produces the forecast of aid similarly with the recurrent architecture of narx the aid forecast at the previous time step can be used as extra input to facilitate forecasting at the next time step then its winning neuron selection strategy selects the neuron with aid the closest to the aid forecast from narx consequently the aid of each grid cell in the winning neuron is adaptively adjusted by the aid forecast from narx for obtaining regional inundation depth forecasts for the next 10 to 60 min 3 1 flood inundation simulation sobek sobek implements a one dimensional channel algorithm where the de saint venant equation is solved by the explicit finite difference method besides that a two dimensional surface overland flow algorithm that is developed based on a one dimensional shallow water flow equation considers the interactions between the river the sewage system and the overland flow the basic assumptions and calculation of sobek used in this study are given below a1 rainfall conditions refer to actual rainfall events a2 the upper lower boundary conditions of the downstream tidal level of a year are the averages of high low tidal levels of the tamsui river estuary from july to october in the previous year a3 it is assumed that all hydraulic facilities flood control and drainage facilities as well as sewer systems are free from damage a4 flood control and drainage facilities operate in accordance with the existing operating rules when no operating rules available a facility operates according to the relationship between the internal and external water levels of the facility a5 it requires considering the water passages that are blocked by urban buildings and the drainage system is assumed to be free from siltation more details of sobek can be found in li 2010 and reggiani et al 2016 3 2 principal component analysis pca pca proposed by karl pearson in 1901 is a multivariate statistical method widely used for data analysis and dimension reduction gocic and trajkovic 2014 zhu et al 2017 żelazny et al 2018 baghanam et al 2020 in this study the flood inundation depths simulated by sobek correspond to 45 101 grid cells 10 10 m covering the whole study area due to the curse of dimensionality it is difficult for a single model to directly forecast the flood inundation depths of all grid cells at the same time therefore prior to flood inundation forecasting pca is used to reduce the dimensionality of the simulated inundation depths from 45 101 grid cells to 4 pcs where the four pcs represent the different spatial distributions of urban inundation and the eigenvector is regarded as the weight of linear transformation 3 3 self organizing map som som proposed by kohonen kohonen 1982 clusters data into a topological map for reflecting the topology of the input vector distribution where neurons of the map compete with each other according to their similarity with each input vector while neighboring neurons possess relatively similar characteristics som is widely used in hydrological and environmental fields nourani et al 2013 nguyen et al 2015 chen et al 2018 guntu et al 2020 chang et al 2020a this study will feed the simulated flood inundation depths in all grid cells into a som algorithm to form a topological map showing the spatial temporal distribution of inundation 3 4 nonlinear autoregressive with exogenous inputs narx narx is a supervised neural network with dynamic feedback connections to deal with temporal problems particularly for time series forecasting chang et al 2016 wunsch et al 2018 yang et al 2019 dinunno and granata 2020 narx has three types of architectures shen and chang 2013 the first type is a static neural network where the target output is used as an input item in the training and testing phases the second type has a serial parallel configuration where the target output is used as an input item in the training phase while the output value is fed back as an input in the testing phase therefore narx produces good performance in the training phase but commonly faces poor performance in the testing phase the third type has a parallel configuration where the network feeds back the output value as an input during training and testing phases leading to strong fault tolerance this study establishes multi step ahead forecast models of aid and pcs using narx with a parallel configuration the architectures of the narx models adopted in som narx and pca som narx approaches are shown in fig 3 a total of 51 rainfall events 2047 datasets are allocated for model construction with 23 events 919 datasets for training 14 events 564 datasets for validation and 14 events 564 datasets for testing table 2 4 results and discussion 4 1 pca dimension reduction results pca can find the best summary of the data by geometrically projecting the data onto a lower dimension i e pc with the aim of preserving as much information as possible pca is conducted on the simulated flood inundation depths of 45 101 grid cells in the study area to obtain several pcs that retain the key features of highly dimensional datasets an eigenvector with a positive negative value indicates a positive negative correlation of the variable with the pc while an eigenvalue indicates the relative importance of the corresponding eigenvector fig 4 shows the pca results corresponding to the cumulative percentages of variance explained by the first ten pcs the percentages of variance explained by the first two pcs achieve 54 71 and 15 8 respectively which are relatively large subsequent percentages are smaller than 10 the first four pcs can explain more than 80 of the total variance of flood inundation data and therefore they are used to express the characteristics of different spatial distributions of flood inundation depths fig 5 shows the values of eigenvectors associated with the first four pcs in each grid cell in fig 5 a it is clear that all the values of eigenvectors are greater than 0 suggesting that the first pc might represent inundation depths the value is larger in places where severe floods occurred more frequently while the value is smaller in places where severe floods occurred less frequently locations with larger values are mostly concentrated near sewer pipelines and the downstream of the jianguo and the yuanshan catchments fig 5 b indicates that negative values are mostly concentrated near sewer pipelines while positive values are sparsely distributed implying the second pc might represent the initial and recession stages of rainfall events under such conditions water flows through sewer pipelines smoothly areas prone to inundation show positive values while areas less prone to inundation show negative values fig 5 c shows that the values of the study area are mostly negative larger negative values are primarily concentrated in the downstream regions and places near sewer pipelines positive values are concentrated in places with high terrains the third pc might therefore represent a smooth operation of the drainage system and inundation occurred in some places between high terrain and low terrain fig 5 d shows that positive values are mostly concentrated in the yuanshan catchment and the downstream of jianguo and zhongshan catchments values in the xinsheng catchment are mostly negative these imply the fourth pc might represent the condition that water flows from upstream to downstream with downstream inundation occurring due to insufficient drainage of rainwater at confluences pca som narx approach uses four pcs to represent the flooding characteristics which is more representative of the spatial distribution of flood inundation than som narx approach uses the aid 4 2 som clustering results som that groups datasets with similar flood characteristics into the same neuron forms a topological map to reflect the spatial temporal distribution of inundation three som map sizes 8 8 9 9 and 10 10 are testedand compared to identify the most suitable map size chang et al 2021 concluded that the comparatively high coverage ratio along the training process indicated the suitability of the som map size where the coverage ratio represented the coverage of the maximum and minimum weights of neurons as a percentage of the training data therefore we calculate the coverage ratios of the first four pcs that represent the characteristics of different spatial distributions the average coverage ratios of 8 8 9 9 and 10 10 som maps are 87 3 95 6 and 95 9 respectively the 9 9 som map appears to contain a sufficient percentage of the flood inundation data and therefore is determined to be the most suitable map size fig 6 shows the results of 9 9 som map where the flood inundation depth tends to increase from the bottom left corner neuron 72 to the top right corner neuron 9 fig 7 presents the different spatial distributions of inundation in the four catchments of each som neuron through the ratio of the total inundation depths in each catchment to the total inundation depths of the four catchments fig 8 further illustrates the occurrence ratio o c c u r r e n c e t i m e o f a d a t a t o t a l d u r a t i o n o f t h e f l o o d e v e n t c o n t a i n i n g t h e d a t a of each som neuron to analyze the temporal characteristics of the topological map where inundation data are sorted in ascending order according to occurrence ratio taking neuron 9 as an example there are four inundation data with 33 3 38 9 44 4 and 50 occurrence ratios indicating inundation occurred mostly during the rising limb of flooding it is noted that no events are clustered into neurons 1 13 14 29 37 40 47 and 50 leading to no temporal distribution of inundation available in them we next explore the pathway of winning neurons over time in the topological map for rainfall events the pathway diagrams of selected rainfall events are shown in fig 9 fig 9 a shows three design rainfall events fig 9 b shows two extreme rainfall events associated with storm 20150723 and storm 20180908 fig 9 c shows rainfall events of typhoon soudelor and storm 20190703 for each historical event the pathways corresponding to rainfall amount the original rainfall amount vs 1 4 times of the original rainfall amount are compared the color of the dot in each subfigure corresponds to the occurrence ratio of data the values corresponding to the initial and final stages of a flooding process are set to be 0 dark blue and 1 dark red respectively it can be found that the initial stage of the flooding process for each selected event is roughly located on the lower left part fig 9 a and 9 b indicate the design and extreme events have similar pathways i e the lower left part the lower right part the upper right part the upper left part moves in a counterclockwise direction fig 9 c indicates the pathways of slight events either start in the lower left part and end in the lower right part or fall within the lower left part only 4 3 narx forecast results narx is used to make multi step ahead forecasts of four pcs and aid with dynamic feedback connections narx can learn the relationship between two consecutive time steps under different rainfall amounts and spatial distributions flood inundation depths over time constitute time series where flood inundation depths at two consecutive time steps are closely related to each other therefore rainfall and the flood inundation depth at the previous time step are the two most important factors affecting inundation forecasts the narx forecast model takes observed data of 15 rain gauge stations around the study area as inputs and feeds back the output of the previous step to the input layer for producing the output of the next time step the forecast results of the som narx approach in terms of r2 and rmse are shown in table 3 it is observed that all the r2 values exceed 0 7 at t 1 up to t 5 in training validation and testing phases rmse values are small due to the small aids of simulated flood events besides the rmse value increases as the forecast horizon increases the results indicate narx can suitably represent the trend of the aid the forecast results of the pca som narx approach in terms of r2 and rmse are shown in table 3 it appears that narx can suitably grasp the trends at each horizon and the rmse values of pcs are larger than those of the aid the reason is that the standard deviations of the first up to the fourth pcs are 714 383 254 and 195 cm respectively whereas the standard deviation of the aid is 2 cm only 4 4 regional inundation forecast results for the pca som narx approach the regional flood inundation forecasts can be obtained by matching narx forecast results and som clustering results according to winning neuron selection and weight assignment strategies the results of winning neuron selection are displayed in fig 10 a 10 d where for each pc the neuron with its value the closest to the narx forecast is colored in dark red and the remaining 9 selected neurons are colored in red fig 10 e displays all the neurons that are selected and neurons with the highest number of times being selected 2 in our case are marked with blue squares the result of weight assignment is shown in fig 10 f where the overall weight value of 100 is allocated among the neurons marked with dark red and blue squares neurons marked with dark red is assigned a weight of 20 while neurons marked with blue squares equally share the weight value of 20 consequently the inundation depth forecast of each grid cell over the study area is given through adjusting the aid forecast from narx with the average of the weighted sums of all selected neurons fig 10 f for the next 10 to 60 min during model construction pca consumes 13 s to reduce the dimensionality from 45 101 grid cells to 4 pcs som consumes 25 740 s to cluster flood inundation depths 2047 simulated flood inundation depths of 45 101 grid cells and narx consumes 13 s to model the interdependence of rainfall with 4 pcs and aid for each time step after the pca som narx model is constructed the overall run time of each step ahead forecasting 10 minute based is 0 02 s for each sample input data for the som narx approach benchmark the neuron with aid the closest to the aid forecast from narx is selected then the aid of each grid cell in the selected neuron is adjusted by the aid forecast from narx for obtaining regional inundation depth forecasts for the next 10 to 60 min we next compare the regional inundation forecasts of som narx and pca som narx at t 1 up to t 6 in terms of rmse based on 51 rainfall events as shown in table 4 in general the rmse value increases as the time step increases at training validation and testing phases for both approaches it can be observed that pca som narx produces significantly smaller rmse values at each time step than som narx the results demonstrate pca som narx can make more accurate forecasts on flood inundation depth of each grid cell in the study area we next evaluate the spatial distribution of flood inundation depth forecasts made by som narx and pca som narx taking storm 20190722 1 4 as an example fig 11 shows the simulation results of sobek and the t 6 forecast results of both approaches at the 70th and the 110th minutes in the perspective of t the 70th minute it was the time the flood peak occurred and flood inundation was concentrated in upstream of the xinsheng catchment fig 11 a1 som narx obviously underestimated inundation depths fig 11 a2 pca som narx rmse 7 14 cm fig 11 a3 produces much more accurate forecasts than som narx rmse 14 52 cm in the perspective of t the 110th minute it was the time the recession limb began fig 11 b1 som narx obviously overestimated in the northwest part but underestimated in the south part fig 11 b2 whereas pca som narx only slightly underestimates and also produces more accurate forecasts fig 11 b3 pca som narx rmse 4 48 cm also produces much more accurate forecasts than som narx rmse 11 81 cm in sum pca som narx can reliably and accurately grasp the spatial distribution of flood inundation in the near future 5 conclusions urban flood inundation forecasting can be very beneficial for disaster mitigation by providing real time accurate inundation maps and flood early warnings to the public we combine pca som and narx to establish a reliable and accurate real time urban flood inundation forecast model pca som narx the proposed pca som narx approach can instantly offer high resolution forecasts of urban flooding processes extending from rainfall to inundation the som narx approach serves as the comparative benchmark the major findings are summarized as follows pca extracts the spatial distribution of urban inundation through four principal components with cumulative percentages explaining more than 80 of the total variance on inundation data the som topological map visualizes the spatial distributions of flood inundation the pathways of winning neurons indicate that the initial stage of the flooding process mainly occurs in the neurons located in the lower left corner of the topological map and such path moves in a counterclockwise direction over time in the topological map narx produces 10 minute flood inundation depth forecasts for the next hour t 1 t 6 with r2 reaching 0 82 at t 1 narx with feedback connections learns the relationship of aid between two consecutive time steps under different rainfall amounts and spatial distributions pca som narx performs better than som narx with rmse values fall within 2 25 cm 3 42 cm and improvement rates over the som narx model reaching 11 up to 21 for t 1 up to t 6 this is accredited to the integration of pca dimensionality reduction som feature map clustering and narx multi step ahead forecasting as well as the winning neuron selection strategy that can better recognize the spatial distribution of flood inundation the proposed pca som narx methodology can reliably and accurately make regional flood inundation forecasts through adequately grasping the inundation status induced by different rainfall patterns the results can support residents and government authorities for real time flood disaster management credit authorship contribution statement li chiu chang conceptualization methodology validation writing original draft jia yi liou data curation visualization software writing original draft fi john chang funding acquisition investigation supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was partly supported by the ministry of science and technology taiwan most 110 2625 m 002 018 and 110 2313 b 002 034 my3 the authors would like to thank the editors and anonymous reviewers for their constructive comments that greatly enrich the manuscript 
3183,the coupled atmospheric hydrologic systems help achieve deeper understanding on the interactions between the atmospheric and land surface processes improve the spatial and temporal accuracy of hydrologic forecasts and extend the forecast leading time wrf hydro is nowadays a widely used hydrologic module to be coupled with the mesoscale numerical weather model wrf for atmospheric hydrologic research and applications the structure of wrf hydro is improved and expanded in this study to better adapt to the complicated rainfall runoff transformation mechanism in the mixed runoff generation regions the infiltration parameterisation is replaced by an infiltration equation that takes into account the impact of the surface soil moisture variation on the infiltration capacity and the spatial discretisation of the infiltration capacity from a distribution curve is achieved based on the conception of the topographic index for the runoff convergence the river channel leakage loss is introduced into the muskingum cunge mc streamflow calculations with variable parameters in time efforts are also made to reduce parameter calibration errors in wrf hydro the accuracy of the wrf rainfall forcing is improved by merging weather radar and rain gauge observations using the kriging with external drift ked interpolation tool the key parameters of wrf hydro are then calibrated using the improved rainfall forcing with the merging observations the performance of the improved wrf hydro structure is explored in both one way and the fully coupled modes with the wrf model typical rainstorm events are selected from semi humid and semi arid catchments of northern china as case studies results have shown that the improved wrf hydro is more effective in simulating floods with high peaks and steep rises and falls but a problem is also shown of receding more quickly for low peaks the improved model structure has changed the proportion of the mixed runoff generation in the long term there is an increase in the infiltration excess runoff generation and decrease in the saturation excess amount both the one way and the fully coupled wrf wrf hydro systems have demonstrated the suitability of the improved structure for rainfall runoff processes dominated by the infiltration excess runoff generation keywords wrf wrf hydro rainfall runoff simulation improved structure mixed runoff generation infiltration 1 introduction an atmospheric hydrologic coupling system enables rapid acquisition of high resolution rainfall data and timely forecasting of floods the complicacy of an atmospheric hydrologic coupling system is determined by the specific implementation of the atmospheric model the land surface model lsm and the hydrologic model on one hand hydrologic models range from lumped semi distributed to fully distributed ones according to the degree of interpretation of reality the multiplicity of laws in the model that constrains the expressions of the physical processes brings differences essou et al 2016 yang et al 2000 and how the spatial information is described further affects the complexity and flexibility of the model cho and engel 2017 fatichi et al 2016 song et al 2015 on the other hand although most lsms and hydrologic models contain similar land surface processes the descriptions of the same processes and their purposes are not the same gudmundsson et al 2012 haddeland et al 2011 in the past lsms are generally coupled to atmospheric models to solve the surface energy balance equations and to provide the atmospheric models with lateral and boundary conditions such as radiation and fluxes sharma et al 2019 wood et al 2011 therefore the expression of the soil is generalised vertically in contrast hydrologic models are less concerned with energy changes but pay more attention to water changes i e the lateral transport of water along the surface a further issue that should not be overlooked is the difference of resolution between the lsms and the hydrologic models while atmospheric models can provide high resolution data input to lsms including rainfall 1 km 25 km depending on the study area hydrologic models require more stringent resolution below 1 km to reflect the variability of runoff over the catchments there have been extensive explorations of the atmospheric hydrologic coupling systems for rainfall runoff modeling and forecasting they have experienced a transition from ideal experiments to regional studies in a broader sense however there still exist many issues to be resolved one of them is the hydrologic model s generalisation of the runoff generation mechanisms especially the mixed mechanism with the consideration of both infiltration excess and saturation excess differs substantially from reality bao et al 2009 yucel et al 2015 to date the identification and construction of the runoff generation mechanisms is still a worthy question for investigating in hydrologic modeling various model structures have been developed to deal with different spatial scales time scales and applications for example the sacramento model sac uses variable permeable area and saturated infiltration rate to reflect the mixed runoff generation mechanisms vrugt et al 2006 the vertical mixed runoff model vmm combines the infiltration excess and saturation excess runoff periods in the vertical direction bao and zhao 2014 the improved generalised catchment load function model gwlf replaces the fixed conductivity coefficients with functional equations to better estimate hydrological conditions in the mixed runoff generation areas sha et al 2014 the variable infiltration xinanjiang model vxm integrates the vic infiltration equation into the original xinanjiang model xinmin et al 2003 the lumped hebei model lhm uses the refined horton empirical equation in the infiltration process to consider the changes of the top soil moisture before the saturation excess happens han 2002 the vic 3l model introduces an infiltration excess and saturation excess curve assuming that the infiltration excess runoff occurs over a non full saturation soil liang and xie 2001 su and xie 2003 and the wrf hydro model includes a simple water balance production scheme sipm based on the experimental derivation of soil hydraulics in conjunction with the richards equation to describe the runoff mixed generation mechanism schaake et al 1996 for the above models with mixed runoff generation structures sac couples the infiltration excess and saturation excess processes based on a two soil layer structures with different storage capacities for estimating infiltration from the upper to the lower layer but neglects the local runoff generation problem finnerty et al 1997 vmm takes into account the spatial distribution of runoff by adopting the infiltration and storage capacity distribution curves but the soil water interaction between surface and subsurface is not considered as spatially variable bao and zhao 2014 the gwlf vxm and lhm model suffers from similar deficiencies which are to some extent determined by the lumped model structures in contrast gridded or distributed hydrologic models have obvious advantages in characterising the spatial heterogeneity of hydrologic variables but are also found to have limitations for example although the distributed vic 3l is able to address the local runoff issue and the interactions between different runoff generation interfaces it does not provide a complete module of runoff generation and lacks descriptions for the lateral transport of the soil water the coupling of lsm with the hydrologic model seems to provide a satisfactory solution but as mentioned above the difference in their focus of the land surface processes and purposes determines that their coupling scales are not consistent wrf hydro is currently one of the few modeling systems that provide a feasible coupling between lsm and the hydrologic model with the consideration of a mixed runoff generation mechanism the currently open code wrf hydro is a multi core parallel multi physics multi scale fully distributed hydraulic model it is originally proposed as a hydrologic extension of the wrf model gochis et al 2015 lsm i e noah or noah mp in wrf hydro provides the lateral and boundary conditions water and energy fluxes of the sub grid by a 4 layer soil column to interact with the atmospheric boundary layer and the vegetation layer a describing of the lateral flow is an extra supplement of wrf hydro which is combined with subsurface overland channel and the aquifer discharge recharge wigmosta et al 1994 the multi scale 3d land surface hydrologic simulation mode can further improve the column only one dimensional vertical structure of soil gochis et al 2018 wrf hydro could run independently with meteorological data or be coupled with the wrf model referred to as the standalonewrf hydro or the fully coupled wrf wrf hydro which has been proven in practice to improve the capabilities of numerical tools in hydro meteorological forecasting ryu et al 2017 wehbe et al 2019 yucel et al 2015 when wrf hydro is coupled with wrf the one way coupling means that the variables of the wrf model output e g precipitation temperature pressure and humidity etc are considered as the input to wrf hydro and to drive the latter s calculations of the land surface and hydrological processes the fully coupling is based on the one way coupling while meanwhile the land variables e g soil moisture heat flux etc calculated from wrf hydro are fed back to the wrf to further influence the wrf calculation for the next timestep nonetheless constrained by the complexity of lsm some parameters are fixed in wrf hydro and the calibration period of sensitive parameters in runoff generation is still a top priority wagner et al 2016 naabil et al 2017 simulated the streamflow in a small catchment of west africa using the standalone wrf hydro and found that the flow had a rapid fallback that did not match the reality lin et al 2018 assesses the performance of wrf hydro in terms of its high resolution simulation of streamflow for dry and wet regions over texas it was found that wrf hydro was aridity dependent i e streamflow was better predicted in wet regions than dry regions the improvement would require synergistic enhancements of evapotranspiration soil moisture and groundwater parameterisations such as infiltration and lateral transport of water storage variables in the current model configuration xiang et al 2017 used wrf hydro to simulate the atmospheric hydrologic interactions in northwest mexico from 2004 and 2013 finding that the soil moisture content and the vegetation type can influence the convective rainfall and the initial land surface condition e g soil moisture content is critical in enhancing the rainfall forecasting systems ryu et al 2017 applied wrf hydro to simulate flash floods in the namgang dam area in korea exploring the sensitivity of several key parameters to storm floods the standalone model was proven to have substantial errors in reproducing the temporal distribution of the flood peaks silver et al 2017 simulated five flood events in arid and semi arid regions of the usa and categorically corrected the values of the parameters by land use types the simulated flow was significantly improved after correction than using the default parameter values senatore et al 2015 carried out continuous simulations over a 3 year period in southern italy and found that the use of the fully coupled wrf wrf hydro could produce higher soil water content and lower surface runoff than the wrf model kerandi et al 2018 also conducted a study of the fully coupled wrf wrf hydro system in an east african watershed and found that rainfall in the coupled system may be influenced by extraterritorial water vapor advection but did not vary much wehbe et al 2019 analysed a 3 day extreme event in a drought prone region of the uae and the simulated rainfall showed that the trends of the root mean square error and the relative error of were reduced in the fully coupled wrf wrf hydro system compared to the wrf putting aside the complexity of the coupling systems the above results have shown that there is still much room for the improvement in the representation of the land surface hydrologic processes in wrf hydro this study proposes an improved wrf hydro regional runoff scheme for characterising the land surface hydrologic processes with the mixed mechanisms of infiltration excess and saturation excess runoff generation enlightened by the structures of the lumped heibei model an infiltration capability distribution curve is adopted with the consideration of the changing effect of the top soil moisture during the rainstorm leakage loss is taken into account in the river routing considering the relatively dry conditions of the river channels a merging method of radar and rain gauge observations is adopted to provide improved rainfall forcing for calibrating key parameters controlling the runoff generation in wrf hydro typical rainstorm events are selected from two semi humid and semi arid catchments in northern china for model calibration and validation and long period simulations are also carried out for testing the performance of the one way and the fully coupled wrf wrf hydro system it is attempted to disentangle the impacts of the changes caused by the newly developed runoff scheme in the wrf wrf hydro system the study provides a way to transplant equations or modules from sophisticated hydrological models to the wrf wrf hydro system in order to enhance the performance of the atmospheric hydrologic coupling system for rainfall runoff modeling 2 improvements for the mixed runoff generation in wrf hydro floods in the mixed runoff generation area usually have three characteristics 1 high intensity and short duration 2 high local sensitivity and spatial temporal variability 3 close correlation with the topographic features such as the land use type and the soil texture especially in mountainous areas these characteristics pose great challenges to the performance of the coupled atmospheric hydrologic system in rainfall runoff modeling the mismatch between the coupled system and the reality in terms of the description of the runoff generation usually leads to inaccurate flood simulations in the mixed runoff generation area according to hillel 2013 and brutsaert 2005 the infiltration process can be defined as the movement of water into the soil surface and subsequently in the soil profile in the mixed runoff generation area with complicated mechanisms of infiltration excess and saturation excess infiltration is a critical process that to some extent dominates the accuracy of the coupled atmospheric hydrologic system the description of the infiltration process determines the kinetic characteristics of the water fluxes into the soil profile which in turn affects surface radiation and evapotranspiration therefore further influences the redistribution of the surface precipitation for many rivers in the mixed runoff generation area of northern china the characteristics of the substratum and the spatial temporal diversity of rainfall has led to the existence of many perennial waterless rivers which results in channel losses during the flood confluence in such cases it is also necessary to take the channel leakage loss into account during river routing 2 1 original principles in wrf hydro for runoff generation a mixed mechanism is currently adopted in wrf hydro to describe the runoff generation which can be divided into 3 components a the infiltration excess surface runoff b the saturated subsurface runoff and c the groundwater free outflow the description of infiltration excess follows the assumption that the surface runoff is generated in excess of infiltration when the infiltration of the grid during the integration time step is greater than the corresponding net grid rainfall in addition to infiltration excess the mechanism of saturation excess is also involved a water outlet is provided at the bottom of each grid column to simulate the free drainage of the subsoil during the integration period as infiltration increases the groundwater level in the soil column gradually accumulates and when the value of the groundwater level is higher than the set maximum level i e the soil water content exceeds the saturated soil water content of the indicated soil column full flow will occur and the water above the water level of the soil column will again return to the surface and participate in subsequent routing the infiltration capacity vf in wrf hydro is calculated as follows 1 v f k 1 n δ z k s m max s m min 1 s m k s min s m max s m min 1 e r kdt δ t 86400 2 r kdt s m max r efkdt r efdk eqns 1 2 are derived from the simple water balance swb model proposed by schaake et al 1996 k is the number of soil layers δ z m is the thickness of the uppermost soil layer δ t is the time step s s m k m3 m3 is the soil water content of each layer s m m a x m3 m3 is the maximum soil water content s m m i n m3 m3 is the minimum soil water content at the cessation of transpiration r kdt is the saturation hydraulic conductivity r efkdt m s is the infiltration coefficient of soil r efdk m s is a empirical runoff infiltration coefficient the equations presented above give a scheme for calculating the infiltration capacity of each grid cell which is constrained by the saturation hydraulic conductivity r kdt in the model at each grid cell the amount of infiltration per unit time f mm and the amount of surface runoff rs mm can be expressed as follows 3 f i max v f i max v f δ t 4 r s m a x i max i max v f i max v f δ t 0 where imax m is the highest surface water level value i e the net rainfall deducting evaporation retention and infiltration which can be derived from the water balance equation 2 2 equations of the infiltration excess mechanism and the channel leakage loss wrf hydro introduces a large number of experimental soil hydraulic parameters in the description of the infiltration process which are fixed at the specific simulation and partly relied on local experimental results even if the model is structurally feasible in the very few current studies that consider the influence of soil structure on the soil hydraulic properties there is still a lack of effective treatment to upgrade the local scale infiltration process to a grid scale that can be used in the atmospheric hydrologic systems vereecken et al 2019 zhao et al 2019 therefore there is a need to find easily accessible expressions of parameters that could reflect the actual infiltration process and its spatial heterogeneity tian et al 2020 for the watersheds with mixed runoff generations of both infiltration excess and saturation excess this need seems to be particularly urgent the lumped hebei model is a widely applied rainfall runoff model in the mixed runoff generation areas of northern china tian et al 2020 tian et al 2019 fig 1 shows the model structure with key parameters of the model it considers both the infiltration excess and the saturation excess runoff generation by adopting two distribution curves to describe the spatial variability of the infiltration capacity and the soil water storage capacity across the whole watershed in this study the successful experiences of the lumped hebei model are learned and tried to be transplanted into wrf hydro the following sections describe the improvements made to wrf hydro which include an infiltration equation that takes into account the changing effect of the surface soil water moisture during the rainstorm a spatially discrete equation for infiltration capacity that incorporates the concept of the topographic index ti and a correlation equation that takes into account the channel leakage losses during routing the following sections describe the improvements made to wrf hydro which include an infiltration equation that takes into account the changing effect of the surface soil water moisture during the rainstorm a spatially discrete equation for infiltration capacity that incorporates the concept of the topographic index ti and a correlation equation that takes into account the channel leakage losses during routing the merged rainfall from weather radar and rain gauges are used to calibrate key parameters in order to get more realistic simulations the improvements made in this study on the wrf hydro structure are shown in fig 2 2 2 1 the infiltration equation considering the changing effect of the surface soil moisture in the lumped hebei model a parabolic infiltration capacity distribution curve is used to reflect the spatial distribution of the infiltration capacity over the watershed as shown by eqn 5 it is assumed that the infiltration capacity at different points of the watershed follows this distribution in space 5 γ f f m n where γ is the ratio of the area with the infiltration capacity less than a certain value to the total area of the watershed f is the infiltration capacity fm is the largest infiltration capacity over the watershed a non sensitive parameter with a default value of 120 mm in north china and n is the infiltration curve coefficient by integrating eqn 5 the average infiltration rate fa across the watershed is obtained 6 f a p p 1 n f m n 1 n where p is the rainfall intensity mm h when p fm the above equation can be deduced to 7 f a f m f m 1 n as the surface soil is gradually wetted during the rain the distribution curve of the infiltration capacity is bound to change accordingly by analysing the rainfall runoff relations in semi arid and semi humid regions of north china the infiltration capacity with the consideration of its spatial variability is conceptualised in the lumped hebei model as follows chen and han 2003 han 2002 8 f m e u s m f c where fc is the stable infiltration rate which is between 1 and 2 mm h in the general mountainous area and around 5 mm h in the karst mountainous area sm is the soil moisture content of the surface layer m is the starting infiltration rate mm h u is the adjustment factor of the surface soil moisture content ranging from 0 1 to 0 3 let m fa the above equation can be further deduced to 9 f p p 1 n f m 1 n e u s m f c eqn 9 in the lumped hebei model is therefore introduced in the wrf hydro s lsm noah mp to calculate the infiltration process within a grid cell the precipitation intensity p is spatially replaced by the grid net rainfall imax the results of the soil moisture contents are calculated from the richard equation as well as the quasi 3d flow groundwater dispersion equation which remains unchanged from the original model for the treatment of the surface soil moisture content as most of the infiltration fronts of the rainstorms that happened in hebei province are below 50 cm and very few of them can reach 1 m sm is replaced by the sum of the water contents of the top 3 soil layers i e s m k 1 3 sm k where sm is the soil water content and k is the number of the soil layers in the lsm model the remaining soil parameters are based on the official default values which are not currently adjustable the study area is relatively homogeneous in terms of land uses with brown soils dominating and a small proportion of brown loams which reduces the dependence on these soil parameters therefore with the improvement the main one dimensional parameters to be calibrated include the adjustment factor u for the surface soil moisture content and the infiltration distribution curve factor n 2 2 2 the spatial discretisation equation of the infiltration capacity based on the topographic index in the lumped hebei model the distribution curve is used to describe the spatial variability of the infiltration capacity across the watershed when the above infiltration equation is transplanted into wrf hydro it is necessary to discretize the infiltration capacity on the grid topmodel beven 1979 provides a simple physical expression of the relation between the geomorphic characteristics and the hydrologic responses in topmodel the runoff generation is based on the concept of the topographic index ln α tanβ where α is the area drained per unit contour length and β is the local slope angle the topographic index can directly reflect the spatial distributions of the saturated and deficit soil water in the watershed based on this idea it is assumed that areas with similar topographic indices have the same hydrological responses according to experimental simulations carried out in north china it is found that there exists a statistical correlation between the infiltration capacity of the lumped hebei model and the topographical index tian et al 2019 which can be expressed as follows 10 f i f m 1 1 e x p ln t i i t i min 1 α β b 1 n where ti is the topographic index of a certain grid cell timin is the minimum topographic index of the calculating area b is the index of the infiltration capacity the parameters that need to be calibrated are b α and β using this equation the infiltration capacity distribution curve of the lumped hebei model can be discretised across the watershed by knowing the topographic index the grid cell fi calculated by the above equation is considered as fm in eqn 9 the spatial distributions of ti need to be calculated before wrf hydro is run with the parameters of timin α and β to discretise the infiltration capacity and the calculations of ti need to cover the entire sub domain of wrf when wrf hydro is run the calculated ti is then interpolated into the wrf hydro soil file via earth system model framework esmf 2 2 3 the leakage loss equations for the channel routing the solution for channel leakage loss is derived from lahmers et al 2019 the muskingum cunge method is provided in wrf hydro to calculate the channel routing this method uses the time varying parameter estimates and assumes that the backwater effect can be neglected from upstream to downstream the stream order is derived by the strahler channel segmentation cunge 1969 learned from the lumped hebei model the following mc equation is used instead to consider the channel leakage loss during river routing 11 q j 1 n 1 c 0 q j n c 1 q j n 1 c 2 q j 1 n qdt d c hl where j and j 1 denote the j th and j 1 th period respectively n and n 1 denote the n th and n 1 th river cross sections q is the calculated streamflow c0 c1 and c2 represent the evolution coefficients of the river qdt is the flow at the corresponding integration moment d is a factor which reflects the influence of the inflow to the river storage the channel loss chl ldksatpedx as shown in fig 3 where pe is the modified wet perimeter determined by a combination of the river width bw the water level h and the river side slope chslp i e p e min h b w 1 b w h 2 c hslp 2 c hslp 2 1 dx is the corresponding channel length dksat is the hydraulic conductivity coefficient and l is the channel leakage loss factor which ranges from 0 to 1 regulating the degree of channel loss the advantage of using this leakage loss equation is the above parameters can all be derived from the original wrf hydro only except l 3 study site forcing data and model configuration 3 1 study site and rainstorm events the daqing river basin as illustrated in fig 4 is a typical representative of the flood prone mixed runoff generation area in china and it has a controlled area of 43 060 km2 and 42 of the basin is mountainous the steep mountainous terrain and the narrow channels which are mostly fan shaped has led to severe historical floods with short routing times and high peaks two medium sized mountainous catchments i e fuping and zijingguan in upstream of the north and south branches of the daqing river is selected as the study sites as shown in fig 4 the fuping catchment covers an area of 1760 km2 with the elevation changing from a minimum of 519 m to a maximum of 2105 m and the zijingguan catchment covers an area of 1760 km2 with elevation ranging between 519 m and 2105 m the study catchments are characterised by a temperate continental monsoon climate with rainfall concentrated from late may to early september and the soil type is mainly brown soil with bare vegetation the region is dominated by convective rainfall in the summer season due to the combined effect of the western pacific subtropical high pressure the westerly band of cold eddies and the uplift of the taihang mountains rainfall runoff data of the fuping and zijingguan catchments from 2005 to 2018 are collated table 1 typical rainstorm events in terms of meteorological causes rainfall of intensity ephemeris and zone ephemeris are selected for the simulation it is difficult to select rainstorm events in the study area especially in the last decade rainfall in the fuping and zijingguan catchments was at a historically low level and certain storms with large rainfall rates did not generate high flood peaks due to the relatively dry underlying conditions for these reasons 10 rainstorm events are selected based on rainfall runoff observations from 2005 to 2018 for model calibration and validation these 10 typical events have different spatial and temporal homogeneities and different flood magnitudes which are then used for calibration and validation of the wrf hydro parameters three long rainfall runoff periods in 2012 2016 and 2018 are subsequently used to verify the improvements of the wrf hydro structure for rainfall runoff modeling by the coupled wrf wr hydro system the observed rainfall and hydrographs of the three long periods are shown in fig 5 which reflect different degrees of complexity of the mixed runoff generation in the study sites the observed rainfall and hydrographs of the three long periods are shown in fig 5 which reflect different degrees of complexity of the mixed runoff generation in the study sites the flood of 2012 period 1 had the highest peak 2580 m3 s with a steep rise and fall which was caused by a strong convective rainstorm with very large intensity in this circumstance the generation of the flood was dominated by the infiltration excess mechanism the year of 2016 had more rainfall in july resulting in a flood peak 581 m3 s on 20 july followed by a higher peak 1760 m3 s on 25 july this multi peaked process was more likely caused by a composite effect of infiltration excess and saturation excess mechanisms the flood process in 2018 period 3 is characterised by frequent but relatively lower rainfall at the beginning after the maximum rainfall rate 14 6 mm h occurred on 22 23 july the flood peaked appeared with a small magnitude 130 m3 s which indicated the saturation excess mechanism might have played a more dominant role 3 2 wrf and wrf hydro configurations as shown in fig 4 three nested domains are created for the wrf downscaling and from the outside to the inside the resolution is 9 km dom 1 3 km dom 2 and 1 km dom 3 respectively the era interim data from the european centre for medium range weather forecasts ecmwf is used as the forcing to provide the initial and boundary fields for wrf among the wrf physical parameterisation schemes the planetary boundary layer scheme ysu yonsei university hong et al 2006 the microphysical period scheme lin pudue lin lin et al 1983 and the description of cumulus convection scheme kf kain fritsch kain 2004 are selected based on the climatic characteristics and the convective rainfall conditions in study area 39 considering that high resolution convective rainfall could be resolved explicit an additional rainfall simulation experiments were carried out to determine the switching on off issue of the cumulus convection scheme and eventually only the innermost wrf domain dom1 with 1 km resolution was switched off in this study skamarock 2008 wang et al 2021 table 2 lists the wrf basic configurations and the main parameterisation schemes used in this study the rainstorms in the study area are concentrated between july and september each year thus the selected storm events span a long period of time the rainfall runoff processes in the basin during the non flood period are highly variable and the channel leakage loss makes it difficult to carry out long period simulations to obtain the corresponding parameters to facilitate the fully coupled study of wrf wrf hydro and to obtain more accurate initial conditions for the model two warm up periods are designed in this study to assist the event based calibration the first period of 15 days is to provide reliable initial conditions for the lsm model noah mp and the second period of 24 h extended from the traditional length of 6 h based on the warm up study of chu et al 2018 is adopted for the purpose of coordinating the initial and lateral boundary fields of wrf the configurations associated with wrf hydro are shown in table 3 considering the opening of baseflow model i e a bucket model may differ significantly from the actual situation where the collection of deep subsurface runoff redistributing into the river channel in the bucket model is prone to result in additional streamflow lahmers et al 2019 therefore the baseflow model is turned off in all the simulations of this study the sub grid of wrf hydro is set to 100 m and the disaggregation aggregation scale factor is set to be 10 this means that the relevant parameters of lsm i e the maximum soil water content the lateral saturated hydraulic conductivity the infiltration excess and the soil water content of each soil layer at the lsm grid 1 km 1 km are generated and decomposed to a 100 m 100 m wrf hydro sub grid the higher resolution sub grid variables i e the ponding depth and the water content of each soil layer generated by wrf hydro overland and subsurface routing are then aggregated back into lsm and fed back to wrf thereafter influencing the boundary layer scheme and the radiation scheme in the next iteration run based on the merged rainfall inputs the key runoff generation parameters that need to be calibrated are shown in table 4 both one way and fully coupling of wrf and wrf hydro are supported by the current modeling system by stating different demands in the namelist file wrf hydro can run flexibly in either one way or coupling mode with wrf 3 3 rainfall forcing by merging qpe and rain gauge observations to improve the accuracy of the key runoff generation parameters of wrf hydro the observed rainfall is used instead of the rain field of the wrf downscaled meteorological forcing for model calibration however the rain gauge network in the two study catchments has relatively low densities 276 3 km2 for fuping and 160 km2 for zijingguan which are not enough to provide detailed information of the spatial rainfall distributions for the coupled modeling system an s band doppler weather radar located in the city of shijiazhuang as shown in fig 4 gives a full coverage of the two catchments studies have shown that merging the observations from the rain gauges and the weather radar has a great potential in providing high resolution rainfall with good qualities in both space and time liu et al 2013 liu et al 2018 tian et al 2021 in this study the merged rainfall of radar qpe quantitative precipitation estimation and gauge observations is used as the forcing of wrf hydro for model calibration the spatial resolution of the observations from shijiazhang weather radar is 1 km 1 with a scan radius of 250 km the radar completes a full scan every 6 mins at 9 scan elevation angles 0 5 1 5 2 4 3 4 4 3 6 0 9 9 14 6 and 19 5 processed reflectivity data after quality control are obtained from the national meteorological administration of china cma the power law marshall palmer relationship is used to convert the radar reflectivity z to rainfall rate r zhang et al 2008 and the values of the coefficients are shown in eqn 12 shen et al 2018 12 z 300 r 1 4 for convective rainfall z 200 r 1 6 for stratiform rainfall data merging is conducted by using the kriging with external drift ked interpolation qiu et al 2020 ked is an extension of the universal kriging interpolation method and the interpolated variable can be expressed as a sum of the deterministic drift and the random residual fields the difference is that kriging with external drift allows the interpolation of the main variable by combining multiple additional variables as the background information haberlandt 2007 wadoux et al 2017 during merging the radar qpe is considered as the only additional variable consistent with the description of the traditional kriging method but for the calculation of the specific weight factor λ i ked the ked method adds additional constraints i e data constraints related to the radar estimations to calculate the covariance of the radar field and the gauge field residuals 13 c x a b r x 14 i 1 n λ i ked 1 15 i 1 n λ i ked r x i r x 0 where c x and r x conform to a linear trend with coefficients a and b and c x and r x denote to the rain gauge observation and the radar rainfall estimation at the location respectively n is the total number of the rain gauges xi is the position of rainfall gauge i and x0 is the position to be estimated the drift field in the study is obtained by processing the spatial variability of rainfall at the locations of the radar estimations by the traditional kriging method and converting the covariance matrix residual field based on the gauge locations to a spectral matrix on the whole catchment by the fast fourier transform fft transformation method nerini et al 2017 sinclair and pegram 2010 this method converts the radar data into a continuous strictly cumulative distribution while fully introducing the spatial variability of the radar data into the interpolation process of the gauge observations enabling a better representation of the spatial and temporal characteristics of rainfall erdin et al 2012 3 4 wrf hydro calibration and evaluation statistics this section introduces the calibration methodology of the wrf hydro parameters and the statistics used to evaluate the rainfall runoff simulations before after the improvements from the one way and the fully coupled wrf wrf hydro system 3 4 1 evaluation of the merged rainfall forcing the evaluation of the merged rainfall is carried out based on the hourly observations of the rain gauges the leave one out cross validation loocv vehtari et al 2017 is used to avoid duplication verification and information redundancy when conducting loocv each single rain gauge is left in turn used for validating the merged rainfall produced based on the other rain gauges considering the spatial mismatch between the gauge based observations and the grid based estimations for each rain gauge the merged rainfall estimations from the most surrounding grid cells and averaged to compare with the gauge observation the loocv methodology provides both a gauge based and an overall evaluation of the merged rainfall driven data three evaluation statistices i e bias rmse root mean square error and mrte mean root transform error are chosen cecinati et al 2017 the involvement of mrte is to prevent an overestimated error caused by rainstorms with extremely large intensity but a low frequency of occurrence in the watershed the three statistics can be calculated eqns 7 9 16 bias 1 n i 1 n p i p i 17 rmse 1 n i 1 n p i p i 2 18 mrte 1 n i 1 n p i p i 2 where pi is the i th rain gauge hourly observation n indicates the total number of rainfall gauges in the study watersheds and p i is the corresponding merged rainfall estimations from the nearest grid cells of the corresponding rain gauge the statistics of rmse and mrte range from 0 to with an optimal value of 0 while bias ranges from to with an optimal value of 0 3 4 2 wrf hydro calibration and evaluation of the flood simulation the calibration of the wrf hydro parameters is based on the parallel dynamically dimensioned search algorithm p dds tolson et al 2014 the merged rainfall estimations from radar qpe and rain gauges are used as the inputs of wrf hydro to obtain more realistic parameters the kling gupta efficiency kge coefficient gupta et al 2010 is chosen as the objective function kge balances on the correlation the water balance and the deviation error between the simulated and the observed flood processes compared to the commonly used nash efficiency coefficient nse which focuses on large flood peaks kge can also take into account the smaller flood processes which is more conducive to a comprehensive evaluation of floods gupta et al 2010 considering the limited number of floods available for model calibration in the study sites the consideration of small magnitudes of floods by this objective function facilitate the calibration of the crucial parameters of wrf hydro kge can be expressed by the following equation 19 kge 1 r 1 2 α 1 2 β 1 2 where r is the ratio of the standard deviation of the simulated data series to the observed series α is the ratio of the mean value of the simulated series to the observed series and β is the correlation coefficient between the two series when kge is equal to 1 the simulation is optimal this means that the euclidean distance from the ideal simulation series is minimal while when kge is negative the simulation is considered to be unsatisfactory gupta et al 2010 and lespinas et al 2018 explored the effective number of iterations to minimise the objective function using the dds algorithm and showed that the simulation was progressively improved between 100 and 500 iterations and that the model enhancement slowed down after 500 iterations due to the highly complicated model structure wrf hydro takes a long time to run the iterations to make the work done efficiently 100 iterations are firstly run to find the variation intervals of the optimal parameters for each rainstorm event based on which the parameter intervals are narrowed down and the results of the second run for 500 iterations are finally adopted as the calibrated parameter set due to the limited typical rainstorms available events prior to 2016 i e event 1 to 4 and event 6 to 9 are used for the model calibration and event 5 and 10 that happened in 2016 are used for validation in addition to kge the flood peak error rp the flood volume error rv and the nash efficiency nse coefficient are additionally selected to evaluate the flood simulation results from the wrf wrf hydro system the calculations of the three statistics are shown by eqns 20 22 20 nse 1 i 1 n q i q i 2 i 1 n q i q 2 21 r p q p q p q p 22 r v r v r v r v where i is the time step and n is the total number of time steps of the flood duration q i and q i are the simulated and the observed discharge series and q is the averaged value of the observed discharges q p and q p are the simulated and the observed flood peak r v and r v is the simulated and the observed flood volume 3 4 3 evaluation of the rainfall simulation to evaluate the model improvement of the fully coupled wrf wrf hydro on the rainfall simulation the statistics of rmse and mbe mean bias error are used to evaluate the temporal and spatial uniformity of the rainfall distribution rmse is calculated by eqn 17 and mbe can be expressed as 23 mbe 1 n i 1 n p i p i when calculating the statistics in the spatial dimension p i and p i refers to the watershed areal rainfall of the i th time period and n is the total number of the time periods during the rainstorm while in the temporal dimension p i and p i refers to the rainstorm accumulated rainfall at the i th rain gauge and n is the total number of rain gauges in the watershed 4 results 4 1 wrf hydro calibration using the merged rainfall forcing fig 6 illustrates the box plots of the evaluation results for the merging rainfall by using the statistics of bias rmse and mrte the mean bias value for the 10 rainstorm events of fuping and zijiangguan catchments is 0 169 indicating the merged rainfall has a slightly negative deviation from the gauge observations the mrte statistics also show a good quality of the merged data with the values of all events below 1 and a mean of 0 423 although the rmse values are slightly larger for some events especially event 8 with the largest value of 2 958 the statistic is also able to maintain at a low error level with an overall mean of 1 347 the temporal and spatial distribution of the observed and the merged rainfall is further given in fig 7 where event 1 is relative homogeneous and event 8 is inhomogeneous in both space and time for event1 the difference of the spatial rainfall is not obvious but when encountering a storm like event 8 the merged rainfall can more precisely describe the spatial distribution compared to the gauge observations based on the calibrated parameters using the merged rainfall the results of the evaluation statistics are illustrated in table 5 and fig 8 and the simulated hydrographs of the 10 rainstorm events before and after the structure improvements are shown in fig 9 the low simulations accuracy for some of the rainstorm events is mainly due to the screening of small magnitudes of floods and the fact that the flood rises and fall occurred within a few hours which made the model simulation difficult the mean value of rp increases slightly from 8 6 to 11 9 after improvements while the mean rv decreases from 23 5 to 22 5 nse decreases from 0 716 to 0 669 and kge increases from 0 502 to 0 521 after the improvements of the model structure the statistic performances also differ among different events with more obvious improvements seen in those with higher flood peaks such as event 5 and event 8 for event 8 rp is reduced the most obviously by 10 8 50 9 before and 40 1 after improvement however for event 1 and event 7 the improved structure suffers from a too fast flood receding which results in smaller flood volumes than the observations e g rv of event 7 increases from 27 3 to 52 7 after improvement event10 is a multi peaked type of flood which is poorly modelled regardless of the improved structure especially as there is a rapid receding process after the first peak is reached it can be concluded that the improved wrf hydro structure performs better for single peak floods with higher peaks but is less effective than before for multi peaked or flood processes with smaller volumes and longer recession times such as event 10 and event 3 4 2 simulations of the one way coupled wrf wrf hydro before and after improvements in order to further validate the applicability of the improved mixed runoff generation structure to long hydrological processes in the study area the simulation results from both one way and the fully coupled wrf wrf hydro are analysed and compared below based on 3 typical long periods occurring in the flood season of 2012 2016 and 2018 for the two way coupling of wrf wrf hydro due to a more complicated compling process which involves the partially open source codes of wrf the spatial discretisation of the infiltration capacity based on the topographic index described in section 2 2 2 cannot be fully realised therefore the originally adopted approach in wrf hydro proposed by schaake et al 1996 is used instead to determine the spatial distribution of the infiltration capacity nevertheless the infiltration equation considering the top soil water content and the channel leaking loss equations in the fully coupled mode are kept consistent with the one way coupling in the following result presentations discrete infiltration 1 is used to describe the improvements involving the discretisation equation proposed in this study while discrete infiltration 2 is used to describe those involving the original schaake s approach 4 2 1 streamflow simulation the simulated hydrographs of the three typical long hydrological periods before and after model improvements are shown in fig 10 both of the two improved structures with different approaches for the infiltration capacity discretization are tested for the one way coupled wrf wrf hydro system results of the flood evaluation statistics are also shown for a more quantitative comparison in table 6 it should be noted that event 8 and event 5 are respectively included in period 1 and period 2 it can be seen from fig 10 that the large peaks in period 1 and period 2 are underestimated by the one way coupled system while for the small peaks the first half of period 2 and the whole period 3 the simulated results are significantly larger than the observations this may result from the unsteady performance of the simulated rainfall from the coupled system for example the improvement in the streamflow simulation for period 3 is restricted by the wrf rainfall input which can be found in fig 10 differs significantly from the gauge observations another reason is that the improved structure works better for single peaked floods where the infiltration excess runoff generation dominates period 3 as shown in fig 5 is a multi peaked flood process with a relatively wetter soil condition and more runoff generated by the saturation excess mechanism the differences in the simulations caused by the model structure improvements can more obviously be seen for the other two periods period 1 and period 2 as shown by the statistic rp in table 6 the improved structure with discrete infiltration 1 thereafter refers to as improved structure 1 gives the best results for the all flood peaks especially for the 21 23 july flood i e event 8 in period 1 rp of the improved structure 1 is reduced to 20 8 from the original simulation with a value of 30 5 except for period 2 which is characterised by a series of small peaks followed by a considerable large peak the coefficients of nse and kge indicate the most obvious improvements for the improved structure 1 regarding the improved structure 2 the simulated flood peaks are slightly worse than the original results however rv and nse becomes better than before especially for event 8 in period 1 and event 5 in period 2 the nse coefficient is respectively improved by 0 125 and 0 337 4 2 2 analysis of the infiltration excess and saturation excess runoff generation in order to better analyse the runoff changes before and after the model improvements the infiltration excess and saturation excess runoff components are tried to be separated from the total runoff in this section in wrf hydro the amount of the infiltration can be expressed as the sum of the local infiltration and the re infiltration where the local infiltration refers to the infiltration in the vertical direction and is controlled by the infiltration equation corradini et al 1998 as shown by eqn 3 or eqn 9 while the re infiltration is caused by the lateral transport of water beyond the storage capacity of the saturated soil column during which this amount of water replenishes the unsaturated soil column along the overland routing path zhang et al 2020 the infiltration process in wrf hydro are illustrated in fig 11 24 r se r r ie i ri r se r se 0 i ri 0 r se 0 since the amount of water in the lateral transport process and the re infiltration process cannot be directly separated in the model the strategy adopted here to facilitate the analysis is to compare the differences of the simulation results by switching on off the routing module in wrf hydro when the routing module is switched on the total runoff r is obtained which contains both the infiltration excess runoff r ie and the saturation excess runoff r se r ie is composed of water from the local infiltration and the re infiltration processes when the routing module is switched off any infiltration excess amount has no chance to re infiltrate into the other unsaturated soil column meaning that there is only local infiltration in the system and the infiltration excess runoff r ie can therefore be obtained the saturation excess runoff r se is then calculated by subtracting the infiltration excess runoff r ie from the total runoff r as shown by eqn 24 when the calculated r se is negative it means there is no generation of the saturation excess runoff and the difference between r and r ie equals to the re infiltration amount i ri it is important to note that this approach is only intended to provide an easy way to separate the different components of the generated runoff the positive and negative values show an overall state of the catchment during a specific period of time with the resulted r se or i ri values indicating that the area is dominated by either the saturation excess runoff generation or the re infiltration in practice saturation excess and re infiltration may happen simultaneously at different areas of the catchment water accumulates quickly in the piedmont area to generate the saturation excess runoff meanwhile re infiltration still happens in the downstream area where the soil is not yet saturated the separated processes of the infiltration excess and saturation excess runoff generation for the 2012 long period i e period 1 including event 8 from the one way coupled wrf wrf hydro are shown in fig 12 specific quantities for each runoff components are further given in the table 7 in the north western parts of the study area the high elevations and the steep slopes of the taihang mountain encourage more water to drain quickly in the downstream river network this is more conducive to the generation of the saturation excess runoff which may be the reason why the re infiltration values are found to be zero in table 7 comparisons are also made between results before and after the model improvements with the improved structure 1 it can be seen that the improved wrf hydro results in an increase of the infiltration excess runoff and a decrease of the saturation excess runoff with respectively a 20 38 mm increase and a 20 58 mm decrease over the long period for event 8 the infiltration excess runoff is also increased by 7 94 mm and the saturation excess runoff is decreased by 6 42 mm the improved structure helps regulate the proportions of different runoff components and to some extent emphasizes the infiltration excess mechanism for the mixed runoff generation this can partly explain why the improved wrf hydro obtains a higher flood peak and a better nse value 4 3 simulations of the fully coupled wrf wrf hydro before and after improvements due to the limitations of the current code openness in wrf it is not possible to implement the spatial discretisation of the infiltration capacity based on the topographic index in the fully coupled system therefore the above mentioned improved structure 2 which remains the schaake s approach eqns 3 is used to examine the improvements of the full coupled system caused by the infiltration equation considering the changing of the top soil water content and the river channel leakage loss equations the simulated streamflow together with the cumulative rainfall from the standalone wrf and the fully coupled wrf wrf hydro system before and after improvements is shown in fig 13 it can be seen that both wrf and the fully coupled system tend to overestimate the cumulative rainfall during the long time simulations among the three periods the 2012 period period 1 shows the closet cumulative amounts to the observations the differences of the cumulative rainfall are found to be the most pronounced with the 2016 period period 2 among the results from the standalone wrf and the coupled system before and after improvements compared to the wrf cumulative amount 333 2 mm the coupled system with the improved structure increases the amount to 369 2 mm it seems that the improved structure does not show any positive effect on the cumulative rainfall for the long time simulation however counting only the 3 day event event 8 in period 1 the relative error re of the cumulative rainfall is reduced from 63 3 the standalone wrf to 53 4 with the fully coupled system before improvements and further reduced to 31 6 with the system after improvements results of the spatial and temporal rainfall evaluation statistics by wrf and the coupled system are further given in table 8 the improved structure shows both advantages and disadvantages for different periods and events for the rmse statistic the fully coupled system fails to significantly enhance the simulation accuracy of rainfall whether in space or in time and is even worse in some cases however the statistic mbe which takes into account the directionality of the error shows that the fully coupled system is better than the standalone wrf and the improved structure has the lowest mean error for both spatial and temporal evaluations the flood evaluation statistics for the three long periods before and after improvements are shown in table 9 the simulated streamflow from the two way coupled system shows similar trends with the one way couple system in general the improved model structure also generates better flood simulations with the two way coupled system the nse coefficients of all the three long periods are much improved and the statistic of rp is also reduced for both period 1 and period 2 the most obvious improvements are found in period 1 with rp decreased from 32 2 to 23 7 and nse increased from 0 519 to 0 607 5 discussion due to the complex conditions of the climatology and the underlying surface in the mixed runoff generation region the water and heat exchange is intense through the land atmospheric interface the accuracy of the flood simulation in such area depends on three main factors firstly the spatial and temporal distribution of the simulated rainfall secondly the land surface hydrologic model such as wrf hydro the error of which normally comes from the physical structure of the model and the calibration of the sensitive parameters and finally the complexity of the flood processes including the magnitude of the flood peak the presence or absence of the baseflow the length of the recession process etc in this study attempts are made to improve the runoff generation structure of wrf hydro by transplanting equations from the traditional lumped hebei model and meanwhile to improve the calibration of sensitive parameters by using rain gauge and radar merged observations the simulation results of streamflow for the three long periods are not satisfactory in this study for both the one way and the fully coupled system before and after improvements the generation of saturation excess runoff can be found due to the lateral water transport in rain free periods after the flood peaks which obviously deviates from the actual situation both wrf and the fully coupled system tend to overestimate the cumulative rainfall as well as the soil water content moreover the northwestern part of the study catchments is mountainous with steep slopes where the confluence module promotes faster water pooling in the downstream river channel and therefore is more conducive to the occurrence of the saturation excess runoff generation meanwhile the considerable errors in the streamflow simulation of the three long periods also suggest that the calibrated parameters may not be entirely suitable for long term simulations the inaccuracy of the parameters to some extent affects the simulated rainfall magnitude through the feedback between wrf and wrf hydro in the fully coupled system model parameters and the model structure may need to be adjusted during the long period simulation for instance the subsurface routing module can be turned off and constraint equations or corresponding attenuation modules can be added to accelerate the attenuation of the soil water content during the rain free period on the premise of the overall catchment water balance nevertheless the improved structure has shown great potential in improving the simulations of floods with large magnitude as well as the spatial distribution of rainfall for the fully coupled system compared with the original wrf hydro the improved structure changes the mixed runoff generation mechanism by increasing the infiltration excess runoff proportion and decreasing the saturation excess part it is proven in this study that with the improved structure both the one way and the fully coupled system can produce higher flood peaks and lower nse values subsequent studies need to be carried out to further verify the effectiveness of the improved model structure proposed in this study first the spatial discretisation of the infiltration capacity is based on the topographic index the value of which may vary at different spatial resolutions therefore the discretisation results should be tested with different grid scales second the improved structure proposed in this study is not fully realised in the fully coupled wrf wrf hydro system which also needs to be further verified with the improvement of the code openness of wrf third the spatial distribution of the key runoff generation parameters such as those related to infiltration and the lateral water transportation as well as the aggregation disaggregation factor need to be further explored with the improved wrf hydro structure in order to produce more realistic rainfall runoff simulations finally the purpose of the study is to introduce an improved structure for wrf hydro and to prove its adaption to runoff generation with mixed mechanisms more efforts are needed to further enhance the model performance especially for floods with small magnitudes and multi peaks where the saturation excess runoff generation dominates 6 conclusions the coupled wrf wrf hydro system provides an efficient way to acquire high resolution rainfall and timely flood forecasts in the mixed runoff generation regions with complicated rainfall runoff transformation mechanisms there is still room for wrf hydro to improve in representing the land surface hydrologic processes enlightened by the structure of the lumped heibei model this study proposes an improved structure for characterising the mixed mechanisms with both infiltration excess and saturation excess runoff generation the infiltration equation considering the changing effect of the surface soil moisture the spatial discretisation equation of the infiltration capacity and the leakage loss equations for the channel routing are introduced into wrf hydro a merging method of radar and rain gauge observations is also adopted to provide improved rainfall forcing for calibrating key parameters of the improved structure the improved structure is then verified by typical storm events and long time periods selected from semi humid and semi arid catchments of northern china the improved structure has shown great potential in improving the simulations of floods with high peaks and steep rises and falls compared with the original wrf hydro the improved structure changes the mixed runoff generation mechanism by increasing the infiltration excess runoff proportion and decreasing the saturation excess part results from both the one way and the fully coupled wrf wrf hydro system have demonstrated the suitability of the improved structure for rainfall runoff processes dominated by the infiltration excess runoff generation however it may have a problem of receding too quickly for small scale floods and producing more saturation excess runoff in the recession process this study provides an attempt to transplant equations or modules from conceptual hydrological models to the coupled wrf wrf hydro system to enhance its performance in rainfall runoff modeling similar studies need to be carried out to further verify the generalisation of the proposed structure in other mixed runoff generation catchments with different climatic and hydrologic conditions credit authorship contribution statement wei wang conceptualization methodology visualization writing original draft writing review editing jia liu conceptualization methodology writing original draft writing review editing bin xu data curation investigation chuanzhe li data curation writing review editing yuchen liu visualization writing review editing fuliang yu supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was funded by the national natural science foundation of china 51822906 the national key research and development project 2017yfc1502405 and the major science and technology program for water pollution control and treatment 2018zx07110001 
3183,the coupled atmospheric hydrologic systems help achieve deeper understanding on the interactions between the atmospheric and land surface processes improve the spatial and temporal accuracy of hydrologic forecasts and extend the forecast leading time wrf hydro is nowadays a widely used hydrologic module to be coupled with the mesoscale numerical weather model wrf for atmospheric hydrologic research and applications the structure of wrf hydro is improved and expanded in this study to better adapt to the complicated rainfall runoff transformation mechanism in the mixed runoff generation regions the infiltration parameterisation is replaced by an infiltration equation that takes into account the impact of the surface soil moisture variation on the infiltration capacity and the spatial discretisation of the infiltration capacity from a distribution curve is achieved based on the conception of the topographic index for the runoff convergence the river channel leakage loss is introduced into the muskingum cunge mc streamflow calculations with variable parameters in time efforts are also made to reduce parameter calibration errors in wrf hydro the accuracy of the wrf rainfall forcing is improved by merging weather radar and rain gauge observations using the kriging with external drift ked interpolation tool the key parameters of wrf hydro are then calibrated using the improved rainfall forcing with the merging observations the performance of the improved wrf hydro structure is explored in both one way and the fully coupled modes with the wrf model typical rainstorm events are selected from semi humid and semi arid catchments of northern china as case studies results have shown that the improved wrf hydro is more effective in simulating floods with high peaks and steep rises and falls but a problem is also shown of receding more quickly for low peaks the improved model structure has changed the proportion of the mixed runoff generation in the long term there is an increase in the infiltration excess runoff generation and decrease in the saturation excess amount both the one way and the fully coupled wrf wrf hydro systems have demonstrated the suitability of the improved structure for rainfall runoff processes dominated by the infiltration excess runoff generation keywords wrf wrf hydro rainfall runoff simulation improved structure mixed runoff generation infiltration 1 introduction an atmospheric hydrologic coupling system enables rapid acquisition of high resolution rainfall data and timely forecasting of floods the complicacy of an atmospheric hydrologic coupling system is determined by the specific implementation of the atmospheric model the land surface model lsm and the hydrologic model on one hand hydrologic models range from lumped semi distributed to fully distributed ones according to the degree of interpretation of reality the multiplicity of laws in the model that constrains the expressions of the physical processes brings differences essou et al 2016 yang et al 2000 and how the spatial information is described further affects the complexity and flexibility of the model cho and engel 2017 fatichi et al 2016 song et al 2015 on the other hand although most lsms and hydrologic models contain similar land surface processes the descriptions of the same processes and their purposes are not the same gudmundsson et al 2012 haddeland et al 2011 in the past lsms are generally coupled to atmospheric models to solve the surface energy balance equations and to provide the atmospheric models with lateral and boundary conditions such as radiation and fluxes sharma et al 2019 wood et al 2011 therefore the expression of the soil is generalised vertically in contrast hydrologic models are less concerned with energy changes but pay more attention to water changes i e the lateral transport of water along the surface a further issue that should not be overlooked is the difference of resolution between the lsms and the hydrologic models while atmospheric models can provide high resolution data input to lsms including rainfall 1 km 25 km depending on the study area hydrologic models require more stringent resolution below 1 km to reflect the variability of runoff over the catchments there have been extensive explorations of the atmospheric hydrologic coupling systems for rainfall runoff modeling and forecasting they have experienced a transition from ideal experiments to regional studies in a broader sense however there still exist many issues to be resolved one of them is the hydrologic model s generalisation of the runoff generation mechanisms especially the mixed mechanism with the consideration of both infiltration excess and saturation excess differs substantially from reality bao et al 2009 yucel et al 2015 to date the identification and construction of the runoff generation mechanisms is still a worthy question for investigating in hydrologic modeling various model structures have been developed to deal with different spatial scales time scales and applications for example the sacramento model sac uses variable permeable area and saturated infiltration rate to reflect the mixed runoff generation mechanisms vrugt et al 2006 the vertical mixed runoff model vmm combines the infiltration excess and saturation excess runoff periods in the vertical direction bao and zhao 2014 the improved generalised catchment load function model gwlf replaces the fixed conductivity coefficients with functional equations to better estimate hydrological conditions in the mixed runoff generation areas sha et al 2014 the variable infiltration xinanjiang model vxm integrates the vic infiltration equation into the original xinanjiang model xinmin et al 2003 the lumped hebei model lhm uses the refined horton empirical equation in the infiltration process to consider the changes of the top soil moisture before the saturation excess happens han 2002 the vic 3l model introduces an infiltration excess and saturation excess curve assuming that the infiltration excess runoff occurs over a non full saturation soil liang and xie 2001 su and xie 2003 and the wrf hydro model includes a simple water balance production scheme sipm based on the experimental derivation of soil hydraulics in conjunction with the richards equation to describe the runoff mixed generation mechanism schaake et al 1996 for the above models with mixed runoff generation structures sac couples the infiltration excess and saturation excess processes based on a two soil layer structures with different storage capacities for estimating infiltration from the upper to the lower layer but neglects the local runoff generation problem finnerty et al 1997 vmm takes into account the spatial distribution of runoff by adopting the infiltration and storage capacity distribution curves but the soil water interaction between surface and subsurface is not considered as spatially variable bao and zhao 2014 the gwlf vxm and lhm model suffers from similar deficiencies which are to some extent determined by the lumped model structures in contrast gridded or distributed hydrologic models have obvious advantages in characterising the spatial heterogeneity of hydrologic variables but are also found to have limitations for example although the distributed vic 3l is able to address the local runoff issue and the interactions between different runoff generation interfaces it does not provide a complete module of runoff generation and lacks descriptions for the lateral transport of the soil water the coupling of lsm with the hydrologic model seems to provide a satisfactory solution but as mentioned above the difference in their focus of the land surface processes and purposes determines that their coupling scales are not consistent wrf hydro is currently one of the few modeling systems that provide a feasible coupling between lsm and the hydrologic model with the consideration of a mixed runoff generation mechanism the currently open code wrf hydro is a multi core parallel multi physics multi scale fully distributed hydraulic model it is originally proposed as a hydrologic extension of the wrf model gochis et al 2015 lsm i e noah or noah mp in wrf hydro provides the lateral and boundary conditions water and energy fluxes of the sub grid by a 4 layer soil column to interact with the atmospheric boundary layer and the vegetation layer a describing of the lateral flow is an extra supplement of wrf hydro which is combined with subsurface overland channel and the aquifer discharge recharge wigmosta et al 1994 the multi scale 3d land surface hydrologic simulation mode can further improve the column only one dimensional vertical structure of soil gochis et al 2018 wrf hydro could run independently with meteorological data or be coupled with the wrf model referred to as the standalonewrf hydro or the fully coupled wrf wrf hydro which has been proven in practice to improve the capabilities of numerical tools in hydro meteorological forecasting ryu et al 2017 wehbe et al 2019 yucel et al 2015 when wrf hydro is coupled with wrf the one way coupling means that the variables of the wrf model output e g precipitation temperature pressure and humidity etc are considered as the input to wrf hydro and to drive the latter s calculations of the land surface and hydrological processes the fully coupling is based on the one way coupling while meanwhile the land variables e g soil moisture heat flux etc calculated from wrf hydro are fed back to the wrf to further influence the wrf calculation for the next timestep nonetheless constrained by the complexity of lsm some parameters are fixed in wrf hydro and the calibration period of sensitive parameters in runoff generation is still a top priority wagner et al 2016 naabil et al 2017 simulated the streamflow in a small catchment of west africa using the standalone wrf hydro and found that the flow had a rapid fallback that did not match the reality lin et al 2018 assesses the performance of wrf hydro in terms of its high resolution simulation of streamflow for dry and wet regions over texas it was found that wrf hydro was aridity dependent i e streamflow was better predicted in wet regions than dry regions the improvement would require synergistic enhancements of evapotranspiration soil moisture and groundwater parameterisations such as infiltration and lateral transport of water storage variables in the current model configuration xiang et al 2017 used wrf hydro to simulate the atmospheric hydrologic interactions in northwest mexico from 2004 and 2013 finding that the soil moisture content and the vegetation type can influence the convective rainfall and the initial land surface condition e g soil moisture content is critical in enhancing the rainfall forecasting systems ryu et al 2017 applied wrf hydro to simulate flash floods in the namgang dam area in korea exploring the sensitivity of several key parameters to storm floods the standalone model was proven to have substantial errors in reproducing the temporal distribution of the flood peaks silver et al 2017 simulated five flood events in arid and semi arid regions of the usa and categorically corrected the values of the parameters by land use types the simulated flow was significantly improved after correction than using the default parameter values senatore et al 2015 carried out continuous simulations over a 3 year period in southern italy and found that the use of the fully coupled wrf wrf hydro could produce higher soil water content and lower surface runoff than the wrf model kerandi et al 2018 also conducted a study of the fully coupled wrf wrf hydro system in an east african watershed and found that rainfall in the coupled system may be influenced by extraterritorial water vapor advection but did not vary much wehbe et al 2019 analysed a 3 day extreme event in a drought prone region of the uae and the simulated rainfall showed that the trends of the root mean square error and the relative error of were reduced in the fully coupled wrf wrf hydro system compared to the wrf putting aside the complexity of the coupling systems the above results have shown that there is still much room for the improvement in the representation of the land surface hydrologic processes in wrf hydro this study proposes an improved wrf hydro regional runoff scheme for characterising the land surface hydrologic processes with the mixed mechanisms of infiltration excess and saturation excess runoff generation enlightened by the structures of the lumped heibei model an infiltration capability distribution curve is adopted with the consideration of the changing effect of the top soil moisture during the rainstorm leakage loss is taken into account in the river routing considering the relatively dry conditions of the river channels a merging method of radar and rain gauge observations is adopted to provide improved rainfall forcing for calibrating key parameters controlling the runoff generation in wrf hydro typical rainstorm events are selected from two semi humid and semi arid catchments in northern china for model calibration and validation and long period simulations are also carried out for testing the performance of the one way and the fully coupled wrf wrf hydro system it is attempted to disentangle the impacts of the changes caused by the newly developed runoff scheme in the wrf wrf hydro system the study provides a way to transplant equations or modules from sophisticated hydrological models to the wrf wrf hydro system in order to enhance the performance of the atmospheric hydrologic coupling system for rainfall runoff modeling 2 improvements for the mixed runoff generation in wrf hydro floods in the mixed runoff generation area usually have three characteristics 1 high intensity and short duration 2 high local sensitivity and spatial temporal variability 3 close correlation with the topographic features such as the land use type and the soil texture especially in mountainous areas these characteristics pose great challenges to the performance of the coupled atmospheric hydrologic system in rainfall runoff modeling the mismatch between the coupled system and the reality in terms of the description of the runoff generation usually leads to inaccurate flood simulations in the mixed runoff generation area according to hillel 2013 and brutsaert 2005 the infiltration process can be defined as the movement of water into the soil surface and subsequently in the soil profile in the mixed runoff generation area with complicated mechanisms of infiltration excess and saturation excess infiltration is a critical process that to some extent dominates the accuracy of the coupled atmospheric hydrologic system the description of the infiltration process determines the kinetic characteristics of the water fluxes into the soil profile which in turn affects surface radiation and evapotranspiration therefore further influences the redistribution of the surface precipitation for many rivers in the mixed runoff generation area of northern china the characteristics of the substratum and the spatial temporal diversity of rainfall has led to the existence of many perennial waterless rivers which results in channel losses during the flood confluence in such cases it is also necessary to take the channel leakage loss into account during river routing 2 1 original principles in wrf hydro for runoff generation a mixed mechanism is currently adopted in wrf hydro to describe the runoff generation which can be divided into 3 components a the infiltration excess surface runoff b the saturated subsurface runoff and c the groundwater free outflow the description of infiltration excess follows the assumption that the surface runoff is generated in excess of infiltration when the infiltration of the grid during the integration time step is greater than the corresponding net grid rainfall in addition to infiltration excess the mechanism of saturation excess is also involved a water outlet is provided at the bottom of each grid column to simulate the free drainage of the subsoil during the integration period as infiltration increases the groundwater level in the soil column gradually accumulates and when the value of the groundwater level is higher than the set maximum level i e the soil water content exceeds the saturated soil water content of the indicated soil column full flow will occur and the water above the water level of the soil column will again return to the surface and participate in subsequent routing the infiltration capacity vf in wrf hydro is calculated as follows 1 v f k 1 n δ z k s m max s m min 1 s m k s min s m max s m min 1 e r kdt δ t 86400 2 r kdt s m max r efkdt r efdk eqns 1 2 are derived from the simple water balance swb model proposed by schaake et al 1996 k is the number of soil layers δ z m is the thickness of the uppermost soil layer δ t is the time step s s m k m3 m3 is the soil water content of each layer s m m a x m3 m3 is the maximum soil water content s m m i n m3 m3 is the minimum soil water content at the cessation of transpiration r kdt is the saturation hydraulic conductivity r efkdt m s is the infiltration coefficient of soil r efdk m s is a empirical runoff infiltration coefficient the equations presented above give a scheme for calculating the infiltration capacity of each grid cell which is constrained by the saturation hydraulic conductivity r kdt in the model at each grid cell the amount of infiltration per unit time f mm and the amount of surface runoff rs mm can be expressed as follows 3 f i max v f i max v f δ t 4 r s m a x i max i max v f i max v f δ t 0 where imax m is the highest surface water level value i e the net rainfall deducting evaporation retention and infiltration which can be derived from the water balance equation 2 2 equations of the infiltration excess mechanism and the channel leakage loss wrf hydro introduces a large number of experimental soil hydraulic parameters in the description of the infiltration process which are fixed at the specific simulation and partly relied on local experimental results even if the model is structurally feasible in the very few current studies that consider the influence of soil structure on the soil hydraulic properties there is still a lack of effective treatment to upgrade the local scale infiltration process to a grid scale that can be used in the atmospheric hydrologic systems vereecken et al 2019 zhao et al 2019 therefore there is a need to find easily accessible expressions of parameters that could reflect the actual infiltration process and its spatial heterogeneity tian et al 2020 for the watersheds with mixed runoff generations of both infiltration excess and saturation excess this need seems to be particularly urgent the lumped hebei model is a widely applied rainfall runoff model in the mixed runoff generation areas of northern china tian et al 2020 tian et al 2019 fig 1 shows the model structure with key parameters of the model it considers both the infiltration excess and the saturation excess runoff generation by adopting two distribution curves to describe the spatial variability of the infiltration capacity and the soil water storage capacity across the whole watershed in this study the successful experiences of the lumped hebei model are learned and tried to be transplanted into wrf hydro the following sections describe the improvements made to wrf hydro which include an infiltration equation that takes into account the changing effect of the surface soil water moisture during the rainstorm a spatially discrete equation for infiltration capacity that incorporates the concept of the topographic index ti and a correlation equation that takes into account the channel leakage losses during routing the following sections describe the improvements made to wrf hydro which include an infiltration equation that takes into account the changing effect of the surface soil water moisture during the rainstorm a spatially discrete equation for infiltration capacity that incorporates the concept of the topographic index ti and a correlation equation that takes into account the channel leakage losses during routing the merged rainfall from weather radar and rain gauges are used to calibrate key parameters in order to get more realistic simulations the improvements made in this study on the wrf hydro structure are shown in fig 2 2 2 1 the infiltration equation considering the changing effect of the surface soil moisture in the lumped hebei model a parabolic infiltration capacity distribution curve is used to reflect the spatial distribution of the infiltration capacity over the watershed as shown by eqn 5 it is assumed that the infiltration capacity at different points of the watershed follows this distribution in space 5 γ f f m n where γ is the ratio of the area with the infiltration capacity less than a certain value to the total area of the watershed f is the infiltration capacity fm is the largest infiltration capacity over the watershed a non sensitive parameter with a default value of 120 mm in north china and n is the infiltration curve coefficient by integrating eqn 5 the average infiltration rate fa across the watershed is obtained 6 f a p p 1 n f m n 1 n where p is the rainfall intensity mm h when p fm the above equation can be deduced to 7 f a f m f m 1 n as the surface soil is gradually wetted during the rain the distribution curve of the infiltration capacity is bound to change accordingly by analysing the rainfall runoff relations in semi arid and semi humid regions of north china the infiltration capacity with the consideration of its spatial variability is conceptualised in the lumped hebei model as follows chen and han 2003 han 2002 8 f m e u s m f c where fc is the stable infiltration rate which is between 1 and 2 mm h in the general mountainous area and around 5 mm h in the karst mountainous area sm is the soil moisture content of the surface layer m is the starting infiltration rate mm h u is the adjustment factor of the surface soil moisture content ranging from 0 1 to 0 3 let m fa the above equation can be further deduced to 9 f p p 1 n f m 1 n e u s m f c eqn 9 in the lumped hebei model is therefore introduced in the wrf hydro s lsm noah mp to calculate the infiltration process within a grid cell the precipitation intensity p is spatially replaced by the grid net rainfall imax the results of the soil moisture contents are calculated from the richard equation as well as the quasi 3d flow groundwater dispersion equation which remains unchanged from the original model for the treatment of the surface soil moisture content as most of the infiltration fronts of the rainstorms that happened in hebei province are below 50 cm and very few of them can reach 1 m sm is replaced by the sum of the water contents of the top 3 soil layers i e s m k 1 3 sm k where sm is the soil water content and k is the number of the soil layers in the lsm model the remaining soil parameters are based on the official default values which are not currently adjustable the study area is relatively homogeneous in terms of land uses with brown soils dominating and a small proportion of brown loams which reduces the dependence on these soil parameters therefore with the improvement the main one dimensional parameters to be calibrated include the adjustment factor u for the surface soil moisture content and the infiltration distribution curve factor n 2 2 2 the spatial discretisation equation of the infiltration capacity based on the topographic index in the lumped hebei model the distribution curve is used to describe the spatial variability of the infiltration capacity across the watershed when the above infiltration equation is transplanted into wrf hydro it is necessary to discretize the infiltration capacity on the grid topmodel beven 1979 provides a simple physical expression of the relation between the geomorphic characteristics and the hydrologic responses in topmodel the runoff generation is based on the concept of the topographic index ln α tanβ where α is the area drained per unit contour length and β is the local slope angle the topographic index can directly reflect the spatial distributions of the saturated and deficit soil water in the watershed based on this idea it is assumed that areas with similar topographic indices have the same hydrological responses according to experimental simulations carried out in north china it is found that there exists a statistical correlation between the infiltration capacity of the lumped hebei model and the topographical index tian et al 2019 which can be expressed as follows 10 f i f m 1 1 e x p ln t i i t i min 1 α β b 1 n where ti is the topographic index of a certain grid cell timin is the minimum topographic index of the calculating area b is the index of the infiltration capacity the parameters that need to be calibrated are b α and β using this equation the infiltration capacity distribution curve of the lumped hebei model can be discretised across the watershed by knowing the topographic index the grid cell fi calculated by the above equation is considered as fm in eqn 9 the spatial distributions of ti need to be calculated before wrf hydro is run with the parameters of timin α and β to discretise the infiltration capacity and the calculations of ti need to cover the entire sub domain of wrf when wrf hydro is run the calculated ti is then interpolated into the wrf hydro soil file via earth system model framework esmf 2 2 3 the leakage loss equations for the channel routing the solution for channel leakage loss is derived from lahmers et al 2019 the muskingum cunge method is provided in wrf hydro to calculate the channel routing this method uses the time varying parameter estimates and assumes that the backwater effect can be neglected from upstream to downstream the stream order is derived by the strahler channel segmentation cunge 1969 learned from the lumped hebei model the following mc equation is used instead to consider the channel leakage loss during river routing 11 q j 1 n 1 c 0 q j n c 1 q j n 1 c 2 q j 1 n qdt d c hl where j and j 1 denote the j th and j 1 th period respectively n and n 1 denote the n th and n 1 th river cross sections q is the calculated streamflow c0 c1 and c2 represent the evolution coefficients of the river qdt is the flow at the corresponding integration moment d is a factor which reflects the influence of the inflow to the river storage the channel loss chl ldksatpedx as shown in fig 3 where pe is the modified wet perimeter determined by a combination of the river width bw the water level h and the river side slope chslp i e p e min h b w 1 b w h 2 c hslp 2 c hslp 2 1 dx is the corresponding channel length dksat is the hydraulic conductivity coefficient and l is the channel leakage loss factor which ranges from 0 to 1 regulating the degree of channel loss the advantage of using this leakage loss equation is the above parameters can all be derived from the original wrf hydro only except l 3 study site forcing data and model configuration 3 1 study site and rainstorm events the daqing river basin as illustrated in fig 4 is a typical representative of the flood prone mixed runoff generation area in china and it has a controlled area of 43 060 km2 and 42 of the basin is mountainous the steep mountainous terrain and the narrow channels which are mostly fan shaped has led to severe historical floods with short routing times and high peaks two medium sized mountainous catchments i e fuping and zijingguan in upstream of the north and south branches of the daqing river is selected as the study sites as shown in fig 4 the fuping catchment covers an area of 1760 km2 with the elevation changing from a minimum of 519 m to a maximum of 2105 m and the zijingguan catchment covers an area of 1760 km2 with elevation ranging between 519 m and 2105 m the study catchments are characterised by a temperate continental monsoon climate with rainfall concentrated from late may to early september and the soil type is mainly brown soil with bare vegetation the region is dominated by convective rainfall in the summer season due to the combined effect of the western pacific subtropical high pressure the westerly band of cold eddies and the uplift of the taihang mountains rainfall runoff data of the fuping and zijingguan catchments from 2005 to 2018 are collated table 1 typical rainstorm events in terms of meteorological causes rainfall of intensity ephemeris and zone ephemeris are selected for the simulation it is difficult to select rainstorm events in the study area especially in the last decade rainfall in the fuping and zijingguan catchments was at a historically low level and certain storms with large rainfall rates did not generate high flood peaks due to the relatively dry underlying conditions for these reasons 10 rainstorm events are selected based on rainfall runoff observations from 2005 to 2018 for model calibration and validation these 10 typical events have different spatial and temporal homogeneities and different flood magnitudes which are then used for calibration and validation of the wrf hydro parameters three long rainfall runoff periods in 2012 2016 and 2018 are subsequently used to verify the improvements of the wrf hydro structure for rainfall runoff modeling by the coupled wrf wr hydro system the observed rainfall and hydrographs of the three long periods are shown in fig 5 which reflect different degrees of complexity of the mixed runoff generation in the study sites the observed rainfall and hydrographs of the three long periods are shown in fig 5 which reflect different degrees of complexity of the mixed runoff generation in the study sites the flood of 2012 period 1 had the highest peak 2580 m3 s with a steep rise and fall which was caused by a strong convective rainstorm with very large intensity in this circumstance the generation of the flood was dominated by the infiltration excess mechanism the year of 2016 had more rainfall in july resulting in a flood peak 581 m3 s on 20 july followed by a higher peak 1760 m3 s on 25 july this multi peaked process was more likely caused by a composite effect of infiltration excess and saturation excess mechanisms the flood process in 2018 period 3 is characterised by frequent but relatively lower rainfall at the beginning after the maximum rainfall rate 14 6 mm h occurred on 22 23 july the flood peaked appeared with a small magnitude 130 m3 s which indicated the saturation excess mechanism might have played a more dominant role 3 2 wrf and wrf hydro configurations as shown in fig 4 three nested domains are created for the wrf downscaling and from the outside to the inside the resolution is 9 km dom 1 3 km dom 2 and 1 km dom 3 respectively the era interim data from the european centre for medium range weather forecasts ecmwf is used as the forcing to provide the initial and boundary fields for wrf among the wrf physical parameterisation schemes the planetary boundary layer scheme ysu yonsei university hong et al 2006 the microphysical period scheme lin pudue lin lin et al 1983 and the description of cumulus convection scheme kf kain fritsch kain 2004 are selected based on the climatic characteristics and the convective rainfall conditions in study area 39 considering that high resolution convective rainfall could be resolved explicit an additional rainfall simulation experiments were carried out to determine the switching on off issue of the cumulus convection scheme and eventually only the innermost wrf domain dom1 with 1 km resolution was switched off in this study skamarock 2008 wang et al 2021 table 2 lists the wrf basic configurations and the main parameterisation schemes used in this study the rainstorms in the study area are concentrated between july and september each year thus the selected storm events span a long period of time the rainfall runoff processes in the basin during the non flood period are highly variable and the channel leakage loss makes it difficult to carry out long period simulations to obtain the corresponding parameters to facilitate the fully coupled study of wrf wrf hydro and to obtain more accurate initial conditions for the model two warm up periods are designed in this study to assist the event based calibration the first period of 15 days is to provide reliable initial conditions for the lsm model noah mp and the second period of 24 h extended from the traditional length of 6 h based on the warm up study of chu et al 2018 is adopted for the purpose of coordinating the initial and lateral boundary fields of wrf the configurations associated with wrf hydro are shown in table 3 considering the opening of baseflow model i e a bucket model may differ significantly from the actual situation where the collection of deep subsurface runoff redistributing into the river channel in the bucket model is prone to result in additional streamflow lahmers et al 2019 therefore the baseflow model is turned off in all the simulations of this study the sub grid of wrf hydro is set to 100 m and the disaggregation aggregation scale factor is set to be 10 this means that the relevant parameters of lsm i e the maximum soil water content the lateral saturated hydraulic conductivity the infiltration excess and the soil water content of each soil layer at the lsm grid 1 km 1 km are generated and decomposed to a 100 m 100 m wrf hydro sub grid the higher resolution sub grid variables i e the ponding depth and the water content of each soil layer generated by wrf hydro overland and subsurface routing are then aggregated back into lsm and fed back to wrf thereafter influencing the boundary layer scheme and the radiation scheme in the next iteration run based on the merged rainfall inputs the key runoff generation parameters that need to be calibrated are shown in table 4 both one way and fully coupling of wrf and wrf hydro are supported by the current modeling system by stating different demands in the namelist file wrf hydro can run flexibly in either one way or coupling mode with wrf 3 3 rainfall forcing by merging qpe and rain gauge observations to improve the accuracy of the key runoff generation parameters of wrf hydro the observed rainfall is used instead of the rain field of the wrf downscaled meteorological forcing for model calibration however the rain gauge network in the two study catchments has relatively low densities 276 3 km2 for fuping and 160 km2 for zijingguan which are not enough to provide detailed information of the spatial rainfall distributions for the coupled modeling system an s band doppler weather radar located in the city of shijiazhuang as shown in fig 4 gives a full coverage of the two catchments studies have shown that merging the observations from the rain gauges and the weather radar has a great potential in providing high resolution rainfall with good qualities in both space and time liu et al 2013 liu et al 2018 tian et al 2021 in this study the merged rainfall of radar qpe quantitative precipitation estimation and gauge observations is used as the forcing of wrf hydro for model calibration the spatial resolution of the observations from shijiazhang weather radar is 1 km 1 with a scan radius of 250 km the radar completes a full scan every 6 mins at 9 scan elevation angles 0 5 1 5 2 4 3 4 4 3 6 0 9 9 14 6 and 19 5 processed reflectivity data after quality control are obtained from the national meteorological administration of china cma the power law marshall palmer relationship is used to convert the radar reflectivity z to rainfall rate r zhang et al 2008 and the values of the coefficients are shown in eqn 12 shen et al 2018 12 z 300 r 1 4 for convective rainfall z 200 r 1 6 for stratiform rainfall data merging is conducted by using the kriging with external drift ked interpolation qiu et al 2020 ked is an extension of the universal kriging interpolation method and the interpolated variable can be expressed as a sum of the deterministic drift and the random residual fields the difference is that kriging with external drift allows the interpolation of the main variable by combining multiple additional variables as the background information haberlandt 2007 wadoux et al 2017 during merging the radar qpe is considered as the only additional variable consistent with the description of the traditional kriging method but for the calculation of the specific weight factor λ i ked the ked method adds additional constraints i e data constraints related to the radar estimations to calculate the covariance of the radar field and the gauge field residuals 13 c x a b r x 14 i 1 n λ i ked 1 15 i 1 n λ i ked r x i r x 0 where c x and r x conform to a linear trend with coefficients a and b and c x and r x denote to the rain gauge observation and the radar rainfall estimation at the location respectively n is the total number of the rain gauges xi is the position of rainfall gauge i and x0 is the position to be estimated the drift field in the study is obtained by processing the spatial variability of rainfall at the locations of the radar estimations by the traditional kriging method and converting the covariance matrix residual field based on the gauge locations to a spectral matrix on the whole catchment by the fast fourier transform fft transformation method nerini et al 2017 sinclair and pegram 2010 this method converts the radar data into a continuous strictly cumulative distribution while fully introducing the spatial variability of the radar data into the interpolation process of the gauge observations enabling a better representation of the spatial and temporal characteristics of rainfall erdin et al 2012 3 4 wrf hydro calibration and evaluation statistics this section introduces the calibration methodology of the wrf hydro parameters and the statistics used to evaluate the rainfall runoff simulations before after the improvements from the one way and the fully coupled wrf wrf hydro system 3 4 1 evaluation of the merged rainfall forcing the evaluation of the merged rainfall is carried out based on the hourly observations of the rain gauges the leave one out cross validation loocv vehtari et al 2017 is used to avoid duplication verification and information redundancy when conducting loocv each single rain gauge is left in turn used for validating the merged rainfall produced based on the other rain gauges considering the spatial mismatch between the gauge based observations and the grid based estimations for each rain gauge the merged rainfall estimations from the most surrounding grid cells and averaged to compare with the gauge observation the loocv methodology provides both a gauge based and an overall evaluation of the merged rainfall driven data three evaluation statistices i e bias rmse root mean square error and mrte mean root transform error are chosen cecinati et al 2017 the involvement of mrte is to prevent an overestimated error caused by rainstorms with extremely large intensity but a low frequency of occurrence in the watershed the three statistics can be calculated eqns 7 9 16 bias 1 n i 1 n p i p i 17 rmse 1 n i 1 n p i p i 2 18 mrte 1 n i 1 n p i p i 2 where pi is the i th rain gauge hourly observation n indicates the total number of rainfall gauges in the study watersheds and p i is the corresponding merged rainfall estimations from the nearest grid cells of the corresponding rain gauge the statistics of rmse and mrte range from 0 to with an optimal value of 0 while bias ranges from to with an optimal value of 0 3 4 2 wrf hydro calibration and evaluation of the flood simulation the calibration of the wrf hydro parameters is based on the parallel dynamically dimensioned search algorithm p dds tolson et al 2014 the merged rainfall estimations from radar qpe and rain gauges are used as the inputs of wrf hydro to obtain more realistic parameters the kling gupta efficiency kge coefficient gupta et al 2010 is chosen as the objective function kge balances on the correlation the water balance and the deviation error between the simulated and the observed flood processes compared to the commonly used nash efficiency coefficient nse which focuses on large flood peaks kge can also take into account the smaller flood processes which is more conducive to a comprehensive evaluation of floods gupta et al 2010 considering the limited number of floods available for model calibration in the study sites the consideration of small magnitudes of floods by this objective function facilitate the calibration of the crucial parameters of wrf hydro kge can be expressed by the following equation 19 kge 1 r 1 2 α 1 2 β 1 2 where r is the ratio of the standard deviation of the simulated data series to the observed series α is the ratio of the mean value of the simulated series to the observed series and β is the correlation coefficient between the two series when kge is equal to 1 the simulation is optimal this means that the euclidean distance from the ideal simulation series is minimal while when kge is negative the simulation is considered to be unsatisfactory gupta et al 2010 and lespinas et al 2018 explored the effective number of iterations to minimise the objective function using the dds algorithm and showed that the simulation was progressively improved between 100 and 500 iterations and that the model enhancement slowed down after 500 iterations due to the highly complicated model structure wrf hydro takes a long time to run the iterations to make the work done efficiently 100 iterations are firstly run to find the variation intervals of the optimal parameters for each rainstorm event based on which the parameter intervals are narrowed down and the results of the second run for 500 iterations are finally adopted as the calibrated parameter set due to the limited typical rainstorms available events prior to 2016 i e event 1 to 4 and event 6 to 9 are used for the model calibration and event 5 and 10 that happened in 2016 are used for validation in addition to kge the flood peak error rp the flood volume error rv and the nash efficiency nse coefficient are additionally selected to evaluate the flood simulation results from the wrf wrf hydro system the calculations of the three statistics are shown by eqns 20 22 20 nse 1 i 1 n q i q i 2 i 1 n q i q 2 21 r p q p q p q p 22 r v r v r v r v where i is the time step and n is the total number of time steps of the flood duration q i and q i are the simulated and the observed discharge series and q is the averaged value of the observed discharges q p and q p are the simulated and the observed flood peak r v and r v is the simulated and the observed flood volume 3 4 3 evaluation of the rainfall simulation to evaluate the model improvement of the fully coupled wrf wrf hydro on the rainfall simulation the statistics of rmse and mbe mean bias error are used to evaluate the temporal and spatial uniformity of the rainfall distribution rmse is calculated by eqn 17 and mbe can be expressed as 23 mbe 1 n i 1 n p i p i when calculating the statistics in the spatial dimension p i and p i refers to the watershed areal rainfall of the i th time period and n is the total number of the time periods during the rainstorm while in the temporal dimension p i and p i refers to the rainstorm accumulated rainfall at the i th rain gauge and n is the total number of rain gauges in the watershed 4 results 4 1 wrf hydro calibration using the merged rainfall forcing fig 6 illustrates the box plots of the evaluation results for the merging rainfall by using the statistics of bias rmse and mrte the mean bias value for the 10 rainstorm events of fuping and zijiangguan catchments is 0 169 indicating the merged rainfall has a slightly negative deviation from the gauge observations the mrte statistics also show a good quality of the merged data with the values of all events below 1 and a mean of 0 423 although the rmse values are slightly larger for some events especially event 8 with the largest value of 2 958 the statistic is also able to maintain at a low error level with an overall mean of 1 347 the temporal and spatial distribution of the observed and the merged rainfall is further given in fig 7 where event 1 is relative homogeneous and event 8 is inhomogeneous in both space and time for event1 the difference of the spatial rainfall is not obvious but when encountering a storm like event 8 the merged rainfall can more precisely describe the spatial distribution compared to the gauge observations based on the calibrated parameters using the merged rainfall the results of the evaluation statistics are illustrated in table 5 and fig 8 and the simulated hydrographs of the 10 rainstorm events before and after the structure improvements are shown in fig 9 the low simulations accuracy for some of the rainstorm events is mainly due to the screening of small magnitudes of floods and the fact that the flood rises and fall occurred within a few hours which made the model simulation difficult the mean value of rp increases slightly from 8 6 to 11 9 after improvements while the mean rv decreases from 23 5 to 22 5 nse decreases from 0 716 to 0 669 and kge increases from 0 502 to 0 521 after the improvements of the model structure the statistic performances also differ among different events with more obvious improvements seen in those with higher flood peaks such as event 5 and event 8 for event 8 rp is reduced the most obviously by 10 8 50 9 before and 40 1 after improvement however for event 1 and event 7 the improved structure suffers from a too fast flood receding which results in smaller flood volumes than the observations e g rv of event 7 increases from 27 3 to 52 7 after improvement event10 is a multi peaked type of flood which is poorly modelled regardless of the improved structure especially as there is a rapid receding process after the first peak is reached it can be concluded that the improved wrf hydro structure performs better for single peak floods with higher peaks but is less effective than before for multi peaked or flood processes with smaller volumes and longer recession times such as event 10 and event 3 4 2 simulations of the one way coupled wrf wrf hydro before and after improvements in order to further validate the applicability of the improved mixed runoff generation structure to long hydrological processes in the study area the simulation results from both one way and the fully coupled wrf wrf hydro are analysed and compared below based on 3 typical long periods occurring in the flood season of 2012 2016 and 2018 for the two way coupling of wrf wrf hydro due to a more complicated compling process which involves the partially open source codes of wrf the spatial discretisation of the infiltration capacity based on the topographic index described in section 2 2 2 cannot be fully realised therefore the originally adopted approach in wrf hydro proposed by schaake et al 1996 is used instead to determine the spatial distribution of the infiltration capacity nevertheless the infiltration equation considering the top soil water content and the channel leaking loss equations in the fully coupled mode are kept consistent with the one way coupling in the following result presentations discrete infiltration 1 is used to describe the improvements involving the discretisation equation proposed in this study while discrete infiltration 2 is used to describe those involving the original schaake s approach 4 2 1 streamflow simulation the simulated hydrographs of the three typical long hydrological periods before and after model improvements are shown in fig 10 both of the two improved structures with different approaches for the infiltration capacity discretization are tested for the one way coupled wrf wrf hydro system results of the flood evaluation statistics are also shown for a more quantitative comparison in table 6 it should be noted that event 8 and event 5 are respectively included in period 1 and period 2 it can be seen from fig 10 that the large peaks in period 1 and period 2 are underestimated by the one way coupled system while for the small peaks the first half of period 2 and the whole period 3 the simulated results are significantly larger than the observations this may result from the unsteady performance of the simulated rainfall from the coupled system for example the improvement in the streamflow simulation for period 3 is restricted by the wrf rainfall input which can be found in fig 10 differs significantly from the gauge observations another reason is that the improved structure works better for single peaked floods where the infiltration excess runoff generation dominates period 3 as shown in fig 5 is a multi peaked flood process with a relatively wetter soil condition and more runoff generated by the saturation excess mechanism the differences in the simulations caused by the model structure improvements can more obviously be seen for the other two periods period 1 and period 2 as shown by the statistic rp in table 6 the improved structure with discrete infiltration 1 thereafter refers to as improved structure 1 gives the best results for the all flood peaks especially for the 21 23 july flood i e event 8 in period 1 rp of the improved structure 1 is reduced to 20 8 from the original simulation with a value of 30 5 except for period 2 which is characterised by a series of small peaks followed by a considerable large peak the coefficients of nse and kge indicate the most obvious improvements for the improved structure 1 regarding the improved structure 2 the simulated flood peaks are slightly worse than the original results however rv and nse becomes better than before especially for event 8 in period 1 and event 5 in period 2 the nse coefficient is respectively improved by 0 125 and 0 337 4 2 2 analysis of the infiltration excess and saturation excess runoff generation in order to better analyse the runoff changes before and after the model improvements the infiltration excess and saturation excess runoff components are tried to be separated from the total runoff in this section in wrf hydro the amount of the infiltration can be expressed as the sum of the local infiltration and the re infiltration where the local infiltration refers to the infiltration in the vertical direction and is controlled by the infiltration equation corradini et al 1998 as shown by eqn 3 or eqn 9 while the re infiltration is caused by the lateral transport of water beyond the storage capacity of the saturated soil column during which this amount of water replenishes the unsaturated soil column along the overland routing path zhang et al 2020 the infiltration process in wrf hydro are illustrated in fig 11 24 r se r r ie i ri r se r se 0 i ri 0 r se 0 since the amount of water in the lateral transport process and the re infiltration process cannot be directly separated in the model the strategy adopted here to facilitate the analysis is to compare the differences of the simulation results by switching on off the routing module in wrf hydro when the routing module is switched on the total runoff r is obtained which contains both the infiltration excess runoff r ie and the saturation excess runoff r se r ie is composed of water from the local infiltration and the re infiltration processes when the routing module is switched off any infiltration excess amount has no chance to re infiltrate into the other unsaturated soil column meaning that there is only local infiltration in the system and the infiltration excess runoff r ie can therefore be obtained the saturation excess runoff r se is then calculated by subtracting the infiltration excess runoff r ie from the total runoff r as shown by eqn 24 when the calculated r se is negative it means there is no generation of the saturation excess runoff and the difference between r and r ie equals to the re infiltration amount i ri it is important to note that this approach is only intended to provide an easy way to separate the different components of the generated runoff the positive and negative values show an overall state of the catchment during a specific period of time with the resulted r se or i ri values indicating that the area is dominated by either the saturation excess runoff generation or the re infiltration in practice saturation excess and re infiltration may happen simultaneously at different areas of the catchment water accumulates quickly in the piedmont area to generate the saturation excess runoff meanwhile re infiltration still happens in the downstream area where the soil is not yet saturated the separated processes of the infiltration excess and saturation excess runoff generation for the 2012 long period i e period 1 including event 8 from the one way coupled wrf wrf hydro are shown in fig 12 specific quantities for each runoff components are further given in the table 7 in the north western parts of the study area the high elevations and the steep slopes of the taihang mountain encourage more water to drain quickly in the downstream river network this is more conducive to the generation of the saturation excess runoff which may be the reason why the re infiltration values are found to be zero in table 7 comparisons are also made between results before and after the model improvements with the improved structure 1 it can be seen that the improved wrf hydro results in an increase of the infiltration excess runoff and a decrease of the saturation excess runoff with respectively a 20 38 mm increase and a 20 58 mm decrease over the long period for event 8 the infiltration excess runoff is also increased by 7 94 mm and the saturation excess runoff is decreased by 6 42 mm the improved structure helps regulate the proportions of different runoff components and to some extent emphasizes the infiltration excess mechanism for the mixed runoff generation this can partly explain why the improved wrf hydro obtains a higher flood peak and a better nse value 4 3 simulations of the fully coupled wrf wrf hydro before and after improvements due to the limitations of the current code openness in wrf it is not possible to implement the spatial discretisation of the infiltration capacity based on the topographic index in the fully coupled system therefore the above mentioned improved structure 2 which remains the schaake s approach eqns 3 is used to examine the improvements of the full coupled system caused by the infiltration equation considering the changing of the top soil water content and the river channel leakage loss equations the simulated streamflow together with the cumulative rainfall from the standalone wrf and the fully coupled wrf wrf hydro system before and after improvements is shown in fig 13 it can be seen that both wrf and the fully coupled system tend to overestimate the cumulative rainfall during the long time simulations among the three periods the 2012 period period 1 shows the closet cumulative amounts to the observations the differences of the cumulative rainfall are found to be the most pronounced with the 2016 period period 2 among the results from the standalone wrf and the coupled system before and after improvements compared to the wrf cumulative amount 333 2 mm the coupled system with the improved structure increases the amount to 369 2 mm it seems that the improved structure does not show any positive effect on the cumulative rainfall for the long time simulation however counting only the 3 day event event 8 in period 1 the relative error re of the cumulative rainfall is reduced from 63 3 the standalone wrf to 53 4 with the fully coupled system before improvements and further reduced to 31 6 with the system after improvements results of the spatial and temporal rainfall evaluation statistics by wrf and the coupled system are further given in table 8 the improved structure shows both advantages and disadvantages for different periods and events for the rmse statistic the fully coupled system fails to significantly enhance the simulation accuracy of rainfall whether in space or in time and is even worse in some cases however the statistic mbe which takes into account the directionality of the error shows that the fully coupled system is better than the standalone wrf and the improved structure has the lowest mean error for both spatial and temporal evaluations the flood evaluation statistics for the three long periods before and after improvements are shown in table 9 the simulated streamflow from the two way coupled system shows similar trends with the one way couple system in general the improved model structure also generates better flood simulations with the two way coupled system the nse coefficients of all the three long periods are much improved and the statistic of rp is also reduced for both period 1 and period 2 the most obvious improvements are found in period 1 with rp decreased from 32 2 to 23 7 and nse increased from 0 519 to 0 607 5 discussion due to the complex conditions of the climatology and the underlying surface in the mixed runoff generation region the water and heat exchange is intense through the land atmospheric interface the accuracy of the flood simulation in such area depends on three main factors firstly the spatial and temporal distribution of the simulated rainfall secondly the land surface hydrologic model such as wrf hydro the error of which normally comes from the physical structure of the model and the calibration of the sensitive parameters and finally the complexity of the flood processes including the magnitude of the flood peak the presence or absence of the baseflow the length of the recession process etc in this study attempts are made to improve the runoff generation structure of wrf hydro by transplanting equations from the traditional lumped hebei model and meanwhile to improve the calibration of sensitive parameters by using rain gauge and radar merged observations the simulation results of streamflow for the three long periods are not satisfactory in this study for both the one way and the fully coupled system before and after improvements the generation of saturation excess runoff can be found due to the lateral water transport in rain free periods after the flood peaks which obviously deviates from the actual situation both wrf and the fully coupled system tend to overestimate the cumulative rainfall as well as the soil water content moreover the northwestern part of the study catchments is mountainous with steep slopes where the confluence module promotes faster water pooling in the downstream river channel and therefore is more conducive to the occurrence of the saturation excess runoff generation meanwhile the considerable errors in the streamflow simulation of the three long periods also suggest that the calibrated parameters may not be entirely suitable for long term simulations the inaccuracy of the parameters to some extent affects the simulated rainfall magnitude through the feedback between wrf and wrf hydro in the fully coupled system model parameters and the model structure may need to be adjusted during the long period simulation for instance the subsurface routing module can be turned off and constraint equations or corresponding attenuation modules can be added to accelerate the attenuation of the soil water content during the rain free period on the premise of the overall catchment water balance nevertheless the improved structure has shown great potential in improving the simulations of floods with large magnitude as well as the spatial distribution of rainfall for the fully coupled system compared with the original wrf hydro the improved structure changes the mixed runoff generation mechanism by increasing the infiltration excess runoff proportion and decreasing the saturation excess part it is proven in this study that with the improved structure both the one way and the fully coupled system can produce higher flood peaks and lower nse values subsequent studies need to be carried out to further verify the effectiveness of the improved model structure proposed in this study first the spatial discretisation of the infiltration capacity is based on the topographic index the value of which may vary at different spatial resolutions therefore the discretisation results should be tested with different grid scales second the improved structure proposed in this study is not fully realised in the fully coupled wrf wrf hydro system which also needs to be further verified with the improvement of the code openness of wrf third the spatial distribution of the key runoff generation parameters such as those related to infiltration and the lateral water transportation as well as the aggregation disaggregation factor need to be further explored with the improved wrf hydro structure in order to produce more realistic rainfall runoff simulations finally the purpose of the study is to introduce an improved structure for wrf hydro and to prove its adaption to runoff generation with mixed mechanisms more efforts are needed to further enhance the model performance especially for floods with small magnitudes and multi peaks where the saturation excess runoff generation dominates 6 conclusions the coupled wrf wrf hydro system provides an efficient way to acquire high resolution rainfall and timely flood forecasts in the mixed runoff generation regions with complicated rainfall runoff transformation mechanisms there is still room for wrf hydro to improve in representing the land surface hydrologic processes enlightened by the structure of the lumped heibei model this study proposes an improved structure for characterising the mixed mechanisms with both infiltration excess and saturation excess runoff generation the infiltration equation considering the changing effect of the surface soil moisture the spatial discretisation equation of the infiltration capacity and the leakage loss equations for the channel routing are introduced into wrf hydro a merging method of radar and rain gauge observations is also adopted to provide improved rainfall forcing for calibrating key parameters of the improved structure the improved structure is then verified by typical storm events and long time periods selected from semi humid and semi arid catchments of northern china the improved structure has shown great potential in improving the simulations of floods with high peaks and steep rises and falls compared with the original wrf hydro the improved structure changes the mixed runoff generation mechanism by increasing the infiltration excess runoff proportion and decreasing the saturation excess part results from both the one way and the fully coupled wrf wrf hydro system have demonstrated the suitability of the improved structure for rainfall runoff processes dominated by the infiltration excess runoff generation however it may have a problem of receding too quickly for small scale floods and producing more saturation excess runoff in the recession process this study provides an attempt to transplant equations or modules from conceptual hydrological models to the coupled wrf wrf hydro system to enhance its performance in rainfall runoff modeling similar studies need to be carried out to further verify the generalisation of the proposed structure in other mixed runoff generation catchments with different climatic and hydrologic conditions credit authorship contribution statement wei wang conceptualization methodology visualization writing original draft writing review editing jia liu conceptualization methodology writing original draft writing review editing bin xu data curation investigation chuanzhe li data curation writing review editing yuchen liu visualization writing review editing fuliang yu supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was funded by the national natural science foundation of china 51822906 the national key research and development project 2017yfc1502405 and the major science and technology program for water pollution control and treatment 2018zx07110001 
3184,climate change will alter the flow availability and expected water allocations in international river treaties many of which were designed using historical flow records effective transboundary treaties should anticipate these concerns and seek to satisfy the priorities of all riparian countries while being robust to impending changes in climate this task is complicated by the fact that specific objectives associated with each party s priorities are not necessarily common knowledge framing uncertainty and the direction amplitude and effect of long term changes in hydro climatic drivers can be highly uncertain climate uncertainty we frame the design of a transboundary treaty as a multi objective optimization problem we use hierarchical clustering to address problem framing uncertainty by identifying the subset of objectives associated with the governing trade offs imposed by the bio physical characteristics of the shared river system we then carry out a scenario neutral climate sensitivity analysis to identify climate robust pareto optimal treaty solutions we illustrate the approach for the ganges water agreement which is due to be renewed in 2026 based on an enumerated population of 25 121 feasible treaty solutions we identify governing objectives and 16 treaty solutions that are pareto optimal under most considered combinations of changes in sea level and dry season flow regime this work provides a path towards improving transboundary allocations for the ganges water treaty and more broadly a template to support transboundary cooperation over shared international rivers keywords multi objective optimization ganges climate change india bangladesh salinity 2000 msc 0000 1111 1 introduction climate change and increased anthropogenic water use threaten water security and pose challenges for water management in many basins around the world stronger storms chen et al 2020 more intense droughts overpeck and udall 2020 and greater hydro meteorological uncertainty panahi et al 2020 are expected in many regions of the world where population growth combined with agricultural intensification will further threaten water security the consequences of these changes include groundwater depletion cotterman et al 2018 freshwater and soil salinization haque 2006 loss of livelihoods muringai et al 2019 and other environmental crises turner et al 2020 these issues are particularly evident in several internationally shared basins including the nile beyene et al 2010 mekong kiem et al 2008 colorado barnett and pierce 2009 and ganges rahman et al 2019 rivers stable and effective policy instruments to manage transboundary waters have become critical for maintaining international cooperation and preventing economic or political crises dinar et al 2016 over two hundred transboundary river basins have been identified housing 42 of the global population water sharing in these basins has led to the creation of over six hundred treaties on freshwater management since the early nineteenth century unep dhi unep 2016 however many of these agreements may not perform well under an increasingly volatile and uncertain climate draper and kundell 2007 new or renegotiated agreements should ideally balance the competing needs of each party while striving to support benefits that are robust to a changing climate this process can be formulated as a multi objective optimization problem that riparian countries cooperatively solve following the framework in maier et al 2019 the objectives i e outcomes of interest are to maximize environmental social and economic benefits and to minimize environmental social and economic costs by selecting appropriate transboundary flow allocation rules which are the decision variables the set of objectives considered in the optimization corresponds to the union of the sets of objectives associated with each party this formulation allows us to focus on conflicting objectives in terms of tradeoffs between measures of system performance this notion of conflict does not necessarily correspond to conflicting actor incentives as treated by non cooperative game theory see e g müller et al 2017 penny et al 2021 indeed the considered tradeoffs between measures of system performance can also arise for a single actor with conflicting performance objective measures for example a given actor might want to simultaneously minimize the peak and maximize the average of incoming streamflow the constraints include the available water resources the physical limits on the diversion infrastructure political feasibility and historical legacies e g pre existing treaties a solution consists of the set of transboundary flow allocation rules that form a treaty trade offs associated with the potentially conflicting nature of the objectives are captured by the notion of pareto optimality e g kasprzyk et al 2013 a solution is pareto optimal if no change in the decision variables could improve any objective without making the situation worse for another in contrast a solution that is not pareto optimal would miss some of the possible joint gains of cooperation and leaves on the table one or more solutions that would make all parties better off kronaveter and shamir 2009 pareto optimality is therefore a requisite attribute of cooperative bargaining solutions nash 1953 kalai and smorodinsky 1975 and a desirable outcome for international water negotiations kronaveter and shamir 2009 in reality of course transboundary water negotiations might not be cooperative and problem framing uncertainties arise from the fact that not all relevant optimization objectives are common knowledge across the negotiating parties our approach relies on the assumption that an initial broad set of candidate objectives can generally be constructed intuitively based on the bio physical and socio political context see discussion in section 4 1 for example in the context of the ganges both parties likely seek to maximize average flow availability during the dry season but minimize salinity and flow variability these candidate objectives might be refined using information available to both parties though not necessarily to the wider public though appropriate approaches to engage stakeholders in a process of knowledge co production wyborn et al 2019 however the relative importance of each objective for each party i e objectives that matter vs objectives that can be safely removed from the optimization might ultimately be kept private for strategic reasons in other words the true set of optimization objectives is likely unknown which prevents the true set of pareto optimal solutions from being discovered this issue is well known in the negotiation literature where a variety of protocols have been proposed to guide the negotiating parties towards the discovery and achievement of pareto optimal outcomes see e g ehtamo et al 1999 lai and sycara 2009 kronaveter and shamir 2009 here in contrast we seek to decrease the dimensionality of the set of candidate objectives ex ante based on known dynamics of the bio physical system rather than publicly unknown preferences of the negotiating parties doing so does not necessarily reveal the true set of hidden stakeholder objectives rather the approach can be seen as a way to leverage publicly available information to simplify a many objective optimization problem that is poorly framed due to hidden objectives see section 4 4 pareto optimality is a non dominance mathematical partitioning rule as one increases the number of objectives the partitioning rule becomes less discriminatory resulting in an increase in the size of the pareto optimal set a phenomenon known as dominance resistance e g reed et al 2013 an excessively large set of objectives such as the full set of initial candidate objectives will cause many solutions that are non dominant under the true set of objectives to be included in the discriminated solution set in contrast considering too few objectives can lead to the opposite issue of oversimplifying the problem by missing important portions of the objective set that are only non dominated with the addition of more objectives see examples in kollat and reed 2007 woodruff et al 2013 our contribution is to leverage the internal physical dynamics of the system to navigate this trade off we apply a data based pattern recognition technique hierarchical clustering on enumerated solutions to reduce the dimensionality of the set of objectives and approximate the pareto optimal set of solutions while minimizing information loss see discussion in section 4 2 in doing so we assume that all feasible treaty solutions can be enumerated an assumption that is discussed in section 4 3 our approach relates to the literature seeking to reduce the complexity of many objective optimization problems by exploiting the correlation between certain objectives e g deb et al 2006 brockhoff and zitzler 2006 brockhoff and zitzler 2009 for example giuliani et al 2014 leverages numerical correlations between objectives to aggregate them into a reduced number of linear combinations of objectives principal components with respect to which the optimization problem is solved here we follow lindroth et al 2010 and estimate pearson correlation coefficients across enumerated solutions between pairs of objectives we then use a clustering procedure to systematically reduce the number of objectives in a manner that is informed by the structure of these correlations in the underlying dataset another type of uncertainty this time on the future states of the world arises from the fact that it is challenging to determine precisely how much and how quickly the relevant climate inputs will change deser et al 2012 in that context it is not sufficient to identify water allocations that are pareto optimal under current conditions rather the analysis must also navigate the trade off between objectives under a range of potential changes in environmental constraints we incorporate a scenario neutral sensitivity analysis to evaluate the robustness of the pareto optimal set of solutions to different combinations of climate inputs following brown et al 2012 different components of the system are considered to create a model with a climate response function the model is then perturbed by stochastically generated climate inputs in order to identify the climate states associated with high risk of systemic failure despite the caveats discussed in section 4 5 this type of scenario neutral analysis is commonly used to evaluate the climate vulnerability of systems brown et al 2012 jones 2001 wilby and dessai 2010 including transboundary river systems de boer et al 2021 in situations where the change in the relevant climatic drivers is highly uncertain however it has not to our knowledge been applied to evaluate the effect of climate uncertainty on the composition of pareto optimal solution sets the approach that we propose which combines hierarchical clustering and scenario neutral analysis falls within the broader category of exploratory modelling approaches in the sense that it addresses both types of uncertainty on framing and on future world states by using numerical simulation to systematically explore their implications on enumerated outcomes it fits within recent frameworks to confront deep uncertainty within water management problems through robust multi objective optimization see moallemi et al 2020 table 1 for example kasprzyk et al 2012 proposes an iterative framework where a pre processing analysis sobol variance decomposition is carried out to reformulate the problem de novo in a way that seeks to balance complexity and effectiveness before the multi objective optimization in a similar manner we use hierarchical clustering here to refine an initial vector of candidate objectives to update the dimensionality of the problem before identifying pareto optimal solutions kasprzyk et al 2012 continues with a scenario analysis to test the robustness of solutions to model assumptions a step that mirrors our proposed scenario neutral analysis we demonstrate our combined approach using the ganges water sharing agreement gwsa between india and bangladesh as an illustrative example the agreement determines the flow of the ganges into bangladesh during the dry season january may by regulating the operation of the farakka barrage fig 1 in india approximately 100 km upstream of the border the barrage diverts ganges river water into the bhagirathi hooghly river a distributary of the ganges that discharges into the bay of bengal in india near the port city of kolkata the gwsa exemplifies the multi faceted challenges associated with transboundary river management under a changing climate the treaty was signed in 1996 with the purpose of balancing flow requirements to de silt the port of kolkata one of india s major cargo ports with dry season irrigation and environmental water needs in bangladesh tanzeema and faisal 2001 since then the flow regime of the ganges and the geomorphology of the delta have changed substantially under the coupled effect of changing rain patterns and upstream water uses rahman et al 2000 in addition salt intrusion has become a major concern throughout the ganges delta due in part to sea level rise and increasingly frequent and intense storm surges rahman et al 2019 these changes have had particularly damaging economic public health and ecological impact in coastal communities in south western bangladesh and the sundarbans a unique and world s largest mangrove ecosystem faisal and parveen 2004 sufficient provision of freshwater inflow through the ganges is paramount to prevent saline intrusions rahman et al 2000 pethick and orford 2013 shammi et al 2016 these rapidly changing conditions might have reduced the effectiveness of current treaty allocations penny et al 2020 which were based on average flow data collected from 1949 1988 and have not been updated salman and uprety 1999 because the treaty is slated to be renewed in 2026 a tractable approach to understand and visualize the implicated hydrologic trade offs is of immediate policy relevance 2 methods 2 1 optimization problem and decision variables we use the notation in kasprzyk et al 2013 to formulate the new gwsa treaty as a multi objective optimization problem seeking to minimize a vector f of p objectives f 1 f 2 f p by choosing a vector l of decision variables within a decision space ω 1 min l ω f l f 1 f 2 f p s t c i l 0 i 1 q where c i l 0 i 1 q represents q constraints on the vector of decision variables feasible solutions are defined as those meeting all the imposed constraints a solution f a dominates another solution f b if f i a f i b i and j f j a f j b the solution is pareto optimal if it is non dominated with respect to all other feasible solutions kasprzyk et al 2013 we defined decision variables by parameterizing the current treaty under the premise that its structure will serve as a basis for its renewal in 2026 the current treaty allocates a fixed percentage p q 1 50 of incoming streamflow to bangladesh and the remaining flow to india up to a threshold q 2 35 000 cubic feet per second or cusec allocated to bangladesh this threshold corresponds to a total incoming streamflow of 70 000 cusec q 2 p q 1 upstream of the diversion additional flow beyond that threshold is allocated to india with flow to bangladesh maintained at q 2 35 000 cusec up to another threshold of 40 000 cusec allocated to india this latter threshold is determined by the capacity of the canal diverting the flow towards india kawser and samad 2016 and is unlikely to be altered in a renewed treaty under current treaty allocations this threshold corresponds to a total flow of q 2 40 000 75 000 cusec upstream of the diversion the treaty also includes special provisions for the driest period of the year march 11 to may 10 during which guaranteed flows are allocated to bangladesh and india in alternating 10 day periods the current treaty splits this period centered around april 10 into n 6 intervals of m 10 days during which a minimum flow of q int 35 000 cusec is alternately guaranteed to each country see penny et al 2020 treaty allocation rules and the five parameters that govern them p q 1 q 2 q int m and n are summarized in fig 2 these five parameters constitute the decision variable vector l of the multi objective optimization 2 2 constraints and enumeration of solutions the five decision variables are bound by a series of constraints summarized in table 1 associated with the physical flow diversion infrastructure and historical legacies namely the feeder canal linking the ganges at farakka barage with the hooghly river has a capacity of 40 000 cusec assuming that the physical capacity of the canal will not be increased when the treaty is renewed this sets a hard limit on the flow that can be diverted to india accordingly q 2 and q int are capped at 40 000 cusec in addition the current treaty prescribes emergency arrangements if the total flow of the ganges at farakka falls below 50 000 cusec we assumed that this clause will carry over to the renewed treaty and set a lower limit of q int at 50 000 2 25 000 cusec this allows each party to benefit from intervals of guaranteed flows before emergency measures are invoked i e for incoming flows at farakka equal to or higher than 50 000 cusec further the minimum flow for q 2 is set to 30 000 cusec so that there generally remains a period of total flow above emergency measures 50 000 cusec that is dictated by p q 1 the number and duration of intervals m and n are set so that the total period governed by interval allocation remains at or below 150 days which corresponds to the entire duration of the annual low flow period regulated by the treaty january 1 to may 31 m must also be an even number for both countries to be attributed identical numbers of guaranteed flow periods regarding the percentage of flow allocated to bangladesh under low flow conditions outside of the interval period we arbitrarily set its boundaries at 45 and 70 the current treaty divides these flow conditions equally between the two countries so deviations from the status quo are likely politically challenging yet if the parameter does become altered in the renewed treaty we assumed it to be more likely in the favor of india due to its favorable hydro strategic position the ensuing constraints c i l on the decision variables are summarized in table 1 we enumerated 25 121 feasible treaty solutions that span the constrained decision space at regular intervals these intervals displayed on table 1 represent the smallest increment in the decision variables that would be practical to implement for example the flow increment of 1000 cusec or 2 8 m 3 s corresponds to a height increment of only approximately 15 cm across the 11 gates of 12 m span that form the head regulation structure of the diversion canal assuming sluice gates with a spillway coefficient of 1 given these considerations the intervals in table 1 are sufficiently small for the enumerated solutions to allow for a reasonable approximation of the true pareto optimal set associated with the considered objectives 2 3 initial set of candidate objectives our initial set of candidate objectives relate to flow conditions in india and bangladesh immediately downstream of the diversion and to salinity conditions in the gorai river in bangladesh near the city of khulna flow and salinity conditions in the gorai are critical in terms of controlling salinity conditions in southwest bangladesh a region that is particularly vulnerable and sensitive to saline intrusions from the bay of bengal mirza and sarker 2004 under the premise that both countries seek to maximize average flows but minimize flow variability and salinity a strong assumption that is discussed in section 4 1 we constructed the initial set of 26 candidate objectives described in table 2 with the aim of capturing the central tendency variability and extremes of flow and salinity at intra and inter annual time scales we evaluated the 26 candidate objectives for each of the 25 121 enumerated solutions by applying the corresponding diversion rules to historical 1998 2017 ganges streamflow upstream of farakka this allowed us to simulate historical downstream conditions in india and bangladesh had the existing treaty allocations been different to do so we proceed as follows see fig 3 1 multiple data sources were combined see supplementary information section s1 to construct estimates of daily inflow to farakka barrage during the january 1 to may 31 period between 1998 and 2017 2 daily streamflow allocations to india and bangladesh were reconstructed using treaty parameters for each of the 25 121 considered treaty alternatives 3 a simple physically based salinity model was used to simulate salinity in the ganges delta in bangladesh gorai river at khulna fig 1 the salinity model incorporates advection and first order exchange processes and is influenced by the incoming streamflow mixing volume e g channel geometry and downstream salinity conditions see section s2 and penny et al 2020 the resulting simulations of daily streamflow india and bangladesh and salinity bangladesh were then used to compute the statistics corresponding to each candidate objective 2 4 dimensionality reduction starting with the initial set of candidate objectives we sought to reduce the number of objectives by exploiting the fact that some objectives might be correlated due to underlying bio physical relationship for example physical constraints e g mass balance advection and mixing associate an increased flow to india with a decreased flow and increased salinity in bangladesh characterizing how these dependencies play out between each combination of objectives in table 2 might allow them to be grouped into clusters that best embody the governing physical trade offs of the system and discount the effect of potentially redundant objectives we used the procedure of agglomerative hierarchical clustering to classify the initial set of candidate objectives according to their similarity across the 25 121 solutions legendre and legendre 1998 to do so we defined a dissimilarity or distance matrix d ij 1 r ij 0 2 where r ij is the pearson correlation coefficient between the simulated value of objectives i and j across the 25 121 enumerated solutions prior to calculating the pearson coefficient statistics associated with salinity levels and flow variability which parties seek to minimize were multiplied by 1 we then implemented complete linkage clustering to group the candidate objectives in increasing order of dissimilarity the most correlated pairs of candidate objectives were grouped first and produce a cluster tree or dendrogram fig 4 another way to consider the problem is to think of the 26 initial candidate objectives as a network of 26 nodes with distance matrix given by d ij hierarchical clustering was used to identify the communities within the obtained graph that best represents its structure radicchi et al 2004 clusters of similar candidate objectives were determined by cutting the dendrogram so that all candidate objectives contained by a cut branch fall within a single cluster although several techniques exist to optimally prune hierarchical dendrograms e g langfelder et al 2008 a parsimonious approach is to cut the tree at a constant dissimilarity threshold d an optimal value of d will maximize both the similarity of objectives within clusters and the dissimilarity of objectives between clusters an excessively small d would produce a large number of similar clusters and fail to capture the governing trade offs of the problem in contrast an excessively large d would group dissimilar objectives within the same cluster if the objectives within a cluster are too dissimilar the choice of the particular objective used to represent the cluster in the pareto optimization will strongly influence its result figure s5 here we used a dissimilarity threshold d 1 this corresponds to a pearson correlation coefficient r 0 meaning that objectives within clusters are positively correlated across the 25 121 enumerated solutions whereas objectives across clusters are negatively correlated in our specific case study a threshold d 1 falls at the limit between three and four clusters fig 4a light green line we opted for four clusters to increase the similarity of objectives within a cluster and make the pareto optimization less sensitive to the particular choice of the objectives used to represent each cluster we identified a single representative objective per cluster by considering the correlation matrix r ij associated with each cluster one matrix by cluster as an analog to a graph adjacency matrix where each node represents an objective for each matrix we then identified the node i e objective with the highest measure of degree centrality golbeck 2015 the approach indicated the following objectives as central to each cluster 1 mean max s b which is the inter annual mean of the intra annual maximum of daily salinity in bangladesh gorai river at khulna 2 mean min 4 q i which is the inter annual mean of the four lowest intra annual minimum daily flows to india 3 min mean q i which is the inter annual minimum of the intra annual mean flow to india 4 days q i 40 k which is the number of days in the full 1998 2017 period where flow to india is less than 40 000 cusec which is the maximum flow that india can receive although these four objectives have the highest degree of centrality within each cluster the chosen threshold d 1 ensures that the objectives were positively correlated within clusters three of the four objectives pertain to india but two of these clusters contain variables associated with bangladesh for instance min mean q i and mean min 4 q i are highly correlated with min mean q b and mean min 4 q b respectively as a result the specific variable chosen for each cluster has little effect on the outcome of the pareto optimization as shown in the sensitivity analysis in section s3 2 5 pareto frontier and scenario neutral analysis the four central objectives q i 40 k min mean q i mean min 4 q i and mean max s b embody the fundamental trade offs of the biophysical system regulated by the ganges treaty the corresponding pareto frontier the set of solutions that are pareto optimal can be identified as the convex hull of the enumerated solutions mapped in the four dimensional space spanned by the considered objectives this mapping for the 25 121 treaty solutions and the associated pareto frontier is represented in fig 5 and discussed in the results section section 3 1 under the assumption that neither party will settle for a treaty that is non dominant under current climate conditions the pareto optimal set contains all treaty solutions that parties might plausibly choose from under the considered set of four central objectives we further determined which treaty solutions of the pareto optimal set are also better than the current treaty according to all four objective variables these treaty solutions are referred to as pob pareto optimal and better under the assumption that parties will not settle for treaty solutions whether pareto optimal or not that are worse than the status quo with regards to any of the four considered objectives to account for the effect of climate change we identified the subset of solutions that remain in the pob set under the broadest range of plausible climate conditions we used the scenario neutral climate vulnerability approach described in brown et al 2012 to determine which of the treaty solutions that are pob under historical climate conditions would remain so under alternative future climates the effect of climate change on ganges streamflow depends on the combined effects of glacial melt in the himalayas changing rainfall patterns during the indian monsoon and changing land and water use in the gangetic plain all of which are highly uncertain wilby and dessai 2010 pervez and henebry 2014 immerzeel et al 2010 lutz et al 2014 in weighing all scenarios equally we do not evaluate the risk likelihood impact associated with climate change for each treaty allocation instead we provide a first order evaluation of the robustness of treaty alternatives to specific changes in key climate drivers without having to rely on a fully specified and down scaled climate model to quantify these changes in situations where climate predictions are readily available the approach can be further refined by using weights to represent the predicted probability of each climate scenario brown et al 2012 in the context of the ganges we consider three sources of hydroclimatic changes 1 changes in flow available at farakka barrage might be altered by changing precipitation patterns and water use upstream wilby and dessai 2010 in particular precipitation is expected to decrease in critical pre monsoon months pervez and henebry 2014 despite an overall expected increase of annual precipitation pervez and henebry 2014 immerzeel et al 2010 as a result streamflow in the upper watershed of the ganges is expected to increase through 2050 lutz et al 2014 in part due to greater runoff from melting glaciers immerzeel et al 2010 kumar et al 2011 siderius et al 2013 but the overall streamflow contribution from the himalayas is expected to decrease with rising temperatures later in the century nepal et al 2014 we incorporated these diverging predictions by simulating changes in the dry season ganges streamflow upstream of the farakka barrage ranging between 20 and 20 of their historical value roughly approximating the range of expected changes in the basin see immerzeel et al 2010 kumar et al 2011 we simulated these changes by multiplying daily simulated dry season streamflow into farakka barrage by a constant factor ranging between 0 8 and 1 2 2 sea level rise will affect salinity conditions in the delta the sea level in the bay of bengal is estimated to rise approximately 0 43 0 84 m by 2100 oppenheimer et al 2019 we simulated increases in sea level of 0 0 2 0 4 0 6 and 0 8 m these changes were incorporated into the boundary conditions of the salinity model as described in section s2 in supplementary information 3 the geomorphology of the delta might be altered due to natural sediment deposition and anthropogenic dredging alteration in particular our salinity model focuses on the gorai river which is a major distributary of the ganges river see fig 1 that supplies freshwater to southern bangladesh a region particularly prone to river salinization the proportion of the ganges streamflow diverted towards the gorai has diminished subtantially over the past few years mirza 1997 but might also increase in a future climate e g if dredging operations are conducted mohiuddin 2002 to account for these possibilities we considered alternative scenarios where the proportion of the ganges flow diverted towards the gorai river is assumed to be 80 100 120 and 160 of the current one this change is implemented by multiplying the parameter of the salinity model associated with advection a in section s2 by a constant representing the relative change in the gorai flow diversion 3 results 3 1 pareto optimal treaty alternatives we found that approximately 10 2 252 of the 25 121 enumerated treaty solutions were pareto optimal under historical climate conditions when considering the four selected objectives fig 5a without the dimensionality reduction procedure from section 2 4 i e considering the full set of original objectives the pareto optimal set of solutions would comprise at least 90 22 566 of all enumerated solutions see supplementary text s4 remarkably the current treaty is not among the pareto optimal treaty solutions meaning that other treaty solutions would have weakly improved on all four objectives under historic conditions importantly the above results are contingent on the four considered objectives these were determined by our cluster analysis to optimally capture the fundamental trade offs of the biophysical system and therefore conditioned by the initial set of candidate objectives that is fed into it as discussed in section 4 the current treaty might well be pareto optimal under another to us unknown set of objectives that were considered when the treaty was established of particular relevance are treaty solutions that are both i pareto optimal and ii better than the current treaty with respect to the four considered objectives these treaties referred to as pareto optimal and better pob make up approximately 19 of the pareto optimal treaty solutions or 1 7 of the total set of solutions the distributions of the decision variables of pob treaty solutions are displayed in fig 5b for most decision variables the corresponding parameter of the current treaty fits within the interquartile range of pob solutions this suggests that the pob treaty solutions are not substantially different from the current treaty for most decision variables an exception arises for the parameter representing the guaranteed flow allocation during interval periods q int most 99 pob treaty solutions have a q int smaller than the q int 35 000 cusec of the current treaty with 75 of the pob treaty solutions with a q int value between 25 000 and 30 000 cusec our results therefore suggest that both parties would benefit from smaller guaranteed flows during interval allocation periods but not from suppressing interval flows altogether to interpret this result consider that interval allocation periods are applied during the period of the year when minimum flow conditions are most likely to occur maximizing the minimum annual flow was identified among the central objective by the clustering analysis because q int typically accounts for the majority of total flows available during interval periods minimum flow for one country generally occurs during the mandated allocation period for the other country rahman et al 2019 under these conditions a treaty with a lower guaranteed flow q int would increase flow availability during the non allocation intervals such a treaty would increase the annual minimal flow of both countries and would therefore dominate treaty solutions with a higher guaranteed flow 3 2 robustness to changing climate conditions fig 6 a describes the climate sensitivity of pareto optimal solutions using two satisficing based robustness measures i e measures that reflect the tendency of decision makers to seek outcomes that meet one or more requirements but may not achieve optimal performance herman et al 2015 the first analysis filters out the treaty solutions that are not pob under historic condition it then evaluates the proportion of the remaining pob solutions that remain pareto approximate for each climate scenario results in fig 6a dashed suggest that the pob treaty solutions are comparatively more sensitive to changes in mean dry season streamflow than to rises in sea level approximately 50 of the 421 treaty solutions that are pob under current climate conditions remain pob for up to 80 cm increases in the mean sea level of the bay of bengal in contrast only 20 of currently pob treaty solutions remain so if mean dry season streamflow decreases by 20 the set of pob solutions appears most sensitive to increases in mean dry season flows a 20 increase in dry season streamflow decreases the set of pob treaties by 92 in a second analysis we determined for each state of the world scenario the subset of treaty alternatives that are also pareto approximate in most 80 other scenarios fig 6a blue circles an approach akin to the domain criterion robustness metric discussed in herman et al 2015 the sets of treaty alternatives that remain pob under each of the three types of changes sea level rise increasing dry season flow and decreasing dry season flow have similarly distributed parameters fig 6c this suggests that there is substantial overlap between the three sets as seen in fig 6 b 4 of the treaties that are pob under current climate are also pob for 80 or more of the considered climate scenarios these results are robust to uncertainties associated with geomorphological changes dredging and silting in the gorai distributary as shown in figure s4 in describing the proportion of treaties that are pob under a given climate scenario the first analysis fig 6a dashed evaluates how climate change might affect the difficulty of the problem a larger proportion of pob treaties means that the solution that gets ultimately selected has a higher chance of being pob i e the negotiation space is larger in contrast the second analysis fig 6a blue is helpful if there is substantial uncertainty on the likelihood of each scenario it allows identification of the subset of currently pob treaty solutions that are robust in that they remain pareto optimal in most scenarios lastly we should note that both analyses pre filter to keep only solutions that are currently pareto optimal under the assumptions that parties will not select a solution that is not currently pareto optimal while intuitive this assumption can be disputed as it is possible that a party prefers a solution that might be pareto optimal in the future even if it is not pareto optimal today we turn our attention to the decision variable values associated with robust pob solutions climate robust treaties are a subset of the treaty solutions that are pob under current climate conditions and so unsurprisingly have similar distributions of decision variables fig 6c in particular their interval flow threshold q int is generally smaller than that of the current treaty in order to navigate the trade off between average and minimum dry season flows see previous section however climate robust treaties differ from the wider set of pob treaties in that they have fewer and shorter intervals smaller n and m and a significantly larger q 2 threshold than the current treaty to interpret these results consider that a shorter period regulated by interval flows allows for a larger portion of the dry season to be governed by proportional flow allocation we speculate that this in turn might decrease the total number of days with flow allocations less than 40 000 cusec which was identified as a central objective by the clustering analysis however a shorter period with guaranteed interval flows might also decrease the treaty s ability to dampen salinity conditions through increased freshwater flow indeed maximum salinity conditions generally occur towards the end of may a few weeks after minimum flow conditions during a period no longer regulated by interval flows under these conditions we speculate that increasing q 2 is pareto improving because it increases the flow available to bangladesh to mitigate river salinity during this critical period we note that these results are likely driven by the fact that salinity conditions in india would likely be affected by an increase in q 2 but were not included in the initial set of candidate objectives variables due to unavailable data as discussed in section 4 4 discussion the optimization of shared river water is a complex challenge that requires reconciling the multiple objectives of numerous stakeholders at times within a complex and not necessarily cooperative negotiation process problem framing uncertainty can then emerge from the fact that stakeholder preference might be kept private for strategic reasons causing the true vector of combined stakeholder objective to be hidden this uncertainty adds on to uncertainties about future states of the world associated with climate change the exploratory modelling approach that we propose combines hierarchical clustering with scenario neutral analysis to mitigate both types of uncertainties and facilitate the discovery of robust pareto optimal river treaty configuration it relies on a series of important assumptions namely i an initial set of candidate objectives must be appropriately enumerated ii these objectives must be clustered in a way that does not lose too much information about pareto dominance iii the pareto optimal set of solutions must be accurately estimated iv pareto dominance must be an effective filter i e the ideal solution must indeed lie within the estimated pareto optimal set and v future states of the world must be properly enumerated these five assumptions are individually discussed in the following paragraphs 4 1 initial set of candidate objectives whether the approach designates a treaty as pareto optimal is ultimately dependant upon the initial set of objective variables that are fed into the clustering algorithm the 26 streamflow and salinity statistics chosen in our illustrative example were based on data availability and intuitive assumptions on the broad objectives of each party maximizing streamflow and minimizing salinity in particular we did not have access to calibrated models of salinity and siltation on the indian side both of which were stated as minimization objectives by india in their use of the ganges water salman and uprety 1999 including these variables into the initial set of objectives might have led to a different set of pob treaties more fundamentally by focusing on a specific set of state based statistics the approach does not engage with broader classes of objectives beyond statistics of flow and salinity e g economic equity risk mitigation and sectoral priorities that might be important to policy makers in real transboundary river systems these considerations have two important implications for the practical applicability of our approach first the approach relies on appropriate biophysical models that are able to accurately simulate all considered objective variables the development and calibration of these models may require effective data sharing and joint research effort between the countries party to the agreement second the approach should be integrated within a broader process of knowledge co production that acknowledges preexisting power dynamics and historical legacies amongst stakeholders in both the scientific and policy realms see wyborn et al 2019 this context should inform the formulation of the initial set of objective variables and the interpretation of the resulting pareto partition 4 2 clustering and information loss reducing the dimensionality of the objective set implies a tension between simplifying the optimization problem and losing important information this tradeoff is governed by the cutoff distance d which determines the minimum level of correlation between the objectives within the clusters and therefore the number of clusters and the extent of information loss while some information loss is inevitable it should minimally impact the composition of the ensuing pareto optimal set the numerical experiment described in supplementary text s3 assesses the relationship between the size of the objective set and the relative ordering of objective rankings we evaluated how sensitive the composition of the pareto optimal set is to the two arbitrary parameters of the clustering approach namely the choice of cutoff distance d and the choice of the central objective to consider for each cluster we found that the composition of the pareto optimal set was robust to both choices as long as the objective chosen to represent each cluster has a sufficient degree of centrality within the cluster 4 3 accuracy of approximated pareto optimal set errors on the pareto optimal set can emerge from an incomplete enumeration of treaty solutions as argued in section 2 2 the bounds on the five decision variables represent physical constraints related to diversion infrastructure or known historic legacies similarly the enumeration intervals represent the smallest increment in the decision variables that would be practical to implement based on these considerations we believe that the enumerated solutions are an accurate representation of the true set of solutions within the considered decision space however a more fundamental assumption concerns the decision space itself and its five decision variables which are based on the current treaty the structure of the current treaty is rooted in a long history of bilateral interactions between india and bangladesh over the ganges river which makes it likely to be carried over to the renewed treaty in 2026 for example the 10 day intervals with alternating flow guarantees date back to an initial agreement that was finalized days before the commission of the farakka barrage salman and uprety 1999 the initial agreement was signed on april 18 1975 and regulated withdrawals by india in portions of 10 days during the 41 remaining days of that single year s dry season however the 10 day intervals of the current treaty have been criticized as propitious to unilateral flow withdrawals thomas 2017 and as causing severe water scarcity during the intervals with non guaranteed flow rahman et al 2019 these considerations point to the potential for also examining treaty solutions that do not conform with the current treaty structure for example simulations by kilgour and dinar 2001 found that a flexible allocation based on flow forecasts might increase total welfare by up to 10 in dry years 4 4 overlap with true set of pareto optimal solutions our approach mitigates strategic framing uncertainty by identifying governing set of objectives based on known physical constraints of the systems rather than the hidden preferences of its stakeholders it follows that the ensuing set of objectives unlikely corresponds to the true vector of combined stakeholder objectives which remains hidden rather the dimensionality reduction approach can be seen as a way to simplify a poorly framed due to hidden objectives many objective optimization problem using information available to all stakeholders because of this and assuming all above assumptions hold we conjecture that the ensuing set of pareto optimal solutions contains the true set of pareto optimal solutions however without knowledge of the true set of stakeholder objectives this conjecture is challenging to test at the very least the hierarchical clustering approach that we propose particularly the dendrogram in fig 4 can be used as a tool to help stakeholders visualize the governing trade offs of the considered bio physical system 4 5 future states of the world and non stationary climate international river agreements are traditionally based on long term flow statistics computed from historic observation e g rahman et al 2019 the underlying assumption of a stationary flow regime is unlikely to hold in the context of climate change the scenario neutral approach that we propose is a first step towards addressing this issue by evaluating the sensitivity of treaty solutions to changes in key climate drivers without requiring detailed climate simulations however it does not address many of the issues associated with changing flow regimes in transboundary basins for example scenario neutral analyses make implicit assumptions about the range and independence of the climate drivers that can render the ensuing visualization misleading quinn et al 2020 changes in climate drivers can be correlated and systems might be particularly vulnerable to conditions outside the range of historical events borgomeo et al 2015 as quinn et al 2020 put it these assumptions could influence which factors are found to be most important and which policies are most robust belying their neutrality assuming uniformity and independence could have decision relevant implications more broadly using long term statistics in a non stationary context means that what is being optimized is a hypothetical value that does not exist i e a long term average that may change more rapidly than the underlying timeseries it is theoretically calculated on while adapted for situations where detailed climate predictions are unavailable the scenario neutral analysis can be seen as a temporary patch in the sense that it evaluates the climate sensitivity of a decision that is nonetheless made under the fundamental assumption of climate stationarity 5 conclusions transboundary water treaties face a variety of challenges due to changing climatic and environmental conditions raising the issue of how to appropriately update existing treaties for an uncertain future we develop an approach that addresses three key questions about transboundary treaty design i how to identify governing trade offs associated with the bio physical nature of the system ii how to visualize and determine the effects of the negotiated parameters of the treaty decision variables on its outcomes objectives and iii how to identify agreeable pareto optimal treaty solution in a way that accounts for a changing and uncertain climate the approach combines hierarchical clustering with a scenario neutral analysis to achieve address these questions applied to the ganges water agreement as an illustrative example the approach shows promise in its ability to discard sub optimal treaty alternatives however the example also shows that the output of the approach i e the set of identified pob treaties depends on the initial sets of treaty parameters and objective variables that are fed into the approach consequently the location specific numerical results that we present are not intended to serve as a basis to renew the treaty instead the approach rather than the illustrative results that we present can be applied to support decisions in the much richer informational environment available to actual decision makers our illustrative case study is intended to demonstrate the potential for this data driven approach to support rather than replace a broader negotiation process and serve as a shared information basis around which stakeholders can coalesce declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests marc f muller reports financial support was provided by national science foundation acknowledgement this research has been conducted under a collaborative project between bangladesh university of engineering and technology buet and the university of notre dame usa funding from the keough school of global affairs the notre dame environmental change initiative and notre dame research is acknowledged kryston penny bolster and müller acknowledge the support from the national science foundation under grant icer 1824951 bolster acknowledges support from the national science foundation under grant ear 2049688 streamflow and salinity data used in this study are available for purchase from the bangladesh water development board dr joseph guillaume and two anonymous reviewers are gratefully acknowledged for their constructive comments appendix a supplementary data supplementary data associated with this article can be found in the online version athttps doi org 10 1016 j jhydrol 2022 128004 supplementary data the following are the supplementary data to this article supplementary data 1 
3184,climate change will alter the flow availability and expected water allocations in international river treaties many of which were designed using historical flow records effective transboundary treaties should anticipate these concerns and seek to satisfy the priorities of all riparian countries while being robust to impending changes in climate this task is complicated by the fact that specific objectives associated with each party s priorities are not necessarily common knowledge framing uncertainty and the direction amplitude and effect of long term changes in hydro climatic drivers can be highly uncertain climate uncertainty we frame the design of a transboundary treaty as a multi objective optimization problem we use hierarchical clustering to address problem framing uncertainty by identifying the subset of objectives associated with the governing trade offs imposed by the bio physical characteristics of the shared river system we then carry out a scenario neutral climate sensitivity analysis to identify climate robust pareto optimal treaty solutions we illustrate the approach for the ganges water agreement which is due to be renewed in 2026 based on an enumerated population of 25 121 feasible treaty solutions we identify governing objectives and 16 treaty solutions that are pareto optimal under most considered combinations of changes in sea level and dry season flow regime this work provides a path towards improving transboundary allocations for the ganges water treaty and more broadly a template to support transboundary cooperation over shared international rivers keywords multi objective optimization ganges climate change india bangladesh salinity 2000 msc 0000 1111 1 introduction climate change and increased anthropogenic water use threaten water security and pose challenges for water management in many basins around the world stronger storms chen et al 2020 more intense droughts overpeck and udall 2020 and greater hydro meteorological uncertainty panahi et al 2020 are expected in many regions of the world where population growth combined with agricultural intensification will further threaten water security the consequences of these changes include groundwater depletion cotterman et al 2018 freshwater and soil salinization haque 2006 loss of livelihoods muringai et al 2019 and other environmental crises turner et al 2020 these issues are particularly evident in several internationally shared basins including the nile beyene et al 2010 mekong kiem et al 2008 colorado barnett and pierce 2009 and ganges rahman et al 2019 rivers stable and effective policy instruments to manage transboundary waters have become critical for maintaining international cooperation and preventing economic or political crises dinar et al 2016 over two hundred transboundary river basins have been identified housing 42 of the global population water sharing in these basins has led to the creation of over six hundred treaties on freshwater management since the early nineteenth century unep dhi unep 2016 however many of these agreements may not perform well under an increasingly volatile and uncertain climate draper and kundell 2007 new or renegotiated agreements should ideally balance the competing needs of each party while striving to support benefits that are robust to a changing climate this process can be formulated as a multi objective optimization problem that riparian countries cooperatively solve following the framework in maier et al 2019 the objectives i e outcomes of interest are to maximize environmental social and economic benefits and to minimize environmental social and economic costs by selecting appropriate transboundary flow allocation rules which are the decision variables the set of objectives considered in the optimization corresponds to the union of the sets of objectives associated with each party this formulation allows us to focus on conflicting objectives in terms of tradeoffs between measures of system performance this notion of conflict does not necessarily correspond to conflicting actor incentives as treated by non cooperative game theory see e g müller et al 2017 penny et al 2021 indeed the considered tradeoffs between measures of system performance can also arise for a single actor with conflicting performance objective measures for example a given actor might want to simultaneously minimize the peak and maximize the average of incoming streamflow the constraints include the available water resources the physical limits on the diversion infrastructure political feasibility and historical legacies e g pre existing treaties a solution consists of the set of transboundary flow allocation rules that form a treaty trade offs associated with the potentially conflicting nature of the objectives are captured by the notion of pareto optimality e g kasprzyk et al 2013 a solution is pareto optimal if no change in the decision variables could improve any objective without making the situation worse for another in contrast a solution that is not pareto optimal would miss some of the possible joint gains of cooperation and leaves on the table one or more solutions that would make all parties better off kronaveter and shamir 2009 pareto optimality is therefore a requisite attribute of cooperative bargaining solutions nash 1953 kalai and smorodinsky 1975 and a desirable outcome for international water negotiations kronaveter and shamir 2009 in reality of course transboundary water negotiations might not be cooperative and problem framing uncertainties arise from the fact that not all relevant optimization objectives are common knowledge across the negotiating parties our approach relies on the assumption that an initial broad set of candidate objectives can generally be constructed intuitively based on the bio physical and socio political context see discussion in section 4 1 for example in the context of the ganges both parties likely seek to maximize average flow availability during the dry season but minimize salinity and flow variability these candidate objectives might be refined using information available to both parties though not necessarily to the wider public though appropriate approaches to engage stakeholders in a process of knowledge co production wyborn et al 2019 however the relative importance of each objective for each party i e objectives that matter vs objectives that can be safely removed from the optimization might ultimately be kept private for strategic reasons in other words the true set of optimization objectives is likely unknown which prevents the true set of pareto optimal solutions from being discovered this issue is well known in the negotiation literature where a variety of protocols have been proposed to guide the negotiating parties towards the discovery and achievement of pareto optimal outcomes see e g ehtamo et al 1999 lai and sycara 2009 kronaveter and shamir 2009 here in contrast we seek to decrease the dimensionality of the set of candidate objectives ex ante based on known dynamics of the bio physical system rather than publicly unknown preferences of the negotiating parties doing so does not necessarily reveal the true set of hidden stakeholder objectives rather the approach can be seen as a way to leverage publicly available information to simplify a many objective optimization problem that is poorly framed due to hidden objectives see section 4 4 pareto optimality is a non dominance mathematical partitioning rule as one increases the number of objectives the partitioning rule becomes less discriminatory resulting in an increase in the size of the pareto optimal set a phenomenon known as dominance resistance e g reed et al 2013 an excessively large set of objectives such as the full set of initial candidate objectives will cause many solutions that are non dominant under the true set of objectives to be included in the discriminated solution set in contrast considering too few objectives can lead to the opposite issue of oversimplifying the problem by missing important portions of the objective set that are only non dominated with the addition of more objectives see examples in kollat and reed 2007 woodruff et al 2013 our contribution is to leverage the internal physical dynamics of the system to navigate this trade off we apply a data based pattern recognition technique hierarchical clustering on enumerated solutions to reduce the dimensionality of the set of objectives and approximate the pareto optimal set of solutions while minimizing information loss see discussion in section 4 2 in doing so we assume that all feasible treaty solutions can be enumerated an assumption that is discussed in section 4 3 our approach relates to the literature seeking to reduce the complexity of many objective optimization problems by exploiting the correlation between certain objectives e g deb et al 2006 brockhoff and zitzler 2006 brockhoff and zitzler 2009 for example giuliani et al 2014 leverages numerical correlations between objectives to aggregate them into a reduced number of linear combinations of objectives principal components with respect to which the optimization problem is solved here we follow lindroth et al 2010 and estimate pearson correlation coefficients across enumerated solutions between pairs of objectives we then use a clustering procedure to systematically reduce the number of objectives in a manner that is informed by the structure of these correlations in the underlying dataset another type of uncertainty this time on the future states of the world arises from the fact that it is challenging to determine precisely how much and how quickly the relevant climate inputs will change deser et al 2012 in that context it is not sufficient to identify water allocations that are pareto optimal under current conditions rather the analysis must also navigate the trade off between objectives under a range of potential changes in environmental constraints we incorporate a scenario neutral sensitivity analysis to evaluate the robustness of the pareto optimal set of solutions to different combinations of climate inputs following brown et al 2012 different components of the system are considered to create a model with a climate response function the model is then perturbed by stochastically generated climate inputs in order to identify the climate states associated with high risk of systemic failure despite the caveats discussed in section 4 5 this type of scenario neutral analysis is commonly used to evaluate the climate vulnerability of systems brown et al 2012 jones 2001 wilby and dessai 2010 including transboundary river systems de boer et al 2021 in situations where the change in the relevant climatic drivers is highly uncertain however it has not to our knowledge been applied to evaluate the effect of climate uncertainty on the composition of pareto optimal solution sets the approach that we propose which combines hierarchical clustering and scenario neutral analysis falls within the broader category of exploratory modelling approaches in the sense that it addresses both types of uncertainty on framing and on future world states by using numerical simulation to systematically explore their implications on enumerated outcomes it fits within recent frameworks to confront deep uncertainty within water management problems through robust multi objective optimization see moallemi et al 2020 table 1 for example kasprzyk et al 2012 proposes an iterative framework where a pre processing analysis sobol variance decomposition is carried out to reformulate the problem de novo in a way that seeks to balance complexity and effectiveness before the multi objective optimization in a similar manner we use hierarchical clustering here to refine an initial vector of candidate objectives to update the dimensionality of the problem before identifying pareto optimal solutions kasprzyk et al 2012 continues with a scenario analysis to test the robustness of solutions to model assumptions a step that mirrors our proposed scenario neutral analysis we demonstrate our combined approach using the ganges water sharing agreement gwsa between india and bangladesh as an illustrative example the agreement determines the flow of the ganges into bangladesh during the dry season january may by regulating the operation of the farakka barrage fig 1 in india approximately 100 km upstream of the border the barrage diverts ganges river water into the bhagirathi hooghly river a distributary of the ganges that discharges into the bay of bengal in india near the port city of kolkata the gwsa exemplifies the multi faceted challenges associated with transboundary river management under a changing climate the treaty was signed in 1996 with the purpose of balancing flow requirements to de silt the port of kolkata one of india s major cargo ports with dry season irrigation and environmental water needs in bangladesh tanzeema and faisal 2001 since then the flow regime of the ganges and the geomorphology of the delta have changed substantially under the coupled effect of changing rain patterns and upstream water uses rahman et al 2000 in addition salt intrusion has become a major concern throughout the ganges delta due in part to sea level rise and increasingly frequent and intense storm surges rahman et al 2019 these changes have had particularly damaging economic public health and ecological impact in coastal communities in south western bangladesh and the sundarbans a unique and world s largest mangrove ecosystem faisal and parveen 2004 sufficient provision of freshwater inflow through the ganges is paramount to prevent saline intrusions rahman et al 2000 pethick and orford 2013 shammi et al 2016 these rapidly changing conditions might have reduced the effectiveness of current treaty allocations penny et al 2020 which were based on average flow data collected from 1949 1988 and have not been updated salman and uprety 1999 because the treaty is slated to be renewed in 2026 a tractable approach to understand and visualize the implicated hydrologic trade offs is of immediate policy relevance 2 methods 2 1 optimization problem and decision variables we use the notation in kasprzyk et al 2013 to formulate the new gwsa treaty as a multi objective optimization problem seeking to minimize a vector f of p objectives f 1 f 2 f p by choosing a vector l of decision variables within a decision space ω 1 min l ω f l f 1 f 2 f p s t c i l 0 i 1 q where c i l 0 i 1 q represents q constraints on the vector of decision variables feasible solutions are defined as those meeting all the imposed constraints a solution f a dominates another solution f b if f i a f i b i and j f j a f j b the solution is pareto optimal if it is non dominated with respect to all other feasible solutions kasprzyk et al 2013 we defined decision variables by parameterizing the current treaty under the premise that its structure will serve as a basis for its renewal in 2026 the current treaty allocates a fixed percentage p q 1 50 of incoming streamflow to bangladesh and the remaining flow to india up to a threshold q 2 35 000 cubic feet per second or cusec allocated to bangladesh this threshold corresponds to a total incoming streamflow of 70 000 cusec q 2 p q 1 upstream of the diversion additional flow beyond that threshold is allocated to india with flow to bangladesh maintained at q 2 35 000 cusec up to another threshold of 40 000 cusec allocated to india this latter threshold is determined by the capacity of the canal diverting the flow towards india kawser and samad 2016 and is unlikely to be altered in a renewed treaty under current treaty allocations this threshold corresponds to a total flow of q 2 40 000 75 000 cusec upstream of the diversion the treaty also includes special provisions for the driest period of the year march 11 to may 10 during which guaranteed flows are allocated to bangladesh and india in alternating 10 day periods the current treaty splits this period centered around april 10 into n 6 intervals of m 10 days during which a minimum flow of q int 35 000 cusec is alternately guaranteed to each country see penny et al 2020 treaty allocation rules and the five parameters that govern them p q 1 q 2 q int m and n are summarized in fig 2 these five parameters constitute the decision variable vector l of the multi objective optimization 2 2 constraints and enumeration of solutions the five decision variables are bound by a series of constraints summarized in table 1 associated with the physical flow diversion infrastructure and historical legacies namely the feeder canal linking the ganges at farakka barage with the hooghly river has a capacity of 40 000 cusec assuming that the physical capacity of the canal will not be increased when the treaty is renewed this sets a hard limit on the flow that can be diverted to india accordingly q 2 and q int are capped at 40 000 cusec in addition the current treaty prescribes emergency arrangements if the total flow of the ganges at farakka falls below 50 000 cusec we assumed that this clause will carry over to the renewed treaty and set a lower limit of q int at 50 000 2 25 000 cusec this allows each party to benefit from intervals of guaranteed flows before emergency measures are invoked i e for incoming flows at farakka equal to or higher than 50 000 cusec further the minimum flow for q 2 is set to 30 000 cusec so that there generally remains a period of total flow above emergency measures 50 000 cusec that is dictated by p q 1 the number and duration of intervals m and n are set so that the total period governed by interval allocation remains at or below 150 days which corresponds to the entire duration of the annual low flow period regulated by the treaty january 1 to may 31 m must also be an even number for both countries to be attributed identical numbers of guaranteed flow periods regarding the percentage of flow allocated to bangladesh under low flow conditions outside of the interval period we arbitrarily set its boundaries at 45 and 70 the current treaty divides these flow conditions equally between the two countries so deviations from the status quo are likely politically challenging yet if the parameter does become altered in the renewed treaty we assumed it to be more likely in the favor of india due to its favorable hydro strategic position the ensuing constraints c i l on the decision variables are summarized in table 1 we enumerated 25 121 feasible treaty solutions that span the constrained decision space at regular intervals these intervals displayed on table 1 represent the smallest increment in the decision variables that would be practical to implement for example the flow increment of 1000 cusec or 2 8 m 3 s corresponds to a height increment of only approximately 15 cm across the 11 gates of 12 m span that form the head regulation structure of the diversion canal assuming sluice gates with a spillway coefficient of 1 given these considerations the intervals in table 1 are sufficiently small for the enumerated solutions to allow for a reasonable approximation of the true pareto optimal set associated with the considered objectives 2 3 initial set of candidate objectives our initial set of candidate objectives relate to flow conditions in india and bangladesh immediately downstream of the diversion and to salinity conditions in the gorai river in bangladesh near the city of khulna flow and salinity conditions in the gorai are critical in terms of controlling salinity conditions in southwest bangladesh a region that is particularly vulnerable and sensitive to saline intrusions from the bay of bengal mirza and sarker 2004 under the premise that both countries seek to maximize average flows but minimize flow variability and salinity a strong assumption that is discussed in section 4 1 we constructed the initial set of 26 candidate objectives described in table 2 with the aim of capturing the central tendency variability and extremes of flow and salinity at intra and inter annual time scales we evaluated the 26 candidate objectives for each of the 25 121 enumerated solutions by applying the corresponding diversion rules to historical 1998 2017 ganges streamflow upstream of farakka this allowed us to simulate historical downstream conditions in india and bangladesh had the existing treaty allocations been different to do so we proceed as follows see fig 3 1 multiple data sources were combined see supplementary information section s1 to construct estimates of daily inflow to farakka barrage during the january 1 to may 31 period between 1998 and 2017 2 daily streamflow allocations to india and bangladesh were reconstructed using treaty parameters for each of the 25 121 considered treaty alternatives 3 a simple physically based salinity model was used to simulate salinity in the ganges delta in bangladesh gorai river at khulna fig 1 the salinity model incorporates advection and first order exchange processes and is influenced by the incoming streamflow mixing volume e g channel geometry and downstream salinity conditions see section s2 and penny et al 2020 the resulting simulations of daily streamflow india and bangladesh and salinity bangladesh were then used to compute the statistics corresponding to each candidate objective 2 4 dimensionality reduction starting with the initial set of candidate objectives we sought to reduce the number of objectives by exploiting the fact that some objectives might be correlated due to underlying bio physical relationship for example physical constraints e g mass balance advection and mixing associate an increased flow to india with a decreased flow and increased salinity in bangladesh characterizing how these dependencies play out between each combination of objectives in table 2 might allow them to be grouped into clusters that best embody the governing physical trade offs of the system and discount the effect of potentially redundant objectives we used the procedure of agglomerative hierarchical clustering to classify the initial set of candidate objectives according to their similarity across the 25 121 solutions legendre and legendre 1998 to do so we defined a dissimilarity or distance matrix d ij 1 r ij 0 2 where r ij is the pearson correlation coefficient between the simulated value of objectives i and j across the 25 121 enumerated solutions prior to calculating the pearson coefficient statistics associated with salinity levels and flow variability which parties seek to minimize were multiplied by 1 we then implemented complete linkage clustering to group the candidate objectives in increasing order of dissimilarity the most correlated pairs of candidate objectives were grouped first and produce a cluster tree or dendrogram fig 4 another way to consider the problem is to think of the 26 initial candidate objectives as a network of 26 nodes with distance matrix given by d ij hierarchical clustering was used to identify the communities within the obtained graph that best represents its structure radicchi et al 2004 clusters of similar candidate objectives were determined by cutting the dendrogram so that all candidate objectives contained by a cut branch fall within a single cluster although several techniques exist to optimally prune hierarchical dendrograms e g langfelder et al 2008 a parsimonious approach is to cut the tree at a constant dissimilarity threshold d an optimal value of d will maximize both the similarity of objectives within clusters and the dissimilarity of objectives between clusters an excessively small d would produce a large number of similar clusters and fail to capture the governing trade offs of the problem in contrast an excessively large d would group dissimilar objectives within the same cluster if the objectives within a cluster are too dissimilar the choice of the particular objective used to represent the cluster in the pareto optimization will strongly influence its result figure s5 here we used a dissimilarity threshold d 1 this corresponds to a pearson correlation coefficient r 0 meaning that objectives within clusters are positively correlated across the 25 121 enumerated solutions whereas objectives across clusters are negatively correlated in our specific case study a threshold d 1 falls at the limit between three and four clusters fig 4a light green line we opted for four clusters to increase the similarity of objectives within a cluster and make the pareto optimization less sensitive to the particular choice of the objectives used to represent each cluster we identified a single representative objective per cluster by considering the correlation matrix r ij associated with each cluster one matrix by cluster as an analog to a graph adjacency matrix where each node represents an objective for each matrix we then identified the node i e objective with the highest measure of degree centrality golbeck 2015 the approach indicated the following objectives as central to each cluster 1 mean max s b which is the inter annual mean of the intra annual maximum of daily salinity in bangladesh gorai river at khulna 2 mean min 4 q i which is the inter annual mean of the four lowest intra annual minimum daily flows to india 3 min mean q i which is the inter annual minimum of the intra annual mean flow to india 4 days q i 40 k which is the number of days in the full 1998 2017 period where flow to india is less than 40 000 cusec which is the maximum flow that india can receive although these four objectives have the highest degree of centrality within each cluster the chosen threshold d 1 ensures that the objectives were positively correlated within clusters three of the four objectives pertain to india but two of these clusters contain variables associated with bangladesh for instance min mean q i and mean min 4 q i are highly correlated with min mean q b and mean min 4 q b respectively as a result the specific variable chosen for each cluster has little effect on the outcome of the pareto optimization as shown in the sensitivity analysis in section s3 2 5 pareto frontier and scenario neutral analysis the four central objectives q i 40 k min mean q i mean min 4 q i and mean max s b embody the fundamental trade offs of the biophysical system regulated by the ganges treaty the corresponding pareto frontier the set of solutions that are pareto optimal can be identified as the convex hull of the enumerated solutions mapped in the four dimensional space spanned by the considered objectives this mapping for the 25 121 treaty solutions and the associated pareto frontier is represented in fig 5 and discussed in the results section section 3 1 under the assumption that neither party will settle for a treaty that is non dominant under current climate conditions the pareto optimal set contains all treaty solutions that parties might plausibly choose from under the considered set of four central objectives we further determined which treaty solutions of the pareto optimal set are also better than the current treaty according to all four objective variables these treaty solutions are referred to as pob pareto optimal and better under the assumption that parties will not settle for treaty solutions whether pareto optimal or not that are worse than the status quo with regards to any of the four considered objectives to account for the effect of climate change we identified the subset of solutions that remain in the pob set under the broadest range of plausible climate conditions we used the scenario neutral climate vulnerability approach described in brown et al 2012 to determine which of the treaty solutions that are pob under historical climate conditions would remain so under alternative future climates the effect of climate change on ganges streamflow depends on the combined effects of glacial melt in the himalayas changing rainfall patterns during the indian monsoon and changing land and water use in the gangetic plain all of which are highly uncertain wilby and dessai 2010 pervez and henebry 2014 immerzeel et al 2010 lutz et al 2014 in weighing all scenarios equally we do not evaluate the risk likelihood impact associated with climate change for each treaty allocation instead we provide a first order evaluation of the robustness of treaty alternatives to specific changes in key climate drivers without having to rely on a fully specified and down scaled climate model to quantify these changes in situations where climate predictions are readily available the approach can be further refined by using weights to represent the predicted probability of each climate scenario brown et al 2012 in the context of the ganges we consider three sources of hydroclimatic changes 1 changes in flow available at farakka barrage might be altered by changing precipitation patterns and water use upstream wilby and dessai 2010 in particular precipitation is expected to decrease in critical pre monsoon months pervez and henebry 2014 despite an overall expected increase of annual precipitation pervez and henebry 2014 immerzeel et al 2010 as a result streamflow in the upper watershed of the ganges is expected to increase through 2050 lutz et al 2014 in part due to greater runoff from melting glaciers immerzeel et al 2010 kumar et al 2011 siderius et al 2013 but the overall streamflow contribution from the himalayas is expected to decrease with rising temperatures later in the century nepal et al 2014 we incorporated these diverging predictions by simulating changes in the dry season ganges streamflow upstream of the farakka barrage ranging between 20 and 20 of their historical value roughly approximating the range of expected changes in the basin see immerzeel et al 2010 kumar et al 2011 we simulated these changes by multiplying daily simulated dry season streamflow into farakka barrage by a constant factor ranging between 0 8 and 1 2 2 sea level rise will affect salinity conditions in the delta the sea level in the bay of bengal is estimated to rise approximately 0 43 0 84 m by 2100 oppenheimer et al 2019 we simulated increases in sea level of 0 0 2 0 4 0 6 and 0 8 m these changes were incorporated into the boundary conditions of the salinity model as described in section s2 in supplementary information 3 the geomorphology of the delta might be altered due to natural sediment deposition and anthropogenic dredging alteration in particular our salinity model focuses on the gorai river which is a major distributary of the ganges river see fig 1 that supplies freshwater to southern bangladesh a region particularly prone to river salinization the proportion of the ganges streamflow diverted towards the gorai has diminished subtantially over the past few years mirza 1997 but might also increase in a future climate e g if dredging operations are conducted mohiuddin 2002 to account for these possibilities we considered alternative scenarios where the proportion of the ganges flow diverted towards the gorai river is assumed to be 80 100 120 and 160 of the current one this change is implemented by multiplying the parameter of the salinity model associated with advection a in section s2 by a constant representing the relative change in the gorai flow diversion 3 results 3 1 pareto optimal treaty alternatives we found that approximately 10 2 252 of the 25 121 enumerated treaty solutions were pareto optimal under historical climate conditions when considering the four selected objectives fig 5a without the dimensionality reduction procedure from section 2 4 i e considering the full set of original objectives the pareto optimal set of solutions would comprise at least 90 22 566 of all enumerated solutions see supplementary text s4 remarkably the current treaty is not among the pareto optimal treaty solutions meaning that other treaty solutions would have weakly improved on all four objectives under historic conditions importantly the above results are contingent on the four considered objectives these were determined by our cluster analysis to optimally capture the fundamental trade offs of the biophysical system and therefore conditioned by the initial set of candidate objectives that is fed into it as discussed in section 4 the current treaty might well be pareto optimal under another to us unknown set of objectives that were considered when the treaty was established of particular relevance are treaty solutions that are both i pareto optimal and ii better than the current treaty with respect to the four considered objectives these treaties referred to as pareto optimal and better pob make up approximately 19 of the pareto optimal treaty solutions or 1 7 of the total set of solutions the distributions of the decision variables of pob treaty solutions are displayed in fig 5b for most decision variables the corresponding parameter of the current treaty fits within the interquartile range of pob solutions this suggests that the pob treaty solutions are not substantially different from the current treaty for most decision variables an exception arises for the parameter representing the guaranteed flow allocation during interval periods q int most 99 pob treaty solutions have a q int smaller than the q int 35 000 cusec of the current treaty with 75 of the pob treaty solutions with a q int value between 25 000 and 30 000 cusec our results therefore suggest that both parties would benefit from smaller guaranteed flows during interval allocation periods but not from suppressing interval flows altogether to interpret this result consider that interval allocation periods are applied during the period of the year when minimum flow conditions are most likely to occur maximizing the minimum annual flow was identified among the central objective by the clustering analysis because q int typically accounts for the majority of total flows available during interval periods minimum flow for one country generally occurs during the mandated allocation period for the other country rahman et al 2019 under these conditions a treaty with a lower guaranteed flow q int would increase flow availability during the non allocation intervals such a treaty would increase the annual minimal flow of both countries and would therefore dominate treaty solutions with a higher guaranteed flow 3 2 robustness to changing climate conditions fig 6 a describes the climate sensitivity of pareto optimal solutions using two satisficing based robustness measures i e measures that reflect the tendency of decision makers to seek outcomes that meet one or more requirements but may not achieve optimal performance herman et al 2015 the first analysis filters out the treaty solutions that are not pob under historic condition it then evaluates the proportion of the remaining pob solutions that remain pareto approximate for each climate scenario results in fig 6a dashed suggest that the pob treaty solutions are comparatively more sensitive to changes in mean dry season streamflow than to rises in sea level approximately 50 of the 421 treaty solutions that are pob under current climate conditions remain pob for up to 80 cm increases in the mean sea level of the bay of bengal in contrast only 20 of currently pob treaty solutions remain so if mean dry season streamflow decreases by 20 the set of pob solutions appears most sensitive to increases in mean dry season flows a 20 increase in dry season streamflow decreases the set of pob treaties by 92 in a second analysis we determined for each state of the world scenario the subset of treaty alternatives that are also pareto approximate in most 80 other scenarios fig 6a blue circles an approach akin to the domain criterion robustness metric discussed in herman et al 2015 the sets of treaty alternatives that remain pob under each of the three types of changes sea level rise increasing dry season flow and decreasing dry season flow have similarly distributed parameters fig 6c this suggests that there is substantial overlap between the three sets as seen in fig 6 b 4 of the treaties that are pob under current climate are also pob for 80 or more of the considered climate scenarios these results are robust to uncertainties associated with geomorphological changes dredging and silting in the gorai distributary as shown in figure s4 in describing the proportion of treaties that are pob under a given climate scenario the first analysis fig 6a dashed evaluates how climate change might affect the difficulty of the problem a larger proportion of pob treaties means that the solution that gets ultimately selected has a higher chance of being pob i e the negotiation space is larger in contrast the second analysis fig 6a blue is helpful if there is substantial uncertainty on the likelihood of each scenario it allows identification of the subset of currently pob treaty solutions that are robust in that they remain pareto optimal in most scenarios lastly we should note that both analyses pre filter to keep only solutions that are currently pareto optimal under the assumptions that parties will not select a solution that is not currently pareto optimal while intuitive this assumption can be disputed as it is possible that a party prefers a solution that might be pareto optimal in the future even if it is not pareto optimal today we turn our attention to the decision variable values associated with robust pob solutions climate robust treaties are a subset of the treaty solutions that are pob under current climate conditions and so unsurprisingly have similar distributions of decision variables fig 6c in particular their interval flow threshold q int is generally smaller than that of the current treaty in order to navigate the trade off between average and minimum dry season flows see previous section however climate robust treaties differ from the wider set of pob treaties in that they have fewer and shorter intervals smaller n and m and a significantly larger q 2 threshold than the current treaty to interpret these results consider that a shorter period regulated by interval flows allows for a larger portion of the dry season to be governed by proportional flow allocation we speculate that this in turn might decrease the total number of days with flow allocations less than 40 000 cusec which was identified as a central objective by the clustering analysis however a shorter period with guaranteed interval flows might also decrease the treaty s ability to dampen salinity conditions through increased freshwater flow indeed maximum salinity conditions generally occur towards the end of may a few weeks after minimum flow conditions during a period no longer regulated by interval flows under these conditions we speculate that increasing q 2 is pareto improving because it increases the flow available to bangladesh to mitigate river salinity during this critical period we note that these results are likely driven by the fact that salinity conditions in india would likely be affected by an increase in q 2 but were not included in the initial set of candidate objectives variables due to unavailable data as discussed in section 4 4 discussion the optimization of shared river water is a complex challenge that requires reconciling the multiple objectives of numerous stakeholders at times within a complex and not necessarily cooperative negotiation process problem framing uncertainty can then emerge from the fact that stakeholder preference might be kept private for strategic reasons causing the true vector of combined stakeholder objective to be hidden this uncertainty adds on to uncertainties about future states of the world associated with climate change the exploratory modelling approach that we propose combines hierarchical clustering with scenario neutral analysis to mitigate both types of uncertainties and facilitate the discovery of robust pareto optimal river treaty configuration it relies on a series of important assumptions namely i an initial set of candidate objectives must be appropriately enumerated ii these objectives must be clustered in a way that does not lose too much information about pareto dominance iii the pareto optimal set of solutions must be accurately estimated iv pareto dominance must be an effective filter i e the ideal solution must indeed lie within the estimated pareto optimal set and v future states of the world must be properly enumerated these five assumptions are individually discussed in the following paragraphs 4 1 initial set of candidate objectives whether the approach designates a treaty as pareto optimal is ultimately dependant upon the initial set of objective variables that are fed into the clustering algorithm the 26 streamflow and salinity statistics chosen in our illustrative example were based on data availability and intuitive assumptions on the broad objectives of each party maximizing streamflow and minimizing salinity in particular we did not have access to calibrated models of salinity and siltation on the indian side both of which were stated as minimization objectives by india in their use of the ganges water salman and uprety 1999 including these variables into the initial set of objectives might have led to a different set of pob treaties more fundamentally by focusing on a specific set of state based statistics the approach does not engage with broader classes of objectives beyond statistics of flow and salinity e g economic equity risk mitigation and sectoral priorities that might be important to policy makers in real transboundary river systems these considerations have two important implications for the practical applicability of our approach first the approach relies on appropriate biophysical models that are able to accurately simulate all considered objective variables the development and calibration of these models may require effective data sharing and joint research effort between the countries party to the agreement second the approach should be integrated within a broader process of knowledge co production that acknowledges preexisting power dynamics and historical legacies amongst stakeholders in both the scientific and policy realms see wyborn et al 2019 this context should inform the formulation of the initial set of objective variables and the interpretation of the resulting pareto partition 4 2 clustering and information loss reducing the dimensionality of the objective set implies a tension between simplifying the optimization problem and losing important information this tradeoff is governed by the cutoff distance d which determines the minimum level of correlation between the objectives within the clusters and therefore the number of clusters and the extent of information loss while some information loss is inevitable it should minimally impact the composition of the ensuing pareto optimal set the numerical experiment described in supplementary text s3 assesses the relationship between the size of the objective set and the relative ordering of objective rankings we evaluated how sensitive the composition of the pareto optimal set is to the two arbitrary parameters of the clustering approach namely the choice of cutoff distance d and the choice of the central objective to consider for each cluster we found that the composition of the pareto optimal set was robust to both choices as long as the objective chosen to represent each cluster has a sufficient degree of centrality within the cluster 4 3 accuracy of approximated pareto optimal set errors on the pareto optimal set can emerge from an incomplete enumeration of treaty solutions as argued in section 2 2 the bounds on the five decision variables represent physical constraints related to diversion infrastructure or known historic legacies similarly the enumeration intervals represent the smallest increment in the decision variables that would be practical to implement based on these considerations we believe that the enumerated solutions are an accurate representation of the true set of solutions within the considered decision space however a more fundamental assumption concerns the decision space itself and its five decision variables which are based on the current treaty the structure of the current treaty is rooted in a long history of bilateral interactions between india and bangladesh over the ganges river which makes it likely to be carried over to the renewed treaty in 2026 for example the 10 day intervals with alternating flow guarantees date back to an initial agreement that was finalized days before the commission of the farakka barrage salman and uprety 1999 the initial agreement was signed on april 18 1975 and regulated withdrawals by india in portions of 10 days during the 41 remaining days of that single year s dry season however the 10 day intervals of the current treaty have been criticized as propitious to unilateral flow withdrawals thomas 2017 and as causing severe water scarcity during the intervals with non guaranteed flow rahman et al 2019 these considerations point to the potential for also examining treaty solutions that do not conform with the current treaty structure for example simulations by kilgour and dinar 2001 found that a flexible allocation based on flow forecasts might increase total welfare by up to 10 in dry years 4 4 overlap with true set of pareto optimal solutions our approach mitigates strategic framing uncertainty by identifying governing set of objectives based on known physical constraints of the systems rather than the hidden preferences of its stakeholders it follows that the ensuing set of objectives unlikely corresponds to the true vector of combined stakeholder objectives which remains hidden rather the dimensionality reduction approach can be seen as a way to simplify a poorly framed due to hidden objectives many objective optimization problem using information available to all stakeholders because of this and assuming all above assumptions hold we conjecture that the ensuing set of pareto optimal solutions contains the true set of pareto optimal solutions however without knowledge of the true set of stakeholder objectives this conjecture is challenging to test at the very least the hierarchical clustering approach that we propose particularly the dendrogram in fig 4 can be used as a tool to help stakeholders visualize the governing trade offs of the considered bio physical system 4 5 future states of the world and non stationary climate international river agreements are traditionally based on long term flow statistics computed from historic observation e g rahman et al 2019 the underlying assumption of a stationary flow regime is unlikely to hold in the context of climate change the scenario neutral approach that we propose is a first step towards addressing this issue by evaluating the sensitivity of treaty solutions to changes in key climate drivers without requiring detailed climate simulations however it does not address many of the issues associated with changing flow regimes in transboundary basins for example scenario neutral analyses make implicit assumptions about the range and independence of the climate drivers that can render the ensuing visualization misleading quinn et al 2020 changes in climate drivers can be correlated and systems might be particularly vulnerable to conditions outside the range of historical events borgomeo et al 2015 as quinn et al 2020 put it these assumptions could influence which factors are found to be most important and which policies are most robust belying their neutrality assuming uniformity and independence could have decision relevant implications more broadly using long term statistics in a non stationary context means that what is being optimized is a hypothetical value that does not exist i e a long term average that may change more rapidly than the underlying timeseries it is theoretically calculated on while adapted for situations where detailed climate predictions are unavailable the scenario neutral analysis can be seen as a temporary patch in the sense that it evaluates the climate sensitivity of a decision that is nonetheless made under the fundamental assumption of climate stationarity 5 conclusions transboundary water treaties face a variety of challenges due to changing climatic and environmental conditions raising the issue of how to appropriately update existing treaties for an uncertain future we develop an approach that addresses three key questions about transboundary treaty design i how to identify governing trade offs associated with the bio physical nature of the system ii how to visualize and determine the effects of the negotiated parameters of the treaty decision variables on its outcomes objectives and iii how to identify agreeable pareto optimal treaty solution in a way that accounts for a changing and uncertain climate the approach combines hierarchical clustering with a scenario neutral analysis to achieve address these questions applied to the ganges water agreement as an illustrative example the approach shows promise in its ability to discard sub optimal treaty alternatives however the example also shows that the output of the approach i e the set of identified pob treaties depends on the initial sets of treaty parameters and objective variables that are fed into the approach consequently the location specific numerical results that we present are not intended to serve as a basis to renew the treaty instead the approach rather than the illustrative results that we present can be applied to support decisions in the much richer informational environment available to actual decision makers our illustrative case study is intended to demonstrate the potential for this data driven approach to support rather than replace a broader negotiation process and serve as a shared information basis around which stakeholders can coalesce declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests marc f muller reports financial support was provided by national science foundation acknowledgement this research has been conducted under a collaborative project between bangladesh university of engineering and technology buet and the university of notre dame usa funding from the keough school of global affairs the notre dame environmental change initiative and notre dame research is acknowledged kryston penny bolster and müller acknowledge the support from the national science foundation under grant icer 1824951 bolster acknowledges support from the national science foundation under grant ear 2049688 streamflow and salinity data used in this study are available for purchase from the bangladesh water development board dr joseph guillaume and two anonymous reviewers are gratefully acknowledged for their constructive comments appendix a supplementary data supplementary data associated with this article can be found in the online version athttps doi org 10 1016 j jhydrol 2022 128004 supplementary data the following are the supplementary data to this article supplementary data 1 
