index,text
3855,in tracer experiments of surface flow constructed wetlands residence time distributions rtds are generally originated from the normalized concentration data of recovered tracers based on ideal instantaneous tracer release mode however this tracer release mode is commonly approximated by finite continuous tracer release over a relatively short duration as a result the accuracy of rtds and hydraulic indexes cannot be guaranteed if the rtd data and index values were still calculated based on the instantaneous release to solve this problem a method for correcting the original rtd data and the index values affected by tracer release duration was proposed the correction of hydraulic indexes can be performed using analytical formulas whereas the correction of the rtds requires an rtd model such as the gamma distribution and one dimensional advection dispersion model or a smoothing algorithm such as the simple moving average algorithm to avoid the increasing effect of random measurement errors caused by the direct use of the rtd correction formulas the correction method was successfully verified by a specially designed tracer test and its practical application effect was exemplified a monte carlo test also proved that the rtd correction owed certain robustness to tracer release instability while the correction of some hydraulic indexes that reflect flow dispersion and comprehensive hydraulic efficiency had inferior robustness aside from this the influence of tracer release duration on rtds and hydraulic indexes without any correction was analyzed it was found that the release duration caused the shape of the original rtds to be more skewed in the positive direction of the x axis and changed from thin and high to fat and short while the duration of the release caused the positive relative errors of most indexes which became more serious with an increase in the duration or worsening hydraulic performance based on these influence rules 0 01 was defined as the threshold of the normalized release duration which needs to correct rtds and hydraulic indexes considering that the relative errors between the uncorrected and corrected indexes were less than 5 when the normalized duration was less than this threshold keywords correction method tracer experiments residence time distribution hydraulic indexes instantaneous tracer release finite continuous tracer release 1 introduction the residence time distribution rtd is a probability density function of the solute concentration breakthrough curve btc obtained by tracer release experiments which has been widely used as an important tool to reflect and analyze the characteristics of solute transport in stream channels and surface flow constructed wetlands holland et al 2004 rueda et al 2006 payn et al 2008 bodin et al 2013 many hydrological phenomena that have long been a focus of research were discovered from the information extraction of rtds or btcs as the raw data of rtds such as the transient storage region commonly existing in streams smedt 2006 zaramella et al 2016 and the short circuiting and dead zones of wetland flow patterns thackston et al 1987 in the study of surface flow wetlands the theory and analysis method of rtds have been fully developed the shapes of rtds were observed to qualitatively evaluate the flow pattern of wetlands thackston et al 1987 hydraulic indexes were proposed to further realize the quantitative evaluation of hydraulic performances bodin et al 2012 most of which can be calculated from rtd data as the characteristic parameters of rtds based on rtds and hydraulic indexes an enormous amount of research has investigated the design and environmental factors affecting the hydraulic efficiency of wetlands such as wetland shape length to width ratio water depth flow rate vegetation and islands jenkins and greenway 2005 persson 2000 2005 holland et al 2004 su et al 2009 guo et al 2019 in addition to the significance of reflecting surface water hydrologic mechanisms rtds and hydraulic indexes were also served as the basis for the study of pollutant degradation and transformation in wetland research thus guiding the optimal design of wetlands to achieve their full potential of water pollution treatment the wetland flow with an rtd close to the dirac function representing the uniform velocity profile was considered as the ideal flow condition thackston et al 1987 the significant correlation of rtds and hydraulic indexes with the purification of surface flow constructed wetlands for pollutants was also pointed out kusin et al 2010 guo et al 2019 rtds and hydraulic indexes can even be used directly for the description and simulation of the pollutant removal process such as the convolution approach between the rtd and chemical transformation function wörman and kronnäs 2005 and also the tanks in series tis model which integrates the hydraulic indexes of e and n and the first order reaction kinetics kadlec and wallace 2009 given the importance of rtds and hydraulic indexes in the study of surface flow constructed wetlands it is crucial to ensure the accuracy of their values which has attracted much attention of researchers headley and kadlec 2007 indicated that the density of tracers would affect the reliability of rtds obtained by tracer tests and it should be within 1 of the density of the ambient water to avoid the density stratification bodin et al 2013 proposed that rtd truncations would interfere with the consistency and accuracy of rtds and hydraulic indexes and recommended that rtds should be truncated at the tracer background values brooks and wise 2005 quantified the moment uncertainties of rtds due to the random errors in tracer concentration measurements and found that the uncertainties were more sensitive to concentration error than they were to volume errors liu et al 2020 screened the hydraulic indexes which were not easily disturbed by rtd errors from the perspective of numerical consistency of hydraulic indexes although these studies have contributed to the guidance of tracer experiments and rtd data processing few of them involved the inaccuracy and correction of rtds and hydraulic indexes caused by the unreasonable behavior of tracer release experiments the tracer release experiment in surface flow wetlands is conducted by releasing inert tracers at the starting point usually the wetland inlet and monitoring btc data at the endpoint usually the wetland outlet there are two common methods of tracer release for obtaining rtds and hydraulic indexes instantaneous release and continuous release the former of which requires that tracers are monitored after the beginning of the instantaneous release until their concentrations were close to the background and the latter which requires that tracers are released at a steady rate until the outlet concentrations reach a constant value headley and kadlec 2007 other release methods such as the finite duration release where the tracers are monitored beyond the plateau phase until they reach the background level are usually used to study the parameters of transient water storage or other solute transport models wagner and harvey 1997 gooseff et al 2005 argerich et al 2008 but rarely applied to rtd acquisition of constructed wetlands although both instantaneous and continuous releases are effective in ascertaining the rtd data and hydraulic indexes of wetlands the instantaneous release method was more commonly used given that it has two advantages the primary advantage is less tracer consumption of the instantaneous release compared to the continuous release method headley and kadlec 2007 since the instantaneous release only needs to label a single parcel of water in wetlands rather than labeling all parcels of water as the continuous release required for example gooseff et al 2008 and payn et al 2008 used 20 g in the coarse bedded reach and 40 g in the fine bedded reach of tracers for the slug release while as much as about 250 g 23 mg s of release rate about 3 h of duration and 450 g 31 mg s of release rate about 4 h of duration of tracers were needed for the continuous release respectively the second advantage is that the acquisition of rtds is more convenient under instantaneous release that is rtds are directly originated from the normalized btc data see section 2 1 whereas rtds under the continuous release need to be obtained by numerical differentiation of the normalized btc data which amplifies measurement errors of btc data despite the significant advantages the ideal instantaneous release is difficult to realize in real world situations it was reported that tracers need to be fully diluted into a considerable volume of solution to ensure a similar density between the tracer solution and wetland water otherwise the density stratification will be severe leading to significant distortion of rtds schmid et al 2004 it is difficult to release such a volume of tracer solution in an instantaneous way besides the instantaneous release of tracers entails a large release rate the impact of high speed tracer release on water flow may interfere with the analysis of normal hydraulic performance of wetlands and streams as a result the so called instantaneous tracer release in the actual tracer experiments is commonly approximated by finite continuous tracer release over a relatively short duration which is in contradiction with the ideal instantaneous release required by the rtd acquisition approach if the rtd acquisition approach based on tracer instantaneous release is still adopted under the release within a certain duration there is a high probability to cause errors of rtds and hydraulic indexes this inference was supported by the experiments conducted by payn et al 2008 and gooseff et al 2008 indicating that the tracer release duration significantly affected the shape of btc which would certainly interfere with the accurate acquisition of rtds and the indexes the errors caused by tracer release duration should be corrected which however is rarely recognized by wetland research most studies have only casually equated the short duration release with ideal instantaneous release no clear standard has been given for how short the release duration should be which was only determined by personal subjective judgment the research conducted by teixeira and siqueira 2008 selected a very short period for tracer release typically within 2 s or 1 60 of the nominal residence time t n and regarded it as an instantaneous release dierberg et al 2005 delivered the tracer solution in 35 min t n was around 4 6 days despite the assumption of the slug tracer injection pugliese et al 2020 pumped the tracer solution into the wetland in a period of as long as 1 39 h t n was 0 87 10 40 days at different monitoring points while rtds and the indexes were still obtained based on an instantaneous tracer release method although payn et al 2008 succeed in deriving the rtd data from the constant rate stream tracer experiments which seemed to be useful for correcting the rtds under short duration release of tracers their research focused on streams without any correction of hydraulic indexes and other characteristic parameters of rtds in this study a method for correcting the original rtds and several common hydraulic indexes e σ φ 2 n λ e λ p φ 10 morril dispersion index mdi moment index mi affected by tracer release duration was proposed the correction of rtds requires the introduction of an rtd model or a smoothing algorithm while hydraulic indexes can be directly corrected by analytical formulas a tracer test was designed to verify the method s correctness the robustness of the method to tracer release instability was explored to further ensure its reliability in practical application aside from this the influence of tracer release duration on the accuracy of rtds and hydraulic indexes without correction was analyzed based on the influence rules the release duration which rtds and the indexes need to be corrected was clearly defined 2 theory 2 1 rtds and hydraulic indexes based on ideal instantaneous tracer release under ideal instantaneous tracer release the tracer concentrations monitored at the wetland outlet can be regarded as a response to the instantaneous release event fig 1 a at the inlet the monitored concentrations can be normalized to the rtd data as follows 1 f t c t q t m where t is the time variable after tracer release f t is the rtd data c t is the monitored tracer concentration q t is the inlet and outlet flow rate of wetlands the inlet flow rate is equal to the outlet flow rate which is assumed to keep constant q t q since the constant flow is a normal operation state of surface flow constructed wetlands in tracer experiments keefe et al 2010 bodin et al 2012 guo et al 2017 m is the total mass of added tracers which can be derived from the tracer amount either injected at the inlet or recovered at the outlet as long as injected tracers can be recovered completely for comparison of different wetland rtds the time variable t can be normalized by the nominal residence time denoted as t n to the dimensionless variable of t denoted as φ φ and f φ can be expressed as 2 t n v q 3 φ t t n 4 f φ c φ v m where v is the volume of water in wetlands the hydraulic indexes considered in this study include e σ φ 2 n λ e λ p φ 10 mdi mi they can be calculated according to the derived rtd as shown in table 1 specifically e defined as the first order moment of the normalized rtd also as the normalized mean residence time is generally used to describe the effective volumetric efficiency thackston et al 1987 σ φ 2 as the second order moment of the normalized rtd also as the normalized variance characterizes the dispersion of water flows kadlec and wallace 2009 n denotes the number of tis model which is also applied to reflect the dispersion of flow patterns as σ φ 2 but is more frequently used kadlec and wallace 2009 bodin et al 2013 λ e is calculated by integrating e and n thus it can be regarded as reflecting comprehensive hydraulic efficiency which covers two aspects of hydraulic information the effective volume and dispersion persson et al 1999 λ p reflects the characteristics of preferential flow which is also regarded as an index of hydraulic efficiency persson et al 1999 deduced λ p through a series of approximate transformations from the expression of λ e however they are still treated as two different indicators guo et al 2017 liu et al 2020 φ 10 and mdi are metrics that typically reflect the short circuit and dispersion of wetland flows respectively morrill et al 1932 teixeira and siqueira 2008 mi was proposed by wahl et al 2010 to avoid the error of rtd truncation quantifying the departure from ideal plug flow the above formulas are almost the only approach to obtain the measured rtds and hydraulic indexes in tracer experiments if the approach is applied to the ideal instantaneous tracer release conditions without any measurement errors the obtained rtds and indexes can be regarded as true rtds and indexes which are objective attributes of wetland flows if the approach is applied to the actual finite continuous tracer release over a certain duration of t the obtained rtds and indexes may have errors which are distinguished from the true values by the subscript t in this study 2 2 correction of rtds affected by tracer release duration under the finite continuous tracer release within a duration of t if an rtd is still calculated based on the ideal instantaneous tracer release eq 1 the original rtd data denoted as f t t can be expressed as 13 f t t c t t q m where c t t is the response concentration of tracers as shown in fig 1b the finite continuous release process is significantly different from the instantaneous release process the former is assumed to be composed of an infinite amount denoted as n n of the latter processes starting at different time points denoted as the variable t x t x 0 t n can be calculated as 14 n t δ t x where δ t x is defined as the change of t x note that t x and t are two different time variables of which the former represents the start time of the divided instantaneous release process and the latter representing the time variable of the finite continuous release process under a divided instantaneous release at t x the outlet concentration denoted as c t x t and corresponding rtd denoted as f t x t have a relationship according to eq 1 as follows 15 f t x t f t c t x t q m in where m in is the mass of tracers released at t x or during t x t x δ t x δ t x 0 note that f t x t equates to the true rtd assuming no any measurement errors f t because it is derived from the instantaneous release process since the tracer solution is generally dissolved into a uniform concentration and released into the wetland inlet at a constant rate m in can be expressed as 16 m in c 0 q δ t x m n where c 0 is the concentration of tracer solution and q is the flow rate of tracer release during a certain period of time within the tracer duration represented by t t δ t δ t 0 the tracer mass recovered at the wetland outlet denoted as m out t t δ t can be expressed by c t t as eq 17 and by c t x t as eq 18 respectively as 17 m out t t δ t c t t q d t 18 m out t t δ t c t x 0 t q δ t c t x i δ t x t q δ t c t x n δ t x t q δ t i 0 n c t x n i δ t x t q δ t the relationship between c t t and c t x t can be obtained by combining eqs 17 and 18 19 c t t i 0 n c t x i δ t x t payn et al 2008 pointed out little difference between the solute transport characteristics of streams under instantaneous release and continuous release that is rtds and hydraulic performance of surface waters are the inherent property of fluid and are unaffected by the tracer s release method according to eq 15 the consistency of f t indicates that the response of c t x t to each instantaneous release of the continuous release event is exactly the same although the response start time t x is different therefore using t x 0 as the reference for each response event because this time point is the beginning of tracer release which should be the calculation origin of rtds and hydraulic indexes it is concluded that c t x i δ t x t can be regarded as a result of translating i δ t x in the positive direction of the t axis also the x axis as given by 20 c t x i δ t x t c t x 0 t i δ t x substituting eq 20 into eq 19 results in 21 c t t i 0 n c t x 0 t i δ t x the relationship between f t t and f t can be obtained by combining eqs 13 16 and 21 as 22 f t t i 0 n f t x 0 t i δ t x t δ t x i 0 n f t i δ t x t δ t x when δ t x 0 eq 22 can be rewritten in integral form as 23 f t t 0 t f t t x d t x t f t f t t t where f t is the cumulative distribution form of rtds f t 0 t f t d t the normalized form of eq 23 can be obtained according to eqs 2 4 24 f t φ 0 φ t f φ φ t x d φ t x φ t f φ f φ φ t φ t where φ t x and φ t are dimensionless representations of t x and t respectively satisfying φ t x t x t n and φ t t t n eq 24 indicates the relation between f t φ and f φ or f φ thus it can be used for correcting f t φ to the true rtd f φ however this formula is an implicit function of f t or f t concerning f t t which is too inconvenient to be used for correction thus the correction formulas can be obtained by rearranging eq 24 in the form of the explicit function scheme 25 f φ φ t f t φ 0 φ φ t φ t i 0 φ φ t f t φ i φ t φ φ t 26 f φ df φ d φ where φ φ t is the integral part of the quotient of t and t unfortunately abnormal significant fluctuations and many unreasonable negative values will likely appear in the corrected rtds if eqs 25 26 are applied directly this phenomenon is due to the significant increase of random measurement errors in the direct correction process as proved in appendix a therefore eqs 25 26 are not directly applicable due to noise in the btc data this problem can be solved by coupling an rtd model with the implicit correction formula eq 24 because f φ is enforced to conform to an rtd model without any measurement errors as shown in fig 2 the coupling strategy is an inverse modeling approach where f φ is derived by fitting the simulated f t φ according to eq 24 to the observations however the success of rtd correction largely depends on the rationality of the model chosen to describe f φ in this study two of the most popular rtd models i e the gamma distribution model and one dimensional advection dispersion 1 d ade model were chosen as examples for the rtd correction as for the gamma model its probability density curve is asymmetric and skewed which is quite similar to most rtds with the single peak observed in practice for the 1 d ade model it is suitable for inverse modeling using tracer tests because its analytical solution can be strictly deduced musner et al 2014 although the actual solute transport is often not one dimensional the two or three dimensional information can be regarded as being integrated into the model parameters keefe et al 2004 deng and jung 2009 musner et al 2014 both the rtd models are expressed as follows 27 f γ φ 1 b a γ a φ a 1 e x p φ b 28 f a d e φ θ p e 4 π φ 3 e x p θ φ 2 p e 4 θ φ where f γ φ and f a d e φ are rtds conforming to the gamma distribution and 1 d ade model respectively a and b the parameters of f γ φ θ and pe the parameters of f a d e φ eq 28 is the normalized form of analytical solution of 1 d ade provided by marion et al 2008 and musner et al 2014 where the parameter θ is defined as θ l u t n t m t n l the wetland length u the average flow velocity while pe the peclet number is converted from d the longitudinal dispersion coefficient according to the relation pe ul d note that θ needs to be distinguished from the hydraulic index e because θ is derived from the model calibration rather than from the rtd data for obtaining parameters of these two models the objective function was determined to be the mean square error rmse between the simulated and observed data of f t φ the optimization process was implemented using the fminunc solver the quasi newton algorithm applied of the optimization toolbox in matlab 2016a aside from introducing an rtd model applying a smoothing or filter algorithm also has great potential to obtain the reasonable data of f φ by filtering out the increased random errors in the direct use of eqs 25 26 due to its simplicity and effectiveness peters et al 2013 smith 2002 the simple moving average sma algorithm was selected in this study in sma a certain window denoted as w containing a fixed amount of data is determined the first element is obtained by taking the average of the initial fixed amount of data then the window moves backward to the end of data with the average calculation triggered by each movement it is futile to directly smooth f φ by sma because the data has been seriously corrupted by the error increase effect it can be known from appendix a that the error of f t φ propagates twice in the direct correction of rtds from f t φ to f φ and from f φ to f φ and thus the smoothing target is aimed at these two error propagations respectively as shown in fig 3 the first smoothing for f t φ is to reduce the data variability of f φ when applying eq 25 for calculating f φ however the unfiltered errors still exist in f φ and increase sharply when applying eq 26 and thus the second smoothing for f φ is also required the key of sma is to determine the appropriate value of w which reflects the smoothing degree peters et al 2013 smith 2002 since the random errors transferred from f t φ to f φ will not increase dramatically even the errors can decrease see appendix a the value of w when smoothing f t φ denoted as w 1 should be low to ensure the original value of f t φ by contrast the minor errors of f φ will cause an extreme variation of f φ see appendix a and thus the value of w when smoothing f φ denoted as w 2 should be much higher there is no need to smooth f φ anymore to avoid losing critical information 2 3 correction of hydraulic indexes affected by tracer release duration it is very meaningful to derive a simple formula based method for correction of hydraulic indexes without using the complete rtd data especially when only the uncorrected hydraulic indexes but not the rtd data are available hydraulic indexes affected by tracer release duration can be corrected by exploring the differences between index values with and without the error caused by finite continuous release in this study the differences are reflected by the relative errors of original index values to the true values which is also convenient for the subsequent analysis of the impact of tracer release duration on index accuracy as presented in section 4 4 the relative errors of the original e σ φ 2 n and λ e denoted as e t σ φ t 2 n t and λ e t i e re e t re σ φ t 2 r e n t and r e λ e t can be derived strictly according to their definitions eqs 5 8 and the implicit correction formula of rtds eq 24 the detailed derivation process is given in appendix b the results are as follows 29 re e t e t e e φ t 2 e 30 re σ φ t 2 σ φ t 2 σ φ 2 σ φ 2 n φ t 2 12 e 2 31 r e n t n t n n 3 n φ t 2 12 e φ t n φ t 2 12 e 2 32 r e λ e t λ e t λ e λ e n φ t 2 3 e 3 e n φ t 3 e n 1 φ t 6 e 2 n 1 note that the relative errors are expressed in terms of e and n as well as φ t because these two indicators are frequently used in wetland research unfortunately this study failed to deduce the exact relative errors of the original λ p φ 10 mdi and mi denoted as λ p t φ 10 t mdi t and mi t i e r e λ p t r e φ 10 t r e mdi t and r e mi t by the relational expression of eq 24 since calculation methods of these indexes were complex compared with the other indexes consequently these relative errors were obtained based on the construction of true rtds f φ and the original rtds f t φ as shown in fig 4 f φ was assumed to conform to the gamma distribution considering that the gamma distribution is often used to construct ideal rtd data due to its good description of rtd characteristics bodin et al 2013 moreover the gamma distribution is convenient to construct different ideal rtds because its parameters of a and b have a concise relationship with hydraulic indexes of e and n that is 33 a n 34 b e n where e and n were commonly in the ranges of e 0 5 1 and n 2 10 with their typical values of e 0 82 and n 4 1 thackston et al 1987 kadlec and wallace 2009 bodin et al 2012 however to cover the outliers of these indexes their ranges were set to e 0 1 1 and n 2 15 therefore a series of f φ were generated with the time step of δ φ 0 01 and the truncation time of φ 4 the data of f t φ under different φ t were generated by substituting f φ into eq 24 φ t was set to change continuously in the range of 0 1 with a step of 0 01 based on f φ and f t φ their hydraulic indexes could be calculated by eqs 9 12 and thus the corresponding relative errors were obtained note that the relative errors were presented in the form of relation curves between the relative errors and φ t as presented in section 4 4 without exact analytical formulas the approximate formulas of these relative errors were derived by relation curve fitting it can be observed from the later section 4 4 that r e λ p t r e φ 10 t r e mdi t and r e mi t are all near linear with φ t when φ t 0 2 the linear slopes vary with the values of e and n thus the slopes are fitted as functions of e and n with the fitting formulas of the slope derived the relative errors can be expressed analytically more detailed procedures are given in appendix b the correction formulas of hydraulic indexes were finally acquired by rearranging the error expressions of these indexes as presented in table 2 all the correction formulas were expressed in terms of the original index values as well as φ t which was convenient for the use of these formulas the original indexes were calculated starting from the beginning of tracer release which was consistent with the criterion of index calculation under the slug release method otherwise the deviation from the calculation origin would lead to calculation error of the indexes note that the correction formula eq 35 means that the true value of the mean residence time e is equal to the center of the breakthrough at the outlet e t minus the center of the injection concentration curve φ t 2 the formula eq 36 means that the true value of the variance σ φ 2 is the variance of the breakthrough at the outlet σ φ t 2 minus the variance of the injection concentration curve φ t 2 12 3 verification methods it is crucial to verify the relational expression between f t φ and f φ eq 24 because this expression is the basis for the correction method of rtds illustrated in figs 2 3 and the correction formulas of hydraulic indexes listed in table 2 the verification was carried out through a series of designed in situ tracer experiments two kinds of tracer experiments were designed one of which adopted a tracer release duration as φ t φ x while the other adopted the duration as φ t 2 φ x apart from this exception the test conditions of these tracer experiments were all consistent thus the true rtds generated by the two experiments were the same by substituting φ t φ x into eq 24 the equation becomes 43 φ x f φ x φ f φ f φ φ x where f φ x φ is the original rtd when φ t φ x suppose that the independent variable of eq 43 i e φ is equal to φ φ x then the equation becomes 44 φ x f φ x φ φ x f φ φ x f φ 2 φ x by substituting φ t 2 φ x in to eq 24 the equation becomes 45 2 φ x f 2 φ x φ f φ f φ 2 φ x where f 2 φ x φ is the original rtd when φ t 2 φ x the relation between f φ x φ and f 2 φ x φ can be obtained by combing eqs 43 45 46 f 2 φ x φ f φ x φ f φ x φ φ x 2 therefore as long as the observed data of f φ x φ and f 2 φ x φ satisfies the relational expression of eq 46 the correction formula eq 24 was considered to be verified aside from this this study also verified the applicability of different coupling strategies the gamma model 1d ade model and sma algorithm for rtd correction and the accuracy of directly correcting hydraulic indexes by correction formulas given in table 2 the former verification was realized by using the correction results of f φ to compute f t φ according to eq 24 and then comparing the simulated f t φ with the observation the latter was realized by comparing the index values arising from the formula based correction and the corrected rtds because there were two original rtds f φ x φ f 2 φ x φ monitored in each wetland the objective function of rtd model parameters a and b of the gamma model θ and pe of the 1d ade model was modified as the sum of two rmses rmses of the simulated f t φ relative to observation under φ t φ x and φ t 2 φ x while the average data of f φ corrected from f φ x φ and f 2 φ x φ when applying the sma algorithm were determined as the representative rtd in a wetland the designed tracer experiments with different tracer release durations were conducted in two surface flow constructed wetlands located in experimental irrigation and drainage sites both at wuhan university hubei province china 114 21 e 30 32 n the planting situations of the two wetlands were different the first denoted as wetland a was not planted with any plants while the other denoted as wetland b was planted with acorus calamus a common emergent plant in wetlands with an average height of about 90 cm and a spacing of about 40 cm both the wetlands were identical in shape and operating conditions their shapes were rectangular with lengths of 11 4 m and widths of 4 15 m their operating conditions were water depths of 20 cm with inflow and outflow rates kept at 1 0 l s the reason why two different wetlands were used for verification was to confirm the universality of the correction method finite continuous tracer release experiments with the release duration of φ t φ x 0 2 31 5 min and φ t 2 φ x 0 4 63 min were carried out in each wetland respectively the purpose of the long durations applied was to confirm the correctness of the correction formulas even under the long injection duration and to avoid the verification being disturbed by the measurement errors of the measured btc data the injected tracers were inert fluorescent dyes bright dyes 106053 fwt 25 containing 2 5 rhodamine wt the amount of tracer released for each experiment was 20 g 0 5 g of rhodamine wt before release tracers were fully diluted to 1600 ml corresponding to the case of φ t 0 2 or 3200 ml corresponding to the case of φ t 0 4 the release rate was limited to 50 ml s by using peristaltic pumps to reduce the impact of tracer release on the wetland water surface the pump outlet was placed as close as possible to the wetland inflow the outlet concentrations of tracers were automatically monitored by a ysi 600 oms multiparameter water quality sonde with the monitoring frequency of 1 min the truncation time of each tracer test was φ 4 2 63 h in the verification process the trapezoidal rule was adopted to calculate the integrals involved in the acquisition of rtds and hydraulic indexes haas 1996 all the calculations were completed using matlab 2016a 4 results and discussion 4 1 verification results the verification results of the correction formula eq 24 in wetland a and b are shown in fig 5 which are both reflected by the quality of the fit between f φ x φ f φ x φ φ x 2 and f 2 φ x φ according to eq 46 these two items are supposed to be equal under any value of φ it was observed from fig 5 that the values of f φ x φ f φ x φ φ x 2 fitted well with the values of f 2 φ x φ from the two wetlands considering the strong correlation between the y x and the regression lines y 1 0264x 0 0064 in wetland a and y 0 9953x 0 0012 in wetland b and the high values of the determination coefficient r2 r2 0 9799 in wetland a and r2 0 8987 in wetland b in the two wetlands despite the satisfactory verification results in the two wetlands it was found that the quality of the fit in wetland a was relatively better than that in wetland b r2 0 9799 in wetland a r2 0 8987 in wetland b this may be due to the difference in rtd stability between these two wetlands rtd stability was the premise of deducing eq 20 which was necessary to derive the correction formulas of eq 24 and eqs 25 26 because of the lack of plants in wetland a fewer factors affected the flow pattern of wetland a whereas the flow of wetland b with plants seemed more likely to be disturbed by uncertain factors such as plant foliage falling off and impeding the flow thus it was inferred that the correction effect in wetland a with a more stable rtd would be better than that in wetland b the verification results of whether the gamma distribution 1d ade model and sma algorithm are applicable to rtd correction are shown in fig 6 the calibrated parameters of the rtd models and sma algorithm are also provided in this figure it was seen that the simulated values of f t φ with different coupling strategies were all in excellent agreement with the observation considering a high level of r2 even higher than 0 9 in all cases r2 0 9232 0 9878 this proves that these coupling strategies were generally effective for rtd correction however there were still subtle differences between these correction results the corrected rtds when coupled with sma were more reliable than those with the two rtd models considering the highest r2 with sma r2 0 9301 0 9878 the correction reliability based on the gamma model r2 0 9811 0 9845 was higher than that based on 1d ade in wetland a 0 9339 0 9648 while the reliability of the two models seemed to be similar in wetland b r2 0 9232 0 9665 and 0 9265 0 9553 with the gamma and 1 d ade model respectively no matter which strategy was used to correct rtds the simulation effects in wetland b r2 0 9232 0 9710 were inferior to those in wetland a r2 0 9339 0 9878 this is due to the inferior stability of rtds in wetland b as indicated earlier the verification results of whether the formula based correction of hydraulic indexes is accurate enough are shown in table 3 it can be seen from the table that there is a low level of differences lower than 20 between most of the hydraulic indexes obtained from the formula based correction and the corrected rtds except for σ φ 2 and n with its relatively significant differences 29 03 69 97 the considerable differences of σ φ 2 and n should not mean the incorrectness of the corresponding correction formulas considering that these formulas were strictly derived from the theory it may be due to the inherent numerical instability of σ φ 2 and n which means that a small variation between the true and corrected rtds still caused great errors of these indexes arising from the corrected rtds the instability of n has been pointed out by bodin et al 2013 and guo et al 2017 although the instability of σ φ 2 was seldom mentioned our previous extensive tracer experiments unpublished discovered the poor consistency of σ φ 2 even the shapes of the two rtds were similar given the overall successful verifications of the rtd correction formula as the basis of the correction method the recommended rtd coupling strategies and the formula based correction for hydraulic indexes it was concluded that the correction method proposed in this study was reliable for correcting rtds and the indexes 4 2 application of the correction method the original rtds and hydraulic indexes of wetland a and b were corrected using and are exemplary of the correction method application as shown in fig 7 the rtd corrections with coupling rtd models and the sma algorithm all achieved reasonable results represented by the typical single peak rtd curves reasonable correction results could not be obtained by direct application of the correction formulas involving numerical differentiation of experimental data eqs 25 26 as shown in fig c 1 of appendix c this was due to the significant increase of random errors in rtd measurements in the direct correction process as proved in appendix a the corrected rtds were more inclined to the negative direction of the x axis than the original rtds the similarity between the corrected and original rtds when φ t 0 2 was higher than that when φ t 0 4 this is to be expected considering that the original rtds under finite continuous tracer release over a shorter duration should be closer to the correction results by comparing the corrected rtds of the two wetlands it was found that the peak value of wetland b occurred much later in time than wetland a which may be due to the interference of wetland plants in wetland b to tracer flow the research carried out by nepf 1999 kothyari et al 2009 and wang et al 2018 confirmed the drag effect of wetland plants on water movement although different coupling strategies were all verified to apply to the rtd correction their correction results were not completely consistent as shown in fig 7 specifically the corrected rtd conforming to the 1d ade model had a significantly higher rtd peak than that of the coupling with the gamma model in wetland a fig 7a according to the verification results the former rtd seems to be slightly less reliable than the latter fig 6a and 6c however it cannot be inferred that the applicability of 1d ade is generally worse than that of the gamma model in rtd correction just as in wetland b where both models achieved almost the same correction results fig 7b therefore both the rtd models should be incorporated into the coupling strategies in essence the possible correction difference between models is due to their different abilities to describe the true rtds a model introduced into the rtd correction must be ensured to be close enough to the rtd to be corrected it should be noted that the gamma and 1d ade models exemplified in this study are only suitable for deriving the single peak rtds for correction of multiple peak rtds that appeared in wetlands with a high coverage or banded distribution of vegetation bodin et al 2012 musner et al 2014 a model for simulating multiple peak rtds is required such as the modified 1 d ade model with weight musner et al 2014 the modified gauss model fogler 2006 bodin et al 2012 and systemic models which combine ideal reactors with varying complexity laurent et al 2015 besides for correction of rtds in the dead zone or hyporheic zone of streams haggerty et al 2002 and gooseff et al 2008 found that a power law rtd model yielded a good agreement to observations so the model should be recommended some complex models with partial differential equations such as the otis model that reflects the transient storage of streams runkel 1998 and the two dimensional contaminant transport model musner et al 2014 are also expected to correct the rtds with abundant hydraulic and transport characteristics it was also observed from fig 7 that the corrected rtds coupling with the sma algorithm exhibited more detailed variation characteristics as compared to the corrections based on rtd models this is because the sma based correction did not restrict the shape of rtds as the model based correction did and thus it retained much of the less significant information that rtd models could not capture it was also confirmed that the sma based correction seemed to be more reliable than the model based correction fig 6e and 6f from this the smoothing algorithm seemed to have more advantages over rtd models for correcting rtds however there is no specific method to determine the values of the parameters w 1 and w 2 of sma although it is known by the error propagation analysis in rtd correction that w 2 should be higher than w 1 in this study the satisfactory correction was achieved when the parameter values were determined manually as w 1 10 and w 2 32 under φ t 32 or 64 under φ t 0 4 but these values could not be guaranteed to be the best estimating the parameter values as being too large or too small would lead to faulty data either due to noise or to unnecessary losses of data accuracy peters et al 2013 smith 2002 besides coupling the corrected rtds with the sma algorithm can still have the unfiltered minor oscillations in the rtd tails which is not conducive to some studies that focused on the flushing behavior of tracers from stream storage zones haggerty et al 2002 gooseff et al 2008 these shortcomings limit the application of sma based rtd correction to a certain extent and thus the strategy of introducing an rtd model is still valuable other smoothing algorithms can also be included in alternatives to coupling strategies among them the geostatistical inversion technique proposed by cirpka et al 2007 was specially designed for rtd correction the rtd correction can be regarded as the deconvolution of eq 24 although this technique is much more complex than the sma algorithm and has limitations in characterizing long term rtds the corrected hydraulic indexes by the correction formulas eqs 38 42 have been given in table 3 from this it can be seen that there was a significant difference between the corrected and uncorrected indexes indicating the necessity of index correction according to the correction results the hydraulic performance of wetland b was better given its higher values of e n λ e λ p φ 10 mi and the lower values of σ φ 2 and mdi meaning there was higher effective volume and hydraulic efficiency and lower mixing of the wetland this should be attributed to the positive effect of wetland plants on hydraulic performance although the correction method of rtds and hydraulic indexes proposed in this study was only exemplified in surface flow wetlands it could be universally applicable in other surface water such as streams and channels considering that wetlands have representative features of surface water hydrology the correction of e and σ φ 2 as the characteristic parameters of the first and second moments of rtds was also of universal significance in the study of hydrology 4 3 robustness of the correction method to tracer release instability the correction method of rtds and hydraulic indexes is based on the premise of the constant rate tracer release that is q is kept constant in the verification experiments of this study the release rate of tracers was precisely controlled to constant flow by the peristaltic pump however in most tracer experiments the tracer is often artificially and even casually poured into wetlands resulting in tracer release instability in this case the errors will be produced when correcting rtds and their indexes which are as follows tracer release instability causes eq 16 to be invalid and it should be replaced by 47 m in t x c 0 q t x δ t x c 0 q 1 re q t x δ t x 1 re q t x m n where m in t x and q t x are the mass and flow rate of tracer release which varied with t x q is the assumed constant flow rate that could divide m into n parts r e q t x is the relative deviation of q t x from q combining eq 47 with eqs 13 15 and 21 the normalized result was 48 f t φ 0 φ t f φ φ t x 1 re q φ t x d φ t x φ t where f t φ is the uncorrected rtd under unstable tracer release it can be seen from this that the relational expression is different from eq 24 which is the key to derive the correction method of rtds and hydraulic indexes the change of this relational expression will eventually lead to errors of correction for rtds and hydraulic indexes consequently it is crucial to analyze the robustness of the correction method to the disturbance of tracer release instability because the analysis is difficult to be carried out by directly transforming and simplifying eq 48 it was achieved by a monte carlo test in which re q φ t x was assumed to be a normally distributed random variable with a zero mean and an assumed variance denoted as s q 2 i e re q φ t x n 0 s q 2 which could reasonably reflect the uncertainty and randomness of tracer release instability a series of re q φ t x data under different s q 2 within 0 0 5 the step was 0 01 were applied to f φ to reproduce f t φ based on the relational expression eq 48 to reproduce the representative data of f t φ f φ was defined as the typical rtd with e 0 82 and n 4 1 conforming to the gamma distribution while φ t was set to 0 2 which was generally the upper limit of tracer release duration the rtd and hydraulic indexes were corrected from f t φ and its indexes by the correction method proposed in this study w 1 and w 2 of sma were determined as 5 and 10 data points respectively and then compared with the true rtd and index values of f φ to reflect the correction robustness to tracer release instability the rtds were compared by calculating the ratio of rmse between the corrected rtd and f φ to the f φ mean denoted as the relative rmse reflecting a relative difference of each rtd data point the indexes were compared by calculating the relative errors of the corrected indexes to the true values the whole process described above was repeated 100 times and the averages of relative rmse of rtds and relative errors of indexes were computed which could be regarded as the solution of the monte carlo test as shown in fig 8 the relative rmses when the rtd correction was coupled with the gamma model and sma algorithm were reasonably low within 5 when 0 s q 2 19 and 0 23 respectively both values of s q 2 represented a medium level of uncertainty for the tracer release rate even with s q 2 as high as 0 5 these two relative rmses were also at an acceptable level within 15 10 38 and 15 00 there was an apparent high level of relative rmse when coupling with the 1d ade model as 11 24 31 98 with the lowest value even higher than 5 however this was largely due to the difference between the 1d ade model which was coupled with rtd correction and the gamma model which was applied to construct the true rtd considering the relatively high value of the basis relative rmse 11 24 when s q 2 0 if the apparent relative rmse was subtracted from the basis value the result as shown in fig 7 would be at the lowest level within 5 when s q 2 was 0 0 5 therefore it can be concluded that the rtd correction with all the coupling strategies recommended in this study has certain robustness to the disturbance of tracer release instability as shown in fig 9 the relative errors of the corrected λ p and mi were always lower than 5 when s q 2 was between 0 and 0 5 indicating that the correction of these two indexes had strong robustness against tracer release instability the robustness of corrections for e and φ 10 was also satisfactory considering their low errors within 5 when s q 2 was as significant as 0 27 and 0 38 both of which were less than 10 9 22 and 6 32 even when s q 2 was 0 5 as for the corrections of σ φ 2 n λ e and mdi the guarantee of their errors within 5 required a relatively strict condition of tracer release stability i e s q 2 0 06 0 12 especially the correction of n was extremely sensitive to unstable tracer release considering that its relative error was the highest with the highest value as considerable as 211 40 4 4 influence of φ t on original rtds and hydraulic indexes it is crucial to analyze the influence of φ t on original rtds and hydraulic indexes the analysis is not only helpful in understanding the characteristics of errors in rtds and their indexes which are caused by finite continuous tracer release but also the basis for deriving the correction formulas of λ p t φ 10 t mdi t and mi t when φ t 0 2 aside from this the threshold value of φ t which needs to correct rtds and hydraulic indexes were obtained based on the analysis the influence of φ t on original rtds was analyzed by substituting the rtd data without the error caused by finite continuous release into eq 24 to generate the original data of f t φ as φ t as it increased from 0 to 1 the corrected rtds coupled with the gamma model of wetland a and b were chosen as examples to clarify the influence rule as shown in fig 10 the original rtds tended to be more skewed to the positive direction of the x axis as φ t increased indicating a larger overall retention time of tracers than reality moreover the peak time of original rtds decreased with the increase of φ t resulting in their shapes changed from thin and high to fat and short this indicated a larger variance of the original rtds than the corrected values payn et al 2008 reported that the plateau region would appear in measured rtds under the long release duration which however was not obvious even when φ t was as high as 1 in these three rtds the influence rules summarized by the two rtds were also applicable to any other wetland rtds data not shown the influence of φ t on original hydraulic indexes was analyzed based on the relative errors caused by φ t re e t re σ φ t 2 r e n t r e λ e t were calculated by their analytical expressions as seen in eqs 29 32 while r e λ p t r e φ 10 t r e mdi t r e mi t without analytical expressions were obtained by the process illustrated in fig 4 the function curves of these errors in the typical rtd e 0 82 n 4 1 are presented in fig 11 besides the figure also gives the extreme error curves with overall maximum and minimum values when e and n were in the common ranges e 0 5 1 n 2 10 and also the change of the error curves with e and n which can cover the characteristics of the curves when taking any values of e and n as shown in this figure the existence of φ t in the range of 0 1 led to the positive relative errors of most indexes except for r e mdi t with its negative errors all the relative errors tended to be more serious with the increase of φ t in most cases except for r e n t and r e mdi t which would decrease once φ t exceeded a certain threshold typically when e or n was large such as e 1 and n 10 shown in fig 11c and g as for the change of the error curves the overall values of the relative errors became more serious as e or n decreased except for re e t and re σ φ t 2 of which the former error was proved to have no relation with n and the latter which increased with n this indicated that the worse the hydraulic performance of wetlands the lower the accuracy of indexes and rtds the index accuracy reflected the rtd accuracy affected by φ t if no correction was carried out given that the poor hydraulic performance was often reflected by the low value of e and n thackston et al 1987 kadlec and wallace 2009 bodin et al 2012 since φ t is rarely as high as 1 the range of φ t for analyzing the relative errors was reduced from 0 to 1 to 0 0 2 as shown in the enlarged region of φ t 0 0 2 in fig 11 it was observed that the relationship between all the errors and φ t was nearly linear when φ t 0 2 and the slope varied with the values of e and n this discovery is the basis from which the correction formulas of λ p φ 10 mdi and mi eqs 39 42 listed in table 2 were derived of which the detailed derivation procedures can be seen in appendix b among the relative errors when φ t 0 2 r e n t r e λ e t r e λ p t and r e φ 10 t could reach a high level when e 0 5 1 and n 2 10 reaching levels as high as 0 4026 0 5444 0 4400 and 0 6923 when e 0 5 and n 2 respectively while others were at a lower level of which the maximum value did not exceed 0 2 at any value of e 0 5 1 and n 2 10 this indicated that the accuracy of n λ e λ p and φ 10 was more easily influenced by φ t compared with that of e σ φ 2 mdi or mi based on the above influence rules of φ t on the accuracy of the index the threshold value of φ t when rtds and hydraulic indexes needed to be corrected was obtained the tolerable relative error of each index was set to 5 therefore it was necessary to find the minimum value of φ t corresponding to this tolerable error limit when e 0 5 1 and n 2 10 because it guaranteed that the relative errors of all the original indexes would always be less than the error limit occurring when φ t did not exceed this minimum value as shown in fig 11 the minimum value was found to be 0 01 in r e φ 10 t and r e mdi t when e 0 5 and n 2 the two relative errors were close to 0 when φ t 0 01 and larger than 5 when φ t 0 02 thus φ t 0 01 was adopted to ensure errors of less than 5 therefore 0 01 was the threshold of φ t for correction if φ t 0 01 all the original hydraulic indexes were closer to the corrected values with the relative errors of less than 5 the accuracy of the original rtds could also be guaranteed since the hydraulic indexes also reflected the overall characteristics of the rtd data in this case the assumption of instantaneous release is applicable to the calculation of rtds and hydraulic indexes however if φ t 0 01 there may be significant errors with the original indexes greater than 5 which were required to be corrected out of necessity such as the studies by teixeira and siqueira 2008 with φ t 1 60 and pugliese et al 2020 with φ t 0 07 at the monitoring point t1 although the threshold values of φ t was defined at the same value of 0 01 among different wetlands the actual threshold duration of t which needs to correct rtds and hydraulic indexes depends on t n considering that φ t t t n it can be inferred that the longer t n of wetlands the less likely the tracer release duration is to reach the threshold and the less necessary the correction is which often occurs in large wetlands with relatively low flow rates compared to wetland volumes for small scale wetlands in order to meet an appropriate discharge capacity their flow rates may be considerable relative to their volumes and attention should be paid to the necessity of the duration control or correction for rtds and hydraulic indexes 5 conclusion the ideal instantaneous release of tracers which was approximated by finite continuous tracer release over a relatively short duration in most tracer experiments of surface flow wetlands was difficult to realize this may cause errors with rtds and hydraulic indexes still obtained based on the ideal instantaneous release mode in this study a method for correcting the original rtd data and hydraulic indexes was proposed to offset the effect of tracer release duration the correction method was successfully verified by a specially designed tracer test further validating its methodology the correction formulas of rtds involving numerical differential of experimental data may lead to unreasonable results due to the significant increase of random errors in rtd measurements this problem could be solved by introducing an rtd model such as the gamma and 1d ade model however the introduced model should be ensured to be suitable for the rtds to be corrected the application of a smoothing algorithm such as the sma algorithm can provide a satisfactory estimation of the corrected rtds but involves the choice of appropriate parameter values such as the window width of sma as for hydraulic indexes they can be directly corrected by the corresponding correction formulas although the correction method of rtds and the indexes are derived based on the premise of constant rate tracer release the method seems to have certain robustness for monitoring release instability despite the correction of σ φ 2 n λ e and mdi with inferior robustness a monte carlo test showed that when correcting for typical rtd e 0 82 and n 4 1 and its indexes of e λ p φ 10 mi under φ t 0 2 the relative rmse of rtds and relative errors of these indexes were less than 5 under a considerable release instability within the variance of 0 19 to more than 0 5 while the guarantee of the errors within 5 for correcting σ φ 2 n λ e and mdi required a relatively strict condition of tracer release stability within the variance of 0 06 0 12 the influence of φ t on rtds and hydraulic indexes without correction were also analyzed as for rtds φ t caused the shape of the original rtds to be more skewed to the positive direction of the x axis and changed from thin and high to fat and short indicating a larger overall retention time and variance for original rtds than that of corrected rtds as for the indexes φ t led to positive relative errors of most indexes which would increase the longer the duration of release the errors generally became more serious as e or n decreased indicating that the accuracy of indexes without correction in wetlands with poor hydraulic performance was more easily disturbed based on the influence rules the threshold of φ t which is needed to correct rtds and indexes was defined as 0 01 considering that the relative errors between the uncorrected and corrected indexes were all less than 5 when φ t 0 01 credit authorship contribution statement wangzi zhou methodology investigation data curation writing original draft bin dong conceptualization supervision resources writing review editing project administration funding acquisition jinzhong yang conceptualization supervision writing review editing jinling wang investigation data curation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this work was financially supported by the national natural science foundation of china grant no 51779181 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127106 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3855,in tracer experiments of surface flow constructed wetlands residence time distributions rtds are generally originated from the normalized concentration data of recovered tracers based on ideal instantaneous tracer release mode however this tracer release mode is commonly approximated by finite continuous tracer release over a relatively short duration as a result the accuracy of rtds and hydraulic indexes cannot be guaranteed if the rtd data and index values were still calculated based on the instantaneous release to solve this problem a method for correcting the original rtd data and the index values affected by tracer release duration was proposed the correction of hydraulic indexes can be performed using analytical formulas whereas the correction of the rtds requires an rtd model such as the gamma distribution and one dimensional advection dispersion model or a smoothing algorithm such as the simple moving average algorithm to avoid the increasing effect of random measurement errors caused by the direct use of the rtd correction formulas the correction method was successfully verified by a specially designed tracer test and its practical application effect was exemplified a monte carlo test also proved that the rtd correction owed certain robustness to tracer release instability while the correction of some hydraulic indexes that reflect flow dispersion and comprehensive hydraulic efficiency had inferior robustness aside from this the influence of tracer release duration on rtds and hydraulic indexes without any correction was analyzed it was found that the release duration caused the shape of the original rtds to be more skewed in the positive direction of the x axis and changed from thin and high to fat and short while the duration of the release caused the positive relative errors of most indexes which became more serious with an increase in the duration or worsening hydraulic performance based on these influence rules 0 01 was defined as the threshold of the normalized release duration which needs to correct rtds and hydraulic indexes considering that the relative errors between the uncorrected and corrected indexes were less than 5 when the normalized duration was less than this threshold keywords correction method tracer experiments residence time distribution hydraulic indexes instantaneous tracer release finite continuous tracer release 1 introduction the residence time distribution rtd is a probability density function of the solute concentration breakthrough curve btc obtained by tracer release experiments which has been widely used as an important tool to reflect and analyze the characteristics of solute transport in stream channels and surface flow constructed wetlands holland et al 2004 rueda et al 2006 payn et al 2008 bodin et al 2013 many hydrological phenomena that have long been a focus of research were discovered from the information extraction of rtds or btcs as the raw data of rtds such as the transient storage region commonly existing in streams smedt 2006 zaramella et al 2016 and the short circuiting and dead zones of wetland flow patterns thackston et al 1987 in the study of surface flow wetlands the theory and analysis method of rtds have been fully developed the shapes of rtds were observed to qualitatively evaluate the flow pattern of wetlands thackston et al 1987 hydraulic indexes were proposed to further realize the quantitative evaluation of hydraulic performances bodin et al 2012 most of which can be calculated from rtd data as the characteristic parameters of rtds based on rtds and hydraulic indexes an enormous amount of research has investigated the design and environmental factors affecting the hydraulic efficiency of wetlands such as wetland shape length to width ratio water depth flow rate vegetation and islands jenkins and greenway 2005 persson 2000 2005 holland et al 2004 su et al 2009 guo et al 2019 in addition to the significance of reflecting surface water hydrologic mechanisms rtds and hydraulic indexes were also served as the basis for the study of pollutant degradation and transformation in wetland research thus guiding the optimal design of wetlands to achieve their full potential of water pollution treatment the wetland flow with an rtd close to the dirac function representing the uniform velocity profile was considered as the ideal flow condition thackston et al 1987 the significant correlation of rtds and hydraulic indexes with the purification of surface flow constructed wetlands for pollutants was also pointed out kusin et al 2010 guo et al 2019 rtds and hydraulic indexes can even be used directly for the description and simulation of the pollutant removal process such as the convolution approach between the rtd and chemical transformation function wörman and kronnäs 2005 and also the tanks in series tis model which integrates the hydraulic indexes of e and n and the first order reaction kinetics kadlec and wallace 2009 given the importance of rtds and hydraulic indexes in the study of surface flow constructed wetlands it is crucial to ensure the accuracy of their values which has attracted much attention of researchers headley and kadlec 2007 indicated that the density of tracers would affect the reliability of rtds obtained by tracer tests and it should be within 1 of the density of the ambient water to avoid the density stratification bodin et al 2013 proposed that rtd truncations would interfere with the consistency and accuracy of rtds and hydraulic indexes and recommended that rtds should be truncated at the tracer background values brooks and wise 2005 quantified the moment uncertainties of rtds due to the random errors in tracer concentration measurements and found that the uncertainties were more sensitive to concentration error than they were to volume errors liu et al 2020 screened the hydraulic indexes which were not easily disturbed by rtd errors from the perspective of numerical consistency of hydraulic indexes although these studies have contributed to the guidance of tracer experiments and rtd data processing few of them involved the inaccuracy and correction of rtds and hydraulic indexes caused by the unreasonable behavior of tracer release experiments the tracer release experiment in surface flow wetlands is conducted by releasing inert tracers at the starting point usually the wetland inlet and monitoring btc data at the endpoint usually the wetland outlet there are two common methods of tracer release for obtaining rtds and hydraulic indexes instantaneous release and continuous release the former of which requires that tracers are monitored after the beginning of the instantaneous release until their concentrations were close to the background and the latter which requires that tracers are released at a steady rate until the outlet concentrations reach a constant value headley and kadlec 2007 other release methods such as the finite duration release where the tracers are monitored beyond the plateau phase until they reach the background level are usually used to study the parameters of transient water storage or other solute transport models wagner and harvey 1997 gooseff et al 2005 argerich et al 2008 but rarely applied to rtd acquisition of constructed wetlands although both instantaneous and continuous releases are effective in ascertaining the rtd data and hydraulic indexes of wetlands the instantaneous release method was more commonly used given that it has two advantages the primary advantage is less tracer consumption of the instantaneous release compared to the continuous release method headley and kadlec 2007 since the instantaneous release only needs to label a single parcel of water in wetlands rather than labeling all parcels of water as the continuous release required for example gooseff et al 2008 and payn et al 2008 used 20 g in the coarse bedded reach and 40 g in the fine bedded reach of tracers for the slug release while as much as about 250 g 23 mg s of release rate about 3 h of duration and 450 g 31 mg s of release rate about 4 h of duration of tracers were needed for the continuous release respectively the second advantage is that the acquisition of rtds is more convenient under instantaneous release that is rtds are directly originated from the normalized btc data see section 2 1 whereas rtds under the continuous release need to be obtained by numerical differentiation of the normalized btc data which amplifies measurement errors of btc data despite the significant advantages the ideal instantaneous release is difficult to realize in real world situations it was reported that tracers need to be fully diluted into a considerable volume of solution to ensure a similar density between the tracer solution and wetland water otherwise the density stratification will be severe leading to significant distortion of rtds schmid et al 2004 it is difficult to release such a volume of tracer solution in an instantaneous way besides the instantaneous release of tracers entails a large release rate the impact of high speed tracer release on water flow may interfere with the analysis of normal hydraulic performance of wetlands and streams as a result the so called instantaneous tracer release in the actual tracer experiments is commonly approximated by finite continuous tracer release over a relatively short duration which is in contradiction with the ideal instantaneous release required by the rtd acquisition approach if the rtd acquisition approach based on tracer instantaneous release is still adopted under the release within a certain duration there is a high probability to cause errors of rtds and hydraulic indexes this inference was supported by the experiments conducted by payn et al 2008 and gooseff et al 2008 indicating that the tracer release duration significantly affected the shape of btc which would certainly interfere with the accurate acquisition of rtds and the indexes the errors caused by tracer release duration should be corrected which however is rarely recognized by wetland research most studies have only casually equated the short duration release with ideal instantaneous release no clear standard has been given for how short the release duration should be which was only determined by personal subjective judgment the research conducted by teixeira and siqueira 2008 selected a very short period for tracer release typically within 2 s or 1 60 of the nominal residence time t n and regarded it as an instantaneous release dierberg et al 2005 delivered the tracer solution in 35 min t n was around 4 6 days despite the assumption of the slug tracer injection pugliese et al 2020 pumped the tracer solution into the wetland in a period of as long as 1 39 h t n was 0 87 10 40 days at different monitoring points while rtds and the indexes were still obtained based on an instantaneous tracer release method although payn et al 2008 succeed in deriving the rtd data from the constant rate stream tracer experiments which seemed to be useful for correcting the rtds under short duration release of tracers their research focused on streams without any correction of hydraulic indexes and other characteristic parameters of rtds in this study a method for correcting the original rtds and several common hydraulic indexes e σ φ 2 n λ e λ p φ 10 morril dispersion index mdi moment index mi affected by tracer release duration was proposed the correction of rtds requires the introduction of an rtd model or a smoothing algorithm while hydraulic indexes can be directly corrected by analytical formulas a tracer test was designed to verify the method s correctness the robustness of the method to tracer release instability was explored to further ensure its reliability in practical application aside from this the influence of tracer release duration on the accuracy of rtds and hydraulic indexes without correction was analyzed based on the influence rules the release duration which rtds and the indexes need to be corrected was clearly defined 2 theory 2 1 rtds and hydraulic indexes based on ideal instantaneous tracer release under ideal instantaneous tracer release the tracer concentrations monitored at the wetland outlet can be regarded as a response to the instantaneous release event fig 1 a at the inlet the monitored concentrations can be normalized to the rtd data as follows 1 f t c t q t m where t is the time variable after tracer release f t is the rtd data c t is the monitored tracer concentration q t is the inlet and outlet flow rate of wetlands the inlet flow rate is equal to the outlet flow rate which is assumed to keep constant q t q since the constant flow is a normal operation state of surface flow constructed wetlands in tracer experiments keefe et al 2010 bodin et al 2012 guo et al 2017 m is the total mass of added tracers which can be derived from the tracer amount either injected at the inlet or recovered at the outlet as long as injected tracers can be recovered completely for comparison of different wetland rtds the time variable t can be normalized by the nominal residence time denoted as t n to the dimensionless variable of t denoted as φ φ and f φ can be expressed as 2 t n v q 3 φ t t n 4 f φ c φ v m where v is the volume of water in wetlands the hydraulic indexes considered in this study include e σ φ 2 n λ e λ p φ 10 mdi mi they can be calculated according to the derived rtd as shown in table 1 specifically e defined as the first order moment of the normalized rtd also as the normalized mean residence time is generally used to describe the effective volumetric efficiency thackston et al 1987 σ φ 2 as the second order moment of the normalized rtd also as the normalized variance characterizes the dispersion of water flows kadlec and wallace 2009 n denotes the number of tis model which is also applied to reflect the dispersion of flow patterns as σ φ 2 but is more frequently used kadlec and wallace 2009 bodin et al 2013 λ e is calculated by integrating e and n thus it can be regarded as reflecting comprehensive hydraulic efficiency which covers two aspects of hydraulic information the effective volume and dispersion persson et al 1999 λ p reflects the characteristics of preferential flow which is also regarded as an index of hydraulic efficiency persson et al 1999 deduced λ p through a series of approximate transformations from the expression of λ e however they are still treated as two different indicators guo et al 2017 liu et al 2020 φ 10 and mdi are metrics that typically reflect the short circuit and dispersion of wetland flows respectively morrill et al 1932 teixeira and siqueira 2008 mi was proposed by wahl et al 2010 to avoid the error of rtd truncation quantifying the departure from ideal plug flow the above formulas are almost the only approach to obtain the measured rtds and hydraulic indexes in tracer experiments if the approach is applied to the ideal instantaneous tracer release conditions without any measurement errors the obtained rtds and indexes can be regarded as true rtds and indexes which are objective attributes of wetland flows if the approach is applied to the actual finite continuous tracer release over a certain duration of t the obtained rtds and indexes may have errors which are distinguished from the true values by the subscript t in this study 2 2 correction of rtds affected by tracer release duration under the finite continuous tracer release within a duration of t if an rtd is still calculated based on the ideal instantaneous tracer release eq 1 the original rtd data denoted as f t t can be expressed as 13 f t t c t t q m where c t t is the response concentration of tracers as shown in fig 1b the finite continuous release process is significantly different from the instantaneous release process the former is assumed to be composed of an infinite amount denoted as n n of the latter processes starting at different time points denoted as the variable t x t x 0 t n can be calculated as 14 n t δ t x where δ t x is defined as the change of t x note that t x and t are two different time variables of which the former represents the start time of the divided instantaneous release process and the latter representing the time variable of the finite continuous release process under a divided instantaneous release at t x the outlet concentration denoted as c t x t and corresponding rtd denoted as f t x t have a relationship according to eq 1 as follows 15 f t x t f t c t x t q m in where m in is the mass of tracers released at t x or during t x t x δ t x δ t x 0 note that f t x t equates to the true rtd assuming no any measurement errors f t because it is derived from the instantaneous release process since the tracer solution is generally dissolved into a uniform concentration and released into the wetland inlet at a constant rate m in can be expressed as 16 m in c 0 q δ t x m n where c 0 is the concentration of tracer solution and q is the flow rate of tracer release during a certain period of time within the tracer duration represented by t t δ t δ t 0 the tracer mass recovered at the wetland outlet denoted as m out t t δ t can be expressed by c t t as eq 17 and by c t x t as eq 18 respectively as 17 m out t t δ t c t t q d t 18 m out t t δ t c t x 0 t q δ t c t x i δ t x t q δ t c t x n δ t x t q δ t i 0 n c t x n i δ t x t q δ t the relationship between c t t and c t x t can be obtained by combining eqs 17 and 18 19 c t t i 0 n c t x i δ t x t payn et al 2008 pointed out little difference between the solute transport characteristics of streams under instantaneous release and continuous release that is rtds and hydraulic performance of surface waters are the inherent property of fluid and are unaffected by the tracer s release method according to eq 15 the consistency of f t indicates that the response of c t x t to each instantaneous release of the continuous release event is exactly the same although the response start time t x is different therefore using t x 0 as the reference for each response event because this time point is the beginning of tracer release which should be the calculation origin of rtds and hydraulic indexes it is concluded that c t x i δ t x t can be regarded as a result of translating i δ t x in the positive direction of the t axis also the x axis as given by 20 c t x i δ t x t c t x 0 t i δ t x substituting eq 20 into eq 19 results in 21 c t t i 0 n c t x 0 t i δ t x the relationship between f t t and f t can be obtained by combining eqs 13 16 and 21 as 22 f t t i 0 n f t x 0 t i δ t x t δ t x i 0 n f t i δ t x t δ t x when δ t x 0 eq 22 can be rewritten in integral form as 23 f t t 0 t f t t x d t x t f t f t t t where f t is the cumulative distribution form of rtds f t 0 t f t d t the normalized form of eq 23 can be obtained according to eqs 2 4 24 f t φ 0 φ t f φ φ t x d φ t x φ t f φ f φ φ t φ t where φ t x and φ t are dimensionless representations of t x and t respectively satisfying φ t x t x t n and φ t t t n eq 24 indicates the relation between f t φ and f φ or f φ thus it can be used for correcting f t φ to the true rtd f φ however this formula is an implicit function of f t or f t concerning f t t which is too inconvenient to be used for correction thus the correction formulas can be obtained by rearranging eq 24 in the form of the explicit function scheme 25 f φ φ t f t φ 0 φ φ t φ t i 0 φ φ t f t φ i φ t φ φ t 26 f φ df φ d φ where φ φ t is the integral part of the quotient of t and t unfortunately abnormal significant fluctuations and many unreasonable negative values will likely appear in the corrected rtds if eqs 25 26 are applied directly this phenomenon is due to the significant increase of random measurement errors in the direct correction process as proved in appendix a therefore eqs 25 26 are not directly applicable due to noise in the btc data this problem can be solved by coupling an rtd model with the implicit correction formula eq 24 because f φ is enforced to conform to an rtd model without any measurement errors as shown in fig 2 the coupling strategy is an inverse modeling approach where f φ is derived by fitting the simulated f t φ according to eq 24 to the observations however the success of rtd correction largely depends on the rationality of the model chosen to describe f φ in this study two of the most popular rtd models i e the gamma distribution model and one dimensional advection dispersion 1 d ade model were chosen as examples for the rtd correction as for the gamma model its probability density curve is asymmetric and skewed which is quite similar to most rtds with the single peak observed in practice for the 1 d ade model it is suitable for inverse modeling using tracer tests because its analytical solution can be strictly deduced musner et al 2014 although the actual solute transport is often not one dimensional the two or three dimensional information can be regarded as being integrated into the model parameters keefe et al 2004 deng and jung 2009 musner et al 2014 both the rtd models are expressed as follows 27 f γ φ 1 b a γ a φ a 1 e x p φ b 28 f a d e φ θ p e 4 π φ 3 e x p θ φ 2 p e 4 θ φ where f γ φ and f a d e φ are rtds conforming to the gamma distribution and 1 d ade model respectively a and b the parameters of f γ φ θ and pe the parameters of f a d e φ eq 28 is the normalized form of analytical solution of 1 d ade provided by marion et al 2008 and musner et al 2014 where the parameter θ is defined as θ l u t n t m t n l the wetland length u the average flow velocity while pe the peclet number is converted from d the longitudinal dispersion coefficient according to the relation pe ul d note that θ needs to be distinguished from the hydraulic index e because θ is derived from the model calibration rather than from the rtd data for obtaining parameters of these two models the objective function was determined to be the mean square error rmse between the simulated and observed data of f t φ the optimization process was implemented using the fminunc solver the quasi newton algorithm applied of the optimization toolbox in matlab 2016a aside from introducing an rtd model applying a smoothing or filter algorithm also has great potential to obtain the reasonable data of f φ by filtering out the increased random errors in the direct use of eqs 25 26 due to its simplicity and effectiveness peters et al 2013 smith 2002 the simple moving average sma algorithm was selected in this study in sma a certain window denoted as w containing a fixed amount of data is determined the first element is obtained by taking the average of the initial fixed amount of data then the window moves backward to the end of data with the average calculation triggered by each movement it is futile to directly smooth f φ by sma because the data has been seriously corrupted by the error increase effect it can be known from appendix a that the error of f t φ propagates twice in the direct correction of rtds from f t φ to f φ and from f φ to f φ and thus the smoothing target is aimed at these two error propagations respectively as shown in fig 3 the first smoothing for f t φ is to reduce the data variability of f φ when applying eq 25 for calculating f φ however the unfiltered errors still exist in f φ and increase sharply when applying eq 26 and thus the second smoothing for f φ is also required the key of sma is to determine the appropriate value of w which reflects the smoothing degree peters et al 2013 smith 2002 since the random errors transferred from f t φ to f φ will not increase dramatically even the errors can decrease see appendix a the value of w when smoothing f t φ denoted as w 1 should be low to ensure the original value of f t φ by contrast the minor errors of f φ will cause an extreme variation of f φ see appendix a and thus the value of w when smoothing f φ denoted as w 2 should be much higher there is no need to smooth f φ anymore to avoid losing critical information 2 3 correction of hydraulic indexes affected by tracer release duration it is very meaningful to derive a simple formula based method for correction of hydraulic indexes without using the complete rtd data especially when only the uncorrected hydraulic indexes but not the rtd data are available hydraulic indexes affected by tracer release duration can be corrected by exploring the differences between index values with and without the error caused by finite continuous release in this study the differences are reflected by the relative errors of original index values to the true values which is also convenient for the subsequent analysis of the impact of tracer release duration on index accuracy as presented in section 4 4 the relative errors of the original e σ φ 2 n and λ e denoted as e t σ φ t 2 n t and λ e t i e re e t re σ φ t 2 r e n t and r e λ e t can be derived strictly according to their definitions eqs 5 8 and the implicit correction formula of rtds eq 24 the detailed derivation process is given in appendix b the results are as follows 29 re e t e t e e φ t 2 e 30 re σ φ t 2 σ φ t 2 σ φ 2 σ φ 2 n φ t 2 12 e 2 31 r e n t n t n n 3 n φ t 2 12 e φ t n φ t 2 12 e 2 32 r e λ e t λ e t λ e λ e n φ t 2 3 e 3 e n φ t 3 e n 1 φ t 6 e 2 n 1 note that the relative errors are expressed in terms of e and n as well as φ t because these two indicators are frequently used in wetland research unfortunately this study failed to deduce the exact relative errors of the original λ p φ 10 mdi and mi denoted as λ p t φ 10 t mdi t and mi t i e r e λ p t r e φ 10 t r e mdi t and r e mi t by the relational expression of eq 24 since calculation methods of these indexes were complex compared with the other indexes consequently these relative errors were obtained based on the construction of true rtds f φ and the original rtds f t φ as shown in fig 4 f φ was assumed to conform to the gamma distribution considering that the gamma distribution is often used to construct ideal rtd data due to its good description of rtd characteristics bodin et al 2013 moreover the gamma distribution is convenient to construct different ideal rtds because its parameters of a and b have a concise relationship with hydraulic indexes of e and n that is 33 a n 34 b e n where e and n were commonly in the ranges of e 0 5 1 and n 2 10 with their typical values of e 0 82 and n 4 1 thackston et al 1987 kadlec and wallace 2009 bodin et al 2012 however to cover the outliers of these indexes their ranges were set to e 0 1 1 and n 2 15 therefore a series of f φ were generated with the time step of δ φ 0 01 and the truncation time of φ 4 the data of f t φ under different φ t were generated by substituting f φ into eq 24 φ t was set to change continuously in the range of 0 1 with a step of 0 01 based on f φ and f t φ their hydraulic indexes could be calculated by eqs 9 12 and thus the corresponding relative errors were obtained note that the relative errors were presented in the form of relation curves between the relative errors and φ t as presented in section 4 4 without exact analytical formulas the approximate formulas of these relative errors were derived by relation curve fitting it can be observed from the later section 4 4 that r e λ p t r e φ 10 t r e mdi t and r e mi t are all near linear with φ t when φ t 0 2 the linear slopes vary with the values of e and n thus the slopes are fitted as functions of e and n with the fitting formulas of the slope derived the relative errors can be expressed analytically more detailed procedures are given in appendix b the correction formulas of hydraulic indexes were finally acquired by rearranging the error expressions of these indexes as presented in table 2 all the correction formulas were expressed in terms of the original index values as well as φ t which was convenient for the use of these formulas the original indexes were calculated starting from the beginning of tracer release which was consistent with the criterion of index calculation under the slug release method otherwise the deviation from the calculation origin would lead to calculation error of the indexes note that the correction formula eq 35 means that the true value of the mean residence time e is equal to the center of the breakthrough at the outlet e t minus the center of the injection concentration curve φ t 2 the formula eq 36 means that the true value of the variance σ φ 2 is the variance of the breakthrough at the outlet σ φ t 2 minus the variance of the injection concentration curve φ t 2 12 3 verification methods it is crucial to verify the relational expression between f t φ and f φ eq 24 because this expression is the basis for the correction method of rtds illustrated in figs 2 3 and the correction formulas of hydraulic indexes listed in table 2 the verification was carried out through a series of designed in situ tracer experiments two kinds of tracer experiments were designed one of which adopted a tracer release duration as φ t φ x while the other adopted the duration as φ t 2 φ x apart from this exception the test conditions of these tracer experiments were all consistent thus the true rtds generated by the two experiments were the same by substituting φ t φ x into eq 24 the equation becomes 43 φ x f φ x φ f φ f φ φ x where f φ x φ is the original rtd when φ t φ x suppose that the independent variable of eq 43 i e φ is equal to φ φ x then the equation becomes 44 φ x f φ x φ φ x f φ φ x f φ 2 φ x by substituting φ t 2 φ x in to eq 24 the equation becomes 45 2 φ x f 2 φ x φ f φ f φ 2 φ x where f 2 φ x φ is the original rtd when φ t 2 φ x the relation between f φ x φ and f 2 φ x φ can be obtained by combing eqs 43 45 46 f 2 φ x φ f φ x φ f φ x φ φ x 2 therefore as long as the observed data of f φ x φ and f 2 φ x φ satisfies the relational expression of eq 46 the correction formula eq 24 was considered to be verified aside from this this study also verified the applicability of different coupling strategies the gamma model 1d ade model and sma algorithm for rtd correction and the accuracy of directly correcting hydraulic indexes by correction formulas given in table 2 the former verification was realized by using the correction results of f φ to compute f t φ according to eq 24 and then comparing the simulated f t φ with the observation the latter was realized by comparing the index values arising from the formula based correction and the corrected rtds because there were two original rtds f φ x φ f 2 φ x φ monitored in each wetland the objective function of rtd model parameters a and b of the gamma model θ and pe of the 1d ade model was modified as the sum of two rmses rmses of the simulated f t φ relative to observation under φ t φ x and φ t 2 φ x while the average data of f φ corrected from f φ x φ and f 2 φ x φ when applying the sma algorithm were determined as the representative rtd in a wetland the designed tracer experiments with different tracer release durations were conducted in two surface flow constructed wetlands located in experimental irrigation and drainage sites both at wuhan university hubei province china 114 21 e 30 32 n the planting situations of the two wetlands were different the first denoted as wetland a was not planted with any plants while the other denoted as wetland b was planted with acorus calamus a common emergent plant in wetlands with an average height of about 90 cm and a spacing of about 40 cm both the wetlands were identical in shape and operating conditions their shapes were rectangular with lengths of 11 4 m and widths of 4 15 m their operating conditions were water depths of 20 cm with inflow and outflow rates kept at 1 0 l s the reason why two different wetlands were used for verification was to confirm the universality of the correction method finite continuous tracer release experiments with the release duration of φ t φ x 0 2 31 5 min and φ t 2 φ x 0 4 63 min were carried out in each wetland respectively the purpose of the long durations applied was to confirm the correctness of the correction formulas even under the long injection duration and to avoid the verification being disturbed by the measurement errors of the measured btc data the injected tracers were inert fluorescent dyes bright dyes 106053 fwt 25 containing 2 5 rhodamine wt the amount of tracer released for each experiment was 20 g 0 5 g of rhodamine wt before release tracers were fully diluted to 1600 ml corresponding to the case of φ t 0 2 or 3200 ml corresponding to the case of φ t 0 4 the release rate was limited to 50 ml s by using peristaltic pumps to reduce the impact of tracer release on the wetland water surface the pump outlet was placed as close as possible to the wetland inflow the outlet concentrations of tracers were automatically monitored by a ysi 600 oms multiparameter water quality sonde with the monitoring frequency of 1 min the truncation time of each tracer test was φ 4 2 63 h in the verification process the trapezoidal rule was adopted to calculate the integrals involved in the acquisition of rtds and hydraulic indexes haas 1996 all the calculations were completed using matlab 2016a 4 results and discussion 4 1 verification results the verification results of the correction formula eq 24 in wetland a and b are shown in fig 5 which are both reflected by the quality of the fit between f φ x φ f φ x φ φ x 2 and f 2 φ x φ according to eq 46 these two items are supposed to be equal under any value of φ it was observed from fig 5 that the values of f φ x φ f φ x φ φ x 2 fitted well with the values of f 2 φ x φ from the two wetlands considering the strong correlation between the y x and the regression lines y 1 0264x 0 0064 in wetland a and y 0 9953x 0 0012 in wetland b and the high values of the determination coefficient r2 r2 0 9799 in wetland a and r2 0 8987 in wetland b in the two wetlands despite the satisfactory verification results in the two wetlands it was found that the quality of the fit in wetland a was relatively better than that in wetland b r2 0 9799 in wetland a r2 0 8987 in wetland b this may be due to the difference in rtd stability between these two wetlands rtd stability was the premise of deducing eq 20 which was necessary to derive the correction formulas of eq 24 and eqs 25 26 because of the lack of plants in wetland a fewer factors affected the flow pattern of wetland a whereas the flow of wetland b with plants seemed more likely to be disturbed by uncertain factors such as plant foliage falling off and impeding the flow thus it was inferred that the correction effect in wetland a with a more stable rtd would be better than that in wetland b the verification results of whether the gamma distribution 1d ade model and sma algorithm are applicable to rtd correction are shown in fig 6 the calibrated parameters of the rtd models and sma algorithm are also provided in this figure it was seen that the simulated values of f t φ with different coupling strategies were all in excellent agreement with the observation considering a high level of r2 even higher than 0 9 in all cases r2 0 9232 0 9878 this proves that these coupling strategies were generally effective for rtd correction however there were still subtle differences between these correction results the corrected rtds when coupled with sma were more reliable than those with the two rtd models considering the highest r2 with sma r2 0 9301 0 9878 the correction reliability based on the gamma model r2 0 9811 0 9845 was higher than that based on 1d ade in wetland a 0 9339 0 9648 while the reliability of the two models seemed to be similar in wetland b r2 0 9232 0 9665 and 0 9265 0 9553 with the gamma and 1 d ade model respectively no matter which strategy was used to correct rtds the simulation effects in wetland b r2 0 9232 0 9710 were inferior to those in wetland a r2 0 9339 0 9878 this is due to the inferior stability of rtds in wetland b as indicated earlier the verification results of whether the formula based correction of hydraulic indexes is accurate enough are shown in table 3 it can be seen from the table that there is a low level of differences lower than 20 between most of the hydraulic indexes obtained from the formula based correction and the corrected rtds except for σ φ 2 and n with its relatively significant differences 29 03 69 97 the considerable differences of σ φ 2 and n should not mean the incorrectness of the corresponding correction formulas considering that these formulas were strictly derived from the theory it may be due to the inherent numerical instability of σ φ 2 and n which means that a small variation between the true and corrected rtds still caused great errors of these indexes arising from the corrected rtds the instability of n has been pointed out by bodin et al 2013 and guo et al 2017 although the instability of σ φ 2 was seldom mentioned our previous extensive tracer experiments unpublished discovered the poor consistency of σ φ 2 even the shapes of the two rtds were similar given the overall successful verifications of the rtd correction formula as the basis of the correction method the recommended rtd coupling strategies and the formula based correction for hydraulic indexes it was concluded that the correction method proposed in this study was reliable for correcting rtds and the indexes 4 2 application of the correction method the original rtds and hydraulic indexes of wetland a and b were corrected using and are exemplary of the correction method application as shown in fig 7 the rtd corrections with coupling rtd models and the sma algorithm all achieved reasonable results represented by the typical single peak rtd curves reasonable correction results could not be obtained by direct application of the correction formulas involving numerical differentiation of experimental data eqs 25 26 as shown in fig c 1 of appendix c this was due to the significant increase of random errors in rtd measurements in the direct correction process as proved in appendix a the corrected rtds were more inclined to the negative direction of the x axis than the original rtds the similarity between the corrected and original rtds when φ t 0 2 was higher than that when φ t 0 4 this is to be expected considering that the original rtds under finite continuous tracer release over a shorter duration should be closer to the correction results by comparing the corrected rtds of the two wetlands it was found that the peak value of wetland b occurred much later in time than wetland a which may be due to the interference of wetland plants in wetland b to tracer flow the research carried out by nepf 1999 kothyari et al 2009 and wang et al 2018 confirmed the drag effect of wetland plants on water movement although different coupling strategies were all verified to apply to the rtd correction their correction results were not completely consistent as shown in fig 7 specifically the corrected rtd conforming to the 1d ade model had a significantly higher rtd peak than that of the coupling with the gamma model in wetland a fig 7a according to the verification results the former rtd seems to be slightly less reliable than the latter fig 6a and 6c however it cannot be inferred that the applicability of 1d ade is generally worse than that of the gamma model in rtd correction just as in wetland b where both models achieved almost the same correction results fig 7b therefore both the rtd models should be incorporated into the coupling strategies in essence the possible correction difference between models is due to their different abilities to describe the true rtds a model introduced into the rtd correction must be ensured to be close enough to the rtd to be corrected it should be noted that the gamma and 1d ade models exemplified in this study are only suitable for deriving the single peak rtds for correction of multiple peak rtds that appeared in wetlands with a high coverage or banded distribution of vegetation bodin et al 2012 musner et al 2014 a model for simulating multiple peak rtds is required such as the modified 1 d ade model with weight musner et al 2014 the modified gauss model fogler 2006 bodin et al 2012 and systemic models which combine ideal reactors with varying complexity laurent et al 2015 besides for correction of rtds in the dead zone or hyporheic zone of streams haggerty et al 2002 and gooseff et al 2008 found that a power law rtd model yielded a good agreement to observations so the model should be recommended some complex models with partial differential equations such as the otis model that reflects the transient storage of streams runkel 1998 and the two dimensional contaminant transport model musner et al 2014 are also expected to correct the rtds with abundant hydraulic and transport characteristics it was also observed from fig 7 that the corrected rtds coupling with the sma algorithm exhibited more detailed variation characteristics as compared to the corrections based on rtd models this is because the sma based correction did not restrict the shape of rtds as the model based correction did and thus it retained much of the less significant information that rtd models could not capture it was also confirmed that the sma based correction seemed to be more reliable than the model based correction fig 6e and 6f from this the smoothing algorithm seemed to have more advantages over rtd models for correcting rtds however there is no specific method to determine the values of the parameters w 1 and w 2 of sma although it is known by the error propagation analysis in rtd correction that w 2 should be higher than w 1 in this study the satisfactory correction was achieved when the parameter values were determined manually as w 1 10 and w 2 32 under φ t 32 or 64 under φ t 0 4 but these values could not be guaranteed to be the best estimating the parameter values as being too large or too small would lead to faulty data either due to noise or to unnecessary losses of data accuracy peters et al 2013 smith 2002 besides coupling the corrected rtds with the sma algorithm can still have the unfiltered minor oscillations in the rtd tails which is not conducive to some studies that focused on the flushing behavior of tracers from stream storage zones haggerty et al 2002 gooseff et al 2008 these shortcomings limit the application of sma based rtd correction to a certain extent and thus the strategy of introducing an rtd model is still valuable other smoothing algorithms can also be included in alternatives to coupling strategies among them the geostatistical inversion technique proposed by cirpka et al 2007 was specially designed for rtd correction the rtd correction can be regarded as the deconvolution of eq 24 although this technique is much more complex than the sma algorithm and has limitations in characterizing long term rtds the corrected hydraulic indexes by the correction formulas eqs 38 42 have been given in table 3 from this it can be seen that there was a significant difference between the corrected and uncorrected indexes indicating the necessity of index correction according to the correction results the hydraulic performance of wetland b was better given its higher values of e n λ e λ p φ 10 mi and the lower values of σ φ 2 and mdi meaning there was higher effective volume and hydraulic efficiency and lower mixing of the wetland this should be attributed to the positive effect of wetland plants on hydraulic performance although the correction method of rtds and hydraulic indexes proposed in this study was only exemplified in surface flow wetlands it could be universally applicable in other surface water such as streams and channels considering that wetlands have representative features of surface water hydrology the correction of e and σ φ 2 as the characteristic parameters of the first and second moments of rtds was also of universal significance in the study of hydrology 4 3 robustness of the correction method to tracer release instability the correction method of rtds and hydraulic indexes is based on the premise of the constant rate tracer release that is q is kept constant in the verification experiments of this study the release rate of tracers was precisely controlled to constant flow by the peristaltic pump however in most tracer experiments the tracer is often artificially and even casually poured into wetlands resulting in tracer release instability in this case the errors will be produced when correcting rtds and their indexes which are as follows tracer release instability causes eq 16 to be invalid and it should be replaced by 47 m in t x c 0 q t x δ t x c 0 q 1 re q t x δ t x 1 re q t x m n where m in t x and q t x are the mass and flow rate of tracer release which varied with t x q is the assumed constant flow rate that could divide m into n parts r e q t x is the relative deviation of q t x from q combining eq 47 with eqs 13 15 and 21 the normalized result was 48 f t φ 0 φ t f φ φ t x 1 re q φ t x d φ t x φ t where f t φ is the uncorrected rtd under unstable tracer release it can be seen from this that the relational expression is different from eq 24 which is the key to derive the correction method of rtds and hydraulic indexes the change of this relational expression will eventually lead to errors of correction for rtds and hydraulic indexes consequently it is crucial to analyze the robustness of the correction method to the disturbance of tracer release instability because the analysis is difficult to be carried out by directly transforming and simplifying eq 48 it was achieved by a monte carlo test in which re q φ t x was assumed to be a normally distributed random variable with a zero mean and an assumed variance denoted as s q 2 i e re q φ t x n 0 s q 2 which could reasonably reflect the uncertainty and randomness of tracer release instability a series of re q φ t x data under different s q 2 within 0 0 5 the step was 0 01 were applied to f φ to reproduce f t φ based on the relational expression eq 48 to reproduce the representative data of f t φ f φ was defined as the typical rtd with e 0 82 and n 4 1 conforming to the gamma distribution while φ t was set to 0 2 which was generally the upper limit of tracer release duration the rtd and hydraulic indexes were corrected from f t φ and its indexes by the correction method proposed in this study w 1 and w 2 of sma were determined as 5 and 10 data points respectively and then compared with the true rtd and index values of f φ to reflect the correction robustness to tracer release instability the rtds were compared by calculating the ratio of rmse between the corrected rtd and f φ to the f φ mean denoted as the relative rmse reflecting a relative difference of each rtd data point the indexes were compared by calculating the relative errors of the corrected indexes to the true values the whole process described above was repeated 100 times and the averages of relative rmse of rtds and relative errors of indexes were computed which could be regarded as the solution of the monte carlo test as shown in fig 8 the relative rmses when the rtd correction was coupled with the gamma model and sma algorithm were reasonably low within 5 when 0 s q 2 19 and 0 23 respectively both values of s q 2 represented a medium level of uncertainty for the tracer release rate even with s q 2 as high as 0 5 these two relative rmses were also at an acceptable level within 15 10 38 and 15 00 there was an apparent high level of relative rmse when coupling with the 1d ade model as 11 24 31 98 with the lowest value even higher than 5 however this was largely due to the difference between the 1d ade model which was coupled with rtd correction and the gamma model which was applied to construct the true rtd considering the relatively high value of the basis relative rmse 11 24 when s q 2 0 if the apparent relative rmse was subtracted from the basis value the result as shown in fig 7 would be at the lowest level within 5 when s q 2 was 0 0 5 therefore it can be concluded that the rtd correction with all the coupling strategies recommended in this study has certain robustness to the disturbance of tracer release instability as shown in fig 9 the relative errors of the corrected λ p and mi were always lower than 5 when s q 2 was between 0 and 0 5 indicating that the correction of these two indexes had strong robustness against tracer release instability the robustness of corrections for e and φ 10 was also satisfactory considering their low errors within 5 when s q 2 was as significant as 0 27 and 0 38 both of which were less than 10 9 22 and 6 32 even when s q 2 was 0 5 as for the corrections of σ φ 2 n λ e and mdi the guarantee of their errors within 5 required a relatively strict condition of tracer release stability i e s q 2 0 06 0 12 especially the correction of n was extremely sensitive to unstable tracer release considering that its relative error was the highest with the highest value as considerable as 211 40 4 4 influence of φ t on original rtds and hydraulic indexes it is crucial to analyze the influence of φ t on original rtds and hydraulic indexes the analysis is not only helpful in understanding the characteristics of errors in rtds and their indexes which are caused by finite continuous tracer release but also the basis for deriving the correction formulas of λ p t φ 10 t mdi t and mi t when φ t 0 2 aside from this the threshold value of φ t which needs to correct rtds and hydraulic indexes were obtained based on the analysis the influence of φ t on original rtds was analyzed by substituting the rtd data without the error caused by finite continuous release into eq 24 to generate the original data of f t φ as φ t as it increased from 0 to 1 the corrected rtds coupled with the gamma model of wetland a and b were chosen as examples to clarify the influence rule as shown in fig 10 the original rtds tended to be more skewed to the positive direction of the x axis as φ t increased indicating a larger overall retention time of tracers than reality moreover the peak time of original rtds decreased with the increase of φ t resulting in their shapes changed from thin and high to fat and short this indicated a larger variance of the original rtds than the corrected values payn et al 2008 reported that the plateau region would appear in measured rtds under the long release duration which however was not obvious even when φ t was as high as 1 in these three rtds the influence rules summarized by the two rtds were also applicable to any other wetland rtds data not shown the influence of φ t on original hydraulic indexes was analyzed based on the relative errors caused by φ t re e t re σ φ t 2 r e n t r e λ e t were calculated by their analytical expressions as seen in eqs 29 32 while r e λ p t r e φ 10 t r e mdi t r e mi t without analytical expressions were obtained by the process illustrated in fig 4 the function curves of these errors in the typical rtd e 0 82 n 4 1 are presented in fig 11 besides the figure also gives the extreme error curves with overall maximum and minimum values when e and n were in the common ranges e 0 5 1 n 2 10 and also the change of the error curves with e and n which can cover the characteristics of the curves when taking any values of e and n as shown in this figure the existence of φ t in the range of 0 1 led to the positive relative errors of most indexes except for r e mdi t with its negative errors all the relative errors tended to be more serious with the increase of φ t in most cases except for r e n t and r e mdi t which would decrease once φ t exceeded a certain threshold typically when e or n was large such as e 1 and n 10 shown in fig 11c and g as for the change of the error curves the overall values of the relative errors became more serious as e or n decreased except for re e t and re σ φ t 2 of which the former error was proved to have no relation with n and the latter which increased with n this indicated that the worse the hydraulic performance of wetlands the lower the accuracy of indexes and rtds the index accuracy reflected the rtd accuracy affected by φ t if no correction was carried out given that the poor hydraulic performance was often reflected by the low value of e and n thackston et al 1987 kadlec and wallace 2009 bodin et al 2012 since φ t is rarely as high as 1 the range of φ t for analyzing the relative errors was reduced from 0 to 1 to 0 0 2 as shown in the enlarged region of φ t 0 0 2 in fig 11 it was observed that the relationship between all the errors and φ t was nearly linear when φ t 0 2 and the slope varied with the values of e and n this discovery is the basis from which the correction formulas of λ p φ 10 mdi and mi eqs 39 42 listed in table 2 were derived of which the detailed derivation procedures can be seen in appendix b among the relative errors when φ t 0 2 r e n t r e λ e t r e λ p t and r e φ 10 t could reach a high level when e 0 5 1 and n 2 10 reaching levels as high as 0 4026 0 5444 0 4400 and 0 6923 when e 0 5 and n 2 respectively while others were at a lower level of which the maximum value did not exceed 0 2 at any value of e 0 5 1 and n 2 10 this indicated that the accuracy of n λ e λ p and φ 10 was more easily influenced by φ t compared with that of e σ φ 2 mdi or mi based on the above influence rules of φ t on the accuracy of the index the threshold value of φ t when rtds and hydraulic indexes needed to be corrected was obtained the tolerable relative error of each index was set to 5 therefore it was necessary to find the minimum value of φ t corresponding to this tolerable error limit when e 0 5 1 and n 2 10 because it guaranteed that the relative errors of all the original indexes would always be less than the error limit occurring when φ t did not exceed this minimum value as shown in fig 11 the minimum value was found to be 0 01 in r e φ 10 t and r e mdi t when e 0 5 and n 2 the two relative errors were close to 0 when φ t 0 01 and larger than 5 when φ t 0 02 thus φ t 0 01 was adopted to ensure errors of less than 5 therefore 0 01 was the threshold of φ t for correction if φ t 0 01 all the original hydraulic indexes were closer to the corrected values with the relative errors of less than 5 the accuracy of the original rtds could also be guaranteed since the hydraulic indexes also reflected the overall characteristics of the rtd data in this case the assumption of instantaneous release is applicable to the calculation of rtds and hydraulic indexes however if φ t 0 01 there may be significant errors with the original indexes greater than 5 which were required to be corrected out of necessity such as the studies by teixeira and siqueira 2008 with φ t 1 60 and pugliese et al 2020 with φ t 0 07 at the monitoring point t1 although the threshold values of φ t was defined at the same value of 0 01 among different wetlands the actual threshold duration of t which needs to correct rtds and hydraulic indexes depends on t n considering that φ t t t n it can be inferred that the longer t n of wetlands the less likely the tracer release duration is to reach the threshold and the less necessary the correction is which often occurs in large wetlands with relatively low flow rates compared to wetland volumes for small scale wetlands in order to meet an appropriate discharge capacity their flow rates may be considerable relative to their volumes and attention should be paid to the necessity of the duration control or correction for rtds and hydraulic indexes 5 conclusion the ideal instantaneous release of tracers which was approximated by finite continuous tracer release over a relatively short duration in most tracer experiments of surface flow wetlands was difficult to realize this may cause errors with rtds and hydraulic indexes still obtained based on the ideal instantaneous release mode in this study a method for correcting the original rtd data and hydraulic indexes was proposed to offset the effect of tracer release duration the correction method was successfully verified by a specially designed tracer test further validating its methodology the correction formulas of rtds involving numerical differential of experimental data may lead to unreasonable results due to the significant increase of random errors in rtd measurements this problem could be solved by introducing an rtd model such as the gamma and 1d ade model however the introduced model should be ensured to be suitable for the rtds to be corrected the application of a smoothing algorithm such as the sma algorithm can provide a satisfactory estimation of the corrected rtds but involves the choice of appropriate parameter values such as the window width of sma as for hydraulic indexes they can be directly corrected by the corresponding correction formulas although the correction method of rtds and the indexes are derived based on the premise of constant rate tracer release the method seems to have certain robustness for monitoring release instability despite the correction of σ φ 2 n λ e and mdi with inferior robustness a monte carlo test showed that when correcting for typical rtd e 0 82 and n 4 1 and its indexes of e λ p φ 10 mi under φ t 0 2 the relative rmse of rtds and relative errors of these indexes were less than 5 under a considerable release instability within the variance of 0 19 to more than 0 5 while the guarantee of the errors within 5 for correcting σ φ 2 n λ e and mdi required a relatively strict condition of tracer release stability within the variance of 0 06 0 12 the influence of φ t on rtds and hydraulic indexes without correction were also analyzed as for rtds φ t caused the shape of the original rtds to be more skewed to the positive direction of the x axis and changed from thin and high to fat and short indicating a larger overall retention time and variance for original rtds than that of corrected rtds as for the indexes φ t led to positive relative errors of most indexes which would increase the longer the duration of release the errors generally became more serious as e or n decreased indicating that the accuracy of indexes without correction in wetlands with poor hydraulic performance was more easily disturbed based on the influence rules the threshold of φ t which is needed to correct rtds and indexes was defined as 0 01 considering that the relative errors between the uncorrected and corrected indexes were all less than 5 when φ t 0 01 credit authorship contribution statement wangzi zhou methodology investigation data curation writing original draft bin dong conceptualization supervision resources writing review editing project administration funding acquisition jinzhong yang conceptualization supervision writing review editing jinling wang investigation data curation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this work was financially supported by the national natural science foundation of china grant no 51779181 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127106 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3856,this paper presents a methodology for the identification of the time tipping point where historical operating rules of a reservoir system should be replaced by new alternatives due to climate change the time tipping point is a time indicator of the failure probability change point of the historical operating rules for the reservoir system under future climate change called the failure warning time for this study the primary purpose of the reservoir system is hydropower generation we first estimate the probability density function of the annual benefit of hydropower generation then based on the estimated probability density function and the given risk tolerance level of the reservoir system we determine the risk based warning threshold and further identify the failure warning time of the historical operating rules via the probability change point analysis technique we apply the proposed methodology to the xiluodu xiangjiaba three gorges cascade reservoir system on the yangtze river in china the results indicate that the failure warning time for the cascade reservoir system will occur in at least another 10 years in the future under climate change we also find that the failure response in the cascade reservoir system is determined by both the reservoir that has the first failure occurrence and its storage capacity the developed methodology can be used to determine the time tipping point to launch adaptation strategies for the river basin management and further can help policymakers cope with climate change keywords climate change reservoir operation failure warning time risk based warning threshold cascade reservoir system 1 introduction joint operation of reservoirs can mitigate the adverse impacts of climate change loucks and van beek 2005 the need to develop reservoir adaptation operation strategies for mitigating the impacts of climate change has received much attention in recent years brown et al 2012 he et al 2020 mandal et al 2019 nourani et al 2020 ray and brown 2015 zhang et al 2020 there are two main approaches of formulating an adaptation strategy on a regional and local scale the top down approach and the bottom up approach the top down approach follows the predict then act idea where climate projections based on general circulation models gcms are downscaled to match the spatial and temporal scales of hydrological models and then reservoir operation models used for formulation of adaptation strategies are driven by hydrological projections related to climate change many studies employ this approach to deal with the adverse effects of specific climate change conditions on river basin management georgakakos et al 2012 giuliani et al 2016 haguma et al 2014 herman and giuliani 2018 tullos et al 2020 zhang et al 2019 in constrast the bottom up approach adopts the decision scaling idea where system characteristics of risk and local capacities are taken into consideration before the robustness of potential adaptation alternatives is tested against climate projections brown et al 2012 both the top down approach and the bottom up approach can answer the question of how to implement reservoir operation under climate change however these two approaches cannot identify the time tipping point at which the current reservoir management strategy fails and new alternatives are needed till now most studies based on the top down approach have adopted subjective preferences to the time tipping point kwadijk et al 2010 this undermines the applicability of the top down approach in real world reservoir practices some researchers haasnoot et al 2015 kwadijk et al 2010 werners et al 2013 have attempted to locate the time tipping point based on the bottom up principles they advanced the concept of adaptation tipping point atp the atp is defined as the point where the changing magnitude of environmental variables such as temperature rainfall discharge and sea level due to climate change is such that the current management strategy will fail to meet the objectives it can determine whether and when adaptation strategies are needed from physical and ecological viewpoints these authors also revealed that failure of the current management strategy to meet the objectives is the main driver motivating adaptation actions rather than climate change itself kwadijk et al 2010 and haasnoot et al 2015 identified the atp for the rhine delta aimed at flood control and water supply according to the rhine delta study when water level alteration under the current management strategy exceeds the acceptable threshold of 0 2m over future decades the atp is reached and a new adaptation strategy is required the atp method is only suitable for reservoir systems evaluated on environmental variables e g flood control only relying on the reservoir water level this is because the environment dam constraints can directly illustrate the reasonability of the acceptable alteration threshold of the environmental variables however the atp method cannot be applied directly to the management of a reservoir system that is aimed at maximizing economic benefit such as hydropower generation this is because the acceptable alteration threshold of hydropower generation should be determined by both environmental variables and turbine generator capacity haasnoot et al 2015 also pointed out the need for further research on how to determine the atp for reservoirs aimed at maximizing economic benefit therefore in the view of the change point of failure probability we propose a methodology to identify the atp of the current management strategy for a reservoir system evaluated on economic benefits under climate change the current management strategy for a reservoir system is described as the parametric rules based on historical observed data giuliani et al 2014 yang et al 2017 zhang et al 2017 in this paper we call this historical operating rules hor of the reservoir system though it also is referred to as baseline operating rules in other publications giuliani et al 2016 herman and giuliani 2018 hor is widely employed in real operational contexts since it serves the objectives well under a range of past hydro meteorological variabilities salas et al 2012 in this study we refer to the identified atp as the failure warning time fwt of hor aimed at maximizing economic benefits we introduce the probability change point analysis technique krishnaiah and miao 1988 liu et al 2010 to determine the fwt of hor fwt can inform reservoir managers when adaptation operating rules are needed however unlike atp which is reached through exceedance of acceptable physical or ecological alteration change thresholds under the current management strategy haasnoot et al 2015 kwadijk et al 2010 werners et al 2013 fwt is a time indicator of the failure probability change point of hor the period prior to fwt indicates that hor is functional with low failure probability while the period after fwt implies that reservoir managers have to implement the adaptation alternatives otherwise they may face high risk of failure if hor continues the failure occurrence of hor is the situation where the actual annual benefit of the current management strategy is less than the risk based warning threshold rwt the rwt is determined by the probability density function and risk tolerance level if the main purpose of the reservoir system is for hydropower generation its annual benefit is highly affected by the magnitude and variability of intra annual streamflow yeh 1985 in order to avoid false identification for failure occurrences of hor the rwt related to hydropower generation should be classified based on the hydrological year category the identification of fwt is conducted in the context of climate change in this study the plausible scenarios to describe climate change are generated from gcm based climate projections the advantages of gcm based climate projections include 1 the consideration of hydro meteorological variables in temporal variability and spatial correlation 2 the ability to provide clear time corresponding to projection results and 3 the physical response of the earth s climate to environmental changes and social development in summary this paper contains three main contributions 1 we propose an approach to identify when adaptation alternatives for a reservoir system are needed to replace hor aimed at maximizing economic benefit 2 we define a risk based warning threshold rwt based on the probability density function of annual benefit and the risk tolerance level and 3 we employ the probability change point analysis technique to identify fwt under a changing climate condition our developed method fills the theoretical gap relating to the time tipping point of the top down approach and answers the question of how to locate the time tipping point of a benefit oriented reservoir management strategy for the bottom up approach the rest of this paper is organized as follows section 2 presents the proposed methodology on how to identify fwt section 3 presents a case study results and discussion appear in section 4 finally conclusions are drawn in section 5 2 methodology fig 1 shows the flowchart of the proposed methodology for the identification of the fwt of hor for a cascade reservoir system under climate change it consists of six steps outlined by red dotted frames 1 in step 1 we use a gcm based model to generate streamflow projections 2 in step 2 step 4 we estimate the probability density function of the annual benefit considering the effect of streamflow specifically in step 2 a multivariate copula method that considers the spatial and temporal correlations is implemented to augment the generated streamflow projections and the augmented streamflows are used to determine the annual benefits then in step 3 the annual benefit is classified using the hydrological year category furthermore in step 4 the probability density function of the classified annual benefit is estimated 3 in step 5 we define the risk based warning threshold rwt based on the risk tolerance level and the estimated probability density function of the classified annual benefit 4 finally in step 6 we employ the probability change point analysis technique to identify the fwt of hor other details are given in the following sections 2 1 stochastic simulation of the gcm based streamflow projection for a cascade reservoir system to estimate the distribution of annual benefit generated by hor under a climate scenario a number of annual benefit samples are required we first augment the streamflows generated from the gcm based model by stochastic simulation and then feed the augmented streamflows into a reservoir operation model driven by hor to calculate the annual benefits stochastic simulation of streamflows for a cascade reservoir system should consider both spatial and temporal dependences among reservoirs it has been shown that the multivariate copula method proposed by chen et al 2015 is able to preserve the spatial and temporal dependence this method also can overcome the high dimensionality difficulty in the calculation additionally it can capture the underlying statistical characteristics of the baseline data in this study the baseline data is the gcm based streamflow projection under a climate scenario as shown in the cascade reservoir system example in step 2 of fig 1 a b and c represent gcm based streamflow projections for res 1 the interval basin between res 1 and res 2 and the interval basin between res 2 and res 3 under the same climate scenario respectively they serve as the baseline data for the multiple copula method for stochastic simulation the validity of the simulated streamflows can be seen via the comparison in boxplots of statistics mean flow standard derivation sd and coefficient of skewness cs between the baseline and simulated streamflows under the same climate scenario as shown in fig s1 in the supplementary material the stochastically simulated streamflows for the k th reservoir of the cascade reservoir system can be described as 1 qsi m k q s 1 k q s s k q s l k 2 q s s k q y 1 s k q y j s k q y n s k q s 1 1 s k q s 1 j s k q s 1 n s k q s i 1 s k q s i j s k q s i n s k q s ts 1 s k q s ts j s k q s ts n s k where qsi m k is the stochastically simulated streamflow dataset for the k th reservoir whose length is determined by the number of simulation runs l which is 200 in our case study the term qsi m k represents the streamflow into the first reservoir when the superscript k is equal to 1 it is the interval streamflow between the k 1 th and and k th reservoirs when k is greater than or equal to 2 additionally the element q s s k is the stochastically simulated streamflow matrix for the k th reservoir during the s th run as described in eq 2 q y j s k is the annual simulated streamflow series described as q y j s k q s 1 j s k q s i j s k q s ts j s k t q s i j s k is the value of inflow k 1 or interval streamflow otherwise for the k th reservoir at the i th time period in the j th year during the s th simulation run and n and ts are the number of years in the future and the number of time periods per year respectively in our case study n and ts are equal to 89 and 36 respectively 2 2 classification of annual benefit of hor based on hydrological year category hyc the annual operational benefit of reservoirs especially hydropower generation is closely related to the magnitude and variability of the intra annual streamflow condition chang et al 2018 yeh 1985 accordingly to identify the failure of hor rwt should be tailored in the specific yearly hydrological condition that is the classified rwts should be derived with respect to different yearly hydrological conditions instead of using the one size fits all value for all years this can avoid the false failure identification of hor 2 2 1 hydrological year category hyc hyc simplifies complex hydrology into a single numerical metric that is tied to water resources management null and viers 2013 the traditional approach based on the empirical probability of annual streamflow average categorizes the type of annual streamflow for a year such as wet or dry however this method ignores the effect of variability of intra annual streamflow on operational decisions such as those related to hydropower generation the set pair analysis method zhao 2000 is a useful tool for considering both the magnitude and variability of intra annual streamflow the steps of the set pair analysis are li et al 2016 1 pair two relevant sets in an uncertainty system for example set a represents a set of 10 day streamflows over a year and set b represents the predefined streamflow set for a dry year and thus g a b is the set pair and then 2 analyze identity difference and opposition characteristics of the two sets via the correlation degree fig 2 a shows the flowchart for calculating hyc via the set pair analysis method hyc includes four classes from wet to dry the procedures to calculate hyc for each reservoir 1 k m in a cascade system can be summarized as follows step 1 use the cumulative simulated streamflow dataset for the k th reservoir as the input which is described as l 1 k qsi m l l 1 k q s 1 l l 1 k q s s l l 1 k q s l l the hyc analysis starts from each period l 1 k q s i j s l then each year l 1 k q y j s l to each simulation run l 1 k q s s l step 2 evaluate the hydrological category for streamflow magnitude at the i th time period in the j th year during the s th simulation run the term c m i j s k is the classified result considering streamflow magnitude which represents one of the four classes class i class ii class iii or class iv this classification is determined by comparing the streamflow l 1 k q s i j s l with the criteria for intra annual streamflow magnitude as shown in fig 2 b in fig 2 b the simulated streamflow dataset is represented by time periods q t 1 k q t i k q t ts k the simulated streamflow matrix at the same time period q t i k is ranked from the largest to the smallest then the indicators of hydrological category in streamflow magnitude q c i k 25 q c i k 50 and q c i k 75 can be determined based on the quantiles of 25 50 and 75 respectively thus there are four criteria in intra annual streamflow magnitude represented by classes i ii iii and iv corresponding to ranges from wetness to dryness namely q c i k 25 q c i k 50 q c i k 25 q c i k 75 q c i k 50 and 0 q c i k 75 respectively step 3 repeat step 2 until i is equal to ts i e the number of time periods per year thus c v j s k is the classified result considering streamflow magnitude for one year step 4 calculate the correlation degree between c v j s k and c c f the term c c f is the f th criterion of streamflow process over one year which is described as c c f f 1 f i f ts where f represents classes i ii iii or iv moreover the equation of correlation degree is shown as 3 μ c v j s k c c f s w j 1 w λ 1 j 2 w λ 2 o w η where w is the size of the analyzed set which is equal to the number of time periods over one year in this study s is the number of identical characteristics e g i i j 1 is the number of first order different characteristics e g i ii j 2 is the number of second order different characteristics e g i iii o is the number of opposite characteristics e g i iv λ 1 and λ 2 are coefficients of uncertain difference which are assigned to be 0 4 and 0 4 respectively in our case study and η is an opposition coefficient with a value of 1 step 5 determine the hyc based on the maximum correlation degree which is shown in the following equation 4 hy c j s k f arg max f i i i i i i i v μ c v j s k c c f where hy c j s k is the hyc of the j th year in the s th simulation run for the k th reservoir in one of the classes i ii iii and iv step 6 repeat steps 2 5 to calculate hyc until n year streamflow series of one simulation run are finished then the hyc calculation is repeated for l simulation runs finally output the hyc results of the k th reservoir for n years of l simulation runs 2 2 2 classification of annual benefit 1 for each reservoir the hyc results for each reservoir in the cascade system are used to classify their annual benefits as follows 5 c b j s k h y c j s k where c b j s k is the class of annual benefit in the j th year of the s th simulation run for the k th reservoir in one of the classes i ii iii or iv 2 for cascade reservoir system since the annual benefit of the cascade reservoir system is the sum of each reservoir the classification of annual benefit for the cascade reservoir system is equal to the weighted average result of classifications for all reservoirs the equation is described as 6 c b j s cas k 1 m ω j s k c b j s k 7 ω j s k b j s k fut k 1 m b j s k fut where c b j s cas is the weighted average class for annual benefit of the cascade system and c b j s k is the class for annual benefit of the k th reservoir which is represented by symbols i ii iii or iv and then transferred to corresponding 1 2 3 or 4 for calculation when the result of c b j s cas is located in 1 0 1 75 1 75 2 5 2 5 3 25 or 3 25 4 0 c b j s cas is transferred to the symbol as classes i ii iii or iv respectively moreover c b j s cas and c b j s k can be simplified as c b j s std where the superscript std includes the cascade system and each reservoir ω j s k is the benefit weight of the k th reservoir in the j th year during the s th simulation run which is calculated by eq 7 m is the number of reservoirs in the cascade system and b j s k fut and k 1 m b j s k fut are the annual benefit of the k th reservoir and the total annual benefit of the cascade reservoir system respectively they can be simplified as b j s std fut where the superscript std includes each reservoir as well as the cascade system the notation fut indicates that the stochastically simulated results based on the gcm based projections are fed into the reservoir operation model driven by hor therefore there are four classified annual benefits for each stakeholder i e cascade system and each individual reservoir 2 3 pdf for classified annual benefit reservoir managers focus on the benefit of their controlling reservoirs while basin management groups are concerned with the overall performance of the cascade reservoir system under the joint operation of multiple reservoirs the fwt identification of hor should be executed from the viewpoint of each stakeholder including the cascade system and each individual reservoir thus the probability density function pdf of classified annual benefit for each stakeholder is analyzed in the following section which is then used to determine rwt the indicator to evaluate the failure performance of hor 2 3 1 candidate pdfs and parameter estimation there is no standard probability distribution for annual benefit particularly for hydropower generation falconett and nagasaka 2010 sahu and mclaughlin 2018 schaefli et al 2007 thus four candidate pdfs are selected in this study including normal gamma weibull with three parameters weibull 3 and burr xii the maximum likelihood method is used to estimate parameters in the normal gamma and burr xii distributions in addition the modified maximum likelihood method cohen and whitten 1982 is adopted to estimate parameters in the weibull 3 distribution the total sample size for the pdf analysis for the same stakeholder under a given climate scenario is equal to the product of the length of future period and total simulation runs in the case study the total sample size is 89 200 but the sample size varies from class i to class iv for the same stakeholder under a given climate scenario table s2 in the supplementary material shows the resulting sample sizes 2 3 2 goodness of fit we use the akaike information criterion aic akaike 1974 to determine the goodness of fit unlike previous studies where the most appropriate pdf can be selected directly from the minimum aic liu et al 2015 xiong et al 2018 we treat the selection as a problem of multi criteria decision making this is because each candidate pdf is evaluated for m 1 stakeholders with four classified annual benefits under a given climate scenario based on the aic goodness of fit results the fuzzy optimum method chen and hou 2004 is used to determine the pdf that bestfits the distributions of classified annual benefits the weighted average membership degree that has a larger value along with a smaller aic is used to determine the best pdf 2 4 risk based warning threshold rwt we employ a risk based concept borgomeo et al 2014 to define the warning threshold for the failure of hor based on the most appropriate pdf selected from section 2 3 the rwt can be calculated from the inverse cumulative distribution function for a given risk tolerance level β as shown in fig 3 for a given pdf the larger the β the higher the rwt and the risk tolerance level β represents the preference of decision makers the suggested range of β is 0 05 0 20 eq 8 shows the calculation of rwt rwt represents the minimum acceptable annual benefit which is used as an evaluation benchmark of hor s failure in other words if the annual benefit of hor is less than rwt a potential operation risk will occur along with the failure occurrence of hor considering the effect of streamflow on annual benefit of reservoir operation rwt varies with classes of annual benefit which can avoid the one size fits all identification of hor s failure 8 pr x f std rwt f std 0 rwt f std g x f std d x β where pr is the probability x f std rwt f std is the failure occurrence event of hor which indicates the actual annual benefit is less than the determined rwt g x f std is the most appropriate pdf among four candidate pdfs in which the variable x f std represents the f th classified annual benefit for the std th stakeholder β is the risk tolerance level which is equal to 0 1 for both the cascade system and each individual reservoir implying that we accept the failure probability of hor of less than 10 and rwt f std is the risk based warning threshold varying with stakeholders and classes of annual benefit 2 5 identification of failure warning time fwt of hor using probability change point analysis technique 2 5 1 probability change point analysis technique the probability change point analysis technique krishnaiah and miao 1988 is a parametric statistical method to detect the change point it has two assumptions 1 the analyzed data is independent and 2 the targeted event follows a binominal distribution the basic principle of the probability change point analysis technique is that the probability of a targeted event is stable at p 1 but suddenly changes into p 2 in the following unknown time τ previous work shows the details of the probability change point analysis technique krishnaiah and miao 1988 liu et al 2010 the probability change point analysis technique has been used widely in the hydrologic field bărbulescu 2016 chen et al 2007 du et al 2015 jiang et al 2017 liu et al 2010 xu et al 2003 this method is popular for solving the problem of flood season segmentation jiang et al 2017 liu et al 2010 it determines the main flood period via the change point of flood disaster occurrences which can guide reservoir operators to dynamically control the flood limited water level in our study the probability change point analysis technique is used to identify fwt a change point when hor fails in the future fwt can inform how long hor can remain effective and when a new operating rule is needed under a changing environment the conceptual elements of the probability change point analysis technique are illustrated based on the practical problem including the 1 analysis object 2 targeted event 3 threshold 4 length of time series 5 time period and 6 size of sample set in each time period table 1 compares the conceptual illustrations in the flood season segmentation and the fwt identification of hor 2 5 2 fwt identification we use the probability change point analysis technique based on the cumulative sum estimation method to determine the change point in our study krishnaiah and miao 1988 liu et al 2010 fig 4 clarifies the procedures of fwt identification as follows note that the fwt identification is implemented for each stakeholder step 1 input the independent variables e v 1 e v j e v n and record the initial identification g 1 the term e v j is the number of failure occurrences of hor for the j th year and it is also assumed to follow a binomial distribution the equation of e v j is 9 e v j s 1 l λ j s where λ j s 1 b j s std fut rwt c b j s std 0 o t h e r w i s e is the binary function which returns a value of 1 failure occurrence or 0 no failure occurrence and l is the number of simulation runs step 2 identify the fwt using the cumulative sum estimation method krishnaiah and miao 1988 introduced the hypothesis test for a change point in probability the equation to detect the change point is 10 τ arg max n s e v j j s e v n where τ is the fwt of hor starting from 1 to n and sevj is the cumulative sum of failure occurrence from the first year to the j th year calculated by 11 se v j r 1 j e v r j 1 2 n step 3 calculate the average failure occurring probabilities for the pre failure period 1 2 τ 1 and the failure period τ τ 1 n from the following equation 12 p v 1 ζ v τ v τ v 1 j τ v 1 τ v 1 e v j v 1 2 where pv is the average failure occurring probability for the v th period in which v 1 and v 2 represent pre failure and failure periods of hor respectively τ 0 τ 1 τ 2 are equal to 1 τ n 1 respectively and ζ v is the sum of occurrences and non occurrences of hor failure which is equal to the number of simulation runs i e l step 4 the definition of fwt in the introduction section implies the critical condition of p 1 p 2 thus if the constraint of p 1 p 2 is satisfied then fwt y r b τ 1 is the yearly information of fwt where yrb is the starting year of the future period accordingly there are two segmentation periods namely the pre failure period and the failure period corresponding to the average failure occurring probabilities of hor of p 1 and p 2 respectively this result is denoted as solution 1 simplified as sl 1 step 5 if the constraint is not satisfied i e p 1 p 2 let τ τ and p 3 p 2 the period from τ to n is called the post failure period which has the average failure occurring probability of p 3 the data for the period from 1 to τ namely e v 1 e v j e v τ is used as the re analysis data and the value of g increases to 2 steps 2 3 are repeated to relocate the change point τ during the period from 1 to τ see the illustration in fig 4 step 6 if the constraint of p 1 p 2 is satisfied by step 5 then fwt y r b τ 1 is the yearly information of fwt in which τ is the relocated change point thus the entire future period is divided into pre failure failure and post failure periods their corresponding average failure occurring probabilities of hor are shown as p 1 p 2 and p 3 this result is denoted as sl 2 step 7 if p 1 p 2 by step 5 then fwt y r b is the yearly information of fwt it indicates that hor cannot be applied in the entire future period under a climatic changing scenario since the average failure occurring probability of hor decreases with three periods that last from 1 to τ 1 τ to τ 1 and τ to n this result is denoted as sl 3 therefore based on the aforementioned steps sl 1 sl 2 and sl 3 are good mediate and poor situations of fwt identification with the constraint of p 1 p 2 respectively sl 1 and sl 2 indicate that hor can be used in years until fwt but the difference is that the fwt of hor for sl 1 is later than that for sl 2 sl 3 indicates the worst result since its high failure of hor mainly in the near future period greatly undermines the application potential of hor in the long term future period 3 case study description 3 1 the xiluodu xld xiangjianba xjb three gorges tgr cascade reservoir system the yangtze river the longest river in asia flows for 6418 km from the qinghai tibet plateau where the reach is called the jinsha river eastward across southwest central and eastern china before emptying into the east china sea at shanghai fig 5 shows the xld xjb tgr cascade reservoir system that covers the upper mainstream of the yangtze river this system is selected as the case study and its characteristic parameter values are listed in table 2 in the cascade system the xld and the xjb are two reservoirs at the end of the jinsha river while their downstream reservoir tgr is an important project intercepting the upstream of the yangtze river streamflow of the interval basin between xjb and tgr collecting flows from the min river jialing river and wu river is more than twice the streamflow into the jinsha river the xld xjb tgr cascade reservoir system has the main functions of hydropower generation and flood control and it can supply most electricity for eastern and central cities in china 3 2 hydro meteorological data we collect the hydro meteorological data for both the jinsha river basin covering xld and xjb and the interval basin between xjb and tgr the time period is 10 days the historical period is from january 1 1956 to december 31 2011 historical daily climate data including precipitation and temperature is provided by the china meteorological data sharing service system http www cma gov cn we then transform the data to a 10 day time period historical 10 day streamflows of the two basins are collected by the changjiang water resources commission the future period starts on january 1 2012 and ends on december 31 2100 projections of climate change in precipitation and temperature are provided by the coupled model intercomparison project phase 5 cmip5 multi model database wang et al 2019 we use one representative concentration pathway rcp8 5 for climate projections in the future because rcp8 5 projects the most severe increase in greenhouse gas emissions among the four rcps and often is used to design conservative mitigation and adaptation strategies ipcc 2014 in addition future raw climate data is post processed to the regional scale using the bias correcting and spatial downscaling approach chen et al 2013 we select four gcms in this study including bnu esm canesm2 csiro mk3 6 0 and ipsl cm5a lr then for each gcm we feed its projected precipitations and potential evaporations into a two parameter monthly water balance model xiong and guo 1999 the model then generates future streamflows for the jinsha river basin and the interval basin between xjb and tgr the calibration and validation results for the hydrological model are shown in table s1 in the supplementary material 3 3 historical operating rules hor for the xld xjb tgr cascade reservoir system 3 3 1 objective eq 13 shows the objective function which maximizes the average annual hydropower generation of the cascade reservoir system 13 max b cas his 1 n j 1 n i 1 ts p o i j δ t i j where b cas his is the average annual hydropower generation in which the notation his indicates that historical streamflows are used as an input into the optimization model n and ts are the number of years and the number of time periods per year respectively δ t i j is the time period which is 10 days and p o i j is the total power output kw at the i th time period in the j th year which is calculated as 14 p o i j k 1 m p o i j k 15 p o i j k min γ k r i j k h i j k p o max k where p o i j k is power output of the k th reservoir at the i th time period in the j th year m is the number of reservoirs in the cascade system γ k is the hydropower generation efficiency of the k th reservoir r i j k is the reservoir release of the k th reservoir at the i th time period in the j th year h i j k is the effective water head of the k th reservoir which is a function of the reservoir storage and the tailrace water level and p o max k is the maximum power output of the k th reservoir which is constrained by turbine generator capacity 3 3 2 constraints the model constraints include water balance water storage capacity hydrological link between reservoirs reservoir release and power output limits 1 water balance equation 16 v i 1 j k v i j k i i j k r i j k δ t i j v 1 j 1 k v ts 1 j k i j k 2 hydrological link between reservoirs 17 i i j k δ i i j k r i j k 1 k 2 3 water storage capacity limit 18 v i min k v i j k v i max k i j k 4 reservoir release limit 19 r min k r i j k r max k i j k 5 power output limit 20 p o min k p o i j k p o max k i j k where v i j k is the reservoir storage of the k th reservoir at the i th time period in the j th year which is constrained by the minimum storage v i min k and the maximum storage v i max k i i j k and δ i i j k are the inflow and interval inflow of the k th reservoir at the i th time period in the j th year respectively r i j k is the release of the k th reservoir at the i th time period in the j th year ranging from the minimum release r min k to the maximum release r max k and p o i j k is the power output of the k th reservoir at the i th time period in the j th year constrained by the minimum output p o min k and the maximum power output p o max k 3 3 3 derivation of hor the parameterization simulation optimization approach has been used for the derivation of operating rules of a multi reservoir system oliveira and loucks 1997 it consists of the following steps koutsoyiannis and economou 2003 1 predefine the reservoir operating rules which generally depends on the study areas and the reservoir operator s preferences 2 optimize the parameters of reservoir operating rules 3 simulate the operation of the reservoir system based on given parameter values of the reservoir operating rules and 4 determine the optimal reservoir operating rules via evaluating the performance measure of the system in this study we use the parameterization simulation optimization approach with the genetic algorithm to derive hor for the cascade reservoir system a linear decision rule is assumed for the hor for the cascade reservoir system karamouz et al 1992 liu et al 2014 which is described by the following equation 21 r i j k a i k v i j k δ t i j i i j k b i k i j k where a i k and b i k are parameters of hor for the k th reservoir at the i th time period r i j k is the reservoir release to be determined for the k th reservoir v i j k is the storage of the k th reservoir at the i th time period in the j th year and v i j k δ t i j i i j k is the available water for the k th reservoir with the unit of discharge the ranges of parameters a i k and b i k are set to be 0 200 and 85000 40000 for xld xjb and tgr respectively 4 results and discussion 4 1 analysis of four climate scenarios fig 6 shows the relative change of multi year average precipitation temperature and streamflow from historical to future periods the selected four gcms reflect different possible future climate situations specifically csiro mk3 6 0 is the scenario where the climate environment becomes simultaneously dry for both the jinsha river basin and the interval basin between xjb and tgr moreover the simultaneously wet climate scenario can be seen in canesm2 bnu esm predicts increasing streamflow into xld and xjb but decreasing interval streamflow into tgr while the opposite is estimated by ipsl cm5a lr in terms of overall streamflow into the cascade system the rank of hydrological conditions from the driest to the wettest is csiro mk3 6 0 bnu esm ipsl cm5a lr and canesm2 the gcm based streamflow projection of each climate scenario then is selected as the baseline data for stochastic simulation using the multivariate copula approach fig s1 in the supplementary material shows boxplots of statistics mean flow standard derivation sd and coefficient of skewness cs of baseline and simulated streamflows under four future climate scenarios it reveals that the statistics of all simulations fall within the boxplots for most of the 10 day periods furthermore it indicates that the stochastically simulated series can be used to represent the selected climate scenario due to statistical characteristics similar to the baseline data 4 2 the pdf of classified annual benefit fig 7 a shows the results of different pdf estimations calculated from the aic and fuzzy optimum methods it shows that the normal distribution is the most appropriate distribution for the annual benefit of hydropower generation since it has the maximum weighted average membership degree of all stakeholders under each climate scenario moreover fig 7 b indicates that the normal distribution outperforms other selected distributions for the cascade system xld and tgr under each climate scenario the normal distribution is also the best choice for xjb under csiro mk3 6 0 and ipsl cm5a lr however relative to xld and tgr the best selection of annual benefit distribution for xjb easily is affected by the given climate scenario this implies that xjb with smaller reservoir storage capacity is less adaptive to the changing environment than xld and tgr with larger reservoir storage capacities which is consistent with the investigation by ehsani et al 2017 table 3 lists pdf parameters of the normal distribution for each class of annual benefit for xld xjb tgr and the cascade system under the four climate scenarios in which the parameters θ 1 and θ 2 represent the mean and the standard derivation of annual hydropower generation respectively as this table shows the mean θ 1 gradually decreases from class i wet to class iv dry for all stakeholders under each climate scenario this demonstrates the rationality of the classification method proposed in section 2 2 moreover the rank of the mean θ 1 among four climate scenarios is consistent with the rank of four gcm based streamflow projections in section 4 1 the standard derivations θ 2 however are greater in the distributions of classes i and iv than in classes ii and iii this is because extremely wet dry streamflow leads to the largest smallest values of annual benefit in class i iv 4 3 results of rwt based on the parameters of the normal distribution for classified annual benefit and the definition of rwt shown in eq 8 table 4 presents the results of rwt for each stakeholder of the xld xjb tgr cascade reservoir system under the four climate scenarios as table 4 shows rwt significantly decreases from class i wet to class iv dry for all stakeholders under each climate scenario additionally rwt increases with increasing gcm based streamflow projections specifically the rwt for xld xjb depends on the streamflow of the jinsha river basin while the rwt for the tgr cascade system relies on the total streamflow into the cascade system this indicates that the evaluation benchmark of whether hor fails should be determined in light of the annual streamflow condition and the climatic environment moreover the sum of rwts for xld xjb and tgr is less than the rwt for the cascade system this is because the rwt for the individual reservoir focuses on the risk of the reservoir itself while the rwt for the cascade system implies that at least one reservoir in the cascade system is at risk overall rwt for each stakeholder becomes smaller in the drier annual streamflow condition and under a more adverse climate changing environment thus the classified rwt can avoid the false failure identification of hor 4 4 the fwt for the xld xjb tgr cascade system the procedures to identify fwt described in section 2 5 2 are implemented for each stakeholder under each climate scenario the data used in the first step is assumed to be independent and we test this assumption based on the lag 1 autocorrelation coefficient additionally a chi squared goodness of test is performed to test the assumption that the failure occurrence of hor follows the binomial distribution we use χ 0 95 2 4 9 488 as the benchmark table 5 presents the results of the autocorrelation coefficient for independence and χ 2 for binomial distribution during pre failure failure and post failure periods it indicates that the assumptions of independence and binomial distribution are acceptable for all three periods table 5 also compares the fwts for the cascade system xld xjb and tgr under the four climate scenarios the results of fwt indicate that hor remains effective in at least another 10 years for all stakeholders under all climate scenarios the fwts are presented by sl 1 good situation and sl 2 mediate situation the sl 2 for xld and xjb exists in the scenarios where streamflow into the jinsha river basin decreases csiro mk3 6 0 and ipsl cm5a lr moreover sl 2 for the cascade system occurs in the condition where the streamflow decreases in both the jinsha river basin and the interval basin between xjb and tgr csiro mk3 6 0 the applicability of the probability change point analysis technique is demonstrated by the successful identification of fwt for all stakeholders under all climate scenarios in table 5 we also can see that the fwt of hor for the cascade system will occur significantly earlier when the streamflow of the jinsha river basin decreases in the future comparing csiro mk3 6 0 ipsl cm5a lr with bnu esm canesm2 furthermore the failure of hor for the cascade system will accelerate if the streamflows decrease alternately for the jinsha river basin and the interval basin between xjb and tgr bnu esm vs canesm2 csiro mk3 6 0 vs ipsl cm5a lr since hor is derived based on the joint operation of the xld xjb tgr cascade system we wonder whether the failure of each individual reservoir may instantly affect the failure of the cascade system from table 5 we see that 1 if the earliest failure warning occurs in tgr or simultaneously in two reservoirs of the jinsha river basin say xld and xjb the instant failure impact on the cascade system is evident this can be observed for bnu esm and canesm2 and 2 if the earliest fwt only happens in xjb the failure response in the cascade system is delayed this can be seen for csiro mk3 6 0 and ipsl cm5a lr hence considering the characteristics of the three reservoirs in table 2 we infer that if the first failure of hor occurs in the reservoir with the larger storage capacity i e xld or tgr the failure of the cascade system will accelerate fig 8 shows the failure occurrance probabilities during pre failure failure and post failure periods for each stakeholder under the four climate scenarios previous research on flood season segmentation indicates that flood disaster events seldom occur in the days of the pre flood season and the post flood season but mainly happen in the days of the flood season jiang et al 2017 liu et al 2010 however regarding the issue of fwt identification of hor in this study the occurrence of hor s failure exists in all years of the future period and the failure period has the highest average probability of failure occurrence this could arise from the fact that a flood disaster event is defined based on the same peak over threshold while the definition of the failure occurrence event of hor is subject to the classified rwt moreover for sl 2 mediate situation even though the average failure probability for the post failure period could be lower than that of the pre failure period such as xld and xjb under ipsl cm5a lr it is suggested that hor be replaced before fwt this is because the high frequent failures of hor in the failure period will greatly undermine the application potential of hor in the following time period similar to explanations of atp haasnoot et al 2015 kwadijk et al 2010 5 conclusions in this paper we proposed a methodology to determine the time tipping point where the historical operating rules hor of the benefit oriented reservoir should be replaced by adaptation alternatives under climate change the xld xjb tgr cascade reservoir system in the yangtze river of china was used as a case study we used bnu esm canesm2 csiro mk3 6 0 and ipsl cm5a lr to produce future climate scenarios we then employed a multivariate copula technique to generate equally likely streamflows based on the gcm projected streamflows the augmented streamflows were used to determine the annual benefits under the operation of hor we further classified annual benefit for each individual reservoir as well as the cascade system using the hydrological year category hyc furthermore we selected the most appropriate pdf of the classified annual benefit via the aic indicator and a multi criteria decision making method accordingly we incorporated the risk tolerance level in the pdf of the classified annual benefit to calculate the risk based warning threshold rwt finally we adopted the probability change point analysis technique to identify the failure warning time fwt of hor under climate change the main conclusions of this paper are summarized as follows 1 the normal distribution is most appropriate to describe the distribution of annual hydropower generation regardless of classes of annual benefit stakeholders and climate scenarios 2 the rwt for each stakeholder becomes smaller in a drier future climatic environment as well as in a drier annual hydrological condition under a specific climate scenario this further suggests the classified rwt should be used in fwt identification 3 the resulting fwts based on the probability change point analysis technique indicate that the time tipping point where hor should be replaced by new adaptation alternatives is at least 10 years away under four climate scenarios 4 the fwt of hor will be earlier with the decreasing streamflow in the jinsha river basin or the opposite streamflow changes of upstream and interval basins 5 the failure impact on the cascade system will accelerate when the first failure performance of hor occurs in the reservoir with larger storage capacity i e xld or tgr credit authorship contribution statement wei zhang conceptualization methodology software data curation writing original draft visualization investigation jinshu li methodology writing review editing validation pan liu conceptualization methodology writing review editing validation xiaohui lei data curation resources jie chen data curation william w g yeh conceptualization methodology writing review editing validation supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was supported by the china scholarship council 201806270120 an aecom endowment the national natural science foundation of china no 52109011 and the china three gorges corporation research project contract no 202103044 the data used in this paper can be requested by contacting the first author wei zhang at zhang wei47 ctg com cn conflict of interest statement the authors declare that they have no conflicts of interest appendix a supplementary material supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127111 appendix a supplementary material the following are the supplementary data to this article supplementary data 1 
3856,this paper presents a methodology for the identification of the time tipping point where historical operating rules of a reservoir system should be replaced by new alternatives due to climate change the time tipping point is a time indicator of the failure probability change point of the historical operating rules for the reservoir system under future climate change called the failure warning time for this study the primary purpose of the reservoir system is hydropower generation we first estimate the probability density function of the annual benefit of hydropower generation then based on the estimated probability density function and the given risk tolerance level of the reservoir system we determine the risk based warning threshold and further identify the failure warning time of the historical operating rules via the probability change point analysis technique we apply the proposed methodology to the xiluodu xiangjiaba three gorges cascade reservoir system on the yangtze river in china the results indicate that the failure warning time for the cascade reservoir system will occur in at least another 10 years in the future under climate change we also find that the failure response in the cascade reservoir system is determined by both the reservoir that has the first failure occurrence and its storage capacity the developed methodology can be used to determine the time tipping point to launch adaptation strategies for the river basin management and further can help policymakers cope with climate change keywords climate change reservoir operation failure warning time risk based warning threshold cascade reservoir system 1 introduction joint operation of reservoirs can mitigate the adverse impacts of climate change loucks and van beek 2005 the need to develop reservoir adaptation operation strategies for mitigating the impacts of climate change has received much attention in recent years brown et al 2012 he et al 2020 mandal et al 2019 nourani et al 2020 ray and brown 2015 zhang et al 2020 there are two main approaches of formulating an adaptation strategy on a regional and local scale the top down approach and the bottom up approach the top down approach follows the predict then act idea where climate projections based on general circulation models gcms are downscaled to match the spatial and temporal scales of hydrological models and then reservoir operation models used for formulation of adaptation strategies are driven by hydrological projections related to climate change many studies employ this approach to deal with the adverse effects of specific climate change conditions on river basin management georgakakos et al 2012 giuliani et al 2016 haguma et al 2014 herman and giuliani 2018 tullos et al 2020 zhang et al 2019 in constrast the bottom up approach adopts the decision scaling idea where system characteristics of risk and local capacities are taken into consideration before the robustness of potential adaptation alternatives is tested against climate projections brown et al 2012 both the top down approach and the bottom up approach can answer the question of how to implement reservoir operation under climate change however these two approaches cannot identify the time tipping point at which the current reservoir management strategy fails and new alternatives are needed till now most studies based on the top down approach have adopted subjective preferences to the time tipping point kwadijk et al 2010 this undermines the applicability of the top down approach in real world reservoir practices some researchers haasnoot et al 2015 kwadijk et al 2010 werners et al 2013 have attempted to locate the time tipping point based on the bottom up principles they advanced the concept of adaptation tipping point atp the atp is defined as the point where the changing magnitude of environmental variables such as temperature rainfall discharge and sea level due to climate change is such that the current management strategy will fail to meet the objectives it can determine whether and when adaptation strategies are needed from physical and ecological viewpoints these authors also revealed that failure of the current management strategy to meet the objectives is the main driver motivating adaptation actions rather than climate change itself kwadijk et al 2010 and haasnoot et al 2015 identified the atp for the rhine delta aimed at flood control and water supply according to the rhine delta study when water level alteration under the current management strategy exceeds the acceptable threshold of 0 2m over future decades the atp is reached and a new adaptation strategy is required the atp method is only suitable for reservoir systems evaluated on environmental variables e g flood control only relying on the reservoir water level this is because the environment dam constraints can directly illustrate the reasonability of the acceptable alteration threshold of the environmental variables however the atp method cannot be applied directly to the management of a reservoir system that is aimed at maximizing economic benefit such as hydropower generation this is because the acceptable alteration threshold of hydropower generation should be determined by both environmental variables and turbine generator capacity haasnoot et al 2015 also pointed out the need for further research on how to determine the atp for reservoirs aimed at maximizing economic benefit therefore in the view of the change point of failure probability we propose a methodology to identify the atp of the current management strategy for a reservoir system evaluated on economic benefits under climate change the current management strategy for a reservoir system is described as the parametric rules based on historical observed data giuliani et al 2014 yang et al 2017 zhang et al 2017 in this paper we call this historical operating rules hor of the reservoir system though it also is referred to as baseline operating rules in other publications giuliani et al 2016 herman and giuliani 2018 hor is widely employed in real operational contexts since it serves the objectives well under a range of past hydro meteorological variabilities salas et al 2012 in this study we refer to the identified atp as the failure warning time fwt of hor aimed at maximizing economic benefits we introduce the probability change point analysis technique krishnaiah and miao 1988 liu et al 2010 to determine the fwt of hor fwt can inform reservoir managers when adaptation operating rules are needed however unlike atp which is reached through exceedance of acceptable physical or ecological alteration change thresholds under the current management strategy haasnoot et al 2015 kwadijk et al 2010 werners et al 2013 fwt is a time indicator of the failure probability change point of hor the period prior to fwt indicates that hor is functional with low failure probability while the period after fwt implies that reservoir managers have to implement the adaptation alternatives otherwise they may face high risk of failure if hor continues the failure occurrence of hor is the situation where the actual annual benefit of the current management strategy is less than the risk based warning threshold rwt the rwt is determined by the probability density function and risk tolerance level if the main purpose of the reservoir system is for hydropower generation its annual benefit is highly affected by the magnitude and variability of intra annual streamflow yeh 1985 in order to avoid false identification for failure occurrences of hor the rwt related to hydropower generation should be classified based on the hydrological year category the identification of fwt is conducted in the context of climate change in this study the plausible scenarios to describe climate change are generated from gcm based climate projections the advantages of gcm based climate projections include 1 the consideration of hydro meteorological variables in temporal variability and spatial correlation 2 the ability to provide clear time corresponding to projection results and 3 the physical response of the earth s climate to environmental changes and social development in summary this paper contains three main contributions 1 we propose an approach to identify when adaptation alternatives for a reservoir system are needed to replace hor aimed at maximizing economic benefit 2 we define a risk based warning threshold rwt based on the probability density function of annual benefit and the risk tolerance level and 3 we employ the probability change point analysis technique to identify fwt under a changing climate condition our developed method fills the theoretical gap relating to the time tipping point of the top down approach and answers the question of how to locate the time tipping point of a benefit oriented reservoir management strategy for the bottom up approach the rest of this paper is organized as follows section 2 presents the proposed methodology on how to identify fwt section 3 presents a case study results and discussion appear in section 4 finally conclusions are drawn in section 5 2 methodology fig 1 shows the flowchart of the proposed methodology for the identification of the fwt of hor for a cascade reservoir system under climate change it consists of six steps outlined by red dotted frames 1 in step 1 we use a gcm based model to generate streamflow projections 2 in step 2 step 4 we estimate the probability density function of the annual benefit considering the effect of streamflow specifically in step 2 a multivariate copula method that considers the spatial and temporal correlations is implemented to augment the generated streamflow projections and the augmented streamflows are used to determine the annual benefits then in step 3 the annual benefit is classified using the hydrological year category furthermore in step 4 the probability density function of the classified annual benefit is estimated 3 in step 5 we define the risk based warning threshold rwt based on the risk tolerance level and the estimated probability density function of the classified annual benefit 4 finally in step 6 we employ the probability change point analysis technique to identify the fwt of hor other details are given in the following sections 2 1 stochastic simulation of the gcm based streamflow projection for a cascade reservoir system to estimate the distribution of annual benefit generated by hor under a climate scenario a number of annual benefit samples are required we first augment the streamflows generated from the gcm based model by stochastic simulation and then feed the augmented streamflows into a reservoir operation model driven by hor to calculate the annual benefits stochastic simulation of streamflows for a cascade reservoir system should consider both spatial and temporal dependences among reservoirs it has been shown that the multivariate copula method proposed by chen et al 2015 is able to preserve the spatial and temporal dependence this method also can overcome the high dimensionality difficulty in the calculation additionally it can capture the underlying statistical characteristics of the baseline data in this study the baseline data is the gcm based streamflow projection under a climate scenario as shown in the cascade reservoir system example in step 2 of fig 1 a b and c represent gcm based streamflow projections for res 1 the interval basin between res 1 and res 2 and the interval basin between res 2 and res 3 under the same climate scenario respectively they serve as the baseline data for the multiple copula method for stochastic simulation the validity of the simulated streamflows can be seen via the comparison in boxplots of statistics mean flow standard derivation sd and coefficient of skewness cs between the baseline and simulated streamflows under the same climate scenario as shown in fig s1 in the supplementary material the stochastically simulated streamflows for the k th reservoir of the cascade reservoir system can be described as 1 qsi m k q s 1 k q s s k q s l k 2 q s s k q y 1 s k q y j s k q y n s k q s 1 1 s k q s 1 j s k q s 1 n s k q s i 1 s k q s i j s k q s i n s k q s ts 1 s k q s ts j s k q s ts n s k where qsi m k is the stochastically simulated streamflow dataset for the k th reservoir whose length is determined by the number of simulation runs l which is 200 in our case study the term qsi m k represents the streamflow into the first reservoir when the superscript k is equal to 1 it is the interval streamflow between the k 1 th and and k th reservoirs when k is greater than or equal to 2 additionally the element q s s k is the stochastically simulated streamflow matrix for the k th reservoir during the s th run as described in eq 2 q y j s k is the annual simulated streamflow series described as q y j s k q s 1 j s k q s i j s k q s ts j s k t q s i j s k is the value of inflow k 1 or interval streamflow otherwise for the k th reservoir at the i th time period in the j th year during the s th simulation run and n and ts are the number of years in the future and the number of time periods per year respectively in our case study n and ts are equal to 89 and 36 respectively 2 2 classification of annual benefit of hor based on hydrological year category hyc the annual operational benefit of reservoirs especially hydropower generation is closely related to the magnitude and variability of the intra annual streamflow condition chang et al 2018 yeh 1985 accordingly to identify the failure of hor rwt should be tailored in the specific yearly hydrological condition that is the classified rwts should be derived with respect to different yearly hydrological conditions instead of using the one size fits all value for all years this can avoid the false failure identification of hor 2 2 1 hydrological year category hyc hyc simplifies complex hydrology into a single numerical metric that is tied to water resources management null and viers 2013 the traditional approach based on the empirical probability of annual streamflow average categorizes the type of annual streamflow for a year such as wet or dry however this method ignores the effect of variability of intra annual streamflow on operational decisions such as those related to hydropower generation the set pair analysis method zhao 2000 is a useful tool for considering both the magnitude and variability of intra annual streamflow the steps of the set pair analysis are li et al 2016 1 pair two relevant sets in an uncertainty system for example set a represents a set of 10 day streamflows over a year and set b represents the predefined streamflow set for a dry year and thus g a b is the set pair and then 2 analyze identity difference and opposition characteristics of the two sets via the correlation degree fig 2 a shows the flowchart for calculating hyc via the set pair analysis method hyc includes four classes from wet to dry the procedures to calculate hyc for each reservoir 1 k m in a cascade system can be summarized as follows step 1 use the cumulative simulated streamflow dataset for the k th reservoir as the input which is described as l 1 k qsi m l l 1 k q s 1 l l 1 k q s s l l 1 k q s l l the hyc analysis starts from each period l 1 k q s i j s l then each year l 1 k q y j s l to each simulation run l 1 k q s s l step 2 evaluate the hydrological category for streamflow magnitude at the i th time period in the j th year during the s th simulation run the term c m i j s k is the classified result considering streamflow magnitude which represents one of the four classes class i class ii class iii or class iv this classification is determined by comparing the streamflow l 1 k q s i j s l with the criteria for intra annual streamflow magnitude as shown in fig 2 b in fig 2 b the simulated streamflow dataset is represented by time periods q t 1 k q t i k q t ts k the simulated streamflow matrix at the same time period q t i k is ranked from the largest to the smallest then the indicators of hydrological category in streamflow magnitude q c i k 25 q c i k 50 and q c i k 75 can be determined based on the quantiles of 25 50 and 75 respectively thus there are four criteria in intra annual streamflow magnitude represented by classes i ii iii and iv corresponding to ranges from wetness to dryness namely q c i k 25 q c i k 50 q c i k 25 q c i k 75 q c i k 50 and 0 q c i k 75 respectively step 3 repeat step 2 until i is equal to ts i e the number of time periods per year thus c v j s k is the classified result considering streamflow magnitude for one year step 4 calculate the correlation degree between c v j s k and c c f the term c c f is the f th criterion of streamflow process over one year which is described as c c f f 1 f i f ts where f represents classes i ii iii or iv moreover the equation of correlation degree is shown as 3 μ c v j s k c c f s w j 1 w λ 1 j 2 w λ 2 o w η where w is the size of the analyzed set which is equal to the number of time periods over one year in this study s is the number of identical characteristics e g i i j 1 is the number of first order different characteristics e g i ii j 2 is the number of second order different characteristics e g i iii o is the number of opposite characteristics e g i iv λ 1 and λ 2 are coefficients of uncertain difference which are assigned to be 0 4 and 0 4 respectively in our case study and η is an opposition coefficient with a value of 1 step 5 determine the hyc based on the maximum correlation degree which is shown in the following equation 4 hy c j s k f arg max f i i i i i i i v μ c v j s k c c f where hy c j s k is the hyc of the j th year in the s th simulation run for the k th reservoir in one of the classes i ii iii and iv step 6 repeat steps 2 5 to calculate hyc until n year streamflow series of one simulation run are finished then the hyc calculation is repeated for l simulation runs finally output the hyc results of the k th reservoir for n years of l simulation runs 2 2 2 classification of annual benefit 1 for each reservoir the hyc results for each reservoir in the cascade system are used to classify their annual benefits as follows 5 c b j s k h y c j s k where c b j s k is the class of annual benefit in the j th year of the s th simulation run for the k th reservoir in one of the classes i ii iii or iv 2 for cascade reservoir system since the annual benefit of the cascade reservoir system is the sum of each reservoir the classification of annual benefit for the cascade reservoir system is equal to the weighted average result of classifications for all reservoirs the equation is described as 6 c b j s cas k 1 m ω j s k c b j s k 7 ω j s k b j s k fut k 1 m b j s k fut where c b j s cas is the weighted average class for annual benefit of the cascade system and c b j s k is the class for annual benefit of the k th reservoir which is represented by symbols i ii iii or iv and then transferred to corresponding 1 2 3 or 4 for calculation when the result of c b j s cas is located in 1 0 1 75 1 75 2 5 2 5 3 25 or 3 25 4 0 c b j s cas is transferred to the symbol as classes i ii iii or iv respectively moreover c b j s cas and c b j s k can be simplified as c b j s std where the superscript std includes the cascade system and each reservoir ω j s k is the benefit weight of the k th reservoir in the j th year during the s th simulation run which is calculated by eq 7 m is the number of reservoirs in the cascade system and b j s k fut and k 1 m b j s k fut are the annual benefit of the k th reservoir and the total annual benefit of the cascade reservoir system respectively they can be simplified as b j s std fut where the superscript std includes each reservoir as well as the cascade system the notation fut indicates that the stochastically simulated results based on the gcm based projections are fed into the reservoir operation model driven by hor therefore there are four classified annual benefits for each stakeholder i e cascade system and each individual reservoir 2 3 pdf for classified annual benefit reservoir managers focus on the benefit of their controlling reservoirs while basin management groups are concerned with the overall performance of the cascade reservoir system under the joint operation of multiple reservoirs the fwt identification of hor should be executed from the viewpoint of each stakeholder including the cascade system and each individual reservoir thus the probability density function pdf of classified annual benefit for each stakeholder is analyzed in the following section which is then used to determine rwt the indicator to evaluate the failure performance of hor 2 3 1 candidate pdfs and parameter estimation there is no standard probability distribution for annual benefit particularly for hydropower generation falconett and nagasaka 2010 sahu and mclaughlin 2018 schaefli et al 2007 thus four candidate pdfs are selected in this study including normal gamma weibull with three parameters weibull 3 and burr xii the maximum likelihood method is used to estimate parameters in the normal gamma and burr xii distributions in addition the modified maximum likelihood method cohen and whitten 1982 is adopted to estimate parameters in the weibull 3 distribution the total sample size for the pdf analysis for the same stakeholder under a given climate scenario is equal to the product of the length of future period and total simulation runs in the case study the total sample size is 89 200 but the sample size varies from class i to class iv for the same stakeholder under a given climate scenario table s2 in the supplementary material shows the resulting sample sizes 2 3 2 goodness of fit we use the akaike information criterion aic akaike 1974 to determine the goodness of fit unlike previous studies where the most appropriate pdf can be selected directly from the minimum aic liu et al 2015 xiong et al 2018 we treat the selection as a problem of multi criteria decision making this is because each candidate pdf is evaluated for m 1 stakeholders with four classified annual benefits under a given climate scenario based on the aic goodness of fit results the fuzzy optimum method chen and hou 2004 is used to determine the pdf that bestfits the distributions of classified annual benefits the weighted average membership degree that has a larger value along with a smaller aic is used to determine the best pdf 2 4 risk based warning threshold rwt we employ a risk based concept borgomeo et al 2014 to define the warning threshold for the failure of hor based on the most appropriate pdf selected from section 2 3 the rwt can be calculated from the inverse cumulative distribution function for a given risk tolerance level β as shown in fig 3 for a given pdf the larger the β the higher the rwt and the risk tolerance level β represents the preference of decision makers the suggested range of β is 0 05 0 20 eq 8 shows the calculation of rwt rwt represents the minimum acceptable annual benefit which is used as an evaluation benchmark of hor s failure in other words if the annual benefit of hor is less than rwt a potential operation risk will occur along with the failure occurrence of hor considering the effect of streamflow on annual benefit of reservoir operation rwt varies with classes of annual benefit which can avoid the one size fits all identification of hor s failure 8 pr x f std rwt f std 0 rwt f std g x f std d x β where pr is the probability x f std rwt f std is the failure occurrence event of hor which indicates the actual annual benefit is less than the determined rwt g x f std is the most appropriate pdf among four candidate pdfs in which the variable x f std represents the f th classified annual benefit for the std th stakeholder β is the risk tolerance level which is equal to 0 1 for both the cascade system and each individual reservoir implying that we accept the failure probability of hor of less than 10 and rwt f std is the risk based warning threshold varying with stakeholders and classes of annual benefit 2 5 identification of failure warning time fwt of hor using probability change point analysis technique 2 5 1 probability change point analysis technique the probability change point analysis technique krishnaiah and miao 1988 is a parametric statistical method to detect the change point it has two assumptions 1 the analyzed data is independent and 2 the targeted event follows a binominal distribution the basic principle of the probability change point analysis technique is that the probability of a targeted event is stable at p 1 but suddenly changes into p 2 in the following unknown time τ previous work shows the details of the probability change point analysis technique krishnaiah and miao 1988 liu et al 2010 the probability change point analysis technique has been used widely in the hydrologic field bărbulescu 2016 chen et al 2007 du et al 2015 jiang et al 2017 liu et al 2010 xu et al 2003 this method is popular for solving the problem of flood season segmentation jiang et al 2017 liu et al 2010 it determines the main flood period via the change point of flood disaster occurrences which can guide reservoir operators to dynamically control the flood limited water level in our study the probability change point analysis technique is used to identify fwt a change point when hor fails in the future fwt can inform how long hor can remain effective and when a new operating rule is needed under a changing environment the conceptual elements of the probability change point analysis technique are illustrated based on the practical problem including the 1 analysis object 2 targeted event 3 threshold 4 length of time series 5 time period and 6 size of sample set in each time period table 1 compares the conceptual illustrations in the flood season segmentation and the fwt identification of hor 2 5 2 fwt identification we use the probability change point analysis technique based on the cumulative sum estimation method to determine the change point in our study krishnaiah and miao 1988 liu et al 2010 fig 4 clarifies the procedures of fwt identification as follows note that the fwt identification is implemented for each stakeholder step 1 input the independent variables e v 1 e v j e v n and record the initial identification g 1 the term e v j is the number of failure occurrences of hor for the j th year and it is also assumed to follow a binomial distribution the equation of e v j is 9 e v j s 1 l λ j s where λ j s 1 b j s std fut rwt c b j s std 0 o t h e r w i s e is the binary function which returns a value of 1 failure occurrence or 0 no failure occurrence and l is the number of simulation runs step 2 identify the fwt using the cumulative sum estimation method krishnaiah and miao 1988 introduced the hypothesis test for a change point in probability the equation to detect the change point is 10 τ arg max n s e v j j s e v n where τ is the fwt of hor starting from 1 to n and sevj is the cumulative sum of failure occurrence from the first year to the j th year calculated by 11 se v j r 1 j e v r j 1 2 n step 3 calculate the average failure occurring probabilities for the pre failure period 1 2 τ 1 and the failure period τ τ 1 n from the following equation 12 p v 1 ζ v τ v τ v 1 j τ v 1 τ v 1 e v j v 1 2 where pv is the average failure occurring probability for the v th period in which v 1 and v 2 represent pre failure and failure periods of hor respectively τ 0 τ 1 τ 2 are equal to 1 τ n 1 respectively and ζ v is the sum of occurrences and non occurrences of hor failure which is equal to the number of simulation runs i e l step 4 the definition of fwt in the introduction section implies the critical condition of p 1 p 2 thus if the constraint of p 1 p 2 is satisfied then fwt y r b τ 1 is the yearly information of fwt where yrb is the starting year of the future period accordingly there are two segmentation periods namely the pre failure period and the failure period corresponding to the average failure occurring probabilities of hor of p 1 and p 2 respectively this result is denoted as solution 1 simplified as sl 1 step 5 if the constraint is not satisfied i e p 1 p 2 let τ τ and p 3 p 2 the period from τ to n is called the post failure period which has the average failure occurring probability of p 3 the data for the period from 1 to τ namely e v 1 e v j e v τ is used as the re analysis data and the value of g increases to 2 steps 2 3 are repeated to relocate the change point τ during the period from 1 to τ see the illustration in fig 4 step 6 if the constraint of p 1 p 2 is satisfied by step 5 then fwt y r b τ 1 is the yearly information of fwt in which τ is the relocated change point thus the entire future period is divided into pre failure failure and post failure periods their corresponding average failure occurring probabilities of hor are shown as p 1 p 2 and p 3 this result is denoted as sl 2 step 7 if p 1 p 2 by step 5 then fwt y r b is the yearly information of fwt it indicates that hor cannot be applied in the entire future period under a climatic changing scenario since the average failure occurring probability of hor decreases with three periods that last from 1 to τ 1 τ to τ 1 and τ to n this result is denoted as sl 3 therefore based on the aforementioned steps sl 1 sl 2 and sl 3 are good mediate and poor situations of fwt identification with the constraint of p 1 p 2 respectively sl 1 and sl 2 indicate that hor can be used in years until fwt but the difference is that the fwt of hor for sl 1 is later than that for sl 2 sl 3 indicates the worst result since its high failure of hor mainly in the near future period greatly undermines the application potential of hor in the long term future period 3 case study description 3 1 the xiluodu xld xiangjianba xjb three gorges tgr cascade reservoir system the yangtze river the longest river in asia flows for 6418 km from the qinghai tibet plateau where the reach is called the jinsha river eastward across southwest central and eastern china before emptying into the east china sea at shanghai fig 5 shows the xld xjb tgr cascade reservoir system that covers the upper mainstream of the yangtze river this system is selected as the case study and its characteristic parameter values are listed in table 2 in the cascade system the xld and the xjb are two reservoirs at the end of the jinsha river while their downstream reservoir tgr is an important project intercepting the upstream of the yangtze river streamflow of the interval basin between xjb and tgr collecting flows from the min river jialing river and wu river is more than twice the streamflow into the jinsha river the xld xjb tgr cascade reservoir system has the main functions of hydropower generation and flood control and it can supply most electricity for eastern and central cities in china 3 2 hydro meteorological data we collect the hydro meteorological data for both the jinsha river basin covering xld and xjb and the interval basin between xjb and tgr the time period is 10 days the historical period is from january 1 1956 to december 31 2011 historical daily climate data including precipitation and temperature is provided by the china meteorological data sharing service system http www cma gov cn we then transform the data to a 10 day time period historical 10 day streamflows of the two basins are collected by the changjiang water resources commission the future period starts on january 1 2012 and ends on december 31 2100 projections of climate change in precipitation and temperature are provided by the coupled model intercomparison project phase 5 cmip5 multi model database wang et al 2019 we use one representative concentration pathway rcp8 5 for climate projections in the future because rcp8 5 projects the most severe increase in greenhouse gas emissions among the four rcps and often is used to design conservative mitigation and adaptation strategies ipcc 2014 in addition future raw climate data is post processed to the regional scale using the bias correcting and spatial downscaling approach chen et al 2013 we select four gcms in this study including bnu esm canesm2 csiro mk3 6 0 and ipsl cm5a lr then for each gcm we feed its projected precipitations and potential evaporations into a two parameter monthly water balance model xiong and guo 1999 the model then generates future streamflows for the jinsha river basin and the interval basin between xjb and tgr the calibration and validation results for the hydrological model are shown in table s1 in the supplementary material 3 3 historical operating rules hor for the xld xjb tgr cascade reservoir system 3 3 1 objective eq 13 shows the objective function which maximizes the average annual hydropower generation of the cascade reservoir system 13 max b cas his 1 n j 1 n i 1 ts p o i j δ t i j where b cas his is the average annual hydropower generation in which the notation his indicates that historical streamflows are used as an input into the optimization model n and ts are the number of years and the number of time periods per year respectively δ t i j is the time period which is 10 days and p o i j is the total power output kw at the i th time period in the j th year which is calculated as 14 p o i j k 1 m p o i j k 15 p o i j k min γ k r i j k h i j k p o max k where p o i j k is power output of the k th reservoir at the i th time period in the j th year m is the number of reservoirs in the cascade system γ k is the hydropower generation efficiency of the k th reservoir r i j k is the reservoir release of the k th reservoir at the i th time period in the j th year h i j k is the effective water head of the k th reservoir which is a function of the reservoir storage and the tailrace water level and p o max k is the maximum power output of the k th reservoir which is constrained by turbine generator capacity 3 3 2 constraints the model constraints include water balance water storage capacity hydrological link between reservoirs reservoir release and power output limits 1 water balance equation 16 v i 1 j k v i j k i i j k r i j k δ t i j v 1 j 1 k v ts 1 j k i j k 2 hydrological link between reservoirs 17 i i j k δ i i j k r i j k 1 k 2 3 water storage capacity limit 18 v i min k v i j k v i max k i j k 4 reservoir release limit 19 r min k r i j k r max k i j k 5 power output limit 20 p o min k p o i j k p o max k i j k where v i j k is the reservoir storage of the k th reservoir at the i th time period in the j th year which is constrained by the minimum storage v i min k and the maximum storage v i max k i i j k and δ i i j k are the inflow and interval inflow of the k th reservoir at the i th time period in the j th year respectively r i j k is the release of the k th reservoir at the i th time period in the j th year ranging from the minimum release r min k to the maximum release r max k and p o i j k is the power output of the k th reservoir at the i th time period in the j th year constrained by the minimum output p o min k and the maximum power output p o max k 3 3 3 derivation of hor the parameterization simulation optimization approach has been used for the derivation of operating rules of a multi reservoir system oliveira and loucks 1997 it consists of the following steps koutsoyiannis and economou 2003 1 predefine the reservoir operating rules which generally depends on the study areas and the reservoir operator s preferences 2 optimize the parameters of reservoir operating rules 3 simulate the operation of the reservoir system based on given parameter values of the reservoir operating rules and 4 determine the optimal reservoir operating rules via evaluating the performance measure of the system in this study we use the parameterization simulation optimization approach with the genetic algorithm to derive hor for the cascade reservoir system a linear decision rule is assumed for the hor for the cascade reservoir system karamouz et al 1992 liu et al 2014 which is described by the following equation 21 r i j k a i k v i j k δ t i j i i j k b i k i j k where a i k and b i k are parameters of hor for the k th reservoir at the i th time period r i j k is the reservoir release to be determined for the k th reservoir v i j k is the storage of the k th reservoir at the i th time period in the j th year and v i j k δ t i j i i j k is the available water for the k th reservoir with the unit of discharge the ranges of parameters a i k and b i k are set to be 0 200 and 85000 40000 for xld xjb and tgr respectively 4 results and discussion 4 1 analysis of four climate scenarios fig 6 shows the relative change of multi year average precipitation temperature and streamflow from historical to future periods the selected four gcms reflect different possible future climate situations specifically csiro mk3 6 0 is the scenario where the climate environment becomes simultaneously dry for both the jinsha river basin and the interval basin between xjb and tgr moreover the simultaneously wet climate scenario can be seen in canesm2 bnu esm predicts increasing streamflow into xld and xjb but decreasing interval streamflow into tgr while the opposite is estimated by ipsl cm5a lr in terms of overall streamflow into the cascade system the rank of hydrological conditions from the driest to the wettest is csiro mk3 6 0 bnu esm ipsl cm5a lr and canesm2 the gcm based streamflow projection of each climate scenario then is selected as the baseline data for stochastic simulation using the multivariate copula approach fig s1 in the supplementary material shows boxplots of statistics mean flow standard derivation sd and coefficient of skewness cs of baseline and simulated streamflows under four future climate scenarios it reveals that the statistics of all simulations fall within the boxplots for most of the 10 day periods furthermore it indicates that the stochastically simulated series can be used to represent the selected climate scenario due to statistical characteristics similar to the baseline data 4 2 the pdf of classified annual benefit fig 7 a shows the results of different pdf estimations calculated from the aic and fuzzy optimum methods it shows that the normal distribution is the most appropriate distribution for the annual benefit of hydropower generation since it has the maximum weighted average membership degree of all stakeholders under each climate scenario moreover fig 7 b indicates that the normal distribution outperforms other selected distributions for the cascade system xld and tgr under each climate scenario the normal distribution is also the best choice for xjb under csiro mk3 6 0 and ipsl cm5a lr however relative to xld and tgr the best selection of annual benefit distribution for xjb easily is affected by the given climate scenario this implies that xjb with smaller reservoir storage capacity is less adaptive to the changing environment than xld and tgr with larger reservoir storage capacities which is consistent with the investigation by ehsani et al 2017 table 3 lists pdf parameters of the normal distribution for each class of annual benefit for xld xjb tgr and the cascade system under the four climate scenarios in which the parameters θ 1 and θ 2 represent the mean and the standard derivation of annual hydropower generation respectively as this table shows the mean θ 1 gradually decreases from class i wet to class iv dry for all stakeholders under each climate scenario this demonstrates the rationality of the classification method proposed in section 2 2 moreover the rank of the mean θ 1 among four climate scenarios is consistent with the rank of four gcm based streamflow projections in section 4 1 the standard derivations θ 2 however are greater in the distributions of classes i and iv than in classes ii and iii this is because extremely wet dry streamflow leads to the largest smallest values of annual benefit in class i iv 4 3 results of rwt based on the parameters of the normal distribution for classified annual benefit and the definition of rwt shown in eq 8 table 4 presents the results of rwt for each stakeholder of the xld xjb tgr cascade reservoir system under the four climate scenarios as table 4 shows rwt significantly decreases from class i wet to class iv dry for all stakeholders under each climate scenario additionally rwt increases with increasing gcm based streamflow projections specifically the rwt for xld xjb depends on the streamflow of the jinsha river basin while the rwt for the tgr cascade system relies on the total streamflow into the cascade system this indicates that the evaluation benchmark of whether hor fails should be determined in light of the annual streamflow condition and the climatic environment moreover the sum of rwts for xld xjb and tgr is less than the rwt for the cascade system this is because the rwt for the individual reservoir focuses on the risk of the reservoir itself while the rwt for the cascade system implies that at least one reservoir in the cascade system is at risk overall rwt for each stakeholder becomes smaller in the drier annual streamflow condition and under a more adverse climate changing environment thus the classified rwt can avoid the false failure identification of hor 4 4 the fwt for the xld xjb tgr cascade system the procedures to identify fwt described in section 2 5 2 are implemented for each stakeholder under each climate scenario the data used in the first step is assumed to be independent and we test this assumption based on the lag 1 autocorrelation coefficient additionally a chi squared goodness of test is performed to test the assumption that the failure occurrence of hor follows the binomial distribution we use χ 0 95 2 4 9 488 as the benchmark table 5 presents the results of the autocorrelation coefficient for independence and χ 2 for binomial distribution during pre failure failure and post failure periods it indicates that the assumptions of independence and binomial distribution are acceptable for all three periods table 5 also compares the fwts for the cascade system xld xjb and tgr under the four climate scenarios the results of fwt indicate that hor remains effective in at least another 10 years for all stakeholders under all climate scenarios the fwts are presented by sl 1 good situation and sl 2 mediate situation the sl 2 for xld and xjb exists in the scenarios where streamflow into the jinsha river basin decreases csiro mk3 6 0 and ipsl cm5a lr moreover sl 2 for the cascade system occurs in the condition where the streamflow decreases in both the jinsha river basin and the interval basin between xjb and tgr csiro mk3 6 0 the applicability of the probability change point analysis technique is demonstrated by the successful identification of fwt for all stakeholders under all climate scenarios in table 5 we also can see that the fwt of hor for the cascade system will occur significantly earlier when the streamflow of the jinsha river basin decreases in the future comparing csiro mk3 6 0 ipsl cm5a lr with bnu esm canesm2 furthermore the failure of hor for the cascade system will accelerate if the streamflows decrease alternately for the jinsha river basin and the interval basin between xjb and tgr bnu esm vs canesm2 csiro mk3 6 0 vs ipsl cm5a lr since hor is derived based on the joint operation of the xld xjb tgr cascade system we wonder whether the failure of each individual reservoir may instantly affect the failure of the cascade system from table 5 we see that 1 if the earliest failure warning occurs in tgr or simultaneously in two reservoirs of the jinsha river basin say xld and xjb the instant failure impact on the cascade system is evident this can be observed for bnu esm and canesm2 and 2 if the earliest fwt only happens in xjb the failure response in the cascade system is delayed this can be seen for csiro mk3 6 0 and ipsl cm5a lr hence considering the characteristics of the three reservoirs in table 2 we infer that if the first failure of hor occurs in the reservoir with the larger storage capacity i e xld or tgr the failure of the cascade system will accelerate fig 8 shows the failure occurrance probabilities during pre failure failure and post failure periods for each stakeholder under the four climate scenarios previous research on flood season segmentation indicates that flood disaster events seldom occur in the days of the pre flood season and the post flood season but mainly happen in the days of the flood season jiang et al 2017 liu et al 2010 however regarding the issue of fwt identification of hor in this study the occurrence of hor s failure exists in all years of the future period and the failure period has the highest average probability of failure occurrence this could arise from the fact that a flood disaster event is defined based on the same peak over threshold while the definition of the failure occurrence event of hor is subject to the classified rwt moreover for sl 2 mediate situation even though the average failure probability for the post failure period could be lower than that of the pre failure period such as xld and xjb under ipsl cm5a lr it is suggested that hor be replaced before fwt this is because the high frequent failures of hor in the failure period will greatly undermine the application potential of hor in the following time period similar to explanations of atp haasnoot et al 2015 kwadijk et al 2010 5 conclusions in this paper we proposed a methodology to determine the time tipping point where the historical operating rules hor of the benefit oriented reservoir should be replaced by adaptation alternatives under climate change the xld xjb tgr cascade reservoir system in the yangtze river of china was used as a case study we used bnu esm canesm2 csiro mk3 6 0 and ipsl cm5a lr to produce future climate scenarios we then employed a multivariate copula technique to generate equally likely streamflows based on the gcm projected streamflows the augmented streamflows were used to determine the annual benefits under the operation of hor we further classified annual benefit for each individual reservoir as well as the cascade system using the hydrological year category hyc furthermore we selected the most appropriate pdf of the classified annual benefit via the aic indicator and a multi criteria decision making method accordingly we incorporated the risk tolerance level in the pdf of the classified annual benefit to calculate the risk based warning threshold rwt finally we adopted the probability change point analysis technique to identify the failure warning time fwt of hor under climate change the main conclusions of this paper are summarized as follows 1 the normal distribution is most appropriate to describe the distribution of annual hydropower generation regardless of classes of annual benefit stakeholders and climate scenarios 2 the rwt for each stakeholder becomes smaller in a drier future climatic environment as well as in a drier annual hydrological condition under a specific climate scenario this further suggests the classified rwt should be used in fwt identification 3 the resulting fwts based on the probability change point analysis technique indicate that the time tipping point where hor should be replaced by new adaptation alternatives is at least 10 years away under four climate scenarios 4 the fwt of hor will be earlier with the decreasing streamflow in the jinsha river basin or the opposite streamflow changes of upstream and interval basins 5 the failure impact on the cascade system will accelerate when the first failure performance of hor occurs in the reservoir with larger storage capacity i e xld or tgr credit authorship contribution statement wei zhang conceptualization methodology software data curation writing original draft visualization investigation jinshu li methodology writing review editing validation pan liu conceptualization methodology writing review editing validation xiaohui lei data curation resources jie chen data curation william w g yeh conceptualization methodology writing review editing validation supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was supported by the china scholarship council 201806270120 an aecom endowment the national natural science foundation of china no 52109011 and the china three gorges corporation research project contract no 202103044 the data used in this paper can be requested by contacting the first author wei zhang at zhang wei47 ctg com cn conflict of interest statement the authors declare that they have no conflicts of interest appendix a supplementary material supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127111 appendix a supplementary material the following are the supplementary data to this article supplementary data 1 
3857,flow velocity source concentration or initial condition is treated as constant in previous advection diffusion reaction adr analytical models for subsurface reactive transport such parameters may vary temporally and spatially and therefore constants limit the application of adr models in this study an adr model is developed considering transient flow fields time dependent source concentrations and arbitrary initial conditions a general analytical solution is derived by green s function method where the flow velocity source concentration and initial condition are described by arbitrary continuous functions the specific solutions are presented under three types of flow velocity models represented by the linear exponential and trigonometric functions the new analytical models of this study are the extensions of many previous ones and the robustness is tested by the laboratory controlled experimental data when compared with previous analytical solutions findings from this study indicate that flow velocity initial conditions and source concentrations produce profoundly different model results of subsurface reactive transport indicating that the transient properties of these model parameters should not be treated as constant similar to many previous analytical solutions the limitation of the new analytical model is to use the temporally dependent model to approximate the spatiotemporal variation of flow velocity to test the influence of such assumptions on breakthrough curves btcs the finite element solution of the transient subsurface flow and reactive transport models is employed results show that the temporally dependent model could be used to approximate the spatiotemporally dependent velocity variation when the hydraulic diffusivity is greater than 5 10 5 m2d 1 sensitivity analysis demonstrates that the most sensitive parameter on the output btcs is the retardation factor followed by parameters related to chemical reactions dispersion flow velocity and the source concentration keywords solute transport variable flow velocity arbitrary initial conditions analytical solutions 1 introduction the advection diffusion reaction adr equation has been widely used to simulate subsurface reactive transport in hydrogeology and environmental engineering due to a high computation demand and a high likelihood of numerical errors from numerical solutions e g numerical dispersion and or artificial oscillation particularly in advection dominated scenarios analytical solutions of adr models are developed alternatively meanwhile less computation is also one of the advantages for the analytical models and it is easy to be implemented by engineers a complete adr model of subsurface contaminant transport is mainly composed of the advection dispersion and reaction terms it is constrained by the source concentration boundary conditions and initial conditions for practical problems all these terms might be a function of time and or space however some of them were treated as constants in previous analytical adr models as summarized in table s1 of supplementary materials due to boundary conditions aquifer heterogeneity including the variation of permeability and porosity and spatiotemporally dependent std recharge and or discharge they may cause flow velocity u to be a std parameter which results in the adr equation with the std advection to date many analytical solutions of adr models have been developed with the std advection such as sanskrityayn et al 2017 2018 sanskrityayn and kumar 2016 singh et al 2015 2017 singh and chatterjee 2017 singh and das 2015 yadav et al 2011 and chaudhary et al 2020 however singh and chatterjee 2017 yadav et al 2011 and singh et al 2017 assumed that the initial condition was constant over space and such assumption could not be satisfied when the study area has a long pollution history sanskrityayn et al 2017 sanskrityayn and kumar 2016 and sanskrityayn et al 2018 did not consider the reaction terms in the adr model the analytical model of chaudhary et al 2020 seems closer to reality than the others but it contained two assumptions that u linearly changed with space and the dispersion coefficient dl changed with u2 this flow field generally occurs in the region around the pumping or injection well meanwhile the linear relationship between d l and u seems more common and robust regardless of use in the analytical solutions barry and sposito 1989 chaudhary et al 2020 or in numerical solutions like modflow mt3dms zheng et al 2012 and feflow trefry and muffels 2007 in essence the current analytical models with the std flow velocity could not be used to describe the subsurface reactive transport with transient flow field reactions time dependent source concentration and arbitrary initial conditions simultaneously alternatively many models assumed that the flow velocity was only spatially dependent bharati et al 2017 2018 neelz 2006 suk 2016 or temporally dependent td such as basha and elhabel 1993 bharati et al 2017 2018 2019 jia et al 2013 kumar et al 2009 li et al 2018 2020 singh et al 2009 su et al 2005 yadava et al 1990 yates 1990 zoppou and knight 1997 however these models believed that the initial concentration was constant chaudhary et al 2020 singh et al 2015 extended these models with non uniform initial conditions but the chemical reaction rate was assumed to linearly change with u in their analytical models such treatment makes the derivation of the analytical solution easier using the laplace transformation technique while the robustness of the model has not been tested recently suk 2016 developed a generalized semi analytical solution with temporally variable transport and decay coefficients using the generalized integral transform technique this model is an extension of many previous models however the mathematical expression was complex and it had large computations since the models contained infinite series meanwhile the td flow velocity was described by a linear function in fact besides the linear function the exponential and trigonometric functions have been also widely used to describe the advection variation with time in summary the current adr analytical models still have limitations and they will be extended in this study specifically an adr model that considers transient flow fields time dependent source concentration reactions and arbitrary initial conditions are developed a general analytical solution is derived by green s function method the transient flow field is assumed to be temporally dependent the specific solutions are presented under three types of flow velocity models respectively represented by the linear exponential and trigonometric functions the assumption involved in the description of the transient flow field will be tested by numerical modelling and laboratory controlled experimental data based on the new analytical models sensitivity analysis is conducted to investigate the influence of fundamental processes on the subsurface reactive transport such as the advection dispersion reaction terms the source concentration and initial conditions the new analytical models of this study are the extensions of many previous ones which could improve the description of the subsurface reactive transport processes 2 problem statement and analytical solution 2 1 mathematical model the schematic diagram of reactive transport model with a transient flow field time dependent source and arbitrary initial conditions is illustrated in fig 1 considering the dispersion advection and chemical reaction under the transient flow field the governing equation of solute transport is chaudhary et al 2020 singh et al 2015 1 r c t x d l x t c x u x t c λ c x 0 t 0 where c is concentration ml 3 t is time t x bis distance l u is flow velocity lt 1 d l is dispersion coefficient l2t 1 and d l α l u α l is aquifer dispersivity l r is retardation factor dimensionless and λ is first order reaction rate t 1 which could also describe the first order biodegradation and radioactive decay the initial condition of the mathematical model is 2 c x t t 0 c i a x where a x represents an arbitrary function of spatial position along the dimension and c i is a positive constant ml 3 when a x 1 the initial condition becomes uniform over space the boundary conditions are 3a c x t x 0 c 0 b t 3b c x t x 0 where c 0 is initial source concentration ml 3 b t represents a function of time and b t t 0 1 in this study the source of solute or contaminates is assumed to be in the origin of the coordinate system in this study the td dispersion and advection are considered kumar 1983 li et al 2018 4a u t u 0 φ t 4b d l t d 0 φ t where u 0 is initial velocity lt 1 d 0 is initial dispersion coefficient l2t 1 and d 0 α l u 0 φ t is an arbitrary function of time and φ t t 0 1 substituting eq 4 into eq 1 yields 5 c t d 0 φ t 2 c x 2 u 0 φ t c x λ c where d 0 r d 0 u 0 r u 0 and λ r λ eqs 2 5 formulate the mathematical model describing the reactive transport under a transient flow field the limitation of the new model is to use the td model to approximate the spatiotemporal variation of flow velocity which is included in the dispersion and advection terms although this assumption has been also widely used in previous studies kumar 1983 selvadurai 2004 singh et al 2014 2020 the performance of the model with the std flow velocity has not been investigated before and it will be tested in section 4 1 2 2 solution under arbitrary mathematical form of u c x 0 and c 0 t in order to derive an analytical solution with arbitrary flow velocity and initial concentration conditions two new variables are introduced as follows 6 t 0 t φ t d t 7 c c e u 0 u 0 t 2 x 4 d 0 λ t substituting eqs 6 7 into eqs 2 5 one has 8a c t d 0 2 c x 2 8b c x t t 0 c i e u 0 x 2 d 0 a x 8c c x t x 0 c 0 e u 0 2 t 4 d 0 e λ f t b f t 8d c x t x 0 where f t is the expression of t in the time variable t eqs 8a 8d become a one dimensional 1d heat conduction problem and green s function method gfm will be employed to derive the analytical solution the derivation of the analytical solution of eq 8a 8d could be seen in section s1 of supplementary materials 9 c c i 0 a x 2 π d 0 t e x x 2 4 d 0 t e x x 2 4 d 0 t e u 0 x 2 d 0 d x c 0 0 t x 2 π d 0 t t 3 e x 2 4 d 0 t t λ f t u 0 2 t 4 d 0 b f t d t substituting eq 9 into eq 7 one can obtain the analytical solution of eqs 1 5 10 c c e u 0 2 x u 0 t 4 d 0 λ t 2 3 special case in section 2 2 a general analytical solution of subsurface reactive transport is derived considering an arbitrary transient flow field time dependent source concentration reactions and arbitrary initial conditions this solution is an extension of many previous ones for instance when φ t e a t b t 1 e b t and a x 1 the newly derived model reduces to singh et al 2008 furthermore when a x 0 b t 1 and φ t u 1 u 0 u 0 u 1 e a t u 0 the new model is the same as that of li et al 2018 another example is when b t e x p b t and a x e x p s e c c x r eqs 1 5 become chaudhary et al 2020 s model as the flow velocity in the advection term of the adr model is computed from darcy s law it cannot be simply expressed as a continuous function therefore many different functions have been employed to approximate the flow velocity variation as shown in the second column of table s1 it is primarily comprised of a linear function by kumar 1983 11 u t u 0 1 a t an exponential function by das et al 2018 li et al 2020 singh et al 2008 singh and das 2015 12 u t u 1 u 0 u 1 e a t and a trigonometric function by singh et al 2009 13 u t u 0 1 s i n a t where a is a power index dimensionless b t 1 and c l 1 are constants and u 0 lt 1 and u 1 lt 1 are the initial flow velocity and the flow velocity at infinite time respectively in this section analytical solutions will be derived with three types of flow velocities the initial condition and the boundary conditions will take the arbitrary forms expressed by eq 2 and eq 3a respectively 2 3 1 flow velocity linearly changing with time eq 11 substituting eq 11 into eq 4a and eq 6 yields 14 t 0 t φ t d t t a t 2 2 where t can be computed from eq 14 15 t 1 1 2 a t a according to eq 6 or eq 14 t is zero if t 0 substituting eqs 14 15 into eq 10 the analytical solution of reactive transport with flow velocity linearly changing with time is 16 c c i e u 0 2 x u 0 t a t 2 2 4 d 0 λ t 0 a x 2 π d 0 t a t 2 2 e x x 2 4 d 0 t a t 2 2 e x x 2 4 d 0 t a t 2 2 e u 0 x 2 d 0 d x c 0 0 t a t 2 2 x 2 π d 0 t a t 2 2 t 3 e x 2 4 d 0 t a t 2 2 t λ 1 1 2 a t a u 0 2 t 4 d 0 b 1 1 2 a t a d t 2 3 2 flow velocity exponentially changing with time eq 12 substituting eq 12 into eq 4a and eq 6 yields 17 t 0 t φ t d t u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 where t can be obtained from eq 17 18 t u 1 u 0 a u 0 t u 1 p r o d u c t l o g u 0 u 1 e a u 0 u 0 u 1 a u 0 t u 1 1 u 1 a u 1 in which productlog x represents the inverse function of x e x on the interval 1 e substituting eqs 17 18 into eq 10 the analytical solution of reactive transport with flow velocity exponentially changing with time becomes 19 c c i e x p u 0 2 x u 0 u 1 u 0 t u 0 u 1 e a t n u 0 u 0 u 1 n u 0 4 d 0 λ t 0 a x 2 π d 0 u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 e x p x x 2 4 d 0 u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 e x p x x 2 4 d 0 u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 e x p u 0 x 2 d 0 d x c 0 0 u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 x 2 π d 0 u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 t 3 e x p x 2 4 d 0 u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 t b u 1 u 0 a u 0 t u 1 p r o d u c t l o g u 0 u 1 e x p a u 0 u 0 u 1 a u 0 t u 1 1 u 1 a u 1 e x p u 1 u 0 a u 0 t u 1 p r o d u c t l o g u 0 u 1 e x p a u 0 u 0 u 1 a u 0 t u 1 1 u 1 a u 1 λ e x p u 0 2 t 4 d 0 d t 2 3 3 flow velocity trigonometrically changing with time eq 13 substituting eq 13 into eq 4a and eq 6 one has 20 t 0 t φ t d t 1 a c o s a t t 1 a to simplify the solution of the model the source concentration is assumed as 21 c 0 t c 0 the initial condition is still in the form of eq 2 substituting eqs 20 21 into eq 10 the analytical solution of reactive transport with flow velocity trigonometrically changing with time becomes 22 c c i e x p u 0 2 x u 0 1 a c o s a t t 1 a 4 d 0 e λ t 0 a x 2 π d 0 1 a c o s a t t 1 a e x p x x 2 4 d 0 1 a c o s a t t 1 a e x p x x 2 4 d 0 1 a c o s a t t 1 a e x p u 0 x 2 d 0 d x c 0 0 1 a c o s a t t 1 a x 2 π d 0 1 a c o s a t t 1 a t 3 e x p x 2 4 d 0 1 a c o s a t t 1 a t e x p u 0 2 t 4 d 0 d t 3 results 3 1 comparison with previous studies to test the new solution derived by green s function method the previous analytical models are employed to serve as benchmarks as shown in fig 2 a 2c singh et al 2008 used the laplace transformation technique to derive the analytical solution with assumptions that the velocity variation followed eq 12 when u 1 0 md 1 as shown in table 1 by setting a x 1 b t 1 e b t r 1 0 λ 0 the solution of eq 19 reduces to the model of singh et al 2008 the other parameters used in this figure are a 1 10 3 b 1 10 3 d 1 c 0 10 gm 3 c i 2 gm 3 d 0 0 1 m2d 1 α l 1 0 m and u 0 0 1 md 1 the comparison between eq 19 and singh et al 2008 as shown in fig 2a fig 2b shows the comparison between eq 19 and li et al 2018 who employed the laplace transformation technique to derive the analytical solution with assumptions that the velocity variation followed eq 12 the initial concentration was zero and the source concentration was constant by setting a x 0 b t 1 r 1 and λ 0 the solution of eq 19 reduces to li et al 2018 the other parameters are assigned default values a 1 0 10 3 c 0 10 0 gm 3 c i 0 d 0 0 1 m2d 1 α l 1 0 m u 0 0 1 md 1 and u 1 0 15 md 1 fig 2c shows the comparison between eq 22 and the analytical model by singh et al 2009 who employed the laplace transformation technique to derive the analytical solution using the trigonometric function of eq 13 to describe the td flow velocity by setting a x 0 b t 1 r 1 λ 0 the solution of eq 22 reduces to singh et al 2009 the other parameters used in this figure are the same ones used in fig 2b fig 2a 2c show that the new solutions of this study agree with the solutions obtained by laplace transformation techniques in previous studies under the special cases implying that green s function method performs well in deriving the adr solutions analytically with transient flow field time dependent source concentration and arbitrary initial condition which successfully encompasses all special cases 3 2 effects of initial conditions on reactive transport as shown in table s1 the laplace transformation technique has been widely used to derive the analytical solution of reactive transport however this method requires that the initial concentration distribution over space has to be uniform e g a x 0 or a x 1 in reality the initial concentration always varies with spatial locations especially when the origin of the coordinate system is located at the contaminant source center to date two types of functions have been widely used 23a a x e c x 23b a x 1 c x where c is a constant l 1 which could be estimated by interpreting the observed concentration of the contaminant source eq 23a and eq 23b have been used for initial conditions by singh et al 2014 2015 respectively fig 3 shows the btc variations affected by four different types of initial conditions a x 0 represents an aquifer that is initially free of solutes or contaminants in the case where a x 1 the initial concentration distribution of the solute is uniform over space and it is used to describe background values the other two types of initial conditions represent scenarios where the solute concentration decays over space from the origin of the coordinate system the flow velocity is described by eq 12 and b t 1 the values assigned to the other parameters are as follows c 0 10 0 gm 3 c i 2 0 gm 3 a 1 0 10 3 c 3 0 10 2 m 1 u 0 0 1 md 1 u 1 0 15 md 1 d 0 0 1 m2d 1 α l 1 0 m r 1 0 and λ 1 0 10 3 d 1 this figure shows that the influence of the initial condition on the btc values is important to the magnitude of btc during the early time span of the model run and should be carefully modeled when the time span of interest is in the early stages such influence becomes smaller as time increases this is because the model becomes independent of the initial condition when the transport model is at a steady state 3 3 effect of source concentration on reactive transport in this study the origin of the coordinate system is assumed to be located at the center of the contaminant source therefore variations of the source concentration are treated as the boundary condition to investigate the effect of the source concentration on the reactive transport three types of the functions are implemented to describe the concentration variations 24a b t 1 24b b t e b t 24c b t s i n b t where b is a constant t 1 eq 24a eq 24b and eq 24c were used to describe the source concentration by li et al 2018 logan 1996 yadava et al 1990 respectively eq 24a represents constant source concentration fig 4 shows the btcs for different boundary conditions where the flow velocity is described by eq 12 the uniform concentration of a x 1 is applied for initial concentration the values of other parameters used in this case are the same as the values used in section 3 2 the high variation in btcs evolution indicates that source concentration could significantly affect the subsurface reactive transport 4 discussions 4 1 validation of the assumption included in the new analytical models as mentioned in introduction flow velocity is a std parameter which is generally computed from hydraulic heads based on darcy s law because the velocity variation is complex it cannot be described by any specific continuous function exactly instead the linear function of eq 11 the exponential function of eq 12 and the trigonometric function of eq 13 are preferred to approximate it when deriving analytical solutions assuming that the flow velocity is only temporally dependent but spatially independent therefore it is necessary to test the limitations of the analytical models using the td u to approximate the std u compared with analytical models the numeral method is more powerful in dealing with mathematical models with complex boundary conditions transient flow fields time dependent source concentration reactions and arbitrary initial conditions therefore numeral modeling has been widely used to test the assumptions involved in analytical models such as chaudhary et al 2020 goode and konikow 1990 and so on although the numerical errors are not easily avoided in numeral modeling they can be decreased by adjusting the std discretization of the grid system as the analytical solution of adr models with std u time dependent source concentration reactions and arbitrary initial conditions arenot available numerical modeling will be employed to test the assumption included in the advection term of eq 5 the conceptual model as shown in fig 5 represents the subsurface flow and reactive transport in a confined alluvial aquifer located between two parallel rivers the hydraulic head at the boundary to the right is constant while the hydraulic head at the boundary to the left increases exponentially with time this conceptual model shows the scenario in which the water level increases in a river system due to the discharging of upstream dammed reservoirs huang et al 2020 lin et al 2019 the mathematical model of subsurface flow and reactive transport in a confined alluvial aquifer is shown in section s2 1 of supplementary materials as the adr analytical model cannot completely consider the variation of the transient flow field we first have to determine the relationship between u and t when establishing the conceptual model then the model of u is substituted into eq 5 for the prediction of the subsurface reactive transport in this case the relationship between u and t is exponential as a result the coefficients of advection and dispersion are not linear such nonlinear coefficients only appear in the analytical model but not in the numeral modelling as they will be treated in another way specifically the mathematical model of subsurface flow eqs s2 1 s2 3 is first solved to produce the std flow velocity of cells in the grid system of numerical modelling then the computed u in the cells is directly substituted to the reactive transport model to compute the solute concentration in the aquifer it is not necessary to find the relationship between u and t in this study the comsol multiphysics software package will be employed to implement numerical modelling such numeral modelling could also be conducted by other software packages like tough borgia et al 2011 zhou et al 2004 modflow mt3dms langevin and guo 2006 prommer et al 2003 and so on as numeral solutions are approximating solutions of mathematical models numerical errors are highly dependent on spatiotemporal discretization a spatial grid system is designed based on that of the analytical solutions as shown in figure s1 detailed information on the numerical modelling procedure is found in section s2 2 of supplementary materials as the aquifer storage μ s is more sensitive to the variations in flow velocity than other parameters three sets of values are implemented μ s 1 10 2 5 10 3 and 1 10 3 respectively the other parameters used in this case are aquifer length l 1000 m aquifer thickness m 50 m hydraulic conductivity k x 10 md 1 c 0 10 gm 3 c i 2 gm 3 a x e c x b t e b t a 5 10 3 b 1 10 3 d 1 c 3 10 2 m 1 d 0 0 1 m2d 1 u 0 0 1 md 1 u 1 0 15 md 1 α l 1 0 m r 1 0 and λ 1 0 10 3 d 1 the contour maps of the hydraulic head and the concentration can be found in figures s2 and s3 of supplementary materials to test the assumption with respect to u in the analytical models we employ the function of the td model to best fit the std u computed by comsol fig 6 a 6c show the goodness of fit of the flow velocity where σ is hydraulic diffusivity l2t 1 and σ km μ s in the legend comsol represents the numerical modelled flow velocity eq 12 is chosen for the goodness of fit analysis because the hydraulic head variation in the left boundary has a similar form according to darcy s law the average flow velocity u over the entire aquifer is 25 u t k xx h x 0 t h x l t l u 1 u 0 u 1 e a t where eq 25 has the same mathematical expression with eq 12 assuming that the values of u 0 and u 1 are given there is only one free parameter a during the simulation in eq 25 if the estimated a is equal to the input value a in the comsol model and the simulation results of the computed velocity are appropriate it implies that the assumption of the flow velocity variation also performs well in modeling the solute transport comparing fig 6a 6c two interesting observations are found first the computed flow velocity by comsol is spatiotemporally dependent when hydraulic diffusivity is small as shown in fig 6a with increasing σ the spatial variation of the flow velocity decreases and can be ignored when σ 5 10 5 m2d 1 second the goodness of fit of the flow velocity r 0 2 improves with increasing σ the differences between the flow velocity by comsol and fitted flow velocity by eq 12 are negligible and a a fig 7 a 7c compare btcs by the comsol model and the analytical solutions for different values of σ results indicate that the difference between two models decreases with increasing hydraulic diffusivity the difference disappears when σ 5 10 5 m2d 1 therefore the td model of flow velocity performs well when σ is larger than 5 10 5 m2d 1 in summary figs 6 7 show that the difference between the td and std models diminishes at high hydraulic diffusivity which is greater than 5 10 5 m2d 1 this value is significantly high for natural flow systems but is possible for instance it is 4 47 10 5 1 95 10 6 m2d 1 in ha et al 2007 2 16 10 6 m2d 1 in shih 1999 3 02 10 7 m2d 1 in shih and lin 2004 2 16 10 6 m2d 1 in shih 1999 1 73 10 5 1 04 10 6 m2d 1 in pacheco and van der weijden 2014 1 72 10 4 8 64 10 7 m2d 1 in guglielmi et al 2015 4 3 10 5 1 3 10 6 m2d 1 in pacheco et al 2015 5 72 10 8 m2d 1 in hu and jiao 2016 6 92 10 6 m2d 1 in shih 2018 and so on the lithology of the aquifer could be gravel and sand clay or shale the detailed information has been listed in table s2 of supplementary materials 4 2 laboratory controlled experiment to test the new model of this study the experimental data of subsurface reactive transport by li et al 2021 will be employed the experiment was conducted in the laboratory under a transient flow field with time dependent source concentration and uniform initial condition however the experiment of li et al 2021 was used to investigate the reactive transport in the aquifer aquitard system and it seems that the experimental data could not be interpreted by the new analytical model of this study due to the following two reasons firstly the solute might enter the aquitard from the adjacent aquifer which could not be considered in the new analytical solutions secondly the reactive transport might be two dimensional 2d while it is assumed to be one dimensional in the analytical solution of this study li et al 2021 employed a 2d model to interpret the experimental data this 2d model considered the transient flow field time dependent source concentration and uniform initial condition but ignored the retardation and reaction e g r 1 0 and λ 0 here we infer that a the mass entering the aquitard is small and could be negligible when the experimental time is short enough such inference could be seen in figures s4a 4b where the concentration of the solute is zero in the aquitard b the reactive transport in the aquifer is one dimensional because of greater discrepancy of permeability between the aquifer and aquitard if these two inferences are true the new model could be used to interpret the experimental data by li et al 2021 then we compare the model of li et al 2021 and this study under the same parameters used in two models u 0 28 73 md 1 u 1 2 85 md 1 a 0 1135 c 0 10 gl 1 c i 0 a x 1 b t 1 e b t b 36 d 1 d 0 1 29 m2d 1 α l 0 045 m r 1 0 and λ 0 the parameters related to the flow velocity are estimated by best fitting the observed flow velocity as shown in fig 8 and the goodness of fit r 0 2 is 0 99 figures s4a 4b shows that btcs are almost the same for the two models demonstrating that the two inferences are reasonable and the new analytical model of this study can be used to interpret the experimental data figures s4a s4b show that the fitness of the observed btc by li et al 2021 is not very good probably because their model did not include the retardation and reaction which could be considered in the new analytical model of this study then we use the new analytical model to reinterpret the experimental data and the estimated parameters are r 1 6 and λ 1 0 10 3 d 1 these two parameters represent the absorption desorption processes and chemical reactions the other parameters are the same as one used in li et al 2021 the errors between the computed and observed btcs are shown in table 1 and errors are computed by moriasi et al 2007 26 rsr i 1 n c i obs c i com 2 i 1 n c i obs c mean 2 where c i obs is the i th observed value c i com is the i th computed value c mean is the mean of the observed data and n is the total number of observations a smaller rsr value indicates the better performance of the model fig 9 a 9b show the comparison between computed and observed btcs and the results of li et al 2021 are also included for the purpose of comparison fig 9a 9b and table 1 demonstrate that the new model performs better than li et al 2021 in the laboratory controlled experiment by li et al 2021 the reactive transport in the aquifer is one dimensional absorption desorption processes could not be ignored 4 3 sensitivity analysis the analytical models of this study contain several parameters such as α l a b c λ r u 0 u 1 in the solution of eq 12 high parameterization may lead to uncertainties including measurement error absence of information or inappropriate usage due to poor understanding of transport mechanisms jia et al 2013 sanskrityayn et al 2017 therefore it is necessary to conduct a sensitivity analysis to investigate the influence of the input parameters on btcs of the analytical models in this study the model of the sensitivity analysis is based on jiao and rushton 1995 wang et al 2015 27 s c i j i j o i i j δ i j o i i j δ i j where s c i j is the sensitivity coefficient o i is the output function of the model δ i j is a small increment which is chosen as 10 2 i j in this study i is i th time for o i j is j th parameter of the model in this study o i is the dimensionless concentration c the negative values of s c i j represent negative correlation and the positive values of s c i j represent positive correlation the greater absolute values of s c i j imply a greater influence of that parameter fig 10 shows the sensitivity of eq 12 to the parameters α l a b c λ r u 0 u 1 over the course of the btc the parameters used in this case are the same as the parameters used in figure s1 the btc is also included in this figure for the purpose of comparison several interesting observations were obtained from the simulation results firstly the most sensitive parameter is the retardation factor r and the parameters related to the chemical reactions λ model results are also sensitive to dispersion α l flow velocity u 0 u 1 and a and the source concentration b secondly s c i j is positive for the parameters involved in the flow velocity and is negative for b and c negative s c i j means that increasing parameter values decreases output btc values while positive s c i j means that increasing parameter values increases output btc values as for α l the s c i j first increases with time from zero decreases at t 1 10 2 and increases again at t 1 10 2 2 until s c i j becomes zero the configuration of the r curve is opposite to that of α l thirdly s c i j approaches zero for all parameters except c when the time is less than 100 days this is because the solute concentration of btc is mainly dependent on the initial condition which is affected by c 5 summary and conclusions the analytical solution of the adr models has been widely used to model subsurface reactive transport due to the lack of computation power and intrinsic numerical errors in this study the previous adr model is expanded and improved by deriving solutions that consider a transient flow field time dependent source concentration reactions and arbitrary initial conditions a general analytical solution is derived by green s function method with an arbitrary flow velocity solutions are presented under three types of specific flow velocities modelled by the linear exponential and trigonometric functions respectively however the flow velocity is assumed to be temporally dependent instead of spatiotemporally dependent such assumption is tested by the numerical solution of transient subsurface flow and reactive transport models furthermore a sensitivity analysis is conducted to simulate the influence of the input parameters on output btcs the new models have been tested by laboratory controlled experimental data the following conclusions can be obtained from this study 1 in the analytical solutions the td model can be used to approximate the std flow velocity when the hydraulic diffusivity is greater than 5 10 5 m2d 1 2 the time dependent source concentration and arbitrary initial conditions included in the new analytical models could not be ignored when modeling the subsurface reactive transport 3 the input parameters with respect to the chemical reactions the transient flow field and the source concentration are sensitive to the output results 4 the sensitivity coefficient of the parameter involved in the initial condition models on btcs is negative and increases with time until it is zero 5 in the laboratory controlled experiment by li et al 2021 the reactive transport in the aquifer is one dimensional and absorption desorption processes could not be ignored credit authorship contribution statement wei wang quanrong wang formal analysis conceptualization methodology supervision writing original draft writing review editing wenguang shi data curation si chen data curation wenjun huang data curation zhitao xiong data curation shengde yu writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was partially supported by programs of natural science foundation of china no 41772252 no 41972250 and no 41502229 innovative research groups of the national nature science foundation of china no 41521001 the 111 program state administration of foreign experts affairs the ministry of education of china no b18049 the fundamental research funds for the central universities china university of geosciences wuhan no cuggc07 the belt and road special foundation of the state key laboratory of hydrology water resources and hydraulic engineering no 2020492011 and natural science foundation of chongqing cstc2020jcyj msxmx1072 we thank the editor associate editor and anonymous reviewers for their constructive comments which help improve the quality of the paper appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127119 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3857,flow velocity source concentration or initial condition is treated as constant in previous advection diffusion reaction adr analytical models for subsurface reactive transport such parameters may vary temporally and spatially and therefore constants limit the application of adr models in this study an adr model is developed considering transient flow fields time dependent source concentrations and arbitrary initial conditions a general analytical solution is derived by green s function method where the flow velocity source concentration and initial condition are described by arbitrary continuous functions the specific solutions are presented under three types of flow velocity models represented by the linear exponential and trigonometric functions the new analytical models of this study are the extensions of many previous ones and the robustness is tested by the laboratory controlled experimental data when compared with previous analytical solutions findings from this study indicate that flow velocity initial conditions and source concentrations produce profoundly different model results of subsurface reactive transport indicating that the transient properties of these model parameters should not be treated as constant similar to many previous analytical solutions the limitation of the new analytical model is to use the temporally dependent model to approximate the spatiotemporal variation of flow velocity to test the influence of such assumptions on breakthrough curves btcs the finite element solution of the transient subsurface flow and reactive transport models is employed results show that the temporally dependent model could be used to approximate the spatiotemporally dependent velocity variation when the hydraulic diffusivity is greater than 5 10 5 m2d 1 sensitivity analysis demonstrates that the most sensitive parameter on the output btcs is the retardation factor followed by parameters related to chemical reactions dispersion flow velocity and the source concentration keywords solute transport variable flow velocity arbitrary initial conditions analytical solutions 1 introduction the advection diffusion reaction adr equation has been widely used to simulate subsurface reactive transport in hydrogeology and environmental engineering due to a high computation demand and a high likelihood of numerical errors from numerical solutions e g numerical dispersion and or artificial oscillation particularly in advection dominated scenarios analytical solutions of adr models are developed alternatively meanwhile less computation is also one of the advantages for the analytical models and it is easy to be implemented by engineers a complete adr model of subsurface contaminant transport is mainly composed of the advection dispersion and reaction terms it is constrained by the source concentration boundary conditions and initial conditions for practical problems all these terms might be a function of time and or space however some of them were treated as constants in previous analytical adr models as summarized in table s1 of supplementary materials due to boundary conditions aquifer heterogeneity including the variation of permeability and porosity and spatiotemporally dependent std recharge and or discharge they may cause flow velocity u to be a std parameter which results in the adr equation with the std advection to date many analytical solutions of adr models have been developed with the std advection such as sanskrityayn et al 2017 2018 sanskrityayn and kumar 2016 singh et al 2015 2017 singh and chatterjee 2017 singh and das 2015 yadav et al 2011 and chaudhary et al 2020 however singh and chatterjee 2017 yadav et al 2011 and singh et al 2017 assumed that the initial condition was constant over space and such assumption could not be satisfied when the study area has a long pollution history sanskrityayn et al 2017 sanskrityayn and kumar 2016 and sanskrityayn et al 2018 did not consider the reaction terms in the adr model the analytical model of chaudhary et al 2020 seems closer to reality than the others but it contained two assumptions that u linearly changed with space and the dispersion coefficient dl changed with u2 this flow field generally occurs in the region around the pumping or injection well meanwhile the linear relationship between d l and u seems more common and robust regardless of use in the analytical solutions barry and sposito 1989 chaudhary et al 2020 or in numerical solutions like modflow mt3dms zheng et al 2012 and feflow trefry and muffels 2007 in essence the current analytical models with the std flow velocity could not be used to describe the subsurface reactive transport with transient flow field reactions time dependent source concentration and arbitrary initial conditions simultaneously alternatively many models assumed that the flow velocity was only spatially dependent bharati et al 2017 2018 neelz 2006 suk 2016 or temporally dependent td such as basha and elhabel 1993 bharati et al 2017 2018 2019 jia et al 2013 kumar et al 2009 li et al 2018 2020 singh et al 2009 su et al 2005 yadava et al 1990 yates 1990 zoppou and knight 1997 however these models believed that the initial concentration was constant chaudhary et al 2020 singh et al 2015 extended these models with non uniform initial conditions but the chemical reaction rate was assumed to linearly change with u in their analytical models such treatment makes the derivation of the analytical solution easier using the laplace transformation technique while the robustness of the model has not been tested recently suk 2016 developed a generalized semi analytical solution with temporally variable transport and decay coefficients using the generalized integral transform technique this model is an extension of many previous models however the mathematical expression was complex and it had large computations since the models contained infinite series meanwhile the td flow velocity was described by a linear function in fact besides the linear function the exponential and trigonometric functions have been also widely used to describe the advection variation with time in summary the current adr analytical models still have limitations and they will be extended in this study specifically an adr model that considers transient flow fields time dependent source concentration reactions and arbitrary initial conditions are developed a general analytical solution is derived by green s function method the transient flow field is assumed to be temporally dependent the specific solutions are presented under three types of flow velocity models respectively represented by the linear exponential and trigonometric functions the assumption involved in the description of the transient flow field will be tested by numerical modelling and laboratory controlled experimental data based on the new analytical models sensitivity analysis is conducted to investigate the influence of fundamental processes on the subsurface reactive transport such as the advection dispersion reaction terms the source concentration and initial conditions the new analytical models of this study are the extensions of many previous ones which could improve the description of the subsurface reactive transport processes 2 problem statement and analytical solution 2 1 mathematical model the schematic diagram of reactive transport model with a transient flow field time dependent source and arbitrary initial conditions is illustrated in fig 1 considering the dispersion advection and chemical reaction under the transient flow field the governing equation of solute transport is chaudhary et al 2020 singh et al 2015 1 r c t x d l x t c x u x t c λ c x 0 t 0 where c is concentration ml 3 t is time t x bis distance l u is flow velocity lt 1 d l is dispersion coefficient l2t 1 and d l α l u α l is aquifer dispersivity l r is retardation factor dimensionless and λ is first order reaction rate t 1 which could also describe the first order biodegradation and radioactive decay the initial condition of the mathematical model is 2 c x t t 0 c i a x where a x represents an arbitrary function of spatial position along the dimension and c i is a positive constant ml 3 when a x 1 the initial condition becomes uniform over space the boundary conditions are 3a c x t x 0 c 0 b t 3b c x t x 0 where c 0 is initial source concentration ml 3 b t represents a function of time and b t t 0 1 in this study the source of solute or contaminates is assumed to be in the origin of the coordinate system in this study the td dispersion and advection are considered kumar 1983 li et al 2018 4a u t u 0 φ t 4b d l t d 0 φ t where u 0 is initial velocity lt 1 d 0 is initial dispersion coefficient l2t 1 and d 0 α l u 0 φ t is an arbitrary function of time and φ t t 0 1 substituting eq 4 into eq 1 yields 5 c t d 0 φ t 2 c x 2 u 0 φ t c x λ c where d 0 r d 0 u 0 r u 0 and λ r λ eqs 2 5 formulate the mathematical model describing the reactive transport under a transient flow field the limitation of the new model is to use the td model to approximate the spatiotemporal variation of flow velocity which is included in the dispersion and advection terms although this assumption has been also widely used in previous studies kumar 1983 selvadurai 2004 singh et al 2014 2020 the performance of the model with the std flow velocity has not been investigated before and it will be tested in section 4 1 2 2 solution under arbitrary mathematical form of u c x 0 and c 0 t in order to derive an analytical solution with arbitrary flow velocity and initial concentration conditions two new variables are introduced as follows 6 t 0 t φ t d t 7 c c e u 0 u 0 t 2 x 4 d 0 λ t substituting eqs 6 7 into eqs 2 5 one has 8a c t d 0 2 c x 2 8b c x t t 0 c i e u 0 x 2 d 0 a x 8c c x t x 0 c 0 e u 0 2 t 4 d 0 e λ f t b f t 8d c x t x 0 where f t is the expression of t in the time variable t eqs 8a 8d become a one dimensional 1d heat conduction problem and green s function method gfm will be employed to derive the analytical solution the derivation of the analytical solution of eq 8a 8d could be seen in section s1 of supplementary materials 9 c c i 0 a x 2 π d 0 t e x x 2 4 d 0 t e x x 2 4 d 0 t e u 0 x 2 d 0 d x c 0 0 t x 2 π d 0 t t 3 e x 2 4 d 0 t t λ f t u 0 2 t 4 d 0 b f t d t substituting eq 9 into eq 7 one can obtain the analytical solution of eqs 1 5 10 c c e u 0 2 x u 0 t 4 d 0 λ t 2 3 special case in section 2 2 a general analytical solution of subsurface reactive transport is derived considering an arbitrary transient flow field time dependent source concentration reactions and arbitrary initial conditions this solution is an extension of many previous ones for instance when φ t e a t b t 1 e b t and a x 1 the newly derived model reduces to singh et al 2008 furthermore when a x 0 b t 1 and φ t u 1 u 0 u 0 u 1 e a t u 0 the new model is the same as that of li et al 2018 another example is when b t e x p b t and a x e x p s e c c x r eqs 1 5 become chaudhary et al 2020 s model as the flow velocity in the advection term of the adr model is computed from darcy s law it cannot be simply expressed as a continuous function therefore many different functions have been employed to approximate the flow velocity variation as shown in the second column of table s1 it is primarily comprised of a linear function by kumar 1983 11 u t u 0 1 a t an exponential function by das et al 2018 li et al 2020 singh et al 2008 singh and das 2015 12 u t u 1 u 0 u 1 e a t and a trigonometric function by singh et al 2009 13 u t u 0 1 s i n a t where a is a power index dimensionless b t 1 and c l 1 are constants and u 0 lt 1 and u 1 lt 1 are the initial flow velocity and the flow velocity at infinite time respectively in this section analytical solutions will be derived with three types of flow velocities the initial condition and the boundary conditions will take the arbitrary forms expressed by eq 2 and eq 3a respectively 2 3 1 flow velocity linearly changing with time eq 11 substituting eq 11 into eq 4a and eq 6 yields 14 t 0 t φ t d t t a t 2 2 where t can be computed from eq 14 15 t 1 1 2 a t a according to eq 6 or eq 14 t is zero if t 0 substituting eqs 14 15 into eq 10 the analytical solution of reactive transport with flow velocity linearly changing with time is 16 c c i e u 0 2 x u 0 t a t 2 2 4 d 0 λ t 0 a x 2 π d 0 t a t 2 2 e x x 2 4 d 0 t a t 2 2 e x x 2 4 d 0 t a t 2 2 e u 0 x 2 d 0 d x c 0 0 t a t 2 2 x 2 π d 0 t a t 2 2 t 3 e x 2 4 d 0 t a t 2 2 t λ 1 1 2 a t a u 0 2 t 4 d 0 b 1 1 2 a t a d t 2 3 2 flow velocity exponentially changing with time eq 12 substituting eq 12 into eq 4a and eq 6 yields 17 t 0 t φ t d t u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 where t can be obtained from eq 17 18 t u 1 u 0 a u 0 t u 1 p r o d u c t l o g u 0 u 1 e a u 0 u 0 u 1 a u 0 t u 1 1 u 1 a u 1 in which productlog x represents the inverse function of x e x on the interval 1 e substituting eqs 17 18 into eq 10 the analytical solution of reactive transport with flow velocity exponentially changing with time becomes 19 c c i e x p u 0 2 x u 0 u 1 u 0 t u 0 u 1 e a t n u 0 u 0 u 1 n u 0 4 d 0 λ t 0 a x 2 π d 0 u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 e x p x x 2 4 d 0 u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 e x p x x 2 4 d 0 u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 e x p u 0 x 2 d 0 d x c 0 0 u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 x 2 π d 0 u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 t 3 e x p x 2 4 d 0 u 1 u 0 t u 0 u 1 e a t a u 0 u 0 u 1 a u 0 t b u 1 u 0 a u 0 t u 1 p r o d u c t l o g u 0 u 1 e x p a u 0 u 0 u 1 a u 0 t u 1 1 u 1 a u 1 e x p u 1 u 0 a u 0 t u 1 p r o d u c t l o g u 0 u 1 e x p a u 0 u 0 u 1 a u 0 t u 1 1 u 1 a u 1 λ e x p u 0 2 t 4 d 0 d t 2 3 3 flow velocity trigonometrically changing with time eq 13 substituting eq 13 into eq 4a and eq 6 one has 20 t 0 t φ t d t 1 a c o s a t t 1 a to simplify the solution of the model the source concentration is assumed as 21 c 0 t c 0 the initial condition is still in the form of eq 2 substituting eqs 20 21 into eq 10 the analytical solution of reactive transport with flow velocity trigonometrically changing with time becomes 22 c c i e x p u 0 2 x u 0 1 a c o s a t t 1 a 4 d 0 e λ t 0 a x 2 π d 0 1 a c o s a t t 1 a e x p x x 2 4 d 0 1 a c o s a t t 1 a e x p x x 2 4 d 0 1 a c o s a t t 1 a e x p u 0 x 2 d 0 d x c 0 0 1 a c o s a t t 1 a x 2 π d 0 1 a c o s a t t 1 a t 3 e x p x 2 4 d 0 1 a c o s a t t 1 a t e x p u 0 2 t 4 d 0 d t 3 results 3 1 comparison with previous studies to test the new solution derived by green s function method the previous analytical models are employed to serve as benchmarks as shown in fig 2 a 2c singh et al 2008 used the laplace transformation technique to derive the analytical solution with assumptions that the velocity variation followed eq 12 when u 1 0 md 1 as shown in table 1 by setting a x 1 b t 1 e b t r 1 0 λ 0 the solution of eq 19 reduces to the model of singh et al 2008 the other parameters used in this figure are a 1 10 3 b 1 10 3 d 1 c 0 10 gm 3 c i 2 gm 3 d 0 0 1 m2d 1 α l 1 0 m and u 0 0 1 md 1 the comparison between eq 19 and singh et al 2008 as shown in fig 2a fig 2b shows the comparison between eq 19 and li et al 2018 who employed the laplace transformation technique to derive the analytical solution with assumptions that the velocity variation followed eq 12 the initial concentration was zero and the source concentration was constant by setting a x 0 b t 1 r 1 and λ 0 the solution of eq 19 reduces to li et al 2018 the other parameters are assigned default values a 1 0 10 3 c 0 10 0 gm 3 c i 0 d 0 0 1 m2d 1 α l 1 0 m u 0 0 1 md 1 and u 1 0 15 md 1 fig 2c shows the comparison between eq 22 and the analytical model by singh et al 2009 who employed the laplace transformation technique to derive the analytical solution using the trigonometric function of eq 13 to describe the td flow velocity by setting a x 0 b t 1 r 1 λ 0 the solution of eq 22 reduces to singh et al 2009 the other parameters used in this figure are the same ones used in fig 2b fig 2a 2c show that the new solutions of this study agree with the solutions obtained by laplace transformation techniques in previous studies under the special cases implying that green s function method performs well in deriving the adr solutions analytically with transient flow field time dependent source concentration and arbitrary initial condition which successfully encompasses all special cases 3 2 effects of initial conditions on reactive transport as shown in table s1 the laplace transformation technique has been widely used to derive the analytical solution of reactive transport however this method requires that the initial concentration distribution over space has to be uniform e g a x 0 or a x 1 in reality the initial concentration always varies with spatial locations especially when the origin of the coordinate system is located at the contaminant source center to date two types of functions have been widely used 23a a x e c x 23b a x 1 c x where c is a constant l 1 which could be estimated by interpreting the observed concentration of the contaminant source eq 23a and eq 23b have been used for initial conditions by singh et al 2014 2015 respectively fig 3 shows the btc variations affected by four different types of initial conditions a x 0 represents an aquifer that is initially free of solutes or contaminants in the case where a x 1 the initial concentration distribution of the solute is uniform over space and it is used to describe background values the other two types of initial conditions represent scenarios where the solute concentration decays over space from the origin of the coordinate system the flow velocity is described by eq 12 and b t 1 the values assigned to the other parameters are as follows c 0 10 0 gm 3 c i 2 0 gm 3 a 1 0 10 3 c 3 0 10 2 m 1 u 0 0 1 md 1 u 1 0 15 md 1 d 0 0 1 m2d 1 α l 1 0 m r 1 0 and λ 1 0 10 3 d 1 this figure shows that the influence of the initial condition on the btc values is important to the magnitude of btc during the early time span of the model run and should be carefully modeled when the time span of interest is in the early stages such influence becomes smaller as time increases this is because the model becomes independent of the initial condition when the transport model is at a steady state 3 3 effect of source concentration on reactive transport in this study the origin of the coordinate system is assumed to be located at the center of the contaminant source therefore variations of the source concentration are treated as the boundary condition to investigate the effect of the source concentration on the reactive transport three types of the functions are implemented to describe the concentration variations 24a b t 1 24b b t e b t 24c b t s i n b t where b is a constant t 1 eq 24a eq 24b and eq 24c were used to describe the source concentration by li et al 2018 logan 1996 yadava et al 1990 respectively eq 24a represents constant source concentration fig 4 shows the btcs for different boundary conditions where the flow velocity is described by eq 12 the uniform concentration of a x 1 is applied for initial concentration the values of other parameters used in this case are the same as the values used in section 3 2 the high variation in btcs evolution indicates that source concentration could significantly affect the subsurface reactive transport 4 discussions 4 1 validation of the assumption included in the new analytical models as mentioned in introduction flow velocity is a std parameter which is generally computed from hydraulic heads based on darcy s law because the velocity variation is complex it cannot be described by any specific continuous function exactly instead the linear function of eq 11 the exponential function of eq 12 and the trigonometric function of eq 13 are preferred to approximate it when deriving analytical solutions assuming that the flow velocity is only temporally dependent but spatially independent therefore it is necessary to test the limitations of the analytical models using the td u to approximate the std u compared with analytical models the numeral method is more powerful in dealing with mathematical models with complex boundary conditions transient flow fields time dependent source concentration reactions and arbitrary initial conditions therefore numeral modeling has been widely used to test the assumptions involved in analytical models such as chaudhary et al 2020 goode and konikow 1990 and so on although the numerical errors are not easily avoided in numeral modeling they can be decreased by adjusting the std discretization of the grid system as the analytical solution of adr models with std u time dependent source concentration reactions and arbitrary initial conditions arenot available numerical modeling will be employed to test the assumption included in the advection term of eq 5 the conceptual model as shown in fig 5 represents the subsurface flow and reactive transport in a confined alluvial aquifer located between two parallel rivers the hydraulic head at the boundary to the right is constant while the hydraulic head at the boundary to the left increases exponentially with time this conceptual model shows the scenario in which the water level increases in a river system due to the discharging of upstream dammed reservoirs huang et al 2020 lin et al 2019 the mathematical model of subsurface flow and reactive transport in a confined alluvial aquifer is shown in section s2 1 of supplementary materials as the adr analytical model cannot completely consider the variation of the transient flow field we first have to determine the relationship between u and t when establishing the conceptual model then the model of u is substituted into eq 5 for the prediction of the subsurface reactive transport in this case the relationship between u and t is exponential as a result the coefficients of advection and dispersion are not linear such nonlinear coefficients only appear in the analytical model but not in the numeral modelling as they will be treated in another way specifically the mathematical model of subsurface flow eqs s2 1 s2 3 is first solved to produce the std flow velocity of cells in the grid system of numerical modelling then the computed u in the cells is directly substituted to the reactive transport model to compute the solute concentration in the aquifer it is not necessary to find the relationship between u and t in this study the comsol multiphysics software package will be employed to implement numerical modelling such numeral modelling could also be conducted by other software packages like tough borgia et al 2011 zhou et al 2004 modflow mt3dms langevin and guo 2006 prommer et al 2003 and so on as numeral solutions are approximating solutions of mathematical models numerical errors are highly dependent on spatiotemporal discretization a spatial grid system is designed based on that of the analytical solutions as shown in figure s1 detailed information on the numerical modelling procedure is found in section s2 2 of supplementary materials as the aquifer storage μ s is more sensitive to the variations in flow velocity than other parameters three sets of values are implemented μ s 1 10 2 5 10 3 and 1 10 3 respectively the other parameters used in this case are aquifer length l 1000 m aquifer thickness m 50 m hydraulic conductivity k x 10 md 1 c 0 10 gm 3 c i 2 gm 3 a x e c x b t e b t a 5 10 3 b 1 10 3 d 1 c 3 10 2 m 1 d 0 0 1 m2d 1 u 0 0 1 md 1 u 1 0 15 md 1 α l 1 0 m r 1 0 and λ 1 0 10 3 d 1 the contour maps of the hydraulic head and the concentration can be found in figures s2 and s3 of supplementary materials to test the assumption with respect to u in the analytical models we employ the function of the td model to best fit the std u computed by comsol fig 6 a 6c show the goodness of fit of the flow velocity where σ is hydraulic diffusivity l2t 1 and σ km μ s in the legend comsol represents the numerical modelled flow velocity eq 12 is chosen for the goodness of fit analysis because the hydraulic head variation in the left boundary has a similar form according to darcy s law the average flow velocity u over the entire aquifer is 25 u t k xx h x 0 t h x l t l u 1 u 0 u 1 e a t where eq 25 has the same mathematical expression with eq 12 assuming that the values of u 0 and u 1 are given there is only one free parameter a during the simulation in eq 25 if the estimated a is equal to the input value a in the comsol model and the simulation results of the computed velocity are appropriate it implies that the assumption of the flow velocity variation also performs well in modeling the solute transport comparing fig 6a 6c two interesting observations are found first the computed flow velocity by comsol is spatiotemporally dependent when hydraulic diffusivity is small as shown in fig 6a with increasing σ the spatial variation of the flow velocity decreases and can be ignored when σ 5 10 5 m2d 1 second the goodness of fit of the flow velocity r 0 2 improves with increasing σ the differences between the flow velocity by comsol and fitted flow velocity by eq 12 are negligible and a a fig 7 a 7c compare btcs by the comsol model and the analytical solutions for different values of σ results indicate that the difference between two models decreases with increasing hydraulic diffusivity the difference disappears when σ 5 10 5 m2d 1 therefore the td model of flow velocity performs well when σ is larger than 5 10 5 m2d 1 in summary figs 6 7 show that the difference between the td and std models diminishes at high hydraulic diffusivity which is greater than 5 10 5 m2d 1 this value is significantly high for natural flow systems but is possible for instance it is 4 47 10 5 1 95 10 6 m2d 1 in ha et al 2007 2 16 10 6 m2d 1 in shih 1999 3 02 10 7 m2d 1 in shih and lin 2004 2 16 10 6 m2d 1 in shih 1999 1 73 10 5 1 04 10 6 m2d 1 in pacheco and van der weijden 2014 1 72 10 4 8 64 10 7 m2d 1 in guglielmi et al 2015 4 3 10 5 1 3 10 6 m2d 1 in pacheco et al 2015 5 72 10 8 m2d 1 in hu and jiao 2016 6 92 10 6 m2d 1 in shih 2018 and so on the lithology of the aquifer could be gravel and sand clay or shale the detailed information has been listed in table s2 of supplementary materials 4 2 laboratory controlled experiment to test the new model of this study the experimental data of subsurface reactive transport by li et al 2021 will be employed the experiment was conducted in the laboratory under a transient flow field with time dependent source concentration and uniform initial condition however the experiment of li et al 2021 was used to investigate the reactive transport in the aquifer aquitard system and it seems that the experimental data could not be interpreted by the new analytical model of this study due to the following two reasons firstly the solute might enter the aquitard from the adjacent aquifer which could not be considered in the new analytical solutions secondly the reactive transport might be two dimensional 2d while it is assumed to be one dimensional in the analytical solution of this study li et al 2021 employed a 2d model to interpret the experimental data this 2d model considered the transient flow field time dependent source concentration and uniform initial condition but ignored the retardation and reaction e g r 1 0 and λ 0 here we infer that a the mass entering the aquitard is small and could be negligible when the experimental time is short enough such inference could be seen in figures s4a 4b where the concentration of the solute is zero in the aquitard b the reactive transport in the aquifer is one dimensional because of greater discrepancy of permeability between the aquifer and aquitard if these two inferences are true the new model could be used to interpret the experimental data by li et al 2021 then we compare the model of li et al 2021 and this study under the same parameters used in two models u 0 28 73 md 1 u 1 2 85 md 1 a 0 1135 c 0 10 gl 1 c i 0 a x 1 b t 1 e b t b 36 d 1 d 0 1 29 m2d 1 α l 0 045 m r 1 0 and λ 0 the parameters related to the flow velocity are estimated by best fitting the observed flow velocity as shown in fig 8 and the goodness of fit r 0 2 is 0 99 figures s4a 4b shows that btcs are almost the same for the two models demonstrating that the two inferences are reasonable and the new analytical model of this study can be used to interpret the experimental data figures s4a s4b show that the fitness of the observed btc by li et al 2021 is not very good probably because their model did not include the retardation and reaction which could be considered in the new analytical model of this study then we use the new analytical model to reinterpret the experimental data and the estimated parameters are r 1 6 and λ 1 0 10 3 d 1 these two parameters represent the absorption desorption processes and chemical reactions the other parameters are the same as one used in li et al 2021 the errors between the computed and observed btcs are shown in table 1 and errors are computed by moriasi et al 2007 26 rsr i 1 n c i obs c i com 2 i 1 n c i obs c mean 2 where c i obs is the i th observed value c i com is the i th computed value c mean is the mean of the observed data and n is the total number of observations a smaller rsr value indicates the better performance of the model fig 9 a 9b show the comparison between computed and observed btcs and the results of li et al 2021 are also included for the purpose of comparison fig 9a 9b and table 1 demonstrate that the new model performs better than li et al 2021 in the laboratory controlled experiment by li et al 2021 the reactive transport in the aquifer is one dimensional absorption desorption processes could not be ignored 4 3 sensitivity analysis the analytical models of this study contain several parameters such as α l a b c λ r u 0 u 1 in the solution of eq 12 high parameterization may lead to uncertainties including measurement error absence of information or inappropriate usage due to poor understanding of transport mechanisms jia et al 2013 sanskrityayn et al 2017 therefore it is necessary to conduct a sensitivity analysis to investigate the influence of the input parameters on btcs of the analytical models in this study the model of the sensitivity analysis is based on jiao and rushton 1995 wang et al 2015 27 s c i j i j o i i j δ i j o i i j δ i j where s c i j is the sensitivity coefficient o i is the output function of the model δ i j is a small increment which is chosen as 10 2 i j in this study i is i th time for o i j is j th parameter of the model in this study o i is the dimensionless concentration c the negative values of s c i j represent negative correlation and the positive values of s c i j represent positive correlation the greater absolute values of s c i j imply a greater influence of that parameter fig 10 shows the sensitivity of eq 12 to the parameters α l a b c λ r u 0 u 1 over the course of the btc the parameters used in this case are the same as the parameters used in figure s1 the btc is also included in this figure for the purpose of comparison several interesting observations were obtained from the simulation results firstly the most sensitive parameter is the retardation factor r and the parameters related to the chemical reactions λ model results are also sensitive to dispersion α l flow velocity u 0 u 1 and a and the source concentration b secondly s c i j is positive for the parameters involved in the flow velocity and is negative for b and c negative s c i j means that increasing parameter values decreases output btc values while positive s c i j means that increasing parameter values increases output btc values as for α l the s c i j first increases with time from zero decreases at t 1 10 2 and increases again at t 1 10 2 2 until s c i j becomes zero the configuration of the r curve is opposite to that of α l thirdly s c i j approaches zero for all parameters except c when the time is less than 100 days this is because the solute concentration of btc is mainly dependent on the initial condition which is affected by c 5 summary and conclusions the analytical solution of the adr models has been widely used to model subsurface reactive transport due to the lack of computation power and intrinsic numerical errors in this study the previous adr model is expanded and improved by deriving solutions that consider a transient flow field time dependent source concentration reactions and arbitrary initial conditions a general analytical solution is derived by green s function method with an arbitrary flow velocity solutions are presented under three types of specific flow velocities modelled by the linear exponential and trigonometric functions respectively however the flow velocity is assumed to be temporally dependent instead of spatiotemporally dependent such assumption is tested by the numerical solution of transient subsurface flow and reactive transport models furthermore a sensitivity analysis is conducted to simulate the influence of the input parameters on output btcs the new models have been tested by laboratory controlled experimental data the following conclusions can be obtained from this study 1 in the analytical solutions the td model can be used to approximate the std flow velocity when the hydraulic diffusivity is greater than 5 10 5 m2d 1 2 the time dependent source concentration and arbitrary initial conditions included in the new analytical models could not be ignored when modeling the subsurface reactive transport 3 the input parameters with respect to the chemical reactions the transient flow field and the source concentration are sensitive to the output results 4 the sensitivity coefficient of the parameter involved in the initial condition models on btcs is negative and increases with time until it is zero 5 in the laboratory controlled experiment by li et al 2021 the reactive transport in the aquifer is one dimensional and absorption desorption processes could not be ignored credit authorship contribution statement wei wang quanrong wang formal analysis conceptualization methodology supervision writing original draft writing review editing wenguang shi data curation si chen data curation wenjun huang data curation zhitao xiong data curation shengde yu writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was partially supported by programs of natural science foundation of china no 41772252 no 41972250 and no 41502229 innovative research groups of the national nature science foundation of china no 41521001 the 111 program state administration of foreign experts affairs the ministry of education of china no b18049 the fundamental research funds for the central universities china university of geosciences wuhan no cuggc07 the belt and road special foundation of the state key laboratory of hydrology water resources and hydraulic engineering no 2020492011 and natural science foundation of chongqing cstc2020jcyj msxmx1072 we thank the editor associate editor and anonymous reviewers for their constructive comments which help improve the quality of the paper appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127119 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3858,growing agricultural and economic activities have brought tremendous pressure to regional water resources management considering the interactions of water resources allocation among adjacent regions with connected water systems it is necessary to pay attention to the unification of socio economic development and environmental protection between the regions this is of significance to many agglomeration areas that are composed of multiple large cities such as the beijing tianjin hebei urban agglomeration bth in china in this research an ensemble approach was proposed to tackle water resources allocation problems under the constraints of water resources to reflect interdependence of the composed three areas i e beijing tianjin and hebei the approach included arima autoregressive integrated moving average method ann artificial neural network modelling copula functions and multi objective chance constrained programming model it can 1 reflect the variations characteristic of regional water supply and demands 2 solve the interactions between multi regional water resources and 3 obtain desired water resources allocation strategies under multi scenario and scale conditions then the approach was applied in typical regions of china i e beijing tianjin hebei urban agglomeration considering 27 scenarios of the nexus water shortage risk multi objective joint opportunity constraint programming model aimed at maximizing economic benefits and ecological benefits in combination with economic agricultural water resources and environmental constraints as the optimal strategies indicated the maximum gdp in bth would remain at 8514 billion yuan the minimum amount of water allocation and wastewater discharge would be 24 26 billion m3 and 2100 2101 million m3 respectively keywords copula function multi objective programming nexus risks beijing tianjin hebei urban agglomeration 1 introduction freshwater is fundamental for economic and social development of human beings chen et al 2017 dong and xu 2019 zhang et al 2018b due to continuously economic growth population increase and living standard improvement water demand in many countries is rising and it is believed that half of the world s population might suffer severe freshwater stresses by 2030 unep 2015 this is of extreme significance to areas that are under rapid urbanization and booming industrialization such as the beijing tianjin hebei bth urban agglomeration in china in such a region under rapid socio economic development the increasing development for agricultural and industrial production has brought tremendous pressure on water resources management yang et al 2017 sun et al 2019 there is a need to propose scientific evaluation of water supply and demand based on regional population and industrial structure and to provide strategies for policy makers especially in northern china chen et al 2020b kattel et al 2021 also more water import from beyond their jurisdictions for satisfying regional demand van den brandeler et al 2019 potential water stresses thus need to be paid attention to considering the effects of physical water transfer projects e g the south to north water diversion project in china liu et al 2020b traditionally water resources allocation considered the constraints of water supply and demand xiong et al 2020 and seldom focused on the joint optimal utilization of water resources among multiple regions thus it is urgent to analyze optimizing strategies on water allocation in consideration of correlated utilization of water resources between adjacent regions widespread application of urban water management required socio economic transition in urban water sector bos et al 2013 previously water allocation can be undertaken through decision making systems market based systems or a combination of the two zhao et al 2013 recently water trading markets were still difficult to establish in many countries within political technical and geographical barriers arellano gonzalez et al 2021 zhang 2007 in terms of market based systems economic cost in water allocation e g water supply demand and storage should be analyzed with the framework of allocation mechanisms and transaction costs brennan 2010 brooks and harris 2008 in terms of decision making systems du et al 2021 explored the joint impacts of the inequality of water permit allocation and farmers behaviors on market performance integration of economic models with optimizing models could effectively find desired solutions of stakeholders for water allocation in consideration of economic environmental and social benefits king et al 2019 in water resources management systems multiple uncertainties existed such as varied water supply and demand options in both short and long term planning due to errors or ambiguity in data and their interactions with fluctuating natural and socio economic conditions ma et al 2020 zhu et al 2019 for example water infrastructure planning linked with urban development and evolved through time bach et al 2015 thus judgments by expert and local stakeholders should be considered in water resources management moglia et al 2012 particularly the vulnerability of water resources would amplify due to rising demands related to economic growth expanding populations and climate change jin et al 2020 ranjan 2010 influenced by climate change and population growth theses uncertain factors would finally lead to water shortage risk and influence the suitability of strategies in water allocation keath and brown 2009 in detail the water shortage risk can be estimated by the probability of exceeding acceptable level of water shortage under future variability between water supply and demand hussien et al 2018 previously multiple uncertainty risk analysis methods were introduced into water resources management for example scenario analysis was regarded as an effective way to analyze possible future events in consideration of future uncertain outcomes zeng et al 2019 influenced by human activities and climate change the non stationary features in hydrological variables should be considered in the framework of risk assessment chebana and ouarda 2021 ahn and palmer 2016 thus the features were paid attention by a number of hydrological studies in terms of flood process daneshkhah et al 2016 luo et al 2021 hydrological forecasting liu et al 2021 watershed precipitation brodeur and steinschneider 2021 abbasian et al 2021 and drought severity especially under the background of climate change montaseri et al 2018 in order to model the characteristics copula functions were regarded as one of effective and flexible methods to explore statistical dependence between two or more random variables e g precipitation floods and droughts yu et al 2019 nguyen huy et al 2017 for example nguyen huy et al 2018 employed copula functions for analyzing relationships between multiple large scale climate scenarios and crop yield balistrocchi et al 2019 found the mutual correlation between flood peak and duration can be properly expressed by one of copula functions i e clayton copula tu et al 2018 and shan et al 2021 explored the joint distributions of sub regional precipitation based on multi dimensional copula functions temporal dependence features of precipitation and runoff were described based on time varying copula functions zhang et al 2021a meanwhile copula functions can build multivariate joint probability distribution and explore the correlation between available transfer water and local surface water gao et al 2018 liu et al 2020a as the interrelated uncertain variations caused the joint risk of nexus systems the reliability of decision making would be influenced remarkably zhang et al 2021b dealing with the joint probability distributions in water and energy nexus systems copula functions can also further support coordinated decision making under uncertainties cai et al 2021 although the risk assessment methods have been widely applied in water resources management previous studies rarely considered the complicated correlation in water supply and demands wang et al 2019 romero lankao and norton 2018 thus it is necessary to recognize the complicated interactions among water supply and demands with socio economic development and to transfer the interactions into water resources management li et al 2020a allocation of water resources was often regarded as an expression of conflicts with socio economic activities kallis and zografos 2014 for example the human induced water scarcity was greatly influenced by economic activities and urbanization in beijing tianjin hebei bth mega region li et al 2020b however traditional classic hydro economic models were not effectively recognized the dynamic interactions between socio economic activities and water resources allocation paim et al 2019 thus effective and robust optimization models were required to allocate water resources under considering the synergies and trade offs of multiple sectors and inherent uncertainties jin et al 2020 xie et al 2018 proposed an inexact two stage stochastic downside risk aversion programming for regional industrial water resources allocation considering various environment control strategies zhang et al 2020b advanced a stochastic fuzzy based fractional programming for water resources allocation management and soil salinity control under uncertainty specially as an effective stochastic mathematical programming method chance constrained programming ccp model was suitable for identifying occasions in the presence of an abundant source of information zhang et al 2019 for example zhang et al 2020a proposed a multi objective chance constrained programming approach for solving planning problems with uncertain weights in agricultural water management although many previous studies focused on the water resource allocation and water shortage risk there is a lack of research in the following aspects a identification of variations in water demands influenced by socio economic development b evaluation of interactions in water supply between adjacent regions and c establishment of adaptive strategies on water allocation in the perspective of risk aversion therefore the objective of this study was to propose a hybrid integrated approach to recognize dynamic interactions between socio economic activities and water resources allocation and to transfer the interactions into water resources management model in detail the approach can a evaluate variations in water demands and correlation of water supply in adjacent regions b transfer the variations and correlation in water demands and supply into a multi objective programming model and c obtain adaptive strategies of water allocation in consideration of water shortage risk in adjacent regions the approach will then be applied in a typical region of china i e bth urban agglomeration copula functions will be introduced to describe the nexus water shortage risk considering interaction and dependence in the region 2 concepts and quantification spatially coupled water shortage risks an integrated approach is proposed to analyze the nexus risks in water resources management system through coupled with autoregressive integrated moving average arima artificial neural network ann copula functions and multi objective chance constrained programming model the general schematic framework is shown in fig 1 water shortage risk in an urban cluster can be recognized under four stages i e data collection uncertainty analysis correlation analysis and optimization management water shortage risk is attributed to the variations between water demands and supply in addition arising from interactions of water supply in urban clusters nexus risks of water resources can be emphasized based on the nexus distributions of water allocation among adjacent cities chen et al 2020a the nexus studies related to water resources are fundamentally concerned with future uncertainty engaging with complicated water management systems as well as its concern with the trajectories of human communities and water resources in multiple regions yung et al 2019 cities are open systems due to their flexible boundaries and they operate around dynamic equilibrium conditions comino et al 2020 physical water transfer projects in trans regions link related adjacent cities in terms of water supply the vulnerability of water demands is also increasingly related to economic development population growth and climate change water shortage risk would occur and have a negative effect on water allocation nexus risks are defined as a set of distributions in consideration of linkages between water supply and demands with two or more natural or socio economic conditions thus the nexus risks should be addressed through reflecting the complexities in inter linkages with water demands or supply socio economic development and regional water transfer the nexus risk analysis aims to identify the probability of exceeding acceptable level of water shortage in a year with a certain time horizon in this context the variability in water demands and supply should be considered there are two strategies to identify the nexus risks one is to couple well established system models where the output of one feeds the input of the other in a one way or iterative process and the other is the holistic approach which internally represents all interactions within a single model payet burin et al 2019 nexus risks focus on the interactions of water demand and supply between adjacent regions copula functions can be used to construct multivariate joint probability distributions according to the multi distribution features of the regions scenario analysis can be introduced to analyze possible future changes in socio economic conditions in order to strengthen decision making for mitigating water shortage nexus risk the nexus risk needs to be incorporated into an optimization model traditionally the optimization model aims at the minimum cost or maximum benefit for identifying optimal water allocation solutions in order to systematically address complexities across correlated water supply among adjacent regions the optimization model would identify the nexus risk distribution in water supply or demand also targets for economic development and environmental protection should be incorporated into the optimization model in combination with economic agricultural water resources and environmental constraints specifically a multi objective chance constrained programming model could identify probability of random events e g water supply the desired strategies can thus directly support for mitigating water shortage nexus risk in adjacent regions 3 methodology 3 1 method of autoregressive integrated moving average arima arima was proposed by box and jenkins 1976 the autoregressive model describes the relationship between current and historical values and predicts itself with the historical time data of the variable itself the autoregressive model must meet the requirements of stationary arima is a generalization of the auto regressive ar model which uses three tools to model sequence correlation in interference the ar 1 model uses only first order terms but in general other higher order terms can be used a p order autoregressive model has the following form 1 x t α 1 x t 1 α 2 x t 2 α 3 x t 3 α p x t p ε t where xt indicates the tth value of random variable in water supply i e x εt is error term and αt is autocorrelation coefficient each integration order corresponds to the difference in the predicted sequence the first order integrated component means that the prediction model is designed for the first difference in the original sequence the second order component corresponds to the use of second order difference and so on the error lag value is used to correct the prediction accuracy of the buy model and the number of recent errors used is equal to the order the form of ma q is described as follows 2 x t ε t θ 1 ε t 1 θ 2 ε t 2 θ q ε q 2 where θt is the coefficient of εt the autoregressive and moving average specifications can be combined to form the arma p q standard form based on the following equation 3 x t α 1 x t 1 α 2 x t 2 α 3 x t 3 α p x t p θ 1 ε t 1 θ 2 ε t 2 θ q ε q 2 the simulation process is divided into four steps data preprocessing stationary test model establishment and model test zheng et al 2018 shao et al 2017 after specifying the functions of the arima model parameters of these functions can be estimated once the appropriate model is selected and its parameters are estimated the model s residuals are checked based on box jenkins method to verify suitability of the series diagnostic tests are used to determine whether the residuals of the selected arima models in the acf autocorrelation function and pacf partial autocorrelation function maps are independent homoscedastic or normally distributed if the same variance and normality assumptions were not provided the observations would be converted by the generalized power transformation method 3 2 method of artificial neural network ann one of typical machine learning methods i e artificial neural network ann modeling was applied to analyze water demands of users back propagation bp was introduced for learning algorithm in ann application uzlu et al 2014 this training algorithm is a technique that helps distribute the error in order to obtain predicted values with minimum error singh et al 2009 the bp neural network is composed of an input layer a hidden layer and an output layer zhang et al 2018a in detail data outputs of water demands i e yi are obtained by data inputs i e xk through the connection links in ann their transfer coefficients are calculated by connection weights i e wki and the value of an activation function i e f is described in equation 4 zeng et al 2012 the output values i e y are obtained based on initially random weights compared with the desired output tl the computed error i e e is back propagated through the original network and the indicators of wki are updated through the training process then the indicators of wki and e are gradually adjusted the training process is repeated when the indicator of error satisfies the desired value before training the matrixes of x x1 x2 xk and y y1 y2 yk are regarded as the input and the output vectors respectively in this study the input matrix includes the related socio economic indicators e g population gdp and output values of agricultural industrial and service sectors and the output matrix includes the related indicators in water supply i e ot 4 y i f k 1 m x k w ki θ i where θi is threshold value which must be exceeded for node to be activated a commonly used activation function throughout neural network literature is the sigmoid function which can be expressed as 5 f x 1 1 e x where x represents the summation result from eq 4 similarly the output signal vector of the output layer is shown as follows 6 o t f i t li y i θ l where ot is output signal vector of output layers tli is the connection weights between hidden and output layers the suitability of parameters is evaluated using a network error function such as the sum of squared errors between the predicted and desired output vector eq 7 7 e 1 n m j 1 n l 1 m t l o t 2 where e is the network error function tl is the desired output vector 3 3 copula functions in probability theory two dimensional random vector trv multivariate random vector mrv joint distribution function jdf and marginal distribution function mdf are important concepts establishing the corresponding relationship between edge and joint distributions requires to further analyze the probability characteristics of correlated parameters at the same time the word copula comes from the latin word link or bond invented by sklar in copula theory a joint distribution function of correlated parameters can be decomposed into edge distribution functions and copula function regarded as connection functions copulas connect the joint distributions with their respective edge distributions copula functions can be expressed as 8 c θ u v c θ f x x f y y where θ is the parameter of copula function x and y are random variables fx x and fy y are the marginal distribution functions of two random variables archimedean copula functions i e gaussian gumbel clayton and frank are widely applied in water resources management shown in equation 9 9 c u v ϕ 1 ϕ u ϕ v the maximum likelihood function is used to estimate the parameter θ of the copula function the likelihood function is shown as follows 10a ln c θ u v ln u v θ 1 ln ln u ln v w 1 θ ln w 2 θ 2 θ 1 w 1 θ 2 10b w ln u θ ln v θ where cθ is a copula function and u and v are the marginal distributions of random variables x and y respectively then the parameters in copula functions are expressed as follows 11 θ argmax i 1 n ln c θ u i v i after obtaining the estimated results of the parameters in the selected copula functions it is necessary to evaluate the performance of copula functions to determine the advantages and disadvantages of the model in this study empirical method is used to test the goodness of fit in order to select the optimal joint distribution function if fn x and gn y are empirical distributions then empirical copula is described in equation 12 12 c 0 u v 1 n i 1 n i f n x i u i g n y i v u v 0 1 where i is a demonstrative function when fn xi u i fn xi u 1 and when fn xi u i fn xi u 0 similarly when gn yi v i gn yi v 1 and when gn yi v i gn yi v 0 square euclidean distance i e d2 can reflect the fitting degree of copula function and actual value the smaller the distance indicates the better fitting degree square euclidean distance is evaluated based on eq 13 13 d 2 i 1 n c u v c 0 u v 2 where c u v is the selected copula function and c0 u v is the empirical copula function 3 4 multi objective chance constrained programming considering the interactions among adjacent regions a multi objective chance constrained programming model is proposed for effectively allocating water resources as follows 14a max f 1 j 1 n i 1 m a ij x ij 14b min f 2 j 1 n i 1 m x ij 14c min f 3 w j 1 n i 1 m b ij x ij 14d i 1 m a ij x ij z j j 14e j 1 n i 1 m x ij w 14f pr i 1 n x ij w j α j 1 p j j 14g j 1 n i 1 m c i j x i j u i i 14h i 1 m b i j x i j y j i i j where f1 is total economic benefit of regions αij is economic benefit per unit of water supply in the ith sector of the jth region xij is water allocation to the ith sector of the jth region f2 is total water supply to regions f3 is total wastewater discharge of sectors in the regions bij is wastewater discharge per unit of water supply in the ith sector of the jth region zj is industrial economic target in the jth region w is total water supply in the regions wj is the amount of water supply in the jth regions which is obtained by copula functions assuming the condition that the constraint is satisfied with at least a probability of αj the probability that the constraints can be violated is described as pi ma et al 2020 zhang et al 2019 c i j indicates the i th grain crop yield per unit of water supply in i th grain crop u is the target for grain production in the regions and b i j is wastewater discharge per unit of water supply in the i th industrial sector of the jth region 4 case study located in north china the urban agglomeration of bth 36 02 n 42 62 n 113 06 e 119 88 e is national political economic and cultural center fig 2 the region is lack of water resources and the per capita water capacity was only 11 11 of national average the average annual rainfall in bth is about 540 mm much smaller than minimum water requirement i e 748 mm previously the cumulative groundwater overexploitation has exceeded 155 billion m3 water resources from local surface and underground water groundwater cannot meet the increasing demand the limited water resources i e 1 01 of total water resources in china supported 7 24 of national population and 10 of national gdp although the south to north water transfer project has promoted the capability of water supply increasing water demand of socio economic activities would still pose challenges to sustainable allocation of water resources therefore it is of great strategic significance to rationally optimize water resources in the region 4 1 water supply and demand simulation the water supply of the three regions of beijing tianjin and hebei are simulated by the arima p d q model the indexes of p d and q were the number of auto regression indicators difference order for component stationary and the items of moving average ma data sets of 67 years i e from 1951 to 2017 were incorporated in the model of autoregressive integrated moving average arima new data sets obtained then from the arima model were compared with the original data sets based on box jenkins method to verify suitability of the series considering the distribution features of water supply in beijing and tianjin the bic bayesian information criterion values of arima with the nine combinations were calculated as shown in table 1 also the index of q was considered in ma model for water supply simulation of hebei province similarly the bic values of ma with q 3 4 8 were calculated and the results indicated that the lower of bic values in arima and ma models the higher fitting degree the goodness of fit test of arima 5 2 1 arima 3 2 1 and ma 4 models also applied suitability the models for water supply simulation fig 3 water demand simulation was proposed based on ann method the indicators of population gdp and gross output value of agriculture were chosen as input variables tables a1 a3 in the section of appendix a the 14 sample sets from 2004 to 2017 were divided as training test and cross validation sets according to the characteristics of the three cities for example a the data sets from 2004 to 2012 2013 2014 and 2015 2017 in beijing were used for training test and validation respectively b the data sets of 2004 2010 2011 2016 and 2017 in tianjin were used for training test and validation respectively c the data sets of 2004 2012 2013 2014 and 2015 2017 in hebei were used for training test and validation respectively the results indicated that the sum squared errors in beijing tianjin and hebei were 6 2 7 6 and 1 4 in the training sets and 2 4 4 and 0 1 in the test sets respectively the parameter estimation of the input indicator was described in table 2 and the test sets based on ann method coincided well with the training sets as shown in fig 4 4 2 copula based correlation analysis in order to adapt to the marginal distribution function of water resources in bth region four distribution functions normal lognormal weibull and gamma distributions were applied in this study fig 5 after estimating parameters of four distribution functions the best edge distribution function can be obtained through the goodness of fit test the maximum likelihood method was used to analyze the parameters of distribution functions of water resources in bth and the k s test and rmse test are used to analyze the goodness of fit of edge distribution functions as shown in table 3 for k s test when h value is close to 0 and p value is greater than 0 05 in marginal distributions it indicates that the distribution function can reflect the statistical characteristics all distributions of total water resources in beijing and tianjin passed the k s test and the normal distribution of total water resources in hebei passed the k s test the rmse indicator was used to select the best fitted distribution functions the results of goodness of fit test in marginal distributions were described as follows a for beijing and tianjin compared with other distribution functions the rmse values of lognormal distribution functions were the smallest i e 2 85 10 5 and 2 86 10 5 respectively and that could be used to simulate the marginal distributions of water resources eqs 15a and 15b and b for hebei province the rmse values of the normal distribution function could be used to simulate the marginal distribution of water resources equation 15c 15a f x 1 0 33 x 2 π exp 1 2 ln x 3 34 2 0 1089 x 0 15b f x 1 0 29 x 2 π exp 1 2 ln x 2 73 2 0 0841 x 0 15c f x 1 19 8 2 π exp 1 2 x 155 72 2 392 04 x 0 where f x represents the probability value of the total water resources distribution function in the region and x represents different levels of total water resources after obtaining the marginal distribution functions of total water resources it is necessary to consider interactions of water resources allocation among adjacent regions copula functions were used to analyze the characteristics of the joint distributions in this study four copula functions i e gaussian gumbel clayton and frank were selected and the parameters of the functions were estimated by maximum likelihood method finally the empirical methods were used to test the goodness of fit in detail copula functions with the smallest square euclidean distance i e d2 could be regarded as the best fitted functions the results of parameter estimation in copula functions were described as follows table 4 compared with the scores in other copula functions the score of d2 between frank function and empirical copula function in terms of beijing tianjin was the smallest i e 0 0153 that could be selected as the best fitted copula function to simulate the joint distributions of water resources in beijing and tianjin under the same principle the clayton function with the smallest value 0 0139 and 0 0194 was selected as the best fitted copula function to simulate the joint distributions of water resources in beijing hebei and tianjin hebei respectively the joint distributions of water resources in beijing tianjin beijing hebei and tianjin hebei were described in eq 16 16a c fr u v 1 4 8213 ln 1 exp 4 8213 u 1 exp 4 8213 v 1 exp 4 8213 1 16b c cl u v u 0 5432 w 0 5432 1 1 0 5432 16c c cl v w v 0 7202 w 0 7202 1 1 0 7202 where cfr u v denotes the frank copula function of total water resources in beijing tianjin u represents the total water resources in beijing that satisfies lognormal distribution n 3 34 0 33 v represents the total water resources in tianjin with the lognormal distribution n 2 73 0 29 ccl u w is clayton copula function of total water resources in beijing hebei w represents the total water resources in hebei with the normal distribution n 155 72 19 80 and ccl v w is frank copula function of total water resources in tianjin hebei their probability density and cumulative distribution are shown in eq 17 and fig 6 17a c 1 p u 1 p v 1 p uv 17b c 1 p u 1 p w 1 p uw 17c c 1 p v 1 p w 1 p vw where puv puw and pvw are joint probabilities of water supply in beijing tianjin beijing hebei and tianjin hebei respectively 4 3 a multi objective chance constrained programming model the multi objective joint chance constrained programming model in bth was developed through combining with copula joint probability as risk control and considering 27 risk scenarios in economic agricultural water resources and environmental constraints the objectives included maximizing gdp minimizing water consumption and mitigating wastewater discharge in bth economic development targets water resources supply demand for industrial activities wastewater treatment were considered as the constraints thus based on source data from macro economy industrial structures water resources utilization wastewater discharge and food production table 5 the multi objective joint opportunity constrained programming model was described as follows 18a max f 1 j 1 3 i 1 3 a ij x ij 18b min f 2 j 1 3 i 1 3 x ij 18c min f 3 w j 1 3 i 1 3 b ij x ij 18d i 1 3 a ij x ij z j j 18e j 1 3 i 1 3 x ij w 18f pr i 1 3 x ij w j α j 1 p j j 18g j 1 3 c i j x i j u i i 18h b i j x i j y j i i j according to the water resources optimization model in equation 17 27 scenarios under joint probabilities of 0 05 0 1 and 0 15 were proposed as shown in table 6 these scenarios were obtained from the joint probabilities of copula functions the values of nine decision variables and the maximum values of three objective functions under different combinations were obtained 5 results and discussion 5 1 water resources allocations for multiple sectors under multiple risk scenarios the strategies of water resources allocation for economic sectors in beijing tianjin region under nexus risk were shown in fig 7 a and table 7 firstly agricultural water allocation would positively correlate with the nexus risk of beijing tianjin and tianjin as well as negatively correlate with the risk of beijing the maximum and minimum values of agricultural water allocation would be 19 34 and 17 663 billion m3 under the scenarios of s4 and s20 respectively secondly the impact of nexus risk on water allocation for industrial sector would be not obvious and industrial water allocation would positively correlate with the risk of beijing and negatively correlate with the risk of tianjin with the maximum and minimum values of 3 02 billion m3 under scenarios of s1 s6 and s14 and 2 27 billion m3 under all scenarios respectively thirdly agricultural water allocation would positively correlate with the nexus risk of beijing tianjin and risk of tianjin as well as negative correlate with risk of beijing the minimum and maximum values would be 3 41 billion m3 under the scenario of s4 and 3 42 billion m3 under all the scenarios respectively the optimized water resources allocation schemes for the economic sectors in beijing hebei region under nexus risk were shown in fig 7 b and table 8 the impact of water shortage risk in beijing and hebei would be not obvious agricultural water allocation would negatively correlate with the nexus risk of beijing hebei with the maximum and minimum values of 21 51 billion m3 under the scenario of s2 and 18 60 billion m3 under all the scenarios respectively in addition the impact of nexus risk of beijing hebei or risk of beijing and hebei on water allocation for industrial sector would be not obvious the optimized water allocation to service sector would positively correlate with the nexus risk of beijing hebei as well as negatively correlate with the risk of beijing and hebei the maximum and minimum water amount for service sector would be 3 42 billion m3 under the scenario of s27 and 3 38 billion m3 under the scenario of s1 respectively the strategies of water resources allocation for different sectors in tianjin hebei region under nexus risk were shown in fig 7 c and table 9 firstly water allocation for the agricultural sector would positively correlate with the nexus risk of hebei the impact of water shortage risk in tianjin hebei or tianjin on water allocation for the sector would be not obvious the corresponding maximum and minimum values for water resources allocation would be 19 32 billion m3 under the scenario of s1 and 16 53 billion m3 under the scenario of s27 respectively secondly the impact of nexus risk of tianjin hebei or risk of tianjin and hebei on water allocation for industrial sector would be not obvious and industrial water allocation amount would be 3 56 billion m3 thirdly water allocation for service sector would negatively correlate with the risk of tianjin and the impact of water shortage risk in tianjin hebei or hebei on the water allocation would be not obvious the maximum and minimum values for water resources allocation to service sector would be 3 43 billion m3 under the scenario of s27 and 3 39 billion m3 under the scenario of s1 respectively 5 2 water resources for multiple regions under multiple risk scenarios in general the water resources allocation to different sectors would be influenced by water shortage risk fig 8 a showed the total water resources allocation for beijing and tianjin under the nexus risk of beijing tianjin as the nexus risk increasing the total amount of water resources allocation would slightly decrease in beijing increase in tianjin and remain 18 16 billion m3 in hebei for beijing the maximum and minimum water values would be 5 8 billion m3 s4 s13 and s27 and 4 0 billion m3 s14 respectively and the related amount for tianjin would be 2 75 billion m3 s14 and 2 billion m3 s27 in addition the optimal total amount of water resources allocation for beijing and hebei under the nexus risk of beijing hebei the was shown in fig 8 b the total amount of water resources allocation for beijing would be varied from 17 6 to 20 9 billion m3 within the nexus risk of hebei beijing and 2 4 billion m3 within the nexus risk of tianjin beijing the maximum and minimum amount would be 5 8 billion m3 under s4 s13 and s27 and 4 billion m3 under s14 in beijing respectively moreover the total water resources allocation schemes for beijing and hebei under the nexus risk was shown in fig 8 c as the nexus risk increasing water resources allocated to beijing tianjin and hebei would remain 2 92 2 1 to 2 9 and 17 1 to 20 8 billion m3 respectively the objective values for water allocation management of bth urban agglomeration were described in table 10 the optimized gdp under the nexus risk of beijing and tianjin would remain 8514 billion yuan with the minimum water allocation amount of 25 billion m3 under s5 to s10 and s14 to s24 the total wastewater discharge amount would increase as the risk level increasing the minimum amount of wastewater discharge would be 2098 8 million m3 under s4 and the maximum amount would be 2101 4 million m3 under s20 and s21 in addition the optimal gdp would also remain 8514 billion yuan under the nexus risk of beijing hebei and tianjin hebei the amount of wastewater discharge would be varied from 2089 1 million m3 s1 to 2100 80 million m3 s27 under the nexus risk of beijing and hebei and form 2092 5 million m3 s1 to 2103 80 million m3 s27 under the nexus risk of tianjin and hebei 5 3 strengths and limitations of the methodology the integrated approach incorporating arima and ann methods copula functions and multi objective chance constrained programming could effectively analyze regional water resources allocation the study also has some limitations for future research directions firstly although the variations in water supply and demand were analyzed based on the methods of arima and ann the mechanisms of the variations could be theoretically explored secondly although joint probabilities of water resources among beijing tianjin and hebei were analyzed by bivariate copula functions the multiple dimensions of co relationship could be further considered based on multivariate copula functions thirdly more scenarios about urban socio economic development would be considered in the proposed optimization model despite these limitations the approach encompassing water shortage risks of urban agglomeration was valuable in terms of water allocation in urban agglomeration it could also be extended to investigate other environmental issues such as energy efficiency 6 conclusions in this study a hybrid integrated approach for water resources allocation under the nexus risk of water shortage was proposed arima method ann modelling copula functions and multi objective chance constrained programming was combined into a general framework the approach represented an improvement over the conventional methods for 1 analyzing the variations in regional water supply and demands through arima method 2 solving the interaction relationship between multi regional nexus water shortage risk through copula functions and 3 obtaining the desired water resources allocation strategies under multi scenario and scale conditions based on multi objective chance constrained programming model the approach was applied in a typical region of china i e bth urban agglomeration the optimum water resources utilization schemes were obtained for analyzing the trade off among economic development environmental protection and nexus risks in the adjacent regions the main results were described as follows a arima 5 2 1 arima 3 2 1 and ma 4 were proved to be the fitted models for water supply simulation in beijing tianjin and hebei b three input variables i e population gdp gross output value of agriculture could be suitable for water demand analysis with rational sum squared errors in the training sets i e 6 1 7 6 and 1 4 of beijing tianjin and hebei and the test sets 2 4 4 and 0 1 of beijing tianjin and hebei c frank function was suitable for modeling the nexus risk of water resources in beijing tianjin and the nexus risk in beijing hebei and tianjin hebei could be effectively simulated by clayton function d through considering 27 scenarios for the proposed optimization model the results indicated that the optimal gdp in bth would remain at 8514 billion yuan and the minimum amount of water allocation and wastewater discharge would be 24 26 billion m3 and 2100 2101 million m3 respectively credit authorship contribution statement yanpeng cai conceptualization methodology formal analysis funding acquisition hao wang data curation validation writing original draft wencong yue writing original draft validation visualization yulei xie supervision methodology validation visualization writing review editing qingtian liang investigation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was supported by the beijing municipal natural science foundation jq18028 and the national natural science foundation of china 51879007 and 41801203 the authors much appreciate the editor and the anonymous reviewers for their constructive comments and suggestions which are extremely helpful for improving the paper appendix a see tables a1 a3 
3858,growing agricultural and economic activities have brought tremendous pressure to regional water resources management considering the interactions of water resources allocation among adjacent regions with connected water systems it is necessary to pay attention to the unification of socio economic development and environmental protection between the regions this is of significance to many agglomeration areas that are composed of multiple large cities such as the beijing tianjin hebei urban agglomeration bth in china in this research an ensemble approach was proposed to tackle water resources allocation problems under the constraints of water resources to reflect interdependence of the composed three areas i e beijing tianjin and hebei the approach included arima autoregressive integrated moving average method ann artificial neural network modelling copula functions and multi objective chance constrained programming model it can 1 reflect the variations characteristic of regional water supply and demands 2 solve the interactions between multi regional water resources and 3 obtain desired water resources allocation strategies under multi scenario and scale conditions then the approach was applied in typical regions of china i e beijing tianjin hebei urban agglomeration considering 27 scenarios of the nexus water shortage risk multi objective joint opportunity constraint programming model aimed at maximizing economic benefits and ecological benefits in combination with economic agricultural water resources and environmental constraints as the optimal strategies indicated the maximum gdp in bth would remain at 8514 billion yuan the minimum amount of water allocation and wastewater discharge would be 24 26 billion m3 and 2100 2101 million m3 respectively keywords copula function multi objective programming nexus risks beijing tianjin hebei urban agglomeration 1 introduction freshwater is fundamental for economic and social development of human beings chen et al 2017 dong and xu 2019 zhang et al 2018b due to continuously economic growth population increase and living standard improvement water demand in many countries is rising and it is believed that half of the world s population might suffer severe freshwater stresses by 2030 unep 2015 this is of extreme significance to areas that are under rapid urbanization and booming industrialization such as the beijing tianjin hebei bth urban agglomeration in china in such a region under rapid socio economic development the increasing development for agricultural and industrial production has brought tremendous pressure on water resources management yang et al 2017 sun et al 2019 there is a need to propose scientific evaluation of water supply and demand based on regional population and industrial structure and to provide strategies for policy makers especially in northern china chen et al 2020b kattel et al 2021 also more water import from beyond their jurisdictions for satisfying regional demand van den brandeler et al 2019 potential water stresses thus need to be paid attention to considering the effects of physical water transfer projects e g the south to north water diversion project in china liu et al 2020b traditionally water resources allocation considered the constraints of water supply and demand xiong et al 2020 and seldom focused on the joint optimal utilization of water resources among multiple regions thus it is urgent to analyze optimizing strategies on water allocation in consideration of correlated utilization of water resources between adjacent regions widespread application of urban water management required socio economic transition in urban water sector bos et al 2013 previously water allocation can be undertaken through decision making systems market based systems or a combination of the two zhao et al 2013 recently water trading markets were still difficult to establish in many countries within political technical and geographical barriers arellano gonzalez et al 2021 zhang 2007 in terms of market based systems economic cost in water allocation e g water supply demand and storage should be analyzed with the framework of allocation mechanisms and transaction costs brennan 2010 brooks and harris 2008 in terms of decision making systems du et al 2021 explored the joint impacts of the inequality of water permit allocation and farmers behaviors on market performance integration of economic models with optimizing models could effectively find desired solutions of stakeholders for water allocation in consideration of economic environmental and social benefits king et al 2019 in water resources management systems multiple uncertainties existed such as varied water supply and demand options in both short and long term planning due to errors or ambiguity in data and their interactions with fluctuating natural and socio economic conditions ma et al 2020 zhu et al 2019 for example water infrastructure planning linked with urban development and evolved through time bach et al 2015 thus judgments by expert and local stakeholders should be considered in water resources management moglia et al 2012 particularly the vulnerability of water resources would amplify due to rising demands related to economic growth expanding populations and climate change jin et al 2020 ranjan 2010 influenced by climate change and population growth theses uncertain factors would finally lead to water shortage risk and influence the suitability of strategies in water allocation keath and brown 2009 in detail the water shortage risk can be estimated by the probability of exceeding acceptable level of water shortage under future variability between water supply and demand hussien et al 2018 previously multiple uncertainty risk analysis methods were introduced into water resources management for example scenario analysis was regarded as an effective way to analyze possible future events in consideration of future uncertain outcomes zeng et al 2019 influenced by human activities and climate change the non stationary features in hydrological variables should be considered in the framework of risk assessment chebana and ouarda 2021 ahn and palmer 2016 thus the features were paid attention by a number of hydrological studies in terms of flood process daneshkhah et al 2016 luo et al 2021 hydrological forecasting liu et al 2021 watershed precipitation brodeur and steinschneider 2021 abbasian et al 2021 and drought severity especially under the background of climate change montaseri et al 2018 in order to model the characteristics copula functions were regarded as one of effective and flexible methods to explore statistical dependence between two or more random variables e g precipitation floods and droughts yu et al 2019 nguyen huy et al 2017 for example nguyen huy et al 2018 employed copula functions for analyzing relationships between multiple large scale climate scenarios and crop yield balistrocchi et al 2019 found the mutual correlation between flood peak and duration can be properly expressed by one of copula functions i e clayton copula tu et al 2018 and shan et al 2021 explored the joint distributions of sub regional precipitation based on multi dimensional copula functions temporal dependence features of precipitation and runoff were described based on time varying copula functions zhang et al 2021a meanwhile copula functions can build multivariate joint probability distribution and explore the correlation between available transfer water and local surface water gao et al 2018 liu et al 2020a as the interrelated uncertain variations caused the joint risk of nexus systems the reliability of decision making would be influenced remarkably zhang et al 2021b dealing with the joint probability distributions in water and energy nexus systems copula functions can also further support coordinated decision making under uncertainties cai et al 2021 although the risk assessment methods have been widely applied in water resources management previous studies rarely considered the complicated correlation in water supply and demands wang et al 2019 romero lankao and norton 2018 thus it is necessary to recognize the complicated interactions among water supply and demands with socio economic development and to transfer the interactions into water resources management li et al 2020a allocation of water resources was often regarded as an expression of conflicts with socio economic activities kallis and zografos 2014 for example the human induced water scarcity was greatly influenced by economic activities and urbanization in beijing tianjin hebei bth mega region li et al 2020b however traditional classic hydro economic models were not effectively recognized the dynamic interactions between socio economic activities and water resources allocation paim et al 2019 thus effective and robust optimization models were required to allocate water resources under considering the synergies and trade offs of multiple sectors and inherent uncertainties jin et al 2020 xie et al 2018 proposed an inexact two stage stochastic downside risk aversion programming for regional industrial water resources allocation considering various environment control strategies zhang et al 2020b advanced a stochastic fuzzy based fractional programming for water resources allocation management and soil salinity control under uncertainty specially as an effective stochastic mathematical programming method chance constrained programming ccp model was suitable for identifying occasions in the presence of an abundant source of information zhang et al 2019 for example zhang et al 2020a proposed a multi objective chance constrained programming approach for solving planning problems with uncertain weights in agricultural water management although many previous studies focused on the water resource allocation and water shortage risk there is a lack of research in the following aspects a identification of variations in water demands influenced by socio economic development b evaluation of interactions in water supply between adjacent regions and c establishment of adaptive strategies on water allocation in the perspective of risk aversion therefore the objective of this study was to propose a hybrid integrated approach to recognize dynamic interactions between socio economic activities and water resources allocation and to transfer the interactions into water resources management model in detail the approach can a evaluate variations in water demands and correlation of water supply in adjacent regions b transfer the variations and correlation in water demands and supply into a multi objective programming model and c obtain adaptive strategies of water allocation in consideration of water shortage risk in adjacent regions the approach will then be applied in a typical region of china i e bth urban agglomeration copula functions will be introduced to describe the nexus water shortage risk considering interaction and dependence in the region 2 concepts and quantification spatially coupled water shortage risks an integrated approach is proposed to analyze the nexus risks in water resources management system through coupled with autoregressive integrated moving average arima artificial neural network ann copula functions and multi objective chance constrained programming model the general schematic framework is shown in fig 1 water shortage risk in an urban cluster can be recognized under four stages i e data collection uncertainty analysis correlation analysis and optimization management water shortage risk is attributed to the variations between water demands and supply in addition arising from interactions of water supply in urban clusters nexus risks of water resources can be emphasized based on the nexus distributions of water allocation among adjacent cities chen et al 2020a the nexus studies related to water resources are fundamentally concerned with future uncertainty engaging with complicated water management systems as well as its concern with the trajectories of human communities and water resources in multiple regions yung et al 2019 cities are open systems due to their flexible boundaries and they operate around dynamic equilibrium conditions comino et al 2020 physical water transfer projects in trans regions link related adjacent cities in terms of water supply the vulnerability of water demands is also increasingly related to economic development population growth and climate change water shortage risk would occur and have a negative effect on water allocation nexus risks are defined as a set of distributions in consideration of linkages between water supply and demands with two or more natural or socio economic conditions thus the nexus risks should be addressed through reflecting the complexities in inter linkages with water demands or supply socio economic development and regional water transfer the nexus risk analysis aims to identify the probability of exceeding acceptable level of water shortage in a year with a certain time horizon in this context the variability in water demands and supply should be considered there are two strategies to identify the nexus risks one is to couple well established system models where the output of one feeds the input of the other in a one way or iterative process and the other is the holistic approach which internally represents all interactions within a single model payet burin et al 2019 nexus risks focus on the interactions of water demand and supply between adjacent regions copula functions can be used to construct multivariate joint probability distributions according to the multi distribution features of the regions scenario analysis can be introduced to analyze possible future changes in socio economic conditions in order to strengthen decision making for mitigating water shortage nexus risk the nexus risk needs to be incorporated into an optimization model traditionally the optimization model aims at the minimum cost or maximum benefit for identifying optimal water allocation solutions in order to systematically address complexities across correlated water supply among adjacent regions the optimization model would identify the nexus risk distribution in water supply or demand also targets for economic development and environmental protection should be incorporated into the optimization model in combination with economic agricultural water resources and environmental constraints specifically a multi objective chance constrained programming model could identify probability of random events e g water supply the desired strategies can thus directly support for mitigating water shortage nexus risk in adjacent regions 3 methodology 3 1 method of autoregressive integrated moving average arima arima was proposed by box and jenkins 1976 the autoregressive model describes the relationship between current and historical values and predicts itself with the historical time data of the variable itself the autoregressive model must meet the requirements of stationary arima is a generalization of the auto regressive ar model which uses three tools to model sequence correlation in interference the ar 1 model uses only first order terms but in general other higher order terms can be used a p order autoregressive model has the following form 1 x t α 1 x t 1 α 2 x t 2 α 3 x t 3 α p x t p ε t where xt indicates the tth value of random variable in water supply i e x εt is error term and αt is autocorrelation coefficient each integration order corresponds to the difference in the predicted sequence the first order integrated component means that the prediction model is designed for the first difference in the original sequence the second order component corresponds to the use of second order difference and so on the error lag value is used to correct the prediction accuracy of the buy model and the number of recent errors used is equal to the order the form of ma q is described as follows 2 x t ε t θ 1 ε t 1 θ 2 ε t 2 θ q ε q 2 where θt is the coefficient of εt the autoregressive and moving average specifications can be combined to form the arma p q standard form based on the following equation 3 x t α 1 x t 1 α 2 x t 2 α 3 x t 3 α p x t p θ 1 ε t 1 θ 2 ε t 2 θ q ε q 2 the simulation process is divided into four steps data preprocessing stationary test model establishment and model test zheng et al 2018 shao et al 2017 after specifying the functions of the arima model parameters of these functions can be estimated once the appropriate model is selected and its parameters are estimated the model s residuals are checked based on box jenkins method to verify suitability of the series diagnostic tests are used to determine whether the residuals of the selected arima models in the acf autocorrelation function and pacf partial autocorrelation function maps are independent homoscedastic or normally distributed if the same variance and normality assumptions were not provided the observations would be converted by the generalized power transformation method 3 2 method of artificial neural network ann one of typical machine learning methods i e artificial neural network ann modeling was applied to analyze water demands of users back propagation bp was introduced for learning algorithm in ann application uzlu et al 2014 this training algorithm is a technique that helps distribute the error in order to obtain predicted values with minimum error singh et al 2009 the bp neural network is composed of an input layer a hidden layer and an output layer zhang et al 2018a in detail data outputs of water demands i e yi are obtained by data inputs i e xk through the connection links in ann their transfer coefficients are calculated by connection weights i e wki and the value of an activation function i e f is described in equation 4 zeng et al 2012 the output values i e y are obtained based on initially random weights compared with the desired output tl the computed error i e e is back propagated through the original network and the indicators of wki are updated through the training process then the indicators of wki and e are gradually adjusted the training process is repeated when the indicator of error satisfies the desired value before training the matrixes of x x1 x2 xk and y y1 y2 yk are regarded as the input and the output vectors respectively in this study the input matrix includes the related socio economic indicators e g population gdp and output values of agricultural industrial and service sectors and the output matrix includes the related indicators in water supply i e ot 4 y i f k 1 m x k w ki θ i where θi is threshold value which must be exceeded for node to be activated a commonly used activation function throughout neural network literature is the sigmoid function which can be expressed as 5 f x 1 1 e x where x represents the summation result from eq 4 similarly the output signal vector of the output layer is shown as follows 6 o t f i t li y i θ l where ot is output signal vector of output layers tli is the connection weights between hidden and output layers the suitability of parameters is evaluated using a network error function such as the sum of squared errors between the predicted and desired output vector eq 7 7 e 1 n m j 1 n l 1 m t l o t 2 where e is the network error function tl is the desired output vector 3 3 copula functions in probability theory two dimensional random vector trv multivariate random vector mrv joint distribution function jdf and marginal distribution function mdf are important concepts establishing the corresponding relationship between edge and joint distributions requires to further analyze the probability characteristics of correlated parameters at the same time the word copula comes from the latin word link or bond invented by sklar in copula theory a joint distribution function of correlated parameters can be decomposed into edge distribution functions and copula function regarded as connection functions copulas connect the joint distributions with their respective edge distributions copula functions can be expressed as 8 c θ u v c θ f x x f y y where θ is the parameter of copula function x and y are random variables fx x and fy y are the marginal distribution functions of two random variables archimedean copula functions i e gaussian gumbel clayton and frank are widely applied in water resources management shown in equation 9 9 c u v ϕ 1 ϕ u ϕ v the maximum likelihood function is used to estimate the parameter θ of the copula function the likelihood function is shown as follows 10a ln c θ u v ln u v θ 1 ln ln u ln v w 1 θ ln w 2 θ 2 θ 1 w 1 θ 2 10b w ln u θ ln v θ where cθ is a copula function and u and v are the marginal distributions of random variables x and y respectively then the parameters in copula functions are expressed as follows 11 θ argmax i 1 n ln c θ u i v i after obtaining the estimated results of the parameters in the selected copula functions it is necessary to evaluate the performance of copula functions to determine the advantages and disadvantages of the model in this study empirical method is used to test the goodness of fit in order to select the optimal joint distribution function if fn x and gn y are empirical distributions then empirical copula is described in equation 12 12 c 0 u v 1 n i 1 n i f n x i u i g n y i v u v 0 1 where i is a demonstrative function when fn xi u i fn xi u 1 and when fn xi u i fn xi u 0 similarly when gn yi v i gn yi v 1 and when gn yi v i gn yi v 0 square euclidean distance i e d2 can reflect the fitting degree of copula function and actual value the smaller the distance indicates the better fitting degree square euclidean distance is evaluated based on eq 13 13 d 2 i 1 n c u v c 0 u v 2 where c u v is the selected copula function and c0 u v is the empirical copula function 3 4 multi objective chance constrained programming considering the interactions among adjacent regions a multi objective chance constrained programming model is proposed for effectively allocating water resources as follows 14a max f 1 j 1 n i 1 m a ij x ij 14b min f 2 j 1 n i 1 m x ij 14c min f 3 w j 1 n i 1 m b ij x ij 14d i 1 m a ij x ij z j j 14e j 1 n i 1 m x ij w 14f pr i 1 n x ij w j α j 1 p j j 14g j 1 n i 1 m c i j x i j u i i 14h i 1 m b i j x i j y j i i j where f1 is total economic benefit of regions αij is economic benefit per unit of water supply in the ith sector of the jth region xij is water allocation to the ith sector of the jth region f2 is total water supply to regions f3 is total wastewater discharge of sectors in the regions bij is wastewater discharge per unit of water supply in the ith sector of the jth region zj is industrial economic target in the jth region w is total water supply in the regions wj is the amount of water supply in the jth regions which is obtained by copula functions assuming the condition that the constraint is satisfied with at least a probability of αj the probability that the constraints can be violated is described as pi ma et al 2020 zhang et al 2019 c i j indicates the i th grain crop yield per unit of water supply in i th grain crop u is the target for grain production in the regions and b i j is wastewater discharge per unit of water supply in the i th industrial sector of the jth region 4 case study located in north china the urban agglomeration of bth 36 02 n 42 62 n 113 06 e 119 88 e is national political economic and cultural center fig 2 the region is lack of water resources and the per capita water capacity was only 11 11 of national average the average annual rainfall in bth is about 540 mm much smaller than minimum water requirement i e 748 mm previously the cumulative groundwater overexploitation has exceeded 155 billion m3 water resources from local surface and underground water groundwater cannot meet the increasing demand the limited water resources i e 1 01 of total water resources in china supported 7 24 of national population and 10 of national gdp although the south to north water transfer project has promoted the capability of water supply increasing water demand of socio economic activities would still pose challenges to sustainable allocation of water resources therefore it is of great strategic significance to rationally optimize water resources in the region 4 1 water supply and demand simulation the water supply of the three regions of beijing tianjin and hebei are simulated by the arima p d q model the indexes of p d and q were the number of auto regression indicators difference order for component stationary and the items of moving average ma data sets of 67 years i e from 1951 to 2017 were incorporated in the model of autoregressive integrated moving average arima new data sets obtained then from the arima model were compared with the original data sets based on box jenkins method to verify suitability of the series considering the distribution features of water supply in beijing and tianjin the bic bayesian information criterion values of arima with the nine combinations were calculated as shown in table 1 also the index of q was considered in ma model for water supply simulation of hebei province similarly the bic values of ma with q 3 4 8 were calculated and the results indicated that the lower of bic values in arima and ma models the higher fitting degree the goodness of fit test of arima 5 2 1 arima 3 2 1 and ma 4 models also applied suitability the models for water supply simulation fig 3 water demand simulation was proposed based on ann method the indicators of population gdp and gross output value of agriculture were chosen as input variables tables a1 a3 in the section of appendix a the 14 sample sets from 2004 to 2017 were divided as training test and cross validation sets according to the characteristics of the three cities for example a the data sets from 2004 to 2012 2013 2014 and 2015 2017 in beijing were used for training test and validation respectively b the data sets of 2004 2010 2011 2016 and 2017 in tianjin were used for training test and validation respectively c the data sets of 2004 2012 2013 2014 and 2015 2017 in hebei were used for training test and validation respectively the results indicated that the sum squared errors in beijing tianjin and hebei were 6 2 7 6 and 1 4 in the training sets and 2 4 4 and 0 1 in the test sets respectively the parameter estimation of the input indicator was described in table 2 and the test sets based on ann method coincided well with the training sets as shown in fig 4 4 2 copula based correlation analysis in order to adapt to the marginal distribution function of water resources in bth region four distribution functions normal lognormal weibull and gamma distributions were applied in this study fig 5 after estimating parameters of four distribution functions the best edge distribution function can be obtained through the goodness of fit test the maximum likelihood method was used to analyze the parameters of distribution functions of water resources in bth and the k s test and rmse test are used to analyze the goodness of fit of edge distribution functions as shown in table 3 for k s test when h value is close to 0 and p value is greater than 0 05 in marginal distributions it indicates that the distribution function can reflect the statistical characteristics all distributions of total water resources in beijing and tianjin passed the k s test and the normal distribution of total water resources in hebei passed the k s test the rmse indicator was used to select the best fitted distribution functions the results of goodness of fit test in marginal distributions were described as follows a for beijing and tianjin compared with other distribution functions the rmse values of lognormal distribution functions were the smallest i e 2 85 10 5 and 2 86 10 5 respectively and that could be used to simulate the marginal distributions of water resources eqs 15a and 15b and b for hebei province the rmse values of the normal distribution function could be used to simulate the marginal distribution of water resources equation 15c 15a f x 1 0 33 x 2 π exp 1 2 ln x 3 34 2 0 1089 x 0 15b f x 1 0 29 x 2 π exp 1 2 ln x 2 73 2 0 0841 x 0 15c f x 1 19 8 2 π exp 1 2 x 155 72 2 392 04 x 0 where f x represents the probability value of the total water resources distribution function in the region and x represents different levels of total water resources after obtaining the marginal distribution functions of total water resources it is necessary to consider interactions of water resources allocation among adjacent regions copula functions were used to analyze the characteristics of the joint distributions in this study four copula functions i e gaussian gumbel clayton and frank were selected and the parameters of the functions were estimated by maximum likelihood method finally the empirical methods were used to test the goodness of fit in detail copula functions with the smallest square euclidean distance i e d2 could be regarded as the best fitted functions the results of parameter estimation in copula functions were described as follows table 4 compared with the scores in other copula functions the score of d2 between frank function and empirical copula function in terms of beijing tianjin was the smallest i e 0 0153 that could be selected as the best fitted copula function to simulate the joint distributions of water resources in beijing and tianjin under the same principle the clayton function with the smallest value 0 0139 and 0 0194 was selected as the best fitted copula function to simulate the joint distributions of water resources in beijing hebei and tianjin hebei respectively the joint distributions of water resources in beijing tianjin beijing hebei and tianjin hebei were described in eq 16 16a c fr u v 1 4 8213 ln 1 exp 4 8213 u 1 exp 4 8213 v 1 exp 4 8213 1 16b c cl u v u 0 5432 w 0 5432 1 1 0 5432 16c c cl v w v 0 7202 w 0 7202 1 1 0 7202 where cfr u v denotes the frank copula function of total water resources in beijing tianjin u represents the total water resources in beijing that satisfies lognormal distribution n 3 34 0 33 v represents the total water resources in tianjin with the lognormal distribution n 2 73 0 29 ccl u w is clayton copula function of total water resources in beijing hebei w represents the total water resources in hebei with the normal distribution n 155 72 19 80 and ccl v w is frank copula function of total water resources in tianjin hebei their probability density and cumulative distribution are shown in eq 17 and fig 6 17a c 1 p u 1 p v 1 p uv 17b c 1 p u 1 p w 1 p uw 17c c 1 p v 1 p w 1 p vw where puv puw and pvw are joint probabilities of water supply in beijing tianjin beijing hebei and tianjin hebei respectively 4 3 a multi objective chance constrained programming model the multi objective joint chance constrained programming model in bth was developed through combining with copula joint probability as risk control and considering 27 risk scenarios in economic agricultural water resources and environmental constraints the objectives included maximizing gdp minimizing water consumption and mitigating wastewater discharge in bth economic development targets water resources supply demand for industrial activities wastewater treatment were considered as the constraints thus based on source data from macro economy industrial structures water resources utilization wastewater discharge and food production table 5 the multi objective joint opportunity constrained programming model was described as follows 18a max f 1 j 1 3 i 1 3 a ij x ij 18b min f 2 j 1 3 i 1 3 x ij 18c min f 3 w j 1 3 i 1 3 b ij x ij 18d i 1 3 a ij x ij z j j 18e j 1 3 i 1 3 x ij w 18f pr i 1 3 x ij w j α j 1 p j j 18g j 1 3 c i j x i j u i i 18h b i j x i j y j i i j according to the water resources optimization model in equation 17 27 scenarios under joint probabilities of 0 05 0 1 and 0 15 were proposed as shown in table 6 these scenarios were obtained from the joint probabilities of copula functions the values of nine decision variables and the maximum values of three objective functions under different combinations were obtained 5 results and discussion 5 1 water resources allocations for multiple sectors under multiple risk scenarios the strategies of water resources allocation for economic sectors in beijing tianjin region under nexus risk were shown in fig 7 a and table 7 firstly agricultural water allocation would positively correlate with the nexus risk of beijing tianjin and tianjin as well as negatively correlate with the risk of beijing the maximum and minimum values of agricultural water allocation would be 19 34 and 17 663 billion m3 under the scenarios of s4 and s20 respectively secondly the impact of nexus risk on water allocation for industrial sector would be not obvious and industrial water allocation would positively correlate with the risk of beijing and negatively correlate with the risk of tianjin with the maximum and minimum values of 3 02 billion m3 under scenarios of s1 s6 and s14 and 2 27 billion m3 under all scenarios respectively thirdly agricultural water allocation would positively correlate with the nexus risk of beijing tianjin and risk of tianjin as well as negative correlate with risk of beijing the minimum and maximum values would be 3 41 billion m3 under the scenario of s4 and 3 42 billion m3 under all the scenarios respectively the optimized water resources allocation schemes for the economic sectors in beijing hebei region under nexus risk were shown in fig 7 b and table 8 the impact of water shortage risk in beijing and hebei would be not obvious agricultural water allocation would negatively correlate with the nexus risk of beijing hebei with the maximum and minimum values of 21 51 billion m3 under the scenario of s2 and 18 60 billion m3 under all the scenarios respectively in addition the impact of nexus risk of beijing hebei or risk of beijing and hebei on water allocation for industrial sector would be not obvious the optimized water allocation to service sector would positively correlate with the nexus risk of beijing hebei as well as negatively correlate with the risk of beijing and hebei the maximum and minimum water amount for service sector would be 3 42 billion m3 under the scenario of s27 and 3 38 billion m3 under the scenario of s1 respectively the strategies of water resources allocation for different sectors in tianjin hebei region under nexus risk were shown in fig 7 c and table 9 firstly water allocation for the agricultural sector would positively correlate with the nexus risk of hebei the impact of water shortage risk in tianjin hebei or tianjin on water allocation for the sector would be not obvious the corresponding maximum and minimum values for water resources allocation would be 19 32 billion m3 under the scenario of s1 and 16 53 billion m3 under the scenario of s27 respectively secondly the impact of nexus risk of tianjin hebei or risk of tianjin and hebei on water allocation for industrial sector would be not obvious and industrial water allocation amount would be 3 56 billion m3 thirdly water allocation for service sector would negatively correlate with the risk of tianjin and the impact of water shortage risk in tianjin hebei or hebei on the water allocation would be not obvious the maximum and minimum values for water resources allocation to service sector would be 3 43 billion m3 under the scenario of s27 and 3 39 billion m3 under the scenario of s1 respectively 5 2 water resources for multiple regions under multiple risk scenarios in general the water resources allocation to different sectors would be influenced by water shortage risk fig 8 a showed the total water resources allocation for beijing and tianjin under the nexus risk of beijing tianjin as the nexus risk increasing the total amount of water resources allocation would slightly decrease in beijing increase in tianjin and remain 18 16 billion m3 in hebei for beijing the maximum and minimum water values would be 5 8 billion m3 s4 s13 and s27 and 4 0 billion m3 s14 respectively and the related amount for tianjin would be 2 75 billion m3 s14 and 2 billion m3 s27 in addition the optimal total amount of water resources allocation for beijing and hebei under the nexus risk of beijing hebei the was shown in fig 8 b the total amount of water resources allocation for beijing would be varied from 17 6 to 20 9 billion m3 within the nexus risk of hebei beijing and 2 4 billion m3 within the nexus risk of tianjin beijing the maximum and minimum amount would be 5 8 billion m3 under s4 s13 and s27 and 4 billion m3 under s14 in beijing respectively moreover the total water resources allocation schemes for beijing and hebei under the nexus risk was shown in fig 8 c as the nexus risk increasing water resources allocated to beijing tianjin and hebei would remain 2 92 2 1 to 2 9 and 17 1 to 20 8 billion m3 respectively the objective values for water allocation management of bth urban agglomeration were described in table 10 the optimized gdp under the nexus risk of beijing and tianjin would remain 8514 billion yuan with the minimum water allocation amount of 25 billion m3 under s5 to s10 and s14 to s24 the total wastewater discharge amount would increase as the risk level increasing the minimum amount of wastewater discharge would be 2098 8 million m3 under s4 and the maximum amount would be 2101 4 million m3 under s20 and s21 in addition the optimal gdp would also remain 8514 billion yuan under the nexus risk of beijing hebei and tianjin hebei the amount of wastewater discharge would be varied from 2089 1 million m3 s1 to 2100 80 million m3 s27 under the nexus risk of beijing and hebei and form 2092 5 million m3 s1 to 2103 80 million m3 s27 under the nexus risk of tianjin and hebei 5 3 strengths and limitations of the methodology the integrated approach incorporating arima and ann methods copula functions and multi objective chance constrained programming could effectively analyze regional water resources allocation the study also has some limitations for future research directions firstly although the variations in water supply and demand were analyzed based on the methods of arima and ann the mechanisms of the variations could be theoretically explored secondly although joint probabilities of water resources among beijing tianjin and hebei were analyzed by bivariate copula functions the multiple dimensions of co relationship could be further considered based on multivariate copula functions thirdly more scenarios about urban socio economic development would be considered in the proposed optimization model despite these limitations the approach encompassing water shortage risks of urban agglomeration was valuable in terms of water allocation in urban agglomeration it could also be extended to investigate other environmental issues such as energy efficiency 6 conclusions in this study a hybrid integrated approach for water resources allocation under the nexus risk of water shortage was proposed arima method ann modelling copula functions and multi objective chance constrained programming was combined into a general framework the approach represented an improvement over the conventional methods for 1 analyzing the variations in regional water supply and demands through arima method 2 solving the interaction relationship between multi regional nexus water shortage risk through copula functions and 3 obtaining the desired water resources allocation strategies under multi scenario and scale conditions based on multi objective chance constrained programming model the approach was applied in a typical region of china i e bth urban agglomeration the optimum water resources utilization schemes were obtained for analyzing the trade off among economic development environmental protection and nexus risks in the adjacent regions the main results were described as follows a arima 5 2 1 arima 3 2 1 and ma 4 were proved to be the fitted models for water supply simulation in beijing tianjin and hebei b three input variables i e population gdp gross output value of agriculture could be suitable for water demand analysis with rational sum squared errors in the training sets i e 6 1 7 6 and 1 4 of beijing tianjin and hebei and the test sets 2 4 4 and 0 1 of beijing tianjin and hebei c frank function was suitable for modeling the nexus risk of water resources in beijing tianjin and the nexus risk in beijing hebei and tianjin hebei could be effectively simulated by clayton function d through considering 27 scenarios for the proposed optimization model the results indicated that the optimal gdp in bth would remain at 8514 billion yuan and the minimum amount of water allocation and wastewater discharge would be 24 26 billion m3 and 2100 2101 million m3 respectively credit authorship contribution statement yanpeng cai conceptualization methodology formal analysis funding acquisition hao wang data curation validation writing original draft wencong yue writing original draft validation visualization yulei xie supervision methodology validation visualization writing review editing qingtian liang investigation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was supported by the beijing municipal natural science foundation jq18028 and the national natural science foundation of china 51879007 and 41801203 the authors much appreciate the editor and the anonymous reviewers for their constructive comments and suggestions which are extremely helpful for improving the paper appendix a see tables a1 a3 
3859,most mountain catchments worldwide are exploited for hydropower production causing significant alterations of their natural regime hydrological and water resources modelling in these catchments is challenging because the alterations of natural streamflow caused by hydropower production are often significant while capturing their variability in space and time requires critical data concerning the hydraulic infrastructures and their operational schedules these data are difficult to acquire thereby hindering the possibility to correctly simulate the complex interaction between the natural hydrological cycle and water uses to overcome these limitations we propose a framework that relies solely on publicly available data which provides accurate simulation of both streamflow and hydropower production the proposed framework is illustrated by means of the hyperstreamhs hydrological model applied to the adige catchment a large watershed of the south eastern alpine region whose streamflow is strongly impacted by 39 large hydropower systems 22 of which connected to storage reservoirs with an overall mean annual production that accounts for about 14 of the total italian hydropower production we analyzed the impact on modelled hydropower production of commonly adopted simplifications in the production schedule as well as of the hydropower systems which are often characterized by a complex infrastructure with several interlinked derivations and conveyance intakes our simulations highlight how an accurate topological representation of hydraulic infrastructures is crucial to correctly represent water transfers more important than capturing the operational schedules when reservoir oscillations are a small fraction of the total head on the contrary scheduling is important for systems in which reservoir oscillations account for a significant portion of the total head furthermore we show that simplifications motivated by difficulties in data collection combine in a non linear manner with an overall impact difficult to assess we propose this framework for accurate modelling of hydropower production at regional and national scales particularly in studies dealing with the projection of climate change and competing uses on water resources and renewable energy keywords water resources management large scale hydrological modelling hydropower production reservoir modelling hydraulic infrastructures 1 introduction electricity demand has more than doubled since 1990 and it is expected to increase further in the near future due to population growth un 2019 and to the progressive decarbonization of transportation housing and energy intensive industrial sectors iea 2018 hydropower is an important energy source satisfying more than 19 of electricity demand worldwide iea 2018 akpinar 2013 with storage reservoir hydropower being the only renewable energy source res that ensures reliable long term storage capacity barton et al 2004 for these characteristics hydropower is expected to play an important role in the future evolution of the electricity market helping to ensure a smooth transition to a green energy economy the main adverse effect of hydropower is the loss of freshwater ecosystem services whose evaluation catalyzed a wealth of attention see e g simonov et al 2019 yu 2017 wang et al 2010 measures are today available to attenuate these losses see e g malm renöfält et al 2010 gabbud and lane 2016 though scenarios with progressive decommissioning of reservoirs in favor of a more diffuse use of solar and wind energy have been recently envisioned waldman et al 2019 although less than other res hydropower production is uncertain because of the inherent variability of streamflow at multiple temporal and spatial scales moreover climate change is expected to increase this variability and may act in combination with competing uses to modify timing and amount of water volumes available for electricity production smajgl et al 2016 anghileri et al 2018 zhang et al 2018 these two external effects may be in synergy in some regions and in opposition in others depending on the local effect of climate change and evolution of water demand for other uses or changes of water use policies in this context hydrological modelling is a viable tool to project the impact of these foreseen changes on future hydropower production and evaluate the effects of modifications in the management strategies aimed at mitigating the above adverse effects indeed in the last decades hydrological modelling has been applied at regional and larger scales often involving complex parameterizations with the objective of representing at high spatio temporal resolution the interplay between biotic and abiotic processes controlling the dynamics of the earth s critical zone see e g sharif et al 2007 wada et al 2016 zierl and bugmann 2005 however climate change is not the only driver of change for water resources as the projected increase of water use for agriculture energy and other sectors is creating concerns as well bieber et al 2018 destouni et al 2013 indeed the effects on water resources of climate change and water uses are difficult to disentangle given that their interaction may give rise to nonlinear effects which analysis requires information on water uses at a level of detail difficult to achieve bellin et al 2016 mallucci et al 2019 hydropower is the dominant water use in mountain regions and its inclusion into hydrological models requires an adequate description of the hydraulic systems and of their interaction with the natural components of the hydrological cycle nazemi and wheater 2015 nazemi and wheater 2015 operations of run of the river systems are strictly dependent on streamflow timing while storage hydropower can modulate its activity to minimize the adverse impacts of climate change and maximize revenue moreover modelling climate change impacts and the effects of changes in water demand on storage hydropower systems requires the introduction of operational constraints as well as suitable production schedules for each hydropower system unfortunately these data are difficult to acquire because they are often kept confidential by the hydropower companies in this situation management strategies should be inferred from other sources in principle expert knowledge may suggest a suitable functional form of the water used for hydropower production with the parameters calibrated according to a given objective function however this approach adds parameters to models that often are already overparameterized thereby increasing the computational cost and uncertainty due to equifinality beven and binley 1992 as a consequence when a large number of hydropower systems should be modeled management rules are assumed a priori according to available constraints i e the hydraulic capacity of the hydropower system and the topology of the hydropower system is often simplified depending on the available information several deterministic approaches have been adopted in the literature to model reservoir operations such as e g hedging curve rules and target volume approach the first approach provides partitioning factors for satisfying the downstream demand from agricultural hydropower and water supply uses according to prioritization rules set by the water manager see e g shrestha et al 2014 guo et al 2013 tu et al 2003 this approach considers the seasonality of water inflows and might provide good results but a limitation emerges in the definition of the downstream demand which has to be known for all hydropower systems being modelled as well as the hedging thresholds and coefficients the target volume approach is often preferred for its simplicity see e g fatichi et al 2015 finger et al 2012 in this case 365 daily target volumes are assigned and turbined flows are determined as a function of the difference between current and target volumes the computation of target volumes can either be based on averaged observations if available otherwise it is based on reservoir dimension and on normalized target volume time series while the target volume approach represents a valid option where detailed time series are available the adoption of normalized target volume curves obtained averaging time series of other reservoirs is unable to capture differences in the management of the reservoirs and this inevitably introduces further uncertainty into the modelled hydropower production furthermore a common assumption of several existing contributions is that the hydropower systems operate always at their maximum capacity when available water volumes exceed those needed for respecting the imposed minimum environmental flows mefs otherwise it is reduced to the quantity needed to guarantee this priority service turner et al 2017 wagner et al 2016 zhao et al 2016 this relatively parsimonious approach has been shown to perform well at the global scale and suits well large scale impact assessments see e g turner et al 2017 turner et al 2017 though it provides unrealistic estimation of water releases from the reservoirs thus affecting environmental health impact assessments related to hydropower activities petruzziello et al 2021 zhao et al 2019 in this context reliable modelling of hydropower production at the mesoscale requires a description of hydropower systems accurate enough to fully grasp the complex interactions between the hydrological cycle and the other water uses particularly when the objective is to assess the impact of climate change or to test policies for mitigating conflicts for water uses since technical information on such hydraulic infrastructures is often incomplete and difficult to obtain we developed and tested a modelling approach that relies on publicly available information for identifying reservoir specific daily operation schemes the resulting modelling framework was then validated against historical time series of streamflows and hydropower production furthermore we analyzed the impact on modelled hydropower production of simplifications typically adopted in large scale modelling efforts both concerning the structure of the hydropower system and its management schedule in particular we considered i a simplification in the geometrical configuration of the hydropower systems by assuming the reservoir as the only water source for the connected generation units thereby neglecting conveyance intakes whether present and ii a simplification of the reservoir operation schedules in which the power plants are always operated at their maximum hydraulic capacity when the required volume is available and using all the incoming volume larger than the mef volume otherwise to this end we applied the hyperstreamhs hydrological model avesani et al 2021 to the adige catchment a large watershed located in the south eastern portion of the alps the catchment offers a complex scenario though rather common in alpine regions in which a detailed model implementation is expected to improve the model s predictive capabilities conversely given the high level of detail available the effects of simplifications introduced into the model can be tracked down thus allowing the identification of the systems that are prone to be negatively impacted by such simplifications for example underestimating hydropower production in this respect our results provide guidance for applications in situations in which data are available with fewer details the work is organized as follows section 2 presents an overview of the model components with particular emphasis on modelling the hydropower systems followed by the presentation of the data that are necessary to run the model and of the procedure to approximate hydropower production schemes section 3 presents an application of the proposed modelling framework to the adige watershed and section 4 presents and discusses model performance in reproducing streamflow and hydropower production of the catchment and then provides a quantitative assessment of the bias introduced under different simplified configurations finally section 5 presents the main conclusions 2 methods 2 1 modelling framework in the present work modelling was performed by using hyperstreamhs a distributed hydrological model combining hydrological flows with explicit modelling of hydropower related water uses and transfers avesani et al 2021 in this framework vertical hydrological fluxes are computed at each macrocell of the computational grid grid size is set at 5 km in the present work and the resulting runoff is routed to the corresponding downstream node by means of the width function instantaneous unit hydrograph wfiuh method with the assumption of constant stream velocity see natural hydrological module in fig 1 the nodes are selected locations along the river network where the natural streamflow is computed as the sum of streamflow from the upstream nodes and the runoff produced by the interbasin i e the contributing area of intermediate hillslopes fig 1 left panel in the presence of human infrastructures additional nodes are included and water mass balances are applied with specific constraints depending on node type see human systems module in fig 1 right panel communication between the natural hydrological and human systems modules takes place at the infrastructures nodes this is exemplified in the central panel of fig 1 where the fluxes entering the mass balance equation at a generic node in this specific case a reservoir are highlighted the total incoming streamflow to the reservoir node 3 is computed as the sum of the streamflow generated by the interbasin between the two upstream nodes 1 and 2 and the reservoir q s 3 t plus the streamflow transferred from the upstream nodes 1 and 2 q s 1 t τ 1 3 and q s 2 t τ 2 3 respectively with τ 1 3 and τ 2 3 being the transfer times between two upstream nodes and the downstream reservoir node 3 water mass balance is then computed at the reservoir see section 2 1 2 for the details on the mass balances applied to the different node types and the outflows q der 3 t and q nat 3 t are computed see fig 1 central panel 2 1 1 natural hydrological module the hydrological component of the model is based on the hyperstream routing scheme presented in piccolroaz et al 2016 which receives the total runoff generated at the level of the macrocells the precipitation is first spatially aggregated at the macrocell scale see left panel in fig 1 and then used as input in a degree day module for snow melting and accumulation the resulting vertical flow is the input of a continuous scs cn module which separates surface runoff from infiltration michel et al 2005 then infiltration feeds a non linear bucket model for soil moisture dynamics majone et al 2010 with the rapid component of return flow and deep infiltration as output evapotranspiration evaluated with the hargreaves and samani 1982 model is added to the water budget equation at this level of the modelling chain finally deep infiltration enters a second linear bucket representing groundwater and the associated slow component of the return flow the total resulting runoff is routed to the nearest downstream node by means of a wfiuh method rodríguez iturbe and rinaldo 1997 applied to the network extracted from the dem of the area left panel in fig 1 the model requires a total of 12 parameters which can be calibrated against streamflow observations by either using the particle swarm optimization pso algorithm kennedy and eberhart 1995 or exploring the hyperparameters space by means of the latin hypercube sampling lhs scheme mckay et al 1979 which are both embedded in the model two objective functions are included nash sutcliffe nse index proposed by nash and sutcliffe 1970 and the kling gupta efficiency index kge proposed by gupta et al 2009 in a multi site calibration framework the global efficiency index is defined as the average of the efficiencies attained at each adopted gauging station a detailed description of the hydrological kernel can be found in avesani et al 2021 notice that the surface and subsurface flow generation module was already successfully applied in previous studies conducted in alpine catchments piccolroaz et al 2015 bellin et al 2016 laiti et al 2018 in addition to its previous features hyperstreamhs was coded for parallel computing through the mpi paradigm to take advantage of the almost perfect scalability of the natural hydrological kernel avesani et al 2021 2 1 2 human systems module in hyperstreamhs hydraulic infrastructures such as reservoirs water diversions and tailraces are modelled by adding nodes at the locations where the natural stream network and the engineered systems are connected at these nodes local water budgets are applied in the respect of the constraints due to the type of use as for example the hydraulic capacity of the diversion channel after water budget is applied the resulting partitioned flows see fig 1 are routed downstream from the human systems module assuming two different celerity values the first equal to 2 m s for fluxes travelling along transport hydraulic infrastructures whereas flows along the natural stream network travel with the same celerity adopted for macrocell node routing which is one of the 12 model parameters three types of nodes are considered 1 reservoir 2 intake and 3 power plant connections between these nodes are also taken into account by including elements such as tunnels diversion channels and penstocks this allows to fully describe the exchange fluxes between the engineered systems and the river network these modules are detailed in avesani et al 2021 the water budget eq 1 at reservoir nodes is performed considering all the inflows σ q in and the following outflows derivation to all the uses according to the given schedules σ q der release of minimum ecological flow mef q mef and spilling q spill when the maximum regulation level is exceeded 1 dv dt σ q in t σ q der t q mef t q spill t where v is the volume of water stored in the reservoir and σ q der is the sum of the flows diverted for multiple water uses i e inflows to the penstocks connected to downstream power houses although similar considerations can be done for uses other than hydropower with the possibility that a portion of σ q der is added to precipitation in irrigation areas in case of an agricultural or multi uses reservoir in the present work we do not consider this case which however can be easily included if needed intake nodes are locations where water is withdrawn from the natural stream network by means of intake structures connected to diversion channels or other conduits they do not have storage capacity and must obey a mef constraint similarly to reservoirs as sketched in the inset a of fig 2 mass conservation applied to this type of nodes leads to 2 q in nat t q out nat t q div art t q out art t q div art t q in art t where the terms of the water budget are distinguished between natural nat and artificial art fluxes occurring in the river network and in the engineered components of the system respectively in eq 2 q div art varies between zero and the maximum water discharge that the intake can accept the second eq 2 is applied to internal nodes of the engineered system as for example the nodes along the derivation tunnel represented in the inset a of fig 2 intake nodes are also used to model restitution fluxes to the river through a tail race channel as shown in the inset b of fig 2 in this case incoming contributions natural and from the engineered system are merged i e summed according to eq 3 and routed downstream along the stream network 3 q out nat t σ q in art t σ q in nat t a type intake node can also be used to model the confluence between conduits in situations like the one depicted in the inset c of fig 2 in this case the following continuity equation eq 4 is applied at the node 4 q out art t σ q in art t where q out art and σ q in art are the outflow and sum of the inflow fluxes at the node respectively finally hydropower plant nodes behave similarly to restitution nodes routing all incoming flows to the downstream stream network the hydropower production hpp at each hydropower system is computed as follows 5 hpp t η i 1 n ρ g q turb i t δ h i t in eq 5 η is the plant s efficiency which for simplicity is assumed to be the same for all the hydropower plants q turb i and δ h i are the turbined water discharge and the hydraulic head of the i th power unit respectively often for efficiency reasons and also in case the power house receives water from more than one source two or more generation units are installed in the same power house for a storage reservoir hydropower plant the head δ h i is given by the difference between the reservoir water stage and the level of the nozzle or the water level in the afterbay depending of the type of turbine on the other hand for run of the river power plants δ h i is assumed equal to the gross head of the power plant 2 2 data requirements for natural hydrological and human systems modules hyperstreamhs requires gridded input of precipitation temperature and evapotranspiration at the same time step of the simulation these inputs can be obtained either by global meteorological datasets or reconstructed by performing interpolation of ground observations with geostatistical tools embedded in the model digital elevation model dem land use and land cover maps are also needed to identify the river network and to initialize the spatially varying parameters controlling evapotranspiration and infiltration processes daily observed streamflow time series at relevant gauging stations are also needed for calibration and validation of the hydrological model the data requirements for characterizing the natural hydrological module are summarized in table 1 modelling the interactions between the river network and the intertwined hydropower systems requires specific topological and operational data in order to adequately describe the hydraulic infrastructures and reproduce the associated water transfers availability of these data is system specific depending also on the level of industrial secrecy of the producers in order to make our approach general we decided to use only data that are publicly available unfortunately very few data are available in the most widely used global datasets such as global reservoir and dam grand lehner et al 2011 global georeferenced database of dams goodd mulligan et al 2020 future hydropower reservoirs and dams database fhred zarfl et al 2015 and therefore a specific search in public archives of state agencies or from informative leaflets is unavoidable for a proper model set up the full list of topology and operational data needed for an optimal characterization of the systems by using only public data is summarized in table 2 furthermore hydropower production historical data are needed for the validation of the human system module and for approximating the hydropower production scheme of the individual power plant as described in section 2 3 hydropower production time series are publicly available upon request from national managers of electricity grid and they are typically provided aggregated in space and time to comply with confidentiality agreements between the public authorities and producers we remark that all data used in the present work are publicly available and this is because our main objective is to develop a methodology that can be used in other contexts without relying on data collected by the producers which are often kept confidential details about the data used for the case study application are presented in section 3 2 3 hydropower production scheme in addition to meteorological geomorphologic and topology data the modelling framework requires the schedule of all the water uses as input to allow flexibility a schedule is associated to each water use and is provided externally in particular hydropower scheduling was inferred from monthly energy production at the province level which is publicly available assuming that all the hydropower systems were operated similarly at this temporal scale water use schedules at finer temporal scales could be envisioned in case the information is available firstly the average water discharge taken from the reservoir of a hydropower system is estimated as follows 6 q avg i hpp exp i γ η δ h i 24 365 where hpp exp i is the expected annual production for the i th power plant as declared by the company operating the plant and usually computed as long term average δ h i is the gross average head and η is the total efficiency of the plant the derived water discharge time series for the single reservoir are then obtained by modulating the average value provided by eq 6 according to the following expression 7 q der i t q avg i k m t δ w t ϕ e t where k m hpp aggr m hpp aggr ann is the ratio between the mean production of the m th month hpp aggr m and the long term annual mean hpp aggr ann of the available aggregated data of hydropower production δ w is a dummy variable introduced to simulate the reduction of production during the weekends and ϕ e is a function reflecting short to medium term variations due to management strategies here we used ϕ e p avg 3 p avg month where p avg 3 is the three day centered moving average of electricity price and p avg month is the average price of the month moving average is used here to smooth the volatility characterizing the time series of daily electricity prices see e g demir et al 2020 the resulting utilization scheme mimics the interplay between variations in hydrology and water uses the latter influenced by the electricity market a similar approach has been adopted by schaefli et al 2007 with a stochastic component that was added to a historical time series with the intent of mimicking the intrinsic variability of the electricity market according to eq 7 the turbined water flow is controlled by the parameters k m ϕ e and δ w each one addressing a different scale of time variability with the former varying also in space at the level of the provinces an example of the resulting utilization scheme is shown in fig 3 we observe variations at multiple scales from the monthly scale chiefly due to seasonal variations of streamflow to the smaller weekly and daily scales due to fluctuations of the electricity price notice the shutoff of production during the weekends when the price of electricity reduces simulated by setting δ w 1 during weekdays and to 0 in the weekends 3 case study and model set up 3 1 study area the adige river is the second longest italian river with a contributing area of 10 500 km 2 at the gauging station of vó destro fig 4 the watershed occupies a large portion of the southeastern alps in a mountain area with elevation ranging from 200 to 3900 m a s l the annual average precipitation ranges from 500 mm in the north west to 1600 mm in the south lutz et al 2016 diamantini et al 2018 with streamflow showing a typical alpine regime with two seasonal maxima one occurring in spring summer due to snow and glacier melt and the other in autumn triggered by cyclonic storms chiogna et al 2016 lutz et al 2016 mallucci et al 2019 fig 4 shows the natural river network the superimposed hydropower network the hydropower plants and the storage reservoirs though fragmented the hydropower network is distributed over the entire river system and exerts a significant impact on streamflow majone et al 2016 pérez ciria et al 2019 zolezzi et al 2009 3 2 climatic forcing land cover and geomorphology data the adige dataset mallucci et al 2019 was used to provide daily air temperature and precipitation forcing to our simulations the dataset consists of daily readings taken at 244 and 350 gauging stations for precipitation and air temperature respectively that have been distributed on a 5 5 km grid by ordinary kriging with external drift oked adopting terrain elevation as secondary variable goovaerts 1997 grid resolution was set on the basis of previously published studies conducted in the study region with the same hydrological kernel laiti et al 2018 avesani et al 2021 moreover potential evapotranspiration pet was computed according to the hargreaves samani approach hargreaves and samani 1982 and provided as a gridded input to the model soil elevation and land use information were extracted from the 30 m eudem digital elevation model dem and the corine 2006 dataset https www eea europa eu publications cor0 landcover respectively the dem has been corrected in order to comply with the portions of stream network altered by human intervention in accordance with the official stream network provided by the superior institute for environmental protection and research ispra available at http www sinanet isprambiente it it sia ispra download mais reticolo idrografico view 3 3 human systems in the adige watershed within the catchment operate 39 large hydropower systems with installed power ranging from 5 2 to 230 mw 22 of which with reservoir see numbering from 1 to 22 in fig 4 with operational volumes ranging from 0 32 to 172 mm 3 see also table 3 a rather extensive network of diversion channels with capacity ranging from 0 3 to 203 m 3 s is feeding the whole system the total long term average production of these hydropower systems is of 6609 gwh y according to data available from the hydropower companies operating in the river basin thereby contributing to more than 14 of the annual italian hydropower production https www terna it it it sistemaelettrico statisticheeprevisioni bilancienergiaelettrica bilancinazionali aspx information concerning topology and operational data of the hydropower systems located in the adige catchment was collected and structured in a gis database during the eocoe ii project https www eocoe eu water for energy the main characteristics of both run of the river and storage systems are summarized in table 3 while the topology of the hydropower network is shown in fig 4 detailed prescriptions for mef at each water diversion were retrieved from the public water usage plans of the trento and bolzano provinces available at http www pguap provincia tn it and https ambiente provincia bz it acqua piano generale utilizzazione acque pubbliche asp respectively the data used to fully characterize hs module in the adige case study are stored in a public github repository available at https github com majoneb hyperstreamhs in the present work plant efficiency η was set constant and equal to 0 8 which is the average of the efficiencies of the hydropower systems for which this information was available i e 12 out of 22 reservoir hydropower systems of the adige river this is justified by the similarity in the hydraulic characteristics of the power plants 3 4 streamflow and hydropower production time series daily streamflow time series at all the relevant gauging stations in the adige see fig 4 were provided by the hydrological offices of trento http www floods it public and bolzano http www provincia bz it hydro these time series are official measurements and are available at a daily or finer time scale in the 1923 2013 time window with very few gaps hydropower production data were provided by the manager of the italian electricity grid terna http www terna it hydropower production time series are publicly available upon request at a monthly time scale and aggregated by province they have been acquired for the 2000 2015 time window with no gaps moreover data are subdivided between small and large hydropower systems 3 mw installed power threshold in line with the classification commonly adopted in italy and inherited in the present work in which only large hydropower plants are taken into account as they contribute for roughly 90 of the total hydropower production production data of the bolzano province can be used directly for model validation since all the hydropower systems of the province are within the upper adige catchment this is not the case for the trento province because only a portion of the hydropower systems is in the lower adige catchment consequently the observed production of the lower adige catchment is estimated by multiplying the production of the trento province by a factor equal to the fraction of the installed capacity in the adige catchment with respect to that of the entire province under the hypothesis that all power plants are operated similarly 3 5 hydrological model calibration and validation hyperstreamhs was calibrated using the nash sutcliffe nse index nash and sutcliffe 1970 as objective function and searching the parameters space with the particle swarming genetic algorithm pso kennedy and eberhart 1995 as already observed in other works see e g bombelli et al 2019 the common approach of calibrating the model at the catchment outlet does not guarantee good accuracy in the sub catchments which are crucial in our simulations because feeding the hydropower systems to overcome this drawback we adopted a multi site calibration strategy following the suggestion by zhang et al 2008 the model was calibrated by maximizing the global nse index at the following three gauging stations cadipietra 148 8 km 2 gadera 289 9 km 2 and vermiglio 79 0 km 2 all located in undisturbed sub catchments see fig 4 the calibration was performed in the time window 1989 2013 by using the first two years as spin off i e they do not contribute to the objective function validation was performed by computing the nse index at four gauging stations not used in calibration and by comparing the simulated annual energy production provided by eq 5 with the measured one the four gauging stations are vandoies 1917 km 2 mezzolombardo 1356 km 2 bronzolo 7400 km 2 and trento 9000 km 2 as depicted in fig 4 3 6 simulation setup simulations were performed by using a time step δ t 1 h to ensure adequate accuracy in routing consequently meteorological data available at a daily time step were scaled accordingly by assuming a uniform distribution of precipitation and evapotraspiration at the sub daily scale and a constant temperature equal to the daily mean the resulting streamflows were then aggregated at the daily scale before computing the nse index to emphasize the benefits of including a suitable representation of hydropower systems topology and operating rules four configurations were considered each one with the hydropower systems represented by using a different level of detail the adopted simplifications are described here with reference to the sketch shown in fig 5 full this configuration simulates the interaction between natural stream network and hydropower systems with fully detailed topology and reservoir operating rules see fig 5a nat this is the fully natural condition with all hydraulic infrastructures removed therefore only natural streamflows are computed in this case with no flow being diverted for hydropower uses see fig 5b of course in this case no energy is produced qmax this configuration includes all the elements of the hydropower system such as the diversion channels conveyance intakes tunnels and penstocks however reservoir operation rules were simplified assuming that hydropower plants are always operated at their maximum hydraulic capacity only obeying mandatory constraints i e minimum and maximum storage capacity with priority given to the release of mef under these conditions eq 7 reduces to q der i t q sys i where q sys i is the hydraulic capacity of the turbines of the i th power plant as shown in fig 5c res in this case storage reservoir operating schemes were implemented with the maximum possible detail as explained in section 2 3 but conveyance intakes were neglected thereby assuming the reservoir as the only water source for the connected generation units in case of run of the river systems only the main intake was considered in the adige watershed only 5 systems were affected by this simplification whose impact on hydropower production is however worth analysing given their large capacity the impact of this modification is exemplified in fig 5d where the contribution of the conveyance intakes is removed from the water discharge delivered to the hydropower plant 4 results and discussion 4 1 relevance of human systems towards streamflow representation the multi site calibration of hyperstreamhs performed as detailed in section 3 5 by using the gauging stations of cadipietra gadera and vermiglio as reference produced an overall nse of 0 63 which can be considered as satisfactory the model was then validated by comparing the simulated with the measured streamflows at four gauging stations downstream the previous ones and not used for calibration the streamflow at these stations is altered to a various degree by hydropower and therefore the performance varies according to the adopted configuration as shown in table 4 considering the three gauging stations of vandoies bronzolo and trento which are mildly impacted by hydropower the nse coefficients are larger than the global nse obtained in calibration this is an encouraging result and shows that hyperstreamhs provides a good representation of the hydrological system the mezzolombardo gauging station is highly impacted by hydropower see the discussion later and although the nse increases progressively as the hydraulic infrastructures are better detailed its maximum value is below 0 5 which is the lower limit for considering the simulations as satisfactorily see e g moriasi et al 2007 in all cases an improvement in the representation of the hydraulic system leads to an increase though in some cases marginal of nse in validation this shows that including into the modelling effort the hydraulic infrastructures is informative similar conclusions were drawn by dang et al 2020 nat and qmax configurations produce similar results since in the latter hydropower systems are always operated at their maximum capacity with reservoirs dramatically reducing their storage indeed in this situation water is stored only when inflow exceeds the hydraulic capacity i e the maximum water discharge that the power plant can convey to the turbines on the other hand also res and full configurations exhibit a similar behavior and this can be attributed to the fact that res configuration differs from full only in 5 systems out of 22 ids 1 4 9 13 26 in table 3 thereby the impact of a different water use schedule in these systems is hardly noticeable at the validation sites consequently for the sake of clarity fig 6 depicts observed and simulated streamflows for the nat and full configurations which represent the two extreme cases of ignoring the presence of the hydraulic infrastructures and representing them to the maximum possible level of detail allowed by publicly available data as discussed in sections 2 2 and 3 3 as expected the proper representation of the hydraulic infrastructures is important during low flow periods from november to march when hydropower releases affect significantly streamflow timing and magnitude as confirmed by visual inspection of the flow duration curves depicted in right panel of fig 6 on the other hand no appreciable differences are observed between nat and full configurations during high flow periods from may to october because of the cutoff introduced by hydraulic capacity of the hydropower system furthermore the difference between nat and full configurations attenuates as the distance between the gauging station and the intake or restitution points of a hydropower system increases this is the consequence of the reduction of the ratio between the turbined water discharge and streamflow along the river network and away from the hydropower plant for example vandoies bronzolo and trento gauging stations are located sufficiently far from the closest upstream hydropower system and exhibit the typical seasonal streamflow variability with small variations and attenuated oscillations during the low flow periods subplots a c and d in fig 6 conversely the mezzolombardo gauging station see fig 4 is located immediately downstream 2 km of the large mezzocorona hydropower plant id 11 in fig 4 with a hydraulic capacity of 66 m 3 s 1 which dramatically affects the otherwise lower natural streamflows mean annual value of 20 m 3 s 1 upstream of the system despite some inaccuracies due to the limited knowledge of reservoir operating rules the full configuration clearly provides the more realistic representation of streamflow as opposed to the nat configuration subplot b in fig 6 from the above considerations it can be concluded that especially during seasons in which hydropower releases constitute a large share of streamflows i e low flow periods the benefit of including a detailed modelling of hydropower systems is significant for a proper representation of streamflow alterations the impact on streamflow alterations of the three configurations described above was investigated by analyzing the time series of the normalized difference between the streamflow in the presence and in the absence of the hydraulic infrastructures 8 r q i conf t q i conf t q i nat t q i nat t where q i conf t is the daily streamflow computed at node i under the given configuration of the hydraulic infrastructures with conf being either full res or qmax and q i nat t is the daily streamflow computed at the same node under the natural nat configuration mean μ r i conf 1 n t 1 n r q i conf t where n is the number of time steps and standard deviation σ r i conf 1 n t 1 n r q i conf t μ r i conf 2 of the normalized residual time series eq 8 are shown in fig 7 left and right columns respectively this figure visualizes in an intuitive manner the most relevant alterations and their spatial pattern in the full configuration the larger alterations with respect to natural conditions are at reservoir nodes see full rombi in fig 7a since only mef and overtop water discharge during flooding feed the channel immediately downstream the impoundment as detailed in section 2 1 2 positive alterations i e streamflow higher than in natural conditions are observed downstream the restitution of the power plants blue triangles in fig 7a receiving contribution from outside the catchment i e from catchments not belonging to their contributing area qmax and full show similar streamflow alterations figs 7c and 7a given that both elaborate the same annual water volume though with a different timing this latter consideration is valid also for the res configuration with the exception of the nodes belonging to the five systems identified by black rectangles in fig 7e that were topologically simplified in the res configuration in this case no alterations i e μ r i res 0 are observed at the nodes where conveyance intakes are deactivated white dots in fig 7e within the black rectangles however significant alterations slightly smaller than in the full configuration are observed at the corresponding nodes of the power plants an indicator of alterations in streamflow timing occurring at the daily time scale is the standard deviation of the normalized residual time series eq 8 shown in the right column of fig 7 in the full configuration fig 7b the largest deviations from the natural regime are observed at the hydropower plants connected to large storage reservoirs see red triangles in fig 7b as a consequence of a changing in time hydropower production the reason of the reduced with respect to the full configuration standard deviation σ r i qmax observed in fig 7d for the qmax configuration can be identified in the simplification introduced in the reservoir management rules see section 3 6 which indeed cause reservoir hydropower systems to be managed similarly to run of the river systems the effects of an unrealistic hydropower schedule such as that introduced by the qmax configuration will be further discussed in section 4 3 alteration of streamflow timing under res configuration exhibits a similar pattern as in the full configuration with the exception of the nodes belonging to the five systems highlighted in fig 7f where the introduced topological simplification leads to small to negligible variations i e σ r i res 0 with respect to the reference nat configuration 4 2 impact of customary approximations on hydropower production the simulated energy production of the adige catchment in the time window 2000 2013 was compared with the observed one computed as the sum of the entire production of the province of bolzano and the portion of the trento province pertaining to the adige watershed as described in section 3 4 in particular fig 8 shows the comparison between modelled and observed hydropower production for the configurations described in section 3 6 at a monthly time scale with the exception of nat where by definition modelling of human systems is not performed the observed and simulated mean annual productions are also summarized in table 5 where the hydropower systems are grouped into reservoir and run of the river systems the full configuration provided the better reproduction of average annual hydropower production with a small difference of 4 due to the imperfect reconstruction of the unknown operational schedule and to a minor extent to errors in simulating streamflow entering the reservoirs and at the withdrawal points on the other hand qmax and res configurations introduce a bias in the representation of hydropower systems leading to larger errors in the modelled hydropower production generally the errors are smaller for run of the river systems with a minimum of 2 in the full configuration larger deviations in the hydropower production at run of the river systems are indeed observed for qmax and res configurations highlighting that imperfect reconstruction of the operational schedule in storage reservoirs also significantly affects streamflow timing at downstream locations where run of the river plants are located we consider the high accuracy of the full configuration in reproducing historical hydropower production data a significant achievement of the present work indeed existing studies compare different scenarios either in terms of water usage policies or climate change impacts see e g meng et al 2020 bejarano et al 2019 gaudard et al 2013 but they do not validate the hydropower modelling framework under historical conditions in our opinion model validation is a necessary step to avoid possibly biased interpretation of scenario runs in the ensuing section we provide additional evidence on how the simplified configurations res and qmax introduce bias in hydropower production modelling 4 3 effects of simplified reservoir operation modelling we start by evaluating more in detail the effects of the qmax configuration which assumes that the storage hydropower systems of the catchment operate at their maximum capacity when the amount of water in their reservoirs is enough to sustain at least one day of production and shut off when it becomes smaller this simplification is commonly adopted in large scale impact assessment studies see e g turner et al 2017 wagner et al 2016 as detailed information on reservoir operation is often hard to obtain as shown in table 5 the simulation performed with the qmax configuration underestimates the total hydropower production more than the other two configurations res and full the impact of this assumption is exemplified in fig 9 which compares the evolution in time of the water stage in the gioveretto reservoir under both the qmax and full configurations under the qmax configuration the reservoir is most of the time at its minimum level zero utilizable water volume and therefore the hydropower plant operates most of the time as a run of the river system at the minimum head this occurs because in the qmax configuration the water flow withdrawn from the reservoir q der is larger than the mean annual water inflow q in avg and therefore the reservoir is predominantly in low storage conditions as a consequence the production reduces because of the lower head despite the turbined water volume is roughly the same the simulated reservoir water stage in the qmax configuration is nevertheless unrealistic large reservoirs usually perform seasonal regulation of the water storage as is the case in the simulation performed under the full configuration see fig 9 it should be noticed that a correct timing of hydropower production is important for a proper evaluation of the ecological impact of hydropower systems in fact hydropower production may adversely affect reservoir aquatic ecosystems due to internal oscillation of the water stage which if of large amplitude may impair the riparian buffer see e g yang et al 2018 renofalt et al 2010 jager and smith 2008 similarly hydropeaking may significantly affect freshwater ecosystems downstream the restitution see e g larsen et al 2021 finch et al 2015 hall et al 2015 bruno et al 2013 under this perspective a realistic and accurate modelling of timing and magnitude of streamflow alterations due to hydropower operation is of deemed importance from the economical point of view the cost of these alterations due to the loss of ecosystem services should be compared with the increased revenue due to a larger production or a larger share of production in periods with high electricity prices and the reduction of co 2 emissions on the other hand simplifications in the hydropower schedule may lead to inaccuracies in the evaluation of the impacts on the ecosystems see e g vigiak et al 2018 similar conditions to those observed at gioveretto are observed in the other simulated reservoirs result not shown here though the modelled production decreases more in systems in which the head created by the impoundment is a larger fraction of the total head 4 3 1 impacts of uncertainty in the hydraulic capacity operational rules for reservoirs are often not disclosed by the hydropower companies for not providing advantages to competitors in the same electricity market therefore with the hydraulic capacity as the only information available large scale studies are conducted by assuming that reservoir hydropower systems are always operated at their hydraulic capacity q sys i with i indicating the hydropower system i 1 22 in our work consistently with fig 4 and table 3 however this information may be known with uncertainty as well particularly when the study refers to a large number of hydropower plants to evaluate the effect of knowing q sys with uncertainty we considered two additional configurations with q der constant in time as in the qmax configuration and equal to q der i k q sys i with i 1 22 and k 0 8 and 1 2 respectively hereafter the former configuration is called qmax 0 8 and the latter qmax 1 2 given the relatively small deviation from system capacity q sys the efficiency η is maintained constant and equal to 0 8 for the purposes of this analysis three indicators were computed for each hydropower system the first indicator is the ratio i h i δ h i h sys i between the maximum oscillation δ h i of the reservoir level and the mean total head h sys i given by the difference between the elevation of the reservoir center of mass at the maximum operational level and the nozzle or the tailrace depending on the type of installed turbine the second indicator r c i v op i q in avg i is the ratio between the operational volume v op i see table 3 and and the mean annual inflow q in avg i this indicator is equal to the number of days needed to fill the reservoir with a constant inflow q in avg i in the absence of utilization and starting from the minimum level and it represents the regulation capacity rc of the reservoir in addition the variation of the modelled hydropower production with respect to the full configuration is computed as follows δ prod i hpp conf i hpp full i hpp full i where hpp conf i is the hydropower production in the selected configuration i e qmax 0 8 qmax and qmax 1 2 and hpp full i that of the reference full configuration results of this analysis are summarised in fig 10 in which each column represents one of the 22 storage hydropower systems of the adige catchment systems with i h 7 from 1 to 12 do not show significant reductions of the production with respect to the full configuration irrespective to the configuration considered either qmax and its two variations described above this result was expected given the predominance of the geodetic head over the head created by the impoundment as reflected in the relatively small i h of these systems on the other hand the losses of hydropower production increase with i h due to the fact that reservoir oscillations δ h are a significant fraction of the total head similarly to qmax both qmax 0 8 and qmax 1 2 configurations reduce the annual production with respect to the full configuration i e δ prod 0 the lowest reduction is obtained with the configuration qmax 0 8 for most of the systems i e 1 2 4 7 9 10 11 12 13 14 15 16 17 18 19 20 21 however for the systems number 3 5 6 8 and 22 the smallest loss of production is obtained with the configuration qmax 1 2 while the reduction of the loss when the configuration qmax 0 8 is used was expected because of the higher simulated average reservoir level with respect to the configuration qmax the lowest reduction obtained with the configuration qmax 1 2 is counter intuitive the explanation is in the low regulation capacity of these reservoirs all having r c 1 with the exception of hydropower system number 5 when rc 1 the reservoir is rapidly filled and the loss of production is proportional to the spilled water volume which is smaller when q der is larger thereby with the configuration qmax 1 2 in the case of system number 5 despite the regulation capacity not usually being a constraint spilling occurred during some of the extreme high flow seasons and thus configuration qmax 1 2 converted most of the excess flows in hydropower production this analysis shows that even when operational schedule is unknown performing the simulation with the qmax configuration or a similar one produces good estimates of the annual energy production however simulations lose accuracy for specific hydropower systems with a reservoir whose maximum oscillation is a significant portion of the head notably the system presenting the second largest i h i e the s giustina reservoir connected to the taio plant see also table 3 exhibits a loss of 30 in the annual production 4 4 effects of simplified network topology in the res configuration only primary water sources such as the reservoir or the main intake in the run of the river hydropower systems were included see fig 5d thereby neglecting the contribution of the conveyance intakes as a result natural streamflow was not affected by conveyance intakes q div art t 0 in eq 2 and turbined volumes were underestimated this approximation is common in studies at regional or larger scales because the technical information needed to simulate conveyance intakes is rarely included into large scale datasets accessible online in addition to the analysis of the difference between the res and full configurations we considered a modified configuration named res qmax which adds the simplifications in reservoir management qmax configuration to those related to system topology res with the aim to verify if and how these two assumptions interact and influence the accuracy of the modelled hydropower production only 5 out of 39 large hydropower systems in the adige watershed include conveyance intakes and were therefore relevant to this analysis the percentage contributing area associated to the conveyance intake and i h indicator of these hydropower systems are shown in table 6 together with their simulated mean annual production under the different aforementioned configurations as expected in all hydropower systems the res configuration leads to a smaller production than the reference full configuration because of the water volume lost by neglecting the conveyance intakes which is not compensated by a larger use of the water stored in the reservoir the production loss is proportional to the drainage area of the conveyance intakes and increases further under the res qmax configuration except for sarentino which is a run of the river power plant operating in conditions similar to qmax fed by a small impoundment with negligible oscillations i h 0 the further loss observed in the combined configuration res qmax is roughly proportional to the structural parameter i h this is expected because in systems with high i h hydropower production is sensitive to changes in the impoundment elevation this analysis highlights that despite performing well at the aggregate scale the res configuration introduced significant biases in the simulated hydropower production of the systems with conveyance intakes see table 6 similarly streamflow is strongly affected by the simplifications introduced in the res configuration both aspects indeed represent a fundamental piece of information for local and regional studies that attempt to analyze competing water uses la jeunesse et al 2016 majone et al 2012 rasanen et al 2017 zeng et al 2017 or to develop sustainable water use policies under a changing climate see e g grizzetti et al 2017 winemiller et al 2016 although open source reservoir datasets such as grand lehner et al 2011 goodd mulligan et al 2020 fhred zarfl et al 2015 represent a valuable source of information for large scale assessments of reservoir functioning and impacts those datasets do not include data concerning conveyance intakes nor they provide information about the connected hydropower plants and their operational schedules our simulations showed that more comprehensive datasets providing detailed information about hydropower systems and their network topology are a valuable piece of information that should not be disregarded though difficult to achieve 5 conclusions we analyzed the effects on modelled streamflow and hydropower production of different levels of approximation used to represent the hydropower systems in a hydrological model a distributed hydrological model hyperstreamhs was first calibrated by using the data of three gauging stations in headwater catchments not influenced by hydropower and other significant water uses the validation of the modelling framework was then performed by comparing simulations extended to the entire adige watershed conducted with the most detailed representation of hydraulic infrastructures that publicly available data allow to achieve full configuration with historical time series of measured streamflow and hydropower production data the full configuration was then assumed as reference and compared with three additional simplified configurations typically adopted in large scale hydrological modelling to make data collection more affordable res qmax and nat assuming the latter as reference for the natural conditions of the watershed the reference configuration full provided a very good representation of total hydropower production of the adige river at the annual scale the difference with the measured production was only of 4 differences of the order of 10 where observed with the other configurations all configurations including the hydropower systems improved the streamflow representation i e produced higher nse indexes at the selected stream gauges in validation with respect to the nat configuration thereby confirming the advantage to include though in an approximate manner hydraulic infrastructures into hydrological modelling streamflow alterations at the modelling nodes were analyzed by comparing the three hydropower configurations i e full res and qmax with the natural configuration nat spatial patterns of streamflow alteration magnitude are similar in the three hydropower configurations fig 7a c e the largest increase in streamflow variability epitomized by the standard deviation of the normalized residuals is observed for the full configuration at the hydropower plants connected with large reservoirs due the relevant hydraulic capacity of the power plant which is typically higher than the mean natural streamflow compared to full qmax configuration shows a lower increase of streamflow variability due to the simplifications introduced in reservoir management res configuration shows results similar to full with the exception of nodes in which topological simplifications were introduced performance analysis of the qmax configuration at the reservoir scale showed that this approach is acceptable in terms of average annual production although its performances deteriorate significantly for reservoirs whose oscillations are a relevant portion of the total head of the system resulting in differences up to 30 in annual production in these cases making realistic assumptions of the production schedule substantially improved the reliability of the predictions in all cases despite good estimates of the annual production modelled reservoir levels do not exhibit seasonal patterns as it would otherwise be expected the five systems simplified by the res configuration showed a remarkable reduction of modelled hydropower production as the main water sources reservoirs or main intakes were not able to compensate for the missing flux provided by the conveyance intakes thereby causing an underestimation up to 53 of hydropower production this latter result highlights how a detailed conceptual model and an accurate representation of hydraulic infrastructures is a crucial part of the modelling endeavour often more important than capturing the operational schedule which is rarely available finally results show that biases in the res and qmax configurations do not compensate rather they accumulate in a non linear manner see table 6 in the present work we showed that hydrological modelling in catchments with streamflow altered by hydropower or other water uses can benefit from including explicitly the functioning in terms of water transfers of hydraulic infrastructures into the hydrological model given that technical information concerning these hydraulic infrastructures is often lacking or incomplete and difficult to obtain we developed and tested a modelling approach that relies solely on publicly available information the comparison with commonly adopted simplifications showed that an accurate search for publicly available data more than commonly done is worth the investment of the financial resources and time required to perform it the reward being chiefly in a more accurate modelling of streamflow and hydropower production for the hydropower systems of the catchment the proposed framework is also useful to guide modelling of hydropower production at the regional and national scales credit authorship contribution statement andrea galletti writing original draft investigation methodology software visualization diego avesani software visualization writing review editing alberto bellin writing review editing conceptualization methodology supervision bruno majone writing review editing conceptualization methodology supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research received financial support by the energy oriented centre of excellence eocoe ii ga number 824158 funded within the horizon2020 framework of the european union and by the project seasonal hydrological econometric forecasting for hydropower optimization she funded within the call for projects research südtirol alto adige 2019 autonomous province of bozen bolzano south tyrol this research has been also supported by the italian ministry of education university and research miur under the departments of excellence grant l 232 2016 streamflow data were provided by the hydrographic office of the autonomous province of bolzano www provincia bz it hydro and by the ufficio dighe of the autonomous province of trento www floods it information on storage reservoirs was retrieved from the italian registry of dams rid http dgdighe mit gov it managed by the italian ministry of infrastructures and transportation 
3859,most mountain catchments worldwide are exploited for hydropower production causing significant alterations of their natural regime hydrological and water resources modelling in these catchments is challenging because the alterations of natural streamflow caused by hydropower production are often significant while capturing their variability in space and time requires critical data concerning the hydraulic infrastructures and their operational schedules these data are difficult to acquire thereby hindering the possibility to correctly simulate the complex interaction between the natural hydrological cycle and water uses to overcome these limitations we propose a framework that relies solely on publicly available data which provides accurate simulation of both streamflow and hydropower production the proposed framework is illustrated by means of the hyperstreamhs hydrological model applied to the adige catchment a large watershed of the south eastern alpine region whose streamflow is strongly impacted by 39 large hydropower systems 22 of which connected to storage reservoirs with an overall mean annual production that accounts for about 14 of the total italian hydropower production we analyzed the impact on modelled hydropower production of commonly adopted simplifications in the production schedule as well as of the hydropower systems which are often characterized by a complex infrastructure with several interlinked derivations and conveyance intakes our simulations highlight how an accurate topological representation of hydraulic infrastructures is crucial to correctly represent water transfers more important than capturing the operational schedules when reservoir oscillations are a small fraction of the total head on the contrary scheduling is important for systems in which reservoir oscillations account for a significant portion of the total head furthermore we show that simplifications motivated by difficulties in data collection combine in a non linear manner with an overall impact difficult to assess we propose this framework for accurate modelling of hydropower production at regional and national scales particularly in studies dealing with the projection of climate change and competing uses on water resources and renewable energy keywords water resources management large scale hydrological modelling hydropower production reservoir modelling hydraulic infrastructures 1 introduction electricity demand has more than doubled since 1990 and it is expected to increase further in the near future due to population growth un 2019 and to the progressive decarbonization of transportation housing and energy intensive industrial sectors iea 2018 hydropower is an important energy source satisfying more than 19 of electricity demand worldwide iea 2018 akpinar 2013 with storage reservoir hydropower being the only renewable energy source res that ensures reliable long term storage capacity barton et al 2004 for these characteristics hydropower is expected to play an important role in the future evolution of the electricity market helping to ensure a smooth transition to a green energy economy the main adverse effect of hydropower is the loss of freshwater ecosystem services whose evaluation catalyzed a wealth of attention see e g simonov et al 2019 yu 2017 wang et al 2010 measures are today available to attenuate these losses see e g malm renöfält et al 2010 gabbud and lane 2016 though scenarios with progressive decommissioning of reservoirs in favor of a more diffuse use of solar and wind energy have been recently envisioned waldman et al 2019 although less than other res hydropower production is uncertain because of the inherent variability of streamflow at multiple temporal and spatial scales moreover climate change is expected to increase this variability and may act in combination with competing uses to modify timing and amount of water volumes available for electricity production smajgl et al 2016 anghileri et al 2018 zhang et al 2018 these two external effects may be in synergy in some regions and in opposition in others depending on the local effect of climate change and evolution of water demand for other uses or changes of water use policies in this context hydrological modelling is a viable tool to project the impact of these foreseen changes on future hydropower production and evaluate the effects of modifications in the management strategies aimed at mitigating the above adverse effects indeed in the last decades hydrological modelling has been applied at regional and larger scales often involving complex parameterizations with the objective of representing at high spatio temporal resolution the interplay between biotic and abiotic processes controlling the dynamics of the earth s critical zone see e g sharif et al 2007 wada et al 2016 zierl and bugmann 2005 however climate change is not the only driver of change for water resources as the projected increase of water use for agriculture energy and other sectors is creating concerns as well bieber et al 2018 destouni et al 2013 indeed the effects on water resources of climate change and water uses are difficult to disentangle given that their interaction may give rise to nonlinear effects which analysis requires information on water uses at a level of detail difficult to achieve bellin et al 2016 mallucci et al 2019 hydropower is the dominant water use in mountain regions and its inclusion into hydrological models requires an adequate description of the hydraulic systems and of their interaction with the natural components of the hydrological cycle nazemi and wheater 2015 nazemi and wheater 2015 operations of run of the river systems are strictly dependent on streamflow timing while storage hydropower can modulate its activity to minimize the adverse impacts of climate change and maximize revenue moreover modelling climate change impacts and the effects of changes in water demand on storage hydropower systems requires the introduction of operational constraints as well as suitable production schedules for each hydropower system unfortunately these data are difficult to acquire because they are often kept confidential by the hydropower companies in this situation management strategies should be inferred from other sources in principle expert knowledge may suggest a suitable functional form of the water used for hydropower production with the parameters calibrated according to a given objective function however this approach adds parameters to models that often are already overparameterized thereby increasing the computational cost and uncertainty due to equifinality beven and binley 1992 as a consequence when a large number of hydropower systems should be modeled management rules are assumed a priori according to available constraints i e the hydraulic capacity of the hydropower system and the topology of the hydropower system is often simplified depending on the available information several deterministic approaches have been adopted in the literature to model reservoir operations such as e g hedging curve rules and target volume approach the first approach provides partitioning factors for satisfying the downstream demand from agricultural hydropower and water supply uses according to prioritization rules set by the water manager see e g shrestha et al 2014 guo et al 2013 tu et al 2003 this approach considers the seasonality of water inflows and might provide good results but a limitation emerges in the definition of the downstream demand which has to be known for all hydropower systems being modelled as well as the hedging thresholds and coefficients the target volume approach is often preferred for its simplicity see e g fatichi et al 2015 finger et al 2012 in this case 365 daily target volumes are assigned and turbined flows are determined as a function of the difference between current and target volumes the computation of target volumes can either be based on averaged observations if available otherwise it is based on reservoir dimension and on normalized target volume time series while the target volume approach represents a valid option where detailed time series are available the adoption of normalized target volume curves obtained averaging time series of other reservoirs is unable to capture differences in the management of the reservoirs and this inevitably introduces further uncertainty into the modelled hydropower production furthermore a common assumption of several existing contributions is that the hydropower systems operate always at their maximum capacity when available water volumes exceed those needed for respecting the imposed minimum environmental flows mefs otherwise it is reduced to the quantity needed to guarantee this priority service turner et al 2017 wagner et al 2016 zhao et al 2016 this relatively parsimonious approach has been shown to perform well at the global scale and suits well large scale impact assessments see e g turner et al 2017 turner et al 2017 though it provides unrealistic estimation of water releases from the reservoirs thus affecting environmental health impact assessments related to hydropower activities petruzziello et al 2021 zhao et al 2019 in this context reliable modelling of hydropower production at the mesoscale requires a description of hydropower systems accurate enough to fully grasp the complex interactions between the hydrological cycle and the other water uses particularly when the objective is to assess the impact of climate change or to test policies for mitigating conflicts for water uses since technical information on such hydraulic infrastructures is often incomplete and difficult to obtain we developed and tested a modelling approach that relies on publicly available information for identifying reservoir specific daily operation schemes the resulting modelling framework was then validated against historical time series of streamflows and hydropower production furthermore we analyzed the impact on modelled hydropower production of simplifications typically adopted in large scale modelling efforts both concerning the structure of the hydropower system and its management schedule in particular we considered i a simplification in the geometrical configuration of the hydropower systems by assuming the reservoir as the only water source for the connected generation units thereby neglecting conveyance intakes whether present and ii a simplification of the reservoir operation schedules in which the power plants are always operated at their maximum hydraulic capacity when the required volume is available and using all the incoming volume larger than the mef volume otherwise to this end we applied the hyperstreamhs hydrological model avesani et al 2021 to the adige catchment a large watershed located in the south eastern portion of the alps the catchment offers a complex scenario though rather common in alpine regions in which a detailed model implementation is expected to improve the model s predictive capabilities conversely given the high level of detail available the effects of simplifications introduced into the model can be tracked down thus allowing the identification of the systems that are prone to be negatively impacted by such simplifications for example underestimating hydropower production in this respect our results provide guidance for applications in situations in which data are available with fewer details the work is organized as follows section 2 presents an overview of the model components with particular emphasis on modelling the hydropower systems followed by the presentation of the data that are necessary to run the model and of the procedure to approximate hydropower production schemes section 3 presents an application of the proposed modelling framework to the adige watershed and section 4 presents and discusses model performance in reproducing streamflow and hydropower production of the catchment and then provides a quantitative assessment of the bias introduced under different simplified configurations finally section 5 presents the main conclusions 2 methods 2 1 modelling framework in the present work modelling was performed by using hyperstreamhs a distributed hydrological model combining hydrological flows with explicit modelling of hydropower related water uses and transfers avesani et al 2021 in this framework vertical hydrological fluxes are computed at each macrocell of the computational grid grid size is set at 5 km in the present work and the resulting runoff is routed to the corresponding downstream node by means of the width function instantaneous unit hydrograph wfiuh method with the assumption of constant stream velocity see natural hydrological module in fig 1 the nodes are selected locations along the river network where the natural streamflow is computed as the sum of streamflow from the upstream nodes and the runoff produced by the interbasin i e the contributing area of intermediate hillslopes fig 1 left panel in the presence of human infrastructures additional nodes are included and water mass balances are applied with specific constraints depending on node type see human systems module in fig 1 right panel communication between the natural hydrological and human systems modules takes place at the infrastructures nodes this is exemplified in the central panel of fig 1 where the fluxes entering the mass balance equation at a generic node in this specific case a reservoir are highlighted the total incoming streamflow to the reservoir node 3 is computed as the sum of the streamflow generated by the interbasin between the two upstream nodes 1 and 2 and the reservoir q s 3 t plus the streamflow transferred from the upstream nodes 1 and 2 q s 1 t τ 1 3 and q s 2 t τ 2 3 respectively with τ 1 3 and τ 2 3 being the transfer times between two upstream nodes and the downstream reservoir node 3 water mass balance is then computed at the reservoir see section 2 1 2 for the details on the mass balances applied to the different node types and the outflows q der 3 t and q nat 3 t are computed see fig 1 central panel 2 1 1 natural hydrological module the hydrological component of the model is based on the hyperstream routing scheme presented in piccolroaz et al 2016 which receives the total runoff generated at the level of the macrocells the precipitation is first spatially aggregated at the macrocell scale see left panel in fig 1 and then used as input in a degree day module for snow melting and accumulation the resulting vertical flow is the input of a continuous scs cn module which separates surface runoff from infiltration michel et al 2005 then infiltration feeds a non linear bucket model for soil moisture dynamics majone et al 2010 with the rapid component of return flow and deep infiltration as output evapotranspiration evaluated with the hargreaves and samani 1982 model is added to the water budget equation at this level of the modelling chain finally deep infiltration enters a second linear bucket representing groundwater and the associated slow component of the return flow the total resulting runoff is routed to the nearest downstream node by means of a wfiuh method rodríguez iturbe and rinaldo 1997 applied to the network extracted from the dem of the area left panel in fig 1 the model requires a total of 12 parameters which can be calibrated against streamflow observations by either using the particle swarm optimization pso algorithm kennedy and eberhart 1995 or exploring the hyperparameters space by means of the latin hypercube sampling lhs scheme mckay et al 1979 which are both embedded in the model two objective functions are included nash sutcliffe nse index proposed by nash and sutcliffe 1970 and the kling gupta efficiency index kge proposed by gupta et al 2009 in a multi site calibration framework the global efficiency index is defined as the average of the efficiencies attained at each adopted gauging station a detailed description of the hydrological kernel can be found in avesani et al 2021 notice that the surface and subsurface flow generation module was already successfully applied in previous studies conducted in alpine catchments piccolroaz et al 2015 bellin et al 2016 laiti et al 2018 in addition to its previous features hyperstreamhs was coded for parallel computing through the mpi paradigm to take advantage of the almost perfect scalability of the natural hydrological kernel avesani et al 2021 2 1 2 human systems module in hyperstreamhs hydraulic infrastructures such as reservoirs water diversions and tailraces are modelled by adding nodes at the locations where the natural stream network and the engineered systems are connected at these nodes local water budgets are applied in the respect of the constraints due to the type of use as for example the hydraulic capacity of the diversion channel after water budget is applied the resulting partitioned flows see fig 1 are routed downstream from the human systems module assuming two different celerity values the first equal to 2 m s for fluxes travelling along transport hydraulic infrastructures whereas flows along the natural stream network travel with the same celerity adopted for macrocell node routing which is one of the 12 model parameters three types of nodes are considered 1 reservoir 2 intake and 3 power plant connections between these nodes are also taken into account by including elements such as tunnels diversion channels and penstocks this allows to fully describe the exchange fluxes between the engineered systems and the river network these modules are detailed in avesani et al 2021 the water budget eq 1 at reservoir nodes is performed considering all the inflows σ q in and the following outflows derivation to all the uses according to the given schedules σ q der release of minimum ecological flow mef q mef and spilling q spill when the maximum regulation level is exceeded 1 dv dt σ q in t σ q der t q mef t q spill t where v is the volume of water stored in the reservoir and σ q der is the sum of the flows diverted for multiple water uses i e inflows to the penstocks connected to downstream power houses although similar considerations can be done for uses other than hydropower with the possibility that a portion of σ q der is added to precipitation in irrigation areas in case of an agricultural or multi uses reservoir in the present work we do not consider this case which however can be easily included if needed intake nodes are locations where water is withdrawn from the natural stream network by means of intake structures connected to diversion channels or other conduits they do not have storage capacity and must obey a mef constraint similarly to reservoirs as sketched in the inset a of fig 2 mass conservation applied to this type of nodes leads to 2 q in nat t q out nat t q div art t q out art t q div art t q in art t where the terms of the water budget are distinguished between natural nat and artificial art fluxes occurring in the river network and in the engineered components of the system respectively in eq 2 q div art varies between zero and the maximum water discharge that the intake can accept the second eq 2 is applied to internal nodes of the engineered system as for example the nodes along the derivation tunnel represented in the inset a of fig 2 intake nodes are also used to model restitution fluxes to the river through a tail race channel as shown in the inset b of fig 2 in this case incoming contributions natural and from the engineered system are merged i e summed according to eq 3 and routed downstream along the stream network 3 q out nat t σ q in art t σ q in nat t a type intake node can also be used to model the confluence between conduits in situations like the one depicted in the inset c of fig 2 in this case the following continuity equation eq 4 is applied at the node 4 q out art t σ q in art t where q out art and σ q in art are the outflow and sum of the inflow fluxes at the node respectively finally hydropower plant nodes behave similarly to restitution nodes routing all incoming flows to the downstream stream network the hydropower production hpp at each hydropower system is computed as follows 5 hpp t η i 1 n ρ g q turb i t δ h i t in eq 5 η is the plant s efficiency which for simplicity is assumed to be the same for all the hydropower plants q turb i and δ h i are the turbined water discharge and the hydraulic head of the i th power unit respectively often for efficiency reasons and also in case the power house receives water from more than one source two or more generation units are installed in the same power house for a storage reservoir hydropower plant the head δ h i is given by the difference between the reservoir water stage and the level of the nozzle or the water level in the afterbay depending of the type of turbine on the other hand for run of the river power plants δ h i is assumed equal to the gross head of the power plant 2 2 data requirements for natural hydrological and human systems modules hyperstreamhs requires gridded input of precipitation temperature and evapotranspiration at the same time step of the simulation these inputs can be obtained either by global meteorological datasets or reconstructed by performing interpolation of ground observations with geostatistical tools embedded in the model digital elevation model dem land use and land cover maps are also needed to identify the river network and to initialize the spatially varying parameters controlling evapotranspiration and infiltration processes daily observed streamflow time series at relevant gauging stations are also needed for calibration and validation of the hydrological model the data requirements for characterizing the natural hydrological module are summarized in table 1 modelling the interactions between the river network and the intertwined hydropower systems requires specific topological and operational data in order to adequately describe the hydraulic infrastructures and reproduce the associated water transfers availability of these data is system specific depending also on the level of industrial secrecy of the producers in order to make our approach general we decided to use only data that are publicly available unfortunately very few data are available in the most widely used global datasets such as global reservoir and dam grand lehner et al 2011 global georeferenced database of dams goodd mulligan et al 2020 future hydropower reservoirs and dams database fhred zarfl et al 2015 and therefore a specific search in public archives of state agencies or from informative leaflets is unavoidable for a proper model set up the full list of topology and operational data needed for an optimal characterization of the systems by using only public data is summarized in table 2 furthermore hydropower production historical data are needed for the validation of the human system module and for approximating the hydropower production scheme of the individual power plant as described in section 2 3 hydropower production time series are publicly available upon request from national managers of electricity grid and they are typically provided aggregated in space and time to comply with confidentiality agreements between the public authorities and producers we remark that all data used in the present work are publicly available and this is because our main objective is to develop a methodology that can be used in other contexts without relying on data collected by the producers which are often kept confidential details about the data used for the case study application are presented in section 3 2 3 hydropower production scheme in addition to meteorological geomorphologic and topology data the modelling framework requires the schedule of all the water uses as input to allow flexibility a schedule is associated to each water use and is provided externally in particular hydropower scheduling was inferred from monthly energy production at the province level which is publicly available assuming that all the hydropower systems were operated similarly at this temporal scale water use schedules at finer temporal scales could be envisioned in case the information is available firstly the average water discharge taken from the reservoir of a hydropower system is estimated as follows 6 q avg i hpp exp i γ η δ h i 24 365 where hpp exp i is the expected annual production for the i th power plant as declared by the company operating the plant and usually computed as long term average δ h i is the gross average head and η is the total efficiency of the plant the derived water discharge time series for the single reservoir are then obtained by modulating the average value provided by eq 6 according to the following expression 7 q der i t q avg i k m t δ w t ϕ e t where k m hpp aggr m hpp aggr ann is the ratio between the mean production of the m th month hpp aggr m and the long term annual mean hpp aggr ann of the available aggregated data of hydropower production δ w is a dummy variable introduced to simulate the reduction of production during the weekends and ϕ e is a function reflecting short to medium term variations due to management strategies here we used ϕ e p avg 3 p avg month where p avg 3 is the three day centered moving average of electricity price and p avg month is the average price of the month moving average is used here to smooth the volatility characterizing the time series of daily electricity prices see e g demir et al 2020 the resulting utilization scheme mimics the interplay between variations in hydrology and water uses the latter influenced by the electricity market a similar approach has been adopted by schaefli et al 2007 with a stochastic component that was added to a historical time series with the intent of mimicking the intrinsic variability of the electricity market according to eq 7 the turbined water flow is controlled by the parameters k m ϕ e and δ w each one addressing a different scale of time variability with the former varying also in space at the level of the provinces an example of the resulting utilization scheme is shown in fig 3 we observe variations at multiple scales from the monthly scale chiefly due to seasonal variations of streamflow to the smaller weekly and daily scales due to fluctuations of the electricity price notice the shutoff of production during the weekends when the price of electricity reduces simulated by setting δ w 1 during weekdays and to 0 in the weekends 3 case study and model set up 3 1 study area the adige river is the second longest italian river with a contributing area of 10 500 km 2 at the gauging station of vó destro fig 4 the watershed occupies a large portion of the southeastern alps in a mountain area with elevation ranging from 200 to 3900 m a s l the annual average precipitation ranges from 500 mm in the north west to 1600 mm in the south lutz et al 2016 diamantini et al 2018 with streamflow showing a typical alpine regime with two seasonal maxima one occurring in spring summer due to snow and glacier melt and the other in autumn triggered by cyclonic storms chiogna et al 2016 lutz et al 2016 mallucci et al 2019 fig 4 shows the natural river network the superimposed hydropower network the hydropower plants and the storage reservoirs though fragmented the hydropower network is distributed over the entire river system and exerts a significant impact on streamflow majone et al 2016 pérez ciria et al 2019 zolezzi et al 2009 3 2 climatic forcing land cover and geomorphology data the adige dataset mallucci et al 2019 was used to provide daily air temperature and precipitation forcing to our simulations the dataset consists of daily readings taken at 244 and 350 gauging stations for precipitation and air temperature respectively that have been distributed on a 5 5 km grid by ordinary kriging with external drift oked adopting terrain elevation as secondary variable goovaerts 1997 grid resolution was set on the basis of previously published studies conducted in the study region with the same hydrological kernel laiti et al 2018 avesani et al 2021 moreover potential evapotranspiration pet was computed according to the hargreaves samani approach hargreaves and samani 1982 and provided as a gridded input to the model soil elevation and land use information were extracted from the 30 m eudem digital elevation model dem and the corine 2006 dataset https www eea europa eu publications cor0 landcover respectively the dem has been corrected in order to comply with the portions of stream network altered by human intervention in accordance with the official stream network provided by the superior institute for environmental protection and research ispra available at http www sinanet isprambiente it it sia ispra download mais reticolo idrografico view 3 3 human systems in the adige watershed within the catchment operate 39 large hydropower systems with installed power ranging from 5 2 to 230 mw 22 of which with reservoir see numbering from 1 to 22 in fig 4 with operational volumes ranging from 0 32 to 172 mm 3 see also table 3 a rather extensive network of diversion channels with capacity ranging from 0 3 to 203 m 3 s is feeding the whole system the total long term average production of these hydropower systems is of 6609 gwh y according to data available from the hydropower companies operating in the river basin thereby contributing to more than 14 of the annual italian hydropower production https www terna it it it sistemaelettrico statisticheeprevisioni bilancienergiaelettrica bilancinazionali aspx information concerning topology and operational data of the hydropower systems located in the adige catchment was collected and structured in a gis database during the eocoe ii project https www eocoe eu water for energy the main characteristics of both run of the river and storage systems are summarized in table 3 while the topology of the hydropower network is shown in fig 4 detailed prescriptions for mef at each water diversion were retrieved from the public water usage plans of the trento and bolzano provinces available at http www pguap provincia tn it and https ambiente provincia bz it acqua piano generale utilizzazione acque pubbliche asp respectively the data used to fully characterize hs module in the adige case study are stored in a public github repository available at https github com majoneb hyperstreamhs in the present work plant efficiency η was set constant and equal to 0 8 which is the average of the efficiencies of the hydropower systems for which this information was available i e 12 out of 22 reservoir hydropower systems of the adige river this is justified by the similarity in the hydraulic characteristics of the power plants 3 4 streamflow and hydropower production time series daily streamflow time series at all the relevant gauging stations in the adige see fig 4 were provided by the hydrological offices of trento http www floods it public and bolzano http www provincia bz it hydro these time series are official measurements and are available at a daily or finer time scale in the 1923 2013 time window with very few gaps hydropower production data were provided by the manager of the italian electricity grid terna http www terna it hydropower production time series are publicly available upon request at a monthly time scale and aggregated by province they have been acquired for the 2000 2015 time window with no gaps moreover data are subdivided between small and large hydropower systems 3 mw installed power threshold in line with the classification commonly adopted in italy and inherited in the present work in which only large hydropower plants are taken into account as they contribute for roughly 90 of the total hydropower production production data of the bolzano province can be used directly for model validation since all the hydropower systems of the province are within the upper adige catchment this is not the case for the trento province because only a portion of the hydropower systems is in the lower adige catchment consequently the observed production of the lower adige catchment is estimated by multiplying the production of the trento province by a factor equal to the fraction of the installed capacity in the adige catchment with respect to that of the entire province under the hypothesis that all power plants are operated similarly 3 5 hydrological model calibration and validation hyperstreamhs was calibrated using the nash sutcliffe nse index nash and sutcliffe 1970 as objective function and searching the parameters space with the particle swarming genetic algorithm pso kennedy and eberhart 1995 as already observed in other works see e g bombelli et al 2019 the common approach of calibrating the model at the catchment outlet does not guarantee good accuracy in the sub catchments which are crucial in our simulations because feeding the hydropower systems to overcome this drawback we adopted a multi site calibration strategy following the suggestion by zhang et al 2008 the model was calibrated by maximizing the global nse index at the following three gauging stations cadipietra 148 8 km 2 gadera 289 9 km 2 and vermiglio 79 0 km 2 all located in undisturbed sub catchments see fig 4 the calibration was performed in the time window 1989 2013 by using the first two years as spin off i e they do not contribute to the objective function validation was performed by computing the nse index at four gauging stations not used in calibration and by comparing the simulated annual energy production provided by eq 5 with the measured one the four gauging stations are vandoies 1917 km 2 mezzolombardo 1356 km 2 bronzolo 7400 km 2 and trento 9000 km 2 as depicted in fig 4 3 6 simulation setup simulations were performed by using a time step δ t 1 h to ensure adequate accuracy in routing consequently meteorological data available at a daily time step were scaled accordingly by assuming a uniform distribution of precipitation and evapotraspiration at the sub daily scale and a constant temperature equal to the daily mean the resulting streamflows were then aggregated at the daily scale before computing the nse index to emphasize the benefits of including a suitable representation of hydropower systems topology and operating rules four configurations were considered each one with the hydropower systems represented by using a different level of detail the adopted simplifications are described here with reference to the sketch shown in fig 5 full this configuration simulates the interaction between natural stream network and hydropower systems with fully detailed topology and reservoir operating rules see fig 5a nat this is the fully natural condition with all hydraulic infrastructures removed therefore only natural streamflows are computed in this case with no flow being diverted for hydropower uses see fig 5b of course in this case no energy is produced qmax this configuration includes all the elements of the hydropower system such as the diversion channels conveyance intakes tunnels and penstocks however reservoir operation rules were simplified assuming that hydropower plants are always operated at their maximum hydraulic capacity only obeying mandatory constraints i e minimum and maximum storage capacity with priority given to the release of mef under these conditions eq 7 reduces to q der i t q sys i where q sys i is the hydraulic capacity of the turbines of the i th power plant as shown in fig 5c res in this case storage reservoir operating schemes were implemented with the maximum possible detail as explained in section 2 3 but conveyance intakes were neglected thereby assuming the reservoir as the only water source for the connected generation units in case of run of the river systems only the main intake was considered in the adige watershed only 5 systems were affected by this simplification whose impact on hydropower production is however worth analysing given their large capacity the impact of this modification is exemplified in fig 5d where the contribution of the conveyance intakes is removed from the water discharge delivered to the hydropower plant 4 results and discussion 4 1 relevance of human systems towards streamflow representation the multi site calibration of hyperstreamhs performed as detailed in section 3 5 by using the gauging stations of cadipietra gadera and vermiglio as reference produced an overall nse of 0 63 which can be considered as satisfactory the model was then validated by comparing the simulated with the measured streamflows at four gauging stations downstream the previous ones and not used for calibration the streamflow at these stations is altered to a various degree by hydropower and therefore the performance varies according to the adopted configuration as shown in table 4 considering the three gauging stations of vandoies bronzolo and trento which are mildly impacted by hydropower the nse coefficients are larger than the global nse obtained in calibration this is an encouraging result and shows that hyperstreamhs provides a good representation of the hydrological system the mezzolombardo gauging station is highly impacted by hydropower see the discussion later and although the nse increases progressively as the hydraulic infrastructures are better detailed its maximum value is below 0 5 which is the lower limit for considering the simulations as satisfactorily see e g moriasi et al 2007 in all cases an improvement in the representation of the hydraulic system leads to an increase though in some cases marginal of nse in validation this shows that including into the modelling effort the hydraulic infrastructures is informative similar conclusions were drawn by dang et al 2020 nat and qmax configurations produce similar results since in the latter hydropower systems are always operated at their maximum capacity with reservoirs dramatically reducing their storage indeed in this situation water is stored only when inflow exceeds the hydraulic capacity i e the maximum water discharge that the power plant can convey to the turbines on the other hand also res and full configurations exhibit a similar behavior and this can be attributed to the fact that res configuration differs from full only in 5 systems out of 22 ids 1 4 9 13 26 in table 3 thereby the impact of a different water use schedule in these systems is hardly noticeable at the validation sites consequently for the sake of clarity fig 6 depicts observed and simulated streamflows for the nat and full configurations which represent the two extreme cases of ignoring the presence of the hydraulic infrastructures and representing them to the maximum possible level of detail allowed by publicly available data as discussed in sections 2 2 and 3 3 as expected the proper representation of the hydraulic infrastructures is important during low flow periods from november to march when hydropower releases affect significantly streamflow timing and magnitude as confirmed by visual inspection of the flow duration curves depicted in right panel of fig 6 on the other hand no appreciable differences are observed between nat and full configurations during high flow periods from may to october because of the cutoff introduced by hydraulic capacity of the hydropower system furthermore the difference between nat and full configurations attenuates as the distance between the gauging station and the intake or restitution points of a hydropower system increases this is the consequence of the reduction of the ratio between the turbined water discharge and streamflow along the river network and away from the hydropower plant for example vandoies bronzolo and trento gauging stations are located sufficiently far from the closest upstream hydropower system and exhibit the typical seasonal streamflow variability with small variations and attenuated oscillations during the low flow periods subplots a c and d in fig 6 conversely the mezzolombardo gauging station see fig 4 is located immediately downstream 2 km of the large mezzocorona hydropower plant id 11 in fig 4 with a hydraulic capacity of 66 m 3 s 1 which dramatically affects the otherwise lower natural streamflows mean annual value of 20 m 3 s 1 upstream of the system despite some inaccuracies due to the limited knowledge of reservoir operating rules the full configuration clearly provides the more realistic representation of streamflow as opposed to the nat configuration subplot b in fig 6 from the above considerations it can be concluded that especially during seasons in which hydropower releases constitute a large share of streamflows i e low flow periods the benefit of including a detailed modelling of hydropower systems is significant for a proper representation of streamflow alterations the impact on streamflow alterations of the three configurations described above was investigated by analyzing the time series of the normalized difference between the streamflow in the presence and in the absence of the hydraulic infrastructures 8 r q i conf t q i conf t q i nat t q i nat t where q i conf t is the daily streamflow computed at node i under the given configuration of the hydraulic infrastructures with conf being either full res or qmax and q i nat t is the daily streamflow computed at the same node under the natural nat configuration mean μ r i conf 1 n t 1 n r q i conf t where n is the number of time steps and standard deviation σ r i conf 1 n t 1 n r q i conf t μ r i conf 2 of the normalized residual time series eq 8 are shown in fig 7 left and right columns respectively this figure visualizes in an intuitive manner the most relevant alterations and their spatial pattern in the full configuration the larger alterations with respect to natural conditions are at reservoir nodes see full rombi in fig 7a since only mef and overtop water discharge during flooding feed the channel immediately downstream the impoundment as detailed in section 2 1 2 positive alterations i e streamflow higher than in natural conditions are observed downstream the restitution of the power plants blue triangles in fig 7a receiving contribution from outside the catchment i e from catchments not belonging to their contributing area qmax and full show similar streamflow alterations figs 7c and 7a given that both elaborate the same annual water volume though with a different timing this latter consideration is valid also for the res configuration with the exception of the nodes belonging to the five systems identified by black rectangles in fig 7e that were topologically simplified in the res configuration in this case no alterations i e μ r i res 0 are observed at the nodes where conveyance intakes are deactivated white dots in fig 7e within the black rectangles however significant alterations slightly smaller than in the full configuration are observed at the corresponding nodes of the power plants an indicator of alterations in streamflow timing occurring at the daily time scale is the standard deviation of the normalized residual time series eq 8 shown in the right column of fig 7 in the full configuration fig 7b the largest deviations from the natural regime are observed at the hydropower plants connected to large storage reservoirs see red triangles in fig 7b as a consequence of a changing in time hydropower production the reason of the reduced with respect to the full configuration standard deviation σ r i qmax observed in fig 7d for the qmax configuration can be identified in the simplification introduced in the reservoir management rules see section 3 6 which indeed cause reservoir hydropower systems to be managed similarly to run of the river systems the effects of an unrealistic hydropower schedule such as that introduced by the qmax configuration will be further discussed in section 4 3 alteration of streamflow timing under res configuration exhibits a similar pattern as in the full configuration with the exception of the nodes belonging to the five systems highlighted in fig 7f where the introduced topological simplification leads to small to negligible variations i e σ r i res 0 with respect to the reference nat configuration 4 2 impact of customary approximations on hydropower production the simulated energy production of the adige catchment in the time window 2000 2013 was compared with the observed one computed as the sum of the entire production of the province of bolzano and the portion of the trento province pertaining to the adige watershed as described in section 3 4 in particular fig 8 shows the comparison between modelled and observed hydropower production for the configurations described in section 3 6 at a monthly time scale with the exception of nat where by definition modelling of human systems is not performed the observed and simulated mean annual productions are also summarized in table 5 where the hydropower systems are grouped into reservoir and run of the river systems the full configuration provided the better reproduction of average annual hydropower production with a small difference of 4 due to the imperfect reconstruction of the unknown operational schedule and to a minor extent to errors in simulating streamflow entering the reservoirs and at the withdrawal points on the other hand qmax and res configurations introduce a bias in the representation of hydropower systems leading to larger errors in the modelled hydropower production generally the errors are smaller for run of the river systems with a minimum of 2 in the full configuration larger deviations in the hydropower production at run of the river systems are indeed observed for qmax and res configurations highlighting that imperfect reconstruction of the operational schedule in storage reservoirs also significantly affects streamflow timing at downstream locations where run of the river plants are located we consider the high accuracy of the full configuration in reproducing historical hydropower production data a significant achievement of the present work indeed existing studies compare different scenarios either in terms of water usage policies or climate change impacts see e g meng et al 2020 bejarano et al 2019 gaudard et al 2013 but they do not validate the hydropower modelling framework under historical conditions in our opinion model validation is a necessary step to avoid possibly biased interpretation of scenario runs in the ensuing section we provide additional evidence on how the simplified configurations res and qmax introduce bias in hydropower production modelling 4 3 effects of simplified reservoir operation modelling we start by evaluating more in detail the effects of the qmax configuration which assumes that the storage hydropower systems of the catchment operate at their maximum capacity when the amount of water in their reservoirs is enough to sustain at least one day of production and shut off when it becomes smaller this simplification is commonly adopted in large scale impact assessment studies see e g turner et al 2017 wagner et al 2016 as detailed information on reservoir operation is often hard to obtain as shown in table 5 the simulation performed with the qmax configuration underestimates the total hydropower production more than the other two configurations res and full the impact of this assumption is exemplified in fig 9 which compares the evolution in time of the water stage in the gioveretto reservoir under both the qmax and full configurations under the qmax configuration the reservoir is most of the time at its minimum level zero utilizable water volume and therefore the hydropower plant operates most of the time as a run of the river system at the minimum head this occurs because in the qmax configuration the water flow withdrawn from the reservoir q der is larger than the mean annual water inflow q in avg and therefore the reservoir is predominantly in low storage conditions as a consequence the production reduces because of the lower head despite the turbined water volume is roughly the same the simulated reservoir water stage in the qmax configuration is nevertheless unrealistic large reservoirs usually perform seasonal regulation of the water storage as is the case in the simulation performed under the full configuration see fig 9 it should be noticed that a correct timing of hydropower production is important for a proper evaluation of the ecological impact of hydropower systems in fact hydropower production may adversely affect reservoir aquatic ecosystems due to internal oscillation of the water stage which if of large amplitude may impair the riparian buffer see e g yang et al 2018 renofalt et al 2010 jager and smith 2008 similarly hydropeaking may significantly affect freshwater ecosystems downstream the restitution see e g larsen et al 2021 finch et al 2015 hall et al 2015 bruno et al 2013 under this perspective a realistic and accurate modelling of timing and magnitude of streamflow alterations due to hydropower operation is of deemed importance from the economical point of view the cost of these alterations due to the loss of ecosystem services should be compared with the increased revenue due to a larger production or a larger share of production in periods with high electricity prices and the reduction of co 2 emissions on the other hand simplifications in the hydropower schedule may lead to inaccuracies in the evaluation of the impacts on the ecosystems see e g vigiak et al 2018 similar conditions to those observed at gioveretto are observed in the other simulated reservoirs result not shown here though the modelled production decreases more in systems in which the head created by the impoundment is a larger fraction of the total head 4 3 1 impacts of uncertainty in the hydraulic capacity operational rules for reservoirs are often not disclosed by the hydropower companies for not providing advantages to competitors in the same electricity market therefore with the hydraulic capacity as the only information available large scale studies are conducted by assuming that reservoir hydropower systems are always operated at their hydraulic capacity q sys i with i indicating the hydropower system i 1 22 in our work consistently with fig 4 and table 3 however this information may be known with uncertainty as well particularly when the study refers to a large number of hydropower plants to evaluate the effect of knowing q sys with uncertainty we considered two additional configurations with q der constant in time as in the qmax configuration and equal to q der i k q sys i with i 1 22 and k 0 8 and 1 2 respectively hereafter the former configuration is called qmax 0 8 and the latter qmax 1 2 given the relatively small deviation from system capacity q sys the efficiency η is maintained constant and equal to 0 8 for the purposes of this analysis three indicators were computed for each hydropower system the first indicator is the ratio i h i δ h i h sys i between the maximum oscillation δ h i of the reservoir level and the mean total head h sys i given by the difference between the elevation of the reservoir center of mass at the maximum operational level and the nozzle or the tailrace depending on the type of installed turbine the second indicator r c i v op i q in avg i is the ratio between the operational volume v op i see table 3 and and the mean annual inflow q in avg i this indicator is equal to the number of days needed to fill the reservoir with a constant inflow q in avg i in the absence of utilization and starting from the minimum level and it represents the regulation capacity rc of the reservoir in addition the variation of the modelled hydropower production with respect to the full configuration is computed as follows δ prod i hpp conf i hpp full i hpp full i where hpp conf i is the hydropower production in the selected configuration i e qmax 0 8 qmax and qmax 1 2 and hpp full i that of the reference full configuration results of this analysis are summarised in fig 10 in which each column represents one of the 22 storage hydropower systems of the adige catchment systems with i h 7 from 1 to 12 do not show significant reductions of the production with respect to the full configuration irrespective to the configuration considered either qmax and its two variations described above this result was expected given the predominance of the geodetic head over the head created by the impoundment as reflected in the relatively small i h of these systems on the other hand the losses of hydropower production increase with i h due to the fact that reservoir oscillations δ h are a significant fraction of the total head similarly to qmax both qmax 0 8 and qmax 1 2 configurations reduce the annual production with respect to the full configuration i e δ prod 0 the lowest reduction is obtained with the configuration qmax 0 8 for most of the systems i e 1 2 4 7 9 10 11 12 13 14 15 16 17 18 19 20 21 however for the systems number 3 5 6 8 and 22 the smallest loss of production is obtained with the configuration qmax 1 2 while the reduction of the loss when the configuration qmax 0 8 is used was expected because of the higher simulated average reservoir level with respect to the configuration qmax the lowest reduction obtained with the configuration qmax 1 2 is counter intuitive the explanation is in the low regulation capacity of these reservoirs all having r c 1 with the exception of hydropower system number 5 when rc 1 the reservoir is rapidly filled and the loss of production is proportional to the spilled water volume which is smaller when q der is larger thereby with the configuration qmax 1 2 in the case of system number 5 despite the regulation capacity not usually being a constraint spilling occurred during some of the extreme high flow seasons and thus configuration qmax 1 2 converted most of the excess flows in hydropower production this analysis shows that even when operational schedule is unknown performing the simulation with the qmax configuration or a similar one produces good estimates of the annual energy production however simulations lose accuracy for specific hydropower systems with a reservoir whose maximum oscillation is a significant portion of the head notably the system presenting the second largest i h i e the s giustina reservoir connected to the taio plant see also table 3 exhibits a loss of 30 in the annual production 4 4 effects of simplified network topology in the res configuration only primary water sources such as the reservoir or the main intake in the run of the river hydropower systems were included see fig 5d thereby neglecting the contribution of the conveyance intakes as a result natural streamflow was not affected by conveyance intakes q div art t 0 in eq 2 and turbined volumes were underestimated this approximation is common in studies at regional or larger scales because the technical information needed to simulate conveyance intakes is rarely included into large scale datasets accessible online in addition to the analysis of the difference between the res and full configurations we considered a modified configuration named res qmax which adds the simplifications in reservoir management qmax configuration to those related to system topology res with the aim to verify if and how these two assumptions interact and influence the accuracy of the modelled hydropower production only 5 out of 39 large hydropower systems in the adige watershed include conveyance intakes and were therefore relevant to this analysis the percentage contributing area associated to the conveyance intake and i h indicator of these hydropower systems are shown in table 6 together with their simulated mean annual production under the different aforementioned configurations as expected in all hydropower systems the res configuration leads to a smaller production than the reference full configuration because of the water volume lost by neglecting the conveyance intakes which is not compensated by a larger use of the water stored in the reservoir the production loss is proportional to the drainage area of the conveyance intakes and increases further under the res qmax configuration except for sarentino which is a run of the river power plant operating in conditions similar to qmax fed by a small impoundment with negligible oscillations i h 0 the further loss observed in the combined configuration res qmax is roughly proportional to the structural parameter i h this is expected because in systems with high i h hydropower production is sensitive to changes in the impoundment elevation this analysis highlights that despite performing well at the aggregate scale the res configuration introduced significant biases in the simulated hydropower production of the systems with conveyance intakes see table 6 similarly streamflow is strongly affected by the simplifications introduced in the res configuration both aspects indeed represent a fundamental piece of information for local and regional studies that attempt to analyze competing water uses la jeunesse et al 2016 majone et al 2012 rasanen et al 2017 zeng et al 2017 or to develop sustainable water use policies under a changing climate see e g grizzetti et al 2017 winemiller et al 2016 although open source reservoir datasets such as grand lehner et al 2011 goodd mulligan et al 2020 fhred zarfl et al 2015 represent a valuable source of information for large scale assessments of reservoir functioning and impacts those datasets do not include data concerning conveyance intakes nor they provide information about the connected hydropower plants and their operational schedules our simulations showed that more comprehensive datasets providing detailed information about hydropower systems and their network topology are a valuable piece of information that should not be disregarded though difficult to achieve 5 conclusions we analyzed the effects on modelled streamflow and hydropower production of different levels of approximation used to represent the hydropower systems in a hydrological model a distributed hydrological model hyperstreamhs was first calibrated by using the data of three gauging stations in headwater catchments not influenced by hydropower and other significant water uses the validation of the modelling framework was then performed by comparing simulations extended to the entire adige watershed conducted with the most detailed representation of hydraulic infrastructures that publicly available data allow to achieve full configuration with historical time series of measured streamflow and hydropower production data the full configuration was then assumed as reference and compared with three additional simplified configurations typically adopted in large scale hydrological modelling to make data collection more affordable res qmax and nat assuming the latter as reference for the natural conditions of the watershed the reference configuration full provided a very good representation of total hydropower production of the adige river at the annual scale the difference with the measured production was only of 4 differences of the order of 10 where observed with the other configurations all configurations including the hydropower systems improved the streamflow representation i e produced higher nse indexes at the selected stream gauges in validation with respect to the nat configuration thereby confirming the advantage to include though in an approximate manner hydraulic infrastructures into hydrological modelling streamflow alterations at the modelling nodes were analyzed by comparing the three hydropower configurations i e full res and qmax with the natural configuration nat spatial patterns of streamflow alteration magnitude are similar in the three hydropower configurations fig 7a c e the largest increase in streamflow variability epitomized by the standard deviation of the normalized residuals is observed for the full configuration at the hydropower plants connected with large reservoirs due the relevant hydraulic capacity of the power plant which is typically higher than the mean natural streamflow compared to full qmax configuration shows a lower increase of streamflow variability due to the simplifications introduced in reservoir management res configuration shows results similar to full with the exception of nodes in which topological simplifications were introduced performance analysis of the qmax configuration at the reservoir scale showed that this approach is acceptable in terms of average annual production although its performances deteriorate significantly for reservoirs whose oscillations are a relevant portion of the total head of the system resulting in differences up to 30 in annual production in these cases making realistic assumptions of the production schedule substantially improved the reliability of the predictions in all cases despite good estimates of the annual production modelled reservoir levels do not exhibit seasonal patterns as it would otherwise be expected the five systems simplified by the res configuration showed a remarkable reduction of modelled hydropower production as the main water sources reservoirs or main intakes were not able to compensate for the missing flux provided by the conveyance intakes thereby causing an underestimation up to 53 of hydropower production this latter result highlights how a detailed conceptual model and an accurate representation of hydraulic infrastructures is a crucial part of the modelling endeavour often more important than capturing the operational schedule which is rarely available finally results show that biases in the res and qmax configurations do not compensate rather they accumulate in a non linear manner see table 6 in the present work we showed that hydrological modelling in catchments with streamflow altered by hydropower or other water uses can benefit from including explicitly the functioning in terms of water transfers of hydraulic infrastructures into the hydrological model given that technical information concerning these hydraulic infrastructures is often lacking or incomplete and difficult to obtain we developed and tested a modelling approach that relies solely on publicly available information the comparison with commonly adopted simplifications showed that an accurate search for publicly available data more than commonly done is worth the investment of the financial resources and time required to perform it the reward being chiefly in a more accurate modelling of streamflow and hydropower production for the hydropower systems of the catchment the proposed framework is also useful to guide modelling of hydropower production at the regional and national scales credit authorship contribution statement andrea galletti writing original draft investigation methodology software visualization diego avesani software visualization writing review editing alberto bellin writing review editing conceptualization methodology supervision bruno majone writing review editing conceptualization methodology supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research received financial support by the energy oriented centre of excellence eocoe ii ga number 824158 funded within the horizon2020 framework of the european union and by the project seasonal hydrological econometric forecasting for hydropower optimization she funded within the call for projects research südtirol alto adige 2019 autonomous province of bozen bolzano south tyrol this research has been also supported by the italian ministry of education university and research miur under the departments of excellence grant l 232 2016 streamflow data were provided by the hydrographic office of the autonomous province of bolzano www provincia bz it hydro and by the ufficio dighe of the autonomous province of trento www floods it information on storage reservoirs was retrieved from the italian registry of dams rid http dgdighe mit gov it managed by the italian ministry of infrastructures and transportation 
