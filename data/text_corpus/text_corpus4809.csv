index,text
24045,horizontal resolutions of regional ocean models are often inadequate to resolve submesoscale vertical advection sva in the continental shelf seas this study aims to compare the sva in two similar model setups in the east china sea with different horizontal resolutions a novel method to parameterise the impact of sva on temperature sva t has also been proposed which can significantly improve the low resolution model lrm results in particular we focus on the time frame wherein this method can be applied the suggested method primarily improves the representation of an internal warming process which is significant in both the observations and high resolution model hrm but is absent in the original lrm combined with the observations we found that the internal warming which occurred in the barrier layer of the water column during early autumn is accompanied by submesoscale oscillations of isothermals in the hrm sva dominates the internal warming process and increases the total vertical advection by up to an order of magnitude in the hrm compared with the lrm therefore we parameterised sva t by increasing the vertical thermal diffusion coefficient in the lrm to further specify the time frame wherein the parameterisation can be applied we introduced two empirical conditions related to the major generation mechanisms of frontogenesis mixed layer instabilities and turbulent thermal wind in the mixed layer a deep mixed layer depth 20 m and a large surface bottom temperature difference t 2 c finally we successfully simulated the internal warming in the lrm during early autumn by applying the proposed method nevertheless the parameterisation of the horizontal distribution of sva t needs to be considered in the future to achieve better three dimensional model results keywords submesoscale advection mixed layer instabilities internal warming vertical mixing dynamical parameterisation east china sea 1 introduction submesoscale advection which is shaped like filaments or eddies with a horizontal scale of approximately 1 10 km have frequently been reported in the frontal area of the upper ocean mcwilliams 1985 thomas et al 2008 capet et al 2008a sasaki et al 2014 these submesoscale circulations are dynamically defined by conditions where the relative vertical vorticity ζ equals or exceeds the planetary vorticity f where the rossby number ro ζ f thomas et al 2008 is o 1 recent studies have pointed out that the submesoscale advections dominate the vertical exchanges of heat salinity and momentum spall 1997 haine and marshall 1998 ferrari and rudnick 2000 thomas 2005 therefore submesoscale vertical advection sva plays a dominant role in the vertical exchanges however most ocean models in particular global simulations are unable to meet the high resolution necessary to simulate sva therefore the contribution of sva needs to be parameterised in low resolution models lrms to improve lrms we need to determine the dynamical impact of sva on vertical exchanges in high resolution models hrms as an example of vertical heat exchange the impact of sva on temperature sva t can be quantified as w t where w is the sva and t is the vertical temperature difference sva t can be simply understood as a vertical stirring via sva under the condition of a strong vertical temperature difference however both terms i e w and t are driven by complicated dynamics on multiple scales mcwilliams 2016 summarised the generation mechanisms of submesoscale currents in oceanic mixed layer mainly mixed layer instabilities mlis frontogenesis and turbulent thermal wind in surface mixed layer the mlis occur in a weakly stratified layer with a lateral buoyancy gradient along the surface boundary and a more strongly stratified interior below boccaletti et al 2007 fox kemper et al 2008 zhai et al 2008 the frontogenesis is induced by the strain rate of the background horizontal deformation flow with a favourably aligned surface lateral buoyancy gradient wind forcing and tides can generate strong vertical mixing which in turn can drive strong submesoscale currents via the turbulent thermal wind mechanism gula et al 2014 mcwilliams et al 2015 all these processes exhibit a forward energy cascade to dissipation with an accompanied diapycnal mixing a deeper mixed layer and stronger lateral buoyancy temperature gradients suggest that more potential energy is available in the mixed layer and stronger submesoscale current can be generated a good connection between strong sva and the deep mixed layer depth mld has been found in the subtropical countercurrent and kuroshio regions sasaki et al 2014 qiu et al 2014 however mcwilliams 2016 pointed out that neither the dissipation nor the mixing rates have yet been accurately quantified for submesoscale currents globally even though local examples show that such effects can be significant to quantify sva t w t we need to synthetically analyse the dynamics on multiple scales including mean circulation mesoscale advections and microscale mixing because temperature is a result of dynamics on multiple scales the relative contributions of various turbulent motions in the temperature are usually illustrated in terms of the reynolds averaged equation eq 1 which has been successfully applied to nutrient analyses lévy et al 2012 1 t t local u t mean h u t mesoscale z w t submesoscale z k v z t micr o scale where the local temperature change is caused by contributions from the mean circulation mesoscale advections sva and microscale mixing of temperature the overbar indicates an average over a spatio temporal scale is larger than the submesoscale field the prime denotes eddy fluctuations and u indicates the horizontal velocity for clarity we herein considered the mean by averaging over a spatial scale of 10 km we separated the mesoscale and submesoscale reynolds fluxes which represent the advective transport of material properties along density surfaces with reversible mixing and the microscale reynolds fluxes which are associated with the irreversible mixing of water masses the effect of microscale turbulence often referred to as vertical mixing is particularly strong in the turbulent boundary layers where it keeps the temperature well mixed in this equation the microscale turbulence is parameterised as a vertical diffusion term with a parameter k v which is the temperature vertical diffusion coefficient tvdc ledwell et al 1998 pointed out that the horizontal and vertical advective reynolds fluxes are dominated by the mean circulation and mesoscale eddies and by mesoscale eddies in the ocean interior away from the ocean boundaries respectively however there is a growing evidence that in the upper few hundred metres of the oceans the vertical fluxes are dominated by sva particularly in frontal areas capet et al 2008a klein and lapeyre 2009 the southern east china sea ecs is a prominent area where the strong sst fronts combined with significant sva occur therefore this region was selected to serve as a typical area for studing sva t yin and huang 2016 have documented a complete evolutionary process of submesoscale frontal waves off the southeast coast of the southern ecs using geostationary ocean colour imagery data a remote sensing snapshot of the sst for 2 november 2013 fig 1a shows a submesoscale temperature distribution over a broad area between the coastal current and kuroshio region the observed horizontal scale of these submesoscale temperature patches covers a wider range of 1 50 km than the typical size of phenomena i e 1 10 km indicating that submesoscale activities can rapidly grow at time scales of the order of a day as shown by the idealised numerical results of boccaletti et al 2007 these submesoscale temperature patches suggest rich sva t activity in the southern ecs traditionally the vertical temperature in the southern ecs is thought to have a three layer structure namely an upper mixed layer barrier layer and bottom mixed layer which is shown via an annual average of the generalised digital environment model gdem carnes 2009 data fig 1b herein the upper and bottom mlds are defined as the depth where the temperature has decreased and increased from the surface and bottom value by 0 1 c respectively the heat exchanges in the upper and bottom layers are rapid because of the microscale mixing and barrier layer is understood to be a heat blocking layer between the upper and bottom mlds however strong sva may challenge our former understanding of the vertical temperature structure in the southern ecs sva may continuously exchange the cold water in the barrier layer with the warm water in the upper mixed layer acting like a warming process in the barrier layer and ultimately altering the heat budget in the interior ocean currently most climate models ignore sva t owing to their insufficient spatial resolutions which may cause significant bias while calculating the temperature and atmosphere ocean heat exchanges on the basis of the dynamical model solution of sva t w t we studied the temperature structure sva and sva t for the case of a strong sva t comparisons between the hrm and lrm results were used to investigate the impact of the resolution on sva t in a frontal area between the cool coastal current and the warm kuroshio current fig 1a rectangular area since both the remote sensing sst data and the field survey data on 2 november 2013 indicate a significantly strong sva in the southern ecs we used 2 november 2013 as a typical day to analyse the dynamics of sva t furthermore the prediction and parameterisation of sva t are discussed to improve the lrm results which are currently unable to directly simulate sva t 2 model configuration and validation 2 1 configuration of two different resolution models an hrm and lrm were used to investigate the role of sva t on the heat budget on the ecs shelf based on the finite volume coastal ocean model fvcom chen et al 2003 on the shelf a high resolution 0 5 km triangular grid was used in the hrm fig 2a on the contrary a low resolution 10 km triangular grid was used in the lrm fig 2b taking an average mld of 60 m a mixed layer deformation radius of approximately 4 km can be obtained when using the approximation b ml h ml f barkan et al 2017 where b ml denotes buoyancy difference across the mixed layer and h ml is the mld therefore it can be concluded that the submesoscale activities are resolved in the hrm but not in lrm the model domains original bathymetric data meteorological forcing open boundary conditions and initial conditions for the two models are identical unstructured grids were developed for the entire coastal china sea and for parts of the japan east sea and the pacific ocean the general bathymetric chart of the oceans smith and sandwell 1997 provides high resolution approximately 1 km bathymetric data a sigma stretched coordinate system was used to specify 40 vertical layers with a vertical resolution of approximately 1 5 m in the mixed layer horizontal and vertical diffusivity coefficients used in the two models table 1 were estimated by the smagorinsky eddy smagorinsky 1963 and k profile parametrisations large et al 1994 respectively the driving forces of the numerical simulations included tides river discharge surface heat fluxes wind and open boundary conditions the harmonic constants of 11 major tidal constituents namely m2 s2 n2 k2 k1 o1 p1 q1 m4 ms4 and mn4 were used on the basis of the oregon state university global inverse tidal model tpxo 7 0 egbert et al 1994 egbert and erofeeva 2002 the river discharge information for the changjiang river was taken from publicly available observational data from the datong hydrometric station http yu zhu vicp net the daily mean heat fluxes were obtained from objectively analysed air sea fluxes yu and weller 2007 and the 3 h wind stress data were obtained from the era interim re analysis dee et al 2011 the open boundary conditions including the daily temperature salinity and velocities at the taiwan strait the western pacific ocean and the japan east sea were obtained from the hybrid coordinate ocean model bleck 2002 the initial conditions were obtained after 3 years of spin up and the hourly outputs of the sea surface height temperature salinity and velocities for 2013 were used for the analysis since our discussion focusses on time scales above the tidal cycle a tidal filter godin 1972 with a moving average was employed to remove tidal oscillations 2 2 model data comparison since we are concerned with the seasonal differences between the hrm and lrm the seasonal variations in the temperature obtained from three surveys in 2013 and gdem were used to validate the two models in may august and october 3 surveys were conducted along two fixed sections a1 a7 and b1 b6 in fig 1 red dots the gdem temperature profiles were monthly averaged all the simulated and observed temperature data were horizontally averaged at the locations of the observation stations fig 1 red dots and were displayed finally in the form of time series and vertical profiles figs 3 and 4 the ssts from both models fig 3a blue and red curves are in good agreement with the observed temperature fig 3 asterisks and the gdem data fig 3 black curves with a temperature difference of 1 c both the simulated and observed ssts show a seasonal variation in the temperature with a warming from april to august and a cooling from september to march the simulated sst in 2013 is close to the annual averaged result of the gdem indicating that 2013 was not an unusual year fig 3b shows the comparisons of the temperature at a depth of 70 m between the two simulations and the observations herein we used the 70 m layer to represent the barrier layer the simulated temperature of the hrm fig 3b blue line agrees well with the three surveys fig 3b asterisks and shows the same pattern as the gdem data fig 3b black line moreover there exists a large temperature difference approximately 2 c during the autumn between the lrm fig 3b red line and the observed data fig 3 asterisks and black line therefore the seasonal variation in the temperature in the interior ocean is reproduced much better in the hrm than in the lrm both the observed and the hrm simulated data indicate an internal warming in the barrier layer from 15 august to 30 october however lrm fails to simulate this internal warming these results indicate that the internal warming is likely caused by sva t which is included in the hrm but excluded in the lrm fig 4 shows a model validation via vertical temperature profiles using data from three aforementioned surveys conducted during the spring summer and autumn of 2013 the simulated and observed temperature profiles show a three layer vertical structure comprising an upper mixed layer barrier layer and bottom mixed layer as shown in the gdem in fig 1b the depth of the upper mixed layer is shallow 20 m during spring and summer but significantly deeper 50 m during autumn and winter the autumn temperatures of the barrier and bottom mixed layers in the lrm fig 4c red curve are much lower than the observed fig 4c black curve and hrm fig 4c blue curve temperatures the high temperatures in the hrm and observations are related to the sva t induced internal warming shown in fig 4b which are missing in the lrm the differences in the circulation patterns between hrm and lrm can be illustrated via the surface currents on 2 november 2013 fig 5 when the model resolution is improved from 10 to 0 5 km the submesoscale advection becomes significantly stronger by an order of magnitude in the study area where the larger scale currents such as the kuroshio current are generally weak these submesoscale advections in the hrm fig 5a are related to the submesoscale temperature distributions on 2 november 2013 as seen in the remote sensing data fig 1a indicating that the hrm realistically simulates the submesoscale processes on the contrary lrm provides a pattern without the submesoscale advections fig 5b as is the case for most current ocean models interestingly even though the lrm does not include the submesoscale dynamics the two models show nearly the same volume fluxes not shown across the taiwan strait east taiwan channel tsushima strait tokara strait and the shelf break of the 200 m isobath which means that the horizontal fluxes induced by the submesoscale advection provide an insignificant contribution to the seasonal mean fluxes 3 results the internal warming in the barrier layer fig 3b was explored by comparing the simulated temperatures between hrm with sva and lrm without sva hereinafter we focus our discussion on the dynamical solution of sva t w z t to further examine the internal warming using a detailed analysis of the temperature structure sva sva t and the related heat budgets 3 1 temperature structure to better examine the internal warming in the hrm we analysed the seasonal variations of parameters simulated by the hrm and lrm fig 6 the simulated temperature time series were obtained via horizontal averaging over the study area fig 1a rectangular area and vertical averaging over the respective layers in addition a snapshot of the vertical temperature structure at the end of the internal warming period 2 november 2013 is presented fig 7 the major difference between the simulated temperatures in hrm and lrm is found during autumn from september to november fig 6a the water column mean temperature in the hrm is approximately 1 c higher than that in the lrm during autumn this indicates that there is an additional warming process in certain layers during the period from 15 august to 30 october fig 6 dashed rectangle to further disentangle this warming process the temperature time series in the upper mixed layer and in the barrier layer are depicted fig 6b and c the temperatures in the upper mixed layer in hrm and lrm are almost identical fig 6b whereas there is a significant temperature difference up to 2 1 c between the two models in the barrier layer during autumn fig 6c in addition the internal warming is associated with a cooling of the upper mixed layer water which differs from the traditional cooling processes induced by microscale mixing indicated by a monotonically decreasing temperature from the surface to the interior this suggests that sva could be the dominant mechanism driving the internal warming in the hrm the role of sva was further indicated by the vertical temperature structure fig 7 section a fig 1a was used for this comparison because it is located at the centre of the focus area both the observations fig 7a and simulations fig 7b and c show a three layer structure namely an upper mixed layer barrier layer and bottom mixed layer which agrees well with the gdem data fig 1b the three layer structure is more noticeable in the offshore area where the water depth is 80 m in this area the upper mld is deeper than 50 m indicating a higher level of available potential energy in the mixed layer linked to a possibly stronger tendency for sva generation the available observations comprise only seven stations the vertical dotted lines in fig 7a c which are labelled on the top of fig 7a unfortunately the low temperature zone above the barrier layer simulated in the hrm between distances of 220 km and 255 km does not include any observations nevertheless the vertical temperature structures are well simulated in the hrm at the neighbouring observational stations 06 and 07 large vertical temperature gradients exist in the barrier layer which is in line with the traditional view that the heat exchange is very small in this layer the temperature structure in the barrier layer is very different between hrm fig 7b and lrm fig 7c simulations the upper boundary of the barrier layer in the hrm fig 7b blue line oscillates between 40 and 80 m in the offshore area whereas it is nearly stationary at a depth of 50 m in the lrm fig 7c blue line the horizontal scale of these oscillations in the hrm is 50 km even though this scale is slightly larger than the typical scale of sva which is approximately 1 10 km these oscillations are most likely generated by sva it is known that submesoscale activities can rapidly grow on time scales of the order of a day as demonstrated by boccaletti et al 2007 even though the observed vertical structures are obtained from a rather sparse station grid oscillations of the isothermals in the barrier layer which are simulated with the hrm are clearly observed fig 7a another obvious difference between hrm and lrm is the temperature at the bottom and barrier layers fig 7 right column under the influence of sva the barrier layer in the hrm simulation is approximately 10 m thicker than that in the lrm simulation which ultimately results in a 2 c increase in the bottom water temperature in the hrm the barrier layer temperature in the hrm is approximately 2 c higher than that in the lrm which can be attributed to the oscillations induced by sva to understand how sva acts on the internal warming one should consider the following scenario sva in the hrm causes a non homogeneous state in the barrier layer consequently the warm and cool water in the upper mixed layer and barrier layer respectively are vertically exchanged since the temperature in the upper mixed layer remains largely unchanged owing to the heat feedback at the air sea interface temperature in the barrier layer increases because of the heat gain from the upper mixed layer 3 2 distribution of sva the maximum value of the total vertical advection in the hrm fig 8a is 6 7 10 4 m s which is approximately five times larger than vertical advection in the lrm 1 4 10 4 m s fig 8d in addition the mean value of the total vertical advection in the hrm is seven times larger than that in the lrm the total vertical advection for different rossby numbers can be compared between hrm and lrm on the basis of a dimensional analysis that was introduced by mahadevan 2016 2 w rouh l where u is horizontal velocity h is depth and l is length scale of the mesoscale process using eq 2 the total vertical velocity amounts to w 10 4 m s in the lrm for the empirically derived conditions ro 0 1 u 0 1 m s h 100 m and l 10 km on the contrary the rossby number increases locally to o 1 in the hrm which causes the total vertical advection to increase to w 10 3 m s one order of magnitude larger than the total vertical velocity in the lrm using a low pass space filter with a cut off scale of 10 km we separated sva from the total vertical advections in hrm and lrm a comparison between the total vertical advections fig 8a and sva fig 8b in hrm shows that approximately 95 of the total vertical advection is generated by sva therefore the occurrence of sva may increase the vertical advection by up to one order of magnitude a comparison between the magnitudes of the vertical advection and buoyancy gradient fig 8b green curve shows that the downward velocity is on the colder side of the front filament whereas the upward velocity is on the warmer side in addition sva can penetrate below the mixed layer in our model simulation a major reason for this is that the buoyancy exhibits horizontal variations underneath the mixed layer zone under the more realistic conditions employed in our study sasaki et al 2014 showed that the sva can penetrate below the mixed layer in real ocean simulations even though in their case they employed mlis to interpret sva topographic wakes occurring at the shelf edge may contribute to the vertical penetration of sva because such wakes can generate vertical velocities that reach from the bottom of the ocean to near the surface dewar et al 2015 rosso et al 2015 sva also affects the vertical exchanges of heat and salt i e the vertical buoyancy flux fig 8b contours and vertical heat flux fig 7b in analogy to the temperature structure fig 7b the isopycnal lines fig 8b contours i e 23 0 σt also oscillate in the offshore area in the hrm but remain flat in lrm indicating that vertical buoyancy fluxes are generated by sva in the barrier layer altogether the distributions of the density anomalies in the two models fig 8 contours show patterns similar to the corresponding temperature structures fig 7 which means that the buoyancy flux and temperature flux act on the same pace therefore it can be concluded that sva is well represented by the internal warming process discussed in section 3 1 the dynamics of the sva was investigated using the four major generation mechanisms indicated by mcwilliams 2016 the scaling theories for the ageostrophic secondary circulation stream function as proposed by barkan et al 2017 were examined with respect to the generation of mlis mle eq 3a frontogenesis strain eq 3b and turbulent thermal wind ttw eq 3c the generation of topographic wakes can be examined via the bottom generated vertical motion w bottom eq 3d 3a mle h bl 2 b 2 f 3b strain γ f mle 3c ttw u h bl b f 2 and 3d w bottom u bottom h where h bl is the surface boundary layer depth b is the magnitude of the surface buoyancy gradient γ is the large scale geostrophic strain rate u is the magnitude of the surface frictional velocity and h is the topography a combination of all four sva generation mechanisms is active in the ecs note that the first three mechanisms are well correlated with the deeper mld as shown in fig 9 the mlis frontogenesis and turbulent thermal wind are somewhat evenly distributed over the entire domain whereas topographic wakes only occur along the edges of the continental shelf frontogenesis has a weaker magnitude than the mlis suggesting that there exists a small large scale geostrophic strain over the entire research area as indicated by eqs 3a and 3b conversely the magnitude of the turbulent thermal wind is similar to that of the mlis which means that the boundary layer turbulence from u in eq 3c makes a large contribution to the sva generation although the three mechanisms in the mixed layer are different with their magnitudes according to above scaling theories it may be more complicate to establish the dominant mechanism e g frontogenesis may be the dominant mechanism when the mixed layer is shallow however the surface boundary layer depth h bl which controls the mld has a dominant effect on the seasonal variation of the first three generation mechanisms fig 9e because their variations are closely linked to the mld fig 13a blue curve in all the above generation mechanisms the available potential energy is converted to eddy kinetic energy which results in the temperature fluxes w t fig 11b being positive nearly everywhere in section a1 7 on 2 november 2013 in the hrm 3 3 distribution of sva t two conditions in the barrier layer namely a high vertical temperature gradient fig 7 and strong sva fig 8 indicate a significant sva t in this section we discuss sva t making use of the definition z w t given in eq 1 sva t causes a heat exchange between the warm upper mixed layer and cool barrier layer increasing the temperature in the barrier layer and decreasing the temperature in the upper mixed layer these effects were explored in the hrm simulation fig 10a in the upper mixed layer sva t was negative above the mld fig 10a green curve indicating that the cool water in the barrier layer is transported to the upper mixed layer on the contrary sva t is generally positive in the barrier layer which means that the water in this layer becomes warmer in addition sva t is insignificant in the inshore area inshore of the 80 m isobath because the temperature is vertically well mixed in the inshore area sva t becomes very weak in the lrm simulation fig 10b because sva is absent even though the three layer structure of temperature is prominent in the offshore area despite the coarse model resolution 3 4 temperature dynamics to quantify the contribution of sva t to the internal warming we integrated the relative contributions of the various motions over the depth range of 50 100 m from 15 august to 30 october using eq 4 which is an integrated form of the reynolds averaged equation eq 1 the 50 100 m depth interval was chosen as being representative of the barrier layer under the seasonal mean contribution of sva t fig 1b 4 aug 15 oct 30 50 m 100 m t t local dzdt aug 15 oct 30 50 m 100 m u t mean h u t mesoscale z w t submesoscale z k h z t microscale dzdt according to eq 4 the local temperature tendency term is approximately balanced by the other four terms representing processes on various scales mean mesoscale submesoscale and microscale the horizontal diffusion and mesoscale advection are negligible in our research area the tendency term in the hrm simulation fig 11a is positive in nearly the entire southern ecs indicating a general warming of the barrier layer the four terms on the right hand side of eq 4 contribute differently to this warming process the mean advection fig 11f is the largest term in the kuroshio region outside the 200 m isobath and in the kuroshio intrusion region north of taiwan indicating that warmer water in the south is transported northward by the kuroshio current to the ecs in autumn the mesoscale advection plays a minor role with respect to the internal warming in comparison with the other three terms therefore it is not shown in fig 11 the submesoscale term fig 11c affects the entire ecs particularly the region between the 100 and 200 m isobaths indicating that sva is a major factor affecting the internal warming in the barrier layer the microscale mixing fig 11d also has a large impact over the entire ecs however its contribution between the 100 and 200 m isobaths is much smaller than that of the submesoscale term the impact of sva on the internal warming is further highlighted by comparing the temperature changes between the hrm fig 11c and lrm fig 11g simulations in lrm the mean mesoscale and microscale terms are similar to those in hrm whereas the submesoscale term is smaller by an order of magnitude than that in the hrm consequently the tendency term in the lrm is also much smaller than that in the hrm indicating that the internal warming process is absent in the lrm this further demonstrates that sva makes a large contribution to the internal warming fig 12 shows the spatially averaged time series of the different terms contributing to the temperature tendency on the basis of eq 1 in the barrier layer when a positive local term fig 12 black line occurs in the internal warming period fig 12 the period marked with a dashed line sva t fig 12 red line is larger than the other factors indicating the dominant role of sva on the internal warming in the barrier layer 4 discussions 4 1 timing of the internal warming previous studies have indicated that the strongest sva occurs in the winter or spring mensa et al 2013 qiu et al 2014 sasaki et al 2014 however our results show that in the ecs the most pronounced sva t induced internal warming occurs in early autumn this is caused by the joint contributions of sva and vertical temperature gradient even though the sva during autumn is weaker than that during winter the vertical temperature gradient is much larger during autumn than it is during winter when vertically well mixed temperature conditions prevail therefore the timing of the maximum internal warming is obviously different from that of the maximum sva an empirical method was proposed to predict the timing of the internal warming taking into account that the driving force of the internal warming is sva t w z t in the study area the offshore sva fig 9c agrees well with the mld fig 13a suggesting that there is a critical value of mld that could act as a trigger for the internal warming another critical value could be the strength of the temperature difference between the surface layer and bottom layer t indicating the potential of sva to affect the water and heat exchange fig 13a shows the variations in mld and t and their correlation with the timing of the internal warming the results demonstrate that the internal warming occurs under conditions of mld 20 m and t 2 c therefore these conditions which are also tracked in the lrm can be used to predict the timing of the strong sva t period and the subsequent internal warming in the ecs the above empirical method requires that a reference vertical structure for the temperature is available from observations or climatological data both the actual mld and the t can be estimated from the vertical structure of temperature using common methods kara et al 2000 thomson and fine 2003 lorbacher et al 2006 which facilitates the rapid prediction of strong sva t events fig 13b and c show two extreme structures that exhibit strong internal warming at the beginning of the internal warming period fig 13b t was larger than 6 c when the mld deepened to 20 m sva became strong enough to transport warm water from the upper layer to the barrier layer on the contrary at the end of the internal warming period fig 13c t decreased to approximately 2 c and the heat flux became very small even though the water exchange between the upper layer and the barrier layer induced by sva was reasonably strong 4 2 improvement of the lrm via an sva t parameterisation it has been shown that at the submesoscale mechanisms associated with energy and heat transfers are closely linked to the vertical velocity field lapeyre and klein 2006 thomas et al 2008 capet et al 2008a 2008b klein et al 2008 tulloch and smith 2009 ferrari 2011 mcwilliams et al 2009 mensa et al 2013 gula et al 2014 the inclusion of these submesoscale dynamics in numerical simulations can alter the total eddy kinetic energy by as much as a factor of two sasaki et al 2014 qiu et al 2014 and significantly enhance the lateral dispersion of passive tracers haza et al 2012 current models in particular global models systematically underestimate the vertical heat flux associated with sva because of their low horizontal resolution therefore an appropriate parameterisation of sva t could significantly improve the lrm results and estimates such as heat fluxes to better parameterise sva t in lrm we first examined the difference in the microturbulence between the hrm and lrm the k profile parametrisation is used to analyse the microturbulence in the boundary layer which is determined from our model results according to the following eqs 5 and 6 5 k v σ h w v σ g σ and 6 ri b d b surf b d d v surf v d 2 v t 2 d where k v σ is the vertical thermal diffusion coefficient in the boundary layer varying with the dimensionless vertical coordinate σ h is the boundary layer depth w v is the vertical turbulent velocity scale parameterising the surface momentum forcing g σ is a nondimensional vertical shape function that is assumed to be a cubic polynomial h is the boundary layer depth bld determined by the minimum depth where the bulk richardson number ri b reaches a critical value of 0 3 b surf and v surf are the near surface values of the buoyancy and the horizontal velocity respectively d is the depth below the ocean surface b d is the buoyancy v d is the velocity and v t d is the turbulent velocity parameterising the surface buoyancy forcing which determines the buoyancy entrainment into the pycnocline layer both the hrm and lrm show increased turbulence from 2 august 2013 to 2 november 2013 fig 14 however the magnitude and structure of k v are different for the two models for example k v on 2 november 2013 fig 14b and d the bld in the hrm is deeper than that in the lrm which means that the restratification induced by the sva is not strong enough to affect the bulk richardson number ri b in the water column moreover the temperature below the boundary layer increases in the hrm which reduces the buoyancy difference between the surface mixed layer and the underlying water masses and in turn causes a deepening of the boundary layer according to eq 6 conversely the restratification induced by the sva causes a weak surface momentum forcing w v which results in smaller turbulence in the hrm fig 14b compared to the lrm fig 14d the sva induced destratifying is exactly an opposite situation with the classical sva induced restratification physics fox kemper et al 2011 which restratifies the mixed layer and causes the mld shallower the destratifying in this paper may only be available for the time when the stratification in the barrier layer is very weak so that the sva can penetrate below the mixed layer on the contrary the restratification physics will dominate the barrier layer when the stratification is enough strong take the summer time for example comparison between the hrm fig 14a and lrm fig 14c shows that the sva in hrm not only reduces the vertical thermal diffusion but also shallows the mixed layer which verifies the restratification physics in strong stratification condition however the microturbulence below the boundary layer where the internal warming occurs is weak both in the hrm and the lrm suggesting that an intensified k v should be implemented below the boundary layer in the lrm to parametrise the sva t the dynamics of sva t is governed by the vertical advection term of the temperature in the temperature governing equation in the fvcom chen et al 2003 7 t t u t x v t y w t z z k v t z f t where u v and w are the velocities in the earth coordinate system k v is the tvdc and f t is the horizontal thermal diffusion term the first term on the right hand side of eq 7 represents the effect of turbulent vertical diffusion in principle sva t can be quantified as w t z which is part of the w t z term however one can also include the contributions of sva t in the lrm by adding the term given in eq 8 to the right hand side of eq 7 in a manner analogous to the turbulent vertical diffusion term 8 z k sva z t z w t z performing a vertical integration from the sea surface to the internal ocean eq 8 can be transformed into eq 9 9 k sva z t z z k sva 0 t z 0 0 z w t z dz assuming that the temperature is vertically well mixed in the near surface layer the vertical gradient of the temperature equals zero at the surface finally the parameter of the tvd term ksva can be quantified by taking the quotient of the vertically integrated sva t and the vertical temperature gradient 10 k sva z 0 z w t z dz t z z taking as an example the parameterisation for 2 november 2013 sva t fig 10a was first integrated to obtain the 0 z w t z dz term fig 15a in eq 10 the major contribution of sva t to the integration is located in the barrier layer fig 15a green curve where the vertical temperature gradient of t z z fig 15b reaches its maximum value in addition in the well mixed area where t z z 0 1 c m we can use eq 10 to deduce tvdc fig 15c by utilising the sva t given in fig 10a the variation in the tvdc during the internal warming period shows a neap spring tidal cycle fig 16a black curve which indicates that tidal mixing can affect sva t since we are focused on the seasonal contribution of sva t the tvdc was averaged resulting in a constant value of 2 cm2 s fig 16a green line combining eqs 7 and 8 an improved tvd coefficient can be obtained by simply adding this average value of 2 cm2 s for ksva to the original coefficient k v of the lrm during the internal warming period which is defined by mld 20 m and t 2 c to apply the above parameterisation to the lrm we set up a numerical experiment test a the tvd coefficient was increased by a constant value of 2 cm2 s in the barrier layer during the internal warming period fig 16a green line the temperature in the barrier layer in test a fig 16b green dashed curve increased during autumn compared with the temperature in the lrm fig 16b red solid curve and approached the temperature in the hrm fig 16b blue solid curve which indicates that the internal warming was reasonably included in test a therefore this incorporation of the effect of sva t in the lrm by simply increasing the tvd coefficient by a constant value is a successful method for our exemplary conditions 5 conclusions using comparisons between hrm and lrm in the southern ecs we highlighted an internal warming process in the barrier layer that was dominated by sva t the prediction and parameterisation of this internal warming and its relation with sva t were further discussed to improve the lrm simulation as a first indication suggesting the importance of sva t a significant internal warming was prominent in the hrm simulation but absent in the lrm simulation in addition observations from three field surveys and gdem data confirmed the occurrence of an internal warming process this internal warming occurred in the barrier layer in early autumn in connection with submesoscale oscillations of the isothermals in the hrm however in the lrm the isothermals were almost stationary during the internal warming process sva dominated the vertical advection and increased it by up to one order of magnitude moreover the variation in mld was well correlated with the scaling of the ageostrophic secondary circulation streamfunctions indicating that sva was likely due to a combination of frontogenesis mlis and turbulent thermal wind in the mixed layer our experiments demonstrated that the internal warming was dominated by sva t warm water is transported by sva t from the upper mixed layer to the barrier layer thus increasing the temperature in the barrier layer therefore sva t was generally positive in the barrier layer which means that the water in this layer became warmer in addition sva t was weaker in the inshore area than in the offshore area because the temperatures are vertically well mixed leading to significantly smaller amounts of heat transport to quantify the temporal and spatial contributions of sva t to the internal warming we integrated the relative contributions of the various turbulent motions in the barrier layer the results show that sva t is a major factor affecting the internal warming in the offshore area a test without vertical advection in the hrm further demonstrated the dominant role of sva t in the southern ecs the timing of the internal warming can be predicted using the empirical conditions of the strong mld mld 20 m in combination with a sufficiently large vertical temperature difference t 2 c since sva is mainly generated in the mixed layer we can use mld as a proxy of the magnitude of sva a mld 20 m can be taken as a threshold for a sufficiently strong sva which in turn can have an effect on the heat flux in the barrier layer unless t 2 c this empirical method can be applied to conventional lrms because both the mld and t are large scale parameters that can be inferred from the vertical distributions provided by lrms technically the internal warming can be incorporated into the lrm by increasing the tvd coefficient using eq 10 which specifies how sva t can be quantified by using a correlation between sva t and the tvd coefficient however this correlation between sva t and tvdc definitely depends on the specific conditions of the investigated area in particular the scale and strength of the mesoscale currents moreover in principle the threshold values for mld and t not only depend on the specific area but also vary in time and space because mesoscale processes generally show seasonal and regional dependencies therefore at present additional information from hrms or high rsesolution measurements is required to include the sva t effect in an lrm for a given research region acknowledgements this study was jointly supported by the national key research and development program of china 2016yfc1401603 nsfc zhejiang joint fund for the integration of industrialization and informatization u1609201 the grant from the scientific research fund of the second institute of oceanography mnr qnyc201603 the sino german cooperation in ocean and polar research under the grant bmbf 03f0701a cliflux the zhejiang provincial natural science foundation lr16d060001 and the natural science foundation of china 41876026 41576007 and 41621064 declaration of interest none author contributions jiliang xuan jian su daji huang and thomas pohlmann conceived and designed the study together jiliang xuan and daji huang performed the numerical experiments and wrote the paper jian su hui wang ruibing ding feng zhou and thomas pohlmann reviewed and edited the manuscript all authors read and approved the manuscript 
24045,horizontal resolutions of regional ocean models are often inadequate to resolve submesoscale vertical advection sva in the continental shelf seas this study aims to compare the sva in two similar model setups in the east china sea with different horizontal resolutions a novel method to parameterise the impact of sva on temperature sva t has also been proposed which can significantly improve the low resolution model lrm results in particular we focus on the time frame wherein this method can be applied the suggested method primarily improves the representation of an internal warming process which is significant in both the observations and high resolution model hrm but is absent in the original lrm combined with the observations we found that the internal warming which occurred in the barrier layer of the water column during early autumn is accompanied by submesoscale oscillations of isothermals in the hrm sva dominates the internal warming process and increases the total vertical advection by up to an order of magnitude in the hrm compared with the lrm therefore we parameterised sva t by increasing the vertical thermal diffusion coefficient in the lrm to further specify the time frame wherein the parameterisation can be applied we introduced two empirical conditions related to the major generation mechanisms of frontogenesis mixed layer instabilities and turbulent thermal wind in the mixed layer a deep mixed layer depth 20 m and a large surface bottom temperature difference t 2 c finally we successfully simulated the internal warming in the lrm during early autumn by applying the proposed method nevertheless the parameterisation of the horizontal distribution of sva t needs to be considered in the future to achieve better three dimensional model results keywords submesoscale advection mixed layer instabilities internal warming vertical mixing dynamical parameterisation east china sea 1 introduction submesoscale advection which is shaped like filaments or eddies with a horizontal scale of approximately 1 10 km have frequently been reported in the frontal area of the upper ocean mcwilliams 1985 thomas et al 2008 capet et al 2008a sasaki et al 2014 these submesoscale circulations are dynamically defined by conditions where the relative vertical vorticity ζ equals or exceeds the planetary vorticity f where the rossby number ro ζ f thomas et al 2008 is o 1 recent studies have pointed out that the submesoscale advections dominate the vertical exchanges of heat salinity and momentum spall 1997 haine and marshall 1998 ferrari and rudnick 2000 thomas 2005 therefore submesoscale vertical advection sva plays a dominant role in the vertical exchanges however most ocean models in particular global simulations are unable to meet the high resolution necessary to simulate sva therefore the contribution of sva needs to be parameterised in low resolution models lrms to improve lrms we need to determine the dynamical impact of sva on vertical exchanges in high resolution models hrms as an example of vertical heat exchange the impact of sva on temperature sva t can be quantified as w t where w is the sva and t is the vertical temperature difference sva t can be simply understood as a vertical stirring via sva under the condition of a strong vertical temperature difference however both terms i e w and t are driven by complicated dynamics on multiple scales mcwilliams 2016 summarised the generation mechanisms of submesoscale currents in oceanic mixed layer mainly mixed layer instabilities mlis frontogenesis and turbulent thermal wind in surface mixed layer the mlis occur in a weakly stratified layer with a lateral buoyancy gradient along the surface boundary and a more strongly stratified interior below boccaletti et al 2007 fox kemper et al 2008 zhai et al 2008 the frontogenesis is induced by the strain rate of the background horizontal deformation flow with a favourably aligned surface lateral buoyancy gradient wind forcing and tides can generate strong vertical mixing which in turn can drive strong submesoscale currents via the turbulent thermal wind mechanism gula et al 2014 mcwilliams et al 2015 all these processes exhibit a forward energy cascade to dissipation with an accompanied diapycnal mixing a deeper mixed layer and stronger lateral buoyancy temperature gradients suggest that more potential energy is available in the mixed layer and stronger submesoscale current can be generated a good connection between strong sva and the deep mixed layer depth mld has been found in the subtropical countercurrent and kuroshio regions sasaki et al 2014 qiu et al 2014 however mcwilliams 2016 pointed out that neither the dissipation nor the mixing rates have yet been accurately quantified for submesoscale currents globally even though local examples show that such effects can be significant to quantify sva t w t we need to synthetically analyse the dynamics on multiple scales including mean circulation mesoscale advections and microscale mixing because temperature is a result of dynamics on multiple scales the relative contributions of various turbulent motions in the temperature are usually illustrated in terms of the reynolds averaged equation eq 1 which has been successfully applied to nutrient analyses lévy et al 2012 1 t t local u t mean h u t mesoscale z w t submesoscale z k v z t micr o scale where the local temperature change is caused by contributions from the mean circulation mesoscale advections sva and microscale mixing of temperature the overbar indicates an average over a spatio temporal scale is larger than the submesoscale field the prime denotes eddy fluctuations and u indicates the horizontal velocity for clarity we herein considered the mean by averaging over a spatial scale of 10 km we separated the mesoscale and submesoscale reynolds fluxes which represent the advective transport of material properties along density surfaces with reversible mixing and the microscale reynolds fluxes which are associated with the irreversible mixing of water masses the effect of microscale turbulence often referred to as vertical mixing is particularly strong in the turbulent boundary layers where it keeps the temperature well mixed in this equation the microscale turbulence is parameterised as a vertical diffusion term with a parameter k v which is the temperature vertical diffusion coefficient tvdc ledwell et al 1998 pointed out that the horizontal and vertical advective reynolds fluxes are dominated by the mean circulation and mesoscale eddies and by mesoscale eddies in the ocean interior away from the ocean boundaries respectively however there is a growing evidence that in the upper few hundred metres of the oceans the vertical fluxes are dominated by sva particularly in frontal areas capet et al 2008a klein and lapeyre 2009 the southern east china sea ecs is a prominent area where the strong sst fronts combined with significant sva occur therefore this region was selected to serve as a typical area for studing sva t yin and huang 2016 have documented a complete evolutionary process of submesoscale frontal waves off the southeast coast of the southern ecs using geostationary ocean colour imagery data a remote sensing snapshot of the sst for 2 november 2013 fig 1a shows a submesoscale temperature distribution over a broad area between the coastal current and kuroshio region the observed horizontal scale of these submesoscale temperature patches covers a wider range of 1 50 km than the typical size of phenomena i e 1 10 km indicating that submesoscale activities can rapidly grow at time scales of the order of a day as shown by the idealised numerical results of boccaletti et al 2007 these submesoscale temperature patches suggest rich sva t activity in the southern ecs traditionally the vertical temperature in the southern ecs is thought to have a three layer structure namely an upper mixed layer barrier layer and bottom mixed layer which is shown via an annual average of the generalised digital environment model gdem carnes 2009 data fig 1b herein the upper and bottom mlds are defined as the depth where the temperature has decreased and increased from the surface and bottom value by 0 1 c respectively the heat exchanges in the upper and bottom layers are rapid because of the microscale mixing and barrier layer is understood to be a heat blocking layer between the upper and bottom mlds however strong sva may challenge our former understanding of the vertical temperature structure in the southern ecs sva may continuously exchange the cold water in the barrier layer with the warm water in the upper mixed layer acting like a warming process in the barrier layer and ultimately altering the heat budget in the interior ocean currently most climate models ignore sva t owing to their insufficient spatial resolutions which may cause significant bias while calculating the temperature and atmosphere ocean heat exchanges on the basis of the dynamical model solution of sva t w t we studied the temperature structure sva and sva t for the case of a strong sva t comparisons between the hrm and lrm results were used to investigate the impact of the resolution on sva t in a frontal area between the cool coastal current and the warm kuroshio current fig 1a rectangular area since both the remote sensing sst data and the field survey data on 2 november 2013 indicate a significantly strong sva in the southern ecs we used 2 november 2013 as a typical day to analyse the dynamics of sva t furthermore the prediction and parameterisation of sva t are discussed to improve the lrm results which are currently unable to directly simulate sva t 2 model configuration and validation 2 1 configuration of two different resolution models an hrm and lrm were used to investigate the role of sva t on the heat budget on the ecs shelf based on the finite volume coastal ocean model fvcom chen et al 2003 on the shelf a high resolution 0 5 km triangular grid was used in the hrm fig 2a on the contrary a low resolution 10 km triangular grid was used in the lrm fig 2b taking an average mld of 60 m a mixed layer deformation radius of approximately 4 km can be obtained when using the approximation b ml h ml f barkan et al 2017 where b ml denotes buoyancy difference across the mixed layer and h ml is the mld therefore it can be concluded that the submesoscale activities are resolved in the hrm but not in lrm the model domains original bathymetric data meteorological forcing open boundary conditions and initial conditions for the two models are identical unstructured grids were developed for the entire coastal china sea and for parts of the japan east sea and the pacific ocean the general bathymetric chart of the oceans smith and sandwell 1997 provides high resolution approximately 1 km bathymetric data a sigma stretched coordinate system was used to specify 40 vertical layers with a vertical resolution of approximately 1 5 m in the mixed layer horizontal and vertical diffusivity coefficients used in the two models table 1 were estimated by the smagorinsky eddy smagorinsky 1963 and k profile parametrisations large et al 1994 respectively the driving forces of the numerical simulations included tides river discharge surface heat fluxes wind and open boundary conditions the harmonic constants of 11 major tidal constituents namely m2 s2 n2 k2 k1 o1 p1 q1 m4 ms4 and mn4 were used on the basis of the oregon state university global inverse tidal model tpxo 7 0 egbert et al 1994 egbert and erofeeva 2002 the river discharge information for the changjiang river was taken from publicly available observational data from the datong hydrometric station http yu zhu vicp net the daily mean heat fluxes were obtained from objectively analysed air sea fluxes yu and weller 2007 and the 3 h wind stress data were obtained from the era interim re analysis dee et al 2011 the open boundary conditions including the daily temperature salinity and velocities at the taiwan strait the western pacific ocean and the japan east sea were obtained from the hybrid coordinate ocean model bleck 2002 the initial conditions were obtained after 3 years of spin up and the hourly outputs of the sea surface height temperature salinity and velocities for 2013 were used for the analysis since our discussion focusses on time scales above the tidal cycle a tidal filter godin 1972 with a moving average was employed to remove tidal oscillations 2 2 model data comparison since we are concerned with the seasonal differences between the hrm and lrm the seasonal variations in the temperature obtained from three surveys in 2013 and gdem were used to validate the two models in may august and october 3 surveys were conducted along two fixed sections a1 a7 and b1 b6 in fig 1 red dots the gdem temperature profiles were monthly averaged all the simulated and observed temperature data were horizontally averaged at the locations of the observation stations fig 1 red dots and were displayed finally in the form of time series and vertical profiles figs 3 and 4 the ssts from both models fig 3a blue and red curves are in good agreement with the observed temperature fig 3 asterisks and the gdem data fig 3 black curves with a temperature difference of 1 c both the simulated and observed ssts show a seasonal variation in the temperature with a warming from april to august and a cooling from september to march the simulated sst in 2013 is close to the annual averaged result of the gdem indicating that 2013 was not an unusual year fig 3b shows the comparisons of the temperature at a depth of 70 m between the two simulations and the observations herein we used the 70 m layer to represent the barrier layer the simulated temperature of the hrm fig 3b blue line agrees well with the three surveys fig 3b asterisks and shows the same pattern as the gdem data fig 3b black line moreover there exists a large temperature difference approximately 2 c during the autumn between the lrm fig 3b red line and the observed data fig 3 asterisks and black line therefore the seasonal variation in the temperature in the interior ocean is reproduced much better in the hrm than in the lrm both the observed and the hrm simulated data indicate an internal warming in the barrier layer from 15 august to 30 october however lrm fails to simulate this internal warming these results indicate that the internal warming is likely caused by sva t which is included in the hrm but excluded in the lrm fig 4 shows a model validation via vertical temperature profiles using data from three aforementioned surveys conducted during the spring summer and autumn of 2013 the simulated and observed temperature profiles show a three layer vertical structure comprising an upper mixed layer barrier layer and bottom mixed layer as shown in the gdem in fig 1b the depth of the upper mixed layer is shallow 20 m during spring and summer but significantly deeper 50 m during autumn and winter the autumn temperatures of the barrier and bottom mixed layers in the lrm fig 4c red curve are much lower than the observed fig 4c black curve and hrm fig 4c blue curve temperatures the high temperatures in the hrm and observations are related to the sva t induced internal warming shown in fig 4b which are missing in the lrm the differences in the circulation patterns between hrm and lrm can be illustrated via the surface currents on 2 november 2013 fig 5 when the model resolution is improved from 10 to 0 5 km the submesoscale advection becomes significantly stronger by an order of magnitude in the study area where the larger scale currents such as the kuroshio current are generally weak these submesoscale advections in the hrm fig 5a are related to the submesoscale temperature distributions on 2 november 2013 as seen in the remote sensing data fig 1a indicating that the hrm realistically simulates the submesoscale processes on the contrary lrm provides a pattern without the submesoscale advections fig 5b as is the case for most current ocean models interestingly even though the lrm does not include the submesoscale dynamics the two models show nearly the same volume fluxes not shown across the taiwan strait east taiwan channel tsushima strait tokara strait and the shelf break of the 200 m isobath which means that the horizontal fluxes induced by the submesoscale advection provide an insignificant contribution to the seasonal mean fluxes 3 results the internal warming in the barrier layer fig 3b was explored by comparing the simulated temperatures between hrm with sva and lrm without sva hereinafter we focus our discussion on the dynamical solution of sva t w z t to further examine the internal warming using a detailed analysis of the temperature structure sva sva t and the related heat budgets 3 1 temperature structure to better examine the internal warming in the hrm we analysed the seasonal variations of parameters simulated by the hrm and lrm fig 6 the simulated temperature time series were obtained via horizontal averaging over the study area fig 1a rectangular area and vertical averaging over the respective layers in addition a snapshot of the vertical temperature structure at the end of the internal warming period 2 november 2013 is presented fig 7 the major difference between the simulated temperatures in hrm and lrm is found during autumn from september to november fig 6a the water column mean temperature in the hrm is approximately 1 c higher than that in the lrm during autumn this indicates that there is an additional warming process in certain layers during the period from 15 august to 30 october fig 6 dashed rectangle to further disentangle this warming process the temperature time series in the upper mixed layer and in the barrier layer are depicted fig 6b and c the temperatures in the upper mixed layer in hrm and lrm are almost identical fig 6b whereas there is a significant temperature difference up to 2 1 c between the two models in the barrier layer during autumn fig 6c in addition the internal warming is associated with a cooling of the upper mixed layer water which differs from the traditional cooling processes induced by microscale mixing indicated by a monotonically decreasing temperature from the surface to the interior this suggests that sva could be the dominant mechanism driving the internal warming in the hrm the role of sva was further indicated by the vertical temperature structure fig 7 section a fig 1a was used for this comparison because it is located at the centre of the focus area both the observations fig 7a and simulations fig 7b and c show a three layer structure namely an upper mixed layer barrier layer and bottom mixed layer which agrees well with the gdem data fig 1b the three layer structure is more noticeable in the offshore area where the water depth is 80 m in this area the upper mld is deeper than 50 m indicating a higher level of available potential energy in the mixed layer linked to a possibly stronger tendency for sva generation the available observations comprise only seven stations the vertical dotted lines in fig 7a c which are labelled on the top of fig 7a unfortunately the low temperature zone above the barrier layer simulated in the hrm between distances of 220 km and 255 km does not include any observations nevertheless the vertical temperature structures are well simulated in the hrm at the neighbouring observational stations 06 and 07 large vertical temperature gradients exist in the barrier layer which is in line with the traditional view that the heat exchange is very small in this layer the temperature structure in the barrier layer is very different between hrm fig 7b and lrm fig 7c simulations the upper boundary of the barrier layer in the hrm fig 7b blue line oscillates between 40 and 80 m in the offshore area whereas it is nearly stationary at a depth of 50 m in the lrm fig 7c blue line the horizontal scale of these oscillations in the hrm is 50 km even though this scale is slightly larger than the typical scale of sva which is approximately 1 10 km these oscillations are most likely generated by sva it is known that submesoscale activities can rapidly grow on time scales of the order of a day as demonstrated by boccaletti et al 2007 even though the observed vertical structures are obtained from a rather sparse station grid oscillations of the isothermals in the barrier layer which are simulated with the hrm are clearly observed fig 7a another obvious difference between hrm and lrm is the temperature at the bottom and barrier layers fig 7 right column under the influence of sva the barrier layer in the hrm simulation is approximately 10 m thicker than that in the lrm simulation which ultimately results in a 2 c increase in the bottom water temperature in the hrm the barrier layer temperature in the hrm is approximately 2 c higher than that in the lrm which can be attributed to the oscillations induced by sva to understand how sva acts on the internal warming one should consider the following scenario sva in the hrm causes a non homogeneous state in the barrier layer consequently the warm and cool water in the upper mixed layer and barrier layer respectively are vertically exchanged since the temperature in the upper mixed layer remains largely unchanged owing to the heat feedback at the air sea interface temperature in the barrier layer increases because of the heat gain from the upper mixed layer 3 2 distribution of sva the maximum value of the total vertical advection in the hrm fig 8a is 6 7 10 4 m s which is approximately five times larger than vertical advection in the lrm 1 4 10 4 m s fig 8d in addition the mean value of the total vertical advection in the hrm is seven times larger than that in the lrm the total vertical advection for different rossby numbers can be compared between hrm and lrm on the basis of a dimensional analysis that was introduced by mahadevan 2016 2 w rouh l where u is horizontal velocity h is depth and l is length scale of the mesoscale process using eq 2 the total vertical velocity amounts to w 10 4 m s in the lrm for the empirically derived conditions ro 0 1 u 0 1 m s h 100 m and l 10 km on the contrary the rossby number increases locally to o 1 in the hrm which causes the total vertical advection to increase to w 10 3 m s one order of magnitude larger than the total vertical velocity in the lrm using a low pass space filter with a cut off scale of 10 km we separated sva from the total vertical advections in hrm and lrm a comparison between the total vertical advections fig 8a and sva fig 8b in hrm shows that approximately 95 of the total vertical advection is generated by sva therefore the occurrence of sva may increase the vertical advection by up to one order of magnitude a comparison between the magnitudes of the vertical advection and buoyancy gradient fig 8b green curve shows that the downward velocity is on the colder side of the front filament whereas the upward velocity is on the warmer side in addition sva can penetrate below the mixed layer in our model simulation a major reason for this is that the buoyancy exhibits horizontal variations underneath the mixed layer zone under the more realistic conditions employed in our study sasaki et al 2014 showed that the sva can penetrate below the mixed layer in real ocean simulations even though in their case they employed mlis to interpret sva topographic wakes occurring at the shelf edge may contribute to the vertical penetration of sva because such wakes can generate vertical velocities that reach from the bottom of the ocean to near the surface dewar et al 2015 rosso et al 2015 sva also affects the vertical exchanges of heat and salt i e the vertical buoyancy flux fig 8b contours and vertical heat flux fig 7b in analogy to the temperature structure fig 7b the isopycnal lines fig 8b contours i e 23 0 σt also oscillate in the offshore area in the hrm but remain flat in lrm indicating that vertical buoyancy fluxes are generated by sva in the barrier layer altogether the distributions of the density anomalies in the two models fig 8 contours show patterns similar to the corresponding temperature structures fig 7 which means that the buoyancy flux and temperature flux act on the same pace therefore it can be concluded that sva is well represented by the internal warming process discussed in section 3 1 the dynamics of the sva was investigated using the four major generation mechanisms indicated by mcwilliams 2016 the scaling theories for the ageostrophic secondary circulation stream function as proposed by barkan et al 2017 were examined with respect to the generation of mlis mle eq 3a frontogenesis strain eq 3b and turbulent thermal wind ttw eq 3c the generation of topographic wakes can be examined via the bottom generated vertical motion w bottom eq 3d 3a mle h bl 2 b 2 f 3b strain γ f mle 3c ttw u h bl b f 2 and 3d w bottom u bottom h where h bl is the surface boundary layer depth b is the magnitude of the surface buoyancy gradient γ is the large scale geostrophic strain rate u is the magnitude of the surface frictional velocity and h is the topography a combination of all four sva generation mechanisms is active in the ecs note that the first three mechanisms are well correlated with the deeper mld as shown in fig 9 the mlis frontogenesis and turbulent thermal wind are somewhat evenly distributed over the entire domain whereas topographic wakes only occur along the edges of the continental shelf frontogenesis has a weaker magnitude than the mlis suggesting that there exists a small large scale geostrophic strain over the entire research area as indicated by eqs 3a and 3b conversely the magnitude of the turbulent thermal wind is similar to that of the mlis which means that the boundary layer turbulence from u in eq 3c makes a large contribution to the sva generation although the three mechanisms in the mixed layer are different with their magnitudes according to above scaling theories it may be more complicate to establish the dominant mechanism e g frontogenesis may be the dominant mechanism when the mixed layer is shallow however the surface boundary layer depth h bl which controls the mld has a dominant effect on the seasonal variation of the first three generation mechanisms fig 9e because their variations are closely linked to the mld fig 13a blue curve in all the above generation mechanisms the available potential energy is converted to eddy kinetic energy which results in the temperature fluxes w t fig 11b being positive nearly everywhere in section a1 7 on 2 november 2013 in the hrm 3 3 distribution of sva t two conditions in the barrier layer namely a high vertical temperature gradient fig 7 and strong sva fig 8 indicate a significant sva t in this section we discuss sva t making use of the definition z w t given in eq 1 sva t causes a heat exchange between the warm upper mixed layer and cool barrier layer increasing the temperature in the barrier layer and decreasing the temperature in the upper mixed layer these effects were explored in the hrm simulation fig 10a in the upper mixed layer sva t was negative above the mld fig 10a green curve indicating that the cool water in the barrier layer is transported to the upper mixed layer on the contrary sva t is generally positive in the barrier layer which means that the water in this layer becomes warmer in addition sva t is insignificant in the inshore area inshore of the 80 m isobath because the temperature is vertically well mixed in the inshore area sva t becomes very weak in the lrm simulation fig 10b because sva is absent even though the three layer structure of temperature is prominent in the offshore area despite the coarse model resolution 3 4 temperature dynamics to quantify the contribution of sva t to the internal warming we integrated the relative contributions of the various motions over the depth range of 50 100 m from 15 august to 30 october using eq 4 which is an integrated form of the reynolds averaged equation eq 1 the 50 100 m depth interval was chosen as being representative of the barrier layer under the seasonal mean contribution of sva t fig 1b 4 aug 15 oct 30 50 m 100 m t t local dzdt aug 15 oct 30 50 m 100 m u t mean h u t mesoscale z w t submesoscale z k h z t microscale dzdt according to eq 4 the local temperature tendency term is approximately balanced by the other four terms representing processes on various scales mean mesoscale submesoscale and microscale the horizontal diffusion and mesoscale advection are negligible in our research area the tendency term in the hrm simulation fig 11a is positive in nearly the entire southern ecs indicating a general warming of the barrier layer the four terms on the right hand side of eq 4 contribute differently to this warming process the mean advection fig 11f is the largest term in the kuroshio region outside the 200 m isobath and in the kuroshio intrusion region north of taiwan indicating that warmer water in the south is transported northward by the kuroshio current to the ecs in autumn the mesoscale advection plays a minor role with respect to the internal warming in comparison with the other three terms therefore it is not shown in fig 11 the submesoscale term fig 11c affects the entire ecs particularly the region between the 100 and 200 m isobaths indicating that sva is a major factor affecting the internal warming in the barrier layer the microscale mixing fig 11d also has a large impact over the entire ecs however its contribution between the 100 and 200 m isobaths is much smaller than that of the submesoscale term the impact of sva on the internal warming is further highlighted by comparing the temperature changes between the hrm fig 11c and lrm fig 11g simulations in lrm the mean mesoscale and microscale terms are similar to those in hrm whereas the submesoscale term is smaller by an order of magnitude than that in the hrm consequently the tendency term in the lrm is also much smaller than that in the hrm indicating that the internal warming process is absent in the lrm this further demonstrates that sva makes a large contribution to the internal warming fig 12 shows the spatially averaged time series of the different terms contributing to the temperature tendency on the basis of eq 1 in the barrier layer when a positive local term fig 12 black line occurs in the internal warming period fig 12 the period marked with a dashed line sva t fig 12 red line is larger than the other factors indicating the dominant role of sva on the internal warming in the barrier layer 4 discussions 4 1 timing of the internal warming previous studies have indicated that the strongest sva occurs in the winter or spring mensa et al 2013 qiu et al 2014 sasaki et al 2014 however our results show that in the ecs the most pronounced sva t induced internal warming occurs in early autumn this is caused by the joint contributions of sva and vertical temperature gradient even though the sva during autumn is weaker than that during winter the vertical temperature gradient is much larger during autumn than it is during winter when vertically well mixed temperature conditions prevail therefore the timing of the maximum internal warming is obviously different from that of the maximum sva an empirical method was proposed to predict the timing of the internal warming taking into account that the driving force of the internal warming is sva t w z t in the study area the offshore sva fig 9c agrees well with the mld fig 13a suggesting that there is a critical value of mld that could act as a trigger for the internal warming another critical value could be the strength of the temperature difference between the surface layer and bottom layer t indicating the potential of sva to affect the water and heat exchange fig 13a shows the variations in mld and t and their correlation with the timing of the internal warming the results demonstrate that the internal warming occurs under conditions of mld 20 m and t 2 c therefore these conditions which are also tracked in the lrm can be used to predict the timing of the strong sva t period and the subsequent internal warming in the ecs the above empirical method requires that a reference vertical structure for the temperature is available from observations or climatological data both the actual mld and the t can be estimated from the vertical structure of temperature using common methods kara et al 2000 thomson and fine 2003 lorbacher et al 2006 which facilitates the rapid prediction of strong sva t events fig 13b and c show two extreme structures that exhibit strong internal warming at the beginning of the internal warming period fig 13b t was larger than 6 c when the mld deepened to 20 m sva became strong enough to transport warm water from the upper layer to the barrier layer on the contrary at the end of the internal warming period fig 13c t decreased to approximately 2 c and the heat flux became very small even though the water exchange between the upper layer and the barrier layer induced by sva was reasonably strong 4 2 improvement of the lrm via an sva t parameterisation it has been shown that at the submesoscale mechanisms associated with energy and heat transfers are closely linked to the vertical velocity field lapeyre and klein 2006 thomas et al 2008 capet et al 2008a 2008b klein et al 2008 tulloch and smith 2009 ferrari 2011 mcwilliams et al 2009 mensa et al 2013 gula et al 2014 the inclusion of these submesoscale dynamics in numerical simulations can alter the total eddy kinetic energy by as much as a factor of two sasaki et al 2014 qiu et al 2014 and significantly enhance the lateral dispersion of passive tracers haza et al 2012 current models in particular global models systematically underestimate the vertical heat flux associated with sva because of their low horizontal resolution therefore an appropriate parameterisation of sva t could significantly improve the lrm results and estimates such as heat fluxes to better parameterise sva t in lrm we first examined the difference in the microturbulence between the hrm and lrm the k profile parametrisation is used to analyse the microturbulence in the boundary layer which is determined from our model results according to the following eqs 5 and 6 5 k v σ h w v σ g σ and 6 ri b d b surf b d d v surf v d 2 v t 2 d where k v σ is the vertical thermal diffusion coefficient in the boundary layer varying with the dimensionless vertical coordinate σ h is the boundary layer depth w v is the vertical turbulent velocity scale parameterising the surface momentum forcing g σ is a nondimensional vertical shape function that is assumed to be a cubic polynomial h is the boundary layer depth bld determined by the minimum depth where the bulk richardson number ri b reaches a critical value of 0 3 b surf and v surf are the near surface values of the buoyancy and the horizontal velocity respectively d is the depth below the ocean surface b d is the buoyancy v d is the velocity and v t d is the turbulent velocity parameterising the surface buoyancy forcing which determines the buoyancy entrainment into the pycnocline layer both the hrm and lrm show increased turbulence from 2 august 2013 to 2 november 2013 fig 14 however the magnitude and structure of k v are different for the two models for example k v on 2 november 2013 fig 14b and d the bld in the hrm is deeper than that in the lrm which means that the restratification induced by the sva is not strong enough to affect the bulk richardson number ri b in the water column moreover the temperature below the boundary layer increases in the hrm which reduces the buoyancy difference between the surface mixed layer and the underlying water masses and in turn causes a deepening of the boundary layer according to eq 6 conversely the restratification induced by the sva causes a weak surface momentum forcing w v which results in smaller turbulence in the hrm fig 14b compared to the lrm fig 14d the sva induced destratifying is exactly an opposite situation with the classical sva induced restratification physics fox kemper et al 2011 which restratifies the mixed layer and causes the mld shallower the destratifying in this paper may only be available for the time when the stratification in the barrier layer is very weak so that the sva can penetrate below the mixed layer on the contrary the restratification physics will dominate the barrier layer when the stratification is enough strong take the summer time for example comparison between the hrm fig 14a and lrm fig 14c shows that the sva in hrm not only reduces the vertical thermal diffusion but also shallows the mixed layer which verifies the restratification physics in strong stratification condition however the microturbulence below the boundary layer where the internal warming occurs is weak both in the hrm and the lrm suggesting that an intensified k v should be implemented below the boundary layer in the lrm to parametrise the sva t the dynamics of sva t is governed by the vertical advection term of the temperature in the temperature governing equation in the fvcom chen et al 2003 7 t t u t x v t y w t z z k v t z f t where u v and w are the velocities in the earth coordinate system k v is the tvdc and f t is the horizontal thermal diffusion term the first term on the right hand side of eq 7 represents the effect of turbulent vertical diffusion in principle sva t can be quantified as w t z which is part of the w t z term however one can also include the contributions of sva t in the lrm by adding the term given in eq 8 to the right hand side of eq 7 in a manner analogous to the turbulent vertical diffusion term 8 z k sva z t z w t z performing a vertical integration from the sea surface to the internal ocean eq 8 can be transformed into eq 9 9 k sva z t z z k sva 0 t z 0 0 z w t z dz assuming that the temperature is vertically well mixed in the near surface layer the vertical gradient of the temperature equals zero at the surface finally the parameter of the tvd term ksva can be quantified by taking the quotient of the vertically integrated sva t and the vertical temperature gradient 10 k sva z 0 z w t z dz t z z taking as an example the parameterisation for 2 november 2013 sva t fig 10a was first integrated to obtain the 0 z w t z dz term fig 15a in eq 10 the major contribution of sva t to the integration is located in the barrier layer fig 15a green curve where the vertical temperature gradient of t z z fig 15b reaches its maximum value in addition in the well mixed area where t z z 0 1 c m we can use eq 10 to deduce tvdc fig 15c by utilising the sva t given in fig 10a the variation in the tvdc during the internal warming period shows a neap spring tidal cycle fig 16a black curve which indicates that tidal mixing can affect sva t since we are focused on the seasonal contribution of sva t the tvdc was averaged resulting in a constant value of 2 cm2 s fig 16a green line combining eqs 7 and 8 an improved tvd coefficient can be obtained by simply adding this average value of 2 cm2 s for ksva to the original coefficient k v of the lrm during the internal warming period which is defined by mld 20 m and t 2 c to apply the above parameterisation to the lrm we set up a numerical experiment test a the tvd coefficient was increased by a constant value of 2 cm2 s in the barrier layer during the internal warming period fig 16a green line the temperature in the barrier layer in test a fig 16b green dashed curve increased during autumn compared with the temperature in the lrm fig 16b red solid curve and approached the temperature in the hrm fig 16b blue solid curve which indicates that the internal warming was reasonably included in test a therefore this incorporation of the effect of sva t in the lrm by simply increasing the tvd coefficient by a constant value is a successful method for our exemplary conditions 5 conclusions using comparisons between hrm and lrm in the southern ecs we highlighted an internal warming process in the barrier layer that was dominated by sva t the prediction and parameterisation of this internal warming and its relation with sva t were further discussed to improve the lrm simulation as a first indication suggesting the importance of sva t a significant internal warming was prominent in the hrm simulation but absent in the lrm simulation in addition observations from three field surveys and gdem data confirmed the occurrence of an internal warming process this internal warming occurred in the barrier layer in early autumn in connection with submesoscale oscillations of the isothermals in the hrm however in the lrm the isothermals were almost stationary during the internal warming process sva dominated the vertical advection and increased it by up to one order of magnitude moreover the variation in mld was well correlated with the scaling of the ageostrophic secondary circulation streamfunctions indicating that sva was likely due to a combination of frontogenesis mlis and turbulent thermal wind in the mixed layer our experiments demonstrated that the internal warming was dominated by sva t warm water is transported by sva t from the upper mixed layer to the barrier layer thus increasing the temperature in the barrier layer therefore sva t was generally positive in the barrier layer which means that the water in this layer became warmer in addition sva t was weaker in the inshore area than in the offshore area because the temperatures are vertically well mixed leading to significantly smaller amounts of heat transport to quantify the temporal and spatial contributions of sva t to the internal warming we integrated the relative contributions of the various turbulent motions in the barrier layer the results show that sva t is a major factor affecting the internal warming in the offshore area a test without vertical advection in the hrm further demonstrated the dominant role of sva t in the southern ecs the timing of the internal warming can be predicted using the empirical conditions of the strong mld mld 20 m in combination with a sufficiently large vertical temperature difference t 2 c since sva is mainly generated in the mixed layer we can use mld as a proxy of the magnitude of sva a mld 20 m can be taken as a threshold for a sufficiently strong sva which in turn can have an effect on the heat flux in the barrier layer unless t 2 c this empirical method can be applied to conventional lrms because both the mld and t are large scale parameters that can be inferred from the vertical distributions provided by lrms technically the internal warming can be incorporated into the lrm by increasing the tvd coefficient using eq 10 which specifies how sva t can be quantified by using a correlation between sva t and the tvd coefficient however this correlation between sva t and tvdc definitely depends on the specific conditions of the investigated area in particular the scale and strength of the mesoscale currents moreover in principle the threshold values for mld and t not only depend on the specific area but also vary in time and space because mesoscale processes generally show seasonal and regional dependencies therefore at present additional information from hrms or high rsesolution measurements is required to include the sva t effect in an lrm for a given research region acknowledgements this study was jointly supported by the national key research and development program of china 2016yfc1401603 nsfc zhejiang joint fund for the integration of industrialization and informatization u1609201 the grant from the scientific research fund of the second institute of oceanography mnr qnyc201603 the sino german cooperation in ocean and polar research under the grant bmbf 03f0701a cliflux the zhejiang provincial natural science foundation lr16d060001 and the natural science foundation of china 41876026 41576007 and 41621064 declaration of interest none author contributions jiliang xuan jian su daji huang and thomas pohlmann conceived and designed the study together jiliang xuan and daji huang performed the numerical experiments and wrote the paper jian su hui wang ruibing ding feng zhou and thomas pohlmann reviewed and edited the manuscript all authors read and approved the manuscript 
24046,the gent and mcwilliams 1990 gm tracer transport scheme has long been a cornerstone of global scale ocean modeling and is well known for its ability to mimic the effects of baroclinic turbulence by reducing the available potential energy of resolved flows however theory predicts that baroclinic turbulence also acts to transfer this potential energy to kinetic energy which can then be fluxed toward larger scales by an inverse energy cascade these dynamical processes represent a separate branch of the large scale ocean energy cycle which gm presently does not account for in this paper a framework is developed which allows the potential energy removed by the gm scheme to be transferred to resolved motions in this framework which is labeled gm e or gm plus energetics the energy transfer occurs by employing gm alongside a parameterization of the barotropic reynolds stresses in the momentum equations which takes the form of a negative harmonic viscosity acting on the barotropic velocities the reynolds stress parameterization is considered as being complementary to gm in that its energetics are explicitly tied to those of gm while being independent of the choice of transfer coefficient or form of the gm closure a set of idealized baroclinic spindown simulations is used to compare gm e against standard gm and is shown to substantially improve the kinetic energy spectra probability distributions of flow structures and restratification rate within the front relative to an eddy resolving truth simulation keywords eddy parameterization gent mcwilliams mesoscale eddies backscatter eddy kinetic energy 1 introduction the flow of the world ocean features a variety of distinct dynamical processes which may be modulated by interactions with the atmosphere bathymetry or each other the ability to study a given process through the development of theory is often limited by how neatly it can be described within well known simplifications of the rotating navier stokes equations for ocean dynamics these equation sets and their attendant processes can broadly categorized by physical scale synoptic planetary geostrophic e g phillips 1963 meso quasigeostrophic e g charney 1948 submeso balance and turbulent thermal wind e g gent and mcwilliams 1983a b gula et al 2014 surface wave craik leibovich e g craik and leibovich 1976 internal gravity wave and turbulence 3d nonhydrostatic among others from a numerical modeling perspective this heterogeneity of ocean dynamics and the equation sets used to describe them means that no single subgridscale closure is likely to satisfactorily capture the complexity of the real ocean the development of a skillful unified eddy closure is doubtful this reality has led to a paradigm in model development wherein ocean eddy closures are routinely formulated with specific processes in mind which are then stacked on top of each other operationally while this approach has generally proven successful in practice and has led to significant leaps forward in the skill of ocean general circulation models it also has pitfalls multiple closures acting independently in a model are unlikely to represent crucial scale to scale interactions that embody the turbulent cascades and may collectively fail to improve the fidelity of coarse resolution models in relation to either observations or higher resolution truth simulations a well known example of this issue occurs in global scale ocean modeling where coarse resolution parameterized simulations have systematically less kinetic energy than high resolution eddy resolving simulations e g arbic et al 2013 kjellsson and zanna 2017 at present ocean models used in coupled climate simulations are routinely run at nominal 1 resolution which is sufficient to permit baroclinic mesoscale eddies over only a small fraction of the world ocean hallberg 2013 these eddies convert available potential energy to eddy kinetic energy and feed into a vigorous inverse cascade which transfers kinetic energy from smaller to larger scales batchelor 1953 kraichnan 1967 charney 1971 but this process is attenuated when the grid resolution is insufficient to resolve only part of the eddy field the inverse cascade is effectively an avenue by which energy accumulates at large scales so that when it and its attendant baroclinic eddies are missing from a model the result is a weak large scale flow commonly used eddy parameterizations can actually exacerbate the weakening of the large scale kinetic energy in coarse resolution models for example in many branches of computational fluid dynamics it is common practice to parameterize the reynolds stresses in the momentum equations with an eddy viscosity where for the sake of model stability it is necessary to use increased eddy viscosity at coarser resolutions e g bryan et al 1975 barham et al 2018 however large eddy viscosity can both nullify resolved baroclinic modes e g bachman and taylor 2014 and dissipate kinetic energy that would otherwise be transferred to larger scales e g arbic et al 2013 zanna et al 2017 kjellsson and zanna 2017 another commonly used mesoscale eddy parameterization the gent and mcwilliams 1990 hereafter gm scheme acts as a sign definite sink of available potential energy gent et al 1995 griffies 1998 and mimics the restratifying effect of unresolved baroclinic eddies the success of gm in dramatically reducing model drift and eliminating the need for unphysical corrections to heat and fresh water fluxes in climate scale ocean models is well documented e g danabasoglu et al 1994 hirst and mcdougall 1996 boville and gent 1998 gordon et al 2000 gent et al 2002 gent 2011 and has motivated a large body of research into improvements and variants of the scheme e g visbeck et al 1997 griffies 1998 smith and gent 2004 fox kemper et al 2008 ferrari et al 2010 marshall et al 2012 among others however because gm is intended for use in large scale ocean models featuring predominantly balanced motions the tendency of the parameterization to reduce ape also reduces the kinetic energy associated with the thermal wind as a result an undesirable side effect of gm is a further erosion of resolved kinetic energy beyond that due to eddy viscosity with no widely accepted scheme to correct this effect currently in use the missing kinetic energy in large scale ocean models has spurred a recent surge of interest in developing parameterizations to re inject this energy through various means stochastic methods have shown promise in terms of enabling direct kinetic energy injection and upgradient momentum fluxes e g frederiksen and davies 1997 berloff 2005 duan and nadiga 2007 grooms and majda 2013 kitsios et al 2013 as have investigations into modeling the turbulent eddy field using a non newtonian stress strain relation e g porta mana and zanna 2014 anstey and zanna 2017 zanna et al 2017 bachman et al 2018 the hierarchy of models comprising the navier stokes α model family holm 1999 hecht et al 2008b feature a set of turbulence closures that can be interpreted as part of the generalized lagrangian mean framework andrews and mcintyre 1978 and have been shown both theoretically holm and wingate 2005 and operationally hecht et al 2008a petersen et al 2008 to result in flows which are notably more energetic than unparameterized control cases another noteworthy approach advocates formulating a budget to account for energy that is spuriously removed by either parameterizations or numerical effects jansen et al 2015 which could then be used to scale an antidiffusive dissipation operator to compensate for the lost energy e g jansen and held 2014 however in spite of the promise shown by these different methods there remain questions about their viability in climate scale ocean modeling and for some their connection to the underlying physics of the large scale oceanic energy cycle the variety of approaches described above highlights both the possibilities and lack of consensus regarding how to ameliorate the problem of weak large scale energy in ocean models an avenue which has to this point been relatively unexplored is the idea of designing a backscatter closure to complement the existing suite of tested well understood closures commonly used in global ocean models such a closure would effectively piggyback off an existing closure to rectify missing energetics but otherwise not interfere with or replace the existing closure in any way for example the gm parameterization represents one branch of the large scale energy cycle which is the forward cascade of available potential energy e g salmon 1980 and subsequent conversion to subgridscale kinetic energy by baroclinic instability presently however the potential energy depleted by gm from the resolved flow effectively disappears from the model despite a body of theoretical e g charney 1971 smith et al 2002 observational e g scott and wang 2005 and numerical evidence e g arbic et al 2007 thompson and young 2007 arbic et al 2012 predicting that the energy released by mesoscale baroclinic instability should be returned to larger scales by an inverse energy cascade with the viewpoint that gm should thus be considered a mechanism for energy transfer rather than an energy sink one might conceive that a parameterization could be designed that is complementary to gm and whose purpose is to close the large scale energy cycle by reinjecting the energy gm extracts via backscatter no extant scheme has attempted to directly exploit the energy transfer implied by gm to inform a backscatter approach the focus of this article is to exposit the theoretical basis on which such an approach could be built formulate it mathematically and test it in a set of idealized baroclinic spindown models which use the gm parameterization in particular quasigeostrophic qg theory will be used to show that closing the large scale ocean energy cycle requires a reynolds stress parameterization in addition to gm this reynolds stress parameterization will be formulated and it will be shown that the combined reynolds stress and gm closures here labeled the gm e framework or gm plus energetics permit the potential energy extracted by gm to be returned to the resolved flow the theoretical framework for the scheme is presented in section 2 and the scheme itself is derived in section 3 results and interpretation of the numerical tests are presented in section 4 concluding remarks and possible future extensions of this idea appear in section 5 details regarding the energy equations and implementation of the new scheme appear in the appendices 2 energetics and eddy forcing of qg flow 2 1 preliminaries the role of eddy fluxes in the resolved buoyancy and momentum budgets has previously been explored from many angles including partitioning the fluxes into skew and diabatic components as in the transformed eulerian mean framework e g andrews and mcintyre 1976 1978 geometric decomposition of the eddy flux tensor e g marshall et al 2012 symmetries of flux gradient transport bachman and fox kemper 2013 and residual mean theory e g young 2012 maddison and marshall 2013 the framework proposed in this paper pays no special attention to the geometry or orientation of the eddy fluxes but does require a clear understanding of how eddies serve to transfer energy between the kinetic and potential energy reservoirs because the focus here is on energy transfer via the gm parameterization which primarily represents balanced mesoscale turbulence the qg equations will be sufficient to illustrate the motivation and mathematics behind this approach the averaged boussinesq qg equations can be written 1 d u g d t u g u g f 0 v a g β y v g x ϕ a g f x 2 d v g d t u g v g f 0 u a g β y u g y ϕ a g f y 3 d b d t u g b n 0 2 w a g b where an overbar is used to indicate an averaged mean quantity and primes indicate eddy deviations away from this average 1 1 when discussing parameterizations mean and eddy will be treated as synonymous with resolved and unresolved by the model respectively here d d t t u g where x y 0 is the horizontal gradient operator 4 u g u g v g 0 and u a g u a g v a g w a g are the geostrophic and ageostrophic velocity vectors and b is the buoyancy which is normalized by the constant part of the coriolis parameter f 0 and background buoyancy frequency n 0 2 z β is the planetary vorticity gradient ϕ a g is the ageostrophic pressure potential and f x f y b represent additional forcing in the momentum and buoyancy equations the corresponding eddy equations to 1 3 can be obtained by subtracting the averaged equations from the unaveraged set here the focus will only be on the energetics in order to motivate the parameterization further on it will be sufficient to think of the total energy as being divided into two types kinetic k and potential p each of which can be subdivided into their mean subscript m and eddy subscript e parts the four possible energies are defined as 5 k m 1 2 u g 2 v g 2 p m 1 2 b 2 n 0 2 6 k e 1 2 u g 2 v g 2 p e 1 2 b 2 n 0 2 the averaged kinetic and potential energy equations can be derived by taking the dot product of 1 and 2 with u g and multiplying 3 with b n 0 2 respectively the eddy energy equations can be obtained in a similar way by multiplying the eddy equations by the eddy primitive variables followed by averaging the internal energy will not factor into this discussion as it is decoupled from the other energy types under the qg approximation the full governing equation for each type of energy consists of terms which transport energy spatially terms which transfer energy from one reservoir to another and terms which act as sources or sinks a proper treatment of the energetics would require prognostic equations for the eddy energies along with associated parameterizations for each of their transport and forcing terms and promising approaches in large scale ocean modeling have been developed in this way e g eden and greatbatch 2008 jansen et al 2015 mak et al 2017 however because the emphasis of this paper is merely to establish a framework by which gm transfers resolved potential energy to kinetic energy simplifications will be made to streamline the forthcoming discussion and mathematics namely terms which supply dissipation mixing or external forcing will be dropped from the ensuing discussion with the proviso that they can be added in future extensions of this framework for a more complete treatment the energy coupling of the qg system will now be analyzed using the simplified energy equations subject to zero flux boundary conditions and the assumption of no sources or sinks of energy by the divergence theorem all of the transport terms drop out upon domain integration leaving only the transfer terms the domain averaged energy equations are then 7 t v k m d v v w a g b t u g d v 8 t v k e d v v t u g w a g b d v 9 t v p e d v v w a g b u g b b n 0 2 d v 10 t v p m d v v u g b b n 0 2 w a g b d v where 11 t u g u g u g v g 0 u g v g v g v g 0 0 0 0 and u g x u g y u g z u g x v g y v g z v g 0 0 0 are the geostrophic reynolds stress and velocity gradient tensors respectively and the double contraction operator takes two second order tensors as arguments and returns a scalar 12 λ γ λ i j γ i j it will henceforth be assumed that the turbulence is homogeneous and isotropic in the qg stretched coordinate system e g hua and haidvogel 1986 the assumption of homogeneous turbulence is controversial e g lesieur et al 2005 but allows local values of the eddy fluxes to be substituted for domain averaged values nonetheless it is common practice in turbulence closure development to make the assumption of homogeneity and is the basis for many prevalent closures in both the les literature e g smagorinsky 1963 germano et al 1991 smagorinsky 1993 and ocean modeling e g fox kemper and menemenlis 2008 bachman et al 2017a note that because it is the turbulence that is assumed to be homogeneous and not the mean flow diffusivity coefficients and gradients of mean quantities are allowed to be spatially variable here the homogeneous turbulence assumption will permit dropping the domain averaging operators in 7 10 it will also be assumed that w b 0 though this is immaterial to the parameterization and is made here for brevity the energy equations which result from these assumptions are 13 t k m t u g 14 t k e t u g w a g b 15 t p e w a g b u g b b n 0 2 16 t p m u g b b n 0 2 from these equations it is clearly seen how the energetics of the system are coupled each mean energy equation shares one term with its eddy counterpart which is of the opposite sign and the mean energies are coupled through the eddy field this implies that a gain in one energy type is compensated by an equivalent loss in another energy type so that for an inviscid flow the total energy is conserved 2 2 implications for modeling 2 2 1 into the eddy permitting regime here the energy equations will be examined to illustrate the energy transfer of baroclinic turbulence in qg flow and to further a discussion about how this transfer should be realized in numerical models baroclinic turbulence grows by converting available potential energy to eddy kinetic energy which in reality occurs across a range of scales near the baroclinic deformation radius e g salmon 1980 fu and flierl 1980 hua and haidvogel 1986 scott and arbic 2007 in a model this conversion is naturally partitioned into resolved and subgridscale components by the resolution of the model grid in reynolds averaged navier stokes rans models it is assumed that nearly all of the baroclinic conversion occurs at the subgridscale as of the writing of this paper this type of model remains prevalent for coupled climate simulations due to the computational expense of running at higher resolution in eddy permitting models dubbed mesoscale ocean large eddy simulations or moles in recent literature fox kemper and menemenlis 2008 a non negligible portion of the total conversion is assumed to occur at both resolved and subgrid scales the turbulence closure techniques appropriate for moles are notably different than for rans and demand additional considerations such as scale and flow awareness e g fox kemper and menemenlis 2008 bachman et al 2017a pearson et al 2017 as well as giving rise to conceptual issues like double counting e g henning and vallis 2004 delworth et al 2012 fig 1 presents a visual representation of this effect from the baroclinic spindown simulations presented further on in this paper the surface vertical relative vorticity field associated with a baroclinically unstable front is shown at different times during the transition from linear growth to turbulence the model resolution for these plots is chosen as a small multiple of the initial first internal deformation radius and demonstrates an eddy resolving simulation top layer of each time slice an eddy permitting simulation middle layer and weakly eddying simulation bottom layer fronts filaments and vortices are clearly visible in the eddy resolving simulation and are concomitant with a vigorous upscale energy cascade these structures are also clear in the eddy permitting simulation though the fronts are less sharp and the resulting vorticity field is of weaker amplitude the structures are nearly indistinguishable in the weakly eddying simulation the resolved dynamics still manifest the tendency of baroclinic eddies to slump over the front but the eddy field and associated frontal gradients are notably weakened relative to the higher resolution simulations likewise the inverse cascade in this simulation is restricted to a very narrow range of wavenumbers resulting in very little energy being deposited at large scales the distinction between rans and moles is needed because it affects both the correct approach to the closure problem as well as the implied energetics for example if one takes the mean and resolved flows to be synonymous then the assumption w b 0 made in the previous section means that there is no potential to kinetic energy conversion by the resolved flow this is an acceptable assumption for a rans model but obviously not so for moles furthermore to substitute local values for domain averaged values in moles requires an assumption of homogeneous turbulence for both the resolved and subgrid fields which is clearly not the case in all but the most idealized models to continue using the assumptions of the previous section and avoid these conceptual differences between rans and moles it will be understood that henceforth t k m and t p m will refer only to the part of the resolved energy tendencies associated with the parameterizations which allows w b 0 in these derivations with no ambiguity furthermore this means that all of the potential energy released by baroclinic turbulence through gm can be considered to be converted to subgridscale kinetic energy and that the subsequent transfer of this energy into larger scale resolved motions is truly via a backscatter type of process 2 2 2 comparison of energy pathways theory vs model fig 2 presents a schematic of how energy transfer at the oceanic mesoscale is predicted to occur in theory versus how it is realized in a model and motivates why the energy released by gm should be rerouted by the parameterization proposed in this paper fig 2a diagrams the theoretical view in which the available potential energy released by baroclinic instability is returned primarily to balanced motions unbalanced processes molemaker et al 2005 mcwilliams 2008 molemaker et al 2010 e g wave generation e g vanneste 2013 shakespeare and taylor 2016 shakespeare and hogg 2017 and smaller scale instabilities e g taylor and ferrari 2009 thomas and taylor 2010 stamper and taylor 2017 provide a route through which some of the balanced energy is cascaded downscale and dissipated most of the balanced energy is returned to larger scales through the inverse energy cascade and barotropization where it can be removed by bottom drag or transferred into rossby wave generation e g rhines 1975 sukoriansky et al 2007 tulloch et al 2009 the characteristic length scale which nominally separates the balanced and unbalanced motions is the baroclinic deformation radius l d a similar energy cycle manifests in numerical models fig 2b but the crucial length scale is the model grid spacing δ x rather than the deformation radius energy released by resolved baroclinic instability is able to follow a similar upscale pathway as in the theoretical case aside from that removed by eddy viscosity presently however gm siphons off some of the released energy into unresolved motions where it implicitly follows the red arrow to the left toward dissipative scales the effect of the reynolds stress parameterization proposed here is represented by the black symbols which is to remove cross out the downscale energy pathway and instead return the gm energy to resolved motions large curved arrow naturally the arguments made using this schematic assume δ x and l d are of similar scale as in a rans model as model resolution is increased as in moles and gm is tapered off e g hallberg 2013 bachman et al 2017a the vertical dashed line in panel b effectively moves to the left and less energy must be returned upscale in order to mimic panel a there is also an upper limit to the grid resolution where this schematic is expected to be accurate for systems such as the one envisioned here where the subgridscale flow is governed by baroclinic quasigeostrophic dynamics and the resolved flow is primarily barotropic quasigeostrophic the reynolds stresses are expected to play a leading order role in the momentum budgets grooms et al 2012 however if the grid resolution is coarsened to the point where turbulence is absent and the resolved flow is planetary geostrophic the reynolds stresses cease to be asymptotically important grooms et al 2011 and the parameterization framework developed here becomes invalid 2 2 3 the role of parameterizations gm and the missing piece eqs 13 16 will now be used to mathematically formalize the energy pathways depicted in fig 2 and to show the role that the parameterizations play in this system consider a scenario where the baroclinic turbulence has saturated so that t k e t p e 0 using the same assumptions preceding 13 16 the implied energy balance is 17 u g b b n 0 2 t u g 18 t p m t k m using gm to parameterize the lateral eddy buoyancy fluxes and writing it in buoyancy diffusivity form e g vallis 2017 u g b κ g m b the resolved energy tendencies are 19 t p m u g b b n 0 2 κ g m b 2 n 0 2 20 t k m t u g κ g m b 2 n 0 2 for positive values of κ g m the effect of gm as a sign definite sink of resolved potential energy is made clear by 19 this result has long been appreciated in previous literature e g gent et al 1995 griffies 1998 and is widely recognized as the main mechanism by which the parameterization mimics baroclinic turbulence perhaps less well known is the relation 20 which is made possible through analysis of the energy equations this relation states that in this simplistic energetic framework all of the potential energy released by gm should be manifested as resolved kinetic energy furthermore 20 hints at a recipe for making this so i e via a parameterization of the lateral reynolds stresses to be clear 19 and 20 specify how the energetics in a large scale model might be realized not the form of the parameterizations that must be used gm represents one half of the equation and exists as a means to reduce resolved potential energy the missing half a parameterization for the reynolds stresses must return this energy in kinetic form via the resolved motions this as yet undefined parameterization does not arise from mimicking the restratifying effects of baroclinic turbulence but by mimicking the energy transfer effects of the turbulence in conjunction with the inverse energy cascade together with gm it thus aspires to provide a more complete treatment of the phenomenology of mesoscale eddies than gm acting alone 3 a parameterization for qg reynolds stresses here a parameterization for the lateral reynolds stresses will be developed with the goal that it is energetically linked to gm such that the relation 20 is satisfied before beginning it is useful to list the required characteristics of the parameterization the parameterization must add kinetic energy to the resolved flow in particular to mimic barotropization this energy must be added only to barotropic motions the parameterization must be energetically constrained i e the amount of energy it adds cannot be unbounded satisfaction of the above properties cannot require a particular choice of the gm transport coefficient κ g m the last point alludes to the multitude of expressions for κ g m that have appeared in ocean modeling literature e g visbeck et al 1997 cessi 2008 fox kemper et al 2008 eden and greatbatch 2008 marshall et al 2012 bachman and fox kemper 2013 jansen et al 2015 bachman et al 2017a each of which has a different rationale for its scaling as well as exhibiting different levels of skill in practice e g bachman et al 2017c despite a lack of consensus over which choice for κ g m is optimal the fundamental property of the gm closure that it reduces resolved potential energy does not depend on the choice of coefficient for the reynolds stress parameterization to be linked energetically to gm it should thus not depend on the choice of coefficient either to be clear however the skill of the combined gm and reynolds stress parameterizations hereafter referred to as gm e or gm plus energetics should still be expected to depend on the expression for κ g m the other characteristics in the above list will be added to the obvious requirements that the parameterization be numerically stable and improve key measures of the resolved flow which will be discussed further in the context of the test simulations in section 4 the derivation begins by employing the form of the qg momentum equations presented in cronin 1996 and takes advantage of the relationship in residual mean theory between the divergence of the eliassen palm flux tensor and the eddy qgpv flux eliassen and palm 1961 andrews and mcintyre 1976 the use of residual mean theory introduces a correction to the ageostrophic velocity which in the case of cronin 1996 is 21 u a g u a g z u g b n 0 2 such that the residual mean momentum equations are 22 d u g d t f 0 k ˆ u a g k ˆ β y u g ϕ a g k ˆ u g q all of the eddy forcing in this equation set is encapsulated as the cross product of the vertical unit vector with the eddy qgpv flux 23 k ˆ u g q x u g u g y u g v g z f 0 n 0 2 v g b x u g v g y v g v g z f 0 n 0 2 u g b transformed eulerian mean tem theory andrews and mcintyre 1976 mcdougall and mcintosh 2001 can be used to write the buoyancy flux terms in 23 in terms of a streamfunction treguier et al 1997 24 ψ u g b n 0 2 subject to zero flux boundary conditions at the free surface and bottom here the vertical boundaries will be idealized to that of a rigid surface located at z 0 over a flat bottomed basin of depth z h and a linear modal decomposition e g lacasce 2012 pedlosky 2013 will be assumed wherein qg buoyancy anomalies are not allowed at the boundaries 2 2 bathymetry is known to exert a strong influence on the oceanic barotropic flow e g koblinsky 1990 gille 2003 and the desire for a more realistic treatment of buoyancy and qgpv anomalies at the boundary has motivated an extensive body of literature e g surface quasigeostrophy blumen 1978 held et al 1995 the simplified vertical boundaries used here are purely for mathematical convenience so as to arrive at the reynolds stress parameterization with minimal diversion a more realistic treatment of many such outstanding issues such as dissipation variable bathymetry local effects etc is a top priority for future extensions of this framework substituting 24 into 23 allows the eddy forcing to be rewritten as 25 k ˆ u g q div t f 0 k ˆ z ψ so that averaging 25 in the vertical from the bottom to the surface boundary 26 1 h h 0 k ˆ u g q d z 1 h h 0 div t d z two important consequences of this vertical averaging can now be noted first the right hand side of 26 represents the barotropic reynolds stress divergence which is the targeted quantity to be parameterized the form of the reynolds stress parameterization thus will be specified by deriving an expression for the barotropic eddy qgpv flux on the left second applying the vertical averaging to all of the terms in the momentum equations 22 removes both the buoyancy flux terms in the eddy forcing as well as the correction to the ageostrophic velocity in 21 so that in the barotropic sense 22 is energetically identical to the standard momentum equations 1 2 because the framework presented in this manuscript primarily emphasizes energetics it is thus warranted to proceed using the residual mean equations as the basis for this derivation assume a flux gradient closure for the eddy qgpv flux of the form u h q κ q q where κ q is the qgpv eddy diffusivity if the vertically averaged lateral qgpv gradient is nonzero one can also define a second diffusivity 27 κ q h 0 κ q q d z h 0 q d z which can be substituted into 26 to obtain 28 1 h h 0 k ˆ u g q d z 1 h h 0 k ˆ κ q q d z 29 κ q k ˆ 1 h h 0 q d z because the vertical boundaries are flat the horizontal gradient operator can be moved outside the integral so that 30 κ q k ˆ 1 h h 0 q d z κ q k ˆ 1 h h 0 q d z recalling that the mean qgpv is 31 q x v g y u g f z f 0 n 0 2 b taking the vertical integral of q gives 32 κ q k ˆ 1 h h 0 q d z κ q k ˆ q 33 κ q h 0 x y v g y y u g x x v g x y u g d z 34 κ q x y v g y y u g x x v g x y u g 35 κ q x x u g y y u g x x v g y y v g 36 κ q 2 u g where capital letters have been used to denote the vertical averages of q u g and v g and the final step makes the substitution u x v y by the continuity equation in the integration step the vortex stretching term has been removed since no buoyancy anomalies are permitted at the vertical boundaries and the planetary vorticity term involving f β j ˆ has been removed to satisfy global momentum conservation bretherton 1966 3 3 the presence of β in downgradient qgpv closures has been a longstanding point of contention in ocean modeling with studies arguing both for its significance e g treguier et al 1997 wardle and marshall 2000 ringler and gent 2011 and insignificance e g bachman et al 2017a regardless its presence violates global angular momentum conservation bretherton 1966 and has motivated approaches to avoid this dilemma by permitting negative diffusivities e g marshall et al 2012 or removing it via a rotational gauge e g eden 2010 given the lingering uncertainty over this term the choice here is to prioritize global momentum conservation and to achieve this via the latter method substituting 36 back into 26 the parameterization for the vertically averaged reynolds stresses becomes 37 1 h h 0 div t d z κ q 2 u g to return to a vertically local value of the reynolds stress divergence one can define 38 div t 1 h h 0 div t d z div d where the baroclinic reynolds stress divergences are represented by the tensor d the advantages of making this substitution will become clear in the following subsections where the energetics of the parameterization are discussed using 24 and 38 the momentum equations 22 can now be written 39 d u g d t f 0 k ˆ u a g k ˆ β y u g ϕ a g k ˆ u g q 40 ϕ a g div t f 0 k ˆ z ψ 41 ϕ a g κ q 2 u g barotropic reynolds stress parameterization div d f 0 k ˆ z ψ the term with square brackets will be the candidate reynolds stress parameterization proposed to complement gm both of which have been identified in 41 using underbraces the buoyancy flux term on the far right will henceforth be ignored and the focus will be on details of the square bracketed term in particular it will be shown that the bulleted requirements at the beginning of this section are all satisfied by this term with this being the case the baroclinic reynolds stress divergence term div d has no role in satisfying the energetic constraints desired of the candidate parameterization it is not part of the gm e framework and thus will not be included in further discussion however it is worth noting that a standard harmonic viscous closure with coefficient ν 42 d ν u g would be a reasonable parameterization for this term since this kind of closure is often employed for numerical stability it is not clear whether the gradients in 42 should act on the full velocities or only their baroclinic parts these issues are tangential to the main thread and will not be considered further though it is noted that the simulations in section 4 use the closure 42 with the full velocities 3 1 energetics of the parameterization one of the main requirements for the proposed reynolds stress parameterization is that it transfers energy into the resolved barotropic flow which requires a closer look at the mean kinetic energy equation the domain averaged kinetic energy tendency due to the parameterization can be derived by taking the dot product of 41 with u g focusing only on the term with the underbrace this is 43 t v k m d v v κ q 2 u g u g d v v κ q u g u x x u y y v g v x x u y y d v here it will be shown that the each term on the right side of 43 will only change the domain integrated barotropic energy to see that this is the case consider for example the u g y y u g term splitting the geostrophic velocity into barotropic and baroclinic parts such that 44 u g u g u g one can write this term as 45 u g y y u g u g u g y y u g 46 y u g u g y u g y u g y u g y u g 2 the term in the square brackets vanishes upon horizontal integration for both no slip u g n ˆ 0 and free slip u g n ˆ 0 boundary conditions where n ˆ is the unit normal to the boundary the second term involves the product of the baroclinic and barotropic lateral shear and vanishes upon vertical integration by noting that 47 h 0 y u g y u g d z y u g y h 0 u g d z 0 the sole remaining term on the far right of 46 represents a sign definite source or sink of barotropic energy depending on the sign of κ q this procedure can be repeated for the other terms on the right side of 43 in each case only one sign definite source or sink term is left after domain averaging and after summing all these terms the kinetic energy tendency of the parameterization is 48 t v k m d v v κ q x u g 2 x v g 2 y u g 2 y v g 2 the energy tendency in 48 is reminiscent of an isotropic harmonic viscosity with coefficient κ q except that it acts only on the barotropic velocities it is clear upon inspecting 48 that for the parameterization to add kinetic energy and satisfy the first bulleted point from the previous section requires κ q 0 in fact an expression for κ q which satisfies this requirement can be derived by returning to the energy tendencies in 19 and 20 which state that the energy gained through the reynolds stress parameterization must equal that which is lost due to gm substituting 48 for the right side of 18 and substituting 19 for the left side the resulting kinetic energy relation is 49 v κ g m b 2 n 0 2 v κ q x u g 2 x v g 2 y u g 2 y v g 2 again assuming homogeneous turbulence to replace the domain averages with local values the resultant expression for κ q is 50 κ q κ g m b 2 n 0 2 x u g 2 x v g 2 y u g 2 y v g 2 if κ g m is positive the right side of 50 consists entirely of terms which are 0 so that κ q 0 this expression for κ q thus satisfies the central requirements for the proposed parameterization in that it is guaranteed to add kinetic energy to the resolved barotropic flow as long as κ q is nonzero and it adds exactly as much energy as gm extracts furthermore while the value of κ q scales linearly with whatever value is used for κ g m it does not depend on the particular choice of κ g m 3 2 a simplification and summary of the gm e scheme in terms of energetics the reynolds stress parameterization acts as a negative viscosity acting on the barotropic flow whose magnitude is set by the local values of κ g m the stratification and the lateral shear however in its original form 43 the parameterization contains terms that affect the local transport of momentum but do not change the domain integrated kinetic energy furthermore the second derivative terms in this expression are not written as the divergence of a flux increasing the likelihood of introducing noise and potentially numerical instability upon implementation from that perspective it is justified to write an alternative flux form version of the parameterization 51 d u g d t f 0 k ˆ u a g k ˆ β y u g ϕ a g κ q u g barotropic reynolds stress parameterization which is identical energetically but far more amenable to numerical implementation as it can easily be slotted into extant subroutines for harmonic viscosity note that here the standard qg momentum equations are written in 51 instead of the residual mean form the expression for κ q is unbounded as written in 50 but the total injection of kinetic energy remains bounded by the constraint in 49 for example consider a region where b is large and the stratification and shear are weak the value of κ q here will be large but the weak shear means that the strong negative viscosity will be acting on small gradients of velocity and the overall energy injected will remain equal to that removed by gm while the existence of upgradient momentum fluxes has long been recognized in oceanic and atmospheric flows e g starr 1968 dritschel and mcintyre 2008 berloff et al 2009 large negative viscosity is worrisome from a numerical perspective and indeed a negative viscosity of any kind is unstable according to traditional analysis however previous studies examining the viability of negative viscosity e g jansen and held 2014 or upgradient flux parameterizations e g zanna et al 2017 in ocean models have suggested these methods may be feasible despite violating the traditional stability criteria the simulations described in section 4 proved surprisingly stable despite the negative viscosity effect and upon detailed examination of failed simulations two modifications were determined to be sufficient to keep the simulations stable for all cases tested here a small parameter ϵ can be added to the denominator of 50 to prevent division by zero in practice setting ϵ close to machine precision is all that is needed a smoothing operation on the viscous fluxes which will be denoted by angle brackets which helps to more evenly distribute injected kinetic energy and prevents pile up of energy at the gridscale in practice the smoothed terms are computed as a weighted average of nearby neighbors several different choices of smoothing operator were tested for the numerical experiments in section 4 and are described in detail in appendix for now the full gm e framework with the above modifications can be summarized by writing it in the qg primitive equations which are 52 d u g d t f 0 k ˆ u a g k ˆ β y u g ϕ a g κ q u g barotropic reynolds stress parameterization 53 d b d t w a g n 0 2 κ g m b gm buoyancy diffusion 54 κ q κ g m b 2 n 0 2 x u g 2 x v g 2 y u g 2 y v g 2 ϵ here the reader is reminded that in 52 54 the overbar simply indicates that the variable is resolved by the model grid and capital letters indicate vertically averaged variables the reynolds stress part of the closure is filtered using the operator and the denominator of the expression for κ q contains a small constant ϵ to prevent division by zero 4 simulations 4 1 model setup the massachusetts institute of technology general circulation model mitgcm marshall et al 1997 is used to solve the hydrostatic boussinesq equations and test the gm e framework the basic flow configuration used for these tests is that of a zonally reentrant channel on an f plane with a temperature front oriented in the cross channel direction that extends from the free surface to the bottom boundary to simulate qg dynamics with interesting vortex stretching both the initial horizontal and vertical buoyancy gradients b y m 2 and b z n 0 2 are made to vary with depth the configuration is identical to that used in bachman et al 2017a with the balanced richardson number r i b n 0 2 f 0 2 m 4 50 at all depths f 0 7 29 1 0 5 s 1 and the total depth h 300 m n 2 and m 2 vary between 2 0 1 0 8 s 2 and 4 5 1 0 9 s 2 at the bottom respectively and 1 0 1 0 7 s 2 and 1 0 1 0 8 s 2 at the top the constant ϵ appearing in 54 is set to 1 0 1 0 15 the initial conditions are the same across all simulations the first internal deformation radius of the initial state is l d 511 8 m this and the total depth are small for typical ocean mesoscale values and fall into more submesoscale values however as argued in bachman et al 2017a the dimensionless parameters of the flow are appropriate for the mesoscale regime and quasigeostrophic dynamics are applicable in all simulations in these simulations all viscous boundary conditions are no slip and the velocity fields are initialized in geostrophic balance to minimize ageostrophic waves the initial stratification is independent of the along front direction all simulations use a third order upwinding scheme for the tracer equations which ensures stability and dissipation of tracers according to numerical not physical specifications the gm parameterization uses a simple vertical tapering large et al 1997 to ensure that there is no buoyancy flux through the vertical boundaries the standard buoyancy diffusion form of gm is used in these simulations the reynolds stress part of the gm e framework uses a top hat smoothing filter which is described in detail in appendix soon after initialization the front undergoes slumping by baroclinic instability this process is more efficient at higher resolution because the model grid is better able to resolve the full range of unstable modes and the weaker eddy viscosity at higher resolution is less able to damp out these modes the conversion of available potential energy to kinetic energy serves both to energize the resolved flow in the form of eddies as well as to tilt the mean isopycnals toward the horizontal output from the model is gathered every two days during this frontal spindown the energy spectra take on a well defined slope by day 100 which persists until the simulations are terminated at day 400 the statistics gathered for the figures in this section are taken by averaging the output between day 200 and the end of the simulation the testing suite consists of five simulations differing in grid resolution δ x a truth simulation is run with δ x 0 1 l d which is sufficiently fine to resolve a vigorous field of baroclinic eddies and manifest a well defined spectral slope of kinetic energy this simulation is run without either the gm or gm e parameterization and uses qg leith eddy viscosity bachman et al 2017a for numerical stability the other simulations in the suite are run at progressively lower resolution with δ x 0 5 l d l d 2 5 l d 5 l d where each coarsening of the grid results in less well resolved eddies a weaker inverse energy cascade more diffuse frontal structures and progressively less energy in the resolved flow a visual depiction of these effects was shown in fig 1 for comparison using the deformation radii of the real ocean at 30 latitude chelton et al 1998 smith 2007 these model resolutions would be roughly equivalent to those of a global model run at 1 2 5 truth 1 5 1 2 1 and 2 resolutions 4 2 effects on kinetic energy a single run without either gm or gm e was completed at each resolution to serve as a reference point that the parameterized runs can be compared against and to demonstrate the effect of grid resolution on the flow statistics the kinetic energy spectra from each of these cases is shown in fig 3 as anticipated the three highest resolution simulations with δ x 0 1 l d 0 5 l d l d have well defined spectral slopes these slopes approximately follow the k m k 3 slope dashed line predicted for the inertial range of a forward potential enstrophy cascade e g smith et al 2002 down to about 4 km wavelengths then steepen to approximately k m k 4 dotted line the k m k 4 slope is not predicted by standard qg theory and is similar to slopes found in the global models of kjellsson and zanna 2017 it is possible that this steepening is due to the inertial range being cut off near the 4 km scale by the eddy viscosity for example see fig 10 overall the spectral slopes of the δ x 0 5 l d purple line and δ x l d yellow line simulations agree closely with the δ x 0 1 l d truth simulation green line albeit with slightly less energy overall the effect of lower resolution begins to show up strongly in the δ x 2 5 l d red line and δ x 5 l d blue line simulations with around one and two orders of magnitude less energy at the largest scales respectively at higher wavenumbers the δ x 2 5 l d simulation exhibits a very short range where the spectral slope steepens while the δ x 5 l d simulation shows no steepening or evidence of a turbulent cascade at all the simulations using gm and gm e are run at the same five resolutions listed above attempting to test these parameterizations using every possible combination of gm coefficient e g visbeck et al 1997 cessi 2008 fox kemper et al 2008 eden and greatbatch 2008 marshall et al 2012 bachman and fox kemper 2013 jansen et al 2015 bachman et al 2017a and viscous closure such as the nine presented in bachman et al 2017a among others would be prohibitively expensive and time consuming to demonstrate the key points in this paper only two such choices the qg leith bachman et al 2017a pearson et al 2017 and smagorinsky smagorinsky 1963 1993 closures are sufficient the qg leith closure is chosen because it is optimally scaled for qg flows is scale aware and recommends using the same value for viscosity as the gm coefficient ν κ g m for these reasons qg leith greatly simplifies parameter space and is an ideal candidate for these tests from a physical perspective the smagorinsky closure is also scale aware but is inappropriately scaled for qg flows it is included here specifically to compare against qg leith and show that scale awareness is not enough to rectify weak energy at low resolution i e an energy injecting closure such as gm e is necessary including smagorinsky will also demonstrate that gm e improves on gm even when the coefficients are scaled poorly like qg leith it is used both to set the harmonic viscosity and the gm coefficient a summary of the control reference and gm gm e experiments is shown in fig 4 kinetic energy spectra from the model runs with gm and gm e are shown in fig 5 the top row shows the spectra using gm with qg leith panel a and smagorinsky panel b as was shown in bachman et al 2017a the qg leith scheme is skillful at cleanly truncating the energy spectra at the gridscale in eddy permitting δ x 0 1 l d 0 5 l d l d simulations with very little deviation away from the spectral slope that emerges at lower wavenumbers in terms of magnitude the spectra are very similar to those from the control cases where neither gm or gm e is used fig 3 this is not entirely surprising since qg leith tends to predict very small coefficients so that the combined effect from viscosity and gm will likewise be small this stands in stark contrast to the effects of the smagorinsky scheme which greatly decreases the kinetic energy at all wavenumbers the effect of smagorinsky in qg scaled flows is excessively dissipative bachman et al 2017a figure 6 because it predicts very large coefficients the plots shown in fig 5b show even less energy than those in bachman et al 2017a however which occurs because here the smagorinsky coefficient is also being used as the gm coefficient because this coefficient is large gm aggressively drains available potential energy from the front if the flow remains approximately in thermal wind balance this also has the effect of removing kinetic energy from the geostrophic shear resulting in greatly depressed kinetic energy spectra as seen in fig 5b the bottom row of fig 5 shows the results of using the gm e framework with each choice of gm coefficient both panels clearly show an increase in energy at all scales though scale awareness of both qg leith and smagorinsky reduces the energy adding effect of gm e in the higher resolution simulations for qg leith panel c the energization is most pronounced for the lowest resolution simulations the eddy permitting simulations with δ x 0 1 l d 0 5 l d show very little effect in comparison to standard gm aside from a small bump in the energy near the gridscale of the δ x 0 5 l d run at smaller wavenumbers gm e increases the energy of the low resolution simulations almost to match those of the high resolution simulations the δ x 2 5 l d simulation red line also appears to have a slightly wider range where the spectrum is red the non eddying simulation with δ x 5 0 l d is strongly energized by gm e though there is a clear overshoot in the energy at the domain scale however in non eddying simulations the reynolds stresses are expected to be asymptotically unimportant grooms et al 2011 and the skill of a moles closure such as qg leith is dubious e g bachman et al 2017a meaning that the skill of gm e in this simulation is doubtful on both physical and numerical grounds regardless the effective gridscale of this simulation is coarser than that used in modern coupled climate scale gcms so the behavior of the δ x 5 0 l d run may not be relevant in practice the effect of using gm e with the smagorinsky closure panel d is to energize the motion at all scales as expected though the overall skill remains poor compared to qg leith this demonstrates the necessity of choosing appropriate coefficients for the eddy viscosity and gm in conjunction with the gm e framework while the scale awareness of smagorinsky is helpful in this regard i e the coefficients are reduced at higher resolution so that none of the simulations are more energetic than truth the poor scaling of smagorinsky in qg flows still overwhelms the positive effect of gm e the kinetic energy content in these simulations can also be analyzed in a way that separates the contributions of the baroclinic and barotropic flow fig 6 shows a bar chart of the fraction of total kinetic energy yellow bars that is contained within the barotropic red bars and baroclinic blue bars motions in this figure the overall energy content is normalized against the energy in the δ x 0 1 l d truth simulation so that the total energy from this simulation is set to one in the simulations without gm panel a most of the energy is contained in the barotropic flow with a clear dropoff in the barotropic energy as the gridscale is coarsened this general trend also is true for the gm cases though the dropoff is less severe for the qg leith model panel b than the smagorinsky model panel c when gm e is used with qg leith panel d the amount of energy at each resolution tends to be closer to truth than when gm alone is used the energy increase is most pronounced in the δ x 2 5 l d and δ x 5 0 l d simulations where the overall energy content is increased by over a factor of ten most importantly the amount of barotropic energy in each simulation is closer to truth than in the gm case which is a direct result of energy being injected only into the barotropic motions interestingly among all of the gm and gm e qg leith models the baroclinic energy content remains fairly consistent which may be indicative of qg leith s ability to tune the gm coefficient as a function of resolution the kinetic energy in the smagorinsky model with gm e is increased across all resolutions consistent with fig 5 though the total content remains significantly less than truth 4 3 effects on flow structures the injection of energy in the gm e framework is through the barotropic momentum and this added momentum can be expected to affect the subsequent flow evolution at a given point in space the energy injection depends on the local properties of the velocity gradients buoyancy gradients and κ g m raising questions about whether this contaminates the domain with noise surface snapshots of the kinetic energy at day 300 are shown in fig 7 to visually illustrate the effects of gm e these snapshots are taken from the δ x 2 5 l d δ x l d and δ x 0 5 l d simulations and clearly show the emergence of frontal structures as the resolution is increased the additional energy injected by gm e bottom row in comparison to gm top row is most evident in the δ x 2 5 l d simulations panels a and d where there is a notable energization in the center of the domain energization in the higher resolution simulations is not evident visually although the spectra in fig 5 confirm that it occurs there is a slight suggestion that additional small scale structures are present in the δ x l d and δ x 0 5 l d gm e simulations but no obvious presence of gridscale noise or other artificial effects on the flow to check the effects of gm e on other emergent flow structures in the domain such as fronts jets and the distribution of energy and enstrophy z m defined below probability density functions pdfs are made across all of the qg leith simulations fig 8 the pdfs are created by sampling the desired quantity k m z m u or b at every point in each model output snapshot from day 200 to day 400 assembling all these values into a vector and then binning them into 60 bins which are evenly spaced in log space a pdf is made for each of these quantities at each resolution except for the δ x 0 1 l d truth simulation which was computationally too expensive however given the close convergence of the δ x 0 5 l d to truth the pdfs from these two simulations are likely to be nearly identical fig 8a shows pdfs of kinetic energy at each resolution from both the gm top and gm e bottom simulations for the gm simulations the pdfs are shifted left toward smaller values for the coarser resolution models which is consistent with the weaker overall kinetic energy in these models shown in figs 3 and 6 the pdfs from the δ x 2 5 l d and δ x 5 0 l d simulations red and blue lines respectively show that there is almost no likelihood of having a point whose kinetic energy is even as strong as the most likely kinetic energy value from the higher resolution models in the gm e simulations the lower resolution pdfs are shifted to the right so that all lie nearly on top of each other meaning that even in the lower resolution models the pointwise values of kinetic energy are likely to be similar to those from the higher resolution models the same general story holds for quantities which are dependent on first derivatives of velocity such as the enstrophy z m x v y u 2 panel b and velocity gradient magnitude u x u 2 y u 2 x v 2 y v 2 panel c for each of these quantities gm e shifts the pdfs to the right in comparison with gm implying stronger vortices and velocity fronts are resolved due to gm e the values of these variables from the δ x 5 0 l d simulation remain skewed to the left of the other simulations partly because the strength of the gradients is limited by the grid spacing and stronger numerical diffusion and also because of the absence of baroclinic eddies at this resolution interestingly there is little difference in the gm and gm e pdfs in terms of the buoyancy gradient magnitude b panel d this is likely because the horizontal buoyancy gradient is related to the baroclinic velocity through thermal wind while the momentum injected by gm e is through the barotropic velocity only a complete analysis of the effects of gm e on flow structures would be incomplete without discussion of its effects on eddy mean flow interaction it is well established that eddy dynamics strongly affect the strength structure and stability of larger scale features such as jets gyres and boundary currents e g thompson 1978 hogg 1985 howden 2000 watts et al 2001 waterman et al 2011 on both sub annual e g bishop 2013 and inter annual e g spall 1996 timescales these interactions are known to be especially prevalent in western boundary currents e g waterman and jayne 2011 waterman and hoskins 2013 which is where the energy exchanges from gm e are likely to be strongest the effects of injecting energy into boundary currents is very likely to imprint on the ocean heat transport atmospheric storm tracks and other climatologically relevant dynamics it is difficult to speculate about the effects of gm e on these dynamics partly due to their intrinsic complexity and partly due to the present simplicity of the framework for example there are likely aspects of the geometry of eddy mean feedbacks e g waterman and lilly 2015 tamarin et al 2016 which cannot be captured by an isotropic injection of energy the simple channel geometry of the simulations used here does not permit these types of flow structures to develop and therefore precludes a proper analysis this is left to future work testing gm e in global ocean configurations 4 4 effects on frontal slumping more unstable baroclinic modes are resolved as grid resolution is increased meaning that the slumping and restratification process associated with baroclinic eddies occurs more quickly at higher resolution gm assists this process by increasing the slumping rate beyond that which the resolved modes can manage alone the inverse energy cascade should also increase the slumping rate as well by adding energy to the largest most powerful eddies thereby making them more efficient at restratifying the flow one might expect that gm e would also increase the restratification rate due to its added energy as well fig 9 shows a time series of isopycnal slope for simulations using qg leith as expected the isopycnal slopes decrease over time as the front spins down with the decrease occurring more quickly as resolution increases the resolution threshold between non eddying and eddying models is also apparent in this figure in that the δ x 2 5 l d and δ x 5 0 l d simulations experience effectively no net slumping due to the absence of baroclinic eddies even though gm is enabled in the simulations used for this plot the effects from using qg leith as the gm coefficient are minimal compare for example figs 3 and 5a so gm provides little extra restratifying capability here the effects of small eddies which are only resolvable at high resolution can also be seen by comparing the δ x l d dashed yellow line and δ x 0 5 l d dashed purple line simulations even though fig 5a shows that the largest eddies in these simulations are similarly energetic the slumping in the δ x 0 5 l d simulation occurs much more quickly beginning around day 200 using gm e solid lines has little positive effect on the non eddying simulations the isopycnals in the δ x 5 0 l d simulation are heaved upward around day 200 which is slowly corrected past day 300 the slope at the end of the simulation is similar to that from the gm only case the heaving is likely spurious and not associated with any physical mechanism even with gm e this simulation does not resolve baroclinic eddies so it is likely that the scheme is introducing noise that is deforming the isopycnals in some locations the δ x 2 5 l d simulation shows almost no effect on the slumping rate from using gm e instead of just gm there is no slope heaving in this simulation but there is also very little speed up in the restratification rate the effects of gm e become much more pronounced once eddies become permitted both the δ x l d and δ x 0 5 l d simulations show a noticeable increase in the slumping rate if this rate is estimated as 55 slumping rate slope t end slope t 0 duration of simulation the slumping rate is abut 50 faster for δ x l d and 20 faster for δ x 0 5 l d interestingly gm e causes the slumping to begin much sooner in the δ x 0 5 l d simulation solid purple line than any of the others though it is unclear why this is so overall the increase in slumping rate due to gm e makes the slope at day 400 in both the eddy permitting simulations closer to that of the truth simulation green line overall the increase in restratification rate due to gm e is consistent with what would be expected due to an inverse energy cascade however the time series plotted here are from a transient simulation with a single front spinning down it is unclear how this faster restratification would affect the time mean slope and dynamics of climatically relevant fronts such as the polar front or those of western boundary currents these are relevant concerns for long duration climate simulations and will require testing in more complicated models than the idealized channels used here but is beyond the scope of this work 4 5 effects on resolved energy transfer a central concern for eddy permitting modeling is the degree to which turbulence closures interfere with resolved dynamics the most well known issue is that of double counting e g henning and vallis 2004 where parameterized eddies out compete resolved eddies for energy which has inspired a variety of approaches ranging from moles style closures e g fox kemper and menemenlis 2008 bachman et al 2017a to resolution functions e g hallberg 2013 to simply turning the closures off at high resolution e g mcclean et al 2011 delworth et al 2012 bryan et al 2014 a less understood question is how parameterizations affect the resolved turbulent cascades themselves in terms of scale to scale transfer to investigate this question spectral energy fluxes from the model can be analyzed to see how each term in the kinetic energy budget acts to move energy up or downscale following kjellsson and zanna 2017 these fluxes are calculated by performing a fourier transform in the along channel direction which for the zonal velocity is written 56 u k l z t 1 2 π 2 u x y z t e i k x l y d x d y here k and l are the zonal and meridional wavenumbers defining the complex conjugate of u as u the resolved kinetic energy in spectral space is k m 0 5 u u v v after averaging over the meridional and vertical directions denoted here by an overbar the kinetic energy spectral flux is computed as the cumulative integral of k m over all zonal wavenumbers 57 k m k k k m d k and whose budget is 58 t k m π n π p π v π f π d π e 59 π n k u u u v u v d k 60 π p k ρ 0 1 u x p ρ 0 1 v y p d k 61 π v k u ν u v ν v d k 62 π f k w b d k 63 π d k u c d u b o t v c d v b o t d k 64 π e k u κ q u v κ q v d k in these expressions u b o t is the horizontal velocity in the cell adjacent to the bathymetry the quadratic bottom drag coefficient c d 0 002 u b o t u b o t p is the thermodynamic pressure and ρ 0 is the reference density π e is the transfer term associated with the gm e parameterization as in kjellsson and zanna 2017 a term similar to π v can be derived for the vertical dissipation but will be ignored here as it is negligibly small not shown note that the unapproximated kinetic energy equation is used in 58 rather than the qg version in section 2 as is appropriate for a primitive equation model such as mitgcm here the difference between transfers in the gm and gm e simulations will be highlighted fig 10a shows spectral energy fluxes from the δ x l d simulations where negative values of the nonlinear transfer term π n correspond to energy transfer to larger scales consistent with an inverse energy cascade in the models the nonlinear transfer pink line is negligibly small keeping in mind that the vertical axis is in logarithmic scale for wavelengths less than approximately 4 km or roughly 8 l d this is broadly consistent with the results of kjellsson and zanna 2017 who found that nonlinear transfer became significant at wavelengths several times larger than the deformation radius and peaked at scales a few times larger still the peaking behavior in their model is partly due to latitudinal variation of the coriolis parameter as their results are extracted from a realistic global model unlike their simulations the models here are run on an f plane so that the relevant upper limit to the eddy scale and upscale transfer is set by the channel width vertical dashed line the behavior of π n is very similar between the gm and gm e simulations suggesting that the gm e does not interfere significantly with upscale transfer once turbulence becomes established the largest difference between gm and gm e occurs in the terms associated with the conversion of potential energy to kinetic energy π p light blue line and π f red line at scales less than 4 km in the gm e simulation the vertical buoyancy flux term π f changes sign twice with small negative values just above the gridscale indicating kinetic energy reduction it is likely that this effect is nonphysical and due to noise generated by gm e at larger scales the shape and magnitude of π f are very similar between the two simulations see panel b and discussion below the pressure gradient term π p is of similar magnitude and opposite sign as π n and also switches sign near the 4 km scale the switch occurs at slightly larger wavenumber in the gm e simulation but this is likely insignificant the viscous dissipation green line and bottom drag yellow line terms are sign definite sinks of kinetic energy so that their spectral fluxes are negative at all wavenumbers conversely the gm e energy source dark blue line is positive at all wavenumbers the bottom drag and gm e terms represent the dominant balance in the kinetic energy budget which is expected given that energy cascaded upscale is barotropized and envisioned to be lost either to rossby wave generation e g rhines 1975 sukoriansky et al 2007 tulloch et al 2009 but which is not possible in these simulations due to no background pv gradient or bottom drag the magnitude of all of the energy flux terms in fig 10a covers a wide range in logarithmic space and makes detailed comparison of their behavior between the gm and gm e simulations difficult however because the behavior of each term is similar in both simulations it is informative to plot the ratio of each term in gm e with its counterpart in gm to see how it is strengthened or weakened by the inclusion of the reynolds stress parameterization in gm e fig 10b shows these ratios as a function of wavenumber with an inset highlighting the ratios at large scales some of the ratios below the 4 km scale are noisy due to different behavior between the two simulations but above this scale the ratios tend to behave more consistently with scale as seen in the inset the pressure and viscous fluxes are around twice as strong in the gm e simulation as there is more kinetic energy present to be both transported and dissipated the flux due to bottom drag is around 30 stronger in this simulation as well the vertical buoyancy flux is essentially unchanged while the nonlinear flux is reduced by an average of 12 this would suggest that at scales much larger than δ x the resolved eddies are able to convert potential to kinetic energy with the same efficiency in both simulations but the transfer between scales is reduced slightly despite there being more energy at any given wavenumber it is unclear how these effects would play out in a global climate simulation on long timescales but this type of investigation requires much more sophisticated models than are used in this work and is left for future study 4 6 effects on scale aware viscosity the gm e framework injects energy locally and the resolved turbulence organizes this energy in space such that the kinetic energy spectra have a well defined slope fig 5 however even using the smoothing operation introduced in section 3 and detailed in appendix the local energy injection can introduce a significant amount of variability at the gridscale flow aware viscous schemes which adjust the viscous coefficient ν based on key measures of resolved flow features are sensitive to this kind of variability and are thus likely to be affected by the use of gm e the qg leith and smagorinsky schemes used in this work are two such flow aware schemes so it is useful to investigate how their behavior changes when gm e is used fig 11 compares probability density functions of the qg leith and smagorinsky coefficients when gm and gm e are used as in fig 8 the pdfs are created by sampling at every point in each snapshot from day 200 to day 400 assembling all these values into a vector and then binning them into 60 bins which are evenly spaced in log space the simulations using gm top row show the expected decrease in ν as the resolution increases the peak of the curves or most likely value of ν is spaced further apart in log space for qg leith than for smagorinsky which is partly due to its greater scale awareness δ x 3 as opposed to δ x 2 for smagorinsky it is also clear that smagorinsky is likely to return ν which are significantly larger than qg leith which is responsible for its much weaker energy spectra in fig 5 the difference between the two schemes becomes larger as resolution increases for δ x 5 0 l d the most likely smagorinsky coefficient is about 4 times larger than that of qg leith but by δ x 0 5 l d is nearly two orders of magnitude larger in comparison with the approximately log normal bell curves for the qg leith pdfs e g pearson and fox kemper 2018 the smagorinsky pdfs tend to have an extra lobe which extends toward smaller values of ν for the qg leith simulations using gm e the log normal shapes of the pdfs are preserved but the curves are shifted roughly half an order of magnitude toward larger values of ν this shift is partly due to the extra variability at small scales and is also broadly consistent with fig 8b which shows that the enstrophy in the gm e simulations is increased if the domain averaged vorticity is increased but the size of the domain remains fixed this implies an increase in the vorticity gradients which qg leith is proportional to the smagorinsky pdfs are also shifted toward larger ν this shift is somewhat larger in the non eddying simulations where the most likely values of ν for δ x 2 5 l d and δ x 5 0 l d are nearly an order of magnitude larger than when using gm gm e also makes the smagorinsky pdfs much more normally distributed in shape though the reason for this is unclear the lower panel of fig 11 presents a table with quantitative values of ν as a function of resolution and confirms the results from the pdfs above here the median viscosity from each simulation is shown instead of the mean viscosity in order to better ignore outlier values the increased values of ν that occur due to using gm e may seem paradoxical since the purpose of the scheme is to inject energy however the increased ν is actually advantageous as it reflects the ability of these flow aware schemes to handle the extra small scale variability and kinetic energy introduced by gm e and keep the model stable it is not clear whether a fixed viscous coefficient as is used in tuned harmonic or biharmonic closures would be able to handle this variability as well or what general rules might emerge on how to appropriately tune the coefficient specifically for gm e simulations the increased ν may also be partly responsible for the increased slumping rate observed in fig 9 since ν is also used as κ g m 5 conclusion the subfield of ocean subgridscale closure development has matured to the point where emphasis is now placed on constraining prospective closures to ensure that first principles are satisfied several examples exist in the recent literature e g jansen et al 2015 bachman et al 2017b including closures that aim to overcome spurious effects introduced by other closures e g jansen and held 2014 while many of these methods show promise in idealized test cases a combination of limited computing budgets and man hours mean that proper testing evaluation and adaptation of these closures for use in realistic models occurs on long timescales if ever absent such testing it is unclear whether the new generation of constrained closures will come to supplant the older generation of successful but unconstrained closures in the near future at its core the idea pursued in this paper is not to design an entirely new closure to replace an extant one but to take an older successful closure gm and build a complement to it here qg theory has been used to develop a framework for how this might be done resulting in a combination of gm and a new parameterization for the horizontal reynolds stresses that retains all of the advantages and successes of gm but improves the realization of the large scale oceanic energy cycle the improvement is achieved by accounting for the total columnwise potential energy reduced by gm and reinjecting it into the barotropic momentum via a negative harmonic viscosity here the combined gm and reynolds stress closure framework has been labeled gm e to highlight that gm alone represents but one part of the large scale energy cycle the reynolds stress part of the gm e framework has several advantages that make it amenable to implementation its mathematical form shown in 52 is simple and in practice it can be discretized on the same numerical stencil as whatever harmonic viscosity is already present in the model the only alteration in comparison to standard harmonic viscosity is that the new closure operates only on the barotropic flow requiring an additional step to vertically average the velocities in a given column the scaling coefficient for the new closure κ q is calculated according to 54 and scales according to the local values of the vertical and horizontal buoyancy gradients the magnitude of the barotropic shear and the local gm transport coefficient the new closure can be used with any choice of gm coefficient and is energetically constrained so that it cannot inject more kinetic energy than the amount of potential energy gm removes this energetic constraint likely improves the numerical stability of the scheme despite the fact that negative viscosity is numerically unstable according to traditional analytical methods a slight modification to the denominator of κ q to ensure no division by zero along with a straightforward local smoothing of the viscous flux appendix were sufficient to keep all simulations shown here stable and visually free of noise fig 7 several measures of the resolved flow show that the gm e framework improves substantially on standard gm gm e significantly energizes the resolved motions fig 5 while maintaining well defined spectral slopes of kinetic energy all the way down to the gridscale when combined with a scale aware gm coefficient its energy injection property is also scaled back as the resolution increases and eddies become more well resolved this allows gm e to produce improved agreement with the spectra and total energy fig 6 from a high resolution truth simulation across a range of grid resolutions from non eddying simulations to those approaching eddy resolving resolution the probability density functions of flow structures such as fronts and vortices are calculated across this range of grid resolutions as well and show much more consistency with each other when gm e is used fig 8 because gm e energizes the large scale eddies and amplifies the gm coefficient when a flow aware closure such as qg leith is used it increases the rate at which isopycnals are tilted by the sum of the resolved and parameterized baroclinic instability also in better agreement with truth the mathematics employed in section 2 to motivate the gm e framework make use of the quasigeostrophic approximation because it is sufficient to illustrate the energetics of baroclinic instability and the inverse energy cascade in that sense qg is also an appropriate framework with which to develop gm e and show how it should facilitate energy transfer in a numerical model even though it is meant to be used in primitive equation models some assumptions such as that of homogeneous turbulence no eddy energy dissipation and idealized vertical boundary conditions were made for mathematical simplicity though they are unlikely to hold in realistic ocean flows despite these simplifications the form of gm e presented in this paper appears to be a promising solution to the problem of missing energy in coarsely resolved ocean models there also exist many possibilities for extending gm e to remove some of the assumptions used in this paper and treat the eddy energy in a more physical manner some ideas for which will now be discussed presently gm e is formulated assuming 100 energy throughput in the eddy energy equations i e no energy is lost to mixing or dissipation as it is transferred from the mean potential to mean kinetic energy reservoirs in reality some of the energy contained in balanced motions can be cascaded downscale and dissipated fig 2 due to processes such as loss of balance wave generation small scale shear instabilities etc given the ubiquity of these processes in realistic flows it is unlikely that all of the potential energy released through baroclinic instability will be cascaded upscale a relatively uncomplicated modification to gm e that would account for this energy loss is to multiply κ q by a nondimensional efficiency factor 0 c 1 that represents the fraction of energy transferred from gm to the reynolds stress parameterization as an example von storch et al 2012 figure 13 used time averaged output from a global ocean model and found that the total amount of energy passing between k m and k e is only about 15 of that transferred from p e to k e this ratio is slightly deceptive as the former pathway receives offsetting contributions from k m k e transfers associated with time mean winds and tropical instability waves as well as k e k m transfers concentrated in the eddy intense southern ocean however if one takes the raw number as a general guideline this would suggest a possible efficiency factor of c 0 15 which is almost an order of magnitude less than the current version of gm e where implicitly c 1 0 however it is important to keep in mind that a numerical model also requires eddy viscosity for numerical stability because the dissipative effects of eddy viscosity are strongest at the gridscale it is possible that a significant amount of the energy injected by gm e is removed immediately and requires c 0 15 for the correct amount of energy to be cascaded upscale the actual fraction of injected energy lost to eddy viscosity depends on the scheme chosen for the gm coefficient as well as the form of dissipation operator harmonic biharmonic etc and its coefficient due to these uncertainties and the arguably nonphysical nature of eddy viscosity in the upscale energy cascade it may be best to think of c as a tunable parameter rather than one informed by physics here no recommendation is given for how to choose c aside from the results for c 1 0 shown in this paper a second more complicated modification to gm e would be to use it in conjunction with an eddy energy equation such as those employed in eden and greatbatch 2008 and jansen et al 2015 the horizontal reynolds stress parameterization from gm e would be present in both the mean and eddy kinetic energy equations and would require some expression for the efficiency factor c to determine the amount of energy to move between the two kinetic energy reservoirs given appropriate expressions for other unclosed terms in the eddy kinetic energy equation such as pressure diffusion turbulent transport and eke dissipation this approach would provide a means of spatially decoupling the energy extraction and injection parts of gm e it is possible that this approach would better represent nonlocal development of baroclinic disturbances and their energetics e g simmons and hoskins 1979 orlanski and chang 1993 as well as complicated energy exchanges such as those associated with standing meanders in quasi zonal currents e g youngs et al 2017 furthermore the eddy kinetic energy equation could also be used to inform expressions for the gm coefficient which depend on the eddy energy e g eden and greatbatch 2008 marshall et al 2012 bachman and fox kemper 2013 jansen et al 2015 a recent study by manucharyan et al 2017 suggests that long lived mesoscale eddies can play a key role in setting the mean circulation in a way that gm cannot replicate by its dependence on the instantaneous ocean state an eddy energy budget may be a viable means of capturing these eddy memory effects by equipping gm with a sort of finite memory of its past states and energy content altogether this approach promises a more energetically consistent implementation of all aspects of gm e at the cost of iterating an extra equation which requires its own set of parameterizations the process of barotropization tends to shift energy to graver vertical modes and the present gm e framework assumes that this process culminates with energy being deposited in the barotropic mode itself however recent work by de la lama et al 2016 shows that the dominant mode of the eddy energy is not purely barotropic as previously supposed suggesting that the terminus of barotropization may instead be either the equivalent barotropic mode e g lacasce and isachsen 2010 or the gravest surface baroclinic mode lacasce 2017 there remains uncertainty about the applicability of these linear modal analyses to nonlinear eddy dynamics particularly in the presence of mean flows some clarification of these points will be necessary before attempting to retrofit the gm e kinetic energy injection with a more complex vertical structure but this nonetheless presents an intriguing avenue for further experimentation an interesting aside to this discussion is worth mentioning before the concluding remarks which concerns the superficially similar implementation of gm e with that of the neptune effect holloway 1996 this effect refers to the statistical dynamical tendency of eddies interacting with bathymetry to induce a stress on the mean circulation and set up a barotropic mean flow u certain skill metrics suggest neptune to be advantageous especially in generating currents near the continental margins e g eby and holloway 1994 holloway and sou 1995 holloway 1992 suggests that a way to relax the model state toward the u predicted by neptune is to alter a model s harmonic eddy viscosity to be ν u u comparing against gm e whose effective eddy forcing is κ q u the eddy forcing ν u from neptune does take a similar mathematical form in terms of energetics and flow tendencies however there is little similarity neptune is not energetically constrained and uses the model s extant eddy viscosity to effectively set the rate at which the model solution is relaxed toward u gm e is energetically tied to gm comes with its own expression for an eddy viscosity with κ q and if ν were chosen to act only on the baroclinic velocity would relax toward a barotropic flow u which is not specified a priori conceptually neptune forces the model toward a state of motion whereas gm e forces the model toward a state of minimum available potential energy while it would be interesting to see if gm e manifests any effects similar to neptune in a global model these considerations are not built into its design criteria and are beyond the scope of this paper there exist several avenues toward future work to test and improve upon the framework laid here with gm e an immediate goal is to add the reynolds stress closure to a climate scale ocean model already employing gm and test its numerical stability in more complicated flows than those used here if gm e proves to be stable and reliable its impact upon the oceanic mean circulation can be tested with special focus on prevailing issues such as eddy saturation e g straub 1993 munday et al 2013 eddy compensation e g meredith et al 2012 and low frequency variability e g yeager and robson 2017 extensions to the basic gm e framework such as those suggested above can also be tested in idealized models opportunities abound and it is the author s hope that this work constitutes an important step toward improving model fidelity in rans moles and beyond acknowledgments this material is based upon work supported by the national center for atmospheric research which is a major facility sponsored by the national science foundation under cooperative agreement no 1852977 special thanks go to ian grooms peter gent anne marie treguier and three anonymous reviewers whose insights and commentary helped to greatly improve this manuscript appendix filtering the smoothing operation described in section 3 is a typical procedure used with several extant parameterizations e g large et al 1994 to buffer against numerical instability and spurious fluxes employing such an operator means that the global energy constraint in 49 is no longer exactly satisfied since the operator changes the local correlations between the velocity velocity gradients and κ q however the parameterization will tend to continue acting as a kinetic energy source after the smoothing as long as u g locally tends to be of the same sign as u g whether these quantities are of the same sign at a given location depends on the flow the chosen smoothing operator and its stencil to see this consider a local averaging operator and the covariance between two variables ϕ and λ within the averaging region defined such that a 1 cov ϕ λ ϕ λ ϕ λ for simplicity consider only the zonal viscous flux κ q u g from the reynolds stress parameterization if the averaging operator is applied to this term the kinetic energy tendency of the flux divergence is a 2 t k m u g κ q u g a 3 u g κ q u g u g κ q u g a 4 u g κ q u g u g cov κ q u g u g κ q u g the domain integrated tendency is a 5 t v k m d v v u g cov κ q u g u g κ q u g d v where as in 46 the divergence term and baroclinic part of u g in a 4 vanish upon domain integration the remaining terms on the right side of a 5 represent the energy tendency of the smoothed parameterization because κ q 0 everywhere and thus κ q 0 everywhere as well the term on the far right is an energy source as long as u g is of the same sign as u g the covariance term is of indeterminate sign and can thus add or remove kinetic energy locally however there is no obvious correlation between κ q and the shear so that the net effect of all such terms in the domain will likely average near zero several different smoothing operators were tested for the numerical simulations in section 4 in realistic simulations irregular boundaries and bathymetry make using operators with wide stencils difficult and impractical so here consideration is restricted to operators with 5 point stencils fig a 12 shows kinetic energy spectra from the δ x 5 l d 2 5 l d l d gm e simulations using a variety of smoothing operators for the reynolds stress parameterization these simulations are identical to those from section 4 aside from using quadratic bottom drag with free slip boundary conditions instead of no slip each panel in fig a 12 contains a schematic showing how the filter weights are distributed in the stencil using the convention a 6 ϕ a ϕ i 2 b ϕ i 1 c ϕ i along with the actual values used for these weights note that the sum of all weights on the five points is always equal to one the filtering can be done separately in each horizontal direction or one can take the outer product of the 1d filter with its transpose to create a single 5 5 2d filter the unfiltered spectra appear in panel a where it is clear that the gm e scheme injects a significant amount of energy at the nyquist wavenumber a top hat filter using a 3 point stencil appears in panel b and the remaining panels contain results using discrete box and gaussian filters of differing orders sagaut and grohens 1999 the results vary significantly for the δ x 5 l d simulation in terms of magnitude and the tail of the spectra at the nyquist wavenumber however the lack of turbulence and extremely coarse resolution in this simulation means that the filtering occurs over flow structures which are essentially uncorrelated with each other the spectra from the higher resolution simulations behave much more consistently in general with the exception of a few panels f and i which still show a sharp spectral tail given the infinite number of combinations of filter weights that can be used to derive these smoothing operators there are no absolute answers about an optimal filter especially looking forward toward simulations with more complex flow and bathymetry than those used here a few general guidelines can be gleaned from these spectra however to eliminate the spectral tail one must weight the adjacent points more heavily than those two grid cells away the weighting of the adjacent points must not be negligibly small to avoid results like the unfiltered case the spectra become less sensitive to the specific choice of filter at resolutions where eddies are marginally resolved or higher although a poor choice of filter can still manifest undesirable features near the gridscale with these lessons in mind the provisional recommendation is to use the top hat filter in panel b as it produces spectra of similar magnitude at all resolutions with no spectral tail and also uses only a 3 point stencil this filter was used for all simulations in section 4 
24046,the gent and mcwilliams 1990 gm tracer transport scheme has long been a cornerstone of global scale ocean modeling and is well known for its ability to mimic the effects of baroclinic turbulence by reducing the available potential energy of resolved flows however theory predicts that baroclinic turbulence also acts to transfer this potential energy to kinetic energy which can then be fluxed toward larger scales by an inverse energy cascade these dynamical processes represent a separate branch of the large scale ocean energy cycle which gm presently does not account for in this paper a framework is developed which allows the potential energy removed by the gm scheme to be transferred to resolved motions in this framework which is labeled gm e or gm plus energetics the energy transfer occurs by employing gm alongside a parameterization of the barotropic reynolds stresses in the momentum equations which takes the form of a negative harmonic viscosity acting on the barotropic velocities the reynolds stress parameterization is considered as being complementary to gm in that its energetics are explicitly tied to those of gm while being independent of the choice of transfer coefficient or form of the gm closure a set of idealized baroclinic spindown simulations is used to compare gm e against standard gm and is shown to substantially improve the kinetic energy spectra probability distributions of flow structures and restratification rate within the front relative to an eddy resolving truth simulation keywords eddy parameterization gent mcwilliams mesoscale eddies backscatter eddy kinetic energy 1 introduction the flow of the world ocean features a variety of distinct dynamical processes which may be modulated by interactions with the atmosphere bathymetry or each other the ability to study a given process through the development of theory is often limited by how neatly it can be described within well known simplifications of the rotating navier stokes equations for ocean dynamics these equation sets and their attendant processes can broadly categorized by physical scale synoptic planetary geostrophic e g phillips 1963 meso quasigeostrophic e g charney 1948 submeso balance and turbulent thermal wind e g gent and mcwilliams 1983a b gula et al 2014 surface wave craik leibovich e g craik and leibovich 1976 internal gravity wave and turbulence 3d nonhydrostatic among others from a numerical modeling perspective this heterogeneity of ocean dynamics and the equation sets used to describe them means that no single subgridscale closure is likely to satisfactorily capture the complexity of the real ocean the development of a skillful unified eddy closure is doubtful this reality has led to a paradigm in model development wherein ocean eddy closures are routinely formulated with specific processes in mind which are then stacked on top of each other operationally while this approach has generally proven successful in practice and has led to significant leaps forward in the skill of ocean general circulation models it also has pitfalls multiple closures acting independently in a model are unlikely to represent crucial scale to scale interactions that embody the turbulent cascades and may collectively fail to improve the fidelity of coarse resolution models in relation to either observations or higher resolution truth simulations a well known example of this issue occurs in global scale ocean modeling where coarse resolution parameterized simulations have systematically less kinetic energy than high resolution eddy resolving simulations e g arbic et al 2013 kjellsson and zanna 2017 at present ocean models used in coupled climate simulations are routinely run at nominal 1 resolution which is sufficient to permit baroclinic mesoscale eddies over only a small fraction of the world ocean hallberg 2013 these eddies convert available potential energy to eddy kinetic energy and feed into a vigorous inverse cascade which transfers kinetic energy from smaller to larger scales batchelor 1953 kraichnan 1967 charney 1971 but this process is attenuated when the grid resolution is insufficient to resolve only part of the eddy field the inverse cascade is effectively an avenue by which energy accumulates at large scales so that when it and its attendant baroclinic eddies are missing from a model the result is a weak large scale flow commonly used eddy parameterizations can actually exacerbate the weakening of the large scale kinetic energy in coarse resolution models for example in many branches of computational fluid dynamics it is common practice to parameterize the reynolds stresses in the momentum equations with an eddy viscosity where for the sake of model stability it is necessary to use increased eddy viscosity at coarser resolutions e g bryan et al 1975 barham et al 2018 however large eddy viscosity can both nullify resolved baroclinic modes e g bachman and taylor 2014 and dissipate kinetic energy that would otherwise be transferred to larger scales e g arbic et al 2013 zanna et al 2017 kjellsson and zanna 2017 another commonly used mesoscale eddy parameterization the gent and mcwilliams 1990 hereafter gm scheme acts as a sign definite sink of available potential energy gent et al 1995 griffies 1998 and mimics the restratifying effect of unresolved baroclinic eddies the success of gm in dramatically reducing model drift and eliminating the need for unphysical corrections to heat and fresh water fluxes in climate scale ocean models is well documented e g danabasoglu et al 1994 hirst and mcdougall 1996 boville and gent 1998 gordon et al 2000 gent et al 2002 gent 2011 and has motivated a large body of research into improvements and variants of the scheme e g visbeck et al 1997 griffies 1998 smith and gent 2004 fox kemper et al 2008 ferrari et al 2010 marshall et al 2012 among others however because gm is intended for use in large scale ocean models featuring predominantly balanced motions the tendency of the parameterization to reduce ape also reduces the kinetic energy associated with the thermal wind as a result an undesirable side effect of gm is a further erosion of resolved kinetic energy beyond that due to eddy viscosity with no widely accepted scheme to correct this effect currently in use the missing kinetic energy in large scale ocean models has spurred a recent surge of interest in developing parameterizations to re inject this energy through various means stochastic methods have shown promise in terms of enabling direct kinetic energy injection and upgradient momentum fluxes e g frederiksen and davies 1997 berloff 2005 duan and nadiga 2007 grooms and majda 2013 kitsios et al 2013 as have investigations into modeling the turbulent eddy field using a non newtonian stress strain relation e g porta mana and zanna 2014 anstey and zanna 2017 zanna et al 2017 bachman et al 2018 the hierarchy of models comprising the navier stokes α model family holm 1999 hecht et al 2008b feature a set of turbulence closures that can be interpreted as part of the generalized lagrangian mean framework andrews and mcintyre 1978 and have been shown both theoretically holm and wingate 2005 and operationally hecht et al 2008a petersen et al 2008 to result in flows which are notably more energetic than unparameterized control cases another noteworthy approach advocates formulating a budget to account for energy that is spuriously removed by either parameterizations or numerical effects jansen et al 2015 which could then be used to scale an antidiffusive dissipation operator to compensate for the lost energy e g jansen and held 2014 however in spite of the promise shown by these different methods there remain questions about their viability in climate scale ocean modeling and for some their connection to the underlying physics of the large scale oceanic energy cycle the variety of approaches described above highlights both the possibilities and lack of consensus regarding how to ameliorate the problem of weak large scale energy in ocean models an avenue which has to this point been relatively unexplored is the idea of designing a backscatter closure to complement the existing suite of tested well understood closures commonly used in global ocean models such a closure would effectively piggyback off an existing closure to rectify missing energetics but otherwise not interfere with or replace the existing closure in any way for example the gm parameterization represents one branch of the large scale energy cycle which is the forward cascade of available potential energy e g salmon 1980 and subsequent conversion to subgridscale kinetic energy by baroclinic instability presently however the potential energy depleted by gm from the resolved flow effectively disappears from the model despite a body of theoretical e g charney 1971 smith et al 2002 observational e g scott and wang 2005 and numerical evidence e g arbic et al 2007 thompson and young 2007 arbic et al 2012 predicting that the energy released by mesoscale baroclinic instability should be returned to larger scales by an inverse energy cascade with the viewpoint that gm should thus be considered a mechanism for energy transfer rather than an energy sink one might conceive that a parameterization could be designed that is complementary to gm and whose purpose is to close the large scale energy cycle by reinjecting the energy gm extracts via backscatter no extant scheme has attempted to directly exploit the energy transfer implied by gm to inform a backscatter approach the focus of this article is to exposit the theoretical basis on which such an approach could be built formulate it mathematically and test it in a set of idealized baroclinic spindown models which use the gm parameterization in particular quasigeostrophic qg theory will be used to show that closing the large scale ocean energy cycle requires a reynolds stress parameterization in addition to gm this reynolds stress parameterization will be formulated and it will be shown that the combined reynolds stress and gm closures here labeled the gm e framework or gm plus energetics permit the potential energy extracted by gm to be returned to the resolved flow the theoretical framework for the scheme is presented in section 2 and the scheme itself is derived in section 3 results and interpretation of the numerical tests are presented in section 4 concluding remarks and possible future extensions of this idea appear in section 5 details regarding the energy equations and implementation of the new scheme appear in the appendices 2 energetics and eddy forcing of qg flow 2 1 preliminaries the role of eddy fluxes in the resolved buoyancy and momentum budgets has previously been explored from many angles including partitioning the fluxes into skew and diabatic components as in the transformed eulerian mean framework e g andrews and mcintyre 1976 1978 geometric decomposition of the eddy flux tensor e g marshall et al 2012 symmetries of flux gradient transport bachman and fox kemper 2013 and residual mean theory e g young 2012 maddison and marshall 2013 the framework proposed in this paper pays no special attention to the geometry or orientation of the eddy fluxes but does require a clear understanding of how eddies serve to transfer energy between the kinetic and potential energy reservoirs because the focus here is on energy transfer via the gm parameterization which primarily represents balanced mesoscale turbulence the qg equations will be sufficient to illustrate the motivation and mathematics behind this approach the averaged boussinesq qg equations can be written 1 d u g d t u g u g f 0 v a g β y v g x ϕ a g f x 2 d v g d t u g v g f 0 u a g β y u g y ϕ a g f y 3 d b d t u g b n 0 2 w a g b where an overbar is used to indicate an averaged mean quantity and primes indicate eddy deviations away from this average 1 1 when discussing parameterizations mean and eddy will be treated as synonymous with resolved and unresolved by the model respectively here d d t t u g where x y 0 is the horizontal gradient operator 4 u g u g v g 0 and u a g u a g v a g w a g are the geostrophic and ageostrophic velocity vectors and b is the buoyancy which is normalized by the constant part of the coriolis parameter f 0 and background buoyancy frequency n 0 2 z β is the planetary vorticity gradient ϕ a g is the ageostrophic pressure potential and f x f y b represent additional forcing in the momentum and buoyancy equations the corresponding eddy equations to 1 3 can be obtained by subtracting the averaged equations from the unaveraged set here the focus will only be on the energetics in order to motivate the parameterization further on it will be sufficient to think of the total energy as being divided into two types kinetic k and potential p each of which can be subdivided into their mean subscript m and eddy subscript e parts the four possible energies are defined as 5 k m 1 2 u g 2 v g 2 p m 1 2 b 2 n 0 2 6 k e 1 2 u g 2 v g 2 p e 1 2 b 2 n 0 2 the averaged kinetic and potential energy equations can be derived by taking the dot product of 1 and 2 with u g and multiplying 3 with b n 0 2 respectively the eddy energy equations can be obtained in a similar way by multiplying the eddy equations by the eddy primitive variables followed by averaging the internal energy will not factor into this discussion as it is decoupled from the other energy types under the qg approximation the full governing equation for each type of energy consists of terms which transport energy spatially terms which transfer energy from one reservoir to another and terms which act as sources or sinks a proper treatment of the energetics would require prognostic equations for the eddy energies along with associated parameterizations for each of their transport and forcing terms and promising approaches in large scale ocean modeling have been developed in this way e g eden and greatbatch 2008 jansen et al 2015 mak et al 2017 however because the emphasis of this paper is merely to establish a framework by which gm transfers resolved potential energy to kinetic energy simplifications will be made to streamline the forthcoming discussion and mathematics namely terms which supply dissipation mixing or external forcing will be dropped from the ensuing discussion with the proviso that they can be added in future extensions of this framework for a more complete treatment the energy coupling of the qg system will now be analyzed using the simplified energy equations subject to zero flux boundary conditions and the assumption of no sources or sinks of energy by the divergence theorem all of the transport terms drop out upon domain integration leaving only the transfer terms the domain averaged energy equations are then 7 t v k m d v v w a g b t u g d v 8 t v k e d v v t u g w a g b d v 9 t v p e d v v w a g b u g b b n 0 2 d v 10 t v p m d v v u g b b n 0 2 w a g b d v where 11 t u g u g u g v g 0 u g v g v g v g 0 0 0 0 and u g x u g y u g z u g x v g y v g z v g 0 0 0 are the geostrophic reynolds stress and velocity gradient tensors respectively and the double contraction operator takes two second order tensors as arguments and returns a scalar 12 λ γ λ i j γ i j it will henceforth be assumed that the turbulence is homogeneous and isotropic in the qg stretched coordinate system e g hua and haidvogel 1986 the assumption of homogeneous turbulence is controversial e g lesieur et al 2005 but allows local values of the eddy fluxes to be substituted for domain averaged values nonetheless it is common practice in turbulence closure development to make the assumption of homogeneity and is the basis for many prevalent closures in both the les literature e g smagorinsky 1963 germano et al 1991 smagorinsky 1993 and ocean modeling e g fox kemper and menemenlis 2008 bachman et al 2017a note that because it is the turbulence that is assumed to be homogeneous and not the mean flow diffusivity coefficients and gradients of mean quantities are allowed to be spatially variable here the homogeneous turbulence assumption will permit dropping the domain averaging operators in 7 10 it will also be assumed that w b 0 though this is immaterial to the parameterization and is made here for brevity the energy equations which result from these assumptions are 13 t k m t u g 14 t k e t u g w a g b 15 t p e w a g b u g b b n 0 2 16 t p m u g b b n 0 2 from these equations it is clearly seen how the energetics of the system are coupled each mean energy equation shares one term with its eddy counterpart which is of the opposite sign and the mean energies are coupled through the eddy field this implies that a gain in one energy type is compensated by an equivalent loss in another energy type so that for an inviscid flow the total energy is conserved 2 2 implications for modeling 2 2 1 into the eddy permitting regime here the energy equations will be examined to illustrate the energy transfer of baroclinic turbulence in qg flow and to further a discussion about how this transfer should be realized in numerical models baroclinic turbulence grows by converting available potential energy to eddy kinetic energy which in reality occurs across a range of scales near the baroclinic deformation radius e g salmon 1980 fu and flierl 1980 hua and haidvogel 1986 scott and arbic 2007 in a model this conversion is naturally partitioned into resolved and subgridscale components by the resolution of the model grid in reynolds averaged navier stokes rans models it is assumed that nearly all of the baroclinic conversion occurs at the subgridscale as of the writing of this paper this type of model remains prevalent for coupled climate simulations due to the computational expense of running at higher resolution in eddy permitting models dubbed mesoscale ocean large eddy simulations or moles in recent literature fox kemper and menemenlis 2008 a non negligible portion of the total conversion is assumed to occur at both resolved and subgrid scales the turbulence closure techniques appropriate for moles are notably different than for rans and demand additional considerations such as scale and flow awareness e g fox kemper and menemenlis 2008 bachman et al 2017a pearson et al 2017 as well as giving rise to conceptual issues like double counting e g henning and vallis 2004 delworth et al 2012 fig 1 presents a visual representation of this effect from the baroclinic spindown simulations presented further on in this paper the surface vertical relative vorticity field associated with a baroclinically unstable front is shown at different times during the transition from linear growth to turbulence the model resolution for these plots is chosen as a small multiple of the initial first internal deformation radius and demonstrates an eddy resolving simulation top layer of each time slice an eddy permitting simulation middle layer and weakly eddying simulation bottom layer fronts filaments and vortices are clearly visible in the eddy resolving simulation and are concomitant with a vigorous upscale energy cascade these structures are also clear in the eddy permitting simulation though the fronts are less sharp and the resulting vorticity field is of weaker amplitude the structures are nearly indistinguishable in the weakly eddying simulation the resolved dynamics still manifest the tendency of baroclinic eddies to slump over the front but the eddy field and associated frontal gradients are notably weakened relative to the higher resolution simulations likewise the inverse cascade in this simulation is restricted to a very narrow range of wavenumbers resulting in very little energy being deposited at large scales the distinction between rans and moles is needed because it affects both the correct approach to the closure problem as well as the implied energetics for example if one takes the mean and resolved flows to be synonymous then the assumption w b 0 made in the previous section means that there is no potential to kinetic energy conversion by the resolved flow this is an acceptable assumption for a rans model but obviously not so for moles furthermore to substitute local values for domain averaged values in moles requires an assumption of homogeneous turbulence for both the resolved and subgrid fields which is clearly not the case in all but the most idealized models to continue using the assumptions of the previous section and avoid these conceptual differences between rans and moles it will be understood that henceforth t k m and t p m will refer only to the part of the resolved energy tendencies associated with the parameterizations which allows w b 0 in these derivations with no ambiguity furthermore this means that all of the potential energy released by baroclinic turbulence through gm can be considered to be converted to subgridscale kinetic energy and that the subsequent transfer of this energy into larger scale resolved motions is truly via a backscatter type of process 2 2 2 comparison of energy pathways theory vs model fig 2 presents a schematic of how energy transfer at the oceanic mesoscale is predicted to occur in theory versus how it is realized in a model and motivates why the energy released by gm should be rerouted by the parameterization proposed in this paper fig 2a diagrams the theoretical view in which the available potential energy released by baroclinic instability is returned primarily to balanced motions unbalanced processes molemaker et al 2005 mcwilliams 2008 molemaker et al 2010 e g wave generation e g vanneste 2013 shakespeare and taylor 2016 shakespeare and hogg 2017 and smaller scale instabilities e g taylor and ferrari 2009 thomas and taylor 2010 stamper and taylor 2017 provide a route through which some of the balanced energy is cascaded downscale and dissipated most of the balanced energy is returned to larger scales through the inverse energy cascade and barotropization where it can be removed by bottom drag or transferred into rossby wave generation e g rhines 1975 sukoriansky et al 2007 tulloch et al 2009 the characteristic length scale which nominally separates the balanced and unbalanced motions is the baroclinic deformation radius l d a similar energy cycle manifests in numerical models fig 2b but the crucial length scale is the model grid spacing δ x rather than the deformation radius energy released by resolved baroclinic instability is able to follow a similar upscale pathway as in the theoretical case aside from that removed by eddy viscosity presently however gm siphons off some of the released energy into unresolved motions where it implicitly follows the red arrow to the left toward dissipative scales the effect of the reynolds stress parameterization proposed here is represented by the black symbols which is to remove cross out the downscale energy pathway and instead return the gm energy to resolved motions large curved arrow naturally the arguments made using this schematic assume δ x and l d are of similar scale as in a rans model as model resolution is increased as in moles and gm is tapered off e g hallberg 2013 bachman et al 2017a the vertical dashed line in panel b effectively moves to the left and less energy must be returned upscale in order to mimic panel a there is also an upper limit to the grid resolution where this schematic is expected to be accurate for systems such as the one envisioned here where the subgridscale flow is governed by baroclinic quasigeostrophic dynamics and the resolved flow is primarily barotropic quasigeostrophic the reynolds stresses are expected to play a leading order role in the momentum budgets grooms et al 2012 however if the grid resolution is coarsened to the point where turbulence is absent and the resolved flow is planetary geostrophic the reynolds stresses cease to be asymptotically important grooms et al 2011 and the parameterization framework developed here becomes invalid 2 2 3 the role of parameterizations gm and the missing piece eqs 13 16 will now be used to mathematically formalize the energy pathways depicted in fig 2 and to show the role that the parameterizations play in this system consider a scenario where the baroclinic turbulence has saturated so that t k e t p e 0 using the same assumptions preceding 13 16 the implied energy balance is 17 u g b b n 0 2 t u g 18 t p m t k m using gm to parameterize the lateral eddy buoyancy fluxes and writing it in buoyancy diffusivity form e g vallis 2017 u g b κ g m b the resolved energy tendencies are 19 t p m u g b b n 0 2 κ g m b 2 n 0 2 20 t k m t u g κ g m b 2 n 0 2 for positive values of κ g m the effect of gm as a sign definite sink of resolved potential energy is made clear by 19 this result has long been appreciated in previous literature e g gent et al 1995 griffies 1998 and is widely recognized as the main mechanism by which the parameterization mimics baroclinic turbulence perhaps less well known is the relation 20 which is made possible through analysis of the energy equations this relation states that in this simplistic energetic framework all of the potential energy released by gm should be manifested as resolved kinetic energy furthermore 20 hints at a recipe for making this so i e via a parameterization of the lateral reynolds stresses to be clear 19 and 20 specify how the energetics in a large scale model might be realized not the form of the parameterizations that must be used gm represents one half of the equation and exists as a means to reduce resolved potential energy the missing half a parameterization for the reynolds stresses must return this energy in kinetic form via the resolved motions this as yet undefined parameterization does not arise from mimicking the restratifying effects of baroclinic turbulence but by mimicking the energy transfer effects of the turbulence in conjunction with the inverse energy cascade together with gm it thus aspires to provide a more complete treatment of the phenomenology of mesoscale eddies than gm acting alone 3 a parameterization for qg reynolds stresses here a parameterization for the lateral reynolds stresses will be developed with the goal that it is energetically linked to gm such that the relation 20 is satisfied before beginning it is useful to list the required characteristics of the parameterization the parameterization must add kinetic energy to the resolved flow in particular to mimic barotropization this energy must be added only to barotropic motions the parameterization must be energetically constrained i e the amount of energy it adds cannot be unbounded satisfaction of the above properties cannot require a particular choice of the gm transport coefficient κ g m the last point alludes to the multitude of expressions for κ g m that have appeared in ocean modeling literature e g visbeck et al 1997 cessi 2008 fox kemper et al 2008 eden and greatbatch 2008 marshall et al 2012 bachman and fox kemper 2013 jansen et al 2015 bachman et al 2017a each of which has a different rationale for its scaling as well as exhibiting different levels of skill in practice e g bachman et al 2017c despite a lack of consensus over which choice for κ g m is optimal the fundamental property of the gm closure that it reduces resolved potential energy does not depend on the choice of coefficient for the reynolds stress parameterization to be linked energetically to gm it should thus not depend on the choice of coefficient either to be clear however the skill of the combined gm and reynolds stress parameterizations hereafter referred to as gm e or gm plus energetics should still be expected to depend on the expression for κ g m the other characteristics in the above list will be added to the obvious requirements that the parameterization be numerically stable and improve key measures of the resolved flow which will be discussed further in the context of the test simulations in section 4 the derivation begins by employing the form of the qg momentum equations presented in cronin 1996 and takes advantage of the relationship in residual mean theory between the divergence of the eliassen palm flux tensor and the eddy qgpv flux eliassen and palm 1961 andrews and mcintyre 1976 the use of residual mean theory introduces a correction to the ageostrophic velocity which in the case of cronin 1996 is 21 u a g u a g z u g b n 0 2 such that the residual mean momentum equations are 22 d u g d t f 0 k ˆ u a g k ˆ β y u g ϕ a g k ˆ u g q all of the eddy forcing in this equation set is encapsulated as the cross product of the vertical unit vector with the eddy qgpv flux 23 k ˆ u g q x u g u g y u g v g z f 0 n 0 2 v g b x u g v g y v g v g z f 0 n 0 2 u g b transformed eulerian mean tem theory andrews and mcintyre 1976 mcdougall and mcintosh 2001 can be used to write the buoyancy flux terms in 23 in terms of a streamfunction treguier et al 1997 24 ψ u g b n 0 2 subject to zero flux boundary conditions at the free surface and bottom here the vertical boundaries will be idealized to that of a rigid surface located at z 0 over a flat bottomed basin of depth z h and a linear modal decomposition e g lacasce 2012 pedlosky 2013 will be assumed wherein qg buoyancy anomalies are not allowed at the boundaries 2 2 bathymetry is known to exert a strong influence on the oceanic barotropic flow e g koblinsky 1990 gille 2003 and the desire for a more realistic treatment of buoyancy and qgpv anomalies at the boundary has motivated an extensive body of literature e g surface quasigeostrophy blumen 1978 held et al 1995 the simplified vertical boundaries used here are purely for mathematical convenience so as to arrive at the reynolds stress parameterization with minimal diversion a more realistic treatment of many such outstanding issues such as dissipation variable bathymetry local effects etc is a top priority for future extensions of this framework substituting 24 into 23 allows the eddy forcing to be rewritten as 25 k ˆ u g q div t f 0 k ˆ z ψ so that averaging 25 in the vertical from the bottom to the surface boundary 26 1 h h 0 k ˆ u g q d z 1 h h 0 div t d z two important consequences of this vertical averaging can now be noted first the right hand side of 26 represents the barotropic reynolds stress divergence which is the targeted quantity to be parameterized the form of the reynolds stress parameterization thus will be specified by deriving an expression for the barotropic eddy qgpv flux on the left second applying the vertical averaging to all of the terms in the momentum equations 22 removes both the buoyancy flux terms in the eddy forcing as well as the correction to the ageostrophic velocity in 21 so that in the barotropic sense 22 is energetically identical to the standard momentum equations 1 2 because the framework presented in this manuscript primarily emphasizes energetics it is thus warranted to proceed using the residual mean equations as the basis for this derivation assume a flux gradient closure for the eddy qgpv flux of the form u h q κ q q where κ q is the qgpv eddy diffusivity if the vertically averaged lateral qgpv gradient is nonzero one can also define a second diffusivity 27 κ q h 0 κ q q d z h 0 q d z which can be substituted into 26 to obtain 28 1 h h 0 k ˆ u g q d z 1 h h 0 k ˆ κ q q d z 29 κ q k ˆ 1 h h 0 q d z because the vertical boundaries are flat the horizontal gradient operator can be moved outside the integral so that 30 κ q k ˆ 1 h h 0 q d z κ q k ˆ 1 h h 0 q d z recalling that the mean qgpv is 31 q x v g y u g f z f 0 n 0 2 b taking the vertical integral of q gives 32 κ q k ˆ 1 h h 0 q d z κ q k ˆ q 33 κ q h 0 x y v g y y u g x x v g x y u g d z 34 κ q x y v g y y u g x x v g x y u g 35 κ q x x u g y y u g x x v g y y v g 36 κ q 2 u g where capital letters have been used to denote the vertical averages of q u g and v g and the final step makes the substitution u x v y by the continuity equation in the integration step the vortex stretching term has been removed since no buoyancy anomalies are permitted at the vertical boundaries and the planetary vorticity term involving f β j ˆ has been removed to satisfy global momentum conservation bretherton 1966 3 3 the presence of β in downgradient qgpv closures has been a longstanding point of contention in ocean modeling with studies arguing both for its significance e g treguier et al 1997 wardle and marshall 2000 ringler and gent 2011 and insignificance e g bachman et al 2017a regardless its presence violates global angular momentum conservation bretherton 1966 and has motivated approaches to avoid this dilemma by permitting negative diffusivities e g marshall et al 2012 or removing it via a rotational gauge e g eden 2010 given the lingering uncertainty over this term the choice here is to prioritize global momentum conservation and to achieve this via the latter method substituting 36 back into 26 the parameterization for the vertically averaged reynolds stresses becomes 37 1 h h 0 div t d z κ q 2 u g to return to a vertically local value of the reynolds stress divergence one can define 38 div t 1 h h 0 div t d z div d where the baroclinic reynolds stress divergences are represented by the tensor d the advantages of making this substitution will become clear in the following subsections where the energetics of the parameterization are discussed using 24 and 38 the momentum equations 22 can now be written 39 d u g d t f 0 k ˆ u a g k ˆ β y u g ϕ a g k ˆ u g q 40 ϕ a g div t f 0 k ˆ z ψ 41 ϕ a g κ q 2 u g barotropic reynolds stress parameterization div d f 0 k ˆ z ψ the term with square brackets will be the candidate reynolds stress parameterization proposed to complement gm both of which have been identified in 41 using underbraces the buoyancy flux term on the far right will henceforth be ignored and the focus will be on details of the square bracketed term in particular it will be shown that the bulleted requirements at the beginning of this section are all satisfied by this term with this being the case the baroclinic reynolds stress divergence term div d has no role in satisfying the energetic constraints desired of the candidate parameterization it is not part of the gm e framework and thus will not be included in further discussion however it is worth noting that a standard harmonic viscous closure with coefficient ν 42 d ν u g would be a reasonable parameterization for this term since this kind of closure is often employed for numerical stability it is not clear whether the gradients in 42 should act on the full velocities or only their baroclinic parts these issues are tangential to the main thread and will not be considered further though it is noted that the simulations in section 4 use the closure 42 with the full velocities 3 1 energetics of the parameterization one of the main requirements for the proposed reynolds stress parameterization is that it transfers energy into the resolved barotropic flow which requires a closer look at the mean kinetic energy equation the domain averaged kinetic energy tendency due to the parameterization can be derived by taking the dot product of 41 with u g focusing only on the term with the underbrace this is 43 t v k m d v v κ q 2 u g u g d v v κ q u g u x x u y y v g v x x u y y d v here it will be shown that the each term on the right side of 43 will only change the domain integrated barotropic energy to see that this is the case consider for example the u g y y u g term splitting the geostrophic velocity into barotropic and baroclinic parts such that 44 u g u g u g one can write this term as 45 u g y y u g u g u g y y u g 46 y u g u g y u g y u g y u g y u g 2 the term in the square brackets vanishes upon horizontal integration for both no slip u g n ˆ 0 and free slip u g n ˆ 0 boundary conditions where n ˆ is the unit normal to the boundary the second term involves the product of the baroclinic and barotropic lateral shear and vanishes upon vertical integration by noting that 47 h 0 y u g y u g d z y u g y h 0 u g d z 0 the sole remaining term on the far right of 46 represents a sign definite source or sink of barotropic energy depending on the sign of κ q this procedure can be repeated for the other terms on the right side of 43 in each case only one sign definite source or sink term is left after domain averaging and after summing all these terms the kinetic energy tendency of the parameterization is 48 t v k m d v v κ q x u g 2 x v g 2 y u g 2 y v g 2 the energy tendency in 48 is reminiscent of an isotropic harmonic viscosity with coefficient κ q except that it acts only on the barotropic velocities it is clear upon inspecting 48 that for the parameterization to add kinetic energy and satisfy the first bulleted point from the previous section requires κ q 0 in fact an expression for κ q which satisfies this requirement can be derived by returning to the energy tendencies in 19 and 20 which state that the energy gained through the reynolds stress parameterization must equal that which is lost due to gm substituting 48 for the right side of 18 and substituting 19 for the left side the resulting kinetic energy relation is 49 v κ g m b 2 n 0 2 v κ q x u g 2 x v g 2 y u g 2 y v g 2 again assuming homogeneous turbulence to replace the domain averages with local values the resultant expression for κ q is 50 κ q κ g m b 2 n 0 2 x u g 2 x v g 2 y u g 2 y v g 2 if κ g m is positive the right side of 50 consists entirely of terms which are 0 so that κ q 0 this expression for κ q thus satisfies the central requirements for the proposed parameterization in that it is guaranteed to add kinetic energy to the resolved barotropic flow as long as κ q is nonzero and it adds exactly as much energy as gm extracts furthermore while the value of κ q scales linearly with whatever value is used for κ g m it does not depend on the particular choice of κ g m 3 2 a simplification and summary of the gm e scheme in terms of energetics the reynolds stress parameterization acts as a negative viscosity acting on the barotropic flow whose magnitude is set by the local values of κ g m the stratification and the lateral shear however in its original form 43 the parameterization contains terms that affect the local transport of momentum but do not change the domain integrated kinetic energy furthermore the second derivative terms in this expression are not written as the divergence of a flux increasing the likelihood of introducing noise and potentially numerical instability upon implementation from that perspective it is justified to write an alternative flux form version of the parameterization 51 d u g d t f 0 k ˆ u a g k ˆ β y u g ϕ a g κ q u g barotropic reynolds stress parameterization which is identical energetically but far more amenable to numerical implementation as it can easily be slotted into extant subroutines for harmonic viscosity note that here the standard qg momentum equations are written in 51 instead of the residual mean form the expression for κ q is unbounded as written in 50 but the total injection of kinetic energy remains bounded by the constraint in 49 for example consider a region where b is large and the stratification and shear are weak the value of κ q here will be large but the weak shear means that the strong negative viscosity will be acting on small gradients of velocity and the overall energy injected will remain equal to that removed by gm while the existence of upgradient momentum fluxes has long been recognized in oceanic and atmospheric flows e g starr 1968 dritschel and mcintyre 2008 berloff et al 2009 large negative viscosity is worrisome from a numerical perspective and indeed a negative viscosity of any kind is unstable according to traditional analysis however previous studies examining the viability of negative viscosity e g jansen and held 2014 or upgradient flux parameterizations e g zanna et al 2017 in ocean models have suggested these methods may be feasible despite violating the traditional stability criteria the simulations described in section 4 proved surprisingly stable despite the negative viscosity effect and upon detailed examination of failed simulations two modifications were determined to be sufficient to keep the simulations stable for all cases tested here a small parameter ϵ can be added to the denominator of 50 to prevent division by zero in practice setting ϵ close to machine precision is all that is needed a smoothing operation on the viscous fluxes which will be denoted by angle brackets which helps to more evenly distribute injected kinetic energy and prevents pile up of energy at the gridscale in practice the smoothed terms are computed as a weighted average of nearby neighbors several different choices of smoothing operator were tested for the numerical experiments in section 4 and are described in detail in appendix for now the full gm e framework with the above modifications can be summarized by writing it in the qg primitive equations which are 52 d u g d t f 0 k ˆ u a g k ˆ β y u g ϕ a g κ q u g barotropic reynolds stress parameterization 53 d b d t w a g n 0 2 κ g m b gm buoyancy diffusion 54 κ q κ g m b 2 n 0 2 x u g 2 x v g 2 y u g 2 y v g 2 ϵ here the reader is reminded that in 52 54 the overbar simply indicates that the variable is resolved by the model grid and capital letters indicate vertically averaged variables the reynolds stress part of the closure is filtered using the operator and the denominator of the expression for κ q contains a small constant ϵ to prevent division by zero 4 simulations 4 1 model setup the massachusetts institute of technology general circulation model mitgcm marshall et al 1997 is used to solve the hydrostatic boussinesq equations and test the gm e framework the basic flow configuration used for these tests is that of a zonally reentrant channel on an f plane with a temperature front oriented in the cross channel direction that extends from the free surface to the bottom boundary to simulate qg dynamics with interesting vortex stretching both the initial horizontal and vertical buoyancy gradients b y m 2 and b z n 0 2 are made to vary with depth the configuration is identical to that used in bachman et al 2017a with the balanced richardson number r i b n 0 2 f 0 2 m 4 50 at all depths f 0 7 29 1 0 5 s 1 and the total depth h 300 m n 2 and m 2 vary between 2 0 1 0 8 s 2 and 4 5 1 0 9 s 2 at the bottom respectively and 1 0 1 0 7 s 2 and 1 0 1 0 8 s 2 at the top the constant ϵ appearing in 54 is set to 1 0 1 0 15 the initial conditions are the same across all simulations the first internal deformation radius of the initial state is l d 511 8 m this and the total depth are small for typical ocean mesoscale values and fall into more submesoscale values however as argued in bachman et al 2017a the dimensionless parameters of the flow are appropriate for the mesoscale regime and quasigeostrophic dynamics are applicable in all simulations in these simulations all viscous boundary conditions are no slip and the velocity fields are initialized in geostrophic balance to minimize ageostrophic waves the initial stratification is independent of the along front direction all simulations use a third order upwinding scheme for the tracer equations which ensures stability and dissipation of tracers according to numerical not physical specifications the gm parameterization uses a simple vertical tapering large et al 1997 to ensure that there is no buoyancy flux through the vertical boundaries the standard buoyancy diffusion form of gm is used in these simulations the reynolds stress part of the gm e framework uses a top hat smoothing filter which is described in detail in appendix soon after initialization the front undergoes slumping by baroclinic instability this process is more efficient at higher resolution because the model grid is better able to resolve the full range of unstable modes and the weaker eddy viscosity at higher resolution is less able to damp out these modes the conversion of available potential energy to kinetic energy serves both to energize the resolved flow in the form of eddies as well as to tilt the mean isopycnals toward the horizontal output from the model is gathered every two days during this frontal spindown the energy spectra take on a well defined slope by day 100 which persists until the simulations are terminated at day 400 the statistics gathered for the figures in this section are taken by averaging the output between day 200 and the end of the simulation the testing suite consists of five simulations differing in grid resolution δ x a truth simulation is run with δ x 0 1 l d which is sufficiently fine to resolve a vigorous field of baroclinic eddies and manifest a well defined spectral slope of kinetic energy this simulation is run without either the gm or gm e parameterization and uses qg leith eddy viscosity bachman et al 2017a for numerical stability the other simulations in the suite are run at progressively lower resolution with δ x 0 5 l d l d 2 5 l d 5 l d where each coarsening of the grid results in less well resolved eddies a weaker inverse energy cascade more diffuse frontal structures and progressively less energy in the resolved flow a visual depiction of these effects was shown in fig 1 for comparison using the deformation radii of the real ocean at 30 latitude chelton et al 1998 smith 2007 these model resolutions would be roughly equivalent to those of a global model run at 1 2 5 truth 1 5 1 2 1 and 2 resolutions 4 2 effects on kinetic energy a single run without either gm or gm e was completed at each resolution to serve as a reference point that the parameterized runs can be compared against and to demonstrate the effect of grid resolution on the flow statistics the kinetic energy spectra from each of these cases is shown in fig 3 as anticipated the three highest resolution simulations with δ x 0 1 l d 0 5 l d l d have well defined spectral slopes these slopes approximately follow the k m k 3 slope dashed line predicted for the inertial range of a forward potential enstrophy cascade e g smith et al 2002 down to about 4 km wavelengths then steepen to approximately k m k 4 dotted line the k m k 4 slope is not predicted by standard qg theory and is similar to slopes found in the global models of kjellsson and zanna 2017 it is possible that this steepening is due to the inertial range being cut off near the 4 km scale by the eddy viscosity for example see fig 10 overall the spectral slopes of the δ x 0 5 l d purple line and δ x l d yellow line simulations agree closely with the δ x 0 1 l d truth simulation green line albeit with slightly less energy overall the effect of lower resolution begins to show up strongly in the δ x 2 5 l d red line and δ x 5 l d blue line simulations with around one and two orders of magnitude less energy at the largest scales respectively at higher wavenumbers the δ x 2 5 l d simulation exhibits a very short range where the spectral slope steepens while the δ x 5 l d simulation shows no steepening or evidence of a turbulent cascade at all the simulations using gm and gm e are run at the same five resolutions listed above attempting to test these parameterizations using every possible combination of gm coefficient e g visbeck et al 1997 cessi 2008 fox kemper et al 2008 eden and greatbatch 2008 marshall et al 2012 bachman and fox kemper 2013 jansen et al 2015 bachman et al 2017a and viscous closure such as the nine presented in bachman et al 2017a among others would be prohibitively expensive and time consuming to demonstrate the key points in this paper only two such choices the qg leith bachman et al 2017a pearson et al 2017 and smagorinsky smagorinsky 1963 1993 closures are sufficient the qg leith closure is chosen because it is optimally scaled for qg flows is scale aware and recommends using the same value for viscosity as the gm coefficient ν κ g m for these reasons qg leith greatly simplifies parameter space and is an ideal candidate for these tests from a physical perspective the smagorinsky closure is also scale aware but is inappropriately scaled for qg flows it is included here specifically to compare against qg leith and show that scale awareness is not enough to rectify weak energy at low resolution i e an energy injecting closure such as gm e is necessary including smagorinsky will also demonstrate that gm e improves on gm even when the coefficients are scaled poorly like qg leith it is used both to set the harmonic viscosity and the gm coefficient a summary of the control reference and gm gm e experiments is shown in fig 4 kinetic energy spectra from the model runs with gm and gm e are shown in fig 5 the top row shows the spectra using gm with qg leith panel a and smagorinsky panel b as was shown in bachman et al 2017a the qg leith scheme is skillful at cleanly truncating the energy spectra at the gridscale in eddy permitting δ x 0 1 l d 0 5 l d l d simulations with very little deviation away from the spectral slope that emerges at lower wavenumbers in terms of magnitude the spectra are very similar to those from the control cases where neither gm or gm e is used fig 3 this is not entirely surprising since qg leith tends to predict very small coefficients so that the combined effect from viscosity and gm will likewise be small this stands in stark contrast to the effects of the smagorinsky scheme which greatly decreases the kinetic energy at all wavenumbers the effect of smagorinsky in qg scaled flows is excessively dissipative bachman et al 2017a figure 6 because it predicts very large coefficients the plots shown in fig 5b show even less energy than those in bachman et al 2017a however which occurs because here the smagorinsky coefficient is also being used as the gm coefficient because this coefficient is large gm aggressively drains available potential energy from the front if the flow remains approximately in thermal wind balance this also has the effect of removing kinetic energy from the geostrophic shear resulting in greatly depressed kinetic energy spectra as seen in fig 5b the bottom row of fig 5 shows the results of using the gm e framework with each choice of gm coefficient both panels clearly show an increase in energy at all scales though scale awareness of both qg leith and smagorinsky reduces the energy adding effect of gm e in the higher resolution simulations for qg leith panel c the energization is most pronounced for the lowest resolution simulations the eddy permitting simulations with δ x 0 1 l d 0 5 l d show very little effect in comparison to standard gm aside from a small bump in the energy near the gridscale of the δ x 0 5 l d run at smaller wavenumbers gm e increases the energy of the low resolution simulations almost to match those of the high resolution simulations the δ x 2 5 l d simulation red line also appears to have a slightly wider range where the spectrum is red the non eddying simulation with δ x 5 0 l d is strongly energized by gm e though there is a clear overshoot in the energy at the domain scale however in non eddying simulations the reynolds stresses are expected to be asymptotically unimportant grooms et al 2011 and the skill of a moles closure such as qg leith is dubious e g bachman et al 2017a meaning that the skill of gm e in this simulation is doubtful on both physical and numerical grounds regardless the effective gridscale of this simulation is coarser than that used in modern coupled climate scale gcms so the behavior of the δ x 5 0 l d run may not be relevant in practice the effect of using gm e with the smagorinsky closure panel d is to energize the motion at all scales as expected though the overall skill remains poor compared to qg leith this demonstrates the necessity of choosing appropriate coefficients for the eddy viscosity and gm in conjunction with the gm e framework while the scale awareness of smagorinsky is helpful in this regard i e the coefficients are reduced at higher resolution so that none of the simulations are more energetic than truth the poor scaling of smagorinsky in qg flows still overwhelms the positive effect of gm e the kinetic energy content in these simulations can also be analyzed in a way that separates the contributions of the baroclinic and barotropic flow fig 6 shows a bar chart of the fraction of total kinetic energy yellow bars that is contained within the barotropic red bars and baroclinic blue bars motions in this figure the overall energy content is normalized against the energy in the δ x 0 1 l d truth simulation so that the total energy from this simulation is set to one in the simulations without gm panel a most of the energy is contained in the barotropic flow with a clear dropoff in the barotropic energy as the gridscale is coarsened this general trend also is true for the gm cases though the dropoff is less severe for the qg leith model panel b than the smagorinsky model panel c when gm e is used with qg leith panel d the amount of energy at each resolution tends to be closer to truth than when gm alone is used the energy increase is most pronounced in the δ x 2 5 l d and δ x 5 0 l d simulations where the overall energy content is increased by over a factor of ten most importantly the amount of barotropic energy in each simulation is closer to truth than in the gm case which is a direct result of energy being injected only into the barotropic motions interestingly among all of the gm and gm e qg leith models the baroclinic energy content remains fairly consistent which may be indicative of qg leith s ability to tune the gm coefficient as a function of resolution the kinetic energy in the smagorinsky model with gm e is increased across all resolutions consistent with fig 5 though the total content remains significantly less than truth 4 3 effects on flow structures the injection of energy in the gm e framework is through the barotropic momentum and this added momentum can be expected to affect the subsequent flow evolution at a given point in space the energy injection depends on the local properties of the velocity gradients buoyancy gradients and κ g m raising questions about whether this contaminates the domain with noise surface snapshots of the kinetic energy at day 300 are shown in fig 7 to visually illustrate the effects of gm e these snapshots are taken from the δ x 2 5 l d δ x l d and δ x 0 5 l d simulations and clearly show the emergence of frontal structures as the resolution is increased the additional energy injected by gm e bottom row in comparison to gm top row is most evident in the δ x 2 5 l d simulations panels a and d where there is a notable energization in the center of the domain energization in the higher resolution simulations is not evident visually although the spectra in fig 5 confirm that it occurs there is a slight suggestion that additional small scale structures are present in the δ x l d and δ x 0 5 l d gm e simulations but no obvious presence of gridscale noise or other artificial effects on the flow to check the effects of gm e on other emergent flow structures in the domain such as fronts jets and the distribution of energy and enstrophy z m defined below probability density functions pdfs are made across all of the qg leith simulations fig 8 the pdfs are created by sampling the desired quantity k m z m u or b at every point in each model output snapshot from day 200 to day 400 assembling all these values into a vector and then binning them into 60 bins which are evenly spaced in log space a pdf is made for each of these quantities at each resolution except for the δ x 0 1 l d truth simulation which was computationally too expensive however given the close convergence of the δ x 0 5 l d to truth the pdfs from these two simulations are likely to be nearly identical fig 8a shows pdfs of kinetic energy at each resolution from both the gm top and gm e bottom simulations for the gm simulations the pdfs are shifted left toward smaller values for the coarser resolution models which is consistent with the weaker overall kinetic energy in these models shown in figs 3 and 6 the pdfs from the δ x 2 5 l d and δ x 5 0 l d simulations red and blue lines respectively show that there is almost no likelihood of having a point whose kinetic energy is even as strong as the most likely kinetic energy value from the higher resolution models in the gm e simulations the lower resolution pdfs are shifted to the right so that all lie nearly on top of each other meaning that even in the lower resolution models the pointwise values of kinetic energy are likely to be similar to those from the higher resolution models the same general story holds for quantities which are dependent on first derivatives of velocity such as the enstrophy z m x v y u 2 panel b and velocity gradient magnitude u x u 2 y u 2 x v 2 y v 2 panel c for each of these quantities gm e shifts the pdfs to the right in comparison with gm implying stronger vortices and velocity fronts are resolved due to gm e the values of these variables from the δ x 5 0 l d simulation remain skewed to the left of the other simulations partly because the strength of the gradients is limited by the grid spacing and stronger numerical diffusion and also because of the absence of baroclinic eddies at this resolution interestingly there is little difference in the gm and gm e pdfs in terms of the buoyancy gradient magnitude b panel d this is likely because the horizontal buoyancy gradient is related to the baroclinic velocity through thermal wind while the momentum injected by gm e is through the barotropic velocity only a complete analysis of the effects of gm e on flow structures would be incomplete without discussion of its effects on eddy mean flow interaction it is well established that eddy dynamics strongly affect the strength structure and stability of larger scale features such as jets gyres and boundary currents e g thompson 1978 hogg 1985 howden 2000 watts et al 2001 waterman et al 2011 on both sub annual e g bishop 2013 and inter annual e g spall 1996 timescales these interactions are known to be especially prevalent in western boundary currents e g waterman and jayne 2011 waterman and hoskins 2013 which is where the energy exchanges from gm e are likely to be strongest the effects of injecting energy into boundary currents is very likely to imprint on the ocean heat transport atmospheric storm tracks and other climatologically relevant dynamics it is difficult to speculate about the effects of gm e on these dynamics partly due to their intrinsic complexity and partly due to the present simplicity of the framework for example there are likely aspects of the geometry of eddy mean feedbacks e g waterman and lilly 2015 tamarin et al 2016 which cannot be captured by an isotropic injection of energy the simple channel geometry of the simulations used here does not permit these types of flow structures to develop and therefore precludes a proper analysis this is left to future work testing gm e in global ocean configurations 4 4 effects on frontal slumping more unstable baroclinic modes are resolved as grid resolution is increased meaning that the slumping and restratification process associated with baroclinic eddies occurs more quickly at higher resolution gm assists this process by increasing the slumping rate beyond that which the resolved modes can manage alone the inverse energy cascade should also increase the slumping rate as well by adding energy to the largest most powerful eddies thereby making them more efficient at restratifying the flow one might expect that gm e would also increase the restratification rate due to its added energy as well fig 9 shows a time series of isopycnal slope for simulations using qg leith as expected the isopycnal slopes decrease over time as the front spins down with the decrease occurring more quickly as resolution increases the resolution threshold between non eddying and eddying models is also apparent in this figure in that the δ x 2 5 l d and δ x 5 0 l d simulations experience effectively no net slumping due to the absence of baroclinic eddies even though gm is enabled in the simulations used for this plot the effects from using qg leith as the gm coefficient are minimal compare for example figs 3 and 5a so gm provides little extra restratifying capability here the effects of small eddies which are only resolvable at high resolution can also be seen by comparing the δ x l d dashed yellow line and δ x 0 5 l d dashed purple line simulations even though fig 5a shows that the largest eddies in these simulations are similarly energetic the slumping in the δ x 0 5 l d simulation occurs much more quickly beginning around day 200 using gm e solid lines has little positive effect on the non eddying simulations the isopycnals in the δ x 5 0 l d simulation are heaved upward around day 200 which is slowly corrected past day 300 the slope at the end of the simulation is similar to that from the gm only case the heaving is likely spurious and not associated with any physical mechanism even with gm e this simulation does not resolve baroclinic eddies so it is likely that the scheme is introducing noise that is deforming the isopycnals in some locations the δ x 2 5 l d simulation shows almost no effect on the slumping rate from using gm e instead of just gm there is no slope heaving in this simulation but there is also very little speed up in the restratification rate the effects of gm e become much more pronounced once eddies become permitted both the δ x l d and δ x 0 5 l d simulations show a noticeable increase in the slumping rate if this rate is estimated as 55 slumping rate slope t end slope t 0 duration of simulation the slumping rate is abut 50 faster for δ x l d and 20 faster for δ x 0 5 l d interestingly gm e causes the slumping to begin much sooner in the δ x 0 5 l d simulation solid purple line than any of the others though it is unclear why this is so overall the increase in slumping rate due to gm e makes the slope at day 400 in both the eddy permitting simulations closer to that of the truth simulation green line overall the increase in restratification rate due to gm e is consistent with what would be expected due to an inverse energy cascade however the time series plotted here are from a transient simulation with a single front spinning down it is unclear how this faster restratification would affect the time mean slope and dynamics of climatically relevant fronts such as the polar front or those of western boundary currents these are relevant concerns for long duration climate simulations and will require testing in more complicated models than the idealized channels used here but is beyond the scope of this work 4 5 effects on resolved energy transfer a central concern for eddy permitting modeling is the degree to which turbulence closures interfere with resolved dynamics the most well known issue is that of double counting e g henning and vallis 2004 where parameterized eddies out compete resolved eddies for energy which has inspired a variety of approaches ranging from moles style closures e g fox kemper and menemenlis 2008 bachman et al 2017a to resolution functions e g hallberg 2013 to simply turning the closures off at high resolution e g mcclean et al 2011 delworth et al 2012 bryan et al 2014 a less understood question is how parameterizations affect the resolved turbulent cascades themselves in terms of scale to scale transfer to investigate this question spectral energy fluxes from the model can be analyzed to see how each term in the kinetic energy budget acts to move energy up or downscale following kjellsson and zanna 2017 these fluxes are calculated by performing a fourier transform in the along channel direction which for the zonal velocity is written 56 u k l z t 1 2 π 2 u x y z t e i k x l y d x d y here k and l are the zonal and meridional wavenumbers defining the complex conjugate of u as u the resolved kinetic energy in spectral space is k m 0 5 u u v v after averaging over the meridional and vertical directions denoted here by an overbar the kinetic energy spectral flux is computed as the cumulative integral of k m over all zonal wavenumbers 57 k m k k k m d k and whose budget is 58 t k m π n π p π v π f π d π e 59 π n k u u u v u v d k 60 π p k ρ 0 1 u x p ρ 0 1 v y p d k 61 π v k u ν u v ν v d k 62 π f k w b d k 63 π d k u c d u b o t v c d v b o t d k 64 π e k u κ q u v κ q v d k in these expressions u b o t is the horizontal velocity in the cell adjacent to the bathymetry the quadratic bottom drag coefficient c d 0 002 u b o t u b o t p is the thermodynamic pressure and ρ 0 is the reference density π e is the transfer term associated with the gm e parameterization as in kjellsson and zanna 2017 a term similar to π v can be derived for the vertical dissipation but will be ignored here as it is negligibly small not shown note that the unapproximated kinetic energy equation is used in 58 rather than the qg version in section 2 as is appropriate for a primitive equation model such as mitgcm here the difference between transfers in the gm and gm e simulations will be highlighted fig 10a shows spectral energy fluxes from the δ x l d simulations where negative values of the nonlinear transfer term π n correspond to energy transfer to larger scales consistent with an inverse energy cascade in the models the nonlinear transfer pink line is negligibly small keeping in mind that the vertical axis is in logarithmic scale for wavelengths less than approximately 4 km or roughly 8 l d this is broadly consistent with the results of kjellsson and zanna 2017 who found that nonlinear transfer became significant at wavelengths several times larger than the deformation radius and peaked at scales a few times larger still the peaking behavior in their model is partly due to latitudinal variation of the coriolis parameter as their results are extracted from a realistic global model unlike their simulations the models here are run on an f plane so that the relevant upper limit to the eddy scale and upscale transfer is set by the channel width vertical dashed line the behavior of π n is very similar between the gm and gm e simulations suggesting that the gm e does not interfere significantly with upscale transfer once turbulence becomes established the largest difference between gm and gm e occurs in the terms associated with the conversion of potential energy to kinetic energy π p light blue line and π f red line at scales less than 4 km in the gm e simulation the vertical buoyancy flux term π f changes sign twice with small negative values just above the gridscale indicating kinetic energy reduction it is likely that this effect is nonphysical and due to noise generated by gm e at larger scales the shape and magnitude of π f are very similar between the two simulations see panel b and discussion below the pressure gradient term π p is of similar magnitude and opposite sign as π n and also switches sign near the 4 km scale the switch occurs at slightly larger wavenumber in the gm e simulation but this is likely insignificant the viscous dissipation green line and bottom drag yellow line terms are sign definite sinks of kinetic energy so that their spectral fluxes are negative at all wavenumbers conversely the gm e energy source dark blue line is positive at all wavenumbers the bottom drag and gm e terms represent the dominant balance in the kinetic energy budget which is expected given that energy cascaded upscale is barotropized and envisioned to be lost either to rossby wave generation e g rhines 1975 sukoriansky et al 2007 tulloch et al 2009 but which is not possible in these simulations due to no background pv gradient or bottom drag the magnitude of all of the energy flux terms in fig 10a covers a wide range in logarithmic space and makes detailed comparison of their behavior between the gm and gm e simulations difficult however because the behavior of each term is similar in both simulations it is informative to plot the ratio of each term in gm e with its counterpart in gm to see how it is strengthened or weakened by the inclusion of the reynolds stress parameterization in gm e fig 10b shows these ratios as a function of wavenumber with an inset highlighting the ratios at large scales some of the ratios below the 4 km scale are noisy due to different behavior between the two simulations but above this scale the ratios tend to behave more consistently with scale as seen in the inset the pressure and viscous fluxes are around twice as strong in the gm e simulation as there is more kinetic energy present to be both transported and dissipated the flux due to bottom drag is around 30 stronger in this simulation as well the vertical buoyancy flux is essentially unchanged while the nonlinear flux is reduced by an average of 12 this would suggest that at scales much larger than δ x the resolved eddies are able to convert potential to kinetic energy with the same efficiency in both simulations but the transfer between scales is reduced slightly despite there being more energy at any given wavenumber it is unclear how these effects would play out in a global climate simulation on long timescales but this type of investigation requires much more sophisticated models than are used in this work and is left for future study 4 6 effects on scale aware viscosity the gm e framework injects energy locally and the resolved turbulence organizes this energy in space such that the kinetic energy spectra have a well defined slope fig 5 however even using the smoothing operation introduced in section 3 and detailed in appendix the local energy injection can introduce a significant amount of variability at the gridscale flow aware viscous schemes which adjust the viscous coefficient ν based on key measures of resolved flow features are sensitive to this kind of variability and are thus likely to be affected by the use of gm e the qg leith and smagorinsky schemes used in this work are two such flow aware schemes so it is useful to investigate how their behavior changes when gm e is used fig 11 compares probability density functions of the qg leith and smagorinsky coefficients when gm and gm e are used as in fig 8 the pdfs are created by sampling at every point in each snapshot from day 200 to day 400 assembling all these values into a vector and then binning them into 60 bins which are evenly spaced in log space the simulations using gm top row show the expected decrease in ν as the resolution increases the peak of the curves or most likely value of ν is spaced further apart in log space for qg leith than for smagorinsky which is partly due to its greater scale awareness δ x 3 as opposed to δ x 2 for smagorinsky it is also clear that smagorinsky is likely to return ν which are significantly larger than qg leith which is responsible for its much weaker energy spectra in fig 5 the difference between the two schemes becomes larger as resolution increases for δ x 5 0 l d the most likely smagorinsky coefficient is about 4 times larger than that of qg leith but by δ x 0 5 l d is nearly two orders of magnitude larger in comparison with the approximately log normal bell curves for the qg leith pdfs e g pearson and fox kemper 2018 the smagorinsky pdfs tend to have an extra lobe which extends toward smaller values of ν for the qg leith simulations using gm e the log normal shapes of the pdfs are preserved but the curves are shifted roughly half an order of magnitude toward larger values of ν this shift is partly due to the extra variability at small scales and is also broadly consistent with fig 8b which shows that the enstrophy in the gm e simulations is increased if the domain averaged vorticity is increased but the size of the domain remains fixed this implies an increase in the vorticity gradients which qg leith is proportional to the smagorinsky pdfs are also shifted toward larger ν this shift is somewhat larger in the non eddying simulations where the most likely values of ν for δ x 2 5 l d and δ x 5 0 l d are nearly an order of magnitude larger than when using gm gm e also makes the smagorinsky pdfs much more normally distributed in shape though the reason for this is unclear the lower panel of fig 11 presents a table with quantitative values of ν as a function of resolution and confirms the results from the pdfs above here the median viscosity from each simulation is shown instead of the mean viscosity in order to better ignore outlier values the increased values of ν that occur due to using gm e may seem paradoxical since the purpose of the scheme is to inject energy however the increased ν is actually advantageous as it reflects the ability of these flow aware schemes to handle the extra small scale variability and kinetic energy introduced by gm e and keep the model stable it is not clear whether a fixed viscous coefficient as is used in tuned harmonic or biharmonic closures would be able to handle this variability as well or what general rules might emerge on how to appropriately tune the coefficient specifically for gm e simulations the increased ν may also be partly responsible for the increased slumping rate observed in fig 9 since ν is also used as κ g m 5 conclusion the subfield of ocean subgridscale closure development has matured to the point where emphasis is now placed on constraining prospective closures to ensure that first principles are satisfied several examples exist in the recent literature e g jansen et al 2015 bachman et al 2017b including closures that aim to overcome spurious effects introduced by other closures e g jansen and held 2014 while many of these methods show promise in idealized test cases a combination of limited computing budgets and man hours mean that proper testing evaluation and adaptation of these closures for use in realistic models occurs on long timescales if ever absent such testing it is unclear whether the new generation of constrained closures will come to supplant the older generation of successful but unconstrained closures in the near future at its core the idea pursued in this paper is not to design an entirely new closure to replace an extant one but to take an older successful closure gm and build a complement to it here qg theory has been used to develop a framework for how this might be done resulting in a combination of gm and a new parameterization for the horizontal reynolds stresses that retains all of the advantages and successes of gm but improves the realization of the large scale oceanic energy cycle the improvement is achieved by accounting for the total columnwise potential energy reduced by gm and reinjecting it into the barotropic momentum via a negative harmonic viscosity here the combined gm and reynolds stress closure framework has been labeled gm e to highlight that gm alone represents but one part of the large scale energy cycle the reynolds stress part of the gm e framework has several advantages that make it amenable to implementation its mathematical form shown in 52 is simple and in practice it can be discretized on the same numerical stencil as whatever harmonic viscosity is already present in the model the only alteration in comparison to standard harmonic viscosity is that the new closure operates only on the barotropic flow requiring an additional step to vertically average the velocities in a given column the scaling coefficient for the new closure κ q is calculated according to 54 and scales according to the local values of the vertical and horizontal buoyancy gradients the magnitude of the barotropic shear and the local gm transport coefficient the new closure can be used with any choice of gm coefficient and is energetically constrained so that it cannot inject more kinetic energy than the amount of potential energy gm removes this energetic constraint likely improves the numerical stability of the scheme despite the fact that negative viscosity is numerically unstable according to traditional analytical methods a slight modification to the denominator of κ q to ensure no division by zero along with a straightforward local smoothing of the viscous flux appendix were sufficient to keep all simulations shown here stable and visually free of noise fig 7 several measures of the resolved flow show that the gm e framework improves substantially on standard gm gm e significantly energizes the resolved motions fig 5 while maintaining well defined spectral slopes of kinetic energy all the way down to the gridscale when combined with a scale aware gm coefficient its energy injection property is also scaled back as the resolution increases and eddies become more well resolved this allows gm e to produce improved agreement with the spectra and total energy fig 6 from a high resolution truth simulation across a range of grid resolutions from non eddying simulations to those approaching eddy resolving resolution the probability density functions of flow structures such as fronts and vortices are calculated across this range of grid resolutions as well and show much more consistency with each other when gm e is used fig 8 because gm e energizes the large scale eddies and amplifies the gm coefficient when a flow aware closure such as qg leith is used it increases the rate at which isopycnals are tilted by the sum of the resolved and parameterized baroclinic instability also in better agreement with truth the mathematics employed in section 2 to motivate the gm e framework make use of the quasigeostrophic approximation because it is sufficient to illustrate the energetics of baroclinic instability and the inverse energy cascade in that sense qg is also an appropriate framework with which to develop gm e and show how it should facilitate energy transfer in a numerical model even though it is meant to be used in primitive equation models some assumptions such as that of homogeneous turbulence no eddy energy dissipation and idealized vertical boundary conditions were made for mathematical simplicity though they are unlikely to hold in realistic ocean flows despite these simplifications the form of gm e presented in this paper appears to be a promising solution to the problem of missing energy in coarsely resolved ocean models there also exist many possibilities for extending gm e to remove some of the assumptions used in this paper and treat the eddy energy in a more physical manner some ideas for which will now be discussed presently gm e is formulated assuming 100 energy throughput in the eddy energy equations i e no energy is lost to mixing or dissipation as it is transferred from the mean potential to mean kinetic energy reservoirs in reality some of the energy contained in balanced motions can be cascaded downscale and dissipated fig 2 due to processes such as loss of balance wave generation small scale shear instabilities etc given the ubiquity of these processes in realistic flows it is unlikely that all of the potential energy released through baroclinic instability will be cascaded upscale a relatively uncomplicated modification to gm e that would account for this energy loss is to multiply κ q by a nondimensional efficiency factor 0 c 1 that represents the fraction of energy transferred from gm to the reynolds stress parameterization as an example von storch et al 2012 figure 13 used time averaged output from a global ocean model and found that the total amount of energy passing between k m and k e is only about 15 of that transferred from p e to k e this ratio is slightly deceptive as the former pathway receives offsetting contributions from k m k e transfers associated with time mean winds and tropical instability waves as well as k e k m transfers concentrated in the eddy intense southern ocean however if one takes the raw number as a general guideline this would suggest a possible efficiency factor of c 0 15 which is almost an order of magnitude less than the current version of gm e where implicitly c 1 0 however it is important to keep in mind that a numerical model also requires eddy viscosity for numerical stability because the dissipative effects of eddy viscosity are strongest at the gridscale it is possible that a significant amount of the energy injected by gm e is removed immediately and requires c 0 15 for the correct amount of energy to be cascaded upscale the actual fraction of injected energy lost to eddy viscosity depends on the scheme chosen for the gm coefficient as well as the form of dissipation operator harmonic biharmonic etc and its coefficient due to these uncertainties and the arguably nonphysical nature of eddy viscosity in the upscale energy cascade it may be best to think of c as a tunable parameter rather than one informed by physics here no recommendation is given for how to choose c aside from the results for c 1 0 shown in this paper a second more complicated modification to gm e would be to use it in conjunction with an eddy energy equation such as those employed in eden and greatbatch 2008 and jansen et al 2015 the horizontal reynolds stress parameterization from gm e would be present in both the mean and eddy kinetic energy equations and would require some expression for the efficiency factor c to determine the amount of energy to move between the two kinetic energy reservoirs given appropriate expressions for other unclosed terms in the eddy kinetic energy equation such as pressure diffusion turbulent transport and eke dissipation this approach would provide a means of spatially decoupling the energy extraction and injection parts of gm e it is possible that this approach would better represent nonlocal development of baroclinic disturbances and their energetics e g simmons and hoskins 1979 orlanski and chang 1993 as well as complicated energy exchanges such as those associated with standing meanders in quasi zonal currents e g youngs et al 2017 furthermore the eddy kinetic energy equation could also be used to inform expressions for the gm coefficient which depend on the eddy energy e g eden and greatbatch 2008 marshall et al 2012 bachman and fox kemper 2013 jansen et al 2015 a recent study by manucharyan et al 2017 suggests that long lived mesoscale eddies can play a key role in setting the mean circulation in a way that gm cannot replicate by its dependence on the instantaneous ocean state an eddy energy budget may be a viable means of capturing these eddy memory effects by equipping gm with a sort of finite memory of its past states and energy content altogether this approach promises a more energetically consistent implementation of all aspects of gm e at the cost of iterating an extra equation which requires its own set of parameterizations the process of barotropization tends to shift energy to graver vertical modes and the present gm e framework assumes that this process culminates with energy being deposited in the barotropic mode itself however recent work by de la lama et al 2016 shows that the dominant mode of the eddy energy is not purely barotropic as previously supposed suggesting that the terminus of barotropization may instead be either the equivalent barotropic mode e g lacasce and isachsen 2010 or the gravest surface baroclinic mode lacasce 2017 there remains uncertainty about the applicability of these linear modal analyses to nonlinear eddy dynamics particularly in the presence of mean flows some clarification of these points will be necessary before attempting to retrofit the gm e kinetic energy injection with a more complex vertical structure but this nonetheless presents an intriguing avenue for further experimentation an interesting aside to this discussion is worth mentioning before the concluding remarks which concerns the superficially similar implementation of gm e with that of the neptune effect holloway 1996 this effect refers to the statistical dynamical tendency of eddies interacting with bathymetry to induce a stress on the mean circulation and set up a barotropic mean flow u certain skill metrics suggest neptune to be advantageous especially in generating currents near the continental margins e g eby and holloway 1994 holloway and sou 1995 holloway 1992 suggests that a way to relax the model state toward the u predicted by neptune is to alter a model s harmonic eddy viscosity to be ν u u comparing against gm e whose effective eddy forcing is κ q u the eddy forcing ν u from neptune does take a similar mathematical form in terms of energetics and flow tendencies however there is little similarity neptune is not energetically constrained and uses the model s extant eddy viscosity to effectively set the rate at which the model solution is relaxed toward u gm e is energetically tied to gm comes with its own expression for an eddy viscosity with κ q and if ν were chosen to act only on the baroclinic velocity would relax toward a barotropic flow u which is not specified a priori conceptually neptune forces the model toward a state of motion whereas gm e forces the model toward a state of minimum available potential energy while it would be interesting to see if gm e manifests any effects similar to neptune in a global model these considerations are not built into its design criteria and are beyond the scope of this paper there exist several avenues toward future work to test and improve upon the framework laid here with gm e an immediate goal is to add the reynolds stress closure to a climate scale ocean model already employing gm and test its numerical stability in more complicated flows than those used here if gm e proves to be stable and reliable its impact upon the oceanic mean circulation can be tested with special focus on prevailing issues such as eddy saturation e g straub 1993 munday et al 2013 eddy compensation e g meredith et al 2012 and low frequency variability e g yeager and robson 2017 extensions to the basic gm e framework such as those suggested above can also be tested in idealized models opportunities abound and it is the author s hope that this work constitutes an important step toward improving model fidelity in rans moles and beyond acknowledgments this material is based upon work supported by the national center for atmospheric research which is a major facility sponsored by the national science foundation under cooperative agreement no 1852977 special thanks go to ian grooms peter gent anne marie treguier and three anonymous reviewers whose insights and commentary helped to greatly improve this manuscript appendix filtering the smoothing operation described in section 3 is a typical procedure used with several extant parameterizations e g large et al 1994 to buffer against numerical instability and spurious fluxes employing such an operator means that the global energy constraint in 49 is no longer exactly satisfied since the operator changes the local correlations between the velocity velocity gradients and κ q however the parameterization will tend to continue acting as a kinetic energy source after the smoothing as long as u g locally tends to be of the same sign as u g whether these quantities are of the same sign at a given location depends on the flow the chosen smoothing operator and its stencil to see this consider a local averaging operator and the covariance between two variables ϕ and λ within the averaging region defined such that a 1 cov ϕ λ ϕ λ ϕ λ for simplicity consider only the zonal viscous flux κ q u g from the reynolds stress parameterization if the averaging operator is applied to this term the kinetic energy tendency of the flux divergence is a 2 t k m u g κ q u g a 3 u g κ q u g u g κ q u g a 4 u g κ q u g u g cov κ q u g u g κ q u g the domain integrated tendency is a 5 t v k m d v v u g cov κ q u g u g κ q u g d v where as in 46 the divergence term and baroclinic part of u g in a 4 vanish upon domain integration the remaining terms on the right side of a 5 represent the energy tendency of the smoothed parameterization because κ q 0 everywhere and thus κ q 0 everywhere as well the term on the far right is an energy source as long as u g is of the same sign as u g the covariance term is of indeterminate sign and can thus add or remove kinetic energy locally however there is no obvious correlation between κ q and the shear so that the net effect of all such terms in the domain will likely average near zero several different smoothing operators were tested for the numerical simulations in section 4 in realistic simulations irregular boundaries and bathymetry make using operators with wide stencils difficult and impractical so here consideration is restricted to operators with 5 point stencils fig a 12 shows kinetic energy spectra from the δ x 5 l d 2 5 l d l d gm e simulations using a variety of smoothing operators for the reynolds stress parameterization these simulations are identical to those from section 4 aside from using quadratic bottom drag with free slip boundary conditions instead of no slip each panel in fig a 12 contains a schematic showing how the filter weights are distributed in the stencil using the convention a 6 ϕ a ϕ i 2 b ϕ i 1 c ϕ i along with the actual values used for these weights note that the sum of all weights on the five points is always equal to one the filtering can be done separately in each horizontal direction or one can take the outer product of the 1d filter with its transpose to create a single 5 5 2d filter the unfiltered spectra appear in panel a where it is clear that the gm e scheme injects a significant amount of energy at the nyquist wavenumber a top hat filter using a 3 point stencil appears in panel b and the remaining panels contain results using discrete box and gaussian filters of differing orders sagaut and grohens 1999 the results vary significantly for the δ x 5 l d simulation in terms of magnitude and the tail of the spectra at the nyquist wavenumber however the lack of turbulence and extremely coarse resolution in this simulation means that the filtering occurs over flow structures which are essentially uncorrelated with each other the spectra from the higher resolution simulations behave much more consistently in general with the exception of a few panels f and i which still show a sharp spectral tail given the infinite number of combinations of filter weights that can be used to derive these smoothing operators there are no absolute answers about an optimal filter especially looking forward toward simulations with more complex flow and bathymetry than those used here a few general guidelines can be gleaned from these spectra however to eliminate the spectral tail one must weight the adjacent points more heavily than those two grid cells away the weighting of the adjacent points must not be negligibly small to avoid results like the unfiltered case the spectra become less sensitive to the specific choice of filter at resolutions where eddies are marginally resolved or higher although a poor choice of filter can still manifest undesirable features near the gridscale with these lessons in mind the provisional recommendation is to use the top hat filter in panel b as it produces spectra of similar magnitude at all resolutions with no spectral tail and also uses only a 3 point stencil this filter was used for all simulations in section 4 
24047,lagrangian particle model for vertical mixing transport and surfacing of buoyant particles in the water column tor nordam a b ruben kristiansen b raymond nepstad a johannes röhrs c a sintef ocean trondheim norway sintef ocean trondheim norway b norwegian university of science and technology trondheim norway norwegian university of science and technology trondheim norway c norwegian meteorological institute oslo norway norwegian meteorological institute oslo norway corresponding author lagrangian particle models are used for many applications in the ocean sciences including transport modelling of oil spills fish eggs and larvae plastics and sediment particles in the context of oil spill modelling there are numerous papers discussing entrainment of surface oil by breaking waves however for the opposite process i e droplets reaching the surface and joining the surface slick we have found no discussion in the literature of the exact steps involved given the wide use of particle based models in oil spill modelling it is important to establish a consistent recipe for treating the surface boundary we investigate a lagrangian particle model for the vertical transport surfacing and resuspension of buoyant material in the water column by modifying the behaviour at the surface boundary the model can be applied to materials such as oil droplets that form a surface slick and hence see the surface as an absorbing boundary and to particles that do not form a surface slick such as fish eggs and microplastics for slick forming materials we also consider resuspension from the surface slick e g entrainment of surface oil by breaking waves while we restrict our attention to positively buoyant materials the model is equally applicable to the settling of negatively buoyant particles such as sediment grains and marine snow we consider three case studies each designed to allow a detailed and direct comparison of the lagrangian model to an eulerian model based on numerical solution of the advection diffusion reaction equation we demonstrate that the two models give the same results when the boundary at the surface is treated correctly keywords oil spills fish eggs microplastics vertical mixing random walk 1 introduction lagrangian transport models are commonly used in many areas of ocean related science including the modelling of oil spills garcía martínez and flores tovar 1999 reed et al french mccay 2009 mariano et al 2011 de dominicis et al 2013 dagestad et al 2018 microplastics ballent et al 2013 ichtyoplankton thygesen and ådlandsvik 2007 fox et al 2009 castano primo et al 2014 fish eggs röhrs et al 2014 and mineral particles gräwe and wolff 2010 the relative simplicity of the core lagrangian particle scheme makes it attractive for numerical applications however there are several subtle points which must be carefully addressed in oceanic applications brickman and smith 2002 ross and sharples 2004 van sebille et al 2018 for example common to all of these applications is that the models must correctly treat the boundaries at the sea surface and the seabed furthermore in the case of spatially variable diffusion which is usually the case in the ocean care must be taken to avoid numerical artefacts that result from a naïve formulation of random walk hunter et al 1993 visser 1997 in the field of numerical oil spill modelling it has long been recognised that the vertical distribution of oil is of paramount importance this includes both the vertical distribution of submerged oil and the distinction between surface oil and submerged droplets one of the earliest works treating an oil spill as a three dimensional process is that of elliott 1986 elliott described the elongation of an oil slick in the direction of the wind attributing the effect to vertical current shear and also formulated a three dimensional random walk based particle model while that model allowed sufficiently large oil droplets to remain at the surface as their rise due to buoyancy would always dominate over the random displacement due to diffusion it did not include a slick formation process or a separate surface state since elliott 1986 much has been written about natural entrainment i e the process where surface oil is submerged as droplets due to dissipation of surface gravity waves several different models have been developed for both the rate of entrainment and the resulting droplet size distribution see e g delvigne and sweeney 1988 johansen et al 2015 and li et al 2017 however less has been said about the opposite process i e oil droplets reaching the surface due to buoyancy and merging with a surface slick reviews of the field such as spaulding 1988 asce 1996 reed et al 1999 and spaulding 2017 all discuss entrainment of surface oil and vertical transport and mixing of droplets but contain no details of the surfacing process in the context of eulerian models surfacing is discussed by e g tkalich and chan 2002 but to the best of our knowledge a complete description of the steps involved in calculating surfacing in a particle based oil spill model has not been published in the current paper we provide a direct comparison between the lagrangian particle scheme and an eulerian model based on the advection diffusion reaction adr equation focusing particularly on the treatment of the surface to this end we provide a detailed description of a lagrangian particle model for the vertical mixing transport and surfacing of oil droplets in the water column as well as the vertical mixing and transport of non slick forming particles such as fish eggs and microplastics for the case of oil droplets we also include resuspension from the surface slick into the water column which can for example be caused by breaking waves we then formulate an equivalent eulerian model based on the adr equation with appropriate boundary conditions while we consider positively buoyant material throughout this paper the formulated models and the results are equally applicable to settling and optionally resuspension of negatively buoyant particles we consider three case studies which are designed to allow a direct comparison of the lagrangian and eulerian schemes for each case we provide details of all the steps involved in the lagrangian particle model and a complete description of an equivalent eulerian scheme with specific boundary conditions we then demonstrate that we obtain the same results with the two models the layout of the paper is as follows in the following section section 2 we describe the system to be studied i e buoyant material in the water column and how this material may or may not form a continuous slick at the surface and how a continuous slick may be resuspended as droplets due to breaking waves we then formulate two models for this system a lagrangian model based on particles subjected to buoyant rise random walk and resuspension and an eulerian model based on the adr equation in section 3 we consider three different case studies and present the results of simulating all three cases with both models section 4 contains a discussion of the way we have chosen to treat the boundary both for the lagrangian and eulerian schemes finally in section 5 we provide some concluding remarks the appendices expand on some of the technical details of solving the adr equation numerically and on the choice of numerical parameters for the particle model 2 models for buoyant material in the water column we consider a system where some buoyant material e g microplastics fish eggs or oil droplets is dispersed in the water column we will only consider transport in the vertical direction treating the water column as a one dimensional system and we consider positively buoyant particles rising at their terminal velocity the main source of vertical mixing in the ocean is turbulent diffusion which is orders of magnitude greater than molecular diffusion tennekes and lumley 1972 vertical turbulent diffusion is usually described by an eddy diffusivity profile here denoted as k z which gives the diffusivity as a function of depth eddy diffusivity profiles can for example be obtained from ocean models e g roms 1 1 myroms org from specialised turbulence models e g gotm 2 2 gotm net or from simpler analytical expressions seeking to capture some important features for a given scenario see e g large et al 1994 depending on the type of material the surface may or may not be seen as a partially absorbing boundary materials that do not form surface slicks such as fish eggs and microplastics may reach the surface through buoyancy and later be resuspended due to turbulent eddies in the water hence we may formulate the following rules which when repeatedly applied describe the motion of non slick forming buoyant particles in a turbulent water column particles are randomly displaced due to turbulent motion of the water being caused by the motion of the water this random displacement treats the surface as a reflecting boundary particles rise due to buoyancy when particles reach the surface due to buoyancy they can rise no further thus treating the surface as a barrier the rationale for treating the boundary as reflecting in diffusion is that turbulent diffusion is caused by eddies in the water and being formed by water these eddies are necessarily unable to carry material out of the water in the case of oil droplets a continuous slick may be formed at the surface and as a droplet rises to the surface and merges with the slick it is effectively removed from the water column for an oil slick to be broken up into droplets and resuspended a high energy event such as a breaking wave is required a set of rules describing the motion of slick forming buoyant particles is droplets are randomly displaced due to turbulent motion of the water being caused by the motion of the water this random displacement treats the surface as a reflecting boundary droplets rise due to buoyancy when droplets reach the surface due to buoyancy they become part of the surface slick thus treating the surface as an absorbing boundary once part of the surface slick droplets may be resuspended due to breaking waves at some rate which is related to the wave state droplets resuspended due to waves are distributed into the upper part of the water column and may in general be assigned a new size in the process again the rationale for the reflecting boundary in the diffusion step is that material carried by the motion of the water cannot leave the water furthermore if the surface was absorbing in diffusion increasing the diffusivity could lead to arbitrarily fast surfacing which is contrary to what is observed in reality in what follows we will formulate an eulerian and a lagrangian model for the behaviour described above common to both models is that they operate in discrete time and that we consider a fixed timestep δ t where 1 t n t 0 n δ t and where t 0 is the time at the start of the simulation 2 1 lagrangian model in a lagrangian particle model an ensemble of a large number n p of particles is used to describe the effects of advection and diffusion at each timestep each particle undergoes a random displacement due to diffusion and a directed displacement due to buoyancy the step length in the random displacement is calculated from the diffusivity profile k z for the random walk formulation to be consistent it must obey the rule that an initially well mixed passive i e neutrally buoyant tracer must remain well mixed regardless of the diffusivity profile this is known as the well mixed condition and was first formulated by thomson 1987 as has been pointed out by several authors see e g hunter et al 1993 holloway 1994 visser 1997 and van sebille et al 2018 a naïve formulation of the random walk will cause an unphysical net transport away from areas of high diffusivity and thus will not obey the well mixed condition additionally care must be taken near the boundaries of the computational domain as the shape and properties of the diffusivity function here can impact the accuracy of the results ross and sharples 2004 we will return to this last point in greater detail in sections 3 and 4 we implement a random walk algorithm known as the visser scheme visser 1997 gräwe 2011 where a particle which at time t n is at a depth z n at a time t n 1 t n δ t will be at a new position z n 1 z n ξ z n where the displacement ξ z n is given by 2 ξ z n k z n δ t r 2 r δ t k z n k z n δ t 2 where k z n d k d z z n δ t is the timestep of the model and r is a random process with mean r 0 and variance r 2 r throughout this paper we have taken r to be uniformly distributed random numbers between 1 and 1 in which case r 1 3 the visser scheme will obey the aforementioned well mixed condition provided the timestep is sufficiently short the requirement is essentially that the diffusivity profile is well approximated by a linear function over the step length of the random walk visser 1997 this is satisfied if 3 δ t min 1 k z where k z d 2 k d z 2 and the minimum is taken over the entire water column according to gräwe et al 2012 it is generally agreed that the timestep should be kept at least an order of magnitude below the limit given by eq 3 the rise due to buoyancy is simply implemented as a constant upwards displacement equal to v b δ t at each timestep we take depth to be positive downwards this is because particles are considered to rise at their terminal velocity for small particles with small rise velocities this is a good approximation as the terminal velocity is reached very fast compared to other relevant processes as previously discussed what happens when a particle reaches the surface depends on the particular type of material considered in the context of an oil spill simulation a droplet that surfaces is assumed to be absorbed into a continuous surface slick of oil and will not be mixed back down into the water column by the eddy diffusivity alone hence an oil droplet that has surfaced is temporarily removed from the water column for a non slick forming particle such as a piece of microplastic the situation may be different and the eddy diffusivity may be sufficient to move the particle back down into the water column particles that have surfaced and been absorbed into a surface slick may however be resuspended due to breaking waves as would be the case for oil droplets we have chosen to include this in the model for slick forming materials 3 3 note that breaking waves will of course also influence the behaviour of non slick forming particles such as fish eggs however we have chosen to include this effect for slick forming particles only as it is far more important in this case as can be seen by comparing the steady state results of the three case studies in section 3 by optionally submerging a constant fraction of the surface slick at each timestep this corresponds to an exponential decay of the amount of material at the surface with a decay rate λ which is related to the wave state typically calculated via the whitecap fraction li et al 2017 scanlon et al 2016 the entrainment is included in the particle model by giving each surfaced particle a probability of being mixed down at each timestep calculated from the lifetime τ 1 λ at the surface when a particle is resuspended it is placed at a random depth uniformly distributed between the surface z 0 and a depth z l tkalich and chan 2002 in practice the entrainment depth is related to the wave height delvigne and sweeney 1988 or the intrusion depth of breaking waves leifer and de leeuw 2006 in a more realistic model a resuspended particle would also be assigned a new size randomly drawn from a suitable size distribution see e g delvigne and sweeney 1988 johansen et al 2015 and li et al 2017 however these complications are outside the scope of the current study which is focused on the process of surfacing this model can be formulated as a series of operations carried out for each particle during each timestep in order to calculate the position z n 1 at time t n 1 from the current position z n we here consider a water column of finite depth h depth positive downwards and a particle rising with a constant terminal speed v b step 1 displace particle randomly 4a z n z n ξ z n step 2 reflect from boundaries 4b z n z n if z n 0 2 h z n if z n h z n otherwise step 3 rise due to buoyancy 4c z n z n v b δ t step 4 set depth to 0 if above surface 4d z n 1 0 if z n 0 z n otherwise depending on the application a particle that reaches the surface in step 4 may either remain in the water column at a depth of 0 m or it may be removed from the water and considered surfaced for an oil spill model the latter would be the case corresponding to the droplet merging with a continuous surface slick it would then take energy in the form of breaking waves to re introduce surfaced oil into the water column in that case a fifth step is also carried out at each timestep step 5 if a particle is considered surfaced it is resuspended with probability p 1 e δ t τ in which case it is assigned a random depth between z 0 and z l note that in the case of slick forming particles steps 1 4 are applied to all particles in the water column i e those particles that are not part of the surface slick while step 5 is applied to all particles that are part of the slick 2 2 eulerian model the adr equation describes the time development of the concentration of a chemical or biological species affected by diffusive advective and reactive processes this may be expressed mathematically in the form of a partial differential equation pde 5 c t k c v c s where c is the concentration of species k is the diffusivity v is the velocity and s is the reaction term for the investigation of the vertical movement of particles e g oil droplets in the water column eq 5 may be simplified to one spatial dimension that is along the z axis depth positive downwards the diffusivity is considered to be spatially dependent that is k z in the vertical case similarly the advection velocity which in this case describes the rising of the individual particles due to buoyancy may also be spatially dependent i e v z to allow particles to stop at the surface and or bottom boundaries of the water column furthermore the reaction term may be considered dependent on position and concentration consequently eq 5 becomes 6 c z t z z k z c z t z z v z c z t s z c z t where c z t represents the concentration of material k z is the spatially dependent diffusivity v z is the spatially dependent velocity and s z c z t is the source term 2 2 1 boundary conditions in our eulerian model we have chosen to treat the transition of oil from the water column to the surface slick via the boundary conditions at the surface an alternative is to model this process as a loss term also known as a sink whereby oil near the surface is removed from the water column at some rate see e g tkalich and chan 2002 and ramírez et al 2018 however the use of a sink term requires the introduction of some length scale that determines what is meant by close to the surface for the eulerian model this could be a grid cell but for the lagrangian model no such convenient length scale exists modelling the transition from subsurface to surface via the boundary conditions on the other hand gives a natural comparison between the eulerian and lagrangian schemes as the concept of reaching the surface arises naturally in both models for the examination of oil droplets which rise towards the surface and create an oil slick we propose a partially absorbing boundary condition where only the advective flux is allowed to transport particles out of the domain through the surface boundary located at z 0 while we demand that the diffusive flux be zero at the boundary this is equivalent to steps 2 and 4 in the particle model where we reflect a particle that has been placed above the surface due to the random walk and consider a particle surfaced if it crosses the boundary due to buoyancy writing the total flux as the sum of the advective flux and the diffusive flux j t j a j d we may write the above boundary condition as 7 j t z 0 j a j d z 0 v z c z t k z c z t z z 0 v z c z t z 0 which then can be simplified to the following neumann boundary condition for the diffusive flux at the surface 8 j d z 0 k z c z t z z 0 0 we note that if the velocity v z 0 at the surface boundary is set to zero the boundary condition reduces to a fully reflective boundary since there will be no advection through the surface this may for instance be used in the simulation of particles that do not create a slick at the surface e g buoyant fish eggs or microplastics in a similar manner and to ensure that no particles leave the domain at the bottom boundary located at z h we propose a reflective boundary condition where the total flux is zero i e 9 j t z h j a j d z h v z c z t k z c z t z z h 0 which takes the form of a robin boundary condition that is a combination of a dirichlet and a neumann boundary condition 2 2 2 reaction term for resuspension of oil from an oil slick let c t o t be the total amount of material considered in the simulation assuming that we consider a system with a finite depth h and we start out at time t 0 with all the material being submerged i e nothing on the surface we have 10 c t o t 0 h c z t 0 d z then at any time t n the amount of material in the surface slick c s l i c k t n can be found as 11 c s l i c k t n c t o t 0 h c z t n d z in our model oil from the surface slick may be resuspended as droplets by assuming an exponential decay of the amount of oil at the surface with a decay rate λ 1 τ where τ is the corresponding lifetime this is equivalent to submerging a constant fraction of the surface slick at every timestep where that fraction is given by 12 p 1 e δ t τ hence the amount of oil resuspended during timestep n is 13 p c s l i c k t n and the corresponding source term is given by 14 s z c z t n p c s l i c k t n l δ t if z l 0 otherwise where δ t is the timestep of the model in this case the resuspended material is distributed uniformly throughout the upper part of the water column down to the depth l see also section 2 1 step 5 2 2 3 numerical solution method for the advection diffusion reaction equation to solve eq 6 a finite volume method fvm was used the z axis was discretised into control volumes or cells of a constant size δ z then the diffusive fluxes through the cell faces were approximated by a second order central difference of the two adjacent cells moreover flux limiting was used to approximate the advective fluxes as a first order upwind flux with a higher order correction depending on a limiter function hundsdorfer 2003 pp 66 67 the flux limiting was performed with a quick quadratic upstream interpolation for convective kinetics limiter function yielding second order spatial accuracy see e g versteeg 2007 pp 170 178 finally the finite volume scheme was discretised in time according to eq 1 and integrated by the crank nicolson method implicit trapezoidal rule in order to achieve second order accuracy in time and favourable unconditional stability see e g versteeg 2007 pp 247 248 see appendix a for further details 3 case studies in this section we present and discuss the results of three example cases in each case we present the solution as calculated both by the eulerian grid model and the lagrangian particle model to demonstrate that they give equivalent results for both models we consider a finite water depth of h 40 m for the eulerian model a spatial discretisation of δ z 0 04 m was used and a timestep of δ t e 1 s for the lagrangian particle model n p 960 000 particles were used and a timestep of δ t l 0 01 s the same numerical parameters were used for all three case studies see appendix b for details on the choice of numerical parameters for the particle model in order to directly compare the results both models were used to calculate concentrations for the eulerian model the initial concentration was in all cases a gaussian concentration profile centred at z μ 0 20 m with a standard deviation of σ 0 2 m hence we have 15 c t o t 0 h 1 2 π σ 0 2 exp z μ 0 2 2 σ 0 2 d z 1 where the integral can for practical purposes be considered equal to 1 to calculate equivalent concentrations from the particle model the initial positions of the particles were drawn from a gaussian random distribution with the same properties as above μ 0 20 m σ 0 2 m the z axis on the interval z 0 to z h was divided into n b 1000 bins giving a bin size equal to the spatial resolution δ z 0 04 m of the eulerian model the particle count in each bin was then converted to a normalised concentration by dividing by n p δ z note that during the simulation the depth of a particle can have any value the concentration bins are only introduced as a means to calculate concentrations and do not affect the particle positions after calculating the binned concentrations these were averaged over 100 consecutive timesteps to get profiles that represent average conditions over the same interval as the timestep of the eulerian model δ t e 1 s we have considered two different diffusivity scenarios one where the diffusivity is a constant k 3 1 0 3 m 2 s and one where it varies with depth for ease of implementation we have chosen to consider a variable profile that is given by an analytical expression following visser 1997 we use a diffusivity k z given by 16a k z k 0 k 1 z e α z 16b k 0 1 0 3 m 2 s k 1 6 1 0 3 m s α 0 5 m 1 which approximates a wind forced surface boundary layer with a mixing layer depth of approximately 10 m the diffusivity profiles are shown in fig 1 3 1 case 1 fish eggs we consider here a case where we have buoyant particles with a rise velocity of 6 mm s this corresponds approximately to the rise velocity of fish eggs with a density of 1 01 kg l and a size of 1 mm in this case the boundary condition at the surface is zero flux in both advection and diffusion thus describing particles that do not form a slick at the surface see discussion in sections 2 and 2 1 we have simulated this scenario with the two different diffusivities shown in fig 1 i e a constant diffusivity of k 3 1 0 3 m 2 s and a variable diffusivity given by eqs 16 in fig 2 the results obtained with constant diffusivity are presented concentration profiles are shown in the left panel calculated both with the lagrangian particle model described in section 2 1 and with the eulerian model described in section 2 2 concentrations at five different times are shown with the five coloured lines showing the results of the lagrangian model and the corresponding dashed black lines showing the results of the eulerian scheme we find that the two models give very similar predictions it is furthermore observed that the concentration profiles at 2 3 and 4 h appear identical this is because after about 2 h a steady state is reached where the upward drift due to buoyancy is exactly balanced by a downwards displacement caused by diffusion in the presence of a reflecting boundary i e the surface in the right panel of fig 2 concentration in the topmost bin i e the interval from z 0 to z δ z 0 04 m is shown as a function of time again for both models with the lagrangian particle model results shown as a continuous blue line and the eulerian grid model as a dashed black line that the system reaches a steady state is clearly visible as the concentration in the topmost bin reaches a constant level after about 2 h even after the steady state is reached we observe that the concentration in the topmost bin fluctuates in the particle model due to the inherent randomness of the random walk scheme however the time averaged concentrations in the top bin over the interval from 5 to 6 h is 1 92268 m 1 for the particle model and 1 92170 m 1 for the grid model which is a discrepancy of 0 053 between the two models for the special case considered here with constant rise speed and diffusivity and completely reflecting boundary the pde for the concentration profile eq 6 has an analytical solution given by 17 c z c 0 e z v b k where k is the diffusivity v b is the constant rise speed and c 0 is the concentration at the surface by using that the integral of the concentration over the entire water column should be unity we find the following analytic solution for the normalised average concentration in the top bin 18 1 δ z 0 δ z e z v b k d z 0 h e z v b k d z 1 92209134033411 strictly speaking the above expression is only approximate as eq 17 only holds for infinite water depth however due to the rapid exponential falloff it is accurate to about 36 decimal places in fig 3 similar results are shown for the same case of buoyant particles with a completely reflecting boundary but this time with a variable diffusivity given by eqs 16 again the left panel shows concentration profiles at five different times and the right panel shows the concentration in the top bin for both models we observe that also in this case a steady state is reached however we note that this time there is a visible discrepancy in the predicted steady state concentration of the topmost cell fig 3 right panel where the particle scheme predicts a concentration of 2 25304 m 1 while the grid model predicts 2 23698 m 1 in both cases an average over the interval from 5 to 6 h is taken this difference of about 0 7 is presumably caused by an artificial build up of particles near the boundary which occurs in the reflection step when the diffusivity profile has a non zero derivative approaching the boundary see ross and sharples 2004 and section 4 the comparison of the steady state predictions are summarised in table 1 and the observed discrepancy in the case of variable diffusivity will be analysed and discussed further in section 4 3 2 case 2 oil droplets in this case we consider particles with a rise velocity of 3 mm s which corresponds approximately to oil droplets with a density of 0 9 kg l and a size of 0 25 mm note that this value was somewhat arbitrarily chosen as an example and should not be seen as representative for oil spills in general the boundary at the surface is treated as reflective in diffusion but absorbing in advection this represents oil droplets being absorbed into the surface slick if they reach the surface due to buoyancy but not if they reach the surface due to diffusion see details in section 2 in this case we present results for the variable diffusivity profile only see eqs 16 the results of the simulation are shown in fig 4 again with concentration profiles for different times shown in the left panel the results from the lagrangian model are shown as continuous coloured lines while the predictions of the eulerian model are shown for the same times as dashed black lines in the right panel the fraction of material that remains in the water column i e the fraction that has not been absorbed into the surface slick is shown we again observe that the two different models give very similar predictions both for the concentration profiles and for the amount of oil remaining in the water column as a function of time in this case the steady state solution is that all the material has settled on the surface with no droplets left in the water column 3 3 case 3 oil droplets with resuspension in the final case we again consider particles with a rise velocity of 3 mm s which corresponds approximately to oil droplets with a density of 0 9 kg l and a size of 0 25 mm note again that this value was somewhat arbitrarily chosen as an example and should not be seen as representative for oil spills in general furthermore the boundary at the surface is treated as reflective in diffusion but absorbing in advection this represents oil droplets being absorbed into the surface slick if they reach the surface due to buoyancy in contrast to case 2 however this time the model includes resuspension at each timestep a constant fraction p 1 e δ t τ of the surface slick is resuspended into the water column this is equivalent to exponential decay of the amount of surface oil at a rate corresponding to a lifetime τ at the surface where we have arbitrarily chosen τ 500 s the resuspended oil is evenly distributed throughout the interval from z 0 to z l where the entrainment depth was also somewhat arbitrarily set to l 1 m as noted in section 2 the entrainment depth and rate as well as the droplet size distribution of the entrained oil will in general depend on the wave state and the properties of the oil see e g delvigne and sweeney 1988 johansen et al 2015 and li et al 2017 however these complications do not directly affect the discussion of the boundary conditions and are thus outside the scope of the current investigation this case has also been simulated with both constant and variable diffusivity the results of the simulations with constant diffusivity are shown in fig 5 in the same way as for case 2 i e with concentration profiles in the left panel and remaining submerged fraction as a function of time in the right panel we again observe that the two different models give very similar predictions both for the concentration profiles and for the amount of oil remaining in the water column as a function of time in this case a steady state is reached where a significant fraction of the material remains submerged this state is reached after about 4 h at the steady state the upwards drift due to buoyancy is exactly balanced by the combined downwards motion due to resuspension and diffusion in the presence of a reflecting boundary we observe that the two different models predict essentially the same time development of the remaining submerged fraction as well as very similar steady state level at steady state the predicted submerged fraction is 0 5005 in the particle model and 0 4998 in the grid model a discrepancy of about 0 14 here the average over the interval from 5 to 6 h was used the same situation as above has been simulated with the variable diffusivity profile given by eqs 16 and the results are shown in fig 6 again concentration profiles are shown in the left panel and submerged fraction as a function of time in the right panel a steady state is reached also in this situation and after about 3 4 h the submerged fraction remains approximately constant at steady state the predicted submerged fraction is 0 5659 for the particle model and 0 5667 for the grid model where the average from 5 to 6 h has been taken in both cases the results are summarised in table 2 4 discussion in this section we discuss some technical details of the reflecting boundary in the lagrangian particle model as well as our reasons for choosing to model the removal of oil from the water column via the boundary conditions in the eulerian scheme 4 1 boundary treatment in lagrangian models we mentioned initially that there are a number of somewhat subtle details that must be taken into account in formulating a particle model first among these are the correct formulation of the random walk to avoid unphysical transport away from regions of high diffusivity random walk schemes are essentially numerical integration methods for stochastic differential equations and there are a range of available methods at different orders of accuracy for a detailed survey of several alternative methods see e g gräwe 2011 and gräwe et al 2012 as well as specialist literature such as kloeden and platen 1992 in this paper we have chosen to use the visser scheme see visser 1997 for details while higher order methods may allow longer timesteps and better handle sharp transitions in diffusivity they will typically formulate the transport process as a single step that includes both random displacement and drift in this case rise due to buoyancy the visser scheme on the other hand allows us to handle the drift as a separate step this is convenient when we want to split the advection and diffusion steps to treat the boundary at the surface as reflecting in diffusion and absorbing in advection on the topic of reflecting boundaries in spatially variable diffusion ross and sharples 2004 has demonstrated that simple reflection is not strictly correct in our case when using the visser scheme with a reflecting boundary and a diffusivity profile whose derivative does not go to zero at the boundary one will observe a spurious increase in concentration of particles near the boundary 4 4 note that this effect is not unique to the visser scheme but may take a different shape with other schemes the effect can however be made arbitrarily small by choosing a sufficiently short timestep we demonstrate this with a numerical example as we have taken r in eq 2 to be uniformly distributed random numbers between 1 and 1 it is possible to calculate the maximum upwards and downwards displacements a particle can have at any position inspired by ross and sharples 2004 we introduce the parameters h 1 and h 2 to describe the range of possible displacements of a particle situated exactly at the reflecting boundary here h 1 is the maximum displacement of a particle moving away from the boundary while h 2 is the maximum displacement of a particle moving into the boundary followed by reflection note that our definition of h 1 differs from ross and sharples 2004 while h 2 is the same hence h 1 and h 2 for the boundary at the surface z 0 are in our case given by 19a h 1 k 0 δ t 6 δ t k 0 k 0 δ t 2 19b h 2 k 0 δ t 6 δ t k 0 k 0 δ t 2 these parameters indicate the size of the region affected by the spurious concentrations as a numerical example we consider a case with neutrally buoyant tracers in a finite depth of 10 m with the same diffusivity profiles as used earlier i e a constant k 3 1 0 3 m 2 s and a variable profile given by eqs 16 the diffusivity profiles are shown in fig 1 we employ an ensemble of n p 200 000 tracers initially distributed in a uniform manner in the whole domain and let the system develop for 12 h the resulting concentrations averaged over 12 h are shown in fig 7 where the calculations have been performed with four different timesteps δ t and the concentrations have been calculated by normalised particle counts in n b 5000 bins in principle the tracers should remain well mixed however as can be seen this is not the case close to the boundary when the variable diffusivity profile is used in each panel of fig 7 the parameter h 1 has been indicated by a horizontal dashed line while h 2 is indicated by a dotted line we observe that for a constant diffusivity h 1 h 2 and there is no spurious concentration effect for the variable profile on the other hand h 1 h 2 and hence there is a region of higher concentration close to the boundary followed by another region of reduced concentration we observe from eqs 19 that the size of the region with spurious concentrations is dependent on the timestep δ t as well as on the behaviour of the diffusivity profile near the boundary note in particular that if k z 0 0 the effect disappears provided the timestep is sufficiently short cf eq 3 for our case studies with variable diffusivity which were carried out with the diffusivity profile given by eqs 16 and a timestep of δ t 0 01 s we find that 20 h 1 0 007806 m h 2 0 007686 m while these values are smaller than the bin size used to calculate concentrations which was δ z 0 04 m we found in case 1 when a variable diffusivity was used a slightly increased prediction of the near surface concentration see fig 3 right panel when the particle model is compared to the eulerian model the effect was not observed for constant diffusivity in case 1 it was also not seen in cases 2 and 3 where any spurious accumulation at the surface is continuously removed by the combined effect of upwards drift due to buoyancy and the absorbing boundary condition in advection one might have expected an increase in concentration near the surface to lead to faster surfacing of the oil in cases 2 and 3 but no indication of this is found at the timestep length used here 4 2 boundary treatment in eulerian models in the current study we have chosen to describe the transition of oil from the water column to the surface slick via the boundary conditions in the eulerian scheme this is a natural way to describe the process as a droplet joining the surface slick will pass through a boundary at the oil water interface and join the continuous oil phase it also allows for a straightforward comparison between the lagrangian and eulerian schemes as the concept of the boundary at the surface exists in both as previously mentioned an alternative would be to formulate the disappearance of oil from the water column as a loss term or sink in the adr equation an example of such a formulation is found in tkalich and chan 2002 where the loss of oil to the surface slick is modelled by assuming the existence of a well mixed layer near the surface throughout which the oil concentration is constant at each timestep some fraction of the oil in this layer is lost to the surface where this fraction is determined from the rise speed of the droplets and the thickness of the well mixed layer in our opinion treating the surfacing of oil via the boundary conditions should be the preferred approach as it does not require any assumptions about the existence of special layers in formulating our eulerian model we have assumed that the transport and mixing of buoyant material in the water column can be described by the advection diffusion equation with the diffusivity given by an eddy diffusivity profile and that the buoyant material can optionally leave the water column through its natural boundary at the surface to form a continuous floating slick 5 conclusion we have analysed a lagrangian particle model for vertical transport mixing surfacing and optionally resuspension of buoyant materials such as oil droplets microplastics and fish eggs the lagrangian model is compared to an eulerian model based on direct numerical solution of the adr equation we have described how to treat the boundary at the surface in order to model materials that form a slick at the surface such as oil as well as non slick forming materials such as plastics and fish eggs in particular we demonstrate that treating the surface in the particle model as completely reflecting is equivalent to solving the adr equation with a robin boundary condition ensuring no flux across the boundary moreover we have demonstrated that treating the surface in the particle model as absorbing in advection and reflecting in diffusion gives the same results as solving the adr equation with a neumann boundary condition enforcing zero diffusive flux while allowing an advective flux we also consider the effect of entrainment of surface oil due to waves in both models and again demonstrate that consistent results emerge while it is likely that many particle based oil spill models use a similar approach to the one outlined in section 2 1 an explicit description and analysis of the steps involved in surfacing has to the best of our knowledge never appeared in the literature furthermore while most oil spill models are based on lagrangian particle schemes eulerian oil spill models exist and are being developed see e g tkalich et al 2003 and restrepo et al 2015 hence it is a point of some importance to have an understanding of how to formulate equivalent descriptions in the two schemes acknowledgements the authors would like to thank their colleagues for many an interesting discussion in the sintef coffeelab the work has been performed partially under the project hpc europa3 infraia 2016 1 730897 with the support of the ec research innovation action under the h2020 programme in particular t n gratefully acknowledges the computer resources and technical support provided by the epcc appendix a details on the implementation of the eulerian finite volume method in fvms the partial differential equation is transformed to integral form by integrating over a control volume ω j corresponding to cell j considering eq 6 the volume integrals on the right hand side may then be rewritten to surface integrals over the boundary of the control volume through the divergence theorem by applying the leibniz integral rule on the left hand side to change the order of the spatial integral and the differentiation with respect to time the average concentration in control volume ω j c j may be defined similarly on the right hand side the average reaction term in the control volume s j is found by integration since only flow in the vertical z direction is considered the left hand side of eq 6 reduces to the change of the cell average concentration per unit of time in the control volume with the grid spacing δ z j z j 1 2 z j 1 2 moreover the right hand side is given by the difference of the diffusive and advective fluxes at the bottom and top faces of the control volume z j 1 2 and z j 1 2 depth positive downwards respectively with the addition of the cell average source term in the control volume with the grid spacing δ z j thus the integral form of eq 6 reads a 1 δ z j d c j d t k c z j 1 2 k c z j 1 2 v c j 1 2 v c j 1 2 δ z j s j which is noted to be an exact equation now the concentration is assumed to be constant within each control volume such that the cell averages c j and s j may be approximated by the values located at the cell centres z j that is c j and s j respectively assuming a constant grid spacing δ z the z axis is thus discretised into n j equidistant control volumes or cells a similar derivation may e g be found in versteeg 2007 pp 243 246 considering the cell adjacent to the surface boundary notated as j 0 the insertion of the absorbing surface boundary condition of eq 8 into eq a 1 causes the diffusive flux over the surface to vanish thus eq a 1 reduces to a 2 δ z d c 0 d t k c z 1 2 v c 1 2 v c 1 2 δ z s 0 where j 1 2 corresponds to the surface boundary moreover as noted in section 2 2 1 if the velocity over the surface is zero the advective flux over the surface also vanishes making the surface a reflecting boundary similarly in the cell adjacent to the bottom boundary i e j n j 1 inserting the reflecting boundary condition from eq 9 into eq a 1 causes both the diffusive and advective fluxes over the bottom boundary to disappear hence eq a 1 reduces to a 3 δ z d c n j 1 d t k c z n j 1 2 k c z n j 3 2 v c n j 1 2 v c n j 3 2 δ z s n j 1 where j n j 1 2 corresponds to the bottom boundary in eq a 1 the diffusive fluxes at the cell faces were approximated by a second order central difference of the two adjacent cells see e g versteeg 2007 p 117 that is on the form a 4 k c z j 1 2 k j 1 2 c j 1 c j z j 1 z j k j 1 2 c j 1 c j δ z where the diffusivity k j 1 2 is determined on the cell faces either explicitly by an analytic expression or by an arithmetic or harmonic mean in the case of a discrete diffusivity for the advective fluxes however it is noted that linear numerical schemes of second order accuracy and higher are known to yield numerical oscillations for advection dominated problems that is when the cell péclet number pe v δ z k 1 for non smooth solutions hundsdorfer 2003 pp 66 67 118 119 consequently in order to implement a more flexible higher order numerical scheme that is higher than first order in this case for advection flux limiting was used to approximate the advective fluxes as a first order upwind flux with a higher order correction depending on a limiter function pp 216 217 hundsdorfer 2003 pp 165 171 versteeg 2007 the approximation of the advective fluxes thus takes the form a 5 v c j 1 2 v j 1 2 c j 1 2 ψ ρ j 1 2 c j 1 c j v j 1 2 c j 1 1 2 ψ ρ j 1 2 c j 1 c j where ψ ρ is the limiter function determining the correction and ρ is given by a 6a ρ j 1 2 c j c j 1 c j 1 c j a 6b ρ j 1 2 c j 2 c j 1 c j 1 c j i e the local ratio of the upwind gradient to the downwind gradient pp 167 171 172 versteeg 2007 p 216 hundsdorfer 2003 the flux limiting was done with a quick quadratic upstream interpolation for convective kinetics limiter function given by a 7 ψ ρ max 0 min 2 ρ 3 ρ 4 2 where ψ ρ 3 ρ 4 corresponds to the quick scheme and resulted in second order accuracy see e g versteeg 2007 pp 170 178 according to versteeg 2007 pp 167 168 higher order accuracy without oscillatory behaviour for non smooth solutions is attained if the scheme is monotonicity preserving i e that it does not create local extrema and does not increase or decrease existing local maxima or minima respectively such monotonicity preserving schemes will have the property of being total variation diminishing tvd that is that the total variation t v ϕ j 1 n j ϕ j ϕ j 1 does not increase over time versteeg 2007 p 168 as noted in versteeg 2007 pp 168 171 flux limiter functions were derived to satisfy a number of criteria which ensures that the resulting scheme is tvd and second order accurate the scheme was discretised in time according to eq 1 and integrated by the crank nicolson method or implicit trapezoidal rule given by a 8 c j n 1 c j n δ t 1 2 f j n 1 2 f j n 1 where f corresponds to the right hand side of eq a 1 evaluated at time steps n and n 1 this was utilised in order to get second order accuracy in time and favourable unconditional stability versteeg 2007 pp 247 248 by including the higher order correction of the flux limiting as an additional source term that is as a deferred correction see versteeg 2007 pp 163 164 172 the scheme may be written as a system of equations that must be solved for each time level n 1 by defining a tridiagonal matrix of coefficients the tridiagonal system of equations was at each time level solved by the tridiagonal matrix algorithm tdma or thomas algorithm see e g pletcher 2013 pp 150 151 however due to the nonlinearities appearing in the source term and the deferred correction an iterative approach must be used to update the coefficients until an acceptable solution is found at the n 1 time level see e g pletcher 2013 p 440 it is noted in hundsdorfer 2003 p 232 that the implicit trapezoidal rule for a pure advection problem is tvd for courant numbers c v δ t δ z 1 appendix b details on the choice of timestep and number of particles in a lagrangian particle model there are two main numerical parameters that control the accuracy the timestep δ t and the number of particles n p ideally the modelled result will converge to the correct solution which may or may not be known as δ t becomes smaller and n p becomes larger when using a particle method each particle position constitutes a sample from the true distribution of positions hence the random noise that is seen when using few particles is not a systematic error but rather an indication that the sample distribution has not yet converged to the true distribution for practical applications this amounts to a random error in the modelled concentration field the convergence with number of particles is 1 n p which means that increasing the number of particles by a factor 10 only reduces the error by a factor 1 10 the computational effort on the other hand increases linearly with n p the scaling of the error with the timestep depends on the chosen random walk scheme in this paper we have used the visser scheme which has order of convergence 1 in the weak sense gräwe 2011 technically this means that the error in the moments of the modelled distribution as compared to the moments of the true distribution will scale as δ t for sufficiently small δ t kloeden and platen 1992 pp 326 327 higher order random walk schemes exist although many have the drawback that one must evaluate higher order derivatives of the diffusivity see e g gräwe 2011 gräwe et al 2012 and kloeden and platen 1992 however in the special case of constant drift and constant diffusivity i e for a stochastic differential equation sde given by b 1 d z a d t b d w t where a and b are constants all schemes reduce to the euler maruyama scheme maruyama 1955 pavliotis 2014 page 146 given by b 2 z n 1 z n a δ t b δ w where δ w is a gaussian random variable with mean δ w 0 and variance δ w 2 δ t for this reason we chose to use case study 1 with constant diffusivity see section 3 1 to carry out a convergence test in order to determine a suitable timestep and number of particles as in the results for case 1 we have calculated the average concentration in the top δ x 0 04 m of the water column using the particle method with different δ t and n p we then calculated the error in the modelled result by subtracting the analytical solution see eq 18 in fig b 8 the results of the convergence test are shown in the left hand panel we have used n p 19 200 we observe that the error scales linearly with δ t down to a relative error of about 3 1 0 3 from this point the error due to too few particles dominate and there is no additional accuracy gained by reducing the timestep further in the middle panel with n p 192 000 we observe that increasing the number of particles by a factor 10 has improved the accuracy by a factor of about 1 10 in this case improved accuracy with reduced timestep is seen down to an error of about 10 3 finally in the right hand panel the particle number is again increased tenfold to n p 1920 000 it is again clear that the increase in number of particles has led to an increased accuracy and the timestep can profitably be decreased even further the convergence test indicates that with the numerical parameters used in the case studies n p 960 000 and δ t 0 01 s we may reasonably expect a relative error of about 5 1 0 4 for the case with constant diffusivity which is what we see in case 1 note also that changing to a higher order sde scheme would not improve the accuracy when constant drift and diffusivity is used as the correction terms in higher order schemes typically contain derivatives of the drift and diffusivity and the drift and diffusivity are the same no matter where they are evaluated gräwe 2011 gräwe et al 2012 kloeden and platen 1992 a final point related to the number of particles is that this will depend on how the concentration field is calculated one option is that one could use larger bins when counting particles to calculate the concentration as larger bins will contain more particles the results are then less susceptible to random fluctuations the trade off is a loss in resolution in that features smaller than the bin size cannot be resolved in this paper we have chosen to use a fairly small bin size of δ x 0 04 m both for the eulerian and the lagrangian models the intention was to facilitate a direct comparison and to study the details of the behaviour near the boundary in practical applications such as in oil spill modelling the bin size would more likely be on the scale of metres rather than centimetres and this would significantly reduce the need for a large number of particles another commonly used approach which may further reduce the need for large particle numbers is to apply some kind of smoothing to the concentration field instead of using the box counts which are equivalent to a histogram of particle positions lynch et al 2014 chapter 8 discusses some different options including kernel estimators also known as kernel density estimators silverman 1986 with a kernel estimator the concentration field in one dimension is calculated as b 3 c z 1 n p λ i 1 n p κ z z i λ where the sum is over particles and z i is the position of particle i the kernel κ z can be any positive function that satisfies κ z d z 1 and λ is called the bandwidth for the same number of particles a kernel estimator can give a smoother and more accurate representation of the concentration field compared to the box count approach the results depend on both the kernel and the bandwidth the choices of which depend among other things on the number of particles see e g spivakovskaya et al 2007 for the current study we have chosen not to apply kernel estimators as the focus of the investigation is on the boundary conditions and not on the concentration field 
24047,lagrangian particle model for vertical mixing transport and surfacing of buoyant particles in the water column tor nordam a b ruben kristiansen b raymond nepstad a johannes röhrs c a sintef ocean trondheim norway sintef ocean trondheim norway b norwegian university of science and technology trondheim norway norwegian university of science and technology trondheim norway c norwegian meteorological institute oslo norway norwegian meteorological institute oslo norway corresponding author lagrangian particle models are used for many applications in the ocean sciences including transport modelling of oil spills fish eggs and larvae plastics and sediment particles in the context of oil spill modelling there are numerous papers discussing entrainment of surface oil by breaking waves however for the opposite process i e droplets reaching the surface and joining the surface slick we have found no discussion in the literature of the exact steps involved given the wide use of particle based models in oil spill modelling it is important to establish a consistent recipe for treating the surface boundary we investigate a lagrangian particle model for the vertical transport surfacing and resuspension of buoyant material in the water column by modifying the behaviour at the surface boundary the model can be applied to materials such as oil droplets that form a surface slick and hence see the surface as an absorbing boundary and to particles that do not form a surface slick such as fish eggs and microplastics for slick forming materials we also consider resuspension from the surface slick e g entrainment of surface oil by breaking waves while we restrict our attention to positively buoyant materials the model is equally applicable to the settling of negatively buoyant particles such as sediment grains and marine snow we consider three case studies each designed to allow a detailed and direct comparison of the lagrangian model to an eulerian model based on numerical solution of the advection diffusion reaction equation we demonstrate that the two models give the same results when the boundary at the surface is treated correctly keywords oil spills fish eggs microplastics vertical mixing random walk 1 introduction lagrangian transport models are commonly used in many areas of ocean related science including the modelling of oil spills garcía martínez and flores tovar 1999 reed et al french mccay 2009 mariano et al 2011 de dominicis et al 2013 dagestad et al 2018 microplastics ballent et al 2013 ichtyoplankton thygesen and ådlandsvik 2007 fox et al 2009 castano primo et al 2014 fish eggs röhrs et al 2014 and mineral particles gräwe and wolff 2010 the relative simplicity of the core lagrangian particle scheme makes it attractive for numerical applications however there are several subtle points which must be carefully addressed in oceanic applications brickman and smith 2002 ross and sharples 2004 van sebille et al 2018 for example common to all of these applications is that the models must correctly treat the boundaries at the sea surface and the seabed furthermore in the case of spatially variable diffusion which is usually the case in the ocean care must be taken to avoid numerical artefacts that result from a naïve formulation of random walk hunter et al 1993 visser 1997 in the field of numerical oil spill modelling it has long been recognised that the vertical distribution of oil is of paramount importance this includes both the vertical distribution of submerged oil and the distinction between surface oil and submerged droplets one of the earliest works treating an oil spill as a three dimensional process is that of elliott 1986 elliott described the elongation of an oil slick in the direction of the wind attributing the effect to vertical current shear and also formulated a three dimensional random walk based particle model while that model allowed sufficiently large oil droplets to remain at the surface as their rise due to buoyancy would always dominate over the random displacement due to diffusion it did not include a slick formation process or a separate surface state since elliott 1986 much has been written about natural entrainment i e the process where surface oil is submerged as droplets due to dissipation of surface gravity waves several different models have been developed for both the rate of entrainment and the resulting droplet size distribution see e g delvigne and sweeney 1988 johansen et al 2015 and li et al 2017 however less has been said about the opposite process i e oil droplets reaching the surface due to buoyancy and merging with a surface slick reviews of the field such as spaulding 1988 asce 1996 reed et al 1999 and spaulding 2017 all discuss entrainment of surface oil and vertical transport and mixing of droplets but contain no details of the surfacing process in the context of eulerian models surfacing is discussed by e g tkalich and chan 2002 but to the best of our knowledge a complete description of the steps involved in calculating surfacing in a particle based oil spill model has not been published in the current paper we provide a direct comparison between the lagrangian particle scheme and an eulerian model based on the advection diffusion reaction adr equation focusing particularly on the treatment of the surface to this end we provide a detailed description of a lagrangian particle model for the vertical mixing transport and surfacing of oil droplets in the water column as well as the vertical mixing and transport of non slick forming particles such as fish eggs and microplastics for the case of oil droplets we also include resuspension from the surface slick into the water column which can for example be caused by breaking waves we then formulate an equivalent eulerian model based on the adr equation with appropriate boundary conditions while we consider positively buoyant material throughout this paper the formulated models and the results are equally applicable to settling and optionally resuspension of negatively buoyant particles we consider three case studies which are designed to allow a direct comparison of the lagrangian and eulerian schemes for each case we provide details of all the steps involved in the lagrangian particle model and a complete description of an equivalent eulerian scheme with specific boundary conditions we then demonstrate that we obtain the same results with the two models the layout of the paper is as follows in the following section section 2 we describe the system to be studied i e buoyant material in the water column and how this material may or may not form a continuous slick at the surface and how a continuous slick may be resuspended as droplets due to breaking waves we then formulate two models for this system a lagrangian model based on particles subjected to buoyant rise random walk and resuspension and an eulerian model based on the adr equation in section 3 we consider three different case studies and present the results of simulating all three cases with both models section 4 contains a discussion of the way we have chosen to treat the boundary both for the lagrangian and eulerian schemes finally in section 5 we provide some concluding remarks the appendices expand on some of the technical details of solving the adr equation numerically and on the choice of numerical parameters for the particle model 2 models for buoyant material in the water column we consider a system where some buoyant material e g microplastics fish eggs or oil droplets is dispersed in the water column we will only consider transport in the vertical direction treating the water column as a one dimensional system and we consider positively buoyant particles rising at their terminal velocity the main source of vertical mixing in the ocean is turbulent diffusion which is orders of magnitude greater than molecular diffusion tennekes and lumley 1972 vertical turbulent diffusion is usually described by an eddy diffusivity profile here denoted as k z which gives the diffusivity as a function of depth eddy diffusivity profiles can for example be obtained from ocean models e g roms 1 1 myroms org from specialised turbulence models e g gotm 2 2 gotm net or from simpler analytical expressions seeking to capture some important features for a given scenario see e g large et al 1994 depending on the type of material the surface may or may not be seen as a partially absorbing boundary materials that do not form surface slicks such as fish eggs and microplastics may reach the surface through buoyancy and later be resuspended due to turbulent eddies in the water hence we may formulate the following rules which when repeatedly applied describe the motion of non slick forming buoyant particles in a turbulent water column particles are randomly displaced due to turbulent motion of the water being caused by the motion of the water this random displacement treats the surface as a reflecting boundary particles rise due to buoyancy when particles reach the surface due to buoyancy they can rise no further thus treating the surface as a barrier the rationale for treating the boundary as reflecting in diffusion is that turbulent diffusion is caused by eddies in the water and being formed by water these eddies are necessarily unable to carry material out of the water in the case of oil droplets a continuous slick may be formed at the surface and as a droplet rises to the surface and merges with the slick it is effectively removed from the water column for an oil slick to be broken up into droplets and resuspended a high energy event such as a breaking wave is required a set of rules describing the motion of slick forming buoyant particles is droplets are randomly displaced due to turbulent motion of the water being caused by the motion of the water this random displacement treats the surface as a reflecting boundary droplets rise due to buoyancy when droplets reach the surface due to buoyancy they become part of the surface slick thus treating the surface as an absorbing boundary once part of the surface slick droplets may be resuspended due to breaking waves at some rate which is related to the wave state droplets resuspended due to waves are distributed into the upper part of the water column and may in general be assigned a new size in the process again the rationale for the reflecting boundary in the diffusion step is that material carried by the motion of the water cannot leave the water furthermore if the surface was absorbing in diffusion increasing the diffusivity could lead to arbitrarily fast surfacing which is contrary to what is observed in reality in what follows we will formulate an eulerian and a lagrangian model for the behaviour described above common to both models is that they operate in discrete time and that we consider a fixed timestep δ t where 1 t n t 0 n δ t and where t 0 is the time at the start of the simulation 2 1 lagrangian model in a lagrangian particle model an ensemble of a large number n p of particles is used to describe the effects of advection and diffusion at each timestep each particle undergoes a random displacement due to diffusion and a directed displacement due to buoyancy the step length in the random displacement is calculated from the diffusivity profile k z for the random walk formulation to be consistent it must obey the rule that an initially well mixed passive i e neutrally buoyant tracer must remain well mixed regardless of the diffusivity profile this is known as the well mixed condition and was first formulated by thomson 1987 as has been pointed out by several authors see e g hunter et al 1993 holloway 1994 visser 1997 and van sebille et al 2018 a naïve formulation of the random walk will cause an unphysical net transport away from areas of high diffusivity and thus will not obey the well mixed condition additionally care must be taken near the boundaries of the computational domain as the shape and properties of the diffusivity function here can impact the accuracy of the results ross and sharples 2004 we will return to this last point in greater detail in sections 3 and 4 we implement a random walk algorithm known as the visser scheme visser 1997 gräwe 2011 where a particle which at time t n is at a depth z n at a time t n 1 t n δ t will be at a new position z n 1 z n ξ z n where the displacement ξ z n is given by 2 ξ z n k z n δ t r 2 r δ t k z n k z n δ t 2 where k z n d k d z z n δ t is the timestep of the model and r is a random process with mean r 0 and variance r 2 r throughout this paper we have taken r to be uniformly distributed random numbers between 1 and 1 in which case r 1 3 the visser scheme will obey the aforementioned well mixed condition provided the timestep is sufficiently short the requirement is essentially that the diffusivity profile is well approximated by a linear function over the step length of the random walk visser 1997 this is satisfied if 3 δ t min 1 k z where k z d 2 k d z 2 and the minimum is taken over the entire water column according to gräwe et al 2012 it is generally agreed that the timestep should be kept at least an order of magnitude below the limit given by eq 3 the rise due to buoyancy is simply implemented as a constant upwards displacement equal to v b δ t at each timestep we take depth to be positive downwards this is because particles are considered to rise at their terminal velocity for small particles with small rise velocities this is a good approximation as the terminal velocity is reached very fast compared to other relevant processes as previously discussed what happens when a particle reaches the surface depends on the particular type of material considered in the context of an oil spill simulation a droplet that surfaces is assumed to be absorbed into a continuous surface slick of oil and will not be mixed back down into the water column by the eddy diffusivity alone hence an oil droplet that has surfaced is temporarily removed from the water column for a non slick forming particle such as a piece of microplastic the situation may be different and the eddy diffusivity may be sufficient to move the particle back down into the water column particles that have surfaced and been absorbed into a surface slick may however be resuspended due to breaking waves as would be the case for oil droplets we have chosen to include this in the model for slick forming materials 3 3 note that breaking waves will of course also influence the behaviour of non slick forming particles such as fish eggs however we have chosen to include this effect for slick forming particles only as it is far more important in this case as can be seen by comparing the steady state results of the three case studies in section 3 by optionally submerging a constant fraction of the surface slick at each timestep this corresponds to an exponential decay of the amount of material at the surface with a decay rate λ which is related to the wave state typically calculated via the whitecap fraction li et al 2017 scanlon et al 2016 the entrainment is included in the particle model by giving each surfaced particle a probability of being mixed down at each timestep calculated from the lifetime τ 1 λ at the surface when a particle is resuspended it is placed at a random depth uniformly distributed between the surface z 0 and a depth z l tkalich and chan 2002 in practice the entrainment depth is related to the wave height delvigne and sweeney 1988 or the intrusion depth of breaking waves leifer and de leeuw 2006 in a more realistic model a resuspended particle would also be assigned a new size randomly drawn from a suitable size distribution see e g delvigne and sweeney 1988 johansen et al 2015 and li et al 2017 however these complications are outside the scope of the current study which is focused on the process of surfacing this model can be formulated as a series of operations carried out for each particle during each timestep in order to calculate the position z n 1 at time t n 1 from the current position z n we here consider a water column of finite depth h depth positive downwards and a particle rising with a constant terminal speed v b step 1 displace particle randomly 4a z n z n ξ z n step 2 reflect from boundaries 4b z n z n if z n 0 2 h z n if z n h z n otherwise step 3 rise due to buoyancy 4c z n z n v b δ t step 4 set depth to 0 if above surface 4d z n 1 0 if z n 0 z n otherwise depending on the application a particle that reaches the surface in step 4 may either remain in the water column at a depth of 0 m or it may be removed from the water and considered surfaced for an oil spill model the latter would be the case corresponding to the droplet merging with a continuous surface slick it would then take energy in the form of breaking waves to re introduce surfaced oil into the water column in that case a fifth step is also carried out at each timestep step 5 if a particle is considered surfaced it is resuspended with probability p 1 e δ t τ in which case it is assigned a random depth between z 0 and z l note that in the case of slick forming particles steps 1 4 are applied to all particles in the water column i e those particles that are not part of the surface slick while step 5 is applied to all particles that are part of the slick 2 2 eulerian model the adr equation describes the time development of the concentration of a chemical or biological species affected by diffusive advective and reactive processes this may be expressed mathematically in the form of a partial differential equation pde 5 c t k c v c s where c is the concentration of species k is the diffusivity v is the velocity and s is the reaction term for the investigation of the vertical movement of particles e g oil droplets in the water column eq 5 may be simplified to one spatial dimension that is along the z axis depth positive downwards the diffusivity is considered to be spatially dependent that is k z in the vertical case similarly the advection velocity which in this case describes the rising of the individual particles due to buoyancy may also be spatially dependent i e v z to allow particles to stop at the surface and or bottom boundaries of the water column furthermore the reaction term may be considered dependent on position and concentration consequently eq 5 becomes 6 c z t z z k z c z t z z v z c z t s z c z t where c z t represents the concentration of material k z is the spatially dependent diffusivity v z is the spatially dependent velocity and s z c z t is the source term 2 2 1 boundary conditions in our eulerian model we have chosen to treat the transition of oil from the water column to the surface slick via the boundary conditions at the surface an alternative is to model this process as a loss term also known as a sink whereby oil near the surface is removed from the water column at some rate see e g tkalich and chan 2002 and ramírez et al 2018 however the use of a sink term requires the introduction of some length scale that determines what is meant by close to the surface for the eulerian model this could be a grid cell but for the lagrangian model no such convenient length scale exists modelling the transition from subsurface to surface via the boundary conditions on the other hand gives a natural comparison between the eulerian and lagrangian schemes as the concept of reaching the surface arises naturally in both models for the examination of oil droplets which rise towards the surface and create an oil slick we propose a partially absorbing boundary condition where only the advective flux is allowed to transport particles out of the domain through the surface boundary located at z 0 while we demand that the diffusive flux be zero at the boundary this is equivalent to steps 2 and 4 in the particle model where we reflect a particle that has been placed above the surface due to the random walk and consider a particle surfaced if it crosses the boundary due to buoyancy writing the total flux as the sum of the advective flux and the diffusive flux j t j a j d we may write the above boundary condition as 7 j t z 0 j a j d z 0 v z c z t k z c z t z z 0 v z c z t z 0 which then can be simplified to the following neumann boundary condition for the diffusive flux at the surface 8 j d z 0 k z c z t z z 0 0 we note that if the velocity v z 0 at the surface boundary is set to zero the boundary condition reduces to a fully reflective boundary since there will be no advection through the surface this may for instance be used in the simulation of particles that do not create a slick at the surface e g buoyant fish eggs or microplastics in a similar manner and to ensure that no particles leave the domain at the bottom boundary located at z h we propose a reflective boundary condition where the total flux is zero i e 9 j t z h j a j d z h v z c z t k z c z t z z h 0 which takes the form of a robin boundary condition that is a combination of a dirichlet and a neumann boundary condition 2 2 2 reaction term for resuspension of oil from an oil slick let c t o t be the total amount of material considered in the simulation assuming that we consider a system with a finite depth h and we start out at time t 0 with all the material being submerged i e nothing on the surface we have 10 c t o t 0 h c z t 0 d z then at any time t n the amount of material in the surface slick c s l i c k t n can be found as 11 c s l i c k t n c t o t 0 h c z t n d z in our model oil from the surface slick may be resuspended as droplets by assuming an exponential decay of the amount of oil at the surface with a decay rate λ 1 τ where τ is the corresponding lifetime this is equivalent to submerging a constant fraction of the surface slick at every timestep where that fraction is given by 12 p 1 e δ t τ hence the amount of oil resuspended during timestep n is 13 p c s l i c k t n and the corresponding source term is given by 14 s z c z t n p c s l i c k t n l δ t if z l 0 otherwise where δ t is the timestep of the model in this case the resuspended material is distributed uniformly throughout the upper part of the water column down to the depth l see also section 2 1 step 5 2 2 3 numerical solution method for the advection diffusion reaction equation to solve eq 6 a finite volume method fvm was used the z axis was discretised into control volumes or cells of a constant size δ z then the diffusive fluxes through the cell faces were approximated by a second order central difference of the two adjacent cells moreover flux limiting was used to approximate the advective fluxes as a first order upwind flux with a higher order correction depending on a limiter function hundsdorfer 2003 pp 66 67 the flux limiting was performed with a quick quadratic upstream interpolation for convective kinetics limiter function yielding second order spatial accuracy see e g versteeg 2007 pp 170 178 finally the finite volume scheme was discretised in time according to eq 1 and integrated by the crank nicolson method implicit trapezoidal rule in order to achieve second order accuracy in time and favourable unconditional stability see e g versteeg 2007 pp 247 248 see appendix a for further details 3 case studies in this section we present and discuss the results of three example cases in each case we present the solution as calculated both by the eulerian grid model and the lagrangian particle model to demonstrate that they give equivalent results for both models we consider a finite water depth of h 40 m for the eulerian model a spatial discretisation of δ z 0 04 m was used and a timestep of δ t e 1 s for the lagrangian particle model n p 960 000 particles were used and a timestep of δ t l 0 01 s the same numerical parameters were used for all three case studies see appendix b for details on the choice of numerical parameters for the particle model in order to directly compare the results both models were used to calculate concentrations for the eulerian model the initial concentration was in all cases a gaussian concentration profile centred at z μ 0 20 m with a standard deviation of σ 0 2 m hence we have 15 c t o t 0 h 1 2 π σ 0 2 exp z μ 0 2 2 σ 0 2 d z 1 where the integral can for practical purposes be considered equal to 1 to calculate equivalent concentrations from the particle model the initial positions of the particles were drawn from a gaussian random distribution with the same properties as above μ 0 20 m σ 0 2 m the z axis on the interval z 0 to z h was divided into n b 1000 bins giving a bin size equal to the spatial resolution δ z 0 04 m of the eulerian model the particle count in each bin was then converted to a normalised concentration by dividing by n p δ z note that during the simulation the depth of a particle can have any value the concentration bins are only introduced as a means to calculate concentrations and do not affect the particle positions after calculating the binned concentrations these were averaged over 100 consecutive timesteps to get profiles that represent average conditions over the same interval as the timestep of the eulerian model δ t e 1 s we have considered two different diffusivity scenarios one where the diffusivity is a constant k 3 1 0 3 m 2 s and one where it varies with depth for ease of implementation we have chosen to consider a variable profile that is given by an analytical expression following visser 1997 we use a diffusivity k z given by 16a k z k 0 k 1 z e α z 16b k 0 1 0 3 m 2 s k 1 6 1 0 3 m s α 0 5 m 1 which approximates a wind forced surface boundary layer with a mixing layer depth of approximately 10 m the diffusivity profiles are shown in fig 1 3 1 case 1 fish eggs we consider here a case where we have buoyant particles with a rise velocity of 6 mm s this corresponds approximately to the rise velocity of fish eggs with a density of 1 01 kg l and a size of 1 mm in this case the boundary condition at the surface is zero flux in both advection and diffusion thus describing particles that do not form a slick at the surface see discussion in sections 2 and 2 1 we have simulated this scenario with the two different diffusivities shown in fig 1 i e a constant diffusivity of k 3 1 0 3 m 2 s and a variable diffusivity given by eqs 16 in fig 2 the results obtained with constant diffusivity are presented concentration profiles are shown in the left panel calculated both with the lagrangian particle model described in section 2 1 and with the eulerian model described in section 2 2 concentrations at five different times are shown with the five coloured lines showing the results of the lagrangian model and the corresponding dashed black lines showing the results of the eulerian scheme we find that the two models give very similar predictions it is furthermore observed that the concentration profiles at 2 3 and 4 h appear identical this is because after about 2 h a steady state is reached where the upward drift due to buoyancy is exactly balanced by a downwards displacement caused by diffusion in the presence of a reflecting boundary i e the surface in the right panel of fig 2 concentration in the topmost bin i e the interval from z 0 to z δ z 0 04 m is shown as a function of time again for both models with the lagrangian particle model results shown as a continuous blue line and the eulerian grid model as a dashed black line that the system reaches a steady state is clearly visible as the concentration in the topmost bin reaches a constant level after about 2 h even after the steady state is reached we observe that the concentration in the topmost bin fluctuates in the particle model due to the inherent randomness of the random walk scheme however the time averaged concentrations in the top bin over the interval from 5 to 6 h is 1 92268 m 1 for the particle model and 1 92170 m 1 for the grid model which is a discrepancy of 0 053 between the two models for the special case considered here with constant rise speed and diffusivity and completely reflecting boundary the pde for the concentration profile eq 6 has an analytical solution given by 17 c z c 0 e z v b k where k is the diffusivity v b is the constant rise speed and c 0 is the concentration at the surface by using that the integral of the concentration over the entire water column should be unity we find the following analytic solution for the normalised average concentration in the top bin 18 1 δ z 0 δ z e z v b k d z 0 h e z v b k d z 1 92209134033411 strictly speaking the above expression is only approximate as eq 17 only holds for infinite water depth however due to the rapid exponential falloff it is accurate to about 36 decimal places in fig 3 similar results are shown for the same case of buoyant particles with a completely reflecting boundary but this time with a variable diffusivity given by eqs 16 again the left panel shows concentration profiles at five different times and the right panel shows the concentration in the top bin for both models we observe that also in this case a steady state is reached however we note that this time there is a visible discrepancy in the predicted steady state concentration of the topmost cell fig 3 right panel where the particle scheme predicts a concentration of 2 25304 m 1 while the grid model predicts 2 23698 m 1 in both cases an average over the interval from 5 to 6 h is taken this difference of about 0 7 is presumably caused by an artificial build up of particles near the boundary which occurs in the reflection step when the diffusivity profile has a non zero derivative approaching the boundary see ross and sharples 2004 and section 4 the comparison of the steady state predictions are summarised in table 1 and the observed discrepancy in the case of variable diffusivity will be analysed and discussed further in section 4 3 2 case 2 oil droplets in this case we consider particles with a rise velocity of 3 mm s which corresponds approximately to oil droplets with a density of 0 9 kg l and a size of 0 25 mm note that this value was somewhat arbitrarily chosen as an example and should not be seen as representative for oil spills in general the boundary at the surface is treated as reflective in diffusion but absorbing in advection this represents oil droplets being absorbed into the surface slick if they reach the surface due to buoyancy but not if they reach the surface due to diffusion see details in section 2 in this case we present results for the variable diffusivity profile only see eqs 16 the results of the simulation are shown in fig 4 again with concentration profiles for different times shown in the left panel the results from the lagrangian model are shown as continuous coloured lines while the predictions of the eulerian model are shown for the same times as dashed black lines in the right panel the fraction of material that remains in the water column i e the fraction that has not been absorbed into the surface slick is shown we again observe that the two different models give very similar predictions both for the concentration profiles and for the amount of oil remaining in the water column as a function of time in this case the steady state solution is that all the material has settled on the surface with no droplets left in the water column 3 3 case 3 oil droplets with resuspension in the final case we again consider particles with a rise velocity of 3 mm s which corresponds approximately to oil droplets with a density of 0 9 kg l and a size of 0 25 mm note again that this value was somewhat arbitrarily chosen as an example and should not be seen as representative for oil spills in general furthermore the boundary at the surface is treated as reflective in diffusion but absorbing in advection this represents oil droplets being absorbed into the surface slick if they reach the surface due to buoyancy in contrast to case 2 however this time the model includes resuspension at each timestep a constant fraction p 1 e δ t τ of the surface slick is resuspended into the water column this is equivalent to exponential decay of the amount of surface oil at a rate corresponding to a lifetime τ at the surface where we have arbitrarily chosen τ 500 s the resuspended oil is evenly distributed throughout the interval from z 0 to z l where the entrainment depth was also somewhat arbitrarily set to l 1 m as noted in section 2 the entrainment depth and rate as well as the droplet size distribution of the entrained oil will in general depend on the wave state and the properties of the oil see e g delvigne and sweeney 1988 johansen et al 2015 and li et al 2017 however these complications do not directly affect the discussion of the boundary conditions and are thus outside the scope of the current investigation this case has also been simulated with both constant and variable diffusivity the results of the simulations with constant diffusivity are shown in fig 5 in the same way as for case 2 i e with concentration profiles in the left panel and remaining submerged fraction as a function of time in the right panel we again observe that the two different models give very similar predictions both for the concentration profiles and for the amount of oil remaining in the water column as a function of time in this case a steady state is reached where a significant fraction of the material remains submerged this state is reached after about 4 h at the steady state the upwards drift due to buoyancy is exactly balanced by the combined downwards motion due to resuspension and diffusion in the presence of a reflecting boundary we observe that the two different models predict essentially the same time development of the remaining submerged fraction as well as very similar steady state level at steady state the predicted submerged fraction is 0 5005 in the particle model and 0 4998 in the grid model a discrepancy of about 0 14 here the average over the interval from 5 to 6 h was used the same situation as above has been simulated with the variable diffusivity profile given by eqs 16 and the results are shown in fig 6 again concentration profiles are shown in the left panel and submerged fraction as a function of time in the right panel a steady state is reached also in this situation and after about 3 4 h the submerged fraction remains approximately constant at steady state the predicted submerged fraction is 0 5659 for the particle model and 0 5667 for the grid model where the average from 5 to 6 h has been taken in both cases the results are summarised in table 2 4 discussion in this section we discuss some technical details of the reflecting boundary in the lagrangian particle model as well as our reasons for choosing to model the removal of oil from the water column via the boundary conditions in the eulerian scheme 4 1 boundary treatment in lagrangian models we mentioned initially that there are a number of somewhat subtle details that must be taken into account in formulating a particle model first among these are the correct formulation of the random walk to avoid unphysical transport away from regions of high diffusivity random walk schemes are essentially numerical integration methods for stochastic differential equations and there are a range of available methods at different orders of accuracy for a detailed survey of several alternative methods see e g gräwe 2011 and gräwe et al 2012 as well as specialist literature such as kloeden and platen 1992 in this paper we have chosen to use the visser scheme see visser 1997 for details while higher order methods may allow longer timesteps and better handle sharp transitions in diffusivity they will typically formulate the transport process as a single step that includes both random displacement and drift in this case rise due to buoyancy the visser scheme on the other hand allows us to handle the drift as a separate step this is convenient when we want to split the advection and diffusion steps to treat the boundary at the surface as reflecting in diffusion and absorbing in advection on the topic of reflecting boundaries in spatially variable diffusion ross and sharples 2004 has demonstrated that simple reflection is not strictly correct in our case when using the visser scheme with a reflecting boundary and a diffusivity profile whose derivative does not go to zero at the boundary one will observe a spurious increase in concentration of particles near the boundary 4 4 note that this effect is not unique to the visser scheme but may take a different shape with other schemes the effect can however be made arbitrarily small by choosing a sufficiently short timestep we demonstrate this with a numerical example as we have taken r in eq 2 to be uniformly distributed random numbers between 1 and 1 it is possible to calculate the maximum upwards and downwards displacements a particle can have at any position inspired by ross and sharples 2004 we introduce the parameters h 1 and h 2 to describe the range of possible displacements of a particle situated exactly at the reflecting boundary here h 1 is the maximum displacement of a particle moving away from the boundary while h 2 is the maximum displacement of a particle moving into the boundary followed by reflection note that our definition of h 1 differs from ross and sharples 2004 while h 2 is the same hence h 1 and h 2 for the boundary at the surface z 0 are in our case given by 19a h 1 k 0 δ t 6 δ t k 0 k 0 δ t 2 19b h 2 k 0 δ t 6 δ t k 0 k 0 δ t 2 these parameters indicate the size of the region affected by the spurious concentrations as a numerical example we consider a case with neutrally buoyant tracers in a finite depth of 10 m with the same diffusivity profiles as used earlier i e a constant k 3 1 0 3 m 2 s and a variable profile given by eqs 16 the diffusivity profiles are shown in fig 1 we employ an ensemble of n p 200 000 tracers initially distributed in a uniform manner in the whole domain and let the system develop for 12 h the resulting concentrations averaged over 12 h are shown in fig 7 where the calculations have been performed with four different timesteps δ t and the concentrations have been calculated by normalised particle counts in n b 5000 bins in principle the tracers should remain well mixed however as can be seen this is not the case close to the boundary when the variable diffusivity profile is used in each panel of fig 7 the parameter h 1 has been indicated by a horizontal dashed line while h 2 is indicated by a dotted line we observe that for a constant diffusivity h 1 h 2 and there is no spurious concentration effect for the variable profile on the other hand h 1 h 2 and hence there is a region of higher concentration close to the boundary followed by another region of reduced concentration we observe from eqs 19 that the size of the region with spurious concentrations is dependent on the timestep δ t as well as on the behaviour of the diffusivity profile near the boundary note in particular that if k z 0 0 the effect disappears provided the timestep is sufficiently short cf eq 3 for our case studies with variable diffusivity which were carried out with the diffusivity profile given by eqs 16 and a timestep of δ t 0 01 s we find that 20 h 1 0 007806 m h 2 0 007686 m while these values are smaller than the bin size used to calculate concentrations which was δ z 0 04 m we found in case 1 when a variable diffusivity was used a slightly increased prediction of the near surface concentration see fig 3 right panel when the particle model is compared to the eulerian model the effect was not observed for constant diffusivity in case 1 it was also not seen in cases 2 and 3 where any spurious accumulation at the surface is continuously removed by the combined effect of upwards drift due to buoyancy and the absorbing boundary condition in advection one might have expected an increase in concentration near the surface to lead to faster surfacing of the oil in cases 2 and 3 but no indication of this is found at the timestep length used here 4 2 boundary treatment in eulerian models in the current study we have chosen to describe the transition of oil from the water column to the surface slick via the boundary conditions in the eulerian scheme this is a natural way to describe the process as a droplet joining the surface slick will pass through a boundary at the oil water interface and join the continuous oil phase it also allows for a straightforward comparison between the lagrangian and eulerian schemes as the concept of the boundary at the surface exists in both as previously mentioned an alternative would be to formulate the disappearance of oil from the water column as a loss term or sink in the adr equation an example of such a formulation is found in tkalich and chan 2002 where the loss of oil to the surface slick is modelled by assuming the existence of a well mixed layer near the surface throughout which the oil concentration is constant at each timestep some fraction of the oil in this layer is lost to the surface where this fraction is determined from the rise speed of the droplets and the thickness of the well mixed layer in our opinion treating the surfacing of oil via the boundary conditions should be the preferred approach as it does not require any assumptions about the existence of special layers in formulating our eulerian model we have assumed that the transport and mixing of buoyant material in the water column can be described by the advection diffusion equation with the diffusivity given by an eddy diffusivity profile and that the buoyant material can optionally leave the water column through its natural boundary at the surface to form a continuous floating slick 5 conclusion we have analysed a lagrangian particle model for vertical transport mixing surfacing and optionally resuspension of buoyant materials such as oil droplets microplastics and fish eggs the lagrangian model is compared to an eulerian model based on direct numerical solution of the adr equation we have described how to treat the boundary at the surface in order to model materials that form a slick at the surface such as oil as well as non slick forming materials such as plastics and fish eggs in particular we demonstrate that treating the surface in the particle model as completely reflecting is equivalent to solving the adr equation with a robin boundary condition ensuring no flux across the boundary moreover we have demonstrated that treating the surface in the particle model as absorbing in advection and reflecting in diffusion gives the same results as solving the adr equation with a neumann boundary condition enforcing zero diffusive flux while allowing an advective flux we also consider the effect of entrainment of surface oil due to waves in both models and again demonstrate that consistent results emerge while it is likely that many particle based oil spill models use a similar approach to the one outlined in section 2 1 an explicit description and analysis of the steps involved in surfacing has to the best of our knowledge never appeared in the literature furthermore while most oil spill models are based on lagrangian particle schemes eulerian oil spill models exist and are being developed see e g tkalich et al 2003 and restrepo et al 2015 hence it is a point of some importance to have an understanding of how to formulate equivalent descriptions in the two schemes acknowledgements the authors would like to thank their colleagues for many an interesting discussion in the sintef coffeelab the work has been performed partially under the project hpc europa3 infraia 2016 1 730897 with the support of the ec research innovation action under the h2020 programme in particular t n gratefully acknowledges the computer resources and technical support provided by the epcc appendix a details on the implementation of the eulerian finite volume method in fvms the partial differential equation is transformed to integral form by integrating over a control volume ω j corresponding to cell j considering eq 6 the volume integrals on the right hand side may then be rewritten to surface integrals over the boundary of the control volume through the divergence theorem by applying the leibniz integral rule on the left hand side to change the order of the spatial integral and the differentiation with respect to time the average concentration in control volume ω j c j may be defined similarly on the right hand side the average reaction term in the control volume s j is found by integration since only flow in the vertical z direction is considered the left hand side of eq 6 reduces to the change of the cell average concentration per unit of time in the control volume with the grid spacing δ z j z j 1 2 z j 1 2 moreover the right hand side is given by the difference of the diffusive and advective fluxes at the bottom and top faces of the control volume z j 1 2 and z j 1 2 depth positive downwards respectively with the addition of the cell average source term in the control volume with the grid spacing δ z j thus the integral form of eq 6 reads a 1 δ z j d c j d t k c z j 1 2 k c z j 1 2 v c j 1 2 v c j 1 2 δ z j s j which is noted to be an exact equation now the concentration is assumed to be constant within each control volume such that the cell averages c j and s j may be approximated by the values located at the cell centres z j that is c j and s j respectively assuming a constant grid spacing δ z the z axis is thus discretised into n j equidistant control volumes or cells a similar derivation may e g be found in versteeg 2007 pp 243 246 considering the cell adjacent to the surface boundary notated as j 0 the insertion of the absorbing surface boundary condition of eq 8 into eq a 1 causes the diffusive flux over the surface to vanish thus eq a 1 reduces to a 2 δ z d c 0 d t k c z 1 2 v c 1 2 v c 1 2 δ z s 0 where j 1 2 corresponds to the surface boundary moreover as noted in section 2 2 1 if the velocity over the surface is zero the advective flux over the surface also vanishes making the surface a reflecting boundary similarly in the cell adjacent to the bottom boundary i e j n j 1 inserting the reflecting boundary condition from eq 9 into eq a 1 causes both the diffusive and advective fluxes over the bottom boundary to disappear hence eq a 1 reduces to a 3 δ z d c n j 1 d t k c z n j 1 2 k c z n j 3 2 v c n j 1 2 v c n j 3 2 δ z s n j 1 where j n j 1 2 corresponds to the bottom boundary in eq a 1 the diffusive fluxes at the cell faces were approximated by a second order central difference of the two adjacent cells see e g versteeg 2007 p 117 that is on the form a 4 k c z j 1 2 k j 1 2 c j 1 c j z j 1 z j k j 1 2 c j 1 c j δ z where the diffusivity k j 1 2 is determined on the cell faces either explicitly by an analytic expression or by an arithmetic or harmonic mean in the case of a discrete diffusivity for the advective fluxes however it is noted that linear numerical schemes of second order accuracy and higher are known to yield numerical oscillations for advection dominated problems that is when the cell péclet number pe v δ z k 1 for non smooth solutions hundsdorfer 2003 pp 66 67 118 119 consequently in order to implement a more flexible higher order numerical scheme that is higher than first order in this case for advection flux limiting was used to approximate the advective fluxes as a first order upwind flux with a higher order correction depending on a limiter function pp 216 217 hundsdorfer 2003 pp 165 171 versteeg 2007 the approximation of the advective fluxes thus takes the form a 5 v c j 1 2 v j 1 2 c j 1 2 ψ ρ j 1 2 c j 1 c j v j 1 2 c j 1 1 2 ψ ρ j 1 2 c j 1 c j where ψ ρ is the limiter function determining the correction and ρ is given by a 6a ρ j 1 2 c j c j 1 c j 1 c j a 6b ρ j 1 2 c j 2 c j 1 c j 1 c j i e the local ratio of the upwind gradient to the downwind gradient pp 167 171 172 versteeg 2007 p 216 hundsdorfer 2003 the flux limiting was done with a quick quadratic upstream interpolation for convective kinetics limiter function given by a 7 ψ ρ max 0 min 2 ρ 3 ρ 4 2 where ψ ρ 3 ρ 4 corresponds to the quick scheme and resulted in second order accuracy see e g versteeg 2007 pp 170 178 according to versteeg 2007 pp 167 168 higher order accuracy without oscillatory behaviour for non smooth solutions is attained if the scheme is monotonicity preserving i e that it does not create local extrema and does not increase or decrease existing local maxima or minima respectively such monotonicity preserving schemes will have the property of being total variation diminishing tvd that is that the total variation t v ϕ j 1 n j ϕ j ϕ j 1 does not increase over time versteeg 2007 p 168 as noted in versteeg 2007 pp 168 171 flux limiter functions were derived to satisfy a number of criteria which ensures that the resulting scheme is tvd and second order accurate the scheme was discretised in time according to eq 1 and integrated by the crank nicolson method or implicit trapezoidal rule given by a 8 c j n 1 c j n δ t 1 2 f j n 1 2 f j n 1 where f corresponds to the right hand side of eq a 1 evaluated at time steps n and n 1 this was utilised in order to get second order accuracy in time and favourable unconditional stability versteeg 2007 pp 247 248 by including the higher order correction of the flux limiting as an additional source term that is as a deferred correction see versteeg 2007 pp 163 164 172 the scheme may be written as a system of equations that must be solved for each time level n 1 by defining a tridiagonal matrix of coefficients the tridiagonal system of equations was at each time level solved by the tridiagonal matrix algorithm tdma or thomas algorithm see e g pletcher 2013 pp 150 151 however due to the nonlinearities appearing in the source term and the deferred correction an iterative approach must be used to update the coefficients until an acceptable solution is found at the n 1 time level see e g pletcher 2013 p 440 it is noted in hundsdorfer 2003 p 232 that the implicit trapezoidal rule for a pure advection problem is tvd for courant numbers c v δ t δ z 1 appendix b details on the choice of timestep and number of particles in a lagrangian particle model there are two main numerical parameters that control the accuracy the timestep δ t and the number of particles n p ideally the modelled result will converge to the correct solution which may or may not be known as δ t becomes smaller and n p becomes larger when using a particle method each particle position constitutes a sample from the true distribution of positions hence the random noise that is seen when using few particles is not a systematic error but rather an indication that the sample distribution has not yet converged to the true distribution for practical applications this amounts to a random error in the modelled concentration field the convergence with number of particles is 1 n p which means that increasing the number of particles by a factor 10 only reduces the error by a factor 1 10 the computational effort on the other hand increases linearly with n p the scaling of the error with the timestep depends on the chosen random walk scheme in this paper we have used the visser scheme which has order of convergence 1 in the weak sense gräwe 2011 technically this means that the error in the moments of the modelled distribution as compared to the moments of the true distribution will scale as δ t for sufficiently small δ t kloeden and platen 1992 pp 326 327 higher order random walk schemes exist although many have the drawback that one must evaluate higher order derivatives of the diffusivity see e g gräwe 2011 gräwe et al 2012 and kloeden and platen 1992 however in the special case of constant drift and constant diffusivity i e for a stochastic differential equation sde given by b 1 d z a d t b d w t where a and b are constants all schemes reduce to the euler maruyama scheme maruyama 1955 pavliotis 2014 page 146 given by b 2 z n 1 z n a δ t b δ w where δ w is a gaussian random variable with mean δ w 0 and variance δ w 2 δ t for this reason we chose to use case study 1 with constant diffusivity see section 3 1 to carry out a convergence test in order to determine a suitable timestep and number of particles as in the results for case 1 we have calculated the average concentration in the top δ x 0 04 m of the water column using the particle method with different δ t and n p we then calculated the error in the modelled result by subtracting the analytical solution see eq 18 in fig b 8 the results of the convergence test are shown in the left hand panel we have used n p 19 200 we observe that the error scales linearly with δ t down to a relative error of about 3 1 0 3 from this point the error due to too few particles dominate and there is no additional accuracy gained by reducing the timestep further in the middle panel with n p 192 000 we observe that increasing the number of particles by a factor 10 has improved the accuracy by a factor of about 1 10 in this case improved accuracy with reduced timestep is seen down to an error of about 10 3 finally in the right hand panel the particle number is again increased tenfold to n p 1920 000 it is again clear that the increase in number of particles has led to an increased accuracy and the timestep can profitably be decreased even further the convergence test indicates that with the numerical parameters used in the case studies n p 960 000 and δ t 0 01 s we may reasonably expect a relative error of about 5 1 0 4 for the case with constant diffusivity which is what we see in case 1 note also that changing to a higher order sde scheme would not improve the accuracy when constant drift and diffusivity is used as the correction terms in higher order schemes typically contain derivatives of the drift and diffusivity and the drift and diffusivity are the same no matter where they are evaluated gräwe 2011 gräwe et al 2012 kloeden and platen 1992 a final point related to the number of particles is that this will depend on how the concentration field is calculated one option is that one could use larger bins when counting particles to calculate the concentration as larger bins will contain more particles the results are then less susceptible to random fluctuations the trade off is a loss in resolution in that features smaller than the bin size cannot be resolved in this paper we have chosen to use a fairly small bin size of δ x 0 04 m both for the eulerian and the lagrangian models the intention was to facilitate a direct comparison and to study the details of the behaviour near the boundary in practical applications such as in oil spill modelling the bin size would more likely be on the scale of metres rather than centimetres and this would significantly reduce the need for a large number of particles another commonly used approach which may further reduce the need for large particle numbers is to apply some kind of smoothing to the concentration field instead of using the box counts which are equivalent to a histogram of particle positions lynch et al 2014 chapter 8 discusses some different options including kernel estimators also known as kernel density estimators silverman 1986 with a kernel estimator the concentration field in one dimension is calculated as b 3 c z 1 n p λ i 1 n p κ z z i λ where the sum is over particles and z i is the position of particle i the kernel κ z can be any positive function that satisfies κ z d z 1 and λ is called the bandwidth for the same number of particles a kernel estimator can give a smoother and more accurate representation of the concentration field compared to the box count approach the results depend on both the kernel and the bandwidth the choices of which depend among other things on the number of particles see e g spivakovskaya et al 2007 for the current study we have chosen not to apply kernel estimators as the focus of the investigation is on the boundary conditions and not on the concentration field 
24048,a method to construct transport matrices from standard ocean model output such as mean volume fluxes and mixed layer depths is presented these transport matrices enable highly efficient calculation of deep water tracer fields that otherwise require long integrations with forward time stepping ocean models comparisons of matrix solutions for ideal mean water age demonstrate that the transport matrices are reasonably accurate representations of the transport in the parent ocean models tracer fields calculated using transport matrices provide simple circulation metrics that can be compared to observations we compare matrix computed radiocarbon distributions from two versions of access ocean models with observations we find matrices based on both models produce realistic circulations the radiocarbon distribution based on access forced with core climatology fits observations better in the deep pacific whereas the fully coupled access1 3 model fits observations better in the deep atlantic when applied to the circulations of access1 3 climate change experiments the transport matrix solutions show an increase in radiocarbon depletion or water age in the projected ocean circulation for the 2090s under the rcp8 5 scenario by computing the water mass fractions last ventilated from specific regions we diagnose a corresponding progressive shutdown in antarctic bottom water formation the volumetric decrease in antarctic waters in the global ocean is compensated by an increase in waters last ventilated in the subantarctic and southern subtropics keywords transport matrix ocean ventilation global ocean modelling tracers ideal mean age 1 introduction the oceans have the capacity to store and release huge amounts of heat and carbon making them an important component of the climate system the deep ocean circulation is crucial to the modulation of the earth s climate on centennial and longer timescales rhein et al 2013 natural radiocarbon has provided important insights into the deep ocean circulation and simulations of natural radiocarbon provide a valuable way to assess the simulated deep ocean ventilation e g toggweiler et al 1989a 1989b however it takes many millenniums for the deep ocean natural radiocarbon to reach steady state therefore numerical ocean general circulation models ogcm need long integration times which is computationally expensive there are several ways to reduce the computational requirements to equilibrate passive tracers one approach is to use an off line version of the ogcm in which tracers are advected and diffused from archived circulation output of the ogcm ribbe and tomczak 1997 while this allows the use of somewhat longer time steps the computational expense is still very large a second approach is to initialise the model with an initial state closer to equilibrium by integrating a coarse resolution offline model that is much more efficient to integrate aumont et al 1998 a third approach is to use a transport matrix built from an ogcm to represent the advection diffusion operator khatiwala et al 2005 khatiwala 2008 the attraction of the matrix transport method is that it provides a highly efficient way to solve the steady state distributions of passive tracers and many transport diagnostics for example devries and primeau 2011 used a data assimilated transport matrix derived from observations of temperature salinity radiocarbon sea surface height and buoyancy fluxes to calculate the fractions of the interior ocean volume that were last ventilated in specified surface regions such as the southern ocean and north atlantic the transport matrix can also be used to determine surface to surface and surface to interior pathways e g primeau 2005 holzer and primeau 2006 2008 gebbie and huybers 2010 finally the transport matrix also allows for highly efficient formulations of biogeochemical models so that their parameters can be objectively analysed for example the phosphate cycle kwon and primeau 2006 primeau et al 2013 holzer and primeau 2013 fu and primeau 2017 silicon cycle holzer et al 2014 holzer and brzezinski 2015 iron cycles frants et al 2016 pasquier and holzer 2017 and radiocarbon bardin et al 2014 here we use the transport matrix approach to find the steady state solutions for water age natural radiocarbon and to map constituent water masses according to regions of their last ventilation the transport matrix representing an ocean s advection diffusion operator for a given circulation can be constructed using several different techniques the matrix can be built with injected tracer pulses at each grid point and using resulting output to construct the underlying advection diffusion operator khatiwala et al 2005 here we use an approach analogous to primeau 2005 where the saved mean advective transports eulerian and eddy components diffusivities horizontal and vertical and upper ocean mixed layer depths are used to build the transport matrix we use time means of archived circulation fields from selected decades for this purpose the layout of the paper is as follows section 2 describes the parent ogcms and the construction of the transport matrices from the ogcm archived circulation we show that the transport matrix produces good respresentations of ideal mean water ages simulated directly with the ogcms in section 3 we use the transport matrix to compute the steady state radiocarbon field and water mass fractions we then build transport matrices for different climate simulations to quantify how the deep ocean circulation and ventilation change between the pre industrial and the projected rcp8 5 climates 2 method 2 1 models used 2 1 1 ocean ice model the longest forward model integration for this project was an ocean only configuration of the australia community climate earth system simulator access which was run for1000 s of years the model is based on bi et al 2013 using the same ocean model mom4p1 griffies 2008 grid and ocean parameters the sea ice model in this experiment is the sea ice simulator as used in gfdl s climate model cm2 1 delworth et al 2006 the access grid is spherical over most of the globe with 1 degree resolution in longitude latitude resolution varies resolution is 0 330 within 100 of the equator increasing to 10 at 300 north and south south of 300 the resolution is mercator becoming 0 250 at 750 s a tripolar grid over the arctic is used to avoid the north pole singularity the long integration was forced with atmospheric reanalysis fields used in the coordinated ocean reference experiment core griffies et al 2009 vertical resolution is 10 m in the upper 200 m and 300 m at the maximum depth of 5000 m the vertical coordinates are zstar which scale with surface height in time the upper ocean is mixed with the k profile parameterisation kpp scheme and vertical background diffusivity of 2 2 5 10 5 m 2 s 1 higher values near poles the biharmonic friction scheme is used and neutral physics includes redi diffusivity 600 m 2 s 1 and gent mcwilliams skew diffusion 2 1 2 atmosphere ocean ice model matrices are also built with output from access coupled model version 1 3 access1 3 experiments submitted to the coupled model intercomparison project cmip phase 5 bi et al 2013 the set up of the ocean model is the same as the ocean only model described above and is coupled to the los alamos sea ice model cice version 4 1 e g flocco et al 2012 the atmospheric component of access1 3 is the unified model um version 7 3 from the met office hadgem2 development team et al 2011 in this work we have produced several matrices based on the access1 3 historical and rcp8 5 scenarios time independent matrices are built on decadal averages of circulation to minimise any impact of year to year variability decades used are 1890 1899 1990 1999 2040 2049 and 2090 2099 2 2 matrix construction and evaluation the following subsections firstly discuss the application of the transport matrices to solving steady state distributions of ocean tracer fields the mean water age tracer in particular is presented for which a steady state solution was also found with the forward ocean model for comparison the next subsections describe the construction of the transport matrices used here the results of which are compared to the forward model extra details regarding the matrix construction may be found in the appendix 2 2 1 matrix formulation in this method a tracer field in the ocean is represented as a vector χ an array of 2 6 106 values for access ocean models the time tendency of this tracer due to physical advection eddy diffusion and vertical mixing is given by a χ where a is the discretised advection diffusion operator organised into a matrix a is what we refer to as the transport matrix a very sparse matrix with 2 107 non zero elements representing 0 0003 of the total entries corresponding to exchanges between nearest neighbours in the real ocean the time tendency of the tracer becomes 1 d d t χ a χ b where b is a vector form of tracer sources and sinks when b is a constant vector the steady state solution a χ b is solved via standard matrix methods essentially lu factorisation followed by back substitution often loosely referred to as matrix inversion we used the pardisio sparse matrix package within the intel math kernel library to solve this linear system if the sources and or sinks b depend nonlinearly on the tracer concentration χ then eq 1 becomes after discretisation onto the numerical grid a system of non linear coupled algebraic equations this occurs for example for nutrient tracers whose biological sink in the upper ocean uptake can be represented with a monod limiting term of the form χ χ k where k is constant in such nonlinear cases eq 1 can still be solved efficiently by for example newton solvers pasquier and holzer 2017 these solvers typically converge in of the order of 10 steps a vast improvement in the computational efficiency over time stepping a forward model to find the steady state here we only consider linear tracers specifically ideal mean water age water mass fractions and radiocarbon as detailed below 2 2 2 water age and forward model solutions water age tracer fields are readily calculated from transport matrices and can be compared to age tracers from forward models to assess how well matrices simulate the forward model circulation particularly in the deep ocean solving for the steady state solution involves applying the boundary condition that water age at the ocean surface is zero and a uniform age source of one second per second in the ocean interior since the source vector b is constant the solution can be found by a single matrix inversion fig 1 shows water age trends in the deep north pacific defined here as the average from 160 2200e 20 600n and below 2000 m representing part of the ocean with the longest timescale several water age tracer trends are shown here initialised from solutions of various matrices discussed below and integrated forward in time with the parent ocean model the physical circulation of the ocean model had already been spun up for 1000 years in each case the age tracer converges towards a common state within the forward model regardless of initial condition as expected some age tracer trends shown in fig 1 were initialised with solutions from matrices constructed with a specialised transport matrix tracer package available in the mom4p1 release khatiwala et al 2005 griffies 2008 this tracer package uses unique puff tracers at every grid point and every time step to extract transport matrix elements calculating separate matrices for explicit and implicit processes it is important to note however this package is different to the method to construct matrices described and used in the following sections also shown in fig 1 are lines labelled dpmixxx which are age trends initialised with matrices that are described in following sections the range of tracer fields in fig 1 include initialisations that both under and overestimate the final state of the ocean model s age tracer but all converge to the same age and are shown here just for demonstration the solution from only explicit processes exp has no vertical mixing and overestimated deep water ages while including vertical implicit mixing exp imp underestimated water ages the low age bias of the exp imp solution is consistent with the results of bardin et al 2016 who found that ages derived from annual averages of transport were younger by 12 relative to ages found with better temporal resolution a matrix combining the explicit matrix with well mixed upper oceans exp upocn produced an initial state that resulted in the least drift after 1000 years of forward integration this case was integrated a further 1000 years and is used as the forward solution of the water age for the ocean model and a reference for matrix solutions the drift in the deep north pacific ages of this integration was less than 3 years over this 1000 years integrating this tracer an extra 1000 years had negligible effect on the correlations listed below changes were in the 3rd significant figure correlations and deep water ages from various matrix age solutions are compared in table 1 and the taylor diagram in fig 2 matrices exp imp and exp upocn produce reasonable correlations 0 960 and 0 948 respectively table 1 indicating these matrices give a good representation of the parent ocean models circulation however these matrices can only be constructed from experiments with specialised transport matrix tracers other solutions listed in table 1 dpmixxx are constructed using generic ocean model output such as water transport and mixed layer depth as described below 2 2 3 advection time tendencies of tracers due to advection from neighbouring cells could be calculated from ocean model velocities however using volume transports is preferable since these include effects from changes in sea level and partial cells in the ocean model affecting tracer advection archived horizontal volume transports are used vertical transports are calculated from the divergence of the horizontal components to ensure volume conservation eddy induced transports from the gent mcwilliams component of the neutral physics scheme are also included in summary the time tendency of a tracer due to advection from neighbouring cells is the average volume transport from that neighbour normalised by the cell volume similarly transports out of the cell are loss terms the appendix a has a schematic of the tracer grid and fluxes and eq a 2 that demonstrate the terms used to calculate the advective components of the transport matrix the matrix built with just these diagnosed transports produces an age solution that has a reasonable correlation with the forward solution advection only in table 1 r 0 931 however this solution also has the oldest of the water ages shown since this matrix is missing various ocean model subgrid processes reducing the connection of the ocean interior to the surface and increasing the water age 2 2 4 vertical and horizontal mixing a matrix of tracer mixing is added to the advection matrix above to improve deep ocean solutions tracer exchange by mixing is calculated vertically and horizontally just between neighbouring tracer cells using grid information such as displacement and interface areas between cells see appendix a for a schematic and equation showing the various terms the ocean is divided into two regions for vertical mixing a well mixed upper ocean and a deep ocean with background mixing uniform diffusion coefficients are applied in these regions the depth of the upper ocean here is defined by the maximum in seasonal mixed layer depths from corresponding forward ocean model experiments and varies spatially from a few tens of metres to a few hundred metres in the tropics and midlatitudes in high latitudes there are regions of deep mixing to several hundred metres along the subantarctic zone and in the north atlantic and locations with mixing to over 1000 m in antarctic seas uniform horizontal mixing is included as a simplified approximation for isopycnal mixing ideal mean water age solutions with various components of ocean circulation and mixing are compared to the forward solution in table 1 and shown in fig 2a the biggest improvement from the advection only solution comes from the inclusion of upper ocean vertical mixing which improves both the correlation r and reduces the age to be closer to the forward solution consistent with the importance of vertical connections in major water formation regions in setting global tracer distributions the inclusion of background diffusivity produces small improvements in both r and age horizontal mixing substantially improves the age with a minor effect on r the values tested for tracer diffusivities were based on physically reasonable estimates and compared to the forward age solution fig 2b compares solutions from various combinations of mixing parameters diamonds show the effect of varying deep ocean background diffusivity 10 4 10 6 m 2 s 1 triangles show different horizontal eddy diffusivity 10 2 10 3 m 2 s 1 crosses are results from a range of upper ocean mixing 0 001 1 0 m 2 s 1 the circle is the solution using preferred diffusivity values upper mixing 0 1 m 2 s 1 deep diffusivity 3 10 5 m 2 s 1 and horizontal mixing 5 10 2 m 2 s 1 for diffusivity values explored here increasing vertical mixing in deep water decreases the mean water age in the deep north pacific and the standard deviation the best r values are found with small deep mixing diffusivities though the associated water ages are substantially greater and solutions plot further away from the reference point on the taylor diagram the deep water vertical mixing value is also close to the background mixing of the forward model 2 2 5 10 5 m 2 s 1 increasing mixing in the upper ocean gives small improvements to r which we use but we also stay within a range of mixing coefficients diagnosed by the ocean model of the order of 0 1 m 2 s 1 in the upper ocean increasing horizontal mixing or eddy diffusivity also reduces water ages and improves r however excessive horizontal mixing degrades the correlation the value of horizontal mixing that gave the best solution from tuning in fig 2b is close to the neutral isopycnal diffusivity used in the ocean model experiment 600 m 2 s 1 2 2 5 comparing matrix and forward model tracer fields various matrix derived water age fields are compared in fig 3 to the forward solution g h without horizontal mixing c d the solution shows small amplitude high frequency features that are unrealistic for deep ocean tracers in fig 1 a solution with higher background mixing dpmix1e 4 e and f has a deep north pacific age closer to the stable forward solution than the preferred matrix dpmix3e 5 a and b however this higher mixing solution has a lower correlation coefficient and is further from the reference solution in fig 2b in fig 3e the depth of maximum age of dpmix1e 4 is deeper relative to the forward solution in the preferred solution a b the oldest water is close to the correct age and has the right depth and extent giving a better representation of the forward model circulation fig 4 shows a joint probability distribution of ideal water ages from the preferred matrix and the reference forward model the joint distribution can be thought of as a binned volume weighted scatter plot most of the ocean falls close to the 1 1 line there is a slight young bias 50 years in waters of intermediate age 400 600 years whereas oldest waters such as in the deep north pacific are biased old 50 100 years some outliers occur such as poorly connected parts of the arctic ocean which are younger in the matrix derived field relative the forward model and even the mediterranean which is older in the matrix field however the age of most of the ocean volume is well represented in the matrix solution 3 comparing circulation of different models and climates using the structure of the preferred matrix found in sections 2 2 3 and 2 2 4 upper mixing 0 1 m 2 s 1 deep diffusivity 3 10 5 m 2 s 1 and horizontal mixing 5 10 2 m 2 s 1 we now consider transport matrices constructed from transports and mixed layer depths of other forward ocean model experiments testing different model setups and climate scenarios these matrices are then used to calculate radiocarbon distributions which enable comparisons of these simulations and their tracers to observations we also calculate the water volumes last ventilated in various regions or water masses and for various climate scenarios tracer distributions in the deep ocean are our primary interest 3 1 radiocarbon we now consider steady state radiocarbon fields computed with transport matrices based on ogcm simulations of the contemporary climate fig 5 compares the matrix derived radiocarbon field for the access ocean with core forcing left column and the access1 3 1990s middle with the glodap observations right key et al 2004 water ages are less than the half life of carbon 14 5730 years so the decay of carbon 14 is approximately linear on ocean timescales hence the radiocarbon distribution is similar to water age fields shown before particularly in the deep ocean near the air sea surface however radiocarbon is in disequilibrium the equilibration time scales for radiocarbon is months to years for reasonable mixed layer depths using exchange rates from toggweiler et al 1989a whereas ideal age tracers equilibrate instantaneously ocean radiocarbon is shown in units of δ carbon which is the change in the isotope ratio of carbon 14 to carbon 12 per mil relative to atmospheric values before nuclear weapons testing toggweiler et al 1989a solving for the steady state radiocarbon solution is similar to solving for water age described before the surface boundary condition is the carbon 14 carbon 12 ratio taken from the glodap pre bomb database key et al 2004 and this ratio decays in the ocean interior with the carbon 14 half life the overall structures of radiocarbon depletion in fig 5 from access ocean and access1 3 experiments are similar in the pacific top row radiocarbon sections from both experiments are very similar to the observed radiocarbon access ocean radiocarbon is slightly more depleted older than observations while access1 3 is less depleted younger and upper ocean waters penetrate deeper there are small discrepancies between models and observations in the top few hundred metres by assuming rapid mixing down to the winter maximum mixed layer depths modelled radiocarbon fields mix surface boundary conditions to depths of the order of 100 m observed radiocarbon has significant vertical gradients in the top few tens of metres due to disequilibrium across the air sea surface and shallow average mixed layers both models show older water in the deep southern ocean and more bottom water penetration into the pacific basin relative to the observations in the atlantic access1 3 has a more realistic representation of north atlantic deep water whereas the access ocean has abyssal water pooling and ageing in the north atlantic the observed radiocarbon distribution also shows old depleted waters in the abyssal south atlantic which are not seen in model solutions models may be missing a connection of pacific abyssal water into the atlantic basin however further investigation of this feature is beyond the scope of this work 3 2 water mass fractions devries and primeau 2011 use a data constrained ocean circulation model which assimilates observations of heat salinity and radiocarbon tracers in addition to observed sea height and surface fluxes of heat and fresh water and estimate the volume fraction of the ocean last ventilated in various surface regions here we calculate corresponding volume fractions using our model derived transport matrices fig 6 shows surface regions we use for this purpose these regions were defined using the same criteria used by gebbie and huybers 2010 and devries and primeau 2011 antarctic and subantarctic water are separated by the 1027 1 k g m 3 isopycnal the 35 0 psu isohaline divides subantarctic and subtropical waters the tropical waters are within the 25 c isotherm subtropical and subarctic waters are separated by the 34 0 psu and 35 4 psu isohalines in the pacific and atlantic oceans respectively the arctic source region is based on geography to define these regions we used the model s climatology the calculated volume fractions last ventilated from each region for the contemporary access experiments are compared to the corresponding results from devries and primeau 2011 in table 2 uncertainty estimates from devries and primeau 2011 are included uncertainty from access experiments are estimated from the range of volume fractions calculated from two 5 year averages of circulation for the access ocean these ranges were less than the level of significance reported in all cases the ocean volume is dominated by water from antarctica and the north atlantic with only small contributions from the tropics and subtropics both access models underestimate the contribution of water from the subarctic which includes the north atlantic deep water though access1 3 contributions are closer to values of devries and primeau 2011 consistent with the more realistic atlantic radiocarbon tracers in fig 5 antarctic waters are the largest water mass fraction in all solutions however the access ocean solution overestimates the contribution relative to devries and primeau 2011 while access1 3 underestimates the volume contributions from tropical and subtropical waters estimated by devries and primeau 2011 are all smaller than for the access models with zero contribution reported from the tropics however the tropical contributions from our matrix solutions of a few percent are reasonable considering a typical mixed layer depth of 100 m is a few percent of the water column and the tropics cover a large fraction of the ocean surface the access1 3 contributions from the tropics and subtropics are higher than access ocean consistent with the observation of deeper surface mixing in radiocarbon in fig 5 3 3 effect of changing climate we now characterise the response of the ocean circulation to climate change in terms of water mass fractions and water ages from different phases of the access1 3 historical and rcp8 5 experiments note that tracer fields shown are steady state solutions to matrices however the circulations represented by these matrices are transient and responding to a changing climate water ages are very similar from transports from the 1890s not shown and the 1990s left column of fig 7 deep north pacific ages are 1127 and 1189 years respectively for regions compared in section 2 2 2 the overall pattern of water age is similar in all climates shown however pacific waters are substantially older for steady states based on future circulations north atlantic deep water does not penetrate as deep for the future circulation and older water extends further across the atlantic basin and pools in the abyssal north atlantic note again that these are steady state solutions the mean water age at depth would not have doubled by 2090 but these solutions indicate a halving in the exchange with the upper ocean in the future climate like water age volume fractions of water masses from the 1890s and the 1990s are very similar table 3 in contrast the volume fractions for the 2090s circulation are quite distinct the solution for the 2040s circulation shows the same pattern of changes but with smaller magnitudes the most significant feature of the 2090s circulation is the shutdown in formation of antarctic bottom water the combined antarctic regions ventilated 30 to 35 of the global ocean volume in the 1890s and 1990s which drops to a mere 4 in the 2090s by contrast north atlantic deep water contributions to the global volume the major component of subarc table 3 is relatively constant the drop in the antarctic contribution is compensated by increases in ventilation from all other regions in particular the subantarctic and southern subtropical regions the shutdown of antarctic bottom water can also be seen in pacific sections of water mass fractions fig 8 deep waters of the southern ocean south of 600s were almost entirely antarctic water in the contemporary circulation in the 2090s antarctic ventilated water only penetrates down to a few hundred metres bottom row the main change in the extent of subarctic water which includes north atlantic deep water is to extend into the southern ocean in this pacific section top row the fraction of water from the tropics increases with climate change though the change is limited second row the extent of water from the subantarctic and southern subtropics clearly increases third and fourth rows encroaching into the deep ocean and transported across the global ocean we emphasise that the ocean state in the 2090s for example will not be in steady state should the climate of the 2090s be maintained for an extended period centuries deep water properties would eventually adjust and antarctic bottom water formation would resume at some timescale producing circulations different to those presented here the weakening of deep circulation in a changing climate has been noted before both in reviews of cmip climate projections e g marsland et al 2013 heuzé et al 2015 and in observations indicative of changes already occurring de lavergne et al 2014 marsland et al 2013 show considerable reduction in the antarctic bottom water circulation in the access1 3 simulations of rcp4 5 and rcp8 5 from early in the 21st century these circulations changes correspond to decreases in winter mixed layer depths in antarctic seas maximum mixed layers from access1 3 are up to 5000 m in the ross and weddell seas early in the 21st century which shoal to a few hundred metres by 2100 for rcp8 5 there is a similar story in the north atlantic although the rate of decrease in north atlantic deep water and mixed layer depth reduces after 2050 here heuzé et al 2015 also find a weakening in the deep circulation and a strengthening in the upper ocean circulation in a survey of cmip5 projections de lavergne et al 2014 argue that the1970 s weddell sea polynya event was a more regular event in the past and its recent absence is consistent with the observed freshening of the upper southern ocean in the current climate the work presented here highlights this weakening of the deep circulation showing the dramatic decrease in the contribution of antarctic waters to the global ocean in projected circulations this has major implications for the storage of heat and carbon in future climate scenarios 4 summary and conclusions the ocean circulations of global climate models are explored using transport matrices both to compare transport metrics to observations and to demonstrate the effects of changing model climate matrices are constructed from standard ocean model output specifically mean volume transport fields and mixed layer depths together with empirically determined values for vertical and horizontal diffusivities in the deep and upper ocean that are consistent with parameters of the parent ocean models this technique does not require any special tracer packages to be run in the forward ocean model it is therefore possible to build these matrices from archives of ocean and climate simulations these matrices then provide a numerically highly efficient means for probing various aspects of the transport and biogeochemistry of the parent models correlations between water age solutions from transport matrices and forward models are very high demonstrating that our matrices capture the parent model s transports with good fidelity radiocarbon distributions from the access ocean model forced with core boundary conditions and the historical access1 3 experiment both resemble observed fields radiocarbon in access core is closer to observations in the pacific basin while access1 3 gives a better representation in the atlantic the access core based matrix overestimates the volume fraction of the ocean that was last ventilated in antarctic waters whereas access1 3 underestimates this fraction using the transport matrix based on the access1 3 climate projection for the 2090s under the rcp8 5 scenario we show an increase in radiocarbon depletion and reduction in the fraction of global ocean last ventilated around antarctica pointing to a shutdown in projected antarctic bottom water formation the radiocarbon fields and water mass fractions for the 2040s circulation show similar changes to those seen in the 2090s albeit with smaller amplitudes the decreased water from antarctic regions is compensated by an increase in water volume from other regions in particular from the subantarctic and southern subtropics changes in deep circulation are important because they directly affect the ocean s ability to store heat and carbon which in turn impacts the future climate including the projected sea level changes future applications of our method to generate transport matrices are numerous matrix derived tracer fields may be used to provide spun up deep water initial conditions for forward models greatly reducing the computational expense required to equilibrate these dynamical forward models transport matrices also enable the efficient computation of deep biogeochemical fields such as the distributions of phosphate nitrate dissolved iron silicic acid and their isotopic ratios in various climate scenarios these fields have long timescales and are expensive to integrate exclusively in forward ocean models but can be very efficiently solved for steady state using newton or newton krylov solvers or even direct matrix inversion when the source sink terms are linear as in examples shown here being able to efficiently find nutrient and trace metal distributions will be invaluable for understanding both future and past biogeochemical cycles acknowledgements this research used computation resources and archives available at the national computational infrastructure nci which is located at the australian national university and supported by the australian government analyses and graphics in this paper used ferret a product of noaa s pacific marine environmental laboratory we also thank the teams whose work produced the valuable databases such as the world ocean atlas and glodap preparation of this manuscript was supported by the csiro decadal forecasting project access model development was funded through the australian climate change science program accsp and thank you to the anonymous reviewers whose comments helped improve the manuscript appendix a construction of transport matrix sections 2 2 3 and 2 2 4 give an overview of the construction of matrices in this work the schematics fig a 1 and paragraphs below give further details the time tendency of a tracer in a cell is calculated as a function of the tracer in the nearest neighbours due to advection and diffusion using output from the forward ocean model when the tracer field is expressed as a vector this transport and diffusion operator becomes a sparse matrix where the matrix element a i j is the component of the time tendency at position index i due to the tracer concentration at position j the forward model is built on a b grid arakawa and lamb 1977 tracer values are defined at cell centres and velocities are assigned at cell corners horizontal volume transports are output and averaged from the forward ogcm for cell boundaries ϕx and ϕy shown in fig a 1a vertical volume flow rates ϕz are found by assuming zero transport through the bottom or top boundary i e ϕ i j k max 1 2 z 0 and from the horizontal divergence using conservation of mass or continuity the indices i j k refer to the cartesian position of a grid cell in the forward ocean model note the vertical index k is positive down whereas positive vertical transport is up thus the vertical flux is obtained from a 1 ϕ i j k 1 2 z ϕ i j k 1 2 z ϕ i 1 2 j k x ϕ i 1 2 j k x ϕ i j 1 2 k y ϕ i j 1 2 k y the contribution from advection to the time tendency of tracer concentration χ i j k is shown in eq a 2 and fig a 1a we use an upwind advection scheme that is only the tracer in grid boxes from which flow originates contribute to the tendency in eq a 2 this is ensured by the max min functions the cell volume v i j k converts the convergence of advective flux to a tendency the tendency term due to the tracer in the cell itself is the total advection out of the cell a 2 d d t χ i j k 1 v i j k max 0 ϕ i 1 2 j k x χ i 1 j k max 0 ϕ i 1 2 j k x χ i 1 j k max 0 ϕ i j 1 2 k y χ i j 1 k max 0 ϕ i j 1 2 k y χ i j 1 k max 0 ϕ i j k 1 2 z χ i j k 1 max 0 ϕ i j k 1 2 z χ i j k 1 min 0 ϕ i 1 2 j k x min 0 ϕ i 1 2 j k x min 0 ϕ i j 1 2 k y min 0 ϕ i j 1 2 k y min 0 ϕ i j k 1 2 z min 0 ϕ i j k 1 2 z χ i j k similarly the time tendency due to diffusion is calculated from tracer gradients between nearest neighbouring cells using s the distance between cells and a the area of cell boundaries shown in fig a 1b and eq a 3 the horizontal diffusivity kh is considered constant whereas vertical diffusivity kz depends on whether the cells are in the deep or upper ocean section 2 2 4 shows results of water age tracer fields found with different combinations of diffusivities which are compared to age tracer fields from the forward ogcm a 3 d d t χ i j k 1 v i j k a i 1 2 j k k h χ i 1 j k χ i j k s i 1 2 j k a i 1 2 j k k h χ i 1 j k χ i j k s i 1 2 j k a i j 1 2 k k h χ i j 1 k χ i j k s i j 1 2 k a i j 1 2 k k h χ i j 1 k χ i j k s i j 1 2 k a i j k 1 2 k i j k 1 2 z χ i j k 1 χ i j k s i j k 1 2 a i j k 1 2 k i j k 1 2 z χ i j k 1 χ i j k s i j k 1 2 the gridded 3 dimensional tracer fields are organised into vectors so that these advective and diffusive terms become coefficients of the transport matrix the time tendency components from advection and mixing are added together to form the advective diffusive operator a that has been applied to tracers in the body of this paper all tracer solutions solved here are for steady state hence time stepping does not need to be considered as discussed by khatiwala et al 2005 there are several properties of the transport matrix which are useful to check the precision of its construction for instance the sum of terms on any row and the volume weighted sum of terms in any column must be zero we checked that our matrices satisfy these conservation constraints to within the expected numerical precision 
24048,a method to construct transport matrices from standard ocean model output such as mean volume fluxes and mixed layer depths is presented these transport matrices enable highly efficient calculation of deep water tracer fields that otherwise require long integrations with forward time stepping ocean models comparisons of matrix solutions for ideal mean water age demonstrate that the transport matrices are reasonably accurate representations of the transport in the parent ocean models tracer fields calculated using transport matrices provide simple circulation metrics that can be compared to observations we compare matrix computed radiocarbon distributions from two versions of access ocean models with observations we find matrices based on both models produce realistic circulations the radiocarbon distribution based on access forced with core climatology fits observations better in the deep pacific whereas the fully coupled access1 3 model fits observations better in the deep atlantic when applied to the circulations of access1 3 climate change experiments the transport matrix solutions show an increase in radiocarbon depletion or water age in the projected ocean circulation for the 2090s under the rcp8 5 scenario by computing the water mass fractions last ventilated from specific regions we diagnose a corresponding progressive shutdown in antarctic bottom water formation the volumetric decrease in antarctic waters in the global ocean is compensated by an increase in waters last ventilated in the subantarctic and southern subtropics keywords transport matrix ocean ventilation global ocean modelling tracers ideal mean age 1 introduction the oceans have the capacity to store and release huge amounts of heat and carbon making them an important component of the climate system the deep ocean circulation is crucial to the modulation of the earth s climate on centennial and longer timescales rhein et al 2013 natural radiocarbon has provided important insights into the deep ocean circulation and simulations of natural radiocarbon provide a valuable way to assess the simulated deep ocean ventilation e g toggweiler et al 1989a 1989b however it takes many millenniums for the deep ocean natural radiocarbon to reach steady state therefore numerical ocean general circulation models ogcm need long integration times which is computationally expensive there are several ways to reduce the computational requirements to equilibrate passive tracers one approach is to use an off line version of the ogcm in which tracers are advected and diffused from archived circulation output of the ogcm ribbe and tomczak 1997 while this allows the use of somewhat longer time steps the computational expense is still very large a second approach is to initialise the model with an initial state closer to equilibrium by integrating a coarse resolution offline model that is much more efficient to integrate aumont et al 1998 a third approach is to use a transport matrix built from an ogcm to represent the advection diffusion operator khatiwala et al 2005 khatiwala 2008 the attraction of the matrix transport method is that it provides a highly efficient way to solve the steady state distributions of passive tracers and many transport diagnostics for example devries and primeau 2011 used a data assimilated transport matrix derived from observations of temperature salinity radiocarbon sea surface height and buoyancy fluxes to calculate the fractions of the interior ocean volume that were last ventilated in specified surface regions such as the southern ocean and north atlantic the transport matrix can also be used to determine surface to surface and surface to interior pathways e g primeau 2005 holzer and primeau 2006 2008 gebbie and huybers 2010 finally the transport matrix also allows for highly efficient formulations of biogeochemical models so that their parameters can be objectively analysed for example the phosphate cycle kwon and primeau 2006 primeau et al 2013 holzer and primeau 2013 fu and primeau 2017 silicon cycle holzer et al 2014 holzer and brzezinski 2015 iron cycles frants et al 2016 pasquier and holzer 2017 and radiocarbon bardin et al 2014 here we use the transport matrix approach to find the steady state solutions for water age natural radiocarbon and to map constituent water masses according to regions of their last ventilation the transport matrix representing an ocean s advection diffusion operator for a given circulation can be constructed using several different techniques the matrix can be built with injected tracer pulses at each grid point and using resulting output to construct the underlying advection diffusion operator khatiwala et al 2005 here we use an approach analogous to primeau 2005 where the saved mean advective transports eulerian and eddy components diffusivities horizontal and vertical and upper ocean mixed layer depths are used to build the transport matrix we use time means of archived circulation fields from selected decades for this purpose the layout of the paper is as follows section 2 describes the parent ogcms and the construction of the transport matrices from the ogcm archived circulation we show that the transport matrix produces good respresentations of ideal mean water ages simulated directly with the ogcms in section 3 we use the transport matrix to compute the steady state radiocarbon field and water mass fractions we then build transport matrices for different climate simulations to quantify how the deep ocean circulation and ventilation change between the pre industrial and the projected rcp8 5 climates 2 method 2 1 models used 2 1 1 ocean ice model the longest forward model integration for this project was an ocean only configuration of the australia community climate earth system simulator access which was run for1000 s of years the model is based on bi et al 2013 using the same ocean model mom4p1 griffies 2008 grid and ocean parameters the sea ice model in this experiment is the sea ice simulator as used in gfdl s climate model cm2 1 delworth et al 2006 the access grid is spherical over most of the globe with 1 degree resolution in longitude latitude resolution varies resolution is 0 330 within 100 of the equator increasing to 10 at 300 north and south south of 300 the resolution is mercator becoming 0 250 at 750 s a tripolar grid over the arctic is used to avoid the north pole singularity the long integration was forced with atmospheric reanalysis fields used in the coordinated ocean reference experiment core griffies et al 2009 vertical resolution is 10 m in the upper 200 m and 300 m at the maximum depth of 5000 m the vertical coordinates are zstar which scale with surface height in time the upper ocean is mixed with the k profile parameterisation kpp scheme and vertical background diffusivity of 2 2 5 10 5 m 2 s 1 higher values near poles the biharmonic friction scheme is used and neutral physics includes redi diffusivity 600 m 2 s 1 and gent mcwilliams skew diffusion 2 1 2 atmosphere ocean ice model matrices are also built with output from access coupled model version 1 3 access1 3 experiments submitted to the coupled model intercomparison project cmip phase 5 bi et al 2013 the set up of the ocean model is the same as the ocean only model described above and is coupled to the los alamos sea ice model cice version 4 1 e g flocco et al 2012 the atmospheric component of access1 3 is the unified model um version 7 3 from the met office hadgem2 development team et al 2011 in this work we have produced several matrices based on the access1 3 historical and rcp8 5 scenarios time independent matrices are built on decadal averages of circulation to minimise any impact of year to year variability decades used are 1890 1899 1990 1999 2040 2049 and 2090 2099 2 2 matrix construction and evaluation the following subsections firstly discuss the application of the transport matrices to solving steady state distributions of ocean tracer fields the mean water age tracer in particular is presented for which a steady state solution was also found with the forward ocean model for comparison the next subsections describe the construction of the transport matrices used here the results of which are compared to the forward model extra details regarding the matrix construction may be found in the appendix 2 2 1 matrix formulation in this method a tracer field in the ocean is represented as a vector χ an array of 2 6 106 values for access ocean models the time tendency of this tracer due to physical advection eddy diffusion and vertical mixing is given by a χ where a is the discretised advection diffusion operator organised into a matrix a is what we refer to as the transport matrix a very sparse matrix with 2 107 non zero elements representing 0 0003 of the total entries corresponding to exchanges between nearest neighbours in the real ocean the time tendency of the tracer becomes 1 d d t χ a χ b where b is a vector form of tracer sources and sinks when b is a constant vector the steady state solution a χ b is solved via standard matrix methods essentially lu factorisation followed by back substitution often loosely referred to as matrix inversion we used the pardisio sparse matrix package within the intel math kernel library to solve this linear system if the sources and or sinks b depend nonlinearly on the tracer concentration χ then eq 1 becomes after discretisation onto the numerical grid a system of non linear coupled algebraic equations this occurs for example for nutrient tracers whose biological sink in the upper ocean uptake can be represented with a monod limiting term of the form χ χ k where k is constant in such nonlinear cases eq 1 can still be solved efficiently by for example newton solvers pasquier and holzer 2017 these solvers typically converge in of the order of 10 steps a vast improvement in the computational efficiency over time stepping a forward model to find the steady state here we only consider linear tracers specifically ideal mean water age water mass fractions and radiocarbon as detailed below 2 2 2 water age and forward model solutions water age tracer fields are readily calculated from transport matrices and can be compared to age tracers from forward models to assess how well matrices simulate the forward model circulation particularly in the deep ocean solving for the steady state solution involves applying the boundary condition that water age at the ocean surface is zero and a uniform age source of one second per second in the ocean interior since the source vector b is constant the solution can be found by a single matrix inversion fig 1 shows water age trends in the deep north pacific defined here as the average from 160 2200e 20 600n and below 2000 m representing part of the ocean with the longest timescale several water age tracer trends are shown here initialised from solutions of various matrices discussed below and integrated forward in time with the parent ocean model the physical circulation of the ocean model had already been spun up for 1000 years in each case the age tracer converges towards a common state within the forward model regardless of initial condition as expected some age tracer trends shown in fig 1 were initialised with solutions from matrices constructed with a specialised transport matrix tracer package available in the mom4p1 release khatiwala et al 2005 griffies 2008 this tracer package uses unique puff tracers at every grid point and every time step to extract transport matrix elements calculating separate matrices for explicit and implicit processes it is important to note however this package is different to the method to construct matrices described and used in the following sections also shown in fig 1 are lines labelled dpmixxx which are age trends initialised with matrices that are described in following sections the range of tracer fields in fig 1 include initialisations that both under and overestimate the final state of the ocean model s age tracer but all converge to the same age and are shown here just for demonstration the solution from only explicit processes exp has no vertical mixing and overestimated deep water ages while including vertical implicit mixing exp imp underestimated water ages the low age bias of the exp imp solution is consistent with the results of bardin et al 2016 who found that ages derived from annual averages of transport were younger by 12 relative to ages found with better temporal resolution a matrix combining the explicit matrix with well mixed upper oceans exp upocn produced an initial state that resulted in the least drift after 1000 years of forward integration this case was integrated a further 1000 years and is used as the forward solution of the water age for the ocean model and a reference for matrix solutions the drift in the deep north pacific ages of this integration was less than 3 years over this 1000 years integrating this tracer an extra 1000 years had negligible effect on the correlations listed below changes were in the 3rd significant figure correlations and deep water ages from various matrix age solutions are compared in table 1 and the taylor diagram in fig 2 matrices exp imp and exp upocn produce reasonable correlations 0 960 and 0 948 respectively table 1 indicating these matrices give a good representation of the parent ocean models circulation however these matrices can only be constructed from experiments with specialised transport matrix tracers other solutions listed in table 1 dpmixxx are constructed using generic ocean model output such as water transport and mixed layer depth as described below 2 2 3 advection time tendencies of tracers due to advection from neighbouring cells could be calculated from ocean model velocities however using volume transports is preferable since these include effects from changes in sea level and partial cells in the ocean model affecting tracer advection archived horizontal volume transports are used vertical transports are calculated from the divergence of the horizontal components to ensure volume conservation eddy induced transports from the gent mcwilliams component of the neutral physics scheme are also included in summary the time tendency of a tracer due to advection from neighbouring cells is the average volume transport from that neighbour normalised by the cell volume similarly transports out of the cell are loss terms the appendix a has a schematic of the tracer grid and fluxes and eq a 2 that demonstrate the terms used to calculate the advective components of the transport matrix the matrix built with just these diagnosed transports produces an age solution that has a reasonable correlation with the forward solution advection only in table 1 r 0 931 however this solution also has the oldest of the water ages shown since this matrix is missing various ocean model subgrid processes reducing the connection of the ocean interior to the surface and increasing the water age 2 2 4 vertical and horizontal mixing a matrix of tracer mixing is added to the advection matrix above to improve deep ocean solutions tracer exchange by mixing is calculated vertically and horizontally just between neighbouring tracer cells using grid information such as displacement and interface areas between cells see appendix a for a schematic and equation showing the various terms the ocean is divided into two regions for vertical mixing a well mixed upper ocean and a deep ocean with background mixing uniform diffusion coefficients are applied in these regions the depth of the upper ocean here is defined by the maximum in seasonal mixed layer depths from corresponding forward ocean model experiments and varies spatially from a few tens of metres to a few hundred metres in the tropics and midlatitudes in high latitudes there are regions of deep mixing to several hundred metres along the subantarctic zone and in the north atlantic and locations with mixing to over 1000 m in antarctic seas uniform horizontal mixing is included as a simplified approximation for isopycnal mixing ideal mean water age solutions with various components of ocean circulation and mixing are compared to the forward solution in table 1 and shown in fig 2a the biggest improvement from the advection only solution comes from the inclusion of upper ocean vertical mixing which improves both the correlation r and reduces the age to be closer to the forward solution consistent with the importance of vertical connections in major water formation regions in setting global tracer distributions the inclusion of background diffusivity produces small improvements in both r and age horizontal mixing substantially improves the age with a minor effect on r the values tested for tracer diffusivities were based on physically reasonable estimates and compared to the forward age solution fig 2b compares solutions from various combinations of mixing parameters diamonds show the effect of varying deep ocean background diffusivity 10 4 10 6 m 2 s 1 triangles show different horizontal eddy diffusivity 10 2 10 3 m 2 s 1 crosses are results from a range of upper ocean mixing 0 001 1 0 m 2 s 1 the circle is the solution using preferred diffusivity values upper mixing 0 1 m 2 s 1 deep diffusivity 3 10 5 m 2 s 1 and horizontal mixing 5 10 2 m 2 s 1 for diffusivity values explored here increasing vertical mixing in deep water decreases the mean water age in the deep north pacific and the standard deviation the best r values are found with small deep mixing diffusivities though the associated water ages are substantially greater and solutions plot further away from the reference point on the taylor diagram the deep water vertical mixing value is also close to the background mixing of the forward model 2 2 5 10 5 m 2 s 1 increasing mixing in the upper ocean gives small improvements to r which we use but we also stay within a range of mixing coefficients diagnosed by the ocean model of the order of 0 1 m 2 s 1 in the upper ocean increasing horizontal mixing or eddy diffusivity also reduces water ages and improves r however excessive horizontal mixing degrades the correlation the value of horizontal mixing that gave the best solution from tuning in fig 2b is close to the neutral isopycnal diffusivity used in the ocean model experiment 600 m 2 s 1 2 2 5 comparing matrix and forward model tracer fields various matrix derived water age fields are compared in fig 3 to the forward solution g h without horizontal mixing c d the solution shows small amplitude high frequency features that are unrealistic for deep ocean tracers in fig 1 a solution with higher background mixing dpmix1e 4 e and f has a deep north pacific age closer to the stable forward solution than the preferred matrix dpmix3e 5 a and b however this higher mixing solution has a lower correlation coefficient and is further from the reference solution in fig 2b in fig 3e the depth of maximum age of dpmix1e 4 is deeper relative to the forward solution in the preferred solution a b the oldest water is close to the correct age and has the right depth and extent giving a better representation of the forward model circulation fig 4 shows a joint probability distribution of ideal water ages from the preferred matrix and the reference forward model the joint distribution can be thought of as a binned volume weighted scatter plot most of the ocean falls close to the 1 1 line there is a slight young bias 50 years in waters of intermediate age 400 600 years whereas oldest waters such as in the deep north pacific are biased old 50 100 years some outliers occur such as poorly connected parts of the arctic ocean which are younger in the matrix derived field relative the forward model and even the mediterranean which is older in the matrix field however the age of most of the ocean volume is well represented in the matrix solution 3 comparing circulation of different models and climates using the structure of the preferred matrix found in sections 2 2 3 and 2 2 4 upper mixing 0 1 m 2 s 1 deep diffusivity 3 10 5 m 2 s 1 and horizontal mixing 5 10 2 m 2 s 1 we now consider transport matrices constructed from transports and mixed layer depths of other forward ocean model experiments testing different model setups and climate scenarios these matrices are then used to calculate radiocarbon distributions which enable comparisons of these simulations and their tracers to observations we also calculate the water volumes last ventilated in various regions or water masses and for various climate scenarios tracer distributions in the deep ocean are our primary interest 3 1 radiocarbon we now consider steady state radiocarbon fields computed with transport matrices based on ogcm simulations of the contemporary climate fig 5 compares the matrix derived radiocarbon field for the access ocean with core forcing left column and the access1 3 1990s middle with the glodap observations right key et al 2004 water ages are less than the half life of carbon 14 5730 years so the decay of carbon 14 is approximately linear on ocean timescales hence the radiocarbon distribution is similar to water age fields shown before particularly in the deep ocean near the air sea surface however radiocarbon is in disequilibrium the equilibration time scales for radiocarbon is months to years for reasonable mixed layer depths using exchange rates from toggweiler et al 1989a whereas ideal age tracers equilibrate instantaneously ocean radiocarbon is shown in units of δ carbon which is the change in the isotope ratio of carbon 14 to carbon 12 per mil relative to atmospheric values before nuclear weapons testing toggweiler et al 1989a solving for the steady state radiocarbon solution is similar to solving for water age described before the surface boundary condition is the carbon 14 carbon 12 ratio taken from the glodap pre bomb database key et al 2004 and this ratio decays in the ocean interior with the carbon 14 half life the overall structures of radiocarbon depletion in fig 5 from access ocean and access1 3 experiments are similar in the pacific top row radiocarbon sections from both experiments are very similar to the observed radiocarbon access ocean radiocarbon is slightly more depleted older than observations while access1 3 is less depleted younger and upper ocean waters penetrate deeper there are small discrepancies between models and observations in the top few hundred metres by assuming rapid mixing down to the winter maximum mixed layer depths modelled radiocarbon fields mix surface boundary conditions to depths of the order of 100 m observed radiocarbon has significant vertical gradients in the top few tens of metres due to disequilibrium across the air sea surface and shallow average mixed layers both models show older water in the deep southern ocean and more bottom water penetration into the pacific basin relative to the observations in the atlantic access1 3 has a more realistic representation of north atlantic deep water whereas the access ocean has abyssal water pooling and ageing in the north atlantic the observed radiocarbon distribution also shows old depleted waters in the abyssal south atlantic which are not seen in model solutions models may be missing a connection of pacific abyssal water into the atlantic basin however further investigation of this feature is beyond the scope of this work 3 2 water mass fractions devries and primeau 2011 use a data constrained ocean circulation model which assimilates observations of heat salinity and radiocarbon tracers in addition to observed sea height and surface fluxes of heat and fresh water and estimate the volume fraction of the ocean last ventilated in various surface regions here we calculate corresponding volume fractions using our model derived transport matrices fig 6 shows surface regions we use for this purpose these regions were defined using the same criteria used by gebbie and huybers 2010 and devries and primeau 2011 antarctic and subantarctic water are separated by the 1027 1 k g m 3 isopycnal the 35 0 psu isohaline divides subantarctic and subtropical waters the tropical waters are within the 25 c isotherm subtropical and subarctic waters are separated by the 34 0 psu and 35 4 psu isohalines in the pacific and atlantic oceans respectively the arctic source region is based on geography to define these regions we used the model s climatology the calculated volume fractions last ventilated from each region for the contemporary access experiments are compared to the corresponding results from devries and primeau 2011 in table 2 uncertainty estimates from devries and primeau 2011 are included uncertainty from access experiments are estimated from the range of volume fractions calculated from two 5 year averages of circulation for the access ocean these ranges were less than the level of significance reported in all cases the ocean volume is dominated by water from antarctica and the north atlantic with only small contributions from the tropics and subtropics both access models underestimate the contribution of water from the subarctic which includes the north atlantic deep water though access1 3 contributions are closer to values of devries and primeau 2011 consistent with the more realistic atlantic radiocarbon tracers in fig 5 antarctic waters are the largest water mass fraction in all solutions however the access ocean solution overestimates the contribution relative to devries and primeau 2011 while access1 3 underestimates the volume contributions from tropical and subtropical waters estimated by devries and primeau 2011 are all smaller than for the access models with zero contribution reported from the tropics however the tropical contributions from our matrix solutions of a few percent are reasonable considering a typical mixed layer depth of 100 m is a few percent of the water column and the tropics cover a large fraction of the ocean surface the access1 3 contributions from the tropics and subtropics are higher than access ocean consistent with the observation of deeper surface mixing in radiocarbon in fig 5 3 3 effect of changing climate we now characterise the response of the ocean circulation to climate change in terms of water mass fractions and water ages from different phases of the access1 3 historical and rcp8 5 experiments note that tracer fields shown are steady state solutions to matrices however the circulations represented by these matrices are transient and responding to a changing climate water ages are very similar from transports from the 1890s not shown and the 1990s left column of fig 7 deep north pacific ages are 1127 and 1189 years respectively for regions compared in section 2 2 2 the overall pattern of water age is similar in all climates shown however pacific waters are substantially older for steady states based on future circulations north atlantic deep water does not penetrate as deep for the future circulation and older water extends further across the atlantic basin and pools in the abyssal north atlantic note again that these are steady state solutions the mean water age at depth would not have doubled by 2090 but these solutions indicate a halving in the exchange with the upper ocean in the future climate like water age volume fractions of water masses from the 1890s and the 1990s are very similar table 3 in contrast the volume fractions for the 2090s circulation are quite distinct the solution for the 2040s circulation shows the same pattern of changes but with smaller magnitudes the most significant feature of the 2090s circulation is the shutdown in formation of antarctic bottom water the combined antarctic regions ventilated 30 to 35 of the global ocean volume in the 1890s and 1990s which drops to a mere 4 in the 2090s by contrast north atlantic deep water contributions to the global volume the major component of subarc table 3 is relatively constant the drop in the antarctic contribution is compensated by increases in ventilation from all other regions in particular the subantarctic and southern subtropical regions the shutdown of antarctic bottom water can also be seen in pacific sections of water mass fractions fig 8 deep waters of the southern ocean south of 600s were almost entirely antarctic water in the contemporary circulation in the 2090s antarctic ventilated water only penetrates down to a few hundred metres bottom row the main change in the extent of subarctic water which includes north atlantic deep water is to extend into the southern ocean in this pacific section top row the fraction of water from the tropics increases with climate change though the change is limited second row the extent of water from the subantarctic and southern subtropics clearly increases third and fourth rows encroaching into the deep ocean and transported across the global ocean we emphasise that the ocean state in the 2090s for example will not be in steady state should the climate of the 2090s be maintained for an extended period centuries deep water properties would eventually adjust and antarctic bottom water formation would resume at some timescale producing circulations different to those presented here the weakening of deep circulation in a changing climate has been noted before both in reviews of cmip climate projections e g marsland et al 2013 heuzé et al 2015 and in observations indicative of changes already occurring de lavergne et al 2014 marsland et al 2013 show considerable reduction in the antarctic bottom water circulation in the access1 3 simulations of rcp4 5 and rcp8 5 from early in the 21st century these circulations changes correspond to decreases in winter mixed layer depths in antarctic seas maximum mixed layers from access1 3 are up to 5000 m in the ross and weddell seas early in the 21st century which shoal to a few hundred metres by 2100 for rcp8 5 there is a similar story in the north atlantic although the rate of decrease in north atlantic deep water and mixed layer depth reduces after 2050 here heuzé et al 2015 also find a weakening in the deep circulation and a strengthening in the upper ocean circulation in a survey of cmip5 projections de lavergne et al 2014 argue that the1970 s weddell sea polynya event was a more regular event in the past and its recent absence is consistent with the observed freshening of the upper southern ocean in the current climate the work presented here highlights this weakening of the deep circulation showing the dramatic decrease in the contribution of antarctic waters to the global ocean in projected circulations this has major implications for the storage of heat and carbon in future climate scenarios 4 summary and conclusions the ocean circulations of global climate models are explored using transport matrices both to compare transport metrics to observations and to demonstrate the effects of changing model climate matrices are constructed from standard ocean model output specifically mean volume transport fields and mixed layer depths together with empirically determined values for vertical and horizontal diffusivities in the deep and upper ocean that are consistent with parameters of the parent ocean models this technique does not require any special tracer packages to be run in the forward ocean model it is therefore possible to build these matrices from archives of ocean and climate simulations these matrices then provide a numerically highly efficient means for probing various aspects of the transport and biogeochemistry of the parent models correlations between water age solutions from transport matrices and forward models are very high demonstrating that our matrices capture the parent model s transports with good fidelity radiocarbon distributions from the access ocean model forced with core boundary conditions and the historical access1 3 experiment both resemble observed fields radiocarbon in access core is closer to observations in the pacific basin while access1 3 gives a better representation in the atlantic the access core based matrix overestimates the volume fraction of the ocean that was last ventilated in antarctic waters whereas access1 3 underestimates this fraction using the transport matrix based on the access1 3 climate projection for the 2090s under the rcp8 5 scenario we show an increase in radiocarbon depletion and reduction in the fraction of global ocean last ventilated around antarctica pointing to a shutdown in projected antarctic bottom water formation the radiocarbon fields and water mass fractions for the 2040s circulation show similar changes to those seen in the 2090s albeit with smaller amplitudes the decreased water from antarctic regions is compensated by an increase in water volume from other regions in particular from the subantarctic and southern subtropics changes in deep circulation are important because they directly affect the ocean s ability to store heat and carbon which in turn impacts the future climate including the projected sea level changes future applications of our method to generate transport matrices are numerous matrix derived tracer fields may be used to provide spun up deep water initial conditions for forward models greatly reducing the computational expense required to equilibrate these dynamical forward models transport matrices also enable the efficient computation of deep biogeochemical fields such as the distributions of phosphate nitrate dissolved iron silicic acid and their isotopic ratios in various climate scenarios these fields have long timescales and are expensive to integrate exclusively in forward ocean models but can be very efficiently solved for steady state using newton or newton krylov solvers or even direct matrix inversion when the source sink terms are linear as in examples shown here being able to efficiently find nutrient and trace metal distributions will be invaluable for understanding both future and past biogeochemical cycles acknowledgements this research used computation resources and archives available at the national computational infrastructure nci which is located at the australian national university and supported by the australian government analyses and graphics in this paper used ferret a product of noaa s pacific marine environmental laboratory we also thank the teams whose work produced the valuable databases such as the world ocean atlas and glodap preparation of this manuscript was supported by the csiro decadal forecasting project access model development was funded through the australian climate change science program accsp and thank you to the anonymous reviewers whose comments helped improve the manuscript appendix a construction of transport matrix sections 2 2 3 and 2 2 4 give an overview of the construction of matrices in this work the schematics fig a 1 and paragraphs below give further details the time tendency of a tracer in a cell is calculated as a function of the tracer in the nearest neighbours due to advection and diffusion using output from the forward ocean model when the tracer field is expressed as a vector this transport and diffusion operator becomes a sparse matrix where the matrix element a i j is the component of the time tendency at position index i due to the tracer concentration at position j the forward model is built on a b grid arakawa and lamb 1977 tracer values are defined at cell centres and velocities are assigned at cell corners horizontal volume transports are output and averaged from the forward ogcm for cell boundaries ϕx and ϕy shown in fig a 1a vertical volume flow rates ϕz are found by assuming zero transport through the bottom or top boundary i e ϕ i j k max 1 2 z 0 and from the horizontal divergence using conservation of mass or continuity the indices i j k refer to the cartesian position of a grid cell in the forward ocean model note the vertical index k is positive down whereas positive vertical transport is up thus the vertical flux is obtained from a 1 ϕ i j k 1 2 z ϕ i j k 1 2 z ϕ i 1 2 j k x ϕ i 1 2 j k x ϕ i j 1 2 k y ϕ i j 1 2 k y the contribution from advection to the time tendency of tracer concentration χ i j k is shown in eq a 2 and fig a 1a we use an upwind advection scheme that is only the tracer in grid boxes from which flow originates contribute to the tendency in eq a 2 this is ensured by the max min functions the cell volume v i j k converts the convergence of advective flux to a tendency the tendency term due to the tracer in the cell itself is the total advection out of the cell a 2 d d t χ i j k 1 v i j k max 0 ϕ i 1 2 j k x χ i 1 j k max 0 ϕ i 1 2 j k x χ i 1 j k max 0 ϕ i j 1 2 k y χ i j 1 k max 0 ϕ i j 1 2 k y χ i j 1 k max 0 ϕ i j k 1 2 z χ i j k 1 max 0 ϕ i j k 1 2 z χ i j k 1 min 0 ϕ i 1 2 j k x min 0 ϕ i 1 2 j k x min 0 ϕ i j 1 2 k y min 0 ϕ i j 1 2 k y min 0 ϕ i j k 1 2 z min 0 ϕ i j k 1 2 z χ i j k similarly the time tendency due to diffusion is calculated from tracer gradients between nearest neighbouring cells using s the distance between cells and a the area of cell boundaries shown in fig a 1b and eq a 3 the horizontal diffusivity kh is considered constant whereas vertical diffusivity kz depends on whether the cells are in the deep or upper ocean section 2 2 4 shows results of water age tracer fields found with different combinations of diffusivities which are compared to age tracer fields from the forward ogcm a 3 d d t χ i j k 1 v i j k a i 1 2 j k k h χ i 1 j k χ i j k s i 1 2 j k a i 1 2 j k k h χ i 1 j k χ i j k s i 1 2 j k a i j 1 2 k k h χ i j 1 k χ i j k s i j 1 2 k a i j 1 2 k k h χ i j 1 k χ i j k s i j 1 2 k a i j k 1 2 k i j k 1 2 z χ i j k 1 χ i j k s i j k 1 2 a i j k 1 2 k i j k 1 2 z χ i j k 1 χ i j k s i j k 1 2 the gridded 3 dimensional tracer fields are organised into vectors so that these advective and diffusive terms become coefficients of the transport matrix the time tendency components from advection and mixing are added together to form the advective diffusive operator a that has been applied to tracers in the body of this paper all tracer solutions solved here are for steady state hence time stepping does not need to be considered as discussed by khatiwala et al 2005 there are several properties of the transport matrix which are useful to check the precision of its construction for instance the sum of terms on any row and the volume weighted sum of terms in any column must be zero we checked that our matrices satisfy these conservation constraints to within the expected numerical precision 
24049,a modeling system is presented for simulation of multiphysics coastal ocean flows at scales from o 1 m to o 1 000 km especially for high fidelity simulation of local complicated free surface phenomena the system integrates the solver for incompressible flow on unstructured mesh sifum and the finite volume coastal ocean model fvcom on the basis of domain decomposition in this system the former is built on the navier stokes equations and simulates small scale fully three dimensional phenomena in local flows whereas the latter is based on the geophysical fluid dynamics equations and predicts large scale background ocean currents the integrated sifum fvcom system is developed from a previous system consisting of a structured grid model and an unstructured grid model tang et al j comput phys 273 2014 and it combines two unstructured grid models and has the capability of dealing with free surface phenomena and complex geometries in local flows in the new system sifum and fvcom are two way coupled via schwarz iteration and they march in time together as a single system the sifum fvcom system performs as intended with regard to capturing physical phenomena e g generation of dam break wave and slashing of water at a structure converging with grid spacing and time step and permitting seamless transition of solutions for far and near fields in addition its prediction of benchmark flow problems matches well with analytical computational and experimental data the system is able to simultaneously and directly simulate many multiscale multiphysics real world phenomena that could not be handled before such capability is illustrated by its application to coastal flooding and the resulting impact on a coastal bridge and a beachfront house keywords multiscale multiphysics near field free surface model coupling overset grids the sifum fvcom system 1 introduction it has become important and urgent to develop our capabilities to simulate many emerging coastal ocean flow problems associated with distinct types of physical phenomena at vastly different scales these problems occur in various natural processes as well as because of fast expansion of human activities in coastal and oceanic waters and the importance and need to develop such simulation capabilities are clearly manifested in two examples in the first example the 2011 tōhoku tsunami started as surface waves with tiny amplitude in a deep ocean with horizontal scales of o 1 000 km and it evolved into huge walls of water as high as 39 m near the seashore and then splashed against structures such as inland houses and bridges at o 10 m o means at order of magnitude leading to 14 508 casualties 11 452 missing people and property damage in value ranging from 16 to 25 trillion yen mimura et al 2011 an emerging and crucial problem in such an event is to predict currents and waves in detail at structures and estimate the hydrodynamic force acting on them the second example comes from the fast growing worldwide practice of power generation from marine hydrokinetic mhk energy which has been estimated to be 8800 tw h per year globally with 10 being technically recoverable tang et al 2014a yuce and muratoglu 2015 twisted with background ocean currents at o 10 km on horizontal scales the flow at an mhk turbine is fully three dimensional 3d and at scales of o 10 m this flow exhibits various small scale phenomena including a meandering motion a tip vortex shear layer an inner layer counter rotating hub vortex in the wakes and even cavitation kang et al 2014 an emerging problem as well as a main challenge in this practice is the evaluation of power output and potential environmental impact yuce and muratoglu 2015 which requires reliable and high fidelity simulation of those phenomena at small scales and their interaction with tidal currents at larger sales besides these two examples there are more examples such as dispersion of oil spills from seabed camilli et al 2010 effects of local flows at seamounts on plankton distribution stevens et al 2014 and waves generated by entry of asteroids gisler et al 2011 although originating from different backgrounds all of these examples present a common challenge to our modeling capacity they involve multiple phenomena by nature that exhibit distinct behaviors in physics e g vortex surface wave and water splashing are better described by different governing equations and span a vast range of spatial and temporal scales these phenomena have been referred to as multiphysics and multiscale flows because of such nature tang and wu 2010 tang and keen 2011 candy 2017 so far essentially we have no appropriate methods and computer software to directly and integrally perform high fidelity simulation of these multiscale and multiphysics problems here directly means fully resolving without parameterization this article targets these phenomena especially those fully 3d complicated local ones and it develops capacity for their high fidelity simulation during the past few decades a number of computer models based on geophysical fluid dynamics gfd equations have been developed by the ocean science community for ocean currents and waves e g blumberg and mellor 1987 chen et al 2003 haidvogel et al 2008 booij et al 1999 these gfd models have been very successful in application to flows with periods as long as months and over regions as large as mesoscales with horizontal sizes from o 10 to o 10 000 km e g klinger and cruz 2009 miles et al 2017 in recent years there has also been a trend to apply such models to flow problems at smaller scales e g less than o 100 m such as tidal energy and coastal flooding e g tang et al 2014a westerink et al 2008 yin et al 2016 however because of restrictions inherent in the governing equations e g the hydrostatic assumption numerical techniques and parameterization the gfd models are unsuitable for strongly 3d local flows such as oil jet spills at seabed in addition these models including their nonhydrostatic versions are designed with layer grids and thus they cannot handle domains that are multiply connected in the vertical direction such as a hole in a seamount and rotating blades of an mhk turbine moreover it has been found that the models may encounter numerical difficulties including instability at small grid spacing and time step heimusund and berntsen 2004 efforts have also been made to design gfd models on the basis of fully 3d governing equations e g fluidity icom candy 2017 oishi et al 2013 and such models can take nonhydrostatic effects into account however because of their grid layout and way to capture water surface they cannot directly handle some local phenomena such as wave splashing at a wall and flow under a bridge deck at the same time software packages built on fully 3d fluid dynamics 3dfd whose governing equations are the navier stokes equations have also been designed for various small scale physical phenomena in engineering communities e g mechanical civil and hydraulic engineering overture november 2012 ansys inc november 2010 opencfd 2004 the 3dfd approaches including direct numerical simulation may not have the aforementioned limitations of the large scale gfd models and they can satisfactorily predict fully 3d complicated local flows with high fidelity at scales of o 1 m o 10 km including the flows that cannot be handled by gfd models as discussed previously e g oil spills at seabed vortices stemming from an mhk turbine tang et al 2008 kang et al 2012 as an example fig 1 shows an instantaneous 3dfd solution for waves impacting a coastal bridge deck and the resulting hydrodynamic load on it the 3dfd modeling captures many dynamic processes that are beyond the reach of gfd models such as splashing of water at the left fascia of the deck fig 1a and b trapping of air between the deck and water fig 1a and the onset of air bubbles at the bottom of the girders fig 1b in general hydrodynamic load on a structure consists of quasi static and slamming forces cuomo et al 2009 and this 3dfd modeling clearly resolves both of these forces fig 1c and d in particular while gfd modeling is able to estimate quasi static forces it cannot deal with the slamming force at all which is caused by water surface impinging directly onto a structure s surface and can be an order magnitude greater than the quasi static force in principle 3dfd can be used for large scale coastal ocean flows nevertheless it is prohibitively expensive for simulation of realistic large scale coastal ocean flows in terms of computational time and memory e g the mesh resolution at the wall in fig 1 is at o 1 mm and it is also ineffective because of limitations in its governing equations and computational techniques because computer modeling has reached the point where gfd and 3dfd models have become mature for their designated flow phenomena and scales integration of these two models is now considered a natural promising and also currently the most feasible approach for simulation of multiscale and multiphysics coastal ocean flows e g fringer et al 2006 in this approach an ocean flow is divided into a large scale far field e g a deep ocean region and a small scale near field e g flow at an mhk turbine the traditional understanding is that the former has dominant effects on the latter whereas the influence in the opposite way i e from small to large scales is secondary or negligible with this understanding a simulation for the far field is performed with a gfd model and then with its results as initial and boundary conditions a further simulation is conducted for the near field with the aid of a small scale model e g a 3dfd model this is one way coupling and solution information goes only from the large scale to the small scale model this one way approach is reasonable and it has been applied in many applications e g coastal flooding yin et al 2016 however such a one way approach has difficulties and limitations and it may not be applicable in some situations firstly it may not be easy or appropriate to divide an ocean flow into far and near fields in actual applications for instance in order to avoid the effects of an object e g an mhk turbine enclosed in it a near field needs to be large enough and this may increase the computational cost substantially for the near field assigned with an expensive model e g a full navier stokes solver also the influence of a near field on its far field has to be included in some situations for example such influence is important in understanding the interaction between background currents and local flows at an array of mhk turbines in tidal power development brown et al 2017 moreover it has been shown that small scale flow trajectories could have pronounced effects on large scale flow trajectories in lagrangian particle tracking in the jamaica bay qu et al 2016 in general effects of small scale flows are difficult to identify clearly but they are attracting increasing attention from the community in many problems such as the emerging problems discussed in the first paragraph of this section secondly a one way coupling approach is not computationally efficient it needs some methods e g interpolation implemented manually or by customized software to transfer the results e g speed from a large scale model to a small scale model it is also not straightforward to apply such results as initial and boundary conditions for the small scale model since they keep changing in magnitude and direction as a result so far largely such data have to be simplified for example into those associated with unidirectional steady flows e g in simulation of local flows at an mhk turbine tang et al 2008 thirdly one way coupling could introduce considerable errors and uncertainty during the data transfer from large scale to small scale models given the fact that ocean flows are complicated and constantly changing in magnitude and direction such errors and uncertainty are difficult to estimate especially during storms consequently to overcome the aforementioned difficulties it is necessary to develop two way coupling methods for coastal ocean flows this is also in line with the trend of multiscale and multiphysics modeling whose research has become active in many other areas domain decomposition has been studied and used intensively in computational fluid dynamics cfd and it provides a framework for the development of two way coupling methods for coastal ocean flows since the early 1980s research on domain decomposition methods for cfd has been conducted to mainly overcome difficulties associated with complex geometries e g benek et al 1983 meakin and street 1988 and then to improve computational efficiency e g meakin and street 1988 chen et al 2014 in these efforts mostly a same set of governing equations are used in different subdomains and intensive research has been conducted on key issues such as algorithms at grid interfaces e g berger 1987 henshaw and watson 1994 tang and zhou 1999 tang et al 2003 and methods for solution of algebraic systems resulting from discretization e g saad and schultz 1986 pavarino and widlund 2002 as a powerful cfd approach nesting grids within a same model has become routine practice to resolve local phenomena in coastal ocean flows oey and chen 1992 sheng and tang 2004 gradually efforts have proceeded to simulation of multiphysics phenomena by coupling of different sets of governing equations these efforts include one dimensional 1d two dimensional 2d coupling sitanggang and lynett 2010 kim et al 2010 2d 2d coupling yin et al 2016 2d 3d coupling tang et al 2013 fujima et al 2002 and 3d 3d coupling paulsen et al 2014 in these efforts simplification such as the boussinesq assumption potential flows and nested meshes has to be adopted in addition not all component models are the best available status representative types in the communities because of all of these factors only limited physics can be captured especially in small scale flows in order to simulate multiscale multiphysics realistic coastal ocean flows we proposed to directly and fully integrate a gfd model and a 3dfd model particularly the finite volume coastal ocean model fvcom and the solver for incompressible flow on overset meshes sifom respectively into a single modeling system tang and wu 2010 qu et al 2016 wu and tang 2010 tang et al 2014b fvcom is a typical coastal ocean model and it is widely used in the ocean science community for prediction of ocean flow problems chen et al 2003 sifom is developed by the authors and coworkers and it has been tested and applied in various small scale fully 3d engineering flow problems tang et al 2014b as the first of its kind the sifom fvcom system is able to simulate many multiphysics coastal ocean flows at scales ranging from o 1 m to o 1 000 km across mesoscales and submesoscales that cannot be handled by other existing models qu et al 2016 tang et al 2014b however the sifom fvcom system cannot deal with free surfaces at local flows because sifom lacks such capability and thus it is not applicable to many important problems e g impinging of surges and waves on a coastal structure in addition sifom uses structured grids and thus the sifom fvcom system is not flexible in dealing with complicated geometries at local flows in this article to overcome the aforementioned shortcomings of the sifom fvcom system a new 3dfd gfd system which is a hybrid of fvcom and the solver for incompressible flow on unstructured mesh sifum has been developed qu 2017 qu et al 2017 sifum can directly simulate many complicated small scale flows beyond the capabilities of gfd models such as those in fig 1 in terms of the governing equations and capabilities fvcom and sifum are respectively among the currently best available types of gfd models in the ocean science community e g blumberg and mellor 1987 chen et al 2003 haidvogel et al 2008 and 3dfd models in the engineering communities e g overture november 2012 ansys inc november 2010 opencfd 2004 the main difference between the sifom fvcom system and the sifum fvcom system stems from sifum which enables the latter to be able to model local flows with strong distortion in free surfaces and easily handle local complicated geometries the new system is an extension of the previous system however such extension is not trivial at all but challenging in its realization the challenge comes from the fact that sifom and sifum are very different in terms of discretization methods and computational meshes plus the fact that sifum and fvcom are two stand alone software packages actually it has been reported that artifacts and instability may take place in integration of sifom and fvcom and discretion is necessary with regards to these aspects tang et al 2016 while following the framework and techniques of the sifom fvcom system development of algorithms is necessary in dealing with new issues such as those related to coupling of free surfaces between unstructured grids of sifum and fvcom additionally schematic and rigorous tests are also necessary in the development of the sifum fvcom system 2 governing equations and discretization the governing equations of sifum are the full 3d naiver stokes equations for incompressible flows of an air water mixture and they are expressed as 1 u 0 2 ρ u t ρ uu μ eff u u μ eff p ρ ρ ref g where t is the time u is the velocity p is the pressure and ρ is the density of the air water mixture the components of u are u v and w in the x y and z direction respectively ρref is a reference density μeff is the effective viscosity and g is gravity μeff μl μt where μl is the laminar viscosity and μt is the turbulence viscosity the total pressure is p and it is calculated as 3 p p ρ ref r g where r is the vector starting from a reference point to the location where the total pressure is evaluated in this work ρref is set as the air density and the reference point is selected as a point on the air flow s boundary as a result p equals the total pressure minus the pressure caused by the air weight the turbulence closure is made with use of the smagorinsky model smagorinsky 1963 4 μ t ρ c s λ 2 e where c s is a coefficient between 0 1 and 0 2 and it is set as 0 2 in this article e is the strain rate and λ is the volume of a mesh cell s control volume in order to deal with complex geometries sifum adopts an unstructured grid whose elements may be tetrahedrons pentahedrons hexahedrons and triangular prisms mostly the last two are used in this article or any combination of them in this model all variables are defined at the centroid of a mesh element a second order accurate three level backward differencing is used to discretize the time derivative term and the discretization for the governing equations is fully implicit the advection term is approximated by a deferred correction scheme fergizer and peric 2002 which is a hybrid of a first order upwind scheme and the second order gamma finite difference jasak 1996 the diffusion term is discretized by the central difference in the normal directions of an element s faces with the aid of values at the centers of the element and its neighbor elements the pressure gradient is treated similarly as the diffusion term to avoid the checkerboard phenomenon a so called momentum interpolation method is used to evaluate momentum fluxes at the faces of an element in discretization of the momentum equation rhie and chow 1983 the continuity equation is computed as the summation of fluxes of volume flow rate across the faces of each control volume velocity and pressure are coupled with each other by the pressure implicit split operator method issa 1986 in order to handle complex free surface phenomena such as splashing of water sifum uses a volume of fluid vof method to resolve water surfaces by which the transportation equation for the volume fraction reads hirt and nichols 1981 5 γ t γ u 0 where γ is the volume fraction defined as 6 γ 0 air 0 γ 1 interface γ 1 water the density and viscosity are functions of γ 7 ρ ρ air γ ρ water ρ air 8 μ l μ air γ μ water μ air in eqs 7 and 8 the subscripts water and air refer to a property of water and a property of air respectively in this work eq 5 is discretized in form of the crank nicolson scheme a vof method called the switching technique for advection and capturing of surfaces stacs is used to resolve the free surface between water and air darwish and moukalled 2006 stacs is a high resolution scheme based on the normalized variable diagram concept leonard 1991 which switches between different high resolution finite difference schemes to yield a bounded value of the volume fraction according to the free surface orientation because of its adoption of a vof method sifum solves the flow of a water air mixture and it captures water surfaces naturally and resolves complex local phenomena such as water splashing with many separate water drops directly rather than tracking free surfaces piece by piece as in gfd models that solve the navier stokes equations e g candy 2017 oishi et al 2013 sifum has been tested and validated intensively in simulations of various problems such as dam break flows currents impacting cylinders and solitary and focused waves impinging on coastal bridge decks and the results compare well with available data in the literature qu 2017 qu et al 2017 the details of sifum including its algorithms and numerical examples are presented in qu 2017 as a typical geophysical fluid dynamics gfd model fvcom has an external mode and an internal mode chen et al 2003 the governing equations for the external mode are the 2d depth average continuity and momentum equations 9 η t h v d 0 10 v d t h vv d g d h η τ s τ b ρ o g where η is the water surface elevation d is the water depth and v is the horizontal velocity h is the horizontal gradient τ b and τ s are the shear stress on the seabed and the water surface respectively ρo is the water density at atmosphere pressure and g includes the other terms such as the coriolis force the governing equations for the internal mode of fvcom are the 3d continuity and momentum equations under the hydrostatic assumption 11 η t h v d ω σ 0 12 v d t h vv d v ω σ g d h η h κ e λ v σ σ d g d ρ o h d σ 0 ρ d σ σ ρ h d h where v is the horizontal velocity and ω is the vertical velocity in the σ coordinate here v and ω comprise velocity u h includes the other terms the subscript σ indicates a derivative with respect to σ and κ and λ are coefficients the mellor and yamada level 2 5 turbulent model is used for turbulence viscosity chen et al 2006 in fvcom the governing equations are solved by a finite volume method on a triangular mesh in the horizontal plane and a σ grid in the vertical direction the time derivative terms are discretized by a runge kutta method and the convection terms are approximated with the aid of upwind schemes in this model pressure is not present explicitly but can be recovered from the water surface elevation according to the hydrostatic assumption version 2 6 of fvcom is used in this paper and the readers are referred to chen et al 2006 for further details of the model 3 integration of sifum and fvcom 3 1 model integration in general 3dfd eqs 1 and 2 are nonhydrostatic but in a region with negligible nonhydrostatic effects these equations will degenerate to be hydrostatic and these equations as well as gfd eqs 9 12 are applicable with such understanding by the idea of domain decomposition the computational domain for a coastal ocean flow is divided into two subdomains one corresponding to a far field and the other corresponding to a near field and the interfaces between them are allocated in regions with hydrostatic flows as shown in the schematic representation in fig 2 sifum is used in subdomain ωsifum the near field which covers small scale local physical phenomena of interest here a flow at a coastal bridge fvcom is used in subdomain ωfvcom the far field which covers large scale background ocean currents subdomain ωsifum includes both an air zone and a water zone and subdomain ωfvcom occupies the water body extending from its boundary at ωfvcom to far open boundaries subdomains ωsifum and ωfvcom overlap with each other and the interfaces between them are ωsifum 1 and ωfvcom notice that ωfvcom remains stationary whereas ωsifum 1 and ωsifum 2 move with time because of restless motion of the water surface ideally the size of ωsifum is sufficiently large and the lateral and top sections in its boundary ωsifum ωsifum 4 are far from an object if it contains for example the bridge in fig 2 in this situation air flow at its top ωsifum 3 is not disturbed by the object and the pressure there is atmospheric pressure additionally water flow on its lateral sides ωsifum 1 is almost hydrostatic and fvcom is applicable there let s and f stand for the operators corresponding to discretization of eqs 1 8 in sifum and eqs 9 12 in fvcom respectively and also let s p γ u and f η v u be the variables for the former and the latter respectively then the two models are integrated as follows 13 sifum s s 0 i n ω sifum u sifum u fvcom o n ω sifum 1 γ sifum γ fvcom o n ω sifum 1 ω sifum 2 p 0 o n ω sifum 3 p n 0 o n ω sifum ω sifum 3 14 fvcom f f 0 i n ω fvcom u fvcom u sifum o n ω fvcom ω fvcom where the subscripts sifum and fvcom indicate values obtained with sifum and fvcom respectively as seen in eq 13 sifum takes the solution of fvcom on ωsifum 1 as a boundary condition for sifum p 0 on ωsifum 3 and this means that pressure equals atmospheric pressure gauge pressure there in view of the divergence free condition that is eq 1 velocity is not imposed as a boundary condition along the entire boundary but is imposed along the water section ωsifum 1 and not along the air section ωsifum 2 on ωsifum 1 ωsifum 2 fvcom s value for γ is determined by its solution for η in eq 14 fvcom adopts the solution of sifum not only along ωfvcom but also in ω fvcom which is a blanked zone of fvcom this is because a velocity redistribution step in the internal mode of fvcom needs the solution for velocity within ω fvcom chen et al 2006 it is noted that blanking zone is an overset grid technique used to facilitate two way coupling in simulation of flows e g flow past a cylinder tang et al 2003 the vertical velocity w in fvcom is transferred from its solution ω in the σ coordinate for sifum and fvcom more boundary conditions are necessary such as for the latter a surface elevation condition at the open sea it is pointed out that inappropriate conditions at the interfaces of sifum and fvcom could lead nonphysical solutions or even an unstable computation which have been observed in our early work tang et al 2014b tang et al 2016 therefore it is crucial to correctly set up these conditions so that computational problems of sifum fvcom and the sifum fvcom system are all well posed and the integration methods in eqs 13 and 14 result from theoretical considerations and numerical tests with these aspects nordström and svärd 2005 temam 2003 tang 2006 both sifum and fvcom are well tested stand alone models they are independent solvers and have their own large complicated computer codes to avoid any possibility of incorrect alteration in these two models as a principle as little as possible modification is made in their codes while the sifum fvcom system is being programmed the modification is made mainly in their output input systems to realize solution exchange according to eqs 13 and 14 however a little alteration has to be made beyond the input output systems in these codes such as that to facilitate the schwarz iteration described in the following section 3 2 numerical method 3 2 1 overset grid method on the basis of partition of a computational domain as discussed in the previous section an overset grid method is presented to couple sifum and fvcom the grids of the two models may overlap arbitrarily as illustrated in fig 3 in fig 3 lines a b c and a b c correspond to ωsifum 1 in fig 2 which is the interface of sifum and lines d e f and d e f correspond to ωfvcom which is the interface of fvcom sifum has all of its variables such as u and p defined at the centroids of mesh elements and it needs boundary conditions at the centers of the elements faces on the interface e g the filled circles in fig 3 in fvcom v and ω are respectively defined at centroids of elements e g the inverted triangles in fig 3 and at grid nodes e g upright triangles in fig 3 other variables such temperature and salinity are defined at middle points of the vertical edges of elements e g squares in fig 3 in the modeling system sifum and fvcom exchange solutions as boundary conditions with each other at all of these points on and next to their interfaces according to eqs 13 and 14 in the modeling system the solution exchange between sifum and fvcom may be done by interpolation directly between their grids however this approach will be complicated in computational procedures and expensive in computational time the complexity and expensiveness come from the fact that the two models use unstructured meshes and that fvcom s mesh inundates with the restless sea surface and the interpolation is complicated they also result from complex connectivity between their meshes which causes the search for host elements to be time consuming since this is necessary at each time step in addition to the fact that ordering of their elements and nodes are essentially random in order to facilitate efficient solution exchange between sifum and fvcom an intermediate grid is introduced and the exchange of solutions between the two models will be through this intermediate mesh instead of directly from to these models fig 4 therefore both sifum and fvcom will send solution information only to the intermediate grid and will also receive the information only from it the intermediate grid is a stationary structured grid and it encloses all mesh elements of the two models involved in solution exchange such exchange is implemented via simple and efficient methods of interpolation as detailed in the following section 3 2 2 interface algorithm the integration formulated in eqs 13 and 14 is realized by interface algorithms presented in this section these algorithms consider the features of sifum and fvcom such as their discretization methods and the intermediate mesh introduced above these algorithms are different types of interpolation depending on the connectivity of the grids and as in many other applications they are all linear and thus locally second order in accuracy since both sifum and fvcom are second order schemes or their local accuracy is third order the accuracy at model interfaces is of one order lower first we consider the solution exchange between sifum s grid and the intermediate grid suppose p is a grid node of the intermediate mesh onto which the solution of sifum will be interpolated and it is located within an sifum s element which is the host element of node p fig 5 a the host element is identified according to the following condition 15 r i p n i 0 i 1 2 i where r ip is the vector from the center of face i of the host element to node p n i is the normal of its face i and i is the total number of the faces of the element then a linear interpolation of variable f is made as 16 f p f c f c r c p where fc is a solution such as u of sifum at the centroid of the host element and according to the gauss formula f c 1 δ i 1 i f i s i where δ is the volume of the host element si is the area of face i and fi the value of f at the center of the face r cp is the vector from the centroid c to node p let p be a point within the grid of sifum e g the circles in fig 3 and it be located in its host element 1 2 3 4 5 6 7 8 in the intermediate grid fig 5b a search for the host element will be made in the intermediate grid also according to condition 15 in this situation i 6 and n i may be determined by the cross product of the two vectors connecting two diagonal vertices of an element s surface e g 1 3 and 2 4 in fig 5b the locations of p and the nodes of its host cell are transformed into a local cartesian coordinate and then in this coordinate the solution at p is obtained with a trilinear interpolation from the eight nodes of the host element an efficient procedure for the computation is presented in tang 2006 since both the sifum s mesh and the intermediate grid are stationary the connectivity between them and the coefficients for interpolation will not change with time and they may be computed during the preprocess of a simulation let us consider solution interpolation between fvcom and the intermediate grid because the relative position between the fvcom s mesh and the intermediate grid changes in time their connectivity has to be determined at each time step during a simulation as shown in fig 6 a suppose p is a point on fvcom s mesh e g the inverted triangles upright triangles and squares in fig 3 to which a solution on the intermediate grid will be interpolated in this situation the host element is identified in the horizontal plane by the condition 17 r i j r i p 0 and it is determined in the vertical direction by the condition 18 z p z p z p here r ij e g r 12 is the vector of the edge of the host element and in the counterclockwise direction from the top view and r ip e g r 1p is the vector from point i to p fig 6a points p and p are the projection in the z direction of p onto the top and bottom surfaces of the element respectively the z coordinate of the former is computed as 19 z p z 1 r 1 p z 2 r 2 p z 3 r 3 p z 4 r 4 p 1 r 1 p 1 r 2 p 1 r 3 p 1 r 4 p and that for the latter is calculated similarly since fvcom s mesh keeps deforming in the vertical direction only z coordinates of its nodes change when p moves out the current host element it must move to another element that is above or below in this situation the position of the new host element changes only in the z direction but its projection in the vertical direction e g the rectangle 1 2 3 4 in fig 6a remains the same therefore an efficient and practical approach to search for the new host element is at each time step to search only in the vertical direction and it starts from the current host element and then moves upward and or downward mostly ending up with the new host element just next to the original host element in practical computations if p moves out of the latter once the host element has been identified the solution is interpolated from the intermediate grid to fvcom by a trilinear interpolation method tang 2006 suppose p is a node of the intermediate grid onto which the solution of fvcom at middle points of edges of elements will be interpolated fig 6b the host element is identified by following the methods formulated as eqs 17 and 18 and the search for the element at each time step is done with the procedure described above in addition the z coordinate of the projection of p is computed via the area weight 20 z p a 23 p z 1 a 31 p z 2 a 12 p z 3 a 23 p a 31 p a 12 p transfer of the solution from fvcom to the intermediate mesh is done by the following interpolation 21 f p a 23 p f 1 a 31 p f 2 a 12 p f 3 a 23 p a 31 p a 12 p 22 f p a 23 p f 1 a 31 p f 2 a 12 p f 3 a 23 p a 31 p a 12 p 23 f p z p z p z p z p f p f p f p where z p and z p are vertical coordinates of the projection of p onto planes 1 2 3 and 1 2 3 respectively as shown in fig 6b in the transfer of the solution of fvcom for fraction volume γ to the intermediate grid the nodes of the intermediate grid are divided into dry nodes γ 0 if they are above fvcom s solution for η and wet nodes γ 1 if they are below it see fig 4 from the intermediate grid to the grid of sifum in view of it being zero at z k 1 and having maximum of 1 the fraction volume is mapped by 24 γ min 1 z k 1 z z k 1 z surf γ surf z z k 1 and γsurf 0 5 is used and z associated with isosurface γsurf 0 5 is regarded as the water surface 3 3 march in time and schwarz iteration a scheme for solution exchange in time in association with a schwarz iteration scheme is designed to facilitate the model integration tang et al 2014b suppose the time step of the sifum fvcom system is δt and δt n sifumδt sifum n fvcomδt fvcom where δt sifum is the time step of sifum and δt fvcom is the time step of fvcom actually the time step for its internal mode δt i with n fvcom and n sifum being positive integers when the system marches from time level tn to the next time level tn δt n is the time level index first sifum and fvcom exchange the solution at their interface at tn and then they march in time independently at their own time steps δt sifum and δt fvcom the two models will exchange the solution again when they reach the next time level at t n 1 tn δt fig 7 for the sake of computational stability the external and internal modes of fvcom may use different time steps δt fvcom n splitδt e where δt e is the time step of the external mode and n split is a positive integer in comparison with sifom in our previous modeling system tang et al 2014b sifum tends to require much smaller time steps because of the adoption of the vof method in correspondence with the integration schemes discussed above a parallel version of schwarz iteration is used as a domain decomposition solver for the sifum fvcom system when marching in time from tn to t n 1 it reads s t n 1 0 s t n f t n 1 0 f t n do m 1 m u t n 1 m sifum u t n 1 m 1 fvcom o n ω sifum 1 γ t n 1 m sifum γ t n 1 m 1 fvcom o n ω sifum 1 ω sifum 2 u t n 1 m fvcom u t n 1 m 1 sifum o n ω fvcom ω fvcom s s t i m 0 t i t n i 1 δ t sifum i 1 2 n sifum in ω sifum f f t i m 0 t i t n i 1 δ t fvcom i 1 2 n fvcom in ω fvcom if s t n sifum m s t n sifum m 1 ɛ and f t n fvcom m f t n fvcom m 1 ɛ goto 1 end do 1 s t n 1 s t n sifum m f t n 1 f t n fvcom m where m is the index for the schwarz iteration m is its maximum and ε is a prescribed convergence criterion it is indicated that this schwarz iteration computes a heterogeneous domain decomposition problem it involves different partial differential equations distinct numerical methods and unlike computational grids in addition because both sifum and fvcom are implicit schemes note that fvcom is considered as an implicit method because its vertical diffusion term in the internal mode is handled implicitly while it marches in time although the others are treated explicitly and their coupling at their interfaces is also implicit the full accuracy of solutions of the sifum fvcom system will be achieved only when the schwarz iteration is convergent however such iteration will be time consuming and its overall solution accuracy may not degenerate much if a convergence is not reached which is indicated in theoretical analysis gustafsson 1981 as well as experiments in the following section when m 1 the coupling becomes explicit the solution at the interface lags in time by one time step and its accuracy there becomes first order in time 4 numerical experiment and validation 4 1 numerical experiment 4 1 1 1d dam break flow this is a 1d riemann problem of the governing equations with the following initial values 25 d 0 1 u 0 x 0 d 0 045 u 0 x 0 here the depth is in meters the subdomain of fvcom extends from 3 to 3 m in the x direction with a blanked zone from 0 15 to 0 15 m and its mesh has 14 400 triangular elements in the horizontal plane grid spacing 0 01 m longitudinally and 21 layers in the vertical direction grid spacing 0 0025 0 005 m the subdomain of sifum covers only the zone from 0 5 to 0 5 m with height at 0 2 m and its mesh has 2560 hexahedron elements in the horizontal plane grid spacing 0 005 m longitudinally and 41 layers in the vertical direction grid spacing 0 0025 0 005 m the width of the computational domain is set as 0 4 m and a slip condition is imposed at the lateral sides for both sifum and fvcom for sifum a nonslip condition is also applied at the channel bed and the initial condition for pressure is set according to eq 3 the time step of the system is 0 005 s in addition let n sifum 1 n fvcom 1 and n split 1 and hereafter these will be the default parameters the values for n sifum n fvcom and n split are so chosen for simplicity and an optimal combination of their values could play an important role in reducing the computational time for the whole system fig 8 presents the solution for water surface elevation together with the solutions obtained with sifum alone and fvcom alone it also shows measurements obtained in a laboratory study with the same parameters and conditions it is interesting to note that as seen in fig 8 in the solution of the sifum fvcom system the surge propagating toward the right contains no step in shape which is the solution of fvcom alone and is actually a standard shock form solution predicted by shallow water equation swes e g wang et al 2013 instead the system produces a surge with peaks and troughs as it travels toward the right and as seen in fig 8 the correctness of the system s solution in this regard is confirmed by the measurement therefore simulation of this riemann problem clearly illustrates a drawback of gfd models i e fvcom misses the physics that generates the peaks and troughs and the necessity to use the hybrid system in capturing the physical phenomena in order to test the performance of the modeling system a numerical experiment is performed on the accuracy order of the solution or the convergence rate of the solution using simulations obtained with the three sets of grid spacings and time steps assuming the solution changes gradually in space and time and contains no singular point an estimate for the solution accuracy reads e g tang and sotiropoulos 2007 26 k log f 2 δ f δ 2 f δ f δ 2 2 log 2 where f is a solution and represents the grid spacing and time step with 2 corresponding to the values used in previous computation the estimate of the accuracy order of solutions for all variables is presented in table 1 the table also shows that the solution converges with grid spacing and time step and the convergence rate is about 1 for water surface elevation in fvcom and 2 for all other variables a second order convergence rate is expected for a second order scheme which both sifum and fvcom adopt although this is not always true in a nonlinear situation also table 1 shows that one schwarz iteration m 1 and three such iterations m 3 produce a similar accuracy order indicating that the number of schwarz iterations has no significant effect on the overall accuracy order of the solution at the grid spacing and time step adopted here and hereafter the accuracy order in sifum is evaluated only by its solutions for water flows 4 1 2 transient flow over a sill in a channel with a sill located at its bottom a water body is initially static and then starts to flow as a velocity is imposed at its entrance the configuration of the channel is 27 1500 x 2000 y 200 1 0 6 e 4 10 6 x 2 x 0 y 80 x 0 z 150 100 1 x 500 4 x 0 z 120 70 1 x 500 4 x 0 here z 0 is set at the surface of the static water body the initial and boundary conditions at the inlet and the exit are 28 η 0 u 0 t 0 u 0 4 1 e 0 2 t x 1500 η 0 x 2000 in this experimental simulation sifum is applied at the convergent section of the channel and fvcom is used for the entire channel except for a blanked zone covered by sifum fig 9 three sets of meshes associated with different grid spacings and time steps are used table 2 to accurately resolve the free surface the grid spacing in the vertical direction is fine near the surface in the meshes of sifum in addition in this model a slip boundary condition is applied at the bottom of channel for simplicity and eq 3 is used to set up the initial condition for pressure an instantaneous solution for the velocity field obtained with the sifum fvcom system is shown in fig 10 a and it exhibits a pattern similar to that produced by fvcom alone fig 10b because the interfaces between sifum and fvcom are artificial boundaries it is important to ensure a seamless transition of their solutions across them i e to correctly resolve flow phenomena at such boundaries and generate no artifact there fig 11 depicts the vector field of the flow as it enters the subdomain of sifum it is seen that overall the two models present a similar pattern and no artifact occurs there however there is some discrepancy between the two models solutions which could be attributed to the difference inherited in the governing equations of the two models and inaccuracy of the interface algorithms as a further check on the solution at the interfaces the temporal evolution of the momentum fluxes at three adjacent cross sections one before one near and one after the left and right interfaces of sifum is examined because the configuration of the channel changes smoothly at the two interfaces the flow variables and the flux should have similar patterns and gradually vary near the two interfaces as depicted in fig 12 this is indeed the case the computed momentum fluxes at the three cross sections at each interface are about the same in pattern and value which further verifies that the flow at the interfaces is reasonably resolved and no pronounced artifact is generated there the result of the numerical experiment on the solution convergence is presented in table 3 it is seen that the solution for all variables of the modeling system converges and the convergence rate is approximately second order at this time point of the test for convergence the flow is smooth and resembles a layer flow and it has just entered the sifum region again table 3 indicates that the number of schwarz iterations has no obvious effect on the solution s overall accuracy order hereafter to save computational time m 1 is set as the default value in simulations of the following sections 4 2 validation 4 2 1 hydraulic jump a hydraulic jump is generated in a channel flow due to contraction of its right bank fig 13 the flow is steady and consists of a faster supercritical flow before the jump and a slower subcritical flow behind it in the simulation fvcom covers the entire computational domain with 4400 elements in the horizontal plane grid spacing approximately 0 8 m and 31 layers in the vertical direction grid spacing 0 025 m sifum wraps a small region with 350 427 mesh elements grid spacing approximately 0 8 m horizontally and approximately 0 03 m vertically fig 13 at the inlet of the flow u and η are set as 8 57 m s and 1 m respectively which correspond to fr 2 74 an extrapolation is used at the outlet the free surface obtained with the modeling system is presented in fig 14 it is seen that the surface elevation predicted by sifum exhibits a ridge at the jump whereas that predicted by fvcom increases monotonically from the lower level to the higher level at the jump on the basis of the swes without viscosity an analytical solution for the flow is available choi et al 2004 the analytical solution can serve as a benchmark to validate the numerical solutions although it is expected that they cannot be exactly the same because of difference in their governing equations a comparison on the reflection angle water depth and velocity of the two solutions is shown in fig 14b and table 4 it is observed that the numerical simulation results match well the analytical solution validating the ability of the sifum fvcom system to correctly resolve the flow reflection phenomena 4 2 2 3d dam break flow initially stationary water in two reservoirs is separated by an infinitely thin dam b b fig 15 the initial water depth is 10 m at the left side and 5 m at the right side after the dam is suddenly removed a flow is generated a surge bore travels toward the right a rarefaction propagates to the left and vortices occur at the two ends of the dam fennema and chaudhry 1990 the meshes of sifum and fvcom overlap as shown in fig 15a the former has 518 736 hexahedron elements grid spacing approximately 2 m horizontally and approximately 0 3 m vertically and the latter has 4108 elements in the horizontal plane grid spacing approximately 5 m and 25 layers in the vertical direction grid spacing approximately 0 5 m the time step of the system is 0 00125 s for reference simulation of the flow is also performed with sifum and fvcom individually the simulation with sifum uses 508 820 hexahedron elements with mesh resolution similar to that of the modeling system and that with fvcom uses the mesh for the modeling system it is seen clearly in fig 15 that in the sifum region of the sifum fvcom system the modeling system produces a solution similar to that produced by sifum alone which is the intention of applying the system in this region the flow exhibits a strong vertical motion because of collapse of the water on the left onto the water on the right and it cannot be resolved appropriately by fvcom in the fvcom region of the sifum fvcom system particularly around x 150 m it is seen that the bore obtained with the sifum fvcom system is different from that produced by fvcom alone the latter exhibits noises which are believed to be an artifact such a difference reflects the effects of the sifum solution for the local flow on the fvcom solution for the background flow fig 15b and d the simulation results have also been compared quantitatively with results in the literature in fig 16 the simulations from the literature include one based on 2d swes fennema and chaudhry 1990 and another based on fully 3d reynolds averaged navier stokes equations and a vof method biscarini et al 2009 in addition a simulation performed with a modeling system that is hybrid of fvcom and a godunov type model based on swes is also included tang et al 2013 fig 16 shows that overall the solution produced by the modeling system compares reasonably well with the solutions in the literature the discrepancy of the solutions is attributed to differences in the computational models and parameters such as mesh resolution 4 2 3 long wave impinging on a vertical cylinder a simulation is performed for a long wave propagating toward the seashore and then impinging on a vertical cylinder on a beach a laboratory experiment has been performed for the flow in a closed circuit current flume bremm et al 2015 and its configuration and parameters are used in the simulation fig 17 the flume s width w is 1 m and the average water depth d2 at its entrance is kept as 0 32 m the structure is placed onshore at a horizontal distance of 0 2 m from the still water line and it is square in cross section with side length of 0 1 m transient elevation of the wave at the left end with a period t of 90 s is used to drive the flow fig 17 fvcom covers the whole computational domain with 6024 elements in the horizontal plane grid spacing approximately 0 2 m and 21 layers in the vertical direction grid spacing mostly 0 05 m and sifum occupies a region around the structure with 19 500 elements grid spacing 0 01 0 1 m horizontally and 0 01 m vertically the time step of the sifum fvcom system is 0 02 s after its onset at the left end of the flume the long wave travels toward the beach and then it generates a current on the beach fig 18 depicts the snapshots of a 3d view of the current before when and after it reaches the cylinder the simulated hydrodynamic force on the cylinder f together with the measurement in the laboratory study is plotted in fig 19 it is seen that the simulation produces a force that compares satisfactorily with that from the measurement it not only captures the positive load which is exerted by the uprush and toward the right but also predicts the negative load which is generated by the backrush and toward the left the simulation of this flow serves as a validation of the sifum fvcom system s capacity to integrally predict propagation of waves generated in deep oceans the resulting flood on beaches and its hydrodynamic loading on coastal structures 5 application the sifum fvcom system developed in this paper is an unprecedented platform to directly perform high fidelity simulation of many emerging multiscale multiphysics coastal ocean flow problems one of such problems is the vulnerability of coastal structures to hydrodynamic impact of storm surges and tsunamis such vulnerability has been manifested during a number of events in recent years such as the 2011 tōhoku tsunami that was triggered by a magnitude 9 0 earthquake and subsequently caused tremendous devastation to inshore infrastructure such as coastal highway bridges in this section as examples to show the capacity of the new modeling system integral simulations are reported for the propagation of tsunamis from deep oceans all the way to beaches and then their hydrodynamic loading onto structures which are difficult to handle with existing models 5 1 tsunami wave and its impinging on a bridge deck in this application a wave from deep water propagates to the seashore and then it impinges on a bridge deck the flow is treated as 2d and the ocean bottom is simplified as an inclined plane fig 20 a as shown in fig 20a the entrance on the left is 14 000 m from the coastline and it has a still water depth of 204 m the width of the beach is set as 100 m a coastal bridge deck is used which is commonly used in the literature qu et al 2016 hayatdavoodi et al 2014 fig 20b the clearance height of the deck s center is set as 4 m above the beach and it is 605 3 m from the still water coastline in the computation as shown in fig 20a fvcom covers the whole computational domain with 16 704 elements in the horizontal plane with a grid spacing ranging from 10 to 20 m and 11 layers in vertical direction with a grid spacing of mostly 1 20 m sifum occupies only the region around the bridge deck with 102 180 unstructured hexahedron elements with a grid spacing of 0 05 2 m finest near the deck horizontally and 0 15 1 m vertically the time step of the system is 0 025 s the observed tsunami elevation with a maximum wave peak of 6 7 m at the iwate south station japan during the 2011 tōhoku tsunami is adopted to drive the flow as the boundary condition at the entrance fig 20c the simulated instantaneous surge and its impinging on the deck at four instances are shown in fig 21 in fig 21a the wave propagates in deep water then a flood run up with a steep front of about 5 m in depth is generated by the wave and it runs onto the land and approaches the deck fig 21b as it passes the deck the flood first runs mainly underneath it fig 21c soon as the elevation of the flood increases the water overtops the deck fig 21d the flow phenomena shown in fig 21 such as trapping of air between the deck and girders and overtopping of water on the deck fig 21d have been observed in early laboratory experiments and computer simulations qu et al 2016 hayatdavoodi et al 2014 the temporal history of the hydrodynamic load on the deck is plotted in fig 22 it is seen that in the time frame in fig 22 the horizontal load reaches its peak value as the flood passes the deck and then it decreases and vanishes gradually however at the same time the vertical load is more complicated it first increases to its peak and then dips to a minimum followed by a few fluctuations and then an increase to a plateau the dip in its value is caused mainly by the weight of the overtopping water these patterns in the simulated load profiles are consistent with those widely reported in experimental and computational investigations e g qu et al 2016 hayatdavoodi et al 2014 as shown in fig 22 the upward vertical load could be huge much larger than the horizontal load and this has been shown to be a crucial mechanism for damage of coastal bridges such as those destroyed during hurricane katrina douglass et al 2006 5 2 coastal flooding and its impact on a beachfront house the sifum fvcom modeling system is applied to simulate coastal flooding generated by an artificial tsunami and its impact on a beachfront house with realistic coastal settings in the simulation the new york bight is selected as the coastal region and its bathymetry data from the national oceanic and atmospheric administration noaa national centers for environmental information ncei are used noaa national centers for environmental information 2018 fig 23 a noaa s vdatum is used to convert the bathymetry data to the common vertical datum navd88 parker et al 2003 a typical coastal house is set at breezy point of rockaway beach new york on which many houses and infrastructure were destroyed during hurricane sandy in 2012 the configuration and parameters of the beachfront house are shown in fig 23a the information on the tsunami comes from a recent work on tsunami and its inundation mapping in this region performed for the us east coast under the auspice of the national tsunami hazard mitigation program shelby et al 2016 this tsunami was generated by the historical 165 km3 currituck underwater landslide at the east coast in this article the tsunami s surface elevation is combined with the regular tidal elevation observed from 0 00 on november 1 2015 to 23 00 on november 5 2015 utm zone 18 and then used as the boundary condition for the surface elevation at the open boundary in the combination the peak of the simulated tsunami elevation is shifted to coincide with that of the tide s peak so the combination represents a most serious situation fig 23b in addition an observed elevation is imposed as a boundary condition at the outlet of the computational domain along the hudson river noaa national data buoy center 2017 as seen in fig 23b a window time of about 16 h is used to ensure that the computed tidal flow has reached an equilibrium state before the tsunami surge enters the computational domain as shown in fig 23c fvcom covers the whole computational domain and its mesh has 108 921 elements with a grid spacing of 10 80 m in the horizontal plane and 11 layers with a grid spacing of mostly 1 3 m in the vertical direction sifum encloses a zone around the house and it uses 614 305 triangular elements with a grid spacing of 0 1 10 m in the horizontal direction 0 1 m at supporting pillars and 0 5 m at the house and 0 5 2 m in the vertical direction fig 23d the time step of the system is 0 05 s fig 24 a and b present the simulated large scale flooding in the estuary and small scale surge impinging on the house at two instances which are counted from 0 00 on november 1 2015 at these moments as indicated by the velocity legend the water velocity on the beach is more than 5 m s as the surge reaches the house water depth rises to about 3 5 m in front of the house and then passes from its lateral sides because of this passing and water going underneath the house the chance of water overtopping the house becomes smaller similar flow patterns were observed in an experiment on an elevated house thusyanthan and gopal 2008 fig 24c shows a detailed view of the flow field around the house including vortex shedding behind the supporting pillars the temporal evolution of the hydrodynamic load on the house is plotted in fig 24d in fig 24d similarly to the situation in section 5 2 the vertical force suddenly rises as the run up arrives at the house and then it dips such behaviors have been also reported in an experimental study of a flood passing a suspended cubic box bradner et al 2011 all of these results illustrate that the proposed sifum fvcom modeling system can not only capture large scale flow phenomena within realistic coastal settings but also is able to simultaneously resolve local small scale hydrodynamic phenomena and relevant parameters such as the vertical force exerted on the bottom of the house which is beyond the capability of exiting gfd models 6 concluding remarks the sifum fvcom system presented in this article results from a series of efforts by the authors toward high fidelity simulation of coastal ocean flows particularly local phenomena tang and wu 2010 tang and keen 2011 qu 2017 qu et al 2016 wu and tang 2010 tang et al 2014b tang et al 2016 the method and numerical algorithms of the system are discussed in detail and it has been tested and validated systematically against data from analytical solutions numerical computations and laboratory measurements in comparison with the system in tang et al 2014b the current system exceeds it in capabilities to deal with complicated free surface local flows and their complex geometries in this paper the system s unique capabilities are illustrated in simulations of example coastal flooding problems which are difficult to handle with existing models the sifum fvcom system provides a new platform to simulate realistic multiphysics flows at distinct scales especially those at small scales and with free surfaces and it has advanced our capability of high fidelity simulation of such flows with this system we can simulate many complicated local problems such as those in section 5 and have arrived at a point closer to direct simulation of many difficult problems such as the example problems in the first paragraph of section 1 as a special feature because the system simultaneously simulates far field and near field flows and permits seamless coupling between them it can be used as a tool to study effects of small scale local flows on large scale background flows which are frequently unclear but of interest in the study of real world problems with the sifum fvcom system more things are within our reach with necessary modification it is expected that the method and algorithms used in construction of the sifum fvcom system can be used to build another integrated 3dfd gfd system with a different 3dfd model such as the open source field operation and manipulation openfoam and another gfd model such as the princeton ocean model pom and the regional ocean modeling system roms moreover in the present study of the sifum fvcom system sifum has been applied only to flows with free surfaces which are the main target for its development however in view of its design the system can also be used when sifum is used for local flows without free surfaces besides sifum is used in only one subdomain in this work but the system is applicable when it is adopted in multiple subdomains the development of the sifum fvcom system may seem straightforward and trivial however this is by far not the case its realization is challenging because it involves integration of different governing equations numerical methods and computational meshes in order to achieve better performance and the full potential of such a system further investigations on three fundamental issues are necessary 1 as a crucial issue methods that couple a 3dfd model and a gfd model directly affect correctness and accuracy of solutions and they could lead to onset of artifacts at model interfaces with this in mind as well recognized in the literature primarily in situations with a same set of governing equations in different subdomains conservative algorithms at grid interfaces perform better than standard interpolation e g tang 2006 hubbard and chen 1994 however realization of conservation between a 3dfd model and a gfd model encounters difficulties one of such difficulties is that the two models have different governing equations and only very limited study of their coupling conditions has been made blayo 2016 relevantly in development of conservative interface algorithms selection of variables to be conserved across model interfaces also needs to be investigated 2 since sifum is applied at local flows with fine meshes plus the fact that it adopts a vof method the time step permitted by stability is small and this makes the computation of the whole system very time consuming consequently it is important to use large time steps in sifum and this may be achieved with techniques of semi lagrangian advection e g lentine et al 2012 3 in simulation of actual problems the computation will be intensive in computational time and memory and thus study on parallel computing with good scaling and efficient domain decomposition schemes is highly desired in general a study for the sifum fvcom system deals with the coupling of two stand alone complicated highly nonlinear models and it is a challenging task to investigate above issues notwithstanding given the feasibility and promising performance of the sifum fvcom system demonstrated in this work all of these issues will be considered in future work acknowledgments this work is sponsored by the national science foundation cmmi 1334551 dms 1622459 partial support also comes from the utrc program and for kq the national natural science foundation of china 51809021 the authors thank dr c s chen for his input on fvcom and the anonymous reviewers for their valuable suggestions supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ocemod 2019 01 001 appendix supplementary materials image application 1 
24049,a modeling system is presented for simulation of multiphysics coastal ocean flows at scales from o 1 m to o 1 000 km especially for high fidelity simulation of local complicated free surface phenomena the system integrates the solver for incompressible flow on unstructured mesh sifum and the finite volume coastal ocean model fvcom on the basis of domain decomposition in this system the former is built on the navier stokes equations and simulates small scale fully three dimensional phenomena in local flows whereas the latter is based on the geophysical fluid dynamics equations and predicts large scale background ocean currents the integrated sifum fvcom system is developed from a previous system consisting of a structured grid model and an unstructured grid model tang et al j comput phys 273 2014 and it combines two unstructured grid models and has the capability of dealing with free surface phenomena and complex geometries in local flows in the new system sifum and fvcom are two way coupled via schwarz iteration and they march in time together as a single system the sifum fvcom system performs as intended with regard to capturing physical phenomena e g generation of dam break wave and slashing of water at a structure converging with grid spacing and time step and permitting seamless transition of solutions for far and near fields in addition its prediction of benchmark flow problems matches well with analytical computational and experimental data the system is able to simultaneously and directly simulate many multiscale multiphysics real world phenomena that could not be handled before such capability is illustrated by its application to coastal flooding and the resulting impact on a coastal bridge and a beachfront house keywords multiscale multiphysics near field free surface model coupling overset grids the sifum fvcom system 1 introduction it has become important and urgent to develop our capabilities to simulate many emerging coastal ocean flow problems associated with distinct types of physical phenomena at vastly different scales these problems occur in various natural processes as well as because of fast expansion of human activities in coastal and oceanic waters and the importance and need to develop such simulation capabilities are clearly manifested in two examples in the first example the 2011 tōhoku tsunami started as surface waves with tiny amplitude in a deep ocean with horizontal scales of o 1 000 km and it evolved into huge walls of water as high as 39 m near the seashore and then splashed against structures such as inland houses and bridges at o 10 m o means at order of magnitude leading to 14 508 casualties 11 452 missing people and property damage in value ranging from 16 to 25 trillion yen mimura et al 2011 an emerging and crucial problem in such an event is to predict currents and waves in detail at structures and estimate the hydrodynamic force acting on them the second example comes from the fast growing worldwide practice of power generation from marine hydrokinetic mhk energy which has been estimated to be 8800 tw h per year globally with 10 being technically recoverable tang et al 2014a yuce and muratoglu 2015 twisted with background ocean currents at o 10 km on horizontal scales the flow at an mhk turbine is fully three dimensional 3d and at scales of o 10 m this flow exhibits various small scale phenomena including a meandering motion a tip vortex shear layer an inner layer counter rotating hub vortex in the wakes and even cavitation kang et al 2014 an emerging problem as well as a main challenge in this practice is the evaluation of power output and potential environmental impact yuce and muratoglu 2015 which requires reliable and high fidelity simulation of those phenomena at small scales and their interaction with tidal currents at larger sales besides these two examples there are more examples such as dispersion of oil spills from seabed camilli et al 2010 effects of local flows at seamounts on plankton distribution stevens et al 2014 and waves generated by entry of asteroids gisler et al 2011 although originating from different backgrounds all of these examples present a common challenge to our modeling capacity they involve multiple phenomena by nature that exhibit distinct behaviors in physics e g vortex surface wave and water splashing are better described by different governing equations and span a vast range of spatial and temporal scales these phenomena have been referred to as multiphysics and multiscale flows because of such nature tang and wu 2010 tang and keen 2011 candy 2017 so far essentially we have no appropriate methods and computer software to directly and integrally perform high fidelity simulation of these multiscale and multiphysics problems here directly means fully resolving without parameterization this article targets these phenomena especially those fully 3d complicated local ones and it develops capacity for their high fidelity simulation during the past few decades a number of computer models based on geophysical fluid dynamics gfd equations have been developed by the ocean science community for ocean currents and waves e g blumberg and mellor 1987 chen et al 2003 haidvogel et al 2008 booij et al 1999 these gfd models have been very successful in application to flows with periods as long as months and over regions as large as mesoscales with horizontal sizes from o 10 to o 10 000 km e g klinger and cruz 2009 miles et al 2017 in recent years there has also been a trend to apply such models to flow problems at smaller scales e g less than o 100 m such as tidal energy and coastal flooding e g tang et al 2014a westerink et al 2008 yin et al 2016 however because of restrictions inherent in the governing equations e g the hydrostatic assumption numerical techniques and parameterization the gfd models are unsuitable for strongly 3d local flows such as oil jet spills at seabed in addition these models including their nonhydrostatic versions are designed with layer grids and thus they cannot handle domains that are multiply connected in the vertical direction such as a hole in a seamount and rotating blades of an mhk turbine moreover it has been found that the models may encounter numerical difficulties including instability at small grid spacing and time step heimusund and berntsen 2004 efforts have also been made to design gfd models on the basis of fully 3d governing equations e g fluidity icom candy 2017 oishi et al 2013 and such models can take nonhydrostatic effects into account however because of their grid layout and way to capture water surface they cannot directly handle some local phenomena such as wave splashing at a wall and flow under a bridge deck at the same time software packages built on fully 3d fluid dynamics 3dfd whose governing equations are the navier stokes equations have also been designed for various small scale physical phenomena in engineering communities e g mechanical civil and hydraulic engineering overture november 2012 ansys inc november 2010 opencfd 2004 the 3dfd approaches including direct numerical simulation may not have the aforementioned limitations of the large scale gfd models and they can satisfactorily predict fully 3d complicated local flows with high fidelity at scales of o 1 m o 10 km including the flows that cannot be handled by gfd models as discussed previously e g oil spills at seabed vortices stemming from an mhk turbine tang et al 2008 kang et al 2012 as an example fig 1 shows an instantaneous 3dfd solution for waves impacting a coastal bridge deck and the resulting hydrodynamic load on it the 3dfd modeling captures many dynamic processes that are beyond the reach of gfd models such as splashing of water at the left fascia of the deck fig 1a and b trapping of air between the deck and water fig 1a and the onset of air bubbles at the bottom of the girders fig 1b in general hydrodynamic load on a structure consists of quasi static and slamming forces cuomo et al 2009 and this 3dfd modeling clearly resolves both of these forces fig 1c and d in particular while gfd modeling is able to estimate quasi static forces it cannot deal with the slamming force at all which is caused by water surface impinging directly onto a structure s surface and can be an order magnitude greater than the quasi static force in principle 3dfd can be used for large scale coastal ocean flows nevertheless it is prohibitively expensive for simulation of realistic large scale coastal ocean flows in terms of computational time and memory e g the mesh resolution at the wall in fig 1 is at o 1 mm and it is also ineffective because of limitations in its governing equations and computational techniques because computer modeling has reached the point where gfd and 3dfd models have become mature for their designated flow phenomena and scales integration of these two models is now considered a natural promising and also currently the most feasible approach for simulation of multiscale and multiphysics coastal ocean flows e g fringer et al 2006 in this approach an ocean flow is divided into a large scale far field e g a deep ocean region and a small scale near field e g flow at an mhk turbine the traditional understanding is that the former has dominant effects on the latter whereas the influence in the opposite way i e from small to large scales is secondary or negligible with this understanding a simulation for the far field is performed with a gfd model and then with its results as initial and boundary conditions a further simulation is conducted for the near field with the aid of a small scale model e g a 3dfd model this is one way coupling and solution information goes only from the large scale to the small scale model this one way approach is reasonable and it has been applied in many applications e g coastal flooding yin et al 2016 however such a one way approach has difficulties and limitations and it may not be applicable in some situations firstly it may not be easy or appropriate to divide an ocean flow into far and near fields in actual applications for instance in order to avoid the effects of an object e g an mhk turbine enclosed in it a near field needs to be large enough and this may increase the computational cost substantially for the near field assigned with an expensive model e g a full navier stokes solver also the influence of a near field on its far field has to be included in some situations for example such influence is important in understanding the interaction between background currents and local flows at an array of mhk turbines in tidal power development brown et al 2017 moreover it has been shown that small scale flow trajectories could have pronounced effects on large scale flow trajectories in lagrangian particle tracking in the jamaica bay qu et al 2016 in general effects of small scale flows are difficult to identify clearly but they are attracting increasing attention from the community in many problems such as the emerging problems discussed in the first paragraph of this section secondly a one way coupling approach is not computationally efficient it needs some methods e g interpolation implemented manually or by customized software to transfer the results e g speed from a large scale model to a small scale model it is also not straightforward to apply such results as initial and boundary conditions for the small scale model since they keep changing in magnitude and direction as a result so far largely such data have to be simplified for example into those associated with unidirectional steady flows e g in simulation of local flows at an mhk turbine tang et al 2008 thirdly one way coupling could introduce considerable errors and uncertainty during the data transfer from large scale to small scale models given the fact that ocean flows are complicated and constantly changing in magnitude and direction such errors and uncertainty are difficult to estimate especially during storms consequently to overcome the aforementioned difficulties it is necessary to develop two way coupling methods for coastal ocean flows this is also in line with the trend of multiscale and multiphysics modeling whose research has become active in many other areas domain decomposition has been studied and used intensively in computational fluid dynamics cfd and it provides a framework for the development of two way coupling methods for coastal ocean flows since the early 1980s research on domain decomposition methods for cfd has been conducted to mainly overcome difficulties associated with complex geometries e g benek et al 1983 meakin and street 1988 and then to improve computational efficiency e g meakin and street 1988 chen et al 2014 in these efforts mostly a same set of governing equations are used in different subdomains and intensive research has been conducted on key issues such as algorithms at grid interfaces e g berger 1987 henshaw and watson 1994 tang and zhou 1999 tang et al 2003 and methods for solution of algebraic systems resulting from discretization e g saad and schultz 1986 pavarino and widlund 2002 as a powerful cfd approach nesting grids within a same model has become routine practice to resolve local phenomena in coastal ocean flows oey and chen 1992 sheng and tang 2004 gradually efforts have proceeded to simulation of multiphysics phenomena by coupling of different sets of governing equations these efforts include one dimensional 1d two dimensional 2d coupling sitanggang and lynett 2010 kim et al 2010 2d 2d coupling yin et al 2016 2d 3d coupling tang et al 2013 fujima et al 2002 and 3d 3d coupling paulsen et al 2014 in these efforts simplification such as the boussinesq assumption potential flows and nested meshes has to be adopted in addition not all component models are the best available status representative types in the communities because of all of these factors only limited physics can be captured especially in small scale flows in order to simulate multiscale multiphysics realistic coastal ocean flows we proposed to directly and fully integrate a gfd model and a 3dfd model particularly the finite volume coastal ocean model fvcom and the solver for incompressible flow on overset meshes sifom respectively into a single modeling system tang and wu 2010 qu et al 2016 wu and tang 2010 tang et al 2014b fvcom is a typical coastal ocean model and it is widely used in the ocean science community for prediction of ocean flow problems chen et al 2003 sifom is developed by the authors and coworkers and it has been tested and applied in various small scale fully 3d engineering flow problems tang et al 2014b as the first of its kind the sifom fvcom system is able to simulate many multiphysics coastal ocean flows at scales ranging from o 1 m to o 1 000 km across mesoscales and submesoscales that cannot be handled by other existing models qu et al 2016 tang et al 2014b however the sifom fvcom system cannot deal with free surfaces at local flows because sifom lacks such capability and thus it is not applicable to many important problems e g impinging of surges and waves on a coastal structure in addition sifom uses structured grids and thus the sifom fvcom system is not flexible in dealing with complicated geometries at local flows in this article to overcome the aforementioned shortcomings of the sifom fvcom system a new 3dfd gfd system which is a hybrid of fvcom and the solver for incompressible flow on unstructured mesh sifum has been developed qu 2017 qu et al 2017 sifum can directly simulate many complicated small scale flows beyond the capabilities of gfd models such as those in fig 1 in terms of the governing equations and capabilities fvcom and sifum are respectively among the currently best available types of gfd models in the ocean science community e g blumberg and mellor 1987 chen et al 2003 haidvogel et al 2008 and 3dfd models in the engineering communities e g overture november 2012 ansys inc november 2010 opencfd 2004 the main difference between the sifom fvcom system and the sifum fvcom system stems from sifum which enables the latter to be able to model local flows with strong distortion in free surfaces and easily handle local complicated geometries the new system is an extension of the previous system however such extension is not trivial at all but challenging in its realization the challenge comes from the fact that sifom and sifum are very different in terms of discretization methods and computational meshes plus the fact that sifum and fvcom are two stand alone software packages actually it has been reported that artifacts and instability may take place in integration of sifom and fvcom and discretion is necessary with regards to these aspects tang et al 2016 while following the framework and techniques of the sifom fvcom system development of algorithms is necessary in dealing with new issues such as those related to coupling of free surfaces between unstructured grids of sifum and fvcom additionally schematic and rigorous tests are also necessary in the development of the sifum fvcom system 2 governing equations and discretization the governing equations of sifum are the full 3d naiver stokes equations for incompressible flows of an air water mixture and they are expressed as 1 u 0 2 ρ u t ρ uu μ eff u u μ eff p ρ ρ ref g where t is the time u is the velocity p is the pressure and ρ is the density of the air water mixture the components of u are u v and w in the x y and z direction respectively ρref is a reference density μeff is the effective viscosity and g is gravity μeff μl μt where μl is the laminar viscosity and μt is the turbulence viscosity the total pressure is p and it is calculated as 3 p p ρ ref r g where r is the vector starting from a reference point to the location where the total pressure is evaluated in this work ρref is set as the air density and the reference point is selected as a point on the air flow s boundary as a result p equals the total pressure minus the pressure caused by the air weight the turbulence closure is made with use of the smagorinsky model smagorinsky 1963 4 μ t ρ c s λ 2 e where c s is a coefficient between 0 1 and 0 2 and it is set as 0 2 in this article e is the strain rate and λ is the volume of a mesh cell s control volume in order to deal with complex geometries sifum adopts an unstructured grid whose elements may be tetrahedrons pentahedrons hexahedrons and triangular prisms mostly the last two are used in this article or any combination of them in this model all variables are defined at the centroid of a mesh element a second order accurate three level backward differencing is used to discretize the time derivative term and the discretization for the governing equations is fully implicit the advection term is approximated by a deferred correction scheme fergizer and peric 2002 which is a hybrid of a first order upwind scheme and the second order gamma finite difference jasak 1996 the diffusion term is discretized by the central difference in the normal directions of an element s faces with the aid of values at the centers of the element and its neighbor elements the pressure gradient is treated similarly as the diffusion term to avoid the checkerboard phenomenon a so called momentum interpolation method is used to evaluate momentum fluxes at the faces of an element in discretization of the momentum equation rhie and chow 1983 the continuity equation is computed as the summation of fluxes of volume flow rate across the faces of each control volume velocity and pressure are coupled with each other by the pressure implicit split operator method issa 1986 in order to handle complex free surface phenomena such as splashing of water sifum uses a volume of fluid vof method to resolve water surfaces by which the transportation equation for the volume fraction reads hirt and nichols 1981 5 γ t γ u 0 where γ is the volume fraction defined as 6 γ 0 air 0 γ 1 interface γ 1 water the density and viscosity are functions of γ 7 ρ ρ air γ ρ water ρ air 8 μ l μ air γ μ water μ air in eqs 7 and 8 the subscripts water and air refer to a property of water and a property of air respectively in this work eq 5 is discretized in form of the crank nicolson scheme a vof method called the switching technique for advection and capturing of surfaces stacs is used to resolve the free surface between water and air darwish and moukalled 2006 stacs is a high resolution scheme based on the normalized variable diagram concept leonard 1991 which switches between different high resolution finite difference schemes to yield a bounded value of the volume fraction according to the free surface orientation because of its adoption of a vof method sifum solves the flow of a water air mixture and it captures water surfaces naturally and resolves complex local phenomena such as water splashing with many separate water drops directly rather than tracking free surfaces piece by piece as in gfd models that solve the navier stokes equations e g candy 2017 oishi et al 2013 sifum has been tested and validated intensively in simulations of various problems such as dam break flows currents impacting cylinders and solitary and focused waves impinging on coastal bridge decks and the results compare well with available data in the literature qu 2017 qu et al 2017 the details of sifum including its algorithms and numerical examples are presented in qu 2017 as a typical geophysical fluid dynamics gfd model fvcom has an external mode and an internal mode chen et al 2003 the governing equations for the external mode are the 2d depth average continuity and momentum equations 9 η t h v d 0 10 v d t h vv d g d h η τ s τ b ρ o g where η is the water surface elevation d is the water depth and v is the horizontal velocity h is the horizontal gradient τ b and τ s are the shear stress on the seabed and the water surface respectively ρo is the water density at atmosphere pressure and g includes the other terms such as the coriolis force the governing equations for the internal mode of fvcom are the 3d continuity and momentum equations under the hydrostatic assumption 11 η t h v d ω σ 0 12 v d t h vv d v ω σ g d h η h κ e λ v σ σ d g d ρ o h d σ 0 ρ d σ σ ρ h d h where v is the horizontal velocity and ω is the vertical velocity in the σ coordinate here v and ω comprise velocity u h includes the other terms the subscript σ indicates a derivative with respect to σ and κ and λ are coefficients the mellor and yamada level 2 5 turbulent model is used for turbulence viscosity chen et al 2006 in fvcom the governing equations are solved by a finite volume method on a triangular mesh in the horizontal plane and a σ grid in the vertical direction the time derivative terms are discretized by a runge kutta method and the convection terms are approximated with the aid of upwind schemes in this model pressure is not present explicitly but can be recovered from the water surface elevation according to the hydrostatic assumption version 2 6 of fvcom is used in this paper and the readers are referred to chen et al 2006 for further details of the model 3 integration of sifum and fvcom 3 1 model integration in general 3dfd eqs 1 and 2 are nonhydrostatic but in a region with negligible nonhydrostatic effects these equations will degenerate to be hydrostatic and these equations as well as gfd eqs 9 12 are applicable with such understanding by the idea of domain decomposition the computational domain for a coastal ocean flow is divided into two subdomains one corresponding to a far field and the other corresponding to a near field and the interfaces between them are allocated in regions with hydrostatic flows as shown in the schematic representation in fig 2 sifum is used in subdomain ωsifum the near field which covers small scale local physical phenomena of interest here a flow at a coastal bridge fvcom is used in subdomain ωfvcom the far field which covers large scale background ocean currents subdomain ωsifum includes both an air zone and a water zone and subdomain ωfvcom occupies the water body extending from its boundary at ωfvcom to far open boundaries subdomains ωsifum and ωfvcom overlap with each other and the interfaces between them are ωsifum 1 and ωfvcom notice that ωfvcom remains stationary whereas ωsifum 1 and ωsifum 2 move with time because of restless motion of the water surface ideally the size of ωsifum is sufficiently large and the lateral and top sections in its boundary ωsifum ωsifum 4 are far from an object if it contains for example the bridge in fig 2 in this situation air flow at its top ωsifum 3 is not disturbed by the object and the pressure there is atmospheric pressure additionally water flow on its lateral sides ωsifum 1 is almost hydrostatic and fvcom is applicable there let s and f stand for the operators corresponding to discretization of eqs 1 8 in sifum and eqs 9 12 in fvcom respectively and also let s p γ u and f η v u be the variables for the former and the latter respectively then the two models are integrated as follows 13 sifum s s 0 i n ω sifum u sifum u fvcom o n ω sifum 1 γ sifum γ fvcom o n ω sifum 1 ω sifum 2 p 0 o n ω sifum 3 p n 0 o n ω sifum ω sifum 3 14 fvcom f f 0 i n ω fvcom u fvcom u sifum o n ω fvcom ω fvcom where the subscripts sifum and fvcom indicate values obtained with sifum and fvcom respectively as seen in eq 13 sifum takes the solution of fvcom on ωsifum 1 as a boundary condition for sifum p 0 on ωsifum 3 and this means that pressure equals atmospheric pressure gauge pressure there in view of the divergence free condition that is eq 1 velocity is not imposed as a boundary condition along the entire boundary but is imposed along the water section ωsifum 1 and not along the air section ωsifum 2 on ωsifum 1 ωsifum 2 fvcom s value for γ is determined by its solution for η in eq 14 fvcom adopts the solution of sifum not only along ωfvcom but also in ω fvcom which is a blanked zone of fvcom this is because a velocity redistribution step in the internal mode of fvcom needs the solution for velocity within ω fvcom chen et al 2006 it is noted that blanking zone is an overset grid technique used to facilitate two way coupling in simulation of flows e g flow past a cylinder tang et al 2003 the vertical velocity w in fvcom is transferred from its solution ω in the σ coordinate for sifum and fvcom more boundary conditions are necessary such as for the latter a surface elevation condition at the open sea it is pointed out that inappropriate conditions at the interfaces of sifum and fvcom could lead nonphysical solutions or even an unstable computation which have been observed in our early work tang et al 2014b tang et al 2016 therefore it is crucial to correctly set up these conditions so that computational problems of sifum fvcom and the sifum fvcom system are all well posed and the integration methods in eqs 13 and 14 result from theoretical considerations and numerical tests with these aspects nordström and svärd 2005 temam 2003 tang 2006 both sifum and fvcom are well tested stand alone models they are independent solvers and have their own large complicated computer codes to avoid any possibility of incorrect alteration in these two models as a principle as little as possible modification is made in their codes while the sifum fvcom system is being programmed the modification is made mainly in their output input systems to realize solution exchange according to eqs 13 and 14 however a little alteration has to be made beyond the input output systems in these codes such as that to facilitate the schwarz iteration described in the following section 3 2 numerical method 3 2 1 overset grid method on the basis of partition of a computational domain as discussed in the previous section an overset grid method is presented to couple sifum and fvcom the grids of the two models may overlap arbitrarily as illustrated in fig 3 in fig 3 lines a b c and a b c correspond to ωsifum 1 in fig 2 which is the interface of sifum and lines d e f and d e f correspond to ωfvcom which is the interface of fvcom sifum has all of its variables such as u and p defined at the centroids of mesh elements and it needs boundary conditions at the centers of the elements faces on the interface e g the filled circles in fig 3 in fvcom v and ω are respectively defined at centroids of elements e g the inverted triangles in fig 3 and at grid nodes e g upright triangles in fig 3 other variables such temperature and salinity are defined at middle points of the vertical edges of elements e g squares in fig 3 in the modeling system sifum and fvcom exchange solutions as boundary conditions with each other at all of these points on and next to their interfaces according to eqs 13 and 14 in the modeling system the solution exchange between sifum and fvcom may be done by interpolation directly between their grids however this approach will be complicated in computational procedures and expensive in computational time the complexity and expensiveness come from the fact that the two models use unstructured meshes and that fvcom s mesh inundates with the restless sea surface and the interpolation is complicated they also result from complex connectivity between their meshes which causes the search for host elements to be time consuming since this is necessary at each time step in addition to the fact that ordering of their elements and nodes are essentially random in order to facilitate efficient solution exchange between sifum and fvcom an intermediate grid is introduced and the exchange of solutions between the two models will be through this intermediate mesh instead of directly from to these models fig 4 therefore both sifum and fvcom will send solution information only to the intermediate grid and will also receive the information only from it the intermediate grid is a stationary structured grid and it encloses all mesh elements of the two models involved in solution exchange such exchange is implemented via simple and efficient methods of interpolation as detailed in the following section 3 2 2 interface algorithm the integration formulated in eqs 13 and 14 is realized by interface algorithms presented in this section these algorithms consider the features of sifum and fvcom such as their discretization methods and the intermediate mesh introduced above these algorithms are different types of interpolation depending on the connectivity of the grids and as in many other applications they are all linear and thus locally second order in accuracy since both sifum and fvcom are second order schemes or their local accuracy is third order the accuracy at model interfaces is of one order lower first we consider the solution exchange between sifum s grid and the intermediate grid suppose p is a grid node of the intermediate mesh onto which the solution of sifum will be interpolated and it is located within an sifum s element which is the host element of node p fig 5 a the host element is identified according to the following condition 15 r i p n i 0 i 1 2 i where r ip is the vector from the center of face i of the host element to node p n i is the normal of its face i and i is the total number of the faces of the element then a linear interpolation of variable f is made as 16 f p f c f c r c p where fc is a solution such as u of sifum at the centroid of the host element and according to the gauss formula f c 1 δ i 1 i f i s i where δ is the volume of the host element si is the area of face i and fi the value of f at the center of the face r cp is the vector from the centroid c to node p let p be a point within the grid of sifum e g the circles in fig 3 and it be located in its host element 1 2 3 4 5 6 7 8 in the intermediate grid fig 5b a search for the host element will be made in the intermediate grid also according to condition 15 in this situation i 6 and n i may be determined by the cross product of the two vectors connecting two diagonal vertices of an element s surface e g 1 3 and 2 4 in fig 5b the locations of p and the nodes of its host cell are transformed into a local cartesian coordinate and then in this coordinate the solution at p is obtained with a trilinear interpolation from the eight nodes of the host element an efficient procedure for the computation is presented in tang 2006 since both the sifum s mesh and the intermediate grid are stationary the connectivity between them and the coefficients for interpolation will not change with time and they may be computed during the preprocess of a simulation let us consider solution interpolation between fvcom and the intermediate grid because the relative position between the fvcom s mesh and the intermediate grid changes in time their connectivity has to be determined at each time step during a simulation as shown in fig 6 a suppose p is a point on fvcom s mesh e g the inverted triangles upright triangles and squares in fig 3 to which a solution on the intermediate grid will be interpolated in this situation the host element is identified in the horizontal plane by the condition 17 r i j r i p 0 and it is determined in the vertical direction by the condition 18 z p z p z p here r ij e g r 12 is the vector of the edge of the host element and in the counterclockwise direction from the top view and r ip e g r 1p is the vector from point i to p fig 6a points p and p are the projection in the z direction of p onto the top and bottom surfaces of the element respectively the z coordinate of the former is computed as 19 z p z 1 r 1 p z 2 r 2 p z 3 r 3 p z 4 r 4 p 1 r 1 p 1 r 2 p 1 r 3 p 1 r 4 p and that for the latter is calculated similarly since fvcom s mesh keeps deforming in the vertical direction only z coordinates of its nodes change when p moves out the current host element it must move to another element that is above or below in this situation the position of the new host element changes only in the z direction but its projection in the vertical direction e g the rectangle 1 2 3 4 in fig 6a remains the same therefore an efficient and practical approach to search for the new host element is at each time step to search only in the vertical direction and it starts from the current host element and then moves upward and or downward mostly ending up with the new host element just next to the original host element in practical computations if p moves out of the latter once the host element has been identified the solution is interpolated from the intermediate grid to fvcom by a trilinear interpolation method tang 2006 suppose p is a node of the intermediate grid onto which the solution of fvcom at middle points of edges of elements will be interpolated fig 6b the host element is identified by following the methods formulated as eqs 17 and 18 and the search for the element at each time step is done with the procedure described above in addition the z coordinate of the projection of p is computed via the area weight 20 z p a 23 p z 1 a 31 p z 2 a 12 p z 3 a 23 p a 31 p a 12 p transfer of the solution from fvcom to the intermediate mesh is done by the following interpolation 21 f p a 23 p f 1 a 31 p f 2 a 12 p f 3 a 23 p a 31 p a 12 p 22 f p a 23 p f 1 a 31 p f 2 a 12 p f 3 a 23 p a 31 p a 12 p 23 f p z p z p z p z p f p f p f p where z p and z p are vertical coordinates of the projection of p onto planes 1 2 3 and 1 2 3 respectively as shown in fig 6b in the transfer of the solution of fvcom for fraction volume γ to the intermediate grid the nodes of the intermediate grid are divided into dry nodes γ 0 if they are above fvcom s solution for η and wet nodes γ 1 if they are below it see fig 4 from the intermediate grid to the grid of sifum in view of it being zero at z k 1 and having maximum of 1 the fraction volume is mapped by 24 γ min 1 z k 1 z z k 1 z surf γ surf z z k 1 and γsurf 0 5 is used and z associated with isosurface γsurf 0 5 is regarded as the water surface 3 3 march in time and schwarz iteration a scheme for solution exchange in time in association with a schwarz iteration scheme is designed to facilitate the model integration tang et al 2014b suppose the time step of the sifum fvcom system is δt and δt n sifumδt sifum n fvcomδt fvcom where δt sifum is the time step of sifum and δt fvcom is the time step of fvcom actually the time step for its internal mode δt i with n fvcom and n sifum being positive integers when the system marches from time level tn to the next time level tn δt n is the time level index first sifum and fvcom exchange the solution at their interface at tn and then they march in time independently at their own time steps δt sifum and δt fvcom the two models will exchange the solution again when they reach the next time level at t n 1 tn δt fig 7 for the sake of computational stability the external and internal modes of fvcom may use different time steps δt fvcom n splitδt e where δt e is the time step of the external mode and n split is a positive integer in comparison with sifom in our previous modeling system tang et al 2014b sifum tends to require much smaller time steps because of the adoption of the vof method in correspondence with the integration schemes discussed above a parallel version of schwarz iteration is used as a domain decomposition solver for the sifum fvcom system when marching in time from tn to t n 1 it reads s t n 1 0 s t n f t n 1 0 f t n do m 1 m u t n 1 m sifum u t n 1 m 1 fvcom o n ω sifum 1 γ t n 1 m sifum γ t n 1 m 1 fvcom o n ω sifum 1 ω sifum 2 u t n 1 m fvcom u t n 1 m 1 sifum o n ω fvcom ω fvcom s s t i m 0 t i t n i 1 δ t sifum i 1 2 n sifum in ω sifum f f t i m 0 t i t n i 1 δ t fvcom i 1 2 n fvcom in ω fvcom if s t n sifum m s t n sifum m 1 ɛ and f t n fvcom m f t n fvcom m 1 ɛ goto 1 end do 1 s t n 1 s t n sifum m f t n 1 f t n fvcom m where m is the index for the schwarz iteration m is its maximum and ε is a prescribed convergence criterion it is indicated that this schwarz iteration computes a heterogeneous domain decomposition problem it involves different partial differential equations distinct numerical methods and unlike computational grids in addition because both sifum and fvcom are implicit schemes note that fvcom is considered as an implicit method because its vertical diffusion term in the internal mode is handled implicitly while it marches in time although the others are treated explicitly and their coupling at their interfaces is also implicit the full accuracy of solutions of the sifum fvcom system will be achieved only when the schwarz iteration is convergent however such iteration will be time consuming and its overall solution accuracy may not degenerate much if a convergence is not reached which is indicated in theoretical analysis gustafsson 1981 as well as experiments in the following section when m 1 the coupling becomes explicit the solution at the interface lags in time by one time step and its accuracy there becomes first order in time 4 numerical experiment and validation 4 1 numerical experiment 4 1 1 1d dam break flow this is a 1d riemann problem of the governing equations with the following initial values 25 d 0 1 u 0 x 0 d 0 045 u 0 x 0 here the depth is in meters the subdomain of fvcom extends from 3 to 3 m in the x direction with a blanked zone from 0 15 to 0 15 m and its mesh has 14 400 triangular elements in the horizontal plane grid spacing 0 01 m longitudinally and 21 layers in the vertical direction grid spacing 0 0025 0 005 m the subdomain of sifum covers only the zone from 0 5 to 0 5 m with height at 0 2 m and its mesh has 2560 hexahedron elements in the horizontal plane grid spacing 0 005 m longitudinally and 41 layers in the vertical direction grid spacing 0 0025 0 005 m the width of the computational domain is set as 0 4 m and a slip condition is imposed at the lateral sides for both sifum and fvcom for sifum a nonslip condition is also applied at the channel bed and the initial condition for pressure is set according to eq 3 the time step of the system is 0 005 s in addition let n sifum 1 n fvcom 1 and n split 1 and hereafter these will be the default parameters the values for n sifum n fvcom and n split are so chosen for simplicity and an optimal combination of their values could play an important role in reducing the computational time for the whole system fig 8 presents the solution for water surface elevation together with the solutions obtained with sifum alone and fvcom alone it also shows measurements obtained in a laboratory study with the same parameters and conditions it is interesting to note that as seen in fig 8 in the solution of the sifum fvcom system the surge propagating toward the right contains no step in shape which is the solution of fvcom alone and is actually a standard shock form solution predicted by shallow water equation swes e g wang et al 2013 instead the system produces a surge with peaks and troughs as it travels toward the right and as seen in fig 8 the correctness of the system s solution in this regard is confirmed by the measurement therefore simulation of this riemann problem clearly illustrates a drawback of gfd models i e fvcom misses the physics that generates the peaks and troughs and the necessity to use the hybrid system in capturing the physical phenomena in order to test the performance of the modeling system a numerical experiment is performed on the accuracy order of the solution or the convergence rate of the solution using simulations obtained with the three sets of grid spacings and time steps assuming the solution changes gradually in space and time and contains no singular point an estimate for the solution accuracy reads e g tang and sotiropoulos 2007 26 k log f 2 δ f δ 2 f δ f δ 2 2 log 2 where f is a solution and represents the grid spacing and time step with 2 corresponding to the values used in previous computation the estimate of the accuracy order of solutions for all variables is presented in table 1 the table also shows that the solution converges with grid spacing and time step and the convergence rate is about 1 for water surface elevation in fvcom and 2 for all other variables a second order convergence rate is expected for a second order scheme which both sifum and fvcom adopt although this is not always true in a nonlinear situation also table 1 shows that one schwarz iteration m 1 and three such iterations m 3 produce a similar accuracy order indicating that the number of schwarz iterations has no significant effect on the overall accuracy order of the solution at the grid spacing and time step adopted here and hereafter the accuracy order in sifum is evaluated only by its solutions for water flows 4 1 2 transient flow over a sill in a channel with a sill located at its bottom a water body is initially static and then starts to flow as a velocity is imposed at its entrance the configuration of the channel is 27 1500 x 2000 y 200 1 0 6 e 4 10 6 x 2 x 0 y 80 x 0 z 150 100 1 x 500 4 x 0 z 120 70 1 x 500 4 x 0 here z 0 is set at the surface of the static water body the initial and boundary conditions at the inlet and the exit are 28 η 0 u 0 t 0 u 0 4 1 e 0 2 t x 1500 η 0 x 2000 in this experimental simulation sifum is applied at the convergent section of the channel and fvcom is used for the entire channel except for a blanked zone covered by sifum fig 9 three sets of meshes associated with different grid spacings and time steps are used table 2 to accurately resolve the free surface the grid spacing in the vertical direction is fine near the surface in the meshes of sifum in addition in this model a slip boundary condition is applied at the bottom of channel for simplicity and eq 3 is used to set up the initial condition for pressure an instantaneous solution for the velocity field obtained with the sifum fvcom system is shown in fig 10 a and it exhibits a pattern similar to that produced by fvcom alone fig 10b because the interfaces between sifum and fvcom are artificial boundaries it is important to ensure a seamless transition of their solutions across them i e to correctly resolve flow phenomena at such boundaries and generate no artifact there fig 11 depicts the vector field of the flow as it enters the subdomain of sifum it is seen that overall the two models present a similar pattern and no artifact occurs there however there is some discrepancy between the two models solutions which could be attributed to the difference inherited in the governing equations of the two models and inaccuracy of the interface algorithms as a further check on the solution at the interfaces the temporal evolution of the momentum fluxes at three adjacent cross sections one before one near and one after the left and right interfaces of sifum is examined because the configuration of the channel changes smoothly at the two interfaces the flow variables and the flux should have similar patterns and gradually vary near the two interfaces as depicted in fig 12 this is indeed the case the computed momentum fluxes at the three cross sections at each interface are about the same in pattern and value which further verifies that the flow at the interfaces is reasonably resolved and no pronounced artifact is generated there the result of the numerical experiment on the solution convergence is presented in table 3 it is seen that the solution for all variables of the modeling system converges and the convergence rate is approximately second order at this time point of the test for convergence the flow is smooth and resembles a layer flow and it has just entered the sifum region again table 3 indicates that the number of schwarz iterations has no obvious effect on the solution s overall accuracy order hereafter to save computational time m 1 is set as the default value in simulations of the following sections 4 2 validation 4 2 1 hydraulic jump a hydraulic jump is generated in a channel flow due to contraction of its right bank fig 13 the flow is steady and consists of a faster supercritical flow before the jump and a slower subcritical flow behind it in the simulation fvcom covers the entire computational domain with 4400 elements in the horizontal plane grid spacing approximately 0 8 m and 31 layers in the vertical direction grid spacing 0 025 m sifum wraps a small region with 350 427 mesh elements grid spacing approximately 0 8 m horizontally and approximately 0 03 m vertically fig 13 at the inlet of the flow u and η are set as 8 57 m s and 1 m respectively which correspond to fr 2 74 an extrapolation is used at the outlet the free surface obtained with the modeling system is presented in fig 14 it is seen that the surface elevation predicted by sifum exhibits a ridge at the jump whereas that predicted by fvcom increases monotonically from the lower level to the higher level at the jump on the basis of the swes without viscosity an analytical solution for the flow is available choi et al 2004 the analytical solution can serve as a benchmark to validate the numerical solutions although it is expected that they cannot be exactly the same because of difference in their governing equations a comparison on the reflection angle water depth and velocity of the two solutions is shown in fig 14b and table 4 it is observed that the numerical simulation results match well the analytical solution validating the ability of the sifum fvcom system to correctly resolve the flow reflection phenomena 4 2 2 3d dam break flow initially stationary water in two reservoirs is separated by an infinitely thin dam b b fig 15 the initial water depth is 10 m at the left side and 5 m at the right side after the dam is suddenly removed a flow is generated a surge bore travels toward the right a rarefaction propagates to the left and vortices occur at the two ends of the dam fennema and chaudhry 1990 the meshes of sifum and fvcom overlap as shown in fig 15a the former has 518 736 hexahedron elements grid spacing approximately 2 m horizontally and approximately 0 3 m vertically and the latter has 4108 elements in the horizontal plane grid spacing approximately 5 m and 25 layers in the vertical direction grid spacing approximately 0 5 m the time step of the system is 0 00125 s for reference simulation of the flow is also performed with sifum and fvcom individually the simulation with sifum uses 508 820 hexahedron elements with mesh resolution similar to that of the modeling system and that with fvcom uses the mesh for the modeling system it is seen clearly in fig 15 that in the sifum region of the sifum fvcom system the modeling system produces a solution similar to that produced by sifum alone which is the intention of applying the system in this region the flow exhibits a strong vertical motion because of collapse of the water on the left onto the water on the right and it cannot be resolved appropriately by fvcom in the fvcom region of the sifum fvcom system particularly around x 150 m it is seen that the bore obtained with the sifum fvcom system is different from that produced by fvcom alone the latter exhibits noises which are believed to be an artifact such a difference reflects the effects of the sifum solution for the local flow on the fvcom solution for the background flow fig 15b and d the simulation results have also been compared quantitatively with results in the literature in fig 16 the simulations from the literature include one based on 2d swes fennema and chaudhry 1990 and another based on fully 3d reynolds averaged navier stokes equations and a vof method biscarini et al 2009 in addition a simulation performed with a modeling system that is hybrid of fvcom and a godunov type model based on swes is also included tang et al 2013 fig 16 shows that overall the solution produced by the modeling system compares reasonably well with the solutions in the literature the discrepancy of the solutions is attributed to differences in the computational models and parameters such as mesh resolution 4 2 3 long wave impinging on a vertical cylinder a simulation is performed for a long wave propagating toward the seashore and then impinging on a vertical cylinder on a beach a laboratory experiment has been performed for the flow in a closed circuit current flume bremm et al 2015 and its configuration and parameters are used in the simulation fig 17 the flume s width w is 1 m and the average water depth d2 at its entrance is kept as 0 32 m the structure is placed onshore at a horizontal distance of 0 2 m from the still water line and it is square in cross section with side length of 0 1 m transient elevation of the wave at the left end with a period t of 90 s is used to drive the flow fig 17 fvcom covers the whole computational domain with 6024 elements in the horizontal plane grid spacing approximately 0 2 m and 21 layers in the vertical direction grid spacing mostly 0 05 m and sifum occupies a region around the structure with 19 500 elements grid spacing 0 01 0 1 m horizontally and 0 01 m vertically the time step of the sifum fvcom system is 0 02 s after its onset at the left end of the flume the long wave travels toward the beach and then it generates a current on the beach fig 18 depicts the snapshots of a 3d view of the current before when and after it reaches the cylinder the simulated hydrodynamic force on the cylinder f together with the measurement in the laboratory study is plotted in fig 19 it is seen that the simulation produces a force that compares satisfactorily with that from the measurement it not only captures the positive load which is exerted by the uprush and toward the right but also predicts the negative load which is generated by the backrush and toward the left the simulation of this flow serves as a validation of the sifum fvcom system s capacity to integrally predict propagation of waves generated in deep oceans the resulting flood on beaches and its hydrodynamic loading on coastal structures 5 application the sifum fvcom system developed in this paper is an unprecedented platform to directly perform high fidelity simulation of many emerging multiscale multiphysics coastal ocean flow problems one of such problems is the vulnerability of coastal structures to hydrodynamic impact of storm surges and tsunamis such vulnerability has been manifested during a number of events in recent years such as the 2011 tōhoku tsunami that was triggered by a magnitude 9 0 earthquake and subsequently caused tremendous devastation to inshore infrastructure such as coastal highway bridges in this section as examples to show the capacity of the new modeling system integral simulations are reported for the propagation of tsunamis from deep oceans all the way to beaches and then their hydrodynamic loading onto structures which are difficult to handle with existing models 5 1 tsunami wave and its impinging on a bridge deck in this application a wave from deep water propagates to the seashore and then it impinges on a bridge deck the flow is treated as 2d and the ocean bottom is simplified as an inclined plane fig 20 a as shown in fig 20a the entrance on the left is 14 000 m from the coastline and it has a still water depth of 204 m the width of the beach is set as 100 m a coastal bridge deck is used which is commonly used in the literature qu et al 2016 hayatdavoodi et al 2014 fig 20b the clearance height of the deck s center is set as 4 m above the beach and it is 605 3 m from the still water coastline in the computation as shown in fig 20a fvcom covers the whole computational domain with 16 704 elements in the horizontal plane with a grid spacing ranging from 10 to 20 m and 11 layers in vertical direction with a grid spacing of mostly 1 20 m sifum occupies only the region around the bridge deck with 102 180 unstructured hexahedron elements with a grid spacing of 0 05 2 m finest near the deck horizontally and 0 15 1 m vertically the time step of the system is 0 025 s the observed tsunami elevation with a maximum wave peak of 6 7 m at the iwate south station japan during the 2011 tōhoku tsunami is adopted to drive the flow as the boundary condition at the entrance fig 20c the simulated instantaneous surge and its impinging on the deck at four instances are shown in fig 21 in fig 21a the wave propagates in deep water then a flood run up with a steep front of about 5 m in depth is generated by the wave and it runs onto the land and approaches the deck fig 21b as it passes the deck the flood first runs mainly underneath it fig 21c soon as the elevation of the flood increases the water overtops the deck fig 21d the flow phenomena shown in fig 21 such as trapping of air between the deck and girders and overtopping of water on the deck fig 21d have been observed in early laboratory experiments and computer simulations qu et al 2016 hayatdavoodi et al 2014 the temporal history of the hydrodynamic load on the deck is plotted in fig 22 it is seen that in the time frame in fig 22 the horizontal load reaches its peak value as the flood passes the deck and then it decreases and vanishes gradually however at the same time the vertical load is more complicated it first increases to its peak and then dips to a minimum followed by a few fluctuations and then an increase to a plateau the dip in its value is caused mainly by the weight of the overtopping water these patterns in the simulated load profiles are consistent with those widely reported in experimental and computational investigations e g qu et al 2016 hayatdavoodi et al 2014 as shown in fig 22 the upward vertical load could be huge much larger than the horizontal load and this has been shown to be a crucial mechanism for damage of coastal bridges such as those destroyed during hurricane katrina douglass et al 2006 5 2 coastal flooding and its impact on a beachfront house the sifum fvcom modeling system is applied to simulate coastal flooding generated by an artificial tsunami and its impact on a beachfront house with realistic coastal settings in the simulation the new york bight is selected as the coastal region and its bathymetry data from the national oceanic and atmospheric administration noaa national centers for environmental information ncei are used noaa national centers for environmental information 2018 fig 23 a noaa s vdatum is used to convert the bathymetry data to the common vertical datum navd88 parker et al 2003 a typical coastal house is set at breezy point of rockaway beach new york on which many houses and infrastructure were destroyed during hurricane sandy in 2012 the configuration and parameters of the beachfront house are shown in fig 23a the information on the tsunami comes from a recent work on tsunami and its inundation mapping in this region performed for the us east coast under the auspice of the national tsunami hazard mitigation program shelby et al 2016 this tsunami was generated by the historical 165 km3 currituck underwater landslide at the east coast in this article the tsunami s surface elevation is combined with the regular tidal elevation observed from 0 00 on november 1 2015 to 23 00 on november 5 2015 utm zone 18 and then used as the boundary condition for the surface elevation at the open boundary in the combination the peak of the simulated tsunami elevation is shifted to coincide with that of the tide s peak so the combination represents a most serious situation fig 23b in addition an observed elevation is imposed as a boundary condition at the outlet of the computational domain along the hudson river noaa national data buoy center 2017 as seen in fig 23b a window time of about 16 h is used to ensure that the computed tidal flow has reached an equilibrium state before the tsunami surge enters the computational domain as shown in fig 23c fvcom covers the whole computational domain and its mesh has 108 921 elements with a grid spacing of 10 80 m in the horizontal plane and 11 layers with a grid spacing of mostly 1 3 m in the vertical direction sifum encloses a zone around the house and it uses 614 305 triangular elements with a grid spacing of 0 1 10 m in the horizontal direction 0 1 m at supporting pillars and 0 5 m at the house and 0 5 2 m in the vertical direction fig 23d the time step of the system is 0 05 s fig 24 a and b present the simulated large scale flooding in the estuary and small scale surge impinging on the house at two instances which are counted from 0 00 on november 1 2015 at these moments as indicated by the velocity legend the water velocity on the beach is more than 5 m s as the surge reaches the house water depth rises to about 3 5 m in front of the house and then passes from its lateral sides because of this passing and water going underneath the house the chance of water overtopping the house becomes smaller similar flow patterns were observed in an experiment on an elevated house thusyanthan and gopal 2008 fig 24c shows a detailed view of the flow field around the house including vortex shedding behind the supporting pillars the temporal evolution of the hydrodynamic load on the house is plotted in fig 24d in fig 24d similarly to the situation in section 5 2 the vertical force suddenly rises as the run up arrives at the house and then it dips such behaviors have been also reported in an experimental study of a flood passing a suspended cubic box bradner et al 2011 all of these results illustrate that the proposed sifum fvcom modeling system can not only capture large scale flow phenomena within realistic coastal settings but also is able to simultaneously resolve local small scale hydrodynamic phenomena and relevant parameters such as the vertical force exerted on the bottom of the house which is beyond the capability of exiting gfd models 6 concluding remarks the sifum fvcom system presented in this article results from a series of efforts by the authors toward high fidelity simulation of coastal ocean flows particularly local phenomena tang and wu 2010 tang and keen 2011 qu 2017 qu et al 2016 wu and tang 2010 tang et al 2014b tang et al 2016 the method and numerical algorithms of the system are discussed in detail and it has been tested and validated systematically against data from analytical solutions numerical computations and laboratory measurements in comparison with the system in tang et al 2014b the current system exceeds it in capabilities to deal with complicated free surface local flows and their complex geometries in this paper the system s unique capabilities are illustrated in simulations of example coastal flooding problems which are difficult to handle with existing models the sifum fvcom system provides a new platform to simulate realistic multiphysics flows at distinct scales especially those at small scales and with free surfaces and it has advanced our capability of high fidelity simulation of such flows with this system we can simulate many complicated local problems such as those in section 5 and have arrived at a point closer to direct simulation of many difficult problems such as the example problems in the first paragraph of section 1 as a special feature because the system simultaneously simulates far field and near field flows and permits seamless coupling between them it can be used as a tool to study effects of small scale local flows on large scale background flows which are frequently unclear but of interest in the study of real world problems with the sifum fvcom system more things are within our reach with necessary modification it is expected that the method and algorithms used in construction of the sifum fvcom system can be used to build another integrated 3dfd gfd system with a different 3dfd model such as the open source field operation and manipulation openfoam and another gfd model such as the princeton ocean model pom and the regional ocean modeling system roms moreover in the present study of the sifum fvcom system sifum has been applied only to flows with free surfaces which are the main target for its development however in view of its design the system can also be used when sifum is used for local flows without free surfaces besides sifum is used in only one subdomain in this work but the system is applicable when it is adopted in multiple subdomains the development of the sifum fvcom system may seem straightforward and trivial however this is by far not the case its realization is challenging because it involves integration of different governing equations numerical methods and computational meshes in order to achieve better performance and the full potential of such a system further investigations on three fundamental issues are necessary 1 as a crucial issue methods that couple a 3dfd model and a gfd model directly affect correctness and accuracy of solutions and they could lead to onset of artifacts at model interfaces with this in mind as well recognized in the literature primarily in situations with a same set of governing equations in different subdomains conservative algorithms at grid interfaces perform better than standard interpolation e g tang 2006 hubbard and chen 1994 however realization of conservation between a 3dfd model and a gfd model encounters difficulties one of such difficulties is that the two models have different governing equations and only very limited study of their coupling conditions has been made blayo 2016 relevantly in development of conservative interface algorithms selection of variables to be conserved across model interfaces also needs to be investigated 2 since sifum is applied at local flows with fine meshes plus the fact that it adopts a vof method the time step permitted by stability is small and this makes the computation of the whole system very time consuming consequently it is important to use large time steps in sifum and this may be achieved with techniques of semi lagrangian advection e g lentine et al 2012 3 in simulation of actual problems the computation will be intensive in computational time and memory and thus study on parallel computing with good scaling and efficient domain decomposition schemes is highly desired in general a study for the sifum fvcom system deals with the coupling of two stand alone complicated highly nonlinear models and it is a challenging task to investigate above issues notwithstanding given the feasibility and promising performance of the sifum fvcom system demonstrated in this work all of these issues will be considered in future work acknowledgments this work is sponsored by the national science foundation cmmi 1334551 dms 1622459 partial support also comes from the utrc program and for kq the national natural science foundation of china 51809021 the authors thank dr c s chen for his input on fvcom and the anonymous reviewers for their valuable suggestions supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ocemod 2019 01 001 appendix supplementary materials image application 1 
