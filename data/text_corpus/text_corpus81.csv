index,text
405,a pore network modeling approach is proposed to understand mineral dissolution regimes during reactive transport as well as changes in porosity and permeability the transport problem is implemented with full consideration of the mass balance of the solute in all pore spaces including pore bodies and throats the changes in geometry of the pore network due to calcite dissolution are taken into account based on the rate of the heterogeneous chemical reaction happening at the mineral surface the networks consider two and three dimensional domains with a variety of number of pores the evolution of network geometry and flow properties are investigated under various flow conditions using representative péclet and damköhler numbers to understand the interplay of transport and reaction a behavior diagram is constructed aiming to identify different regimes and their boundaries the dissolution patterns identified in this study further the applicability of the pore network model approach as a tool for understanding of reactive transport and dissolution processes keywords pore network modeling reactive transport dissolution pattern pore scale modeling nomenclature z coordination number qij volumetric flow rate through throat ij cij conductance of throat ij pi pressure in pore i pj pressure in pore j rij cross section radius of the throat ij μ dynamic viscosity of the fluid lij length of the throat ij k absolute permeability of the network δp pressure difference through the network a cross sectional area of the network l length of the network t time c α i mass concentration of species α in pore i c α ij mass concentration of species α in throat ij vi volume of pore i d α diffusion coefficient of species α ri radius of pore i r het α reaction rate of specie α due to heterogeneous chemical reaction a r i available reactive surface area of pore i c α in mass concentration of specie α in the pore from where the flow is arriving in the throat ij a r ij available reactive surface area of throat ij ar available reactive surface area of the pore space β stoichiometric coefficient that relates the consumed species α with the consumed reactive mineral ρsolid density of the solid reactive mineral kr kinetic constant of the heterogeneous chemical reaction ca acid mass concentration of the pore or throat r het a reaction rate of acid due to heterogeneous chemical reaction m a con consumed mass of acid m solid con consumed mass of solid vcon consumed volume dvi volume change in pore i dvij volume change in throat ij dri radius change in pore i drij radius change in throat ij dv i ij volume doubly dissolved by throat ij and the connected pore i dv j ij volume doubly dissolved by throat ij and the connected pore j a i ij surface area of the semi sphere formed by pore i and throat ij re reynolds number ρf fluid density v 0 characteristic velocity represented here by the inlet velocity peda péclet damköhler number ass specific surface area of the porous medium da damköhler number σ the standard deviation of the logarithmic of the acid concentration n number of pores and throats that are evaluated log 10 c a x mean value of the logarithmic of acid concentration of all data set 1 introduction reactive transport in porous media and mineral dissolution processes are of extreme interest for many subsurface applications including co 2 storage enhanced oil recovery eor and acidizing for stimulation sohrabi et al 2012 wolterbeek and raoof 2018 menke et al 2018 gharbi et al 2013 changes in porosity and permeability of porous media as well as the observation of various dissolution patterns of the porous medium are consequences of these dynamic processes algive et al 2010 soulaine et al 2017 depending on the dominant transport mechanism and the reactivity of the mineral solid surface different dissolution patterns through a porous medium can be observed golfier et al 2002 soulaine et al 2017 consequently good understanding of the dissolution processes is imperative to assess long term reservoir integrity properties for co 2 storage and to design efficiently acidizing treatments rathnaweera et al 2016 bemer and lombard 2010 fredd and dowell 2000 with respect to co 2 injection for storage and for eor rock mechanical changes may be induced by chemical reactions especially in porous media with substantial carbonate minerals egermann et al 2010 rathnaweera et al 2016 bemer and lombard 2010 for geological co 2 storage such mineralogical alterations may be of concern for the safety and efficiency of the technique because mineral dissolution may increase the chance for leakage and also co 2 migration out of the storage formation egermann et al 2010 rathnaweera et al 2016 bemer and lombard 2010 as discussed by ott and oedai 2015 the consequences of these dynamics interactions are dependent on the transport regimes formation of preferential pathways bypasses rock matrix and leads to poor utilization of the pore space for the storage of co 2 surface dissolution alters the mechanical integrity of the rock near the well where most of the acid is consumed and uniform dissolution might lead to subsidence due to weakening of mechanical properties of the reservoir regarding acidizing for well stimulation formation of preferential pathways increases the overall conductance through the reservoir and consequently the well productivity hill and schechter 2000 ott and oedai 2015 also for a given volume of injected fluid the deeper the wormhole penetration into the reservoir the better therefore single dominant wormhole channels at intermediate injection rates are often desired and represent the most effective stimulation fredd and fogler 1999 in this context dimensionless numbers characterize reactive transport regimes steefel and mäher 2009 the use of dimensional analysis is a standard tool in fluid mechanics that aims to derive the relevant dimensionless parameters that control the physics of a specific problem békri et al 1995 the péclet number pe is defined as the ratio of the advection rate to the rate of diffusion of a chemical species and the damköhler number da is defined as the ratio of the reaction rate to the advection rate the péclet damköhler number peda is the ratio of the reaction rate and the diffusive mass transfer rate based on dimensionless numbers behavior diagrams or phase diagrams are useful to define flow boundaries for different dissolution regimes daccord et al 1993b golfier et al 2002 soulaine et al 2017 liu and mostaghimi 2017 song et al 2018 porosity permeability relationships have also been used to understand and characterize different patterns of dissolution in porous media at the pore scale békri et al 1995 algive et al 2010 liu and mostaghimi 2017 soulaine et al 2017 uniform dissolution is described as a reaction limited process where the reactive solute is spread over the whole porous medium and the dissolution is nearly uniform all over the available reactive surface békri et al 1995 golfier et al 2002 this regime is defined by békri et al 1995 for peda 1 and by soulaine et al 2017 for da 1 while for liu and mostaghimi 2017 the boundaries of this regime depend on the correlation length of the porous medium note that characteristic lengths used to compute the dimensionless numbers are not the same and consequently boundaries between the different regimes are different despite the agreement of the general features of the behavior diagrams for systems with greater reactivity in the case of békri et al 1995 for peda 1 the dissolution pattern depends upon the dominant transport process surface dissolution or compact dissolution is characterized by the domination of the diffusion mechanism over transport by advection and consequently dissolution mainly occurs in the inlet area of the porous medium liu and mostaghimi 2017 golfier et al 2002 in this regime a uniform concentration profile is observed along the cross sections perpendicular to the flow soulaine et al 2017 observed this pattern for p e 10 2 and da 1 preferential pathways or wormholing are observed when the predominant mechanism is advection for békri et al 1995 this regime is observed for peda 1 and for soulaine et al 2017 for da 1 a mixed dissolution pattern is described by liu and mostaghimi 2017 as a transition zone between face dissolution and wormholing soulaine et al 2017 and golfier et al 2002 differentiate wormholing using three different regimes conical wormholes are observed for larger injection rates but still in a diffusion dominated mechanism where solute starts to penetrate into the porous medium and the uniform patterns along the vertical cross sections are no longer observed 10 2 p e 1 and da 1 for soulaine et al 2017 and around 10 3 p e 10 2 and d a 10 3 for golfier et al 2002 one dominant wormhole can be observed for intermediate flow rates 1 pe 10 and da 1 according to soulaine et al 2017 where the reactive solute penetrates preferentially into the biggest pore spaces to form flow channels and consequently the formation of a dominant wormhole ramified wormholes occur at large injection rates for pe 10 and da 1 soulaine et al 2017 and are characterized by wormholes becoming more branched in order to investigate the dissolution processes in porous media several numerical approaches and experiments have been developed numerical schemes based on random walks and finite difference formulations were used by békri et al 1995 to explore the effects of dissolution on different porous media configurations liu and mostaghimi 2017 proposed a lattice boltzmann method to explore the effects of different correlation lengths on dissolution patterns soulaine et al 2017 proposed a micro continuum darcy brinkman stokes dbs approach which considers stokes flow in the void areas and darcy s law for transport through the matrix that was also compared with micromodel experiments simulating the dissolution of a calcite grain golfier et al 2002 used a three dimensional coupled reaction transport darcy scale model that was directly compared with dissolution experiments performed on two dimensional beds of packed grains of salt reflecting dissolution processes occurring during acid injection in limestone pore network modeling is another numerical approach that has been used to study reactive flow and dissolution processes hoefner and fogler 1988 pioneered the use of pore network modeling to study dissolution of porous media and to evaluate qualitatively the formation of wormhole channels based on the damköhler number fredd and fogler 1998 went beyond and combined effects of transport and reaction to predict wormhole structure by using two dimensional networks and also a three dimensional physically representative network based on packed bed representation of the porous medium note that in both studies mixing occurs only in the pores and only throats are allowed to grow due to dissolution more recently algive et al 2007 2010 and bekri et al 2015 used pore network models to investigate changes in petrophysical properties in the presence of reactive fluid based on permeability porosity relationships for different flow conditions and also investigated different dissolution regimes for the case of deposition in porous media the approach of their studies considers that the system is not very far from chemical equilibrium and that the asymptotic regime has been reached in this way the solute concentration undergoes an exponential evolution with time and moment theory is applied to determine the macroscopic transport coefficients of the transport equation tansey and balhoff 2016 studied dissolution of a porous medium due to a reactive single phase transport in the mass transfer limited regime also using pore network modeling simulations were conducted on random close pack arrangements of spheres where the mass balance equation was solved for pore bodies only and no phase diagram was explored pore network modeling is a technique that is widely used to represent natural porous media where complex pore geometries are represented using a simplified pore and throat type network algive et al 2010 since the pioneering work of fatt 1956 that studied two phase flow and capillary pressure curves pore network models have been successfully applied in numerous research areas including reactive transport and dissolution problems li et al 2006 algive et al 2010 raoof et al 2012 the computational efficiency of pore network models are related to the simplicity of their geometry and because of this feature pore network modeling is considered applicable to much larger domains when compared to direct simulation methods mehmani and balhoff 2015 yang et al 2016 the main objective of this study is to understand the occurrence of different dissolution regimes in a porous medium subject to various reactive flow conditions during single phase flow relevant to geological sequestration of co 2 using the pore network modeling approach modeling of the pore scale phenomena involved in reactive flow through porous media is an important step towards understanding the changes in permeability and porosity as well as different dissolution patterns observed at larger scales the main contribution of this work is to identify different dissolution regimes in a phase diagram format based on dimensionless numbers using a complete pore network model that takes into account species mass balance inside pore and throat volumes as well as the evolution of pore space geometry and network flow field during reactive transport simulations qualitative criteria are often used to evaluate different dissolution patterns including evolution of acid concentration network geometry fluid volumetric flow rate and porosity permeability relationship here a quantitative criterion based on standard deviation analysis is introduced to classify the regime by interpreting acid distribution within pore space in the remainder of the paper we first present the governing equations of the pore network model that simulates reactive transport and dissolution as well as the computational implementation of these equations and the pore networks selected for this study finally we present the simulation results and discuss the regimes observed we close with a summary and conclusions 2 pore network models construction porous media are investigated using two and three dimensional 2d and 3d cubic pore network models the pores are characterized as spherical and are connected to each other by cylindrical throats with circular cross sections the size of the pores respect a uniform distribution and the size of the throats are related to the size of the pores connected to them throat diameters were defined as 1 4 of the diameter of the smallest pore connected to a throat and interpore distances are equal pore walls are assumed to be composed of a single mineral such as calcite a more complex network derived from a real carbonate rock sample is also presented this pore network is generated from micro computed tomography micro ct and was obtained from a data set made available by imperial college london in statoil format perm 2020 pore networks were constructed using openpnm which is an open source pore network modeling package that is designed to be customized users can write their own pore scale models or even use or edit some of the available routines gostick et al 2016 another feature of openpnm is the possibility to generate cubic and random networks in the most varied pore and throat size distributions it is also possible to import networks from different formats 3 governing equations the governing equations of the reactive transport problem with dissolution of the porous medium are presented in this section as follows pressure field determination mass balance simplified kinetic approach the geometry update standard deviation criterion for interpreting acid distribution and dimensionless numbers 3 1 steady state flow field in order to obtain the pressure field of the network we consider the steady state flow of a single phase incompressible fluid in which the mass conservation for each pore is given by 1 i j z q i j 0 where z is the coordination number and qij is the volumetric flow rate through throat ij the volumetric flow rate through a pore throat is determined by the pressure difference between the connected pores i and j p i p j and the throat conductance cij as follows 2 q i j c i j p i p j the throat conductance is obtained by use of poiseuille s law for laminar flow in a cylindrical tube 3 c i j π r i j 4 8 μ l i j where rij is the radius of throat ij cross section μ is the dynamic viscosity of the fluid and lij is the length of the throat ij substituting eqs 2 and 3 into eq 1 a linear algebraic system for the unknown pressure field is solved for the pressure in each pore to determine the steady state flow field of the network constant volumetric flow rate at the inlet boundary and fixed pressure at the outlet boundary are imposed also to determine the absolute permeability fixed pressures are imposed at the inlet and outlet boundaries both systems result in a one dimensional flow problem considering the last case the total flow rate through the network q is obtained after pressure field determination and darcy s law is used to calculate the absolute permeability k of the system as described below 4 k μ q l a δ p where a is the cross sectional area of the network and l is the length of the network 3 2 concentration field the reactive transport and dissolution problem is described by the mass balance in all available pore spaces pores and throats and is deduced from the mass conservation equations of the chemical species bird et al 2011 the transport of a chemical species occurs by advection and diffusion for a control volume represented by pores the mass balance equation for chemical species α in pore i is 5 d d t c α i v i i j i n c α i j q i j c α i i j o u t q i j i j a i j d α c α i j c α i 0 5 l i j r i r h e t α a r i where t is the time c α i is the mass concentration of species α in pore i c α ij is the mass concentration of species α in throat ij vi is the volume of pore i aij is the cross sectional area of throat ij d α is the diffusion coefficient of species α ri is the radius of pore i r het α is the reaction rate of species α due to heterogeneous chemical reaction and a r i is the available reactive surface area of pore i on the left hand side is the accumulation term that is discretized later in this section on the right hand side the first two terms take into account advective mass inflow rates represented by the mass that arrives in pore i from connected throats ij and advective mass outflow rate represented by the mass that leaves pore i through throats ij the third term describes the mass change rate due to diffusion between pore i and all connected throats ij and the last term describes the mass change of species α due to heterogeneous chemical reaction that occurs in the available reactive surface area of pore i for control volumes represented by throats the mass balance equation for species α in throat ij is 6 d d t c α i j v i j c α i n c α i j q i j a i j d α c α i c α i j 0 5 l i j r i a i j d α c α j c α i j 0 5 l i j r j r h e t α a r i j where c α in is the mass concentration of species α in the pore from where the flow is arriving in the throat ij and a r ij is the reactive surface area of throat ij on the right hand side of eq 6 the first term takes into account the mass change due to advection between the inlet and the outlet zones of throat ij that are described by the mass of species α that arrives in throat ij from the connected pore i or j depending on the flow direction the inflow concentration is represented by c α in and the mass of α that leaves throat ij in the direction of the other connected pore is c α ij the second and third terms represent the mass change rate by diffusion phenomena between the throat ij and the connected pores i and j respectively the last term presents the mass change of species α due to heterogeneous chemical reaction that occurs in the available reactive surface area of throat ij the euler implicit method is used to discretize the time derivatives in eqs 5 and 6 and to set up the linear system for the unknown concentration of α species in all pores and throats of the network at each time step the linear system is solved by using a direct method from the scipy library jones et al 2001 the domain initial condition and the inlet boundary condition are represented by a fixed value of species concentration as presented below respectively 7 c α i t 0 a n d c α i j t 0 c α 0 c o n s t a n t 8 c α i n l e t t c α i c o n s t a n t where c α intlet is the acid mass concentration in the inlet pore spaces the boundary condition at outlet pores are represented by a sink term where the mass of acid that arrives at outlet pores by advection phenomenon from all connected throats will leave these pores with the same total volumetric flow rate that arrives in each of these pores q i sink as follows 9 c α i o u t l e t q i s i n k t i j i n c α i j q i j where c α i outlet is the acid mass concentration in the outlet pore i finally discretization of the accumulation term of mass balance equations is expressed by the product rule in our approach the concentration field is solved implicitly and the volume explicitly in other words the system is solved for the new concentrations based on the previous geometry and then geometry is updated as indicated by 10 d dt c α v v d c α dt c α dv dt v n c α n 1 c α n δ t c α n 1 v n v n 1 δ t where v represents the volume of both pores and throats and the superscripts n n 1 and n 1 represent respectively the present the next and the previous instants 3 3 dissolution reactions during the dissolution process porous medium geometry evolves with heterogeneous chemical reactions at the available reactive surfaces of pores and throats for simplicity reactive surfaces are represented by the presence of only one mineral that is dissolved by the presence of an acid species this approach represents in a simplified way the acidization processes where hydrochloric acid hcl is injected in carbonate rocks represented by calcite caco 3 as follows 11 c a c o 3 s 2 h c l a q c a c l 2 a q c o 2 a q h 2 o l because the acid is the only component in the aqueous phase that reacts with the solid mineral it is the only chemical species concentration that needs to be tracked the other species are determined by stoichiometry note that the rate limiting reaction is the acid attack on calcite and it is assumed that carbonate equilibria is totally shifted toward co 2 aq due to the high acid concentration in the system thus a single reaction rate is sufficient to represent our problem this approach follows from the work of soulaine et al 2017 3 4 geometry definitions and update as our solution involves geometry changes at each time step during the simulations control volumes of pores and throats are changed in this way after each time step with the solution of the concentration field based on mass balance the change in volume of the pore spaces is obtained by the relation between the solid consumed on the available reactive surface of each pore space and the density of the reactive mineral that composes the porous medium considering a first order reaction rate for the heterogeneous chemical reaction and a stoichiometric coefficient that relates the consumption of the hydrochloric acid α a and the consumption of the reactive mineral the change in volume of the solid as a function of time is given by 12 d v d t r h e t a a r β ρ s o l i d k r c a a r β ρ s o l i d where ar is the available reactive surface area of the pore or throat ca is the acid mass concentration of the pore or throat β is the stoichiometric coefficient that relates the acid consumption to the consumed reactive mineral ρsolid is the density of the solid reactive mineral and kr is the kinetic constant of the heterogeneous chemical reaction from eq 12 it is possible to identify three important quantities consumed mass of acid m a con consumed mass of solid msolid and consumed volume of solid vcon as presented below respectively 13 m a c o n k r c a a r δ t 14 m s o l i d c o n β m a c o n 15 v c o n m s o l i d c o n ρ s o l i d based on the consumed volume eq 15 it is possible to determine the change in volume of pores dvi and throats dvij and relate these volume changes to the increase of pore radii dri and to the estimation of the increase of throat radii drij as presented below 16 d v i 4 π r i 2 d r i 17 d v i j 2 π r i j l i j d r i j at the junction of the throat with each pore this procedure double counts the dissolution of the volumes presented below 18 d v i i j 2 π r i j d r i d r i j 19 d v j i j 2 π r i j d r j d r i j where dv i ij and dv j ij are the volumes doubly dissolved by throat ij and the connected pores i and j respectively considering this information and the premise that double dissolution is maintained the new pores and throats volumes are determined respectively by 20 v i n 1 v i n d v i i j d v i i j 21 v i j n 1 v i j n d v i j d v i i j d v j i j the pore volume is defined considering the volume of a sphere and consequently the updated radius of the pore is calculated as 22 v i n 1 4 3 π r i n 1 3 the change in pore radius more precisely the increase in pore radius as a consequence of the dissolution process affects the length of the throats of the network because the pore volume invades part of the volume that previously belonged to the connected throats the change in throat length caused by the changes in connected pores radii is given by 23 l i j n 1 d i j r i n 1 r j n 1 where dij is the distance between the centers of two connected pores i and j the volume of the throats are obtained considering the control volume as a cylinder given the updated throat length it is possible to determine the throat radius using eq 24 24 v i j n 1 π r i j n 1 2 l i j n 1 new throat available reactive area and cross sectional area are obtained respectively by 25 a r i j n 1 2 π r i j n 1 l i j n 1 26 a i j n 1 π r i j n 1 2 finally considering the inlet and outlet areas of each pore defined by the sum of the spherical cap surfaces formed between the pore i and all connected throats ij eq 27 it is possible to determine the available reactive surface area of each pore as presented below 27 a i i j n 1 2 π r i n 1 r i n 1 r i n 1 2 r i j n 1 2 28 a r i n 1 4 π r i n 1 2 i j a i i j where a i ij is the surface area of the semi sphere formed by pore i and throat ij the above procedure is repeated for each time step and because of this it is possible to evaluate the evolution of the permeability and also the pore space during the simulation of the reactive transport coupled with dissolution process 3 5 dimensionless numbers the use of dimensionless numbers in reactive transport aims to generalize predictions and results across a range of transport and reaction rate conditions problems involving reactive transport usually take into account reynolds re péclet pe damköhler da and péclet damköhler peda numbers to characterize different dissolution patterns the definitions used in this work are based on soulaine et al 2017 and calculated at the initial time reynolds number re expresses the ratio of inertial effects to viscous forces and it determines the character of the flow laminar turbulent and transient flows and is given by 29 r e ρ f v 0 k μ f where ρf is the fluid density v 0 is a characteristic velocity represented here by the inlet velocity k is the square root of the permeability of the porous medium and represents a characteristic length and μf is the fluid dynamic viscosity the péclet number pe is defined as the ratio of the advection rate to the rate of diffusion of a chemical species as 30 p e v 0 k d α where d α is the diffusion coefficient of species α the péclet damköhler peda is defined as the ratio of the reaction rate and the diffusive mass transfer rate as 31 peda k r a ss d α where kr is the constant of reaction and ass is the specific surface area of the porous medium defined as the total available reactive surface area of the network divided by the total volume of pore spaces finally the damköhler number da that represents the ratio of the reaction rate to the rate of advection is defined as the ratio of the peda and pe numbers as 32 d a k r v 0 k a s s 3 6 statistics and regimes classification statistical approaches are useful for extracting information from a given data set and to better understand observed patterns in this way the standard deviation of the logarithm of the acid concentration σ is used in this study as a quantitative criterion to define dissolution regimes this parameter is a measure of the spread of a set of values hence the smaller the deviation the more homogeneous is the data set based on numerous observations of simulation results in cubic networks and for the initial condition used in these tests c a 0 10 k g m 3 the limit σ value to categorize a normalized data set as homogeneous was observed to be 1 therefore two different measures are considered the standard deviation of the acid concentration over all pores and throats of the network σnet and the average of the standard deviations of each vertical cross section of the network σ c r o s s first σnet is evaluated if σnet 1 the acid concentration is considered uniform through the network and the regime is classified as uniform otherwise the σ c r o s s is evaluated and if σ c r o s s 1 the acid concentration is considered to be uniform in each vertical cross section of the network and the regime is classified as surface dissolution otherwise the regime is classified as preferential pathways the standard deviation criterion is obtained as 33 σ 1 n x 1 n log 10 c a x log 10 c a x 2 where n is the number of pores and throats that are evaluated and log 10 c a x is the mean value of the logarithm of acid concentration in the data set for the construction of the phase diagrams the standard deviation analysis is evaluated for 100 random networks with the same size distribution and considering the same flow and reactive parameters in this way it is possible for each dissolution regime to present the number of networks that respected the criterion proposed to identify the main patterns 4 implementation the base algorithm from openpnm used for the implementation of the reactive transport and dissolution process was the transient reactive transport algorithm designed to account for advection diffusion and reaction phenomena considering just pores as control volumes and without considering geometry changes during simulations in this way the main improvements implemented by this work are related to considering pores and throats as control volumes and also considering geometry updates due to heterogeneous chemical reaction at each time step of the simulations the final and more complex algorithm follows the steps described below 1 network construction and geometry data definition 2 fluid and solid properties definition 3 definition of flow and kinetic parameters 4 solution of the steady state flow field 5 definition of initial and boundary conditions as well as simulation time and time steps for the concentration field solution 6 set up the sparse linear system of equations constructed based on the pores and throats mass balances using the euler implicit method 7 solution of the sparse linear system 8 after each time step with the new acid mass concentration c a n 1 multiplied by the volume vn for each pore and throat the total mass of acid ma inside each pore and throat is determined 9 determination of consumed mass of acid using eq 13 10 determination of consumed mass of solid using eq 14 11 determination of consumed volume of solid using eq 15 12 update the pore space volume v n 1 adding the consumed volume vcon to the previous volume vn 13 geometry update a determination of the new pore and throat volumes using respectively eqs 20 and 21 b determination of the new pore radii using eq 22 c determination of the new throat lengths using eq 23 d determination of the new throat radii using eq 24 e determination of the new available reactive area and cross sectional area of throats by using respectively eqs 25 and 26 f determination of the new available reactive area for pores using eq 28 14 update the hydraulic conductance eq 3 considering the updated geometry 15 update the fluid flow field eq 1 considering the updated geometry 16 update the new acid mass concentration c a n 1 for each pore space considering the total mass of this chemical species inside each pore and throat ma divided by the respective updated volume v n 1 17 return to step 6 and repeat until the algorithm reaches the final time step 5 results and discussion simulations of reactive transport are performed in different cubic networks to investigate dissolution regimes the geometry of the simulation domains are based on the work of song et al 2014 who conducted dissolution experiments in a real rock micro model directly etched in to a block of calcite and of soulaine et al 2017 that conducted simulations of the dissolution process in a two dimensional domain using a micro continuum dbs approach in this way the networks used in this work consider a uniform distribution of the pore sizes ranging from 300 μm to 900 μm a concentration of 10 kg m 3 of acid is injected from the left hand side of the network one dimensional flow in the positive x direction at a constant volumetric flow rate corresponding to a re 0 1 fluid and solid properties are set to μ f 10 3 p a s ρ f 1000 k g m 3 and ρ s o l i d 2165 k g m 3 the stoichiometric coefficient that relates the consumed acid species with the consumed solid reactive mineral is set to β 1 all these properties are based on the work of soulaine et al 2017 simulations considered a range in pe from 10 3 to 102 whereas the da varied from 10 3 to 1 in order to obtain these wide ranges of dimensionless numbers we considered diffusivity coefficients from 10 9 to as large as 10 4 m 2 s 1 and reaction rate constants from 10 6 to 10 3 m s 1 alternately v 0 could have been varied to obtain the desired range of pe and da the final simulation time was set to 500 seconds and the time step size was fixed at 1 second it is important to notice that simulations at the surface regime present a smaller simulation time due to the limitation of the merging of pores and throats not yet implemented in this work also damköhler values are limited to avoid reactivity scenarios where the merging of pore spaces could happen likewise greater reactivity might lead to the formation of a co 2 phase due to the large amount of reaction product produced both of these are topics to be developed in future work importantly the reactivities tested were sufficient to present behaviors of transport limited processes the results are discussed based on the pore volumes of injectant pvi additionally the last section presents extra simulations considering the carbonate network including a comparison between our results and those available in the literature 5 1 identification of dissolution regimes a network composed of 10 10 pores is used to explore the different dissolution regimes and to construct phase diagrams based on the dimensionless numbers pe da and peda fig 1 presents a scheme of the 10 10 network geometry the simulation results show that depending on the flow conditions and the mineral reactivity different geometries and acid distributions can be observed after the dissolution process these observations agree with previous literature daccord et al 1993b golfier et al 2002 soulaine et al 2017 liu and mostaghimi 2017 three main dissolution patterns and two intermediate patterns are observed from reactive transport simulations uniform dissolution surface dissolution preferential pathways transition zone and mixed zone the uniform dissolution pattern is related to significant acid penetration in the network in this regime the acid consumption rate is smaller than the transport by diffusion and advection meaning that almost the entire pore space is filled with a uniform distribution of the acid see fig 2 when a sufficiently large reactivity exists the changes in pore space geometry happen throughout the entire domain see fig 3 a otherwise no significant changes are observed throughout the network this is a consequence of the availability of acid for all pore spaces of the network that characterizes the reaction limited feature of this dissolution regime the volumetric flow rate starts to present changes for a da 0 01 that are more evident for throats with larger permeability see fig 3b the standard deviation based on acid concentration data from all pore spaces σnet was determined for 100 networks and for 100 of the samples presented a value less than one evidencing the uniform pattern of the regime the transition zone is characterized by the decrease of the acid penetration through the network and a concentration of the geometry changes in some portions of the domain regardless of the péclet number in this da range this behavior is observed the surface dissolution pattern is characterized by a homogeneous acid concentration along the cross sections perpendicular to the flow see fig 4 a in this regime the diffusion mechanism dominates over advective transport and reactivity of the acid is high meaning that significant amounts of acid are consumed on the upstream pore spaces of the network thereby impairing the propagation of the acid through the entire porous medium because of this the largest changes in geometry are observed for pores and throats located near the inlet area of the network see fig 4b the standard deviation analysis was evaluated and presented σnet 1 and σ c r o s s 1 for 100 of the samples this confirms the uniform profile of acid concentration along cross sections perpendicular to the flow the mixed zone is characterized as a transition between surface dissolution and preferential pathways in this regime the homogeneity of acid concentration along vertical cross sections starts to disappear as well as other features of surface regime the preferential pathways are observed when advection is the strongest transport mechanism and the reactivity of the acid is high preferential pathways result from the heterogeneous geometry of the porous medium and consequent heterogeneous velocity profile because of this more acid penetrates into the network through the more permeable pathways and no uniform patterns are observed see fig 5 furthermore geometry changes in this regime are also more evident along the most permeable areas as well as changes in volumetric flow rates the standard deviation analysis presented σnet 1 for 100 of the samples and σ c r o s s 1 for 96 of the samples evidencing the formation of preferential pathways through the domain fig 6 presents the evolution of the relationship between normalized permeability and porosity for the three main dissolution regimes observed for the uniform dissolution a linear pattern is observed independent of the mineral reactivity considered this means that besides the increase in porosity absolute permeability of the porous medium also increases as a consequence of geometry changes in the entire network a power law pattern is observed for the surface dissolution regime that can be interpreted as a restriction caused by the transport even with an increase of the porosity the overall permeability does not increase at the same rate because the majority of the affected pores are in the inlet a similar pattern is observed for preferential pathways however with a smaller increase of the porosity when compared to the surface dissolution the difference in the increase of permeability for preferential pathways and surface dissolution regimes is explained by the extent of acid contact with solid throughout the entire network volume after 209 4 pvi of injection the pore spaces that have undergone dissolution by the presence of acid in the preferential pathways regime are less in volume than those affected in the surface dissolution regime 188 4 pvi and also the uniform dissolution regime 209 4 pvi that is the fraction of the pore volume of the network that is affected by dissolution in the preferential pathways regime is less than the other two regimes and pathways do not span the sample fig 5 for example is an image of the final acid concentration distribution in the preferential pathway regime note that the pathways do not span from the injection side to the production side 5 2 behavior diagram construction in order to summarize the different dissolution regimes observed in the reactive transport simulations conducted on the network composed by 10 10 pores behavior diagrams are constructed based on the pe da and peda dimensionless numbers as presented in figs 7 a and 7b the main features of the diagrams agree well with literature results especially when compared with the study of soulaine et al 2017 that presents a regime diagram based on pe and da and the work of golfier et al 2002 that present the regime diagrams based on pe da and peda considering that the transition boundaries are based mostly on qualitative observation some uncertainties are associated with these lines and discrepancies between the studies can be noticed the pore network modeling used in this study is not capable yet to explore different preferential pathways regimes as by previous studies did golfier et al 2002 soulaine et al 2017 however the main dissolution regimes are explored by using a different analysis tool as presented in this section furthermore because this model does not consider merging of pores and throats this limitation also may bring some difference in the analysis of the boundaries and regimes it is also important to remember that dimensionless numbers are computed differently in each of the literature studies and this may explain these discrepancies after all it is important to highlight the applicability of pore network modeling as a tool to investigate dissolution regimes concerning length scale effects a network composed of 10 40 pores is used to investigate possible differences in the construction of behavior diagrams of different network sizes from fig 8 it is possible to note that besides all the agreements compared to the results from 10 10 network a small discrepancy related to the mixed zone is observed the transition pattern between surface dissolution and preferential pathways is reduced for the 10 40 network and is related to the increase of network heterogeneity and consequently a faster transition between regimes with large mineral reactivity therefore regardless of the difference in the mixed zone one can conclude that the behavior diagrams are in good agreement considering networks with different sizes 5 3 verification in a 40 40 network considering here a network with 40 40 pores the main dissolution regimes are verified fig 9 presents the acid concentration profile for uniform surface dissolution and preferential pathways regimes respectively after 50 6 pvi 40 5 pvi and 50 6 pvi figs 9a c the behaviors observed agree with the discussed features of each of the regimes uniform dissolution presents a uniform concentration of acid through the entire domain surface dissolution is characterized by a homogeneous concentration profile along the cross sections perpendicular to the flow and preferential pathways area highlighted by acid distribution through most permeable areas additionally fig 10 presents the porosity permeability relationship of these regimes the linear pattern of the uniform distribution is apparent as well as the power law pattern of surface dissolution and preferential pathways it is important to observe here that surface dissolution again presents greater increase of porosity than preferential pathways due to the large dissolution rate for inlet pore spaces even with the lack of pore merging the importance of surface dissolution is also evidence of the role of diffusion the standard deviations of these simulations were obtained and also agree with the regime specifications 5 4 3d domain verification a three dimensional domain is constructed to evaluate the generality of the features of the dissolution regimes obtained using 2d pore networks fig 11 presents the initial geometry for a network composed by 10 10 10 pores the acid concentration for uniform dissolution surface dissolution and preferential pathways after 250 2 pvi 150 1 pvi and 250 2 pvi respectively are presented in fig 12 the features of each regime agree with discussions made considering 2d networks the uniform dissolution see fig 12a presents a uniform distribution of the acid throughout the entire domain and shows a σ n e t 0 01 for the conditions assumed p e 0 095 d a 0 0006 and p e d a 6 06 10 5 the surface dissolution see fig 12b presents a homogeneous distribution of the acid concentration along cross sections perpendicular to the flow the standard deviations of this regime and the dimensionless numbers result respectively in σ n e t 1 56 and σ c r o s s 0 39 and p e 0 00095 d a 0 57 and p e d a 5 456 10 4 that agree with the previous assumptions the preferential pathways see fig 12c are well observed in the middle region of the network considering p e 95 d a 0 57 and p e d a 5 456 10 1 the standard deviation of this condition is σ n e t 3 52 and σ c r o s s 2 31 the porosity permeability relationships for the three main dissolution regimes are presented in fig 13 the uniform dissolution regime presents a linear pattern as observed for 2d simulations the surface dissolution result also replicates the results obtained for 2d domains that present a more rapid increase of the porosity in comparison to the permeability as a result of the geometry changes in the inlet area of the networks on the other hand the preferential pathways presents a slightly different pattern where a power law behavior is observed initially at normalized porosity range of 1 1 2 followed by a pronounced increase of the permeability that characterizes the formation of preferential pathways this difference is related to the greater degree of freedom for 3d simulations that allows more propagation options for the fluid throughout the porous medium and increases the evidence of highly conductive channels formation these different behaviors in 2d and 3d networks are expected because the preferential pathways regime tends to create fractal structures daccord et al 1987 1993a that depend on the dimensionality of the enclosing domain 5 5 implementation on real pore networks the single phase reactive transport approach developed in this work was also implemented using a pore network obtained from a carbonate rock this pore network model is used to ensure the applicability of this methodology for more complex pore topologies here the inlet acid concentration is set to 1 kg m 3 and a reaction limited scenario is presented considering d a 0 001 greater reactivities cannot be considered without including the merging of pores and throats fig 14 presents the final concentration profile of a uniform dissolution pattern simulation that is in good agreement with the behaviors observed in cubic networks and presenting σ n e t 0 003 the results of porosity and permeability evolution from these simulations are compared with regular cubic network results and literature data the power law exponent of the curves obtained by plotting log k k 0 versus log ϕ ϕ 0 are compared with values obtained by egermann et al 2010 and bekri et al 2015 both worked with 3d regular pore networks constructed based on petrophysical laboratory data egermann et al 2010 also conducted core flood experiments the latter related the power law exponent with the dissolution pattern where reaction limited regimes were identified between values of 1 5 and 6 9 identified in table 1 by the subscripts min and max respectively greater values were related to a convective predominant regime described by changes only in throats geometry value identified by the subscript throats table 1 presents the power law exponents and their references it is noticed that simulations in the 2d and 3d pore networks previously discussed in this work and from bekri et al 2015 obtained values in the range that represents uniform dissolution for the carbonate simulation the exponent is larger and is explained by the fact that the available surface areas obtained for this sample see eq 28 are much smaller due to the significant heterogeneity of the pore and throat sizes consequently for this case changes were observed mainly in the permeability due to dissolution of throats as for future work the implementation of merging of pores and throats would improve and facilitate the use of the approach presented in this study to evaluate dissolution regimes in more complex pore networks derived from real porous media this will likely change the response of permeability and porosity for extreme cases respectively represented by preferential pathways and surface dissolution regimes and also bring the reactive transport model to the physical problem 6 conclusion this work presents a pore network modeling approach to evaluate the effects of different transport mechanisms and mineral reactivity on dissolution regimes as well as changes in porosity and permeability the transport problem is implemented by considering the acid mass balance inside pores and throats the changes in pore space geometry due to dissolution are considered based on the rate of the heterogeneous chemical reaction happening at the solid surface péclet and damköhler dimensionless numbers are used to construct behavior diagrams in order to characterize the different dissolution regimes the reactive transport simulations developed in this work exhibit results similar to those previously discussed in the literature based on direct simulations and experimental trials in this work five dissolution regimes were explored based on acid concentration network geometry volumetric flow rate porosity permeability relationship and standard deviation analysis that was successfully introduced as a quantitative criterion for the cases studied these regimes include uniform dissolution da 0 05 transition zone 0 05 da 0 1 surface dissolution da 0 1 and pe 0 001 mixed zone and preferential pathways in general for da 0 1 and pe 0 001 the results demonstrate the applicability of pore network modeling as a tool to explore reactive transport and dissolution processes as well as to predict changes in porosity and permeability results demonstrated the various dissolution regimes observed at larger scales the use of a pore network approach to understand reactive transport during single phase flow also offers new possibilities of investigation merging of pores and throats to form vug like pores is suggested as an improvement to better evaluate regimes with significant mineral reactivity incorporation of cornered pores with triangular geometry that are the most common pore shape allows the exploration of more complex systems based on multiphase reactive transport in this way multiphase systems are also suggested to be implemented to represent various subsurface and reservoir conditions credit authorship contribution statement barbara f esteves conceptualization methodology software writing original draft paulo l c lage writing review editing supervision paulo couto writing review editing supervision anthony r kovscek conceptualization supervision funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment bfe and ark acknowledge gratefully the support of the stanford center for carbon storage supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j advwatres 2020 103741 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
405,a pore network modeling approach is proposed to understand mineral dissolution regimes during reactive transport as well as changes in porosity and permeability the transport problem is implemented with full consideration of the mass balance of the solute in all pore spaces including pore bodies and throats the changes in geometry of the pore network due to calcite dissolution are taken into account based on the rate of the heterogeneous chemical reaction happening at the mineral surface the networks consider two and three dimensional domains with a variety of number of pores the evolution of network geometry and flow properties are investigated under various flow conditions using representative péclet and damköhler numbers to understand the interplay of transport and reaction a behavior diagram is constructed aiming to identify different regimes and their boundaries the dissolution patterns identified in this study further the applicability of the pore network model approach as a tool for understanding of reactive transport and dissolution processes keywords pore network modeling reactive transport dissolution pattern pore scale modeling nomenclature z coordination number qij volumetric flow rate through throat ij cij conductance of throat ij pi pressure in pore i pj pressure in pore j rij cross section radius of the throat ij μ dynamic viscosity of the fluid lij length of the throat ij k absolute permeability of the network δp pressure difference through the network a cross sectional area of the network l length of the network t time c α i mass concentration of species α in pore i c α ij mass concentration of species α in throat ij vi volume of pore i d α diffusion coefficient of species α ri radius of pore i r het α reaction rate of specie α due to heterogeneous chemical reaction a r i available reactive surface area of pore i c α in mass concentration of specie α in the pore from where the flow is arriving in the throat ij a r ij available reactive surface area of throat ij ar available reactive surface area of the pore space β stoichiometric coefficient that relates the consumed species α with the consumed reactive mineral ρsolid density of the solid reactive mineral kr kinetic constant of the heterogeneous chemical reaction ca acid mass concentration of the pore or throat r het a reaction rate of acid due to heterogeneous chemical reaction m a con consumed mass of acid m solid con consumed mass of solid vcon consumed volume dvi volume change in pore i dvij volume change in throat ij dri radius change in pore i drij radius change in throat ij dv i ij volume doubly dissolved by throat ij and the connected pore i dv j ij volume doubly dissolved by throat ij and the connected pore j a i ij surface area of the semi sphere formed by pore i and throat ij re reynolds number ρf fluid density v 0 characteristic velocity represented here by the inlet velocity peda péclet damköhler number ass specific surface area of the porous medium da damköhler number σ the standard deviation of the logarithmic of the acid concentration n number of pores and throats that are evaluated log 10 c a x mean value of the logarithmic of acid concentration of all data set 1 introduction reactive transport in porous media and mineral dissolution processes are of extreme interest for many subsurface applications including co 2 storage enhanced oil recovery eor and acidizing for stimulation sohrabi et al 2012 wolterbeek and raoof 2018 menke et al 2018 gharbi et al 2013 changes in porosity and permeability of porous media as well as the observation of various dissolution patterns of the porous medium are consequences of these dynamic processes algive et al 2010 soulaine et al 2017 depending on the dominant transport mechanism and the reactivity of the mineral solid surface different dissolution patterns through a porous medium can be observed golfier et al 2002 soulaine et al 2017 consequently good understanding of the dissolution processes is imperative to assess long term reservoir integrity properties for co 2 storage and to design efficiently acidizing treatments rathnaweera et al 2016 bemer and lombard 2010 fredd and dowell 2000 with respect to co 2 injection for storage and for eor rock mechanical changes may be induced by chemical reactions especially in porous media with substantial carbonate minerals egermann et al 2010 rathnaweera et al 2016 bemer and lombard 2010 for geological co 2 storage such mineralogical alterations may be of concern for the safety and efficiency of the technique because mineral dissolution may increase the chance for leakage and also co 2 migration out of the storage formation egermann et al 2010 rathnaweera et al 2016 bemer and lombard 2010 as discussed by ott and oedai 2015 the consequences of these dynamics interactions are dependent on the transport regimes formation of preferential pathways bypasses rock matrix and leads to poor utilization of the pore space for the storage of co 2 surface dissolution alters the mechanical integrity of the rock near the well where most of the acid is consumed and uniform dissolution might lead to subsidence due to weakening of mechanical properties of the reservoir regarding acidizing for well stimulation formation of preferential pathways increases the overall conductance through the reservoir and consequently the well productivity hill and schechter 2000 ott and oedai 2015 also for a given volume of injected fluid the deeper the wormhole penetration into the reservoir the better therefore single dominant wormhole channels at intermediate injection rates are often desired and represent the most effective stimulation fredd and fogler 1999 in this context dimensionless numbers characterize reactive transport regimes steefel and mäher 2009 the use of dimensional analysis is a standard tool in fluid mechanics that aims to derive the relevant dimensionless parameters that control the physics of a specific problem békri et al 1995 the péclet number pe is defined as the ratio of the advection rate to the rate of diffusion of a chemical species and the damköhler number da is defined as the ratio of the reaction rate to the advection rate the péclet damköhler number peda is the ratio of the reaction rate and the diffusive mass transfer rate based on dimensionless numbers behavior diagrams or phase diagrams are useful to define flow boundaries for different dissolution regimes daccord et al 1993b golfier et al 2002 soulaine et al 2017 liu and mostaghimi 2017 song et al 2018 porosity permeability relationships have also been used to understand and characterize different patterns of dissolution in porous media at the pore scale békri et al 1995 algive et al 2010 liu and mostaghimi 2017 soulaine et al 2017 uniform dissolution is described as a reaction limited process where the reactive solute is spread over the whole porous medium and the dissolution is nearly uniform all over the available reactive surface békri et al 1995 golfier et al 2002 this regime is defined by békri et al 1995 for peda 1 and by soulaine et al 2017 for da 1 while for liu and mostaghimi 2017 the boundaries of this regime depend on the correlation length of the porous medium note that characteristic lengths used to compute the dimensionless numbers are not the same and consequently boundaries between the different regimes are different despite the agreement of the general features of the behavior diagrams for systems with greater reactivity in the case of békri et al 1995 for peda 1 the dissolution pattern depends upon the dominant transport process surface dissolution or compact dissolution is characterized by the domination of the diffusion mechanism over transport by advection and consequently dissolution mainly occurs in the inlet area of the porous medium liu and mostaghimi 2017 golfier et al 2002 in this regime a uniform concentration profile is observed along the cross sections perpendicular to the flow soulaine et al 2017 observed this pattern for p e 10 2 and da 1 preferential pathways or wormholing are observed when the predominant mechanism is advection for békri et al 1995 this regime is observed for peda 1 and for soulaine et al 2017 for da 1 a mixed dissolution pattern is described by liu and mostaghimi 2017 as a transition zone between face dissolution and wormholing soulaine et al 2017 and golfier et al 2002 differentiate wormholing using three different regimes conical wormholes are observed for larger injection rates but still in a diffusion dominated mechanism where solute starts to penetrate into the porous medium and the uniform patterns along the vertical cross sections are no longer observed 10 2 p e 1 and da 1 for soulaine et al 2017 and around 10 3 p e 10 2 and d a 10 3 for golfier et al 2002 one dominant wormhole can be observed for intermediate flow rates 1 pe 10 and da 1 according to soulaine et al 2017 where the reactive solute penetrates preferentially into the biggest pore spaces to form flow channels and consequently the formation of a dominant wormhole ramified wormholes occur at large injection rates for pe 10 and da 1 soulaine et al 2017 and are characterized by wormholes becoming more branched in order to investigate the dissolution processes in porous media several numerical approaches and experiments have been developed numerical schemes based on random walks and finite difference formulations were used by békri et al 1995 to explore the effects of dissolution on different porous media configurations liu and mostaghimi 2017 proposed a lattice boltzmann method to explore the effects of different correlation lengths on dissolution patterns soulaine et al 2017 proposed a micro continuum darcy brinkman stokes dbs approach which considers stokes flow in the void areas and darcy s law for transport through the matrix that was also compared with micromodel experiments simulating the dissolution of a calcite grain golfier et al 2002 used a three dimensional coupled reaction transport darcy scale model that was directly compared with dissolution experiments performed on two dimensional beds of packed grains of salt reflecting dissolution processes occurring during acid injection in limestone pore network modeling is another numerical approach that has been used to study reactive flow and dissolution processes hoefner and fogler 1988 pioneered the use of pore network modeling to study dissolution of porous media and to evaluate qualitatively the formation of wormhole channels based on the damköhler number fredd and fogler 1998 went beyond and combined effects of transport and reaction to predict wormhole structure by using two dimensional networks and also a three dimensional physically representative network based on packed bed representation of the porous medium note that in both studies mixing occurs only in the pores and only throats are allowed to grow due to dissolution more recently algive et al 2007 2010 and bekri et al 2015 used pore network models to investigate changes in petrophysical properties in the presence of reactive fluid based on permeability porosity relationships for different flow conditions and also investigated different dissolution regimes for the case of deposition in porous media the approach of their studies considers that the system is not very far from chemical equilibrium and that the asymptotic regime has been reached in this way the solute concentration undergoes an exponential evolution with time and moment theory is applied to determine the macroscopic transport coefficients of the transport equation tansey and balhoff 2016 studied dissolution of a porous medium due to a reactive single phase transport in the mass transfer limited regime also using pore network modeling simulations were conducted on random close pack arrangements of spheres where the mass balance equation was solved for pore bodies only and no phase diagram was explored pore network modeling is a technique that is widely used to represent natural porous media where complex pore geometries are represented using a simplified pore and throat type network algive et al 2010 since the pioneering work of fatt 1956 that studied two phase flow and capillary pressure curves pore network models have been successfully applied in numerous research areas including reactive transport and dissolution problems li et al 2006 algive et al 2010 raoof et al 2012 the computational efficiency of pore network models are related to the simplicity of their geometry and because of this feature pore network modeling is considered applicable to much larger domains when compared to direct simulation methods mehmani and balhoff 2015 yang et al 2016 the main objective of this study is to understand the occurrence of different dissolution regimes in a porous medium subject to various reactive flow conditions during single phase flow relevant to geological sequestration of co 2 using the pore network modeling approach modeling of the pore scale phenomena involved in reactive flow through porous media is an important step towards understanding the changes in permeability and porosity as well as different dissolution patterns observed at larger scales the main contribution of this work is to identify different dissolution regimes in a phase diagram format based on dimensionless numbers using a complete pore network model that takes into account species mass balance inside pore and throat volumes as well as the evolution of pore space geometry and network flow field during reactive transport simulations qualitative criteria are often used to evaluate different dissolution patterns including evolution of acid concentration network geometry fluid volumetric flow rate and porosity permeability relationship here a quantitative criterion based on standard deviation analysis is introduced to classify the regime by interpreting acid distribution within pore space in the remainder of the paper we first present the governing equations of the pore network model that simulates reactive transport and dissolution as well as the computational implementation of these equations and the pore networks selected for this study finally we present the simulation results and discuss the regimes observed we close with a summary and conclusions 2 pore network models construction porous media are investigated using two and three dimensional 2d and 3d cubic pore network models the pores are characterized as spherical and are connected to each other by cylindrical throats with circular cross sections the size of the pores respect a uniform distribution and the size of the throats are related to the size of the pores connected to them throat diameters were defined as 1 4 of the diameter of the smallest pore connected to a throat and interpore distances are equal pore walls are assumed to be composed of a single mineral such as calcite a more complex network derived from a real carbonate rock sample is also presented this pore network is generated from micro computed tomography micro ct and was obtained from a data set made available by imperial college london in statoil format perm 2020 pore networks were constructed using openpnm which is an open source pore network modeling package that is designed to be customized users can write their own pore scale models or even use or edit some of the available routines gostick et al 2016 another feature of openpnm is the possibility to generate cubic and random networks in the most varied pore and throat size distributions it is also possible to import networks from different formats 3 governing equations the governing equations of the reactive transport problem with dissolution of the porous medium are presented in this section as follows pressure field determination mass balance simplified kinetic approach the geometry update standard deviation criterion for interpreting acid distribution and dimensionless numbers 3 1 steady state flow field in order to obtain the pressure field of the network we consider the steady state flow of a single phase incompressible fluid in which the mass conservation for each pore is given by 1 i j z q i j 0 where z is the coordination number and qij is the volumetric flow rate through throat ij the volumetric flow rate through a pore throat is determined by the pressure difference between the connected pores i and j p i p j and the throat conductance cij as follows 2 q i j c i j p i p j the throat conductance is obtained by use of poiseuille s law for laminar flow in a cylindrical tube 3 c i j π r i j 4 8 μ l i j where rij is the radius of throat ij cross section μ is the dynamic viscosity of the fluid and lij is the length of the throat ij substituting eqs 2 and 3 into eq 1 a linear algebraic system for the unknown pressure field is solved for the pressure in each pore to determine the steady state flow field of the network constant volumetric flow rate at the inlet boundary and fixed pressure at the outlet boundary are imposed also to determine the absolute permeability fixed pressures are imposed at the inlet and outlet boundaries both systems result in a one dimensional flow problem considering the last case the total flow rate through the network q is obtained after pressure field determination and darcy s law is used to calculate the absolute permeability k of the system as described below 4 k μ q l a δ p where a is the cross sectional area of the network and l is the length of the network 3 2 concentration field the reactive transport and dissolution problem is described by the mass balance in all available pore spaces pores and throats and is deduced from the mass conservation equations of the chemical species bird et al 2011 the transport of a chemical species occurs by advection and diffusion for a control volume represented by pores the mass balance equation for chemical species α in pore i is 5 d d t c α i v i i j i n c α i j q i j c α i i j o u t q i j i j a i j d α c α i j c α i 0 5 l i j r i r h e t α a r i where t is the time c α i is the mass concentration of species α in pore i c α ij is the mass concentration of species α in throat ij vi is the volume of pore i aij is the cross sectional area of throat ij d α is the diffusion coefficient of species α ri is the radius of pore i r het α is the reaction rate of species α due to heterogeneous chemical reaction and a r i is the available reactive surface area of pore i on the left hand side is the accumulation term that is discretized later in this section on the right hand side the first two terms take into account advective mass inflow rates represented by the mass that arrives in pore i from connected throats ij and advective mass outflow rate represented by the mass that leaves pore i through throats ij the third term describes the mass change rate due to diffusion between pore i and all connected throats ij and the last term describes the mass change of species α due to heterogeneous chemical reaction that occurs in the available reactive surface area of pore i for control volumes represented by throats the mass balance equation for species α in throat ij is 6 d d t c α i j v i j c α i n c α i j q i j a i j d α c α i c α i j 0 5 l i j r i a i j d α c α j c α i j 0 5 l i j r j r h e t α a r i j where c α in is the mass concentration of species α in the pore from where the flow is arriving in the throat ij and a r ij is the reactive surface area of throat ij on the right hand side of eq 6 the first term takes into account the mass change due to advection between the inlet and the outlet zones of throat ij that are described by the mass of species α that arrives in throat ij from the connected pore i or j depending on the flow direction the inflow concentration is represented by c α in and the mass of α that leaves throat ij in the direction of the other connected pore is c α ij the second and third terms represent the mass change rate by diffusion phenomena between the throat ij and the connected pores i and j respectively the last term presents the mass change of species α due to heterogeneous chemical reaction that occurs in the available reactive surface area of throat ij the euler implicit method is used to discretize the time derivatives in eqs 5 and 6 and to set up the linear system for the unknown concentration of α species in all pores and throats of the network at each time step the linear system is solved by using a direct method from the scipy library jones et al 2001 the domain initial condition and the inlet boundary condition are represented by a fixed value of species concentration as presented below respectively 7 c α i t 0 a n d c α i j t 0 c α 0 c o n s t a n t 8 c α i n l e t t c α i c o n s t a n t where c α intlet is the acid mass concentration in the inlet pore spaces the boundary condition at outlet pores are represented by a sink term where the mass of acid that arrives at outlet pores by advection phenomenon from all connected throats will leave these pores with the same total volumetric flow rate that arrives in each of these pores q i sink as follows 9 c α i o u t l e t q i s i n k t i j i n c α i j q i j where c α i outlet is the acid mass concentration in the outlet pore i finally discretization of the accumulation term of mass balance equations is expressed by the product rule in our approach the concentration field is solved implicitly and the volume explicitly in other words the system is solved for the new concentrations based on the previous geometry and then geometry is updated as indicated by 10 d dt c α v v d c α dt c α dv dt v n c α n 1 c α n δ t c α n 1 v n v n 1 δ t where v represents the volume of both pores and throats and the superscripts n n 1 and n 1 represent respectively the present the next and the previous instants 3 3 dissolution reactions during the dissolution process porous medium geometry evolves with heterogeneous chemical reactions at the available reactive surfaces of pores and throats for simplicity reactive surfaces are represented by the presence of only one mineral that is dissolved by the presence of an acid species this approach represents in a simplified way the acidization processes where hydrochloric acid hcl is injected in carbonate rocks represented by calcite caco 3 as follows 11 c a c o 3 s 2 h c l a q c a c l 2 a q c o 2 a q h 2 o l because the acid is the only component in the aqueous phase that reacts with the solid mineral it is the only chemical species concentration that needs to be tracked the other species are determined by stoichiometry note that the rate limiting reaction is the acid attack on calcite and it is assumed that carbonate equilibria is totally shifted toward co 2 aq due to the high acid concentration in the system thus a single reaction rate is sufficient to represent our problem this approach follows from the work of soulaine et al 2017 3 4 geometry definitions and update as our solution involves geometry changes at each time step during the simulations control volumes of pores and throats are changed in this way after each time step with the solution of the concentration field based on mass balance the change in volume of the pore spaces is obtained by the relation between the solid consumed on the available reactive surface of each pore space and the density of the reactive mineral that composes the porous medium considering a first order reaction rate for the heterogeneous chemical reaction and a stoichiometric coefficient that relates the consumption of the hydrochloric acid α a and the consumption of the reactive mineral the change in volume of the solid as a function of time is given by 12 d v d t r h e t a a r β ρ s o l i d k r c a a r β ρ s o l i d where ar is the available reactive surface area of the pore or throat ca is the acid mass concentration of the pore or throat β is the stoichiometric coefficient that relates the acid consumption to the consumed reactive mineral ρsolid is the density of the solid reactive mineral and kr is the kinetic constant of the heterogeneous chemical reaction from eq 12 it is possible to identify three important quantities consumed mass of acid m a con consumed mass of solid msolid and consumed volume of solid vcon as presented below respectively 13 m a c o n k r c a a r δ t 14 m s o l i d c o n β m a c o n 15 v c o n m s o l i d c o n ρ s o l i d based on the consumed volume eq 15 it is possible to determine the change in volume of pores dvi and throats dvij and relate these volume changes to the increase of pore radii dri and to the estimation of the increase of throat radii drij as presented below 16 d v i 4 π r i 2 d r i 17 d v i j 2 π r i j l i j d r i j at the junction of the throat with each pore this procedure double counts the dissolution of the volumes presented below 18 d v i i j 2 π r i j d r i d r i j 19 d v j i j 2 π r i j d r j d r i j where dv i ij and dv j ij are the volumes doubly dissolved by throat ij and the connected pores i and j respectively considering this information and the premise that double dissolution is maintained the new pores and throats volumes are determined respectively by 20 v i n 1 v i n d v i i j d v i i j 21 v i j n 1 v i j n d v i j d v i i j d v j i j the pore volume is defined considering the volume of a sphere and consequently the updated radius of the pore is calculated as 22 v i n 1 4 3 π r i n 1 3 the change in pore radius more precisely the increase in pore radius as a consequence of the dissolution process affects the length of the throats of the network because the pore volume invades part of the volume that previously belonged to the connected throats the change in throat length caused by the changes in connected pores radii is given by 23 l i j n 1 d i j r i n 1 r j n 1 where dij is the distance between the centers of two connected pores i and j the volume of the throats are obtained considering the control volume as a cylinder given the updated throat length it is possible to determine the throat radius using eq 24 24 v i j n 1 π r i j n 1 2 l i j n 1 new throat available reactive area and cross sectional area are obtained respectively by 25 a r i j n 1 2 π r i j n 1 l i j n 1 26 a i j n 1 π r i j n 1 2 finally considering the inlet and outlet areas of each pore defined by the sum of the spherical cap surfaces formed between the pore i and all connected throats ij eq 27 it is possible to determine the available reactive surface area of each pore as presented below 27 a i i j n 1 2 π r i n 1 r i n 1 r i n 1 2 r i j n 1 2 28 a r i n 1 4 π r i n 1 2 i j a i i j where a i ij is the surface area of the semi sphere formed by pore i and throat ij the above procedure is repeated for each time step and because of this it is possible to evaluate the evolution of the permeability and also the pore space during the simulation of the reactive transport coupled with dissolution process 3 5 dimensionless numbers the use of dimensionless numbers in reactive transport aims to generalize predictions and results across a range of transport and reaction rate conditions problems involving reactive transport usually take into account reynolds re péclet pe damköhler da and péclet damköhler peda numbers to characterize different dissolution patterns the definitions used in this work are based on soulaine et al 2017 and calculated at the initial time reynolds number re expresses the ratio of inertial effects to viscous forces and it determines the character of the flow laminar turbulent and transient flows and is given by 29 r e ρ f v 0 k μ f where ρf is the fluid density v 0 is a characteristic velocity represented here by the inlet velocity k is the square root of the permeability of the porous medium and represents a characteristic length and μf is the fluid dynamic viscosity the péclet number pe is defined as the ratio of the advection rate to the rate of diffusion of a chemical species as 30 p e v 0 k d α where d α is the diffusion coefficient of species α the péclet damköhler peda is defined as the ratio of the reaction rate and the diffusive mass transfer rate as 31 peda k r a ss d α where kr is the constant of reaction and ass is the specific surface area of the porous medium defined as the total available reactive surface area of the network divided by the total volume of pore spaces finally the damköhler number da that represents the ratio of the reaction rate to the rate of advection is defined as the ratio of the peda and pe numbers as 32 d a k r v 0 k a s s 3 6 statistics and regimes classification statistical approaches are useful for extracting information from a given data set and to better understand observed patterns in this way the standard deviation of the logarithm of the acid concentration σ is used in this study as a quantitative criterion to define dissolution regimes this parameter is a measure of the spread of a set of values hence the smaller the deviation the more homogeneous is the data set based on numerous observations of simulation results in cubic networks and for the initial condition used in these tests c a 0 10 k g m 3 the limit σ value to categorize a normalized data set as homogeneous was observed to be 1 therefore two different measures are considered the standard deviation of the acid concentration over all pores and throats of the network σnet and the average of the standard deviations of each vertical cross section of the network σ c r o s s first σnet is evaluated if σnet 1 the acid concentration is considered uniform through the network and the regime is classified as uniform otherwise the σ c r o s s is evaluated and if σ c r o s s 1 the acid concentration is considered to be uniform in each vertical cross section of the network and the regime is classified as surface dissolution otherwise the regime is classified as preferential pathways the standard deviation criterion is obtained as 33 σ 1 n x 1 n log 10 c a x log 10 c a x 2 where n is the number of pores and throats that are evaluated and log 10 c a x is the mean value of the logarithm of acid concentration in the data set for the construction of the phase diagrams the standard deviation analysis is evaluated for 100 random networks with the same size distribution and considering the same flow and reactive parameters in this way it is possible for each dissolution regime to present the number of networks that respected the criterion proposed to identify the main patterns 4 implementation the base algorithm from openpnm used for the implementation of the reactive transport and dissolution process was the transient reactive transport algorithm designed to account for advection diffusion and reaction phenomena considering just pores as control volumes and without considering geometry changes during simulations in this way the main improvements implemented by this work are related to considering pores and throats as control volumes and also considering geometry updates due to heterogeneous chemical reaction at each time step of the simulations the final and more complex algorithm follows the steps described below 1 network construction and geometry data definition 2 fluid and solid properties definition 3 definition of flow and kinetic parameters 4 solution of the steady state flow field 5 definition of initial and boundary conditions as well as simulation time and time steps for the concentration field solution 6 set up the sparse linear system of equations constructed based on the pores and throats mass balances using the euler implicit method 7 solution of the sparse linear system 8 after each time step with the new acid mass concentration c a n 1 multiplied by the volume vn for each pore and throat the total mass of acid ma inside each pore and throat is determined 9 determination of consumed mass of acid using eq 13 10 determination of consumed mass of solid using eq 14 11 determination of consumed volume of solid using eq 15 12 update the pore space volume v n 1 adding the consumed volume vcon to the previous volume vn 13 geometry update a determination of the new pore and throat volumes using respectively eqs 20 and 21 b determination of the new pore radii using eq 22 c determination of the new throat lengths using eq 23 d determination of the new throat radii using eq 24 e determination of the new available reactive area and cross sectional area of throats by using respectively eqs 25 and 26 f determination of the new available reactive area for pores using eq 28 14 update the hydraulic conductance eq 3 considering the updated geometry 15 update the fluid flow field eq 1 considering the updated geometry 16 update the new acid mass concentration c a n 1 for each pore space considering the total mass of this chemical species inside each pore and throat ma divided by the respective updated volume v n 1 17 return to step 6 and repeat until the algorithm reaches the final time step 5 results and discussion simulations of reactive transport are performed in different cubic networks to investigate dissolution regimes the geometry of the simulation domains are based on the work of song et al 2014 who conducted dissolution experiments in a real rock micro model directly etched in to a block of calcite and of soulaine et al 2017 that conducted simulations of the dissolution process in a two dimensional domain using a micro continuum dbs approach in this way the networks used in this work consider a uniform distribution of the pore sizes ranging from 300 μm to 900 μm a concentration of 10 kg m 3 of acid is injected from the left hand side of the network one dimensional flow in the positive x direction at a constant volumetric flow rate corresponding to a re 0 1 fluid and solid properties are set to μ f 10 3 p a s ρ f 1000 k g m 3 and ρ s o l i d 2165 k g m 3 the stoichiometric coefficient that relates the consumed acid species with the consumed solid reactive mineral is set to β 1 all these properties are based on the work of soulaine et al 2017 simulations considered a range in pe from 10 3 to 102 whereas the da varied from 10 3 to 1 in order to obtain these wide ranges of dimensionless numbers we considered diffusivity coefficients from 10 9 to as large as 10 4 m 2 s 1 and reaction rate constants from 10 6 to 10 3 m s 1 alternately v 0 could have been varied to obtain the desired range of pe and da the final simulation time was set to 500 seconds and the time step size was fixed at 1 second it is important to notice that simulations at the surface regime present a smaller simulation time due to the limitation of the merging of pores and throats not yet implemented in this work also damköhler values are limited to avoid reactivity scenarios where the merging of pore spaces could happen likewise greater reactivity might lead to the formation of a co 2 phase due to the large amount of reaction product produced both of these are topics to be developed in future work importantly the reactivities tested were sufficient to present behaviors of transport limited processes the results are discussed based on the pore volumes of injectant pvi additionally the last section presents extra simulations considering the carbonate network including a comparison between our results and those available in the literature 5 1 identification of dissolution regimes a network composed of 10 10 pores is used to explore the different dissolution regimes and to construct phase diagrams based on the dimensionless numbers pe da and peda fig 1 presents a scheme of the 10 10 network geometry the simulation results show that depending on the flow conditions and the mineral reactivity different geometries and acid distributions can be observed after the dissolution process these observations agree with previous literature daccord et al 1993b golfier et al 2002 soulaine et al 2017 liu and mostaghimi 2017 three main dissolution patterns and two intermediate patterns are observed from reactive transport simulations uniform dissolution surface dissolution preferential pathways transition zone and mixed zone the uniform dissolution pattern is related to significant acid penetration in the network in this regime the acid consumption rate is smaller than the transport by diffusion and advection meaning that almost the entire pore space is filled with a uniform distribution of the acid see fig 2 when a sufficiently large reactivity exists the changes in pore space geometry happen throughout the entire domain see fig 3 a otherwise no significant changes are observed throughout the network this is a consequence of the availability of acid for all pore spaces of the network that characterizes the reaction limited feature of this dissolution regime the volumetric flow rate starts to present changes for a da 0 01 that are more evident for throats with larger permeability see fig 3b the standard deviation based on acid concentration data from all pore spaces σnet was determined for 100 networks and for 100 of the samples presented a value less than one evidencing the uniform pattern of the regime the transition zone is characterized by the decrease of the acid penetration through the network and a concentration of the geometry changes in some portions of the domain regardless of the péclet number in this da range this behavior is observed the surface dissolution pattern is characterized by a homogeneous acid concentration along the cross sections perpendicular to the flow see fig 4 a in this regime the diffusion mechanism dominates over advective transport and reactivity of the acid is high meaning that significant amounts of acid are consumed on the upstream pore spaces of the network thereby impairing the propagation of the acid through the entire porous medium because of this the largest changes in geometry are observed for pores and throats located near the inlet area of the network see fig 4b the standard deviation analysis was evaluated and presented σnet 1 and σ c r o s s 1 for 100 of the samples this confirms the uniform profile of acid concentration along cross sections perpendicular to the flow the mixed zone is characterized as a transition between surface dissolution and preferential pathways in this regime the homogeneity of acid concentration along vertical cross sections starts to disappear as well as other features of surface regime the preferential pathways are observed when advection is the strongest transport mechanism and the reactivity of the acid is high preferential pathways result from the heterogeneous geometry of the porous medium and consequent heterogeneous velocity profile because of this more acid penetrates into the network through the more permeable pathways and no uniform patterns are observed see fig 5 furthermore geometry changes in this regime are also more evident along the most permeable areas as well as changes in volumetric flow rates the standard deviation analysis presented σnet 1 for 100 of the samples and σ c r o s s 1 for 96 of the samples evidencing the formation of preferential pathways through the domain fig 6 presents the evolution of the relationship between normalized permeability and porosity for the three main dissolution regimes observed for the uniform dissolution a linear pattern is observed independent of the mineral reactivity considered this means that besides the increase in porosity absolute permeability of the porous medium also increases as a consequence of geometry changes in the entire network a power law pattern is observed for the surface dissolution regime that can be interpreted as a restriction caused by the transport even with an increase of the porosity the overall permeability does not increase at the same rate because the majority of the affected pores are in the inlet a similar pattern is observed for preferential pathways however with a smaller increase of the porosity when compared to the surface dissolution the difference in the increase of permeability for preferential pathways and surface dissolution regimes is explained by the extent of acid contact with solid throughout the entire network volume after 209 4 pvi of injection the pore spaces that have undergone dissolution by the presence of acid in the preferential pathways regime are less in volume than those affected in the surface dissolution regime 188 4 pvi and also the uniform dissolution regime 209 4 pvi that is the fraction of the pore volume of the network that is affected by dissolution in the preferential pathways regime is less than the other two regimes and pathways do not span the sample fig 5 for example is an image of the final acid concentration distribution in the preferential pathway regime note that the pathways do not span from the injection side to the production side 5 2 behavior diagram construction in order to summarize the different dissolution regimes observed in the reactive transport simulations conducted on the network composed by 10 10 pores behavior diagrams are constructed based on the pe da and peda dimensionless numbers as presented in figs 7 a and 7b the main features of the diagrams agree well with literature results especially when compared with the study of soulaine et al 2017 that presents a regime diagram based on pe and da and the work of golfier et al 2002 that present the regime diagrams based on pe da and peda considering that the transition boundaries are based mostly on qualitative observation some uncertainties are associated with these lines and discrepancies between the studies can be noticed the pore network modeling used in this study is not capable yet to explore different preferential pathways regimes as by previous studies did golfier et al 2002 soulaine et al 2017 however the main dissolution regimes are explored by using a different analysis tool as presented in this section furthermore because this model does not consider merging of pores and throats this limitation also may bring some difference in the analysis of the boundaries and regimes it is also important to remember that dimensionless numbers are computed differently in each of the literature studies and this may explain these discrepancies after all it is important to highlight the applicability of pore network modeling as a tool to investigate dissolution regimes concerning length scale effects a network composed of 10 40 pores is used to investigate possible differences in the construction of behavior diagrams of different network sizes from fig 8 it is possible to note that besides all the agreements compared to the results from 10 10 network a small discrepancy related to the mixed zone is observed the transition pattern between surface dissolution and preferential pathways is reduced for the 10 40 network and is related to the increase of network heterogeneity and consequently a faster transition between regimes with large mineral reactivity therefore regardless of the difference in the mixed zone one can conclude that the behavior diagrams are in good agreement considering networks with different sizes 5 3 verification in a 40 40 network considering here a network with 40 40 pores the main dissolution regimes are verified fig 9 presents the acid concentration profile for uniform surface dissolution and preferential pathways regimes respectively after 50 6 pvi 40 5 pvi and 50 6 pvi figs 9a c the behaviors observed agree with the discussed features of each of the regimes uniform dissolution presents a uniform concentration of acid through the entire domain surface dissolution is characterized by a homogeneous concentration profile along the cross sections perpendicular to the flow and preferential pathways area highlighted by acid distribution through most permeable areas additionally fig 10 presents the porosity permeability relationship of these regimes the linear pattern of the uniform distribution is apparent as well as the power law pattern of surface dissolution and preferential pathways it is important to observe here that surface dissolution again presents greater increase of porosity than preferential pathways due to the large dissolution rate for inlet pore spaces even with the lack of pore merging the importance of surface dissolution is also evidence of the role of diffusion the standard deviations of these simulations were obtained and also agree with the regime specifications 5 4 3d domain verification a three dimensional domain is constructed to evaluate the generality of the features of the dissolution regimes obtained using 2d pore networks fig 11 presents the initial geometry for a network composed by 10 10 10 pores the acid concentration for uniform dissolution surface dissolution and preferential pathways after 250 2 pvi 150 1 pvi and 250 2 pvi respectively are presented in fig 12 the features of each regime agree with discussions made considering 2d networks the uniform dissolution see fig 12a presents a uniform distribution of the acid throughout the entire domain and shows a σ n e t 0 01 for the conditions assumed p e 0 095 d a 0 0006 and p e d a 6 06 10 5 the surface dissolution see fig 12b presents a homogeneous distribution of the acid concentration along cross sections perpendicular to the flow the standard deviations of this regime and the dimensionless numbers result respectively in σ n e t 1 56 and σ c r o s s 0 39 and p e 0 00095 d a 0 57 and p e d a 5 456 10 4 that agree with the previous assumptions the preferential pathways see fig 12c are well observed in the middle region of the network considering p e 95 d a 0 57 and p e d a 5 456 10 1 the standard deviation of this condition is σ n e t 3 52 and σ c r o s s 2 31 the porosity permeability relationships for the three main dissolution regimes are presented in fig 13 the uniform dissolution regime presents a linear pattern as observed for 2d simulations the surface dissolution result also replicates the results obtained for 2d domains that present a more rapid increase of the porosity in comparison to the permeability as a result of the geometry changes in the inlet area of the networks on the other hand the preferential pathways presents a slightly different pattern where a power law behavior is observed initially at normalized porosity range of 1 1 2 followed by a pronounced increase of the permeability that characterizes the formation of preferential pathways this difference is related to the greater degree of freedom for 3d simulations that allows more propagation options for the fluid throughout the porous medium and increases the evidence of highly conductive channels formation these different behaviors in 2d and 3d networks are expected because the preferential pathways regime tends to create fractal structures daccord et al 1987 1993a that depend on the dimensionality of the enclosing domain 5 5 implementation on real pore networks the single phase reactive transport approach developed in this work was also implemented using a pore network obtained from a carbonate rock this pore network model is used to ensure the applicability of this methodology for more complex pore topologies here the inlet acid concentration is set to 1 kg m 3 and a reaction limited scenario is presented considering d a 0 001 greater reactivities cannot be considered without including the merging of pores and throats fig 14 presents the final concentration profile of a uniform dissolution pattern simulation that is in good agreement with the behaviors observed in cubic networks and presenting σ n e t 0 003 the results of porosity and permeability evolution from these simulations are compared with regular cubic network results and literature data the power law exponent of the curves obtained by plotting log k k 0 versus log ϕ ϕ 0 are compared with values obtained by egermann et al 2010 and bekri et al 2015 both worked with 3d regular pore networks constructed based on petrophysical laboratory data egermann et al 2010 also conducted core flood experiments the latter related the power law exponent with the dissolution pattern where reaction limited regimes were identified between values of 1 5 and 6 9 identified in table 1 by the subscripts min and max respectively greater values were related to a convective predominant regime described by changes only in throats geometry value identified by the subscript throats table 1 presents the power law exponents and their references it is noticed that simulations in the 2d and 3d pore networks previously discussed in this work and from bekri et al 2015 obtained values in the range that represents uniform dissolution for the carbonate simulation the exponent is larger and is explained by the fact that the available surface areas obtained for this sample see eq 28 are much smaller due to the significant heterogeneity of the pore and throat sizes consequently for this case changes were observed mainly in the permeability due to dissolution of throats as for future work the implementation of merging of pores and throats would improve and facilitate the use of the approach presented in this study to evaluate dissolution regimes in more complex pore networks derived from real porous media this will likely change the response of permeability and porosity for extreme cases respectively represented by preferential pathways and surface dissolution regimes and also bring the reactive transport model to the physical problem 6 conclusion this work presents a pore network modeling approach to evaluate the effects of different transport mechanisms and mineral reactivity on dissolution regimes as well as changes in porosity and permeability the transport problem is implemented by considering the acid mass balance inside pores and throats the changes in pore space geometry due to dissolution are considered based on the rate of the heterogeneous chemical reaction happening at the solid surface péclet and damköhler dimensionless numbers are used to construct behavior diagrams in order to characterize the different dissolution regimes the reactive transport simulations developed in this work exhibit results similar to those previously discussed in the literature based on direct simulations and experimental trials in this work five dissolution regimes were explored based on acid concentration network geometry volumetric flow rate porosity permeability relationship and standard deviation analysis that was successfully introduced as a quantitative criterion for the cases studied these regimes include uniform dissolution da 0 05 transition zone 0 05 da 0 1 surface dissolution da 0 1 and pe 0 001 mixed zone and preferential pathways in general for da 0 1 and pe 0 001 the results demonstrate the applicability of pore network modeling as a tool to explore reactive transport and dissolution processes as well as to predict changes in porosity and permeability results demonstrated the various dissolution regimes observed at larger scales the use of a pore network approach to understand reactive transport during single phase flow also offers new possibilities of investigation merging of pores and throats to form vug like pores is suggested as an improvement to better evaluate regimes with significant mineral reactivity incorporation of cornered pores with triangular geometry that are the most common pore shape allows the exploration of more complex systems based on multiphase reactive transport in this way multiphase systems are also suggested to be implemented to represent various subsurface and reservoir conditions credit authorship contribution statement barbara f esteves conceptualization methodology software writing original draft paulo l c lage writing review editing supervision paulo couto writing review editing supervision anthony r kovscek conceptualization supervision funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment bfe and ark acknowledge gratefully the support of the stanford center for carbon storage supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j advwatres 2020 103741 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
406,the predictions of two recent and two classical mathematical models are compared with experimentally measured three phase relative permeabilities experimentally determined constitutive relationships in two phase systems were used as model input parameters to numerically predict relative permeabilities kr in three phase systems then the estimated results were compared with experimental three phase permeabilities measured along decreasing water saturation decreasing oil saturation increasing gas saturation ddi paths the results of the individual models to each of the three fluids involved water oil and gas were analyzed in detail the simulated results showed that the total differential td compatible model overestimates significantly both the global mobilities as well as the relative phase permeabilities in the three phase system there was improvement in the prediction with the td compatible model when experimental data were used to locally impose the global mobility and fractional water and gas fluxes in the ternary diagram globally the best prediction of the measured kr values was obtained with the so called mechanistic model however its numerical implementation requires a preliminary calibration of the relative phase permeabilities in a three phase system against experimental data along one ddi path to quantify the required six characteristic coefficients in contrast to the td compatible model which by construction does not exhibit any numerical instabilities elliptic zones in the water oil napl gas ternary diagram were identified in the mechanistic model keywords relative permeability three phase system mathematical model global mobility ternary diagram 1 introduction since the 1950s the number of sites contaminated by halogenated solvents has increased significantly in industrialized countries solvents are used in a wide range of industrial processes and in everyday products e g paints oils varnishes and dry cleaning liquids and may be released into the environment in industrial effluents or by improper disposal by users among all solvents aliphatic chlorinated solvents including chloromethane chloroethane and chloroethene have been the most frequently encountered group of compounds therefore characterization and modeling of the fate of chlorinated solvents in porous aquifers has gained significant attention in recent years to protect groundwater resources fried et al 1979 cohen and mercer 1993 pankow and cherry 1996 jellali et al 2001 bohy et al 2006 dridi et al 2009 cotel et al 2011 portois et al 2018 qian et al 2020 these liquid compounds are immiscible in water and because they are usually denser than water except vinyl chloride chloromethane and chloroethane they are called dense nonaqueous phase liquids dnapl in the subsurface chlorinated solvents migrate vertically depending on the gravity and capillary forces through the unsaturated zone where a large vapor plume appears due to their high volatility after rainfall a vapor lixiviation due to vapor precipitation may occur and dissolved chlorinated solvents can reach the groundwater table and contaminate the groundwater mendoza and frind 1990 sleep and sykes 1992 jellali et al 2003 if the amount of solvents released is large the dnapl reaches and penetrates the groundwater table due to its high density dissolves and forms a solute plume within the aquifer a certain amount of solvents becomes trapped as blobs or forms pools over low permeability geological structures this constitutes a long term source of contamination of drinkable groundwater resources given the low solubilities of the solvents schwille 1988 brusseau 1992 kennedy and lennox 1997 eberhardt and grathwohl 2002 seyedabbasi et al 2012 multiphase flow may occur in a porous aquifer in the form of three phase water napl gas flow in the unsaturated zone and two phase water napl flow in the saturated zone fig 1 gravity driven infiltration of napls in soil containing one or more chlorinated solvents leaves behind a zone of residual saturation this process results in a small size napl source zone within the porous medium with respect to the characteristic dimensions of the aquifer the main difference between the two and three phase flow is the formation of napl layers sandwiched between gas and water blunt et al 1995 and the double displacement where the gas displaces the disconnected napl ganglia which displaces water øren and pinczewski 1995 these mechanisms can reduce residual napl saturation even in capillary dominated flow helland and jettestuen 2016 whereas in two phase capillary dominated flow isolated ganglia are trapped chatzis and morrow 1984 numerical simulation of multiphase flow has become a crucial method for solving water resource management and other environmental problems such as co2 sequestration in saline aquifers and coupled geomechanical processes in the subsurface helmig et al 2013 celia et al 2015 benisch et al 2020 while multiphase flow models for water napl and gas phases were initially adopted in petroleum research for reservoir simulation they were later successfully exploited for hydrosystem monitoring or remediation pressure and saturation of fluids are the key variables in the analysis of multiphase flow in porous media furthermore secondary variables such as relative permeabilities and capillary pressures which are functions of fluid saturations are needed for the simulation of displacement processes in porous media forecasting the behavior of chlorinated solvents in aquifers presents at least two difficulties characterization of the source zone i e locating the source zone and evaluating the napl volume and composition and modeling of the fate of pollution downstream of the source zone i e how to choose physical models mathematical tools and numerical methods multiphase flow modeling is a major tool for assessing groundwater pollution caused by non aqueous phase liquids napl such as chlorinated solvents to quantify and characterize groundwater pollution by napls numerical codes that include multicomponent transport equations require a fast and accurate resolution of the primary and secondary variables of three phase flow the relative permeability of a fluid depends on the wetting properties of the porous medium van dijke and sorbie 2002 but it may also depend on the saturation history as the pore scale fluid configurations are history dependent relative permeability can be measured either in the laboratory by performing coreflood experiments or estimated using empirical correlations the earliest three phase relative permeability measurements found in the literature date back to the work of leverett and lewis 1941 and since then a variety of studies have been conducted to investigate the effects of various parameters such as saturation history wettability spreading and layer drainage on three phase relative permeability alizadeh and piri 2014a nonetheless experimental measurement of three phase relative permeabilities is far more complex and time consuming than two phase relative permeabilities and thus several correlations and mathematical models have been proposed over the years to predict three phase relative permeabilities using two phase relative permeability data e g corey et al 1956 stone 1970 1973 baker 1988 delshad and pope 1989 blunt et al 1995 blunt 2000 ranaee et al 2015 shahverdi and sohrabi 2017 a detailed review of existing three phase relative permeability models is given by shahverdi and sohrabi 2017 the present study addresses from both physical and numerical points of view specific questions related to mathematical modeling of three phase multiphase flow in porous media as regards the physical aspect the research questions relate directly to the use and implementation of three phase water napl gas flow codes to predict for example the formation of a napl source zone after infiltration of napls into the subsurface these numerical tools require as input parameters inter alia constitutive relationships such as relative permeabilities which are functions of saturations of different fluids present in the porous medium in connection with the implementation of relative permeabilities in numerical three phase flow codes model developers and users are faced with a range of basic questions how is one able to predict the relative permeability of the napl phase as a function of water and gas saturation levels are the relative permeability models that have traditionally been developed for napls such as stone models stone 1970 1973 appropriate for representing the governing displacement physics and if not what are the shortcomings regarding the numerical aspect the questions that arise for modelers are often related to the possible instability of numerical models relative permeability models for the napl phase in three phase flow systems can be the origin of numerical instabilities trangenstein 1989 while conventionally assumed that three phase permeability models only generate hyperbolic systems bell et al 1986 using synthetic kr models showed that the system of saturation equations is not purely hyperbolic in all respects and may produce unstable results for certain saturation values called elliptic regions jahanbakhshi et al 2013 demonstrated by linearization that the system is unstable in elliptic regions i e for conjugate complex eigenvalues of the jacobian matrix of the system of two saturation equations using the fractional flow theory of displacement for example using stone s model i stone 1970 in cases of flow configurations that do not include gravity and capillary effects the occurrence of elliptic zones leads to significant oscillations of fluid saturations schneider 2015 and exhibits complex wave speeds that result in non unique solutions jackson and blunt 2002 in the absence of three phase experimental data a new class of total differential td interpolations was designed to simplify the numerical simulations of compressible three phase flows by using a global pressure formulation chavent et al 2008 chavent 2009 amaziane et al 2012 this formulation requires that the three phase relative permeabilities and capillary pressures satisfy the so called total differential td condition chavent 2009 which guarantees the strict hyperbolicity of the reformulated system chavent and jaffré 1986 the td interpolation of a collection of three phase data sets is then realized by constructing two functions over the ternary diagram one global capillary pressure and one global mobility which satisfy the boundary conditions determined by the three given two phase data sets the resultant relative permeabilities that comply with the condition of total differential defined by di chiara roupert 2009 do not yield elliptic zones and will therefore be used in our comparison of the predictions of different mathematical models with experimentally tested three phase relative permeability results the td compatible model described by di chiara roupert et al 2010a will be extended by integrating experimental based residual fluid saturations in two phase systems to compare the td compatible model with the commonly used three phase relative permeability models we included three other models in our study first the recently developed model for the prediction of three phase relative permeabilities the so called mechanistic model proposed by shahverdi and sohrabi 2017 will be evaluated this model presumably takes into account the interaction between various fluids as well as fluid saturation distributions using an arithmetic averaging relationship between two phase and three phase permeabilities our numerical study will then be completed by applying the classical parker lenhard model parker and lenhard 1990 that was traditionally introduced as one of the first permeability models in three phase flow and transport numerical simulators to describe and predict the fate of contamination by napls in the subsurface and the historical stone model i stone 1970 commonly implemented in industrial oil reservoir codes will be used to model the oil relative permeability in three phase systems in our numerical simulations we used experimentally determined constitutive relationships of two phase systems as input parameters to numerically predict the relative permeabilities in three phase systems then we compared the estimated results with experimental three phase permeabilities measured by oak oak 1990 and alizadeh alizadeh 2013 alizadeh and piri 2014b along decreasing water saturation decreasing oil napl saturation increasing gas saturation ddi paths the overall objective of the present work was to quantify the differences between the measured and the predicted relative permeabilities for water oil and gas in a three phase fluid system the occurrence of elliptic regions is also analyzed for the mechanistic model parker lenhard model and stone s model i in the framework of the classical fractional flow theory of displacement our study is organized as follows section 2 outlines the main features of the three phase relative permeability models evaluated the experimental data employed for the evaluation and comparison of the different mathematical models to describe relative permeabilities in three phase flow systems are concisely described in section 3 key results of our numerical studies are presented in section 4 finally section 5 presents the outcome of our individual model analysis to each of the three fluids involved water oil and gas and discusses the existence and importance of elliptic zones in a water oil napl gas ternary diagram when using the mechanistic model 2 mathematical models here we describe the main features of two recent and two classical models evaluated against experimentally measured three phase permeabilities mechanistic model of shahverdi sohrabi shahverdi and sohrabi 2017 total differential compatible model introduced by di chiara roupert et al 2010a 2010b extended by integrating experimental based residual fluid saturations in two phase systems parker lenhard model parker and lenhard 1990 stone s model i stone 1970 the constitutive relationships capillary pressure saturation pc s and relative permeability saturation kr s functions in two phase systems used in our study are summarized in appendix a 2 1 mechanistic model of shahverdi sohrabi to predict three phase relative permeabilities of oil water and gas the so called mechanistic model proposed by shahverdi and sohrabi 2017 takes into account the interactions between the fluids and fluid saturation distributions for this purpose an arithmetic averaging relationship between two phase and three phase permeability is used six new parameters named characteristic coefficients aij having a value between zero and one are introduced in their model to express the linear relationship between two phase and three phase saturations for each of the three fluids present in the system these coefficients reflect the contribution of each fluid in controlling the flow of the other fluids it should be noted that at least one set of experimental three phase relative permeability data for one saturation path is required to tune the characteristic coefficients the estimated characteristic coefficients can then be employed to predict three phase relative permeabilities for any other saturation path in this model the three phase relative permeability of the oil phase kro is expressed by 1 k r o s w o s w o s g o k r o w s o w s g o s w o s g o k r o g s o g where krow is the two phase oil relative permeability in the oil water system krog is the two phase oil relative permeability in the gas oil system sow and sog are the oil saturation in the two phase oil water and gas oil system and swo and sgo represent the water saturation in a two phase water oil system and gas saturation in the two phase gas oil system the model proposes a linear relationship between two phase and three phase saturations as follows 1a s o w a o w s o 1b s o g a o g s o 1c s w o a w o s w 1d s g o a g o s g where sw so and sg are the three phase saturations of water oil and gas respectively similar expressions can be developed for three phase water relative permeability krw and gas relative permeability krg 2 k r w s o w s o w s g w k r w o s w o s g w s o w s g w k r w g s w g where sgw and swg are the gas saturation and water saturation in the two phase gas water system the two phase saturations are linked to the given three phase saturations by the following linear relationships 2a s g w a g w s g 2b s w g a w g s w the gas relative permeability is expressed as 3 k r g s w g s o g s w g k r g w s g w s o g s o g s w g k r g o s g o eqs 1 2 and 3 represent a coupled nonlinear system of equations in our study the six two phase relative permeabilities in eqs 1 2 and 3 are expressed using the mualem van genuchten model appendix b to quantify the characteristic coefficients aij we used the nlfit tool of origin 2019 with the levenberg marquardt iteration algorithm and user defined fitting functions with multiple variables 2 2 total differential td compatible model in a three phase fluid water wet system there generally exist two fluid interfaces oil water and gas oil at both interfaces there is a change in pressure called capillary pressure when moving from one fluid to the other moreover the individual phase pressures can be singular in the case where the derivative of capillary pressure becomes infinite at residual saturations hence phase pressures cannot be regular across a two phase interface the total differential condition allows the two gradients of two phase capillary pressures to be rewritten as a single gradient of a mathematical function called the global capillary pressure function pc g chavent and jaffré 1986 chavent 2009 di chiara roupert et al 2010a the resulting new pressure variable called global pressure p is written as the sum of the pressure of one of the three fluid phases and the global capillary pressure pc g in our modeling approach we used the gas pressure to define the global pressure this is required when dealing with compressible three phase flow note the global pressure is smooth compared to the individual phase pressures and exhibits a global volumetric flow vector without any capillary gradients this global pressure formalism specifically allows the decoupling of the pressure equation and the two saturation equations the numerical analysis of the problem is thus simplified and the efficiency of the calculation is improved note the global pressure approach in a two and three phase flow system exists only for data of relative permeabilities and capillary pressures that satisfy the total differential td condition the td compatible model introduced by di chiara roupert et al 2010a uses continuous mathematical functions to describe the two phase relative permeabilities and capillary pressures on the edges of the ternary diagram fig 2 in the present study we integrated experimental based residual fluid saturations in two phase systems to quantify the mobility and global capillary pressure on the three boundaries the way the integration was done is described in section 4 2 the input parameters required for the td compatible model are two phase relative permeabilities krj kl and two phase capillary pressures pc kl on the three edges of the ternary diagram fig 2 where j 1 2 or 3 and k l 1 2 or 3 the independent variables are the water saturation s1 and gas saturation s3 two phase constitutive relationships used in the td compatible model are described in appendix a the required model input parameters are obtained by considering primary drainage of a single phase fluid system further physical properties of the fluids taken into account are equilibrium interfacial tensions in the gas water system σgw oil water system σow and gas oil system σgo water gas and oil densities and viscosities molecular weight of the gas gas constant temperature and reference density of gas the data available in the literature on bentheimer and berea sandstones were used as input parameters for the interpolation module using finite elements that was developed by di chiara roupert 2009 then for each rock sample the three phase data that are td compatible will be determined from a global capillary pressure function and a global mobility function which depend on the saturation and overall global pressure level p note that the boundary conditions of the ternary diagram for the global capillary pressure and global mobility must be consistent with the three sets of two phase data step 2 and step 3 in table 1 di chiara roupert et al 2010a note in step 2 one has to respect the so called td compatibility condition the three sets of two phase data built up on the edges of the ternary diagram have to satisfy this condition the global capillary pressure calculated independently on the oil gas and water gas side must be the same at the gas summit the td compatibility condition is a nonlinear constraint on weighted means of the given two phase relative permeability data set it presents a certain weakness of this model in contrast to its strength of being free of elliptic zones in the saturation space the two phase data known on the limits of the ternary diagram will then be extended to the whole diagram and thus determine the relative permeabilities in a three phase system by respecting the total differential condition the numerical construction of the global mobility and global capillary pressure will then be performed by finite elements c0 step 4 in table 1 and c1 step 5 in table 1 using laplacian and bi laplacian interpolation relative permeabilities in three phase systems will then be derived from global mobilities d step 4 fluid fractional flows fj step 5 using the derivatives of the global capillary pressures pc g the capillary pressure curves in a water gas system pc 12 and gas oil system pc 32 with respect to s1 and s3 individual mobilities dj step 5 by 4 k r 1 s p f 1 s p d 1 d s p k r 2 s p f 2 s p d 2 d s p k r 3 s p f 3 s p d 3 p p c g s p p c 32 s 3 d s p the relative permeabilities krj for the three fluid phases with j 1 water 2 napl 3 gas that will be quantified will then be compared with the three phase experimental data 2 3 parker lenhard model based on the van genuchten parameter m appendix a obtained from the capillary pressure saturation pc s relationship in the two phase gas water system and the irreducible wetting fluid saturation swi water oil and gas relative permeabilities in a three phase fluid system can be predicted the water relative permeability krw is described by 5 k r w s w 1 2 1 1 s w 1 m m 2 with s w s w s w i s m a x s w i where swi is the irreducible saturation of the wetting fluid phase here water and smax is the maximum saturation of the wetting fluid phase during drainage of the porous medium water is displaced for example by gas the maximum saturation smax is equal to 1 note that the maximum saturation of the wetting fluid phase smax is considered to be independent of fluid properties or saturation history in the present work we focused our attention to monotonic wetting phase drainage from complete saturation the oil relative permeability kro is expressed as 6 k r o s t s w 1 2 1 s w 1 m m 1 s t 1 m m 2 where s t s w s o s w i 1 s w i the gas relative permeability krg is described by 7 k r g 1 s t 1 2 1 s t 1 m 2 m where s t s w s o s w i 1 s w i 1 s g s w i 1 s w i 2 4 stone s model i to quantify the oil relative permeability in a three phase system the first model proposed by stone in 1970 uses a geometric averaging between the oil relative permeability krog in the two phase gas oil system and the oil relative permeability krow in the two phase oil water system 8 k r o s o 1 s g 1 s w k r o g s g k r o w s w in this equation s o s g and s w are the normalized oil gas and water saturations respectively and are defined as 8a s o s o s o r 1 s w i s o r 8b s g s g 1 s w i s o r 8c s w s w s w i 1 s w i s o r where swi and sor are irreducible water saturation and residual oil saturation respectively in our study two phase oil relative permeability in the gas oil system is expressed by the mualem van genuchten mvg model mualem 1976 van genuchten 1980 8d k r o g s g s o s o r 1 s o r 1 1 s o s o r 1 s o r 1 m o g m o g 2 1 s g s o r 1 s o r 1 1 1 s g s o r 1 s o r 1 m o g m o g 2 and two phase oil relative permeability in the oil water system is expresses by the modified mualem van genuchten model 8e k r o w s w k r o w m a x 1 s w s w i 1 s w i 1 s w s w i 1 s w i 1 m o w 2 m o w where krow max is the maximum relative oil permeability achieved at irreducible water saturation swi in the oil water system mog and mow correspond to the mvg parameter in a gas oil system and oil water system respectively 3 experimental data to evaluate and compare the four mathematical models explained earlier experimental data generated on two different water wet sandstones were selected from the literature 3 1 data on bentheimer sandstone alizadeh 2013 performed a series of steady state flow experiments on water wet bentheimer sandstone to obtain two phase and three phase relative permeabilities the absolute brine permeability and porosity of the core sample whose data were used in our study were 2 66 d and 0 24 respectively alizadeh and piri 2014b the physical properties of the fluids used in the flow experiments are provided in table 2 the two phase relative permeabilities obtained during primary drainage in oil water gas water and gas oil systems are plotted in fig 3 and compared to the simulated two phase relative permeabilities using the mvg model to quantify the input parameter for the mvg model we used the experimentally determined end point wetting phase saturations and the associated nonwetting phase relative permeability as known irreducible water saturations swi in the oil water and gas water systems remaining oil saturation sor in the gas oil system and maximum relative permeability of the nonwetting fluid krnw max the only remaining model parameter mvg parameter m was then obtained by a nonlinear fit of the theoretical kr s against the experimentally observed permeability curve using the nlfit tool of origin 2019 with the levenberg marquardt iteration algorithm the capillary pressure saturation curve measured by alizadeh 2013 for a gas water system was analysed numerically with the van genuchten model fig 3 the optimal calibration of the experimental pc s data was obtained using the fit of the three model parameters swi m α all fit parameters and characteristics of the optimization process are listed in table c1 appendix c it is worthwhile to mention that the irreducible water saturation or residual oil saturation quantified from capillary pressure curves is systematically smaller than that observed experimentally in the two phase flow experiment from the theoretical point of view the numerical value of parameter m derived from the mvg model should be equal to that of parameter m appearing in the van genuchten pc s model as the aim of our study is to represent as close as possible the experimental constitutive relationships we preferred to keep fitted the parameter m in both relationships 3 2 data on berea sandstone oak 1990 performed a series of steady state flow experiments on water wet berea sandstone to obtain two phase and three phase relative permeabilities the absolute permeability and porosity of the core sample whose data were used here were 0 2 d and 0 22 the physical properties of the fluids used in his experiments are provided in table 3 the two phase relative permeabilities obtained in experiments 2 8 and 13 were conducted in oil water gas water and oil gas systems the measured and numerically simulated two phase relationships are presented in fig 4 the capillary pressure saturation curves determined in oak s experiments in a gas water water oil and oil gas system were analysed numerically with the van genuchten model fig 4 all fit parameters and characteristics of the optimization process are summarized in table c2 appendix c 3 3 comparison of measured and predicted three phase kr values the saturation path of three decreasing water saturation decreasing oil saturation increasing gas saturation ddi experiments performed on bentheimer sandstone by alizadeh and piri 2014b and 7 ddi experiments performed on berea sandstone by oak 1990 are shown in fig 5 the experimental two and three phase relative permeabilities obtained on the bentheimer and berea sandstones were used to predict three phase flow in porous media using the four mathematical models described earlier in section 2 in our numerical study the model performance was evaluated by quantitative and qualitative methods in the qualitative approach the response of each model was first visually analyzed by plotting the measured and simulated values of relative permeabilities as functions of the saturation of the corresponding fluid phase to quantify the goodness of the prediction of the measured kr values we used the root mean square error rmse 9 r m s e 1 n i 1 n m i p i 2 the coefficient of residual mass crm 10 c r m i 1 n m i i 1 n p i i 1 n m i the relative error re defined as 11 r e p i m i m i and the maximum relative error mre expressed by 12 m r e m a x p i m i i 1 n m a x m i where mi and pi represent the measured and predicted kr values and n is the number of experimental data the rmse is an accuracy index and expresses the average model prediction error in units of the variable of interest it can range from 0 to is indifferent to the direction of errors and represents negatively oriented scores the crm illustrates the tendency of a model to overestimate or underestimate the measurements positive values for crm indicate that the model underestimates the measurements and negative values for crm indicate a tendency to overestimate to analyze globally the response and goodness of the different models to predict the three phase relative permeabilities of water oil and gas we plotted the simulated kr values against the measured kr values and analyzed the scatter plot by linear regression using originlab 2019 the quantified coefficient of determination r squared is expressed by 13 r 2 1 n i 1 n m i m p i p 2 σ m σ p with m 1 n i 1 n m i and p 1 n i 1 n p i where σ m qnd σ p are the standard deviation of mi and pi respectively r squared is a statistical measure of how close the data are to the fitted regression line and demonstrates thus the ratio between the scatter of predicted values to the measured values 4 results of the numerical modeling 4 1 mechanistic model of shahverdi sohrabi 4 1 1 implementation of the model to test the implementation of the mechanistic model developed by shahverdi and sohrabi 2017 we used oak s experiment 15 or named g1 in shahverdi and sohrabi 2017 the six two phase relative permeabilities are expressed by the mualem van genuchten model see appendix b the used model parameters are reported in table 4 to quantify the characteristic coefficients aij shown in table 5 we used the nlfit tool of origin 2019 with the levenberg marquardt iteration algorithm and user defined fitting functions with multiple variables the fit of oak s experimental data originating from experiment 15 on soil sample 6 which corresponds to experiment g1 named by shahverdi and sohrabi 2017 was achieved in our runs after 420 iterations with a chi square tolerance value of 1 10 9 giving a fit result with r squared of 0 99 it is worth noting that the uncertainty intervals obtained for the characteristic coefficients aog and awg table 5 are extremely high compared to their numerical values which were bounded in the fitting procedure between 0 and 1 the predicted kr values of oak s ddi experiments shown in the following are obtained using the model parameter estimates given in table 5 we did not yet consider their uncertainty intervals in our modeling approach to predict the level of uncertainty associated with these parameter estimates through i e an assessment of the covariance matrix however the estimated coefficients aij are quite different from the numerical values published by shahverdi and sohrabi 2017 who used the genetic algorithm as described in shahverdi et al 2011 in their nonlinear fitting procedure for estimation of relative permeability the relative permeabilities for the corresponding two phase systems similar to ours the way of implementing the two phase relative permeabilities in our case by using the analytical function of mvg model in their case spline functions and the automatic fitting procedure itself seem to significantly impact the numerical values of estimated coefficients aij the main differences can be summarized as follows in our work 1 aog is greater than aow hence the oil phase is more dominated by the gas phase than the water phase and 2 the comparison between ago and agw indicates that more fraction of gas saturation is governed by water however as shown in fig 6 the detailed comparison of fitted kr values against the experimental data indicates that our fitted kr values have rmses values that are comparable with the tuned kr values found by shahverdi and sohrabi 2017 it is certainly not surprising that the estimation of these characteristic coefficients does not allow a unique solution this is related not only to the nature of the inverse problem but also to the approach employed to the minimization of a given objective function to further explain the observed differences a profile likehood analysis could be carried out for each given ddi path ranaee et al 2015 in order to investigate for some given upper and lower limits of confidence intervals if the model displays a unique minimum identifiability case or on the contrary if the case is not structurally identifiable one can therefore make a priori choice on the path to be chosen in order to guarantee an exploitable fitted model in our study we have chosen to use automatic nonlinear minimization of the objective function using the nlfit tool implemented in origin 2019 with the levenberg marquardt iteration algorithm whereas the coefficients generated by shahverdi and sohrabi 2017 were determined with a genetic algorithm to build up the objective function we used a continuous description of data sets using the constitutive analytical mvg relationship whereas the genetic algorithm approach implemented by shaverdi and sohrabi 2017 was based on kr values represented by quadratic b spline functions note also that the quantified coefficient of residual mass crm do not always exhibit similar tendencies for example the water relative permeability is underestimated by shahverdi and sohrabi 2017 and only slightly overestimated in our study whereas the estimates of gas relative permeabilities show contrary trend concerning the prediction of kr values globally our results obtained for experiments 17 g2 and 18 g3 are similar to those obtained by shahverdi and sohrabi the detailed comparison of predicted kr values water oil gas for experiments 17 and 18 with those of shahverdi and sohrabi 2017 is documented in appendix d 4 1 2 prediction of oak s ddi experiments 16 19 20 and 25 figs 7 10 show the predicted three phase relative permeabilities along the ddi saturation paths of experiment 16 19 20 and 25 not surprisingly the relative permeabilities predicted for experiment 16 by the mechanistic model clearly represent the measured kr values its ddi saturation path is close to that of experiment 15 used in the calibration process of the characteristic coefficients aij fig 5 and therefore the numerical values of crm and mre are quite similar the relative permeabilities predicted in experiment 19 and 25 for water and gas also perfectly fits the observed experimental data expressed by low rmses and low mres ranging between 1 and 17 however the oil relative permeabilities are strongly overestimated as shown by the high negative values of crm in the case of experiment 20 which corresponds to a saturation path at irreducible water saturation the water relative permeability is predicted as very close to zero fig 9 surprisingly in this case the predicted oil relative permeabilities as well as the gas relative permeabilities are highly underestimating the observed values the mre value attains about 64 and 28 for the predicted oil and gas permeability respectively 4 1 3 prediction of alizadeh s experiments on bentheimer sandstone the required input parameters used for the description of the experimental two phase relative permeabilities in the mechanistic model see appendix b are summarized in table 6 to test the influence of the characteristic coefficients aij on the prediction of the three phase relative permeabilities along the three ddi saturation paths we decided to apply three options to quantify the coefficients aij by nonlinear fit we used 1 in option a the measured kr values of experiment a 2 in option c the experimental results of experiment c and 3 in option ac both data sets of results the quantified characteristic coefficients aij for each of the three options are reported in table 7 it is worth noting that the uncertainty intervals obtained for the characteristic coefficient awg are high compared to their numerical values which were bounded in the fitting procedure between 0 and 1 especially in modeling option a the standard error of awg is extremely high and underlines that the model parameter obtained is rather uncertain the predicted kr values of alizadeh s ddi experiments shown in the following are obtained using the model parameter estimates given in table 7 we did not yet consider their uncertainty intervals in our modeling approach to predict the level of uncertainty associated with these parameter estimates through i e an assessment of the covariance matrix comparing the resulting coefficients from option a with those quantified from option c unlike the numerical value of aow the differences are quite significant aog for example which characterizes the relation between the oil saturation in the two phase oil gas system and oil saturation in the three phase fluid system is found to be zero in option a while in option c it takes the maximum value of 1 a similar fact can be stated for coefficient awg in option ac the quantified characteristic coefficients are situated between either option a and option c or closer to the coefficients of option c the latter can be attributed to the fact that the data set of experiment c contains more values than the data set of experiment a figs 11 13 show the fitted and predicted three phase relative permeabilities along the ddi saturation paths of experiment a c and d1 to qualify the goodness of each of the numerical simulations we specified the corresponding rmse crm and mre the simulated water relative permeabilities of experiment a and c globally overestimates the experimental values note that experiment d1 corresponds to the case where water is at irreducible saturation and thus immobile however the oil relative and gas relative permeability measured in experiment c and d1 are both underestimated by all three model options the detailed comparison of all predicted fitted kr values with the measured values show that the numerical results obtained with coefficients of option c and ac are overly closer to the experimental data than those quantified with coefficients of option a one reason for this may be the higher number of data points considered during the optimization procedure of the characteristic coefficients aij but also the more central location of ddi saturation path of experiment c in the ternary diagram the use of two experimental data sets option ac for tuning of the characteristic coefficients as suggested by shahverdi and sohrabi 2017 to reduce the degree of uncertainty by employing more measured data of three phase relative permeabilities slightly improves only the goodness of predicted kr values therefore in the following global analysis we will only consider the simulated results obtained with model option c 4 1 4 global analysis of predicted three phase relative permeabilities for further investigation of the accuracy of the model the three phase relative permeabilities predicted by the model for each fluid phase are plotted against the measured relative permeabilities obtained for berea and bentheimer sandstone figs 14 16 each figure also contains a description of the quantified relative error as a function of the measured relative permeability in the three phase system in the case of berea sandstone as shown by the cross plot fig 14 the water relative permeability is reasonably well predicted by the mechanistic model globally it slightly overestimates the measured kr values characterized by a relative error of about 0 13 0 53 however for the bentheimer sandstone the predicted water relative permeabilities deviate strongly from the experimental measurements in this case the scatter of the predicted values to the measured values is strongly disordered and cannot be reasonably described by the fitted regression line r squared 0 56 except for a high measured water relative permeability the mechanistic model largely overestimates the experimental data up to a factor of 7 for low relative permeabilities the average relative error is about 2 2 and the standard deviation of the relative error is 2 15 for both sandstones the cross plot of calculated oil relative permeability against the measured oil relative permeability can be represented by the fitted regression line fig 15 with a r squared of 0 95 and 0 99 the cross plot for the three phase oil relative permeability is characterized by two regions for measured oil relative permeability below 0 1 the predicted permeabilities are significantly higher than those observed attaining kr values 10 times or more for measured oil relative permeabilities higher than 0 1 the oil relative permeabilities predicted by the mechanistic model are about 60 and 25 lower than the measured kr values in the case of berea sandstone and bentheimer sandstone respectively however the average relative errors were quantified to 3 25 4 75 for berea sandstone and 1 27 2 78 for bentheimer sandstone respectively the obtained global overestimate of measured oil relative permeabilities is clearly attributed to the weight of the large number of experimental data with oil relative permeabilities lower than 0 1 analyzing the fitted regression line of the cross plot shown in fig 16 one could again conclude that the predicted gas relative permeabilities underestimated the measured data of the berea sandstone and bentheimer sandstone by about 10 and 30 respectively but the average relative error of about 1 69 6 71 quantified for the experimental data of berea sandstone does not give the same conclusion apparently the mechanistic model overestimates the low relative permeabilities measured in the experiment even by factor of 10 and more the large number of data close to the origin does not strongly influence the slope of the regression line but have a strong impact on the average relative error in the case of bentheimer sandstone the maximum relative errors observed for the predicted gas relative permeability do not exceed 1 5 for the extremely low gas relative permeabilities measured in the experiment 4 2 total differential td compatible model 4 2 1 prediction of global mobilities the td compatible model introduced by di chiara roupert et al 2010a 2010b quantifies in the first major step the global mobilities in the ternary diagram by numerical resolution of the laplace equation note that on the three edges of the ternary diagram the global mobilities are prescribed using the known individual phase mobilities in the two phase systems in the td compatible model the global mobility at saturation level s s1 s3 and global pressure p are defined as follows 14 d s k r 1 s d 1 k r 2 s d 2 k r 3 s d 3 where dj and krj denote the mobility and relative permeability of phase j 1 water 2 oil and 3 gas water and oil are supposed to be incompressible fluids while the dynamic viscosities of the fluid phases μj are supposed to be constant and independent of the pressure level variation of gas density ρ3 with gas pressure p3 is taken into account in the computation of gas mobility the phase mobilities are expressed by 15 d 1 1 μ 1 d 2 1 μ 2 d 3 1 μ 3 ρ 3 p 3 ρ 3 1 μ 3 b 3 where ρ 3 is the gas density at reference pressure and b3 is the volume factor in our study we extended the original td compatible model by integrating experimentally based residual saturations of the wetting fluid into two phase systems to numerically integrate the relative permeabilities of the non wetting fluids into the three edges required for complete computation of the global mobilities on the edges we linearly extrapolated the kr values between the experimentally quantified maximum relative permeability of the non wetting fluid krnw max and 1 an illustrative example of the modifications is shown in fig 17 for the oil gas edge of bentheimer sandstone in the following we first discuss the application of the td compatible model to the bentheimer sandstone then use the experimental data available for the berea sandstone to test the prediction of global mobilities using the td compatible model 4 2 1 1 bentheimer sandstone based on the model input parameter outlined in appendix c and the fluid properties and experimental conditions of the ddi flow tests performed on bentheimer sandstone see section 3 1 section 3 2 the two phase relative permeabilities and global mobilities on the three sides of the ternary diagram were quantified as shown in fig 17 to parameterize the required capillary pressure curves in a water oil and oil gas system we used both the model parameters of the water retention curve in the water gas system described in appendix c and the scaling factors βij for the fluid system oil water and gas oil based on the measured interfacial tensions fluid couples gas water oil water and gas oil see table 2 to model the global mobilities on the ternary diagram we used a spatial discretization of 0 01 saturation intervals the simulated global mobilities are shown in fig 17 in form of isovalues ranging from 144 to 53 650 mskg 1 to compare the simulated global mobilities with the experimental data of the three ddi flow experiments a c and d1 we first extracted from our numerical results the global mobilities for the corresponding experimental saturations s1 s2 and s3 the experimental phase mobilities were then determined from eq 15 using the dynamic viscosities table 2 the variation of the volume factor b3 with gas pressure could be considered negligible nevertheless we can infer from the resolution of the global capillary pressure on the ternary diagram that the difference in gas pressure p3 compared to the reference gas pressure of 55 157 atm is very small the minimum gas pressure water summit was approximately 55 161 atm while the maximum gas pressure gas summit was approximately 55 205 atm thus the resulting volume factor of the gas b3 eq 15 varied between 0 99999 and 1 00082 fig 18 shows the comparison of global mobilities predicted by the model and those experimentally determined from ddi experiments a c and d1 apart from ddi experiment d1 the simulated global mobilities strongly overestimate the experimental data the relative error in ddi experiment a is highest with an approximate value of 8 26 9 16 in experiment c re 2 35 1 91 its maximum relative error of 24 is observed for a gas saturation of 0 11 when approaching the gas summit at sg 0 57 the relative error decreases to 1 2 model predictions however are reasonably good in the area where water is under irreducible saturation ddi experiment d1 the td compatible model just slightly overestimates the experimental global mobilities in this case the relative error does not significantly decrease with increasing gas saturation and is quantified to be approximately 0 34 0 18 4 2 1 2 berea sandstone based on the model input parameter outlined in appendix c and the fluid properties and experimental conditions of the ddi flow tests performed on berea sandstone see section 3 2 the two phase relative permeabilities and global mobilities on the three sides of the ternary diagram were quantified as shown in fig 19 to model the global mobilities on the ternary diagram we used a spatial discretization of 0 01 saturation intervals to parameterize the required capillary pressure curves for the water oil and oil gas system we used the model parameters of the capillary pressure curve measured in the water oil system as the irreducible water saturation swi obtained in the two phase flow experiments was higher than that obtained from the capillary pressure curve we used the fit parameters obtained when swi was set to 0 26 we derived the scaling factor βgo required for the fluid system gas oil from the ratio of parameters α quantified in the water oil and oil gas system which was about 1 67 the simulated global mobilities are shown in fig 19 in form of isovalues ranging from 144 to 57 112 mskg 1 the maximum global mobilities determined at the gas summit are about 7 higher than those quantified for the bentheimer sandstone this is due to the maximum capillary pressures measured for berea sandstone at irreducible wetting fluid saturation which are approximately 10 times higher than those of bentheimer sandstone for the same reference pressure of 55 157 atm applied on the rock samples the maximum gas pressures is achieved at the gas summit to 58 908 atm whereas at the water and oil summits the corresponding gas pressures were calculated by the td compatible model to about 55 157 and 55 329 atm respectively thus the compressibility of the gas phase results in a volume factor b3 whose maximum value at the gas summit is about 1 068 however for gas saturations below 0 6 the quantified volume factor b3 was below 1 003 the maximum gas saturation achieved in oak s ddi experiment is below 60 and its effect on the computation of experimental global mobilities see eq 15 can be ignored after extracting the global mobilities corresponding to the experimental data of the seven ddi flow experiments the numerical results were compared with the experimentally determined global mobilities fig 20 the same general trend was observed for bentheimer sandstone the predictions overestimate the observations and with increasing gas saturations the differences become acceptable for low gas saturations up to 30 or 35 the simulated global mobilities strongly overestimate the experimental data by a factor of 2 and more for example in the case of ddi experiment 15 the maximum relative error was quantified to about 8 3 for a measured gas saturation of about 13 whereas for a gas saturation of 59 the relative error decreased to about 0 3 the highest average relative error was quantified for the prediction of global mobilities of experiment 25 re 24 07 31 89 4 2 2 prediction of global mobilities using local experimental data in both test cases the predicted global mobility overestimates the actual physical values to obtain values close to the experimental global mobilities we partially constrained the model of three phase permeabilities respecting the condition of total differential with regard to measurements therefore we implemented the possibility of imposing locally inside the ternary diagram global mobilities derived from experimental data in the interpolation by finite elements c0 the use of other two dimensional interpolation models of global mobilities between the numerical values given at the edges of the ternary diagram such as the lagrange interpolation polynomials was not considered as a very promising improvement over the current interpolation method since the predictions are well above the experimental data in order to constrain our interpolation method we used one third of the experimental data available for the bentheimer and berea sandstone ddi experiments to measure local global mobility uniformly distributed within the ternary diagram the resulting improved global mobilities will then be used based on eq 4 to predict the three phase relative permeabilities water oil gas for bentheimer sandstone and berea sandstone section 4 2 3 4 2 2 1 bentheimer sandstone the improved global mobilities obtained for experiments a c and d1 are shown in fig 18 using locally prescribed mobilities derived from 13 measuring points the relative errors of the simulated mobilities obtained for experiment a c and d1 are significantly reduced but still overestimate the experimental data in the case of experiment a and c the relative error is now approximately 2 30 3 67 and 0 49 0 58 respectively whereas the relative error for the predicted mobilities of experiment d1 becomes very low re 0 07 0 09 note that experiment d1 corresponds to a saturation path where water is at irreducible saturation and thus parallel to the gas oil edge of the ternary diagram 4 2 2 2 berea sandstone the improved global mobilities obtained for experiments 16 17 and 18 are shown in fig 20 using locally prescribed mobilities derived from 34 measuring points the relative errors of the simulated mobilities obtained for experiments 15 20 and 25 are reduced but still largely overestimate the experimental data for example in the case of experiment 16 the relative error is now approximately 0 12 0 30 instead of 2 74 2 67 whereas the average relative error for the predicted mobilities of experiment 20 is also reduced from re 1 94 2 39 to re 0 15 0 32 note that the highest average relative error of simulated global mobilities is still observed in experiment 25 which is however significantly reduced by a factor of approximately 16 re 1 49 3 90 4 2 3 prediction of relative permeabilities in a three phase system the numerical construction of the global capillary pressure p c g is performed by finite elements c1 step 5 described in table 1 using bi laplacian interpolation of the global capillary pressure prescribed on edges ij of the ternary diagram where tangential and normal derivatives of p c g are respectively fixed as dirichlet and neuman boundary conditions appendix e to quantify the global capillary pressure on the ternary diagram we used a spatial discretization of 0 01 saturation intervals based on the td compatibility condition introduced by chavent 2009 two inequalities have to be respected di chiara roupert et al 2010 16 β 13 t p c 12 1 t p c 12 0 β 23 t β 13 t a β 13 t p c 32 t β 12 t β 13 t b where β ij is the global capillary pressure on edges ij of the ternary diagram p c 12 and p c 32 are the capillary pressure in a two phase water oil and gas oil system respectively and t is the saturation parameter varying between zero and one the water fractional flow f1 and gas fractional flow f3 are obtained from the derivatives of the global capillary pressure function pc g and the derivatives of capillary functions p c 12 and p c 32 di chiara roupert et al 2010a 17 f 1 s p p c g s 1 s p d p c 12 s 1 d s 1 1 f 3 s p p c g s 3 s p d p c 32 s 3 d s 3 1 the oil fractional flow f2 is then quantified using the expression 18 f 2 s p 1 f 1 s p f 3 s p using the phase mobilities dj global mobility d and fluid fractional flows fj calculated for a given water saturation s1 and gas saturation s3 the relative permeabilities to water oil and gas are then derived from eq 4 4 2 3 1 bentheimer sandstone the analyses of the two inequalities described by eq 16 are presented in appendix e both conditions are evaluated as functions of t and shown in form of a comparison of three curves fig e2 appendix e while condition b is respected for all saturation parameters t condition a is only satisfied for t 0 78 for t values higher than 0 78 β23 t is higher than β13 t note that the irreducible water saturation swi in the two phase water gas system was quantified to 0 22 here the td compatible model is not applicable for gas saturations higher than 1 swi we therefore modified the numerical approach originally introduced by di chiara roupert et al 2010a instead of solving the biharmonic problem over the entire ternary diagram in our computation we omitted the immobile water zone near the gas summit along this new border the limit value of β13 t 0 78 on each node of the mesh is fixed as known dirichlet boundary value of the global capillary pressure and its corresponding normal derivative belonging to the border the biharmonic problem of step 5 table 1 is solved using hct finite elements at the given experimental global pressure level of p 55 16 atm corresponding to 800 psig in our simulations we used small saturation intervals of 0 005 to produce a sufficiently smooth map of the global capillary pressure function pc g and its two derivatives with respect to s1 and s3 eq 17 once the three maps are calculated the water and gas fractional flows f1 and f3 are then derived using eq 17 fig 21 shows the results of two numerical studies performed a the so called predicted distribution of the global capillary pressure and the derived fractional flows of water and gas b the corresponding simulated distributions when using 13 local experiments based on water and gas fractional flows the 13 local points selected are the same points as in the previous global mobilities studies while on the three edges of the ternary diagram and their neighborhood the water and gas fractional flows reflect the prescribed physical values of the two phase systems in the ternary diagram however they appear as zones of unphysical values when approaching the water summit the water fractional flows exceeds locally the maximum value of 1 and simultaneously the gas fractional flow is below 0 a similar effect but more pronounced in form of an elongated bump is observed for the distribution of the gas fractional flow when approaching the gas summit the gas fractional flows largely exceed the physical upper limit of 1 while the water gas fractional flow become locally negative it is worth noting here that the distribution of pc g is not significantly modified when using locally prescribed water and gas fractional flows observing closely pc g differs only locally in the neighborhood of the 13 fitting points at maximum by about 35 pa and is thus not visible in the chosen colormap of pc g however the maps of f1 and f3 are locally adjusted to the physical conditions of the ddi experiments which is visible in fig 21b this helped to locally reduce the height of the bump of f3 therefore and to be consistent with the improvement achieved in the case of global mobilities the numerical results obtained with modeling approach b were further considered the relative permeabilities to water oil and gas are then obtained from the td compatible model using eq 4 fig 22 shows the comparison of relative permeabilities measured from experiment c with those predicted by the td compatible model the detailed comparison of predicted kr values water oil gas for experiments a and d1 with those experimentally measured is documented in appendix e figs e3 and e4 in view of the fact that f2 is derived from f1 and f3 according to eq 18 it is not surprising that the majority of the predicted relative permeabilities of oil is not physical the high positive value of crm also indicates that the td compatible model largely underestimates the measurements as the water and gas fractional flows predicted for ddi experiment c are mostly positive we can use both global mobilities and fractional flows to compare the measured water relative permeabilities and gas relative permeabilities with those predicted the predicted water relative permeabilities largely overestimate the measured values in addition in the case of experiment c the tendency of decreasing water relative permeabilities with increasing water saturation is not consistent with the laws of physics however in the case of experiment a fig e3 the predicted positive water relative permeability increases with water saturation the prediction of gas relative permeabilities is rather acceptable with the td compatible model as shown in figs 22 e3 and e4 the predicted gas relative permeabilities increase with gas saturation but still overestimate the experimentally measured values by a factor of approximately 1 5 to 2 4 2 3 2 berea sandstone the analyses of the two inequalities described by eq 16 are presented in appendix e both conditions are evaluated as functions of t and shown in form of a comparison of three curves fig e5 while condition b is respected for all saturation parameters t condition a is only satisfied for t 0 62 for t values higher than 0 62 β23 t is higher than β13 t note that the irreducible water saturation swi in the two phase water gas system was quantified to 0 38 here the td compatible model is not applicable for gas saturations higher than 1 swi we then applied the same choices for this inner boundary close to the gas summit and solved the biharmonic problem of step 5 table 1 as described in section 4 2 3 1 fig 23 illustrates the results of calculated distribution of the global capillary pressure and the derived fractional flows of water and gas using 34 local experiment based water and gas fractional flows the chosen 34 local points are the same as in the previous global mobilities studies here the global capillary pressures prescribed along the three edges of the ternary diagram vary between 20 000 and 15 000 pa due to the high capillarity of berea sandstone compared to bentheimer sandstone the difference between the minimum and maximum value of pc g is approximately ten times higher than in the previous study in contrast to fig 21 the obtained distribution shows a strong local decrease of pc g funnel shaped in the middle of the ternary diagram this results in high negative values of gas fractional flow in addition as already observed for the bentheimer sandstone an elongated bump along the water gas side appears when approaching the gas summit the calculated distribution of water fractional flow is smoother than in the case of bentheimer sandstone however the physical upper limit of 1 is exceeded with a maximum value of 1 7 in regions along the water gas side and close to the water summit since the quantified gas fractional flows are significantly below or above the physical limits of 0 and 1 respectively a further interpretation of the gas fraction in terms of gas relative permeabilities is not possible therefore as in the case of bentheimer sandstone the relative oil permeabilities in the three phase system is not likely to be determined the only possible interpretation is therefore limited to the quantification of relative water permeabilities using eq 4 as the water fractions determined represent physical values except for a small area in the diagram the calculated water relative permeabilities are compared with the experimental data of ddi experiments 15 fig 24 and experiments 18 fig 25 the detailed comparison of predicted water relative permeabilities for experiments 16 17 19 and 25 with those experimentally measured is documented in appendix e figs e6 and e7 generally the measured water relative permeabilities are largely overestimated by the td compatible model the majority of the predicted values clearly exceed the physical upper limit of 1 which is mainly due to the water fractional flow determined some of which are two orders of magnitude higher than the experimental fractional water flows this is clearly shown for example in the case of ddi experiment 15 fig 24 in this case the physical upper limit of the water fractional flow of 1 is not exceeded but the water relative permeability clearly exceeds the maximum value of 1 for example at a water saturation of 0 32 the water fractional flow is about 0 182 which highly overestimates the experimental value f1 0 and the calculated ratio of global mobility to water mobility d d1 is about 27 the product of f1 and d d1 then gives the high physically unrealistic numerical value of 4 92 for water relative permeability as shown in fig 24 the predicted ratios of global mobility to the water mobility are relatively close to the experimentally determined ratios in the case of experiment 18 the predicted water relative permeabilities are obviously below 1 but in addition as in the other ddi experiments the experimentally determined water relative permeabilities are clearly exceeded fig 25 the residual mass coefficient crm calculated here is 439 which clearly demonstrates the overestimation of the measured values it should be noted that the global mobilities estimated are rather similar to the measured values 4 3 parker lenhard model 4 3 1 application to bentheimer sandstone table 8 summarizes the model input parameters used for the application of the parker lenhard model to the bentheimer sandstone they were obtained by nonlinear fit of the van genuchten 1980 model to alizadeh s capillary pressure curve measured for soil sample b in a water gas system r squared cod 0 986 or by nonlinear fit of the mualem van genuchten model to alizadeh s experimental water relative permeability water saturation curve r squared 0 994 see appendix f 1 note in the latter case m was the only fit parameter as the irreducible water saturation swi was fixed and taken equal to the experimentally determined value fig 26 shows the comparison of relative permeabilities measured from experiment c with those predicted by the parker lenhard model for both modeling options the detailed comparison of predicted kr values water oil gas for experiments a and d1 with those measured by alizadeh 2013 is documented in appendix f globally the relative permeabilities to water oil and gas predicted with both modeling options overestimate the measured kr values fig 26 annexe f figs f2 and f3 the best prediction of the water relative permeability is achieved with option kr s which results in lowest rmse values and smallest negative coefficients of residual mass crm note that in the case of experiment d1 which is conducted at irreducible water saturation both modeling options satisfactorily predict the measured water relative permeabilities the oil relative permeabilities predicted by modeling option pc s still overestimate the experimental data but are generally closer to the measured kr values than modeling option kr s surprisingly the measured gas relative permeabilities are strongly overestimated by both modeling options as shown in figs 26 f 2 and f 3 the predicted relative permeabilities to gas are rather close to each other and overvalue the experimentally quantified permeabilities also for experiment d1 by a factor of 2 to 3 this is even surprising as the oil relative permeability for experiment d1 is satisfactorily predicted by both modeling options 4 3 2 application to berea sandstone table 9 summarizes the model input parameters used for the application of the parker lenhard model to the berea sandstone they were obtained by nonlinear fit of the van genuchten 1980 model to oak s capillary pressure curve measured for soil sample 6 in a water gas system r squared cod 0 995 or by nonlinear fit of the mualem van genuchten model to oak s experimental water relative permeability water saturation curve r squared 0 972 see appendix f 2 note in the latter case m was the only fit parameter as the irreducible water saturation swi was fixed and taken equal to the experimentally determined value the numerical results obtained for the berea sandstone are shown in fig 27 and in appendix f2 globally using modeling option kr s the relative permeabilities for water oil and gas are overestimated by both modeling options modeling option pc s underestimates the measured water relative permeabilities and except for experiments 19 and 25 also the oil relative permeability whereas the gas relative permeability is globally overestimated the water and gas relative permeabilities predicted by modeling option kr s are closer to the measured kr values than with modeling option pc s as underlined by the rmse values however the oil relative permeabilites are better predicted with modeling option pc s than with modeling option krw as shown in fig 27 in the case of experiment 15 modeling option pc s strongly overestimates the measured gas relative permeability whereas the oil relative permeability is underestimated by the modeling approach in the latter case here a better prediction with lower rmse is obtained than with modeling option kr s the quantified coefficient of residual mass crm also indicates that the measured values are only slightly underestimated whereas a strong overestimation is observed with option kr s the detailed comparison of predicted kr values water oil gas for experiments 16 20 25 with those measured by oak 1990 is documented in appendix f 4 3 3 global analysis of predicted three phase relative permeabilities for further investigation of the accuracy of the model the three phase relative permeabilities predicted by the model for each fluid phase are plotted against the measured relative permeabilities obtained for berea and bentheimer sandstone figs 28 30 each figure also contains a description of the quantified relative error as a function of the measured relative permeability in the three phase system in the case of berea sandstone as shown by the cross plot fig 28 the water relative permeability is reasonably well predicted by model option kr s globally it slightly overestimates the measured kr values characterized by a relative error of about 0 13 0 72 it is worthwhile to note that for relative permeabilities higher than 0 04 the predicted values closely approaches the measured relative permeabilities however model option pc s strongly underestimates the measured water relative permeabilities re 0 96 0 02 for the whole set of experimental data in the case of bentheimer sandstone model option kr s also seems as the better option to predict the measured water relative permeabilities here both options overestimate the experimental data re 0 85 1 85 kr s re 4 72 3 86 pc s the deviation from the 1 1 line is high for measured water relative permeabilities lower than 0 01 in the case of modeling option pc s the maximum relative error achieves values higher than 15 the oil relative permeabilities predicted for the berea sandstone fig 29 show the same general trend as observed for the water relative permeabilities modeling option kr s overestimates and modeling option pc s underestimates the measured relative oil permeabilities however here modeling option kr s strongly overestimates the experimental data characterized by a large spreading around a high mean relative error re 12 59 15 65 whereas modeling option pc s seems to be the best option for predicting the experimental data re 0 16 0 90 even if the deviation from the 1 1 line increases with increasing measured oil relative permeabilities in the case of bentheimer sandstone both modeling options again overestimate the measured oil relative permeabilities re 7 01 15 66 kr s re 3 80 7 59 pc s it is worth noting here that the deviation of predicted oil relative permeabilities from the experimental data is also high for very low oil relative permeabilities 0 01 they attain maximum relative errors of up to 80 and 40 for modeling option kr s and modeling option pc s respectively globally the best results are obtained with modeling option pc s it satisfactorily predicts the experimental data as shown by the small deviations from the 1 1 line when the measured relative permeabilities exceed 0 05 using the parker lenhard model the gas relative permeabilities predicted for berea sandstone and bentheimer sandstone strongly overestimate the measured gas relative permeabilities fig 30 the relative errors of the prediction are quantified to 5 64 17 16 kr s and 38 75 128 63 pc s for berea sandstone and 3 16 3 29 kr s and 4 41 5 41 pc s for bentheimer sandstone respectively as already mentioned before the maximum relative errors appear for very low relative permeabilities 0 01 in the case of berea sandstone the maximum relative errors attain values of 1000 option kr s and 100 option pc s whereas for bentheimer sandstone achieve values of about 26 option kr s and 14 option pc s even for higher relative permeabilities measured for both sandstones the predicted gas relative permeabilities overestimate globally the experimental data at least by a factor of 2 4 4 stone s model i the numerical simulations performed with stone s model i concern only the oil relative permeability in a three phase system table 10 summarizes the model input parameter used for the application of stone s model i to the bentheimer sandstone and berea sandstone they were obtained by nonlinear fit of the mualem van genuchten model van genuchten 1980 to the experimental two phase gas oil oil water relative permeability saturation curves measured for bentheimer sandstone alizadeh 2013 and berea sandstone oak 1990 see tables c1 and c2 4 4 1 application to bentheimer sandstone fig 31 shows the comparison of predicted oil relative permeability versus oil saturation with those measured in ddi experiments a c and d1 alizadeh 2013 here the average model prediction errors are acceptable the rmse values vary between 0 0108 experiment a to 0 0218 experiment c surprisingly the oil relative permeabilities measured in experiments c and d1 are reasonably well predicted by stone s model i here the coefficients of residual mass crm range between 0 685 and 0 103 in the case of experiment a stone s model overestimates globally the measured oil relative permeability by up to a factor of 4 to 8 at oil saturations close to the residual oil saturation 4 4 2 application to berea sandstone fig 32 shows the comparison of predicted oil relative permeability versus oil saturation with those measured in ddi experiments 15 20 and 25 oak 1990 the agreement of the predicted relative oil permeabilities with the measurement results is relatively good for experiments 15 16 17 and 20 larger deviations are observed especially in experiments 19 and 25 the reason for the strong underestimation of the measured oil permeabilities crm 1 is that the stone i model sets the relative permeabilities for all oil saturations smaller than the residual saturations sor 0 259 to zero 4 4 3 cross plot of oil relative permeabilities predicted by stone s model i against the experimental three phase kr values measured on berea and bentheimer sandstone for further investigation of the accuracy of stone s model i the three phase oil relative permeability predicted by the model is plotted against the experimental oil relative permeability measured for berea and bentheimer sandstone fig 33 the figure also contains a description of the quantified relative error as a function of the measured oil relative permeability in the three phase system in the case of berea sandstone as shown by the cross plot fig 33 the oil relative permeability is reasonably well predicted by stone s model i globally it slightly underestimates the measured kr values characterized by a relative error of about 0 31 1 07 the highest relative errors are observed for very low oil relative permeabilities attaining a maximum relative error of about 4 at a measured relative permeability of 0 01 it is worthwhile to note that for relative permeabilities higher than 0 3 the predicted values closely approaches the measured relative permeabilities here the scatterplot of predicted kr values against the measured data can be described by a linear regression r squared 0 966 whose slope is close to one the oil relative permeabilities predicted for bentheimer sandstone show a different behavior than berea sandstone here the simulation based on stone s model i significantly overestimates the measured relative oil permeabilities with a high average relative error and an associated large variance re 1 74 2 68 just as the berea sandstone the maximum relative errors appear at low values of measured oil relative permeability however for higher values of experimental relative permeability for example above 0 2 the predicted oil relative permeabilities systematically underestimate the measured values by about 25 and are well described by the fitted straight line of linear regression r squared 0 987 5 discussion 5 1 global analysis of predicted three phase relative permeabilities for further evaluation of the accuracy of the 4 different models used to predict three phase relative permeabilities measured in ddi experiments conducted on bentheimer and berea sandstones the relative errors re identified in the previous section are summarized in table 11 individually for each fluid phase in the following the main results presented in table 11 will be discussed with respect to each of the three phase relative permeabilities 5 1 1 three phase water relative permeability in the case of berea sandstone the water relative permeability is reasonably well predicted by the mechanistic model globally it slightly overestimates the measured kr values nonetheless for the bentheimer sandstone the predicted water relative permeabilities varies significantly from the experimental measurements except for a high measured water relative permeability the mechanistic model largely overestimates the experimental data up to a factor of 7 for low relative permeabilities the average relative error is about 2 2 and the standard deviation of the relative error is 2 15 the td compatible model provided quantifiable results on water relative permeabilities the water relative permeabilities measured on both bentheimer sandstone and berea sandstone are highly overestimated by the td compatible model with the corresponding relative errors being very large using the parker lenhard model the water relative permeability measured for the berea sandstone was reasonably well predicted by model option kr s globally it slightly overestimates the measured kr values it should be noted that for relative permeabilities higher than 0 04 the predicted values closely approaches the measured relative permeabilities however model option pc s strongly underestimates the measured water relative permeabilities for the entire set of experimental data in the case of bentheimer sandstone model option kr s also seems the better option to predict the measured water relative permeabilities in this case both options overestimate the experimental data in the case of modeling option pc s the maximum relative error achieves values higher than 15 5 1 2 three phase oil relative permeability using the mechanistic model the predicted oil relative permeabilities are partially acceptable for measured oil relative permeability below 0 1 the predicted permeabilities are significantly higher than those observed attaining kr values 10 times or more for measured oil relative permeabilities higher than 0 1 the oil relative permeabilities predicted by the mechanistic model are about 60 and 25 lower than the measured kr values in the case of berea sandstone and bentheimer sandstone respectively however the relative errors were quantified to 3 25 4 75 for berea sandstone and 1 27 2 78 for bentheimer sandstone respectively the obtained global overestimate of measured oil relative permeabilities is clearly attributed to the weight of the large number of experimental data with oil relative permeabilities lower than 0 1 the oil relative permeabilities predicted for the berea sandstone using the parker lenhard model show similar trend as those for the water relative permeabilities modeling option kr s overestimates and modeling option pc s underestimates the measured relative oil permeabilities however here modeling option kr s strongly overestimates the experimental data characterized by a large spreading around a high mean relative error whereas modeling option pc s seems as the best option for predicting the experimental data in the case of bentheimer sandstone both modeling options again overestimate the measured oil relative permeabilities it should be noted here that the deviation of predicted oil relative permeabilities from the experimental data is also high for very low oil relative permeabilities 0 01 they attain maximum relative errors of up to 80 and 40 for modeling option kr s and modeling option pc s respectively globally the best results are obtained with modeling option pc s it was shown that in the case of berea sandstone the oil relative permeability is reasonably well predicted by stone s model i globally it slightly underestimates the measured kr values the highest relative errors are observed for very low oil relative permeabilities attaining a maximum relative error of about 4 at a measured relative permeability of 0 01 the oil relative permeabilities predicted for bentheimer sandstone show a different behavior than berea sandstone here the simulation based on stone s model i significantly overestimates the measured relative oil permeabilities with a high average relative error and an associated large variance just as the berea sandstone the maximum relative errors appear at low values of measured oil relative permeability 5 1 3 three phase gas relative permeability using the mechanistic model the predicted gas relative permeabilities underestimated the measured data of the berea sandstone and bentheimer sandstone by about 10 and 30 respectively but the average relative error of about 1 69 6 71 quantified for the experimental data of berea sandstone does not provide the same conclusion apparently the mechanistic model overestimates the low relative permeabilities measured in the experiment even by factor of 10 and more in the case of bentheimer sandstone the measured gas relative permeabilities are well represented by the model predictions the maximum relative errors do not exceed 1 5 for the extremely low gas relative permeabilities measured in the experiment the td compatible model provided only reliable predictions for the bentheimer sandstone the difficulties described in section 4 2 the very high capillarity of berea sandstone poses problems in the interpolation of the global capillary pressure and its derivatives with respect to water saturation s1 and gas saturation s3 using the parker lenhard model the gas relative permeabilities predicted for berea sandstone and bentheimer sandstone strongly overestimate the measured gas relative permeabilities the maximum relative errors are observed for very low relative permeabilities 0 01 in the case of berea sandstone the maximum relative errors attain values of 1000 option kr s and 100 option pc s whereas for bentheimer sandstone values of about 26 option kr s and 14 option pc s are achieved even for higher relative permeabilities measured for both sandstones the predicted gas relative permeabilities overestimate the experimental data globally by at least a factor of 2 5 2 existence of elliptic zones in the ternary diagram the existence and importance of elliptic zones in a water oil napl gas ternary diagram when using the mechanistic model will be discussed in appendices g 4 and g 5 the results obtained with the parker lenhard model and stone s model i are presented the percentage of saturation space covered by elliptic regions quantified for the three models are summarized in table 12 it should be noted that the three fluid saturations in the ternary diagram range from 0 to 1 few authors used effective saturations in their studies e g jackson and blunt 2002 the starting point is the mass conservation equation for an incompressible immiscible three phase flow which can be written in terms of two saturation equations for water α 1 and gas phases α 3 eq g2 appendix g in the case of zero capillary pressure the dimensionless system of saturation equations can be linearized in terms of two saturation gradients involving a jacobian matrix j as follows 19 t d s 1 3 j z d s 1 3 0 with j f 1 s 1 f 1 s 3 f 3 s 1 f 3 s 3 where zd and td are the dimensionless distance and time appendix g f 1 and f 3 are fractional flow functions of water and gaz respectively defined as 20 f 1 λ 1 λ t 1 n g ρ d 1 k r 2 ρ d μ 2 μ 3 k r 3 21 f 3 λ 3 λ t 1 n g ρ d μ 2 μ 1 k r 1 k r 2 with the gravity number n g k ρ 2 ρ 3 g μ 2 v t o t ρ d ρ 1 ρ 3 ρ 2 ρ 3 is the density ratio λα is the phase mobility and λ t is the total mobility defined as λ t α k r α μ α eigenvalues u d of the jacobian matrix j can then be expressed as follows 22 u d 1 2 f 1 s 1 f 3 s 3 f 1 s 1 f 3 s 3 2 4 f 1 s 3 f 3 s 1 the corresponding partial derivatives of fractional flow functions f 1 and f 3 are detailed in appendix g to compute elliptic regions that provide numerical instabilities we analyzed the sign of the square root argument of eq 22 within the ternary diagram a large set of fluid saturations was studied in order to display complex eigenvalues that correspond to a negative square root argument to validate our search algorithm of negative square root arguments of eq 22 we first used the model of bell and compared the identified elliptic zones with those quantified by jahanbakhshi et al 2013 appendix g 3 furthermore the influence of gravity and total velocities on the extent of elliptic zones are synthetically discussed in appendix g 5 2 1 bentheimer sandstone the fluid properties of experiments conducted on bentheimer sandstone table 2 the intrinsic permeability of the rock k 2 63 10 12 m2 and the quantified characteristic coefficients aij summarized in table 7 of the three modeling options a c and ac were used to study the possible existence of elliptic zones in the ternary diagram in a first modeling step gravity effects were neglected the results obtained for options a c and ac are shown on the left side of fig 34 in all three modeling options there is a very small elliptic zone on the water oil side with a percentage area of less than 1 the double dependency on water and gas saturation as in stone s model has often been pointed as proof for the existence of an elliptic zone modulo with certain constraints on viscosities trangenstein 1989 jackson and blunt 2002 here the elliptic region however is a narrow zone located near the water oil edge with gas saturations below 5 while the oil saturations range between 50 and 80 to study the influence of gravity on the extent and distribution of elliptic zones in the ternary diagram we used a series of total velocities which are in the range of total velocities applied in alizadeh s ddi experiments in all modeling options when the total velocity is equal to 1 5 10 4 ms 1 the area of the elliptic zone represents less than 1 of the total area of the ternary diagram however the further decrease of the total velocity significantly alters the area and form of the elliptic zone for example in modeling option c the elliptic zones are significantly larger with almost 30 of the total surface for a velocity that is ten times lower note that all three models are characterized by the occurrence of elliptic regions where the directions associated with the eigenvectors coincide for a velocity that is one hundred times lower the elliptic zone will again become smaller and occupy only 10 of the total area of the ternary diagram table 12 modeling option c seems to generate larger elliptic zones located near the water gas side than options a and ac particularly when water saturation is greater than 50 in modeling option a the elliptic zone appearing for a total velocity of 1 5 10 5 ms 1 is nearly the same as in modeling option ac it represents about 20 of the total surface of the ternary diagram just as option c with decreasing total velocity the elliptic zones are smaller for a velocity that is ten times lower the occupied surface attains about 15 of the total surface it should be noted that the use of the mechanistic model leads to a plurality of elliptical zones which was not the case when using bell s model fig g2 appendix g or was not observed in the jackson and blunt 2002 experiments on a pore scale model manufactured with a bundle of cylindrical capillary tube the number of elliptic zones between two and three is a function of the total velocities and is located in very different sectors of the ternary diagram note that in the case of very low total velocities corresponding to high gravity numbers of 5 a large fraction is found in the region of irreducible water saturation 5 2 2 berea sandstone a second study on the existence of elliptic zones was conducted with the mechanistic model using the experimental data of the berea sandstone table 3 and the intrinsic permeability of the rock k 1 97 10 13 m2 the quantified characteristic coefficients aij summarized in table 5 were used to study the possible existence of elliptic zones in the ternary diagram the results of the study are presented in fig 35 with the reference case without gravity in the absence of gravity elliptic zones are almost nonexistent compared to the zones identified for the bentheimer sandstone fig 34 significant elliptic regions appear only for total velocities lower than 2 10 5 ms 1 by decreasing the total velocity the percentage area of saturation space covered by elliptic regions progressively increases up to about 42 at a total velocity of 5 10 6 ms 1 a further decrease in total velocities will lead to a continuous reduction in the percentage area occupied by the elliptic regions which becomes stable around 10 for total velocities between 1 5 10 7 and 1 5 10 8 ms 1 fig 35 table 12 summarizes the percentage area covered by elliptic regions for total velocities of 1 5 10 5 1 5 10 6 and 1 5 10 7 ms 1 which are in the range of total velocities applied in oak s ddi experiments it is worth noting that for gravity numbers lower than 0 5 the elliptic region is located at the water summit and forms a single patch increasing the gravity number will lead to an increase in the elliptic region accompanied by a separation of the single patch in two or more sub areas up to a gravity number of about 1 11 corresponding to a total velocity of about 9 10 6 ms 1 the saturation space covered by elliptic zones is mainly located in the ternary diagram where water is mobile the main part of the elliptic region is situated above the gravity number 3 3 in an irreducible water zone 6 conclusions and future work in this study two recent and two classical models were evaluated against experimentally measured three phase permeabilities experimental data generated on two different water wet sandstones were selected from the literature to evaluate and compare the four mathematical models experimentally determined constitutive relationships in two phase systems were used as input parameters to numerically predict relative permeabilities kr in three phase systems and then the estimated results were compared with experimental three phase permeabilities measured along decreasing water saturation decreasing oil saturation increasing gas saturation ddi paths 6 1 which models yield results that best match flow experiments globally the best prediction of the measured kr values was obtained with the mechanistic model of shahverdi and sohrabi 2017 however its implementation requires a preliminary calibration of the relative phase permeabilities in a three phase system against experimental data along one ddi path to quantify the required six characteristic coefficients our study showed that the parker lenhard model provides very different predicted kr values that are strongly dependent on the method used to determine the van genuchten parameter m globally the oil relative permeabilities predicted for the berea sandstone using the parker lenhard model shows the same general trend as observed for the water relative permeabilities modeling option kr s overestimates and modeling option pc s underestimates the measured relative oil permeabilities furthermore using the parker lenhard model the gas relative permeabilities predicted for berea sandstone and bentheimer sandstone are significantly higher than the measured gas relative permeabilities in the case of berea sandstone the oil relative permeability is reasonably well predicted by stone s model i nevertheless the oil relative permeability expected for bentheimer sandstone indicates a different behavior than berea sandstone in this case the simulation based on stone s model i significantly overestimates the measured relative oil permeabilities with a high average relative error and an associated large variance just as the berea sandstone the maximum relative errors appear at low values of measured oil relative permeability for the first time the td compatible model has been applied to detailed experimental three phase data our study showed that the global mobilities predicted by c0 finite element interpolation significantly overestimate the experimentally quantified global mobilities prediction improved when experimental data were used to locally impose the global mobility our numerical study also revealed weaknesses in the td compatible model the main issue is the fulfillment of the required condition of fractional flows of water oil and gas predicted by the pde td interpolation algorithm which should be bounded by the physical limits of 0 and 1 everywhere in the ternary diagram this condition was respected in the case of negligible residual wetting phase saturation low capillary porous medium and smooth variations of associated capillary pressure gradients as shown in the study of di chiara et al 2010 in our case however it appears that the very high capillarity of both the bentheimer and berea sandstones contributes to numerically interpolated water and gas fractional flows in the ternary diagram that locally fall below the physical lower limit of 0 and exceed its upper limit of 1 this in turn leads to negative oil fractional flow and thus results in unphysical oil relative permeabilities 6 2 what input data do the models require and how burdensome are these requirements the least request of input data is required when using the parker lenhard model and stone s model i the parker lenhard model requires only van genuchten parameter m and the irreducible wetting fluid saturation to model the three phase relative permeabilities of water oil and gas to quantify the oil relative permeability in a three phase fluid system stone s model i uses as input data the oil relative permeabilities in the two phase gas oil and oil water systems the irreducible water saturation and residual oil saturation the use of the mechanistic model to predict three phase relative permeabilities requires not only three two phase relative permeabilities but also six coefficients that presumably take into account the interaction between various fluids as well as fluid saturation distributions it should be noted that at least one set of experimental three phase relative permeability data for one saturation path for all three fluids is required to tune these characteristic coefficients to reduce the degree of uncertainty shahverdi and sohrabi 2017 suggested employing more measured data of three phase relative permeabilities for calibration of the six characteristic coefficients in the case of bentheimer sandstone using two experimental data sets instead of one for tuning the characteristic coefficients only slightly improved the predicted kr values the use of different input data sets also revealed the absence of a unique solution for the calibration of these six characteristic coefficients this resulted in different qualities in the subsequent prediction of the relative permeabilities to predict three phase relative permeabilities using the td compatible model the user requires more input data than the other three models it requires detailed information of the dynamic viscosities of the three fluid phases the variation of gas density as a function of the gas pressure as well as the two phase relative permeabilities and capillary pressures known on the edges of the ternary diagram since capillary pressure curves are not always available for all two phase fluid pairs involved in flow experiments at least the water retention curve measured in the water gas system is required the scaling approach parker et al 1987 based on the interfacial tensions of the two phase gas water gas oil and oil water systems may be used to parameterize the required capillary pressure curves in a water oil and oil gas system 6 3 what are the models computational requirements both in deriving three phase relative permeability functions and in using them in a flow simulator the most computational effort to assess three phase relative permeabilities is required for the td compatible model the predicted three phase relative permeabilities and global capillary pressures satisfy a so called total differential td compatibility condition which guarantees strict hyperbolicity of the reformulated system chavent and jaffré 1986 boundary conditions for global capillary pressure and global mobility are required such that the corresponding three phase data are consistent with a given set of three two phase data the numerical construction of global capillary pressure and global mobility functions by c1 and c0 finite element is performed using bi laplacian and laplacian interpolation the td compatibility condition required for the two phase data sets prescribed on the three edges of the ternary diagram is a nonlinear constraint on weighted means of the given two phase relative permeability data set this presents a certain weakness of this model in contrast to its strength of being free of elliptic zones in the saturation space it should be emphasized that the three phase data obtained with the td compatible model allow the three phase compressible global volumetric flow equation to be rewritten in a more suitable fractional form the gradient of capillary pressure coupling terms are eliminated from the formula for the global volumetric flow chavent 2009 this may lead to a more efficient computing time compared to traditional pressure saturation models the mechanistic model uses an arithmetic averaging relationship between two phase and three phase permeabilities here the user must first tune the six characteristic coefficients using for example a commercial tool once quantified the estimated characteristic coefficients can then be easily implemented in any flow simulator to model three phase relative permeabilities for any other saturation path the least numerical effort to build up three phase relative permeabilities is required for the parker lenhard model and stone s model i in both cases the mathematical functions using the two phase relative permeabilities of water and gas as input data can be directly implemented in flow simulators which is already the case for commercial flow simulators e g mofat us epa 1991 eclipse schlumberger 2015 for simulation of three phase flow it is noteworthy here that numerical issues may occur with stone s model i when normalized water and gas saturations achieve high values close to the physical upper limit of 1 6 4 which models admit elliptic regions in saturation space to assess the presence of potential elliptic zones in our study we tested the mechanistic model the parker lenhard model and stone s model i in the case of bentheimer and berea sandstones all three models admit elliptic zones gravitational effect causes multiple elliptic zones that depend on the total flux applied to the rock samples the percentage area of elliptical zones in the ternary diagram quantified for stone s model i was the highest and supports the results previously reported in the literature our numerical results showed that the parker lenhard model produces a higher percentage area of elliptic zones than the mechanistic model note that in our study we neglected the capillarity of the porous media which may dim the extent of potential elliptic zones as complete datasets on capillary pressure saturation curves are available for both sandstones it could be interesting to implement the effect of capillarity in the evaluation of elliptic zones under the given experimental conditions in the case of the td compatible model our study revealed that the interpolation of the global capillary pressure and its derivatives exposes unphysical fractional phase flows the total differential compatible approach will not be verified everywhere within the ternary diagram this could also be an indication of existing elliptic regions to build up a more robust td compatible modeling approach and to obtain reliable physical values of predicted fractional flows in the 3 phase ternary diagram further research steps are needed i to overcome the problem of overestimated global mobilities a more promising solution could be used to solve the poisson s equation instead of the laplace equation since the poisson s equation is the inhomogeneous equivalent form of laplace s equation the associated spatially variable source function could be quantified by an inverse modeling approach using a limited number of pilot points on experiment based global mobilities uniformly distributed in the ternary diagram a non linear least square method may be used to minimize the objective function of the inverse problem ii a similar inverse modeling approach could be used to improve the interpolation of the global capillary pressure pc g and its spatial derivatives on the ternary diagram step 5 of the pde td interpolation algorithm table 1 could be replaced by solving the inhomogeneous biharmonic equation here the pilot points could include the experiment based fractional water and gas flows and therefore reprocessed into spatial derivatives of pc g with respect to s1 and s3 using eq 17 in our study measurements of three phase relative permeabilities along ddi paths were compared with those predicted from four mathematical models an open question is still the goodness of predicted relative permeabilities when increasing both the water and oil flux and decreasing the gas flux this may also be part of further research work in addition while not yet considered in this work it would be interesting to assess the relative skills of the models tested as described by e g ranaee et al 2016 using model identification criteria this could be a way to take into account the complexity of a given model at least in terms of the number of parameters involved and possibly also considering the level of uncertainty associated with parameter estimates through the estimation of the covariance matrix as an additional benefit the use of these criteria yield the probability posterior probability conditional on the number of available data associated with a given model eventually leading to a multi model framework further studies could also focus on the parameter identification as shown in the work of ranaee et al 2017 data availability statement the data that support the findings of this study are available from the corresponding author upon reasonable request credit authorship contribution statement gerhard schäfer conceptualization methodology investigation software writing original draft raphaël di chiara roupert investigation formal analysis software writing review editing amir h alizadeh formal analysis validation data curation writing review editing mohammad piri resources data curation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this research was granted from january to august 2019 by the french american fulbright commission and the institute of international education council for international exchange of scholars iie cies us department of state gerhard schäfer is also grateful for the financial support by the university of strasbourg during his sabbatical leave at the center of innovation for flow through porous media university of wyoming and the administrative and technical support by the university of wyoming appendix a two phase constitutive relationships used in the study a 1 capillary pressure curves in two phase systems water gas water oil and oil gas the van genuchten 1980 model uses a simple analytical expression to describe the capillary pressure curves in a two phase water gas system the capillary pressure pcgw pa as function of the effective saturation of the wetting fluid phase water is described by a1 p c g w 1 α s w e 1 m 1 1 m with m 1 1 n where α pa 1 and n are empirical parameters parameter n controls the curvature of the pc s function α quantifies the level of the plateau of the capillary pressure the effective saturation swe of the wetting fluid phase is defined by a2 s w e s w s w i s m a x s w i where swi is the irreducible saturation of the wetting fluid phase here water and sm ax is the maximum saturation of the wetting fluid phase during drainage of the porous medium water is displaced for example by gas or by a napl the maximum saturation smax is equal to 1 on the other hand when gas or a napl is displaced by water in the case of imbibition sm ax is limited to values lower than 1 because the non wetting fluid phase will remain in the porous medium at residual saturation snwr the maximum water saturation is therefore complementary to the residual saturation of the non wetting fluid phase sm ax 1 sgr sm ax 1 sor in three phase systems for the interfaces oil water and gas oil the capillary pressures pcow and pcgo are generally calculated from relation a1 by applying a scaling approach based on the interfacial tensions of the two phase system gas water gas oil and oil water parker et al 1987 a3 p c o w s w e 1 β o w p c g w s w e where water is the wetting fluid phase a4 p c g o s w e 1 β g o p c g w s w e where oil is the wetting fluid phase β o w σ g w 0 σ o w and β g o σ g w 0 σ g o are the scaling factors for the fluid system oil water and gas oil σ g w 0 σ ow and σ go are the interfacial tension of fluid couples gas water oil water and gas oil a 2 relative permeabilities in two phase systems water gas water oil and oil gas in a two phase water gas system using a modified mualem van genuchten mvg approach with a maximum value of the nonwetting fluid phase here gas the relative permeabilities are defined as a5 k r w s w e 1 1 s w e 1 m w g m w g 2 k r g k r g w m a x 1 s w e 1 s w e 1 m g w 2 m g w where krgw max is the maximum relative gas permeability achieved at irreducible water saturation swi in the gas water system mwg and mgw correspond to the mvg parameter for water and gas respectively in a two phase water oil system the relative permeabilities are then written as follows a6 k r w s w e 1 1 s w e 1 m w o m w o 2 k r o w k r o w m a x 1 s w e 1 s w e 1 m o w 2 m o w where krow max is the maximum relative oil permeability achieved at irreducible water saturation swi in the water oil system mwo and mow correspond to the mvg parameter for water and gas respectively in a two phase oil gas system the corresponding relative permeabilities can be expressed by a7 k rg k rgo max 1 s oe 1 s oe 1 m go 2 m go k rog s oe 1 1 s oe 1 m og m og 2 where krgo max is the maximum relative gas permeability achieved at residual oil saturation in the oil gas system sor mog and mgo correspond to the mvg parameter for oil and gas respectively here soe is the effective oil saturation defined by a8 s o e s o s o r 1 s o r and so is the oil saturation appendix b implementation of the mechanistic model of shahverdi and sohrabi 2017 the three phase relative permeabilities of the mechanistic model of shahverdi and sohrabi 2017 form a coupled nonlinear system of eqs 1 to 3 we describe how the six two phase relative permeabilities that appear in eqs 1 2 and 3 are expressed when using the mualem van genuchten model b 1 three phase relative permeability of the oil phase kro the three phase relative permeability of the oil phase eq 1 is expressed by b1 k r o s w o s w o s g o k r o w s o w s g o s w o s g o k r o g s o g where s o w a o w s o b 2 a s o g a o g s o b 2 b s w o a w o s w b 2 c s g o a g o s g b 2 d and becomes b3 k r o a w o s w a w o s w a g o s g k r o w a o w s o a g o s g a w o s w a g o s g k r o g a o g s o using the two phase relative permeability of oil in a water oil system expressed by the modified mualem van genuchten model krow is written as b4 k r o w k r o w m a x 1 s w e 1 s w e 1 m o w 2 m o w k r o w m a x 1 s w o w s w i o w 1 s w i o w 1 s w o w s w i o w 1 s w i o w 1 m o w 2 m o w since krow has to be picked up at the representative two phase saturation sow using expression b2a eq b4 can then be expressed as function of the oil saturation so in the three phase system as follows b5 k r o w k r o w m a x 1 1 a o w s o s w i o w 1 s w i o w 1 1 a o w s o s w i o w 1 s w i o w 1 m o w 2 m o w using the two phase relative permeability of oil in an oil gas system expressed by the mualem van genuchten model krog is written as b6 k r o g s o e 1 1 s o e 1 m o g m o g 2 s o o g s o r o g 1 s o r o g 1 1 s o o g s o r o g 1 s o r o g 1 m o g m o g 2 since krog has to be picked up at the representative two phase saturation sog using expression b2b eq b6 can then be expressed as function of the oil saturation so in the three phase system as follows b7 k r o g a o g s o s o r o g 1 s o r o g 1 1 a o g s o s o r o g 1 s o r o g 1 m o g m o g 2 finally inserting eqs b5 and b7 in eq b3 one obtains the final expression of the relative oil permeability in the three phase system b8 k r o a w o s w a w o s w a g o s g k r o w m a x 1 1 a o w s o s w i o w 1 s w i o w 1 1 a o w s o s w i o w 1 s w i o w 1 m o w 2 m o w a g o s g a w o s w a g o s g a o g s o s o r o g 1 s o r o g 1 1 a o g s o s o r o g 1 s o r o g 1 m o g m o g 2 note that in eq b8 one has to respect the following constraints 1 a o w s o s w i o w 0 a o g s o s o r o g 0 b 2 three phase relative permeability of the water phase krw the three phase relative permeability of the water phase eq 2 is expressed by b9 k r w s o w s o w s g w k r w o s w o s g w s o w s g w k r w g s w g where s g w a g w s g b 9 a s w g a w g s w b 9 b and becomes b10 k r w a o w s o a o w s o a g w s g k r w o a w o s w a g w s g a o w s o a g w s g k r w g a w g s w using the two phase relative permeability of water in a water oil system expressed by the mualem van genuchten model krwo is written as b11 k r w o s w e 1 1 s w e 1 m w o m w o 2 s w w o s w i w o 1 s w i w o 1 1 s w w o s w i w o 1 s w i w o 1 m w o m w o 2 since krwo has to be picked up at the representative two phase saturation swo using expression b2c eq b11 can then be expressed as function of the water saturation sw in the three phase system as follows b12 k r w o a w o s w s w i w o 1 s w i w o 1 1 a w o s w s w i w o 1 s w i w o 1 m w o m w o 2 using the two phase relative permeability of water in a water gas system expressed by the mualem van genuchten model krwg is written as b13 k r w g s w e 1 1 s w e 1 m w g m w g 2 s w w g s w i w g 1 s w i w g 1 1 s w w g s w i w g 1 s w i w g 1 m w g m w g 2 since krwg has to be picked up at the representative two phase saturation swg using expression b9b eq b13 can then be expressed as function of the water saturation sw in the three phase system as follows b14 k r w g a w g s w s w i w g 1 s w i w g 1 1 a w g s w s w i w g 1 s w i w g 1 m w g m w g 2 finally inserting eqs b12 and b14 in eq b10 one obtains the final expression of the relative water permeability in the three phase system b15 k r w a o w s o a o w s o a g w s g a w o s w s w i w o 1 s w i w o 1 1 a w o s w s w i w o 1 s w i w o 1 m w o m w o 2 a g w s g a o w s o a g w s g a w g s w s w i w g 1 s w i w g 1 1 a w g s w s w i w g 1 s w i w g 1 m w g m w g 2 note that in eq b15 one has to respect the following constraints a w o s w s w i w o 0 a w g s w s w i w g 0 b 3 three phase relative permeability of the gas phase krg the three phase relative permeability of the gas phase eq 3 is expressed by b16 k r g s w g s o g s w g k r g w s g w s o g s o g s w g k r g o s g o and takes the following form b17 k rg a wg s w a og s o a wg s w k rgw a gw s g a og s o a og s o a wg s w k rgo a go s g using the two phase relative permeability of gas in a water gas system expressed by the modified mualem van genuchten model krgw is written as b18 k r g w k r g w m a x 1 s w e 1 s w e 1 m g w 2 m g w k r g w m a x 1 s w g w s w i g w 1 s w i g w 1 s w g w s w i g w 1 s w i g w 1 m g w 2 m g w since krgw has to be picked up at the representative two phase saturation sgw using expression b9a eq b18 can then be expressed as function of the gas saturation sg in the three phase system as follows b19 k r g w k r g w m a x 1 1 a g w s g s w i g w 1 s w i g w 1 1 a g w s g s w i g w 1 s w i g w 1 m g w 2 m g w using the two phase relative permeability of gas in an oil gas system expressed by the modified mualem van genuchten model krgo is written as b20 k r g o k r g o m a x 1 s o e 1 s o e 1 m g o 2 m g o k r g o m a x 1 s o g o s o r g o 1 s o r g o 1 s o g o s o r g o 1 s o r g o 1 m g o 2 m g o since krgo has to be picked up at the representative two phase saturation sgo using expression b2d eq b20 can then be expressed as function of the gas saturation sg in the three phase system as follows b21 k r g o k r g o m a x 1 1 a g o s g s o r g o 1 s o r g o 1 1 a g o s g s o r g o 1 s o r g o 1 m g o 2 m g o finally inserting eqs b19 and b21 in eq b17 one obtains the final expression of the relative gas permeability in the three phase system b22 k r g a w g s w a o g s o a w g s w k r g w m a x 1 1 a g w s g s w i g w 1 s w i g w 1 1 a g w s g s w i g w 1 s w i g w 1 m g w 2 m g w a o g s o a o g s o a w g s w k r g o m a x 1 1 a g o s g s o r g o 1 s o r g o 1 1 a g o s g s o r g o 1 s o r g o 1 m g o 2 m g o note that in eq b22 one has to respect the following constraints 1 a g w s g s w i g w 0 1 a g o s g s o r g o 0 appendix c quantified mvg parameters of the experimental two phase constitutive relationships table c1 and table c2 summarize the mualem van genuchten mvg parameters quantified for the bentheimer sandstone and berea sandstone the numerical values are obtained by a nonlinear fit of the theoretical pc s and kr s curves appendix a against the experimentally observed curves using the nlfit tool of origin 2019 with the levenberg marquardt iteration algorithm the tables specify uncertainty intervals standard errors associated with model parameter estimates r squared values are indicated as statistical measure when suitable to underline how close the experimental data are to the fitted curve appendix d comparison of predicted kr values water oil gas for oak s ddi experiments 17 and 18 with the findings of shahverdi and sohrabi 2017 figs d1 d3 and figs d4 d6 present the detailed comparison of relative permeabilities for water oil and gas of oak s ddi experiments 17 and 18 using the mechanistic model here we compare our numerical results obtained with those referenced in shahverdi and sohrabi 2017 to quantify the goodness of the prediction of the measured kr values the root mean square error rmse and the coefficient of residual mass crm are indicated appendix e boundary conditions and numerical results of the td compatible model e 1 boundary conditions tangential and normal derivatives of global capillary pressure p c g let τ and n be the tangential and normal unit vectors on t fig e1 defined by e1 τ 12 i 1 n 12 3 3 i 1 2 i 3 on t 12 water oil edge τ 13 i 3 i 1 n 13 3 3 i 1 i 3 on t 13 water gas edge τ 32 i 3 n 32 3 3 i 3 2 i 1 on t 32 gas oil edge where i 1 and i 3 are the unit vectors of the os1 os3 system of non orthogonal axis the global capillary pressure p c g being function of s1 and s3 the tangential and normal derivatives of p c g on t p c g τ and p c g n are then given by e2 p c g τ p c g s 1 p c g n 3 3 p c g s 1 2 p c g s 3 on t 12 water oil edge p c g τ p c g s 3 p c g s 1 p c g n 3 3 p c g s 1 p c g s 3 on t 13 water gas edge p c g τ p c g s 3 p c g n 3 3 p c g s 3 2 p c g s 1 on t 32 gas oil edge in order to perform c1 finite element interpolation in the orthogonal ox oy system the non orthogonal vectors i 1 and i 3 must be projected on the unit vectors of the ox oy system i and j as follows e3 i 1 i i 3 1 2 i 3 2 j we can then re write the tangential derivatives of p c g in terms of x and y derivatives and the normal derivatives of p c g as follows e4 p c g x p c g s 1 p c g y 0 p c g n 3 3 p c g s 1 on t 12 water oil edge p c g x 1 2 p c g s 3 p c g s 1 p c g y 3 2 p c g s 3 p c g n 3 3 p c g s 1 p c g s 3 on t 13 water gas edge p c g x 1 2 p c g s 3 p c g y 3 2 p c g s 3 p c g n 3 3 p c g s 3 on t 32 gas oil edge note that the normal derivatives in eq e4 are slightly modified with regard to eq e2 as p c g s 1 0 and p c g s 3 0 on the gas oil and the water oil edge respectively after c1 finite interpolation of p c g on the whole ternary diagram the numerical solutions in terms of x and y derivatives of p c g are projected along i 1 i 3 to compute the corresponding derivatives such as e5 p c g s 1 p c g x 3 3 p c g y p c g s 3 2 3 3 p c g y which are then used for computation of the water fractional flow f1 and gas fractional flow f3 as described in eq 17 e 2 results of the td compatible model e 2 1 bentheimer sandstone results of the td compatible model are shown in figs e2 e4 e 2 2 berea sandstone results of the td compatible model are shown in figs e5 e7 appendix f parker lenhard model applied to bentheimer sandstone alizadeh s ddi experiments a and d1 and berea sandstone oak s ddi experiments 16 20 and 25 f 1 bentheimer sandstone f 1 1 input parameters determined for modeling options pc s and kr s fig f1 shows the comparison of measured and fitted two phase constitutive relationships f 1 2 comparison of predicted kr values water oil gas with those measured in ddi experiments a and d1 figs f2 and f3 show the relative permeabilities measured from alizadeh s ddi experiments a and d1 compared to those predicted by the parker lenhard model f 2 berea sandstone f 2 1 input parameters determined for modeling options pc s and kr s fig f4 shows the comparison of measured and fitted two phase constitutive relationships f 2 2 comparison of predicted kr values water oil gas with those measured in ddi experiments 16 20 and 25 figs f5 f10 show the relative permeabilities measured from oak s ddi experiments 16 20 and 25 compared to those predicted by the parker lenhard model appendix g study of the occurrence of elliptic zones g 1 basic equations the three phase flow of immiscible phases is described using the darcy muskat law for the velocity of fluid phase α g1 v α k k r α μ α p α ρ α g where k is the absolute permeability l2 p α is the pressure of the phase α ml 1t 2 ρα is the density ml 3 μ is the dynamic viscosity ml 1t 1 g lt 2 is the gravity vector and k rα is the relative permeability conservation equations for an incompressible immiscible three phase flow can be written in terms of two saturation equations for water α 1 and gas phases α 3 g2 t d s α z d f α 0 with α 1 3 where s α is the saturation of phase α f α is the fractional flow of phase α zd and td are the dimensionless distance and time respectively such as g3 z d z l a n d t d 0 t v t o t ϕ l d t where z is the depth l l the total length of the system l φ is the porosity and vtot v 1 v 2 v 3 is the total volumetric flow rate of the three fluid phases lt 1 g 2 linearized fractional flow equations for saturation in the case of zero capillary pressure the dimensionless system of saturation yields fractional flow functions of water and gaz f 1 f 3 respectively g4 f 1 λ 1 λ t 1 n g ρ d 1 k r 2 ρ d μ 2 μ 3 k r 3 g5 f 3 λ 3 λ t 1 n g ρ d μ 2 μ 1 k r 1 k r 2 with the gravity number n g k ρ 2 ρ 3 g μ 2 v t o t ρ d ρ 1 ρ 3 ρ 2 ρ 3 is the density ratio λα m 1lt is the phase mobility and λ t m 1lt is the total mobility defined as λ t α k r α μ α the dimensionless system is linearized in terms of two saturation gradients involving a jacobian matrix j as follows g6 t d s 1 3 j z d s 1 3 0 with j f 1 s 1 f 1 s 3 f 3 s 1 f 3 s 3 from a numerical point of view solutions of the following riemann problem at t d 0 g7 z d 0 s 1 s 1 l s 3 s 3 l z d 0 s 1 s 1 r s 3 s 3 r depend on a dimensionless wave velocity u d z d t d yielding rarefaction and sock patterns which are the eigenvalues u d of the jacobian matrix j g8 u d 1 2 f 1 s 1 f 3 s 3 f 1 s 1 f 3 s 3 2 4 f 1 s 3 f 3 s 1 with the corresponding partial derivatives of fractional flow functions f 1 g9 f 1 s 1 3 1 μ 1 μ 2 μ 3 λ t 2 v t o t λ t s 1 3 μ 2 μ 3 k r 1 v t o t g k μ 2 k r 1 k r 3 ρ 3 ρ 1 μ 3 k r 1 k r 2 ρ 2 ρ 1 k r 1 s 1 3 μ 2 μ 3 λ t v t o t g k μ 2 k r 3 λ t ρ 3 ρ 1 μ 3 k r 2 λ t ρ 2 ρ 1 k r 2 s 1 3 g k μ 3 k r 1 λ t ρ 2 ρ 1 k r 3 s 1 3 g k μ 2 k r 1 λ t ρ 3 ρ 1 and f 3 g10 f 3 s 1 3 1 μ 1 μ 2 μ 3 λ t 2 v t o t λ t s 1 3 μ 1 μ 2 k r 3 v t o t g k μ 1 k r 2 k r 3 ρ 2 ρ 3 μ 2 k r 1 k r 3 ρ 1 ρ 3 k r 3 s 1 3 μ 1 μ 2 λ t v t o t g k μ 1 k r 2 λ t ρ 2 ρ 3 μ 2 k r 1 λ t ρ 1 ρ 3 k r 2 s 1 3 g k μ 1 k r 3 λ t ρ 2 ρ 3 k r 1 s 1 3 g k μ 2 k r 3 λ t ρ 1 ρ 3 where λ t s 1 3 α 1 μ α k r α s 1 3 when the eigenvalues u d are real and distinct the system g6 is hyperbolic in this case there are two real eigenvectors v d v d 1 v d 3 that correspond to the direction of admissible changes in fluid saturation and identify so called fast and slow rarefaction curves the components of the eigenvectors are expressed as g11 v d 1 d s 1 f 1 s 3 v d 3 d s 3 u d f 1 s 1 the fast rarefaction characterized by the eigenvector v d represents situations in which gas or and water saturations increase in three phase systems jackson and blunt 2002 when eq g8 gives a real wave velocity some values of saturations called umbilic point jackson and blunt 2002 give the same value u d u d u d the resulting system is therefore non strictly hyperbolic and very sensitive to the initial condition isaacson et al 1990 the square root in eq g8 is then always positive in the elliptic region wherein u d are complex and conjugates a linearized analysis shows that the system is unstable e g jahanbakhsi et al 2013 bell et al 1986 in the presence of capillarity the diffusive term becomes dominant at high frequencies however at low frequencies the diffusive term would not be sufficient to remove instabilities it has been shown that inside the elliptic region equilibrium formulation yields unstable and oscillatory solutions when the initial and injected state for saturation is inside the elliptic region the solution exhibits oscillatory behavior growing in magnitude showing that the system is unstable trangenstein 1989 a non equilibrium approach was developed jahanbakhsi et al 2013 using relaxation strategies barenblatt s model which leads to high order terms involving cross derivatives when both sl and sr are outside the elliptic region the solution is stable and the existence of the elliptic zone does not affect the results when initial and injected states are on the opposite sides of the elliptic region solutions are oscillatory and not completely stabilized g 3 test of implemented algorithm to identify elliptic zones the study case of bell in order to investigate three phase relative permeability behavior on ternary diagram t a first set of functions is used from bell et al 1986 g12 k r 1 s 1 1 09 s 1 1 516687 0 09 s 1 4 51668 k r 2 s 1 s 3 1 s 1 s 3 1 s 1 1 s 3 k r 12 s 1 k r 23 s 3 k r 3 s 3 0 525 s 3 1 02 0 475 s 3 3 62 to quantify the three phase oil relative permeability kr2 the two phase relative permeability functions k r12 and k r23 from the water oil and oil gas side are expressed by g13 k r 12 s 1 1 95 1 s 1 8 28 0 95 1 s 1 11 284 k r 23 s 3 1 19 1 s 3 2 006 0 19 1 s 3 2 024 bell s model is a synthetic set of relative permeabilities known to maximize the elliptic region on t water viscosity is μ1 0 8 cp gas viscosity is μ3 0 05 cp and three different oil viscosities are investigated from 0 1 cp to 5 cp without gravity effect fig g1 when reducing the oil viscosity from 5 cp to 0 1 cp the elliptic region produces a larger instability area the largest zone for μ2 0 1 cp almost occupies 15 of the whole ternary surface parallelly oriented to the gas oil side compared to 7 obtained for μ2 1 cp the lower the oil viscosity is the larger the extent of the elliptic area when including gravity another elliptic region appears whose extent strongly depend on the absolute value of total velocity fig g2 shows the influence of gravity associated with different orders of magnitude of total velocity varying from 10 2 ms 1 to 10 7 ms 1 as reference is used here the case without gravity and a fixed oil viscosity fixed of 1 cp when the total velocity is 10 2 ms 1 the elliptic zone decreases slightly while its area remains close to 7 of the total ternary surface the further decrease of the total velocity results in a significant decrease of the elliptic area to about 2 of the total ternary surface and a displacement of the elliptic zone towards the oil vertex overly the decrease of total velocity has a stabilizing and antagonistic effect in contrast to the oil viscosity however both parameters appear in the denominator of the gravity number n g eqs g4 and g5 g 4 parker lenhard model quantification of elliptic regions the occurrence of elliptic regions was assessed for the parker lenhard model in the same way as described for the mechanistic model the numerical results obtained for the bentheimer sandstone and berea sandstone are described below g 4 1 bentheimer sandstone the study on the occurrence of elliptic regions was conducted with the parker lenhard model using the experimental data of the bentheimer sandstone table 2 the intrinsic permeability of the rock k 2 63 10 12 m2 and the model input parameter of modeling options pc s and kr s table 8 the numerical results obtained are shown in fig g3 g 4 2 berea sandstone the study on the occurrence of elliptic regions was conducted with the parker lenhard model using the experimental data of the berea sandstone table 3 the intrinsic permeability of the rock k 1 97 10 13 m2 and the model input parameter of modeling options pc s and kr s table 9 the numerical results obtained are shown in fig g4 g 5 stone s model i quantification of elliptic zones the occurrence of elliptic regions was assessed for the stone s model i in the same way as described for the mechanistic model the numerical results obtained for the bentheimer sandstone and berea sandstone are presented below to study the existence of possible elliptic regions we required a relative permeability model for water and gas in the water oil gas saturation space we therefore used the water relative permeability and gas relative permeability expression described by the lenhard parker model eqs 5 and 7 the van genuchten parameter m and the irreducible water saturation in a water gas system swi was adopted from modeling option pc s table 8 table 9 g 5 1 bentheimer sandstone the study on the occurrence of elliptic regions was conducted with stone s model i using the experimental data of the bentheimer sandstone table 2 the intrinsic permeability of the rock k 2 63 10 12 m2 and the model input parameter used for the prediction of ddi experiments performed on bentheimer sandstone table 10 the numerical results obtained are shown in fig g5 g 5 2 berea sandstone the study on the occurrence of elliptic regions was conducted with stone s model i using the experimental data of the berea sandstone table 3 the intrinsic permeability of the rock k 1 97 10 13 m2 and the model input parameter used for the prediction of ddi experiments performed on berea sandstone table 10 the numerical results obtained are shown in fig g6 
406,the predictions of two recent and two classical mathematical models are compared with experimentally measured three phase relative permeabilities experimentally determined constitutive relationships in two phase systems were used as model input parameters to numerically predict relative permeabilities kr in three phase systems then the estimated results were compared with experimental three phase permeabilities measured along decreasing water saturation decreasing oil saturation increasing gas saturation ddi paths the results of the individual models to each of the three fluids involved water oil and gas were analyzed in detail the simulated results showed that the total differential td compatible model overestimates significantly both the global mobilities as well as the relative phase permeabilities in the three phase system there was improvement in the prediction with the td compatible model when experimental data were used to locally impose the global mobility and fractional water and gas fluxes in the ternary diagram globally the best prediction of the measured kr values was obtained with the so called mechanistic model however its numerical implementation requires a preliminary calibration of the relative phase permeabilities in a three phase system against experimental data along one ddi path to quantify the required six characteristic coefficients in contrast to the td compatible model which by construction does not exhibit any numerical instabilities elliptic zones in the water oil napl gas ternary diagram were identified in the mechanistic model keywords relative permeability three phase system mathematical model global mobility ternary diagram 1 introduction since the 1950s the number of sites contaminated by halogenated solvents has increased significantly in industrialized countries solvents are used in a wide range of industrial processes and in everyday products e g paints oils varnishes and dry cleaning liquids and may be released into the environment in industrial effluents or by improper disposal by users among all solvents aliphatic chlorinated solvents including chloromethane chloroethane and chloroethene have been the most frequently encountered group of compounds therefore characterization and modeling of the fate of chlorinated solvents in porous aquifers has gained significant attention in recent years to protect groundwater resources fried et al 1979 cohen and mercer 1993 pankow and cherry 1996 jellali et al 2001 bohy et al 2006 dridi et al 2009 cotel et al 2011 portois et al 2018 qian et al 2020 these liquid compounds are immiscible in water and because they are usually denser than water except vinyl chloride chloromethane and chloroethane they are called dense nonaqueous phase liquids dnapl in the subsurface chlorinated solvents migrate vertically depending on the gravity and capillary forces through the unsaturated zone where a large vapor plume appears due to their high volatility after rainfall a vapor lixiviation due to vapor precipitation may occur and dissolved chlorinated solvents can reach the groundwater table and contaminate the groundwater mendoza and frind 1990 sleep and sykes 1992 jellali et al 2003 if the amount of solvents released is large the dnapl reaches and penetrates the groundwater table due to its high density dissolves and forms a solute plume within the aquifer a certain amount of solvents becomes trapped as blobs or forms pools over low permeability geological structures this constitutes a long term source of contamination of drinkable groundwater resources given the low solubilities of the solvents schwille 1988 brusseau 1992 kennedy and lennox 1997 eberhardt and grathwohl 2002 seyedabbasi et al 2012 multiphase flow may occur in a porous aquifer in the form of three phase water napl gas flow in the unsaturated zone and two phase water napl flow in the saturated zone fig 1 gravity driven infiltration of napls in soil containing one or more chlorinated solvents leaves behind a zone of residual saturation this process results in a small size napl source zone within the porous medium with respect to the characteristic dimensions of the aquifer the main difference between the two and three phase flow is the formation of napl layers sandwiched between gas and water blunt et al 1995 and the double displacement where the gas displaces the disconnected napl ganglia which displaces water øren and pinczewski 1995 these mechanisms can reduce residual napl saturation even in capillary dominated flow helland and jettestuen 2016 whereas in two phase capillary dominated flow isolated ganglia are trapped chatzis and morrow 1984 numerical simulation of multiphase flow has become a crucial method for solving water resource management and other environmental problems such as co2 sequestration in saline aquifers and coupled geomechanical processes in the subsurface helmig et al 2013 celia et al 2015 benisch et al 2020 while multiphase flow models for water napl and gas phases were initially adopted in petroleum research for reservoir simulation they were later successfully exploited for hydrosystem monitoring or remediation pressure and saturation of fluids are the key variables in the analysis of multiphase flow in porous media furthermore secondary variables such as relative permeabilities and capillary pressures which are functions of fluid saturations are needed for the simulation of displacement processes in porous media forecasting the behavior of chlorinated solvents in aquifers presents at least two difficulties characterization of the source zone i e locating the source zone and evaluating the napl volume and composition and modeling of the fate of pollution downstream of the source zone i e how to choose physical models mathematical tools and numerical methods multiphase flow modeling is a major tool for assessing groundwater pollution caused by non aqueous phase liquids napl such as chlorinated solvents to quantify and characterize groundwater pollution by napls numerical codes that include multicomponent transport equations require a fast and accurate resolution of the primary and secondary variables of three phase flow the relative permeability of a fluid depends on the wetting properties of the porous medium van dijke and sorbie 2002 but it may also depend on the saturation history as the pore scale fluid configurations are history dependent relative permeability can be measured either in the laboratory by performing coreflood experiments or estimated using empirical correlations the earliest three phase relative permeability measurements found in the literature date back to the work of leverett and lewis 1941 and since then a variety of studies have been conducted to investigate the effects of various parameters such as saturation history wettability spreading and layer drainage on three phase relative permeability alizadeh and piri 2014a nonetheless experimental measurement of three phase relative permeabilities is far more complex and time consuming than two phase relative permeabilities and thus several correlations and mathematical models have been proposed over the years to predict three phase relative permeabilities using two phase relative permeability data e g corey et al 1956 stone 1970 1973 baker 1988 delshad and pope 1989 blunt et al 1995 blunt 2000 ranaee et al 2015 shahverdi and sohrabi 2017 a detailed review of existing three phase relative permeability models is given by shahverdi and sohrabi 2017 the present study addresses from both physical and numerical points of view specific questions related to mathematical modeling of three phase multiphase flow in porous media as regards the physical aspect the research questions relate directly to the use and implementation of three phase water napl gas flow codes to predict for example the formation of a napl source zone after infiltration of napls into the subsurface these numerical tools require as input parameters inter alia constitutive relationships such as relative permeabilities which are functions of saturations of different fluids present in the porous medium in connection with the implementation of relative permeabilities in numerical three phase flow codes model developers and users are faced with a range of basic questions how is one able to predict the relative permeability of the napl phase as a function of water and gas saturation levels are the relative permeability models that have traditionally been developed for napls such as stone models stone 1970 1973 appropriate for representing the governing displacement physics and if not what are the shortcomings regarding the numerical aspect the questions that arise for modelers are often related to the possible instability of numerical models relative permeability models for the napl phase in three phase flow systems can be the origin of numerical instabilities trangenstein 1989 while conventionally assumed that three phase permeability models only generate hyperbolic systems bell et al 1986 using synthetic kr models showed that the system of saturation equations is not purely hyperbolic in all respects and may produce unstable results for certain saturation values called elliptic regions jahanbakhshi et al 2013 demonstrated by linearization that the system is unstable in elliptic regions i e for conjugate complex eigenvalues of the jacobian matrix of the system of two saturation equations using the fractional flow theory of displacement for example using stone s model i stone 1970 in cases of flow configurations that do not include gravity and capillary effects the occurrence of elliptic zones leads to significant oscillations of fluid saturations schneider 2015 and exhibits complex wave speeds that result in non unique solutions jackson and blunt 2002 in the absence of three phase experimental data a new class of total differential td interpolations was designed to simplify the numerical simulations of compressible three phase flows by using a global pressure formulation chavent et al 2008 chavent 2009 amaziane et al 2012 this formulation requires that the three phase relative permeabilities and capillary pressures satisfy the so called total differential td condition chavent 2009 which guarantees the strict hyperbolicity of the reformulated system chavent and jaffré 1986 the td interpolation of a collection of three phase data sets is then realized by constructing two functions over the ternary diagram one global capillary pressure and one global mobility which satisfy the boundary conditions determined by the three given two phase data sets the resultant relative permeabilities that comply with the condition of total differential defined by di chiara roupert 2009 do not yield elliptic zones and will therefore be used in our comparison of the predictions of different mathematical models with experimentally tested three phase relative permeability results the td compatible model described by di chiara roupert et al 2010a will be extended by integrating experimental based residual fluid saturations in two phase systems to compare the td compatible model with the commonly used three phase relative permeability models we included three other models in our study first the recently developed model for the prediction of three phase relative permeabilities the so called mechanistic model proposed by shahverdi and sohrabi 2017 will be evaluated this model presumably takes into account the interaction between various fluids as well as fluid saturation distributions using an arithmetic averaging relationship between two phase and three phase permeabilities our numerical study will then be completed by applying the classical parker lenhard model parker and lenhard 1990 that was traditionally introduced as one of the first permeability models in three phase flow and transport numerical simulators to describe and predict the fate of contamination by napls in the subsurface and the historical stone model i stone 1970 commonly implemented in industrial oil reservoir codes will be used to model the oil relative permeability in three phase systems in our numerical simulations we used experimentally determined constitutive relationships of two phase systems as input parameters to numerically predict the relative permeabilities in three phase systems then we compared the estimated results with experimental three phase permeabilities measured by oak oak 1990 and alizadeh alizadeh 2013 alizadeh and piri 2014b along decreasing water saturation decreasing oil napl saturation increasing gas saturation ddi paths the overall objective of the present work was to quantify the differences between the measured and the predicted relative permeabilities for water oil and gas in a three phase fluid system the occurrence of elliptic regions is also analyzed for the mechanistic model parker lenhard model and stone s model i in the framework of the classical fractional flow theory of displacement our study is organized as follows section 2 outlines the main features of the three phase relative permeability models evaluated the experimental data employed for the evaluation and comparison of the different mathematical models to describe relative permeabilities in three phase flow systems are concisely described in section 3 key results of our numerical studies are presented in section 4 finally section 5 presents the outcome of our individual model analysis to each of the three fluids involved water oil and gas and discusses the existence and importance of elliptic zones in a water oil napl gas ternary diagram when using the mechanistic model 2 mathematical models here we describe the main features of two recent and two classical models evaluated against experimentally measured three phase permeabilities mechanistic model of shahverdi sohrabi shahverdi and sohrabi 2017 total differential compatible model introduced by di chiara roupert et al 2010a 2010b extended by integrating experimental based residual fluid saturations in two phase systems parker lenhard model parker and lenhard 1990 stone s model i stone 1970 the constitutive relationships capillary pressure saturation pc s and relative permeability saturation kr s functions in two phase systems used in our study are summarized in appendix a 2 1 mechanistic model of shahverdi sohrabi to predict three phase relative permeabilities of oil water and gas the so called mechanistic model proposed by shahverdi and sohrabi 2017 takes into account the interactions between the fluids and fluid saturation distributions for this purpose an arithmetic averaging relationship between two phase and three phase permeability is used six new parameters named characteristic coefficients aij having a value between zero and one are introduced in their model to express the linear relationship between two phase and three phase saturations for each of the three fluids present in the system these coefficients reflect the contribution of each fluid in controlling the flow of the other fluids it should be noted that at least one set of experimental three phase relative permeability data for one saturation path is required to tune the characteristic coefficients the estimated characteristic coefficients can then be employed to predict three phase relative permeabilities for any other saturation path in this model the three phase relative permeability of the oil phase kro is expressed by 1 k r o s w o s w o s g o k r o w s o w s g o s w o s g o k r o g s o g where krow is the two phase oil relative permeability in the oil water system krog is the two phase oil relative permeability in the gas oil system sow and sog are the oil saturation in the two phase oil water and gas oil system and swo and sgo represent the water saturation in a two phase water oil system and gas saturation in the two phase gas oil system the model proposes a linear relationship between two phase and three phase saturations as follows 1a s o w a o w s o 1b s o g a o g s o 1c s w o a w o s w 1d s g o a g o s g where sw so and sg are the three phase saturations of water oil and gas respectively similar expressions can be developed for three phase water relative permeability krw and gas relative permeability krg 2 k r w s o w s o w s g w k r w o s w o s g w s o w s g w k r w g s w g where sgw and swg are the gas saturation and water saturation in the two phase gas water system the two phase saturations are linked to the given three phase saturations by the following linear relationships 2a s g w a g w s g 2b s w g a w g s w the gas relative permeability is expressed as 3 k r g s w g s o g s w g k r g w s g w s o g s o g s w g k r g o s g o eqs 1 2 and 3 represent a coupled nonlinear system of equations in our study the six two phase relative permeabilities in eqs 1 2 and 3 are expressed using the mualem van genuchten model appendix b to quantify the characteristic coefficients aij we used the nlfit tool of origin 2019 with the levenberg marquardt iteration algorithm and user defined fitting functions with multiple variables 2 2 total differential td compatible model in a three phase fluid water wet system there generally exist two fluid interfaces oil water and gas oil at both interfaces there is a change in pressure called capillary pressure when moving from one fluid to the other moreover the individual phase pressures can be singular in the case where the derivative of capillary pressure becomes infinite at residual saturations hence phase pressures cannot be regular across a two phase interface the total differential condition allows the two gradients of two phase capillary pressures to be rewritten as a single gradient of a mathematical function called the global capillary pressure function pc g chavent and jaffré 1986 chavent 2009 di chiara roupert et al 2010a the resulting new pressure variable called global pressure p is written as the sum of the pressure of one of the three fluid phases and the global capillary pressure pc g in our modeling approach we used the gas pressure to define the global pressure this is required when dealing with compressible three phase flow note the global pressure is smooth compared to the individual phase pressures and exhibits a global volumetric flow vector without any capillary gradients this global pressure formalism specifically allows the decoupling of the pressure equation and the two saturation equations the numerical analysis of the problem is thus simplified and the efficiency of the calculation is improved note the global pressure approach in a two and three phase flow system exists only for data of relative permeabilities and capillary pressures that satisfy the total differential td condition the td compatible model introduced by di chiara roupert et al 2010a uses continuous mathematical functions to describe the two phase relative permeabilities and capillary pressures on the edges of the ternary diagram fig 2 in the present study we integrated experimental based residual fluid saturations in two phase systems to quantify the mobility and global capillary pressure on the three boundaries the way the integration was done is described in section 4 2 the input parameters required for the td compatible model are two phase relative permeabilities krj kl and two phase capillary pressures pc kl on the three edges of the ternary diagram fig 2 where j 1 2 or 3 and k l 1 2 or 3 the independent variables are the water saturation s1 and gas saturation s3 two phase constitutive relationships used in the td compatible model are described in appendix a the required model input parameters are obtained by considering primary drainage of a single phase fluid system further physical properties of the fluids taken into account are equilibrium interfacial tensions in the gas water system σgw oil water system σow and gas oil system σgo water gas and oil densities and viscosities molecular weight of the gas gas constant temperature and reference density of gas the data available in the literature on bentheimer and berea sandstones were used as input parameters for the interpolation module using finite elements that was developed by di chiara roupert 2009 then for each rock sample the three phase data that are td compatible will be determined from a global capillary pressure function and a global mobility function which depend on the saturation and overall global pressure level p note that the boundary conditions of the ternary diagram for the global capillary pressure and global mobility must be consistent with the three sets of two phase data step 2 and step 3 in table 1 di chiara roupert et al 2010a note in step 2 one has to respect the so called td compatibility condition the three sets of two phase data built up on the edges of the ternary diagram have to satisfy this condition the global capillary pressure calculated independently on the oil gas and water gas side must be the same at the gas summit the td compatibility condition is a nonlinear constraint on weighted means of the given two phase relative permeability data set it presents a certain weakness of this model in contrast to its strength of being free of elliptic zones in the saturation space the two phase data known on the limits of the ternary diagram will then be extended to the whole diagram and thus determine the relative permeabilities in a three phase system by respecting the total differential condition the numerical construction of the global mobility and global capillary pressure will then be performed by finite elements c0 step 4 in table 1 and c1 step 5 in table 1 using laplacian and bi laplacian interpolation relative permeabilities in three phase systems will then be derived from global mobilities d step 4 fluid fractional flows fj step 5 using the derivatives of the global capillary pressures pc g the capillary pressure curves in a water gas system pc 12 and gas oil system pc 32 with respect to s1 and s3 individual mobilities dj step 5 by 4 k r 1 s p f 1 s p d 1 d s p k r 2 s p f 2 s p d 2 d s p k r 3 s p f 3 s p d 3 p p c g s p p c 32 s 3 d s p the relative permeabilities krj for the three fluid phases with j 1 water 2 napl 3 gas that will be quantified will then be compared with the three phase experimental data 2 3 parker lenhard model based on the van genuchten parameter m appendix a obtained from the capillary pressure saturation pc s relationship in the two phase gas water system and the irreducible wetting fluid saturation swi water oil and gas relative permeabilities in a three phase fluid system can be predicted the water relative permeability krw is described by 5 k r w s w 1 2 1 1 s w 1 m m 2 with s w s w s w i s m a x s w i where swi is the irreducible saturation of the wetting fluid phase here water and smax is the maximum saturation of the wetting fluid phase during drainage of the porous medium water is displaced for example by gas the maximum saturation smax is equal to 1 note that the maximum saturation of the wetting fluid phase smax is considered to be independent of fluid properties or saturation history in the present work we focused our attention to monotonic wetting phase drainage from complete saturation the oil relative permeability kro is expressed as 6 k r o s t s w 1 2 1 s w 1 m m 1 s t 1 m m 2 where s t s w s o s w i 1 s w i the gas relative permeability krg is described by 7 k r g 1 s t 1 2 1 s t 1 m 2 m where s t s w s o s w i 1 s w i 1 s g s w i 1 s w i 2 4 stone s model i to quantify the oil relative permeability in a three phase system the first model proposed by stone in 1970 uses a geometric averaging between the oil relative permeability krog in the two phase gas oil system and the oil relative permeability krow in the two phase oil water system 8 k r o s o 1 s g 1 s w k r o g s g k r o w s w in this equation s o s g and s w are the normalized oil gas and water saturations respectively and are defined as 8a s o s o s o r 1 s w i s o r 8b s g s g 1 s w i s o r 8c s w s w s w i 1 s w i s o r where swi and sor are irreducible water saturation and residual oil saturation respectively in our study two phase oil relative permeability in the gas oil system is expressed by the mualem van genuchten mvg model mualem 1976 van genuchten 1980 8d k r o g s g s o s o r 1 s o r 1 1 s o s o r 1 s o r 1 m o g m o g 2 1 s g s o r 1 s o r 1 1 1 s g s o r 1 s o r 1 m o g m o g 2 and two phase oil relative permeability in the oil water system is expresses by the modified mualem van genuchten model 8e k r o w s w k r o w m a x 1 s w s w i 1 s w i 1 s w s w i 1 s w i 1 m o w 2 m o w where krow max is the maximum relative oil permeability achieved at irreducible water saturation swi in the oil water system mog and mow correspond to the mvg parameter in a gas oil system and oil water system respectively 3 experimental data to evaluate and compare the four mathematical models explained earlier experimental data generated on two different water wet sandstones were selected from the literature 3 1 data on bentheimer sandstone alizadeh 2013 performed a series of steady state flow experiments on water wet bentheimer sandstone to obtain two phase and three phase relative permeabilities the absolute brine permeability and porosity of the core sample whose data were used in our study were 2 66 d and 0 24 respectively alizadeh and piri 2014b the physical properties of the fluids used in the flow experiments are provided in table 2 the two phase relative permeabilities obtained during primary drainage in oil water gas water and gas oil systems are plotted in fig 3 and compared to the simulated two phase relative permeabilities using the mvg model to quantify the input parameter for the mvg model we used the experimentally determined end point wetting phase saturations and the associated nonwetting phase relative permeability as known irreducible water saturations swi in the oil water and gas water systems remaining oil saturation sor in the gas oil system and maximum relative permeability of the nonwetting fluid krnw max the only remaining model parameter mvg parameter m was then obtained by a nonlinear fit of the theoretical kr s against the experimentally observed permeability curve using the nlfit tool of origin 2019 with the levenberg marquardt iteration algorithm the capillary pressure saturation curve measured by alizadeh 2013 for a gas water system was analysed numerically with the van genuchten model fig 3 the optimal calibration of the experimental pc s data was obtained using the fit of the three model parameters swi m α all fit parameters and characteristics of the optimization process are listed in table c1 appendix c it is worthwhile to mention that the irreducible water saturation or residual oil saturation quantified from capillary pressure curves is systematically smaller than that observed experimentally in the two phase flow experiment from the theoretical point of view the numerical value of parameter m derived from the mvg model should be equal to that of parameter m appearing in the van genuchten pc s model as the aim of our study is to represent as close as possible the experimental constitutive relationships we preferred to keep fitted the parameter m in both relationships 3 2 data on berea sandstone oak 1990 performed a series of steady state flow experiments on water wet berea sandstone to obtain two phase and three phase relative permeabilities the absolute permeability and porosity of the core sample whose data were used here were 0 2 d and 0 22 the physical properties of the fluids used in his experiments are provided in table 3 the two phase relative permeabilities obtained in experiments 2 8 and 13 were conducted in oil water gas water and oil gas systems the measured and numerically simulated two phase relationships are presented in fig 4 the capillary pressure saturation curves determined in oak s experiments in a gas water water oil and oil gas system were analysed numerically with the van genuchten model fig 4 all fit parameters and characteristics of the optimization process are summarized in table c2 appendix c 3 3 comparison of measured and predicted three phase kr values the saturation path of three decreasing water saturation decreasing oil saturation increasing gas saturation ddi experiments performed on bentheimer sandstone by alizadeh and piri 2014b and 7 ddi experiments performed on berea sandstone by oak 1990 are shown in fig 5 the experimental two and three phase relative permeabilities obtained on the bentheimer and berea sandstones were used to predict three phase flow in porous media using the four mathematical models described earlier in section 2 in our numerical study the model performance was evaluated by quantitative and qualitative methods in the qualitative approach the response of each model was first visually analyzed by plotting the measured and simulated values of relative permeabilities as functions of the saturation of the corresponding fluid phase to quantify the goodness of the prediction of the measured kr values we used the root mean square error rmse 9 r m s e 1 n i 1 n m i p i 2 the coefficient of residual mass crm 10 c r m i 1 n m i i 1 n p i i 1 n m i the relative error re defined as 11 r e p i m i m i and the maximum relative error mre expressed by 12 m r e m a x p i m i i 1 n m a x m i where mi and pi represent the measured and predicted kr values and n is the number of experimental data the rmse is an accuracy index and expresses the average model prediction error in units of the variable of interest it can range from 0 to is indifferent to the direction of errors and represents negatively oriented scores the crm illustrates the tendency of a model to overestimate or underestimate the measurements positive values for crm indicate that the model underestimates the measurements and negative values for crm indicate a tendency to overestimate to analyze globally the response and goodness of the different models to predict the three phase relative permeabilities of water oil and gas we plotted the simulated kr values against the measured kr values and analyzed the scatter plot by linear regression using originlab 2019 the quantified coefficient of determination r squared is expressed by 13 r 2 1 n i 1 n m i m p i p 2 σ m σ p with m 1 n i 1 n m i and p 1 n i 1 n p i where σ m qnd σ p are the standard deviation of mi and pi respectively r squared is a statistical measure of how close the data are to the fitted regression line and demonstrates thus the ratio between the scatter of predicted values to the measured values 4 results of the numerical modeling 4 1 mechanistic model of shahverdi sohrabi 4 1 1 implementation of the model to test the implementation of the mechanistic model developed by shahverdi and sohrabi 2017 we used oak s experiment 15 or named g1 in shahverdi and sohrabi 2017 the six two phase relative permeabilities are expressed by the mualem van genuchten model see appendix b the used model parameters are reported in table 4 to quantify the characteristic coefficients aij shown in table 5 we used the nlfit tool of origin 2019 with the levenberg marquardt iteration algorithm and user defined fitting functions with multiple variables the fit of oak s experimental data originating from experiment 15 on soil sample 6 which corresponds to experiment g1 named by shahverdi and sohrabi 2017 was achieved in our runs after 420 iterations with a chi square tolerance value of 1 10 9 giving a fit result with r squared of 0 99 it is worth noting that the uncertainty intervals obtained for the characteristic coefficients aog and awg table 5 are extremely high compared to their numerical values which were bounded in the fitting procedure between 0 and 1 the predicted kr values of oak s ddi experiments shown in the following are obtained using the model parameter estimates given in table 5 we did not yet consider their uncertainty intervals in our modeling approach to predict the level of uncertainty associated with these parameter estimates through i e an assessment of the covariance matrix however the estimated coefficients aij are quite different from the numerical values published by shahverdi and sohrabi 2017 who used the genetic algorithm as described in shahverdi et al 2011 in their nonlinear fitting procedure for estimation of relative permeability the relative permeabilities for the corresponding two phase systems similar to ours the way of implementing the two phase relative permeabilities in our case by using the analytical function of mvg model in their case spline functions and the automatic fitting procedure itself seem to significantly impact the numerical values of estimated coefficients aij the main differences can be summarized as follows in our work 1 aog is greater than aow hence the oil phase is more dominated by the gas phase than the water phase and 2 the comparison between ago and agw indicates that more fraction of gas saturation is governed by water however as shown in fig 6 the detailed comparison of fitted kr values against the experimental data indicates that our fitted kr values have rmses values that are comparable with the tuned kr values found by shahverdi and sohrabi 2017 it is certainly not surprising that the estimation of these characteristic coefficients does not allow a unique solution this is related not only to the nature of the inverse problem but also to the approach employed to the minimization of a given objective function to further explain the observed differences a profile likehood analysis could be carried out for each given ddi path ranaee et al 2015 in order to investigate for some given upper and lower limits of confidence intervals if the model displays a unique minimum identifiability case or on the contrary if the case is not structurally identifiable one can therefore make a priori choice on the path to be chosen in order to guarantee an exploitable fitted model in our study we have chosen to use automatic nonlinear minimization of the objective function using the nlfit tool implemented in origin 2019 with the levenberg marquardt iteration algorithm whereas the coefficients generated by shahverdi and sohrabi 2017 were determined with a genetic algorithm to build up the objective function we used a continuous description of data sets using the constitutive analytical mvg relationship whereas the genetic algorithm approach implemented by shaverdi and sohrabi 2017 was based on kr values represented by quadratic b spline functions note also that the quantified coefficient of residual mass crm do not always exhibit similar tendencies for example the water relative permeability is underestimated by shahverdi and sohrabi 2017 and only slightly overestimated in our study whereas the estimates of gas relative permeabilities show contrary trend concerning the prediction of kr values globally our results obtained for experiments 17 g2 and 18 g3 are similar to those obtained by shahverdi and sohrabi the detailed comparison of predicted kr values water oil gas for experiments 17 and 18 with those of shahverdi and sohrabi 2017 is documented in appendix d 4 1 2 prediction of oak s ddi experiments 16 19 20 and 25 figs 7 10 show the predicted three phase relative permeabilities along the ddi saturation paths of experiment 16 19 20 and 25 not surprisingly the relative permeabilities predicted for experiment 16 by the mechanistic model clearly represent the measured kr values its ddi saturation path is close to that of experiment 15 used in the calibration process of the characteristic coefficients aij fig 5 and therefore the numerical values of crm and mre are quite similar the relative permeabilities predicted in experiment 19 and 25 for water and gas also perfectly fits the observed experimental data expressed by low rmses and low mres ranging between 1 and 17 however the oil relative permeabilities are strongly overestimated as shown by the high negative values of crm in the case of experiment 20 which corresponds to a saturation path at irreducible water saturation the water relative permeability is predicted as very close to zero fig 9 surprisingly in this case the predicted oil relative permeabilities as well as the gas relative permeabilities are highly underestimating the observed values the mre value attains about 64 and 28 for the predicted oil and gas permeability respectively 4 1 3 prediction of alizadeh s experiments on bentheimer sandstone the required input parameters used for the description of the experimental two phase relative permeabilities in the mechanistic model see appendix b are summarized in table 6 to test the influence of the characteristic coefficients aij on the prediction of the three phase relative permeabilities along the three ddi saturation paths we decided to apply three options to quantify the coefficients aij by nonlinear fit we used 1 in option a the measured kr values of experiment a 2 in option c the experimental results of experiment c and 3 in option ac both data sets of results the quantified characteristic coefficients aij for each of the three options are reported in table 7 it is worth noting that the uncertainty intervals obtained for the characteristic coefficient awg are high compared to their numerical values which were bounded in the fitting procedure between 0 and 1 especially in modeling option a the standard error of awg is extremely high and underlines that the model parameter obtained is rather uncertain the predicted kr values of alizadeh s ddi experiments shown in the following are obtained using the model parameter estimates given in table 7 we did not yet consider their uncertainty intervals in our modeling approach to predict the level of uncertainty associated with these parameter estimates through i e an assessment of the covariance matrix comparing the resulting coefficients from option a with those quantified from option c unlike the numerical value of aow the differences are quite significant aog for example which characterizes the relation between the oil saturation in the two phase oil gas system and oil saturation in the three phase fluid system is found to be zero in option a while in option c it takes the maximum value of 1 a similar fact can be stated for coefficient awg in option ac the quantified characteristic coefficients are situated between either option a and option c or closer to the coefficients of option c the latter can be attributed to the fact that the data set of experiment c contains more values than the data set of experiment a figs 11 13 show the fitted and predicted three phase relative permeabilities along the ddi saturation paths of experiment a c and d1 to qualify the goodness of each of the numerical simulations we specified the corresponding rmse crm and mre the simulated water relative permeabilities of experiment a and c globally overestimates the experimental values note that experiment d1 corresponds to the case where water is at irreducible saturation and thus immobile however the oil relative and gas relative permeability measured in experiment c and d1 are both underestimated by all three model options the detailed comparison of all predicted fitted kr values with the measured values show that the numerical results obtained with coefficients of option c and ac are overly closer to the experimental data than those quantified with coefficients of option a one reason for this may be the higher number of data points considered during the optimization procedure of the characteristic coefficients aij but also the more central location of ddi saturation path of experiment c in the ternary diagram the use of two experimental data sets option ac for tuning of the characteristic coefficients as suggested by shahverdi and sohrabi 2017 to reduce the degree of uncertainty by employing more measured data of three phase relative permeabilities slightly improves only the goodness of predicted kr values therefore in the following global analysis we will only consider the simulated results obtained with model option c 4 1 4 global analysis of predicted three phase relative permeabilities for further investigation of the accuracy of the model the three phase relative permeabilities predicted by the model for each fluid phase are plotted against the measured relative permeabilities obtained for berea and bentheimer sandstone figs 14 16 each figure also contains a description of the quantified relative error as a function of the measured relative permeability in the three phase system in the case of berea sandstone as shown by the cross plot fig 14 the water relative permeability is reasonably well predicted by the mechanistic model globally it slightly overestimates the measured kr values characterized by a relative error of about 0 13 0 53 however for the bentheimer sandstone the predicted water relative permeabilities deviate strongly from the experimental measurements in this case the scatter of the predicted values to the measured values is strongly disordered and cannot be reasonably described by the fitted regression line r squared 0 56 except for a high measured water relative permeability the mechanistic model largely overestimates the experimental data up to a factor of 7 for low relative permeabilities the average relative error is about 2 2 and the standard deviation of the relative error is 2 15 for both sandstones the cross plot of calculated oil relative permeability against the measured oil relative permeability can be represented by the fitted regression line fig 15 with a r squared of 0 95 and 0 99 the cross plot for the three phase oil relative permeability is characterized by two regions for measured oil relative permeability below 0 1 the predicted permeabilities are significantly higher than those observed attaining kr values 10 times or more for measured oil relative permeabilities higher than 0 1 the oil relative permeabilities predicted by the mechanistic model are about 60 and 25 lower than the measured kr values in the case of berea sandstone and bentheimer sandstone respectively however the average relative errors were quantified to 3 25 4 75 for berea sandstone and 1 27 2 78 for bentheimer sandstone respectively the obtained global overestimate of measured oil relative permeabilities is clearly attributed to the weight of the large number of experimental data with oil relative permeabilities lower than 0 1 analyzing the fitted regression line of the cross plot shown in fig 16 one could again conclude that the predicted gas relative permeabilities underestimated the measured data of the berea sandstone and bentheimer sandstone by about 10 and 30 respectively but the average relative error of about 1 69 6 71 quantified for the experimental data of berea sandstone does not give the same conclusion apparently the mechanistic model overestimates the low relative permeabilities measured in the experiment even by factor of 10 and more the large number of data close to the origin does not strongly influence the slope of the regression line but have a strong impact on the average relative error in the case of bentheimer sandstone the maximum relative errors observed for the predicted gas relative permeability do not exceed 1 5 for the extremely low gas relative permeabilities measured in the experiment 4 2 total differential td compatible model 4 2 1 prediction of global mobilities the td compatible model introduced by di chiara roupert et al 2010a 2010b quantifies in the first major step the global mobilities in the ternary diagram by numerical resolution of the laplace equation note that on the three edges of the ternary diagram the global mobilities are prescribed using the known individual phase mobilities in the two phase systems in the td compatible model the global mobility at saturation level s s1 s3 and global pressure p are defined as follows 14 d s k r 1 s d 1 k r 2 s d 2 k r 3 s d 3 where dj and krj denote the mobility and relative permeability of phase j 1 water 2 oil and 3 gas water and oil are supposed to be incompressible fluids while the dynamic viscosities of the fluid phases μj are supposed to be constant and independent of the pressure level variation of gas density ρ3 with gas pressure p3 is taken into account in the computation of gas mobility the phase mobilities are expressed by 15 d 1 1 μ 1 d 2 1 μ 2 d 3 1 μ 3 ρ 3 p 3 ρ 3 1 μ 3 b 3 where ρ 3 is the gas density at reference pressure and b3 is the volume factor in our study we extended the original td compatible model by integrating experimentally based residual saturations of the wetting fluid into two phase systems to numerically integrate the relative permeabilities of the non wetting fluids into the three edges required for complete computation of the global mobilities on the edges we linearly extrapolated the kr values between the experimentally quantified maximum relative permeability of the non wetting fluid krnw max and 1 an illustrative example of the modifications is shown in fig 17 for the oil gas edge of bentheimer sandstone in the following we first discuss the application of the td compatible model to the bentheimer sandstone then use the experimental data available for the berea sandstone to test the prediction of global mobilities using the td compatible model 4 2 1 1 bentheimer sandstone based on the model input parameter outlined in appendix c and the fluid properties and experimental conditions of the ddi flow tests performed on bentheimer sandstone see section 3 1 section 3 2 the two phase relative permeabilities and global mobilities on the three sides of the ternary diagram were quantified as shown in fig 17 to parameterize the required capillary pressure curves in a water oil and oil gas system we used both the model parameters of the water retention curve in the water gas system described in appendix c and the scaling factors βij for the fluid system oil water and gas oil based on the measured interfacial tensions fluid couples gas water oil water and gas oil see table 2 to model the global mobilities on the ternary diagram we used a spatial discretization of 0 01 saturation intervals the simulated global mobilities are shown in fig 17 in form of isovalues ranging from 144 to 53 650 mskg 1 to compare the simulated global mobilities with the experimental data of the three ddi flow experiments a c and d1 we first extracted from our numerical results the global mobilities for the corresponding experimental saturations s1 s2 and s3 the experimental phase mobilities were then determined from eq 15 using the dynamic viscosities table 2 the variation of the volume factor b3 with gas pressure could be considered negligible nevertheless we can infer from the resolution of the global capillary pressure on the ternary diagram that the difference in gas pressure p3 compared to the reference gas pressure of 55 157 atm is very small the minimum gas pressure water summit was approximately 55 161 atm while the maximum gas pressure gas summit was approximately 55 205 atm thus the resulting volume factor of the gas b3 eq 15 varied between 0 99999 and 1 00082 fig 18 shows the comparison of global mobilities predicted by the model and those experimentally determined from ddi experiments a c and d1 apart from ddi experiment d1 the simulated global mobilities strongly overestimate the experimental data the relative error in ddi experiment a is highest with an approximate value of 8 26 9 16 in experiment c re 2 35 1 91 its maximum relative error of 24 is observed for a gas saturation of 0 11 when approaching the gas summit at sg 0 57 the relative error decreases to 1 2 model predictions however are reasonably good in the area where water is under irreducible saturation ddi experiment d1 the td compatible model just slightly overestimates the experimental global mobilities in this case the relative error does not significantly decrease with increasing gas saturation and is quantified to be approximately 0 34 0 18 4 2 1 2 berea sandstone based on the model input parameter outlined in appendix c and the fluid properties and experimental conditions of the ddi flow tests performed on berea sandstone see section 3 2 the two phase relative permeabilities and global mobilities on the three sides of the ternary diagram were quantified as shown in fig 19 to model the global mobilities on the ternary diagram we used a spatial discretization of 0 01 saturation intervals to parameterize the required capillary pressure curves for the water oil and oil gas system we used the model parameters of the capillary pressure curve measured in the water oil system as the irreducible water saturation swi obtained in the two phase flow experiments was higher than that obtained from the capillary pressure curve we used the fit parameters obtained when swi was set to 0 26 we derived the scaling factor βgo required for the fluid system gas oil from the ratio of parameters α quantified in the water oil and oil gas system which was about 1 67 the simulated global mobilities are shown in fig 19 in form of isovalues ranging from 144 to 57 112 mskg 1 the maximum global mobilities determined at the gas summit are about 7 higher than those quantified for the bentheimer sandstone this is due to the maximum capillary pressures measured for berea sandstone at irreducible wetting fluid saturation which are approximately 10 times higher than those of bentheimer sandstone for the same reference pressure of 55 157 atm applied on the rock samples the maximum gas pressures is achieved at the gas summit to 58 908 atm whereas at the water and oil summits the corresponding gas pressures were calculated by the td compatible model to about 55 157 and 55 329 atm respectively thus the compressibility of the gas phase results in a volume factor b3 whose maximum value at the gas summit is about 1 068 however for gas saturations below 0 6 the quantified volume factor b3 was below 1 003 the maximum gas saturation achieved in oak s ddi experiment is below 60 and its effect on the computation of experimental global mobilities see eq 15 can be ignored after extracting the global mobilities corresponding to the experimental data of the seven ddi flow experiments the numerical results were compared with the experimentally determined global mobilities fig 20 the same general trend was observed for bentheimer sandstone the predictions overestimate the observations and with increasing gas saturations the differences become acceptable for low gas saturations up to 30 or 35 the simulated global mobilities strongly overestimate the experimental data by a factor of 2 and more for example in the case of ddi experiment 15 the maximum relative error was quantified to about 8 3 for a measured gas saturation of about 13 whereas for a gas saturation of 59 the relative error decreased to about 0 3 the highest average relative error was quantified for the prediction of global mobilities of experiment 25 re 24 07 31 89 4 2 2 prediction of global mobilities using local experimental data in both test cases the predicted global mobility overestimates the actual physical values to obtain values close to the experimental global mobilities we partially constrained the model of three phase permeabilities respecting the condition of total differential with regard to measurements therefore we implemented the possibility of imposing locally inside the ternary diagram global mobilities derived from experimental data in the interpolation by finite elements c0 the use of other two dimensional interpolation models of global mobilities between the numerical values given at the edges of the ternary diagram such as the lagrange interpolation polynomials was not considered as a very promising improvement over the current interpolation method since the predictions are well above the experimental data in order to constrain our interpolation method we used one third of the experimental data available for the bentheimer and berea sandstone ddi experiments to measure local global mobility uniformly distributed within the ternary diagram the resulting improved global mobilities will then be used based on eq 4 to predict the three phase relative permeabilities water oil gas for bentheimer sandstone and berea sandstone section 4 2 3 4 2 2 1 bentheimer sandstone the improved global mobilities obtained for experiments a c and d1 are shown in fig 18 using locally prescribed mobilities derived from 13 measuring points the relative errors of the simulated mobilities obtained for experiment a c and d1 are significantly reduced but still overestimate the experimental data in the case of experiment a and c the relative error is now approximately 2 30 3 67 and 0 49 0 58 respectively whereas the relative error for the predicted mobilities of experiment d1 becomes very low re 0 07 0 09 note that experiment d1 corresponds to a saturation path where water is at irreducible saturation and thus parallel to the gas oil edge of the ternary diagram 4 2 2 2 berea sandstone the improved global mobilities obtained for experiments 16 17 and 18 are shown in fig 20 using locally prescribed mobilities derived from 34 measuring points the relative errors of the simulated mobilities obtained for experiments 15 20 and 25 are reduced but still largely overestimate the experimental data for example in the case of experiment 16 the relative error is now approximately 0 12 0 30 instead of 2 74 2 67 whereas the average relative error for the predicted mobilities of experiment 20 is also reduced from re 1 94 2 39 to re 0 15 0 32 note that the highest average relative error of simulated global mobilities is still observed in experiment 25 which is however significantly reduced by a factor of approximately 16 re 1 49 3 90 4 2 3 prediction of relative permeabilities in a three phase system the numerical construction of the global capillary pressure p c g is performed by finite elements c1 step 5 described in table 1 using bi laplacian interpolation of the global capillary pressure prescribed on edges ij of the ternary diagram where tangential and normal derivatives of p c g are respectively fixed as dirichlet and neuman boundary conditions appendix e to quantify the global capillary pressure on the ternary diagram we used a spatial discretization of 0 01 saturation intervals based on the td compatibility condition introduced by chavent 2009 two inequalities have to be respected di chiara roupert et al 2010 16 β 13 t p c 12 1 t p c 12 0 β 23 t β 13 t a β 13 t p c 32 t β 12 t β 13 t b where β ij is the global capillary pressure on edges ij of the ternary diagram p c 12 and p c 32 are the capillary pressure in a two phase water oil and gas oil system respectively and t is the saturation parameter varying between zero and one the water fractional flow f1 and gas fractional flow f3 are obtained from the derivatives of the global capillary pressure function pc g and the derivatives of capillary functions p c 12 and p c 32 di chiara roupert et al 2010a 17 f 1 s p p c g s 1 s p d p c 12 s 1 d s 1 1 f 3 s p p c g s 3 s p d p c 32 s 3 d s 3 1 the oil fractional flow f2 is then quantified using the expression 18 f 2 s p 1 f 1 s p f 3 s p using the phase mobilities dj global mobility d and fluid fractional flows fj calculated for a given water saturation s1 and gas saturation s3 the relative permeabilities to water oil and gas are then derived from eq 4 4 2 3 1 bentheimer sandstone the analyses of the two inequalities described by eq 16 are presented in appendix e both conditions are evaluated as functions of t and shown in form of a comparison of three curves fig e2 appendix e while condition b is respected for all saturation parameters t condition a is only satisfied for t 0 78 for t values higher than 0 78 β23 t is higher than β13 t note that the irreducible water saturation swi in the two phase water gas system was quantified to 0 22 here the td compatible model is not applicable for gas saturations higher than 1 swi we therefore modified the numerical approach originally introduced by di chiara roupert et al 2010a instead of solving the biharmonic problem over the entire ternary diagram in our computation we omitted the immobile water zone near the gas summit along this new border the limit value of β13 t 0 78 on each node of the mesh is fixed as known dirichlet boundary value of the global capillary pressure and its corresponding normal derivative belonging to the border the biharmonic problem of step 5 table 1 is solved using hct finite elements at the given experimental global pressure level of p 55 16 atm corresponding to 800 psig in our simulations we used small saturation intervals of 0 005 to produce a sufficiently smooth map of the global capillary pressure function pc g and its two derivatives with respect to s1 and s3 eq 17 once the three maps are calculated the water and gas fractional flows f1 and f3 are then derived using eq 17 fig 21 shows the results of two numerical studies performed a the so called predicted distribution of the global capillary pressure and the derived fractional flows of water and gas b the corresponding simulated distributions when using 13 local experiments based on water and gas fractional flows the 13 local points selected are the same points as in the previous global mobilities studies while on the three edges of the ternary diagram and their neighborhood the water and gas fractional flows reflect the prescribed physical values of the two phase systems in the ternary diagram however they appear as zones of unphysical values when approaching the water summit the water fractional flows exceeds locally the maximum value of 1 and simultaneously the gas fractional flow is below 0 a similar effect but more pronounced in form of an elongated bump is observed for the distribution of the gas fractional flow when approaching the gas summit the gas fractional flows largely exceed the physical upper limit of 1 while the water gas fractional flow become locally negative it is worth noting here that the distribution of pc g is not significantly modified when using locally prescribed water and gas fractional flows observing closely pc g differs only locally in the neighborhood of the 13 fitting points at maximum by about 35 pa and is thus not visible in the chosen colormap of pc g however the maps of f1 and f3 are locally adjusted to the physical conditions of the ddi experiments which is visible in fig 21b this helped to locally reduce the height of the bump of f3 therefore and to be consistent with the improvement achieved in the case of global mobilities the numerical results obtained with modeling approach b were further considered the relative permeabilities to water oil and gas are then obtained from the td compatible model using eq 4 fig 22 shows the comparison of relative permeabilities measured from experiment c with those predicted by the td compatible model the detailed comparison of predicted kr values water oil gas for experiments a and d1 with those experimentally measured is documented in appendix e figs e3 and e4 in view of the fact that f2 is derived from f1 and f3 according to eq 18 it is not surprising that the majority of the predicted relative permeabilities of oil is not physical the high positive value of crm also indicates that the td compatible model largely underestimates the measurements as the water and gas fractional flows predicted for ddi experiment c are mostly positive we can use both global mobilities and fractional flows to compare the measured water relative permeabilities and gas relative permeabilities with those predicted the predicted water relative permeabilities largely overestimate the measured values in addition in the case of experiment c the tendency of decreasing water relative permeabilities with increasing water saturation is not consistent with the laws of physics however in the case of experiment a fig e3 the predicted positive water relative permeability increases with water saturation the prediction of gas relative permeabilities is rather acceptable with the td compatible model as shown in figs 22 e3 and e4 the predicted gas relative permeabilities increase with gas saturation but still overestimate the experimentally measured values by a factor of approximately 1 5 to 2 4 2 3 2 berea sandstone the analyses of the two inequalities described by eq 16 are presented in appendix e both conditions are evaluated as functions of t and shown in form of a comparison of three curves fig e5 while condition b is respected for all saturation parameters t condition a is only satisfied for t 0 62 for t values higher than 0 62 β23 t is higher than β13 t note that the irreducible water saturation swi in the two phase water gas system was quantified to 0 38 here the td compatible model is not applicable for gas saturations higher than 1 swi we then applied the same choices for this inner boundary close to the gas summit and solved the biharmonic problem of step 5 table 1 as described in section 4 2 3 1 fig 23 illustrates the results of calculated distribution of the global capillary pressure and the derived fractional flows of water and gas using 34 local experiment based water and gas fractional flows the chosen 34 local points are the same as in the previous global mobilities studies here the global capillary pressures prescribed along the three edges of the ternary diagram vary between 20 000 and 15 000 pa due to the high capillarity of berea sandstone compared to bentheimer sandstone the difference between the minimum and maximum value of pc g is approximately ten times higher than in the previous study in contrast to fig 21 the obtained distribution shows a strong local decrease of pc g funnel shaped in the middle of the ternary diagram this results in high negative values of gas fractional flow in addition as already observed for the bentheimer sandstone an elongated bump along the water gas side appears when approaching the gas summit the calculated distribution of water fractional flow is smoother than in the case of bentheimer sandstone however the physical upper limit of 1 is exceeded with a maximum value of 1 7 in regions along the water gas side and close to the water summit since the quantified gas fractional flows are significantly below or above the physical limits of 0 and 1 respectively a further interpretation of the gas fraction in terms of gas relative permeabilities is not possible therefore as in the case of bentheimer sandstone the relative oil permeabilities in the three phase system is not likely to be determined the only possible interpretation is therefore limited to the quantification of relative water permeabilities using eq 4 as the water fractions determined represent physical values except for a small area in the diagram the calculated water relative permeabilities are compared with the experimental data of ddi experiments 15 fig 24 and experiments 18 fig 25 the detailed comparison of predicted water relative permeabilities for experiments 16 17 19 and 25 with those experimentally measured is documented in appendix e figs e6 and e7 generally the measured water relative permeabilities are largely overestimated by the td compatible model the majority of the predicted values clearly exceed the physical upper limit of 1 which is mainly due to the water fractional flow determined some of which are two orders of magnitude higher than the experimental fractional water flows this is clearly shown for example in the case of ddi experiment 15 fig 24 in this case the physical upper limit of the water fractional flow of 1 is not exceeded but the water relative permeability clearly exceeds the maximum value of 1 for example at a water saturation of 0 32 the water fractional flow is about 0 182 which highly overestimates the experimental value f1 0 and the calculated ratio of global mobility to water mobility d d1 is about 27 the product of f1 and d d1 then gives the high physically unrealistic numerical value of 4 92 for water relative permeability as shown in fig 24 the predicted ratios of global mobility to the water mobility are relatively close to the experimentally determined ratios in the case of experiment 18 the predicted water relative permeabilities are obviously below 1 but in addition as in the other ddi experiments the experimentally determined water relative permeabilities are clearly exceeded fig 25 the residual mass coefficient crm calculated here is 439 which clearly demonstrates the overestimation of the measured values it should be noted that the global mobilities estimated are rather similar to the measured values 4 3 parker lenhard model 4 3 1 application to bentheimer sandstone table 8 summarizes the model input parameters used for the application of the parker lenhard model to the bentheimer sandstone they were obtained by nonlinear fit of the van genuchten 1980 model to alizadeh s capillary pressure curve measured for soil sample b in a water gas system r squared cod 0 986 or by nonlinear fit of the mualem van genuchten model to alizadeh s experimental water relative permeability water saturation curve r squared 0 994 see appendix f 1 note in the latter case m was the only fit parameter as the irreducible water saturation swi was fixed and taken equal to the experimentally determined value fig 26 shows the comparison of relative permeabilities measured from experiment c with those predicted by the parker lenhard model for both modeling options the detailed comparison of predicted kr values water oil gas for experiments a and d1 with those measured by alizadeh 2013 is documented in appendix f globally the relative permeabilities to water oil and gas predicted with both modeling options overestimate the measured kr values fig 26 annexe f figs f2 and f3 the best prediction of the water relative permeability is achieved with option kr s which results in lowest rmse values and smallest negative coefficients of residual mass crm note that in the case of experiment d1 which is conducted at irreducible water saturation both modeling options satisfactorily predict the measured water relative permeabilities the oil relative permeabilities predicted by modeling option pc s still overestimate the experimental data but are generally closer to the measured kr values than modeling option kr s surprisingly the measured gas relative permeabilities are strongly overestimated by both modeling options as shown in figs 26 f 2 and f 3 the predicted relative permeabilities to gas are rather close to each other and overvalue the experimentally quantified permeabilities also for experiment d1 by a factor of 2 to 3 this is even surprising as the oil relative permeability for experiment d1 is satisfactorily predicted by both modeling options 4 3 2 application to berea sandstone table 9 summarizes the model input parameters used for the application of the parker lenhard model to the berea sandstone they were obtained by nonlinear fit of the van genuchten 1980 model to oak s capillary pressure curve measured for soil sample 6 in a water gas system r squared cod 0 995 or by nonlinear fit of the mualem van genuchten model to oak s experimental water relative permeability water saturation curve r squared 0 972 see appendix f 2 note in the latter case m was the only fit parameter as the irreducible water saturation swi was fixed and taken equal to the experimentally determined value the numerical results obtained for the berea sandstone are shown in fig 27 and in appendix f2 globally using modeling option kr s the relative permeabilities for water oil and gas are overestimated by both modeling options modeling option pc s underestimates the measured water relative permeabilities and except for experiments 19 and 25 also the oil relative permeability whereas the gas relative permeability is globally overestimated the water and gas relative permeabilities predicted by modeling option kr s are closer to the measured kr values than with modeling option pc s as underlined by the rmse values however the oil relative permeabilites are better predicted with modeling option pc s than with modeling option krw as shown in fig 27 in the case of experiment 15 modeling option pc s strongly overestimates the measured gas relative permeability whereas the oil relative permeability is underestimated by the modeling approach in the latter case here a better prediction with lower rmse is obtained than with modeling option kr s the quantified coefficient of residual mass crm also indicates that the measured values are only slightly underestimated whereas a strong overestimation is observed with option kr s the detailed comparison of predicted kr values water oil gas for experiments 16 20 25 with those measured by oak 1990 is documented in appendix f 4 3 3 global analysis of predicted three phase relative permeabilities for further investigation of the accuracy of the model the three phase relative permeabilities predicted by the model for each fluid phase are plotted against the measured relative permeabilities obtained for berea and bentheimer sandstone figs 28 30 each figure also contains a description of the quantified relative error as a function of the measured relative permeability in the three phase system in the case of berea sandstone as shown by the cross plot fig 28 the water relative permeability is reasonably well predicted by model option kr s globally it slightly overestimates the measured kr values characterized by a relative error of about 0 13 0 72 it is worthwhile to note that for relative permeabilities higher than 0 04 the predicted values closely approaches the measured relative permeabilities however model option pc s strongly underestimates the measured water relative permeabilities re 0 96 0 02 for the whole set of experimental data in the case of bentheimer sandstone model option kr s also seems as the better option to predict the measured water relative permeabilities here both options overestimate the experimental data re 0 85 1 85 kr s re 4 72 3 86 pc s the deviation from the 1 1 line is high for measured water relative permeabilities lower than 0 01 in the case of modeling option pc s the maximum relative error achieves values higher than 15 the oil relative permeabilities predicted for the berea sandstone fig 29 show the same general trend as observed for the water relative permeabilities modeling option kr s overestimates and modeling option pc s underestimates the measured relative oil permeabilities however here modeling option kr s strongly overestimates the experimental data characterized by a large spreading around a high mean relative error re 12 59 15 65 whereas modeling option pc s seems to be the best option for predicting the experimental data re 0 16 0 90 even if the deviation from the 1 1 line increases with increasing measured oil relative permeabilities in the case of bentheimer sandstone both modeling options again overestimate the measured oil relative permeabilities re 7 01 15 66 kr s re 3 80 7 59 pc s it is worth noting here that the deviation of predicted oil relative permeabilities from the experimental data is also high for very low oil relative permeabilities 0 01 they attain maximum relative errors of up to 80 and 40 for modeling option kr s and modeling option pc s respectively globally the best results are obtained with modeling option pc s it satisfactorily predicts the experimental data as shown by the small deviations from the 1 1 line when the measured relative permeabilities exceed 0 05 using the parker lenhard model the gas relative permeabilities predicted for berea sandstone and bentheimer sandstone strongly overestimate the measured gas relative permeabilities fig 30 the relative errors of the prediction are quantified to 5 64 17 16 kr s and 38 75 128 63 pc s for berea sandstone and 3 16 3 29 kr s and 4 41 5 41 pc s for bentheimer sandstone respectively as already mentioned before the maximum relative errors appear for very low relative permeabilities 0 01 in the case of berea sandstone the maximum relative errors attain values of 1000 option kr s and 100 option pc s whereas for bentheimer sandstone achieve values of about 26 option kr s and 14 option pc s even for higher relative permeabilities measured for both sandstones the predicted gas relative permeabilities overestimate globally the experimental data at least by a factor of 2 4 4 stone s model i the numerical simulations performed with stone s model i concern only the oil relative permeability in a three phase system table 10 summarizes the model input parameter used for the application of stone s model i to the bentheimer sandstone and berea sandstone they were obtained by nonlinear fit of the mualem van genuchten model van genuchten 1980 to the experimental two phase gas oil oil water relative permeability saturation curves measured for bentheimer sandstone alizadeh 2013 and berea sandstone oak 1990 see tables c1 and c2 4 4 1 application to bentheimer sandstone fig 31 shows the comparison of predicted oil relative permeability versus oil saturation with those measured in ddi experiments a c and d1 alizadeh 2013 here the average model prediction errors are acceptable the rmse values vary between 0 0108 experiment a to 0 0218 experiment c surprisingly the oil relative permeabilities measured in experiments c and d1 are reasonably well predicted by stone s model i here the coefficients of residual mass crm range between 0 685 and 0 103 in the case of experiment a stone s model overestimates globally the measured oil relative permeability by up to a factor of 4 to 8 at oil saturations close to the residual oil saturation 4 4 2 application to berea sandstone fig 32 shows the comparison of predicted oil relative permeability versus oil saturation with those measured in ddi experiments 15 20 and 25 oak 1990 the agreement of the predicted relative oil permeabilities with the measurement results is relatively good for experiments 15 16 17 and 20 larger deviations are observed especially in experiments 19 and 25 the reason for the strong underestimation of the measured oil permeabilities crm 1 is that the stone i model sets the relative permeabilities for all oil saturations smaller than the residual saturations sor 0 259 to zero 4 4 3 cross plot of oil relative permeabilities predicted by stone s model i against the experimental three phase kr values measured on berea and bentheimer sandstone for further investigation of the accuracy of stone s model i the three phase oil relative permeability predicted by the model is plotted against the experimental oil relative permeability measured for berea and bentheimer sandstone fig 33 the figure also contains a description of the quantified relative error as a function of the measured oil relative permeability in the three phase system in the case of berea sandstone as shown by the cross plot fig 33 the oil relative permeability is reasonably well predicted by stone s model i globally it slightly underestimates the measured kr values characterized by a relative error of about 0 31 1 07 the highest relative errors are observed for very low oil relative permeabilities attaining a maximum relative error of about 4 at a measured relative permeability of 0 01 it is worthwhile to note that for relative permeabilities higher than 0 3 the predicted values closely approaches the measured relative permeabilities here the scatterplot of predicted kr values against the measured data can be described by a linear regression r squared 0 966 whose slope is close to one the oil relative permeabilities predicted for bentheimer sandstone show a different behavior than berea sandstone here the simulation based on stone s model i significantly overestimates the measured relative oil permeabilities with a high average relative error and an associated large variance re 1 74 2 68 just as the berea sandstone the maximum relative errors appear at low values of measured oil relative permeability however for higher values of experimental relative permeability for example above 0 2 the predicted oil relative permeabilities systematically underestimate the measured values by about 25 and are well described by the fitted straight line of linear regression r squared 0 987 5 discussion 5 1 global analysis of predicted three phase relative permeabilities for further evaluation of the accuracy of the 4 different models used to predict three phase relative permeabilities measured in ddi experiments conducted on bentheimer and berea sandstones the relative errors re identified in the previous section are summarized in table 11 individually for each fluid phase in the following the main results presented in table 11 will be discussed with respect to each of the three phase relative permeabilities 5 1 1 three phase water relative permeability in the case of berea sandstone the water relative permeability is reasonably well predicted by the mechanistic model globally it slightly overestimates the measured kr values nonetheless for the bentheimer sandstone the predicted water relative permeabilities varies significantly from the experimental measurements except for a high measured water relative permeability the mechanistic model largely overestimates the experimental data up to a factor of 7 for low relative permeabilities the average relative error is about 2 2 and the standard deviation of the relative error is 2 15 the td compatible model provided quantifiable results on water relative permeabilities the water relative permeabilities measured on both bentheimer sandstone and berea sandstone are highly overestimated by the td compatible model with the corresponding relative errors being very large using the parker lenhard model the water relative permeability measured for the berea sandstone was reasonably well predicted by model option kr s globally it slightly overestimates the measured kr values it should be noted that for relative permeabilities higher than 0 04 the predicted values closely approaches the measured relative permeabilities however model option pc s strongly underestimates the measured water relative permeabilities for the entire set of experimental data in the case of bentheimer sandstone model option kr s also seems the better option to predict the measured water relative permeabilities in this case both options overestimate the experimental data in the case of modeling option pc s the maximum relative error achieves values higher than 15 5 1 2 three phase oil relative permeability using the mechanistic model the predicted oil relative permeabilities are partially acceptable for measured oil relative permeability below 0 1 the predicted permeabilities are significantly higher than those observed attaining kr values 10 times or more for measured oil relative permeabilities higher than 0 1 the oil relative permeabilities predicted by the mechanistic model are about 60 and 25 lower than the measured kr values in the case of berea sandstone and bentheimer sandstone respectively however the relative errors were quantified to 3 25 4 75 for berea sandstone and 1 27 2 78 for bentheimer sandstone respectively the obtained global overestimate of measured oil relative permeabilities is clearly attributed to the weight of the large number of experimental data with oil relative permeabilities lower than 0 1 the oil relative permeabilities predicted for the berea sandstone using the parker lenhard model show similar trend as those for the water relative permeabilities modeling option kr s overestimates and modeling option pc s underestimates the measured relative oil permeabilities however here modeling option kr s strongly overestimates the experimental data characterized by a large spreading around a high mean relative error whereas modeling option pc s seems as the best option for predicting the experimental data in the case of bentheimer sandstone both modeling options again overestimate the measured oil relative permeabilities it should be noted here that the deviation of predicted oil relative permeabilities from the experimental data is also high for very low oil relative permeabilities 0 01 they attain maximum relative errors of up to 80 and 40 for modeling option kr s and modeling option pc s respectively globally the best results are obtained with modeling option pc s it was shown that in the case of berea sandstone the oil relative permeability is reasonably well predicted by stone s model i globally it slightly underestimates the measured kr values the highest relative errors are observed for very low oil relative permeabilities attaining a maximum relative error of about 4 at a measured relative permeability of 0 01 the oil relative permeabilities predicted for bentheimer sandstone show a different behavior than berea sandstone here the simulation based on stone s model i significantly overestimates the measured relative oil permeabilities with a high average relative error and an associated large variance just as the berea sandstone the maximum relative errors appear at low values of measured oil relative permeability 5 1 3 three phase gas relative permeability using the mechanistic model the predicted gas relative permeabilities underestimated the measured data of the berea sandstone and bentheimer sandstone by about 10 and 30 respectively but the average relative error of about 1 69 6 71 quantified for the experimental data of berea sandstone does not provide the same conclusion apparently the mechanistic model overestimates the low relative permeabilities measured in the experiment even by factor of 10 and more in the case of bentheimer sandstone the measured gas relative permeabilities are well represented by the model predictions the maximum relative errors do not exceed 1 5 for the extremely low gas relative permeabilities measured in the experiment the td compatible model provided only reliable predictions for the bentheimer sandstone the difficulties described in section 4 2 the very high capillarity of berea sandstone poses problems in the interpolation of the global capillary pressure and its derivatives with respect to water saturation s1 and gas saturation s3 using the parker lenhard model the gas relative permeabilities predicted for berea sandstone and bentheimer sandstone strongly overestimate the measured gas relative permeabilities the maximum relative errors are observed for very low relative permeabilities 0 01 in the case of berea sandstone the maximum relative errors attain values of 1000 option kr s and 100 option pc s whereas for bentheimer sandstone values of about 26 option kr s and 14 option pc s are achieved even for higher relative permeabilities measured for both sandstones the predicted gas relative permeabilities overestimate the experimental data globally by at least a factor of 2 5 2 existence of elliptic zones in the ternary diagram the existence and importance of elliptic zones in a water oil napl gas ternary diagram when using the mechanistic model will be discussed in appendices g 4 and g 5 the results obtained with the parker lenhard model and stone s model i are presented the percentage of saturation space covered by elliptic regions quantified for the three models are summarized in table 12 it should be noted that the three fluid saturations in the ternary diagram range from 0 to 1 few authors used effective saturations in their studies e g jackson and blunt 2002 the starting point is the mass conservation equation for an incompressible immiscible three phase flow which can be written in terms of two saturation equations for water α 1 and gas phases α 3 eq g2 appendix g in the case of zero capillary pressure the dimensionless system of saturation equations can be linearized in terms of two saturation gradients involving a jacobian matrix j as follows 19 t d s 1 3 j z d s 1 3 0 with j f 1 s 1 f 1 s 3 f 3 s 1 f 3 s 3 where zd and td are the dimensionless distance and time appendix g f 1 and f 3 are fractional flow functions of water and gaz respectively defined as 20 f 1 λ 1 λ t 1 n g ρ d 1 k r 2 ρ d μ 2 μ 3 k r 3 21 f 3 λ 3 λ t 1 n g ρ d μ 2 μ 1 k r 1 k r 2 with the gravity number n g k ρ 2 ρ 3 g μ 2 v t o t ρ d ρ 1 ρ 3 ρ 2 ρ 3 is the density ratio λα is the phase mobility and λ t is the total mobility defined as λ t α k r α μ α eigenvalues u d of the jacobian matrix j can then be expressed as follows 22 u d 1 2 f 1 s 1 f 3 s 3 f 1 s 1 f 3 s 3 2 4 f 1 s 3 f 3 s 1 the corresponding partial derivatives of fractional flow functions f 1 and f 3 are detailed in appendix g to compute elliptic regions that provide numerical instabilities we analyzed the sign of the square root argument of eq 22 within the ternary diagram a large set of fluid saturations was studied in order to display complex eigenvalues that correspond to a negative square root argument to validate our search algorithm of negative square root arguments of eq 22 we first used the model of bell and compared the identified elliptic zones with those quantified by jahanbakhshi et al 2013 appendix g 3 furthermore the influence of gravity and total velocities on the extent of elliptic zones are synthetically discussed in appendix g 5 2 1 bentheimer sandstone the fluid properties of experiments conducted on bentheimer sandstone table 2 the intrinsic permeability of the rock k 2 63 10 12 m2 and the quantified characteristic coefficients aij summarized in table 7 of the three modeling options a c and ac were used to study the possible existence of elliptic zones in the ternary diagram in a first modeling step gravity effects were neglected the results obtained for options a c and ac are shown on the left side of fig 34 in all three modeling options there is a very small elliptic zone on the water oil side with a percentage area of less than 1 the double dependency on water and gas saturation as in stone s model has often been pointed as proof for the existence of an elliptic zone modulo with certain constraints on viscosities trangenstein 1989 jackson and blunt 2002 here the elliptic region however is a narrow zone located near the water oil edge with gas saturations below 5 while the oil saturations range between 50 and 80 to study the influence of gravity on the extent and distribution of elliptic zones in the ternary diagram we used a series of total velocities which are in the range of total velocities applied in alizadeh s ddi experiments in all modeling options when the total velocity is equal to 1 5 10 4 ms 1 the area of the elliptic zone represents less than 1 of the total area of the ternary diagram however the further decrease of the total velocity significantly alters the area and form of the elliptic zone for example in modeling option c the elliptic zones are significantly larger with almost 30 of the total surface for a velocity that is ten times lower note that all three models are characterized by the occurrence of elliptic regions where the directions associated with the eigenvectors coincide for a velocity that is one hundred times lower the elliptic zone will again become smaller and occupy only 10 of the total area of the ternary diagram table 12 modeling option c seems to generate larger elliptic zones located near the water gas side than options a and ac particularly when water saturation is greater than 50 in modeling option a the elliptic zone appearing for a total velocity of 1 5 10 5 ms 1 is nearly the same as in modeling option ac it represents about 20 of the total surface of the ternary diagram just as option c with decreasing total velocity the elliptic zones are smaller for a velocity that is ten times lower the occupied surface attains about 15 of the total surface it should be noted that the use of the mechanistic model leads to a plurality of elliptical zones which was not the case when using bell s model fig g2 appendix g or was not observed in the jackson and blunt 2002 experiments on a pore scale model manufactured with a bundle of cylindrical capillary tube the number of elliptic zones between two and three is a function of the total velocities and is located in very different sectors of the ternary diagram note that in the case of very low total velocities corresponding to high gravity numbers of 5 a large fraction is found in the region of irreducible water saturation 5 2 2 berea sandstone a second study on the existence of elliptic zones was conducted with the mechanistic model using the experimental data of the berea sandstone table 3 and the intrinsic permeability of the rock k 1 97 10 13 m2 the quantified characteristic coefficients aij summarized in table 5 were used to study the possible existence of elliptic zones in the ternary diagram the results of the study are presented in fig 35 with the reference case without gravity in the absence of gravity elliptic zones are almost nonexistent compared to the zones identified for the bentheimer sandstone fig 34 significant elliptic regions appear only for total velocities lower than 2 10 5 ms 1 by decreasing the total velocity the percentage area of saturation space covered by elliptic regions progressively increases up to about 42 at a total velocity of 5 10 6 ms 1 a further decrease in total velocities will lead to a continuous reduction in the percentage area occupied by the elliptic regions which becomes stable around 10 for total velocities between 1 5 10 7 and 1 5 10 8 ms 1 fig 35 table 12 summarizes the percentage area covered by elliptic regions for total velocities of 1 5 10 5 1 5 10 6 and 1 5 10 7 ms 1 which are in the range of total velocities applied in oak s ddi experiments it is worth noting that for gravity numbers lower than 0 5 the elliptic region is located at the water summit and forms a single patch increasing the gravity number will lead to an increase in the elliptic region accompanied by a separation of the single patch in two or more sub areas up to a gravity number of about 1 11 corresponding to a total velocity of about 9 10 6 ms 1 the saturation space covered by elliptic zones is mainly located in the ternary diagram where water is mobile the main part of the elliptic region is situated above the gravity number 3 3 in an irreducible water zone 6 conclusions and future work in this study two recent and two classical models were evaluated against experimentally measured three phase permeabilities experimental data generated on two different water wet sandstones were selected from the literature to evaluate and compare the four mathematical models experimentally determined constitutive relationships in two phase systems were used as input parameters to numerically predict relative permeabilities kr in three phase systems and then the estimated results were compared with experimental three phase permeabilities measured along decreasing water saturation decreasing oil saturation increasing gas saturation ddi paths 6 1 which models yield results that best match flow experiments globally the best prediction of the measured kr values was obtained with the mechanistic model of shahverdi and sohrabi 2017 however its implementation requires a preliminary calibration of the relative phase permeabilities in a three phase system against experimental data along one ddi path to quantify the required six characteristic coefficients our study showed that the parker lenhard model provides very different predicted kr values that are strongly dependent on the method used to determine the van genuchten parameter m globally the oil relative permeabilities predicted for the berea sandstone using the parker lenhard model shows the same general trend as observed for the water relative permeabilities modeling option kr s overestimates and modeling option pc s underestimates the measured relative oil permeabilities furthermore using the parker lenhard model the gas relative permeabilities predicted for berea sandstone and bentheimer sandstone are significantly higher than the measured gas relative permeabilities in the case of berea sandstone the oil relative permeability is reasonably well predicted by stone s model i nevertheless the oil relative permeability expected for bentheimer sandstone indicates a different behavior than berea sandstone in this case the simulation based on stone s model i significantly overestimates the measured relative oil permeabilities with a high average relative error and an associated large variance just as the berea sandstone the maximum relative errors appear at low values of measured oil relative permeability for the first time the td compatible model has been applied to detailed experimental three phase data our study showed that the global mobilities predicted by c0 finite element interpolation significantly overestimate the experimentally quantified global mobilities prediction improved when experimental data were used to locally impose the global mobility our numerical study also revealed weaknesses in the td compatible model the main issue is the fulfillment of the required condition of fractional flows of water oil and gas predicted by the pde td interpolation algorithm which should be bounded by the physical limits of 0 and 1 everywhere in the ternary diagram this condition was respected in the case of negligible residual wetting phase saturation low capillary porous medium and smooth variations of associated capillary pressure gradients as shown in the study of di chiara et al 2010 in our case however it appears that the very high capillarity of both the bentheimer and berea sandstones contributes to numerically interpolated water and gas fractional flows in the ternary diagram that locally fall below the physical lower limit of 0 and exceed its upper limit of 1 this in turn leads to negative oil fractional flow and thus results in unphysical oil relative permeabilities 6 2 what input data do the models require and how burdensome are these requirements the least request of input data is required when using the parker lenhard model and stone s model i the parker lenhard model requires only van genuchten parameter m and the irreducible wetting fluid saturation to model the three phase relative permeabilities of water oil and gas to quantify the oil relative permeability in a three phase fluid system stone s model i uses as input data the oil relative permeabilities in the two phase gas oil and oil water systems the irreducible water saturation and residual oil saturation the use of the mechanistic model to predict three phase relative permeabilities requires not only three two phase relative permeabilities but also six coefficients that presumably take into account the interaction between various fluids as well as fluid saturation distributions it should be noted that at least one set of experimental three phase relative permeability data for one saturation path for all three fluids is required to tune these characteristic coefficients to reduce the degree of uncertainty shahverdi and sohrabi 2017 suggested employing more measured data of three phase relative permeabilities for calibration of the six characteristic coefficients in the case of bentheimer sandstone using two experimental data sets instead of one for tuning the characteristic coefficients only slightly improved the predicted kr values the use of different input data sets also revealed the absence of a unique solution for the calibration of these six characteristic coefficients this resulted in different qualities in the subsequent prediction of the relative permeabilities to predict three phase relative permeabilities using the td compatible model the user requires more input data than the other three models it requires detailed information of the dynamic viscosities of the three fluid phases the variation of gas density as a function of the gas pressure as well as the two phase relative permeabilities and capillary pressures known on the edges of the ternary diagram since capillary pressure curves are not always available for all two phase fluid pairs involved in flow experiments at least the water retention curve measured in the water gas system is required the scaling approach parker et al 1987 based on the interfacial tensions of the two phase gas water gas oil and oil water systems may be used to parameterize the required capillary pressure curves in a water oil and oil gas system 6 3 what are the models computational requirements both in deriving three phase relative permeability functions and in using them in a flow simulator the most computational effort to assess three phase relative permeabilities is required for the td compatible model the predicted three phase relative permeabilities and global capillary pressures satisfy a so called total differential td compatibility condition which guarantees strict hyperbolicity of the reformulated system chavent and jaffré 1986 boundary conditions for global capillary pressure and global mobility are required such that the corresponding three phase data are consistent with a given set of three two phase data the numerical construction of global capillary pressure and global mobility functions by c1 and c0 finite element is performed using bi laplacian and laplacian interpolation the td compatibility condition required for the two phase data sets prescribed on the three edges of the ternary diagram is a nonlinear constraint on weighted means of the given two phase relative permeability data set this presents a certain weakness of this model in contrast to its strength of being free of elliptic zones in the saturation space it should be emphasized that the three phase data obtained with the td compatible model allow the three phase compressible global volumetric flow equation to be rewritten in a more suitable fractional form the gradient of capillary pressure coupling terms are eliminated from the formula for the global volumetric flow chavent 2009 this may lead to a more efficient computing time compared to traditional pressure saturation models the mechanistic model uses an arithmetic averaging relationship between two phase and three phase permeabilities here the user must first tune the six characteristic coefficients using for example a commercial tool once quantified the estimated characteristic coefficients can then be easily implemented in any flow simulator to model three phase relative permeabilities for any other saturation path the least numerical effort to build up three phase relative permeabilities is required for the parker lenhard model and stone s model i in both cases the mathematical functions using the two phase relative permeabilities of water and gas as input data can be directly implemented in flow simulators which is already the case for commercial flow simulators e g mofat us epa 1991 eclipse schlumberger 2015 for simulation of three phase flow it is noteworthy here that numerical issues may occur with stone s model i when normalized water and gas saturations achieve high values close to the physical upper limit of 1 6 4 which models admit elliptic regions in saturation space to assess the presence of potential elliptic zones in our study we tested the mechanistic model the parker lenhard model and stone s model i in the case of bentheimer and berea sandstones all three models admit elliptic zones gravitational effect causes multiple elliptic zones that depend on the total flux applied to the rock samples the percentage area of elliptical zones in the ternary diagram quantified for stone s model i was the highest and supports the results previously reported in the literature our numerical results showed that the parker lenhard model produces a higher percentage area of elliptic zones than the mechanistic model note that in our study we neglected the capillarity of the porous media which may dim the extent of potential elliptic zones as complete datasets on capillary pressure saturation curves are available for both sandstones it could be interesting to implement the effect of capillarity in the evaluation of elliptic zones under the given experimental conditions in the case of the td compatible model our study revealed that the interpolation of the global capillary pressure and its derivatives exposes unphysical fractional phase flows the total differential compatible approach will not be verified everywhere within the ternary diagram this could also be an indication of existing elliptic regions to build up a more robust td compatible modeling approach and to obtain reliable physical values of predicted fractional flows in the 3 phase ternary diagram further research steps are needed i to overcome the problem of overestimated global mobilities a more promising solution could be used to solve the poisson s equation instead of the laplace equation since the poisson s equation is the inhomogeneous equivalent form of laplace s equation the associated spatially variable source function could be quantified by an inverse modeling approach using a limited number of pilot points on experiment based global mobilities uniformly distributed in the ternary diagram a non linear least square method may be used to minimize the objective function of the inverse problem ii a similar inverse modeling approach could be used to improve the interpolation of the global capillary pressure pc g and its spatial derivatives on the ternary diagram step 5 of the pde td interpolation algorithm table 1 could be replaced by solving the inhomogeneous biharmonic equation here the pilot points could include the experiment based fractional water and gas flows and therefore reprocessed into spatial derivatives of pc g with respect to s1 and s3 using eq 17 in our study measurements of three phase relative permeabilities along ddi paths were compared with those predicted from four mathematical models an open question is still the goodness of predicted relative permeabilities when increasing both the water and oil flux and decreasing the gas flux this may also be part of further research work in addition while not yet considered in this work it would be interesting to assess the relative skills of the models tested as described by e g ranaee et al 2016 using model identification criteria this could be a way to take into account the complexity of a given model at least in terms of the number of parameters involved and possibly also considering the level of uncertainty associated with parameter estimates through the estimation of the covariance matrix as an additional benefit the use of these criteria yield the probability posterior probability conditional on the number of available data associated with a given model eventually leading to a multi model framework further studies could also focus on the parameter identification as shown in the work of ranaee et al 2017 data availability statement the data that support the findings of this study are available from the corresponding author upon reasonable request credit authorship contribution statement gerhard schäfer conceptualization methodology investigation software writing original draft raphaël di chiara roupert investigation formal analysis software writing review editing amir h alizadeh formal analysis validation data curation writing review editing mohammad piri resources data curation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this research was granted from january to august 2019 by the french american fulbright commission and the institute of international education council for international exchange of scholars iie cies us department of state gerhard schäfer is also grateful for the financial support by the university of strasbourg during his sabbatical leave at the center of innovation for flow through porous media university of wyoming and the administrative and technical support by the university of wyoming appendix a two phase constitutive relationships used in the study a 1 capillary pressure curves in two phase systems water gas water oil and oil gas the van genuchten 1980 model uses a simple analytical expression to describe the capillary pressure curves in a two phase water gas system the capillary pressure pcgw pa as function of the effective saturation of the wetting fluid phase water is described by a1 p c g w 1 α s w e 1 m 1 1 m with m 1 1 n where α pa 1 and n are empirical parameters parameter n controls the curvature of the pc s function α quantifies the level of the plateau of the capillary pressure the effective saturation swe of the wetting fluid phase is defined by a2 s w e s w s w i s m a x s w i where swi is the irreducible saturation of the wetting fluid phase here water and sm ax is the maximum saturation of the wetting fluid phase during drainage of the porous medium water is displaced for example by gas or by a napl the maximum saturation smax is equal to 1 on the other hand when gas or a napl is displaced by water in the case of imbibition sm ax is limited to values lower than 1 because the non wetting fluid phase will remain in the porous medium at residual saturation snwr the maximum water saturation is therefore complementary to the residual saturation of the non wetting fluid phase sm ax 1 sgr sm ax 1 sor in three phase systems for the interfaces oil water and gas oil the capillary pressures pcow and pcgo are generally calculated from relation a1 by applying a scaling approach based on the interfacial tensions of the two phase system gas water gas oil and oil water parker et al 1987 a3 p c o w s w e 1 β o w p c g w s w e where water is the wetting fluid phase a4 p c g o s w e 1 β g o p c g w s w e where oil is the wetting fluid phase β o w σ g w 0 σ o w and β g o σ g w 0 σ g o are the scaling factors for the fluid system oil water and gas oil σ g w 0 σ ow and σ go are the interfacial tension of fluid couples gas water oil water and gas oil a 2 relative permeabilities in two phase systems water gas water oil and oil gas in a two phase water gas system using a modified mualem van genuchten mvg approach with a maximum value of the nonwetting fluid phase here gas the relative permeabilities are defined as a5 k r w s w e 1 1 s w e 1 m w g m w g 2 k r g k r g w m a x 1 s w e 1 s w e 1 m g w 2 m g w where krgw max is the maximum relative gas permeability achieved at irreducible water saturation swi in the gas water system mwg and mgw correspond to the mvg parameter for water and gas respectively in a two phase water oil system the relative permeabilities are then written as follows a6 k r w s w e 1 1 s w e 1 m w o m w o 2 k r o w k r o w m a x 1 s w e 1 s w e 1 m o w 2 m o w where krow max is the maximum relative oil permeability achieved at irreducible water saturation swi in the water oil system mwo and mow correspond to the mvg parameter for water and gas respectively in a two phase oil gas system the corresponding relative permeabilities can be expressed by a7 k rg k rgo max 1 s oe 1 s oe 1 m go 2 m go k rog s oe 1 1 s oe 1 m og m og 2 where krgo max is the maximum relative gas permeability achieved at residual oil saturation in the oil gas system sor mog and mgo correspond to the mvg parameter for oil and gas respectively here soe is the effective oil saturation defined by a8 s o e s o s o r 1 s o r and so is the oil saturation appendix b implementation of the mechanistic model of shahverdi and sohrabi 2017 the three phase relative permeabilities of the mechanistic model of shahverdi and sohrabi 2017 form a coupled nonlinear system of eqs 1 to 3 we describe how the six two phase relative permeabilities that appear in eqs 1 2 and 3 are expressed when using the mualem van genuchten model b 1 three phase relative permeability of the oil phase kro the three phase relative permeability of the oil phase eq 1 is expressed by b1 k r o s w o s w o s g o k r o w s o w s g o s w o s g o k r o g s o g where s o w a o w s o b 2 a s o g a o g s o b 2 b s w o a w o s w b 2 c s g o a g o s g b 2 d and becomes b3 k r o a w o s w a w o s w a g o s g k r o w a o w s o a g o s g a w o s w a g o s g k r o g a o g s o using the two phase relative permeability of oil in a water oil system expressed by the modified mualem van genuchten model krow is written as b4 k r o w k r o w m a x 1 s w e 1 s w e 1 m o w 2 m o w k r o w m a x 1 s w o w s w i o w 1 s w i o w 1 s w o w s w i o w 1 s w i o w 1 m o w 2 m o w since krow has to be picked up at the representative two phase saturation sow using expression b2a eq b4 can then be expressed as function of the oil saturation so in the three phase system as follows b5 k r o w k r o w m a x 1 1 a o w s o s w i o w 1 s w i o w 1 1 a o w s o s w i o w 1 s w i o w 1 m o w 2 m o w using the two phase relative permeability of oil in an oil gas system expressed by the mualem van genuchten model krog is written as b6 k r o g s o e 1 1 s o e 1 m o g m o g 2 s o o g s o r o g 1 s o r o g 1 1 s o o g s o r o g 1 s o r o g 1 m o g m o g 2 since krog has to be picked up at the representative two phase saturation sog using expression b2b eq b6 can then be expressed as function of the oil saturation so in the three phase system as follows b7 k r o g a o g s o s o r o g 1 s o r o g 1 1 a o g s o s o r o g 1 s o r o g 1 m o g m o g 2 finally inserting eqs b5 and b7 in eq b3 one obtains the final expression of the relative oil permeability in the three phase system b8 k r o a w o s w a w o s w a g o s g k r o w m a x 1 1 a o w s o s w i o w 1 s w i o w 1 1 a o w s o s w i o w 1 s w i o w 1 m o w 2 m o w a g o s g a w o s w a g o s g a o g s o s o r o g 1 s o r o g 1 1 a o g s o s o r o g 1 s o r o g 1 m o g m o g 2 note that in eq b8 one has to respect the following constraints 1 a o w s o s w i o w 0 a o g s o s o r o g 0 b 2 three phase relative permeability of the water phase krw the three phase relative permeability of the water phase eq 2 is expressed by b9 k r w s o w s o w s g w k r w o s w o s g w s o w s g w k r w g s w g where s g w a g w s g b 9 a s w g a w g s w b 9 b and becomes b10 k r w a o w s o a o w s o a g w s g k r w o a w o s w a g w s g a o w s o a g w s g k r w g a w g s w using the two phase relative permeability of water in a water oil system expressed by the mualem van genuchten model krwo is written as b11 k r w o s w e 1 1 s w e 1 m w o m w o 2 s w w o s w i w o 1 s w i w o 1 1 s w w o s w i w o 1 s w i w o 1 m w o m w o 2 since krwo has to be picked up at the representative two phase saturation swo using expression b2c eq b11 can then be expressed as function of the water saturation sw in the three phase system as follows b12 k r w o a w o s w s w i w o 1 s w i w o 1 1 a w o s w s w i w o 1 s w i w o 1 m w o m w o 2 using the two phase relative permeability of water in a water gas system expressed by the mualem van genuchten model krwg is written as b13 k r w g s w e 1 1 s w e 1 m w g m w g 2 s w w g s w i w g 1 s w i w g 1 1 s w w g s w i w g 1 s w i w g 1 m w g m w g 2 since krwg has to be picked up at the representative two phase saturation swg using expression b9b eq b13 can then be expressed as function of the water saturation sw in the three phase system as follows b14 k r w g a w g s w s w i w g 1 s w i w g 1 1 a w g s w s w i w g 1 s w i w g 1 m w g m w g 2 finally inserting eqs b12 and b14 in eq b10 one obtains the final expression of the relative water permeability in the three phase system b15 k r w a o w s o a o w s o a g w s g a w o s w s w i w o 1 s w i w o 1 1 a w o s w s w i w o 1 s w i w o 1 m w o m w o 2 a g w s g a o w s o a g w s g a w g s w s w i w g 1 s w i w g 1 1 a w g s w s w i w g 1 s w i w g 1 m w g m w g 2 note that in eq b15 one has to respect the following constraints a w o s w s w i w o 0 a w g s w s w i w g 0 b 3 three phase relative permeability of the gas phase krg the three phase relative permeability of the gas phase eq 3 is expressed by b16 k r g s w g s o g s w g k r g w s g w s o g s o g s w g k r g o s g o and takes the following form b17 k rg a wg s w a og s o a wg s w k rgw a gw s g a og s o a og s o a wg s w k rgo a go s g using the two phase relative permeability of gas in a water gas system expressed by the modified mualem van genuchten model krgw is written as b18 k r g w k r g w m a x 1 s w e 1 s w e 1 m g w 2 m g w k r g w m a x 1 s w g w s w i g w 1 s w i g w 1 s w g w s w i g w 1 s w i g w 1 m g w 2 m g w since krgw has to be picked up at the representative two phase saturation sgw using expression b9a eq b18 can then be expressed as function of the gas saturation sg in the three phase system as follows b19 k r g w k r g w m a x 1 1 a g w s g s w i g w 1 s w i g w 1 1 a g w s g s w i g w 1 s w i g w 1 m g w 2 m g w using the two phase relative permeability of gas in an oil gas system expressed by the modified mualem van genuchten model krgo is written as b20 k r g o k r g o m a x 1 s o e 1 s o e 1 m g o 2 m g o k r g o m a x 1 s o g o s o r g o 1 s o r g o 1 s o g o s o r g o 1 s o r g o 1 m g o 2 m g o since krgo has to be picked up at the representative two phase saturation sgo using expression b2d eq b20 can then be expressed as function of the gas saturation sg in the three phase system as follows b21 k r g o k r g o m a x 1 1 a g o s g s o r g o 1 s o r g o 1 1 a g o s g s o r g o 1 s o r g o 1 m g o 2 m g o finally inserting eqs b19 and b21 in eq b17 one obtains the final expression of the relative gas permeability in the three phase system b22 k r g a w g s w a o g s o a w g s w k r g w m a x 1 1 a g w s g s w i g w 1 s w i g w 1 1 a g w s g s w i g w 1 s w i g w 1 m g w 2 m g w a o g s o a o g s o a w g s w k r g o m a x 1 1 a g o s g s o r g o 1 s o r g o 1 1 a g o s g s o r g o 1 s o r g o 1 m g o 2 m g o note that in eq b22 one has to respect the following constraints 1 a g w s g s w i g w 0 1 a g o s g s o r g o 0 appendix c quantified mvg parameters of the experimental two phase constitutive relationships table c1 and table c2 summarize the mualem van genuchten mvg parameters quantified for the bentheimer sandstone and berea sandstone the numerical values are obtained by a nonlinear fit of the theoretical pc s and kr s curves appendix a against the experimentally observed curves using the nlfit tool of origin 2019 with the levenberg marquardt iteration algorithm the tables specify uncertainty intervals standard errors associated with model parameter estimates r squared values are indicated as statistical measure when suitable to underline how close the experimental data are to the fitted curve appendix d comparison of predicted kr values water oil gas for oak s ddi experiments 17 and 18 with the findings of shahverdi and sohrabi 2017 figs d1 d3 and figs d4 d6 present the detailed comparison of relative permeabilities for water oil and gas of oak s ddi experiments 17 and 18 using the mechanistic model here we compare our numerical results obtained with those referenced in shahverdi and sohrabi 2017 to quantify the goodness of the prediction of the measured kr values the root mean square error rmse and the coefficient of residual mass crm are indicated appendix e boundary conditions and numerical results of the td compatible model e 1 boundary conditions tangential and normal derivatives of global capillary pressure p c g let τ and n be the tangential and normal unit vectors on t fig e1 defined by e1 τ 12 i 1 n 12 3 3 i 1 2 i 3 on t 12 water oil edge τ 13 i 3 i 1 n 13 3 3 i 1 i 3 on t 13 water gas edge τ 32 i 3 n 32 3 3 i 3 2 i 1 on t 32 gas oil edge where i 1 and i 3 are the unit vectors of the os1 os3 system of non orthogonal axis the global capillary pressure p c g being function of s1 and s3 the tangential and normal derivatives of p c g on t p c g τ and p c g n are then given by e2 p c g τ p c g s 1 p c g n 3 3 p c g s 1 2 p c g s 3 on t 12 water oil edge p c g τ p c g s 3 p c g s 1 p c g n 3 3 p c g s 1 p c g s 3 on t 13 water gas edge p c g τ p c g s 3 p c g n 3 3 p c g s 3 2 p c g s 1 on t 32 gas oil edge in order to perform c1 finite element interpolation in the orthogonal ox oy system the non orthogonal vectors i 1 and i 3 must be projected on the unit vectors of the ox oy system i and j as follows e3 i 1 i i 3 1 2 i 3 2 j we can then re write the tangential derivatives of p c g in terms of x and y derivatives and the normal derivatives of p c g as follows e4 p c g x p c g s 1 p c g y 0 p c g n 3 3 p c g s 1 on t 12 water oil edge p c g x 1 2 p c g s 3 p c g s 1 p c g y 3 2 p c g s 3 p c g n 3 3 p c g s 1 p c g s 3 on t 13 water gas edge p c g x 1 2 p c g s 3 p c g y 3 2 p c g s 3 p c g n 3 3 p c g s 3 on t 32 gas oil edge note that the normal derivatives in eq e4 are slightly modified with regard to eq e2 as p c g s 1 0 and p c g s 3 0 on the gas oil and the water oil edge respectively after c1 finite interpolation of p c g on the whole ternary diagram the numerical solutions in terms of x and y derivatives of p c g are projected along i 1 i 3 to compute the corresponding derivatives such as e5 p c g s 1 p c g x 3 3 p c g y p c g s 3 2 3 3 p c g y which are then used for computation of the water fractional flow f1 and gas fractional flow f3 as described in eq 17 e 2 results of the td compatible model e 2 1 bentheimer sandstone results of the td compatible model are shown in figs e2 e4 e 2 2 berea sandstone results of the td compatible model are shown in figs e5 e7 appendix f parker lenhard model applied to bentheimer sandstone alizadeh s ddi experiments a and d1 and berea sandstone oak s ddi experiments 16 20 and 25 f 1 bentheimer sandstone f 1 1 input parameters determined for modeling options pc s and kr s fig f1 shows the comparison of measured and fitted two phase constitutive relationships f 1 2 comparison of predicted kr values water oil gas with those measured in ddi experiments a and d1 figs f2 and f3 show the relative permeabilities measured from alizadeh s ddi experiments a and d1 compared to those predicted by the parker lenhard model f 2 berea sandstone f 2 1 input parameters determined for modeling options pc s and kr s fig f4 shows the comparison of measured and fitted two phase constitutive relationships f 2 2 comparison of predicted kr values water oil gas with those measured in ddi experiments 16 20 and 25 figs f5 f10 show the relative permeabilities measured from oak s ddi experiments 16 20 and 25 compared to those predicted by the parker lenhard model appendix g study of the occurrence of elliptic zones g 1 basic equations the three phase flow of immiscible phases is described using the darcy muskat law for the velocity of fluid phase α g1 v α k k r α μ α p α ρ α g where k is the absolute permeability l2 p α is the pressure of the phase α ml 1t 2 ρα is the density ml 3 μ is the dynamic viscosity ml 1t 1 g lt 2 is the gravity vector and k rα is the relative permeability conservation equations for an incompressible immiscible three phase flow can be written in terms of two saturation equations for water α 1 and gas phases α 3 g2 t d s α z d f α 0 with α 1 3 where s α is the saturation of phase α f α is the fractional flow of phase α zd and td are the dimensionless distance and time respectively such as g3 z d z l a n d t d 0 t v t o t ϕ l d t where z is the depth l l the total length of the system l φ is the porosity and vtot v 1 v 2 v 3 is the total volumetric flow rate of the three fluid phases lt 1 g 2 linearized fractional flow equations for saturation in the case of zero capillary pressure the dimensionless system of saturation yields fractional flow functions of water and gaz f 1 f 3 respectively g4 f 1 λ 1 λ t 1 n g ρ d 1 k r 2 ρ d μ 2 μ 3 k r 3 g5 f 3 λ 3 λ t 1 n g ρ d μ 2 μ 1 k r 1 k r 2 with the gravity number n g k ρ 2 ρ 3 g μ 2 v t o t ρ d ρ 1 ρ 3 ρ 2 ρ 3 is the density ratio λα m 1lt is the phase mobility and λ t m 1lt is the total mobility defined as λ t α k r α μ α the dimensionless system is linearized in terms of two saturation gradients involving a jacobian matrix j as follows g6 t d s 1 3 j z d s 1 3 0 with j f 1 s 1 f 1 s 3 f 3 s 1 f 3 s 3 from a numerical point of view solutions of the following riemann problem at t d 0 g7 z d 0 s 1 s 1 l s 3 s 3 l z d 0 s 1 s 1 r s 3 s 3 r depend on a dimensionless wave velocity u d z d t d yielding rarefaction and sock patterns which are the eigenvalues u d of the jacobian matrix j g8 u d 1 2 f 1 s 1 f 3 s 3 f 1 s 1 f 3 s 3 2 4 f 1 s 3 f 3 s 1 with the corresponding partial derivatives of fractional flow functions f 1 g9 f 1 s 1 3 1 μ 1 μ 2 μ 3 λ t 2 v t o t λ t s 1 3 μ 2 μ 3 k r 1 v t o t g k μ 2 k r 1 k r 3 ρ 3 ρ 1 μ 3 k r 1 k r 2 ρ 2 ρ 1 k r 1 s 1 3 μ 2 μ 3 λ t v t o t g k μ 2 k r 3 λ t ρ 3 ρ 1 μ 3 k r 2 λ t ρ 2 ρ 1 k r 2 s 1 3 g k μ 3 k r 1 λ t ρ 2 ρ 1 k r 3 s 1 3 g k μ 2 k r 1 λ t ρ 3 ρ 1 and f 3 g10 f 3 s 1 3 1 μ 1 μ 2 μ 3 λ t 2 v t o t λ t s 1 3 μ 1 μ 2 k r 3 v t o t g k μ 1 k r 2 k r 3 ρ 2 ρ 3 μ 2 k r 1 k r 3 ρ 1 ρ 3 k r 3 s 1 3 μ 1 μ 2 λ t v t o t g k μ 1 k r 2 λ t ρ 2 ρ 3 μ 2 k r 1 λ t ρ 1 ρ 3 k r 2 s 1 3 g k μ 1 k r 3 λ t ρ 2 ρ 3 k r 1 s 1 3 g k μ 2 k r 3 λ t ρ 1 ρ 3 where λ t s 1 3 α 1 μ α k r α s 1 3 when the eigenvalues u d are real and distinct the system g6 is hyperbolic in this case there are two real eigenvectors v d v d 1 v d 3 that correspond to the direction of admissible changes in fluid saturation and identify so called fast and slow rarefaction curves the components of the eigenvectors are expressed as g11 v d 1 d s 1 f 1 s 3 v d 3 d s 3 u d f 1 s 1 the fast rarefaction characterized by the eigenvector v d represents situations in which gas or and water saturations increase in three phase systems jackson and blunt 2002 when eq g8 gives a real wave velocity some values of saturations called umbilic point jackson and blunt 2002 give the same value u d u d u d the resulting system is therefore non strictly hyperbolic and very sensitive to the initial condition isaacson et al 1990 the square root in eq g8 is then always positive in the elliptic region wherein u d are complex and conjugates a linearized analysis shows that the system is unstable e g jahanbakhsi et al 2013 bell et al 1986 in the presence of capillarity the diffusive term becomes dominant at high frequencies however at low frequencies the diffusive term would not be sufficient to remove instabilities it has been shown that inside the elliptic region equilibrium formulation yields unstable and oscillatory solutions when the initial and injected state for saturation is inside the elliptic region the solution exhibits oscillatory behavior growing in magnitude showing that the system is unstable trangenstein 1989 a non equilibrium approach was developed jahanbakhsi et al 2013 using relaxation strategies barenblatt s model which leads to high order terms involving cross derivatives when both sl and sr are outside the elliptic region the solution is stable and the existence of the elliptic zone does not affect the results when initial and injected states are on the opposite sides of the elliptic region solutions are oscillatory and not completely stabilized g 3 test of implemented algorithm to identify elliptic zones the study case of bell in order to investigate three phase relative permeability behavior on ternary diagram t a first set of functions is used from bell et al 1986 g12 k r 1 s 1 1 09 s 1 1 516687 0 09 s 1 4 51668 k r 2 s 1 s 3 1 s 1 s 3 1 s 1 1 s 3 k r 12 s 1 k r 23 s 3 k r 3 s 3 0 525 s 3 1 02 0 475 s 3 3 62 to quantify the three phase oil relative permeability kr2 the two phase relative permeability functions k r12 and k r23 from the water oil and oil gas side are expressed by g13 k r 12 s 1 1 95 1 s 1 8 28 0 95 1 s 1 11 284 k r 23 s 3 1 19 1 s 3 2 006 0 19 1 s 3 2 024 bell s model is a synthetic set of relative permeabilities known to maximize the elliptic region on t water viscosity is μ1 0 8 cp gas viscosity is μ3 0 05 cp and three different oil viscosities are investigated from 0 1 cp to 5 cp without gravity effect fig g1 when reducing the oil viscosity from 5 cp to 0 1 cp the elliptic region produces a larger instability area the largest zone for μ2 0 1 cp almost occupies 15 of the whole ternary surface parallelly oriented to the gas oil side compared to 7 obtained for μ2 1 cp the lower the oil viscosity is the larger the extent of the elliptic area when including gravity another elliptic region appears whose extent strongly depend on the absolute value of total velocity fig g2 shows the influence of gravity associated with different orders of magnitude of total velocity varying from 10 2 ms 1 to 10 7 ms 1 as reference is used here the case without gravity and a fixed oil viscosity fixed of 1 cp when the total velocity is 10 2 ms 1 the elliptic zone decreases slightly while its area remains close to 7 of the total ternary surface the further decrease of the total velocity results in a significant decrease of the elliptic area to about 2 of the total ternary surface and a displacement of the elliptic zone towards the oil vertex overly the decrease of total velocity has a stabilizing and antagonistic effect in contrast to the oil viscosity however both parameters appear in the denominator of the gravity number n g eqs g4 and g5 g 4 parker lenhard model quantification of elliptic regions the occurrence of elliptic regions was assessed for the parker lenhard model in the same way as described for the mechanistic model the numerical results obtained for the bentheimer sandstone and berea sandstone are described below g 4 1 bentheimer sandstone the study on the occurrence of elliptic regions was conducted with the parker lenhard model using the experimental data of the bentheimer sandstone table 2 the intrinsic permeability of the rock k 2 63 10 12 m2 and the model input parameter of modeling options pc s and kr s table 8 the numerical results obtained are shown in fig g3 g 4 2 berea sandstone the study on the occurrence of elliptic regions was conducted with the parker lenhard model using the experimental data of the berea sandstone table 3 the intrinsic permeability of the rock k 1 97 10 13 m2 and the model input parameter of modeling options pc s and kr s table 9 the numerical results obtained are shown in fig g4 g 5 stone s model i quantification of elliptic zones the occurrence of elliptic regions was assessed for the stone s model i in the same way as described for the mechanistic model the numerical results obtained for the bentheimer sandstone and berea sandstone are presented below to study the existence of possible elliptic regions we required a relative permeability model for water and gas in the water oil gas saturation space we therefore used the water relative permeability and gas relative permeability expression described by the lenhard parker model eqs 5 and 7 the van genuchten parameter m and the irreducible water saturation in a water gas system swi was adopted from modeling option pc s table 8 table 9 g 5 1 bentheimer sandstone the study on the occurrence of elliptic regions was conducted with stone s model i using the experimental data of the bentheimer sandstone table 2 the intrinsic permeability of the rock k 2 63 10 12 m2 and the model input parameter used for the prediction of ddi experiments performed on bentheimer sandstone table 10 the numerical results obtained are shown in fig g5 g 5 2 berea sandstone the study on the occurrence of elliptic regions was conducted with stone s model i using the experimental data of the berea sandstone table 3 the intrinsic permeability of the rock k 1 97 10 13 m2 and the model input parameter used for the prediction of ddi experiments performed on berea sandstone table 10 the numerical results obtained are shown in fig g6 
407,we detail a new semi analytic solution for the slope beach problem in which linearization of the initial waveform is not carried out to provide the exact corresponding boundary condition for the transformed problem numerical code benchmarking requires the construction of exact solutions to check the convergence order and efficiently compare the simulations using fine meshes we quantify the impact of the linearization assumption and compare two situations linearized and non linearized with a second order finite volume code the accuracy of the shoreline velocity maximum run up and maximum run down situations in particular are of crucial importance in applications as they characterize the inundation and impact intensity of a wave on potential infrastructure to this end we provide two sets of spreadsheets containing highly accurate approximations of the exact non linearized solution for cases c and d of carrier et al 2003 study for benchmarking purposes keywords slope beach problem code benchmarking analytical solution shallow water linearization 1 introduction the slope beach problem is a rare semi analytical solution for the shallow water problem involving a dry wet interface moving on a non constant topography it is an excellent configuration for benchmarking numerical solutions and to check software introduced in the seminal carrier and greenspan 1958 paper see also the introduction in synolakis 1987 on the historical contributions to the linear case the hodograph transformation has received several major contributions in the two last decades see e g carrier et al 2003 kânoğlu 2004 kânoğlu and synolakis 2006 the method is based on the introduction of two new independent variables σ λ in functions of water height time and velocity these transform the shallow water equations into a second order linear partial differential equation pde problem as below 4 σ φ λ λ σ φ σ σ 0 where φ is the potential from which the primitive variables of the flow can be recovered to solve the linear transformed problem in variables σ λ initial conditions are prescribed at λ 0 where one assumes a null velocity configuration for the initial condition carrier et al 2003 a linearization is performed to derive an equivalent initial condition in function of σ from the initial water height profile given with respect to x the solution is then provided by a convolution operator involving functions with integral singularities kânoğlu and collaborators kânoğlu and synolakis 2006 consider non null initial velocity to provide a more complete formulation but linearization of the initial waveform is still employed to produce the initial condition with respect to variable σ very recent papers see e g aydin and kânoğlu 2017 use the same approximation x σ 2 to provide the initial condition and perform benchmarking synolakis et al 2008 as mentioned by kânoğlu in kânoğlu 2004 despite the linearization used to specify the boundary condition the subsequent analytical solution maintains the nonlinear effects as shown by synolakis 1987 and titov and synolakis 1995 through comparisons with laboratory data and numerical predictions respectively indeed the nonlinearity effect of the shallow water equations is preserved even with the linearization of the initial condition however during the development of a numerical code based on a new finite volume technology reis et al 2019 we observed that the numerical solution did not converge towards the benchmark data presented in the framework of the isec 2004 workshop on long wave runup models which is based on the widely used semi analytical solution provided in the carrier et al work carrier et al 2003 for coarse meshes the two solutions are similar with respect to the scheme error but for finer meshes we found that our numerical solution does not converge to the analytical one the expected convergence orders in particular are not obtained we discovered that this issue is caused by the linearization of the initial condition for finer meshes assuming x σ 2 produces an error larger than the numerical one consequently the linearized slope beach benchmark is not appropriate to check the convergence order of the numerical method in this context it is worth noting that li and raichlen 2001 proposed in the framework of the study of the runup of solitary waves on a uniform plane beach connected to an open ocean of constant depth an improvement of the methodology used in synolakis 1987 by retaining a one order higher term in the taylor s series then the semi analytical solution turns to be more accurate nevertheless as soon as we introduce an approximation in the construction of the semi analytical solution we theoretically have an error that disables the convergence analysis which is the main goal of our paper in the present work we propose an extension of the carrier and greenspan method without using an approximation for the initial condition concerning the waveform we implement a new semi analytical solution and compare it with numerical solutions obtained with the second order finite volume code we prove that we can recover the correct convergence order moreover we provide a quantification of the error introduced by the linearization of the initial water surface displacement the structure of the paper is as follows section 2 is dedicated to the construction of the analytical solution while section 3 presents an extensive numerical study of the theoretical solution and comparisons with the finite volume approximation and the one deriving from the linearization assumption 2 analytical solution of the ivp we consider the nonlinear shallow water problem introduced in carrier and greenspan 1958 carrier et al 2003 kânoğlu 2004 kânoğlu and synolakis 2006 using the non dimensional form of the 1d nonlinear shallow water nlsw equations for propagation over a plane beach with a uniform slope on an infinite domain the equations in question are 1a η t h η u x 0 1b u t u u x η x 0 where h x x is the undisturbed water depth while u x t and η x t represent respectively the depth averaged horizontal velocity and the free surface elevation with respect to the still water level swl the non dimensional quantities present in 1 are related to their dimensional counterparts by x l x t l α g t η α l η u g α l u where l is a characteristic horizontal length g is the gravitational acceleration and α tan β is the beach slope the corresponding problem geometry is presented in fig 1 using a hodograph transformation slightly different from the one used in the carrier and greenspan pioneering study carrier and greenspan 1958 namely 2a λ t u 2b q σ 2 x η and defining the functional ψ η u 2 2 carrier and collaborators carrier et al 2003 used 1 to derive the following equation 4 σ ψ λ λ σ ψ σ σ 0 with the moving shoreline corresponding to σ 0 by further defining the potential φ such that ψ φ λ together with 3a u φ σ 2 σ 3b η φ λ φ σ 2 8 σ 2 and assuming that initial conditions correspond to λ 0 see more below the following initial value problem ivp was obtained 4a 4 σ φ λ λ σ φ σ σ 0 4b φ σ 0 p σ 4c φ λ σ 0 f σ with 5a p σ 0 σ 2 s u s 0 d s 5b f σ η σ 0 1 2 u 2 σ 0 to solve this ivp the authors used the hankel transform to derive an analytical expression for the potential involving trigonometric functions and a bessel function of the first kind 6 φ σ λ 2 0 0 b f b j 0 ρ σ sin ρ λ 2 j 0 ρ b d ρ d b 0 0 ρ b p b j 0 ρ σ cos ρ λ 2 j 0 ρ b d ρ d b by invoking the green function they further derived φ σ λ 2 i 1 σ λ i 2 σ λ λ in which i 1 σ λ 0 f b g b σ λ d b i 2 σ λ 0 p b g b σ λ d b noticing that g b σ λ presents a singularity for b λ 2 σ and taking advantage of the green function definition see e g 22 in carrier et al 2003 integrals i 1 and i 2 are given in a more convenient form namely i 1 b 1 b 2 f b τ 1 b σ λ d b b 2 b 3 f b τ 2 b σ λ d b with a similar expression for i 2 where b 1 max 0 σ λ 2 b 2 σ λ 2 b 3 σ λ 2 with τ 1 b σ λ 4 π b λ 2 4 b σ 2 k 16 b σ λ 2 4 b σ 2 τ 2 b σ λ 1 π b σ k λ 2 4 b σ 2 16 b σ where k is the complete elliptic integral of the first kind the singularity at b λ 2 σ is handled using an appropriate standard numerical integration tool as long as σ 10 3 for smaller values of σ our experience shows that errors from the numerical integration and or differentiation do not allow to obtain accurate exact solutions therefore if the focus concerns the shoreline i e σ 0 one has to employ an alternative specific analytical approach see further below the plane beach problem is a very important test for numerical code benchmarking and delivering the exact solution is mandatory for both the velocity and free surface elevation fields and the evolution of the shoreline position and frontline velocity the two issues will be addressed in detail in the following section considering the initial static case i e u 0 x u x t 0 0 the general case with a non null initial velocity will be discussed briefly at the end of the section devoted to the applications 2 1 computation of velocity and free surface elevation fields we start by noting that as u 0 x 0 then p b 0 implying i 2 0 while the expression of f simplifies to f σ η σ 0 the values of the velocity and free surface elevation are computed for given values of the location x and time t say x and t using the set of equations 3 this involves computing the value of σ λ corresponding to the physical coordinates x t and then evaluating the first order derivatives of the potential φ with respect to σ and λ seen as a whole these tasks are achieved by evaluating the first and second order partial derivatives of φ numerically using a robust adaptive numerical differentiation tool the derivestsuite developed by john d errico for matlab in fact determining σ λ for a given x t is achieved using the following newton raphson strategy on the set of equations 2 σ i 1 σ i 1 u λ σ i λ i t t σ i λ i η λ σ i λ i x x σ i λ i d σ i λ i λ i 1 λ i t t σ i λ i u σ σ i λ i x x σ i λ i 2 σ i η σ σ i λ i d σ i λ i with d σ i λ i 1 u λ σ i λ i u σ σ i λ i η λ σ i λ i 2 σ i η σ σ i λ i a newton raphson splitting technique can also be used see e g kânoğlu 2004 synolakis 1987 to accomplish this alternatively when dealing with several grid points the solution can be found via interpolation using delaunay triangulation see e g anderson et al 2017 then once σ λ has been determined to the required numerical precision the velocity and free surface elevation are determined using 3 at this point it is of utmost importance to stress that the numerical computation of i 1 requires the evaluation of η σ 0 for given values of σ however the physical problem is generally given in terms of η 0 x η x t 0 the initial free surface elevation field therefore we consider the identity 2b written for t 0 i e σ 2 x η 0 x and set η σ 0 η 0 x with x given by the newton raphson iterative procedure 7 x i 1 x i σ 2 η 0 x i x i 1 η 0 x i where η 0 denotes the first derivative of η 0 x with respect to x because in the context of tsunami simulation η 0 is generally a very smooth function with η 0 x 1 see e g nicolsky et al 2018 and references therein only a few iterations are needed to determine x to machine precision we further note that the iterative procedure starts with x 1 σ 2 that is precisely the restrictive linear approximation for the initial free surface elevation field often used in the literature see further therefore in practical terms the linear approximation is obtained by restricting the iterative procedure to its initial guess whereas the nonlinear approach corresponds to performing the full iterative procedure 7 up to the accuracy threshold to guarantee that the transformation 2 is single valued for all target values x t we monitor the value of the corresponding jacobian j x q t λ x λ t q combining 2 and 3 we derive j 1 u λ 2 1 4 u σ 2 if j or 1 j is smaller than a certain threshold say ε j the results obtained are discarded as they might be non physical we prefer to use j instead of the alternative jacobian x σ t λ x λ t σ see e g kânoğlu 2004 as the latter equals 2σj and thus tends to zero as one approaches the shoreline preventing its use to assess the physical admissibility of the solution in that region 2 2 computation of shoreline velocity and position we now turn to the computation of the time evolution of the shoreline velocity us and position xs which are given by cf 3 u s φ σ 2 σ σ 0 x s η s 1 2 u s 2 φ λ σ 0 first as uσ vanishes on the shoreline the jacobian of the transformation becomes j s 1 u s λ 2 from 3a we derive the relation u s φ σ σ 2 σ 0 rewriting 4a as φ σ σ 4 φ λ λ φ σ σ we finally obtain u s φ λ λ σ 0 therefore determining us and xs relies only on the evaluation of the first and second derivatives of function φ λ φ 0 λ that is 8a u s φ λ λ 8b x s 1 2 u s 2 φ λ while the jacobian js further requires the evaluation of φ λ λ λ from 6 and defining η b η b 0 we now obtain φ λ 2 0 η b b 0 sin ρ λ 2 j 0 ρ b d ρ d b as see carrier et al 2003 and references therein 0 sin ρ λ 2 j 0 ρ b d ρ h λ 2 b h λ 2 b λ 2 4 b 2 where h is the heaviside function we have φ λ 4 0 λ 2 η b b λ 2 4 b 2 d b integration by parts and the leibniz rule for integrals lead to φ λ λ η 0 π λ 4 d η λ 2 d b λ 2 0 λ 2 d 2 η b d b 2 arcsin 2 b λ d b and φ λ λ λ π 4 d η λ 2 d b π λ 8 d 2 η λ 2 d b 2 λ 2 d 2 η 0 d b 2 1 2 0 λ 2 d 3 η b d b 3 λ 2 4 b 2 b arcsin 2 b λ d b enabling us to compute the evolution of us and xs or η s x s from 8 the derivatives of η b appearing in the two previous integrals are obtained from the derivatives of η 0 x using the chain rule taking 2b into account the computation of the jacobian js is straightforward because 9 u s λ φ λ λ λ 1 2 d 2 η 0 d b 2 3 π λ 32 d 3 η λ 2 d b 3 1 8 0 λ 2 d 4 η b d b 4 b λ λ 2 4 b 2 3 2 λ arcsin 2 b λ d b again for a given time t the corresponding value of λ if it exists is calculated recurring to 2a taking σ 0 in this context it is useful to define the function μ λ λ u s λ t then given t the required value of λ is obtained within a prescribed precision typically 10 7 using the matlab minimizer function fminbnd on μ we find that for some values of t the minimum value of μ is not close to zero 10 8 indicating that λ u s λ t has no solution this is further supported by the fact that in these cases js almost vanishes hence the calculations for these specific values of t are discarded an alternative procedure would be to set a sequence λn and then derive t n λ n u s λ n however the monotonicity of λn does not ensure the monotonicity of t n leading to a requirement for the properties of t n to be monitored to avoid non physical time sequences as observed in the plane beach benchmark shoreline data presented in the framework of the isec 2004 workshop on long wave runup models see http isec nacse org workshop 2004 cornell bmark1 html 3 applications 3 1 initial waveforms having presented the methodology to compute the exact solution of the 1d uniformly sloping beach problem we now apply it to the four cases presented in the carrier et al study carrier et al 2003 the initial free surface elevation of each of these initial static cases is given by a the gaussian shape initial waveform η 0 x a exp k x x 0 2 with a 0 0017 k 4 0 x 0 1 69 b the negative gaussian shape the inverse profile of case a η 0 x a exp k x x 0 2 c the leading depression n wave ldn shape typically caused by a seismic fault dislocation by a subduction earthquake η 0 x a 1 exp k 1 x x 1 2 a 2 exp k 2 x x 2 2 where a 1 0 02 a 2 0 01 k 1 k 2 3 5 x 1 1 5625 x 2 1 0 d the ldn wave shape typically caused by an offshore submarine landslide η 0 x a 1 exp k 1 x x 1 2 a 2 exp k 2 x x 2 2 with a 1 0 006 a 2 0 018 k 1 4 9 k 2 4 0 x 1 4 1209 x 2 1 6384 cases c and d were used in recent studies brecht et al 2018 clain et al 2016 reis et al 2019 vater et al 2015 as part of numerical code benchmarking procedures in the context of tsunami simulation we compare the semi analytic results obtained for the free surface elevation and velocity fields for given time values and for the evolution of the shoreline position and velocity for two scenarios concerning the initial free surface elevation in the σ λ space η σ 0 on the one hand we consider the nonlinear case on the other we consider the approximation resulting from the linearization of the transformation 2b for t 0 assuming η x i e x σ 2 see previous section for details in all cases we adopt the threshold ε j 10 2 for the jacobian of the hodograph transformation to illustrate the crucial importance of considering an exact solution for code benchmarking purposes we further compare these results with the ones obtained using a 1d nlsw finite volume code based on the second order monotonic upstream centered scheme for conservation laws muscl methodology employing the van leer limiter van leer 1977 to ensure that the total variation diminishing tvd property is maintained the numerical code described in detail in clain et al 2016 reis et al 2019 vater et al 2015 involves the use of the so called hydrostatic reconstruction technique audusse et al 2004 and the harten lax van leer contact solver see e g toro et al 1994 other methodologies such as the smoothed particle hydrodynamics sph method were developed and used in test cases to check the numerical solution accuracy brecht et al 2018 the time step is controlled by a courant friedrichs lewy coefficient with respect to the first order time step which we set equal to 0 4 of the maximum admissible time step the threshold used to define the water cut off which determines the position velocity of the dry wet interfaces is set to 10 4 finally we adopt the methodology proposed in berger et al 2005 to deal appropriately with the muscl slope limiting procedure on non uniform grids in all numerical simulations performed with this code in the present work the initial configuration is η 0 x when comparing exact and numerical results some convergence analysis is conducted and the following definitions are used the l 1 and l errors for a bounded l 1 function ξ are given by l 1 error ϵ ξ 1 i 1 i ξ i j ξ i e x δ x i l l error ϵ ξ max i 1 i ξ i j ξ i e x where ξ i e x i 1 i and ξ i j i 1 i are respectively the exact and the approximated cell mean values at the simulation time of interest t j while i stands for the number of mesh cells involved l for the corresponding domain length and δxi for the length of the ith mesh cell in fig 2 we depict the initial free surface elevation for the four cases the initial waveforms are presented for both the nonlinear and linear approaches as expected the linearization results in a shift of the initial wave profile whereas the maximum initial displacement remains unchanged we notice that the shift of the initial waveforms is more visible when η 0 x x is less fulfilled allowing for the maximum elevation differences of around 3 5 between the linear and nonlinear cases 3 2 free surface elevation and velocity profiles near the shoreline the differences observed for each case between the linear and the nonlinear initial waveforms are expected to have consequences in terms of the propagation of the waves therefore in the following we evaluate the free surface elevation and velocity fields near the shoreline for specific time values for case d we consider three times t 2 2411 t 2 4512 and t 3 0816 these times correspond respectively to the dimensional times t 160 s 175 s and 220 s proposed in benchmark problem 1 of the isec 2004 workshop on long wave runup models when one takes l 5000 m and the beach slope α is set to 1 10 these times were chosen to match the moments when the shoreline velocity is maximum during the initial draw down when maximum shoreline velocity is achieved during the subsequent run up and when the maximum run up occurs respectively as shown in the last two panels of fig 9 it is also of interest to address case c as the initial waveform also involves an ldn wave the times considered are t 1 9409 2 8952 and 3 0812 these correspond to shoreline motion extremes in a way that is very similar to case d see the first pair of panels in fig 9 the associated dimensional times when one takes l 75 000 m and α 1 200 as suggested in carrier et al 2003 are t 2400 s 3580 s and 3810 s the semi analytic results are further compared to those obtained with the muscl numerical code for four different uniform meshes of 2500 5000 10 000 and 20 000 cells for case c we adopt the physical domain 5000 m 295 000 m while for case d the interval 200 m 49 800 m is considered the results obtained for case c for the free surface elevation and the velocity profiles near the shoreline are presented in fig 3 and highlight how the differences in the initial free surface elevations linearized and non linearized yield noticeable differences in the profiles the differences can reach 16 and 40 for the velocity and the free surface elevation respectively in contrast the numerical results obtained with the finest mesh match the nonlinear profiles relatively well this is further confirmed by the convergence in mesh results depicted in fig 4 the results presented correspond to the l 1 and l errors and we report that the average convergence rate is around 1 4 1 7 for the l 1 error and slightly lower for the l error these convergence rates are in line with the second order characteristics of the numerical scheme used and the fact that the shoreline position and velocity are determined using a rather simple cut off threshold procedure the velocity and free surface elevation for case c clearly indicate that the non linearized initial waveform provides a very good agreement with those of the numerical simulations in contrast the profiles obtained with the linearization procedure cannot be used for code benchmarking purposes as they differ significantly from i the nonlinear exact results and ii the numerical results for the analysis of the profiles obtained for case d fig 5 shows the results obtained near the shoreline for both the free surface elevation and the velocity as in case c there are noticeable differences between the linear and nonlinear results these differences can be as high as 9 and 15 for the free surface elevation and the velocity respectively as in case c we observe a good agreement between the numerical simulations obtained with the finest mesh and the nonlinear profiles the corresponding convergence results see figure 6 confirm this fact with convergence rates in the range 1 3 1 8 for the l 1 error and slightly lower values when the l norm is used we note that the results obtained by linearizing the initial free surface elevation correspond to those of benchmark problem 1 of the isec 2004 workshop hence if one takes the physical initial waveform profile η 0 x as the initial configuration for the numerical simulation then the nonlinear approach is mandatory to allow its use in code benchmarking procedures 3 3 evolution of shoreline position and velocity here we analyze the results obtained for the evolution of the shoreline position and velocity we compare the semi analytic results obtained for cases a d depending on the approach used to calculate the initial free surface elevation linear versus nonlinear for cases c and d we further analyze the results obtained using the numerical code as accuracy is a key issue when dealing with numerical results concerning the shoreline we consider non uniform meshes that are finer in the region encompassing the shoreline motion and have a much coarser pattern in the deep ocean for case c we consider a set of seven meshes with 2350 4700 150 400 cells while for case d the seven meshes used have 2645 5290 169 280 cells the patterns of the two coarsest meshes are depicted in fig 7 these meshes are used to generate the finer meshes by dividing each of their cells into 2 4 64 new cells in figs 8 and 9 we present the time evolution of the shoreline position and velocity for cases a d for two different approaches to computing each initial waveform the analysis of the curves presented in both figures leads to the conclusion that although the overall shape of the evolution curves obtained using the two distinct methodologies is similar significant differences can be observed in the vicinity of the local extremes for both the shoreline position and velocity in particular we conclude that the linear approach leads to an overestimation of the maximum run up and maximum shoreward velocity whereas the resulting maximum draw down and maximum offshore velocity are underestimated fig 9 also depicts the results obtained in the vicinity of the most relevant local extremes for cases c and d using the muscl numerical code the agreement of the numerical results with the ones obtained using the nonlinear approach is very good this fact is further confirmed by the corresponding convergence analysis in mesh presented further below in table 1 we quantify in a detailed manner the differences in some extreme values concerning the evolution of the shoreline that results from each methodology used to calculate the initial free surface elevation of the waves the maximum run up maximum draw down maximum shoreward velocity and maximum offshore velocity in table 2 we present the differences obtained for the maximum momentum flux per unit breadth qu 2 as this parameter has also been addressed in the carrier el al study carrier et al 2003 analyzing the results presented in table 1 we observe that the differences in the maximum run up range between 0 4 case b and 1 9 case c while for the maximum draw down they can reach 2 5 case a the time values corresponding to these extremes are less sensitive to the methodology used the differences observed staying below 0 6 the maximum shoreward velocity presents the highest differences ranging from 3 9 case b to 6 1 case c the wave position corresponding to the extreme values of the shoreward velocity presents differences that can be as high as 3 5 case c while the differences for the corresponding time tend to be smaller 1 3 as for the maximum offshore velocity the differences are in the interval 3 4 case c 4 1 case a the time differences are once again somewhat smaller 0 9 whereas position differences as high as 37 case c are observed the results for the maximum momentum flux shown in table 2 present differences between 0 3 case c and 0 9 cases b and d the differences can be as high as 2 6 cases b and d for the corresponding position as for the value of σ typically of the order of 0 2 i e near the shoreline the differences observed for the different cases are of the order of 2 therefore the analysis of the results clearly shows that the methodology used to calculate the initial waveform has a non negligible impact on the extreme values observed for the shoreline position and velocity we already drew a similar conclusion concerning the free surface elevation and velocity profiles near the shoreline moreover we note that the numerical results obtained with the muscl code cf fig 9 are clearly in line with those of the nonlinear approach see below for detailed convergence analysis another important conclusion is that the extreme values presented in tables 1 and 2 for the linear approach are precisely the same as those that can be found in table 1 of the carrier el al study carrier et al 2003 there are a few slight differences but these are a consequence of the coarseness of the σ λ grid used to obtain the results in equation 9 of carrier et al 2003 the authors adopt the linear approximation explicitly for the initial water surface displacement considered stressing that this procedure is adopted for simple convenience as this aspect is never referred to again throughout the rest of their work the reader is probably led to think that the results presented in section 4 therein where cases a d are first introduced and analyzed were obtained without any approximation concerning the initial wave profile from our results we conclude that in fact all extreme results presented in that work were obtained using the linear procedure this unfortunate misleading led to an inevitable contamination of studies focusing on the slope beach problem that took the extreme results presented in the carrier el al study carrier et al 2003 as reference assuming these were obtained without any approximation for instance the description of benchmark problem 1 of the isec 2004 workshop on long wave runup models refers to carrier et al 2003 and effectively the benchmark data corresponds to case d when one takes l 5000 m and α 1 10 as claimed but only if the linear approximation is used to calculate the initial waveform in contrast in the kânoğlu 2004 study kânoğlu 2004 we can find another striking example of the unexpected consequences of this misleading the author presents a simplified technique involving among other processes the linearization of the initial free surface elevation and compares the results obtained in his work with those presented in carrier et al 2003 as the results are essentially the same cf table 1 of kânoğlu 2004 the author naturally concludes that linearization of the initial condition does not appear to affect the subsequent nonlinear evolution as shown through comparison with earlier studies in fact both carrier et al 2003 and kânoğlu 2004 use the linearization procedure and the cause of some small discrepancies between their results is probably due to the coarseness of the σ λ grid used in the calculations the conclusions of kânoğlu 2004 concerning the advantages of the unharmful linearization procedure were subsequently used in a considerable number of reference works in the field of nonlinear shallow water wave equations see e g aydin 2011 aydin and kânoğlu 2007 aydin and kânoğlu 2017 kânoğlu and synolakis 2006 to the authors knowledge there are no published works addressing the impact of the initial linearization procedure in the nonlinear evolution of the waves in the framework of the slope beach problem in fig 10 we illustrate the convergence in mesh for the maximum run up maximum draw down maximum shoreward velocity and maximum seaward velocity for cases c and d the convergence in mesh of the numerical results with respect to the ones derived using the semi analytic nonlinear procedure is clear we observe that for case c the maximum run up obtained with a water cut off threshold of 10 4 does not exactly match the analytical value in fact as shown in the top left panel this extreme value is sensitive to the threshold value used in the simple water cut off procedure adopted in the code nevertheless we observe that a good agreement is obtained when a threshold of 10 5 is used and we stress that in all cases the results obtained with the numerical code differ considerably from those derived using a linearization of the initial waveform this confirms once again the incompatibility of use of the physical exact initial waveforms proposed for cases a d as given by 24 27 and the linearization procedure in the framework of code benchmarking 3 4 non null initial velocity case until now we have devoted our attention to the zero initial velocity case i e u 0 x u x t 0 0 as this is the case that is addressed in detail not only in the carrier et al study carrier et al 2003 but also in a series of works that have been published subsequently assuming u 0 x 0 one can still derive semi analytic expressions for the potential φ σ λ using 6 as starting point and accounting for the contribution of u 0 to p σ and f σ given by 5 therefore expressions for the evolution of shoreline position and velocity can be derived in a similar way to the one described above for the initial static case however the initial conditions for the ivp resulting from 2a are now posed for λ 0 λ x t 0 u 0 x where u 0 x is given for example by i the exact nonlinear relation kânoğlu and synolakis 2006 10 u 0 x 2 x 2 x η 0 x ii the linear approximation used in carrier et al 2003 11 u 0 x η 0 x x iii or alternatively by the relation suggested in pritchard and dickinson 2007 in the framework of an asymptotic near shore analysis of the problem 12 u 0 x η 0 x implying in all these cases that λ 0 depends on σ due to 2b as a consequence the corresponding potential 13 φ σ λ 2 0 0 b f b j 0 ρ σ sin ρ λ λ 0 2 j 0 ρ b d ρ d b 0 0 ρ b p b j 0 ρ σ cos ρ λ λ 0 2 j 0 ρ b d ρ d b does not solve equation 4a of the ivp exactly anymore providing an approximation to the solution up to an order of at least u 0 σ as shown in nicolsky et al 2018 as observed by the authors of that work the approximated solution provided by 13 might break down for near shore waves with large initial velocities to illustrate this situation we consider case d once again but now with u 0 x given by 12 as this approximation provides the highest extreme values for the shoreline position and velocity see aydin and kânoğlu 2017and references therein while formulations 20 and 11 lead to very similar results see kânoğlu and synolakis 2006 in this new case we consider that constants a 1 and a 2 used in 3 are now equal to 40 of their initial static case values i e a 1 0 0024 and a 2 0 0072 this reduction of the ldn wave initial amplitude with respect to case d is carried out to ensure that the jacobian of the hodograph transformation 3 stays in the interval ε j ε j 1 throughout the wave propagation for the sake of simplicity we shall denote this case d in fig 11 we present the initial free surface elevation and velocity for case d the evolution of the shoreline position and velocity is depicted in fig 12 this figure intends to illustrate the difference between the results obtained using the potential 13 and those given by the muscl numerical technique when u 0 x is given by 12 the code settings used in the simulation are the same as those described previously for case d the results obtained for both the shoreline position and the velocity using the semi analytic trigonometric formulation are generally close to the numerical reference results but there are clear differences around the maximum run up 1 maximum draw down 0 4 maximum shoreward velocity 2 5 and maximum offshore velocity 2 7 confirming the limitations of using 13 when u 0 x is not constant 4 conclusions the slope beach problem is a popular benchmark for code validation that involves a dry wet interface moving on a non constant topography the semi analytical solution proposed in the literature is based on an important assumption that enables one to easily evaluate the initial condition in the σ λ space from the initial water height given in terms of variable x we show the limitations of such an approximation and quantify the deviation introduced by this linearization procedure in particular the convergence order of a discrete numerical scheme cannot be evaluated if this approximation concerning the initial waveform is used we then propose a new technique to provide a semi analytical solution with no linearization numerical simulations performed with an independent finite volume code prove that the full nonlinear solution is the correct one and we obtain the expected convergence we also assess the error deriving from the linearization to establish some criteria for choosing the method with or without linearization the assumption x σ 2 produces in general a relative error of a few percent and could be used in a wide range of applications nevertheless for applications that require a more accurate evaluation of the physical quantities computation of the full nonlinear solution is mandatory for this reason we provide as an additional material to the present paper two sets of spreadsheets containing highly accurate approximations of the exact non linearized solution for cases c and d that can be used for code benchmarking purposes author statement all authors have materially participated in the research all aspects and article preparation all sections declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors acknowledge the financial support provided by the fundo europeu de desenvolvimento regional feder through the programa operacional fatores de competitividade compete 2020 project poci 01 0145 feder 028118 and the national funds through the fundação para a ciência e a tecnologia with reference ptdc mat apl 28118 2017 this work was supported by the portuguese foundation for science and technology fct in the framework of the strategic funding uid fis 04650 2019 supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j advwatres 2020 103751 https data mendeley com datasets 7by5kxsdk4 draft a e3db45dc 03e1 4d5b a0e0 ba7fd533123f appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
407,we detail a new semi analytic solution for the slope beach problem in which linearization of the initial waveform is not carried out to provide the exact corresponding boundary condition for the transformed problem numerical code benchmarking requires the construction of exact solutions to check the convergence order and efficiently compare the simulations using fine meshes we quantify the impact of the linearization assumption and compare two situations linearized and non linearized with a second order finite volume code the accuracy of the shoreline velocity maximum run up and maximum run down situations in particular are of crucial importance in applications as they characterize the inundation and impact intensity of a wave on potential infrastructure to this end we provide two sets of spreadsheets containing highly accurate approximations of the exact non linearized solution for cases c and d of carrier et al 2003 study for benchmarking purposes keywords slope beach problem code benchmarking analytical solution shallow water linearization 1 introduction the slope beach problem is a rare semi analytical solution for the shallow water problem involving a dry wet interface moving on a non constant topography it is an excellent configuration for benchmarking numerical solutions and to check software introduced in the seminal carrier and greenspan 1958 paper see also the introduction in synolakis 1987 on the historical contributions to the linear case the hodograph transformation has received several major contributions in the two last decades see e g carrier et al 2003 kânoğlu 2004 kânoğlu and synolakis 2006 the method is based on the introduction of two new independent variables σ λ in functions of water height time and velocity these transform the shallow water equations into a second order linear partial differential equation pde problem as below 4 σ φ λ λ σ φ σ σ 0 where φ is the potential from which the primitive variables of the flow can be recovered to solve the linear transformed problem in variables σ λ initial conditions are prescribed at λ 0 where one assumes a null velocity configuration for the initial condition carrier et al 2003 a linearization is performed to derive an equivalent initial condition in function of σ from the initial water height profile given with respect to x the solution is then provided by a convolution operator involving functions with integral singularities kânoğlu and collaborators kânoğlu and synolakis 2006 consider non null initial velocity to provide a more complete formulation but linearization of the initial waveform is still employed to produce the initial condition with respect to variable σ very recent papers see e g aydin and kânoğlu 2017 use the same approximation x σ 2 to provide the initial condition and perform benchmarking synolakis et al 2008 as mentioned by kânoğlu in kânoğlu 2004 despite the linearization used to specify the boundary condition the subsequent analytical solution maintains the nonlinear effects as shown by synolakis 1987 and titov and synolakis 1995 through comparisons with laboratory data and numerical predictions respectively indeed the nonlinearity effect of the shallow water equations is preserved even with the linearization of the initial condition however during the development of a numerical code based on a new finite volume technology reis et al 2019 we observed that the numerical solution did not converge towards the benchmark data presented in the framework of the isec 2004 workshop on long wave runup models which is based on the widely used semi analytical solution provided in the carrier et al work carrier et al 2003 for coarse meshes the two solutions are similar with respect to the scheme error but for finer meshes we found that our numerical solution does not converge to the analytical one the expected convergence orders in particular are not obtained we discovered that this issue is caused by the linearization of the initial condition for finer meshes assuming x σ 2 produces an error larger than the numerical one consequently the linearized slope beach benchmark is not appropriate to check the convergence order of the numerical method in this context it is worth noting that li and raichlen 2001 proposed in the framework of the study of the runup of solitary waves on a uniform plane beach connected to an open ocean of constant depth an improvement of the methodology used in synolakis 1987 by retaining a one order higher term in the taylor s series then the semi analytical solution turns to be more accurate nevertheless as soon as we introduce an approximation in the construction of the semi analytical solution we theoretically have an error that disables the convergence analysis which is the main goal of our paper in the present work we propose an extension of the carrier and greenspan method without using an approximation for the initial condition concerning the waveform we implement a new semi analytical solution and compare it with numerical solutions obtained with the second order finite volume code we prove that we can recover the correct convergence order moreover we provide a quantification of the error introduced by the linearization of the initial water surface displacement the structure of the paper is as follows section 2 is dedicated to the construction of the analytical solution while section 3 presents an extensive numerical study of the theoretical solution and comparisons with the finite volume approximation and the one deriving from the linearization assumption 2 analytical solution of the ivp we consider the nonlinear shallow water problem introduced in carrier and greenspan 1958 carrier et al 2003 kânoğlu 2004 kânoğlu and synolakis 2006 using the non dimensional form of the 1d nonlinear shallow water nlsw equations for propagation over a plane beach with a uniform slope on an infinite domain the equations in question are 1a η t h η u x 0 1b u t u u x η x 0 where h x x is the undisturbed water depth while u x t and η x t represent respectively the depth averaged horizontal velocity and the free surface elevation with respect to the still water level swl the non dimensional quantities present in 1 are related to their dimensional counterparts by x l x t l α g t η α l η u g α l u where l is a characteristic horizontal length g is the gravitational acceleration and α tan β is the beach slope the corresponding problem geometry is presented in fig 1 using a hodograph transformation slightly different from the one used in the carrier and greenspan pioneering study carrier and greenspan 1958 namely 2a λ t u 2b q σ 2 x η and defining the functional ψ η u 2 2 carrier and collaborators carrier et al 2003 used 1 to derive the following equation 4 σ ψ λ λ σ ψ σ σ 0 with the moving shoreline corresponding to σ 0 by further defining the potential φ such that ψ φ λ together with 3a u φ σ 2 σ 3b η φ λ φ σ 2 8 σ 2 and assuming that initial conditions correspond to λ 0 see more below the following initial value problem ivp was obtained 4a 4 σ φ λ λ σ φ σ σ 0 4b φ σ 0 p σ 4c φ λ σ 0 f σ with 5a p σ 0 σ 2 s u s 0 d s 5b f σ η σ 0 1 2 u 2 σ 0 to solve this ivp the authors used the hankel transform to derive an analytical expression for the potential involving trigonometric functions and a bessel function of the first kind 6 φ σ λ 2 0 0 b f b j 0 ρ σ sin ρ λ 2 j 0 ρ b d ρ d b 0 0 ρ b p b j 0 ρ σ cos ρ λ 2 j 0 ρ b d ρ d b by invoking the green function they further derived φ σ λ 2 i 1 σ λ i 2 σ λ λ in which i 1 σ λ 0 f b g b σ λ d b i 2 σ λ 0 p b g b σ λ d b noticing that g b σ λ presents a singularity for b λ 2 σ and taking advantage of the green function definition see e g 22 in carrier et al 2003 integrals i 1 and i 2 are given in a more convenient form namely i 1 b 1 b 2 f b τ 1 b σ λ d b b 2 b 3 f b τ 2 b σ λ d b with a similar expression for i 2 where b 1 max 0 σ λ 2 b 2 σ λ 2 b 3 σ λ 2 with τ 1 b σ λ 4 π b λ 2 4 b σ 2 k 16 b σ λ 2 4 b σ 2 τ 2 b σ λ 1 π b σ k λ 2 4 b σ 2 16 b σ where k is the complete elliptic integral of the first kind the singularity at b λ 2 σ is handled using an appropriate standard numerical integration tool as long as σ 10 3 for smaller values of σ our experience shows that errors from the numerical integration and or differentiation do not allow to obtain accurate exact solutions therefore if the focus concerns the shoreline i e σ 0 one has to employ an alternative specific analytical approach see further below the plane beach problem is a very important test for numerical code benchmarking and delivering the exact solution is mandatory for both the velocity and free surface elevation fields and the evolution of the shoreline position and frontline velocity the two issues will be addressed in detail in the following section considering the initial static case i e u 0 x u x t 0 0 the general case with a non null initial velocity will be discussed briefly at the end of the section devoted to the applications 2 1 computation of velocity and free surface elevation fields we start by noting that as u 0 x 0 then p b 0 implying i 2 0 while the expression of f simplifies to f σ η σ 0 the values of the velocity and free surface elevation are computed for given values of the location x and time t say x and t using the set of equations 3 this involves computing the value of σ λ corresponding to the physical coordinates x t and then evaluating the first order derivatives of the potential φ with respect to σ and λ seen as a whole these tasks are achieved by evaluating the first and second order partial derivatives of φ numerically using a robust adaptive numerical differentiation tool the derivestsuite developed by john d errico for matlab in fact determining σ λ for a given x t is achieved using the following newton raphson strategy on the set of equations 2 σ i 1 σ i 1 u λ σ i λ i t t σ i λ i η λ σ i λ i x x σ i λ i d σ i λ i λ i 1 λ i t t σ i λ i u σ σ i λ i x x σ i λ i 2 σ i η σ σ i λ i d σ i λ i with d σ i λ i 1 u λ σ i λ i u σ σ i λ i η λ σ i λ i 2 σ i η σ σ i λ i a newton raphson splitting technique can also be used see e g kânoğlu 2004 synolakis 1987 to accomplish this alternatively when dealing with several grid points the solution can be found via interpolation using delaunay triangulation see e g anderson et al 2017 then once σ λ has been determined to the required numerical precision the velocity and free surface elevation are determined using 3 at this point it is of utmost importance to stress that the numerical computation of i 1 requires the evaluation of η σ 0 for given values of σ however the physical problem is generally given in terms of η 0 x η x t 0 the initial free surface elevation field therefore we consider the identity 2b written for t 0 i e σ 2 x η 0 x and set η σ 0 η 0 x with x given by the newton raphson iterative procedure 7 x i 1 x i σ 2 η 0 x i x i 1 η 0 x i where η 0 denotes the first derivative of η 0 x with respect to x because in the context of tsunami simulation η 0 is generally a very smooth function with η 0 x 1 see e g nicolsky et al 2018 and references therein only a few iterations are needed to determine x to machine precision we further note that the iterative procedure starts with x 1 σ 2 that is precisely the restrictive linear approximation for the initial free surface elevation field often used in the literature see further therefore in practical terms the linear approximation is obtained by restricting the iterative procedure to its initial guess whereas the nonlinear approach corresponds to performing the full iterative procedure 7 up to the accuracy threshold to guarantee that the transformation 2 is single valued for all target values x t we monitor the value of the corresponding jacobian j x q t λ x λ t q combining 2 and 3 we derive j 1 u λ 2 1 4 u σ 2 if j or 1 j is smaller than a certain threshold say ε j the results obtained are discarded as they might be non physical we prefer to use j instead of the alternative jacobian x σ t λ x λ t σ see e g kânoğlu 2004 as the latter equals 2σj and thus tends to zero as one approaches the shoreline preventing its use to assess the physical admissibility of the solution in that region 2 2 computation of shoreline velocity and position we now turn to the computation of the time evolution of the shoreline velocity us and position xs which are given by cf 3 u s φ σ 2 σ σ 0 x s η s 1 2 u s 2 φ λ σ 0 first as uσ vanishes on the shoreline the jacobian of the transformation becomes j s 1 u s λ 2 from 3a we derive the relation u s φ σ σ 2 σ 0 rewriting 4a as φ σ σ 4 φ λ λ φ σ σ we finally obtain u s φ λ λ σ 0 therefore determining us and xs relies only on the evaluation of the first and second derivatives of function φ λ φ 0 λ that is 8a u s φ λ λ 8b x s 1 2 u s 2 φ λ while the jacobian js further requires the evaluation of φ λ λ λ from 6 and defining η b η b 0 we now obtain φ λ 2 0 η b b 0 sin ρ λ 2 j 0 ρ b d ρ d b as see carrier et al 2003 and references therein 0 sin ρ λ 2 j 0 ρ b d ρ h λ 2 b h λ 2 b λ 2 4 b 2 where h is the heaviside function we have φ λ 4 0 λ 2 η b b λ 2 4 b 2 d b integration by parts and the leibniz rule for integrals lead to φ λ λ η 0 π λ 4 d η λ 2 d b λ 2 0 λ 2 d 2 η b d b 2 arcsin 2 b λ d b and φ λ λ λ π 4 d η λ 2 d b π λ 8 d 2 η λ 2 d b 2 λ 2 d 2 η 0 d b 2 1 2 0 λ 2 d 3 η b d b 3 λ 2 4 b 2 b arcsin 2 b λ d b enabling us to compute the evolution of us and xs or η s x s from 8 the derivatives of η b appearing in the two previous integrals are obtained from the derivatives of η 0 x using the chain rule taking 2b into account the computation of the jacobian js is straightforward because 9 u s λ φ λ λ λ 1 2 d 2 η 0 d b 2 3 π λ 32 d 3 η λ 2 d b 3 1 8 0 λ 2 d 4 η b d b 4 b λ λ 2 4 b 2 3 2 λ arcsin 2 b λ d b again for a given time t the corresponding value of λ if it exists is calculated recurring to 2a taking σ 0 in this context it is useful to define the function μ λ λ u s λ t then given t the required value of λ is obtained within a prescribed precision typically 10 7 using the matlab minimizer function fminbnd on μ we find that for some values of t the minimum value of μ is not close to zero 10 8 indicating that λ u s λ t has no solution this is further supported by the fact that in these cases js almost vanishes hence the calculations for these specific values of t are discarded an alternative procedure would be to set a sequence λn and then derive t n λ n u s λ n however the monotonicity of λn does not ensure the monotonicity of t n leading to a requirement for the properties of t n to be monitored to avoid non physical time sequences as observed in the plane beach benchmark shoreline data presented in the framework of the isec 2004 workshop on long wave runup models see http isec nacse org workshop 2004 cornell bmark1 html 3 applications 3 1 initial waveforms having presented the methodology to compute the exact solution of the 1d uniformly sloping beach problem we now apply it to the four cases presented in the carrier et al study carrier et al 2003 the initial free surface elevation of each of these initial static cases is given by a the gaussian shape initial waveform η 0 x a exp k x x 0 2 with a 0 0017 k 4 0 x 0 1 69 b the negative gaussian shape the inverse profile of case a η 0 x a exp k x x 0 2 c the leading depression n wave ldn shape typically caused by a seismic fault dislocation by a subduction earthquake η 0 x a 1 exp k 1 x x 1 2 a 2 exp k 2 x x 2 2 where a 1 0 02 a 2 0 01 k 1 k 2 3 5 x 1 1 5625 x 2 1 0 d the ldn wave shape typically caused by an offshore submarine landslide η 0 x a 1 exp k 1 x x 1 2 a 2 exp k 2 x x 2 2 with a 1 0 006 a 2 0 018 k 1 4 9 k 2 4 0 x 1 4 1209 x 2 1 6384 cases c and d were used in recent studies brecht et al 2018 clain et al 2016 reis et al 2019 vater et al 2015 as part of numerical code benchmarking procedures in the context of tsunami simulation we compare the semi analytic results obtained for the free surface elevation and velocity fields for given time values and for the evolution of the shoreline position and velocity for two scenarios concerning the initial free surface elevation in the σ λ space η σ 0 on the one hand we consider the nonlinear case on the other we consider the approximation resulting from the linearization of the transformation 2b for t 0 assuming η x i e x σ 2 see previous section for details in all cases we adopt the threshold ε j 10 2 for the jacobian of the hodograph transformation to illustrate the crucial importance of considering an exact solution for code benchmarking purposes we further compare these results with the ones obtained using a 1d nlsw finite volume code based on the second order monotonic upstream centered scheme for conservation laws muscl methodology employing the van leer limiter van leer 1977 to ensure that the total variation diminishing tvd property is maintained the numerical code described in detail in clain et al 2016 reis et al 2019 vater et al 2015 involves the use of the so called hydrostatic reconstruction technique audusse et al 2004 and the harten lax van leer contact solver see e g toro et al 1994 other methodologies such as the smoothed particle hydrodynamics sph method were developed and used in test cases to check the numerical solution accuracy brecht et al 2018 the time step is controlled by a courant friedrichs lewy coefficient with respect to the first order time step which we set equal to 0 4 of the maximum admissible time step the threshold used to define the water cut off which determines the position velocity of the dry wet interfaces is set to 10 4 finally we adopt the methodology proposed in berger et al 2005 to deal appropriately with the muscl slope limiting procedure on non uniform grids in all numerical simulations performed with this code in the present work the initial configuration is η 0 x when comparing exact and numerical results some convergence analysis is conducted and the following definitions are used the l 1 and l errors for a bounded l 1 function ξ are given by l 1 error ϵ ξ 1 i 1 i ξ i j ξ i e x δ x i l l error ϵ ξ max i 1 i ξ i j ξ i e x where ξ i e x i 1 i and ξ i j i 1 i are respectively the exact and the approximated cell mean values at the simulation time of interest t j while i stands for the number of mesh cells involved l for the corresponding domain length and δxi for the length of the ith mesh cell in fig 2 we depict the initial free surface elevation for the four cases the initial waveforms are presented for both the nonlinear and linear approaches as expected the linearization results in a shift of the initial wave profile whereas the maximum initial displacement remains unchanged we notice that the shift of the initial waveforms is more visible when η 0 x x is less fulfilled allowing for the maximum elevation differences of around 3 5 between the linear and nonlinear cases 3 2 free surface elevation and velocity profiles near the shoreline the differences observed for each case between the linear and the nonlinear initial waveforms are expected to have consequences in terms of the propagation of the waves therefore in the following we evaluate the free surface elevation and velocity fields near the shoreline for specific time values for case d we consider three times t 2 2411 t 2 4512 and t 3 0816 these times correspond respectively to the dimensional times t 160 s 175 s and 220 s proposed in benchmark problem 1 of the isec 2004 workshop on long wave runup models when one takes l 5000 m and the beach slope α is set to 1 10 these times were chosen to match the moments when the shoreline velocity is maximum during the initial draw down when maximum shoreline velocity is achieved during the subsequent run up and when the maximum run up occurs respectively as shown in the last two panels of fig 9 it is also of interest to address case c as the initial waveform also involves an ldn wave the times considered are t 1 9409 2 8952 and 3 0812 these correspond to shoreline motion extremes in a way that is very similar to case d see the first pair of panels in fig 9 the associated dimensional times when one takes l 75 000 m and α 1 200 as suggested in carrier et al 2003 are t 2400 s 3580 s and 3810 s the semi analytic results are further compared to those obtained with the muscl numerical code for four different uniform meshes of 2500 5000 10 000 and 20 000 cells for case c we adopt the physical domain 5000 m 295 000 m while for case d the interval 200 m 49 800 m is considered the results obtained for case c for the free surface elevation and the velocity profiles near the shoreline are presented in fig 3 and highlight how the differences in the initial free surface elevations linearized and non linearized yield noticeable differences in the profiles the differences can reach 16 and 40 for the velocity and the free surface elevation respectively in contrast the numerical results obtained with the finest mesh match the nonlinear profiles relatively well this is further confirmed by the convergence in mesh results depicted in fig 4 the results presented correspond to the l 1 and l errors and we report that the average convergence rate is around 1 4 1 7 for the l 1 error and slightly lower for the l error these convergence rates are in line with the second order characteristics of the numerical scheme used and the fact that the shoreline position and velocity are determined using a rather simple cut off threshold procedure the velocity and free surface elevation for case c clearly indicate that the non linearized initial waveform provides a very good agreement with those of the numerical simulations in contrast the profiles obtained with the linearization procedure cannot be used for code benchmarking purposes as they differ significantly from i the nonlinear exact results and ii the numerical results for the analysis of the profiles obtained for case d fig 5 shows the results obtained near the shoreline for both the free surface elevation and the velocity as in case c there are noticeable differences between the linear and nonlinear results these differences can be as high as 9 and 15 for the free surface elevation and the velocity respectively as in case c we observe a good agreement between the numerical simulations obtained with the finest mesh and the nonlinear profiles the corresponding convergence results see figure 6 confirm this fact with convergence rates in the range 1 3 1 8 for the l 1 error and slightly lower values when the l norm is used we note that the results obtained by linearizing the initial free surface elevation correspond to those of benchmark problem 1 of the isec 2004 workshop hence if one takes the physical initial waveform profile η 0 x as the initial configuration for the numerical simulation then the nonlinear approach is mandatory to allow its use in code benchmarking procedures 3 3 evolution of shoreline position and velocity here we analyze the results obtained for the evolution of the shoreline position and velocity we compare the semi analytic results obtained for cases a d depending on the approach used to calculate the initial free surface elevation linear versus nonlinear for cases c and d we further analyze the results obtained using the numerical code as accuracy is a key issue when dealing with numerical results concerning the shoreline we consider non uniform meshes that are finer in the region encompassing the shoreline motion and have a much coarser pattern in the deep ocean for case c we consider a set of seven meshes with 2350 4700 150 400 cells while for case d the seven meshes used have 2645 5290 169 280 cells the patterns of the two coarsest meshes are depicted in fig 7 these meshes are used to generate the finer meshes by dividing each of their cells into 2 4 64 new cells in figs 8 and 9 we present the time evolution of the shoreline position and velocity for cases a d for two different approaches to computing each initial waveform the analysis of the curves presented in both figures leads to the conclusion that although the overall shape of the evolution curves obtained using the two distinct methodologies is similar significant differences can be observed in the vicinity of the local extremes for both the shoreline position and velocity in particular we conclude that the linear approach leads to an overestimation of the maximum run up and maximum shoreward velocity whereas the resulting maximum draw down and maximum offshore velocity are underestimated fig 9 also depicts the results obtained in the vicinity of the most relevant local extremes for cases c and d using the muscl numerical code the agreement of the numerical results with the ones obtained using the nonlinear approach is very good this fact is further confirmed by the corresponding convergence analysis in mesh presented further below in table 1 we quantify in a detailed manner the differences in some extreme values concerning the evolution of the shoreline that results from each methodology used to calculate the initial free surface elevation of the waves the maximum run up maximum draw down maximum shoreward velocity and maximum offshore velocity in table 2 we present the differences obtained for the maximum momentum flux per unit breadth qu 2 as this parameter has also been addressed in the carrier el al study carrier et al 2003 analyzing the results presented in table 1 we observe that the differences in the maximum run up range between 0 4 case b and 1 9 case c while for the maximum draw down they can reach 2 5 case a the time values corresponding to these extremes are less sensitive to the methodology used the differences observed staying below 0 6 the maximum shoreward velocity presents the highest differences ranging from 3 9 case b to 6 1 case c the wave position corresponding to the extreme values of the shoreward velocity presents differences that can be as high as 3 5 case c while the differences for the corresponding time tend to be smaller 1 3 as for the maximum offshore velocity the differences are in the interval 3 4 case c 4 1 case a the time differences are once again somewhat smaller 0 9 whereas position differences as high as 37 case c are observed the results for the maximum momentum flux shown in table 2 present differences between 0 3 case c and 0 9 cases b and d the differences can be as high as 2 6 cases b and d for the corresponding position as for the value of σ typically of the order of 0 2 i e near the shoreline the differences observed for the different cases are of the order of 2 therefore the analysis of the results clearly shows that the methodology used to calculate the initial waveform has a non negligible impact on the extreme values observed for the shoreline position and velocity we already drew a similar conclusion concerning the free surface elevation and velocity profiles near the shoreline moreover we note that the numerical results obtained with the muscl code cf fig 9 are clearly in line with those of the nonlinear approach see below for detailed convergence analysis another important conclusion is that the extreme values presented in tables 1 and 2 for the linear approach are precisely the same as those that can be found in table 1 of the carrier el al study carrier et al 2003 there are a few slight differences but these are a consequence of the coarseness of the σ λ grid used to obtain the results in equation 9 of carrier et al 2003 the authors adopt the linear approximation explicitly for the initial water surface displacement considered stressing that this procedure is adopted for simple convenience as this aspect is never referred to again throughout the rest of their work the reader is probably led to think that the results presented in section 4 therein where cases a d are first introduced and analyzed were obtained without any approximation concerning the initial wave profile from our results we conclude that in fact all extreme results presented in that work were obtained using the linear procedure this unfortunate misleading led to an inevitable contamination of studies focusing on the slope beach problem that took the extreme results presented in the carrier el al study carrier et al 2003 as reference assuming these were obtained without any approximation for instance the description of benchmark problem 1 of the isec 2004 workshop on long wave runup models refers to carrier et al 2003 and effectively the benchmark data corresponds to case d when one takes l 5000 m and α 1 10 as claimed but only if the linear approximation is used to calculate the initial waveform in contrast in the kânoğlu 2004 study kânoğlu 2004 we can find another striking example of the unexpected consequences of this misleading the author presents a simplified technique involving among other processes the linearization of the initial free surface elevation and compares the results obtained in his work with those presented in carrier et al 2003 as the results are essentially the same cf table 1 of kânoğlu 2004 the author naturally concludes that linearization of the initial condition does not appear to affect the subsequent nonlinear evolution as shown through comparison with earlier studies in fact both carrier et al 2003 and kânoğlu 2004 use the linearization procedure and the cause of some small discrepancies between their results is probably due to the coarseness of the σ λ grid used in the calculations the conclusions of kânoğlu 2004 concerning the advantages of the unharmful linearization procedure were subsequently used in a considerable number of reference works in the field of nonlinear shallow water wave equations see e g aydin 2011 aydin and kânoğlu 2007 aydin and kânoğlu 2017 kânoğlu and synolakis 2006 to the authors knowledge there are no published works addressing the impact of the initial linearization procedure in the nonlinear evolution of the waves in the framework of the slope beach problem in fig 10 we illustrate the convergence in mesh for the maximum run up maximum draw down maximum shoreward velocity and maximum seaward velocity for cases c and d the convergence in mesh of the numerical results with respect to the ones derived using the semi analytic nonlinear procedure is clear we observe that for case c the maximum run up obtained with a water cut off threshold of 10 4 does not exactly match the analytical value in fact as shown in the top left panel this extreme value is sensitive to the threshold value used in the simple water cut off procedure adopted in the code nevertheless we observe that a good agreement is obtained when a threshold of 10 5 is used and we stress that in all cases the results obtained with the numerical code differ considerably from those derived using a linearization of the initial waveform this confirms once again the incompatibility of use of the physical exact initial waveforms proposed for cases a d as given by 24 27 and the linearization procedure in the framework of code benchmarking 3 4 non null initial velocity case until now we have devoted our attention to the zero initial velocity case i e u 0 x u x t 0 0 as this is the case that is addressed in detail not only in the carrier et al study carrier et al 2003 but also in a series of works that have been published subsequently assuming u 0 x 0 one can still derive semi analytic expressions for the potential φ σ λ using 6 as starting point and accounting for the contribution of u 0 to p σ and f σ given by 5 therefore expressions for the evolution of shoreline position and velocity can be derived in a similar way to the one described above for the initial static case however the initial conditions for the ivp resulting from 2a are now posed for λ 0 λ x t 0 u 0 x where u 0 x is given for example by i the exact nonlinear relation kânoğlu and synolakis 2006 10 u 0 x 2 x 2 x η 0 x ii the linear approximation used in carrier et al 2003 11 u 0 x η 0 x x iii or alternatively by the relation suggested in pritchard and dickinson 2007 in the framework of an asymptotic near shore analysis of the problem 12 u 0 x η 0 x implying in all these cases that λ 0 depends on σ due to 2b as a consequence the corresponding potential 13 φ σ λ 2 0 0 b f b j 0 ρ σ sin ρ λ λ 0 2 j 0 ρ b d ρ d b 0 0 ρ b p b j 0 ρ σ cos ρ λ λ 0 2 j 0 ρ b d ρ d b does not solve equation 4a of the ivp exactly anymore providing an approximation to the solution up to an order of at least u 0 σ as shown in nicolsky et al 2018 as observed by the authors of that work the approximated solution provided by 13 might break down for near shore waves with large initial velocities to illustrate this situation we consider case d once again but now with u 0 x given by 12 as this approximation provides the highest extreme values for the shoreline position and velocity see aydin and kânoğlu 2017and references therein while formulations 20 and 11 lead to very similar results see kânoğlu and synolakis 2006 in this new case we consider that constants a 1 and a 2 used in 3 are now equal to 40 of their initial static case values i e a 1 0 0024 and a 2 0 0072 this reduction of the ldn wave initial amplitude with respect to case d is carried out to ensure that the jacobian of the hodograph transformation 3 stays in the interval ε j ε j 1 throughout the wave propagation for the sake of simplicity we shall denote this case d in fig 11 we present the initial free surface elevation and velocity for case d the evolution of the shoreline position and velocity is depicted in fig 12 this figure intends to illustrate the difference between the results obtained using the potential 13 and those given by the muscl numerical technique when u 0 x is given by 12 the code settings used in the simulation are the same as those described previously for case d the results obtained for both the shoreline position and the velocity using the semi analytic trigonometric formulation are generally close to the numerical reference results but there are clear differences around the maximum run up 1 maximum draw down 0 4 maximum shoreward velocity 2 5 and maximum offshore velocity 2 7 confirming the limitations of using 13 when u 0 x is not constant 4 conclusions the slope beach problem is a popular benchmark for code validation that involves a dry wet interface moving on a non constant topography the semi analytical solution proposed in the literature is based on an important assumption that enables one to easily evaluate the initial condition in the σ λ space from the initial water height given in terms of variable x we show the limitations of such an approximation and quantify the deviation introduced by this linearization procedure in particular the convergence order of a discrete numerical scheme cannot be evaluated if this approximation concerning the initial waveform is used we then propose a new technique to provide a semi analytical solution with no linearization numerical simulations performed with an independent finite volume code prove that the full nonlinear solution is the correct one and we obtain the expected convergence we also assess the error deriving from the linearization to establish some criteria for choosing the method with or without linearization the assumption x σ 2 produces in general a relative error of a few percent and could be used in a wide range of applications nevertheless for applications that require a more accurate evaluation of the physical quantities computation of the full nonlinear solution is mandatory for this reason we provide as an additional material to the present paper two sets of spreadsheets containing highly accurate approximations of the exact non linearized solution for cases c and d that can be used for code benchmarking purposes author statement all authors have materially participated in the research all aspects and article preparation all sections declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors acknowledge the financial support provided by the fundo europeu de desenvolvimento regional feder through the programa operacional fatores de competitividade compete 2020 project poci 01 0145 feder 028118 and the national funds through the fundação para a ciência e a tecnologia with reference ptdc mat apl 28118 2017 this work was supported by the portuguese foundation for science and technology fct in the framework of the strategic funding uid fis 04650 2019 supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j advwatres 2020 103751 https data mendeley com datasets 7by5kxsdk4 draft a e3db45dc 03e1 4d5b a0e0 ba7fd533123f appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
408,understanding of the soil moisture movement process in the unsaturated zone is crucial for an accurate estimate of the rate of recharge to the aquifer the goal of the present research is therefore to quantify the temporal variability of moisture movement through the unsaturated zone a new framework for quantifying the temporal variability of soil moisture movement over a relatively large space scale through the unsaturated zone is proposed the unsaturated zone is treated as a nonlinear soil moisture reservoir with a single random input the effective infiltration and a single random output the recharge to the saturated zone in time the variation of volumetric soil moisture in response to the variation of effective infiltration is represented by a nonlinear functional series involving generalizations of the convolution integral which underlies the concept of unit hydrograph a second order autoregressive model is used to account for the temporal behavior of the input process the use of fourier stieltjes representation approach enables developing closed form expressions for the variance of volumetric soil moisture and cross covariance of the soil moisture and effective infiltration the variance can be viewed as an index of temporal variability in soil moisture or uncertainty involved in the modeling process the cross covariance contains information about how two processes are correlated in time focus of analysis is placed on the influence of the controlling parameters on the temporal variability of soil moisture movement keywords soil moisture reservoir nonlinear functional series fourier stieltjes representation variability of soil moisture movement 1 introduction the unsaturated zone or vadose zone is a portion of the subsurface between the land surface and the groundwater table it involves transfer of infiltration to recharge to the groundwater table thus it strongly controls the rate of recharge to the aquifer understanding of the moisture moment process in the unsaturated zone is therefore crucial in predicting the amount of available groundwater for human consumption e g pollacco et al 2008 ries et al 2015 mathias et al 2017 xie et al 2018 richards equation combination of the continuity equation with the darcy equation is the most widely used equation for modeling the moisture movement through the unsaturated zone e g parlange et al 1999 raats 2001 farthing and ogden 2017 it is a nonlinear partial differential equation due to the dependence of unsaturated hydraulic conductivity on the moisture content or capillary pressure head thus the soil water constitutive relations such as moisture content capillary pressure relations and hydraulic conductivity relations must be specified in order to solve richards equation it is found from field observations that the water constitutive relations are strongly dependent on soil texture and structure e g nielsen et al 1973 shouse et al 1995 mallants et al 1996 zaman et al 2004 vereecken et al 2007 mcmillan and srinivasan 2015 the soil hydraulic properties of natural earth materials are observed to be highly variable in space in most cases involving predictions over large scales direct measurements are not possible so that there can be large uncertainty in moisture movement predictions based on richards equation another possible approach to practical problems of unsaturated flow predictions over relatively large space scales has treated the flow processes as a continuous time series rather than the time spatial processes in hydrology the approach of control volume provides the framework for applying the basic principle of conservation of mass in describing the flow process when the control volume is taken to be the entire unsaturated zone the equation of motion for the soil moisture movement process may be represented in a lumped form e g duffy et al 1984 besbes and de marsily 1984 rodriguez iturbe et al 1991 laio et al 2001 albertson and montaldo 2003 montaldo and albertson 2003 as 1 d θ t d t i t r t where θ is the volumetric soil moisture i is the effective infiltration below the root zone and r is the recharge to the saturated zone the approach regards the unsaturated zone as a soil moisture reservoir with a single inflow effective infiltration and a single outflow recharge to the aquifer so thatθ i and r in eq 1 represent spatial averages over the entire unsaturated zone and as such only their temporal variability is retained in general r in eq 1 is a nonlinear function of soil moisture e g porporato et al 2004 botter et al 2009 curtu et al 2014 this leads eq 1 to a nonlinear differential equation which generally does not have an analytical solution it has been reported in the literature e g flake 1963 waddington and fallside 1966 wolf 1968 that the solution to an ordinary nonlinear differential equation 2a d y t d t f y t g t under the initial condition 2b f y 0 0 takes the form 3 y t 0 t h 1 s 1 g s 1 d s 1 0 t 0 t h 1 s 1 s 2 g s 1 g s 2 d s 1 d s 2 0 t 0 t 0 t h n s 1 s 2 s n g s 1 g s 2 g s n d s 1 d s 2 d s n in eqs 2 and 3 y t is a continuous function f y t is a continuous function of y for each value of t g t denotes the forcing function hn s 1 s 2 sn is the nth order volterra kernel and s 1 s 2 sn are variables this implies that the solution of eq 1 will admit the form of volterra series similar to eq 3 note that the volterra integral series initially introduced by wiener 1958 in electronics has been adopted for hydrological systems analysis of the nonlinear response of catchment to the rainfall input e g amorocho and brandstetter 1971 diskin and boneh 1972 napiórkowski and strupczewski 1979 patry and mariño 1983 nourani 2017 the purpose of the present research is to demonstrate an application of volterra integral series to quantify the temporal variability of soil moisture movement through the unsaturated zone this is achieved by treating eq 1 as a stochastic differential equation in time and by applying the fourier stieltjes representation to develop the closed form expressions for the variance of volumetric soil moisture and the cross covariance of soil moisture and effective infiltration the impacts of the controlling parameters on the temporal variability of soil moisture movement are analyzed based on those closed form expressions to our knowledge the application of nonlinear functional series to the analysis of unsaturated flow fields has not been presented so far we hope that the present research will stimulate further research in this area 2 material and methods 2 1 theoretical development the temporal variation of rainfall is usually stochastic in nature resulting in irregular infiltration and recharge to the aquifer thus the present work begins with treating eq 1 as a stochastic equation with a stochastic input the effective infiltration and therefore a stochastic output the recharge to the aquifer that is we consider the unsaturated zone as a soil moisture reservoir with a single stochastic inflow and a single stochastic outflow in addition the recharge to the saturated zone is assumed to depend solely on the volumetric soil moisture stored in the unsaturated zone e g cordova and bras 1981 rodriguez iturbe et al 1991 daly et al 2004 botter et al 2007 andreasen et al 2013 hoekstra 2019 so that the perturbation solution of eq 1 to the fluctuations in effective infiltration can be represented by a volterra integral functional series as 4 θ t 0 t h 1 s 1 u s 1 d s 1 0 t 0 t h 2 s 1 s 2 u s 1 u s 2 d s 1 d s 2 0 t 0 t 0 t h n s 1 s 2 s n u s 1 u s 2 u s n d s 1 d s 2 d s n where θ t and u t denote the fluctuations in volumetric soil moisture and effective infiltration respectively the first term on the right hand side of eq 4 the convolution integral is identical to the solution of a linear model analogous to the unit hydrograph while the remaining terms are generalizations of the linear convolution term the nonlinearity is reflected by the multi dimensional convolution integrals 2 2 stochastic formulation the fourier stieltjes representation theorem treating random processes in terms of general orthogonal expansions in frequency domains e g priestley 1981 provides a convenient way for developing the cross correlation and auto correlation functions which are the tasks undertaken here it plays a central role in much of the theoretical development in the study of subsurface flow in heterogeneous aquifers e g dagan 1989 gelhar 1993 zhang 2002 rubin 2003 consider i t to be a temporal random process with a zero mean and fourier stieltjes representation e g priestley 1965 5 u t λ u ξ t ω e i ω t d z ξ ω where λuξ t ω is the modulating function ω represents the frequency and zξ ω is an orthogonal process with the power spectral density sξξ ω defined as 6 e d z ξ ω 2 s ξ ξ ω d ω by using eq 5 the temporal random output θ t from eq 4 can be shown to be 7 θ t γ 1 t ω 1 exp i ω 1 t d z ξ ω 1 γ 2 t ω 1 ω 2 exp i ω 1 ω 2 t d z ξ ω 1 d z ξ ω 2 γ n t ω 1 ω 2 ω n exp i ω 1 ω 2 ω n t d z ξ ω 1 d z ξ ω 2 d z ξ ω n in which the generalized kernel functions of an infinite sequence are defined as 8 γ 1 t ω 1 0 t h 1 t s 1 λ u ξ s 1 ω 1 exp i ω 1 s 1 t d s 1 γ 2 t ω 1 ω 2 0 t 0 t h 2 t s 1 s 2 λ u ξ s 1 ω 1 λ u ξ s 2 ω 2 exp i ω 1 s 1 t i ω 2 s 2 t d s 1 d s 2 γ n t ω 1 ω n 0 t 0 t h n t s 1 s n λ u ξ s 1 ω 1 λ u ξ s n ω n exp i ω 1 s 1 t i ω n s n t d s 1 d s n for practical purposes the order of nonlinearity in eq 7 may be considered limited one may adopt a truncated form of eq 7 so that the summation is done only up to some finite order the present study assumes that the perturbed terms beyond the second order of the volterra series are negligible e g diskin and boneh 1973 party and mariño 1983 müftüoğlu 1984 napiórkowski 1986 so that eq 7 can be reduced to 9 θ t γ 1 t ω 1 exp i ω 1 t d z ξ ω 1 γ 2 t ω 1 ω 2 exp i ω 1 ω 2 t d z ξ ω 1 d z ξ ω 2 where the perturbed quantities θ are assumed to be excited by a gaussian process zξ eq 9 serves as a basis for the analytical development of covariance and cross covariance functions between u and θ fields note that the covariance of the values of a random field at two different times defines the covariance function while the covariance of two values associated with different random fields defines the cross covariance function e g vanmarcke 1983 2 3 spectral solutions by using the spectral representation theorem and the properties of products of gaussian processes 10 e d z ξ ω 1 d z ξ ω 2 d z ξ ω 3 d z ξ ω 4 e d z ξ ω 1 d z ξ ω 2 e d z ξ ω 3 d z ξ ω 4 e d z ξ ω 1 d z ξ ω 3 e d z ξ ω 2 d z ξ ω 4 e d z ξ ω 1 d z ξ ω 4 e d z ξ ω 2 d z ξ ω 3 in eq 9 the covariance or autocovariance function of the random field θ and cross covariance function between the u input and θ output fields can be computed respectively as 11 c o v θ t θ t t 1 e θ t θ t t 1 e θ t e θ t t 1 γ 1 t ω 1 γ 1 t t 1 ω 1 exp i t 1 ω 1 s ξ ξ ω 1 d ω 1 2 γ 2 t ω 1 ω 2 γ 2 t t 1 ω 1 ω 2 exp i t 1 ω 1 ω 2 s ξ ξ ω 1 s ξ ξ ω 2 d ω 1 d ω 2 12 c u u θ t t 1 t 2 e u t t 1 u t t 2 θ t e θ t 2 λ u ξ t t 1 ω 1 λ u ξ t t 2 ω 2 γ 2 t ω 1 ω 2 exp i ω 1 t 1 ω 2 t 2 s ξ ξ ω 1 s ξ ξ ω 2 d ω 1 d ω 2 the covariance function is a measure of the temporal correlation structure of θ field while the cross covariance function measures how the u and θ fields are correlated in time following priestley 1965 the spectral density of θ can be defined based on eq 11 as 13 s θ θ t ω γ 1 t ω 2 2 γ 2 t ω x 2 s ξ ξ x dx s ξ ξ ω in obtaining the closed form expressions for the covariance and cross covariance functions the type of input process and the form of volterra kernel must be specified we proceed with the assumptions that the spatial average of effective infiltration into the upper soil layer an input to the volterra series is a constant fraction of the rainfall so that 14 u t γ p t where p represents the temporal fluctuations in rainfall rate γ is a constant and the time varying but spatially uniform rainfall over the basin can be described by a continuous second order autoregressive model ar 2 e g mimikdu 1983 thyregod et al 1999 birkel et al 2011 datta and bolisetti 2015 in time the ar 2 model represents a type of random process it specifies the value at the present time depending linearly partly on its own two previous values at times t 1 and t 2 and partly on a stochastic disturbance or white noise that is the present study considers that the values of time series rainfall data are highly correlated with the values that proceed and succeed them when the input and output are both recorded a continuous function of time the associated second order differential equation for the temporal distribution of rainfall rate takes the form e g priestley 1981 15 d 2 p d t 2 α 1 d p d t α 2 p ξ t here α 1 and α 2 are positive parameters and ξ t is a stationary stochastic white noise force with zero mean and constant power spectral density denoted as 16 s ξ ξ ω i ξ making use of fourier stieltjes representations for the perturbed quantities p andξ respectively 17a p t λ p ξ t ω e i ω t d z ξ ω 17b ξ t e i ω t d z ξ ω in eq 15 gives 18 d 2 λ p ξ d t 2 α 1 i 2 ω d λ p ξ d t α 2 i α 1 ω ω 2 λ p ξ 1 which has the general solution given by 19 λ p ξ t ω 1 α 2 ω 2 i α 1 ω c 1 exp t 2 β 1 i 2 ω c 2 exp t 2 β 2 i 2 ω with 20a β 1 α 1 α 1 2 4 α 2 20b β 2 α 1 α 1 2 4 α 2 in eq 17a λpξ t ω represents the modulating function for the rainfall process the arbitrary constants c 1 and c 2 in eq 19 can be determined using the initial conditions given it should be recognized that the representation 17b exists and is unique for any zero mean stationary random field e g lumley and panofsky 1964 when the process is nonstationary the representation is no longer valid in the limit when the time step becomes negligible 21 λ p ξ ω 1 α 2 ω 2 i α 1 ω from eq 14 it implies 22 λ u ξ ω γ α 2 ω 2 i α 1 ω that is the input for evaluating eqs 11 and 12 is taken to be a stationary process with a modulating function given by eq 22 3 results and discussion at this point we begin quantitatively evaluating the analytical developments the covariance and cross covariance functions presented in eqs 11 and 12 it seems difficult to identify volterra kernel functions from input out data since the sample of observations contain a large number of unknown parameters e g priestley 1988 however a continuous nonlinear system may be approximated by a sum of a linear system and products of linear systems e g brilliant 1958 van trees 1964 this suggests that the second order kernel function may be defined by the product of linear kernel 23 h 2 t 1 t 2 m h 1 t 1 h 1 t 2 where m is a constant for the calculations presented in this work the transfer function in besbes and de marsily 1984 is used as the kernel function of the linear model 24a h 1 t 1 k n 1 t k n 1 e t k which is identical to the instantaneous unit hydrograph of the nash 1957 model consisting of n identical linear reservoirs in cascade here the parameter n depends on the thickness of the unsaturated zone and the time constant k characterizes the percolation velocity besbes and de marsily 1984 the parameter n in eq 24a could be a fractional number for fractional values of n the factorial in eq 24a is replaced by the gamma function such that 24b h 1 t 1 k φ n t k n 1 e t k where 24c φ n 0 x n 1 e x d x however to take the advantage of closed form solutions the kernel in eq 24a with the value of n 2 is used for evaluating eqs 11 and 12 namely 25 h 1 t t k 2 e t k finally substituting eqs 16 22 23 and 25 into eqs 11 and 12 and by taking t 1 0 t 2 yields the variance of volumetric soil moisture 26 σ θ 2 t e θ t θ t e θ t e θ t σ l θ 2 t 2 m 2 σ l θ 2 t 2 and the cross covariance function between the effective infiltration and soil moisture fields at zero lag 27 c u u θ t e u t u t θ t e θ t π 2 2 k 2 μ 2 γ 4 m i ξ 2 ω 2 in eqs 26 and 27 28a σ l θ 2 t π k μ γ 2 i ξ 1 2 1 λ 1 2 τ 1 2 ψ 1 2 τ 1 λ 1 ψ 2 t ψ 3 1 2 t 2 τ 1 2 ψ 4 28b ω t τ 1 λ 1 ψ 1 λ 2 ψ 4 2 ψ 2 4 ψ 3 ψ 5 μ α 1 α 12 4α 2 1 2 λ 1 1 t t t k τ 1 exp t λ 2 1 t and the functions for ψ1 ψ5 are given respectively in appendix a to examine the variance of volumetric soil moisture given by eq 26 plots of eq 28a as a function of η 2 are shown in fig 1 for different values of η 1 the figure indicates that the variance σlθ 2 persists longer for small values of η 1 noticing from eq 26 that the variance σ θ 2 for the nonlinear system is approximated by a linear combination of the variance σlθ 2 for the linear system and products of that the figure therefore implies that σθ 2 increases with a decrease in the parameter α 1 for a fixed value of η 2 fluctuations in rainfall are highly correlated for a small value of α 1 and the correlation decreases as α 1 increases a smaller value of α 1 enhances the persistence of rainfall fluctuations and therefore longer persistence in effective infiltration fluctuations the variance may be regarded as a quantitative measure of temporal variability as such the figure reveals the reduction in the variability of soil moisture moment with the parameter α 1 the figure also depicts the behavior of the variance σlθ 2 as the function of the parameter k it can be clearly seen a decrease in σlθ 2 with an increasing k for a soil moisture reservoir with a larger k quick response to the input the moisture fluctuations introduced by the variation in effective infiltration will tend to have more variable and less persistent fluctuations than those receiving water from the reservoir with a smaller k less persistent fluctuations in soil moisture result in a smaller σlθ 2 and therefore a smaller σθ 2 in conclusion the parameter k decreases the persistence of soil moisture fluctuations and in turn the variance σ θ 2 the cross correlation function given by eq 27 is plotted versus η 2 in fig 2 for different values of η 1 the cross correlation function may also be interpreted as the projection of amplitude of infiltration fluctuations onto that of moisture fluctuations thus as shown in the figure a reduction in the cross correlation of the effective infiltration and volumetric soil moisture with the parameters k or α 1 implies that the contribution of the variability of infiltration processes to that of moisture moment processes decreases with k or α 1 this is consistent with that shown in fig 1 it is important to recognize the difference between the traditional such as albertson and montaldo 2003 and montaldo and albertson 2003 and present studies on characterizing the temporal variability of soil moisture movement albertson and montaldo 2003 and montaldo and albertson 2003 present analyses of the temporal variability of root zone soil moisture by integrating a differential form of mass balance in conjunction with darcy s law over the root zone as such the nonlinear relationship between the flux and moisture content variables must be specified to proceed with their evaluation this implies that the nonlinearity of the moisture flux relationships plays the major factor in influencing the volumetric soil moisture distribution and therefore the temporal variability of soil moisture movement on the other hand the present research treats the entire unsaturated zone as a control volume such that the temporal distribution of volumetric soil moisture can be expressed as a volterra integral series the convolution of the kernels of the system with the input effective infiltration rates without knowing about its internal structure such as the form of nonlinear moisture flux relationship once the forms of kernels for a system are determined from an input and corresponding output records experiments the volumetric soil moisture in response to any given input effective infiltration rate or rainfall rate can be determined and in turn the temporal variability of soil moisture movement in other words the present model disregards the internal mechanism which contributes to the soil moisture movement process and concentrates on the relationships between a model input and an output response function soil moisture is strongly affected by the amount of rainfall which infiltrates into the subsurface soil rainfall processes are generally recognized as being affected by complex natural events the details of which cannot be described precisely consequently the movement of soil moisture is often formulated as a stochastic random process in order to reflect the uncertainty of our knowledge the second moment or variance developed here gives a quantitative measure of uncertainty anticipated in the prediction of temporal soil moisture movement the variability of soil moisture movement strongly controls the rate of recharge to the aquifer the fluctuations in effective infiltration affected by the rainfall runoff transformation is the main forcing for the variability of soil moisture movement therefore changes in the earth s climate have the potential to influence the rate of aquifer recharge and thus the amount of available groundwater however the influence of climate change on the variation of the rate of aquifer recharge is one of the most difficult factors to evaluate when assessing groundwater resources the present approach links the impact of rainfall variability to that of volumetric soil moisture and leads to a closed form expression for quantifying the variability of soil moisture movement which has a clear advantage over the existing approaches the results of this study provide valuable information for the analysis of the effect of climate fluctuations on the variation of rate of aquifer recharge which is a basic prerequisite for efficient ground water resource management equation 28 indicates that once the kernel functions for the nonlinear system are known an estimation of the nonlinear system variance for any given rainfall process can be evaluated therefore for actual hydrological applications the kernels should be identified from observed input output time series the kernels are usually determined for a given real system based on a finite input and corresponding output observations system by optimization methods since the cross correlation technique e g lee and schetzen 1965 priestley 1981 papalexiou 2018 is more relevant to the present study a brief introduction of using that in determining the kernel is outlined below eq 12 in conjunction with its fourier transform can be used to identify the kernel functions of nonlinear integral series using the fourier stieltjes representation e g priestley 1965 for cuuθ 29 c u u θ t s u θ t ω 1 ω 2 d ω 1 d ω 2 and comparing it with eq 12 it follows that 30 s u θ t ω 1 ω 2 2 λ u ξ t ω 1 λ u ξ t ω 2 γ 2 t ω 1 ω 2 s ξ ξ ω 1 s ξ ξ ω 2 which leads to 31 ξ t ω 1 ω 2 1 2 s u θ t ω 1 ω 2 s u u ω 1 s u u ω 2 where suθ is the cross spectrum between u t and θ t suu is the spectral density function of u t and 32 ξ t ω 1 ω 2 0 t 0 t h 2 t s 1 s 2 exp i ω 1 s 1 t i ω 2 s 2 t d s 1 d s 2 as such given finite observations on the input and output processes eqs 31 and 32 enable to estimate the form of kernel by replacing the terms in the numerator and denominator by their respective sample estimates due to the soil moisture process of a stochastic nature there is a need to address the uncertainty involved in the modeling prediction for example accurate prediction of the volumetric soil moisture is required to estimate the recharge into the saturated zone which serves as a basis for the rational management of groundwater resources to account for the random effects in the modeling prediction it may be more reasonable to consider say the mean volumetric soil moisture and plus minus two standard deviations square root of the variances rather than only the mean moisture as a calibration target referring from eq 3 the second order form of mean equation for the volumetric soil moisture is taken in the form 33 θ t 0 t h 1 s 1 u s 1 d s 1 0 t 0 t h 2 s 1 s 2 u s 1 u s 2 d s 1 d s 2 where θ t and u t indicate the means of volumetric soil moisture and effective infiltration respectively eq 15 implies that the temporal distribution of mean rainfall rate is given by 34 p t p 0 exp η 2 2 δ 1 η 1 t where p 0 is the initial rainfall rate and δ1 η 1 2 4 1 2 using eqs 14 23 25 and 34 in eq 33 the mean volumetric soil moisture is described by 35 θ t θ l m θ l 2 where 36a θ l t γ p 0 1 δ 2 t 1 exp δ 2 t δ 2 2 36b δ 2 η 2 δ 1 2 η 1 2 1 η 2 eq 35 twice the square root of eq 26 offers a useful basis for prediction of volumetric soil moisture under uncertainty the present model makes no claims on the knowledge of the soil water constitutive relations such as moisture content capillary pressure relations and hydraulic conductivity relations which are specified by the traditional approach in solving richards equation this implies that the present approach tends to be at an advantage when the soil water constitutive relations involved are unknown or when the relationships for the system are so complex that a conceptual representation of the process would be impractical 4 conclusions the present research proposes a new framework to quantify the temporal variability of soil moisture movement and the cross covariance of soil moisture and effective infiltration the new framework treats the bulk soil volume as a nonlinear reservoir with time variant soil moisture that filters effective infiltration inputs into recharge outputs the novel aspects of the work appear to be the theoretical development based on fourier stieltjes representation and closed form solutions for the soil moisture variance and the cross covariance of soil moisture and effective infiltration in time there is certainly a need to model these variables for applications to land atmosphere interactions ecohydrology and recharge estimation further the proposed approach has the benefit of operating at the bulk soil scale and therefore if an appropriate input output function can be specified at that scale the method does not require specification of smaller scale heterogeneity based on the analysis of the closed form expressions it is found that the smaller values of the parameter k or α 1 lead to larger variability of the soil moisture movement process this is because of that the smaller values of the parameter k or α 1 increases the persistence of soil moisture fluctuations and in turn the variability of the soil moisture movement process when soil moisture movement problems involve predictions over much larger scales the square root of the variance of volumetric soil moisture eq 26 provides a quantification of the uncertainty in application of the mean model in the field eqs 31 and 32 provide a basis for identifying the form of kernel from observed input output time series credit authorship contribution statement ching min chang conceptualization methodology investigation writing original draft writing review editing visualization hund der yeh conceptualization methodology investigation writing original draft writing review editing visualization mo hsiung chuang conceptualization methodology investigation writing original draft writing review editing visualization declaration of competing interest none acknowledgements research leading to this paper has been partially supported by the grant from the taiwan ministry of science and technology under the grants most 106 2621 m 130 002 and 107 2221 e 009 019 my3 we are grateful to the anonymous reviewers for constructive comments that improved the quality of the work supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103752 appendix b supplementary materials image application 1 appendix a expressions for the function in eq 28 a1 ψ 1 2 ρ 1 ρ 1 1 ρ 1 2 2 ρ 2 ρ 2 1 ρ 2 2 a2 ψ 2 1 2 λ 1 τ 1 1 ρ 1 2 τ 2 ρ 1 τ 1 ρ 1 1 ρ 1 2 2 1 2 λ 1 τ 1 1 ρ 2 2 τ 3 ρ 2 τ 1 ρ 2 1 ρ 2 2 2 a3 ψ 3 1 2 t τ 1 1 ρ 1 2 τ 2 τ 1 1 ρ 1 2 2 τ 3 τ 1 1 ρ 2 2 2 1 2 t τ 1 1 ρ 2 2 a4 ψ 4 1 1 ρ 1 2 1 1 ρ 2 2 a5 ψ 5 λ 2 τ 1 1 ρ 1 2 2 τ 1 ρ 1 τ 2 1 ρ 1 2 2 λ 2 τ 1 1 ρ 2 2 2 τ 1 ρ 2 τ 3 1 ρ 2 2 2 with a6 ρ 1 2 2 η 2 η 1 2 2 η 1 η 1 2 4 a7 ρ 2 2 2 η 2 η 1 2 2 η 1 η 1 2 4 η 1 α 1 α 2 η 2 k α 2 τ 2 exp ρ 1 t and τ 3 exp ρ 2 t 
408,understanding of the soil moisture movement process in the unsaturated zone is crucial for an accurate estimate of the rate of recharge to the aquifer the goal of the present research is therefore to quantify the temporal variability of moisture movement through the unsaturated zone a new framework for quantifying the temporal variability of soil moisture movement over a relatively large space scale through the unsaturated zone is proposed the unsaturated zone is treated as a nonlinear soil moisture reservoir with a single random input the effective infiltration and a single random output the recharge to the saturated zone in time the variation of volumetric soil moisture in response to the variation of effective infiltration is represented by a nonlinear functional series involving generalizations of the convolution integral which underlies the concept of unit hydrograph a second order autoregressive model is used to account for the temporal behavior of the input process the use of fourier stieltjes representation approach enables developing closed form expressions for the variance of volumetric soil moisture and cross covariance of the soil moisture and effective infiltration the variance can be viewed as an index of temporal variability in soil moisture or uncertainty involved in the modeling process the cross covariance contains information about how two processes are correlated in time focus of analysis is placed on the influence of the controlling parameters on the temporal variability of soil moisture movement keywords soil moisture reservoir nonlinear functional series fourier stieltjes representation variability of soil moisture movement 1 introduction the unsaturated zone or vadose zone is a portion of the subsurface between the land surface and the groundwater table it involves transfer of infiltration to recharge to the groundwater table thus it strongly controls the rate of recharge to the aquifer understanding of the moisture moment process in the unsaturated zone is therefore crucial in predicting the amount of available groundwater for human consumption e g pollacco et al 2008 ries et al 2015 mathias et al 2017 xie et al 2018 richards equation combination of the continuity equation with the darcy equation is the most widely used equation for modeling the moisture movement through the unsaturated zone e g parlange et al 1999 raats 2001 farthing and ogden 2017 it is a nonlinear partial differential equation due to the dependence of unsaturated hydraulic conductivity on the moisture content or capillary pressure head thus the soil water constitutive relations such as moisture content capillary pressure relations and hydraulic conductivity relations must be specified in order to solve richards equation it is found from field observations that the water constitutive relations are strongly dependent on soil texture and structure e g nielsen et al 1973 shouse et al 1995 mallants et al 1996 zaman et al 2004 vereecken et al 2007 mcmillan and srinivasan 2015 the soil hydraulic properties of natural earth materials are observed to be highly variable in space in most cases involving predictions over large scales direct measurements are not possible so that there can be large uncertainty in moisture movement predictions based on richards equation another possible approach to practical problems of unsaturated flow predictions over relatively large space scales has treated the flow processes as a continuous time series rather than the time spatial processes in hydrology the approach of control volume provides the framework for applying the basic principle of conservation of mass in describing the flow process when the control volume is taken to be the entire unsaturated zone the equation of motion for the soil moisture movement process may be represented in a lumped form e g duffy et al 1984 besbes and de marsily 1984 rodriguez iturbe et al 1991 laio et al 2001 albertson and montaldo 2003 montaldo and albertson 2003 as 1 d θ t d t i t r t where θ is the volumetric soil moisture i is the effective infiltration below the root zone and r is the recharge to the saturated zone the approach regards the unsaturated zone as a soil moisture reservoir with a single inflow effective infiltration and a single outflow recharge to the aquifer so thatθ i and r in eq 1 represent spatial averages over the entire unsaturated zone and as such only their temporal variability is retained in general r in eq 1 is a nonlinear function of soil moisture e g porporato et al 2004 botter et al 2009 curtu et al 2014 this leads eq 1 to a nonlinear differential equation which generally does not have an analytical solution it has been reported in the literature e g flake 1963 waddington and fallside 1966 wolf 1968 that the solution to an ordinary nonlinear differential equation 2a d y t d t f y t g t under the initial condition 2b f y 0 0 takes the form 3 y t 0 t h 1 s 1 g s 1 d s 1 0 t 0 t h 1 s 1 s 2 g s 1 g s 2 d s 1 d s 2 0 t 0 t 0 t h n s 1 s 2 s n g s 1 g s 2 g s n d s 1 d s 2 d s n in eqs 2 and 3 y t is a continuous function f y t is a continuous function of y for each value of t g t denotes the forcing function hn s 1 s 2 sn is the nth order volterra kernel and s 1 s 2 sn are variables this implies that the solution of eq 1 will admit the form of volterra series similar to eq 3 note that the volterra integral series initially introduced by wiener 1958 in electronics has been adopted for hydrological systems analysis of the nonlinear response of catchment to the rainfall input e g amorocho and brandstetter 1971 diskin and boneh 1972 napiórkowski and strupczewski 1979 patry and mariño 1983 nourani 2017 the purpose of the present research is to demonstrate an application of volterra integral series to quantify the temporal variability of soil moisture movement through the unsaturated zone this is achieved by treating eq 1 as a stochastic differential equation in time and by applying the fourier stieltjes representation to develop the closed form expressions for the variance of volumetric soil moisture and the cross covariance of soil moisture and effective infiltration the impacts of the controlling parameters on the temporal variability of soil moisture movement are analyzed based on those closed form expressions to our knowledge the application of nonlinear functional series to the analysis of unsaturated flow fields has not been presented so far we hope that the present research will stimulate further research in this area 2 material and methods 2 1 theoretical development the temporal variation of rainfall is usually stochastic in nature resulting in irregular infiltration and recharge to the aquifer thus the present work begins with treating eq 1 as a stochastic equation with a stochastic input the effective infiltration and therefore a stochastic output the recharge to the aquifer that is we consider the unsaturated zone as a soil moisture reservoir with a single stochastic inflow and a single stochastic outflow in addition the recharge to the saturated zone is assumed to depend solely on the volumetric soil moisture stored in the unsaturated zone e g cordova and bras 1981 rodriguez iturbe et al 1991 daly et al 2004 botter et al 2007 andreasen et al 2013 hoekstra 2019 so that the perturbation solution of eq 1 to the fluctuations in effective infiltration can be represented by a volterra integral functional series as 4 θ t 0 t h 1 s 1 u s 1 d s 1 0 t 0 t h 2 s 1 s 2 u s 1 u s 2 d s 1 d s 2 0 t 0 t 0 t h n s 1 s 2 s n u s 1 u s 2 u s n d s 1 d s 2 d s n where θ t and u t denote the fluctuations in volumetric soil moisture and effective infiltration respectively the first term on the right hand side of eq 4 the convolution integral is identical to the solution of a linear model analogous to the unit hydrograph while the remaining terms are generalizations of the linear convolution term the nonlinearity is reflected by the multi dimensional convolution integrals 2 2 stochastic formulation the fourier stieltjes representation theorem treating random processes in terms of general orthogonal expansions in frequency domains e g priestley 1981 provides a convenient way for developing the cross correlation and auto correlation functions which are the tasks undertaken here it plays a central role in much of the theoretical development in the study of subsurface flow in heterogeneous aquifers e g dagan 1989 gelhar 1993 zhang 2002 rubin 2003 consider i t to be a temporal random process with a zero mean and fourier stieltjes representation e g priestley 1965 5 u t λ u ξ t ω e i ω t d z ξ ω where λuξ t ω is the modulating function ω represents the frequency and zξ ω is an orthogonal process with the power spectral density sξξ ω defined as 6 e d z ξ ω 2 s ξ ξ ω d ω by using eq 5 the temporal random output θ t from eq 4 can be shown to be 7 θ t γ 1 t ω 1 exp i ω 1 t d z ξ ω 1 γ 2 t ω 1 ω 2 exp i ω 1 ω 2 t d z ξ ω 1 d z ξ ω 2 γ n t ω 1 ω 2 ω n exp i ω 1 ω 2 ω n t d z ξ ω 1 d z ξ ω 2 d z ξ ω n in which the generalized kernel functions of an infinite sequence are defined as 8 γ 1 t ω 1 0 t h 1 t s 1 λ u ξ s 1 ω 1 exp i ω 1 s 1 t d s 1 γ 2 t ω 1 ω 2 0 t 0 t h 2 t s 1 s 2 λ u ξ s 1 ω 1 λ u ξ s 2 ω 2 exp i ω 1 s 1 t i ω 2 s 2 t d s 1 d s 2 γ n t ω 1 ω n 0 t 0 t h n t s 1 s n λ u ξ s 1 ω 1 λ u ξ s n ω n exp i ω 1 s 1 t i ω n s n t d s 1 d s n for practical purposes the order of nonlinearity in eq 7 may be considered limited one may adopt a truncated form of eq 7 so that the summation is done only up to some finite order the present study assumes that the perturbed terms beyond the second order of the volterra series are negligible e g diskin and boneh 1973 party and mariño 1983 müftüoğlu 1984 napiórkowski 1986 so that eq 7 can be reduced to 9 θ t γ 1 t ω 1 exp i ω 1 t d z ξ ω 1 γ 2 t ω 1 ω 2 exp i ω 1 ω 2 t d z ξ ω 1 d z ξ ω 2 where the perturbed quantities θ are assumed to be excited by a gaussian process zξ eq 9 serves as a basis for the analytical development of covariance and cross covariance functions between u and θ fields note that the covariance of the values of a random field at two different times defines the covariance function while the covariance of two values associated with different random fields defines the cross covariance function e g vanmarcke 1983 2 3 spectral solutions by using the spectral representation theorem and the properties of products of gaussian processes 10 e d z ξ ω 1 d z ξ ω 2 d z ξ ω 3 d z ξ ω 4 e d z ξ ω 1 d z ξ ω 2 e d z ξ ω 3 d z ξ ω 4 e d z ξ ω 1 d z ξ ω 3 e d z ξ ω 2 d z ξ ω 4 e d z ξ ω 1 d z ξ ω 4 e d z ξ ω 2 d z ξ ω 3 in eq 9 the covariance or autocovariance function of the random field θ and cross covariance function between the u input and θ output fields can be computed respectively as 11 c o v θ t θ t t 1 e θ t θ t t 1 e θ t e θ t t 1 γ 1 t ω 1 γ 1 t t 1 ω 1 exp i t 1 ω 1 s ξ ξ ω 1 d ω 1 2 γ 2 t ω 1 ω 2 γ 2 t t 1 ω 1 ω 2 exp i t 1 ω 1 ω 2 s ξ ξ ω 1 s ξ ξ ω 2 d ω 1 d ω 2 12 c u u θ t t 1 t 2 e u t t 1 u t t 2 θ t e θ t 2 λ u ξ t t 1 ω 1 λ u ξ t t 2 ω 2 γ 2 t ω 1 ω 2 exp i ω 1 t 1 ω 2 t 2 s ξ ξ ω 1 s ξ ξ ω 2 d ω 1 d ω 2 the covariance function is a measure of the temporal correlation structure of θ field while the cross covariance function measures how the u and θ fields are correlated in time following priestley 1965 the spectral density of θ can be defined based on eq 11 as 13 s θ θ t ω γ 1 t ω 2 2 γ 2 t ω x 2 s ξ ξ x dx s ξ ξ ω in obtaining the closed form expressions for the covariance and cross covariance functions the type of input process and the form of volterra kernel must be specified we proceed with the assumptions that the spatial average of effective infiltration into the upper soil layer an input to the volterra series is a constant fraction of the rainfall so that 14 u t γ p t where p represents the temporal fluctuations in rainfall rate γ is a constant and the time varying but spatially uniform rainfall over the basin can be described by a continuous second order autoregressive model ar 2 e g mimikdu 1983 thyregod et al 1999 birkel et al 2011 datta and bolisetti 2015 in time the ar 2 model represents a type of random process it specifies the value at the present time depending linearly partly on its own two previous values at times t 1 and t 2 and partly on a stochastic disturbance or white noise that is the present study considers that the values of time series rainfall data are highly correlated with the values that proceed and succeed them when the input and output are both recorded a continuous function of time the associated second order differential equation for the temporal distribution of rainfall rate takes the form e g priestley 1981 15 d 2 p d t 2 α 1 d p d t α 2 p ξ t here α 1 and α 2 are positive parameters and ξ t is a stationary stochastic white noise force with zero mean and constant power spectral density denoted as 16 s ξ ξ ω i ξ making use of fourier stieltjes representations for the perturbed quantities p andξ respectively 17a p t λ p ξ t ω e i ω t d z ξ ω 17b ξ t e i ω t d z ξ ω in eq 15 gives 18 d 2 λ p ξ d t 2 α 1 i 2 ω d λ p ξ d t α 2 i α 1 ω ω 2 λ p ξ 1 which has the general solution given by 19 λ p ξ t ω 1 α 2 ω 2 i α 1 ω c 1 exp t 2 β 1 i 2 ω c 2 exp t 2 β 2 i 2 ω with 20a β 1 α 1 α 1 2 4 α 2 20b β 2 α 1 α 1 2 4 α 2 in eq 17a λpξ t ω represents the modulating function for the rainfall process the arbitrary constants c 1 and c 2 in eq 19 can be determined using the initial conditions given it should be recognized that the representation 17b exists and is unique for any zero mean stationary random field e g lumley and panofsky 1964 when the process is nonstationary the representation is no longer valid in the limit when the time step becomes negligible 21 λ p ξ ω 1 α 2 ω 2 i α 1 ω from eq 14 it implies 22 λ u ξ ω γ α 2 ω 2 i α 1 ω that is the input for evaluating eqs 11 and 12 is taken to be a stationary process with a modulating function given by eq 22 3 results and discussion at this point we begin quantitatively evaluating the analytical developments the covariance and cross covariance functions presented in eqs 11 and 12 it seems difficult to identify volterra kernel functions from input out data since the sample of observations contain a large number of unknown parameters e g priestley 1988 however a continuous nonlinear system may be approximated by a sum of a linear system and products of linear systems e g brilliant 1958 van trees 1964 this suggests that the second order kernel function may be defined by the product of linear kernel 23 h 2 t 1 t 2 m h 1 t 1 h 1 t 2 where m is a constant for the calculations presented in this work the transfer function in besbes and de marsily 1984 is used as the kernel function of the linear model 24a h 1 t 1 k n 1 t k n 1 e t k which is identical to the instantaneous unit hydrograph of the nash 1957 model consisting of n identical linear reservoirs in cascade here the parameter n depends on the thickness of the unsaturated zone and the time constant k characterizes the percolation velocity besbes and de marsily 1984 the parameter n in eq 24a could be a fractional number for fractional values of n the factorial in eq 24a is replaced by the gamma function such that 24b h 1 t 1 k φ n t k n 1 e t k where 24c φ n 0 x n 1 e x d x however to take the advantage of closed form solutions the kernel in eq 24a with the value of n 2 is used for evaluating eqs 11 and 12 namely 25 h 1 t t k 2 e t k finally substituting eqs 16 22 23 and 25 into eqs 11 and 12 and by taking t 1 0 t 2 yields the variance of volumetric soil moisture 26 σ θ 2 t e θ t θ t e θ t e θ t σ l θ 2 t 2 m 2 σ l θ 2 t 2 and the cross covariance function between the effective infiltration and soil moisture fields at zero lag 27 c u u θ t e u t u t θ t e θ t π 2 2 k 2 μ 2 γ 4 m i ξ 2 ω 2 in eqs 26 and 27 28a σ l θ 2 t π k μ γ 2 i ξ 1 2 1 λ 1 2 τ 1 2 ψ 1 2 τ 1 λ 1 ψ 2 t ψ 3 1 2 t 2 τ 1 2 ψ 4 28b ω t τ 1 λ 1 ψ 1 λ 2 ψ 4 2 ψ 2 4 ψ 3 ψ 5 μ α 1 α 12 4α 2 1 2 λ 1 1 t t t k τ 1 exp t λ 2 1 t and the functions for ψ1 ψ5 are given respectively in appendix a to examine the variance of volumetric soil moisture given by eq 26 plots of eq 28a as a function of η 2 are shown in fig 1 for different values of η 1 the figure indicates that the variance σlθ 2 persists longer for small values of η 1 noticing from eq 26 that the variance σ θ 2 for the nonlinear system is approximated by a linear combination of the variance σlθ 2 for the linear system and products of that the figure therefore implies that σθ 2 increases with a decrease in the parameter α 1 for a fixed value of η 2 fluctuations in rainfall are highly correlated for a small value of α 1 and the correlation decreases as α 1 increases a smaller value of α 1 enhances the persistence of rainfall fluctuations and therefore longer persistence in effective infiltration fluctuations the variance may be regarded as a quantitative measure of temporal variability as such the figure reveals the reduction in the variability of soil moisture moment with the parameter α 1 the figure also depicts the behavior of the variance σlθ 2 as the function of the parameter k it can be clearly seen a decrease in σlθ 2 with an increasing k for a soil moisture reservoir with a larger k quick response to the input the moisture fluctuations introduced by the variation in effective infiltration will tend to have more variable and less persistent fluctuations than those receiving water from the reservoir with a smaller k less persistent fluctuations in soil moisture result in a smaller σlθ 2 and therefore a smaller σθ 2 in conclusion the parameter k decreases the persistence of soil moisture fluctuations and in turn the variance σ θ 2 the cross correlation function given by eq 27 is plotted versus η 2 in fig 2 for different values of η 1 the cross correlation function may also be interpreted as the projection of amplitude of infiltration fluctuations onto that of moisture fluctuations thus as shown in the figure a reduction in the cross correlation of the effective infiltration and volumetric soil moisture with the parameters k or α 1 implies that the contribution of the variability of infiltration processes to that of moisture moment processes decreases with k or α 1 this is consistent with that shown in fig 1 it is important to recognize the difference between the traditional such as albertson and montaldo 2003 and montaldo and albertson 2003 and present studies on characterizing the temporal variability of soil moisture movement albertson and montaldo 2003 and montaldo and albertson 2003 present analyses of the temporal variability of root zone soil moisture by integrating a differential form of mass balance in conjunction with darcy s law over the root zone as such the nonlinear relationship between the flux and moisture content variables must be specified to proceed with their evaluation this implies that the nonlinearity of the moisture flux relationships plays the major factor in influencing the volumetric soil moisture distribution and therefore the temporal variability of soil moisture movement on the other hand the present research treats the entire unsaturated zone as a control volume such that the temporal distribution of volumetric soil moisture can be expressed as a volterra integral series the convolution of the kernels of the system with the input effective infiltration rates without knowing about its internal structure such as the form of nonlinear moisture flux relationship once the forms of kernels for a system are determined from an input and corresponding output records experiments the volumetric soil moisture in response to any given input effective infiltration rate or rainfall rate can be determined and in turn the temporal variability of soil moisture movement in other words the present model disregards the internal mechanism which contributes to the soil moisture movement process and concentrates on the relationships between a model input and an output response function soil moisture is strongly affected by the amount of rainfall which infiltrates into the subsurface soil rainfall processes are generally recognized as being affected by complex natural events the details of which cannot be described precisely consequently the movement of soil moisture is often formulated as a stochastic random process in order to reflect the uncertainty of our knowledge the second moment or variance developed here gives a quantitative measure of uncertainty anticipated in the prediction of temporal soil moisture movement the variability of soil moisture movement strongly controls the rate of recharge to the aquifer the fluctuations in effective infiltration affected by the rainfall runoff transformation is the main forcing for the variability of soil moisture movement therefore changes in the earth s climate have the potential to influence the rate of aquifer recharge and thus the amount of available groundwater however the influence of climate change on the variation of the rate of aquifer recharge is one of the most difficult factors to evaluate when assessing groundwater resources the present approach links the impact of rainfall variability to that of volumetric soil moisture and leads to a closed form expression for quantifying the variability of soil moisture movement which has a clear advantage over the existing approaches the results of this study provide valuable information for the analysis of the effect of climate fluctuations on the variation of rate of aquifer recharge which is a basic prerequisite for efficient ground water resource management equation 28 indicates that once the kernel functions for the nonlinear system are known an estimation of the nonlinear system variance for any given rainfall process can be evaluated therefore for actual hydrological applications the kernels should be identified from observed input output time series the kernels are usually determined for a given real system based on a finite input and corresponding output observations system by optimization methods since the cross correlation technique e g lee and schetzen 1965 priestley 1981 papalexiou 2018 is more relevant to the present study a brief introduction of using that in determining the kernel is outlined below eq 12 in conjunction with its fourier transform can be used to identify the kernel functions of nonlinear integral series using the fourier stieltjes representation e g priestley 1965 for cuuθ 29 c u u θ t s u θ t ω 1 ω 2 d ω 1 d ω 2 and comparing it with eq 12 it follows that 30 s u θ t ω 1 ω 2 2 λ u ξ t ω 1 λ u ξ t ω 2 γ 2 t ω 1 ω 2 s ξ ξ ω 1 s ξ ξ ω 2 which leads to 31 ξ t ω 1 ω 2 1 2 s u θ t ω 1 ω 2 s u u ω 1 s u u ω 2 where suθ is the cross spectrum between u t and θ t suu is the spectral density function of u t and 32 ξ t ω 1 ω 2 0 t 0 t h 2 t s 1 s 2 exp i ω 1 s 1 t i ω 2 s 2 t d s 1 d s 2 as such given finite observations on the input and output processes eqs 31 and 32 enable to estimate the form of kernel by replacing the terms in the numerator and denominator by their respective sample estimates due to the soil moisture process of a stochastic nature there is a need to address the uncertainty involved in the modeling prediction for example accurate prediction of the volumetric soil moisture is required to estimate the recharge into the saturated zone which serves as a basis for the rational management of groundwater resources to account for the random effects in the modeling prediction it may be more reasonable to consider say the mean volumetric soil moisture and plus minus two standard deviations square root of the variances rather than only the mean moisture as a calibration target referring from eq 3 the second order form of mean equation for the volumetric soil moisture is taken in the form 33 θ t 0 t h 1 s 1 u s 1 d s 1 0 t 0 t h 2 s 1 s 2 u s 1 u s 2 d s 1 d s 2 where θ t and u t indicate the means of volumetric soil moisture and effective infiltration respectively eq 15 implies that the temporal distribution of mean rainfall rate is given by 34 p t p 0 exp η 2 2 δ 1 η 1 t where p 0 is the initial rainfall rate and δ1 η 1 2 4 1 2 using eqs 14 23 25 and 34 in eq 33 the mean volumetric soil moisture is described by 35 θ t θ l m θ l 2 where 36a θ l t γ p 0 1 δ 2 t 1 exp δ 2 t δ 2 2 36b δ 2 η 2 δ 1 2 η 1 2 1 η 2 eq 35 twice the square root of eq 26 offers a useful basis for prediction of volumetric soil moisture under uncertainty the present model makes no claims on the knowledge of the soil water constitutive relations such as moisture content capillary pressure relations and hydraulic conductivity relations which are specified by the traditional approach in solving richards equation this implies that the present approach tends to be at an advantage when the soil water constitutive relations involved are unknown or when the relationships for the system are so complex that a conceptual representation of the process would be impractical 4 conclusions the present research proposes a new framework to quantify the temporal variability of soil moisture movement and the cross covariance of soil moisture and effective infiltration the new framework treats the bulk soil volume as a nonlinear reservoir with time variant soil moisture that filters effective infiltration inputs into recharge outputs the novel aspects of the work appear to be the theoretical development based on fourier stieltjes representation and closed form solutions for the soil moisture variance and the cross covariance of soil moisture and effective infiltration in time there is certainly a need to model these variables for applications to land atmosphere interactions ecohydrology and recharge estimation further the proposed approach has the benefit of operating at the bulk soil scale and therefore if an appropriate input output function can be specified at that scale the method does not require specification of smaller scale heterogeneity based on the analysis of the closed form expressions it is found that the smaller values of the parameter k or α 1 lead to larger variability of the soil moisture movement process this is because of that the smaller values of the parameter k or α 1 increases the persistence of soil moisture fluctuations and in turn the variability of the soil moisture movement process when soil moisture movement problems involve predictions over much larger scales the square root of the variance of volumetric soil moisture eq 26 provides a quantification of the uncertainty in application of the mean model in the field eqs 31 and 32 provide a basis for identifying the form of kernel from observed input output time series credit authorship contribution statement ching min chang conceptualization methodology investigation writing original draft writing review editing visualization hund der yeh conceptualization methodology investigation writing original draft writing review editing visualization mo hsiung chuang conceptualization methodology investigation writing original draft writing review editing visualization declaration of competing interest none acknowledgements research leading to this paper has been partially supported by the grant from the taiwan ministry of science and technology under the grants most 106 2621 m 130 002 and 107 2221 e 009 019 my3 we are grateful to the anonymous reviewers for constructive comments that improved the quality of the work supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103752 appendix b supplementary materials image application 1 appendix a expressions for the function in eq 28 a1 ψ 1 2 ρ 1 ρ 1 1 ρ 1 2 2 ρ 2 ρ 2 1 ρ 2 2 a2 ψ 2 1 2 λ 1 τ 1 1 ρ 1 2 τ 2 ρ 1 τ 1 ρ 1 1 ρ 1 2 2 1 2 λ 1 τ 1 1 ρ 2 2 τ 3 ρ 2 τ 1 ρ 2 1 ρ 2 2 2 a3 ψ 3 1 2 t τ 1 1 ρ 1 2 τ 2 τ 1 1 ρ 1 2 2 τ 3 τ 1 1 ρ 2 2 2 1 2 t τ 1 1 ρ 2 2 a4 ψ 4 1 1 ρ 1 2 1 1 ρ 2 2 a5 ψ 5 λ 2 τ 1 1 ρ 1 2 2 τ 1 ρ 1 τ 2 1 ρ 1 2 2 λ 2 τ 1 1 ρ 2 2 2 τ 1 ρ 2 τ 3 1 ρ 2 2 2 with a6 ρ 1 2 2 η 2 η 1 2 2 η 1 η 1 2 4 a7 ρ 2 2 2 η 2 η 1 2 2 η 1 η 1 2 4 η 1 α 1 α 2 η 2 k α 2 τ 2 exp ρ 1 t and τ 3 exp ρ 2 t 
409,we propose a thermodynamic approach to modeling unsaturated flow in porous media where the liquid saturation is understood as the state variable the free energy functional is designed as a symmetric expansion of the traditional capillary energy density in richards equation therefore removing ambiguities on the interpretation of the higher order term in the model equation the proposed definition renders a formulation that leads naturally to an entropy function of the system and we show that the model describes an entropy increasing process for an isolated system the new formulation reproduces gravity fingering during infiltration in soil we show that the nonlinear and singular structure of the capillary pinning function in the fourth order term plays a fundamental role in the behavior and stability of infiltration fronts promoting front pinning and the persistence of fingered infiltration at relatively large flux ratios keywords vadose zone infiltration gravity fingering entropy nonequilibrium thermodynamics msc 00 01 99 00 1 introduction fluid dynamics through unsaturated porous media is key in understanding the distribution of soil moisture which in turn regulates the interactions between climate soil and vegetation these interactions are essential in the description of the hydrological ecological and meteorological processes rodriguez iturbe 2000 many infiltration models have been developed based on a variety of empirical conceptual and physical approaches buckingham 1907 richards 1931 horton 1933 philip 1957 1969 but these models generally assume stable wetting and drying fronts when the medium is homogeneous gravity driven displacement of one fluid by another in porous media however is often subject to hydrodynamic instability whereby fluid invasion takes the form of preferential flow paths or fingers sahimi 1993 frette et al 1992 méheust et al 2002 examples include secondary oil migration in reservoir rocks thomas and clouse 1995 meakin et al 2000 luo et al 2004 and infiltration of rainfall water in dry soil hill and parlange 1972 glass et al 1989d ritsema et al 1998 since the 1970s carefully designed experiments have repeatedly shown gravity fingering during infiltration in homogeneous sands diment and watson 1985 glass et al 1989d 1990 selker et al 1992a 1992b lu et al 1994 bauters et al 1998 2000 yao and hendrickx 2001 sililo and tellam 2000 flekkøy et al 2002 wang et al 2004 wei et al 2014 the selected pattern of the phenomenon is a winner takes all process in which the fastest growing fingers channelize most of the flow and the growth of other incipient fingers is thereby suppressed glass et al 1989d selker et al 1992b in addition to the clear evidence of the gravity fingering phenomenon in laboratory experiments several works point to its importance also in field settings ritsema and dekker 1994b hendrickx and flury 2001 work on water flow and infiltration in textured soils has demonstrated the potential importance of fingered flow in the field glass et al 1988 ommen et al 1989 liu et al 1994 ritsema and dekker 1994b 1994a ritsema et al 1996 1998 wang et al 2004 including the role of water repellency as a mechanism that exacerbates it bauters et al 1998 ritsema and dekker 2000b 2000a wang et al 2000 the formation of fingers can significantly influence the transport of contaminants to surface and ground waters glass et al 1989a and reduces the water rechargeable area in the root zone of plants the stability of infiltration fronts varies with the properties of the medium and the infiltrating flux experimental work has shown that the fingering instability is expected to be more vigorous for coarse soils heijs et al 1996 for two reasons importance of gravity vs capillary forces and because the soil retention curve and unsaturated conductivity are often sharper more nonlinear for sands than for clays although these behaviors are observed for the soils studied the conditions of the triggering mechanism of instability to generate preferential paths of flow are complex because of the subtle interplay between gravity and capillary effects and the impact of the macroscopic interface at the wetting front the other important experimental trends are related to soil water conditions as the initial moisture content plays a critical role in the fingering instability it is well established that fingering is promoted when the medium is quite dry and that even relatively low water saturations lead to a compact downward moving wetting front lu et al 1994 bauters et al 2000 stable fronts are also observed in dry media when the infiltration rate is either very small or approaches the saturated conductivity hendrickx and yao 1996 in general larger infiltration rates produce faster thicker fingers glass et al 1989d an important feature of gravity fingering is the presence of saturation overshoot that is the pile up of water at the infiltration front which is understood to be a prerequisite for the fingering instability in unsaturated flows dicarlo 2004 egorov et al 2003 nieber et al 2005 dicarlo 2007 cueto felgueroso and juanes 2009a the classical richards model of infiltration richards 1931 along with the standard monotonic pressure saturation relation is stable in homogeneous porous media under infinitesimal and finite perturbations nieber et al 2005 fürst et al 2009 this model is incompatible with saturation overshoot for infiltration into unsaturated homogeneous media leads to monotonic saturation profiles and cannot reproduce the fingering phenomenon many extensions to the richards equation have been proposed in the past few decades to develop continuum mathematical models that describe gravity driven unsaturated flows through porous media and attempt to capture finger formation see e g cueto felgueroso and juanes 2009a dicarlo 2013 xiong 2014 for an overview for example eliassi and glass 2002 invoked a hold back pile up hbpu effect to develop an extension of the richards equation with an additional higher order term they proposed three mathematical representations of the hbpu effect to include hypodiffusive hyperbolic and mixed spatial temporal forms cueto felgueroso and juanes 2008 2009a proposed a thermodynamic approach to multiphase flows through porous media and developed a phase field model of unsaturated flow their model then leads to an extension of the richards equation that includes a new term a fourth order derivative in space with a scaling linking the magnitude of this term to the other terms in the richards equation several authors have studied the impact of dynamic capillary pressure on unsaturated flow patterns concluding that the extended richards equation including dynamic capillarity and hysteresis may also lead to saturation overshoot and flow patterns that are similar to the observed wetting front instability see e g rätz and schweizer 2014 van duijn et al 2018 zhuang et al 2019b in this study we adopt what we consider to be a minimum ingredients model of unsaturated flow that is compatible with the observations of hydrodynamic instability and fingering patterns during infiltration into dry coarse soil we do not include capillary hysteresis in our model this is because the proposed fourth order model can lead to fingering instabilities and finger persistence without hysteresis while hysteresis alone without a mechanism that leads to saturation overshoot cannot explain the formation of gravity fingers during water infiltration in soil eliassi and glass 2001 van duijn et al 2004 nieber et al 2005 fürst et al 2009 including hysteresis in the capillary pressure is essential to reproduce important experimental observations of unsaturated flow among them is the long term stability of the finger cores as preferential flow paths glass et al 1989a rezanezhad et al 2006 without hysteresis finger widths slowly continue to increase due to lateral capillary diffusion the other phenomenon is the unconventional water flow during horizontal redistribution due to capillary hysteresis which may lead to persistent discontinuities across sharp saturation gradients and to flow from regions of smaller saturation towards others with larger one philip 1991 raats and van duijn 1995 heinen and raats 1999 pop et al 2009 van duijn and mitra 2018 which may also be attributed to multistability of the capillary energy cueto felgueroso and juanes 2016 the higher order term in the proposed model and in the model based on the phase field methodology cueto felgueroso and juanes 2009a is responsible for triggering the instability of the flow the formation of saturation overshoot and gravity fingers in unsaturated flows without resorting to hysteresis we note that hysteresis is a very real phenomenon with an important macroscopic consequences liu et al 1994 bauters et al 1998 spiteri and juanes 2006 juanes et al 2006 which can be incorporated in the capillary pressure function to further improve the results while dynamic capillary pressure is sufficient to generate a saturation overshoot in 1d nieber et al 2005 dicarlo et al 2008 zhuang et al 2019a the combined effect of dynamic capillary pressure and hysteresis is needed to produce reasonable looking overshoot and fingering patterns rätz and schweizer 2014 zhang and zegeling 2017 zhuang et al 2019b the role of nonzero contact angle on unstable flow formation in porous media has been studied experimentally wallach et al 2013 and a moving boundary approach was proposed brindt and wallach 2017 which attributes the hold back pile up effect to the nonzero contact angle where water is initially prevented from invading the dry pores at the wetting front when sufficient water piles up saturation overshoot the pressure increases and becomes enough to overcome the impeding pressure barrier water entry capillary pressure this leads to the invasion of pores and the propagation of a sharp wetting front with a nonmonotonic saturation profile here we adopt a thermodynamic approach to unsaturated flow where the liquid saturation is understood as the state variable we design a free energy functional as a symmetric expansion of the traditional capillary energy density leverett 1941 morrow 1970 aavatsmark 1989a 1989b sciarra et al 2007 sciarra 2016 therefore removing ambiguities on the interpretation of the nonlocal term our approach is based on the phase field methodology cahn and hilliard 1958 cueto felgueroso and juanes 2009a where in the formulation of the capillary energy in addition to the terms related to richards equation bulk energy we include the energy associated with the effect of the macroscopic interface the wetting front this energy approach leads naturally to a nonlinear higher order term involving a special function which we term capillary pinning function multiplying the square gradient term the structure of this function plays a fundamental role in the behavior of continuum models of multiphase flow in a capillary tube cueto felgueroso and juanes 2012 strait et al 2015 hele shaw cell cueto felgueroso and juanes 2014 or thin film flow over a substrate pahlavan et al 2015 by construction the capillary pinning function in the model proposed here is proportional to the capillary energy density we show that this definition renders a formulation that leads naturally to an entropy function of the system and we prove that the model leads to an entropy increasing process for an isolated system we also show that the proposed model reproduces the saturation overshoot at the wetting front the formation of gravity fingers and the pinning behavior at the base of the infiltration front in section 2 we present the derivation of the proposed model and the construction of the capillary pinning function introduced section 3 is devoted to the construction of the entropy function of the proposed model and the analysis of the entropy of an isolated system numerical simulations are performed in section 4 to evaluate the effect of the nonlinear capillary pinning function on saturation overshoot and on the pinning behavior at the base during fingered infiltration finally we provide some concluding remarks in section 5 2 mathematical model 2 1 local model richards equation it is useful to first describe the thermodynamic approach as it applies to the traditional unsaturated flow equation richards equation richards 1931 we start by imposing mass conservation in terms of water saturation s 1 ρ ϕ s t f 0 and mass flux driven by a potential π 2 f ρ λ w s π where ρ is the water density ϕ is the medium porosity g is the gravitational acceleration all assumed constant and λw s is the water mobility 3 λ w s k μ k r s where k is the medium permeability μ is the fluid dynamic viscosity and kr s is the water relative permeability which accounts for the effect of partial saturation richards 1931 muskat and meres 1936 muskat 1949 bear 1972 it proves convenient to introduce the saturated hydraulic conductivity 4 k sat ρ g k μ the potential is derived from the energy function e 5 π d e d s the energy e comprises gravitational and capillary energy components e e grav e cap the gravitational component is simply 6 e grav ρ g z s where z is depth in the direction of gravity the capillary component is given by 7 e cap e 0 ψ s where e 0 is a reference energy dependent on the elevation datum and on the surface energy of the medium when filled with water and ψ s is the capillary energy function from which the capillary pressure pc s is derived 8 p c s d ψ d s which can be expressed in head units as the water suction head ψ s 9 p c s ρ g ψ s we will further express the water suction head ψ using the leverett scaling leverett 1941 10 ψ s h cap j s h cap γ cos θ ρ g k ϕ where h cap is the characteristic capillary rise γ is the surface tension between the fluids θ is the contact angle and j s is the leverett j function leverett 1941 which is a dimensionless version of the capillary pressure function using eqs 8 10 we can write eq 7 as 11 e cap e 0 ρ g h cap i s i s 0 s j s d s we refer to i s as the dimensionless capillary energy density leverett 1941 morrow 1970 aavatsmark 1989a 1989b the flow potential based on this energy is given by 12 π d e d s ρ g z ψ s finally inserting eq 12 into the flux eq 2 and the mass conservation eq 1 and assuming constant fluid density yields the classical richards equation 13 ϕ s t k sat k r s z ψ s 0 2 2 nonlocal model to develop a model capable of unstable infiltration we propose a second gradient theory sciarra et al 2007 sciarra 2016 of the capillary energy written as a second order expansion of the classical local one 14 e cap e 0 ρ g h cap i s 1 1 2 δ 2 s 2 where δ is the characteristic length scale of the diffuse interface written in the form of a nonlinear cahn hilliard free energy cahn and hilliard 1958 cahn 1961 bray 1994 anderson et al 1998 boettinger et al 2002 emmerich 2008 the capillary energy includes a bulk and an interfacial contribution which accounts for the structure of the diffuse interface of wetting fronts 15 e cap e 0 ρ g h cap i s e cap bulk 1 2 ρ g κ s s 2 e cap interf where we identify κ as being the capillary pinning function 16 κ s h cap δ 2 i s h cap δ 2 0 s j s d s the modified gradient theory energy functional is e e grav e cap the flow potential is obtained by taking the variational derivative of the energy functional with respect to saturation rather than the total derivative witelski 1998 17 π δ e δ s e s e s ρ g z ψ s κ s κ s s so that conservation of mass yields the new model 18 ϕ s t k sat k r s z ψ s κ s κ s s 0 2 3 capillary pressure and relative permeability functions the capillary pressure function is typically a decreasing function of saturation richards 1931 leverett 1941 bear 1972 based on standard constitutive relation modeling brooks and corey 1966 van genuchten 1980 we adopt functional forms that lead to a stable state energy minimum for s 1 cueto felgueroso and juanes 2009a we model the leverett j function j s leverett 1941 as fig 1 b 19 j s s 1 λ 1 exp β s v e 1 β λ λ 1 s where λ is a parameter in the brooks and corey model brooks and corey 1966 and β 0 and v e max v e 1 are parameters controlling the position of the energy minimum with v e max 1 1 β ln 1 β λ λ 1 is the maximum tolerable value of ve to have an energy minimum for s 1 the bulk capillary energy and gradient energy coefficient are determined by the integral of the j function i s which is given by 20 i s λ λ 1 s λ 1 λ 1 exp β s v e the above relationship leads to convex capillary energies and nonnegative gradient energy coefficients κ which satisfy κ s 0 0 fig 1a the use of this type of capillary bulk energy function is motivated by the physics of infiltration when the medium approaches full saturation s 1 the two assumptions of infinite mobility and infinity compressibility of air cease to be valid therefore the energy of the system must include an extra term due to the water pressure behind the front bauters et al 1998 from a modeling perspective the additional term introduces a steep increase in the bulk energy as s 1 preventing the saturation from taking values above 1 fig 1b in our construction of the proposed model the use of a convex bulk capillary energy function leads to monotonic capillary pressure which is compatible with the initial richards equation as will be explained in the next section we discover that the use of a convex bulk capillary energy function and the expansion 14 for the capillary energy using the second gradient theory leads to a thermodynamically consistent model of unsaturated flow the only requirement that we impose on the relative permeability function kr s is that it be smooth and convex typical functional forms include those of brooks and corey 1966 and van genuchten 1980 here we use a simple power law relation 21 k r s s α with α 1 a simple power law in saturation k r s s α is often used as a parsimonious approach to modeling the relative permeability function corey 1954 brooks and corey 1966 the exponent α can have different values for lower and higher water saturation and depending on the type of soils such different behaviors for the relative permeability are observed experimentally dicarlo 2007 2004 high values of the parameter α can be obtained as shown in cueto felgueroso and juanes 2009a to fit the experimental results in dicarlo 2004 where the parameter α is between 2 and 11 for the types of soil considered in the study cueto felgueroso and juanes 2009a this power law behavior with relatively large exponent can also be seen as a smoother version of relative permeabilities with lower exponent where there is a cut off water saturation an irreducible water saturation 3 entropy function the existence of an entropy function for a conservation law is a constructive proof that the model is well posed and thermodynamically consistent dafermos 2000 lefloch 2002 generally in the process of solving systems of conservation laws one has to deal with weak solutions where uniqueness is lost further criteria are required where a companion balance law should be introduced using a convex function mathematical entropy of the variable of the initial system to characterize the admissible unique solution of this system for any arbitrary initial and boundary conditions in continuum physics the companion balance law is intimately related with the second law of thermodynamics dafermos 2000 where the variable is the physical entropy with associated entropy flux although some systems such as diffusion models are endowed with a rich collection of entropies only one of them enjoys a physical interpretation in multiphase flow a thermodynamic approach can be used to express the helmholtz free energy per unit pore volume aavatsmark 1989a 1989b and determine the natural entropy that has a physical interpretation to verify that this entropy function can characterize admissible solutions the resulting differential equation using this entropy function should be integrated over an isolated system to demonstrate that the system describes an entropy increasing process here we construct the entropy function for our mathematical model of unsaturated flow and show that it leads to an entropy increasing evolution positive dissipation for an isolated system we start by writing the model system in 1d as follows 22 s t f s z f s φ cap z z 0 where subscripts indicate partial derivatives the flux function is defined as 23 f s k sat ϕ k r s and φ cap is the gradient theory capillary potential 24 φ cap π cap ρ g ψ s κ s κ s s for notational convenience hereafter we write φ φ cap in the absence of the nonlocal term eq 22 has a similar form to the buckley leverett equation buckley and leverett 1942 but with a convex flux function aavatsmark 1989a b studied the buckley leverett equation and showed that the capillary energy density i s is the physical entropy of the problem for the buckley leverett equation and for the richards equation any convex function is actually a valid entropy function due to monotonicity of the capillary pressure this is not the case however for models with higher order terms where the definition of the entropy function usually relies on a delicate balance between diffusive and dispersive or higher order terms lefloch 2002 we start by multiplying eq 22 by the derivative u of a convex function of saturation u s assuming smooth solutions s z t we write 25 u t f s z u f s φ z z where the entropy flux due to gravity is defined as 26 f s 0 s u s f s d s to understand the influence of the right hand side term of eq 25 which includes the local effects of capillary pressure and the nonlocal effects due to saturation gradients we analyze an isolated system in the interval a z b this means that the mass flux and entropy flux f and f respectively are zero at both ends of the domain integrating eq 25 in the interval a b 27 d d t a b u d z f s z a z b a b u f φ z z d z the second term of the left hand side is zero because the system is isolated we use the product rule of differentiation to write the right hand side as 28 rhs a b u f φ z z d z 0 for isolated system a b u z f φ z d z a b u s z f φ z d z we define the positive function of saturation 29 v s u s f s κ s and the spatial function σ κ s z with these definitions we have φ ψ κ σ z and substituting in eq 28 30 rhs a b v σ φ z d z a b v σ ψ z d z a b v σ κ σ z z d z a b v σ ψ s z d z a b v σ κ σ z z v σ z κ σ z d z a b v σ 2 κ ψ d z a b v σ κ σ z z d z a b v σ z 2 κ d z a b v σ σ z κ s z d z the first term in eq 30 is negative by virtue of ψ s h cap j s being a monotonically decreasing function the second term is conservative and therefore equal to zero for an isolated system the third term is negative because all factors in the integrand are nonnegative the signed of the fourth term in eq 30 is in principle undetermined but can be made equal to zero by imposing that the function v be constant thus we choose v vc 0 which implies from eq 29 that 31 u v c κ s f s with this definition we have that the entropy function u of the isolated system evolves according to 32 d d t a b u d z a b v c σ 2 ψ κ σ z 2 κ d z 0 this derivation demonstrates that the proposed model is provably dissipative and is endowed with an entropy function we note that if a nonconvex double well bulk capillary energy cueto felgueroso and juanes 2012 is used with the second order expansion for the capillary energy the first term in eq 30 can be nonnegative and there is no guarantee that the overall expression necessarily takes a negative value finally we conclude that a convex capillary energy leading to monotonic capillary pressure function as already proposed for richards equation is more suitable to our construction of the proposed model based on the second gradient theory and the proposed capillary pinning function 4 numerical simulations 4 1 finite element implementation for computational convenience we write the model eq 18 as a system of two second order pdes 33 ϕ s t k sat k r s z k sat k r s ξ 0 34 ξ ψ s κ κ s the above mixed formulation can be compactly written in vector form as 35 ϕ 0 0 0 u t γ t 0 ξ ψ κ where the vectors of dependent variables u and fluxes γ are given by 36 u s ξ γ k sat k r s ξ x κ s x k sat k r s 1 ξ z κ s z the coupled eqs 33 34 are discretized in space using a standard galerkin finite element formulation and advanced in time using an implicit scheme bdf2 for constant flow rate infiltration we impose the water infiltration flux at the top boundary 37 f k sat k r s z ψ s κ s κ s s n z 0 r s k sat where rs is the flux ratio dimensionless which takes a value between 0 and 1 the minus sign indicating that it is a flux into the domain the numerical simulations of 1 d systems for saturation overshoot and 2 d systems for gravity fingering are performed respectively in section 4 3 and section 4 4 using initial conditions with small perturbations near the top boundary of the domain 4 2 entropy production in horizontal redistribution to test the validity of the entropy function and entropy inequality derived in eqs 31 and 32 we compute the evolution of the total entropy of the system udx in a problem of fluid redistribution in a closed 1d horizontal porous medium of length l 0 6 m fig 2 the porous medium has porosity ϕ 0 3 saturated hydraulic conductivity k sat 40 cm min and capillary heigth h cap 0 02 m and δ 0 01 m while the relative permeability function is kr s 3 we define a smooth initial saturation profile and let the saturations redistribute with no flow boundary conditions so that the saturation at long times is uniform fig 2a the mathematical entropy function decreases in time we plot the physical entropy 0 l u d x which increases monotonically with time demonstrating that the system is dissipative fig 2b 4 3 one dimensional simulations of saturation overshoot we simulate one dimensional constant flux infiltration into a dry porous column figs 1c 3 4 the porous medium has porosity ϕ 0 3 saturated hydraulic conductivity k sat 40 cm min and capillary heigth h cap 0 02 m while the relative permeability function is kr s 7 we impose a water influx at the top boundary that is a fraction of the saturated conductivity q 0 and define the flux ratio as rs q 0 k sat we begin by exploring the role of the capillary energy function on the overshoot characteristics fig 1c in particular we analyze whether the infiltration profiles satisfy the physical requirement that s 1 we set a flux ratio of rs 0 01 and simulate the evolution of saturation profiles for several forms of the j function the bulk capillary energy is characterized by λ 10 β 40 and three values of ve ve 1 1 05 and 1 095 in eq 19 while ve 1 seems to guarantee that water saturations do not exceed 1 larger values lead to unbounded saturations for sufficiently large flux ratios and particular parameter combinations the value of ve has a large influence on the magnitude of the nonlocal term the use of v e 1 095 which is very close to the maximum tolerable value v e max 1 09541 corresponding to the parameters taken into account in the numerical test seems to have a significant impact on the magnitude of the nonlocal term when the maximum saturation is close to the value of one for values of ve which are not large when the saturation value is in the vicinity of one the magnitude of the nonlocal term becomes negligible compared to the other terms due to gravity and capillary pressure as a consequence the model equation becomes very close to richards equation which allows the model to respect that the computed values of water saturation remain bounded the most remarkable feature of the saturation profiles obtained with the proposed form of the capillary pinning function κ is that the saturation overshoot remains close to unity across a wide range of flux ratios fig 3 the pile up effect leads to overshoots whose length increases with flux ratio propagating upstream from the sharp wetting front this is consistent with experimental observations and in contrast with choosing a constant value of κ which yields a sharp decline of the saturation overshoot as rs decreases cueto felgueroso and juanes 2009a because κ vanishes at s 0 wetting fronts are steeper inducing a more pronounced pile up effect the length of the overshoot region is controlled by the capillary pressure function by the flux ratio fig 3 and by the strength of the gradient energy term the latter can be characterized through the ratio between two characteristic lengths the capillary height h cap which mathematically controls the strength of capillary diffusion and the gradient energy length δ which controls the size of the energy expansion term in eq 14 larger values of δ h cap increase the relative strength of the fourth order term in the model increasing the height and width of the overshoot fig 4 mathematically the saturation undershoot behind the tip of the advancing wetting front is due to the presence of the fourth order term in the flow equation fourth order diffusion allows for nonmonotonic saturations which implies the possibility of saturation overshoot but also the possible presence of an undershoot right above the tip while inherent to higher order models of unsaturated flow this oscillatory behavior is quickly damped by the strongly dissipative fourth order term in contrast oscillations are very strong in the model of unsaturated flow with dynamic capillarity e g nieber et al 2005 zhuang et al 2019b note that the undershoot can be removed as in the model with dynamic capillary pressure by considering hysteresis in the capillary pressure curve sander et al 2008 zhang and zegeling 2017 rezanezhad et al 2006 and rezanezhad 2007 have studied the physical relevance of an undershoot behind the finger tip for the fingered flow through initially dry sand they measured water content dynamics within the finger tip along the finger core behind the tip and within the fringe of the finger the results of their experimental study revealed a saturation minimum undershoot behind the tip of the advancing finger rezanezhad et al 2006 and the authors concluded that behind the tip of the advancing wetting front there is an additional lateral gradient which leads to a horizontal flow component we note that as it has already been mentioned sander et al 2008 small oscillations are observed downstream of the wetting front of fingers by glass et al 1989c but the authors did not comment on these observations in general existing experiments are inconclusive in terms of either confirming or ruling out the undershooting phenomenon observed in higher order models of unsaturated flow some of the profiles of 1d infiltration are rather oscillatory near the wetting front zhuang et al 2019b fig 4 and some 2d experiments actually seem to exhibit a behavior similar to the one shown in figs 3 and 4 rezanezhad et al 2006 fig 9 further experimental studies are necessary to assess whether the observed oscillations actually occur and under what conditions or whether such behavior is instead just a mathematical property of the higher order model without a direct correlate in the physical system 4 4 two dimensional simulations of gravity fingering numerical simulations are performed using the proposed model to investigate the behaviors of gravity fingers compared to experimental and theoretical results experimental studies are performed glass et al 1989d and guided by theoretical analysis glass et al 1989b for wetting front instability in porous media these studies were applied at the finger scale and large chamber scale by imposing a constant rate infiltration at the top boundary for various flux ratios the results show that the number of fingers remains essentially the same as the flux ratio is increased through moderates values at relatively large flux ratios the number of fingers decreases and the width of fingers increases with increasing the flux ratio and ultimately tends to one large finger to cover the whole domain the sensitivity of the model s behavior in terms of finger characteristics to the model s parameters was rather exhaustively analyzed in cueto felgueroso and juanes 2009a for the original infiltration model with constant κ we simulate 2d constant flux infiltration into a dry porous medium figs 5 9 the medium properties are the same as those of the 1d simulations porosity ϕ 0 3 saturated hydraulic conductivity k sat 40 cm min capillary heigth h cap 0 02 m and relative permeability kr s 7 the bulk capillary energy is characterized by λ 10 β 40 and ve 1 05 in eq 19 the computational domain is a rectangle with dimensions 0 3 0 6 m2 we impose the water flux at the top boundary and define the flux ratio as in the 1d simulations rs q 0 k sat the 2d patterns of water saturation for infiltration in dry soil under different flux ratios reveal a transition from fingered to compact infiltration as rs approaches unity figs 5 and 6 this transition is consistent with experimental observations of the wetting front instability glass et al 1989d at relatively large flux ratios the number of fingers decreases as the infiltrating flux increases while the finger width increases with flux ratio furthermore the number of fingers remains constant as the flux ratio is increased through moderates values our model predictions are in good agreement with the experimental observations glass et al 1989d and analysis glass et al 1989b parlange and hill 1976 performed for gravity driven fingers the numerical simulations of the proposed model show that some of the fingers can advance faster than others which is compatible with experimental observations of gravity driven fingers in unsaturated media glass et al 1989c 1989d 1989a 1988 the ratio of characteristic length scales δ h cap which compares the strength of the gradient capillary energy with the capillary height sets the finger width scale when the other model parameters are kept constant fig 7 in particular the ratio δ h cap could be used to calibrate the model by matching experimental observations of gravity fingering with different infiltration rates the functional relationship developed for the finger width glass et al 1989d 1989b parlange and hill 1976 may be fitted to experimental data and used in the calibration process of the model we plot the 2d saturation patterns fig 8 and finger widths fig 9 for infiltration at a constant infiltration flux and various values of the length scale ratio smaller values of δ h cap lead to thinner fingers for the same flux ratio figs 8 and 9 owing to capillary diffusion in the absence of capillary pressure hysteresis the fingers are also growing laterally but this lateral growth is negligible in these simulations the time scale for lateral growth is significantly larger than the time it takes for the fingers to reach the bottom boundary the experiments conducted by yao and hendrickx 1996 and hendrickx and yao 1996 demonstrated that at low flow infiltration rates the wetting fronts tend to become stable with finger widths that increase with decreasing flux for the present simulations in homogeneous media decreasing infiltration rates lead to thinner fingers this behavior makes sense from the perspective of a linear stability analysis of the model cueto felgueroso and juanes 2008 2009b 2009a at very low rates lateral redistribution is strong enough to prevent these thin fingers to develop so the proposed model also leads to a stable wetting front at very low infiltration rates a possible explanation for the discrepancy in terms of finger width at very low infiltration rates is that there is always some degree of heterogeneity in the experimental system so that some of the very thin fingers would be suppressed focusing the small infiltration flux towards a few ones rather than allowing the development of the natural wavelength of the instability for a homogeneous medium 4 5 comparison with the experiments of glass et al 1989 to validate the proposed model against laboratory experiments of fingering during water infiltration we model the experiments of glass et al 1989d who studied constant rate infiltration into packed white silica sands the experiments were conducted in a quasi 2d infiltration chamber characterizing the finger morphology and dynamics over a wide range of infiltration rates corresponding to flux ratios from r s 0 01 to r s 0 82 the sand was initially dry we simulate 2d constant flux infiltration into a porous medium with very low initial saturation s 0 0 01 fig 10 we consider a square domain of dimensions 0 3 0 3 m2 describing the experimental bottom layer composed of 14 20 sand glass et al 1989d as model parameters we set a porosity ϕ 0 3 a saturated hydraulic conductivity of k sat 40 cm min a capillary heigth of h cap 0 046 cm and relative permeability kr s 7 the bulk capillary energy is characterized by λ 10 β 40 and ve 1 05 in eq 19 these are the same constitutive relationships used in previous sections which we take as representative of coarse sand we impose the water flux at the top boundary and free drainage at the bottom of the domain the lateral boundaries are no flow boundaries to compare with the various experimental conditions we define the flux ratio as rs q 0 k sat the computational grid is a cartesian mesh of 600 600 finite elements an important step to capture the finger width scale is to calibrate the assumed proportionality constant between δ eq 14 and h cap we fit the finger width for a small flux ratio rs 0 012 and obtain good agreement between experimental and numerical finger width for δ 0 01h cap for this coarse sand we then use this relationship for all other flux ratios we observe good overall agreement between experiments and simulations fig 10 qualitatively the trends of normalized finger width and finger speed are similar in experiments and in simulations fig 10e and f the agreement between observed and simulated fingers breaks down at large flux ratios while simulations predict a transition to compact infiltration for rs around 0 3 fig 10d experiments show persistent fingered flow up to rs around 0 8 we attribute this discrepancy to the absence of heterogeneity and hysteresis in the model which seems to lead to more stable infiltration patterns we observe differences in the flow patterns at very low infiltration rates fig 10a the experiments indicate a decrease in the number of fingers corresponding to an increase in the separation between fingers in the simulations the finger spacing decreases as the finger width decreases so that more and more fingers appear in the domain this is because the finger spacing dictated by the characteristic wavelength of the wetting front instability decreases with infiltration rate cueto felgueroso and juanes 2008 2009a 2009b we attribute the discrepancy to the absence of heterogeneity in our simulations which could suppress the growth of some fingers focusing the small infiltration flux towards a few ones rather than allowing the development of the natural wavelength of the instability for a homogeneous medium 5 discussion and conclusions in this paper we have proposed a thermodynamic approach to modeling unsaturated flow where the liquid saturation is understood as the state variable the free energy functional is designed as a symmetric expansion of the traditional capillary energy density in richards equation therefore removing ambiguities on the interpretation of the higher order term in the model equation the proposed definition renders a formulation that leads naturally to an entropy function of the system and we show that the model describes an entropy increasing process for an isolated system the new formulation of the free energy which includes a nonlinear gradient energy through a capillary pinning function helps identify the characteristic length scale associated with the high order term as the finger size more precisely the finger width depends linearly on the ratio between gradient energy length and capillary height the structure of this function plays a fundamental role in the behavior and stability of infiltration fronts promoting front pinning and the persistence of fingered infiltration at relatively large flux ratios comparison between simulations and experiments of fingering at various constant infiltration rates helps calibrate the relationship between the two characteristic length scales the capillary height and the length associated with the second gradient expansion of the capillary energy we observe good overall agreement between experiments and simulations deviating in the limit of nearly saturated conditions for which the simulations predict earlier transition to compact infiltration and very small infiltration rates for the experiments predict an increase of the spacing between fingers our construction of the capillary pinning function provides a fundamental link between the high order term and the traditional capillary pressure term of the unsaturated flow equation by identifying the separate role of two characteristic length scales namely the capillary height and the length associated with the energy expansion the new model allows direct comparison between simulated and observed finger widths for different medium properties and infiltration fluxes finally the new definition will help understand the impact of medium heterogeneity on wetting front instabilities credit authorship contribution statement abdelaziz beljadid investigation writing original draft luis cueto felgueroso investigation writing original draft ruben juanes conceptualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments funding for this research was provided by the abdul latif jameel world water and food security lab j wafs at mit to rj ab was supported by the fonds de recherche du québec nature et technologies frqnt and j wafs lcf gratefully acknowledges funding from the spanish ministry of economy and competitiveness grant ctm2014 54312 p lcf and rj also acknowledge funding from the mit international science and technology initiatives misti through a seed fund grant supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103684 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
409,we propose a thermodynamic approach to modeling unsaturated flow in porous media where the liquid saturation is understood as the state variable the free energy functional is designed as a symmetric expansion of the traditional capillary energy density in richards equation therefore removing ambiguities on the interpretation of the higher order term in the model equation the proposed definition renders a formulation that leads naturally to an entropy function of the system and we show that the model describes an entropy increasing process for an isolated system the new formulation reproduces gravity fingering during infiltration in soil we show that the nonlinear and singular structure of the capillary pinning function in the fourth order term plays a fundamental role in the behavior and stability of infiltration fronts promoting front pinning and the persistence of fingered infiltration at relatively large flux ratios keywords vadose zone infiltration gravity fingering entropy nonequilibrium thermodynamics msc 00 01 99 00 1 introduction fluid dynamics through unsaturated porous media is key in understanding the distribution of soil moisture which in turn regulates the interactions between climate soil and vegetation these interactions are essential in the description of the hydrological ecological and meteorological processes rodriguez iturbe 2000 many infiltration models have been developed based on a variety of empirical conceptual and physical approaches buckingham 1907 richards 1931 horton 1933 philip 1957 1969 but these models generally assume stable wetting and drying fronts when the medium is homogeneous gravity driven displacement of one fluid by another in porous media however is often subject to hydrodynamic instability whereby fluid invasion takes the form of preferential flow paths or fingers sahimi 1993 frette et al 1992 méheust et al 2002 examples include secondary oil migration in reservoir rocks thomas and clouse 1995 meakin et al 2000 luo et al 2004 and infiltration of rainfall water in dry soil hill and parlange 1972 glass et al 1989d ritsema et al 1998 since the 1970s carefully designed experiments have repeatedly shown gravity fingering during infiltration in homogeneous sands diment and watson 1985 glass et al 1989d 1990 selker et al 1992a 1992b lu et al 1994 bauters et al 1998 2000 yao and hendrickx 2001 sililo and tellam 2000 flekkøy et al 2002 wang et al 2004 wei et al 2014 the selected pattern of the phenomenon is a winner takes all process in which the fastest growing fingers channelize most of the flow and the growth of other incipient fingers is thereby suppressed glass et al 1989d selker et al 1992b in addition to the clear evidence of the gravity fingering phenomenon in laboratory experiments several works point to its importance also in field settings ritsema and dekker 1994b hendrickx and flury 2001 work on water flow and infiltration in textured soils has demonstrated the potential importance of fingered flow in the field glass et al 1988 ommen et al 1989 liu et al 1994 ritsema and dekker 1994b 1994a ritsema et al 1996 1998 wang et al 2004 including the role of water repellency as a mechanism that exacerbates it bauters et al 1998 ritsema and dekker 2000b 2000a wang et al 2000 the formation of fingers can significantly influence the transport of contaminants to surface and ground waters glass et al 1989a and reduces the water rechargeable area in the root zone of plants the stability of infiltration fronts varies with the properties of the medium and the infiltrating flux experimental work has shown that the fingering instability is expected to be more vigorous for coarse soils heijs et al 1996 for two reasons importance of gravity vs capillary forces and because the soil retention curve and unsaturated conductivity are often sharper more nonlinear for sands than for clays although these behaviors are observed for the soils studied the conditions of the triggering mechanism of instability to generate preferential paths of flow are complex because of the subtle interplay between gravity and capillary effects and the impact of the macroscopic interface at the wetting front the other important experimental trends are related to soil water conditions as the initial moisture content plays a critical role in the fingering instability it is well established that fingering is promoted when the medium is quite dry and that even relatively low water saturations lead to a compact downward moving wetting front lu et al 1994 bauters et al 2000 stable fronts are also observed in dry media when the infiltration rate is either very small or approaches the saturated conductivity hendrickx and yao 1996 in general larger infiltration rates produce faster thicker fingers glass et al 1989d an important feature of gravity fingering is the presence of saturation overshoot that is the pile up of water at the infiltration front which is understood to be a prerequisite for the fingering instability in unsaturated flows dicarlo 2004 egorov et al 2003 nieber et al 2005 dicarlo 2007 cueto felgueroso and juanes 2009a the classical richards model of infiltration richards 1931 along with the standard monotonic pressure saturation relation is stable in homogeneous porous media under infinitesimal and finite perturbations nieber et al 2005 fürst et al 2009 this model is incompatible with saturation overshoot for infiltration into unsaturated homogeneous media leads to monotonic saturation profiles and cannot reproduce the fingering phenomenon many extensions to the richards equation have been proposed in the past few decades to develop continuum mathematical models that describe gravity driven unsaturated flows through porous media and attempt to capture finger formation see e g cueto felgueroso and juanes 2009a dicarlo 2013 xiong 2014 for an overview for example eliassi and glass 2002 invoked a hold back pile up hbpu effect to develop an extension of the richards equation with an additional higher order term they proposed three mathematical representations of the hbpu effect to include hypodiffusive hyperbolic and mixed spatial temporal forms cueto felgueroso and juanes 2008 2009a proposed a thermodynamic approach to multiphase flows through porous media and developed a phase field model of unsaturated flow their model then leads to an extension of the richards equation that includes a new term a fourth order derivative in space with a scaling linking the magnitude of this term to the other terms in the richards equation several authors have studied the impact of dynamic capillary pressure on unsaturated flow patterns concluding that the extended richards equation including dynamic capillarity and hysteresis may also lead to saturation overshoot and flow patterns that are similar to the observed wetting front instability see e g rätz and schweizer 2014 van duijn et al 2018 zhuang et al 2019b in this study we adopt what we consider to be a minimum ingredients model of unsaturated flow that is compatible with the observations of hydrodynamic instability and fingering patterns during infiltration into dry coarse soil we do not include capillary hysteresis in our model this is because the proposed fourth order model can lead to fingering instabilities and finger persistence without hysteresis while hysteresis alone without a mechanism that leads to saturation overshoot cannot explain the formation of gravity fingers during water infiltration in soil eliassi and glass 2001 van duijn et al 2004 nieber et al 2005 fürst et al 2009 including hysteresis in the capillary pressure is essential to reproduce important experimental observations of unsaturated flow among them is the long term stability of the finger cores as preferential flow paths glass et al 1989a rezanezhad et al 2006 without hysteresis finger widths slowly continue to increase due to lateral capillary diffusion the other phenomenon is the unconventional water flow during horizontal redistribution due to capillary hysteresis which may lead to persistent discontinuities across sharp saturation gradients and to flow from regions of smaller saturation towards others with larger one philip 1991 raats and van duijn 1995 heinen and raats 1999 pop et al 2009 van duijn and mitra 2018 which may also be attributed to multistability of the capillary energy cueto felgueroso and juanes 2016 the higher order term in the proposed model and in the model based on the phase field methodology cueto felgueroso and juanes 2009a is responsible for triggering the instability of the flow the formation of saturation overshoot and gravity fingers in unsaturated flows without resorting to hysteresis we note that hysteresis is a very real phenomenon with an important macroscopic consequences liu et al 1994 bauters et al 1998 spiteri and juanes 2006 juanes et al 2006 which can be incorporated in the capillary pressure function to further improve the results while dynamic capillary pressure is sufficient to generate a saturation overshoot in 1d nieber et al 2005 dicarlo et al 2008 zhuang et al 2019a the combined effect of dynamic capillary pressure and hysteresis is needed to produce reasonable looking overshoot and fingering patterns rätz and schweizer 2014 zhang and zegeling 2017 zhuang et al 2019b the role of nonzero contact angle on unstable flow formation in porous media has been studied experimentally wallach et al 2013 and a moving boundary approach was proposed brindt and wallach 2017 which attributes the hold back pile up effect to the nonzero contact angle where water is initially prevented from invading the dry pores at the wetting front when sufficient water piles up saturation overshoot the pressure increases and becomes enough to overcome the impeding pressure barrier water entry capillary pressure this leads to the invasion of pores and the propagation of a sharp wetting front with a nonmonotonic saturation profile here we adopt a thermodynamic approach to unsaturated flow where the liquid saturation is understood as the state variable we design a free energy functional as a symmetric expansion of the traditional capillary energy density leverett 1941 morrow 1970 aavatsmark 1989a 1989b sciarra et al 2007 sciarra 2016 therefore removing ambiguities on the interpretation of the nonlocal term our approach is based on the phase field methodology cahn and hilliard 1958 cueto felgueroso and juanes 2009a where in the formulation of the capillary energy in addition to the terms related to richards equation bulk energy we include the energy associated with the effect of the macroscopic interface the wetting front this energy approach leads naturally to a nonlinear higher order term involving a special function which we term capillary pinning function multiplying the square gradient term the structure of this function plays a fundamental role in the behavior of continuum models of multiphase flow in a capillary tube cueto felgueroso and juanes 2012 strait et al 2015 hele shaw cell cueto felgueroso and juanes 2014 or thin film flow over a substrate pahlavan et al 2015 by construction the capillary pinning function in the model proposed here is proportional to the capillary energy density we show that this definition renders a formulation that leads naturally to an entropy function of the system and we prove that the model leads to an entropy increasing process for an isolated system we also show that the proposed model reproduces the saturation overshoot at the wetting front the formation of gravity fingers and the pinning behavior at the base of the infiltration front in section 2 we present the derivation of the proposed model and the construction of the capillary pinning function introduced section 3 is devoted to the construction of the entropy function of the proposed model and the analysis of the entropy of an isolated system numerical simulations are performed in section 4 to evaluate the effect of the nonlinear capillary pinning function on saturation overshoot and on the pinning behavior at the base during fingered infiltration finally we provide some concluding remarks in section 5 2 mathematical model 2 1 local model richards equation it is useful to first describe the thermodynamic approach as it applies to the traditional unsaturated flow equation richards equation richards 1931 we start by imposing mass conservation in terms of water saturation s 1 ρ ϕ s t f 0 and mass flux driven by a potential π 2 f ρ λ w s π where ρ is the water density ϕ is the medium porosity g is the gravitational acceleration all assumed constant and λw s is the water mobility 3 λ w s k μ k r s where k is the medium permeability μ is the fluid dynamic viscosity and kr s is the water relative permeability which accounts for the effect of partial saturation richards 1931 muskat and meres 1936 muskat 1949 bear 1972 it proves convenient to introduce the saturated hydraulic conductivity 4 k sat ρ g k μ the potential is derived from the energy function e 5 π d e d s the energy e comprises gravitational and capillary energy components e e grav e cap the gravitational component is simply 6 e grav ρ g z s where z is depth in the direction of gravity the capillary component is given by 7 e cap e 0 ψ s where e 0 is a reference energy dependent on the elevation datum and on the surface energy of the medium when filled with water and ψ s is the capillary energy function from which the capillary pressure pc s is derived 8 p c s d ψ d s which can be expressed in head units as the water suction head ψ s 9 p c s ρ g ψ s we will further express the water suction head ψ using the leverett scaling leverett 1941 10 ψ s h cap j s h cap γ cos θ ρ g k ϕ where h cap is the characteristic capillary rise γ is the surface tension between the fluids θ is the contact angle and j s is the leverett j function leverett 1941 which is a dimensionless version of the capillary pressure function using eqs 8 10 we can write eq 7 as 11 e cap e 0 ρ g h cap i s i s 0 s j s d s we refer to i s as the dimensionless capillary energy density leverett 1941 morrow 1970 aavatsmark 1989a 1989b the flow potential based on this energy is given by 12 π d e d s ρ g z ψ s finally inserting eq 12 into the flux eq 2 and the mass conservation eq 1 and assuming constant fluid density yields the classical richards equation 13 ϕ s t k sat k r s z ψ s 0 2 2 nonlocal model to develop a model capable of unstable infiltration we propose a second gradient theory sciarra et al 2007 sciarra 2016 of the capillary energy written as a second order expansion of the classical local one 14 e cap e 0 ρ g h cap i s 1 1 2 δ 2 s 2 where δ is the characteristic length scale of the diffuse interface written in the form of a nonlinear cahn hilliard free energy cahn and hilliard 1958 cahn 1961 bray 1994 anderson et al 1998 boettinger et al 2002 emmerich 2008 the capillary energy includes a bulk and an interfacial contribution which accounts for the structure of the diffuse interface of wetting fronts 15 e cap e 0 ρ g h cap i s e cap bulk 1 2 ρ g κ s s 2 e cap interf where we identify κ as being the capillary pinning function 16 κ s h cap δ 2 i s h cap δ 2 0 s j s d s the modified gradient theory energy functional is e e grav e cap the flow potential is obtained by taking the variational derivative of the energy functional with respect to saturation rather than the total derivative witelski 1998 17 π δ e δ s e s e s ρ g z ψ s κ s κ s s so that conservation of mass yields the new model 18 ϕ s t k sat k r s z ψ s κ s κ s s 0 2 3 capillary pressure and relative permeability functions the capillary pressure function is typically a decreasing function of saturation richards 1931 leverett 1941 bear 1972 based on standard constitutive relation modeling brooks and corey 1966 van genuchten 1980 we adopt functional forms that lead to a stable state energy minimum for s 1 cueto felgueroso and juanes 2009a we model the leverett j function j s leverett 1941 as fig 1 b 19 j s s 1 λ 1 exp β s v e 1 β λ λ 1 s where λ is a parameter in the brooks and corey model brooks and corey 1966 and β 0 and v e max v e 1 are parameters controlling the position of the energy minimum with v e max 1 1 β ln 1 β λ λ 1 is the maximum tolerable value of ve to have an energy minimum for s 1 the bulk capillary energy and gradient energy coefficient are determined by the integral of the j function i s which is given by 20 i s λ λ 1 s λ 1 λ 1 exp β s v e the above relationship leads to convex capillary energies and nonnegative gradient energy coefficients κ which satisfy κ s 0 0 fig 1a the use of this type of capillary bulk energy function is motivated by the physics of infiltration when the medium approaches full saturation s 1 the two assumptions of infinite mobility and infinity compressibility of air cease to be valid therefore the energy of the system must include an extra term due to the water pressure behind the front bauters et al 1998 from a modeling perspective the additional term introduces a steep increase in the bulk energy as s 1 preventing the saturation from taking values above 1 fig 1b in our construction of the proposed model the use of a convex bulk capillary energy function leads to monotonic capillary pressure which is compatible with the initial richards equation as will be explained in the next section we discover that the use of a convex bulk capillary energy function and the expansion 14 for the capillary energy using the second gradient theory leads to a thermodynamically consistent model of unsaturated flow the only requirement that we impose on the relative permeability function kr s is that it be smooth and convex typical functional forms include those of brooks and corey 1966 and van genuchten 1980 here we use a simple power law relation 21 k r s s α with α 1 a simple power law in saturation k r s s α is often used as a parsimonious approach to modeling the relative permeability function corey 1954 brooks and corey 1966 the exponent α can have different values for lower and higher water saturation and depending on the type of soils such different behaviors for the relative permeability are observed experimentally dicarlo 2007 2004 high values of the parameter α can be obtained as shown in cueto felgueroso and juanes 2009a to fit the experimental results in dicarlo 2004 where the parameter α is between 2 and 11 for the types of soil considered in the study cueto felgueroso and juanes 2009a this power law behavior with relatively large exponent can also be seen as a smoother version of relative permeabilities with lower exponent where there is a cut off water saturation an irreducible water saturation 3 entropy function the existence of an entropy function for a conservation law is a constructive proof that the model is well posed and thermodynamically consistent dafermos 2000 lefloch 2002 generally in the process of solving systems of conservation laws one has to deal with weak solutions where uniqueness is lost further criteria are required where a companion balance law should be introduced using a convex function mathematical entropy of the variable of the initial system to characterize the admissible unique solution of this system for any arbitrary initial and boundary conditions in continuum physics the companion balance law is intimately related with the second law of thermodynamics dafermos 2000 where the variable is the physical entropy with associated entropy flux although some systems such as diffusion models are endowed with a rich collection of entropies only one of them enjoys a physical interpretation in multiphase flow a thermodynamic approach can be used to express the helmholtz free energy per unit pore volume aavatsmark 1989a 1989b and determine the natural entropy that has a physical interpretation to verify that this entropy function can characterize admissible solutions the resulting differential equation using this entropy function should be integrated over an isolated system to demonstrate that the system describes an entropy increasing process here we construct the entropy function for our mathematical model of unsaturated flow and show that it leads to an entropy increasing evolution positive dissipation for an isolated system we start by writing the model system in 1d as follows 22 s t f s z f s φ cap z z 0 where subscripts indicate partial derivatives the flux function is defined as 23 f s k sat ϕ k r s and φ cap is the gradient theory capillary potential 24 φ cap π cap ρ g ψ s κ s κ s s for notational convenience hereafter we write φ φ cap in the absence of the nonlocal term eq 22 has a similar form to the buckley leverett equation buckley and leverett 1942 but with a convex flux function aavatsmark 1989a b studied the buckley leverett equation and showed that the capillary energy density i s is the physical entropy of the problem for the buckley leverett equation and for the richards equation any convex function is actually a valid entropy function due to monotonicity of the capillary pressure this is not the case however for models with higher order terms where the definition of the entropy function usually relies on a delicate balance between diffusive and dispersive or higher order terms lefloch 2002 we start by multiplying eq 22 by the derivative u of a convex function of saturation u s assuming smooth solutions s z t we write 25 u t f s z u f s φ z z where the entropy flux due to gravity is defined as 26 f s 0 s u s f s d s to understand the influence of the right hand side term of eq 25 which includes the local effects of capillary pressure and the nonlocal effects due to saturation gradients we analyze an isolated system in the interval a z b this means that the mass flux and entropy flux f and f respectively are zero at both ends of the domain integrating eq 25 in the interval a b 27 d d t a b u d z f s z a z b a b u f φ z z d z the second term of the left hand side is zero because the system is isolated we use the product rule of differentiation to write the right hand side as 28 rhs a b u f φ z z d z 0 for isolated system a b u z f φ z d z a b u s z f φ z d z we define the positive function of saturation 29 v s u s f s κ s and the spatial function σ κ s z with these definitions we have φ ψ κ σ z and substituting in eq 28 30 rhs a b v σ φ z d z a b v σ ψ z d z a b v σ κ σ z z d z a b v σ ψ s z d z a b v σ κ σ z z v σ z κ σ z d z a b v σ 2 κ ψ d z a b v σ κ σ z z d z a b v σ z 2 κ d z a b v σ σ z κ s z d z the first term in eq 30 is negative by virtue of ψ s h cap j s being a monotonically decreasing function the second term is conservative and therefore equal to zero for an isolated system the third term is negative because all factors in the integrand are nonnegative the signed of the fourth term in eq 30 is in principle undetermined but can be made equal to zero by imposing that the function v be constant thus we choose v vc 0 which implies from eq 29 that 31 u v c κ s f s with this definition we have that the entropy function u of the isolated system evolves according to 32 d d t a b u d z a b v c σ 2 ψ κ σ z 2 κ d z 0 this derivation demonstrates that the proposed model is provably dissipative and is endowed with an entropy function we note that if a nonconvex double well bulk capillary energy cueto felgueroso and juanes 2012 is used with the second order expansion for the capillary energy the first term in eq 30 can be nonnegative and there is no guarantee that the overall expression necessarily takes a negative value finally we conclude that a convex capillary energy leading to monotonic capillary pressure function as already proposed for richards equation is more suitable to our construction of the proposed model based on the second gradient theory and the proposed capillary pinning function 4 numerical simulations 4 1 finite element implementation for computational convenience we write the model eq 18 as a system of two second order pdes 33 ϕ s t k sat k r s z k sat k r s ξ 0 34 ξ ψ s κ κ s the above mixed formulation can be compactly written in vector form as 35 ϕ 0 0 0 u t γ t 0 ξ ψ κ where the vectors of dependent variables u and fluxes γ are given by 36 u s ξ γ k sat k r s ξ x κ s x k sat k r s 1 ξ z κ s z the coupled eqs 33 34 are discretized in space using a standard galerkin finite element formulation and advanced in time using an implicit scheme bdf2 for constant flow rate infiltration we impose the water infiltration flux at the top boundary 37 f k sat k r s z ψ s κ s κ s s n z 0 r s k sat where rs is the flux ratio dimensionless which takes a value between 0 and 1 the minus sign indicating that it is a flux into the domain the numerical simulations of 1 d systems for saturation overshoot and 2 d systems for gravity fingering are performed respectively in section 4 3 and section 4 4 using initial conditions with small perturbations near the top boundary of the domain 4 2 entropy production in horizontal redistribution to test the validity of the entropy function and entropy inequality derived in eqs 31 and 32 we compute the evolution of the total entropy of the system udx in a problem of fluid redistribution in a closed 1d horizontal porous medium of length l 0 6 m fig 2 the porous medium has porosity ϕ 0 3 saturated hydraulic conductivity k sat 40 cm min and capillary heigth h cap 0 02 m and δ 0 01 m while the relative permeability function is kr s 3 we define a smooth initial saturation profile and let the saturations redistribute with no flow boundary conditions so that the saturation at long times is uniform fig 2a the mathematical entropy function decreases in time we plot the physical entropy 0 l u d x which increases monotonically with time demonstrating that the system is dissipative fig 2b 4 3 one dimensional simulations of saturation overshoot we simulate one dimensional constant flux infiltration into a dry porous column figs 1c 3 4 the porous medium has porosity ϕ 0 3 saturated hydraulic conductivity k sat 40 cm min and capillary heigth h cap 0 02 m while the relative permeability function is kr s 7 we impose a water influx at the top boundary that is a fraction of the saturated conductivity q 0 and define the flux ratio as rs q 0 k sat we begin by exploring the role of the capillary energy function on the overshoot characteristics fig 1c in particular we analyze whether the infiltration profiles satisfy the physical requirement that s 1 we set a flux ratio of rs 0 01 and simulate the evolution of saturation profiles for several forms of the j function the bulk capillary energy is characterized by λ 10 β 40 and three values of ve ve 1 1 05 and 1 095 in eq 19 while ve 1 seems to guarantee that water saturations do not exceed 1 larger values lead to unbounded saturations for sufficiently large flux ratios and particular parameter combinations the value of ve has a large influence on the magnitude of the nonlocal term the use of v e 1 095 which is very close to the maximum tolerable value v e max 1 09541 corresponding to the parameters taken into account in the numerical test seems to have a significant impact on the magnitude of the nonlocal term when the maximum saturation is close to the value of one for values of ve which are not large when the saturation value is in the vicinity of one the magnitude of the nonlocal term becomes negligible compared to the other terms due to gravity and capillary pressure as a consequence the model equation becomes very close to richards equation which allows the model to respect that the computed values of water saturation remain bounded the most remarkable feature of the saturation profiles obtained with the proposed form of the capillary pinning function κ is that the saturation overshoot remains close to unity across a wide range of flux ratios fig 3 the pile up effect leads to overshoots whose length increases with flux ratio propagating upstream from the sharp wetting front this is consistent with experimental observations and in contrast with choosing a constant value of κ which yields a sharp decline of the saturation overshoot as rs decreases cueto felgueroso and juanes 2009a because κ vanishes at s 0 wetting fronts are steeper inducing a more pronounced pile up effect the length of the overshoot region is controlled by the capillary pressure function by the flux ratio fig 3 and by the strength of the gradient energy term the latter can be characterized through the ratio between two characteristic lengths the capillary height h cap which mathematically controls the strength of capillary diffusion and the gradient energy length δ which controls the size of the energy expansion term in eq 14 larger values of δ h cap increase the relative strength of the fourth order term in the model increasing the height and width of the overshoot fig 4 mathematically the saturation undershoot behind the tip of the advancing wetting front is due to the presence of the fourth order term in the flow equation fourth order diffusion allows for nonmonotonic saturations which implies the possibility of saturation overshoot but also the possible presence of an undershoot right above the tip while inherent to higher order models of unsaturated flow this oscillatory behavior is quickly damped by the strongly dissipative fourth order term in contrast oscillations are very strong in the model of unsaturated flow with dynamic capillarity e g nieber et al 2005 zhuang et al 2019b note that the undershoot can be removed as in the model with dynamic capillary pressure by considering hysteresis in the capillary pressure curve sander et al 2008 zhang and zegeling 2017 rezanezhad et al 2006 and rezanezhad 2007 have studied the physical relevance of an undershoot behind the finger tip for the fingered flow through initially dry sand they measured water content dynamics within the finger tip along the finger core behind the tip and within the fringe of the finger the results of their experimental study revealed a saturation minimum undershoot behind the tip of the advancing finger rezanezhad et al 2006 and the authors concluded that behind the tip of the advancing wetting front there is an additional lateral gradient which leads to a horizontal flow component we note that as it has already been mentioned sander et al 2008 small oscillations are observed downstream of the wetting front of fingers by glass et al 1989c but the authors did not comment on these observations in general existing experiments are inconclusive in terms of either confirming or ruling out the undershooting phenomenon observed in higher order models of unsaturated flow some of the profiles of 1d infiltration are rather oscillatory near the wetting front zhuang et al 2019b fig 4 and some 2d experiments actually seem to exhibit a behavior similar to the one shown in figs 3 and 4 rezanezhad et al 2006 fig 9 further experimental studies are necessary to assess whether the observed oscillations actually occur and under what conditions or whether such behavior is instead just a mathematical property of the higher order model without a direct correlate in the physical system 4 4 two dimensional simulations of gravity fingering numerical simulations are performed using the proposed model to investigate the behaviors of gravity fingers compared to experimental and theoretical results experimental studies are performed glass et al 1989d and guided by theoretical analysis glass et al 1989b for wetting front instability in porous media these studies were applied at the finger scale and large chamber scale by imposing a constant rate infiltration at the top boundary for various flux ratios the results show that the number of fingers remains essentially the same as the flux ratio is increased through moderates values at relatively large flux ratios the number of fingers decreases and the width of fingers increases with increasing the flux ratio and ultimately tends to one large finger to cover the whole domain the sensitivity of the model s behavior in terms of finger characteristics to the model s parameters was rather exhaustively analyzed in cueto felgueroso and juanes 2009a for the original infiltration model with constant κ we simulate 2d constant flux infiltration into a dry porous medium figs 5 9 the medium properties are the same as those of the 1d simulations porosity ϕ 0 3 saturated hydraulic conductivity k sat 40 cm min capillary heigth h cap 0 02 m and relative permeability kr s 7 the bulk capillary energy is characterized by λ 10 β 40 and ve 1 05 in eq 19 the computational domain is a rectangle with dimensions 0 3 0 6 m2 we impose the water flux at the top boundary and define the flux ratio as in the 1d simulations rs q 0 k sat the 2d patterns of water saturation for infiltration in dry soil under different flux ratios reveal a transition from fingered to compact infiltration as rs approaches unity figs 5 and 6 this transition is consistent with experimental observations of the wetting front instability glass et al 1989d at relatively large flux ratios the number of fingers decreases as the infiltrating flux increases while the finger width increases with flux ratio furthermore the number of fingers remains constant as the flux ratio is increased through moderates values our model predictions are in good agreement with the experimental observations glass et al 1989d and analysis glass et al 1989b parlange and hill 1976 performed for gravity driven fingers the numerical simulations of the proposed model show that some of the fingers can advance faster than others which is compatible with experimental observations of gravity driven fingers in unsaturated media glass et al 1989c 1989d 1989a 1988 the ratio of characteristic length scales δ h cap which compares the strength of the gradient capillary energy with the capillary height sets the finger width scale when the other model parameters are kept constant fig 7 in particular the ratio δ h cap could be used to calibrate the model by matching experimental observations of gravity fingering with different infiltration rates the functional relationship developed for the finger width glass et al 1989d 1989b parlange and hill 1976 may be fitted to experimental data and used in the calibration process of the model we plot the 2d saturation patterns fig 8 and finger widths fig 9 for infiltration at a constant infiltration flux and various values of the length scale ratio smaller values of δ h cap lead to thinner fingers for the same flux ratio figs 8 and 9 owing to capillary diffusion in the absence of capillary pressure hysteresis the fingers are also growing laterally but this lateral growth is negligible in these simulations the time scale for lateral growth is significantly larger than the time it takes for the fingers to reach the bottom boundary the experiments conducted by yao and hendrickx 1996 and hendrickx and yao 1996 demonstrated that at low flow infiltration rates the wetting fronts tend to become stable with finger widths that increase with decreasing flux for the present simulations in homogeneous media decreasing infiltration rates lead to thinner fingers this behavior makes sense from the perspective of a linear stability analysis of the model cueto felgueroso and juanes 2008 2009b 2009a at very low rates lateral redistribution is strong enough to prevent these thin fingers to develop so the proposed model also leads to a stable wetting front at very low infiltration rates a possible explanation for the discrepancy in terms of finger width at very low infiltration rates is that there is always some degree of heterogeneity in the experimental system so that some of the very thin fingers would be suppressed focusing the small infiltration flux towards a few ones rather than allowing the development of the natural wavelength of the instability for a homogeneous medium 4 5 comparison with the experiments of glass et al 1989 to validate the proposed model against laboratory experiments of fingering during water infiltration we model the experiments of glass et al 1989d who studied constant rate infiltration into packed white silica sands the experiments were conducted in a quasi 2d infiltration chamber characterizing the finger morphology and dynamics over a wide range of infiltration rates corresponding to flux ratios from r s 0 01 to r s 0 82 the sand was initially dry we simulate 2d constant flux infiltration into a porous medium with very low initial saturation s 0 0 01 fig 10 we consider a square domain of dimensions 0 3 0 3 m2 describing the experimental bottom layer composed of 14 20 sand glass et al 1989d as model parameters we set a porosity ϕ 0 3 a saturated hydraulic conductivity of k sat 40 cm min a capillary heigth of h cap 0 046 cm and relative permeability kr s 7 the bulk capillary energy is characterized by λ 10 β 40 and ve 1 05 in eq 19 these are the same constitutive relationships used in previous sections which we take as representative of coarse sand we impose the water flux at the top boundary and free drainage at the bottom of the domain the lateral boundaries are no flow boundaries to compare with the various experimental conditions we define the flux ratio as rs q 0 k sat the computational grid is a cartesian mesh of 600 600 finite elements an important step to capture the finger width scale is to calibrate the assumed proportionality constant between δ eq 14 and h cap we fit the finger width for a small flux ratio rs 0 012 and obtain good agreement between experimental and numerical finger width for δ 0 01h cap for this coarse sand we then use this relationship for all other flux ratios we observe good overall agreement between experiments and simulations fig 10 qualitatively the trends of normalized finger width and finger speed are similar in experiments and in simulations fig 10e and f the agreement between observed and simulated fingers breaks down at large flux ratios while simulations predict a transition to compact infiltration for rs around 0 3 fig 10d experiments show persistent fingered flow up to rs around 0 8 we attribute this discrepancy to the absence of heterogeneity and hysteresis in the model which seems to lead to more stable infiltration patterns we observe differences in the flow patterns at very low infiltration rates fig 10a the experiments indicate a decrease in the number of fingers corresponding to an increase in the separation between fingers in the simulations the finger spacing decreases as the finger width decreases so that more and more fingers appear in the domain this is because the finger spacing dictated by the characteristic wavelength of the wetting front instability decreases with infiltration rate cueto felgueroso and juanes 2008 2009a 2009b we attribute the discrepancy to the absence of heterogeneity in our simulations which could suppress the growth of some fingers focusing the small infiltration flux towards a few ones rather than allowing the development of the natural wavelength of the instability for a homogeneous medium 5 discussion and conclusions in this paper we have proposed a thermodynamic approach to modeling unsaturated flow where the liquid saturation is understood as the state variable the free energy functional is designed as a symmetric expansion of the traditional capillary energy density in richards equation therefore removing ambiguities on the interpretation of the higher order term in the model equation the proposed definition renders a formulation that leads naturally to an entropy function of the system and we show that the model describes an entropy increasing process for an isolated system the new formulation of the free energy which includes a nonlinear gradient energy through a capillary pinning function helps identify the characteristic length scale associated with the high order term as the finger size more precisely the finger width depends linearly on the ratio between gradient energy length and capillary height the structure of this function plays a fundamental role in the behavior and stability of infiltration fronts promoting front pinning and the persistence of fingered infiltration at relatively large flux ratios comparison between simulations and experiments of fingering at various constant infiltration rates helps calibrate the relationship between the two characteristic length scales the capillary height and the length associated with the second gradient expansion of the capillary energy we observe good overall agreement between experiments and simulations deviating in the limit of nearly saturated conditions for which the simulations predict earlier transition to compact infiltration and very small infiltration rates for the experiments predict an increase of the spacing between fingers our construction of the capillary pinning function provides a fundamental link between the high order term and the traditional capillary pressure term of the unsaturated flow equation by identifying the separate role of two characteristic length scales namely the capillary height and the length associated with the energy expansion the new model allows direct comparison between simulated and observed finger widths for different medium properties and infiltration fluxes finally the new definition will help understand the impact of medium heterogeneity on wetting front instabilities credit authorship contribution statement abdelaziz beljadid investigation writing original draft luis cueto felgueroso investigation writing original draft ruben juanes conceptualization writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments funding for this research was provided by the abdul latif jameel world water and food security lab j wafs at mit to rj ab was supported by the fonds de recherche du québec nature et technologies frqnt and j wafs lcf gratefully acknowledges funding from the spanish ministry of economy and competitiveness grant ctm2014 54312 p lcf and rj also acknowledge funding from the mit international science and technology initiatives misti through a seed fund grant supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103684 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
