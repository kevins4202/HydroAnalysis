index,text
235,identification of the location and strength of a contaminant source in an aquifer is a challenging but crucial task efficient surrogate models can be constructed to replace traditional time consuming simulators while solving this inverse problem in recent years with the rapid development of machine learning ml algorithms the artificial neural network ann has been proven to be an efficient way for surrogate modeling however it may be difficult for ann based algorithms to learn the convection dispersion equation and predict the contaminant concentration field due to their point to point learning scheme because of their strong localized features the concentration fields can be seen as images in contrast the convolutional neural network cnn can extract spatial information better due to its convolutional structure herein a theory guided full convolutional neural network tgfcnn model is proposed to solve inverse problems in subsurface contaminant transport tgfcnn can construct robust and reliable surrogate models with limited training realizations and be further utilized for inverse modeling tasks the loss function of tgfcnn comprises the residual of governing equations of contaminant transport as well as data mismatch moreover the iterative ensemble smoother ies method is employed to update the parameters while solving the inverse problems the proposed tgfcnn model is evaluated in four scenarios the results demonstrate that the tgfcnn model possesses strong generalization and extrapolation abilities and satisfactory accuracy when estimating unknown contaminant source parameters as well as the permeability field the time consumption of the tgfcnn surrogate model for inverse tasks is also greatly reduced compared to using traditional simulators directly 1 introduction identification of the release history of a subsurface contaminant source with sparse and limited observation data is a crucial but challenging task for environmental monitoring and cleanup this task can be regarded as a high dimensional inverse problem zhang et al 2015 xu and gómez hernández 2018 mo et al 2019 timely and effective identification of a source and prediction of contaminant migration are critical to implementing relevant measures to prevent further pollution at present various approaches have been proposed to solve inverse problems for instance markov chain monte carlo mcmc is a highly accurate method for nonlinear systems it solves inverse problems in a probabilistic framework vrugt 2016 in addition mcmc with delay rejection adaptive metropolis dram sampling can be more efficient for strong nonlinear multi peak distributions and other complex parameter estimation problems haario et al 2006 zhang et al 2015 vrugt 2016 zhou and tartakovsky 2021 since bayesian inference based on mcmc sampling can be used for nonlinear systems and considers uncertainties directly the bayesian method is comparably more reliable and applicable monache et al 2008 shi et al 2012 laloy et al 2013 zeng et al 2012 zhang et al 2015 moreover bayesian inference can provide the posterior distribution of parameters and update previous inferences according to new observation data wang and jin 2013 researchers have also proposed numerous improvements to bayesian inference monache et al 2008 used an unmodified forward model to make full use of the generality and flexibility of bayesian inference by applying this method the posterior probability distribution of unknown parameters can be obtained they applied this approach to a continental scale accidental release of radioactive material from near algeciras in spain to retrieve information of the source zhang et al 2015 utilized relative entropy to quantify information gain from observation data and combined it with a bayesian method based on mcmc to reconstruct the unknown parameters they also employed an interpolation method based on an adaptive sparse grid to speed up computation and reduce time cost ensemble based methods have also been proposed for data assimilation or inverse modeling e g ensemble kalman filter enkf evensen 1994 and ensemble smoothers es leeuwen and evensen 1996 these data assimilation methods can be used to estimate model parameters and can be easily employed to analyze the uncertainty of the estimations these two kinds of ensemble based methods have been widely applied in groundwater hydrology to identify the location and strength of subsurface contaminant sources chaudhuri et al 2018 chen and zhang 2006 franssen and kinzelbach 2008 gu and oliver 2007 ju et al 2018 white 2018 xu and gómez hernández 2018 zhou et al 2011 the enkf method updates the parameters and state variables simultaneously in each analysis step which may cause an inconsistency problem thulin et al 2007 and a convergency problem when the system is strongly nonlinear chang et al 2017 however the es method provides a global updating scheme to overcome these issues in enkf chen and oliver 2013 used the iteration method to improve the quality of es in strongly nonlinear problems proposing the iterative ensemble smoother ies method chang et al 2017 developed a surrogate based ies method to speed up the data assimilation process this method is more convenient and applicable to various surrogate models traditional methods for solving inverse problems are usually utilized in conjunction with simulators or surrogate models simulators usually require numerous iterations to solve forward problems however which increases the consumption of time furthermore with the increment of input dimensionality most extant surrogate models will suffer from the curse of dimensionality liao and zhang 2016 mo et al 2019 indeed numerous training realizations are needed to achieve satisfactory accuracy which may further increase computational cost in recent years with the development of ml algorithms various problems with porous medium have been solved neural networks nns have been widely utilized to construct surrogate models compared to traditional surrogate models nns can capture spatiotemporal features and deal effectively with high dimensional problems due to the special deep architectures as surrogate models nns can approximate nonlinear functions excellently if the structures of hidden layers are sufficiently complex recently numerous researchers have employed nns to construct efficient surrogate models or solve complex high dimensional problems directly wu et al 2019 constructed a convolutional neural network cnn model to predict effective diffusivity of 2d porous media by treating the porous structure as an image the results demonstrate that the computational cost of cnn is significantly reduced compared with lattice boltzmann lbm simulations based on consumer complaint information sun et al 2019 utilized a cnn to explore the characteristics of complaints corresponding to different contaminant intrusion nodes and to improve the performance of contamination source identification however their algorithm is markedly sensitive to noise mo et al 2019 proposed a deep autoregressive neural network based on the dense convolutional encoder decoder architecture and applied it to construct surrogate models for contaminant transport problems the input dimensionality of this network was 686 which shows the ability of the deep autoregressive neural network to solve high dimensional problems they also employed the iterative local updating ensemble smoother ilues method to solve high dimensional inverse problems by combining it with the deep autoregressive neural network surrogate model although the dense convolutional encoder decoder network obtained satisfactory performance its accuracy and generalization ability needed to be guaranteed by numerous training data wei et al 2020 attempted to combine five physics based descriptions with ml algorithms such as support vector regression and gaussian process regression to predict thermal transport in porous medium the results demonstrate that these proposed five descriptions have strong correlations with conductivity fields wang et al 2020c utilized cnn based gated u net to estimate velocity fields in all directions and macro scale conductivity fields in the tortuous flow paths of porous media the error of predictions can be less than 1 in 2d models and 10 in 3d models which demonstrates the strong fitting ability of cnn based algorithms grbčić et al 2020 combined ann with random forests to determine variables of the contaminant transport process i e start time end time and contaminant concentration this method can narrow down the search space of the source node because of the efficiency of ann and realize identification of the contaminant source efficiently by utilizing monte carlo simulation sun and wang 2020b proposed a novel bayesian neural network constrained by physics to reconstruct flow fields from noisy samples which provides an innovative approach to resist the influence of noise zhou and tartakovsky 2021 developed an adaptive mcmc method based on the cnn surrogate model this method can reduce computational cost efficiently which allows further reduction of sampling error of the approximate likelihood function despite the numerous successes of ml based methods certain shortcomings remain for instance most of these ml based methods are data driven as a consequence an enormous amount of training data is needed in addition it is difficult to extrapolate or generalize beyond the scope of training data the predictions of data driven methods may also not always be physical to deal with these problems some researches have attempted to consider physical constraints for instance raissi et al 2019 proposed a physics informed neural network pinn which incorporates the residual of governing equations as a regulation in the loss function of the neural network wang et al 2020b developed a theory guided neural network tgnn which incorporates both physical constraints and engineering controls wang et al 2020a proposed a theory guided convolutional neural network tgcnn framework for uncertainty quantification and inverse modeling tasks which employed a convolutional encoder decoder architecture in their works the finite difference fd method was adopted to calculate the residuals of pdes in the cnn structure currently the theory guided training strategy has been studied and utilized in many works chen and zhang 2021 he and zhang 2020 xu et al 2021 in the present work we construct a theory guided full convolutional neural network tgfcnn the full convolutional neural network fcnn structure has been widely used such as for predicting stress factor contributions in porous materials keleṣ et al 2021 its structure is simpler due to the full convolutional architecture compared to the encoder decoder structure of tgcnn wang et al 2020a the residual of governing equations is incorporated into the loss function as soft constraints in this work four different scenarios are designed to test the performance of tgfcnn we utilize the tgfcnn model to construct surrogate models for contaminant source identification in these four scenarios with the assistance of theory guidance the predictions are more accurate and reliable than the results obtained by purely data driven cnn compared to data driven cnn based surrogate models the tgfcnn surrogate model can obtain superior generalization performance with a small amount of training realizations which means that less computational cost is required the results demonstrate that although the structure of tgfcnn is simple the accuracy and generalization ability of the tgfcnn surrogate model are satisfactory because data mismatch and physical theories are simultaneously honored the remainder of this paper proceeds as follows in section 2 we introduce the ies method governing equations and the basic structure of tgfcnn in section 3 several 2d cases with different setups are designed to test the accuracy of the tgfcnn based ies finally in section 4 the performance of the proposed tgfcnn model is discussed and conclusions are presented 2 methodology in this section we firstly introduce the ies method we then elaborate on the governing equations of the contaminant transport problem finally the architecture of tgfcnn and how to combine the governing equations into tgfcnn are outlined 2 1 iterative ensemble smoother a common mathematical representation of a physical model is considered as follows 1 d g m where g denotes the forward model m denotes the inputted model parameters and d is the output of the forward models g given m predicting the output d by running simulators or solving equations can be regarded as a forward problem however the model parameters m are unknown in most cases and they need to be inferred with given measurements the process of inferring the unknown parameters m can be considered to be an inverse problem the inverse problem can be expressed as oliver et al 2008 wang et al 2020a 2 d obs g m ε where d obs denotes the observation data and ε represents the measurements error due to the unique and ill posed feature of solution of the inverse problem the most efficient method to solve the inverse problem is by maximizing the conditional probability density function p m d obs chang et al 2017 as mentioned by oliver et al 2008 if the prior probability density function pdf of model parameters and measurement errors follow a gaussian distribution maximizing the conditional probability density function p m d obs is equivalent to minimizing the following objective function 3 o m 1 2 d obs g m t c d 1 d obs g m 1 2 m m p r t c m 1 m m p r where cd denotes the covariance matrix of measurements data cm denotes the covariance matrix of prior model parameters m pr represents the prior model parameters and g m denotes the predicted data from forward models with model parameters m to optimize the objective function eq 3 an iterative gauss newton formula is introduced as follows chen and oliver 2013 chang et al 2017 wang et al 2020a 4 m l 1 m l 1 λ l c m 1 g l t c d 1 g l 1 c m 1 m l m p r g l t c d 1 g m l d obs where l is the iterative step gl denotes the sensitivity matrix of parameters m l at lth iterative step and λ l denotes a multiplier to reduce the influence of data mismatch in the early iterations chen and oliver 2013 chang et al 2017 white 2018 wang et al 2020a in the ensemble based method eq 4 can be rewritten for different realizations as follows chang et al 2017 wang et al 2020a 5 m l 1 j m l j 1 1 λ l c m c m g l j t 1 λ l c d g l j c m g l j t 1 g l j c m g m t m m p r c m g l j t 1 λ l c d g l j c m g l j t 1 g m l j d j obs j 1 n e where j denotes the realization index and ne denotes the total number of realizations in the ensemble in the ies method the prior covariance matrix cm in the hessian matrix is replaced by the covariance matrix c m l of the updated parameters m l j at iterative step l chen and oliver 2013 chang et al 2017 wang et al 2020a and the average sensitivity matrix g l can replace the sensitivity matrix g l j gu and oliver 2007 chang et al 2017 wang et al 2020a moreover c m g l t is approximated with c m l d l and g l c m l g l t is approximated with c d l d l chang et al 2017 wang et al 2020a c m l d l denotes the covariance of parameters m l and prediction g m l and c d l d l denotes the covariance of g m l as a consequence the updating formula of ies can be expressed as chang et al 2017 wang et al 2020a 6 m l 1 j m l j 1 1 λ l c m l c m l d l 1 λ l c d c d l d l 1 c d l m l c m 1 m l j m j p r e c m l d l 1 λ l c d c d l d l 1 g m l j d j obs j 1 n e 2 2 governing equations governing equations of the subsurface contaminant transport process consist of two parts the equation of flow in porous medium i e eq 7 and the equation of the convection and dispersion of contaminant in the flow field i e eq 8 the equation of flow in porous medium can be written as follows 7 s s h t x k x y h x y k x y h y where h is the hydraulic head ss is the specific storage x and y are cartesian coordinates and k x y denotes the hydraulic conductivity field then the hydraulic head h and the seepage along x and y coordinates vx and vy respectively can be obtained as follows 8 v x k x θ h x 9 v y k y θ h y where kx and ky denote the component of k x y along x and y coordinates respectively and θ denotes the porosity of subsurface medium the equation of contaminant convection and dispersion in the flow field is written as 10 θ c t x θ d x x c x x θ d x y c y y θ d y y c y y θ d y x c x x θ v x c y θ v y c q s c s r n where c denotes the dissolved concentration of contaminant dxx dxy dyy and dyx denote the hydrodynamic dispersion coefficient tensor in corresponding directions qs denotes the volumetric flow rate per unit volume of aquifer with a positive value representing fluid source and a negative value representing sink cs denotes the contaminant concentration of the sources or sinks and rn is the chemical reaction term the hydrodynamic dispersion coefficient tensor dxx dxy dyy and dyx in the 2d case can be calculated as follows 11 d x x α l v x 2 v α t v y 2 v d 12 d y y α l v y 2 v α t v x 2 v d 13 d x y d y x α l α t v x v y v 14 v v x 2 v y 2 where α l denotes the longitudinal dispersivity α t denotes the transverse dispersivity and d denotes the effective molecular diffusion coefficient 2 3 theory guided full convolutional neural network cnn has been widely used for image processing the convolution operation makes it more advantageous in processing high dimensional data in addition due to the parameter sharing scheme the parameters of the cnn can be reduced significantly in this work the contaminant concentration field at each time step can be regarded as an image cnn usually includes convolutional layers activation layers and pooling layers in tgfcnn only several convolutional and activation layers are utilized to further simplify the structure compared to the theory guided neural network tgnn wang et al 2020b tgfcnn is more suitable for contaminant transport problems due to its more efficient capability of image processing moreover we can change the number of convolutional layers to increase the complexity of tgfcnn fig 1 shows the structure of tgfcnn where hi wi chi and ti denote the height width number of channels and number of time steps of input images respectively ho wo cho and to are corresponding properties of output images as shown in fig 1 the channel of the input image at time step t 0 consists of x matrix y matrix and t matrix whose value is t0 and k field for other time steps the t matrix can be changed accordingly xn and ym denote the maximum value of x and y coordinates respectively the labeled data can be obtained from simulation software modflow and mt3dms in tgfcnn the loss function consists of the residual of underlying governing equations as a soft constraint to improve accuracy and generalizability the inputs of tgfcnn are images with several channels including coordinate information hydraulic conductivity fields and other additional conditions in different scenarios e g the location and strength of the contaminant source the output is the predicted one channel contaminant concentration field the parameters of the tgfcnn model can be updated by minimizing the data mismatch and the residual of governing equations in this work height width and time step of the inputted image are the same as those of the output image i e hi ho wi wo and chi cho respectively eqs 7 9 are utilized to obtain h field and seepage vx and vy from surrogate models which can be rewritten as follows 15 s s h p r e t x k x y h p r e x y k x y h p r e y 16 v x p r e k x θ h p r e x 17 v y p r e k y θ h p r e y where hpre denotes the predicted hydraulic head from tgfcnn and v x p r e and v y p r e denote the seepages calculated according to hpre eq 10 can be rewritten as follows 18 θ c p r e t x θ d x x c p r e x x θ d x y c p r e y y θ d y y c p r e y y θ d y x c p r e x x θ v x c p r e y θ v y c p r e q s c s r n where cpre is the contaminant concentration fields predicted from tgfcnn the chemical reaction term is not considered in this work i e rn 0 the mean square errors mses of eqs 15 and 18 are added into the loss function of tgfcnn as follows 19 l pde 1 1 n n 1 n s s h p r e t x k x y h p r e x y k x y h p r e y 2 20 l pde 2 1 n n 1 n θ c p r e t x θ d x x c p r e x x θ d x y c p r e y y θ d y y c p r e y y θ d y x c p r e x x θ v x c p r e y θ v y c p r e q s c s 2 where n denotes the number of collocation points in this study the derivatives of the head and concentration are calculated by the central difference method the loss function of tgfcnn can be summarized as 21 l 1 n n 1 n c p r e c o b s 2 λ pde 1 l pde 1 λ pde 2 l pde 2 where cobs is the observation value of the contaminant concentration field and λpde1 and λpde2 are hyper parameters to control the weight of the residual of these two governing equations in this work λpde1 is set to be 0 and λpde2 is set to be 100 in cases 1 3 and are both set to be 100 in case 4 in the training process tgfcnn will predict contaminant concentration fields for all time steps t at once in addition only some sparse data points and collocation points from all t time steps are collected to calculate the residuals of the governing equation to impose the physical constraints for tgfcnn 3 case studies in this section we test the performance of tgfcnn with several contaminant transport problems under different conditions we construct four surrogate models respectively for these scenarios estimating the initial release location and concentration without additional injection under a known k field estimating the location injection concentration and duration of the short term source under a known k field estimating the location and injection concentration of the long term source under a known k field and estimating the location and injection concentration of the long term source and unknown k fields the accuracy of tgfcnn is compared with the traditional data driven cnn to elucidate the effect of theory guidance it is worth noting that the structure and setup of tgfcnn and cnn are the same i e the only difference is the existence of theory guidance in cases 1 3 we consider an ideal situation in which the k field as shown in fig 2 and thus the flow field are already known therefore λpde1 in cases 1 3 is set to be 0 the studied domain is a 310 l 610 l rectangle which is discretized uniformly into 32 62 grids with δx δy 10 l herein k x y is generated by employing karhunen loeve expansion kle in the kle method a random field lnk x τ can be expressed as wang et al 2020b 22 l n k x τ l n k x τ l n k x τ where x d physical domain τ θ probability spaces l n k x τ denotes the mean of lnk and lnk x τ denotes the fluctuation the symmetric bounded and positive definite covariance clnk x x lnk x τ lnk x τ can describe the spatial structure of lnk x τ which can be further decomposed as ghanem and spanos 2003 23 c l n k x x i 1 λ i f i x f i x the eigenvalue λ i and eigenfunction fi x y can be obtained from the second type fredholm equation wang et al 2020b 24 d c l n k x x f x λ f x then eq 22 can be represented as wang et al 2020b 25 l n k x τ ln k x i 1 λ i f i x ξ i τ where ξ i τ denotes orthogonal gaussian random variables moreover eq 25 can be truncated into n terms to decrease the dimension of random variables ξ i τ thus eq 25 can be rewritten as wang et al 2020b 26 l n k x ln k x n i 1 λ i f i x ξ i τ the correlation length along the x axis is 122 l and 62 l along the y axis which are both 0 2 times the length of corresponding sides the mean of lnk is set to be 2 and the variance is 1 0 60 energy has been kept in the kle method in case 4 a more complex situation is considered i e the k fields are unknown in the simulation process eq 7 is first solved to obtain a steady flow field by utilizing the simulation software modflow which will not be influenced by the release of contaminant the left and right sides are set to be the entrance and the exit of the flow field respectively taking the boundary conditions as h x 0 40 l and h x 610 0 l the upper and lower boundaries are set to be impervious eq 8 is then solved to determine the transport process of contaminant by utilizing the simulation software mt3dms zheng and wang 1999 the porosity θ is set to be 0 3 the dispersivity α l is set to be 10 α t is set to be 1 and the effective molecular diffusion coefficient d is negligibly small the duration is set to be 360 t the time step is 6 t the architecture of tgfcnn is fixed as shown in table 1 in table 1 chin is the channel number of the input layer which can be determined according to different conditions for example if the location intensity and duration of the contaminant source are considered in a case the channel number in the surrogate model can be set to be 7 comprising the x coordinate and y coordinate of the grid information of the time step the hydraulic conductivity field and the location intensity and duration of the contaminant source the activation function used in each layer is leakyrelu to avoid vanishing gradient adam kingma and ba 2015 is chosen as the optimizer the learning rate is set to be 0 0001 the neural networks will be trained through 2000 epochs the xavier uniform initialization method is used to initialize the weights of neural networks and the biases are set to be 0 initially the models are built based on the pytorch framework which is a commonly used deep learning python package paszke et al 2017 a nvidia geforce rtx 2080 ti gpu is used to perform the training process 3 1 case 1 estimating the initial release location and concentration of contaminant without additional injection under a known k field in this subsection we assume that there is no source of contaminant in the flow field i e q s c s k 0 and only a small area of the domain has contaminants of a certain concentration at the initial moment a surrogate model is built to estimate the initial release location and concentration of the contaminant the range of the initial contaminated area is set to be a 3 3 matrix the prior value range and reference values of the matrix center point coordinates and concentration are shown in table 2 it is worth noting that the x and y coordinates are divided by the grid length 10 to balance the magnitude of the parameters tgfcnn and cnn are utilized to construct surrogate models for different initial contaminant locations and strength the inputs of surrogate models comprise x coordinate y coordinate time step initial conditions release location and initial strength and known k field to provide more field information to improve the accuracy of prediction these two surrogate models are trained with 100 realizations in addition 496 16 31 data points and 1891 collocation points are extracted through the entire time steps including the initial time step i e 61 time steps in each realization amounting to 30 256 i e 496 61 time steps data points and 115 351 i e 1891 61 time steps collocation points the training time of the tgfcnn model is approximately 7 and 6 h for the cnn model root mean square error rmse and r 2 score are employed to estimate the performance of the trained surrogate models rmse and r 2 score are defined as follows 27 rmse 1 n i 1 n u p r e i u r e f i 2 28 r 2 1 i 1 n u p r e i u r e f i 2 n 1 n u r e f i u r e f 2 where n is the total number of observation points u p r e i denotes the i th prediction value u r e f i denotes the ith reference value and u r e f is the mean of uref we input a new group of initial release locations and concentrations of contaminant under the known k field to compare the performance of these two models and the reference values are solved with mt3dms some predicted snapshots of the contaminant concentration field from the tgfcnn surrogate model are shown in fig 3 and some predicted snapshots from the cnn surrogate model are presented in fig 4 it can be seen that errors of the cnn surrogate model are more pronounced than those of the tgfcnn surrogate model especially where no data points are extracted the predictions of the tgfcnn surrogate model are more in line with physical equations and obvious outliers are not likely to appear in the predicted values these two figures show that the physical constraints can assist to reduce the approximation errors effectively the tgfcnn surrogate model can still predict results with high accuracy when the inputted initial release locations and concentrations of contaminant are not trained the results indicate the strong generalization and extrapolation ability of tgfcnn for further comparison of the performance between tgfcnn and cnn surrogate models we calculate the mean r 2 score and rmse of predictions from the two surrogate models for 100 new realizations with different initial contaminant locations and concentrations the histograms of r 2 score and rmse are presented in fig 5 information of input number of training realization the mean and variance of r 2 score and rmse of predictions are summarized in table 3 the histograms of r 2 score and rmse also show the superior accuracy of the tgfcnn surrogate model compared with the cnn surrogate it can also be seen that the physical constraints are of great use to improve the performance of surrogate models we also fixed the number of collocation points and trained the tgfcnn surrogate model with a different number of data points and training realizations to further study the effect of data points on the accuracy of surrogate models the mean r 2 score and mean rmse for surrogate models are shown in fig 6 the performance of the cnn surrogate model varies significantly with the number of data points and training realizations this is because the cnn surrogate model is trained in a purely data driven manner and less data means less information to be learned with the assistance of physical constraints the performance of the tgfcnn model is more stable even in the absence of data points tgfcnn can obtain satisfactory results by merely obeying the governing equation without actually solving it while this is impossible for the data driven cnn the results above illustrate the satisfactory performance of the tgfcnn surrogate model it can then be further utilized to solve the inverse problems by combining it with the ies algorithm here we would like to estimate the location and initial concentration of the contaminant source with observation data the contaminant concentration data of 12 randomly selected observation points at the last 20 time steps are collected as observations and used for parameter estimation fig 7 shows the locations of these selected observation points it is worth noting that only the information of c fields is used to estimate unknown parameters in these four cases in the ies we firstly generate 200 groups of random variables i e the x and y coordinates and the strength of the initial released contaminant as initial parameters which will be updated during the iteration the iteration number is set to be five the updating processes of these three unknown parameters by employing the tgfcnn surrogate model and simulator are shown in fig 8 and the estimated results are presented in table 3 fig 8 and table 4 indicate that as the iteration progresses the parameters of the tgfcnn surrogate model and the simulator gradually converge to the reference value at the end of each iteration the updated parameters can be inputted into the simulator to calculate the rmse with the observation data the convergence process of rmse during the iteration is displayed in fig 9 these results demonstrate the effectiveness and accuracy of the tgfcnn surrogate based ies method the time consumed during the iteration is shown in fig 10 and it can be seen that the consumed time using simulator ies for one iteration is much larger than that of five iterations using tgfcnn ies therefore under the premise of ensuring accuracy the tgfcnn surrogate model can effectively reduce time consumption for estimation of the initially released contaminant location and concentration 3 2 case 2 estimating the location injection concentration and duration of the short term source under a known k field in this case we assume that there is a short term 3 3 matrix of the contaminant source in the flow field and the duration of this source is t t 60 the inputs of surrogate models consist of x and y coordinates time step duration of source initial conditions location and strength of the injection source and k field the value range and reference values of the parameters about the matrix center point are presented in table 5 similar to case 1 100 realizations are solved with simulators and used as labeled data to train tgfcnn and cnn surrogate models 30 256 labeled training data and an additional 102 660 collocation points are extracted through the entire time span to train the tgfcnn model and the cnn surrogate is trained only with the labeled data the consumed time of training the tgfcnn model and cnn model is approximately 7 and 6 h respectively after training 100 new realizations are predicted with tgfcnn and cnn surrogate models to test the performance snapshots of one selected contaminant concentration field at time step 20 40 and 60 from tgfcnn and cnn surrogate models are presented in appendix a1 and a2 respectively the histograms of r 2 score and rmse for the predictions from the two surrogate models are shown in fig 11 the r 2 score histogram of tgfcnn is closer to 1 and the rmse histogram is closer to 0 indicating that the performance of the tgfcnn surrogate model is more accurate than that of cnn this case shows that the tgfcnn model is more stable and accurate than the traditional cnn model when facing more complex situations demonstrating the satisfactory extrapolation and generalization ability of the tgfcnn model information of input number of training realization the mean and variance of r 2 score and rmse of predictions are summarized in table 6 the tgfcnn surrogate model can then be used to solve the inverse problem in combination with the ies method the sampling method of observation data is the same as that in case 1 the iteration number is set to be five moreover 200 groups of parameters are generated and updated during the iteration the simulator based ies method is used as a contrast experiment the updating processes of the four unknown parameters with the tgfcnn surrogate model and simulator are shown in fig 12 the estimated results are presented in table 7 the convergence process of rmse during the iteration is shown in fig 13 it can be seen that as the iteration progresses the four parameters gradually converge to the reference values and the overall rmse gradually decreases the tgfcnn surrogate based ies method is shown to estimate unknown parameters efficiently 3 3 case 3 estimating the location and injection concentration of the long term source under a known k field in this case we assume that there is a 3 3 matrix of contaminant source in the flow field and the duration of this source is 60 time steps the values range and reference values of the parameters about the matrix center point are shown in table 8 the inputs of surrogate models consist of x coordinate y coordinate step information initial conditions location and strength of the injection source and the known k field the number and sampling method of data points and collocation points are the same as those in case 1 tgfcnn and cnn surrogate models are trained with 100 realizations the consumed time of training the tgfcnn surrogate is approximately 6 5 h and approximately 6 h for the cnn surrogate after training 100 new realizations are predicted with tgfcnn and cnn surrogate models to test their performance input number of training realization the mean and variance of r 2 score and rmse of predictions are summarized in table 9 snapshots of one selected contaminant concentration field at time step 20 40 and 60 for tgfcnn and cnn surrogate models are presented in appendix b1 and b2 respectively as contaminants are injected for a long period of time the concentration of the contaminant keeps increasing consequently the data deviation between each time step will gradually become larger it is difficult for the data driven cnn model to learn this data deviation whereas tgfcnn can still predict the contaminant transport well with the assistance of theory guidance similar to the previous two cases we calculate the r 2 score and rmse of predictions from surrogate models for 100 new realizations and the histograms are presented in fig 14 it is obvious that the performance of tgfcnn is superior to that of cnn the tgfcnn surrogate model is then ultilized to solve the inverse problem the updating processes of the three unknown parameters with tgfcnn ies and simulator ies are shown in fig 15 the estimated results of the parameters are presented in table 10 the rmse convergence processes of the parameters are shown in fig 16 it can be seen that both the results of simulator ies and tgfcnn ies converge to the reference values indicating the effectiveness of the tgfcnn surrogate based ies for estimating the location and injection concentration of the long term contaminant source the results demonstrate the generalization ability of the tgfcnn model 3 4 case 4 estimating the location and injection concentration of the long term source and unknown k fields the same as in case 3 the contaminant source is still set to be a 3 3 matrix in the flow field and the duration of this source is 60 the values range and reference values of the parameters about the matrix center point are same as those in case 3 however the k fields fig 17 and thus the flow fields are unknown which increases the difficulty of constructing surrogate models especially for data driven models the mean of training lnk is set to be 2 and the variance is 1 0 the correlation length along the x axis and y axis are 122 l and 62 l respectively the left boundary is set to be 40 l in order to obtain seepage vx and vy and further calculate eq 20 two surrogate models are constructed to predict h fields and c fields respectively the structure of these two models are the same as in previous cases the input of the surrogate model for h fields consists of x coordinate y coordinate and different k fields the input of the surrogate model for c fields consists of x coordinate y coordinate step information initial conditions location and strength of the injection source vx and vy the number and sampling method of points are the same as those in case 1 firstly the surrogate models for h fields are trained with 100 labeled realizations and 900 virtual realizations without any labeled data to strengthen the effect of theory guidance the consumed time of training the tgfcnn surrogate is approximately 35 h and approximately 1 3 h for the cnn surrogate after training 100 new untrained k fields are inputted into the surrogate models for h fields the histograms of r 2 score and rmse for the 100 new predicted h fields from the two surrogate models are shown in fig 18 the predictions from the tgfcnn surrogate model can match the reference better than those from the cnn surrogate model due to the assistance of theory guidance input number of training realization the mean and variance of r 2 score and rmse of predicted h fields are summarized in table 11 furthermore the generalization and extrapolation performance of the surrogate models for h fields have been estimated firstly the left boundary condition is fixed to be 40 l and some k fields with the mean of lnk to be 1 and the variance to be 0 5 are inputted into the surrogate models secondly the left boundary condition of flow field has been changed to 50 l with the mean of lnk to be 2 and the variance to be 1 in fig 19 the prediction of h fields exhibits high accuracy from the tgfcnn surrogate model even though the changed k fields and boundary condition were not learned in the training process these results demonstrate the effectiveness of theory guidance and the strong generalization and extrapolation ability of the tgfcnn surrogate model the surrogate models for c fields are trained subsequently by inputting seepage vx and vy which can be obtained from predicted h fields 100 labeled and 900 virtual realizations have been used to train these models the consumed time of training the tgfcnn surrogate and cnn surrogate is approximately 40 h and 4 h respectively after training 100 new untrained k fields are inputted into the surrogate models for h fields to obtain seepage vx and vy then the vx and vy are inputted into the surrogate models for c fields to predict the contaminant transport snapshots of one selected c field at time step 20 40 and 60 from tgfcnn and cnn surrogate models are presented in appendix c1 and c2 respectively the histograms of r 2 score and rmse for the 100 new predicted c fields are shown in fig 20 information of input number of training realization the mean and variance of r 2 score and rmse of predicted c fields are summarized in table 12 to further evaluate the generalization and extrapolation performance the obtained seepages vx and vy based on h fields of fig 19 are subsequently inputted into the surrogate for c fields fig 21 displays the correlation between the prediction and reference the predictions of the tgfcnn surrogate model and reference values converge closer to the line y x compared to those of the cnn surrogate model in the ies method the sampling method of observation data is same as that in case 1 the location and strength of the contaminant source and the k field are needed to be estimated the iteration number is set to be 10 200 groups of parameters are initialized and updated during the iteration the simulator based ies method is used as a contrast experiment the updating processes of the location x y and strength of the contaminant source are presented in fig 22 the estimated parameters and k fields are shown in table 13 and fig 23 respectively the rmse of the estimated k field is 0 0801 in the ies method based on the tgfcnn surrogate model and 0 0993 based on the simulator during the iteration process the k field and parameters gradually converge to reference values therefore the rmse of the predicted c field decreases correspondingly the decreasing process of rmse of observation points during the iteration is shown in fig 24 the simliar estimated results demonstrate the accuracy and effectiveness of the proposed tgfcnn framework moreover the surrogate model for h fields could also be constructed with pinn raissi et al 2019 tgnn wang et al 2020b 2021b and weak form tgnn tgnn wf xu et al 2021 frameworks which all employ the fully connected neural network architecture pinn has been used for surrogate modeling of fluid flow problems governed by navier stokes equations by sun et al 2020a and achieves sufficient accuracy tgnn also achieves satisfactory performance for surrogate modeling of subsurface flow problems with different k fields tgnn wf can further improve the robustness of the tgnn framework by incorporating the weak form of the governing equation as physical constraints consequently these mentioned frameworks can be combined with the tgfcnn based surrogate model for c fields to solve the inverse problem in a hybrid scheme however it may be difficult for nn based algorithms to learn the convection dispersion equation and predict c fields due to their point to point learning scheme this is because the c fields have strong localized features which can be seen as images in contrast tgfcnn can extract local information better due to its convolutional scheme in addition the k fields can be inputted into the tgfcnn as images directly which need to be parameterized with the kle method prior to being inputted into tgnn as compared in wang et al 2021a 4 discussion and conclusion in this study the theory guided full convolutional neural network tgfcnn is proposed for inverse problems in contaminant transport problems in tgfcnn we incorporate physical constraints into the loss function to improve the performance of cnn tgfcnn is not only trained with sparse data points from simulation but also guided by physical theories i e governing equations compared to traditional cnn models the theory guidance allows tgfcnn to achieve superior accuracy therefore the tgfcnn surrogate can be combined with the iterative ensemble smother ies for inverse modeling in contaminant transport problems the performance of the proposed tgfcnn based ies is tested in four cases both the tgfcnn surrogate model and the cnn surrogate model are trained for comparison the generalization and extrapolation performance of tgfcnn has been evaluated through changing the boundary condition and k fields the results demonstrate that the tgfcnn surrogate model possesses better prediction and generalization ability than the conventional cnn surrogate model we then employed the trained tgfcnn surrogate model and ies to solve inverse problems as the iteration progresses the parameters to be solved gradually converge to the reference values and the rmse between the observation data and predictions gradually decreases moreover the consumed time of tgfcnn ies for inversion is markedly shorter than that of simulator ies therefore it is more efficient to use the tgfcnn surrogate model for solving inverse problems in surface contaminant transport although the structure of tgfcnn is simple the results demonstrate the high accuracy and efficiency of tgfcnn in contaminant transport problems the proposed tgfcnn model provides an efficient way for solving problems with strong localized features i e learning localized features through the cnn structure and improving the prediction accuracy by constraining the network with governing equations the tgfcnn is however developed for and demonstrated with 2d problems wang et al 2021c pointed out the potential of cnn based methods for 3d pore scale imaging and modeling the tgfcnn may be extended for more complex governing equations and modeling 3d convection dispersion of contaminants credit authorship contribution statement tianhao he conceptualization methodology writing original draft writing review editing nanzhe wang software data curation visualization investigation dongxiao zhang conceptualization methodology writing original draft writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is partially funded by the shenzhen key laboratory of natural gas hydrates grant no zdsys20200421111201738 and the sustech qingdao new energy technology research institute appendix appendix a in this case we assume that there is a short term 3 3 matrix of contaminant source in the flow field and the duration of this source is t t 60 after training 100 new realizations are solved with the simulator as a reference and predicted with tgfcnn and cnn surrogate models to test the performance snapshots of one selected contaminant concentration field at time step 20 40 and 60 from tgfcnn and cnn surrogate models are presented in figs a1 and a2 respectively appendix b in this case we assume that there is a 3 3 matrix of contaminant source in the flow field in entire 60 time steps snapshots of one selected contaminant concentration field at time step 20 40 and 60 for tgfcnn and cnn surrogate models are presented in figs b1 and b2 respectively appendix c in this case the contaminant source is still set to be a 3 3 matrix in the flow field and the duration of this source is 60 different from case 3 the k fields and thus the flow fields are unknown which increases the difficulty of constructing surrogate models especially for data driven models snapshots of one selected contaminant concentration field at time step 20 40 and 60 for tgfcnn and cnn surrogate models are presented in figs c1 and c2 respectively 
235,identification of the location and strength of a contaminant source in an aquifer is a challenging but crucial task efficient surrogate models can be constructed to replace traditional time consuming simulators while solving this inverse problem in recent years with the rapid development of machine learning ml algorithms the artificial neural network ann has been proven to be an efficient way for surrogate modeling however it may be difficult for ann based algorithms to learn the convection dispersion equation and predict the contaminant concentration field due to their point to point learning scheme because of their strong localized features the concentration fields can be seen as images in contrast the convolutional neural network cnn can extract spatial information better due to its convolutional structure herein a theory guided full convolutional neural network tgfcnn model is proposed to solve inverse problems in subsurface contaminant transport tgfcnn can construct robust and reliable surrogate models with limited training realizations and be further utilized for inverse modeling tasks the loss function of tgfcnn comprises the residual of governing equations of contaminant transport as well as data mismatch moreover the iterative ensemble smoother ies method is employed to update the parameters while solving the inverse problems the proposed tgfcnn model is evaluated in four scenarios the results demonstrate that the tgfcnn model possesses strong generalization and extrapolation abilities and satisfactory accuracy when estimating unknown contaminant source parameters as well as the permeability field the time consumption of the tgfcnn surrogate model for inverse tasks is also greatly reduced compared to using traditional simulators directly 1 introduction identification of the release history of a subsurface contaminant source with sparse and limited observation data is a crucial but challenging task for environmental monitoring and cleanup this task can be regarded as a high dimensional inverse problem zhang et al 2015 xu and gómez hernández 2018 mo et al 2019 timely and effective identification of a source and prediction of contaminant migration are critical to implementing relevant measures to prevent further pollution at present various approaches have been proposed to solve inverse problems for instance markov chain monte carlo mcmc is a highly accurate method for nonlinear systems it solves inverse problems in a probabilistic framework vrugt 2016 in addition mcmc with delay rejection adaptive metropolis dram sampling can be more efficient for strong nonlinear multi peak distributions and other complex parameter estimation problems haario et al 2006 zhang et al 2015 vrugt 2016 zhou and tartakovsky 2021 since bayesian inference based on mcmc sampling can be used for nonlinear systems and considers uncertainties directly the bayesian method is comparably more reliable and applicable monache et al 2008 shi et al 2012 laloy et al 2013 zeng et al 2012 zhang et al 2015 moreover bayesian inference can provide the posterior distribution of parameters and update previous inferences according to new observation data wang and jin 2013 researchers have also proposed numerous improvements to bayesian inference monache et al 2008 used an unmodified forward model to make full use of the generality and flexibility of bayesian inference by applying this method the posterior probability distribution of unknown parameters can be obtained they applied this approach to a continental scale accidental release of radioactive material from near algeciras in spain to retrieve information of the source zhang et al 2015 utilized relative entropy to quantify information gain from observation data and combined it with a bayesian method based on mcmc to reconstruct the unknown parameters they also employed an interpolation method based on an adaptive sparse grid to speed up computation and reduce time cost ensemble based methods have also been proposed for data assimilation or inverse modeling e g ensemble kalman filter enkf evensen 1994 and ensemble smoothers es leeuwen and evensen 1996 these data assimilation methods can be used to estimate model parameters and can be easily employed to analyze the uncertainty of the estimations these two kinds of ensemble based methods have been widely applied in groundwater hydrology to identify the location and strength of subsurface contaminant sources chaudhuri et al 2018 chen and zhang 2006 franssen and kinzelbach 2008 gu and oliver 2007 ju et al 2018 white 2018 xu and gómez hernández 2018 zhou et al 2011 the enkf method updates the parameters and state variables simultaneously in each analysis step which may cause an inconsistency problem thulin et al 2007 and a convergency problem when the system is strongly nonlinear chang et al 2017 however the es method provides a global updating scheme to overcome these issues in enkf chen and oliver 2013 used the iteration method to improve the quality of es in strongly nonlinear problems proposing the iterative ensemble smoother ies method chang et al 2017 developed a surrogate based ies method to speed up the data assimilation process this method is more convenient and applicable to various surrogate models traditional methods for solving inverse problems are usually utilized in conjunction with simulators or surrogate models simulators usually require numerous iterations to solve forward problems however which increases the consumption of time furthermore with the increment of input dimensionality most extant surrogate models will suffer from the curse of dimensionality liao and zhang 2016 mo et al 2019 indeed numerous training realizations are needed to achieve satisfactory accuracy which may further increase computational cost in recent years with the development of ml algorithms various problems with porous medium have been solved neural networks nns have been widely utilized to construct surrogate models compared to traditional surrogate models nns can capture spatiotemporal features and deal effectively with high dimensional problems due to the special deep architectures as surrogate models nns can approximate nonlinear functions excellently if the structures of hidden layers are sufficiently complex recently numerous researchers have employed nns to construct efficient surrogate models or solve complex high dimensional problems directly wu et al 2019 constructed a convolutional neural network cnn model to predict effective diffusivity of 2d porous media by treating the porous structure as an image the results demonstrate that the computational cost of cnn is significantly reduced compared with lattice boltzmann lbm simulations based on consumer complaint information sun et al 2019 utilized a cnn to explore the characteristics of complaints corresponding to different contaminant intrusion nodes and to improve the performance of contamination source identification however their algorithm is markedly sensitive to noise mo et al 2019 proposed a deep autoregressive neural network based on the dense convolutional encoder decoder architecture and applied it to construct surrogate models for contaminant transport problems the input dimensionality of this network was 686 which shows the ability of the deep autoregressive neural network to solve high dimensional problems they also employed the iterative local updating ensemble smoother ilues method to solve high dimensional inverse problems by combining it with the deep autoregressive neural network surrogate model although the dense convolutional encoder decoder network obtained satisfactory performance its accuracy and generalization ability needed to be guaranteed by numerous training data wei et al 2020 attempted to combine five physics based descriptions with ml algorithms such as support vector regression and gaussian process regression to predict thermal transport in porous medium the results demonstrate that these proposed five descriptions have strong correlations with conductivity fields wang et al 2020c utilized cnn based gated u net to estimate velocity fields in all directions and macro scale conductivity fields in the tortuous flow paths of porous media the error of predictions can be less than 1 in 2d models and 10 in 3d models which demonstrates the strong fitting ability of cnn based algorithms grbčić et al 2020 combined ann with random forests to determine variables of the contaminant transport process i e start time end time and contaminant concentration this method can narrow down the search space of the source node because of the efficiency of ann and realize identification of the contaminant source efficiently by utilizing monte carlo simulation sun and wang 2020b proposed a novel bayesian neural network constrained by physics to reconstruct flow fields from noisy samples which provides an innovative approach to resist the influence of noise zhou and tartakovsky 2021 developed an adaptive mcmc method based on the cnn surrogate model this method can reduce computational cost efficiently which allows further reduction of sampling error of the approximate likelihood function despite the numerous successes of ml based methods certain shortcomings remain for instance most of these ml based methods are data driven as a consequence an enormous amount of training data is needed in addition it is difficult to extrapolate or generalize beyond the scope of training data the predictions of data driven methods may also not always be physical to deal with these problems some researches have attempted to consider physical constraints for instance raissi et al 2019 proposed a physics informed neural network pinn which incorporates the residual of governing equations as a regulation in the loss function of the neural network wang et al 2020b developed a theory guided neural network tgnn which incorporates both physical constraints and engineering controls wang et al 2020a proposed a theory guided convolutional neural network tgcnn framework for uncertainty quantification and inverse modeling tasks which employed a convolutional encoder decoder architecture in their works the finite difference fd method was adopted to calculate the residuals of pdes in the cnn structure currently the theory guided training strategy has been studied and utilized in many works chen and zhang 2021 he and zhang 2020 xu et al 2021 in the present work we construct a theory guided full convolutional neural network tgfcnn the full convolutional neural network fcnn structure has been widely used such as for predicting stress factor contributions in porous materials keleṣ et al 2021 its structure is simpler due to the full convolutional architecture compared to the encoder decoder structure of tgcnn wang et al 2020a the residual of governing equations is incorporated into the loss function as soft constraints in this work four different scenarios are designed to test the performance of tgfcnn we utilize the tgfcnn model to construct surrogate models for contaminant source identification in these four scenarios with the assistance of theory guidance the predictions are more accurate and reliable than the results obtained by purely data driven cnn compared to data driven cnn based surrogate models the tgfcnn surrogate model can obtain superior generalization performance with a small amount of training realizations which means that less computational cost is required the results demonstrate that although the structure of tgfcnn is simple the accuracy and generalization ability of the tgfcnn surrogate model are satisfactory because data mismatch and physical theories are simultaneously honored the remainder of this paper proceeds as follows in section 2 we introduce the ies method governing equations and the basic structure of tgfcnn in section 3 several 2d cases with different setups are designed to test the accuracy of the tgfcnn based ies finally in section 4 the performance of the proposed tgfcnn model is discussed and conclusions are presented 2 methodology in this section we firstly introduce the ies method we then elaborate on the governing equations of the contaminant transport problem finally the architecture of tgfcnn and how to combine the governing equations into tgfcnn are outlined 2 1 iterative ensemble smoother a common mathematical representation of a physical model is considered as follows 1 d g m where g denotes the forward model m denotes the inputted model parameters and d is the output of the forward models g given m predicting the output d by running simulators or solving equations can be regarded as a forward problem however the model parameters m are unknown in most cases and they need to be inferred with given measurements the process of inferring the unknown parameters m can be considered to be an inverse problem the inverse problem can be expressed as oliver et al 2008 wang et al 2020a 2 d obs g m ε where d obs denotes the observation data and ε represents the measurements error due to the unique and ill posed feature of solution of the inverse problem the most efficient method to solve the inverse problem is by maximizing the conditional probability density function p m d obs chang et al 2017 as mentioned by oliver et al 2008 if the prior probability density function pdf of model parameters and measurement errors follow a gaussian distribution maximizing the conditional probability density function p m d obs is equivalent to minimizing the following objective function 3 o m 1 2 d obs g m t c d 1 d obs g m 1 2 m m p r t c m 1 m m p r where cd denotes the covariance matrix of measurements data cm denotes the covariance matrix of prior model parameters m pr represents the prior model parameters and g m denotes the predicted data from forward models with model parameters m to optimize the objective function eq 3 an iterative gauss newton formula is introduced as follows chen and oliver 2013 chang et al 2017 wang et al 2020a 4 m l 1 m l 1 λ l c m 1 g l t c d 1 g l 1 c m 1 m l m p r g l t c d 1 g m l d obs where l is the iterative step gl denotes the sensitivity matrix of parameters m l at lth iterative step and λ l denotes a multiplier to reduce the influence of data mismatch in the early iterations chen and oliver 2013 chang et al 2017 white 2018 wang et al 2020a in the ensemble based method eq 4 can be rewritten for different realizations as follows chang et al 2017 wang et al 2020a 5 m l 1 j m l j 1 1 λ l c m c m g l j t 1 λ l c d g l j c m g l j t 1 g l j c m g m t m m p r c m g l j t 1 λ l c d g l j c m g l j t 1 g m l j d j obs j 1 n e where j denotes the realization index and ne denotes the total number of realizations in the ensemble in the ies method the prior covariance matrix cm in the hessian matrix is replaced by the covariance matrix c m l of the updated parameters m l j at iterative step l chen and oliver 2013 chang et al 2017 wang et al 2020a and the average sensitivity matrix g l can replace the sensitivity matrix g l j gu and oliver 2007 chang et al 2017 wang et al 2020a moreover c m g l t is approximated with c m l d l and g l c m l g l t is approximated with c d l d l chang et al 2017 wang et al 2020a c m l d l denotes the covariance of parameters m l and prediction g m l and c d l d l denotes the covariance of g m l as a consequence the updating formula of ies can be expressed as chang et al 2017 wang et al 2020a 6 m l 1 j m l j 1 1 λ l c m l c m l d l 1 λ l c d c d l d l 1 c d l m l c m 1 m l j m j p r e c m l d l 1 λ l c d c d l d l 1 g m l j d j obs j 1 n e 2 2 governing equations governing equations of the subsurface contaminant transport process consist of two parts the equation of flow in porous medium i e eq 7 and the equation of the convection and dispersion of contaminant in the flow field i e eq 8 the equation of flow in porous medium can be written as follows 7 s s h t x k x y h x y k x y h y where h is the hydraulic head ss is the specific storage x and y are cartesian coordinates and k x y denotes the hydraulic conductivity field then the hydraulic head h and the seepage along x and y coordinates vx and vy respectively can be obtained as follows 8 v x k x θ h x 9 v y k y θ h y where kx and ky denote the component of k x y along x and y coordinates respectively and θ denotes the porosity of subsurface medium the equation of contaminant convection and dispersion in the flow field is written as 10 θ c t x θ d x x c x x θ d x y c y y θ d y y c y y θ d y x c x x θ v x c y θ v y c q s c s r n where c denotes the dissolved concentration of contaminant dxx dxy dyy and dyx denote the hydrodynamic dispersion coefficient tensor in corresponding directions qs denotes the volumetric flow rate per unit volume of aquifer with a positive value representing fluid source and a negative value representing sink cs denotes the contaminant concentration of the sources or sinks and rn is the chemical reaction term the hydrodynamic dispersion coefficient tensor dxx dxy dyy and dyx in the 2d case can be calculated as follows 11 d x x α l v x 2 v α t v y 2 v d 12 d y y α l v y 2 v α t v x 2 v d 13 d x y d y x α l α t v x v y v 14 v v x 2 v y 2 where α l denotes the longitudinal dispersivity α t denotes the transverse dispersivity and d denotes the effective molecular diffusion coefficient 2 3 theory guided full convolutional neural network cnn has been widely used for image processing the convolution operation makes it more advantageous in processing high dimensional data in addition due to the parameter sharing scheme the parameters of the cnn can be reduced significantly in this work the contaminant concentration field at each time step can be regarded as an image cnn usually includes convolutional layers activation layers and pooling layers in tgfcnn only several convolutional and activation layers are utilized to further simplify the structure compared to the theory guided neural network tgnn wang et al 2020b tgfcnn is more suitable for contaminant transport problems due to its more efficient capability of image processing moreover we can change the number of convolutional layers to increase the complexity of tgfcnn fig 1 shows the structure of tgfcnn where hi wi chi and ti denote the height width number of channels and number of time steps of input images respectively ho wo cho and to are corresponding properties of output images as shown in fig 1 the channel of the input image at time step t 0 consists of x matrix y matrix and t matrix whose value is t0 and k field for other time steps the t matrix can be changed accordingly xn and ym denote the maximum value of x and y coordinates respectively the labeled data can be obtained from simulation software modflow and mt3dms in tgfcnn the loss function consists of the residual of underlying governing equations as a soft constraint to improve accuracy and generalizability the inputs of tgfcnn are images with several channels including coordinate information hydraulic conductivity fields and other additional conditions in different scenarios e g the location and strength of the contaminant source the output is the predicted one channel contaminant concentration field the parameters of the tgfcnn model can be updated by minimizing the data mismatch and the residual of governing equations in this work height width and time step of the inputted image are the same as those of the output image i e hi ho wi wo and chi cho respectively eqs 7 9 are utilized to obtain h field and seepage vx and vy from surrogate models which can be rewritten as follows 15 s s h p r e t x k x y h p r e x y k x y h p r e y 16 v x p r e k x θ h p r e x 17 v y p r e k y θ h p r e y where hpre denotes the predicted hydraulic head from tgfcnn and v x p r e and v y p r e denote the seepages calculated according to hpre eq 10 can be rewritten as follows 18 θ c p r e t x θ d x x c p r e x x θ d x y c p r e y y θ d y y c p r e y y θ d y x c p r e x x θ v x c p r e y θ v y c p r e q s c s r n where cpre is the contaminant concentration fields predicted from tgfcnn the chemical reaction term is not considered in this work i e rn 0 the mean square errors mses of eqs 15 and 18 are added into the loss function of tgfcnn as follows 19 l pde 1 1 n n 1 n s s h p r e t x k x y h p r e x y k x y h p r e y 2 20 l pde 2 1 n n 1 n θ c p r e t x θ d x x c p r e x x θ d x y c p r e y y θ d y y c p r e y y θ d y x c p r e x x θ v x c p r e y θ v y c p r e q s c s 2 where n denotes the number of collocation points in this study the derivatives of the head and concentration are calculated by the central difference method the loss function of tgfcnn can be summarized as 21 l 1 n n 1 n c p r e c o b s 2 λ pde 1 l pde 1 λ pde 2 l pde 2 where cobs is the observation value of the contaminant concentration field and λpde1 and λpde2 are hyper parameters to control the weight of the residual of these two governing equations in this work λpde1 is set to be 0 and λpde2 is set to be 100 in cases 1 3 and are both set to be 100 in case 4 in the training process tgfcnn will predict contaminant concentration fields for all time steps t at once in addition only some sparse data points and collocation points from all t time steps are collected to calculate the residuals of the governing equation to impose the physical constraints for tgfcnn 3 case studies in this section we test the performance of tgfcnn with several contaminant transport problems under different conditions we construct four surrogate models respectively for these scenarios estimating the initial release location and concentration without additional injection under a known k field estimating the location injection concentration and duration of the short term source under a known k field estimating the location and injection concentration of the long term source under a known k field and estimating the location and injection concentration of the long term source and unknown k fields the accuracy of tgfcnn is compared with the traditional data driven cnn to elucidate the effect of theory guidance it is worth noting that the structure and setup of tgfcnn and cnn are the same i e the only difference is the existence of theory guidance in cases 1 3 we consider an ideal situation in which the k field as shown in fig 2 and thus the flow field are already known therefore λpde1 in cases 1 3 is set to be 0 the studied domain is a 310 l 610 l rectangle which is discretized uniformly into 32 62 grids with δx δy 10 l herein k x y is generated by employing karhunen loeve expansion kle in the kle method a random field lnk x τ can be expressed as wang et al 2020b 22 l n k x τ l n k x τ l n k x τ where x d physical domain τ θ probability spaces l n k x τ denotes the mean of lnk and lnk x τ denotes the fluctuation the symmetric bounded and positive definite covariance clnk x x lnk x τ lnk x τ can describe the spatial structure of lnk x τ which can be further decomposed as ghanem and spanos 2003 23 c l n k x x i 1 λ i f i x f i x the eigenvalue λ i and eigenfunction fi x y can be obtained from the second type fredholm equation wang et al 2020b 24 d c l n k x x f x λ f x then eq 22 can be represented as wang et al 2020b 25 l n k x τ ln k x i 1 λ i f i x ξ i τ where ξ i τ denotes orthogonal gaussian random variables moreover eq 25 can be truncated into n terms to decrease the dimension of random variables ξ i τ thus eq 25 can be rewritten as wang et al 2020b 26 l n k x ln k x n i 1 λ i f i x ξ i τ the correlation length along the x axis is 122 l and 62 l along the y axis which are both 0 2 times the length of corresponding sides the mean of lnk is set to be 2 and the variance is 1 0 60 energy has been kept in the kle method in case 4 a more complex situation is considered i e the k fields are unknown in the simulation process eq 7 is first solved to obtain a steady flow field by utilizing the simulation software modflow which will not be influenced by the release of contaminant the left and right sides are set to be the entrance and the exit of the flow field respectively taking the boundary conditions as h x 0 40 l and h x 610 0 l the upper and lower boundaries are set to be impervious eq 8 is then solved to determine the transport process of contaminant by utilizing the simulation software mt3dms zheng and wang 1999 the porosity θ is set to be 0 3 the dispersivity α l is set to be 10 α t is set to be 1 and the effective molecular diffusion coefficient d is negligibly small the duration is set to be 360 t the time step is 6 t the architecture of tgfcnn is fixed as shown in table 1 in table 1 chin is the channel number of the input layer which can be determined according to different conditions for example if the location intensity and duration of the contaminant source are considered in a case the channel number in the surrogate model can be set to be 7 comprising the x coordinate and y coordinate of the grid information of the time step the hydraulic conductivity field and the location intensity and duration of the contaminant source the activation function used in each layer is leakyrelu to avoid vanishing gradient adam kingma and ba 2015 is chosen as the optimizer the learning rate is set to be 0 0001 the neural networks will be trained through 2000 epochs the xavier uniform initialization method is used to initialize the weights of neural networks and the biases are set to be 0 initially the models are built based on the pytorch framework which is a commonly used deep learning python package paszke et al 2017 a nvidia geforce rtx 2080 ti gpu is used to perform the training process 3 1 case 1 estimating the initial release location and concentration of contaminant without additional injection under a known k field in this subsection we assume that there is no source of contaminant in the flow field i e q s c s k 0 and only a small area of the domain has contaminants of a certain concentration at the initial moment a surrogate model is built to estimate the initial release location and concentration of the contaminant the range of the initial contaminated area is set to be a 3 3 matrix the prior value range and reference values of the matrix center point coordinates and concentration are shown in table 2 it is worth noting that the x and y coordinates are divided by the grid length 10 to balance the magnitude of the parameters tgfcnn and cnn are utilized to construct surrogate models for different initial contaminant locations and strength the inputs of surrogate models comprise x coordinate y coordinate time step initial conditions release location and initial strength and known k field to provide more field information to improve the accuracy of prediction these two surrogate models are trained with 100 realizations in addition 496 16 31 data points and 1891 collocation points are extracted through the entire time steps including the initial time step i e 61 time steps in each realization amounting to 30 256 i e 496 61 time steps data points and 115 351 i e 1891 61 time steps collocation points the training time of the tgfcnn model is approximately 7 and 6 h for the cnn model root mean square error rmse and r 2 score are employed to estimate the performance of the trained surrogate models rmse and r 2 score are defined as follows 27 rmse 1 n i 1 n u p r e i u r e f i 2 28 r 2 1 i 1 n u p r e i u r e f i 2 n 1 n u r e f i u r e f 2 where n is the total number of observation points u p r e i denotes the i th prediction value u r e f i denotes the ith reference value and u r e f is the mean of uref we input a new group of initial release locations and concentrations of contaminant under the known k field to compare the performance of these two models and the reference values are solved with mt3dms some predicted snapshots of the contaminant concentration field from the tgfcnn surrogate model are shown in fig 3 and some predicted snapshots from the cnn surrogate model are presented in fig 4 it can be seen that errors of the cnn surrogate model are more pronounced than those of the tgfcnn surrogate model especially where no data points are extracted the predictions of the tgfcnn surrogate model are more in line with physical equations and obvious outliers are not likely to appear in the predicted values these two figures show that the physical constraints can assist to reduce the approximation errors effectively the tgfcnn surrogate model can still predict results with high accuracy when the inputted initial release locations and concentrations of contaminant are not trained the results indicate the strong generalization and extrapolation ability of tgfcnn for further comparison of the performance between tgfcnn and cnn surrogate models we calculate the mean r 2 score and rmse of predictions from the two surrogate models for 100 new realizations with different initial contaminant locations and concentrations the histograms of r 2 score and rmse are presented in fig 5 information of input number of training realization the mean and variance of r 2 score and rmse of predictions are summarized in table 3 the histograms of r 2 score and rmse also show the superior accuracy of the tgfcnn surrogate model compared with the cnn surrogate it can also be seen that the physical constraints are of great use to improve the performance of surrogate models we also fixed the number of collocation points and trained the tgfcnn surrogate model with a different number of data points and training realizations to further study the effect of data points on the accuracy of surrogate models the mean r 2 score and mean rmse for surrogate models are shown in fig 6 the performance of the cnn surrogate model varies significantly with the number of data points and training realizations this is because the cnn surrogate model is trained in a purely data driven manner and less data means less information to be learned with the assistance of physical constraints the performance of the tgfcnn model is more stable even in the absence of data points tgfcnn can obtain satisfactory results by merely obeying the governing equation without actually solving it while this is impossible for the data driven cnn the results above illustrate the satisfactory performance of the tgfcnn surrogate model it can then be further utilized to solve the inverse problems by combining it with the ies algorithm here we would like to estimate the location and initial concentration of the contaminant source with observation data the contaminant concentration data of 12 randomly selected observation points at the last 20 time steps are collected as observations and used for parameter estimation fig 7 shows the locations of these selected observation points it is worth noting that only the information of c fields is used to estimate unknown parameters in these four cases in the ies we firstly generate 200 groups of random variables i e the x and y coordinates and the strength of the initial released contaminant as initial parameters which will be updated during the iteration the iteration number is set to be five the updating processes of these three unknown parameters by employing the tgfcnn surrogate model and simulator are shown in fig 8 and the estimated results are presented in table 3 fig 8 and table 4 indicate that as the iteration progresses the parameters of the tgfcnn surrogate model and the simulator gradually converge to the reference value at the end of each iteration the updated parameters can be inputted into the simulator to calculate the rmse with the observation data the convergence process of rmse during the iteration is displayed in fig 9 these results demonstrate the effectiveness and accuracy of the tgfcnn surrogate based ies method the time consumed during the iteration is shown in fig 10 and it can be seen that the consumed time using simulator ies for one iteration is much larger than that of five iterations using tgfcnn ies therefore under the premise of ensuring accuracy the tgfcnn surrogate model can effectively reduce time consumption for estimation of the initially released contaminant location and concentration 3 2 case 2 estimating the location injection concentration and duration of the short term source under a known k field in this case we assume that there is a short term 3 3 matrix of the contaminant source in the flow field and the duration of this source is t t 60 the inputs of surrogate models consist of x and y coordinates time step duration of source initial conditions location and strength of the injection source and k field the value range and reference values of the parameters about the matrix center point are presented in table 5 similar to case 1 100 realizations are solved with simulators and used as labeled data to train tgfcnn and cnn surrogate models 30 256 labeled training data and an additional 102 660 collocation points are extracted through the entire time span to train the tgfcnn model and the cnn surrogate is trained only with the labeled data the consumed time of training the tgfcnn model and cnn model is approximately 7 and 6 h respectively after training 100 new realizations are predicted with tgfcnn and cnn surrogate models to test the performance snapshots of one selected contaminant concentration field at time step 20 40 and 60 from tgfcnn and cnn surrogate models are presented in appendix a1 and a2 respectively the histograms of r 2 score and rmse for the predictions from the two surrogate models are shown in fig 11 the r 2 score histogram of tgfcnn is closer to 1 and the rmse histogram is closer to 0 indicating that the performance of the tgfcnn surrogate model is more accurate than that of cnn this case shows that the tgfcnn model is more stable and accurate than the traditional cnn model when facing more complex situations demonstrating the satisfactory extrapolation and generalization ability of the tgfcnn model information of input number of training realization the mean and variance of r 2 score and rmse of predictions are summarized in table 6 the tgfcnn surrogate model can then be used to solve the inverse problem in combination with the ies method the sampling method of observation data is the same as that in case 1 the iteration number is set to be five moreover 200 groups of parameters are generated and updated during the iteration the simulator based ies method is used as a contrast experiment the updating processes of the four unknown parameters with the tgfcnn surrogate model and simulator are shown in fig 12 the estimated results are presented in table 7 the convergence process of rmse during the iteration is shown in fig 13 it can be seen that as the iteration progresses the four parameters gradually converge to the reference values and the overall rmse gradually decreases the tgfcnn surrogate based ies method is shown to estimate unknown parameters efficiently 3 3 case 3 estimating the location and injection concentration of the long term source under a known k field in this case we assume that there is a 3 3 matrix of contaminant source in the flow field and the duration of this source is 60 time steps the values range and reference values of the parameters about the matrix center point are shown in table 8 the inputs of surrogate models consist of x coordinate y coordinate step information initial conditions location and strength of the injection source and the known k field the number and sampling method of data points and collocation points are the same as those in case 1 tgfcnn and cnn surrogate models are trained with 100 realizations the consumed time of training the tgfcnn surrogate is approximately 6 5 h and approximately 6 h for the cnn surrogate after training 100 new realizations are predicted with tgfcnn and cnn surrogate models to test their performance input number of training realization the mean and variance of r 2 score and rmse of predictions are summarized in table 9 snapshots of one selected contaminant concentration field at time step 20 40 and 60 for tgfcnn and cnn surrogate models are presented in appendix b1 and b2 respectively as contaminants are injected for a long period of time the concentration of the contaminant keeps increasing consequently the data deviation between each time step will gradually become larger it is difficult for the data driven cnn model to learn this data deviation whereas tgfcnn can still predict the contaminant transport well with the assistance of theory guidance similar to the previous two cases we calculate the r 2 score and rmse of predictions from surrogate models for 100 new realizations and the histograms are presented in fig 14 it is obvious that the performance of tgfcnn is superior to that of cnn the tgfcnn surrogate model is then ultilized to solve the inverse problem the updating processes of the three unknown parameters with tgfcnn ies and simulator ies are shown in fig 15 the estimated results of the parameters are presented in table 10 the rmse convergence processes of the parameters are shown in fig 16 it can be seen that both the results of simulator ies and tgfcnn ies converge to the reference values indicating the effectiveness of the tgfcnn surrogate based ies for estimating the location and injection concentration of the long term contaminant source the results demonstrate the generalization ability of the tgfcnn model 3 4 case 4 estimating the location and injection concentration of the long term source and unknown k fields the same as in case 3 the contaminant source is still set to be a 3 3 matrix in the flow field and the duration of this source is 60 the values range and reference values of the parameters about the matrix center point are same as those in case 3 however the k fields fig 17 and thus the flow fields are unknown which increases the difficulty of constructing surrogate models especially for data driven models the mean of training lnk is set to be 2 and the variance is 1 0 the correlation length along the x axis and y axis are 122 l and 62 l respectively the left boundary is set to be 40 l in order to obtain seepage vx and vy and further calculate eq 20 two surrogate models are constructed to predict h fields and c fields respectively the structure of these two models are the same as in previous cases the input of the surrogate model for h fields consists of x coordinate y coordinate and different k fields the input of the surrogate model for c fields consists of x coordinate y coordinate step information initial conditions location and strength of the injection source vx and vy the number and sampling method of points are the same as those in case 1 firstly the surrogate models for h fields are trained with 100 labeled realizations and 900 virtual realizations without any labeled data to strengthen the effect of theory guidance the consumed time of training the tgfcnn surrogate is approximately 35 h and approximately 1 3 h for the cnn surrogate after training 100 new untrained k fields are inputted into the surrogate models for h fields the histograms of r 2 score and rmse for the 100 new predicted h fields from the two surrogate models are shown in fig 18 the predictions from the tgfcnn surrogate model can match the reference better than those from the cnn surrogate model due to the assistance of theory guidance input number of training realization the mean and variance of r 2 score and rmse of predicted h fields are summarized in table 11 furthermore the generalization and extrapolation performance of the surrogate models for h fields have been estimated firstly the left boundary condition is fixed to be 40 l and some k fields with the mean of lnk to be 1 and the variance to be 0 5 are inputted into the surrogate models secondly the left boundary condition of flow field has been changed to 50 l with the mean of lnk to be 2 and the variance to be 1 in fig 19 the prediction of h fields exhibits high accuracy from the tgfcnn surrogate model even though the changed k fields and boundary condition were not learned in the training process these results demonstrate the effectiveness of theory guidance and the strong generalization and extrapolation ability of the tgfcnn surrogate model the surrogate models for c fields are trained subsequently by inputting seepage vx and vy which can be obtained from predicted h fields 100 labeled and 900 virtual realizations have been used to train these models the consumed time of training the tgfcnn surrogate and cnn surrogate is approximately 40 h and 4 h respectively after training 100 new untrained k fields are inputted into the surrogate models for h fields to obtain seepage vx and vy then the vx and vy are inputted into the surrogate models for c fields to predict the contaminant transport snapshots of one selected c field at time step 20 40 and 60 from tgfcnn and cnn surrogate models are presented in appendix c1 and c2 respectively the histograms of r 2 score and rmse for the 100 new predicted c fields are shown in fig 20 information of input number of training realization the mean and variance of r 2 score and rmse of predicted c fields are summarized in table 12 to further evaluate the generalization and extrapolation performance the obtained seepages vx and vy based on h fields of fig 19 are subsequently inputted into the surrogate for c fields fig 21 displays the correlation between the prediction and reference the predictions of the tgfcnn surrogate model and reference values converge closer to the line y x compared to those of the cnn surrogate model in the ies method the sampling method of observation data is same as that in case 1 the location and strength of the contaminant source and the k field are needed to be estimated the iteration number is set to be 10 200 groups of parameters are initialized and updated during the iteration the simulator based ies method is used as a contrast experiment the updating processes of the location x y and strength of the contaminant source are presented in fig 22 the estimated parameters and k fields are shown in table 13 and fig 23 respectively the rmse of the estimated k field is 0 0801 in the ies method based on the tgfcnn surrogate model and 0 0993 based on the simulator during the iteration process the k field and parameters gradually converge to reference values therefore the rmse of the predicted c field decreases correspondingly the decreasing process of rmse of observation points during the iteration is shown in fig 24 the simliar estimated results demonstrate the accuracy and effectiveness of the proposed tgfcnn framework moreover the surrogate model for h fields could also be constructed with pinn raissi et al 2019 tgnn wang et al 2020b 2021b and weak form tgnn tgnn wf xu et al 2021 frameworks which all employ the fully connected neural network architecture pinn has been used for surrogate modeling of fluid flow problems governed by navier stokes equations by sun et al 2020a and achieves sufficient accuracy tgnn also achieves satisfactory performance for surrogate modeling of subsurface flow problems with different k fields tgnn wf can further improve the robustness of the tgnn framework by incorporating the weak form of the governing equation as physical constraints consequently these mentioned frameworks can be combined with the tgfcnn based surrogate model for c fields to solve the inverse problem in a hybrid scheme however it may be difficult for nn based algorithms to learn the convection dispersion equation and predict c fields due to their point to point learning scheme this is because the c fields have strong localized features which can be seen as images in contrast tgfcnn can extract local information better due to its convolutional scheme in addition the k fields can be inputted into the tgfcnn as images directly which need to be parameterized with the kle method prior to being inputted into tgnn as compared in wang et al 2021a 4 discussion and conclusion in this study the theory guided full convolutional neural network tgfcnn is proposed for inverse problems in contaminant transport problems in tgfcnn we incorporate physical constraints into the loss function to improve the performance of cnn tgfcnn is not only trained with sparse data points from simulation but also guided by physical theories i e governing equations compared to traditional cnn models the theory guidance allows tgfcnn to achieve superior accuracy therefore the tgfcnn surrogate can be combined with the iterative ensemble smother ies for inverse modeling in contaminant transport problems the performance of the proposed tgfcnn based ies is tested in four cases both the tgfcnn surrogate model and the cnn surrogate model are trained for comparison the generalization and extrapolation performance of tgfcnn has been evaluated through changing the boundary condition and k fields the results demonstrate that the tgfcnn surrogate model possesses better prediction and generalization ability than the conventional cnn surrogate model we then employed the trained tgfcnn surrogate model and ies to solve inverse problems as the iteration progresses the parameters to be solved gradually converge to the reference values and the rmse between the observation data and predictions gradually decreases moreover the consumed time of tgfcnn ies for inversion is markedly shorter than that of simulator ies therefore it is more efficient to use the tgfcnn surrogate model for solving inverse problems in surface contaminant transport although the structure of tgfcnn is simple the results demonstrate the high accuracy and efficiency of tgfcnn in contaminant transport problems the proposed tgfcnn model provides an efficient way for solving problems with strong localized features i e learning localized features through the cnn structure and improving the prediction accuracy by constraining the network with governing equations the tgfcnn is however developed for and demonstrated with 2d problems wang et al 2021c pointed out the potential of cnn based methods for 3d pore scale imaging and modeling the tgfcnn may be extended for more complex governing equations and modeling 3d convection dispersion of contaminants credit authorship contribution statement tianhao he conceptualization methodology writing original draft writing review editing nanzhe wang software data curation visualization investigation dongxiao zhang conceptualization methodology writing original draft writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is partially funded by the shenzhen key laboratory of natural gas hydrates grant no zdsys20200421111201738 and the sustech qingdao new energy technology research institute appendix appendix a in this case we assume that there is a short term 3 3 matrix of contaminant source in the flow field and the duration of this source is t t 60 after training 100 new realizations are solved with the simulator as a reference and predicted with tgfcnn and cnn surrogate models to test the performance snapshots of one selected contaminant concentration field at time step 20 40 and 60 from tgfcnn and cnn surrogate models are presented in figs a1 and a2 respectively appendix b in this case we assume that there is a 3 3 matrix of contaminant source in the flow field in entire 60 time steps snapshots of one selected contaminant concentration field at time step 20 40 and 60 for tgfcnn and cnn surrogate models are presented in figs b1 and b2 respectively appendix c in this case the contaminant source is still set to be a 3 3 matrix in the flow field and the duration of this source is 60 different from case 3 the k fields and thus the flow fields are unknown which increases the difficulty of constructing surrogate models especially for data driven models snapshots of one selected contaminant concentration field at time step 20 40 and 60 for tgfcnn and cnn surrogate models are presented in figs c1 and c2 respectively 
236,subsurface barriers are often used to mitigate the spread of contaminants in groundwater current methods typically involve the injection of slurries into aquifers a process that clogs porosity and reduces hydraulic conductivity an alternative way to achieve this effect in calcareous aquifers could be to inject a fluid that dissolves the existing carbonate minerals and induces the formation of phases that have higher molar volumes while such mineral replacement reactions are known to affect hydraulic conductivity their ability to impede contaminant transport has not been tested in this study we injected oxalic acid into a pseudo 2d flow through cell containing calcitic sand which simulated a calcareous aquifer the oxalic acid causes the dissolution of calcite as well as the precipitation of calcium oxalate minerals in a reaction zone that spreads out from the point of injection we found that this process reduces the water discharge in the cell by up to 80 and caused the flow velocity around the reaction zone to drop from 20 cm h 1 to 0 1 cm h 1 mineralogical analyses and electron microscopy indicate that permeability is reduced primarily by partitioning of the intergranular voids by micrometer sized calcium oxalate crystals our results suggest that coupled dissolution precipitation reactions could be a feasible method for deploying subsurface barriers in aquifers graphical abstract image graphical abstract keywords groundwater calcium oxalate calcite porous media porosity 1 introduction all shallow aquifers are sensitive to pollution from agricultural industrial and urban sources one of the main strategies for dealing with aquifer contamination is treating the water to reduce the level of contaminants this is achieved by both ex situ methods e g pump and treat and in situ techniques including permeable reactive barriers and vapor stripping gvirtzman et al 1992 roehl et al 2005 maitra 2019 sharma et al 2020 however an alternative strategy for coping with subsurface contaminants is to isolate the contaminated region from the rest of the aquifer ross and beljin 1998 kashir and yanful 2000 katsumi et al 2008 such a method is usually employed when treatment is not economically viable or when a combined approach to mitigate the effects of pollution is required the isolation of a polluted zone is typically achieved by creating barriers to fluid flow in the subsurface that effectively separate the polluted zone from the uncontaminated part of the aquifer subsurface barriers are often formed by injecting a slurry of inorganic phases such as bentonite clay and cementitious materials into the aquifer kui et al 2019 these inorganic materials cause occlusion of the pore space in the aquifer rock which significantly reduces the permeability evans and huang 2016 evans et al 2020 however the durability of barriers formed from these materials is low and their deterioration over time can result in secondary contamination of the aquifer and additional costs opdyke et al 2005 abbaslou et al 2016 kui et al 2019 an alternative approach to creating flow barriers may be possible in carbonate aquifers which provide potable water to more than 25 of the world s population kalhor et al 2019 the minerals that comprise carbonate aquifers typically calcite aragonite and dolomite are relatively reactive morse et al 2007 and their controlled in situ dissolution coupled with the precipitation of new minerals possessing higher molar volumes can lead to the occlusion of porosity pollok et al 2011 this porosity reduction has the potential to lower the hydraulic conductivity in the aquifer leading to the formation of subsurface barriers fig 1 the use of coupled dissolution precipitation reactions could have two important advantages over existing methods first the method does not require the excavation of deep trenches and can potentially be used at greater depths and even in confined aquifers second the fluid being injected has a low viscosity similar to that of water so that it can potentially penetrate effectively into the host rock coupled dissolution precipitation reactions have been shown to be effective in altering the permeability of calcareous rocks singurindy and berkowitz 2003 examined the changes in hydraulic conductivity in a carbonate rock core injected with sulfuric acid the dissolution of calcite and the precipitation of gypsum led to a range of behaviors including clogging wormhole formation and oscillations in the hydraulic conductivity that resulted from the competition between dissolution and precipitation at different h so4 2 ratios and flow rates similar complex behavior has been reported during experiments involving the reaction of carbonate rocks with a range of reactive fluids e g polak et al 2004 singurindy et al 2005 elkhoury et al 2015 garcia rios et al 2015 menefee et al 2020 while such studies indicate that coupled dissolution precipitation reactions might provide a way to create resilient barriers in carbonate aquifers most experiments have been carried out on 1d flow through cores as a result relatively little is known about how such reactions alter porosity and flow patterns under simulated aquifer conditions and if such barriers are effective in preventing the dispersion of contaminants here we use pseudo 2d laboratory experiments to simulate mineral replacement during injection of a reactive fluid into a calcareous aquifer we demonstrate how coupled dissolution precipitation reactions affect fluid discharge under different experimental conditions and explore the impact on solute transport in addition we discuss the implications of our results for the application of such methods in real world settings 2 methods 2 1 coupled dissolution precipitation reactions for our model system we chose the reaction between calcite caco3 and oxalic acid h2c2o4 which produces 2 kinds of calcium oxalate minerals wadsten et al 1985 giordani et al 2003 monohydrate whewellite cac2o4 h2o and dihydrate weddellite cac2o4 2h2o the reaction is relatively rapid at standard temperature and pressure taking hours to days to reach completion in addition calcium oxalate is both nontoxic and highly insoluble doherty et al 2007 ruiz agudo et al 2013 the coupled dissolution precipitation reaction can be described as a 2 step process 1a cac o 3 s 2 h aq c a 2 aq h 2 o l c o 2 g 1b c a 2 aq c 2 o 4 2 aq n h 2 o l ca c 2 o 4 n h 2 o s during the first step calcite dissolves to release ca ions while at the second step oxalate ions combine with the released ca ions to form calcium oxalate minerals crucially the molar volume of caco3 vmcaco3 is 37 cm3 mol 1 while the molar volumes of whewellite and weddelite are 66 cm3 mol 1 and 84 cm3 mol 1 respectively thus for a stoichiometric reaction the change in molar volume δvm is 29 cm3 mol 1 for whewellite cezar 1998 king et al 2014 and and 47 cm3 mol 1 for weddelite 2 2 experimental set up to simulate injection of an oxalic acid solution into a phreatic carbonate aquifer a pseudo 2 dimensional laboratory scale system was contructed fig 2 the model consisted of a plexiglass rectangular tank 30 cm wide 25 cm high and 4 cm deep that was divided into three cells separated by a dense permeable mesh the central cell was filled to a depth of 13 cm with carbonate sand derived from ground limestone from the aminadav formation near jerusalem the rocks were ground using a jaw crusher and disk pulverizer and sieved to create a uniform grain size in our experiments two different grain sizes were used 420 850 μm and 180 420 μm and the measured porosity for the two types of sand was 55 and 45 respectively each side of the central cell was filled with water so that constant hydraulic heads of 9 5 cm and 9 cm above the base of the cell were maintained for the left and right boundaries respectively this head difference caused water to flow continually from the left side of the cell to the right side a tube was inserted into the center of the cell and water was injected at a rate of 100 ml h 1 using a peristaltic pump after running the system for 12h the injected water was switched to an oxalic acid solution made by diluting h2c2o4 99 8 analytical grade sdfcl with deionized water in our experiments three different concentrations were tested 1m 0 1m and 0 01m in total ten experiments were conducted and a summary of the experimental conditions are shown in table 1 during the experiment the outlet discharge from both the lower head cell and the higher head cell was measured using calibrated rain gauges and recorded using a digital data logger onset hobo pendant measurement of the outlet from the high head cell was used for validation in all of the experiments with the 420 850 μm sand the initial discharge was relatively constant at 660 ml h 1 10 prior to acid injection in the 180 420 μm sand the initial discharge was smaller 130 186 ml h 1 which is consistent with its lower permeability the initial hydraulic conductivity was estimated from the discharge and hydraulic gradient across the cell using darcy s law bear 1979 freeze et al 1979 2 q ak δ h l where q is the discharge of water in a homogeneous medium k is the hydraulic conductivity of the medium a is the cross sectional area 36 cm2 δh is the hydraulic head gradient and l is the distance between the two heads 30 cm the estimated hydraulic conductivities are in the range 2 1 10 3 2 5 10 3 m s 1 for the experiments carried out with 420 850 μm size grains and 4 5 10 4 6 6 10 4 m s 1 for the simulations conducted with 180 420 μm size grains these values are consistent with those reported in literature bear 1972 2 3 image acquisition and processing to visually track the spatial extent of the mineral replacement in each experiment the medium was photographed every hour using a mobile phone camera samsung galaxy s5 16 mega pixels mounted on a tripod constant background lighting was maintained by enclosing the experiment in a photography light box fig 3 the calcium oxalate precipitate was bright white providing a good visual contrast with the beige colored limestone we used in our experiments fig 4 in several experiments we also used time lapse photography to track flow patterns by injecting blue food coloring directly into the cell this was carried out both before and after oxalic acid injection to calculate the spatial and temporal changes in porosity in one of the experiments 0 1m grain size 420 850 μm each color picture was converted to a grayscale image using matlab supplementary fig 3 this image was then turned into a binary image by using a thresholding algorithm with the ratio between the black pixels and the total number of pixels providing an estimate of the porosity a threshold value of 0 35 produced a good match with the direct measurement of the porosity for the carbonate sand using this approach porosity was estimated in four different regions each 2 5 2 5 cm2 within the cell 2 4 analytical methods after the termination of 2 of the experiments 0 1m h2c2o4 420 850 μm grain size and 1m h2c2o4 180 420 μm grain size samples were collected from the cells using a corer cores were taken from 5 cm downstream of the oxalic acid injection point and samples from the different heights were analyzed using x ray diffraction xrd d8 advance to determine mineral composition in addition high resolution images of the samples were obtained using light microscopy zeiss stereo discovery v8 and environmental scanning electron microscopy esem quanta 200 additionally in one experiment 0 1m h2c2o4 420 850 μm grain size water samples were collected at the outlet at 5 different times calcium ion concentrations were determined using inductively coupled plasma mass spectrometry icp ms agilent 7500cx 3 results and discussion 3 1 evolution and shape of the mineral reaction zone in all of the experiments a lighter colored region developed in the center of the cell surrounding the oxalic acid injection point in the experiment shown in fig 4 0 1m h2c2o4 420 850 μm grain size the replacement zone expands over time creating an asymmetric pattern that is skewed towards the downstream direction this pattern is consistent with the lateral transport of oxalic acid and its subsequent reaction in the direction of flow the rate at which the reaction zone increased was approximately constant during the experiment by the end of the experiment the reaction zone had spread to 52 of the model aquifer s cross section extending to the base of the model and to the downstream boundary in the experiments in which the reaction zone reached the downstream boundary a white precipitate began to accumulate outside of the porous medium in the downstream constant head cell supplementary fig 1 electron microscopy and xrd analysis revealed that the precipitate comprised whewellite crystal aggregates 5 20 μm in size this fine particulate matter most likely forms within the porous medium and is transported through the cell to the outlet the concentration of h2c2o4 in the injected fluid had a significant effect on the shape of the replacement zone fig 5 in the 1m oxalic acid experiments fig 5a b the reaction zone extended from the base of the cell to top of the cell and reached both side boundaries in addition narrow channels 0 5 cm wide formed in the upper section of the porous medium as a result of the release of co2 during calcite dissolution by contrast in the 0 1m oxalic acid experiments no channels were observed and the extent of the reaction zone was more limited both laterally and vertically fig 5c d although distinct reaction zones were still visible at the lowest concentration we tested 0 01m the visible extent of reaction was relatively restricted covering only 6 of the cell fig 5e grain size also had a significant impact on the spatial pattern of reaction in the fine grain experiments 180 420 μm the reaction zone had a more limited lateral extent than in the coarse grain experiments fig 5 this is most likely a result of the lower flow rate in the lower permeability system and the subsequent slower rate of transport of both dissolved oxalic acid and calcium oxalate particles thus in low permeability aquifers the reaction zone could be highly localized 3 2 calcium oxalate content in reacted cells electron microscopy shows that as a result of reaction calcium oxalate builds up on the surfaces of the grains to form a non uniform coating of 1 5 μm size crystals fig 6 in addition the pore network is also filled with fine granular material supplementary fig 2 the size of the calcium oxalate grains is similar to that found in the outlet which is consistent with their mobilization and transport through the pore network from the xrd analyses the core from the experiment carried out at the highest oxalid acid concentration and highest permeability h2c2o4 1m and 420 850 μm grain size shows an estimated 56 9 calcium oxalate content of which 1 is weddellite and the rest is whewellite at the base fig 7 a the calcium oxalate content drops to 37 9 in the top part of the reaction zone surprisingly in the uppermost sample located in the unsaturated zone the calcium oxalate content was 30 our experiments also revealed that lower oxalic acid concentrations led to lower calcium oxalate contents the analysis of the core sampled in an experiment carried out at 0 1m h2c2o4 showed that the maximum calcium oxalate content in the reaction zone was only 19 9 fig 7b visual inspection of the experiment indicates the presence of oxalate above the saturated zone although the xrd analysis did not detect the presence of oxalate minerals in the uppermost sample in the core the efficiency of the reaction ƞ defined here as the molar proportion of calcium carbonate converted into oxalate minerals can be calculated using the following equation 3 η wt caox m caox wt cac o 3 m cac o 3 wt caox m caox where wt caox is the mass fraction of calcium oxalate wt caco3 is the mass fraction of calcite mcaox is the molar mass of calcium oxalate 128 1 g mol 1 and mcaco3 is the molar mass of calcite 100 1 g mol 1 using the estimated mass fractions from the xrd data the maximal efficiency of the replacement reaction is 50 in the 1m oxalic acid experiment and 16 in the 0 1m experiment the persistence of a significant proportion of the initial calcite even at the highest concentration of h2c2o4 could be due to an armoring effect that creates an impermeable coating around the carbonate grains effectively shutting down further reaction the armoring mechanism is consistent with the way the ca concentrations in the outlet effluent change with time fig 8 during the initial stage of the experiment carried out at 0 1 m h2c2o4 and 420 850 μm grain size ca concentrations increase from 4 ppm to 72 ppm in the first six hours this corresponds to an initial stage of dissolution of calcite during which the reaction is not entirely stoichiometric i e not all the calcium ions released during calcite dissolution become incorporated into the calcium oxalate phases however after 48 hours the concentration drops to 1 ppm probably reflecting a significant reduction in the rate of calcite dissolution the ca concentrations also provide an indication of the degree to which dissolution is incongruent the difference δ between the total amount of calcium that was released as a result of calcite dissolution and the amount that precipitates as a result of calcium oxalate formation can be estimated using the following equation 4 δ t 0 t t q t c t dt where q t is the time dependent discharge at the outlet c t is the ca concentration and t is the time at which the experiment is terminated numerical integration of equation 4 using the experimental data produces a value of 0 88 g or 0 022 mol of dissolved ca this value can be compared with the amount of ca bound to oxalate minerals at the end of the experiment which we estimated from the volume of the reaction zone 800 ml the proportion of ca oxalate 18 according to xrd the bulk density of the porous medium 1 15 g ml 1 and the molecular mass of whewellite 146 g mol 1 this yields a value of 1 13 mol ca which indicates that less than 2 of the calcium released during calcite dissolution leaves the system in dissolved form 3 3 impact of mineral replacement on discharge and flow patterns injection of dye into the porous matrix revealed that the flow was significantly slowed in the region surrounding the reaction zone in the experiment shown in fig 9 carried out at 0 1 m h2c2o4 in the high permeability medium 420 850 μm the lateral intersticial velocity was 20 cm h 1 prior to oxalic acid injection by contrast after 3 days of reaction the velocity is estimated to be 0 1 cm h 1 during the period of observation the dispersion of dye through the reaction zone was barely discernible indicating that the oxalate replacement zone represented an effective barrier to the transport of solutes importantly the dye we injected gives an indication of the intersticial fluid velocity and simulates the transport of an inert contaminant however heavy metals and organic compounds are often sorbed onto mineral surfaces in limestones e g wefer roehl et al 2001 sdiri and higashi 2013 and their effective transport through the barrier could be significantly slower than the rate we observed after the initiation of acid injection discharge decreased significantly in all the high permeability experiments 420 850 μm grain size in the experiment shown in fig 10 1m h2c2o4 2 main stages can be seen during the first 15 hours of acid injection discharge decreased rapidly at a non uniform rate from 640 to 316 ml h 1 at later times the discharge stabilized at a value of approximately 310 ml h 1 the initial stage of the experiment is attributed to the reduction in hydraulic conductivity caused by the dissolution precipitation reaction while the second stage is consistent with the cessation of the replacement reaction moreover the observation that the discharge is stable for over 30 hours suggests that the reduced hydraulic conductivity is a persistent feature of the system the two stages of initial reduction in discharge and the stabilization of discharge were also observed during the intermediate oxalic acid concentration 0 1m experiments but the changes occurred much more gradually fig 11 a despite very different levels of measured calcium oxalate the overall reduction in discharge 70 was similar to that observed in the 1m h2c2o4 experiments by contrast at the lowest oxalic acid concentration 0 01m no significant changes in discharge were observed to facilitate the description of the effect of oxalic acid concentration on the rate of change in the systems we define t1 2 as the time required for the fluid discharge to drop to less than 50 of the initial value thus in the experiments with coarse sand the average value for t1 2 is 9 7 h at 1m 33 5 h at 0 1m and 72 h at 0 01m in the low permeability experiments 180 420 μm grain size a significant reduction in discharge was also observed although the decline was slower than in the high permeability experiments fig 11b moreover in the low permeability experiments the discharge did not reach a stable value suggesting that the replacement reaction did not reach completion in addition the overall reduction in discharge 40 during the low permeability experiments was also smaller than in the high permeability experiments however rather than reflecting a smaller reduction in hydraulic conductivity this is likely to be because the constant rate of fluid injection 100 ml h 1 represented about 50 75 of the initial discharge in the low permeability experiments 3 4 porosity evolution and reaction efficiency the results from the image analysis method for estimating porosity fig 12 indicate that the rate of porosity reduction varies throughout the reaction zone as expected the initial rate of change is most rapid nearest the point of injection and becomes slower with increasing distance in the 3 locations within the reaction zone the method estimates the final porosity to be approximately 20 however this value is a significant underestimation of the total porosity because the method is unable to image the submicrometer scale voids within the calcium oxalate aggregates that fill the large intergranular voids nevertheless the method probably provides an indication of the porosity associated with large pores that are responsible for conducting most of the fluid flow the maximal effect of the reaction on porosity can be constrained by considering the changes occurring in a closed system in which the final porosity nfin in the reacting porous medium is affected by two main factors the reaction efficiency η defined in equation 3 and the initial porosity ninit this dependence can be expressed by the following equation 5 n fin η δ v m v m cac o 3 1 n init n init this equation predicts that in a calcareous aquifer with a porosity of 55 as was the case in our high permeability experiments the final porosity will be approximately 20 if all the calcium carbonate is replaced by calcium oxalate fig 13 however if the porous matrix has an initial porosity lower than 45 which is typical of the vast majority of carbonate aquifers the total occlusion of porosity is theoretically possible even when the efficiency is significantly lower than 100 our experiments indicate that even a small reduction in porosity can induce profound changes in permeability for example in the experiment shown in fig 9 the maximum efficiency was only 16 corresponding to a porosity reduction of 5 nevertheless this change was enough to significantly impact flow and create an effective barrier to flow this effect is probably the result of the partitioning of large intergranular voids by the calcium oxalate crystals creating a network of micrometer size pores with a similar porosity but much lower permeability in addition heterogenous precipitation patterns at the pore scale may disrupt the connectivity between remaining large pores 4 conclusions we examined the impact of the replacement of calcium carbonate by calcium oxalate on flow in a model aquifer system and found that flow declined by as much as 80 furthermore imaging of flow patterns show that the reaction zone created an effective barrier to flow although not all the calcium carbonate in the system was replaced the newly formed calcium oxalate occluded intergranular porosity and reduced the permeability of the calcareous matrix before such mineral replacement reactions can be employed to contain groundwater contamination a number of issues need to be addressed first the differences between the experimental conditions and those encountered in real aquifers do not allow us to predict its efficacy in reducing permeability in the field carbonate aquifers frequently possess much lower permeabilities than the porous media we tested and they are often fractured rather than granular micro karstic features such as large pores or pore clusters create preferential pathways with high water fluxes that could both spread and dilute the reactants in addition in our experiments we did not explore the effects of temperature and pressure on reaction rates and system behavior this may be particularly important in deep aquifers that can experience relatively extreme physical conditions furthermore our system was pseudo 2d and involved a single injection point to use mineral replacement to contain a contaminant plume in a field setting a 3d array of injection boreholes would be required this means that complete sealing may be difficult to achieve particularly in thick aquifers so that the method may be more suitable for preventing the spread of light non aqueous phase liquids lnapls which float on the water table a limited field scale pilot could resolve some of these unknowns a second issue that needs to be addressed is the stability of the barrier and the potential impact of the method on water quality if the calcium oxalate precipitate is dissolved or mobilized over time not only will the effectiveness of the barrier be reduced but water quality in the uncontaminated aquifer might be compromised our experiments indicated that oxalate particles are mobilized during the formation dissolution precipitation process but it is unclear if these would be entrained and ultimately filtered out in a larger scale porous medium again a field scale pilot in which groundwater chemistry was monitored would provide answers to some of these issues one aspect of coupled dissolution precipitation reactions highlighted by the experiments is that modelling such systems in both laboratory and field settings is a non trivial task existing kinetic models do not account for the impact on reaction rates of the build up of insoluble mineral layers and such effects mean that rate equations at the continuum level which are required for darcy scale modelling become ad hoc clearly an accurate kinetic description of the chemical processes would provide a predictive capability of the dynamics of such systems and this is the focus of ongoing work in our lab despite the limitations of the present study our results indicate that coupled dissolution precipitation reactions represent a potential pathway for creating subsurface barriers moreover such replacement reactions could be used not only in calcareous aquifers but in aquifers with other kinds of lithologies too future experiments focusing on other types of rocks and geochemical reactions could point the way to new and effective methods for creating subsurface barriers for managing contaminated aquifers credit authorship contribution statement anat cohen methodology investigation writing original draft visualization roni grayevsky investigation yoni israeli conceptualization investigation simon emmanuel conceptualization methodology writing original draft supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the israel ministry of energy and the israel water authority are thanked for their generous financial support supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 104052 appendix supplementary materials image application 1 
236,subsurface barriers are often used to mitigate the spread of contaminants in groundwater current methods typically involve the injection of slurries into aquifers a process that clogs porosity and reduces hydraulic conductivity an alternative way to achieve this effect in calcareous aquifers could be to inject a fluid that dissolves the existing carbonate minerals and induces the formation of phases that have higher molar volumes while such mineral replacement reactions are known to affect hydraulic conductivity their ability to impede contaminant transport has not been tested in this study we injected oxalic acid into a pseudo 2d flow through cell containing calcitic sand which simulated a calcareous aquifer the oxalic acid causes the dissolution of calcite as well as the precipitation of calcium oxalate minerals in a reaction zone that spreads out from the point of injection we found that this process reduces the water discharge in the cell by up to 80 and caused the flow velocity around the reaction zone to drop from 20 cm h 1 to 0 1 cm h 1 mineralogical analyses and electron microscopy indicate that permeability is reduced primarily by partitioning of the intergranular voids by micrometer sized calcium oxalate crystals our results suggest that coupled dissolution precipitation reactions could be a feasible method for deploying subsurface barriers in aquifers graphical abstract image graphical abstract keywords groundwater calcium oxalate calcite porous media porosity 1 introduction all shallow aquifers are sensitive to pollution from agricultural industrial and urban sources one of the main strategies for dealing with aquifer contamination is treating the water to reduce the level of contaminants this is achieved by both ex situ methods e g pump and treat and in situ techniques including permeable reactive barriers and vapor stripping gvirtzman et al 1992 roehl et al 2005 maitra 2019 sharma et al 2020 however an alternative strategy for coping with subsurface contaminants is to isolate the contaminated region from the rest of the aquifer ross and beljin 1998 kashir and yanful 2000 katsumi et al 2008 such a method is usually employed when treatment is not economically viable or when a combined approach to mitigate the effects of pollution is required the isolation of a polluted zone is typically achieved by creating barriers to fluid flow in the subsurface that effectively separate the polluted zone from the uncontaminated part of the aquifer subsurface barriers are often formed by injecting a slurry of inorganic phases such as bentonite clay and cementitious materials into the aquifer kui et al 2019 these inorganic materials cause occlusion of the pore space in the aquifer rock which significantly reduces the permeability evans and huang 2016 evans et al 2020 however the durability of barriers formed from these materials is low and their deterioration over time can result in secondary contamination of the aquifer and additional costs opdyke et al 2005 abbaslou et al 2016 kui et al 2019 an alternative approach to creating flow barriers may be possible in carbonate aquifers which provide potable water to more than 25 of the world s population kalhor et al 2019 the minerals that comprise carbonate aquifers typically calcite aragonite and dolomite are relatively reactive morse et al 2007 and their controlled in situ dissolution coupled with the precipitation of new minerals possessing higher molar volumes can lead to the occlusion of porosity pollok et al 2011 this porosity reduction has the potential to lower the hydraulic conductivity in the aquifer leading to the formation of subsurface barriers fig 1 the use of coupled dissolution precipitation reactions could have two important advantages over existing methods first the method does not require the excavation of deep trenches and can potentially be used at greater depths and even in confined aquifers second the fluid being injected has a low viscosity similar to that of water so that it can potentially penetrate effectively into the host rock coupled dissolution precipitation reactions have been shown to be effective in altering the permeability of calcareous rocks singurindy and berkowitz 2003 examined the changes in hydraulic conductivity in a carbonate rock core injected with sulfuric acid the dissolution of calcite and the precipitation of gypsum led to a range of behaviors including clogging wormhole formation and oscillations in the hydraulic conductivity that resulted from the competition between dissolution and precipitation at different h so4 2 ratios and flow rates similar complex behavior has been reported during experiments involving the reaction of carbonate rocks with a range of reactive fluids e g polak et al 2004 singurindy et al 2005 elkhoury et al 2015 garcia rios et al 2015 menefee et al 2020 while such studies indicate that coupled dissolution precipitation reactions might provide a way to create resilient barriers in carbonate aquifers most experiments have been carried out on 1d flow through cores as a result relatively little is known about how such reactions alter porosity and flow patterns under simulated aquifer conditions and if such barriers are effective in preventing the dispersion of contaminants here we use pseudo 2d laboratory experiments to simulate mineral replacement during injection of a reactive fluid into a calcareous aquifer we demonstrate how coupled dissolution precipitation reactions affect fluid discharge under different experimental conditions and explore the impact on solute transport in addition we discuss the implications of our results for the application of such methods in real world settings 2 methods 2 1 coupled dissolution precipitation reactions for our model system we chose the reaction between calcite caco3 and oxalic acid h2c2o4 which produces 2 kinds of calcium oxalate minerals wadsten et al 1985 giordani et al 2003 monohydrate whewellite cac2o4 h2o and dihydrate weddellite cac2o4 2h2o the reaction is relatively rapid at standard temperature and pressure taking hours to days to reach completion in addition calcium oxalate is both nontoxic and highly insoluble doherty et al 2007 ruiz agudo et al 2013 the coupled dissolution precipitation reaction can be described as a 2 step process 1a cac o 3 s 2 h aq c a 2 aq h 2 o l c o 2 g 1b c a 2 aq c 2 o 4 2 aq n h 2 o l ca c 2 o 4 n h 2 o s during the first step calcite dissolves to release ca ions while at the second step oxalate ions combine with the released ca ions to form calcium oxalate minerals crucially the molar volume of caco3 vmcaco3 is 37 cm3 mol 1 while the molar volumes of whewellite and weddelite are 66 cm3 mol 1 and 84 cm3 mol 1 respectively thus for a stoichiometric reaction the change in molar volume δvm is 29 cm3 mol 1 for whewellite cezar 1998 king et al 2014 and and 47 cm3 mol 1 for weddelite 2 2 experimental set up to simulate injection of an oxalic acid solution into a phreatic carbonate aquifer a pseudo 2 dimensional laboratory scale system was contructed fig 2 the model consisted of a plexiglass rectangular tank 30 cm wide 25 cm high and 4 cm deep that was divided into three cells separated by a dense permeable mesh the central cell was filled to a depth of 13 cm with carbonate sand derived from ground limestone from the aminadav formation near jerusalem the rocks were ground using a jaw crusher and disk pulverizer and sieved to create a uniform grain size in our experiments two different grain sizes were used 420 850 μm and 180 420 μm and the measured porosity for the two types of sand was 55 and 45 respectively each side of the central cell was filled with water so that constant hydraulic heads of 9 5 cm and 9 cm above the base of the cell were maintained for the left and right boundaries respectively this head difference caused water to flow continually from the left side of the cell to the right side a tube was inserted into the center of the cell and water was injected at a rate of 100 ml h 1 using a peristaltic pump after running the system for 12h the injected water was switched to an oxalic acid solution made by diluting h2c2o4 99 8 analytical grade sdfcl with deionized water in our experiments three different concentrations were tested 1m 0 1m and 0 01m in total ten experiments were conducted and a summary of the experimental conditions are shown in table 1 during the experiment the outlet discharge from both the lower head cell and the higher head cell was measured using calibrated rain gauges and recorded using a digital data logger onset hobo pendant measurement of the outlet from the high head cell was used for validation in all of the experiments with the 420 850 μm sand the initial discharge was relatively constant at 660 ml h 1 10 prior to acid injection in the 180 420 μm sand the initial discharge was smaller 130 186 ml h 1 which is consistent with its lower permeability the initial hydraulic conductivity was estimated from the discharge and hydraulic gradient across the cell using darcy s law bear 1979 freeze et al 1979 2 q ak δ h l where q is the discharge of water in a homogeneous medium k is the hydraulic conductivity of the medium a is the cross sectional area 36 cm2 δh is the hydraulic head gradient and l is the distance between the two heads 30 cm the estimated hydraulic conductivities are in the range 2 1 10 3 2 5 10 3 m s 1 for the experiments carried out with 420 850 μm size grains and 4 5 10 4 6 6 10 4 m s 1 for the simulations conducted with 180 420 μm size grains these values are consistent with those reported in literature bear 1972 2 3 image acquisition and processing to visually track the spatial extent of the mineral replacement in each experiment the medium was photographed every hour using a mobile phone camera samsung galaxy s5 16 mega pixels mounted on a tripod constant background lighting was maintained by enclosing the experiment in a photography light box fig 3 the calcium oxalate precipitate was bright white providing a good visual contrast with the beige colored limestone we used in our experiments fig 4 in several experiments we also used time lapse photography to track flow patterns by injecting blue food coloring directly into the cell this was carried out both before and after oxalic acid injection to calculate the spatial and temporal changes in porosity in one of the experiments 0 1m grain size 420 850 μm each color picture was converted to a grayscale image using matlab supplementary fig 3 this image was then turned into a binary image by using a thresholding algorithm with the ratio between the black pixels and the total number of pixels providing an estimate of the porosity a threshold value of 0 35 produced a good match with the direct measurement of the porosity for the carbonate sand using this approach porosity was estimated in four different regions each 2 5 2 5 cm2 within the cell 2 4 analytical methods after the termination of 2 of the experiments 0 1m h2c2o4 420 850 μm grain size and 1m h2c2o4 180 420 μm grain size samples were collected from the cells using a corer cores were taken from 5 cm downstream of the oxalic acid injection point and samples from the different heights were analyzed using x ray diffraction xrd d8 advance to determine mineral composition in addition high resolution images of the samples were obtained using light microscopy zeiss stereo discovery v8 and environmental scanning electron microscopy esem quanta 200 additionally in one experiment 0 1m h2c2o4 420 850 μm grain size water samples were collected at the outlet at 5 different times calcium ion concentrations were determined using inductively coupled plasma mass spectrometry icp ms agilent 7500cx 3 results and discussion 3 1 evolution and shape of the mineral reaction zone in all of the experiments a lighter colored region developed in the center of the cell surrounding the oxalic acid injection point in the experiment shown in fig 4 0 1m h2c2o4 420 850 μm grain size the replacement zone expands over time creating an asymmetric pattern that is skewed towards the downstream direction this pattern is consistent with the lateral transport of oxalic acid and its subsequent reaction in the direction of flow the rate at which the reaction zone increased was approximately constant during the experiment by the end of the experiment the reaction zone had spread to 52 of the model aquifer s cross section extending to the base of the model and to the downstream boundary in the experiments in which the reaction zone reached the downstream boundary a white precipitate began to accumulate outside of the porous medium in the downstream constant head cell supplementary fig 1 electron microscopy and xrd analysis revealed that the precipitate comprised whewellite crystal aggregates 5 20 μm in size this fine particulate matter most likely forms within the porous medium and is transported through the cell to the outlet the concentration of h2c2o4 in the injected fluid had a significant effect on the shape of the replacement zone fig 5 in the 1m oxalic acid experiments fig 5a b the reaction zone extended from the base of the cell to top of the cell and reached both side boundaries in addition narrow channels 0 5 cm wide formed in the upper section of the porous medium as a result of the release of co2 during calcite dissolution by contrast in the 0 1m oxalic acid experiments no channels were observed and the extent of the reaction zone was more limited both laterally and vertically fig 5c d although distinct reaction zones were still visible at the lowest concentration we tested 0 01m the visible extent of reaction was relatively restricted covering only 6 of the cell fig 5e grain size also had a significant impact on the spatial pattern of reaction in the fine grain experiments 180 420 μm the reaction zone had a more limited lateral extent than in the coarse grain experiments fig 5 this is most likely a result of the lower flow rate in the lower permeability system and the subsequent slower rate of transport of both dissolved oxalic acid and calcium oxalate particles thus in low permeability aquifers the reaction zone could be highly localized 3 2 calcium oxalate content in reacted cells electron microscopy shows that as a result of reaction calcium oxalate builds up on the surfaces of the grains to form a non uniform coating of 1 5 μm size crystals fig 6 in addition the pore network is also filled with fine granular material supplementary fig 2 the size of the calcium oxalate grains is similar to that found in the outlet which is consistent with their mobilization and transport through the pore network from the xrd analyses the core from the experiment carried out at the highest oxalid acid concentration and highest permeability h2c2o4 1m and 420 850 μm grain size shows an estimated 56 9 calcium oxalate content of which 1 is weddellite and the rest is whewellite at the base fig 7 a the calcium oxalate content drops to 37 9 in the top part of the reaction zone surprisingly in the uppermost sample located in the unsaturated zone the calcium oxalate content was 30 our experiments also revealed that lower oxalic acid concentrations led to lower calcium oxalate contents the analysis of the core sampled in an experiment carried out at 0 1m h2c2o4 showed that the maximum calcium oxalate content in the reaction zone was only 19 9 fig 7b visual inspection of the experiment indicates the presence of oxalate above the saturated zone although the xrd analysis did not detect the presence of oxalate minerals in the uppermost sample in the core the efficiency of the reaction ƞ defined here as the molar proportion of calcium carbonate converted into oxalate minerals can be calculated using the following equation 3 η wt caox m caox wt cac o 3 m cac o 3 wt caox m caox where wt caox is the mass fraction of calcium oxalate wt caco3 is the mass fraction of calcite mcaox is the molar mass of calcium oxalate 128 1 g mol 1 and mcaco3 is the molar mass of calcite 100 1 g mol 1 using the estimated mass fractions from the xrd data the maximal efficiency of the replacement reaction is 50 in the 1m oxalic acid experiment and 16 in the 0 1m experiment the persistence of a significant proportion of the initial calcite even at the highest concentration of h2c2o4 could be due to an armoring effect that creates an impermeable coating around the carbonate grains effectively shutting down further reaction the armoring mechanism is consistent with the way the ca concentrations in the outlet effluent change with time fig 8 during the initial stage of the experiment carried out at 0 1 m h2c2o4 and 420 850 μm grain size ca concentrations increase from 4 ppm to 72 ppm in the first six hours this corresponds to an initial stage of dissolution of calcite during which the reaction is not entirely stoichiometric i e not all the calcium ions released during calcite dissolution become incorporated into the calcium oxalate phases however after 48 hours the concentration drops to 1 ppm probably reflecting a significant reduction in the rate of calcite dissolution the ca concentrations also provide an indication of the degree to which dissolution is incongruent the difference δ between the total amount of calcium that was released as a result of calcite dissolution and the amount that precipitates as a result of calcium oxalate formation can be estimated using the following equation 4 δ t 0 t t q t c t dt where q t is the time dependent discharge at the outlet c t is the ca concentration and t is the time at which the experiment is terminated numerical integration of equation 4 using the experimental data produces a value of 0 88 g or 0 022 mol of dissolved ca this value can be compared with the amount of ca bound to oxalate minerals at the end of the experiment which we estimated from the volume of the reaction zone 800 ml the proportion of ca oxalate 18 according to xrd the bulk density of the porous medium 1 15 g ml 1 and the molecular mass of whewellite 146 g mol 1 this yields a value of 1 13 mol ca which indicates that less than 2 of the calcium released during calcite dissolution leaves the system in dissolved form 3 3 impact of mineral replacement on discharge and flow patterns injection of dye into the porous matrix revealed that the flow was significantly slowed in the region surrounding the reaction zone in the experiment shown in fig 9 carried out at 0 1 m h2c2o4 in the high permeability medium 420 850 μm the lateral intersticial velocity was 20 cm h 1 prior to oxalic acid injection by contrast after 3 days of reaction the velocity is estimated to be 0 1 cm h 1 during the period of observation the dispersion of dye through the reaction zone was barely discernible indicating that the oxalate replacement zone represented an effective barrier to the transport of solutes importantly the dye we injected gives an indication of the intersticial fluid velocity and simulates the transport of an inert contaminant however heavy metals and organic compounds are often sorbed onto mineral surfaces in limestones e g wefer roehl et al 2001 sdiri and higashi 2013 and their effective transport through the barrier could be significantly slower than the rate we observed after the initiation of acid injection discharge decreased significantly in all the high permeability experiments 420 850 μm grain size in the experiment shown in fig 10 1m h2c2o4 2 main stages can be seen during the first 15 hours of acid injection discharge decreased rapidly at a non uniform rate from 640 to 316 ml h 1 at later times the discharge stabilized at a value of approximately 310 ml h 1 the initial stage of the experiment is attributed to the reduction in hydraulic conductivity caused by the dissolution precipitation reaction while the second stage is consistent with the cessation of the replacement reaction moreover the observation that the discharge is stable for over 30 hours suggests that the reduced hydraulic conductivity is a persistent feature of the system the two stages of initial reduction in discharge and the stabilization of discharge were also observed during the intermediate oxalic acid concentration 0 1m experiments but the changes occurred much more gradually fig 11 a despite very different levels of measured calcium oxalate the overall reduction in discharge 70 was similar to that observed in the 1m h2c2o4 experiments by contrast at the lowest oxalic acid concentration 0 01m no significant changes in discharge were observed to facilitate the description of the effect of oxalic acid concentration on the rate of change in the systems we define t1 2 as the time required for the fluid discharge to drop to less than 50 of the initial value thus in the experiments with coarse sand the average value for t1 2 is 9 7 h at 1m 33 5 h at 0 1m and 72 h at 0 01m in the low permeability experiments 180 420 μm grain size a significant reduction in discharge was also observed although the decline was slower than in the high permeability experiments fig 11b moreover in the low permeability experiments the discharge did not reach a stable value suggesting that the replacement reaction did not reach completion in addition the overall reduction in discharge 40 during the low permeability experiments was also smaller than in the high permeability experiments however rather than reflecting a smaller reduction in hydraulic conductivity this is likely to be because the constant rate of fluid injection 100 ml h 1 represented about 50 75 of the initial discharge in the low permeability experiments 3 4 porosity evolution and reaction efficiency the results from the image analysis method for estimating porosity fig 12 indicate that the rate of porosity reduction varies throughout the reaction zone as expected the initial rate of change is most rapid nearest the point of injection and becomes slower with increasing distance in the 3 locations within the reaction zone the method estimates the final porosity to be approximately 20 however this value is a significant underestimation of the total porosity because the method is unable to image the submicrometer scale voids within the calcium oxalate aggregates that fill the large intergranular voids nevertheless the method probably provides an indication of the porosity associated with large pores that are responsible for conducting most of the fluid flow the maximal effect of the reaction on porosity can be constrained by considering the changes occurring in a closed system in which the final porosity nfin in the reacting porous medium is affected by two main factors the reaction efficiency η defined in equation 3 and the initial porosity ninit this dependence can be expressed by the following equation 5 n fin η δ v m v m cac o 3 1 n init n init this equation predicts that in a calcareous aquifer with a porosity of 55 as was the case in our high permeability experiments the final porosity will be approximately 20 if all the calcium carbonate is replaced by calcium oxalate fig 13 however if the porous matrix has an initial porosity lower than 45 which is typical of the vast majority of carbonate aquifers the total occlusion of porosity is theoretically possible even when the efficiency is significantly lower than 100 our experiments indicate that even a small reduction in porosity can induce profound changes in permeability for example in the experiment shown in fig 9 the maximum efficiency was only 16 corresponding to a porosity reduction of 5 nevertheless this change was enough to significantly impact flow and create an effective barrier to flow this effect is probably the result of the partitioning of large intergranular voids by the calcium oxalate crystals creating a network of micrometer size pores with a similar porosity but much lower permeability in addition heterogenous precipitation patterns at the pore scale may disrupt the connectivity between remaining large pores 4 conclusions we examined the impact of the replacement of calcium carbonate by calcium oxalate on flow in a model aquifer system and found that flow declined by as much as 80 furthermore imaging of flow patterns show that the reaction zone created an effective barrier to flow although not all the calcium carbonate in the system was replaced the newly formed calcium oxalate occluded intergranular porosity and reduced the permeability of the calcareous matrix before such mineral replacement reactions can be employed to contain groundwater contamination a number of issues need to be addressed first the differences between the experimental conditions and those encountered in real aquifers do not allow us to predict its efficacy in reducing permeability in the field carbonate aquifers frequently possess much lower permeabilities than the porous media we tested and they are often fractured rather than granular micro karstic features such as large pores or pore clusters create preferential pathways with high water fluxes that could both spread and dilute the reactants in addition in our experiments we did not explore the effects of temperature and pressure on reaction rates and system behavior this may be particularly important in deep aquifers that can experience relatively extreme physical conditions furthermore our system was pseudo 2d and involved a single injection point to use mineral replacement to contain a contaminant plume in a field setting a 3d array of injection boreholes would be required this means that complete sealing may be difficult to achieve particularly in thick aquifers so that the method may be more suitable for preventing the spread of light non aqueous phase liquids lnapls which float on the water table a limited field scale pilot could resolve some of these unknowns a second issue that needs to be addressed is the stability of the barrier and the potential impact of the method on water quality if the calcium oxalate precipitate is dissolved or mobilized over time not only will the effectiveness of the barrier be reduced but water quality in the uncontaminated aquifer might be compromised our experiments indicated that oxalate particles are mobilized during the formation dissolution precipitation process but it is unclear if these would be entrained and ultimately filtered out in a larger scale porous medium again a field scale pilot in which groundwater chemistry was monitored would provide answers to some of these issues one aspect of coupled dissolution precipitation reactions highlighted by the experiments is that modelling such systems in both laboratory and field settings is a non trivial task existing kinetic models do not account for the impact on reaction rates of the build up of insoluble mineral layers and such effects mean that rate equations at the continuum level which are required for darcy scale modelling become ad hoc clearly an accurate kinetic description of the chemical processes would provide a predictive capability of the dynamics of such systems and this is the focus of ongoing work in our lab despite the limitations of the present study our results indicate that coupled dissolution precipitation reactions represent a potential pathway for creating subsurface barriers moreover such replacement reactions could be used not only in calcareous aquifers but in aquifers with other kinds of lithologies too future experiments focusing on other types of rocks and geochemical reactions could point the way to new and effective methods for creating subsurface barriers for managing contaminated aquifers credit authorship contribution statement anat cohen methodology investigation writing original draft visualization roni grayevsky investigation yoni israeli conceptualization investigation simon emmanuel conceptualization methodology writing original draft supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the israel ministry of energy and the israel water authority are thanked for their generous financial support supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 104052 appendix supplementary materials image application 1 
237,the objective of this paper is to investigate the interplay between wettability alteration and domain geometry in influencing the pore scale displacement and trapping mechanisms of two phase flow in porous media a new wettability alteration algorithm is introduced to quantify and track the spatial and temporal variability of the wettability state of every pore simulations in an initially oil wet domain are conducted using the lattice boltzmann model while utilizing the wettability alteration algorithm to capture the new wettability states the simulations are then resumed under the new generated wettability states to investigate the coupled impacts of wettability alteration and domain topology on the resulting pore scale displacement behavior we observe varying degrees of improvements in the oil phase fractional flow as the wettability state is varied towards water wet conditions influenced by the domain geometry capillary number and phase saturation significant heterogeneity increased surface roughness and the prevalence of narrower pore spaces in the rock sample in comparison to the spherepack increase the percentage of trapped oil ganglia as a result wettability alteration results in varying degrees of oil remobilization events followed by coalescence with the main flow path especially at higher capillary numbers moreover oil phase fractional flow at higher oil saturation becomes influenced primarily by the increased phase connectivity and improvements due to wettability alteration become less significant similar displacement mechanisms are observed in both domains controlled primarily by the wettability distribution and the local pore geometry however the resulting flow pathways which dictate the overall flow behavior are controlled by the frequency of various displacement mechanisms and are a function of the domain geometry the observations in this study highlight the complex interactions between wettability heterogeneity and pore geometry in influencing pore scale two phase flow the wettability alteration algorithm introduced can be used to optimize pore scale displacement processes by providing a framework to track the locations and the relative degree of wettability alteration enable automatic wettability alteration and detect trapped ganglia without the need for post processing keywords wettability wettability alteration algorithm two phase flow in porous media lattice boltzmann method pore scale simulation pore scale displacement mechanisms 1 introduction the physics of multiphase flow in porous media influences a wide variety of the most urgent challenges facing the world including ensuring energy security and clean water availability while alleviating the adverse effects of human activity on climate change an enhanced understanding of the associated physical phenomena governing the flow of fluids in subsurface rock formations has far reaching implications in many scientific applications including hydrocarbon extraction contaminant remediation and co2 sequestration efforts blunt 2017 the main challenge associated with characterizing and understanding the pore scale physics of multiphase flow in geologic porous media stems from the highly heterogeneous topology of these formations armstrong et al 2016 moreover the wettability of a porous medium which is defined as the affinity with which the various immiscible fluids attach to the medium s solid surface plays a significant role in influencing the pore scale flow behavior and the resulting macroscale flow properties of multiphase flow in porous media warner 2015 nemer et al 2020 the wettability distribution controls the local interface instabilities and the resulting displacement patterns where a shift in the mechanism controlling the growth of the invading cluster from burst to overlap cooperative pore filling occurs as the domain becomes more wetting with respect to the invading fluid cieplak and robbins 1990 melrose et al 1965 holtzman and segre 2015 bakhshian et al 2020 on the other hand the impact of local pore geometry in controlling and influencing the pore scale displacement mechanisms cannot be overstated especially in natural heterogeneous systems bakhshian et al 2019 the interplay between the topology of a medium and the wettability distribution heavily influences the relative permeability characteristics of the rock in addition to the capillary trapping mechanisms arriola et al 1983 buckley et al 1942 for example the oil ganglia trapping which occurs at the end of waterflooding is a direct consequence of the domain topology and is influenced primarily by the wettability of the medium in strongly wetting systems the wetting phase is located in the narrower regions of the pore space and flows in the form of thin films over the rock surface thus allowing the non wetting phase to occupy the center of the large pores and potentially be trapped by capillary forces in the form of ganglia bakhshian et al 2020 iglauer et al 2012 an improved understanding of the domain topology and wettability interdependence and the resulting capillary trapping is integral towards designing strategies that suppress or increase residual trapping towards enhanced hydrocarbon recovery and improved co2 sequestration respectively the wettability of the domain is a valuable control parameter that can be modified to improve the oil recovery factor and design successful enhanced oil recovery eor techniques such as low salinity waterflooding lswf tang et al 1997 tang and morrow 1999 and surfactant flooding standnes and austad 2000 hou et al 2015 although various mechanisms have been proposed to explain the greater recovery observed during low salinity waterflooding it is commonly suggested that the most likely reason behind the improved recovery is wettability alteration mahani et al 2015 bartels et al 2019 and that a shift in the wettability state from a strongly oil wet condition to a neutral wet or a water wet condition has a significant impact on the extent and rate of increase in the oil recovery efficiency tweheyo et al 1999 furthermore it has been demonstrated that wettability alteration due to lswf also favorably impacts macroscale parameters such as relative permeability and capillary pressure jerauld et al 2008 however the impacts on the pore scale flow behavior and the coupled influence of medium topology are less understood and there is a need for studies that bridge the gap between the physics observed in the sub pore scale and the core scale in order to advance our understanding of flow in mixed wet systems bartels et al 2019 a heterogeneous wettability distribution is typically encountered in most reservoirs in addition the wetting characteristics vary between reservoirs and display spatial heterogeneity from one pore to another from strongly oil water wet to intermediate wet characteristics which results in significant implications on the pore scale flow details wettability also displays a temporal dependence where for example a permanent wettability alteration occurs during drainage due to polar interactions and adsorption of asphaltenes on the grain surface kovscek et al 1993 buckley and liu 1998 moreover wettability alteration is observed during secondary and tertiary lswf which directly impacts the pore scale fluid configurations and the recovery factor aziz et al 2019 akai et al 2020 an altered wettability state of a reservoir is a function of the initial fluid distribution and composition the initial wettability state the portion of the domain where wettability alteration occurs and the degree of wettability alteration in our previous study nemer et al 2020 we conducted a systematic analysis of the relative importance of the wettability altered fraction the degree of wettability alteration and the accurate contact angle assignment and their effects on relative permeability and pore scale fluid configurations in order to better understand the quantitative and qualitative influence of wettability alteration on the pore scale and macroscale flow properties we found that the relative permeability and flow behavior are influenced primarily by the fraction of the pores undergoing wettability alteration and we observed a dependency for the remaining two factors where the degree of alteration and accurate contact angle assignment become more important in a domain with a larger wettability altered fraction a parametric investigation of the pore scale flow behavior due to the coupled influence of wettability alteration and domain topology using experimental approaches is difficult which highlights the need for a computational approach the lattice boltzmann method lbm is a powerful numerical technique that is commonly used to simulate multiphase flow in complex porous media since it can be easily implemented alongside micro computed tomography micro ct scanned images of real porous media samples as a result the lbm is better suited for an investigation centered around the complex topology of porous media over pore scale network modeling in which domain simplifications are used to capture the medium heterogeneity jiang et al 2007 moreover the lbm overcomes the main difficulties associated with grid based computational fluid dynamics methods which are capturing and tracking the dynamic fluid fluid interface golparvar et al 2018 liu et al 2016 since the interface arises automatically in the pseudo potential lbm due to phase separation chen and doolen 1998 in addition the method s suitability for parallel implementation due to local computations significantly improves its computational efficiency a number of multiphase models based on the lbm are commonly used such as the pseudo potential model shan and chen 1993 color gradient model gunstensen et al 1991 free energy model swift et al 1996 and mean field model he et al 1999 the lbm has been widely and rigorously used to model multiphase flow and validate experimental capillary pressure and relative permeability measurements in spherepacks and realistic pore structures pan et al 2004 tsuji et al 2016 li et al 2018 ramstad et al 2012 lattice boltzmann studies focused primarily on the impact of wettability in both homogeneous and mixed wet systems are steadily increasing nemer et al 2020 landry et al 2014 zhao et al 2018 bakhshian and hosseini 2019 akai et al 2019 in the study of bakhshian et al 2020 the coupled influence of pore geometry and wettability on the pore scale flow dynamics of two phase flow in porous media was investigated using the lbm in two domains of varying heterogeneity and under a wide range of uniform contact angles 25 θ 175 although uniform wet systems are rarely encountered in real porous media the complex nature of multiphase flow in mixed wet systems has not been fully investigated due to the challenges associated with characterizing local wettability alteration for example the wettability distribution in mixed and fractionally wet systems is typically assigned randomly or by altering the wettability at the portions of the domain in contact with the wettability altering agent at the end of the simulations zhao et al 2018 bakhshian and hosseini 2019 landry et al 2014 in real systems the wettability alteration shows a temporal dependence where the relative change in wettability at various regions in the system is proportional to the reaction time with the wettability altering agents an investigation has been conducted in flovik et al 2015 where a two phase network model was complemented with a wettability alteration mechanism dependent on the cumulative flow of the wettability altering agent through the various pores the extent and rate of remobilization and fractional flow improvements were found to be correlated with the degree of wettability alteration moreover in the study of akai et al 2019 the importance of capturing accurate contact angle distributions and the resulting impact on the pore scale and macroscale flow behavior was demonstrated by incorporating in situ measured experimental contact angles as a result a wettability alteration algorithm that can capture the spatial and time dependent variation in the wettability state of every single pore as a function of the domain topology is a valuable tool when investigating eor techniques and co2 sequestration potential using direct numerical simulations of multiphase flow in porous media the objective of this study is to investigate the interplay and interconnection between domain and wettability heterogeneity in influencing multiphase flow dynamics and the resulting pore scale flow mechanisms in order to conduct the investigation a wettability alteration algorithm is developed to track the time dependent and relative wettability alteration occurring in the domain we conduct two phase simulations at varying saturations of the two immiscible fluids in a two dimensional oil wet domain while tracking the expected locations and relative magnitude of wettability alteration although the extent of phase percolation is highly dependent on dimensionality the aim of the investigation is to provide an algorithm capable of tracking wettability alteration regardless of domain dimensionality and capture the dominant pore scale displacement mechanisms as a function of the updated wettability states four altered wettability states weakly oil wet intermediate wet weakly water wet and strongly water wet are generated based on the histogram of the wettability alteration data the simulations are then resumed under the new wettability states to draw insight into the resulting pore scale mechanisms due to wettability alteration which influence the macroscale behavior and the recovery efficiency in order to investigate the interplay between domain topology and wettability alteration the simulations will be performed on two domains of equal porosity and varying degrees of heterogeneity a spherepack and a rock berea sandstone sample in the next section the shan chen multi relaxation time multicomponent lattice boltzmann model with explicit forcing will be introduced in addition to the wettability alteration algorithm and the domains to be investigated the model will then be used to investigate the coupled impacts of wettability alteration and pore geometry on two phase flow by analyzing fractional flow effects pore scale fluid displacement mechanisms and oil ganglia dynamics 2 methods 2 1 shan chen multicomponent lattice boltzmann method in this section the shan chen multicomponent lb model with explicit forcing is introduced porter et al 2012 the lbm is centered around solving the lattice boltzmann equation lbe which is obtained by discretizing the boltzmann equation as shown in wolf gladrow 2004 krüger et al 2017 and can be characterized as a discrete approximation of the incompressible navier stokes equations li et al 2005 the fluid flow behavior is represented by distribution functions of fluid particles residing on a regular lattice which stream and collide wolf gladrow 2004 krüger et al 2017 the lbe tracks the evolution of the discrete velocity distribution function f i σ x t corresponding to a component σ at location x and time t with a discrete velocity e i 1 f i σ x e i δ t t δ t f i σ x t ω i σ i 0 1 b 1 where δ t is the length of the time step b is the total number of discrete velocity vectors in the lattice and ω i σ is the discrete collision operator the d2q9 lattice is used in this work where d2 represents the number of dimensions and q9 represents the number of discrete velocities qian and orszag 1993 the mrt collision operator is utilized due to the superior performance it has demonstrated over the standard bhatnagar gross krook bgk collision operator lallemand and luo 2000 in the mrt collision model mccracken and abraham 2005 du et al 2006 wang et al 2010 rao and schaefer 2019 the streaming process is carried out in the velocity space and the collision process occurs in the moment space the mrt collision process is summarized as 2 ω σ m 1 s σ m f σ x t f σ eq x t where m is a b b transformation matrix which transforms the b dimensional particle distribution function vector f σ in the velocity space to a b dimensional vector m σ in the moment space such that 3 m σ m f σ m σ eq m f σ eq the term f i σ eq x t is the equilibrium particle distribution function and is expressed as 4 f i σ eq w i ρ σ 1 e i u eq c s 2 e i u eq 2 2 c s 4 u eq u eq 2 c s 2 where w i presented in eq 5 represents the weight associated with a specific discrete velocity e i 5 w 4 9 1 9 1 9 1 9 1 9 1 36 1 36 1 36 1 36 and c s is the pseudo speed of sound which is model dependent 6 c s 2 1 3 c 2 1 3 δ x 2 δ t 2 the relaxation rate matrix s is a diagonal matrix of the various relaxation rates given by 7 s d i a g s ρ σ s e σ s ε σ s j σ s q σ s j σ s q σ s v σ s v σ and the kinematic viscosity v of the fluid is set by the relaxation rate s v σ krüger et al 2017 8 v c s 2 1 s v σ δ t 2 the resulting lbe evolution equation with the mrt collision operator and in the presence of external forcing is presented in eq 9 9 f σ x e i δ t t δ t f σ x t m 1 s σ m f σ x t f σ eq x t m 1 i s 2 σ m f σ x t where f σ x t is the forcing term and is defined as porter et al 2012 10 f i σ f σ e i u eq ρ σ c s 2 f i σ eq the macroscopic density ρ and velocity u of the σ component at a fluid node are obtained from the moments of the particle distribution function and the macroscopic velocity equation is force corrected due to external forcing 11 ρ σ x i 0 b 1 f i σ x 12 u σ x 1 ρ σ x i 0 b 1 f i σ x e i δ t 2 f σ the equilibrium velocity is used in computing the equilibrium particle distribution function porter et al 2012 eq 4 and is given by 13 u eq x σ σ s v σ ρ σ u σ σ σ s v σ ρ σ the forcing term f σ is the sum of all forces acting on a component which include the fluid fluid interaction force f f σ the fluid solid interaction force f s σ and any external forces f ext σ ρ σ g martys and chen 1996 14 f σ f f σ f s σ f ext σ the shan chen fluid fluid interaction force is the sum of the forces between components σ and σ at two neighboring lattice sites and is given by shan and doolen 1995 15 f f σ g σ σ ρ σ x t i 0 b 1 w i ρ σ x e i δ t t e i δ t where g σ σ is the strength of the interparticle force and is positive in order to result in a repulsive force and immiscible components the interfacial tension between the fluid pair is determined by the interaction strength g σ σ and is chosen to be large enough to produce phase segregation huang et al 2007 the wetting boundary condition is assigned using the fluid solid interaction force martys and chen 1996 16 f s σ g σ s ρ σ x t i 0 b 1 w i s x e i δ t t e i δ t where g σ s is strength of the interaction between a fluid component σ and the solid boundary and s x e i δ t t is an indicator function that is set to 0 for fluid nodes and 1 for solid nodes the interaction strength is attractive for a wetting fluid g σ s 0 and repulsive for a non wetting fluid g σ s 0 the resulting contact angle θ can be varied by altering the values of the interaction strengths of the two fluid components while maintaining g σ s g σ s a plot of the resulting contact angles for different values of g σ s is provided in our previous work nemer et al 2020 2 2 simulation domains and model parameters in this work the simulations are conducted in a spherepack homogeneous slice and a rock heterogeneous slice as shown in fig 1 the spherepack and rock slices are obtained by micro ct scanning with a resolution of 7 μ m and 2 114 μ m respectively saxena et al 2017 the original rock structure is from a berea sandstone churcher et al 1991 the rock slice shown in fig 1 was obtained after a number of morphological operations were performed to eliminate dead end pores and enhance throat connectivity such that the resulting porosity is equal to the porosity of the spherepack sample and is a controlled factor in the investigation the resulting porosity of the domains shown in fig 1 is 0 34 the simulation domain sizes in the spherepack and rock domains are 601 601 l u 2 and 1024 1024 l u 2 respectively in the investigations to be conducted in this study the density of the wetting and non wetting fluids are set to unity in lattice units ρ w ρ n w 1000 k g m 3 the viscosity ratio is also set to 1 in a capillary force dominated regime this approximation is sufficient for a water and non aqueous phase liquid system since the density and viscosity are of the same order of magnitude li et al 2018 the interfacial tension is defined using the young laplace test in which the value of the fluid fluid interaction parameter that results in phase segregation between the two components is determined g σ σ 3 1 the young laplace test involves initializing droplets of varying radii of one fluid suspended in the second fluid the pressure difference across the droplet at equilibrium is plotted against the reciprocal of the final droplet radius and the slope of the plot is the interfacial tension in lattice units σ 0 0925 15 m n m the lattice units are converted to physical units through a determination of scaling quantities for length l time t and fluid density m zhao et al 2018 liu et al 2015 ramstad et al 2010 the bounce back boundary condition he and luo 1997 is assigned at the solid nodes and periodic boundary conditions are implemented in the x and y directions in order to highlight capillary number effects the simulations are performed under two capillary numbers c a 6 5 10 4 and 1 1 10 3 2 3 wettability alteration algorithm as mentioned earlier the wettability of a reservoir varies spatially and temporally during a displacement process for example during low salinity waterflooding as low salinity water migrates into a reservoir saturated with oil the interactions between the low salinity water and the solid matrix alter the wettability of the domain over time berg et al 2010 in order to capture this effect in the simulations we utilize a scalar field to monitor the interactions between the two components and the solid matrix the wettability alteration scalar field w for each component σ σ is initially set to 0 at every solid node location as the simulation proceeds we track the location of the two components and increment the w field associated with the component residing on the corresponding solid node based on a predetermined density threshold the w field can be incremented every n time steps where n can be chosen arbitrarily by tracking the w field we account for water displacing oil and vice versa from any solid location in our investigations the actual wettability alteration of the domain is performed once the simulations are stopped and new wettability states are generated however in the future to ensure the true time dependent nature of the algorithm specific thresholds will be set such that once the w field crosses the defined threshold for a specific new wettability state the wettability state of the domain is automatically updated these thresholds can be determined using experimental studies aimed at developing wettability alteration correlations for various fluid systems the new wettability states are incorporated by varying the fluid solid interaction parameter introduced earlier at a specific simulation time or once the simulation has run the relative degree of wettability alteration is obtained as follows and as shown in the pseudocode detailing the procedure provided in algorithm 1 given below the w fields for the two components are divided by the absolute maximum value between the two fields therefore the w field which contains the maximum value will have values normalized between 0 and 1 while the other field will have values between 0 and a value smaller than 1 x once this step has been performed a global wettability alteration field is computed by subtracting the two w fields the new global w field contains values between x 1 assuming the w field for oil contained the maximum value from the two fields values closest to 1 in the global w field signify solid locations that are most likely to remain oil wet while values closest to x represent the locations where wettability alteration towards a water wet state is expected to occur a histogram of the global w field data reveals the relative degree of wettability alteration in the domain and a contour plot of the data leads to the locations of wettability alteration there are a number of advantages associated with tracking wettability alteration using this approach the fraction of the domain undergoing wettability alteration plays a very important role in influencing the flow dynamics of mixed wet systems nemer et al 2020 which the algorithm inherently captures the relative degree of wettability alteration can be captured by comparing the scalar values to track the locations that interact the most with the wettability altering agent which can be useful in enhancing eor techniques moreover the same algorithm can be applied to identify the locations where disconnected oil or co2 ganglia reside in order to better understand capillary trapping mechanisms additional advantages of the algorithm are the inherent simplicity low computational cost and the potential compatibility with various fluid systems by utilizing different experimentally defined correlations as a result the wettability alteration algorithm introduced provides a valuable and efficient framework towards accurately tracking and performing wettability alteration in addition to automatically detecting trapped ganglia without post processing 3 results and discussion 3 1 generation of new wettability states the initial simulations are performed in an oil wet θ 160 domain for varying saturations of the wettability altering fluid s w 0 25 0 5 0 75 the fluids are initialized according to the procedure outlined in nemer et al 2020 li et al 2018 and periodic boundary conditions are implemented in the x and y directions thus resembling drainage and imbibition processes occurring simultaneously the objective of these simulations is to track the location and relative magnitude of wettability alteration using the developed algorithm once the wettability state has been altered the simulations are resumed under the new wettability states and the effects on the oil phase fractional flow and the pore scale flow details are investigated the simulations prior to wettability alteration are performed on both the spherepack and rock domains under the two capillary numbers specified as mentioned earlier an initial simulation is conducted in an oil wet domain for various distinct saturations of the two components s w 0 25 0 5 0 75 at the end of the simulations in the initially oil wet domain a histogram of the global w field is generated to determine the relative magnitude of wettability alteration furthermore a contour plot of the global w field provides insight into the regions expected to have higher lower rates of wettability alteration since it is determined by the time of reaction with the wettability altering agent water the global w field data are scalar values that summarize the temporal interactions of the two phases at every solid node in the domain in order to generate the new wettability states the overall range of scalar values in the normalized global wettability alteration field data is divided into smaller distinct intervals a bar graph of the frequency of occurrence of the various interaction times global wettability alteration field distribution within these smaller intervals is generated for each distinct saturation of the wettability altering agent as a result a bar graph of the global wettability alteration field distribution which is a function of the phase saturation is provided in the various rows of figs 2 and 3 currently however the algorithm does not propose or utilize a relationship between interaction time and contact angle therefore the degree of wettability alteration for each set of distinct saturations is investigated by generating weakly oil wet intermediate wet weakly water wet and strongly water wet domains from the same aforementioned global w field data bar graph obtained at the end of the simulation in the oil wet domain the various wettability states are generated by mapping the interaction time ranges bar graph ranges in the x axis to representative contact angle distributions in the horizontal direction this is observed in figs 2 and 3 where the same global w field distribution for each distinct saturation is mapped to various wettability states contact angle distributions in the horizontal direction the normalized interaction time ranges are set for s w 0 5 by assigning the most frequent interaction time highest bar to the contact angles of 123 90 60 and 36 for the weakly oil wet intermediate wet weakly water wet and strongly water wet domains respectively the contact angle values mapped to the interaction time ranges for s w 0 5 are kept constant for various saturations of the wettability altering fluid s w 0 25 0 75 to capture the phase saturation effect on the resulting wettability states therefore the model includes all of the essential ingredients of a wettability alteration study it is a time dependent model where the wettability alteration is correlated with the flow pathways of the wettability altering agent and the relative degree of wettability alteration is dictated by the interaction time between the domain and the wettability altering agent the new wettability states are generated for various initial saturations of the wettability altering agent water phase and provided in figs 2 and 3 for the spherepack and rock domains respectively as the saturation of the wettability altering agent is increased we notice the bar graph becoming increasingly skewed away from an oil wet condition in addition a wider distribution of contact angles is observed for larger saturations of the wettability altering agent this occurs because increasing the saturation of the water phase improves the phase connectivity which strongly enhances the ability of the water phase to traverse the domain more efficiently thus allowing it to displace the oil phase from additional regions of the domain the differences in the wettability alteration data as a function of domain geometry are indicative of the varying flow behavior in the two domains for example the majority of the wettability alteration field data is located within a specific range in the spherepack domain whereas the data is more evenly spread across multiple distinct ranges in the rock domain this implies that additional possible flow paths exist in the rock domain due to the higher degree of heterogeneity the new wettability states generated under the larger capillary number c a 1 1 10 3 demonstrate very similar behavior and trends as the ones presented for the smaller capillary number c a 6 5 10 4 and are presented in figs s1 s2 in the supplementary material in the following sections the interplay between domain geometry and wettability alteration will be further emphasized and analyzed by monitoring oil phase fractional flow behavior oil ganglia dynamics and pore scale fluid displacement mechanisms 3 2 effect on fractional flow once the new wettability states have been generated the simulations are re initialized using the final fluid distributions from the oil wet simulations prior to wettability alteration in order to determine the impact of the new wettability states on the oil phase fractional flow the oil phase fractional flow is computed by dividing the oil flow rate by the total flow rate f o q o q o q w the oil phase fractional flow curves at various oil phase saturations s o 0 25 0 5 0 75 before and after the induced wettability alteration in the rock domain are provided in fig 4 the oil phase fractional flow curves in the spherepack domain display similar behavior and are presented in fig s3 similarly the oil phase fractional flow curves under the larger capillary number c a 1 1 10 3 in both domains are provided in figs s4 s5 the magnitude of the oil phase fractional flow in an oil wet domain before wettability alteration is dictated by the oil saturation and the initial connectivity of the oil phase as observed improvements in the oil phase fractional flow values due to wettability alteration become increasingly evident as the wettability state is incrementally altered to intermediate wet θ m e a n 90 weakly water wet θ m e a n 60 and strongly water wet θ m e a n 36 conditions a summary of the effect of wettability alteration on the fractional flow curves in the spherepack and rock domains is presented in fig 5 as shown in fig 5 altering the wettability of the domain from a strongly oil wet θ m e a n 160 to a weakly oil wet condition θ m e a n 123 does not result in significant improvements in the oil phase fractional flow and for low oil saturations we observe negative effects in both domains moreover an intermediate wet condition θ m e a n 90 only results in major improvements in the oil phase fractional flow at comparable saturations s o 0 5 these improvements are observed under both capillary numbers in the rock domain but only for the higher c a in the spherepack domain this can be explained by the observations in rabbani et al 2018 where a combination of concave and convex interfaces were observed under intermediate wet conditions and the interface curvature was found to be a strong function of the local pore geometry and angularity as a result in intermediate wet conditions the local pore geometry becomes the governing factor dictating the interface shape capillary force direction and the resulting occurrence of imbibition or drainage locally bakhshian et al 2020 rabbani et al 2018 this effect is more pronounced at equal saturations of the two components where the connectivity patterns are comparable and become less important in dictating the pore scale flow behavior in the spherepack domain the biggest relative improvement in the oil phase fractional flow under the lower c a is seen as we transition towards a weakly water wet condition with no significant improvement as we transition towards a strongly water wet condition θ m e a n 36 however a further wettability alteration towards a strongly water wet condition does continue to improve the oil phase fractional flow for the higher c a in the spherepack domain as the capillary number increases the oil phase traverses the domain with a larger conductance due to the higher driving force the ability of both fluids to overcome the entry capillary pressure of additional pore spaces increases which results in the creation of an increased number of flow paths and an enhancement in the connectivity of the fluids nemer et al 2020 on the other hand a further transition towards a strongly water wet condition continues to result in improvements in the oil phase fractional flow in the rock domain for both capillary numbers a similar pattern was observed in bakhshian et al 2020 where the optimum wetting conditions for maximizing the displacement efficiency of the defending fluid occurred under imbibition water wet conditions in a heterogeneous domain and intermediate wet weakly water wet conditions in a homogeneous domain these observations demonstrate the role of geometry in controlling the local displacement patterns and the resulting influence on the macroscale behavior and highlight the importance of capturing both wettability and geometry heterogeneity when attempting to quantify optimal wetting conditions furthermore we observe that the relative improvement in the oil phase fractional flow decreases with increasing oil saturation as we transition towards water wet conditions this occurs because the dominant parameter controlling the flow behavior of the oil phase at higher oil saturation is the increased connectivity due to the higher phase saturation and the relative improvements due to wettability alteration become less significant however the most important factor in enhancing the oil phase fractional flow is a transition in the wetting characteristics of the domain from an oil wet to a water wet condition an alteration in the wettability state towards water wet conditions enables the water phase to invade the narrow and dead end regions saturated with the trapped oil phase as a result small oil phase blobs which have previously been trapped become remobilized and are capable of joining nearby larger oil ganglia flowing through the wider regions of the pore space via coalescence the extent of remobilization followed by coalescence is also dependent on the capillary number and the pore topology where a larger capillary number increases the likelihood of these events occurring due to the increased ability of the water phase to invade narrower pore spaces 3 3 pore scale displacement analysis 3 3 1 pore scale displacement mechanisms the evolution of the pore scale fluid configurations in oil wet conditions for the spherepack and rock domains investigated are presented in fig 6 we analyze the fluid configurations at comparable saturations to isolate the coupled impacts of wettability and pore geometry on flow evolution since the improved phase connectivity due to a dominant saturation has implications on the flow patterns the layered fluid initialization procedure allows us to observe pore scale invasion mechanisms associated with drainage conditions front where water is displacing oil and imbibition conditions front where oil is displacing water the water non wetting phase preferentially invades the larger pores via a burst mechanism haines jump where an increase in the pressure locally beyond a critical capillary pressure results in a perturbation of the interface until an equilibrium is reached cieplak and robbins 1990 bakhshian et al 2020 edery et al 2018 moebius and or 2014 as shown in figs 6b and 6f as a result the oil phase is displaced by the water phase and forced into the smaller and narrower regions of the pore space zhao et al 2016 on the other hand the pore scale invasion pattern at the front where oil wetting phase displaces water non wetting phase results in a competition between piston like displacement and snap off processes singh et al 2017 a snap off event occurs when the wetting phase layer swells and fills a throat until a critical capillary pressure is reached and a portion of the non wetting phase becomes disconnected from its flow path singh et al 2017 the wetting phase can either completely displace the non wetting phase from a pore via piston like displacement figs 6b and 6f or flow through increasingly swelling layers which can completely fill the narrower pore spaces and result in the non wetting phase becoming disconnected in the form of ganglia figs 6d and 6g snap off occurs when piston like displacement is topologically not possible singh et al 2017 blunt et al 1992 joekar niasar and hassanizadeh 2012 piston like displacement is evident at the early time steps in the narrow pores since it requires the complete filling of an adjacent pore by the wetting phase before proceeding singh et al 2017 by comparing the displacement fronts at the two earliest time steps we observe that the interface evolution extent is smaller during piston like displacement wetting phase displacing non wetting phase than that observed during bursts non wetting phase displacing wetting phase at later time steps the oil phase traverses the domain in the form of well connected layers along the solid surface without necessarily displacing the water phase from the center of the large pores figs 6d and 6h the oil phase maintains a large degree of connectivity owing to the periodic nature of the domain and the wettability condition and resides in the narrowest regions of the pore space the nature of the oil phase propagation pattern in the form of swelling layers along the solid surface results in ganglia of the water non wetting phase becoming increasingly disconnected via snap off singh et al 2017 an accurate assessment of non wetting phase trapping potential is extremely important when analyzing co2 sequestration efforts and oil recovery potential where either maximum or minimum trapping is preferred respectively the frequency of snap off events is dependent on wettability and pore geometry and are more likely in domains with a larger pore to throat radius ratio singh et al 2017 wardlaw et al 1982 chatzis et al 1983 we observe a higher frequency of snap off events in the rock domain leading to a larger number of disconnected non wetting phase ganglia due to the larger pore size distribution and the prevalence of smaller pores this can be explained by the investigation conducted in bakhshian et al 2021 where corner flow and the subsequent trapping of the non wetting defending fluid were more readily observed in small pores although the described displacement patterns are present in both domains the frequency of occurrence and resulting flow pathways are controlled by the pore geometry for example thin films are more emphasized in the rock domain due to the increased surface roughness and higher angularity of the solid surface which amplifies wettability effects zhao et al 2016 therefore in the rock domain we observe the oil phase propagating in thinner layers without filling the pore bodies fig 6h which has implications on the displacement efficiency moreover the impactful role of pore topology becomes more evident since displacement patterns locally become influenced by the motion of the other displacement front ahead for example in the rock domain the existence of a number of large pores successively in the top region of the domain allows for the creation of a dominant flow path for the water phase fig 6h the enabling factor behind the fast creation of the water preferential flow path is the significant interface perturbation that occurs in the middle of the domain due to the very large local pore space the behavior of the water phase in that region of the domain forces the oil phase both ahead and behind to be quickly displaced by the water phase as shown in fig 6f as a result although wettability controls the resulting pore scale mechanisms given the pore space topology locally the resulting flow pathways are dictated by the cumulative behavior and interaction between these displacement mechanisms as evident in the different flow pathways observed in the two domains investigated these observations provide insights into the complexity behind characterizing pore scale multiphase flow owing to the competition between pore geometry and wettability in influencing the displacement patterns in order to illustrate how the change in wettability will disrupt the fluid distributions and influence the fluid evolution patterns in the wettability altered domains generated at the end of the oil wet simulations the pore scale fluid configurations in the wettability altered domains are presented in figs 7 12 as mentioned earlier the simulations are initialized in the wettability altered domains using the fluid distributions at the final time step in the oil wet simulations and the effects of wettability alteration on the fluid distributions are monitored a relaxation of the wettability state towards weakly oil wet conditions results in minor changes to the flow patterns fig 7 in the rock domain the oil phase continues to traverse the domain in the form of thin layers while incrementally filling narrower pore bodies where possible via cooperative pore filling the resulting oil phase flow pathways through the center of the pores allow the oil phase to traverse certain regions of the pore space with higher mobility via piston like displacement in comparison to the regions where the oil phase continues to flow in the form of layers therefore the oil phase continues to flow predominantly in the form of layers while incrementally forming higher mobility flow pathways controlled by local wettability and pore geometry through a combination of cooperative pore filling and piston like displacement however the flow of the oil phase through slow connected layers dominates the flow rate of the oil phase as shown in fig 5 slight improvements are observed in the rock domain due to the described phenomena while the flow behavior of the oil phase in the spherepack domain remains largely unimproved the oil phase flow pattern has already evolved and a slight relaxation in the wettability state is not sufficient to alter the oil phase flow behavior given the pore topology of the spherepack domain and the smaller fluid solid interfacial area as the wettability state is further altered to intermediate wet conditions the complexity of the pore scale displacement behavior increases since the two components demonstrate similar degrees of affinity to the solid surface the local pore scale configuration and flow pattern evolution become strongly dependent on the pore geometry in intermediate wet conditions the interface curvature and the resulting direction of capillary forces are strong functions of the local pore geometry and angularity rabbani et al 2018 the simultaneous existence of concave and convex interfaces implies the existence of imbibition and drainage events in different parts of the domain controlled primarily by the local pore geometry bakhshian et al 2020 as shown in fig 8 at comparable saturations of the two phases we observe an improvement in the fractional flow of the oil phase in regions where the oil phase completely occupies the pore body the oil phase now begins to traverse the pore more readily thus allowing the original oil phase which existed predominantly in layers on opposite sides of the pore to become connected to the oil phase flowing through the pore body it can be observed that an overlap of multiple neighboring menisci occurs due to cooperative pore filling and a new stable meniscus is formed bakhshian et al 2020 zhao et al 2016 as shown in figs 8d and 8h therefore the enhanced flow capability of the oil phase through the center of the large pores and the reduction in the extent to which the oil phase flows in layers along the solid surface results in increasing the oil phase fractional flow values this effect is enhanced in the rock domain due to the wider pore size distribution and the larger accessible fluid solid interfacial area which enhances the performance of the displacement mechanism explained once the wettability state has been transformed to weakly water wet followed by strongly water wet conditions the oil phase begins to increasingly flow with higher phase conductance through the large pores while the water phase flows through layers and becomes increasingly confined to the tighter pores figs 9 10 11 12 the pore scale displacement mechanisms are similar to those observed in the originally oil wet domain with the major distinction that the oil phase has now been transformed to the non wetting phase moreover we observe an increase in the number of larger oil ganglia and a reduction in the number of small oil blobs in water wet conditions at the pore scale this is observed because once the wettability state is altered towards water wet conditions capillary pressure assists water in imbibing into the tighter regions saturated with the oil phase thus allowing some of the oil phase to become remobilized additionally the oil layers increasingly break down into smaller disconnected oil ganglia dispersed throughout the domain with potential for mobility the remobilized smaller oil ganglia can then join the larger oil ganglia non wetting phase flowing through the wider regions of the pore space via coalescence the evolution process summarized is presented in fig 11 the oil phase connectivity increases which enhances the flow ability of the oil phase as evident in the fractional flow investigation presented earlier in section 3 2 the aforementioned phenomena are observed in both domains and under the two capillary numbers investigated as shown in figs 9 12 however the effects are more pronounced in the rock domain due to the increased surface roughness and the larger pore size distribution of the rock domain at the lower c a a change in the wettability state towards strongly water wet conditions in the spherepack domain did not result in significant improvements in the oil phase fractional flow over weakly water wet conditions as opposed to the rock domain the rock domain retains larger portions of the oil phase in the very narrow regions with potential for remobilization via a further alteration in the wettability state towards strongly water wet conditions as demonstrated in fig 5 in water wet conditions the oil phase resides in the domain in the form of connected large ganglia flowing through the center of the large pore spaces with high mobility and a large potential for recovery as a result a larger c a enhances the potential for recovery since it enables the water phase to increasingly displace the oil phase from narrower pores thus increasing the potential for oil remobilization followed by coalescence especially in the rock domain due to the larger number of narrow pore spaces fig 12h in addition previously detached oil ganglia via snap off are more likely to become remobilized under the larger c a 3 3 2 oil ganglia analysis in order to better illustrate the observed improvements in the oil phase fractional flow due to wettability alteration we investigate the oil ganglia dynamics by quantifying the frequency and distribution of the size of the oil ganglia as the wettability state of the domain is incrementally altered from an oil wet to a water wet condition moreover we also highlight the role of the domain topology in influencing the potential for oil ganglia remobilization after wettability alteration the distributions of the oil ganglia sizes are obtained at the end of the simulations in the initially oil wet domain and under the new wettability states generated using the wettability alteration algorithm weakly oil wet intermediate wet weakly water wet and strongly water wet for the spherepack fig 13 and rock fig 14 domains as mentioned earlier this analysis is performed at specific saturations of the two phases s o 0 25 0 5 0 75 by utilizing the wettability alteration algorithm which generates the wettability states inherently as a function of the domain and the phase saturations we are providing more accurate insights into the interplay between wettability alteration and geometry heterogeneity in impacting the extent of oil ganglia remobilization in the initially oil wet domain at intermediate saturations figs 13a and 14a we find that the majority of the oil phase in the domain flows in the form of a number of well connected clusters which occupy large areas in both domains although the strongly wetting condition enables high wetting phase connectivity these wetting phase layers flow very slowly in comparison to the non wetting phase as was shown in the fractional flow values in fig 5 furthermore we also find that a large percentage of the oil ganglia in the domain though not a dominant portion of the oil in place are small disconnected blobs and occupy very small areas in the domain this occurs because the oil phase wetting phase flows primarily in the form of a number of wetting layers and resides in the narrow and tight regions of the pore space blunt 2017 as shown in figs 6d and 6h therefore the number of small oil blobs in an oil wet domain becomes increasingly dependent on the pore size distribution and surface roughness since a larger fraction of small pores and increasingly rough surfaces implies a larger percentage of small oil blobs as observed in the rock domain in fig 14a therefore we expect a larger percentage of oil ganglia remobilization events with wettability alteration in the rock domain dependent on the accessibility of these tighter pore spaces as the wettability state of the domain is incrementally altered towards weakly oil wet figs 13b and 14b and intermediate wet figs 13c and 14c conditions the initially large oil layers in the domain can become disconnected and we observe a gradual increase in the number of medium sized ganglia in addition the number of very small oil blobs slowly decreases due to the transition from layer flow figs 6d and 6h to cooperative pore filling figs 8d and 8h as a result of the increased ability of the oil phase to traverse the centers of the pores more easily the resulting competition between enhanced flow ability due to the higher phase connectivity observed under oil wet conditions and the increased cooperative pore filling events observed in weakly oil wet and intermediate wet conditions explains the resulting non drastic effects on the fractional flow as shown in fig 5 however an exception is observed at s o 0 5 under both capillary numbers in the rock domain but only for the higher c a in the spherepack domain where an alteration in the wettability state towards intermediate wet conditions resulted in significant fractional flow enhancement this occurs due to the larger fluid solid interfacial area and rougher edges in the rock domain where strongly oil wet conditions significantly impact the oil phase flow rate and a relaxation of the wetting conditions has a stronger impact the domain topology in the rock domain provides a significant level of heterogeneity surface roughness and a large number of narrow pore spaces capable of isolating and holding small oil blobs on the other hand the large pore spaces and the smooth surfaces present in the spherepack domain provide a domain topology in which the fractional flow of the oil phase is only slightly improved under intermediate wet conditions despite the occurrence of cooperative pore filling events resulting in a significantly large oil cluster as we transition further towards weakly water wet figs 13d and 14d and strongly water wet figs 13e and 14e conditions for intermediate saturations of the oil phase we observe a reduction in the number of very small oil blobs and an increase in the size of the larger oil ganglia the transformation of the wettability state enables the creation of a dominant oil phase flow path in the rock domain where a large percentage of the oil in place resides in one large cluster fig 11h whereas we observe the creation of multiple large oil ganglia in the spherepack domain fig 11d the resulting oil ganglia distribution is a consequence of the enhanced ability of the water phase to remobilize previously trapped oil blobs and the breakup of the previously well connected oil clusters under oil wet conditions to smaller disconnected oil ganglia via snap off figs 11c and 11g pak et al 2015 the smaller remobilized oil ganglia have the potential to join the dominant oil phase flow path through coalescence figs 11d and 11h as a result the increase in the number of medium sized oil ganglia is the consequence of a combination of coalescence and snap off however the disconnected non wetting phase can still join the main flow path the non wetting phase ganglia which are not trapped continue to merge with the larger ones therefore contributing to the increase in the size of the larger oil cluster this behavior is more evident under strongly wetting conditions due to the increased capability of the non wetting phase to traverse the domain more readily primarily through the center of the large pores although the flow of the wetting phase in layers increases the likelihood of the non wetting phase becoming trapped via snap off this behavior is more prevalent in the small pores of the domain thus reducing the effect on the overall recovery and displacement efficiency bakhshian et al 2021 therefore the oil phase connectivity increases and the potential for enhanced oil recovery is improved since the oil phase is now more easily mobilized aziz et al 2020 a similar observation has been reported in bakhshian et al 2021 where an increase in the non wetting defending fluid connectivity was observed with a transition in the displacement process from drainage to imbibition the oil ganglia distribution under the larger c a is impacted by two competing forces the breakup of large oil ganglia into smaller ones due to greater viscous forces pak et al 2015 and increased coalescence events due to the greater ability of both phases to flow through previously inaccessible pores as a result the potential for oil ganglia remobilization increases under the larger c a due to the increased ability of the water phase to invade even narrower pore spaces where the oil phase is trapped moreover the prevalence of narrow pore throats in the rock domain increases the percentage of coalescence events in comparison to the well connected spherepack domain where the effect of viscous forces on the breakup of large oil ganglia is more influential however the larger frequency of coalescence events observed is due to the use of periodic boundary conditions where both phases are continuously allowed to re enter the domain the resulting effect on the oil ganglia distribution in the rock domain is an increase in the size of the larger oil ganglia fig s7e as shown in fig 12h on the other hand as observed in fig s6e we observe the breakup of the largest oil ganglia into a number of smaller ones under the higher c a in the spherepack domain the oil ganglia distribution and the degree of remobilization are dependent on the phase saturation and controlled primarily by the phase connectivity for example the oil phase demonstrates a larger degree of connectivity at higher oil phase saturations and the oil phase flows predominantly in highly connected layers in oil wet conditions and large ganglia in the center of the pore space in water wet conditions figs s8a e and s9a e therefore the majority of the domain is accessible to the oil phase in water wet conditions which limits the amount of oil phase trapping via snap off figs s8e and s9e the aforementioned observations and the resulting oil ganglia distributions remain largely consistent under the larger c a implying that the phase saturation is the more influential factor in dictating phase connectivity figs s10 s11 on the other hand the limited connectivity of the oil phase at lower saturations results in the opposite effect as the wettability state of the domain is altered to water wet conditions we observe a reduction in coalescence events due to the limited domain accessibility of the oil phase and a distribution of small oil ganglia sizes is observed figs s12 s13 the prominence of smaller oil ganglia without the formation of a larger oil ganglion is indicative of a prevalence of snap off events figs s12e and s13e this is expected since the water phase wetting phase now occupies the majority of the domain and the oil phase is more likely to become increasingly disconnected via snap off at lower oil phase saturations however at lower oil phase saturations the wider pore size distribution in the rock domain provides a larger number of previously inaccessible pores and a larger c a increases oil remobilization and coalescence events which results in a modest increase in the size of the larger oil ganglion fig s15e 4 conclusions and future work the current study sheds light on the complex pore scale behavior of multiphase flow in natural porous media as a result of the coupled influence of wettability alteration and domain topology a wettability alteration algorithm was developed to capture more accurate domain specific wettability altered states in two geometries a spherepack and a rock slice initially the simulations are conducted in an oil wet domain for varying saturations of the oil phase and the wettability alteration algorithm is utilized to track the relative wettability alteration the wettability alteration data is used to generate the new wettability states and the simulations are then performed on the wettability altered domains to analyze the resulting pore scale flow behavior an intermediate wet condition enhances the role of local pore topology which becomes the governing factor controlling the shape of the local interface and the resulting occurrence of an imbibition or drainage type event therefore the pore size distribution and the fluid solid interfacial area become very influential in controlling the local pore scale displacement pattern and the resulting flow pathways we observe a competition between the highly connected oil layers under oil wet conditions and increased cooperative pore filling events in weakly oil wet and intermediate wet conditions in enhancing the oil phase flow which explains the smaller impact on the oil phase fractional flow however for equal saturations of the two fluids improvements in the oil phase fractional flow were observed under both c a in the rock domain but only for the higher c a in the spherepack domain in intermediate wet conditions a larger percentage of narrower pore spaces increased surface roughness and a larger fluid solid interfacial area in the rock domain increase the trapping likelihood of smaller oil blobs which can be mobilized by relaxing the wettability condition at higher oil phase saturations the connectivity of the oil phase becomes more important in controlling the flow behavior and the effects due to wettability alteration are less pronounced the biggest relative improvements in the oil phase fractional flow were observed once the wettability state was transformed to the weakly water wet condition in both domains the new wettability state allows the water phase to invade the narrower pore spaces and displace the trapped oil phase moreover the oil layers break down into smaller oil ganglia located in various regions of the domain the smaller oil ganglia increasingly join the larger oil ganglia flowing through the center of the large pores via coalescence however the oil phase non wetting phase can also become disconnected from the main flow path via snap off the competition between coalescence and snap off events is strongly influenced by many factors such as the wettability condition capillary number phase saturation and domain topology a further transition towards strongly water wet conditions at the lower c a was only beneficial in the rock domain due to the greater trapping observed under oil wet conditions as a result of the increased domain heterogeneity furthermore the oil ganglia distribution under a larger c a is affected by the domain topology and is a result of the competition between two opposing mechanisms greater viscous forces causing the breakdown of larger oil ganglia and the increased ability of both phases to flow through previously inaccessible pores leading to a higher degree of oil ganglia remobilization and coalescence events although the pore scale displacement mechanisms locally are controlled by the local wettability distribution and pore topology the flow pathways are the result of the average of the interaction and competition between the local displacement mechanisms therefore assigning a random or uniform wettability distribution is not sufficient to capture the flow behavior and accurate geometry specific wettability characterization is integral towards designing and optimizing pore scale displacement processes the wettability alteration algorithm that is introduced in this work inherently captures the locations that interact the most with the wettability altering agent and provides insights into capillary trapping potential as a result the algorithm can prove extremely useful when investigating eor or co2 trapping potential especially when complemented with experimental wettability alteration correlations for different fluid systems credit authorship contribution statement mohamed n nemer conceptualization methodology software validation formal analysis investigation resources data curation writing original draft writing review editing visualization parthib r rao conceptualization methodology software resources writing review editing supervision laura schaefer conceptualization methodology validation resources writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is supported by the abu dhabi national oil company adnoc supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j advwatres 2021 104055 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 akai alhammadi blunt bijeljic 2019 t akai a m alhammadi m j blunt b bijeljic modeling oil recovery in mixed wet rocks pore scale comparison between experiment and simulation transp porous media 127 2 2019 393 414 akai t alhammadi a m blunt m j bijeljic b 2019 modeling oil recovery in mixed wet rocks pore scale comparison between experiment and simulation transport in porous media 127 2 393 414 akai blunt bijeljic 2020 t akai m j blunt b bijeljic pore scale numerical simulation of low salinity water flooding using the lattice boltzmann method j colloid interface sci 566 2020 444 453 akai t blunt m j bijeljic b 2020 pore scale numerical simulation of low salinity water flooding using the lattice boltzmann method journal of colloid and interface science 566 444 453 armstrong mcclure berrill rücker schlüter berg 2016 r t armstrong j e mcclure m a berrill m rücker s schlüter s berg beyond darcy s law the role of phase topology and ganglion dynamics for two fluid flow physical review e 94 4 2016 043113 armstrong r t mcclure j e berrill m a rücker m schlüter s berg s 2016 beyond darcy s law the role of phase topology and ganglion dynamics for two fluid flow physical review e 94 4 043113 arriola willhite green et al 1983 a arriola g p willhite d w green trapping of oil drops in a noncircular pore throat and mobilization upon contact with a surfactant society of petroleum engineers journal 23 01 1983 99 114 arriola a willhite g p green d w et al 1983 trapping of oil drops in a noncircular pore throat and mobilization upon contact with a surfactant society of petroleum engineers journal 23 01 99 114 aziz joekar niasar martínez ferrer godinez brizuela theodoropoulos mahani 2019 r aziz v joekar niasar p j martínez ferrer o e godinez brizuela c theodoropoulos h mahani novel insights into pore scale dynamics of wettability alteration during low salinity waterflooding sci rep 9 1 2019 1 13 aziz r joekar niasar v martínez ferrer p j godinez brizuela o e theodoropoulos c mahani h 2019 novel insights into pore scale dynamics of wettability alteration during low salinity waterflooding scientific reports 9 1 1 13 aziz niasar erfani martínez ferrer 2020 r aziz v niasar h erfani p j martínez ferrer impact of pore morphology on two phase flow dynamics under wettability alteration fuel 268 2020 117315 aziz r niasar v erfani h martínez ferrer p j 2020 impact of pore morphology on two phase flow dynamics under wettability alteration fuel 268 117315 bakhshian hosseini 2019 s bakhshian s a hosseini pore scale analysis of supercritical co2 brine immiscible displacement under fractional wettability conditions adv water resour 126 2019 96 107 bakhshian s hosseini s a 2019 pore scale analysis of supercritical co2 brine immiscible displacement under fractional wettability conditions advances in water resources 126 96 107 bakhshian hosseini shokri 2019 s bakhshian s a hosseini n shokri pore scale characteristics of multiphase flow in heterogeneous porous media using the lattice boltzmann method sci rep 9 1 2019 1 13 bakhshian s hosseini s a shokri n 2019 pore scale characteristics of multiphase flow in heterogeneous porous media using the lattice boltzmann method scientific reports 9 1 1 13 bakhshian rabbani hosseini shokri 2020 s bakhshian h s rabbani s a hosseini n shokri new insights into complex interactions between heterogeneity and wettability influencing two phase flow in porous media geophys res lett 47 14 2020 e2020gl088187 bakhshian s rabbani h s hosseini s a shokri n 2020 new insights into complex interactions between heterogeneity and wettability influencing two phase flow in porous media geophysical research letters 47 14 e2020gl088187 bakhshian rabbani shokri 2021 s bakhshian h s rabbani n shokri physics driven investigation of wettability effects on two phase flow in natural porous media recent advances new insights and future perspectives transp porous media 2021 1 22 bakhshian s rabbani h s shokri n 2021 physics driven investigation of wettability effects on two phase flow in natural porous media recent advances new insights and future perspectives transport in porous media 1 22 bartels mahani berg hassanizadeh 2019 w b bartels h mahani s berg s hassanizadeh literature review of low salinity waterflooding from a length and time scale perspective fuel 236 2019 338 353 bartels w b mahani h berg s hassanizadeh s 2019 literature review of low salinity waterflooding from a length and time scale perspective fuel 236 338 353 berg cense jansen bakker 2010 s berg a cense e jansen k bakker direct experimental evidence of wettability modification by low salinity petrophysics the spwla journal of formation evaluation and reservoir description 51 05 2010 berg s cense a jansen e bakker k 2010 direct experimental evidence of wettability modification by low salinity petrophysics the spwla journal of formation evaluation and reservoir description 51 05 blunt king scher 1992 m blunt m j king h scher simulation and theory of two phase flow in porous media physical review a 46 12 1992 7680 blunt m king m j scher h 1992 simulation and theory of two phase flow in porous media physical review a 46 12 7680 blunt 2017 m j blunt multiphase flow in permeable media a pore scale perspective 2017 cambridge university press blunt m j 2017 multiphase flow in permeable media a pore scale perspective cambridge university press buckley liu 1998 j buckley y liu some mechanisms of crude oil brine solid interactions journal of petroleum science and engineering 20 3 4 1998 155 160 buckley j liu y 1998 some mechanisms of crude oil brine solid interactions journal of petroleum science and engineering 20 3 4 155 160 buckley leverett et al 1942 s e buckley m leverett mechanism of fluid displacement in sands transactions of the aime 146 01 1942 107 116 buckley s e leverett m et al 1942 mechanism of fluid displacement in sands transactions of the aime 146 01 107 116 chatzis morrow lim et al 1983 i chatzis n r morrow h t lim magnitude and detailed structure of residual oil saturation society of petroleum engineers journal 23 02 1983 311 326 chatzis i morrow n r lim h t et al 1983 magnitude and detailed structure of residual oil saturation society of petroleum engineers journal 23 02 311 326 chen doolen 1998 s chen g d doolen lattice boltzmann method for fluid flows annu rev fluid mech 30 1 1998 329 364 chen s doolen g d 1998 lattice boltzmann method for fluid flows annual review of fluid mechanics 30 1 329 364 churcher french shaw schramm et al 1991 p churcher p french j shaw l schramm rock properties of berea sandstone baker dolomite and indiana limestone spe international symposium on oilfield chemistry 1991 society of petroleum engineers churcher p french p shaw j schramm l et al 1991 rock properties of berea sandstone baker dolomite and indiana limestone in spe international symposium on oilfield chemistry society of petroleum engineers cieplak robbins 1990 m cieplak m o robbins influence of contact angle on quasistatic fluid invasion of porous media physical review b 41 16 1990 11508 cieplak m robbins m o 1990 influence of contact angle on quasistatic fluid invasion of porous media physical review b 41 16 11508 du shi chen 2006 r du b shi x chen multi relaxation time lattice boltzmann model for incompressible flow phys lett a 359 6 2006 564 572 du r shi b chen x 2006 multi relaxation time lattice boltzmann model for incompressible flow physics letters a 359 6 564 572 edery berg weitz 2018 y edery s berg d weitz surfactant variations in porous media localize capillary instabilities during haines jumps phys rev lett 120 2 2018 028005 edery y berg s weitz d 2018 surfactant variations in porous media localize capillary instabilities during haines jumps physical review letters 120 2 028005 flovik sinha hansen 2015 v flovik s sinha a hansen dynamic wettability alteration in immiscible two phase flow in porous media effect on transport properties and critical slowing down front phys 3 2015 86 flovik v sinha s hansen a 2015 dynamic wettability alteration in immiscible two phase flow in porous media effect on transport properties and critical slowing down frontiers in physics 3 86 golparvar zhou wu ma yu 2018 a golparvar y zhou k wu j ma z yu a comprehensive review of pore scale modeling methodologies for multiphase flow in porous media advances in geo energy research 2 4 2018 418 440 golparvar a zhou y wu k ma j yu z 2018 a comprehensive review of pore scale modeling methodologies for multiphase flow in porous media advances in geo energy research 2 4 418 440 gunstensen rothman zaleski zanetti 1991 a k gunstensen d h rothman s zaleski g zanetti lattice boltzmann model of immiscible fluids physical review a 43 8 1991 4320 gunstensen a k rothman d h zaleski s zanetti g 1991 lattice boltzmann model of immiscible fluids physical review a 43 8 4320 he chen zhang 1999 x he s chen r zhang a lattice boltzmann scheme for incompressible multiphase flow and its application in simulation of rayleigh taylor instability j comput phys 152 2 1999 642 663 he x chen s zhang r 1999 a lattice boltzmann scheme for incompressible multiphase flow and its application in simulation of rayleigh taylor instability journal of computational physics 152 2 642 663 he luo 1997 x he l s luo lattice boltzmann model for the incompressible navier stokes equation j stat phys 88 3 4 1997 927 944 he x luo l s 1997 lattice boltzmann model for the incompressible navier stokes equation journal of statistical physics 88 3 4 927 944 holtzman segre 2015 r holtzman e segre wettability stabilizes fluid invasion into porous media via nonlocal cooperative pore filling phys rev lett 115 16 2015 164501 holtzman r segre e 2015 wettability stabilizes fluid invasion into porous media via nonlocal cooperative pore filling physical review letters 115 16 164501 hou wang huang 2015 b f hou y f wang y huang mechanistic study of wettability alteration of oil wet sandstone surface using different surfactants appl surf sci 330 2015 56 64 hou b f wang y f huang y 2015 mechanistic study of wettability alteration of oil wet sandstone surface using different surfactants applied surface science 330 56 64 huang thorne jr schaap sukop 2007 h huang d t thorne jr m g schaap m c sukop proposed approximation for contact angles in shan and chen type multicomponent multiphase lattice boltzmann models physical review e 76 6 2007 066701 huang h thorne jr d t schaap m g sukop m c 2007 proposed approximation for contact angles in shan and chen type multicomponent multiphase lattice boltzmann models physical review e 76 6 066701 iglauer fernø shearing blunt 2012 s iglauer m fernø p shearing m blunt comparison of residual oil cluster size distribution morphology and saturation in oil wet and water wet sandstone j colloid interface sci 375 1 2012 187 192 iglauer s fernø m shearing p blunt m 2012 comparison of residual oil cluster size distribution morphology and saturation in oil wet and water wet sandstone journal of colloid and interface science 375 1 187 192 jerauld webb lin seccombe 2008 g r jerauld k j webb c y lin j c seccombe modeling low salinity waterflooding spe reservoir evaluation engineering 11 06 2008 1000 1012 jerauld g r webb k j lin c y seccombe j c 2008 modeling low salinity waterflooding spe reservoir evaluation engineering 11 06 1000 1012 jiang wu couples van dijke sorbie ma 2007 z jiang k wu g couples m i j van dijke k s sorbie j ma efficient extraction of networks from three dimensional porous media water resour res 43 12 2007 jiang z wu k couples g van dijke m i j sorbie k s ma j 2007 efficient extraction of networks from three dimensional porous media water resources research 43 12 joekar niasar hassanizadeh 2012 v joekar niasar s hassanizadeh analysis of fundamentals of two phase flow in porous media using dynamic pore network models a review crit rev environ sci technol 42 18 2012 1895 1976 joekar niasar v hassanizadeh s 2012 analysis of fundamentals of two phase flow in porous media using dynamic pore network models a review critical reviews in environmental science and technology 42 18 1895 1976 kovscek wong radke 1993 a kovscek h wong c radke a pore level scenario for the development of mixed wettability in oil reservoirs alche j 39 6 1993 1072 1085 kovscek a wong h radke c 1993 a pore level scenario for the development of mixed wettability in oil reservoirs aiche journal 39 6 1072 1085 krüger kusumaatmaja kuzmin shardt silva viggen 2017 t krüger h kusumaatmaja a kuzmin o shardt g silva e m viggen the lattice boltzmann method principles and practice 10 2017 springer krüger t kusumaatmaja h kuzmin a shardt o silva g viggen e m 2017 the lattice boltzmann method principles and practice vol 10 springer lallemand luo 2000 p lallemand l s luo theory of the lattice boltzmann method dispersion dissipation isotropy galilean invariance and stability physical review e 61 6 2000 6546 lallemand p luo l s 2000 theory of the lattice boltzmann method dispersion dissipation isotropy galilean invariance and stability physical review e 61 6 6546 landry karpyn ayala 2014 c landry z karpyn o ayala relative permeability of homogenous wet and mixed wet porous media as determined by pore scale lattice boltzmann modeling water resour res 50 5 2014 3672 3689 landry c karpyn z ayala o 2014 relative permeability of homogenous wet and mixed wet porous media as determined by pore scale lattice boltzmann modeling water resources research 50 5 3672 3689 li pan miller 2005 h li c pan c t miller pore scale investigation of viscous coupling effects for two phase flow in porous media physical review e 72 2 2005 026705 li h pan c miller c t 2005 pore scale investigation of viscous coupling effects for two phase flow in porous media physical review e 72 2 026705 li galindo torres yan scheuermann li 2018 z li s galindo torres g yan a scheuermann l li a lattice boltzmann investigation of steady state fluid distribution capillary pressure and relative permeability of a porous medium effects of fluid and geometrical properties adv water resour 116 2018 153 166 li z galindo torres s yan g scheuermann a li l 2018 a lattice boltzmann investigation of steady state fluid distribution capillary pressure and relative permeability of a porous medium effects of fluid and geometrical properties advances in water resources 116 153 166 liu kang leonardi schmieschek narváez jones williams valocchi harting 2016 h liu q kang c r leonardi s schmieschek a narváez b d jones j r williams a j valocchi j harting multiphase lattice boltzmann simulations for porous media applications comput geosci 20 4 2016 777 805 liu h kang q leonardi c r schmieschek s narváez a jones b d williams j r valocchi a j harting j 2016 multiphase lattice boltzmann simulations for porous media applications computational geosciences 20 4 777 805 liu zhang valocchi 2015 h liu y zhang a j valocchi lattice boltzmann simulation of immiscible fluid displacement in porous media homogeneous versus heterogeneous pore network physics of fluids 27 5 2015 052103 liu h zhang y valocchi a j 2015 lattice boltzmann simulation of immiscible fluid displacement in porous media homogeneous versus heterogeneous pore network physics of fluids 27 5 052103 mahani berg ilic bartels joekar niasar et al 2015 h mahani s berg d ilic w b bartels v joekar niasar kinetics of low salinity flooding effect spe j 20 01 2015 8 20 mahani h berg s ilic d bartels w b joekar niasar v et al 2015 kinetics of low salinity flooding effect spe journal 20 01 8 20 martys chen 1996 n s martys h chen simulation of multicomponent fluids in complex three dimensional geometries by the lattice boltzmann method physical review e 53 1 1996 743 martys n s chen h 1996 simulation of multicomponent fluids in complex three dimensional geometries by the lattice boltzmann method physical review e 53 1 743 mccracken abraham 2005 m e mccracken j abraham multiple relaxation time lattice boltzmann model for multiphase flow physical review e 71 3 2005 036701 mccracken m e abraham j 2005 multiple relaxation time lattice boltzmann model for multiphase flow physical review e 71 3 036701 melrose et al 1965 j c melrose wettability as related to capillary action in porous media society of petroleum engineers journal 5 03 1965 259 271 melrose j c et al 1965 wettability as related to capillary action in porous media society of petroleum engineers journal 5 03 259 271 moebius or 2014 f moebius d or pore scale dynamics underlying the motion of drainage fronts in porous media water resour res 50 11 2014 8441 8457 moebius f or d 2014 pore scale dynamics underlying the motion of drainage fronts in porous media water resources research 50 11 8441 8457 nemer rao schaefer 2020 m n nemer p r rao l schaefer wettability alteration implications on pore scale multiphase flow in porous media using the lattice boltzmann method adv water resour 2020 103790 nemer m n rao p r schaefer l 2020 wettability alteration implications on pore scale multiphase flow in porous media using the lattice boltzmann method advances in water resources 103790 pak butler geiger van dijke sorbie 2015 t pak i b butler s geiger m i van dijke k s sorbie droplet fragmentation 3d imaging of a previously unidentified pore scale process during multiphase flow in porous media proceedings of the national academy of sciences 112 7 2015 1947 1952 pak t butler i b geiger s van dijke m i sorbie k s 2015 droplet fragmentation 3d imaging of a previously unidentified pore scale process during multiphase flow in porous media proceedings of the national academy of sciences 112 7 1947 1952 pan hilpert miller 2004 c pan m hilpert c miller lattice boltzmann simulation of two phase flow in porous media water resour res 40 1 2004 pan c hilpert m miller c 2004 lattice boltzmann simulation of two phase flow in porous media water resources research 40 1 porter coon kang moulton carey 2012 m l porter e coon q kang j moulton j carey multicomponent interparticle potential lattice boltzmann model for fluids with large viscosity ratios physical review e 86 3 2012 036701 porter m l coon e kang q moulton j carey j 2012 multicomponent interparticle potential lattice boltzmann model for fluids with large viscosity ratios physical review e 86 3 036701 qian orszag 1993 y qian s orszag lattice bgk models for the navier stokes equation nonlinear deviation in compressible regimes epl europhysics letters 21 3 1993 255 qian y orszag s 1993 lattice bgk models for the navier stokes equation nonlinear deviation in compressible regimes epl europhysics letters 21 3 255 rabbani zhao juanes shokri 2018 h s rabbani b zhao r juanes n shokri pore geometry control of apparent wetting in porous media sci rep 8 1 2018 1 8 rabbani h s zhao b juanes r shokri n 2018 pore geometry control of apparent wetting in porous media scientific reports 8 1 1 8 ramstad idowu nardi øren 2012 t ramstad n idowu c nardi p e øren relative permeability calculations from two phase flow simulations directly on digital images of porous rocks transp porous media 94 2 2012 487 504 ramstad t idowu n nardi c øren p e 2012 relative permeability calculations from two phase flow simulations directly on digital images of porous rocks transport in porous media 94 2 487 504 ramstad øren bakke et al 2010 t ramstad p e øren s bakke simulation of two phase flow in reservoir rocks using a lattice boltzmann method spe j 15 04 2010 917 927 ramstad t øren p e bakke s et al 2010 simulation of two phase flow in reservoir rocks using a lattice boltzmann method spe journal 15 04 917 927 rao schaefer 2019 p rao l schaefer lattice boltzmann models for micro tomographic pore spaces computers fluids 193 2019 104294 rao p schaefer l 2019 lattice boltzmann models for micro tomographic pore spaces computers fluids 193 104294 saxena hofmann alpak berg dietderich agarwal tandon hunter freeman wilson 2017 n saxena r hofmann f o alpak s berg j dietderich u agarwal k tandon s hunter j freeman o b wilson and benchmarks for pore scale flow simulated using micro ct images of porous media and digital rocks adv water resour 109 2017 211 235 saxena n hofmann r alpak f o berg s dietderich j agarwal u tandon k hunter s freeman j wilson o b 2017 
237,the objective of this paper is to investigate the interplay between wettability alteration and domain geometry in influencing the pore scale displacement and trapping mechanisms of two phase flow in porous media a new wettability alteration algorithm is introduced to quantify and track the spatial and temporal variability of the wettability state of every pore simulations in an initially oil wet domain are conducted using the lattice boltzmann model while utilizing the wettability alteration algorithm to capture the new wettability states the simulations are then resumed under the new generated wettability states to investigate the coupled impacts of wettability alteration and domain topology on the resulting pore scale displacement behavior we observe varying degrees of improvements in the oil phase fractional flow as the wettability state is varied towards water wet conditions influenced by the domain geometry capillary number and phase saturation significant heterogeneity increased surface roughness and the prevalence of narrower pore spaces in the rock sample in comparison to the spherepack increase the percentage of trapped oil ganglia as a result wettability alteration results in varying degrees of oil remobilization events followed by coalescence with the main flow path especially at higher capillary numbers moreover oil phase fractional flow at higher oil saturation becomes influenced primarily by the increased phase connectivity and improvements due to wettability alteration become less significant similar displacement mechanisms are observed in both domains controlled primarily by the wettability distribution and the local pore geometry however the resulting flow pathways which dictate the overall flow behavior are controlled by the frequency of various displacement mechanisms and are a function of the domain geometry the observations in this study highlight the complex interactions between wettability heterogeneity and pore geometry in influencing pore scale two phase flow the wettability alteration algorithm introduced can be used to optimize pore scale displacement processes by providing a framework to track the locations and the relative degree of wettability alteration enable automatic wettability alteration and detect trapped ganglia without the need for post processing keywords wettability wettability alteration algorithm two phase flow in porous media lattice boltzmann method pore scale simulation pore scale displacement mechanisms 1 introduction the physics of multiphase flow in porous media influences a wide variety of the most urgent challenges facing the world including ensuring energy security and clean water availability while alleviating the adverse effects of human activity on climate change an enhanced understanding of the associated physical phenomena governing the flow of fluids in subsurface rock formations has far reaching implications in many scientific applications including hydrocarbon extraction contaminant remediation and co2 sequestration efforts blunt 2017 the main challenge associated with characterizing and understanding the pore scale physics of multiphase flow in geologic porous media stems from the highly heterogeneous topology of these formations armstrong et al 2016 moreover the wettability of a porous medium which is defined as the affinity with which the various immiscible fluids attach to the medium s solid surface plays a significant role in influencing the pore scale flow behavior and the resulting macroscale flow properties of multiphase flow in porous media warner 2015 nemer et al 2020 the wettability distribution controls the local interface instabilities and the resulting displacement patterns where a shift in the mechanism controlling the growth of the invading cluster from burst to overlap cooperative pore filling occurs as the domain becomes more wetting with respect to the invading fluid cieplak and robbins 1990 melrose et al 1965 holtzman and segre 2015 bakhshian et al 2020 on the other hand the impact of local pore geometry in controlling and influencing the pore scale displacement mechanisms cannot be overstated especially in natural heterogeneous systems bakhshian et al 2019 the interplay between the topology of a medium and the wettability distribution heavily influences the relative permeability characteristics of the rock in addition to the capillary trapping mechanisms arriola et al 1983 buckley et al 1942 for example the oil ganglia trapping which occurs at the end of waterflooding is a direct consequence of the domain topology and is influenced primarily by the wettability of the medium in strongly wetting systems the wetting phase is located in the narrower regions of the pore space and flows in the form of thin films over the rock surface thus allowing the non wetting phase to occupy the center of the large pores and potentially be trapped by capillary forces in the form of ganglia bakhshian et al 2020 iglauer et al 2012 an improved understanding of the domain topology and wettability interdependence and the resulting capillary trapping is integral towards designing strategies that suppress or increase residual trapping towards enhanced hydrocarbon recovery and improved co2 sequestration respectively the wettability of the domain is a valuable control parameter that can be modified to improve the oil recovery factor and design successful enhanced oil recovery eor techniques such as low salinity waterflooding lswf tang et al 1997 tang and morrow 1999 and surfactant flooding standnes and austad 2000 hou et al 2015 although various mechanisms have been proposed to explain the greater recovery observed during low salinity waterflooding it is commonly suggested that the most likely reason behind the improved recovery is wettability alteration mahani et al 2015 bartels et al 2019 and that a shift in the wettability state from a strongly oil wet condition to a neutral wet or a water wet condition has a significant impact on the extent and rate of increase in the oil recovery efficiency tweheyo et al 1999 furthermore it has been demonstrated that wettability alteration due to lswf also favorably impacts macroscale parameters such as relative permeability and capillary pressure jerauld et al 2008 however the impacts on the pore scale flow behavior and the coupled influence of medium topology are less understood and there is a need for studies that bridge the gap between the physics observed in the sub pore scale and the core scale in order to advance our understanding of flow in mixed wet systems bartels et al 2019 a heterogeneous wettability distribution is typically encountered in most reservoirs in addition the wetting characteristics vary between reservoirs and display spatial heterogeneity from one pore to another from strongly oil water wet to intermediate wet characteristics which results in significant implications on the pore scale flow details wettability also displays a temporal dependence where for example a permanent wettability alteration occurs during drainage due to polar interactions and adsorption of asphaltenes on the grain surface kovscek et al 1993 buckley and liu 1998 moreover wettability alteration is observed during secondary and tertiary lswf which directly impacts the pore scale fluid configurations and the recovery factor aziz et al 2019 akai et al 2020 an altered wettability state of a reservoir is a function of the initial fluid distribution and composition the initial wettability state the portion of the domain where wettability alteration occurs and the degree of wettability alteration in our previous study nemer et al 2020 we conducted a systematic analysis of the relative importance of the wettability altered fraction the degree of wettability alteration and the accurate contact angle assignment and their effects on relative permeability and pore scale fluid configurations in order to better understand the quantitative and qualitative influence of wettability alteration on the pore scale and macroscale flow properties we found that the relative permeability and flow behavior are influenced primarily by the fraction of the pores undergoing wettability alteration and we observed a dependency for the remaining two factors where the degree of alteration and accurate contact angle assignment become more important in a domain with a larger wettability altered fraction a parametric investigation of the pore scale flow behavior due to the coupled influence of wettability alteration and domain topology using experimental approaches is difficult which highlights the need for a computational approach the lattice boltzmann method lbm is a powerful numerical technique that is commonly used to simulate multiphase flow in complex porous media since it can be easily implemented alongside micro computed tomography micro ct scanned images of real porous media samples as a result the lbm is better suited for an investigation centered around the complex topology of porous media over pore scale network modeling in which domain simplifications are used to capture the medium heterogeneity jiang et al 2007 moreover the lbm overcomes the main difficulties associated with grid based computational fluid dynamics methods which are capturing and tracking the dynamic fluid fluid interface golparvar et al 2018 liu et al 2016 since the interface arises automatically in the pseudo potential lbm due to phase separation chen and doolen 1998 in addition the method s suitability for parallel implementation due to local computations significantly improves its computational efficiency a number of multiphase models based on the lbm are commonly used such as the pseudo potential model shan and chen 1993 color gradient model gunstensen et al 1991 free energy model swift et al 1996 and mean field model he et al 1999 the lbm has been widely and rigorously used to model multiphase flow and validate experimental capillary pressure and relative permeability measurements in spherepacks and realistic pore structures pan et al 2004 tsuji et al 2016 li et al 2018 ramstad et al 2012 lattice boltzmann studies focused primarily on the impact of wettability in both homogeneous and mixed wet systems are steadily increasing nemer et al 2020 landry et al 2014 zhao et al 2018 bakhshian and hosseini 2019 akai et al 2019 in the study of bakhshian et al 2020 the coupled influence of pore geometry and wettability on the pore scale flow dynamics of two phase flow in porous media was investigated using the lbm in two domains of varying heterogeneity and under a wide range of uniform contact angles 25 θ 175 although uniform wet systems are rarely encountered in real porous media the complex nature of multiphase flow in mixed wet systems has not been fully investigated due to the challenges associated with characterizing local wettability alteration for example the wettability distribution in mixed and fractionally wet systems is typically assigned randomly or by altering the wettability at the portions of the domain in contact with the wettability altering agent at the end of the simulations zhao et al 2018 bakhshian and hosseini 2019 landry et al 2014 in real systems the wettability alteration shows a temporal dependence where the relative change in wettability at various regions in the system is proportional to the reaction time with the wettability altering agents an investigation has been conducted in flovik et al 2015 where a two phase network model was complemented with a wettability alteration mechanism dependent on the cumulative flow of the wettability altering agent through the various pores the extent and rate of remobilization and fractional flow improvements were found to be correlated with the degree of wettability alteration moreover in the study of akai et al 2019 the importance of capturing accurate contact angle distributions and the resulting impact on the pore scale and macroscale flow behavior was demonstrated by incorporating in situ measured experimental contact angles as a result a wettability alteration algorithm that can capture the spatial and time dependent variation in the wettability state of every single pore as a function of the domain topology is a valuable tool when investigating eor techniques and co2 sequestration potential using direct numerical simulations of multiphase flow in porous media the objective of this study is to investigate the interplay and interconnection between domain and wettability heterogeneity in influencing multiphase flow dynamics and the resulting pore scale flow mechanisms in order to conduct the investigation a wettability alteration algorithm is developed to track the time dependent and relative wettability alteration occurring in the domain we conduct two phase simulations at varying saturations of the two immiscible fluids in a two dimensional oil wet domain while tracking the expected locations and relative magnitude of wettability alteration although the extent of phase percolation is highly dependent on dimensionality the aim of the investigation is to provide an algorithm capable of tracking wettability alteration regardless of domain dimensionality and capture the dominant pore scale displacement mechanisms as a function of the updated wettability states four altered wettability states weakly oil wet intermediate wet weakly water wet and strongly water wet are generated based on the histogram of the wettability alteration data the simulations are then resumed under the new wettability states to draw insight into the resulting pore scale mechanisms due to wettability alteration which influence the macroscale behavior and the recovery efficiency in order to investigate the interplay between domain topology and wettability alteration the simulations will be performed on two domains of equal porosity and varying degrees of heterogeneity a spherepack and a rock berea sandstone sample in the next section the shan chen multi relaxation time multicomponent lattice boltzmann model with explicit forcing will be introduced in addition to the wettability alteration algorithm and the domains to be investigated the model will then be used to investigate the coupled impacts of wettability alteration and pore geometry on two phase flow by analyzing fractional flow effects pore scale fluid displacement mechanisms and oil ganglia dynamics 2 methods 2 1 shan chen multicomponent lattice boltzmann method in this section the shan chen multicomponent lb model with explicit forcing is introduced porter et al 2012 the lbm is centered around solving the lattice boltzmann equation lbe which is obtained by discretizing the boltzmann equation as shown in wolf gladrow 2004 krüger et al 2017 and can be characterized as a discrete approximation of the incompressible navier stokes equations li et al 2005 the fluid flow behavior is represented by distribution functions of fluid particles residing on a regular lattice which stream and collide wolf gladrow 2004 krüger et al 2017 the lbe tracks the evolution of the discrete velocity distribution function f i σ x t corresponding to a component σ at location x and time t with a discrete velocity e i 1 f i σ x e i δ t t δ t f i σ x t ω i σ i 0 1 b 1 where δ t is the length of the time step b is the total number of discrete velocity vectors in the lattice and ω i σ is the discrete collision operator the d2q9 lattice is used in this work where d2 represents the number of dimensions and q9 represents the number of discrete velocities qian and orszag 1993 the mrt collision operator is utilized due to the superior performance it has demonstrated over the standard bhatnagar gross krook bgk collision operator lallemand and luo 2000 in the mrt collision model mccracken and abraham 2005 du et al 2006 wang et al 2010 rao and schaefer 2019 the streaming process is carried out in the velocity space and the collision process occurs in the moment space the mrt collision process is summarized as 2 ω σ m 1 s σ m f σ x t f σ eq x t where m is a b b transformation matrix which transforms the b dimensional particle distribution function vector f σ in the velocity space to a b dimensional vector m σ in the moment space such that 3 m σ m f σ m σ eq m f σ eq the term f i σ eq x t is the equilibrium particle distribution function and is expressed as 4 f i σ eq w i ρ σ 1 e i u eq c s 2 e i u eq 2 2 c s 4 u eq u eq 2 c s 2 where w i presented in eq 5 represents the weight associated with a specific discrete velocity e i 5 w 4 9 1 9 1 9 1 9 1 9 1 36 1 36 1 36 1 36 and c s is the pseudo speed of sound which is model dependent 6 c s 2 1 3 c 2 1 3 δ x 2 δ t 2 the relaxation rate matrix s is a diagonal matrix of the various relaxation rates given by 7 s d i a g s ρ σ s e σ s ε σ s j σ s q σ s j σ s q σ s v σ s v σ and the kinematic viscosity v of the fluid is set by the relaxation rate s v σ krüger et al 2017 8 v c s 2 1 s v σ δ t 2 the resulting lbe evolution equation with the mrt collision operator and in the presence of external forcing is presented in eq 9 9 f σ x e i δ t t δ t f σ x t m 1 s σ m f σ x t f σ eq x t m 1 i s 2 σ m f σ x t where f σ x t is the forcing term and is defined as porter et al 2012 10 f i σ f σ e i u eq ρ σ c s 2 f i σ eq the macroscopic density ρ and velocity u of the σ component at a fluid node are obtained from the moments of the particle distribution function and the macroscopic velocity equation is force corrected due to external forcing 11 ρ σ x i 0 b 1 f i σ x 12 u σ x 1 ρ σ x i 0 b 1 f i σ x e i δ t 2 f σ the equilibrium velocity is used in computing the equilibrium particle distribution function porter et al 2012 eq 4 and is given by 13 u eq x σ σ s v σ ρ σ u σ σ σ s v σ ρ σ the forcing term f σ is the sum of all forces acting on a component which include the fluid fluid interaction force f f σ the fluid solid interaction force f s σ and any external forces f ext σ ρ σ g martys and chen 1996 14 f σ f f σ f s σ f ext σ the shan chen fluid fluid interaction force is the sum of the forces between components σ and σ at two neighboring lattice sites and is given by shan and doolen 1995 15 f f σ g σ σ ρ σ x t i 0 b 1 w i ρ σ x e i δ t t e i δ t where g σ σ is the strength of the interparticle force and is positive in order to result in a repulsive force and immiscible components the interfacial tension between the fluid pair is determined by the interaction strength g σ σ and is chosen to be large enough to produce phase segregation huang et al 2007 the wetting boundary condition is assigned using the fluid solid interaction force martys and chen 1996 16 f s σ g σ s ρ σ x t i 0 b 1 w i s x e i δ t t e i δ t where g σ s is strength of the interaction between a fluid component σ and the solid boundary and s x e i δ t t is an indicator function that is set to 0 for fluid nodes and 1 for solid nodes the interaction strength is attractive for a wetting fluid g σ s 0 and repulsive for a non wetting fluid g σ s 0 the resulting contact angle θ can be varied by altering the values of the interaction strengths of the two fluid components while maintaining g σ s g σ s a plot of the resulting contact angles for different values of g σ s is provided in our previous work nemer et al 2020 2 2 simulation domains and model parameters in this work the simulations are conducted in a spherepack homogeneous slice and a rock heterogeneous slice as shown in fig 1 the spherepack and rock slices are obtained by micro ct scanning with a resolution of 7 μ m and 2 114 μ m respectively saxena et al 2017 the original rock structure is from a berea sandstone churcher et al 1991 the rock slice shown in fig 1 was obtained after a number of morphological operations were performed to eliminate dead end pores and enhance throat connectivity such that the resulting porosity is equal to the porosity of the spherepack sample and is a controlled factor in the investigation the resulting porosity of the domains shown in fig 1 is 0 34 the simulation domain sizes in the spherepack and rock domains are 601 601 l u 2 and 1024 1024 l u 2 respectively in the investigations to be conducted in this study the density of the wetting and non wetting fluids are set to unity in lattice units ρ w ρ n w 1000 k g m 3 the viscosity ratio is also set to 1 in a capillary force dominated regime this approximation is sufficient for a water and non aqueous phase liquid system since the density and viscosity are of the same order of magnitude li et al 2018 the interfacial tension is defined using the young laplace test in which the value of the fluid fluid interaction parameter that results in phase segregation between the two components is determined g σ σ 3 1 the young laplace test involves initializing droplets of varying radii of one fluid suspended in the second fluid the pressure difference across the droplet at equilibrium is plotted against the reciprocal of the final droplet radius and the slope of the plot is the interfacial tension in lattice units σ 0 0925 15 m n m the lattice units are converted to physical units through a determination of scaling quantities for length l time t and fluid density m zhao et al 2018 liu et al 2015 ramstad et al 2010 the bounce back boundary condition he and luo 1997 is assigned at the solid nodes and periodic boundary conditions are implemented in the x and y directions in order to highlight capillary number effects the simulations are performed under two capillary numbers c a 6 5 10 4 and 1 1 10 3 2 3 wettability alteration algorithm as mentioned earlier the wettability of a reservoir varies spatially and temporally during a displacement process for example during low salinity waterflooding as low salinity water migrates into a reservoir saturated with oil the interactions between the low salinity water and the solid matrix alter the wettability of the domain over time berg et al 2010 in order to capture this effect in the simulations we utilize a scalar field to monitor the interactions between the two components and the solid matrix the wettability alteration scalar field w for each component σ σ is initially set to 0 at every solid node location as the simulation proceeds we track the location of the two components and increment the w field associated with the component residing on the corresponding solid node based on a predetermined density threshold the w field can be incremented every n time steps where n can be chosen arbitrarily by tracking the w field we account for water displacing oil and vice versa from any solid location in our investigations the actual wettability alteration of the domain is performed once the simulations are stopped and new wettability states are generated however in the future to ensure the true time dependent nature of the algorithm specific thresholds will be set such that once the w field crosses the defined threshold for a specific new wettability state the wettability state of the domain is automatically updated these thresholds can be determined using experimental studies aimed at developing wettability alteration correlations for various fluid systems the new wettability states are incorporated by varying the fluid solid interaction parameter introduced earlier at a specific simulation time or once the simulation has run the relative degree of wettability alteration is obtained as follows and as shown in the pseudocode detailing the procedure provided in algorithm 1 given below the w fields for the two components are divided by the absolute maximum value between the two fields therefore the w field which contains the maximum value will have values normalized between 0 and 1 while the other field will have values between 0 and a value smaller than 1 x once this step has been performed a global wettability alteration field is computed by subtracting the two w fields the new global w field contains values between x 1 assuming the w field for oil contained the maximum value from the two fields values closest to 1 in the global w field signify solid locations that are most likely to remain oil wet while values closest to x represent the locations where wettability alteration towards a water wet state is expected to occur a histogram of the global w field data reveals the relative degree of wettability alteration in the domain and a contour plot of the data leads to the locations of wettability alteration there are a number of advantages associated with tracking wettability alteration using this approach the fraction of the domain undergoing wettability alteration plays a very important role in influencing the flow dynamics of mixed wet systems nemer et al 2020 which the algorithm inherently captures the relative degree of wettability alteration can be captured by comparing the scalar values to track the locations that interact the most with the wettability altering agent which can be useful in enhancing eor techniques moreover the same algorithm can be applied to identify the locations where disconnected oil or co2 ganglia reside in order to better understand capillary trapping mechanisms additional advantages of the algorithm are the inherent simplicity low computational cost and the potential compatibility with various fluid systems by utilizing different experimentally defined correlations as a result the wettability alteration algorithm introduced provides a valuable and efficient framework towards accurately tracking and performing wettability alteration in addition to automatically detecting trapped ganglia without post processing 3 results and discussion 3 1 generation of new wettability states the initial simulations are performed in an oil wet θ 160 domain for varying saturations of the wettability altering fluid s w 0 25 0 5 0 75 the fluids are initialized according to the procedure outlined in nemer et al 2020 li et al 2018 and periodic boundary conditions are implemented in the x and y directions thus resembling drainage and imbibition processes occurring simultaneously the objective of these simulations is to track the location and relative magnitude of wettability alteration using the developed algorithm once the wettability state has been altered the simulations are resumed under the new wettability states and the effects on the oil phase fractional flow and the pore scale flow details are investigated the simulations prior to wettability alteration are performed on both the spherepack and rock domains under the two capillary numbers specified as mentioned earlier an initial simulation is conducted in an oil wet domain for various distinct saturations of the two components s w 0 25 0 5 0 75 at the end of the simulations in the initially oil wet domain a histogram of the global w field is generated to determine the relative magnitude of wettability alteration furthermore a contour plot of the global w field provides insight into the regions expected to have higher lower rates of wettability alteration since it is determined by the time of reaction with the wettability altering agent water the global w field data are scalar values that summarize the temporal interactions of the two phases at every solid node in the domain in order to generate the new wettability states the overall range of scalar values in the normalized global wettability alteration field data is divided into smaller distinct intervals a bar graph of the frequency of occurrence of the various interaction times global wettability alteration field distribution within these smaller intervals is generated for each distinct saturation of the wettability altering agent as a result a bar graph of the global wettability alteration field distribution which is a function of the phase saturation is provided in the various rows of figs 2 and 3 currently however the algorithm does not propose or utilize a relationship between interaction time and contact angle therefore the degree of wettability alteration for each set of distinct saturations is investigated by generating weakly oil wet intermediate wet weakly water wet and strongly water wet domains from the same aforementioned global w field data bar graph obtained at the end of the simulation in the oil wet domain the various wettability states are generated by mapping the interaction time ranges bar graph ranges in the x axis to representative contact angle distributions in the horizontal direction this is observed in figs 2 and 3 where the same global w field distribution for each distinct saturation is mapped to various wettability states contact angle distributions in the horizontal direction the normalized interaction time ranges are set for s w 0 5 by assigning the most frequent interaction time highest bar to the contact angles of 123 90 60 and 36 for the weakly oil wet intermediate wet weakly water wet and strongly water wet domains respectively the contact angle values mapped to the interaction time ranges for s w 0 5 are kept constant for various saturations of the wettability altering fluid s w 0 25 0 75 to capture the phase saturation effect on the resulting wettability states therefore the model includes all of the essential ingredients of a wettability alteration study it is a time dependent model where the wettability alteration is correlated with the flow pathways of the wettability altering agent and the relative degree of wettability alteration is dictated by the interaction time between the domain and the wettability altering agent the new wettability states are generated for various initial saturations of the wettability altering agent water phase and provided in figs 2 and 3 for the spherepack and rock domains respectively as the saturation of the wettability altering agent is increased we notice the bar graph becoming increasingly skewed away from an oil wet condition in addition a wider distribution of contact angles is observed for larger saturations of the wettability altering agent this occurs because increasing the saturation of the water phase improves the phase connectivity which strongly enhances the ability of the water phase to traverse the domain more efficiently thus allowing it to displace the oil phase from additional regions of the domain the differences in the wettability alteration data as a function of domain geometry are indicative of the varying flow behavior in the two domains for example the majority of the wettability alteration field data is located within a specific range in the spherepack domain whereas the data is more evenly spread across multiple distinct ranges in the rock domain this implies that additional possible flow paths exist in the rock domain due to the higher degree of heterogeneity the new wettability states generated under the larger capillary number c a 1 1 10 3 demonstrate very similar behavior and trends as the ones presented for the smaller capillary number c a 6 5 10 4 and are presented in figs s1 s2 in the supplementary material in the following sections the interplay between domain geometry and wettability alteration will be further emphasized and analyzed by monitoring oil phase fractional flow behavior oil ganglia dynamics and pore scale fluid displacement mechanisms 3 2 effect on fractional flow once the new wettability states have been generated the simulations are re initialized using the final fluid distributions from the oil wet simulations prior to wettability alteration in order to determine the impact of the new wettability states on the oil phase fractional flow the oil phase fractional flow is computed by dividing the oil flow rate by the total flow rate f o q o q o q w the oil phase fractional flow curves at various oil phase saturations s o 0 25 0 5 0 75 before and after the induced wettability alteration in the rock domain are provided in fig 4 the oil phase fractional flow curves in the spherepack domain display similar behavior and are presented in fig s3 similarly the oil phase fractional flow curves under the larger capillary number c a 1 1 10 3 in both domains are provided in figs s4 s5 the magnitude of the oil phase fractional flow in an oil wet domain before wettability alteration is dictated by the oil saturation and the initial connectivity of the oil phase as observed improvements in the oil phase fractional flow values due to wettability alteration become increasingly evident as the wettability state is incrementally altered to intermediate wet θ m e a n 90 weakly water wet θ m e a n 60 and strongly water wet θ m e a n 36 conditions a summary of the effect of wettability alteration on the fractional flow curves in the spherepack and rock domains is presented in fig 5 as shown in fig 5 altering the wettability of the domain from a strongly oil wet θ m e a n 160 to a weakly oil wet condition θ m e a n 123 does not result in significant improvements in the oil phase fractional flow and for low oil saturations we observe negative effects in both domains moreover an intermediate wet condition θ m e a n 90 only results in major improvements in the oil phase fractional flow at comparable saturations s o 0 5 these improvements are observed under both capillary numbers in the rock domain but only for the higher c a in the spherepack domain this can be explained by the observations in rabbani et al 2018 where a combination of concave and convex interfaces were observed under intermediate wet conditions and the interface curvature was found to be a strong function of the local pore geometry and angularity as a result in intermediate wet conditions the local pore geometry becomes the governing factor dictating the interface shape capillary force direction and the resulting occurrence of imbibition or drainage locally bakhshian et al 2020 rabbani et al 2018 this effect is more pronounced at equal saturations of the two components where the connectivity patterns are comparable and become less important in dictating the pore scale flow behavior in the spherepack domain the biggest relative improvement in the oil phase fractional flow under the lower c a is seen as we transition towards a weakly water wet condition with no significant improvement as we transition towards a strongly water wet condition θ m e a n 36 however a further wettability alteration towards a strongly water wet condition does continue to improve the oil phase fractional flow for the higher c a in the spherepack domain as the capillary number increases the oil phase traverses the domain with a larger conductance due to the higher driving force the ability of both fluids to overcome the entry capillary pressure of additional pore spaces increases which results in the creation of an increased number of flow paths and an enhancement in the connectivity of the fluids nemer et al 2020 on the other hand a further transition towards a strongly water wet condition continues to result in improvements in the oil phase fractional flow in the rock domain for both capillary numbers a similar pattern was observed in bakhshian et al 2020 where the optimum wetting conditions for maximizing the displacement efficiency of the defending fluid occurred under imbibition water wet conditions in a heterogeneous domain and intermediate wet weakly water wet conditions in a homogeneous domain these observations demonstrate the role of geometry in controlling the local displacement patterns and the resulting influence on the macroscale behavior and highlight the importance of capturing both wettability and geometry heterogeneity when attempting to quantify optimal wetting conditions furthermore we observe that the relative improvement in the oil phase fractional flow decreases with increasing oil saturation as we transition towards water wet conditions this occurs because the dominant parameter controlling the flow behavior of the oil phase at higher oil saturation is the increased connectivity due to the higher phase saturation and the relative improvements due to wettability alteration become less significant however the most important factor in enhancing the oil phase fractional flow is a transition in the wetting characteristics of the domain from an oil wet to a water wet condition an alteration in the wettability state towards water wet conditions enables the water phase to invade the narrow and dead end regions saturated with the trapped oil phase as a result small oil phase blobs which have previously been trapped become remobilized and are capable of joining nearby larger oil ganglia flowing through the wider regions of the pore space via coalescence the extent of remobilization followed by coalescence is also dependent on the capillary number and the pore topology where a larger capillary number increases the likelihood of these events occurring due to the increased ability of the water phase to invade narrower pore spaces 3 3 pore scale displacement analysis 3 3 1 pore scale displacement mechanisms the evolution of the pore scale fluid configurations in oil wet conditions for the spherepack and rock domains investigated are presented in fig 6 we analyze the fluid configurations at comparable saturations to isolate the coupled impacts of wettability and pore geometry on flow evolution since the improved phase connectivity due to a dominant saturation has implications on the flow patterns the layered fluid initialization procedure allows us to observe pore scale invasion mechanisms associated with drainage conditions front where water is displacing oil and imbibition conditions front where oil is displacing water the water non wetting phase preferentially invades the larger pores via a burst mechanism haines jump where an increase in the pressure locally beyond a critical capillary pressure results in a perturbation of the interface until an equilibrium is reached cieplak and robbins 1990 bakhshian et al 2020 edery et al 2018 moebius and or 2014 as shown in figs 6b and 6f as a result the oil phase is displaced by the water phase and forced into the smaller and narrower regions of the pore space zhao et al 2016 on the other hand the pore scale invasion pattern at the front where oil wetting phase displaces water non wetting phase results in a competition between piston like displacement and snap off processes singh et al 2017 a snap off event occurs when the wetting phase layer swells and fills a throat until a critical capillary pressure is reached and a portion of the non wetting phase becomes disconnected from its flow path singh et al 2017 the wetting phase can either completely displace the non wetting phase from a pore via piston like displacement figs 6b and 6f or flow through increasingly swelling layers which can completely fill the narrower pore spaces and result in the non wetting phase becoming disconnected in the form of ganglia figs 6d and 6g snap off occurs when piston like displacement is topologically not possible singh et al 2017 blunt et al 1992 joekar niasar and hassanizadeh 2012 piston like displacement is evident at the early time steps in the narrow pores since it requires the complete filling of an adjacent pore by the wetting phase before proceeding singh et al 2017 by comparing the displacement fronts at the two earliest time steps we observe that the interface evolution extent is smaller during piston like displacement wetting phase displacing non wetting phase than that observed during bursts non wetting phase displacing wetting phase at later time steps the oil phase traverses the domain in the form of well connected layers along the solid surface without necessarily displacing the water phase from the center of the large pores figs 6d and 6h the oil phase maintains a large degree of connectivity owing to the periodic nature of the domain and the wettability condition and resides in the narrowest regions of the pore space the nature of the oil phase propagation pattern in the form of swelling layers along the solid surface results in ganglia of the water non wetting phase becoming increasingly disconnected via snap off singh et al 2017 an accurate assessment of non wetting phase trapping potential is extremely important when analyzing co2 sequestration efforts and oil recovery potential where either maximum or minimum trapping is preferred respectively the frequency of snap off events is dependent on wettability and pore geometry and are more likely in domains with a larger pore to throat radius ratio singh et al 2017 wardlaw et al 1982 chatzis et al 1983 we observe a higher frequency of snap off events in the rock domain leading to a larger number of disconnected non wetting phase ganglia due to the larger pore size distribution and the prevalence of smaller pores this can be explained by the investigation conducted in bakhshian et al 2021 where corner flow and the subsequent trapping of the non wetting defending fluid were more readily observed in small pores although the described displacement patterns are present in both domains the frequency of occurrence and resulting flow pathways are controlled by the pore geometry for example thin films are more emphasized in the rock domain due to the increased surface roughness and higher angularity of the solid surface which amplifies wettability effects zhao et al 2016 therefore in the rock domain we observe the oil phase propagating in thinner layers without filling the pore bodies fig 6h which has implications on the displacement efficiency moreover the impactful role of pore topology becomes more evident since displacement patterns locally become influenced by the motion of the other displacement front ahead for example in the rock domain the existence of a number of large pores successively in the top region of the domain allows for the creation of a dominant flow path for the water phase fig 6h the enabling factor behind the fast creation of the water preferential flow path is the significant interface perturbation that occurs in the middle of the domain due to the very large local pore space the behavior of the water phase in that region of the domain forces the oil phase both ahead and behind to be quickly displaced by the water phase as shown in fig 6f as a result although wettability controls the resulting pore scale mechanisms given the pore space topology locally the resulting flow pathways are dictated by the cumulative behavior and interaction between these displacement mechanisms as evident in the different flow pathways observed in the two domains investigated these observations provide insights into the complexity behind characterizing pore scale multiphase flow owing to the competition between pore geometry and wettability in influencing the displacement patterns in order to illustrate how the change in wettability will disrupt the fluid distributions and influence the fluid evolution patterns in the wettability altered domains generated at the end of the oil wet simulations the pore scale fluid configurations in the wettability altered domains are presented in figs 7 12 as mentioned earlier the simulations are initialized in the wettability altered domains using the fluid distributions at the final time step in the oil wet simulations and the effects of wettability alteration on the fluid distributions are monitored a relaxation of the wettability state towards weakly oil wet conditions results in minor changes to the flow patterns fig 7 in the rock domain the oil phase continues to traverse the domain in the form of thin layers while incrementally filling narrower pore bodies where possible via cooperative pore filling the resulting oil phase flow pathways through the center of the pores allow the oil phase to traverse certain regions of the pore space with higher mobility via piston like displacement in comparison to the regions where the oil phase continues to flow in the form of layers therefore the oil phase continues to flow predominantly in the form of layers while incrementally forming higher mobility flow pathways controlled by local wettability and pore geometry through a combination of cooperative pore filling and piston like displacement however the flow of the oil phase through slow connected layers dominates the flow rate of the oil phase as shown in fig 5 slight improvements are observed in the rock domain due to the described phenomena while the flow behavior of the oil phase in the spherepack domain remains largely unimproved the oil phase flow pattern has already evolved and a slight relaxation in the wettability state is not sufficient to alter the oil phase flow behavior given the pore topology of the spherepack domain and the smaller fluid solid interfacial area as the wettability state is further altered to intermediate wet conditions the complexity of the pore scale displacement behavior increases since the two components demonstrate similar degrees of affinity to the solid surface the local pore scale configuration and flow pattern evolution become strongly dependent on the pore geometry in intermediate wet conditions the interface curvature and the resulting direction of capillary forces are strong functions of the local pore geometry and angularity rabbani et al 2018 the simultaneous existence of concave and convex interfaces implies the existence of imbibition and drainage events in different parts of the domain controlled primarily by the local pore geometry bakhshian et al 2020 as shown in fig 8 at comparable saturations of the two phases we observe an improvement in the fractional flow of the oil phase in regions where the oil phase completely occupies the pore body the oil phase now begins to traverse the pore more readily thus allowing the original oil phase which existed predominantly in layers on opposite sides of the pore to become connected to the oil phase flowing through the pore body it can be observed that an overlap of multiple neighboring menisci occurs due to cooperative pore filling and a new stable meniscus is formed bakhshian et al 2020 zhao et al 2016 as shown in figs 8d and 8h therefore the enhanced flow capability of the oil phase through the center of the large pores and the reduction in the extent to which the oil phase flows in layers along the solid surface results in increasing the oil phase fractional flow values this effect is enhanced in the rock domain due to the wider pore size distribution and the larger accessible fluid solid interfacial area which enhances the performance of the displacement mechanism explained once the wettability state has been transformed to weakly water wet followed by strongly water wet conditions the oil phase begins to increasingly flow with higher phase conductance through the large pores while the water phase flows through layers and becomes increasingly confined to the tighter pores figs 9 10 11 12 the pore scale displacement mechanisms are similar to those observed in the originally oil wet domain with the major distinction that the oil phase has now been transformed to the non wetting phase moreover we observe an increase in the number of larger oil ganglia and a reduction in the number of small oil blobs in water wet conditions at the pore scale this is observed because once the wettability state is altered towards water wet conditions capillary pressure assists water in imbibing into the tighter regions saturated with the oil phase thus allowing some of the oil phase to become remobilized additionally the oil layers increasingly break down into smaller disconnected oil ganglia dispersed throughout the domain with potential for mobility the remobilized smaller oil ganglia can then join the larger oil ganglia non wetting phase flowing through the wider regions of the pore space via coalescence the evolution process summarized is presented in fig 11 the oil phase connectivity increases which enhances the flow ability of the oil phase as evident in the fractional flow investigation presented earlier in section 3 2 the aforementioned phenomena are observed in both domains and under the two capillary numbers investigated as shown in figs 9 12 however the effects are more pronounced in the rock domain due to the increased surface roughness and the larger pore size distribution of the rock domain at the lower c a a change in the wettability state towards strongly water wet conditions in the spherepack domain did not result in significant improvements in the oil phase fractional flow over weakly water wet conditions as opposed to the rock domain the rock domain retains larger portions of the oil phase in the very narrow regions with potential for remobilization via a further alteration in the wettability state towards strongly water wet conditions as demonstrated in fig 5 in water wet conditions the oil phase resides in the domain in the form of connected large ganglia flowing through the center of the large pore spaces with high mobility and a large potential for recovery as a result a larger c a enhances the potential for recovery since it enables the water phase to increasingly displace the oil phase from narrower pores thus increasing the potential for oil remobilization followed by coalescence especially in the rock domain due to the larger number of narrow pore spaces fig 12h in addition previously detached oil ganglia via snap off are more likely to become remobilized under the larger c a 3 3 2 oil ganglia analysis in order to better illustrate the observed improvements in the oil phase fractional flow due to wettability alteration we investigate the oil ganglia dynamics by quantifying the frequency and distribution of the size of the oil ganglia as the wettability state of the domain is incrementally altered from an oil wet to a water wet condition moreover we also highlight the role of the domain topology in influencing the potential for oil ganglia remobilization after wettability alteration the distributions of the oil ganglia sizes are obtained at the end of the simulations in the initially oil wet domain and under the new wettability states generated using the wettability alteration algorithm weakly oil wet intermediate wet weakly water wet and strongly water wet for the spherepack fig 13 and rock fig 14 domains as mentioned earlier this analysis is performed at specific saturations of the two phases s o 0 25 0 5 0 75 by utilizing the wettability alteration algorithm which generates the wettability states inherently as a function of the domain and the phase saturations we are providing more accurate insights into the interplay between wettability alteration and geometry heterogeneity in impacting the extent of oil ganglia remobilization in the initially oil wet domain at intermediate saturations figs 13a and 14a we find that the majority of the oil phase in the domain flows in the form of a number of well connected clusters which occupy large areas in both domains although the strongly wetting condition enables high wetting phase connectivity these wetting phase layers flow very slowly in comparison to the non wetting phase as was shown in the fractional flow values in fig 5 furthermore we also find that a large percentage of the oil ganglia in the domain though not a dominant portion of the oil in place are small disconnected blobs and occupy very small areas in the domain this occurs because the oil phase wetting phase flows primarily in the form of a number of wetting layers and resides in the narrow and tight regions of the pore space blunt 2017 as shown in figs 6d and 6h therefore the number of small oil blobs in an oil wet domain becomes increasingly dependent on the pore size distribution and surface roughness since a larger fraction of small pores and increasingly rough surfaces implies a larger percentage of small oil blobs as observed in the rock domain in fig 14a therefore we expect a larger percentage of oil ganglia remobilization events with wettability alteration in the rock domain dependent on the accessibility of these tighter pore spaces as the wettability state of the domain is incrementally altered towards weakly oil wet figs 13b and 14b and intermediate wet figs 13c and 14c conditions the initially large oil layers in the domain can become disconnected and we observe a gradual increase in the number of medium sized ganglia in addition the number of very small oil blobs slowly decreases due to the transition from layer flow figs 6d and 6h to cooperative pore filling figs 8d and 8h as a result of the increased ability of the oil phase to traverse the centers of the pores more easily the resulting competition between enhanced flow ability due to the higher phase connectivity observed under oil wet conditions and the increased cooperative pore filling events observed in weakly oil wet and intermediate wet conditions explains the resulting non drastic effects on the fractional flow as shown in fig 5 however an exception is observed at s o 0 5 under both capillary numbers in the rock domain but only for the higher c a in the spherepack domain where an alteration in the wettability state towards intermediate wet conditions resulted in significant fractional flow enhancement this occurs due to the larger fluid solid interfacial area and rougher edges in the rock domain where strongly oil wet conditions significantly impact the oil phase flow rate and a relaxation of the wetting conditions has a stronger impact the domain topology in the rock domain provides a significant level of heterogeneity surface roughness and a large number of narrow pore spaces capable of isolating and holding small oil blobs on the other hand the large pore spaces and the smooth surfaces present in the spherepack domain provide a domain topology in which the fractional flow of the oil phase is only slightly improved under intermediate wet conditions despite the occurrence of cooperative pore filling events resulting in a significantly large oil cluster as we transition further towards weakly water wet figs 13d and 14d and strongly water wet figs 13e and 14e conditions for intermediate saturations of the oil phase we observe a reduction in the number of very small oil blobs and an increase in the size of the larger oil ganglia the transformation of the wettability state enables the creation of a dominant oil phase flow path in the rock domain where a large percentage of the oil in place resides in one large cluster fig 11h whereas we observe the creation of multiple large oil ganglia in the spherepack domain fig 11d the resulting oil ganglia distribution is a consequence of the enhanced ability of the water phase to remobilize previously trapped oil blobs and the breakup of the previously well connected oil clusters under oil wet conditions to smaller disconnected oil ganglia via snap off figs 11c and 11g pak et al 2015 the smaller remobilized oil ganglia have the potential to join the dominant oil phase flow path through coalescence figs 11d and 11h as a result the increase in the number of medium sized oil ganglia is the consequence of a combination of coalescence and snap off however the disconnected non wetting phase can still join the main flow path the non wetting phase ganglia which are not trapped continue to merge with the larger ones therefore contributing to the increase in the size of the larger oil cluster this behavior is more evident under strongly wetting conditions due to the increased capability of the non wetting phase to traverse the domain more readily primarily through the center of the large pores although the flow of the wetting phase in layers increases the likelihood of the non wetting phase becoming trapped via snap off this behavior is more prevalent in the small pores of the domain thus reducing the effect on the overall recovery and displacement efficiency bakhshian et al 2021 therefore the oil phase connectivity increases and the potential for enhanced oil recovery is improved since the oil phase is now more easily mobilized aziz et al 2020 a similar observation has been reported in bakhshian et al 2021 where an increase in the non wetting defending fluid connectivity was observed with a transition in the displacement process from drainage to imbibition the oil ganglia distribution under the larger c a is impacted by two competing forces the breakup of large oil ganglia into smaller ones due to greater viscous forces pak et al 2015 and increased coalescence events due to the greater ability of both phases to flow through previously inaccessible pores as a result the potential for oil ganglia remobilization increases under the larger c a due to the increased ability of the water phase to invade even narrower pore spaces where the oil phase is trapped moreover the prevalence of narrow pore throats in the rock domain increases the percentage of coalescence events in comparison to the well connected spherepack domain where the effect of viscous forces on the breakup of large oil ganglia is more influential however the larger frequency of coalescence events observed is due to the use of periodic boundary conditions where both phases are continuously allowed to re enter the domain the resulting effect on the oil ganglia distribution in the rock domain is an increase in the size of the larger oil ganglia fig s7e as shown in fig 12h on the other hand as observed in fig s6e we observe the breakup of the largest oil ganglia into a number of smaller ones under the higher c a in the spherepack domain the oil ganglia distribution and the degree of remobilization are dependent on the phase saturation and controlled primarily by the phase connectivity for example the oil phase demonstrates a larger degree of connectivity at higher oil phase saturations and the oil phase flows predominantly in highly connected layers in oil wet conditions and large ganglia in the center of the pore space in water wet conditions figs s8a e and s9a e therefore the majority of the domain is accessible to the oil phase in water wet conditions which limits the amount of oil phase trapping via snap off figs s8e and s9e the aforementioned observations and the resulting oil ganglia distributions remain largely consistent under the larger c a implying that the phase saturation is the more influential factor in dictating phase connectivity figs s10 s11 on the other hand the limited connectivity of the oil phase at lower saturations results in the opposite effect as the wettability state of the domain is altered to water wet conditions we observe a reduction in coalescence events due to the limited domain accessibility of the oil phase and a distribution of small oil ganglia sizes is observed figs s12 s13 the prominence of smaller oil ganglia without the formation of a larger oil ganglion is indicative of a prevalence of snap off events figs s12e and s13e this is expected since the water phase wetting phase now occupies the majority of the domain and the oil phase is more likely to become increasingly disconnected via snap off at lower oil phase saturations however at lower oil phase saturations the wider pore size distribution in the rock domain provides a larger number of previously inaccessible pores and a larger c a increases oil remobilization and coalescence events which results in a modest increase in the size of the larger oil ganglion fig s15e 4 conclusions and future work the current study sheds light on the complex pore scale behavior of multiphase flow in natural porous media as a result of the coupled influence of wettability alteration and domain topology a wettability alteration algorithm was developed to capture more accurate domain specific wettability altered states in two geometries a spherepack and a rock slice initially the simulations are conducted in an oil wet domain for varying saturations of the oil phase and the wettability alteration algorithm is utilized to track the relative wettability alteration the wettability alteration data is used to generate the new wettability states and the simulations are then performed on the wettability altered domains to analyze the resulting pore scale flow behavior an intermediate wet condition enhances the role of local pore topology which becomes the governing factor controlling the shape of the local interface and the resulting occurrence of an imbibition or drainage type event therefore the pore size distribution and the fluid solid interfacial area become very influential in controlling the local pore scale displacement pattern and the resulting flow pathways we observe a competition between the highly connected oil layers under oil wet conditions and increased cooperative pore filling events in weakly oil wet and intermediate wet conditions in enhancing the oil phase flow which explains the smaller impact on the oil phase fractional flow however for equal saturations of the two fluids improvements in the oil phase fractional flow were observed under both c a in the rock domain but only for the higher c a in the spherepack domain in intermediate wet conditions a larger percentage of narrower pore spaces increased surface roughness and a larger fluid solid interfacial area in the rock domain increase the trapping likelihood of smaller oil blobs which can be mobilized by relaxing the wettability condition at higher oil phase saturations the connectivity of the oil phase becomes more important in controlling the flow behavior and the effects due to wettability alteration are less pronounced the biggest relative improvements in the oil phase fractional flow were observed once the wettability state was transformed to the weakly water wet condition in both domains the new wettability state allows the water phase to invade the narrower pore spaces and displace the trapped oil phase moreover the oil layers break down into smaller oil ganglia located in various regions of the domain the smaller oil ganglia increasingly join the larger oil ganglia flowing through the center of the large pores via coalescence however the oil phase non wetting phase can also become disconnected from the main flow path via snap off the competition between coalescence and snap off events is strongly influenced by many factors such as the wettability condition capillary number phase saturation and domain topology a further transition towards strongly water wet conditions at the lower c a was only beneficial in the rock domain due to the greater trapping observed under oil wet conditions as a result of the increased domain heterogeneity furthermore the oil ganglia distribution under a larger c a is affected by the domain topology and is a result of the competition between two opposing mechanisms greater viscous forces causing the breakdown of larger oil ganglia and the increased ability of both phases to flow through previously inaccessible pores leading to a higher degree of oil ganglia remobilization and coalescence events although the pore scale displacement mechanisms locally are controlled by the local wettability distribution and pore topology the flow pathways are the result of the average of the interaction and competition between the local displacement mechanisms therefore assigning a random or uniform wettability distribution is not sufficient to capture the flow behavior and accurate geometry specific wettability characterization is integral towards designing and optimizing pore scale displacement processes the wettability alteration algorithm that is introduced in this work inherently captures the locations that interact the most with the wettability altering agent and provides insights into capillary trapping potential as a result the algorithm can prove extremely useful when investigating eor or co2 trapping potential especially when complemented with experimental wettability alteration correlations for different fluid systems credit authorship contribution statement mohamed n nemer conceptualization methodology software validation formal analysis investigation resources data curation writing original draft writing review editing visualization parthib r rao conceptualization methodology software resources writing review editing supervision laura schaefer conceptualization methodology validation resources writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is supported by the abu dhabi national oil company adnoc supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j advwatres 2021 104055 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 akai alhammadi blunt bijeljic 2019 t akai a m alhammadi m j blunt b bijeljic modeling oil recovery in mixed wet rocks pore scale comparison between experiment and simulation transp porous media 127 2 2019 393 414 akai t alhammadi a m blunt m j bijeljic b 2019 modeling oil recovery in mixed wet rocks pore scale comparison between experiment and simulation transport in porous media 127 2 393 414 akai blunt bijeljic 2020 t akai m j blunt b bijeljic pore scale numerical simulation of low salinity water flooding using the lattice boltzmann method j colloid interface sci 566 2020 444 453 akai t blunt m j bijeljic b 2020 pore scale numerical simulation of low salinity water flooding using the lattice boltzmann method journal of colloid and interface science 566 444 453 armstrong mcclure berrill rücker schlüter berg 2016 r t armstrong j e mcclure m a berrill m rücker s schlüter s berg beyond darcy s law the role of phase topology and ganglion dynamics for two fluid flow physical review e 94 4 2016 043113 armstrong r t mcclure j e berrill m a rücker m schlüter s berg s 2016 beyond darcy s law the role of phase topology and ganglion dynamics for two fluid flow physical review e 94 4 043113 arriola willhite green et al 1983 a arriola g p willhite d w green trapping of oil drops in a noncircular pore throat and mobilization upon contact with a surfactant society of petroleum engineers journal 23 01 1983 99 114 arriola a willhite g p green d w et al 1983 trapping of oil drops in a noncircular pore throat and mobilization upon contact with a surfactant society of petroleum engineers journal 23 01 99 114 aziz joekar niasar martínez ferrer godinez brizuela theodoropoulos mahani 2019 r aziz v joekar niasar p j martínez ferrer o e godinez brizuela c theodoropoulos h mahani novel insights into pore scale dynamics of wettability alteration during low salinity waterflooding sci rep 9 1 2019 1 13 aziz r joekar niasar v martínez ferrer p j godinez brizuela o e theodoropoulos c mahani h 2019 novel insights into pore scale dynamics of wettability alteration during low salinity waterflooding scientific reports 9 1 1 13 aziz niasar erfani martínez ferrer 2020 r aziz v niasar h erfani p j martínez ferrer impact of pore morphology on two phase flow dynamics under wettability alteration fuel 268 2020 117315 aziz r niasar v erfani h martínez ferrer p j 2020 impact of pore morphology on two phase flow dynamics under wettability alteration fuel 268 117315 bakhshian hosseini 2019 s bakhshian s a hosseini pore scale analysis of supercritical co2 brine immiscible displacement under fractional wettability conditions adv water resour 126 2019 96 107 bakhshian s hosseini s a 2019 pore scale analysis of supercritical co2 brine immiscible displacement under fractional wettability conditions advances in water resources 126 96 107 bakhshian hosseini shokri 2019 s bakhshian s a hosseini n shokri pore scale characteristics of multiphase flow in heterogeneous porous media using the lattice boltzmann method sci rep 9 1 2019 1 13 bakhshian s hosseini s a shokri n 2019 pore scale characteristics of multiphase flow in heterogeneous porous media using the lattice boltzmann method scientific reports 9 1 1 13 bakhshian rabbani hosseini shokri 2020 s bakhshian h s rabbani s a hosseini n shokri new insights into complex interactions between heterogeneity and wettability influencing two phase flow in porous media geophys res lett 47 14 2020 e2020gl088187 bakhshian s rabbani h s hosseini s a shokri n 2020 new insights into complex interactions between heterogeneity and wettability influencing two phase flow in porous media geophysical research letters 47 14 e2020gl088187 bakhshian rabbani shokri 2021 s bakhshian h s rabbani n shokri physics driven investigation of wettability effects on two phase flow in natural porous media recent advances new insights and future perspectives transp porous media 2021 1 22 bakhshian s rabbani h s shokri n 2021 physics driven investigation of wettability effects on two phase flow in natural porous media recent advances new insights and future perspectives transport in porous media 1 22 bartels mahani berg hassanizadeh 2019 w b bartels h mahani s berg s hassanizadeh literature review of low salinity waterflooding from a length and time scale perspective fuel 236 2019 338 353 bartels w b mahani h berg s hassanizadeh s 2019 literature review of low salinity waterflooding from a length and time scale perspective fuel 236 338 353 berg cense jansen bakker 2010 s berg a cense e jansen k bakker direct experimental evidence of wettability modification by low salinity petrophysics the spwla journal of formation evaluation and reservoir description 51 05 2010 berg s cense a jansen e bakker k 2010 direct experimental evidence of wettability modification by low salinity petrophysics the spwla journal of formation evaluation and reservoir description 51 05 blunt king scher 1992 m blunt m j king h scher simulation and theory of two phase flow in porous media physical review a 46 12 1992 7680 blunt m king m j scher h 1992 simulation and theory of two phase flow in porous media physical review a 46 12 7680 blunt 2017 m j blunt multiphase flow in permeable media a pore scale perspective 2017 cambridge university press blunt m j 2017 multiphase flow in permeable media a pore scale perspective cambridge university press buckley liu 1998 j buckley y liu some mechanisms of crude oil brine solid interactions journal of petroleum science and engineering 20 3 4 1998 155 160 buckley j liu y 1998 some mechanisms of crude oil brine solid interactions journal of petroleum science and engineering 20 3 4 155 160 buckley leverett et al 1942 s e buckley m leverett mechanism of fluid displacement in sands transactions of the aime 146 01 1942 107 116 buckley s e leverett m et al 1942 mechanism of fluid displacement in sands transactions of the aime 146 01 107 116 chatzis morrow lim et al 1983 i chatzis n r morrow h t lim magnitude and detailed structure of residual oil saturation society of petroleum engineers journal 23 02 1983 311 326 chatzis i morrow n r lim h t et al 1983 magnitude and detailed structure of residual oil saturation society of petroleum engineers journal 23 02 311 326 chen doolen 1998 s chen g d doolen lattice boltzmann method for fluid flows annu rev fluid mech 30 1 1998 329 364 chen s doolen g d 1998 lattice boltzmann method for fluid flows annual review of fluid mechanics 30 1 329 364 churcher french shaw schramm et al 1991 p churcher p french j shaw l schramm rock properties of berea sandstone baker dolomite and indiana limestone spe international symposium on oilfield chemistry 1991 society of petroleum engineers churcher p french p shaw j schramm l et al 1991 rock properties of berea sandstone baker dolomite and indiana limestone in spe international symposium on oilfield chemistry society of petroleum engineers cieplak robbins 1990 m cieplak m o robbins influence of contact angle on quasistatic fluid invasion of porous media physical review b 41 16 1990 11508 cieplak m robbins m o 1990 influence of contact angle on quasistatic fluid invasion of porous media physical review b 41 16 11508 du shi chen 2006 r du b shi x chen multi relaxation time lattice boltzmann model for incompressible flow phys lett a 359 6 2006 564 572 du r shi b chen x 2006 multi relaxation time lattice boltzmann model for incompressible flow physics letters a 359 6 564 572 edery berg weitz 2018 y edery s berg d weitz surfactant variations in porous media localize capillary instabilities during haines jumps phys rev lett 120 2 2018 028005 edery y berg s weitz d 2018 surfactant variations in porous media localize capillary instabilities during haines jumps physical review letters 120 2 028005 flovik sinha hansen 2015 v flovik s sinha a hansen dynamic wettability alteration in immiscible two phase flow in porous media effect on transport properties and critical slowing down front phys 3 2015 86 flovik v sinha s hansen a 2015 dynamic wettability alteration in immiscible two phase flow in porous media effect on transport properties and critical slowing down frontiers in physics 3 86 golparvar zhou wu ma yu 2018 a golparvar y zhou k wu j ma z yu a comprehensive review of pore scale modeling methodologies for multiphase flow in porous media advances in geo energy research 2 4 2018 418 440 golparvar a zhou y wu k ma j yu z 2018 a comprehensive review of pore scale modeling methodologies for multiphase flow in porous media advances in geo energy research 2 4 418 440 gunstensen rothman zaleski zanetti 1991 a k gunstensen d h rothman s zaleski g zanetti lattice boltzmann model of immiscible fluids physical review a 43 8 1991 4320 gunstensen a k rothman d h zaleski s zanetti g 1991 lattice boltzmann model of immiscible fluids physical review a 43 8 4320 he chen zhang 1999 x he s chen r zhang a lattice boltzmann scheme for incompressible multiphase flow and its application in simulation of rayleigh taylor instability j comput phys 152 2 1999 642 663 he x chen s zhang r 1999 a lattice boltzmann scheme for incompressible multiphase flow and its application in simulation of rayleigh taylor instability journal of computational physics 152 2 642 663 he luo 1997 x he l s luo lattice boltzmann model for the incompressible navier stokes equation j stat phys 88 3 4 1997 927 944 he x luo l s 1997 lattice boltzmann model for the incompressible navier stokes equation journal of statistical physics 88 3 4 927 944 holtzman segre 2015 r holtzman e segre wettability stabilizes fluid invasion into porous media via nonlocal cooperative pore filling phys rev lett 115 16 2015 164501 holtzman r segre e 2015 wettability stabilizes fluid invasion into porous media via nonlocal cooperative pore filling physical review letters 115 16 164501 hou wang huang 2015 b f hou y f wang y huang mechanistic study of wettability alteration of oil wet sandstone surface using different surfactants appl surf sci 330 2015 56 64 hou b f wang y f huang y 2015 mechanistic study of wettability alteration of oil wet sandstone surface using different surfactants applied surface science 330 56 64 huang thorne jr schaap sukop 2007 h huang d t thorne jr m g schaap m c sukop proposed approximation for contact angles in shan and chen type multicomponent multiphase lattice boltzmann models physical review e 76 6 2007 066701 huang h thorne jr d t schaap m g sukop m c 2007 proposed approximation for contact angles in shan and chen type multicomponent multiphase lattice boltzmann models physical review e 76 6 066701 iglauer fernø shearing blunt 2012 s iglauer m fernø p shearing m blunt comparison of residual oil cluster size distribution morphology and saturation in oil wet and water wet sandstone j colloid interface sci 375 1 2012 187 192 iglauer s fernø m shearing p blunt m 2012 comparison of residual oil cluster size distribution morphology and saturation in oil wet and water wet sandstone journal of colloid and interface science 375 1 187 192 jerauld webb lin seccombe 2008 g r jerauld k j webb c y lin j c seccombe modeling low salinity waterflooding spe reservoir evaluation engineering 11 06 2008 1000 1012 jerauld g r webb k j lin c y seccombe j c 2008 modeling low salinity waterflooding spe reservoir evaluation engineering 11 06 1000 1012 jiang wu couples van dijke sorbie ma 2007 z jiang k wu g couples m i j van dijke k s sorbie j ma efficient extraction of networks from three dimensional porous media water resour res 43 12 2007 jiang z wu k couples g van dijke m i j sorbie k s ma j 2007 efficient extraction of networks from three dimensional porous media water resources research 43 12 joekar niasar hassanizadeh 2012 v joekar niasar s hassanizadeh analysis of fundamentals of two phase flow in porous media using dynamic pore network models a review crit rev environ sci technol 42 18 2012 1895 1976 joekar niasar v hassanizadeh s 2012 analysis of fundamentals of two phase flow in porous media using dynamic pore network models a review critical reviews in environmental science and technology 42 18 1895 1976 kovscek wong radke 1993 a kovscek h wong c radke a pore level scenario for the development of mixed wettability in oil reservoirs alche j 39 6 1993 1072 1085 kovscek a wong h radke c 1993 a pore level scenario for the development of mixed wettability in oil reservoirs aiche journal 39 6 1072 1085 krüger kusumaatmaja kuzmin shardt silva viggen 2017 t krüger h kusumaatmaja a kuzmin o shardt g silva e m viggen the lattice boltzmann method principles and practice 10 2017 springer krüger t kusumaatmaja h kuzmin a shardt o silva g viggen e m 2017 the lattice boltzmann method principles and practice vol 10 springer lallemand luo 2000 p lallemand l s luo theory of the lattice boltzmann method dispersion dissipation isotropy galilean invariance and stability physical review e 61 6 2000 6546 lallemand p luo l s 2000 theory of the lattice boltzmann method dispersion dissipation isotropy galilean invariance and stability physical review e 61 6 6546 landry karpyn ayala 2014 c landry z karpyn o ayala relative permeability of homogenous wet and mixed wet porous media as determined by pore scale lattice boltzmann modeling water resour res 50 5 2014 3672 3689 landry c karpyn z ayala o 2014 relative permeability of homogenous wet and mixed wet porous media as determined by pore scale lattice boltzmann modeling water resources research 50 5 3672 3689 li pan miller 2005 h li c pan c t miller pore scale investigation of viscous coupling effects for two phase flow in porous media physical review e 72 2 2005 026705 li h pan c miller c t 2005 pore scale investigation of viscous coupling effects for two phase flow in porous media physical review e 72 2 026705 li galindo torres yan scheuermann li 2018 z li s galindo torres g yan a scheuermann l li a lattice boltzmann investigation of steady state fluid distribution capillary pressure and relative permeability of a porous medium effects of fluid and geometrical properties adv water resour 116 2018 153 166 li z galindo torres s yan g scheuermann a li l 2018 a lattice boltzmann investigation of steady state fluid distribution capillary pressure and relative permeability of a porous medium effects of fluid and geometrical properties advances in water resources 116 153 166 liu kang leonardi schmieschek narváez jones williams valocchi harting 2016 h liu q kang c r leonardi s schmieschek a narváez b d jones j r williams a j valocchi j harting multiphase lattice boltzmann simulations for porous media applications comput geosci 20 4 2016 777 805 liu h kang q leonardi c r schmieschek s narváez a jones b d williams j r valocchi a j harting j 2016 multiphase lattice boltzmann simulations for porous media applications computational geosciences 20 4 777 805 liu zhang valocchi 2015 h liu y zhang a j valocchi lattice boltzmann simulation of immiscible fluid displacement in porous media homogeneous versus heterogeneous pore network physics of fluids 27 5 2015 052103 liu h zhang y valocchi a j 2015 lattice boltzmann simulation of immiscible fluid displacement in porous media homogeneous versus heterogeneous pore network physics of fluids 27 5 052103 mahani berg ilic bartels joekar niasar et al 2015 h mahani s berg d ilic w b bartels v joekar niasar kinetics of low salinity flooding effect spe j 20 01 2015 8 20 mahani h berg s ilic d bartels w b joekar niasar v et al 2015 kinetics of low salinity flooding effect spe journal 20 01 8 20 martys chen 1996 n s martys h chen simulation of multicomponent fluids in complex three dimensional geometries by the lattice boltzmann method physical review e 53 1 1996 743 martys n s chen h 1996 simulation of multicomponent fluids in complex three dimensional geometries by the lattice boltzmann method physical review e 53 1 743 mccracken abraham 2005 m e mccracken j abraham multiple relaxation time lattice boltzmann model for multiphase flow physical review e 71 3 2005 036701 mccracken m e abraham j 2005 multiple relaxation time lattice boltzmann model for multiphase flow physical review e 71 3 036701 melrose et al 1965 j c melrose wettability as related to capillary action in porous media society of petroleum engineers journal 5 03 1965 259 271 melrose j c et al 1965 wettability as related to capillary action in porous media society of petroleum engineers journal 5 03 259 271 moebius or 2014 f moebius d or pore scale dynamics underlying the motion of drainage fronts in porous media water resour res 50 11 2014 8441 8457 moebius f or d 2014 pore scale dynamics underlying the motion of drainage fronts in porous media water resources research 50 11 8441 8457 nemer rao schaefer 2020 m n nemer p r rao l schaefer wettability alteration implications on pore scale multiphase flow in porous media using the lattice boltzmann method adv water resour 2020 103790 nemer m n rao p r schaefer l 2020 wettability alteration implications on pore scale multiphase flow in porous media using the lattice boltzmann method advances in water resources 103790 pak butler geiger van dijke sorbie 2015 t pak i b butler s geiger m i van dijke k s sorbie droplet fragmentation 3d imaging of a previously unidentified pore scale process during multiphase flow in porous media proceedings of the national academy of sciences 112 7 2015 1947 1952 pak t butler i b geiger s van dijke m i sorbie k s 2015 droplet fragmentation 3d imaging of a previously unidentified pore scale process during multiphase flow in porous media proceedings of the national academy of sciences 112 7 1947 1952 pan hilpert miller 2004 c pan m hilpert c miller lattice boltzmann simulation of two phase flow in porous media water resour res 40 1 2004 pan c hilpert m miller c 2004 lattice boltzmann simulation of two phase flow in porous media water resources research 40 1 porter coon kang moulton carey 2012 m l porter e coon q kang j moulton j carey multicomponent interparticle potential lattice boltzmann model for fluids with large viscosity ratios physical review e 86 3 2012 036701 porter m l coon e kang q moulton j carey j 2012 multicomponent interparticle potential lattice boltzmann model for fluids with large viscosity ratios physical review e 86 3 036701 qian orszag 1993 y qian s orszag lattice bgk models for the navier stokes equation nonlinear deviation in compressible regimes epl europhysics letters 21 3 1993 255 qian y orszag s 1993 lattice bgk models for the navier stokes equation nonlinear deviation in compressible regimes epl europhysics letters 21 3 255 rabbani zhao juanes shokri 2018 h s rabbani b zhao r juanes n shokri pore geometry control of apparent wetting in porous media sci rep 8 1 2018 1 8 rabbani h s zhao b juanes r shokri n 2018 pore geometry control of apparent wetting in porous media scientific reports 8 1 1 8 ramstad idowu nardi øren 2012 t ramstad n idowu c nardi p e øren relative permeability calculations from two phase flow simulations directly on digital images of porous rocks transp porous media 94 2 2012 487 504 ramstad t idowu n nardi c øren p e 2012 relative permeability calculations from two phase flow simulations directly on digital images of porous rocks transport in porous media 94 2 487 504 ramstad øren bakke et al 2010 t ramstad p e øren s bakke simulation of two phase flow in reservoir rocks using a lattice boltzmann method spe j 15 04 2010 917 927 ramstad t øren p e bakke s et al 2010 simulation of two phase flow in reservoir rocks using a lattice boltzmann method spe journal 15 04 917 927 rao schaefer 2019 p rao l schaefer lattice boltzmann models for micro tomographic pore spaces computers fluids 193 2019 104294 rao p schaefer l 2019 lattice boltzmann models for micro tomographic pore spaces computers fluids 193 104294 saxena hofmann alpak berg dietderich agarwal tandon hunter freeman wilson 2017 n saxena r hofmann f o alpak s berg j dietderich u agarwal k tandon s hunter j freeman o b wilson and benchmarks for pore scale flow simulated using micro ct images of porous media and digital rocks adv water resour 109 2017 211 235 saxena n hofmann r alpak f o berg s dietderich j agarwal u tandon k hunter s freeman j wilson o b 2017 
238,in water resources management and practices the time connected duration and frequency of episodic low streamflow events and droughts are often needed for a range of purposes such as water supply planning low flow management and drought planning however the existing graphical tools commonly used in hydrology such as flow duration curves fdc discharge duration frequency qdf and severity duration frequency sdf curves often do not provide this information in this study we contribute an approach to develop a flow duration frequency fdf curve by fitting the exponential function to graphically show the time connected duration and frequency of episodic low streamflow events the fdf fitting is comprehensively tested with a bootstrap resampling experiment using long term continuous streamflow records for 92 usgs gages located in the state of illinois u s a the experiment results reveal that the proposed methodology can reasonably develop fdf curves for episodic low streamflow events the results demonstrate that the fdf fitting is improved by using longer streamflow record though the improvement appears to level off with 30 years or longer streamflow records the results also confirm that the fdf fitting is more reliable for higher streamflow threshold to define episodic low streamflow events keywords drought water resources graphic tool stochastic hydrology low flow 1 introduction drought is the result of precipitation deficiency and or high evapotranspiration over prolonged periods and extended areas it is temporary deviance from long term normal climatic conditions unlike aridity which is permanent climate feature with a long term normal condition of low precipitation drought is temporary while the impact of drought is often underestimated due to slow onset it is the second most costly natural hazard in the united states causing average annual losses of 9 billion for the period of 1980 2019 in cpi adjusted 2019 value ncei 2019 based on the four properties of drought i e nature of water deficit time unit threshold and regionalization proposed by dracup et al 1980 a raft of indices have been proposed and used to characterize drought nalbantis and tsakiris 2009 palmer 1965 sung and chung 2014 drought can be defined based on disciplinary perspectives and is commonly classified as four categories meteorological or climatological agricultural hydrological and socioeconomic droughts american meteorological society 1997 wilhite and glantz 1985 meteorological drought is based on precipitation deficit agricultural drought links impact of drought to agriculture hydrological drought occurs when precipitation deficits impact water resources including streamflow reservoir and lake storage as well as groundwater socioeconomic drought focuses on societal and economic impacts of drought streamflow is the key variable to describe hydrological droughts tsakiris et al 2013 a phenomenon that is difficult to characterize sung and chung 2014 hydrological drought is often defined based on streamflow below average water availability i e a threshold level tallaksen and van lanen 2004 the threshold level is often based on daily monthly seasonally or annual percentile flows for a selected duration that is derived from a flow duration curve fdc there are many graphic tools to characterize streamflow and hydrological drought among which fdcs are the most extensively used the fdc graphically represents the frequency or the percentage of time in which a streamflow of a given magnitudeis equaled or exceeded over a specified period vogel and fennessey 1994 zhang 2017 it provides a stochastic representation of streamflow variability over the period müller et al 2014 a fdc presents a wealth of hydrologic information in a single graph and thus has long history in applications including but not limited to hydropower planning water quality management flood control water supply planning and river sedimentation analyses vogel and fennessey 1995 however fdcs only illustrate streamflow variability in the frequency domain without considering the time connected durations of episodic events which is critical for water supply planning and water resources management to include durations of episodic events discharge duration frequency qdf curves were developed and investigated using statistical analyses of streamflow to estimate floods or low flow for a given occurrence probability galea and prudhomme 1994 1997 sherwood 1994 qdf has been use to analyze streamflow features for catchments located in france javelle et al 1999 martinique meunier 2001 and canada javelle et al 2002 qdf curves are developed similarly as intensity duration frequency idf curves that were commonly applied in rainfall analyses except qdfs are applied to discharge data chin et al 2000 qdfs like idfs consider the duration as a fixed parameter first discharges are aggregated over a specific fixed duration then for each duration a probability distribution is fitted to the extracted maxima of these aggregated discharge values javelle et al 2002 when qdfs are applied to analyze floods the curve may be called flood duration curve as well renima et al 2018 qdfs could be also used for exploring low flows to examine the relationship onyutha and willems 2013 severity duration frequency curves sdf employed by sung and chung 2014 explore characteristics of streamflow drought using the threshold level approach based on selected threshold streamflow levels streamflow drought severity and duration are calculated and an appropriate generalized extreme value gev probability distribution is selected using the l moment diagrams of various goodness of fit techniques the sdf curves are then developed using the selected gev distribution while both qdf and sdf curves consider durations of individual high flow or low flow events it is often based on annual maximum or minimum series information of the durations and frequencies of all time connected episodic events not just the annual extreme events is often needed for many water resource management purposes such as water supply planning drought planning minimum flow management water availability for power generation etc denooyer et al 2016 this type of information however cannot be obtained from fdc qdf or sdf curves qdfs and sdfs do not consider all time connected episodic events and they are analyzed using time partition to segregate data to the annual time interval potentially resulting in splitting one episodic event into two time steps when only extreme values are retained in the analyses many other major events could be missed with these major events retained in hydrologic analyses a greater number of events will be used and it offers greater flexibility and robustness renima et al 2018 a novel concentration duration frequency cdf curve has been proposed to characterize time connected duration and frequency of water quality episodic events robinson and roby 2006 schwartz et al 2008 this is warranted because aquatic organisms are impacted by both the concentration and time connected duration of water quality parameters such as ph or turbidity robinson and roby 2006 for example brook trout s foraging success reduced by 80 for 40 ntu water over 10 min sweka and hartman 2001 following the idf procedure defined by chin et al 2000 greb and graczyk 1995 robinson and roby 2006 rousseau et al 2001 schwartz et al 2008 developed cdf curves for different parameters in water resource management the time connected durations of episodic low streamflow events are often critical regulations and management of water resources are often based on the levels of streamflow or water availability water withdrawals are sometimes restricted or ceased when streamflow is less than a prescribed protective minimum streamflow in several states in the united states zhang 2017 zhang and balay 2014 the time connected durations of episodic low streamflow events are also needed to analyze water supply risks kelly et al 2018 in water resources management streamflow levels of interest are often determined for water development for example a protective streamflow is often determined based on the response of aquatic species to hydrologic alteration acreman and dunbar 2004 when streamflow levels are determined how long these exceedance events last continuously and how often episodic low streamflow events occur provide the basis for designing cooling water ponds assessing water supply risks managing droughts and characterizing impacts on aquatic species this type of information is needed but widely used graphical or statistical tools such as fdc qdf or sdf curves in hydrology do not provide both the streamflow magnitude time connected duration and frequency information simultaneously for a pre determined streamflow level the objective of this study is to develop a flow duration frequency fdf curve that provides the needed information of time connected durations and frequencies of low streamflow episodic events we contribute to the development and fitting of the fdf curve in addition we extensively test the fitting of fdf curves using bootstrap resampling experiments and examine the performance of the fitting for 92 long term continuous united states geological survey usgs streamflow gages distributed through the state of illinois the fdf curves proposed in this study provide a graphic tool to characterize episodic low streamflow events for water resources managers when streamflow levels of interest are determined this tool can be used to assess water supply risks identify durations and frequencies of streamflow droughts evaluate low flow management and characterize environmental flow requirements the tool will be a valuable complement to commonly employed graphic tools such as fdcs in section 2 the study area and data are described briefly the development of the fdf curve for a single gage and its curve fitting are discussed in section 3 in section 4 the bootstrap resampling experiment design used to test the fdf curve fitting is summarized it is followed by the results and conclusions based on the extensive test using 92 usgs streamflow gages 2 study area and data illinois is a state in the midwest of the united states with a total area of about 150 000 square kilometers km2 lying in the interior plains physiographic division which only has minor variation in its elevations fenneman 1928 leighton et al 1948 illinois has a typical continental climate with cold winters warm summers and moderate springs and falls the annual average temperatures in the north and south of the state are 8 9 c and 14 4 c respectively the annual precipitation ranges from 812 mm north to 1219 mm south angel 2015 the national water information system nwis of the usgs has about 400 active or inactive streamflow gages within illinois many of these gages have records less than 50 years and 92 gages that have records greater than 50 years are used in this study fig 1 these gages are the same gages that zhang 2017 used in examining the fdc development with the index gage method daily streamflow records are downloaded from the nwis website the 92 gages cover a wide range of drainage areas from 12 to 24 732 km2 the average period of record is 73 years with the minimum of 52 years and the maximum of 105 years these gages monitor watersheds with varying physiographic characteristics ranging from rural to urban from high to low baseflow contribution and from headwaters to major rivers the pertinent information of these gages is shown in table 1 3 development of fdf curves 3 1 episodic low streamflow events fig 2 depicts a hypothetical hydrograph used to demonstrate episodic low streamflow events p0 is the streamflow level of interest determined statistically or physically based on the purpose of the analysis the crossings of the p0 through the hydrograph define the beginnings and endings of episodic low streamflow events the time duration of the episodic events di is the time connected duration that the streamflow is less than or equal to p0 if the arrivals of the episodic events are independent it can be assumed to follow a poisson arrival process cramér and leadbetter 2013 and thus statistical modeling could be used to model the relationship between the frequency and duration of the episodic low streamflow events as has been used to model fdc curves in literature fennessey and vogel 1990 vogel and fennessey 1995 the daily streamflow series exhibit statistically significant autocorrelation at the 95 confident level when correlation presents mathematical modeling has been used in hydrology literature franchini and suppo 1996 mimikou and kaemaki 1985 singh 1971 in this study mathematical modeling is proposed to describe the relationship between the frequency and duration of episodic low streamflow events the duration of interest is denoted by d the frequency is described by the number of events n equal to or exceeding d exponential power and polynomial functions have been widely used in hydrology literature franchini and suppo 1996 mimikou and kaemaki 1985 based on the shape of the scatterplot of n vs d exponential power and polynomial functions are tested which are as follows 1 n α e d β 2 n α d β 3 n α β d γ d 2 4 n α β d γ d 2 θ d 3 where α β ϒ and θ are the coefficients the test of fitting of eqs 1 to 4 shows that the exponential function has the smallest sum of squared residues compared with the other 3 equations thus the exponential function is selected here to develop the fdf curve it is noteworthy that l moment diagram or probability plot correlation coefficient ppcc may be used for fitting common probability distributions hosking 1990 vogel 1986 vogel and kroll 1989 3 2 frequency and duration of episodic low streamflow events in temperate regions the threshold level approach is commonly used to estimate a hydrologic drought cancelliere and salas 2004 salas et al 2019 shin and salas 2000 tallaksen et al 2009 to develop the fdf curves the streamflow of interest needs to be determined first it could be determined by the purpose of the application such as a minimum flow requirement or desired water supply it could be also derived from the fdc which is based on the entire available streamflow record generally low flows in the range of p75 p95 are often used for perennial rivers kjeldsen et al 2000 p75 is the 75th percentile streamflow which the streamflow at the site of interest is expected to equal or exceed over the period note that the percentiles used here are exceedance percentiles instead of non exceedance percentiles as fdcs are conventionally defined with exceedance percentiles in this study five different low flows i e p75 p80 p85 p90 and p95 are employed as the cutoff levels to develop fdf curves table 2 lists the ranked durations for each event at the usgs gage 03337000 boneyard creek at urbana il for each low flow threshold the durations for each event are provided for example for the low flow threshold p80 there are 5 events n 5 with durations larger than or equal to 33 days d 33 for the low flow threshold p95 there are 5 events n 5 with durations greater than or equal to 18 days d 18 3 3 fdf curve fitting the frequency and duration of episodic low streamflow events shown in table 2 are graphically presented in fig 3 where the x axis is the duration of events d and y axis is the number of events n the fdf curve is developed by fitting the observed points to the exponential function using least square approach to estimate the parameters α and β the parameter α represents the total number of events and β represents the mean duration of all events the fdf curves for the 5 streamflow thresholds are shown in fig 3 as well table 3 shows the estimated parameters α and β of these fdf curves it appears that the exponential function fits well to the observed episodic low streamflow events it is noted that the y axis is in log space and graphically the fitting in the right tail appears not as good as the other parts of the fdf curve both the total number of low streamflow events and the mean duration decrease when the streamflow threshold decreases at the boneyard creek gage 4 bootstrap resampling experiment to use fdf curves in real world water resources management practices one needs to comprehensively understand how to fit fdf curve and what factors may impact fdf curves specifically it is important to understand and answer the following questions 1 how does fdf curve fitting performance vary when the period of record varies 2 how do the parameters of the exponential functions change with varying record length 3 how many years of hydrologic record would be required to derive an fdf curve in water resources practice 4 how do streamflow thresholds used to determine episodic low streamflow events impact fdf curves bootstrap resampling experiments using the long term continuous streamflow records for the 92 usgs streamflow gages in illinois are employed here to explore these impacts the bootstrap method has commonly been applied in the hydrology literature zhang and kroll 2007 4 1 bootstrap resampling design in this study the bootstrap resampling experiment based on fdf curve fitting followed these steps 1 select a usgs streamflow gage from the 92 gages and choose p75 as the streamflow threshold and then determine parameters α and β of the fdf curve using the entire streamflow record this fdf curve is considered the representative fdf curve as it is derived using the entire streamflow records 2 randomly generate a bootstrap sample consisting of n 5 years of streamflow record with a replacement based on the entire streamflow record to maintain the intra annual variability of streamflow the resampling is performed using entire annual records based on a climate year which starts on april 1 of a year and ends on march 31 of the subsequent year the streamflow sample is represented as x x 1 x 2 xi xn where xi is the ith streamflow data slice a year of streamflow and n is the period of records in the samples the serial correlations of annual flows of all the gages generally are weak with correlation coefficient less than 0 4 thus sampling based on annual data is reasonable 3 estimate the parameters of α and β for the fdf curves using the bootstrap sample 4 compute the root mean square error rmse percent absolute error pae and nash sutcliffe efficiency coefficient nse for the fdf curves based on the bootstrap sample with respect to the representative fdf curve the rmse pae and nse are described in the following section 5 repeat steps 2 to 4 for 1000 times by generating 1000 bootstrap samples the large number of samples ensure the comprehensive evaluation of the fdf curve fitting 6 summarize the rmse pae and nse for the 1000 bootstrap samples 7 repeat steps 2 to 6 for bootstrap sample consisting of 10 20 30 40 and 50 years of streamflow records 8 repeat steps 1 to 7 by changing the streamflow threshold of p80 p85 p90 and p95 sequentially 9 repeat steps 1 to 8 for each of the 92 long term usgs gages 10 summarize and characterize the rmse pae and nse across the 92 usgs gages to evaluate the overall performance of the fdf curve fitting the number of low streamflow events depends on the period of records used for deriving the fdf curve thus to compare the performance of the fdf curve fitting for different period of records the number of low streamflow events for a specific period is converted to the number of low streamflow events for a period of 100 years 4 2 performance metrics three commonly used performance metrics rmse pae and nse are employed to evaluate how the fdf curves developed using the bootstrap samples match the representative fdf curve developed using the entire streamflow records it is noteworthy that the performance metrics are calculated in logarithms 5 r m s e t 1 m log 10 y b t log 10 y r t 2 m 6 p a e t 1 m log 10 y b t log 10 y r t log 10 y r t 7 n s e 1 t 1 m log 10 y b t log 10 y r t 2 t 1 m log 10 y r t log 10 y r t 2 where m is the maximum duration of events yr t is the number of events from the representative fdf curve and yb t is the number of events from the fdf curves using the bootstrap sample and y r t is the average of yr t 5 results and discussion the results of bootstrapping resampling experiment are presented for a single usgs gage based on the usgs gage 03337000 boneyard creek at urbana il refer to as boneyard gage hereafter and for all 92 gages to explore the fdf curve development for a single site and overall performance of fdf development based on 92 gages respectively 5 1 fdf for an individual gage fig 4 graphically shows the results of the bootstrap resampling experiment for boneyard gage for different periods of records of 5 10 20 30 40 and 50 years and for streamflow thresholds of p75 p80 p85 p90 and p95 the red curve in each panel is the representative fdf curve developed using the entire streamflow record and green curves are the 1000 fdf curves developed using the bootstrap samples as shown in the figure the fdf curves based on the 1000 bootstrap samples form a band with different widths around the representative fdf curve for a specific streamflow threshold with increasing period of records the band gradually becomes narrower and all the fdf curves of bootstrap samples tend to center around the representative fdf curve there are a small number of outlier fdf curves of the 1000 bootstrap samples indicating the fdf curves deviate remarkably from the representative fdf curve and the majority bootstrap sample fdf curves the number of the outlier fdf curves gradually diminish as the period of record increases when the period of record is 30 years or longer the outlier fdf curves do not exist anymore this demonstrates greater variability in the fdf curves for a shorter period of record when the streamflow records used for developing fdf curves are 30 years or longer the variability in the fdf decreases noticeably for the same period of record it can be seen that the variability of fdf curves increase from p75 a relatively higher streamflow threshold to p95 a relatively lower streamflow threshold this indicates that the fdf curves based on very low streamflow threshold and short period of record could be very uncertain to assess the fdf curves based on bootstrap samples the rmse pae and nse are averaged over the 1000 samples figs 5 7 shows the averages of rmse pae and nse rmse and pae demonstrate very similar patterns for a specific streamflow threshold both rmse and pae decrease with increasing periods of record indicating the fdf curves using a longer period of records match better to the representative fdf curve it is also noted that the improvement of the fdf with increasing periods of record levels off when the period is 30 years or longer this indicates that when the streamflow record is less than 30 years it is beneficial to obtain longer streamflow records to develop fdf curves however when the streamflow record is 30 years or longer the benefit of obtaining additional streamflow record is diminishing the results also show that the rmse and pae decrease when the streamflow threshold increases in fig 7 the nse values of all different periods of record show an increasing trend with increasing periods of record the nse values are greater than 0 95 when the period of record is 30 years or longer indicating a good fitting performance between the fdf curve of the bootstrap samples and the representative fdf curves it also shows when the streamflow threshold is low i e p95 and the period of record is short 5 or 10 years the nse values are less than 0 8 indicating the fdf curves for a low threshold and short period of record are highly uncertain in addition to assessing fdf curve fitting the parameters of the exponential function used for developing the fdf curves are also examined in detail figs 8 and 9 provide the histograms of the parameters α and β based on the 1000 bootstrap samples for the periods of records at 5 10 20 30 40 and 50 years for the streamflow threshold of p95 the histograms of α and β for other streamflow thresholds are similar to figs 8 and 9 and thus are not presented here from figs 8 and 9 both α and β approximately follow a normal distribution for different periods of records α and β show greater variability for shorter periods such as 5 or 10 years than those for longer periods of records this indicates that the estimators of the parameters of the exponential function for a shortened period of record have greater variability than for a longer period of record it is also found the improvement from using a longer period of record levels off when the period of record is 30 years or longer 5 2 fdf fitting for all sites to comprehensively assess the fdf curve fitting using the exponential function the overall results for 92 gages are summarized with respect to the performance metrics figs 10 12 show the mean rmse pae and nse for 92 usgs gages versus different periods of records for the 5 selected streamflow thresholds for a specific streamflow threshold the mean rmse decreases when a longer period of record is employed the improvement however levels off when the period of record is 30 years or longer for the same period of record the mean rmse increases when the streamflow threshold increases indicating the fdf curves with a lower streamflow threshold are more variable than those with a higher streamflow threshold the pae shows a very similar pattern as the rmse for a specific streamflow threshold the mean nse increases with a longer period of record it is also noted that the mean nse levels off when the period of record is 30 years or longer for the same period of record the nse decreases when the streamflow threshold decreases indicating variability of the fdf curve for a lower streamflow threshold is relatively greater for a streamflow threshold of p95 the mean nse the period of record of 5 and 10 is 1 5 and 0 65 respectively the extremely low nse values indicate that when the streamflow record is less than or equal 10 years the fdf curves for a streamflow threshold of p95 are highly uncertain on the other hand when the streamflow is 30 years or longer the improvement measured by the nse is minimal these results indicate that for developing a reliable fdf curve 30 years of streamflow record are warranted though additional streamflow record would increase the fdf curve fitting to explore the distribution of the rmse pae and nse over the 92 gages the histograms of the rmse pae and nse are demonstrated in figs 13 15 for the 5 selected period of records and 5 selected streamflow thresholds for the same streamflow threshold the rmse is more clustered for a longer period of record than for a shorter period of record in addition the rmse is also less for a long period of record than for a shorter period of record the same as shown by the mean rmse in fig 10 the improvement measured by rmse appears to level off when the period of record is 30 years or longer for the same period of record the rmse for fdf curves with a higher streamflow threshold is more clustered than for those with a lower streamflow threshold from figs 14 and 15 the pae and nse demonstrate very similar characteristics graphically with the rmse in fig 13 this confirms that the proposed fdf development approach performs consistently with varying performance metrics especially when the period of record is 30 years or longer 5 3 occurrence of short duration episodic low streamflow events the deviation of the fdf curves from the observations is often greater for long duration episodic low streamflow events as seen from figs 3 and 4 a potential reason could be the occurrence of many short duration events i e 1 day through 6 days of low streamflows which impact fdf curve fitting for drought management these events are often pooled by using moving averages of a specific length i e 7 day averages beyene et al 2014 saifullah et al 2019 these short duration episodic events sometimes are excluded to simplify the analysis of streamflow drought characteristics for example see tallaksen et al 1997 zelenhasić and salvai 1987 rivera et al 2017 saifullah et al 2019 in water resources management practice short duration episodic low streamflow events also have minor impact on water resources and policy thus the events with duration of less than 7 days are excluded and fdf curve is fit to explore the impact of short duration events the developed fdf curves with exclusion of these events at the boneyard creek gage are shown in fig 16 it appears that the exclusion of short duration events appears to improve the fit of fdf curves for longer duration low streamflow both kolmogorov smirnov test massey 1951 and anderson darling test stephens 1974 confirmed the fit of fdf curves has been improved substantially the comprehensive impacts of short duration low streamflow events on fdf curves are worthy of further examination 5 4 potential use of fdf curves based on the results shown above an fdf curve may be used in water resources practices if it is developed from a relatively long term streamflow records 30 years or more for a range of purposes for example if a power plant in illinois needs to withdraw cooling water from a river it likely will have a protective streamflow requirement which requires the power plant to cease water withdrawal when the streamflow at the intake is equal to or less than the protective streamflow requirement in illinois low flows often occur during summers and falls coincidently with the high electricity demand thus the power plant might design a storage pond as a backup water supply when water withdrawal must be ceased due to the protective streamflow requirement in this situation the fdf curve provides the number of continuous days when streamflow will be less than the protective streamflow requirement and how often it occurs the fdf tool provides the basis for sizing storage ponds and assessing corresponding risks resources agencies may also use fdf curves to evaluate environmental flows conventionally environmental flows are derived using fdcs or monthly fdcs based on hydrologic alteration impacts on aquatic species richter 2010 zhang et al 2020 usually environmental flows consider the impact of the change in magnitude of streamflow on aquatic species but the time connected durations of hydrologic alteration are not considered fdf curves can provide information on time connected durations and associated frequencies to better determine environmental flows which consider impacts of both magnitude and time connected durations on aquatic species and the ecosystems 6 conclusions in water resource management and practices the time connected duration and frequency of episodic low streamflow events and droughts are often needed for a range of purposes however the existing graphical tools commonly used in hydrology often do not provide this information in a concise way in this study we contribute an approach to develop an fdf curve based on fitting an exponential function to graphically show the time connected duration and frequency of episodic low streamflow events the fdf is derived by fitting an exponential function to the observed time connected duration and frequency of episodic low streamflow events the fdf curve fit is comprehensively tested with a bootstrap resampling experiment using long term continuous streamflow records for 92 usgs gages located in the state of illinois u s a the experiment results reveal that the proposed methodology can reasonably develop fdf curves for episodic low streamflow events based on the results the following conclusions could be reached 1 the fdf curves can simultaneously graphically show the time connected duration and frequency of episodic low streamflow events which is very valuable for providing information to water resources planning low flow management drought management water supply planning etc 2 the episodic low streamflow events can be well fitted by an exponential function and thus the developed fdf curve could be used to stochastically analyze features of the episodic low streamflow events 3 for a specific streamflow threshold used to define episodic low streamflow events the fdf curves based on longer period of record are more reliable and when the period of record is 30 years or longer the improvement with additional streamflow levels off thus it is recommended the minimum of 30 years of streamflow record is used to develop an fdf curve 4 for the same period of record it appears the fdf curves based on a relative higher streamflow threshold are more stable this demonstrates that it is harder to characterize the stochastic features for episodic low streamflow events based on extremely low streamflow such as p95 the fdf curves proposed in the study provide critically valuable information for water resources management and planning while the current study examines comprehensively how to fit the observed episodic low streamflow events with an exponential function it is warranted in the future to explore how other functions may improve the fitting in addition it will be very valuable if a regional fdf curve could be developed to be used for sites with short or no records credit authorship contribution statement weiguo zhao data curation formal analysis investigation methodology writing original draft xue guan zhenxing zhang conceptualization methodology supervision writing original draft zhaoli wang liying wang emily allen mamer declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the author would like to thank laura keefer for her encouragement to purse this investigation and lisa sheppard for editorial review we also want to thank sadia sabrina for assisting on the arcgis map generation editors and three anonymous reviewers provided insightful comments and we appreciate their comments any opinions findings and conclusions or recommendations expressed in this paper are those of the authors and do not necessarily reflect the views of the illinois state water survey or the university of illinois weiguo zhao was supported in part by the one hundred outstanding innovative scholars of colleges and universities in hebei province in china under grant slrc2019022 
238,in water resources management and practices the time connected duration and frequency of episodic low streamflow events and droughts are often needed for a range of purposes such as water supply planning low flow management and drought planning however the existing graphical tools commonly used in hydrology such as flow duration curves fdc discharge duration frequency qdf and severity duration frequency sdf curves often do not provide this information in this study we contribute an approach to develop a flow duration frequency fdf curve by fitting the exponential function to graphically show the time connected duration and frequency of episodic low streamflow events the fdf fitting is comprehensively tested with a bootstrap resampling experiment using long term continuous streamflow records for 92 usgs gages located in the state of illinois u s a the experiment results reveal that the proposed methodology can reasonably develop fdf curves for episodic low streamflow events the results demonstrate that the fdf fitting is improved by using longer streamflow record though the improvement appears to level off with 30 years or longer streamflow records the results also confirm that the fdf fitting is more reliable for higher streamflow threshold to define episodic low streamflow events keywords drought water resources graphic tool stochastic hydrology low flow 1 introduction drought is the result of precipitation deficiency and or high evapotranspiration over prolonged periods and extended areas it is temporary deviance from long term normal climatic conditions unlike aridity which is permanent climate feature with a long term normal condition of low precipitation drought is temporary while the impact of drought is often underestimated due to slow onset it is the second most costly natural hazard in the united states causing average annual losses of 9 billion for the period of 1980 2019 in cpi adjusted 2019 value ncei 2019 based on the four properties of drought i e nature of water deficit time unit threshold and regionalization proposed by dracup et al 1980 a raft of indices have been proposed and used to characterize drought nalbantis and tsakiris 2009 palmer 1965 sung and chung 2014 drought can be defined based on disciplinary perspectives and is commonly classified as four categories meteorological or climatological agricultural hydrological and socioeconomic droughts american meteorological society 1997 wilhite and glantz 1985 meteorological drought is based on precipitation deficit agricultural drought links impact of drought to agriculture hydrological drought occurs when precipitation deficits impact water resources including streamflow reservoir and lake storage as well as groundwater socioeconomic drought focuses on societal and economic impacts of drought streamflow is the key variable to describe hydrological droughts tsakiris et al 2013 a phenomenon that is difficult to characterize sung and chung 2014 hydrological drought is often defined based on streamflow below average water availability i e a threshold level tallaksen and van lanen 2004 the threshold level is often based on daily monthly seasonally or annual percentile flows for a selected duration that is derived from a flow duration curve fdc there are many graphic tools to characterize streamflow and hydrological drought among which fdcs are the most extensively used the fdc graphically represents the frequency or the percentage of time in which a streamflow of a given magnitudeis equaled or exceeded over a specified period vogel and fennessey 1994 zhang 2017 it provides a stochastic representation of streamflow variability over the period müller et al 2014 a fdc presents a wealth of hydrologic information in a single graph and thus has long history in applications including but not limited to hydropower planning water quality management flood control water supply planning and river sedimentation analyses vogel and fennessey 1995 however fdcs only illustrate streamflow variability in the frequency domain without considering the time connected durations of episodic events which is critical for water supply planning and water resources management to include durations of episodic events discharge duration frequency qdf curves were developed and investigated using statistical analyses of streamflow to estimate floods or low flow for a given occurrence probability galea and prudhomme 1994 1997 sherwood 1994 qdf has been use to analyze streamflow features for catchments located in france javelle et al 1999 martinique meunier 2001 and canada javelle et al 2002 qdf curves are developed similarly as intensity duration frequency idf curves that were commonly applied in rainfall analyses except qdfs are applied to discharge data chin et al 2000 qdfs like idfs consider the duration as a fixed parameter first discharges are aggregated over a specific fixed duration then for each duration a probability distribution is fitted to the extracted maxima of these aggregated discharge values javelle et al 2002 when qdfs are applied to analyze floods the curve may be called flood duration curve as well renima et al 2018 qdfs could be also used for exploring low flows to examine the relationship onyutha and willems 2013 severity duration frequency curves sdf employed by sung and chung 2014 explore characteristics of streamflow drought using the threshold level approach based on selected threshold streamflow levels streamflow drought severity and duration are calculated and an appropriate generalized extreme value gev probability distribution is selected using the l moment diagrams of various goodness of fit techniques the sdf curves are then developed using the selected gev distribution while both qdf and sdf curves consider durations of individual high flow or low flow events it is often based on annual maximum or minimum series information of the durations and frequencies of all time connected episodic events not just the annual extreme events is often needed for many water resource management purposes such as water supply planning drought planning minimum flow management water availability for power generation etc denooyer et al 2016 this type of information however cannot be obtained from fdc qdf or sdf curves qdfs and sdfs do not consider all time connected episodic events and they are analyzed using time partition to segregate data to the annual time interval potentially resulting in splitting one episodic event into two time steps when only extreme values are retained in the analyses many other major events could be missed with these major events retained in hydrologic analyses a greater number of events will be used and it offers greater flexibility and robustness renima et al 2018 a novel concentration duration frequency cdf curve has been proposed to characterize time connected duration and frequency of water quality episodic events robinson and roby 2006 schwartz et al 2008 this is warranted because aquatic organisms are impacted by both the concentration and time connected duration of water quality parameters such as ph or turbidity robinson and roby 2006 for example brook trout s foraging success reduced by 80 for 40 ntu water over 10 min sweka and hartman 2001 following the idf procedure defined by chin et al 2000 greb and graczyk 1995 robinson and roby 2006 rousseau et al 2001 schwartz et al 2008 developed cdf curves for different parameters in water resource management the time connected durations of episodic low streamflow events are often critical regulations and management of water resources are often based on the levels of streamflow or water availability water withdrawals are sometimes restricted or ceased when streamflow is less than a prescribed protective minimum streamflow in several states in the united states zhang 2017 zhang and balay 2014 the time connected durations of episodic low streamflow events are also needed to analyze water supply risks kelly et al 2018 in water resources management streamflow levels of interest are often determined for water development for example a protective streamflow is often determined based on the response of aquatic species to hydrologic alteration acreman and dunbar 2004 when streamflow levels are determined how long these exceedance events last continuously and how often episodic low streamflow events occur provide the basis for designing cooling water ponds assessing water supply risks managing droughts and characterizing impacts on aquatic species this type of information is needed but widely used graphical or statistical tools such as fdc qdf or sdf curves in hydrology do not provide both the streamflow magnitude time connected duration and frequency information simultaneously for a pre determined streamflow level the objective of this study is to develop a flow duration frequency fdf curve that provides the needed information of time connected durations and frequencies of low streamflow episodic events we contribute to the development and fitting of the fdf curve in addition we extensively test the fitting of fdf curves using bootstrap resampling experiments and examine the performance of the fitting for 92 long term continuous united states geological survey usgs streamflow gages distributed through the state of illinois the fdf curves proposed in this study provide a graphic tool to characterize episodic low streamflow events for water resources managers when streamflow levels of interest are determined this tool can be used to assess water supply risks identify durations and frequencies of streamflow droughts evaluate low flow management and characterize environmental flow requirements the tool will be a valuable complement to commonly employed graphic tools such as fdcs in section 2 the study area and data are described briefly the development of the fdf curve for a single gage and its curve fitting are discussed in section 3 in section 4 the bootstrap resampling experiment design used to test the fdf curve fitting is summarized it is followed by the results and conclusions based on the extensive test using 92 usgs streamflow gages 2 study area and data illinois is a state in the midwest of the united states with a total area of about 150 000 square kilometers km2 lying in the interior plains physiographic division which only has minor variation in its elevations fenneman 1928 leighton et al 1948 illinois has a typical continental climate with cold winters warm summers and moderate springs and falls the annual average temperatures in the north and south of the state are 8 9 c and 14 4 c respectively the annual precipitation ranges from 812 mm north to 1219 mm south angel 2015 the national water information system nwis of the usgs has about 400 active or inactive streamflow gages within illinois many of these gages have records less than 50 years and 92 gages that have records greater than 50 years are used in this study fig 1 these gages are the same gages that zhang 2017 used in examining the fdc development with the index gage method daily streamflow records are downloaded from the nwis website the 92 gages cover a wide range of drainage areas from 12 to 24 732 km2 the average period of record is 73 years with the minimum of 52 years and the maximum of 105 years these gages monitor watersheds with varying physiographic characteristics ranging from rural to urban from high to low baseflow contribution and from headwaters to major rivers the pertinent information of these gages is shown in table 1 3 development of fdf curves 3 1 episodic low streamflow events fig 2 depicts a hypothetical hydrograph used to demonstrate episodic low streamflow events p0 is the streamflow level of interest determined statistically or physically based on the purpose of the analysis the crossings of the p0 through the hydrograph define the beginnings and endings of episodic low streamflow events the time duration of the episodic events di is the time connected duration that the streamflow is less than or equal to p0 if the arrivals of the episodic events are independent it can be assumed to follow a poisson arrival process cramér and leadbetter 2013 and thus statistical modeling could be used to model the relationship between the frequency and duration of the episodic low streamflow events as has been used to model fdc curves in literature fennessey and vogel 1990 vogel and fennessey 1995 the daily streamflow series exhibit statistically significant autocorrelation at the 95 confident level when correlation presents mathematical modeling has been used in hydrology literature franchini and suppo 1996 mimikou and kaemaki 1985 singh 1971 in this study mathematical modeling is proposed to describe the relationship between the frequency and duration of episodic low streamflow events the duration of interest is denoted by d the frequency is described by the number of events n equal to or exceeding d exponential power and polynomial functions have been widely used in hydrology literature franchini and suppo 1996 mimikou and kaemaki 1985 based on the shape of the scatterplot of n vs d exponential power and polynomial functions are tested which are as follows 1 n α e d β 2 n α d β 3 n α β d γ d 2 4 n α β d γ d 2 θ d 3 where α β ϒ and θ are the coefficients the test of fitting of eqs 1 to 4 shows that the exponential function has the smallest sum of squared residues compared with the other 3 equations thus the exponential function is selected here to develop the fdf curve it is noteworthy that l moment diagram or probability plot correlation coefficient ppcc may be used for fitting common probability distributions hosking 1990 vogel 1986 vogel and kroll 1989 3 2 frequency and duration of episodic low streamflow events in temperate regions the threshold level approach is commonly used to estimate a hydrologic drought cancelliere and salas 2004 salas et al 2019 shin and salas 2000 tallaksen et al 2009 to develop the fdf curves the streamflow of interest needs to be determined first it could be determined by the purpose of the application such as a minimum flow requirement or desired water supply it could be also derived from the fdc which is based on the entire available streamflow record generally low flows in the range of p75 p95 are often used for perennial rivers kjeldsen et al 2000 p75 is the 75th percentile streamflow which the streamflow at the site of interest is expected to equal or exceed over the period note that the percentiles used here are exceedance percentiles instead of non exceedance percentiles as fdcs are conventionally defined with exceedance percentiles in this study five different low flows i e p75 p80 p85 p90 and p95 are employed as the cutoff levels to develop fdf curves table 2 lists the ranked durations for each event at the usgs gage 03337000 boneyard creek at urbana il for each low flow threshold the durations for each event are provided for example for the low flow threshold p80 there are 5 events n 5 with durations larger than or equal to 33 days d 33 for the low flow threshold p95 there are 5 events n 5 with durations greater than or equal to 18 days d 18 3 3 fdf curve fitting the frequency and duration of episodic low streamflow events shown in table 2 are graphically presented in fig 3 where the x axis is the duration of events d and y axis is the number of events n the fdf curve is developed by fitting the observed points to the exponential function using least square approach to estimate the parameters α and β the parameter α represents the total number of events and β represents the mean duration of all events the fdf curves for the 5 streamflow thresholds are shown in fig 3 as well table 3 shows the estimated parameters α and β of these fdf curves it appears that the exponential function fits well to the observed episodic low streamflow events it is noted that the y axis is in log space and graphically the fitting in the right tail appears not as good as the other parts of the fdf curve both the total number of low streamflow events and the mean duration decrease when the streamflow threshold decreases at the boneyard creek gage 4 bootstrap resampling experiment to use fdf curves in real world water resources management practices one needs to comprehensively understand how to fit fdf curve and what factors may impact fdf curves specifically it is important to understand and answer the following questions 1 how does fdf curve fitting performance vary when the period of record varies 2 how do the parameters of the exponential functions change with varying record length 3 how many years of hydrologic record would be required to derive an fdf curve in water resources practice 4 how do streamflow thresholds used to determine episodic low streamflow events impact fdf curves bootstrap resampling experiments using the long term continuous streamflow records for the 92 usgs streamflow gages in illinois are employed here to explore these impacts the bootstrap method has commonly been applied in the hydrology literature zhang and kroll 2007 4 1 bootstrap resampling design in this study the bootstrap resampling experiment based on fdf curve fitting followed these steps 1 select a usgs streamflow gage from the 92 gages and choose p75 as the streamflow threshold and then determine parameters α and β of the fdf curve using the entire streamflow record this fdf curve is considered the representative fdf curve as it is derived using the entire streamflow records 2 randomly generate a bootstrap sample consisting of n 5 years of streamflow record with a replacement based on the entire streamflow record to maintain the intra annual variability of streamflow the resampling is performed using entire annual records based on a climate year which starts on april 1 of a year and ends on march 31 of the subsequent year the streamflow sample is represented as x x 1 x 2 xi xn where xi is the ith streamflow data slice a year of streamflow and n is the period of records in the samples the serial correlations of annual flows of all the gages generally are weak with correlation coefficient less than 0 4 thus sampling based on annual data is reasonable 3 estimate the parameters of α and β for the fdf curves using the bootstrap sample 4 compute the root mean square error rmse percent absolute error pae and nash sutcliffe efficiency coefficient nse for the fdf curves based on the bootstrap sample with respect to the representative fdf curve the rmse pae and nse are described in the following section 5 repeat steps 2 to 4 for 1000 times by generating 1000 bootstrap samples the large number of samples ensure the comprehensive evaluation of the fdf curve fitting 6 summarize the rmse pae and nse for the 1000 bootstrap samples 7 repeat steps 2 to 6 for bootstrap sample consisting of 10 20 30 40 and 50 years of streamflow records 8 repeat steps 1 to 7 by changing the streamflow threshold of p80 p85 p90 and p95 sequentially 9 repeat steps 1 to 8 for each of the 92 long term usgs gages 10 summarize and characterize the rmse pae and nse across the 92 usgs gages to evaluate the overall performance of the fdf curve fitting the number of low streamflow events depends on the period of records used for deriving the fdf curve thus to compare the performance of the fdf curve fitting for different period of records the number of low streamflow events for a specific period is converted to the number of low streamflow events for a period of 100 years 4 2 performance metrics three commonly used performance metrics rmse pae and nse are employed to evaluate how the fdf curves developed using the bootstrap samples match the representative fdf curve developed using the entire streamflow records it is noteworthy that the performance metrics are calculated in logarithms 5 r m s e t 1 m log 10 y b t log 10 y r t 2 m 6 p a e t 1 m log 10 y b t log 10 y r t log 10 y r t 7 n s e 1 t 1 m log 10 y b t log 10 y r t 2 t 1 m log 10 y r t log 10 y r t 2 where m is the maximum duration of events yr t is the number of events from the representative fdf curve and yb t is the number of events from the fdf curves using the bootstrap sample and y r t is the average of yr t 5 results and discussion the results of bootstrapping resampling experiment are presented for a single usgs gage based on the usgs gage 03337000 boneyard creek at urbana il refer to as boneyard gage hereafter and for all 92 gages to explore the fdf curve development for a single site and overall performance of fdf development based on 92 gages respectively 5 1 fdf for an individual gage fig 4 graphically shows the results of the bootstrap resampling experiment for boneyard gage for different periods of records of 5 10 20 30 40 and 50 years and for streamflow thresholds of p75 p80 p85 p90 and p95 the red curve in each panel is the representative fdf curve developed using the entire streamflow record and green curves are the 1000 fdf curves developed using the bootstrap samples as shown in the figure the fdf curves based on the 1000 bootstrap samples form a band with different widths around the representative fdf curve for a specific streamflow threshold with increasing period of records the band gradually becomes narrower and all the fdf curves of bootstrap samples tend to center around the representative fdf curve there are a small number of outlier fdf curves of the 1000 bootstrap samples indicating the fdf curves deviate remarkably from the representative fdf curve and the majority bootstrap sample fdf curves the number of the outlier fdf curves gradually diminish as the period of record increases when the period of record is 30 years or longer the outlier fdf curves do not exist anymore this demonstrates greater variability in the fdf curves for a shorter period of record when the streamflow records used for developing fdf curves are 30 years or longer the variability in the fdf decreases noticeably for the same period of record it can be seen that the variability of fdf curves increase from p75 a relatively higher streamflow threshold to p95 a relatively lower streamflow threshold this indicates that the fdf curves based on very low streamflow threshold and short period of record could be very uncertain to assess the fdf curves based on bootstrap samples the rmse pae and nse are averaged over the 1000 samples figs 5 7 shows the averages of rmse pae and nse rmse and pae demonstrate very similar patterns for a specific streamflow threshold both rmse and pae decrease with increasing periods of record indicating the fdf curves using a longer period of records match better to the representative fdf curve it is also noted that the improvement of the fdf with increasing periods of record levels off when the period is 30 years or longer this indicates that when the streamflow record is less than 30 years it is beneficial to obtain longer streamflow records to develop fdf curves however when the streamflow record is 30 years or longer the benefit of obtaining additional streamflow record is diminishing the results also show that the rmse and pae decrease when the streamflow threshold increases in fig 7 the nse values of all different periods of record show an increasing trend with increasing periods of record the nse values are greater than 0 95 when the period of record is 30 years or longer indicating a good fitting performance between the fdf curve of the bootstrap samples and the representative fdf curves it also shows when the streamflow threshold is low i e p95 and the period of record is short 5 or 10 years the nse values are less than 0 8 indicating the fdf curves for a low threshold and short period of record are highly uncertain in addition to assessing fdf curve fitting the parameters of the exponential function used for developing the fdf curves are also examined in detail figs 8 and 9 provide the histograms of the parameters α and β based on the 1000 bootstrap samples for the periods of records at 5 10 20 30 40 and 50 years for the streamflow threshold of p95 the histograms of α and β for other streamflow thresholds are similar to figs 8 and 9 and thus are not presented here from figs 8 and 9 both α and β approximately follow a normal distribution for different periods of records α and β show greater variability for shorter periods such as 5 or 10 years than those for longer periods of records this indicates that the estimators of the parameters of the exponential function for a shortened period of record have greater variability than for a longer period of record it is also found the improvement from using a longer period of record levels off when the period of record is 30 years or longer 5 2 fdf fitting for all sites to comprehensively assess the fdf curve fitting using the exponential function the overall results for 92 gages are summarized with respect to the performance metrics figs 10 12 show the mean rmse pae and nse for 92 usgs gages versus different periods of records for the 5 selected streamflow thresholds for a specific streamflow threshold the mean rmse decreases when a longer period of record is employed the improvement however levels off when the period of record is 30 years or longer for the same period of record the mean rmse increases when the streamflow threshold increases indicating the fdf curves with a lower streamflow threshold are more variable than those with a higher streamflow threshold the pae shows a very similar pattern as the rmse for a specific streamflow threshold the mean nse increases with a longer period of record it is also noted that the mean nse levels off when the period of record is 30 years or longer for the same period of record the nse decreases when the streamflow threshold decreases indicating variability of the fdf curve for a lower streamflow threshold is relatively greater for a streamflow threshold of p95 the mean nse the period of record of 5 and 10 is 1 5 and 0 65 respectively the extremely low nse values indicate that when the streamflow record is less than or equal 10 years the fdf curves for a streamflow threshold of p95 are highly uncertain on the other hand when the streamflow is 30 years or longer the improvement measured by the nse is minimal these results indicate that for developing a reliable fdf curve 30 years of streamflow record are warranted though additional streamflow record would increase the fdf curve fitting to explore the distribution of the rmse pae and nse over the 92 gages the histograms of the rmse pae and nse are demonstrated in figs 13 15 for the 5 selected period of records and 5 selected streamflow thresholds for the same streamflow threshold the rmse is more clustered for a longer period of record than for a shorter period of record in addition the rmse is also less for a long period of record than for a shorter period of record the same as shown by the mean rmse in fig 10 the improvement measured by rmse appears to level off when the period of record is 30 years or longer for the same period of record the rmse for fdf curves with a higher streamflow threshold is more clustered than for those with a lower streamflow threshold from figs 14 and 15 the pae and nse demonstrate very similar characteristics graphically with the rmse in fig 13 this confirms that the proposed fdf development approach performs consistently with varying performance metrics especially when the period of record is 30 years or longer 5 3 occurrence of short duration episodic low streamflow events the deviation of the fdf curves from the observations is often greater for long duration episodic low streamflow events as seen from figs 3 and 4 a potential reason could be the occurrence of many short duration events i e 1 day through 6 days of low streamflows which impact fdf curve fitting for drought management these events are often pooled by using moving averages of a specific length i e 7 day averages beyene et al 2014 saifullah et al 2019 these short duration episodic events sometimes are excluded to simplify the analysis of streamflow drought characteristics for example see tallaksen et al 1997 zelenhasić and salvai 1987 rivera et al 2017 saifullah et al 2019 in water resources management practice short duration episodic low streamflow events also have minor impact on water resources and policy thus the events with duration of less than 7 days are excluded and fdf curve is fit to explore the impact of short duration events the developed fdf curves with exclusion of these events at the boneyard creek gage are shown in fig 16 it appears that the exclusion of short duration events appears to improve the fit of fdf curves for longer duration low streamflow both kolmogorov smirnov test massey 1951 and anderson darling test stephens 1974 confirmed the fit of fdf curves has been improved substantially the comprehensive impacts of short duration low streamflow events on fdf curves are worthy of further examination 5 4 potential use of fdf curves based on the results shown above an fdf curve may be used in water resources practices if it is developed from a relatively long term streamflow records 30 years or more for a range of purposes for example if a power plant in illinois needs to withdraw cooling water from a river it likely will have a protective streamflow requirement which requires the power plant to cease water withdrawal when the streamflow at the intake is equal to or less than the protective streamflow requirement in illinois low flows often occur during summers and falls coincidently with the high electricity demand thus the power plant might design a storage pond as a backup water supply when water withdrawal must be ceased due to the protective streamflow requirement in this situation the fdf curve provides the number of continuous days when streamflow will be less than the protective streamflow requirement and how often it occurs the fdf tool provides the basis for sizing storage ponds and assessing corresponding risks resources agencies may also use fdf curves to evaluate environmental flows conventionally environmental flows are derived using fdcs or monthly fdcs based on hydrologic alteration impacts on aquatic species richter 2010 zhang et al 2020 usually environmental flows consider the impact of the change in magnitude of streamflow on aquatic species but the time connected durations of hydrologic alteration are not considered fdf curves can provide information on time connected durations and associated frequencies to better determine environmental flows which consider impacts of both magnitude and time connected durations on aquatic species and the ecosystems 6 conclusions in water resource management and practices the time connected duration and frequency of episodic low streamflow events and droughts are often needed for a range of purposes however the existing graphical tools commonly used in hydrology often do not provide this information in a concise way in this study we contribute an approach to develop an fdf curve based on fitting an exponential function to graphically show the time connected duration and frequency of episodic low streamflow events the fdf is derived by fitting an exponential function to the observed time connected duration and frequency of episodic low streamflow events the fdf curve fit is comprehensively tested with a bootstrap resampling experiment using long term continuous streamflow records for 92 usgs gages located in the state of illinois u s a the experiment results reveal that the proposed methodology can reasonably develop fdf curves for episodic low streamflow events based on the results the following conclusions could be reached 1 the fdf curves can simultaneously graphically show the time connected duration and frequency of episodic low streamflow events which is very valuable for providing information to water resources planning low flow management drought management water supply planning etc 2 the episodic low streamflow events can be well fitted by an exponential function and thus the developed fdf curve could be used to stochastically analyze features of the episodic low streamflow events 3 for a specific streamflow threshold used to define episodic low streamflow events the fdf curves based on longer period of record are more reliable and when the period of record is 30 years or longer the improvement with additional streamflow levels off thus it is recommended the minimum of 30 years of streamflow record is used to develop an fdf curve 4 for the same period of record it appears the fdf curves based on a relative higher streamflow threshold are more stable this demonstrates that it is harder to characterize the stochastic features for episodic low streamflow events based on extremely low streamflow such as p95 the fdf curves proposed in the study provide critically valuable information for water resources management and planning while the current study examines comprehensively how to fit the observed episodic low streamflow events with an exponential function it is warranted in the future to explore how other functions may improve the fitting in addition it will be very valuable if a regional fdf curve could be developed to be used for sites with short or no records credit authorship contribution statement weiguo zhao data curation formal analysis investigation methodology writing original draft xue guan zhenxing zhang conceptualization methodology supervision writing original draft zhaoli wang liying wang emily allen mamer declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the author would like to thank laura keefer for her encouragement to purse this investigation and lisa sheppard for editorial review we also want to thank sadia sabrina for assisting on the arcgis map generation editors and three anonymous reviewers provided insightful comments and we appreciate their comments any opinions findings and conclusions or recommendations expressed in this paper are those of the authors and do not necessarily reflect the views of the illinois state water survey or the university of illinois weiguo zhao was supported in part by the one hundred outstanding innovative scholars of colleges and universities in hebei province in china under grant slrc2019022 
239,for mitigating negative effects of floods and droughts estimates of flow indicators and their uncertainties are essential the recently introduced concept of the representative parameter sets rpss enables modelling uncertainty to be represented in the flow frequency space at low computational cost using a small subset of pre selected model parameter sets this concept is here adapted to assess hazards of three flow indicators annual maximal flow annual 7 day average low flow and annual mean flow an additional in depth analysis assesses the rps transferability to other flow indicators and to hydrological signatures rps based simulations are benchmarked with a random selection of parameter sets the results show that i rpss can be successfully transferred between flow indicators with only a small drop in model performance and ii rpss can be used to represent modelling uncertainty in hydrological signatures the rps concept has thus great potential for delineating modelling uncertainty of any environmental model keywords simulation ensemble river flow indicator frequency domain representative parameter set uncertainty cluster analysis 1 introduction both drought and flood hazards were responsible for almost 50 of all natural disasters that occurred globally over the years 1998 2017 with floods affecting the largest number of people 2 billion followed by droughts 1 5 billion unisdr and cred 2018 therefore to mitigate such negative effects of floods and droughts accurate estimates of flow indicators e g extreme low and high flows and their hazards are essential flow indicators were originally developed for synthesizing characteristics of the river flow regime poff et al 1997 a commonly applied flow indicator is the magnitude of discharge which can refer to minimum low flows or maximum high flows magnitude these flow indicators can be derived from observed or simulated river flow data for reliable hazard estimates based on direct statistical analysis at least 20 years of observations are required whereas further increasing the record length greatly deceases the uncertainty attached to the hazard estimates hu et al 2020 due to the lack of long time series of discharge data of a desired temporal resolution direct statistical analysis of past events are often not possible or are very limited at many locations and instead a hydrological model may be employed to simulate time series of streamflow from which high low flows are extracted and treated with statistical analysis grimaldi et al 2012 emerton et al 2016 wu et al 2020 a clear advantage of this approach is that frequency estimates can be derived for locations with limited or no historical discharge data a drawback is that a hydrological model introduces additional uncertainty into the frequency analysis meresa and romanowicz 2017 sikorska senoner et al 2020 this modelling uncertainty may stem from input model structure parameter and output uncertainty renard et al 2011 sikorska and renard 2017 westerberg et al 2020 and should be accounted for in flow frequency analysis shah et al 2018 a common way to represent this modelling uncertainty is through using multiple model parameters cameron et al 1999 which can be justified by the parameter equifinality beven and freer 2001 sikorska and seibert 2018 parameter uncertainty of hydrological models has also been demonstrated to be the most important source of uncertainty for design floods brunner and sikorska senoner 2019 aside from the record length brunner et al 2018 only recently meresa and zhang 2021 have shown that both extreme low and high flows are strongly affected by modelling uncertainty wherein low flows are more affected by model parametric uncertainty and high flows by input model uncertainty nevertheless using multiple parameter sets for a hydrological model remains a common way to represent to some extent modelling uncertainty in hydrological simulations lawrence 2020 if more complex analysis of different uncertainty sources is not possible or not required such multiple parameter sets can be derived either from probabilistic parameter inferences or from multiple runs of independent model calibrations sikorska senoner et al 2020 both resulting in a parameter ensemble usually consisting of 100 to 1000 and more optimized parameter sets the number of parameter sets is often related to computational efforts of running the model and its spatial and temporal resolution however even 100 parameter sets may become computationally limiting for flow frequency analysis of long time series 100 years at a high temporal or spatial resolution therefore instead of using a full parameter ensemble resulting from the model inference sikorska senoner et al 2020 recently proposed a novel approach of downsizing the parameter ensemble to a small number of representative parameter sets rpss in their approach only the rpss pre selected from a training dataset are analyzed for flow hazards enabling modelling uncertainty to be represented in the frequency space this greatly reduces computational requirements of using a hydrological model within a complex modelling chain for climate impact studies or flow frequency analysis the rps approach may appear similar to surrogate models kennedy and o hagan 2000 razavi et al 2012 berends et al 2018 machac et al 2018 called also as simulators or emulators such surrogate models substitute complex models with simpler ones for approximating predictions at lower computational costs despite the motivation behind the development of surrogate models and the rps approach is the same i e making a better usage of available computational resources the way to achieve this aim is completely different while in the rps based approach a reduction of computational costs is achieved through pre selecting a small parameter subset but the same model is employed in the surrogate modelling a computational reduction is gained through employing a different simpler model which is faster in simulations therefore the developed rps concept has a great potential for lowering model computational costs in practical applications but requires some further research in the study of sikorska senoner et al 2020 the choice of rpss was developed based on extreme high flows annual maxima with three different selection methods ranking quantiling and clustering and resulted in a set of three rpss these sets represent the upper middle and lower intervals i e the 90 prediction intervals along the median value it was also found that the clustering method provides the best and most unbiased estimates and this method was recommended for further use in a follow up study sikorska senoner 2021 found that five to seven clusters are required to provide reliable flow estimates for different prediction intervals i e in the range of 68 to 99 in the frequency space since each cluster is described with three parameter sets five to seven clusters result in 15 to 21 rpss that need to be considered as an uncertainty measure for flow frequency analysis both of these previous studies on rpss however limited their focus to high flows whereas other flow conditions have so far not been explored this is a common limitation of many modelling studies that focus either on flood or drought conditions while crafting hydrological models for simulating only one of these hazards by selecting specific objective functions kollat et al 2012 pool et al 2017 brunner et al 2021 yet there is a globally observed increase in the co occurrence of hazards when their impacts overlap temporally and spatially e g drought followed by flood without leaving enough time for the system to recover de ruiter et al 2020 thus for optimal modeling of both droughts and floods it would be desirable that the model with single set up could represent different flow conditions in a similar manner this is particularly important for the balanced management of water resources di baldassarre et al 2017 kreibich et al 2019 as independent analysis of floods and droughts may greatly limit the ability to cope with the other type of hazard brunner et al 2021 in the present study the rps concept to lower computational requirements of a hydrological model is therefore extended to different flow conditions represented with three flow indicators annual maximal flow hq e g do et al 2017 annual 7 day average low flow lq e g dudley et al 2020 and annual mean flow mq e g kumar et al 2009 to represent the ensemble variability the selection of rpss is performed based on seven clusters that result in 21 rpss selected out of 1000 as suggested by sikorska senoner 2021 diagnosis of model behaviors at the frequency space is supported with the analysis of hydrologic signatures of simulated discharge time series westerberg and mcmillan 2015 mcmillan et al 2017 mcmillan 2021 which should additionally verify the rps concept applicability to time series this study thus aims at deepening the rps concept for lowering model computational costs by answering the following open research questions 1 are rpss robust and transferable to different flow conditions i e are the same or different rpss chosen for different flow conditions and can rpss developed with high flows be applicable to low flows or vice versa 2 how much more beneficial is a selection of rpss over a random selection of the same number of parameter sets 3 how well are the flow dynamics represented with rps based simulations at the time series domain assessed using hydrologic signatures the study is developed for the same small swiss catchment dönnern at olten and using the parameter ensemble identical with the one used in sikorska senoner 2021 this parameter ensemble consists of 1000 parameter sets derived via a multi objective and multi period calibration of the daily hbv model the research questions are developed using 1000 different realizations of discharge pseudo observations of 100 years each resulting from simulation of 100 meteorological scenarios of 100 years each that are briefly described in section 3 2 and that were used in both previous studies see sikorska senoner et al 2020 for further details the use of such long time series is advocated for assessing the method in the flow frequency space 2 methods 2 1 the concept of the representative parameter sets rpss the concept of the representative parameter ensemble or representative parameter sets rpss was introduced by sikorska senoner et al 2020 and further adopted by sikorska senoner 2021 the rpss represent a small parameter subset selected from the full parameter ensemble available that fulfills the following conditions fig 1 1 it represents the entire range of the full ensemble variability of the hydrological responses in the flow frequency space 2 little computational effort is required to run the hydrological model as compared to the full parameter ensemble 3 it is transferable to independent time periods providing representative ranges of ensemble simulations in the flow frequency space a selection of the rps subset is performed using a training dataset containing a large sample of hydrological model simulations and model parameter sets but at a much reduced time series length compared to a potential application or extrapolation phase for example a selection can be made based on observed historical data but the rps subset is then applied for climate impact analysis for the entire 21st century 2 2 modelling framework and clustering based selection of the rpss a selection of the rpss is based on simulation of respective flows in the flow frequency space and is performed independently for different flow indicators i e for annual 7 day average low flow lq annual maximal flows hq and annual mean flow mq simulations of a hydrological model here hbv using input forcing data and optimized parameter sets here 1000 sets serve as a basis for an rps selection in this study the same model set up as in sikorska senoner 2021 is used which consists of 1000 parameter sets and 100 hydro meteorological scenarios resulting from 100 different meteorological input scenarios see section 3 2 for details the method for deriving the parameter ensemble of 1000 sets is not the focus of this study and the interested reader is referred to the source paper based on this modelling framework set up a selection of three flow indicators is performed for each scenario independently next a clustering approach is applied to each flow indicator and scenario independently for simplicity a brief description of the selection method applied to hq is detailed below hqs simulated for one scenario using the full parameter ensemble are sorted by their magnitude over all simulation years for different parameter sets independently as required to represent them in the flow frequency space next these simulation curves are clustered into seven clusters using the k means clustering with the function kmeans from the package stats r core team 2019 and the hartigan wong algorithm hartigan and wong 1979 next these selected clusters are sorted by their magnitude in the upper tail of the distribution using the 90th percentile for each defined cluster the 5th 50th and 95th percentiles over all simulation years are computed and corresponding parameter sets are selected by minimizing the euclidean distance ed as a measure of similarity hence each cluster is described with three rpss that sum up to 21 rpss h q for all seven clusters for a more detailed description see sikorska senoner 2021 in a similar way the rpss for lqs and mqs are selected as rpss l q and rpss m q 2 3 construction of uncertainty intervals for flow frequency simulations based on the rps subset of 21 parameter sets the respective hyper percentiles over the entire ensemble are computed here the 5th 50th 95th percentiles are derived that enable calculation of the 90 prediction intervals 90 pis along the median value similar to sikorska senoner et al 2020 next these rpss from the rps subset are selected in which corresponding simulations lie closest to the computed hyper percentiles in the frequency space based on the ed value and are retained as θ hq 5 th θ hq 50 th and θ hq 95 th for the hq example the simulations corresponding to the θ hq 5 th and θ hq 95 th together define the 90 pis for the hq indicator for plotting positions of flow indicators in the frequency space here the generalized extreme value distribution type i gumbel space the gringorten s method gringorten 1963 is used 1 k j j 0 44 j 0 12 where k j is a plotting position for the j th sorted flow lq mq or hq in the gumbel space and j is the number of simulation years the relation between the k j and the probability p j of the event occurrence is simply expressed as 2 p j 1 k j knowing p j the return period of the event t j can be computed as 3 t j 1 1 p j note that plotting positions are used only for visualizing the analysis in the flow frequency space but they do not play any role in the selection of the rpss 2 4 assessment tests five different assessment tests detailed below and in table 1 are performed to judge the behavior of the rps based pis in reference to the full ensemble simulation using 100 hydro meteorological scenarios for a detailed description of the meteorological scenarios the reader is referred to sikorska senoner et al 2020 while details on the hydrological simulations can be found in sikorska senoner 2021 cross validation to evaluate the behavior of the rps based simulations in the frequency space a leave one out cross validation test see sikorska senoner et al 2020 for details is performed in which one meteorological scenario sr is removed from the analysis and the selection of rpss is executed based on all other remaining meteorological scenarios i e using m 1 2 m and m r the evaluation of rps based simulations is then executed against the sr meteorological scenario initially removed from the set this test assesses the performance of the rps selection at independent time series for the three flow indicators tested here multi scenario test in a multi scenario test sikorska senoner et al 2020 the selection of rpss is executed on one sx meteorological scenario randomly without replacement selected from the m available scenarios and evaluated against all remaining scenarios m 1 2 m and m x this test assesses the transferability of rpss to other time periods but at the same flow conditions for the three flow indicators tested here switch test to evaluate the behavior of rps based simulations for different flow conditions than were originally used for the rps selection a simple switch test is applied in this test rpss selected for one flow indicator e g hq are transferred and assessed for other flow indicators i e mq and lq the flow conditions on which the rps selection is performed are referred to as a donor whereas the evaluation flow conditions are referred to as a target in this way the strength and the transferability of the rpss to different flow indicators can be evaluated the switch test is performed for all meteorological scenarios following the cross validation and multi scenario tests to evaluate the behavior of the derived rpss for each scenario the switch test based on the cross validation evaluation is referred to as switch test 2 and that on the multi test as switch test 1 see table 1 for an overview benchmark random selection as a benchmark 21 parameter sets are randomly selected from all 1000 sets available irrespective of flow conditions and meteorological scenario these sets compose a benchmark rps subset and are used to derive the 90 pis and the median percentile in a similar way to the rps based pis note that by randomly selecting parameter sets independently of flow conditions and meteorological scenarios these sets are selected as valid for all three flow indicators lq mq and hq and all meteorological scenarios see table 1 a selection of random sets is performed only once sensitivity test the benchmark test introduced above relies on a single selection of 21 parameter sets to test its sensitivity to the randomness of selected parameter sets this selection is repeated 100 times with replacement meaning that not all parameter sets out of 1000 available have to be used whereas some can be selected multiple times at each time the selection of parameter sets is done independently from the meteorological scenario and flow indicators as sets are chosen in a purely random way by combining individual repeats one can assess how much the selected benchmark depends on a random selection and whether increasing the number of repeats improves or decreases the performance of random based simulations thus the subset of parameter sets increases from 21 one repeat to 100 repeats of 21 sets note that the same parameter set may occur multiple times within such a random subset and given that only 1000 sets are available the total number of randomly selected sets approaches 1000 and thus is not simply equal to 21x100 2 5 qualitative criteria to support analysis of rps based simulations the evaluation of the rps based simulations resulting from all five tests described in section 2 4 is performed for the 90 pis based on the following quantitative metrics both introduced by sikorska senoner et al 2020 overlapping pools the overlapping pools index a o p p i describes how well the pis constructed using the rpss overlap with the pis derived using the full ensemble simulation hence it measures the reliability of the rps based pis since by definition rps based pis should represent 90 pis the reference pools for the full parameter ensemble are computed as 90 pis outlier ratio the outliers are defined as simulation points in the cross validation based tests and as simulation curves in the multi scenario based tests lying outside the rps based pis the ratio is defined per simulation curve cross validation or scenario multi scenario test and is computed in the following way if 50 of the simulation points per one simulation curve are lying outside the pis then this simulation curve is assumed to be outside the pis next the percentage of hydrological simulation curves lying outside the rps based pis is calculated as r hso in the same way a scenario is assumed to be outside the pis if 50 of the simulation curves lie outside the pis and the percentage of meteorological scenarios lying outside the rps based pis is computed as r mso in addition an average number of simulation points lying outside per simulation curve cross validation and simulation curves lying outside per scenario multi scenario are calculated as r spo and r sso 2 6 post processing diagnosis with hydrologic signatures hydrologic signatures hss are indexed values calculated from observed or simulated time series of hydro meteorological data mcmillan et al 2017 mcmillan 2021 gnann et al 2021 they are specifically suited to extract the most important information about the catchment hydrological behaviour if based on observed time series or to diagnose model deficits if based on simulated time series thus hss are frequently applied either as a post processing evaluation tool euser et al 2013 coxon et al 2014 westerberg et al 2020 or they can be directly included into model calibration westerberg et al 2011 shafii and tolson 2015 fenicia et al 2018 kavetski et al 2018 if not used for model calibration a set of hss offers a very powerful independent test to assess model performance as different signatures focus on different aspects of flow dynamics such a test assesses model performance for a wide range of flows from low to high flow indicators in this study hss are used as a post processing tool to diagnose the behavior of rps based model simulations in the time series domain the underlying assumption of the rps concept is an accurate representation of the full simulation ensemble range in the flow frequency space yet such rpss should ideally also enable one to return to the time series and provide reliable model simulations at the time domain to test this hypothesis hss are computed in two ways first based on the rps based simulations and second based on the full simulation ensemble to evaluate how well hss computed from rps based simulations represent flow dynamics scaled scores liu et al 2009 westerberg et al 2011 are assigned to each hs and each rps based time series simulation these scaled scores are computed relative to the reference values westerberg and birkel 2015 westerberg et al 2020 which here are the hss calculated from the full simulation ensemble hence for each hs computed based on the full simulation ensemble the maximum h s m a x median h s m e d and minimum h s m i n values are defined as reference values to which scores of 1 0 and 1 are assigned next the hs is computed for each rps based simulation and the scaled score is calculated by a linear interpolation between reference ranges if a hs value based on a rps simulation falls outside the reference range h s m i n h s m a x a linear extrapolation is performed outside these values see fig 2 for illustration note that by definition the aim of selecting rpss lies not on the best representation of the best median simulation value but on covering the range of possible model realizations represented here by the h s m i n h s m a x range hence the decision on rps based hss is made according to how well they can reproduce the range of the reference hss for this study a set of 17 hss is selected as summarized in table 2 these hss comprise those recommended by addor et al 2018 i e the first 13 and are extended with additional four hss suggested by westerberg and mcmillan 2015 3 details on experimental setup 3 1 study catchment hydrologic model and parameter ensemble the rps concept is tested on a small swiss catchment of dönnern stream at olten 196 km 2 located in the jura mountains the catchment has an elevation range from 400 to 760 m a s l see fig 3 in sikorska senoner et al 2020 for this catchment a parameter ensemble with 1000 sets is available from the previous study sikorska senoner 2021 this ensemble provides parameter sets for a conceptual hydrological hbv light model seibert and vis 2012 and it was derived in the previous study by calibrating the hydrological model at a daily time step with observed data precipitation temperature and discharge using a multi objective and multi period approach for further details on the model and calibration approach the reader is referred to the source papers this parameter ensemble is used here for testing the rps concept with all three flow indicators which is needed to assess the transferability of rpss to different flow conditions 3 2 hydro meteorological scenarios for dönnern 100 meteorological scenarios of 100 years of continuous precipitation and temperature time series at an hourly time step were available see sikorska senoner et al 2020 for details that were generated using a weather generator gwex disag evin et al 2018 this weather generator is a stochastic multi site precipitation and temperature model that reproduces the statistical behaviour of weather events on different temporal and spatial scales it was set up for a large part of switzerland using observations from the period of 1930 2015 from 105 precipitation and 26 temperature stations these 100 meteorological scenarios are a subset from the scenarios generated over the larger area and for the period of 1000 years each the selected 100 scenarios cover the same time frame and thus represent the natural climate variability they were aggregated to a daily time step and next were fed into the calibrated hbv model to produce pseudo observed discharge time series using 1000 optimized parameter sets this resulted in 1000 discharge simulations of 100 years per scenario computed in the previous work sikorska senoner 2021 which are available for the current analysis 3 3 computation of flow indicators three flow indicators are used to represent different flow conditions these are annual 7 day average low flow lq annual mean flow mq and annual maximal flow hq lq is computed using a 7 day running mean that is commonly applied to analyze changes in low flow dynamics riggs 1980 reilly and kroll 2003 dudley et al 2020 fleming et al 2021 hq is taken as the maximum annual daily flow within each year that is a common choice for flood analysis eng et al 2013 do et al 2017 sikorska senoner and seibert 2020 lq and hq are supported with the analysis of annual mean flows calculated as a mean flow within the year kumar et al 2009 such a selection based on a calendar year can be justified because runoff processes in the dönnern catchment are dominated by precipitation dynamics only sikorska senoner and seibert 2020 thus snow storage and melt do not play any important role in the catchment 4 results 4 1 selected rpss a cluster based selection of rpss for different flow indicators led to choosing 21 parameter sets from 1000 possible sets for each considered scenario and flow indicator to evaluate which parameter sets are chosen for different flow conditions box plots with selected rpss are presented in fig 3 together with standard evaluation metrics used in hydrology kling gupta efficiency kge gupta et al 2009 peak efficiency seibert 2003 and mare measure dawson et al 2007 these metrics were also used during the calibration of the hydrological hbv model in the previous study sikorska senoner 2021 these metrics are computed over the entire observation time window 1989 2014 and are confronted with the metrics calculated for the full parameter ensemble with 1000 sets gray box plots it appears that rpss selected for all three flow indicators cover the entire range of the full parameter ensemble it can also be seen that generally slightly different parameter sets were chosen as rpss for different flow indicators with respect to different efficiency metrics considered here it is evident that rpss selected for lq and hq lie in the same range for kge and mare whereas for mq a much wider spread in the efficiency is observed regarding the peak efficiency rpss selected for lq and mq cover similar ranges whereas those selected for hq are more concentrated along the median value but have a wider range it can be concluded that despite slightly different parameter sets being chosen as rps for different flow indicators they lead to a similar model performance for all three considered criteria 4 2 rps based simulation ensemble an example of the resulting simulation ensemble in the flow frequency space based on the rps subset is shown in fig 4 for one demonstration scenario for all three flow indicators the selection of the rpss visualized here was based on the same scenario it can be seen that the rps based predictive intervals almost overlap with the intervals calculated from the full ensemble for all flow conditions 4 3 assessment of the rps based uncertainty intervals the behavior of the rps based 90 prediction intervals pis were assessed for independent time periods using two tests cross validation and multi scenario test for all 100 scenarios see table 1 for details an example of a visual assessment is presented in fig 5 for one demonstration scenario and results for all scenarios are summarized in table 3 in the multi scenario test bottom panel fig 5 the rps based pis overlap with the intervals based on the full parameter ensemble whereas in the cross validation the rps based pis are slightly larger than the intervals constructed using the full parameter ensemble this is not surprising since the cross validation rps based pis are constructed using the rpss selected based on 99 other scenarios and are then applied to one application scenario in contrast pis based on the full ensemble are constructed using only one application scenario in the multi scenario test the rps based pis are based on one scenario but applied to 99 scenarios and thus the reference ensemble is constructed also using these 99 scenarios overall both assessment tests point out the robustness of the cluster based selection method of rpss applied to all three flow indicators this is also justified with the assessment criteria presented in table 3 as can be seen by the overlapping pools index a o p p i the rps based pis closely overlap with pis based on the full ensemble and are on average slightly larger this is also confirmed by the fact that only a small part of hydrological simulation curves lie outside the rps based pis 0 7 for all three flow indicators and all meteorological scenarios are included within the rps based pis on average only a small proportion of simulation points 1 7 simulation points per one simulation in the cross validation and simulation curves 0 05 simulation curves per one scenario in the multi scenario test lie outside the rps based pis 4 4 transferability of the rpss to other flow conditions two switch tests were performed to assess how well rpss selected based on one flow indicator donor can be transferred and applied to other flow indicators target see also table 1 while switch test 1 is somehow conceptually similar to the multi scenario test switch test 2 is similar to the cross validation test the major difference lies in the selection of rpss and their application to predict different flow indicators an example of these tests is presented in fig 6 for one demonstration scenario it appears from fig 6 that using rps sets estimated based on hq as a donor applied to lq as a target variable was more beneficial than vice versa i e using lq as a donor for simulating hq as a target regarding the application to mq as a target lq used as a donor provided better estimates than hq used as a donor nevertheless it appears that rpss based on all three flow indicators can be transferred to other flow conditions with only a slight drop in the rps based pis performance this visual impression is mirrored by the quantitative metrics table 4 that are all slightly worse for pis with transferred sets than if the rps selection is performed directly at the target flow indicator compare with table 3 comparing the rps based pis although they are only slightly wider a o p p i than if constructed using a target variable more simulation points lie outside such pis with transferred rpss in switch test 1 an average number of simulation curves lying outside the pis is between 0 3 to 5 0 r h s o in switch test 2 the same number of scenarios is considered to lie outside the pis as in targeted rps selection and is equal to 0 on average r m s o the number of points lying outside the rps based pis is on average in the range of 2 53 to 11 97 per one hydrological simulation r s p o and the number of simulation curves lying outside the rps based pis is between 0 10 and 5 69 per one scenario r s s o which is slightly higher than for the rps based pis targeted to the flow indicator hence the following can be concluded if hq is a target variable the selection of rpss should be optimally done on this variable if mq or lq are target variables the selection of rpss can be done using any flow indicator i e mq lq or hq 4 5 random parameter set selection and sensitivity analysis as a benchmark a random selection of 21 parameter sets was performed i e without any clustering to derive the 90 pis results of such a random selection are presented in fig 7 for one demonstration scenario the results are presented per one scenario and per 99 scenarios to be conceptually similar to the cross validation and multi scenario tests as interpreted from fig 7 a random selection led to a poorer performance of pis because the constructed intervals are much narrower than the pis based on the rps selection compare green to blue polygons this effect is visible for both one scenario and multi scenario 99 analysis and all three flow indicators but is the most pronounced for mq and hq this visual assessment is confirmed by the calculated metrics presented in table 5 in addition the sensitivity to the number of random repeats was investigated by averaging results per increasing number of repeats 1 100 for simplicity the results are illustrated only for 1 10 and 100 repeats the results reported for 1 repeat correspond to the benchmark test while the results reported for 10 and 100 repeats reveal sensitivity analysis results as already seen from the fig 7 and confirmed by the quantitative criteria the performance of the pis constructed based on a random parameter selection greatly dropped if compared to the rps based intervals generally for a random parameter selection all assessment metrics dropped with pis being too narrow a o p p i and an average of 11 00 to 20 60 of hydrological simulation curves lying outside the pis per scenario r h s o the number of simulation points lying outside the pis was in the range of 12 12 to 24 54 per simulation curve r s p o and the number of simulation curves was in the range of 68 04 to 145 96 per scenario r s s o increasing the number of repeats only slightly improves the performance of the pis based on random selection with the evaluation metrics remaining poor it appears from these findings that the random selection of 21 parameter sets yields worse results than the switch tests this suggests that rps based selection of parameter sets is more beneficial even if performed on other flow indicators than the targeted variable and this is discussed further in section 5 4 6 diagnostics of the rpss based simulations using hydrologic signatures hydrologic signatures hss provided an independent test on the rps based hydrological model simulations the ability to reproduce hss was assessed with scaled scores that were computed in a reference to the full simulation ensemble and results of this analysis are presented in fig 8 the results are shown for simulations using the rpss targeted to three different flow indicators in two assessment tests cross validation and multi scenario test the gray boxes represent the reference scores i e based on the full parameter ensemble it can be seen that hss computed from rps based simulations box plots in most cases cover the reference boxes well in the cross validation test whereas in the multi scenario test hss from rps based simulations sometimes lie outside the reference boxes first this observation is in agreement with the performance of the rps based pis in the flow frequency space see section 4 3 second this diagnosis of hss demonstrates that rps based simulations are able to faithfully reproduce hss computed with the full parameter ensemble hence rps based simulations provide a good representation of the modelling uncertainty and uncertainty ranges not only in the flow frequency space but also in the signature domain a further detailed analysis of box plot behavior indicates that the box plots manifest different patterns for different hss particularly with regards to the spread between the 25th percentile to the 75th percentile while for some hss e g bfi hfd mean high q freq high q dur this spread is small for other hss e g q5q low q freq low q dur qlv this spread is large indicating a large variability in these signature values depending on the individual rps simulation nevertheless all rps based hss are centered on the reference value of 0 and symmetrically spread around their median value indicating the overall good coverage with the full ensemble simulations without any strong underestimation or overestimation of hss note that evaluation of hss in the switch tests was not possible because switch tests are tailored to the flow frequency space by switching the donor with the target variable while they do no affect the computation of hss that are evaluated at time series without any reference to flow indicators in contrast hss could be computed for the model simulations using a random parameter selection and the results of scaled score computation is shown in fig 9 it can be seen that hss calculated using a random selection of model parameters led to asymmetrically spread box plots whereas rps based simulations led to more symmetrically spread box plots over the entire range compare figs 9 and 8 moreover a random selection of model parameters resulted mostly in underestimated hs values as seen by the fact that all box plots are stretched to negative values of the scaled scores these patterns do not seem to be affected by the number of repeats thus these findings show that hss computed using a random parameter selection led to narrower or underestimated uncertainty ranges of hss than when rps based simulations were used for calculation of hss which is further discussed in section 5 5 discussion a clustering based selection of representative parameter sets rpss has been shown to perform well for flow risk analysis using all three flow indicators annual 7 day average low flow lq annual mean flow mq and annual high flow hq all providing reliable 90 prediction intervals pis in the flow frequency space it has also been found via the switch tests that the rpss selected based on one flow indicator donor can be transferred to other flow indicators target with only a little drop in the pis performance in the flow frequency space based on these findings the following is recommended if hq is a target variable the selection of rpss should optimally be carried out on this variable if mq or lq are target variables the selection of rpss can be made using any flow indicators i e mq lq or hq moreover simulations based on transferred rpss outperformed those based on a random selection of model parameter sets hence it can be concluded that the rps selection of model parameters is beneficial and provides a more balanced way of selecting parameter sets from the entire parameter ensemble available for simulating pis in the flow frequency space these findings were also confirmed by the independent diagnosis based on hydrologic signatures which additionally pointed out the weakness of the random parameter selection the signature based analysis reported that rpss selected in the flow frequency space are able to reproduce uncertainty ranges at the signature domain which was not the case for a random parameter selection this is a great benefit of the clustering based selection as it shows that the rpss concept has the potential to be applied also at the time domain even if rpss are selected in the flow frequency domain some aspects require however a further in depth discussion 5 1 methodological aspects first of all it has to be stressed that both the applicability of the rps concept and the transferability of rpss may strongly depend on the overall model performance achieved after the calibration in particular the representation of modelling uncertainty with rpss depends on whether the inferred model parameters are representative for different model components and runoff processes in a similar way such as low and high flow dynamics the parameter ensemble used in this study resulted from a multi objective and multi period calibration sikorska senoner 2021 and thus all three flow indicators are realistically simulated as also demonstrated in section 4 3 such multi objective calibrations are recommended if multiple objectives are to be met to a similar extent efstratiadis and koutsoyiannis 2010 guse et al 2020 a trade off between different objectives is reflected in model parameters that are able to realistically represent different flow conditions but at the cost of lowering performance for all components considered referred to as the pareto frontier beven and freer 2001 it is expected that using a single objective function would lead to a much lower transferability of rpss between different flow indicators an interesting issue to investigate in a future study would be thus to test how the selection of calibration criteria impacts the transferability of rpss between different flow conditions the independent test with hydrologic signatures hss pointed out the strength of the rps concept over a random parameter selection the uncertainty ranges of hss based on the latter were underestimated and asymmetric in comparison to the reference values in contrast all rps based hss were symmetrically spread over their median values and centered on the best reference value moreover despite the rps based hss cover very well the reference hss for some hss a larger spread in the range between different percentiles was observed this indicates that some hss can be well defined with already a smaller number of parameter sets whereas other hss require more sets this is partly in agreement with the study of westerberg and mcmillan 2015 who focused on quantifying uncertainty in hss and found that uncertainty ranges vary for different hss thus the rps concept can be recommended as an alternative way to derive uncertainty in hss resulting from modelling uncertainty it has to be noted however that uncertainty in hss may also originate from other sources such us precipitation data or discharge data westerberg and mcmillan 2015 which were not explicitly included in this study the rps approach could be however easily extended to account also for these uncertainty sources the rps concept has been tested with synthetic data i e using pseudo observed streamflow series generated from meteorological scenarios with the help of a hydrological model for this study 100 years of simulations per scenario were available creating a rich dataset for testing the concept the use of such long time series is advocated for assessing the method in the flow frequency space with rare events yet such a long time series are obviously usually not available for gauged stations where observations are often limited to only 20 to 30 years note however that the methodology is independent of the record length and thus remains valid also for shorter time series the rps concept selects parameter sets upon the available data set thus using 20 30 years of observations for selecting parameter sets will result in rpss that well represent modelling uncertainty at this time window and flow frequencies of this time period extrapolating these estimates into more extreme events may obviously be linked with increased uncertainty and reduced accuracy of rps based simulations this is however a general problem in hydrology of extrapolating observed values into extreme values finally the developed method of the rps selection has been tested here with hydrological simulations from the conceptual hbv model and flow indicators it has to be stressed however that the selection of rpss does not depend in any way on the hydrological model employed as the selection is performed in the flow frequency space using simulated flow indicators only i e regardless of the way in which they are derived thus this selection method can be employed to choose rpss out of an ensemble available for any hydrologic model in this study a parameter ensemble of 1000 members was available the way in which this ensemble is delivered is out of the scope of this study but it may impact results of the rps selection and the ability to transfer the rpss between different flow conditions as discussed above thus the way the parameter ensemble is delivered remains important for any hydrological model pool et al 2017 and for any flow frequency analysis brunner and sikorska senoner 2019 moreover the selection of the rpss could be applied in the same manner to any environmental model assuming that the predicted variable can be represented in the frequency space a further research direction should test the application of the rps selection to other environmental models e g groundwater snow models or sediment models with different variable indicators in addition to the above the rps selection method tested here for a conceptually based model could be potentially coupled with a data driven approach to further increase model predictive skills sikorska senoner and quilty 2021 and thus the accurateness of flow predictions 5 2 outlook in this study three different flow indicators were investigated for a rainfall dominated catchment however due to the diversity of flood processes sikorska et al 2015b stein et al 2020 and drought types van loon and van lanen 2012 an application of the rps concept to different types of floods and droughts could be beneficial in catchments with different types present e g snowmelt and rainfall floods or snowmelt and rainfall deficit drought types such analysis could support a selection of rpss per flood drought type which could greatly improve predictions of specific hazards this would however be linked with some additional computational cost as several rpss per flood drought type would have to be processed and thus dedicated guidelines on their usage might be required the study of the rps concept together with different types of flood and drought could be of particular value for climate impact studies lawrence 2020 sikorska senoner and seibert 2020 next the rps concept originally developed by sikorska senoner et al 2020 and applied here considers only the modelling uncertainty of a hydrological model due to parameter uncertainty and partly model uncertainty however other uncertainty sources in model simulations such as input or output data renard et al 2011 sikorska et al 2015a westerberg et al 2020 are not considered here this is not a critical point since the interest here lies only on the resulting modelling uncertainty yet if more detailed information is required a dedicated methodology with propagation of different uncertainty sources on flow indicators would be needed meresa and zhang 2021 and could be adapted for the rps concept to define rps sets per uncertainty source propagated the clustering based rps selection is beneficial in lowering computational efforts of using a hydrological model in different hazard assessment and climate impact studies because the selection of rps must be performed only once as long as catchment properties do not change while rps can be applied several times to very different settings see sikorska senoner et al 2020 for further discussion on this point moreover the rps concept is advantageous over the surrogate modelling because it employs the same hydrological model but at reduced computational costs thanks to a pre selected subset of model parameters in contrast surrogate models require setting up of a simpler model which also needs to be parametrized thus the exact effect and uncertainty introduced due to using such a simpler model in regards to the original model are difficult to assess for that purpose the same analysis as with the surrogate model would need to be repeated with the original model razavi et al 2012 therefore the rps concept appears very powerful because no simplification in the model structure must be performed such an rps concept can be applied in probabilistic flood risk assessments hazard scenario analysis climate scenario analysis or multiple site analysis or uncertainty propagation it can also support real time forecasting of flow related hazards sikorska senoner 2021 this is extremely important for all engineering problems related to water resources such as flood design operation of retention lakes and hydropower water supply or maintaining the minimal ecological flow in rivers and flow forecasting i e everywhere where risk and failure may have high economic and societal impact and thus accurate estimates with uncertainty consideration are needed particularly for flow forecasting the input data has the highest uncertainty wu et al 2020 thus a reduction of computational efforts by using a small sample of rpss for a hydrological model could be of a great value 6 conclusions the concept of the representative parameter sets rpss for lowering computational costs that are selected in the flow frequency space based on clustering has been adopted to study modelling uncertainty of three different flow indicators annual 7 day average low flow lq annual mean flow mq and annual high flow hq based on several tests it was found that the rps concept can be successfully applied to provide uncertainty estimates on any of these three flow indicators the clustering based selection of rpss also overperformed a random selection of parameter sets moreover rpss selected based on one flow indicator can be transferred to other flow indicators with only a little loss in the model performance in addition the independent test with hydrologic signatures revealed that rps based hydrological simulations provide good coverage with the signatures calculated using the full simulation ensemble hence it can be concluded that the rps concept can be applied to any hydrological model to select representative parameter sets and to provide reliable uncertainty estimates for both the flow frequency and signature domain it also reduces the computational cost connected with the use of a hydrological model compared to the simulation based on the full parameter ensemble and thus it is of particular importance for all flow uncertainty analysis and hazard estimation under uncertainty moreover the rps concept lowers computational costs through reducing the parameter sets but uses the same original model thus it is beneficial over the surrogate modelling the concept is however not limited to hydrological modelling and can be potentially applied to any environmental model to represent its modelling uncertainty at a low computational cost credit authorship contribution statement anna e sikorska senoner funding acquisition conceptualization methodology software visualization writing original draft writing review editing declaration of competing interest the author declares that she has no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was funded through the forschungskredit of the university of zurich grant no fk 18 118 fk 20 124 the sciencecloud provided by s3it at the university of zurich enabled the computation intensive simulations to be run on virtual machines the author wishes to thank two anonymous reviewers for very useful comments to the previous version of this manuscript and tracy ewen for proofreading the manuscript 
239,for mitigating negative effects of floods and droughts estimates of flow indicators and their uncertainties are essential the recently introduced concept of the representative parameter sets rpss enables modelling uncertainty to be represented in the flow frequency space at low computational cost using a small subset of pre selected model parameter sets this concept is here adapted to assess hazards of three flow indicators annual maximal flow annual 7 day average low flow and annual mean flow an additional in depth analysis assesses the rps transferability to other flow indicators and to hydrological signatures rps based simulations are benchmarked with a random selection of parameter sets the results show that i rpss can be successfully transferred between flow indicators with only a small drop in model performance and ii rpss can be used to represent modelling uncertainty in hydrological signatures the rps concept has thus great potential for delineating modelling uncertainty of any environmental model keywords simulation ensemble river flow indicator frequency domain representative parameter set uncertainty cluster analysis 1 introduction both drought and flood hazards were responsible for almost 50 of all natural disasters that occurred globally over the years 1998 2017 with floods affecting the largest number of people 2 billion followed by droughts 1 5 billion unisdr and cred 2018 therefore to mitigate such negative effects of floods and droughts accurate estimates of flow indicators e g extreme low and high flows and their hazards are essential flow indicators were originally developed for synthesizing characteristics of the river flow regime poff et al 1997 a commonly applied flow indicator is the magnitude of discharge which can refer to minimum low flows or maximum high flows magnitude these flow indicators can be derived from observed or simulated river flow data for reliable hazard estimates based on direct statistical analysis at least 20 years of observations are required whereas further increasing the record length greatly deceases the uncertainty attached to the hazard estimates hu et al 2020 due to the lack of long time series of discharge data of a desired temporal resolution direct statistical analysis of past events are often not possible or are very limited at many locations and instead a hydrological model may be employed to simulate time series of streamflow from which high low flows are extracted and treated with statistical analysis grimaldi et al 2012 emerton et al 2016 wu et al 2020 a clear advantage of this approach is that frequency estimates can be derived for locations with limited or no historical discharge data a drawback is that a hydrological model introduces additional uncertainty into the frequency analysis meresa and romanowicz 2017 sikorska senoner et al 2020 this modelling uncertainty may stem from input model structure parameter and output uncertainty renard et al 2011 sikorska and renard 2017 westerberg et al 2020 and should be accounted for in flow frequency analysis shah et al 2018 a common way to represent this modelling uncertainty is through using multiple model parameters cameron et al 1999 which can be justified by the parameter equifinality beven and freer 2001 sikorska and seibert 2018 parameter uncertainty of hydrological models has also been demonstrated to be the most important source of uncertainty for design floods brunner and sikorska senoner 2019 aside from the record length brunner et al 2018 only recently meresa and zhang 2021 have shown that both extreme low and high flows are strongly affected by modelling uncertainty wherein low flows are more affected by model parametric uncertainty and high flows by input model uncertainty nevertheless using multiple parameter sets for a hydrological model remains a common way to represent to some extent modelling uncertainty in hydrological simulations lawrence 2020 if more complex analysis of different uncertainty sources is not possible or not required such multiple parameter sets can be derived either from probabilistic parameter inferences or from multiple runs of independent model calibrations sikorska senoner et al 2020 both resulting in a parameter ensemble usually consisting of 100 to 1000 and more optimized parameter sets the number of parameter sets is often related to computational efforts of running the model and its spatial and temporal resolution however even 100 parameter sets may become computationally limiting for flow frequency analysis of long time series 100 years at a high temporal or spatial resolution therefore instead of using a full parameter ensemble resulting from the model inference sikorska senoner et al 2020 recently proposed a novel approach of downsizing the parameter ensemble to a small number of representative parameter sets rpss in their approach only the rpss pre selected from a training dataset are analyzed for flow hazards enabling modelling uncertainty to be represented in the frequency space this greatly reduces computational requirements of using a hydrological model within a complex modelling chain for climate impact studies or flow frequency analysis the rps approach may appear similar to surrogate models kennedy and o hagan 2000 razavi et al 2012 berends et al 2018 machac et al 2018 called also as simulators or emulators such surrogate models substitute complex models with simpler ones for approximating predictions at lower computational costs despite the motivation behind the development of surrogate models and the rps approach is the same i e making a better usage of available computational resources the way to achieve this aim is completely different while in the rps based approach a reduction of computational costs is achieved through pre selecting a small parameter subset but the same model is employed in the surrogate modelling a computational reduction is gained through employing a different simpler model which is faster in simulations therefore the developed rps concept has a great potential for lowering model computational costs in practical applications but requires some further research in the study of sikorska senoner et al 2020 the choice of rpss was developed based on extreme high flows annual maxima with three different selection methods ranking quantiling and clustering and resulted in a set of three rpss these sets represent the upper middle and lower intervals i e the 90 prediction intervals along the median value it was also found that the clustering method provides the best and most unbiased estimates and this method was recommended for further use in a follow up study sikorska senoner 2021 found that five to seven clusters are required to provide reliable flow estimates for different prediction intervals i e in the range of 68 to 99 in the frequency space since each cluster is described with three parameter sets five to seven clusters result in 15 to 21 rpss that need to be considered as an uncertainty measure for flow frequency analysis both of these previous studies on rpss however limited their focus to high flows whereas other flow conditions have so far not been explored this is a common limitation of many modelling studies that focus either on flood or drought conditions while crafting hydrological models for simulating only one of these hazards by selecting specific objective functions kollat et al 2012 pool et al 2017 brunner et al 2021 yet there is a globally observed increase in the co occurrence of hazards when their impacts overlap temporally and spatially e g drought followed by flood without leaving enough time for the system to recover de ruiter et al 2020 thus for optimal modeling of both droughts and floods it would be desirable that the model with single set up could represent different flow conditions in a similar manner this is particularly important for the balanced management of water resources di baldassarre et al 2017 kreibich et al 2019 as independent analysis of floods and droughts may greatly limit the ability to cope with the other type of hazard brunner et al 2021 in the present study the rps concept to lower computational requirements of a hydrological model is therefore extended to different flow conditions represented with three flow indicators annual maximal flow hq e g do et al 2017 annual 7 day average low flow lq e g dudley et al 2020 and annual mean flow mq e g kumar et al 2009 to represent the ensemble variability the selection of rpss is performed based on seven clusters that result in 21 rpss selected out of 1000 as suggested by sikorska senoner 2021 diagnosis of model behaviors at the frequency space is supported with the analysis of hydrologic signatures of simulated discharge time series westerberg and mcmillan 2015 mcmillan et al 2017 mcmillan 2021 which should additionally verify the rps concept applicability to time series this study thus aims at deepening the rps concept for lowering model computational costs by answering the following open research questions 1 are rpss robust and transferable to different flow conditions i e are the same or different rpss chosen for different flow conditions and can rpss developed with high flows be applicable to low flows or vice versa 2 how much more beneficial is a selection of rpss over a random selection of the same number of parameter sets 3 how well are the flow dynamics represented with rps based simulations at the time series domain assessed using hydrologic signatures the study is developed for the same small swiss catchment dönnern at olten and using the parameter ensemble identical with the one used in sikorska senoner 2021 this parameter ensemble consists of 1000 parameter sets derived via a multi objective and multi period calibration of the daily hbv model the research questions are developed using 1000 different realizations of discharge pseudo observations of 100 years each resulting from simulation of 100 meteorological scenarios of 100 years each that are briefly described in section 3 2 and that were used in both previous studies see sikorska senoner et al 2020 for further details the use of such long time series is advocated for assessing the method in the flow frequency space 2 methods 2 1 the concept of the representative parameter sets rpss the concept of the representative parameter ensemble or representative parameter sets rpss was introduced by sikorska senoner et al 2020 and further adopted by sikorska senoner 2021 the rpss represent a small parameter subset selected from the full parameter ensemble available that fulfills the following conditions fig 1 1 it represents the entire range of the full ensemble variability of the hydrological responses in the flow frequency space 2 little computational effort is required to run the hydrological model as compared to the full parameter ensemble 3 it is transferable to independent time periods providing representative ranges of ensemble simulations in the flow frequency space a selection of the rps subset is performed using a training dataset containing a large sample of hydrological model simulations and model parameter sets but at a much reduced time series length compared to a potential application or extrapolation phase for example a selection can be made based on observed historical data but the rps subset is then applied for climate impact analysis for the entire 21st century 2 2 modelling framework and clustering based selection of the rpss a selection of the rpss is based on simulation of respective flows in the flow frequency space and is performed independently for different flow indicators i e for annual 7 day average low flow lq annual maximal flows hq and annual mean flow mq simulations of a hydrological model here hbv using input forcing data and optimized parameter sets here 1000 sets serve as a basis for an rps selection in this study the same model set up as in sikorska senoner 2021 is used which consists of 1000 parameter sets and 100 hydro meteorological scenarios resulting from 100 different meteorological input scenarios see section 3 2 for details the method for deriving the parameter ensemble of 1000 sets is not the focus of this study and the interested reader is referred to the source paper based on this modelling framework set up a selection of three flow indicators is performed for each scenario independently next a clustering approach is applied to each flow indicator and scenario independently for simplicity a brief description of the selection method applied to hq is detailed below hqs simulated for one scenario using the full parameter ensemble are sorted by their magnitude over all simulation years for different parameter sets independently as required to represent them in the flow frequency space next these simulation curves are clustered into seven clusters using the k means clustering with the function kmeans from the package stats r core team 2019 and the hartigan wong algorithm hartigan and wong 1979 next these selected clusters are sorted by their magnitude in the upper tail of the distribution using the 90th percentile for each defined cluster the 5th 50th and 95th percentiles over all simulation years are computed and corresponding parameter sets are selected by minimizing the euclidean distance ed as a measure of similarity hence each cluster is described with three rpss that sum up to 21 rpss h q for all seven clusters for a more detailed description see sikorska senoner 2021 in a similar way the rpss for lqs and mqs are selected as rpss l q and rpss m q 2 3 construction of uncertainty intervals for flow frequency simulations based on the rps subset of 21 parameter sets the respective hyper percentiles over the entire ensemble are computed here the 5th 50th 95th percentiles are derived that enable calculation of the 90 prediction intervals 90 pis along the median value similar to sikorska senoner et al 2020 next these rpss from the rps subset are selected in which corresponding simulations lie closest to the computed hyper percentiles in the frequency space based on the ed value and are retained as θ hq 5 th θ hq 50 th and θ hq 95 th for the hq example the simulations corresponding to the θ hq 5 th and θ hq 95 th together define the 90 pis for the hq indicator for plotting positions of flow indicators in the frequency space here the generalized extreme value distribution type i gumbel space the gringorten s method gringorten 1963 is used 1 k j j 0 44 j 0 12 where k j is a plotting position for the j th sorted flow lq mq or hq in the gumbel space and j is the number of simulation years the relation between the k j and the probability p j of the event occurrence is simply expressed as 2 p j 1 k j knowing p j the return period of the event t j can be computed as 3 t j 1 1 p j note that plotting positions are used only for visualizing the analysis in the flow frequency space but they do not play any role in the selection of the rpss 2 4 assessment tests five different assessment tests detailed below and in table 1 are performed to judge the behavior of the rps based pis in reference to the full ensemble simulation using 100 hydro meteorological scenarios for a detailed description of the meteorological scenarios the reader is referred to sikorska senoner et al 2020 while details on the hydrological simulations can be found in sikorska senoner 2021 cross validation to evaluate the behavior of the rps based simulations in the frequency space a leave one out cross validation test see sikorska senoner et al 2020 for details is performed in which one meteorological scenario sr is removed from the analysis and the selection of rpss is executed based on all other remaining meteorological scenarios i e using m 1 2 m and m r the evaluation of rps based simulations is then executed against the sr meteorological scenario initially removed from the set this test assesses the performance of the rps selection at independent time series for the three flow indicators tested here multi scenario test in a multi scenario test sikorska senoner et al 2020 the selection of rpss is executed on one sx meteorological scenario randomly without replacement selected from the m available scenarios and evaluated against all remaining scenarios m 1 2 m and m x this test assesses the transferability of rpss to other time periods but at the same flow conditions for the three flow indicators tested here switch test to evaluate the behavior of rps based simulations for different flow conditions than were originally used for the rps selection a simple switch test is applied in this test rpss selected for one flow indicator e g hq are transferred and assessed for other flow indicators i e mq and lq the flow conditions on which the rps selection is performed are referred to as a donor whereas the evaluation flow conditions are referred to as a target in this way the strength and the transferability of the rpss to different flow indicators can be evaluated the switch test is performed for all meteorological scenarios following the cross validation and multi scenario tests to evaluate the behavior of the derived rpss for each scenario the switch test based on the cross validation evaluation is referred to as switch test 2 and that on the multi test as switch test 1 see table 1 for an overview benchmark random selection as a benchmark 21 parameter sets are randomly selected from all 1000 sets available irrespective of flow conditions and meteorological scenario these sets compose a benchmark rps subset and are used to derive the 90 pis and the median percentile in a similar way to the rps based pis note that by randomly selecting parameter sets independently of flow conditions and meteorological scenarios these sets are selected as valid for all three flow indicators lq mq and hq and all meteorological scenarios see table 1 a selection of random sets is performed only once sensitivity test the benchmark test introduced above relies on a single selection of 21 parameter sets to test its sensitivity to the randomness of selected parameter sets this selection is repeated 100 times with replacement meaning that not all parameter sets out of 1000 available have to be used whereas some can be selected multiple times at each time the selection of parameter sets is done independently from the meteorological scenario and flow indicators as sets are chosen in a purely random way by combining individual repeats one can assess how much the selected benchmark depends on a random selection and whether increasing the number of repeats improves or decreases the performance of random based simulations thus the subset of parameter sets increases from 21 one repeat to 100 repeats of 21 sets note that the same parameter set may occur multiple times within such a random subset and given that only 1000 sets are available the total number of randomly selected sets approaches 1000 and thus is not simply equal to 21x100 2 5 qualitative criteria to support analysis of rps based simulations the evaluation of the rps based simulations resulting from all five tests described in section 2 4 is performed for the 90 pis based on the following quantitative metrics both introduced by sikorska senoner et al 2020 overlapping pools the overlapping pools index a o p p i describes how well the pis constructed using the rpss overlap with the pis derived using the full ensemble simulation hence it measures the reliability of the rps based pis since by definition rps based pis should represent 90 pis the reference pools for the full parameter ensemble are computed as 90 pis outlier ratio the outliers are defined as simulation points in the cross validation based tests and as simulation curves in the multi scenario based tests lying outside the rps based pis the ratio is defined per simulation curve cross validation or scenario multi scenario test and is computed in the following way if 50 of the simulation points per one simulation curve are lying outside the pis then this simulation curve is assumed to be outside the pis next the percentage of hydrological simulation curves lying outside the rps based pis is calculated as r hso in the same way a scenario is assumed to be outside the pis if 50 of the simulation curves lie outside the pis and the percentage of meteorological scenarios lying outside the rps based pis is computed as r mso in addition an average number of simulation points lying outside per simulation curve cross validation and simulation curves lying outside per scenario multi scenario are calculated as r spo and r sso 2 6 post processing diagnosis with hydrologic signatures hydrologic signatures hss are indexed values calculated from observed or simulated time series of hydro meteorological data mcmillan et al 2017 mcmillan 2021 gnann et al 2021 they are specifically suited to extract the most important information about the catchment hydrological behaviour if based on observed time series or to diagnose model deficits if based on simulated time series thus hss are frequently applied either as a post processing evaluation tool euser et al 2013 coxon et al 2014 westerberg et al 2020 or they can be directly included into model calibration westerberg et al 2011 shafii and tolson 2015 fenicia et al 2018 kavetski et al 2018 if not used for model calibration a set of hss offers a very powerful independent test to assess model performance as different signatures focus on different aspects of flow dynamics such a test assesses model performance for a wide range of flows from low to high flow indicators in this study hss are used as a post processing tool to diagnose the behavior of rps based model simulations in the time series domain the underlying assumption of the rps concept is an accurate representation of the full simulation ensemble range in the flow frequency space yet such rpss should ideally also enable one to return to the time series and provide reliable model simulations at the time domain to test this hypothesis hss are computed in two ways first based on the rps based simulations and second based on the full simulation ensemble to evaluate how well hss computed from rps based simulations represent flow dynamics scaled scores liu et al 2009 westerberg et al 2011 are assigned to each hs and each rps based time series simulation these scaled scores are computed relative to the reference values westerberg and birkel 2015 westerberg et al 2020 which here are the hss calculated from the full simulation ensemble hence for each hs computed based on the full simulation ensemble the maximum h s m a x median h s m e d and minimum h s m i n values are defined as reference values to which scores of 1 0 and 1 are assigned next the hs is computed for each rps based simulation and the scaled score is calculated by a linear interpolation between reference ranges if a hs value based on a rps simulation falls outside the reference range h s m i n h s m a x a linear extrapolation is performed outside these values see fig 2 for illustration note that by definition the aim of selecting rpss lies not on the best representation of the best median simulation value but on covering the range of possible model realizations represented here by the h s m i n h s m a x range hence the decision on rps based hss is made according to how well they can reproduce the range of the reference hss for this study a set of 17 hss is selected as summarized in table 2 these hss comprise those recommended by addor et al 2018 i e the first 13 and are extended with additional four hss suggested by westerberg and mcmillan 2015 3 details on experimental setup 3 1 study catchment hydrologic model and parameter ensemble the rps concept is tested on a small swiss catchment of dönnern stream at olten 196 km 2 located in the jura mountains the catchment has an elevation range from 400 to 760 m a s l see fig 3 in sikorska senoner et al 2020 for this catchment a parameter ensemble with 1000 sets is available from the previous study sikorska senoner 2021 this ensemble provides parameter sets for a conceptual hydrological hbv light model seibert and vis 2012 and it was derived in the previous study by calibrating the hydrological model at a daily time step with observed data precipitation temperature and discharge using a multi objective and multi period approach for further details on the model and calibration approach the reader is referred to the source papers this parameter ensemble is used here for testing the rps concept with all three flow indicators which is needed to assess the transferability of rpss to different flow conditions 3 2 hydro meteorological scenarios for dönnern 100 meteorological scenarios of 100 years of continuous precipitation and temperature time series at an hourly time step were available see sikorska senoner et al 2020 for details that were generated using a weather generator gwex disag evin et al 2018 this weather generator is a stochastic multi site precipitation and temperature model that reproduces the statistical behaviour of weather events on different temporal and spatial scales it was set up for a large part of switzerland using observations from the period of 1930 2015 from 105 precipitation and 26 temperature stations these 100 meteorological scenarios are a subset from the scenarios generated over the larger area and for the period of 1000 years each the selected 100 scenarios cover the same time frame and thus represent the natural climate variability they were aggregated to a daily time step and next were fed into the calibrated hbv model to produce pseudo observed discharge time series using 1000 optimized parameter sets this resulted in 1000 discharge simulations of 100 years per scenario computed in the previous work sikorska senoner 2021 which are available for the current analysis 3 3 computation of flow indicators three flow indicators are used to represent different flow conditions these are annual 7 day average low flow lq annual mean flow mq and annual maximal flow hq lq is computed using a 7 day running mean that is commonly applied to analyze changes in low flow dynamics riggs 1980 reilly and kroll 2003 dudley et al 2020 fleming et al 2021 hq is taken as the maximum annual daily flow within each year that is a common choice for flood analysis eng et al 2013 do et al 2017 sikorska senoner and seibert 2020 lq and hq are supported with the analysis of annual mean flows calculated as a mean flow within the year kumar et al 2009 such a selection based on a calendar year can be justified because runoff processes in the dönnern catchment are dominated by precipitation dynamics only sikorska senoner and seibert 2020 thus snow storage and melt do not play any important role in the catchment 4 results 4 1 selected rpss a cluster based selection of rpss for different flow indicators led to choosing 21 parameter sets from 1000 possible sets for each considered scenario and flow indicator to evaluate which parameter sets are chosen for different flow conditions box plots with selected rpss are presented in fig 3 together with standard evaluation metrics used in hydrology kling gupta efficiency kge gupta et al 2009 peak efficiency seibert 2003 and mare measure dawson et al 2007 these metrics were also used during the calibration of the hydrological hbv model in the previous study sikorska senoner 2021 these metrics are computed over the entire observation time window 1989 2014 and are confronted with the metrics calculated for the full parameter ensemble with 1000 sets gray box plots it appears that rpss selected for all three flow indicators cover the entire range of the full parameter ensemble it can also be seen that generally slightly different parameter sets were chosen as rpss for different flow indicators with respect to different efficiency metrics considered here it is evident that rpss selected for lq and hq lie in the same range for kge and mare whereas for mq a much wider spread in the efficiency is observed regarding the peak efficiency rpss selected for lq and mq cover similar ranges whereas those selected for hq are more concentrated along the median value but have a wider range it can be concluded that despite slightly different parameter sets being chosen as rps for different flow indicators they lead to a similar model performance for all three considered criteria 4 2 rps based simulation ensemble an example of the resulting simulation ensemble in the flow frequency space based on the rps subset is shown in fig 4 for one demonstration scenario for all three flow indicators the selection of the rpss visualized here was based on the same scenario it can be seen that the rps based predictive intervals almost overlap with the intervals calculated from the full ensemble for all flow conditions 4 3 assessment of the rps based uncertainty intervals the behavior of the rps based 90 prediction intervals pis were assessed for independent time periods using two tests cross validation and multi scenario test for all 100 scenarios see table 1 for details an example of a visual assessment is presented in fig 5 for one demonstration scenario and results for all scenarios are summarized in table 3 in the multi scenario test bottom panel fig 5 the rps based pis overlap with the intervals based on the full parameter ensemble whereas in the cross validation the rps based pis are slightly larger than the intervals constructed using the full parameter ensemble this is not surprising since the cross validation rps based pis are constructed using the rpss selected based on 99 other scenarios and are then applied to one application scenario in contrast pis based on the full ensemble are constructed using only one application scenario in the multi scenario test the rps based pis are based on one scenario but applied to 99 scenarios and thus the reference ensemble is constructed also using these 99 scenarios overall both assessment tests point out the robustness of the cluster based selection method of rpss applied to all three flow indicators this is also justified with the assessment criteria presented in table 3 as can be seen by the overlapping pools index a o p p i the rps based pis closely overlap with pis based on the full ensemble and are on average slightly larger this is also confirmed by the fact that only a small part of hydrological simulation curves lie outside the rps based pis 0 7 for all three flow indicators and all meteorological scenarios are included within the rps based pis on average only a small proportion of simulation points 1 7 simulation points per one simulation in the cross validation and simulation curves 0 05 simulation curves per one scenario in the multi scenario test lie outside the rps based pis 4 4 transferability of the rpss to other flow conditions two switch tests were performed to assess how well rpss selected based on one flow indicator donor can be transferred and applied to other flow indicators target see also table 1 while switch test 1 is somehow conceptually similar to the multi scenario test switch test 2 is similar to the cross validation test the major difference lies in the selection of rpss and their application to predict different flow indicators an example of these tests is presented in fig 6 for one demonstration scenario it appears from fig 6 that using rps sets estimated based on hq as a donor applied to lq as a target variable was more beneficial than vice versa i e using lq as a donor for simulating hq as a target regarding the application to mq as a target lq used as a donor provided better estimates than hq used as a donor nevertheless it appears that rpss based on all three flow indicators can be transferred to other flow conditions with only a slight drop in the rps based pis performance this visual impression is mirrored by the quantitative metrics table 4 that are all slightly worse for pis with transferred sets than if the rps selection is performed directly at the target flow indicator compare with table 3 comparing the rps based pis although they are only slightly wider a o p p i than if constructed using a target variable more simulation points lie outside such pis with transferred rpss in switch test 1 an average number of simulation curves lying outside the pis is between 0 3 to 5 0 r h s o in switch test 2 the same number of scenarios is considered to lie outside the pis as in targeted rps selection and is equal to 0 on average r m s o the number of points lying outside the rps based pis is on average in the range of 2 53 to 11 97 per one hydrological simulation r s p o and the number of simulation curves lying outside the rps based pis is between 0 10 and 5 69 per one scenario r s s o which is slightly higher than for the rps based pis targeted to the flow indicator hence the following can be concluded if hq is a target variable the selection of rpss should be optimally done on this variable if mq or lq are target variables the selection of rpss can be done using any flow indicator i e mq lq or hq 4 5 random parameter set selection and sensitivity analysis as a benchmark a random selection of 21 parameter sets was performed i e without any clustering to derive the 90 pis results of such a random selection are presented in fig 7 for one demonstration scenario the results are presented per one scenario and per 99 scenarios to be conceptually similar to the cross validation and multi scenario tests as interpreted from fig 7 a random selection led to a poorer performance of pis because the constructed intervals are much narrower than the pis based on the rps selection compare green to blue polygons this effect is visible for both one scenario and multi scenario 99 analysis and all three flow indicators but is the most pronounced for mq and hq this visual assessment is confirmed by the calculated metrics presented in table 5 in addition the sensitivity to the number of random repeats was investigated by averaging results per increasing number of repeats 1 100 for simplicity the results are illustrated only for 1 10 and 100 repeats the results reported for 1 repeat correspond to the benchmark test while the results reported for 10 and 100 repeats reveal sensitivity analysis results as already seen from the fig 7 and confirmed by the quantitative criteria the performance of the pis constructed based on a random parameter selection greatly dropped if compared to the rps based intervals generally for a random parameter selection all assessment metrics dropped with pis being too narrow a o p p i and an average of 11 00 to 20 60 of hydrological simulation curves lying outside the pis per scenario r h s o the number of simulation points lying outside the pis was in the range of 12 12 to 24 54 per simulation curve r s p o and the number of simulation curves was in the range of 68 04 to 145 96 per scenario r s s o increasing the number of repeats only slightly improves the performance of the pis based on random selection with the evaluation metrics remaining poor it appears from these findings that the random selection of 21 parameter sets yields worse results than the switch tests this suggests that rps based selection of parameter sets is more beneficial even if performed on other flow indicators than the targeted variable and this is discussed further in section 5 4 6 diagnostics of the rpss based simulations using hydrologic signatures hydrologic signatures hss provided an independent test on the rps based hydrological model simulations the ability to reproduce hss was assessed with scaled scores that were computed in a reference to the full simulation ensemble and results of this analysis are presented in fig 8 the results are shown for simulations using the rpss targeted to three different flow indicators in two assessment tests cross validation and multi scenario test the gray boxes represent the reference scores i e based on the full parameter ensemble it can be seen that hss computed from rps based simulations box plots in most cases cover the reference boxes well in the cross validation test whereas in the multi scenario test hss from rps based simulations sometimes lie outside the reference boxes first this observation is in agreement with the performance of the rps based pis in the flow frequency space see section 4 3 second this diagnosis of hss demonstrates that rps based simulations are able to faithfully reproduce hss computed with the full parameter ensemble hence rps based simulations provide a good representation of the modelling uncertainty and uncertainty ranges not only in the flow frequency space but also in the signature domain a further detailed analysis of box plot behavior indicates that the box plots manifest different patterns for different hss particularly with regards to the spread between the 25th percentile to the 75th percentile while for some hss e g bfi hfd mean high q freq high q dur this spread is small for other hss e g q5q low q freq low q dur qlv this spread is large indicating a large variability in these signature values depending on the individual rps simulation nevertheless all rps based hss are centered on the reference value of 0 and symmetrically spread around their median value indicating the overall good coverage with the full ensemble simulations without any strong underestimation or overestimation of hss note that evaluation of hss in the switch tests was not possible because switch tests are tailored to the flow frequency space by switching the donor with the target variable while they do no affect the computation of hss that are evaluated at time series without any reference to flow indicators in contrast hss could be computed for the model simulations using a random parameter selection and the results of scaled score computation is shown in fig 9 it can be seen that hss calculated using a random selection of model parameters led to asymmetrically spread box plots whereas rps based simulations led to more symmetrically spread box plots over the entire range compare figs 9 and 8 moreover a random selection of model parameters resulted mostly in underestimated hs values as seen by the fact that all box plots are stretched to negative values of the scaled scores these patterns do not seem to be affected by the number of repeats thus these findings show that hss computed using a random parameter selection led to narrower or underestimated uncertainty ranges of hss than when rps based simulations were used for calculation of hss which is further discussed in section 5 5 discussion a clustering based selection of representative parameter sets rpss has been shown to perform well for flow risk analysis using all three flow indicators annual 7 day average low flow lq annual mean flow mq and annual high flow hq all providing reliable 90 prediction intervals pis in the flow frequency space it has also been found via the switch tests that the rpss selected based on one flow indicator donor can be transferred to other flow indicators target with only a little drop in the pis performance in the flow frequency space based on these findings the following is recommended if hq is a target variable the selection of rpss should optimally be carried out on this variable if mq or lq are target variables the selection of rpss can be made using any flow indicators i e mq lq or hq moreover simulations based on transferred rpss outperformed those based on a random selection of model parameter sets hence it can be concluded that the rps selection of model parameters is beneficial and provides a more balanced way of selecting parameter sets from the entire parameter ensemble available for simulating pis in the flow frequency space these findings were also confirmed by the independent diagnosis based on hydrologic signatures which additionally pointed out the weakness of the random parameter selection the signature based analysis reported that rpss selected in the flow frequency space are able to reproduce uncertainty ranges at the signature domain which was not the case for a random parameter selection this is a great benefit of the clustering based selection as it shows that the rpss concept has the potential to be applied also at the time domain even if rpss are selected in the flow frequency domain some aspects require however a further in depth discussion 5 1 methodological aspects first of all it has to be stressed that both the applicability of the rps concept and the transferability of rpss may strongly depend on the overall model performance achieved after the calibration in particular the representation of modelling uncertainty with rpss depends on whether the inferred model parameters are representative for different model components and runoff processes in a similar way such as low and high flow dynamics the parameter ensemble used in this study resulted from a multi objective and multi period calibration sikorska senoner 2021 and thus all three flow indicators are realistically simulated as also demonstrated in section 4 3 such multi objective calibrations are recommended if multiple objectives are to be met to a similar extent efstratiadis and koutsoyiannis 2010 guse et al 2020 a trade off between different objectives is reflected in model parameters that are able to realistically represent different flow conditions but at the cost of lowering performance for all components considered referred to as the pareto frontier beven and freer 2001 it is expected that using a single objective function would lead to a much lower transferability of rpss between different flow indicators an interesting issue to investigate in a future study would be thus to test how the selection of calibration criteria impacts the transferability of rpss between different flow conditions the independent test with hydrologic signatures hss pointed out the strength of the rps concept over a random parameter selection the uncertainty ranges of hss based on the latter were underestimated and asymmetric in comparison to the reference values in contrast all rps based hss were symmetrically spread over their median values and centered on the best reference value moreover despite the rps based hss cover very well the reference hss for some hss a larger spread in the range between different percentiles was observed this indicates that some hss can be well defined with already a smaller number of parameter sets whereas other hss require more sets this is partly in agreement with the study of westerberg and mcmillan 2015 who focused on quantifying uncertainty in hss and found that uncertainty ranges vary for different hss thus the rps concept can be recommended as an alternative way to derive uncertainty in hss resulting from modelling uncertainty it has to be noted however that uncertainty in hss may also originate from other sources such us precipitation data or discharge data westerberg and mcmillan 2015 which were not explicitly included in this study the rps approach could be however easily extended to account also for these uncertainty sources the rps concept has been tested with synthetic data i e using pseudo observed streamflow series generated from meteorological scenarios with the help of a hydrological model for this study 100 years of simulations per scenario were available creating a rich dataset for testing the concept the use of such long time series is advocated for assessing the method in the flow frequency space with rare events yet such a long time series are obviously usually not available for gauged stations where observations are often limited to only 20 to 30 years note however that the methodology is independent of the record length and thus remains valid also for shorter time series the rps concept selects parameter sets upon the available data set thus using 20 30 years of observations for selecting parameter sets will result in rpss that well represent modelling uncertainty at this time window and flow frequencies of this time period extrapolating these estimates into more extreme events may obviously be linked with increased uncertainty and reduced accuracy of rps based simulations this is however a general problem in hydrology of extrapolating observed values into extreme values finally the developed method of the rps selection has been tested here with hydrological simulations from the conceptual hbv model and flow indicators it has to be stressed however that the selection of rpss does not depend in any way on the hydrological model employed as the selection is performed in the flow frequency space using simulated flow indicators only i e regardless of the way in which they are derived thus this selection method can be employed to choose rpss out of an ensemble available for any hydrologic model in this study a parameter ensemble of 1000 members was available the way in which this ensemble is delivered is out of the scope of this study but it may impact results of the rps selection and the ability to transfer the rpss between different flow conditions as discussed above thus the way the parameter ensemble is delivered remains important for any hydrological model pool et al 2017 and for any flow frequency analysis brunner and sikorska senoner 2019 moreover the selection of the rpss could be applied in the same manner to any environmental model assuming that the predicted variable can be represented in the frequency space a further research direction should test the application of the rps selection to other environmental models e g groundwater snow models or sediment models with different variable indicators in addition to the above the rps selection method tested here for a conceptually based model could be potentially coupled with a data driven approach to further increase model predictive skills sikorska senoner and quilty 2021 and thus the accurateness of flow predictions 5 2 outlook in this study three different flow indicators were investigated for a rainfall dominated catchment however due to the diversity of flood processes sikorska et al 2015b stein et al 2020 and drought types van loon and van lanen 2012 an application of the rps concept to different types of floods and droughts could be beneficial in catchments with different types present e g snowmelt and rainfall floods or snowmelt and rainfall deficit drought types such analysis could support a selection of rpss per flood drought type which could greatly improve predictions of specific hazards this would however be linked with some additional computational cost as several rpss per flood drought type would have to be processed and thus dedicated guidelines on their usage might be required the study of the rps concept together with different types of flood and drought could be of particular value for climate impact studies lawrence 2020 sikorska senoner and seibert 2020 next the rps concept originally developed by sikorska senoner et al 2020 and applied here considers only the modelling uncertainty of a hydrological model due to parameter uncertainty and partly model uncertainty however other uncertainty sources in model simulations such as input or output data renard et al 2011 sikorska et al 2015a westerberg et al 2020 are not considered here this is not a critical point since the interest here lies only on the resulting modelling uncertainty yet if more detailed information is required a dedicated methodology with propagation of different uncertainty sources on flow indicators would be needed meresa and zhang 2021 and could be adapted for the rps concept to define rps sets per uncertainty source propagated the clustering based rps selection is beneficial in lowering computational efforts of using a hydrological model in different hazard assessment and climate impact studies because the selection of rps must be performed only once as long as catchment properties do not change while rps can be applied several times to very different settings see sikorska senoner et al 2020 for further discussion on this point moreover the rps concept is advantageous over the surrogate modelling because it employs the same hydrological model but at reduced computational costs thanks to a pre selected subset of model parameters in contrast surrogate models require setting up of a simpler model which also needs to be parametrized thus the exact effect and uncertainty introduced due to using such a simpler model in regards to the original model are difficult to assess for that purpose the same analysis as with the surrogate model would need to be repeated with the original model razavi et al 2012 therefore the rps concept appears very powerful because no simplification in the model structure must be performed such an rps concept can be applied in probabilistic flood risk assessments hazard scenario analysis climate scenario analysis or multiple site analysis or uncertainty propagation it can also support real time forecasting of flow related hazards sikorska senoner 2021 this is extremely important for all engineering problems related to water resources such as flood design operation of retention lakes and hydropower water supply or maintaining the minimal ecological flow in rivers and flow forecasting i e everywhere where risk and failure may have high economic and societal impact and thus accurate estimates with uncertainty consideration are needed particularly for flow forecasting the input data has the highest uncertainty wu et al 2020 thus a reduction of computational efforts by using a small sample of rpss for a hydrological model could be of a great value 6 conclusions the concept of the representative parameter sets rpss for lowering computational costs that are selected in the flow frequency space based on clustering has been adopted to study modelling uncertainty of three different flow indicators annual 7 day average low flow lq annual mean flow mq and annual high flow hq based on several tests it was found that the rps concept can be successfully applied to provide uncertainty estimates on any of these three flow indicators the clustering based selection of rpss also overperformed a random selection of parameter sets moreover rpss selected based on one flow indicator can be transferred to other flow indicators with only a little loss in the model performance in addition the independent test with hydrologic signatures revealed that rps based hydrological simulations provide good coverage with the signatures calculated using the full simulation ensemble hence it can be concluded that the rps concept can be applied to any hydrological model to select representative parameter sets and to provide reliable uncertainty estimates for both the flow frequency and signature domain it also reduces the computational cost connected with the use of a hydrological model compared to the simulation based on the full parameter ensemble and thus it is of particular importance for all flow uncertainty analysis and hazard estimation under uncertainty moreover the rps concept lowers computational costs through reducing the parameter sets but uses the same original model thus it is beneficial over the surrogate modelling the concept is however not limited to hydrological modelling and can be potentially applied to any environmental model to represent its modelling uncertainty at a low computational cost credit authorship contribution statement anna e sikorska senoner funding acquisition conceptualization methodology software visualization writing original draft writing review editing declaration of competing interest the author declares that she has no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was funded through the forschungskredit of the university of zurich grant no fk 18 118 fk 20 124 the sciencecloud provided by s3it at the university of zurich enabled the computation intensive simulations to be run on virtual machines the author wishes to thank two anonymous reviewers for very useful comments to the previous version of this manuscript and tracy ewen for proofreading the manuscript 
