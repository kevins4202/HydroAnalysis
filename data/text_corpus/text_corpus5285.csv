index,text
26425,a global sensitivity analysis was conducted on a dynamic water balance model with 19 parameters describing canopy structure stomatal regulation and soil characteristics to quantify the importance of vegetation and soil properties in coupled models of hydrology and forest dynamics main outputs were total evaporation as well as a physiological drought index calculated from actual and potential transpiration parameter sensitivity was assessed at ten temperate to sub alpine locations covering both water limited and energy limited sites varying parameter values within plausible ranges led to differences of several hundreds of mm year in predicted long term evaporation root zone storage is the most important parameter at drier stations whereas canopy and stomatal parameters become more important where soil moisture is less limiting physiological drought also depends strongly on root zone properties while canopy structure only matters at the drier sites stomatal sensitivity to dry air substantially contributed to drought stress at the more humid sites keywords sensitivity analysis drought stress forest water balance ecohydrology rooting zone storage capacity water partitioning software availability name of software forhytm developer matthias speich contact information matthias speich wsl ch speichmatthias gmail com hardware required general purpose computer software required r programming language r availability https github com mspeich forhytm 1 introduction forests grow on large parts of the surface of the earth sometimes with profound effects on local water balance numerous studies have shown that afforestation deforestation and change in forest properties affect water yield although the nature and intensity of these effects differ greatly between different cases e g andréassian 2004 this may have strong implications for flood regimes and the use of water for human consumption or economic activities e g irrigation or power generation furthermore local water balance affects the well being of the forest itself as tree growth and mortality are affected by drought changes in forest properties such as canopy cover density and species composition are driven by land use change nijzink et al 2016 forest management policies giuggiola et al 2013 natural succession dynamics ewers et al 2005 pollution renner et al 2014 or changing environmental conditions mátyás 2010 1 1 forest water interactions and modeling them there is a tight link between terrestrial water fluxes and vegetation dynamics at various spatial and temporal scales from a plant physiological perspective co2 uptake and water vapor loss take the same pathway the stomata this leads to a trade off between carbon assimilation and water conservation cowan 1978 while plant species have evolved different strategies to solve this trade off water shortage generally reduces a plant s potential for carbon uptake mcdowell et al 2008 prolonged and intense drought leads to reduced growth and vitality and in some cases to death through various physiological processes mcdowell et al 2008 unlike annual plants which tend to favor an intensive water uptake strategy to enable rapid growth and seed production trees and shrubs usually follow a more conservative strategy and reduce transpiration and assimilation in case of limited water supply teuling et al 2010 the water balance of forests is thus modulated to a large extent by stomatal activity ewers et al 2005 much of the current knowledge of the influence of forests on hydrology has been gained from paired catchment studies andréassian 2004 brown et al 2005 hegg et al 2006 many of these studies suggest that the percentage of forest cover impacts water yield negatively however this relationship does not always hold for example in a comparison of eddy covariance measurement sites williams et al 2012 found that under similar climates forested sites tended to evaporate a smaller fraction of precipitation than grasslands a review by stednick 1996 showed that the sensitivity of catchments to timber harvest varied across different hydro climatic regions also forest cover alone does not adequately describe the impact of forests on hydrology further aspects of importance are stand age with the associated change in leaf and sapwood area vertessy et al 2001 as well as species composition as species specific differences in stomatal behavior may influence stand level transpiration ewers et al 2005 a meta analysis by brown et al 2005 revealed that afforestation with conifers generally leads to a greater reduction in water yield than with hardwoods in an analysis of long term experimental catchments creed et al 2014 found that water yield tended to increase with increasing temperatures in catchments dominated by evergreen conifers and to decrease in hardwood dominated catchments they attributed these differential reactions to differences in stomatal and phenological responses to warming under ongoing climate change shifts in spatial patterns of hydro climatic conditions jung and chang 2012 forest structure clark et al 2016 and species distribution bugmann et al 2014 zimmermann et al 2016 are expected these shifts potentially affect the aforementioned linkages between forests and hydrology to assess the impact of such changes on ecosystems and natural resources various models have been developed with great differences in spatiotemporal scales and complexity some approaches relate long term water balance to climatic and surface factors using relatively simple relationships whereas other models simulate processes explicitly and although their output can be aggregated to long term values operate at much finer temporal scales a widely used instance of the former is the budyko framework this term refers to a number of functionally similar equations relating long term evaporative fraction e t p the ratio of total evaporation to precipitation to the aridity index a i p e t p the ratio of potential evapotranspiration to precipitation see wang et al 2016 for a recent review budyko 1974 describes a semi empirical nonparametric equation applied to 1200 river basins which was used to predict long term water partitioning with a relative error of 10 the budyko equation is defined as follows see also fig 6 d and e 1 e t p a i t a n h 1 a i 1 e x p a i 0 5 in the recent years much effort has been devoted to the development of budyko type equations focusing on strengthening its theoretical basis zhang et al 2004 assessing the applicability of the framework at various spatiotemporal scales donohue et al 2007 and including non climatic factors donohue et al 2012 gentine et al 2012 zhang et al 2004 it has long been postulated that vegetation properties modify the relationship between water partitioning and climate milly 1994 donohue et al 2007 argue that vegetation dynamics affect inter annual variations in water partitioning as well as long term water balance and that including such processes would make budyko type equations applicable at smaller spatiotemporal scales however explicitly including surface properties has proven challenging for example zhang et al 2004 present an equation with an adjustable parameter modifying the shape of the curve relating p e t p to e t p in a calibration exercise the parameter value fit for forested catchments was higher leading to higher evaporation than for grassed catchments this parameter integrates the effect of all factors other than water supply and demand sums such as seasonality precipitation intermittency topography soil and vegetation properties however the contribution of each of these factors to the parameter value is difficult to quantify donohue et al 2012 parameterized another single parameter budyko type equation with a combination of three ecohydrologically relevant variables soil water holding capacity rooting depth and mean precipitation intensity the budyko framework has also been used to assess the effects of climate and land cover changes on water partitioning creed et al 2014 renner et al 2014 dynamic modeling approaches offer an alternative perspective to study the interactions between vegetation and hydrology in such models this coupling is represented in various ways some models focus almost exclusively on hydrology e g viviroli et al 2009 or vegetation dynamics e g lischke et al 2006 with a limited treatment of the respective other process although this limits the predictive ability of these models they have been applied in many climate impact studies bugmann et al 2014 speich et al 2015 other models include an explicit connection between hydrology and vegetation at different levels of complexity chen et al 2015 in parallel to model development numerical experiments have been conducted to examine model behavior at the hydrology vegetation interface often by varying vegetation parameters these studies have highlighted the importance of lai and its seasonal variation armbruster et al 2004 rooting depth armbruster et al 2004 federer et al 2003 or stomatal behavior mackay et al 2003 federer et al 2003 showed that the effect of soil and rooting characteristics on total evaporation depends greatly on climate more research is needed to determine how all these parameters influence the water balance under different climates and how they interact with each other another important aspect of the vegetation hydrology coupling is physiological drought as water availability impacts vegetation growth and mortality and determines vegetation type and characteristics here drought is defined from a physiological point of view referring to conditions where water shortage limits plant function a widely used index for physiological drought is the ratio of actual and potential transpiration or evapotranspiration in the budyko framework this ratio describes energy partitioning and is thought to depend on aridity p e t p and surface properties renner et al 2014 zhang et al 2004 whereas in dynamic models it is used to model the effects of water shortage on the vegetation e g lischke et al 2006 some models simulate the partitioning of evapotranspiration into its soil and vegetation components and use the ratio of actual to potential transpiration rather than bulk evapotranspiration as a drought index e g seely et al 2015 zierl 2001 as this formulation better takes into account the effect of surface parameters and is thus thought to be more ecologically meaningful lischke and zierl 2002 with all other factors kept constant the intensity of physiological drought as expressed by this drought index increases with increasing lai decreases with increasing root zone water holding capacity and decreases with increasing minimum stomatal resistance wellpott et al 2005 this is consistent with many empirical observations which suggest a strong interplay between physiological drought and vegetation properties giuggiola et al 2013 mcdowell et al 2008 thus some authors have hypothesized that stand leaf area and rooting depth adapt dynamically to climate e g kergoat 1998 however the effect of these and other vegetation properties on physiological drought has not been studied as much as their effect on evaporation but see wellpott et al 2005 another type of drought index based on soil moisture state was shown to be highly dependent on model parameters samaniego et al 2013 1 2 sensitivity analysis in hydrological and environmental modeling a way to systematically study such relationships is sensitivity analysis i e an investigation of how varying the input factors of a numerical model affects its outputs pianosi et al 2016 this study focuses on global parameter sensitivity i e the effect of variations in model parameters as opposed to e g forcing data across the whole range of possible parameter values as opposed to local derivatives often sensitivity analysis is performed in two steps first unimportant parameters are identified in a screening procedure in a second step a more advanced method is used with only the important parameters being varied pianosi et al 2016 among screening methods the elementary effects method proposed by morris 1991 and improved by other authors campolongo et al 2007 sin and gernaey 2009 is widely used and has been shown to provide reliable estimates of parameter sensitivity herman et al 2013 for more advanced analyses there exist many different methods with different theoretical foundations see review by pianosi et al 2016 the choice of an appropriate sensitivity analysis method depends on different factors such as the nature of the question at hand the properties of the model e g smoothness of the response surface or computational cost one such approach consists of fitting a statistical meta model to a sample of model runs if such a meta model is able to reproduce the behavior of the original model it can be used to gain information on parameter sensitivity many different statistical modeling approaches have been applied for such a meta model based analysis among which simple or generalized linear models sieber and uhlenbrook 2005 or regression trees harper et al 2011 recently anova has been used to assess the contribution of different uncertainty sources e g climate and hydrological models climate and land use scenarios to modeled hydrological climate impact projections addor et al 2014 while the results of such an analysis are often quantitative sensitivity indices such as regression coefficients coutts and yokomizo 2014 or significance measures hou et al 2012 graphical methods offer another sometimes more informative way to evaluate parameter sensitivity cannon and mckendry 2002 coutts and yokomizo 2014 1 3 aim of this work the aim of this study is to examine and quantify the sensitivity of the simulated long term water balance and physiological drought to several surface and vegetation properties under various climatic conditions occurring in temperate to sub alpine locations this is done through a parameter sensitivity analysis performed on a local water balance model at ten locations in switzerland covering a large range of climate characteristics typical for temperate and mountainous regions to this aim we developed forhytm forest hydrology toy model a local water balance model of intermediate complexity combining well known process formulations for transpiration evaporation and soil water balance the outputs of forhytm are potential pt and actual transpiration at total evaporation te water yield wy all in mm as well as a non dimensional drought index di in the present study only the long term annual means are evaluated te and wy represent the partitioning of incoming precipitation into evaporation lost to the system and streamflow or ground water local water resources on the other hand pt at and di are of interest for physiological considerations as forhytm combines process formulations that are common to many models it can serve as a tool to explore the behavior of forest water balance models in general also as it describes the interface between vegetation and hydrology it may be implemented as a part of distributed models that simulate both hydrology and vegetation dynamics due to its intermediate level of complexity it would be well suited for implementation in semi conceptual models see chen et al 2015 in such models physical processes are simulated dynamically but process formulations are often simplified this approach has the advantage to keep a high degree of realism while keeping data demand relatively low thus these models are well suited to simulate climate impacts on forests and hydrology for large regions country scale but at a comparatively fine resolution the present study aims at answering the following questions 1 which parameters characterizing vegetation and soil are important for modeling local water balance and physiological drought 2 how do these parameters interact with each other and with climate regarding the first question we hypothesized that the most important parameters would be soil moisture storage capacity leaf area index lai and minimum stomatal resistance based on the findings of donohue et al 2007 for water partitioning and wellpott et al 2005 for physiological drought h1 for the second question we hypothesized that water balance and drought index would be primarily controlled by climate with a greater effect of lai and stomatal resistance at the more humid sites and a greater effect of soil moisture storage capacity at drier sites h2 furthermore this study aims at relating these findings to the development of coupled models of hydrology and vegetation dynamics and at gaining insights for simpler modeling approaches at coarser time scales 2 methods 2 1 the water balance model forhytm this section outlines forhytm the water balance model used in this study the model has a one dimensional vertical structure and describes a spatial unit at which the assumption of a unique value for meteorological variables and surface parameters is reasonable while lateral water transfer can be neglected e g a forest plot or a raster cell in a distributed meso scale hydrological model with a cell size in the order of magnitude of 50 500 m forhytm operates at a sub daily time step hourly in the case of this study and its outputs can be aggregated to any temporal resolution e g daily annual or long term pt at and di are defined here following zierl 2001 in this paper the abbreviations pt and at refer to long term annual means whereas in the model description below instantaneous fluxes are represented by e with the corresponding subscript pt is the amount of water that would be transpired without any effect of dry air or dry soil on stomatal opening pt only accounts for the effect of non optimal air temperature and radiation on the stomata at is the actual transpiration further accounting for stomatal closure due to dry air and dry soil the physiological drought index di is based on the ratio of actual to potential transpiration over the whole simulation period 2 d i 1 a t p t total evaporation te is the sum of at soil evaporation and interception loss and water yield wy is the sum of runoff and groundwater recharge as drivers forhytm requires hourly measurements of precipitation mm air temperature c global radiation wm 2 relative humidity and wind speed m s 1 as well as daily relative sunshine duration of potential sunshine duration this is compatible with the forcing needed to run state of the art hydrological models such as prevah gurtz et al 1999 speich et al 2015 the 19 model parameters representing vegetation surface and subsurface properties are presented in the model description below and in section 2 2 1 and listed in table 1 fig 1 shows the model logic of forhytm water enters the system as precipitation pin and leaves it in the form of transpiration etrans soil evaporation esoil interception loss eint or water yield the canopy is represented by a single layer characterized by leaf area index lai and fractional vegetation cover fvc fraction of area covered by the canopy the system contains two storage elements the interception storage si and the plant available soil moisture ssm following menzel 1996 and vegas galdos et al 2012 the size of the interception reservoir simax mm is defined as a function of lai 3 s i m a x k s i m a x l o g 10 1 l a i where k s i m a x is a free parameter the upper limit of ssm sfc mm can be understood as the product of soil water holding capacity and effective rooting depth soil water holding capacity is the amount of water that can be retained in the soil and accessed by plant roots it is usually calculated as the difference between water content at field capacity and at the wilting point and expressed in terms of water depth per unit soil depth here as in other models of similar complexity e g gurtz et al 1999 sfc is treated as a model parameter without specifying soil hydraulic properties and rooting depth the term canopy refers here to trees only so that transpiration calculated by forhhytm only accounts for water transpired by trees understory transpiration is lumped together with soil evaporation there are several reasons for this choice first it is assumed that an index based on tree transpiration only is most representative of the growing conditions for trees second understory transpiration has been shown to be highly dependent on available radiation at the forest floor e g diawara et al 1991 thus tending towards equilibrium rather than imposed evaporation as defined by jarvis and mcnaughton 1986 as is the case with soil evaporation finally this definition of transpiration is also used for stand scale transpiration calculated from upscaled sap flow measurements which may be used in the future to validate this model to include the effects of leaf phenology another parameter gsl growth season length days was added outside the leafed season lai is set to a minimum of 0 2 in the first and last 20 days of the leafed season lai is interpolated linearly between this minimum and the value at full foliage given by the free parameter more details are given in the supplementary material s1 energy partitioning also depends on fractional vegetation cover fvc as there is usually a close link between lai and fvc defining fvc as a free parameter would lead to implausible parameter combinations on the other hand non independent parameters would greatly complicate sensitivity analysis this problem was addressed by linking lai and fvc through a free parameter termed ff the link between lai and fvc is implemented as follows 4 f v c f f 0 054 l a i this relationship is based on modeled lai and fvc for hypothetical forest stands details on these calculations are given in the supplementary material s1 this ad hoc formulation only serves to provide a plausible link between lai and fvc in the present study while keeping the input parameters independent and we do not recommend the use of eq 4 for other purposes the interception storage si is refilled by precipitation following menzel 1996 5 s i t m i n s i m a x s i t 1 s i m a x s i t 1 1 e 1 s i m a x p i n t e i n t t where pin t is incoming precipitation during time step t the plant available soil moisture reservoir ssm is refilled by effective precipitation and depleted by transpiration and soil evaporation soil moisture refilling uses the formulation proposed by bergström 1992 where the partitioning of incoming precipitation into soil moisture recharge and runoff is a non linear function of current soil moisture controlled by the dimensionless exponent beta the water balance of ssm is defined as 6 s s m t m i n s f c s s m t 1 p e f f t s s m t 1 s f c b e t a e t r a n s t e s o i l t where peff t is effective precipitation defined as 7 p e f f t p t max 0 s i t s i t 1 the calculation of the evaporation components etrans esoil and eint is based on the hybrid dual source scheme of guan and wilson 2009 this scheme builds upon previous efforts to estimate transpiration and soil evaporation e g shuttleworth and wallace 1985 and is applicable to both sparse and dense canopies this method has been successfully applied to predict transpiration and evaporation in various ecosystems lu et al 2014 and outperformed similar models e g shuttleworth and wallace 1985 in this scheme energy is split between soil and canopy using a layer approach i e through lai and the partitioning of energy into latent and sensible heat is done using a patch approach i e by tying the available energy available to soil and canopy to their respective surface area available energy r n is the sum of net shortwave and longwave radiation details on the radiation parameterization are given in the supplementary material s1 the available energy for canopy and soil ac and as is calculated using beer s law 8 a c r n 1 e k l l a i 9 a s r n e k l l a i where kl is the canopy light extinction coefficient a free parameter then ac is used to calculate interception evaporation eint assuming no surface resistance 10 e i n t m i n s i δ a c f v c ρ a c p r a a r a c v p d δ γ ρ w λ f w e t where δ is the first derivative of the relationship between saturated vapor pressure and temperature hpa k 1 ρa the density of air kg m 3 cp the heat capacity of air j kg 1 k 1 r a a and r a c are the above canopy and within canopy aerodynamic resistances respectively s m 1 vpd the difference of saturated and actual atmospheric water vapor pressure hpa γ the psychrometric constant hpa k 1 ρw the density of water kg m 3 λ the latent heat of vaporization of water j kg 1 and fwet is the fraction of foliage area covered by water calculated following deardorff 1978 11 f w e t s i s i m a x 2 3 details on the calculation of the aerodynamic resistances are given in the supplementary material s1 the energy used for interception evaporation is subtracted from ac to obtain at the energy available for transpiration 12 a t a c ρ w λ e i n t transpiration is estimated analogously including a canopy resistance term r s c 13 e t r a n s δ a e f v c ρ a c p r a v p d δ γ r s c r a ρ w λ 1 f w e t the canopy resistance rs c is estimated using a jarvis type model jarvis 1976 14 r s c r s m i n l a i f v c f 1 r g f 2 t a f 3 v p d f 4 s s m where rsmin is the minimum stomatal resistance of individual leaves s m 1 the response function for rg is implemented after stewart 1988 15 f 1 1000 1000 j r r g j r r g where jr is a free parameter the response function for temperature is also taken from stewart 1988 16 f 2 t a t m i n t m a x t a a t o p t t m i n t m a x t o p t a where 17 a t m a x t o p t t o p t t m i n and the free parameters tmin topt and tmax are the minimum optimal and maximum temperatures for photosynthesis the response function for vpd has been implemented in various ways e g as a linear stewart 1988 or logarithmic function oren et al 1999 here the formulation of noilhan and planton 1989 was selected 18 f 3 1 1 j v p d v p d where jvpd a free parameter is the stomatal sensitivity to vpd similarly while different implementations for the soil moisture response function exist asce 1996 granier et al 1999 a piecewise linear function was chosen here 19 f 4 1 i f s s m t s f c j s m j s m s f c s s m t o t h e r w i s e where jsm a free parameter is the threshold soil moisture level at which stomatal closure starts for the estimation of potential transpiration f 3 and f 4 are always set to one for soil evaporation defining a surface resistance as was attempted by shuttleworth and wallace 1985 is more difficult indeed this resistance would depend on a large number of factors such as topsoil moisture hydraulic conductivity and the presence of ground vegetation or a litter layer an explicit representation of these factors would greatly increase model complexity and many of the required parameters are subject to high uncertainty therefore it is assumed instead that soil evaporation gets reduced exponentially as the soil dries brutsaert 2014 kelliher et al 1995 morillas et al 2013 soil evaporation is thus calculated following morillas et al 2013 20 e s δ a s 1 f v c ρ a c p r a s r a a v p d δ γ ρ w λ f p e f d r y i n g where r a s is below canopy aerodynamic resistance see s1 fpe is a function of precipitation and soil evaporation in the last 16 days and fdrying is a function of the number of days since the last rainy day defined here as a day with peff 5 mm d 1 the function of antecedent precipitation and evaporation is defined as 21 f p e m i n i d 15 d p e f f i i d 15 d e p o t s o i l i 1 where d is the current day peff i is the sum of effective precipitation on a day i and epot soil i the sum of potential soil evaporation i e eq 20 with fpe and fdrying set to unity the function of soil drying is defined as 22 f d r y i n g e x p d d r y k a p p a where d d r y is the number of consecutive dry days and the e folding time kappa is a free parameter the above model description applies to snow free conditions a detailed assessment of snowpack dynamics is outside the scope of this study however as snowmelt represents an important component of annual water balance in many regions of switzerland speich et al 2015 a parsimonious snow routine was implemented based on the hydrological model hbv bergström 1992 the snow routine is described in the supplementary material s1 if snow is present all evaporative fluxes are set to zero snow sublimation is implicitly accounted for in the snow routine 2 2 sensitivity analysis the sensitivity analysis consisted of two steps first a screening identified unimportant parameters from an initial set of 19 parameters for the parameters that were identified as important a sensitivity analysis based on meta modeling was conducted 2 2 1 variable selection and definition of input space the parameters included in this sensitivity analysis describe three different model aspects the structure of the canopy the stomatal control of transpiration and the soil properties model parameters were retained if they relate to at least one of these three aspects and if it was possible to define a meaningful range based on reported observations and commonly used parameter values table 1 shows the 19 parameters with their minima and maxima the reasons for setting these parameter ranges are discussed in the supplementary material s1 2 2 2 the elementary effects method for the screening analysis the elementary effects method of morris 1991 was used with the improvements suggested by campolongo et al 2007 and sin and gernaey 2009 the input space is defined as follows for m factors x 1 x m the range for each factor is divided into p equidistant levels a trajectory in this input space consists of m 1 sets of parameter values where the value of each parameter gets increased or decreased once by a given fraction δ i of the parameter range in a random order the model is run with each of these parameter sets generating m 1 outputs y x 1 x m for each parameter x i the elementary effect ee is the difference in modeled y between the run where x i has been altered and the previous run divided by the change δ i of the parameter value 23 e e i y x 1 x i δ i x m y x 1 x m δ i as the different parameters as well as the output variables are not commensurate with each other scores based on elementary effects obtained with eq 23 cannot be directly compared therefore following sin and gernaey 2009 the e e i were multiplied with the ratio of the standard deviations of the model outputs σ x i and of the parameters σ y to obtain the scaled elementary effects s e e i 24 s e e i y x 1 x i δ i x m y x 1 x m δ i σ x i σ y in a screening experiment r trajectories are generated each with a different starting point and a different order of parameter change as a sensitivity index describing the importance of each parameter the mean of absolute values μ i o f the r different s e e i values was chosen campolongo et al 2007 this index was calculated for each combination of parameters stations and output variables randomly selecting the starting points of trajectories and the order of parameter changes may lead to a non optimal sampling of the input space therefore the so called quasi optimized trajectories sampling strategy of ge and menendez 2014 a computationally less expensive adaptation of the strategy proposed by campolongo et al 2007 was used with this method r 20 trajectories were generated details are given in the supplementary material s1 2 2 3 meta model based sensitivity analysis for the second part of the sensitivity analysis another set of model runs was generated where only the values of the eight retained parameters were varied the eleven other parameters were assigned a fixed value as declared in table 1 for the output variables te and di a statistical meta model was fit to the set of model runs with the parameters as predictors and the output variable as dependent variable the statistical meta model is a multiple regression model of the form 25 y ˆ β 0 β 1 x s 1 β 10 x s 1 x s 2 ε where y ˆ is the output variable predicted by the meta model β 0 the intercept β i the slope of each term x s i the scaled i th predictor x s i x s j the interaction between the i th and j th predictors i e their product and ε is an error term accounting for the unexplained variance the predictors are scaled so that they are centered on the mean and expressed in units of standard deviations each meta model is fit to the entire set of model runs for all stations and includes station identity as a categorical predictor the meta models include up to two way interactions between parameters and three way interactions between two parameters and the factor station where a visual examination of the residuals distribution across the range of one parameter suggested a non linear relationship an orthogonal quadratic term was added for that parameter and kept only if it decreased the akaike information criterion aic akaike 1998 to limit complexity no higher order polynomials were introduced and interactions were kept only if they decreased aic the sampling method is latin hypercube sampling lhs mckay et al 2000 a stratified monte carlo sampling scheme a set of 800 parameter combinations was generated and used to run the model at each of the ten locations details are given in the supplementary material s1 parameter sensitivity is evaluated graphically using effects plots to represent meta model predictions these plots show the linear or curvilinear relationship between one predictor and the output variable while all other predictors are set to an arbitrarily fixed value fox 2003 here the fixed value is the middle of the parameter range each curve corresponds to the parameter effect at one station in addition a new set of 800 parameter combinations was generated for each plot where all parameters are varied except the one whose effect is being evaluated this allows a representation of the possible range of meta model outputs when all parameters are varied within their plausible range to assess the ability of the meta model to emulate the original model and whether the number of parameter combinations is large enough confidence intervals were calculated using a bootstrapping procedure a sample of model runs was drawn with replacement and the meta model coefficients estimated from that sample this procedure was repeated 2000 times for each meta model the confidence interval is given by the 2 5 and 97 5 percentiles of the bootstrapped meta model predictions at each discrete interval of the x axis 2 3 data in this experiment the model was driven with meteorological data see section 2 1 from ten stations of the automatic stations network swissmetnet of the swiss meteorological office the simulation period is 1982 2009 the selected stations are listed in table 2 and their location is shown on fig 2 all stations belong to the köppen geiger köppen 2011 classes cfb warm temperate humid warm summer or dfc cold humid cool summer table 2 also shows the two climatic parameters of the budyko 1974 framework mean annual precipitation map and potential evapotranspiration pet as well as their ratio pet is a measure of atmospheric water demand independently of surface cover and was computed here following priestley and taylor 1972 in the budyko framework climates where long term pet exceeds precipitation are considered water limited and climates where precipitation exceeds pet are considered energy limited most of the selected sites fall into the latter category except sion and basel where pet exceeds precipitation and montana where annual water supply and demand are equal the stations were chosen so that the whole range of hydro climatic conditions in potentially forested regions in switzerland temperate to sub alpine regions is represented fig 3 shows a series of climatic indicators for the period 1982 2009 at each station with the stations sorted by elevation the mean growing season temperature defined arbitrarily as may through october is shown in fig 3 a as an indicator of evaporative demand the growing season precipitation sum shown on fig 3 b varies greatly between the stations it is also informative to consider the precipitation sum outside the growing season november april shown on fig 3 c as an indicator of soil moisture recharge between two growing seasons the three remaining climate indicators describe the temporal patterns of water supply with the frequency of rainy days the average depth of precipitation on a rainy day and the length of the longest rain free period shown in fig 3 d e and f respectively the differences between the stations are further discussed in the supplementary material s1 to summarize the selected stations cover a wide range of precipitation regimes across a strong temperature gradient 3 results 3 1 screening analysis fig 4 shows the μ scores mean absolute elementary effects for all output variables the parameters where μ reached a threshold arbitrarily defined as 0 2 for any of the five outputs were retained for further analysis an exception was made for the temperature response parameters of the stomatal resistance submodel the threshold was reached by both tmin and topt however as these two parameters jointly control the shape of the same curve only tpot was retained in total eight parameters were kept for further analysis lai gsl rsmin jvpd topt sfc beta and kappa the other variables were set to fixed values as shown in table 1 3 2 meta model based sensitivity analysis 3 2 1 ranges of absolute values and station effect fig 5 shows the ranges of the five output variables simulated by forhytm at each station with the 800 parameter combinations the medians of pt are all between 400 and 600 mm year 1 with an interquartile range iqr of 200 300 mm year 1 and a spread of up to 800 mm year 1 for at the medians range between 200 and 400 mm year 1 with an iqr of about 100 mm year 1 at each station the overall spread is up to 600 mm year 1 although pt and at are rather similar across stations the medians for di vary between 0 2 and 0 4 and up to 0 65 at sion for te the medians range between 450 and 650 mm year 1 the spread at each station is less than for at with the iqr not exceeding 100 mm year 1 and the range not exceeding 450 mm year 1 finally wy shows large and significant differences between stations with medians between 150 sion and 1100 mm year 1 magadino in fig 6 a to c pt at te and wy are scaled with mean annual precipitation sion is the only station where pt can exceed precipitation whereas it represents between 10 and 90 of precipitation at the other stations medians between 30 and 50 the at p ratio varies less across stations with medians between 20 and 40 and maxima between 40 and 60 at most stations total evaporation represents between 40 and 60 of precipitation exceptions are magadino with a median around 35 and basel and sion with medians of 70 75 fig 6 d and e shows the normalized te in relation to the budyko curve eq 1 all stations are close to the curve but the medians of t e p are consistently below at ulrichen and montana the whole range of modeled t e p is below the budyko curve 3 2 2 meta model fitting the meta models are all able to explain almost all of the variance of the model outputs adjusted r2 0 99 for all outputs including quadratic terms for some parameters decreased aic the parameters with quadratic terms are lai topt sfc and beta for di as well as kappa for te also most of the two way interactions contributed to decrease aic and were thus kept in the meta models figure s2 1 shows the interactions included in the meta models of di and te the rest of the discussion focuses on these two output variables since the meta models are complex and contain many interactions and orthogonal quadratic terms the regression coefficients are not well suited as sensitivity indices instead the evaluation of the meta models is done graphically using effects plots see section 2 2 3 for di which unlike the other outputs is on the standard unit interval a natural logarithm transformation of the dependent variable was considered however the resulting meta model showed a greater deviation from normality and heteroskedasticity of the residuals so that no transformation was applied in the final meta model the bootstrap confidence intervals are very narrow with a maximum interval size of 8 9 mm year 1 for te and of 0 01 for di not shown indicating that the meta models are able to emulate the dynamic model 3 2 3 parameter effect the maximum effect of each parameter on total evaporation te and drought index di i e the change in output due to changes in parameter values across their plausible range is shown in table 3 the range in each column refers to the stations where the effect of each parameter is lowest and highest table 3 also includes the effect of station i e climate which is the most important factor controlling both te and di for both output variables sfc is the most important parameter the effect of canopy properties on te varies greatly across stations with almost no effect at some stations to over 100 mm year 1 for lai and rsmin for di the most important parameters next to sfc are jvpd and beta the four most important parameter effects on total evaporation are shown on fig 7 for three contrasting stations sion dry inner alpine p e t p 1 91 davos cold subalpine p e t p 0 84 and magadino warm and humid p e t p 0 57 the lines show the meta model predictions with all other parameters set to the center of their range and the intervals represent the 2 5 and 97 5 percentile of a set of 800 additional meta model predictions where all parameters vary except the one on the x axis as te and wy are complementary fractions of precipitation over climatological time scales the effect of a parameter on wy is of equal size and opposite sign as the effect on te here the effects on te are presented because the inter station variability is much smaller for te than for wy so that the curves for te are easier to visualize and interpret sfc is the most important parameter especially at sion where the interval is very narrow and the relationship quasi linear at the two other stations the curves saturate around 150 mm apart from sfc te at sion is only influenced noticeably by beta not shown and the curve is nearly flat for all other parameters on the other hand the stomatal parameters rsmin and jvpd play a greater role at the two other stations fig 8 shows the effect of lai sfc beta and jvpd on di at sion dry inner alpine p e t p 1 91 basel temperate lowland p e t p 1 14 and davos cold subalpine p e t p 0 84 in all cases the spacing of the curves on the y axis shows that di is strongly controlled by climate di may take values from 0 1 to 0 4 at davos 0 15 to 0 6 at basel and 0 35 to 0 8 at sion the variation within these ranges is due to varying parameter values also here sfc has the strongest effect i e the steepest curves and the narrowest intervals at davos the curve flattens off at 150 mm indicating that any increase in sfc beyond that value has little effect on di by contrast there is almost no saturation effect at the two drier stations the effect of lai is different at each station with a convex and rather flat curve at davos an almost linear positive relationship at basel and a concave curve at sion with a much wider interval at low lai the effect of beta is similar at all three stations with a decrease of di in the range of 1 4 and a flattening of the curves at 4 the slope for jvpd is much steeper at davos than at the two drier sites 3 2 4 parameter interactions the effect plots do not show many important parameter interactions as an exception the effect of canopy properties such as lai and stomatal parameters increases when soil moisture is less limiting i e at more humid stations and at higher values of sfc fig 9 shows the effect of lai and rsmin on te for all stations with a low intermediate and high value of sfc both lai and rsmin have a greater effect at more humid stations and their effect increases with increasing sfc for example an increase in lai from 1 to 4 at magadino or davos increases te by about 100 mm year 1 at low sfc this value goes up to 130 mm year mm 1 at high sfc a greater increase occurs at other stations where the effect of lai is less important such as pully with corresponding values of 40 and 90 mm year 1 similarly the effect of rsmin increases from 100 to 130 mm year 1 at davos and from about 40 to 80 mm year 1 at ulrichen fig 10 shows the effect of lai and jvpd on di again at three levels of sfc with increasing sfc the effect of lai becomes more important at sion on the other hand at the other stations the slopes get flatter at the drier stations the effect of jvpd is almost zero regardless of sfc on the other hand at more humid stations the slopes for jvpd are much steeper at high sfc 3 2 5 plausibility of model results as forhytm combines widely applied process formulations no validation was undertaken here also the results are not necessarily realistic predictions but rather show the range that can be obtained by varying uncertain parameter values nevertheless to interpret the effect of parameters it is important to assess the plausibility of outputs in another study forhytm was applied at 14 eddy covariance measurement sites speich et al in preparation at the nine sites with climatic and edaphic conditions similar to the sites shown here the model performed well with a kling gupta efficiency gupta et al 2009 ranging from 0 66 to 0 87 for half hourly te and from 0 51 to 0 77 for soil moisture dynamics a comparison of the forhytm outputs of the present study with public datasets of modeled mean annual te and runoff is given in s2 2 actual transpiration may be estimated from upscaled sap flow measurements for example leuzinger and körner 2010 estimated long term canopy transpiration and total evaporation based on sap flow measurements at a broadleaf forest stand near basel with a lai of 5 and a root zone storage capacity of 80 mm they obtained values of 221 and 597 mm year 1 for at and te respectively for these settings the corresponding meta models in this study predict about 280 and 580 mm year 1 respectively in another study wieser et al 2014 measured sap flow of pinus sylvestris in a dry inner alpine valley in austria with a climate similar to sion annual at was 74 and 88 mm in 2011 and 2012 respectively with a very low lai 0 55 extrapolation of the effects curves for the meta model at sion yields values between 70 and 100 mm while they do not constitute a thorough validation these comparisons suggest that the toy model simulates the processes well enough for the purposes of this study 4 discussion 4 1 screening of unimportant parameters the screening revealed that some parameters have very little effect on the outputs therefore common values from the literature may be used for these parameters with little contribution to model error also the low scores of ff suggest that variations of fvc within a plausible range for a given lai have little impact on the outputs another unimportant parameter is the canopy height zv however this parameter only affects aerodynamic resistance in our model and has no influence on stomatal resistance even though such a link has been described see also section 4 2 4 2 parameter effects the parameters with the largest effects on te are sfc lai and rsmin this is in accordance with the three vegetation properties identified by donohue et al 2007 as having the greatest influence on hydrology leaf area photosynthetic rate and rooting depth their relative importance varies between sites as sfc is more important at drier sites and canopy characteristics at more humid sites at the stations compared here a shift from a shallow to a deep soil with a fully developed rooting system increases annual te by 50 200 mm year 1 this is in line with the sensitivity of te to available water capacity reported by federer et al 2003 the significance of this change for water yield depends on climate annual wy is between 1000 and 1200 mm year 1 at magadino and between 100 and 200 mm year 1 at sion thus the same change in sfc may double annual wy at sion and show little relative effect at magadino the effect of gsl gives an indication of the expected difference between deciduous and evergreen trees especially at a cold site like davos where the leafed season is shortest if all other parameters are equal te is higher for evergreens by about 50 mm year 1 the stomatal parameters rsmin and to a lesser extent jvpd both reduce te low stomatal resistance is often associated with a high sensitivity to vpd oren et al 1999 so that on an annual or longer time scale their effects often counteract each other contributing to the relatively low variability in forest te roberts 2007 overall it appears that rsmin is more important for water balance estimations whereas jvpd is more important for modeling physiological drought di is also mainly determined by climate but the effect of parameters goes up to 0 3 considering that most of the forested area of switzerland typically exhibits long term di values between 0 and 0 3 zierl 2001 this shows the importance of surface properties on physiological drought again sfc is the most important parameter also at humid stations the varying effect of jvpd suggests that dry air accounts for a larger part of the drought stress experienced by trees at more humid sites whereas soil drought dominates at drier locations this is in line with the findings of zweifel et al 2005 who examined the physiological response of trees to soil drying and vpd close to sion and davos and found that the effect of dry soil dominated in the first case and the effect of vpd in the second at most stations a higher lai leads to greater drought index values this is consistent with the idea of a negative feedback between vegetation density and physiological drought kergoat 1998 and with the higher drought stress effects observed giuggiola et al 2013 or modeled de cáceres et al 2015 in denser stands however at the more humid stations the effect is negligible or even negative fig 10 this is due to the different relative influence of soil and atmospheric drought at different stations indeed the effect of high vpd on stomatal opening is purely instantaneous and when soil moisture is not limiting negative by contrast stomatal closure due to dry soil mitigates the immediate effect on transpiration over a longer period a multiplicative increase in canopy resistance eq 13 causes a greater proportional reduction of transpiration eq 14 at lower than at higher lai where soil moisture is not limiting and drought is dominated by vpd this counteracts the positive relationship between lai and di leading to a flattening of the curve this might be a drawback of using a jarvis type canopy resistance formulation in combination with the drought index used here indeed there are no physiological reasons to assume that a higher leaf area would decrease drought stress especially since the model does not consider aerodynamic coupling however this effect occurs primarily at the more humid locations i e where drought plays a minor role in ecological processes the rather strong effect of topt is surprising an examination of the effects plots not shown reveals that this effect occurs mostly at warm sites where the model reacts strongly to low topt as plant response to temperature results from adaptation to local climate körner 2012 trees with low photosynthetic optima are unlikely to occur outside cold environments the strong topt effect therefore occurs in a part of the parameter space that is of little relevance for process understanding and model development 4 3 implications for model development this study revealed a high sensitivity of te to lai and sfc as noted above this is consistent with empirical observations therefore special care should be given to the parameterization of these vegetation properties for hydrological modeling this also confirms previous assessments that temporal variations in vegetation cover must be taken into account in modeling studies gallart and llorens 2003 this refers to intra annual changes due to phenology see e g section 1 5 in s1 as well as inter annual variations due to changes in allometry stand density or vegetation composition promising results have been obtained with assimilation of remotely sensed lai chakroun et al 2014 or of vegetation model outputs schattan et al 2013 sfc is much more difficult to measure and generalize for example walthert et al 2015 used geostatistical methods to generate maps of soil properties for swiss forests based on 2071 forest soil profiles however they did not obtain any satisfactory results for soil thickness and stone content two crucial parameters for the estimation of sfc many authors have reported adaptations of vegetation characteristics to climate including sfc and lai eagleson 1982 gentine et al 2012 o grady et al 2011 this has inspired various approaches for a dynamic parameterization of sfc e g nijzink et al 2016 gentine et al 2012 postulate that due to these adaptations of vegetation properties long term water partitioning is controlled by climate only as described by budyko 1974 however there are many possible reasons why vegetation properties at a particular site may depart from equilibrium such as succession dynamics a lagged response to climate change natural and anthropogenic disturbances or non climatic stressors such as nutrient limitation or pollution variations in lai parameterization may be due to different definitions for this variable for example some lai measurements do not account for foliage clumping chen et al 2016 found that ignoring the effects of clumping caused a significant underestimation of annual te in forests lai not corrected for clumping is usually smaller than actual lai by a factor of about 0 5 0 8 iio et al 2014 the shape of the effect curves indicates that this may be especially important at lower lai with an effect of up to 50 mm year 1 on the water balance the importance of rsmin suggests that it might be necessary to consider differences due to species identity stand age or height or possible effects of increased c o 2 concentration on stomatal resistance however due to the high variability of stomatal resistance measurements even between trees of the same species e g breuer et al 2003 parameterization may be challenging information for such a parameterization may be obtained from studies relating transpiration measurements to environmental variables and tree characteristics ford et al 2011 or species identity leuzinger et al 2005 as well as from theory and observations in tree hydraulics ewers et al 2005 this experiment shows that di is determined to a large extent by climate but may be substantially modified by vegetation and soil properties thus coupled modeling of hydrology and vegetation dynamics is necessary to explore the long term development of lai and sfc with time and a changing climate stomatal properties especially jvpd are also important but as discussed above may be difficult to parameterize to account for differential drought sensitivity of species without explicitly parameterizing jvpd lischke and zierl 2002 calculated long term di with a vpd response function independent of species and overlaid the results with a species distribution map from this they derived a species specific drought sensitivity corresponding to the highest di tolerated by this species this parameter reflects not only stomatal sensitivity to drought but also other characteristics such as water use efficiency under water stress or the ability to compete for water the soil hydrological parameter beta which has a substantial effect on di is not an observable quantity and has been assigned different interpretations bergström and graham 1998 use it to reflect spatial heterogeneity of infiltration rather than soil properties whereas van den roovaart et al 2014 use it as a measure of soil absorption capacity in distributed models beta is parameterized as a function of soil type uhlenbrook 1999 land cover johst 2003 or the combined effects of soil depth and elevation merz 2002 the large effect of beta shows the importance of soil infiltration and absorption characteristics for root zone water availability the important contribution of vpd to physiological drought at some stations shows that the physiological effects of high vpd see e g novick et al 2016 should not be neglected to our knowledge only few models explicitly include water stress due to high vpd seidl et al 2012 zierl 2001 while other models include this effect implicitly seely et al 2015 wellpott et al 2005 or only use soil moisture to differentiate between pt and at while incorporating the vpd effect into di is physiologically meaningful further research is needed to determine whether this is a realistic representation of the effects of drought on tree growth more generally adequately representing the various physiological impacts of water shortage on trees is the subject of ongoing research de cáceres et al 2015 for such questions comparing modeled indices with physiological indicators such as growth patterns in tree rings bhuyan et al 2017 crown condition zierl 2004 or tree height walthert et al 2015 is a promising approach 4 4 links to the budyko framework while this study used a dynamic model with a sub daily timestep outputs were evaluated at the climatological time scale which enables a comparison with the budyko framework although the range of a i p e t p of the stations used here is relatively narrow compared to other studies donohue et al 2012 zhang et al 2004 it still covers the range containing the majority of the forested catchments of zhang et al 2004 as shown in fig 6 d and e the long term te estimates were near the budyko curve for all sites but systematically below this is consistent with williams et al 2012 who found that forests had a lower evaporative fraction than grasslands for the high elevation stations montana ulrichen and davos this may be partly explained by the fact that snow sublimation is not counted in te in the model however at the lowland sites snow sublimation hardly plays a role in the water balance williams et al 2012 explained their findings with the conservative water use strategy of forests in comparison to grasses teuling et al 2010 grasses generally have lower stomatal resistance breuer et al 2003 and lower stomatal sensitivities than trees teuling et al 2010 in this study the effect of rsmin on te is nonlinear with a steeper slope at the lower end of the parameter range this part of the rsmin range overlaps with values typical for grasses breuer et al 2003 guan and wilson 2009 therefore parameterizing canopy resistance to reflect the behavior of grasses would greatly increase the evaporative fraction however a shift to grasslands would also result in a lower canopy height which increases aerodynamic resistance jarvis and mcnaughton 1986 some of the stations have similar a i despite differences in the absolute values of p e t and p for example davos and pully have a i of 0 84 and 0 88 respectively whereas p e t and p differ by 146 and 118 mm year 1 respectively in accordance with the budyko curve the evaporation fraction is slightly higher at pully at the humid end of the a i range are the stations magadino and glarus with a i of 0 57 and 0 58 respectively and differences in p e t and p of 175 and 344 and mm year 1 respectively however the evaporative fraction differs significantly between the two stations with higher t e p at glarus fig 6 c likewise there are large differences in the drought index values with greater values at magadino fig 5 c this may be explained by the different precipitation regimes precipitation at magadino is distributed between fewer events but with a greater mean intensity fig 3 d and e therefore even a deep soil might not be able to retain all incoming precipitation of a given event which increases runoff and decreases transpiration also a smaller fraction of precipitation is lost to interception which also decreases t e this highlights the importance of the temporal distribution of precipitation for long term water partitioning donohue et al 2012 this study has shown a differential effect of surface properties on water partitioning under different climates this might explain the difficulty of relating deviations from the budyko curve to specific surface properties for example studies that use a budyko type equation with an adjustable parameter have stratified observations into broad categories such as forested and grass dominated catchments zhang et al 2004 or catchments belonging to the same basin yang et al 2009 to calibrate this parameter the results of this study suggest that a potentially interesting strategy would be to divide observations into groups with similar climates but different surface characteristics to explore the relationships between climate soil and vegetation properties and water partitioning while some of the parameters identified as important are difficult to estimate such as the stomatal properties such a study might make use of publicly available datasets of lai soil properties and vegetation type 4 5 limitations of this study and outlook the geographical focus of the present study is switzerland although there are important differences between the stations considered here they represent only a small subset of the different climates of the world with our setup it is possible to repeat the analysis conducted here with input from other climates synthetic weather data obtained from a weather generator e g ivanov et al 2007 or grid cell level outputs of climate models however such analyses go beyond the scope of this study also this study has focused on long term output quantities while these are useful descriptors of a site s hydrology and ecohydrology other outputs are also relevant such as the temporal distribution of discharge or a seasonal drought index e g zierl 2004 for such outputs the sensitivity to the different parameters might not be the same as for long term values another limitation of this study is that the meteorological input is treated as an independent variable neglecting the effects of land surface properties on climate e g van der ent et al 2014 these effects are generally relevant at spatial scales larger than individual forest stands and small catchments ellison et al 2012 therefore the effects of vegetation and soil parameters discussed here only apply if the area under consideration is small enough or shielded enough so that local climate is not affected by changes in forest properties in other locations e g large scale afforestation or deforestation in forhytm plant available soil moisture is represented as a single storage this approach has been criticized as it neglects important aspects of soil water flow e g milly 1994 however simulation experiments have shown that with adequate parameterization such simple models perform relatively well compared to models with multiple soil layers federer et al 2003 another limitation related to the soil representation is that the model does not include a groundwater storage limiting its applicability to regions where groundwater substantially contributes to tree transpiration e g schilling et al 2014 5 conclusions this study examined how vegetation and soil parameters affect long term total evaporation te and a physiological drought index di in a water balance model applied to various locations in switzerland with contrasting climates while climate is a primary determinant for both output variables the spread of results obtained by varying surface parameters within their plausible ranges is quite large for a given climate variations in surface parameters within their plausible range may affect mean annual total evaporation by several hundreds of mm year 1 it was hypothesized h1 that the most important parameters would be leaf area index lai minimum stomatal resistance rsmin and soil water storage capacity sfc for water balance this hypothesis was confirmed for physiological drought rsmin was less important whereas stomatal sensitivity to dry air jvpd and a parameter controlling partitioning of incoming water between storage and runoff beta had a larger effect the second hypothesis h2 was that the main control on te and di would be exerted by climate and that the influence of vegetation parameters would vary with climate with a greater importance of lai and rsmin under more humid climates and of sfc under drier conditions the insensitivity of te to lai and stomatal characteristics at the dry site sion supports this hypothesis as does the saturation of the sfc te curves at the energy limited sites fig 7 however below the saturation threshold sfc also has a considerable effect on te at the most humid sites also for di this hypothesis could only be partially confirmed as for te sfc is important at all sites but there is a saturation effect at the more humid sites in accordance with h2 the importance of stomatal factors was greater under more humid conditions however the influence of lai is low to non existent at humid sites and greatest at the driest sites in conjunction with high sfc furthermore this study revealed that many of the parameters commonly used in water balance models have little effect on long term hydrology and ecohydrology and may be safely set to fixed values these findings highlight the necessity of coupling hydrological and vegetation models for future predictions of water resources and forest growth indeed two of the most important surface parameters for hydrology lai and sfc vary across climatological time scales and should therefore be treated as state variables in a coupled model also if enough data are available parameterizing minimum stomatal resistance as a function of species identity and or canopy height may improve long term forecasts of evaporation and water yield regarding drought modeling this study underlines the importance of considering the physiological effects of vapor pressure deficit on plant drought stress in addition to the effects of dry soil acknowledgements this research was funded by the swiss national science foundation no 153544 meteorological data was provided by the swiss federal office of meteorology and climatology meteoswiss we thank luzi bernhard wsl for providing the sample dataset included in the publicly available software package the authors would like to thank pius korner oikostat gmbh for assistance with the statistical analyses and james kirchner eth zurich for providing constructive comments finally we would like to thank the three anonymous reviewers whose comments greatly contributed to improve this article appendix a supplementary data the following are the supplementary data related to this article supplementary1 supplementary1 supplementary2 supplementary2 supplementary3 supplementary3 supplementary4 supplementary4 appendix a supplementary data supplementary data related to this article can be found at https doi org 10 1016 j envsoft 2018 01 016 
26425,a global sensitivity analysis was conducted on a dynamic water balance model with 19 parameters describing canopy structure stomatal regulation and soil characteristics to quantify the importance of vegetation and soil properties in coupled models of hydrology and forest dynamics main outputs were total evaporation as well as a physiological drought index calculated from actual and potential transpiration parameter sensitivity was assessed at ten temperate to sub alpine locations covering both water limited and energy limited sites varying parameter values within plausible ranges led to differences of several hundreds of mm year in predicted long term evaporation root zone storage is the most important parameter at drier stations whereas canopy and stomatal parameters become more important where soil moisture is less limiting physiological drought also depends strongly on root zone properties while canopy structure only matters at the drier sites stomatal sensitivity to dry air substantially contributed to drought stress at the more humid sites keywords sensitivity analysis drought stress forest water balance ecohydrology rooting zone storage capacity water partitioning software availability name of software forhytm developer matthias speich contact information matthias speich wsl ch speichmatthias gmail com hardware required general purpose computer software required r programming language r availability https github com mspeich forhytm 1 introduction forests grow on large parts of the surface of the earth sometimes with profound effects on local water balance numerous studies have shown that afforestation deforestation and change in forest properties affect water yield although the nature and intensity of these effects differ greatly between different cases e g andréassian 2004 this may have strong implications for flood regimes and the use of water for human consumption or economic activities e g irrigation or power generation furthermore local water balance affects the well being of the forest itself as tree growth and mortality are affected by drought changes in forest properties such as canopy cover density and species composition are driven by land use change nijzink et al 2016 forest management policies giuggiola et al 2013 natural succession dynamics ewers et al 2005 pollution renner et al 2014 or changing environmental conditions mátyás 2010 1 1 forest water interactions and modeling them there is a tight link between terrestrial water fluxes and vegetation dynamics at various spatial and temporal scales from a plant physiological perspective co2 uptake and water vapor loss take the same pathway the stomata this leads to a trade off between carbon assimilation and water conservation cowan 1978 while plant species have evolved different strategies to solve this trade off water shortage generally reduces a plant s potential for carbon uptake mcdowell et al 2008 prolonged and intense drought leads to reduced growth and vitality and in some cases to death through various physiological processes mcdowell et al 2008 unlike annual plants which tend to favor an intensive water uptake strategy to enable rapid growth and seed production trees and shrubs usually follow a more conservative strategy and reduce transpiration and assimilation in case of limited water supply teuling et al 2010 the water balance of forests is thus modulated to a large extent by stomatal activity ewers et al 2005 much of the current knowledge of the influence of forests on hydrology has been gained from paired catchment studies andréassian 2004 brown et al 2005 hegg et al 2006 many of these studies suggest that the percentage of forest cover impacts water yield negatively however this relationship does not always hold for example in a comparison of eddy covariance measurement sites williams et al 2012 found that under similar climates forested sites tended to evaporate a smaller fraction of precipitation than grasslands a review by stednick 1996 showed that the sensitivity of catchments to timber harvest varied across different hydro climatic regions also forest cover alone does not adequately describe the impact of forests on hydrology further aspects of importance are stand age with the associated change in leaf and sapwood area vertessy et al 2001 as well as species composition as species specific differences in stomatal behavior may influence stand level transpiration ewers et al 2005 a meta analysis by brown et al 2005 revealed that afforestation with conifers generally leads to a greater reduction in water yield than with hardwoods in an analysis of long term experimental catchments creed et al 2014 found that water yield tended to increase with increasing temperatures in catchments dominated by evergreen conifers and to decrease in hardwood dominated catchments they attributed these differential reactions to differences in stomatal and phenological responses to warming under ongoing climate change shifts in spatial patterns of hydro climatic conditions jung and chang 2012 forest structure clark et al 2016 and species distribution bugmann et al 2014 zimmermann et al 2016 are expected these shifts potentially affect the aforementioned linkages between forests and hydrology to assess the impact of such changes on ecosystems and natural resources various models have been developed with great differences in spatiotemporal scales and complexity some approaches relate long term water balance to climatic and surface factors using relatively simple relationships whereas other models simulate processes explicitly and although their output can be aggregated to long term values operate at much finer temporal scales a widely used instance of the former is the budyko framework this term refers to a number of functionally similar equations relating long term evaporative fraction e t p the ratio of total evaporation to precipitation to the aridity index a i p e t p the ratio of potential evapotranspiration to precipitation see wang et al 2016 for a recent review budyko 1974 describes a semi empirical nonparametric equation applied to 1200 river basins which was used to predict long term water partitioning with a relative error of 10 the budyko equation is defined as follows see also fig 6 d and e 1 e t p a i t a n h 1 a i 1 e x p a i 0 5 in the recent years much effort has been devoted to the development of budyko type equations focusing on strengthening its theoretical basis zhang et al 2004 assessing the applicability of the framework at various spatiotemporal scales donohue et al 2007 and including non climatic factors donohue et al 2012 gentine et al 2012 zhang et al 2004 it has long been postulated that vegetation properties modify the relationship between water partitioning and climate milly 1994 donohue et al 2007 argue that vegetation dynamics affect inter annual variations in water partitioning as well as long term water balance and that including such processes would make budyko type equations applicable at smaller spatiotemporal scales however explicitly including surface properties has proven challenging for example zhang et al 2004 present an equation with an adjustable parameter modifying the shape of the curve relating p e t p to e t p in a calibration exercise the parameter value fit for forested catchments was higher leading to higher evaporation than for grassed catchments this parameter integrates the effect of all factors other than water supply and demand sums such as seasonality precipitation intermittency topography soil and vegetation properties however the contribution of each of these factors to the parameter value is difficult to quantify donohue et al 2012 parameterized another single parameter budyko type equation with a combination of three ecohydrologically relevant variables soil water holding capacity rooting depth and mean precipitation intensity the budyko framework has also been used to assess the effects of climate and land cover changes on water partitioning creed et al 2014 renner et al 2014 dynamic modeling approaches offer an alternative perspective to study the interactions between vegetation and hydrology in such models this coupling is represented in various ways some models focus almost exclusively on hydrology e g viviroli et al 2009 or vegetation dynamics e g lischke et al 2006 with a limited treatment of the respective other process although this limits the predictive ability of these models they have been applied in many climate impact studies bugmann et al 2014 speich et al 2015 other models include an explicit connection between hydrology and vegetation at different levels of complexity chen et al 2015 in parallel to model development numerical experiments have been conducted to examine model behavior at the hydrology vegetation interface often by varying vegetation parameters these studies have highlighted the importance of lai and its seasonal variation armbruster et al 2004 rooting depth armbruster et al 2004 federer et al 2003 or stomatal behavior mackay et al 2003 federer et al 2003 showed that the effect of soil and rooting characteristics on total evaporation depends greatly on climate more research is needed to determine how all these parameters influence the water balance under different climates and how they interact with each other another important aspect of the vegetation hydrology coupling is physiological drought as water availability impacts vegetation growth and mortality and determines vegetation type and characteristics here drought is defined from a physiological point of view referring to conditions where water shortage limits plant function a widely used index for physiological drought is the ratio of actual and potential transpiration or evapotranspiration in the budyko framework this ratio describes energy partitioning and is thought to depend on aridity p e t p and surface properties renner et al 2014 zhang et al 2004 whereas in dynamic models it is used to model the effects of water shortage on the vegetation e g lischke et al 2006 some models simulate the partitioning of evapotranspiration into its soil and vegetation components and use the ratio of actual to potential transpiration rather than bulk evapotranspiration as a drought index e g seely et al 2015 zierl 2001 as this formulation better takes into account the effect of surface parameters and is thus thought to be more ecologically meaningful lischke and zierl 2002 with all other factors kept constant the intensity of physiological drought as expressed by this drought index increases with increasing lai decreases with increasing root zone water holding capacity and decreases with increasing minimum stomatal resistance wellpott et al 2005 this is consistent with many empirical observations which suggest a strong interplay between physiological drought and vegetation properties giuggiola et al 2013 mcdowell et al 2008 thus some authors have hypothesized that stand leaf area and rooting depth adapt dynamically to climate e g kergoat 1998 however the effect of these and other vegetation properties on physiological drought has not been studied as much as their effect on evaporation but see wellpott et al 2005 another type of drought index based on soil moisture state was shown to be highly dependent on model parameters samaniego et al 2013 1 2 sensitivity analysis in hydrological and environmental modeling a way to systematically study such relationships is sensitivity analysis i e an investigation of how varying the input factors of a numerical model affects its outputs pianosi et al 2016 this study focuses on global parameter sensitivity i e the effect of variations in model parameters as opposed to e g forcing data across the whole range of possible parameter values as opposed to local derivatives often sensitivity analysis is performed in two steps first unimportant parameters are identified in a screening procedure in a second step a more advanced method is used with only the important parameters being varied pianosi et al 2016 among screening methods the elementary effects method proposed by morris 1991 and improved by other authors campolongo et al 2007 sin and gernaey 2009 is widely used and has been shown to provide reliable estimates of parameter sensitivity herman et al 2013 for more advanced analyses there exist many different methods with different theoretical foundations see review by pianosi et al 2016 the choice of an appropriate sensitivity analysis method depends on different factors such as the nature of the question at hand the properties of the model e g smoothness of the response surface or computational cost one such approach consists of fitting a statistical meta model to a sample of model runs if such a meta model is able to reproduce the behavior of the original model it can be used to gain information on parameter sensitivity many different statistical modeling approaches have been applied for such a meta model based analysis among which simple or generalized linear models sieber and uhlenbrook 2005 or regression trees harper et al 2011 recently anova has been used to assess the contribution of different uncertainty sources e g climate and hydrological models climate and land use scenarios to modeled hydrological climate impact projections addor et al 2014 while the results of such an analysis are often quantitative sensitivity indices such as regression coefficients coutts and yokomizo 2014 or significance measures hou et al 2012 graphical methods offer another sometimes more informative way to evaluate parameter sensitivity cannon and mckendry 2002 coutts and yokomizo 2014 1 3 aim of this work the aim of this study is to examine and quantify the sensitivity of the simulated long term water balance and physiological drought to several surface and vegetation properties under various climatic conditions occurring in temperate to sub alpine locations this is done through a parameter sensitivity analysis performed on a local water balance model at ten locations in switzerland covering a large range of climate characteristics typical for temperate and mountainous regions to this aim we developed forhytm forest hydrology toy model a local water balance model of intermediate complexity combining well known process formulations for transpiration evaporation and soil water balance the outputs of forhytm are potential pt and actual transpiration at total evaporation te water yield wy all in mm as well as a non dimensional drought index di in the present study only the long term annual means are evaluated te and wy represent the partitioning of incoming precipitation into evaporation lost to the system and streamflow or ground water local water resources on the other hand pt at and di are of interest for physiological considerations as forhytm combines process formulations that are common to many models it can serve as a tool to explore the behavior of forest water balance models in general also as it describes the interface between vegetation and hydrology it may be implemented as a part of distributed models that simulate both hydrology and vegetation dynamics due to its intermediate level of complexity it would be well suited for implementation in semi conceptual models see chen et al 2015 in such models physical processes are simulated dynamically but process formulations are often simplified this approach has the advantage to keep a high degree of realism while keeping data demand relatively low thus these models are well suited to simulate climate impacts on forests and hydrology for large regions country scale but at a comparatively fine resolution the present study aims at answering the following questions 1 which parameters characterizing vegetation and soil are important for modeling local water balance and physiological drought 2 how do these parameters interact with each other and with climate regarding the first question we hypothesized that the most important parameters would be soil moisture storage capacity leaf area index lai and minimum stomatal resistance based on the findings of donohue et al 2007 for water partitioning and wellpott et al 2005 for physiological drought h1 for the second question we hypothesized that water balance and drought index would be primarily controlled by climate with a greater effect of lai and stomatal resistance at the more humid sites and a greater effect of soil moisture storage capacity at drier sites h2 furthermore this study aims at relating these findings to the development of coupled models of hydrology and vegetation dynamics and at gaining insights for simpler modeling approaches at coarser time scales 2 methods 2 1 the water balance model forhytm this section outlines forhytm the water balance model used in this study the model has a one dimensional vertical structure and describes a spatial unit at which the assumption of a unique value for meteorological variables and surface parameters is reasonable while lateral water transfer can be neglected e g a forest plot or a raster cell in a distributed meso scale hydrological model with a cell size in the order of magnitude of 50 500 m forhytm operates at a sub daily time step hourly in the case of this study and its outputs can be aggregated to any temporal resolution e g daily annual or long term pt at and di are defined here following zierl 2001 in this paper the abbreviations pt and at refer to long term annual means whereas in the model description below instantaneous fluxes are represented by e with the corresponding subscript pt is the amount of water that would be transpired without any effect of dry air or dry soil on stomatal opening pt only accounts for the effect of non optimal air temperature and radiation on the stomata at is the actual transpiration further accounting for stomatal closure due to dry air and dry soil the physiological drought index di is based on the ratio of actual to potential transpiration over the whole simulation period 2 d i 1 a t p t total evaporation te is the sum of at soil evaporation and interception loss and water yield wy is the sum of runoff and groundwater recharge as drivers forhytm requires hourly measurements of precipitation mm air temperature c global radiation wm 2 relative humidity and wind speed m s 1 as well as daily relative sunshine duration of potential sunshine duration this is compatible with the forcing needed to run state of the art hydrological models such as prevah gurtz et al 1999 speich et al 2015 the 19 model parameters representing vegetation surface and subsurface properties are presented in the model description below and in section 2 2 1 and listed in table 1 fig 1 shows the model logic of forhytm water enters the system as precipitation pin and leaves it in the form of transpiration etrans soil evaporation esoil interception loss eint or water yield the canopy is represented by a single layer characterized by leaf area index lai and fractional vegetation cover fvc fraction of area covered by the canopy the system contains two storage elements the interception storage si and the plant available soil moisture ssm following menzel 1996 and vegas galdos et al 2012 the size of the interception reservoir simax mm is defined as a function of lai 3 s i m a x k s i m a x l o g 10 1 l a i where k s i m a x is a free parameter the upper limit of ssm sfc mm can be understood as the product of soil water holding capacity and effective rooting depth soil water holding capacity is the amount of water that can be retained in the soil and accessed by plant roots it is usually calculated as the difference between water content at field capacity and at the wilting point and expressed in terms of water depth per unit soil depth here as in other models of similar complexity e g gurtz et al 1999 sfc is treated as a model parameter without specifying soil hydraulic properties and rooting depth the term canopy refers here to trees only so that transpiration calculated by forhhytm only accounts for water transpired by trees understory transpiration is lumped together with soil evaporation there are several reasons for this choice first it is assumed that an index based on tree transpiration only is most representative of the growing conditions for trees second understory transpiration has been shown to be highly dependent on available radiation at the forest floor e g diawara et al 1991 thus tending towards equilibrium rather than imposed evaporation as defined by jarvis and mcnaughton 1986 as is the case with soil evaporation finally this definition of transpiration is also used for stand scale transpiration calculated from upscaled sap flow measurements which may be used in the future to validate this model to include the effects of leaf phenology another parameter gsl growth season length days was added outside the leafed season lai is set to a minimum of 0 2 in the first and last 20 days of the leafed season lai is interpolated linearly between this minimum and the value at full foliage given by the free parameter more details are given in the supplementary material s1 energy partitioning also depends on fractional vegetation cover fvc as there is usually a close link between lai and fvc defining fvc as a free parameter would lead to implausible parameter combinations on the other hand non independent parameters would greatly complicate sensitivity analysis this problem was addressed by linking lai and fvc through a free parameter termed ff the link between lai and fvc is implemented as follows 4 f v c f f 0 054 l a i this relationship is based on modeled lai and fvc for hypothetical forest stands details on these calculations are given in the supplementary material s1 this ad hoc formulation only serves to provide a plausible link between lai and fvc in the present study while keeping the input parameters independent and we do not recommend the use of eq 4 for other purposes the interception storage si is refilled by precipitation following menzel 1996 5 s i t m i n s i m a x s i t 1 s i m a x s i t 1 1 e 1 s i m a x p i n t e i n t t where pin t is incoming precipitation during time step t the plant available soil moisture reservoir ssm is refilled by effective precipitation and depleted by transpiration and soil evaporation soil moisture refilling uses the formulation proposed by bergström 1992 where the partitioning of incoming precipitation into soil moisture recharge and runoff is a non linear function of current soil moisture controlled by the dimensionless exponent beta the water balance of ssm is defined as 6 s s m t m i n s f c s s m t 1 p e f f t s s m t 1 s f c b e t a e t r a n s t e s o i l t where peff t is effective precipitation defined as 7 p e f f t p t max 0 s i t s i t 1 the calculation of the evaporation components etrans esoil and eint is based on the hybrid dual source scheme of guan and wilson 2009 this scheme builds upon previous efforts to estimate transpiration and soil evaporation e g shuttleworth and wallace 1985 and is applicable to both sparse and dense canopies this method has been successfully applied to predict transpiration and evaporation in various ecosystems lu et al 2014 and outperformed similar models e g shuttleworth and wallace 1985 in this scheme energy is split between soil and canopy using a layer approach i e through lai and the partitioning of energy into latent and sensible heat is done using a patch approach i e by tying the available energy available to soil and canopy to their respective surface area available energy r n is the sum of net shortwave and longwave radiation details on the radiation parameterization are given in the supplementary material s1 the available energy for canopy and soil ac and as is calculated using beer s law 8 a c r n 1 e k l l a i 9 a s r n e k l l a i where kl is the canopy light extinction coefficient a free parameter then ac is used to calculate interception evaporation eint assuming no surface resistance 10 e i n t m i n s i δ a c f v c ρ a c p r a a r a c v p d δ γ ρ w λ f w e t where δ is the first derivative of the relationship between saturated vapor pressure and temperature hpa k 1 ρa the density of air kg m 3 cp the heat capacity of air j kg 1 k 1 r a a and r a c are the above canopy and within canopy aerodynamic resistances respectively s m 1 vpd the difference of saturated and actual atmospheric water vapor pressure hpa γ the psychrometric constant hpa k 1 ρw the density of water kg m 3 λ the latent heat of vaporization of water j kg 1 and fwet is the fraction of foliage area covered by water calculated following deardorff 1978 11 f w e t s i s i m a x 2 3 details on the calculation of the aerodynamic resistances are given in the supplementary material s1 the energy used for interception evaporation is subtracted from ac to obtain at the energy available for transpiration 12 a t a c ρ w λ e i n t transpiration is estimated analogously including a canopy resistance term r s c 13 e t r a n s δ a e f v c ρ a c p r a v p d δ γ r s c r a ρ w λ 1 f w e t the canopy resistance rs c is estimated using a jarvis type model jarvis 1976 14 r s c r s m i n l a i f v c f 1 r g f 2 t a f 3 v p d f 4 s s m where rsmin is the minimum stomatal resistance of individual leaves s m 1 the response function for rg is implemented after stewart 1988 15 f 1 1000 1000 j r r g j r r g where jr is a free parameter the response function for temperature is also taken from stewart 1988 16 f 2 t a t m i n t m a x t a a t o p t t m i n t m a x t o p t a where 17 a t m a x t o p t t o p t t m i n and the free parameters tmin topt and tmax are the minimum optimal and maximum temperatures for photosynthesis the response function for vpd has been implemented in various ways e g as a linear stewart 1988 or logarithmic function oren et al 1999 here the formulation of noilhan and planton 1989 was selected 18 f 3 1 1 j v p d v p d where jvpd a free parameter is the stomatal sensitivity to vpd similarly while different implementations for the soil moisture response function exist asce 1996 granier et al 1999 a piecewise linear function was chosen here 19 f 4 1 i f s s m t s f c j s m j s m s f c s s m t o t h e r w i s e where jsm a free parameter is the threshold soil moisture level at which stomatal closure starts for the estimation of potential transpiration f 3 and f 4 are always set to one for soil evaporation defining a surface resistance as was attempted by shuttleworth and wallace 1985 is more difficult indeed this resistance would depend on a large number of factors such as topsoil moisture hydraulic conductivity and the presence of ground vegetation or a litter layer an explicit representation of these factors would greatly increase model complexity and many of the required parameters are subject to high uncertainty therefore it is assumed instead that soil evaporation gets reduced exponentially as the soil dries brutsaert 2014 kelliher et al 1995 morillas et al 2013 soil evaporation is thus calculated following morillas et al 2013 20 e s δ a s 1 f v c ρ a c p r a s r a a v p d δ γ ρ w λ f p e f d r y i n g where r a s is below canopy aerodynamic resistance see s1 fpe is a function of precipitation and soil evaporation in the last 16 days and fdrying is a function of the number of days since the last rainy day defined here as a day with peff 5 mm d 1 the function of antecedent precipitation and evaporation is defined as 21 f p e m i n i d 15 d p e f f i i d 15 d e p o t s o i l i 1 where d is the current day peff i is the sum of effective precipitation on a day i and epot soil i the sum of potential soil evaporation i e eq 20 with fpe and fdrying set to unity the function of soil drying is defined as 22 f d r y i n g e x p d d r y k a p p a where d d r y is the number of consecutive dry days and the e folding time kappa is a free parameter the above model description applies to snow free conditions a detailed assessment of snowpack dynamics is outside the scope of this study however as snowmelt represents an important component of annual water balance in many regions of switzerland speich et al 2015 a parsimonious snow routine was implemented based on the hydrological model hbv bergström 1992 the snow routine is described in the supplementary material s1 if snow is present all evaporative fluxes are set to zero snow sublimation is implicitly accounted for in the snow routine 2 2 sensitivity analysis the sensitivity analysis consisted of two steps first a screening identified unimportant parameters from an initial set of 19 parameters for the parameters that were identified as important a sensitivity analysis based on meta modeling was conducted 2 2 1 variable selection and definition of input space the parameters included in this sensitivity analysis describe three different model aspects the structure of the canopy the stomatal control of transpiration and the soil properties model parameters were retained if they relate to at least one of these three aspects and if it was possible to define a meaningful range based on reported observations and commonly used parameter values table 1 shows the 19 parameters with their minima and maxima the reasons for setting these parameter ranges are discussed in the supplementary material s1 2 2 2 the elementary effects method for the screening analysis the elementary effects method of morris 1991 was used with the improvements suggested by campolongo et al 2007 and sin and gernaey 2009 the input space is defined as follows for m factors x 1 x m the range for each factor is divided into p equidistant levels a trajectory in this input space consists of m 1 sets of parameter values where the value of each parameter gets increased or decreased once by a given fraction δ i of the parameter range in a random order the model is run with each of these parameter sets generating m 1 outputs y x 1 x m for each parameter x i the elementary effect ee is the difference in modeled y between the run where x i has been altered and the previous run divided by the change δ i of the parameter value 23 e e i y x 1 x i δ i x m y x 1 x m δ i as the different parameters as well as the output variables are not commensurate with each other scores based on elementary effects obtained with eq 23 cannot be directly compared therefore following sin and gernaey 2009 the e e i were multiplied with the ratio of the standard deviations of the model outputs σ x i and of the parameters σ y to obtain the scaled elementary effects s e e i 24 s e e i y x 1 x i δ i x m y x 1 x m δ i σ x i σ y in a screening experiment r trajectories are generated each with a different starting point and a different order of parameter change as a sensitivity index describing the importance of each parameter the mean of absolute values μ i o f the r different s e e i values was chosen campolongo et al 2007 this index was calculated for each combination of parameters stations and output variables randomly selecting the starting points of trajectories and the order of parameter changes may lead to a non optimal sampling of the input space therefore the so called quasi optimized trajectories sampling strategy of ge and menendez 2014 a computationally less expensive adaptation of the strategy proposed by campolongo et al 2007 was used with this method r 20 trajectories were generated details are given in the supplementary material s1 2 2 3 meta model based sensitivity analysis for the second part of the sensitivity analysis another set of model runs was generated where only the values of the eight retained parameters were varied the eleven other parameters were assigned a fixed value as declared in table 1 for the output variables te and di a statistical meta model was fit to the set of model runs with the parameters as predictors and the output variable as dependent variable the statistical meta model is a multiple regression model of the form 25 y ˆ β 0 β 1 x s 1 β 10 x s 1 x s 2 ε where y ˆ is the output variable predicted by the meta model β 0 the intercept β i the slope of each term x s i the scaled i th predictor x s i x s j the interaction between the i th and j th predictors i e their product and ε is an error term accounting for the unexplained variance the predictors are scaled so that they are centered on the mean and expressed in units of standard deviations each meta model is fit to the entire set of model runs for all stations and includes station identity as a categorical predictor the meta models include up to two way interactions between parameters and three way interactions between two parameters and the factor station where a visual examination of the residuals distribution across the range of one parameter suggested a non linear relationship an orthogonal quadratic term was added for that parameter and kept only if it decreased the akaike information criterion aic akaike 1998 to limit complexity no higher order polynomials were introduced and interactions were kept only if they decreased aic the sampling method is latin hypercube sampling lhs mckay et al 2000 a stratified monte carlo sampling scheme a set of 800 parameter combinations was generated and used to run the model at each of the ten locations details are given in the supplementary material s1 parameter sensitivity is evaluated graphically using effects plots to represent meta model predictions these plots show the linear or curvilinear relationship between one predictor and the output variable while all other predictors are set to an arbitrarily fixed value fox 2003 here the fixed value is the middle of the parameter range each curve corresponds to the parameter effect at one station in addition a new set of 800 parameter combinations was generated for each plot where all parameters are varied except the one whose effect is being evaluated this allows a representation of the possible range of meta model outputs when all parameters are varied within their plausible range to assess the ability of the meta model to emulate the original model and whether the number of parameter combinations is large enough confidence intervals were calculated using a bootstrapping procedure a sample of model runs was drawn with replacement and the meta model coefficients estimated from that sample this procedure was repeated 2000 times for each meta model the confidence interval is given by the 2 5 and 97 5 percentiles of the bootstrapped meta model predictions at each discrete interval of the x axis 2 3 data in this experiment the model was driven with meteorological data see section 2 1 from ten stations of the automatic stations network swissmetnet of the swiss meteorological office the simulation period is 1982 2009 the selected stations are listed in table 2 and their location is shown on fig 2 all stations belong to the köppen geiger köppen 2011 classes cfb warm temperate humid warm summer or dfc cold humid cool summer table 2 also shows the two climatic parameters of the budyko 1974 framework mean annual precipitation map and potential evapotranspiration pet as well as their ratio pet is a measure of atmospheric water demand independently of surface cover and was computed here following priestley and taylor 1972 in the budyko framework climates where long term pet exceeds precipitation are considered water limited and climates where precipitation exceeds pet are considered energy limited most of the selected sites fall into the latter category except sion and basel where pet exceeds precipitation and montana where annual water supply and demand are equal the stations were chosen so that the whole range of hydro climatic conditions in potentially forested regions in switzerland temperate to sub alpine regions is represented fig 3 shows a series of climatic indicators for the period 1982 2009 at each station with the stations sorted by elevation the mean growing season temperature defined arbitrarily as may through october is shown in fig 3 a as an indicator of evaporative demand the growing season precipitation sum shown on fig 3 b varies greatly between the stations it is also informative to consider the precipitation sum outside the growing season november april shown on fig 3 c as an indicator of soil moisture recharge between two growing seasons the three remaining climate indicators describe the temporal patterns of water supply with the frequency of rainy days the average depth of precipitation on a rainy day and the length of the longest rain free period shown in fig 3 d e and f respectively the differences between the stations are further discussed in the supplementary material s1 to summarize the selected stations cover a wide range of precipitation regimes across a strong temperature gradient 3 results 3 1 screening analysis fig 4 shows the μ scores mean absolute elementary effects for all output variables the parameters where μ reached a threshold arbitrarily defined as 0 2 for any of the five outputs were retained for further analysis an exception was made for the temperature response parameters of the stomatal resistance submodel the threshold was reached by both tmin and topt however as these two parameters jointly control the shape of the same curve only tpot was retained in total eight parameters were kept for further analysis lai gsl rsmin jvpd topt sfc beta and kappa the other variables were set to fixed values as shown in table 1 3 2 meta model based sensitivity analysis 3 2 1 ranges of absolute values and station effect fig 5 shows the ranges of the five output variables simulated by forhytm at each station with the 800 parameter combinations the medians of pt are all between 400 and 600 mm year 1 with an interquartile range iqr of 200 300 mm year 1 and a spread of up to 800 mm year 1 for at the medians range between 200 and 400 mm year 1 with an iqr of about 100 mm year 1 at each station the overall spread is up to 600 mm year 1 although pt and at are rather similar across stations the medians for di vary between 0 2 and 0 4 and up to 0 65 at sion for te the medians range between 450 and 650 mm year 1 the spread at each station is less than for at with the iqr not exceeding 100 mm year 1 and the range not exceeding 450 mm year 1 finally wy shows large and significant differences between stations with medians between 150 sion and 1100 mm year 1 magadino in fig 6 a to c pt at te and wy are scaled with mean annual precipitation sion is the only station where pt can exceed precipitation whereas it represents between 10 and 90 of precipitation at the other stations medians between 30 and 50 the at p ratio varies less across stations with medians between 20 and 40 and maxima between 40 and 60 at most stations total evaporation represents between 40 and 60 of precipitation exceptions are magadino with a median around 35 and basel and sion with medians of 70 75 fig 6 d and e shows the normalized te in relation to the budyko curve eq 1 all stations are close to the curve but the medians of t e p are consistently below at ulrichen and montana the whole range of modeled t e p is below the budyko curve 3 2 2 meta model fitting the meta models are all able to explain almost all of the variance of the model outputs adjusted r2 0 99 for all outputs including quadratic terms for some parameters decreased aic the parameters with quadratic terms are lai topt sfc and beta for di as well as kappa for te also most of the two way interactions contributed to decrease aic and were thus kept in the meta models figure s2 1 shows the interactions included in the meta models of di and te the rest of the discussion focuses on these two output variables since the meta models are complex and contain many interactions and orthogonal quadratic terms the regression coefficients are not well suited as sensitivity indices instead the evaluation of the meta models is done graphically using effects plots see section 2 2 3 for di which unlike the other outputs is on the standard unit interval a natural logarithm transformation of the dependent variable was considered however the resulting meta model showed a greater deviation from normality and heteroskedasticity of the residuals so that no transformation was applied in the final meta model the bootstrap confidence intervals are very narrow with a maximum interval size of 8 9 mm year 1 for te and of 0 01 for di not shown indicating that the meta models are able to emulate the dynamic model 3 2 3 parameter effect the maximum effect of each parameter on total evaporation te and drought index di i e the change in output due to changes in parameter values across their plausible range is shown in table 3 the range in each column refers to the stations where the effect of each parameter is lowest and highest table 3 also includes the effect of station i e climate which is the most important factor controlling both te and di for both output variables sfc is the most important parameter the effect of canopy properties on te varies greatly across stations with almost no effect at some stations to over 100 mm year 1 for lai and rsmin for di the most important parameters next to sfc are jvpd and beta the four most important parameter effects on total evaporation are shown on fig 7 for three contrasting stations sion dry inner alpine p e t p 1 91 davos cold subalpine p e t p 0 84 and magadino warm and humid p e t p 0 57 the lines show the meta model predictions with all other parameters set to the center of their range and the intervals represent the 2 5 and 97 5 percentile of a set of 800 additional meta model predictions where all parameters vary except the one on the x axis as te and wy are complementary fractions of precipitation over climatological time scales the effect of a parameter on wy is of equal size and opposite sign as the effect on te here the effects on te are presented because the inter station variability is much smaller for te than for wy so that the curves for te are easier to visualize and interpret sfc is the most important parameter especially at sion where the interval is very narrow and the relationship quasi linear at the two other stations the curves saturate around 150 mm apart from sfc te at sion is only influenced noticeably by beta not shown and the curve is nearly flat for all other parameters on the other hand the stomatal parameters rsmin and jvpd play a greater role at the two other stations fig 8 shows the effect of lai sfc beta and jvpd on di at sion dry inner alpine p e t p 1 91 basel temperate lowland p e t p 1 14 and davos cold subalpine p e t p 0 84 in all cases the spacing of the curves on the y axis shows that di is strongly controlled by climate di may take values from 0 1 to 0 4 at davos 0 15 to 0 6 at basel and 0 35 to 0 8 at sion the variation within these ranges is due to varying parameter values also here sfc has the strongest effect i e the steepest curves and the narrowest intervals at davos the curve flattens off at 150 mm indicating that any increase in sfc beyond that value has little effect on di by contrast there is almost no saturation effect at the two drier stations the effect of lai is different at each station with a convex and rather flat curve at davos an almost linear positive relationship at basel and a concave curve at sion with a much wider interval at low lai the effect of beta is similar at all three stations with a decrease of di in the range of 1 4 and a flattening of the curves at 4 the slope for jvpd is much steeper at davos than at the two drier sites 3 2 4 parameter interactions the effect plots do not show many important parameter interactions as an exception the effect of canopy properties such as lai and stomatal parameters increases when soil moisture is less limiting i e at more humid stations and at higher values of sfc fig 9 shows the effect of lai and rsmin on te for all stations with a low intermediate and high value of sfc both lai and rsmin have a greater effect at more humid stations and their effect increases with increasing sfc for example an increase in lai from 1 to 4 at magadino or davos increases te by about 100 mm year 1 at low sfc this value goes up to 130 mm year mm 1 at high sfc a greater increase occurs at other stations where the effect of lai is less important such as pully with corresponding values of 40 and 90 mm year 1 similarly the effect of rsmin increases from 100 to 130 mm year 1 at davos and from about 40 to 80 mm year 1 at ulrichen fig 10 shows the effect of lai and jvpd on di again at three levels of sfc with increasing sfc the effect of lai becomes more important at sion on the other hand at the other stations the slopes get flatter at the drier stations the effect of jvpd is almost zero regardless of sfc on the other hand at more humid stations the slopes for jvpd are much steeper at high sfc 3 2 5 plausibility of model results as forhytm combines widely applied process formulations no validation was undertaken here also the results are not necessarily realistic predictions but rather show the range that can be obtained by varying uncertain parameter values nevertheless to interpret the effect of parameters it is important to assess the plausibility of outputs in another study forhytm was applied at 14 eddy covariance measurement sites speich et al in preparation at the nine sites with climatic and edaphic conditions similar to the sites shown here the model performed well with a kling gupta efficiency gupta et al 2009 ranging from 0 66 to 0 87 for half hourly te and from 0 51 to 0 77 for soil moisture dynamics a comparison of the forhytm outputs of the present study with public datasets of modeled mean annual te and runoff is given in s2 2 actual transpiration may be estimated from upscaled sap flow measurements for example leuzinger and körner 2010 estimated long term canopy transpiration and total evaporation based on sap flow measurements at a broadleaf forest stand near basel with a lai of 5 and a root zone storage capacity of 80 mm they obtained values of 221 and 597 mm year 1 for at and te respectively for these settings the corresponding meta models in this study predict about 280 and 580 mm year 1 respectively in another study wieser et al 2014 measured sap flow of pinus sylvestris in a dry inner alpine valley in austria with a climate similar to sion annual at was 74 and 88 mm in 2011 and 2012 respectively with a very low lai 0 55 extrapolation of the effects curves for the meta model at sion yields values between 70 and 100 mm while they do not constitute a thorough validation these comparisons suggest that the toy model simulates the processes well enough for the purposes of this study 4 discussion 4 1 screening of unimportant parameters the screening revealed that some parameters have very little effect on the outputs therefore common values from the literature may be used for these parameters with little contribution to model error also the low scores of ff suggest that variations of fvc within a plausible range for a given lai have little impact on the outputs another unimportant parameter is the canopy height zv however this parameter only affects aerodynamic resistance in our model and has no influence on stomatal resistance even though such a link has been described see also section 4 2 4 2 parameter effects the parameters with the largest effects on te are sfc lai and rsmin this is in accordance with the three vegetation properties identified by donohue et al 2007 as having the greatest influence on hydrology leaf area photosynthetic rate and rooting depth their relative importance varies between sites as sfc is more important at drier sites and canopy characteristics at more humid sites at the stations compared here a shift from a shallow to a deep soil with a fully developed rooting system increases annual te by 50 200 mm year 1 this is in line with the sensitivity of te to available water capacity reported by federer et al 2003 the significance of this change for water yield depends on climate annual wy is between 1000 and 1200 mm year 1 at magadino and between 100 and 200 mm year 1 at sion thus the same change in sfc may double annual wy at sion and show little relative effect at magadino the effect of gsl gives an indication of the expected difference between deciduous and evergreen trees especially at a cold site like davos where the leafed season is shortest if all other parameters are equal te is higher for evergreens by about 50 mm year 1 the stomatal parameters rsmin and to a lesser extent jvpd both reduce te low stomatal resistance is often associated with a high sensitivity to vpd oren et al 1999 so that on an annual or longer time scale their effects often counteract each other contributing to the relatively low variability in forest te roberts 2007 overall it appears that rsmin is more important for water balance estimations whereas jvpd is more important for modeling physiological drought di is also mainly determined by climate but the effect of parameters goes up to 0 3 considering that most of the forested area of switzerland typically exhibits long term di values between 0 and 0 3 zierl 2001 this shows the importance of surface properties on physiological drought again sfc is the most important parameter also at humid stations the varying effect of jvpd suggests that dry air accounts for a larger part of the drought stress experienced by trees at more humid sites whereas soil drought dominates at drier locations this is in line with the findings of zweifel et al 2005 who examined the physiological response of trees to soil drying and vpd close to sion and davos and found that the effect of dry soil dominated in the first case and the effect of vpd in the second at most stations a higher lai leads to greater drought index values this is consistent with the idea of a negative feedback between vegetation density and physiological drought kergoat 1998 and with the higher drought stress effects observed giuggiola et al 2013 or modeled de cáceres et al 2015 in denser stands however at the more humid stations the effect is negligible or even negative fig 10 this is due to the different relative influence of soil and atmospheric drought at different stations indeed the effect of high vpd on stomatal opening is purely instantaneous and when soil moisture is not limiting negative by contrast stomatal closure due to dry soil mitigates the immediate effect on transpiration over a longer period a multiplicative increase in canopy resistance eq 13 causes a greater proportional reduction of transpiration eq 14 at lower than at higher lai where soil moisture is not limiting and drought is dominated by vpd this counteracts the positive relationship between lai and di leading to a flattening of the curve this might be a drawback of using a jarvis type canopy resistance formulation in combination with the drought index used here indeed there are no physiological reasons to assume that a higher leaf area would decrease drought stress especially since the model does not consider aerodynamic coupling however this effect occurs primarily at the more humid locations i e where drought plays a minor role in ecological processes the rather strong effect of topt is surprising an examination of the effects plots not shown reveals that this effect occurs mostly at warm sites where the model reacts strongly to low topt as plant response to temperature results from adaptation to local climate körner 2012 trees with low photosynthetic optima are unlikely to occur outside cold environments the strong topt effect therefore occurs in a part of the parameter space that is of little relevance for process understanding and model development 4 3 implications for model development this study revealed a high sensitivity of te to lai and sfc as noted above this is consistent with empirical observations therefore special care should be given to the parameterization of these vegetation properties for hydrological modeling this also confirms previous assessments that temporal variations in vegetation cover must be taken into account in modeling studies gallart and llorens 2003 this refers to intra annual changes due to phenology see e g section 1 5 in s1 as well as inter annual variations due to changes in allometry stand density or vegetation composition promising results have been obtained with assimilation of remotely sensed lai chakroun et al 2014 or of vegetation model outputs schattan et al 2013 sfc is much more difficult to measure and generalize for example walthert et al 2015 used geostatistical methods to generate maps of soil properties for swiss forests based on 2071 forest soil profiles however they did not obtain any satisfactory results for soil thickness and stone content two crucial parameters for the estimation of sfc many authors have reported adaptations of vegetation characteristics to climate including sfc and lai eagleson 1982 gentine et al 2012 o grady et al 2011 this has inspired various approaches for a dynamic parameterization of sfc e g nijzink et al 2016 gentine et al 2012 postulate that due to these adaptations of vegetation properties long term water partitioning is controlled by climate only as described by budyko 1974 however there are many possible reasons why vegetation properties at a particular site may depart from equilibrium such as succession dynamics a lagged response to climate change natural and anthropogenic disturbances or non climatic stressors such as nutrient limitation or pollution variations in lai parameterization may be due to different definitions for this variable for example some lai measurements do not account for foliage clumping chen et al 2016 found that ignoring the effects of clumping caused a significant underestimation of annual te in forests lai not corrected for clumping is usually smaller than actual lai by a factor of about 0 5 0 8 iio et al 2014 the shape of the effect curves indicates that this may be especially important at lower lai with an effect of up to 50 mm year 1 on the water balance the importance of rsmin suggests that it might be necessary to consider differences due to species identity stand age or height or possible effects of increased c o 2 concentration on stomatal resistance however due to the high variability of stomatal resistance measurements even between trees of the same species e g breuer et al 2003 parameterization may be challenging information for such a parameterization may be obtained from studies relating transpiration measurements to environmental variables and tree characteristics ford et al 2011 or species identity leuzinger et al 2005 as well as from theory and observations in tree hydraulics ewers et al 2005 this experiment shows that di is determined to a large extent by climate but may be substantially modified by vegetation and soil properties thus coupled modeling of hydrology and vegetation dynamics is necessary to explore the long term development of lai and sfc with time and a changing climate stomatal properties especially jvpd are also important but as discussed above may be difficult to parameterize to account for differential drought sensitivity of species without explicitly parameterizing jvpd lischke and zierl 2002 calculated long term di with a vpd response function independent of species and overlaid the results with a species distribution map from this they derived a species specific drought sensitivity corresponding to the highest di tolerated by this species this parameter reflects not only stomatal sensitivity to drought but also other characteristics such as water use efficiency under water stress or the ability to compete for water the soil hydrological parameter beta which has a substantial effect on di is not an observable quantity and has been assigned different interpretations bergström and graham 1998 use it to reflect spatial heterogeneity of infiltration rather than soil properties whereas van den roovaart et al 2014 use it as a measure of soil absorption capacity in distributed models beta is parameterized as a function of soil type uhlenbrook 1999 land cover johst 2003 or the combined effects of soil depth and elevation merz 2002 the large effect of beta shows the importance of soil infiltration and absorption characteristics for root zone water availability the important contribution of vpd to physiological drought at some stations shows that the physiological effects of high vpd see e g novick et al 2016 should not be neglected to our knowledge only few models explicitly include water stress due to high vpd seidl et al 2012 zierl 2001 while other models include this effect implicitly seely et al 2015 wellpott et al 2005 or only use soil moisture to differentiate between pt and at while incorporating the vpd effect into di is physiologically meaningful further research is needed to determine whether this is a realistic representation of the effects of drought on tree growth more generally adequately representing the various physiological impacts of water shortage on trees is the subject of ongoing research de cáceres et al 2015 for such questions comparing modeled indices with physiological indicators such as growth patterns in tree rings bhuyan et al 2017 crown condition zierl 2004 or tree height walthert et al 2015 is a promising approach 4 4 links to the budyko framework while this study used a dynamic model with a sub daily timestep outputs were evaluated at the climatological time scale which enables a comparison with the budyko framework although the range of a i p e t p of the stations used here is relatively narrow compared to other studies donohue et al 2012 zhang et al 2004 it still covers the range containing the majority of the forested catchments of zhang et al 2004 as shown in fig 6 d and e the long term te estimates were near the budyko curve for all sites but systematically below this is consistent with williams et al 2012 who found that forests had a lower evaporative fraction than grasslands for the high elevation stations montana ulrichen and davos this may be partly explained by the fact that snow sublimation is not counted in te in the model however at the lowland sites snow sublimation hardly plays a role in the water balance williams et al 2012 explained their findings with the conservative water use strategy of forests in comparison to grasses teuling et al 2010 grasses generally have lower stomatal resistance breuer et al 2003 and lower stomatal sensitivities than trees teuling et al 2010 in this study the effect of rsmin on te is nonlinear with a steeper slope at the lower end of the parameter range this part of the rsmin range overlaps with values typical for grasses breuer et al 2003 guan and wilson 2009 therefore parameterizing canopy resistance to reflect the behavior of grasses would greatly increase the evaporative fraction however a shift to grasslands would also result in a lower canopy height which increases aerodynamic resistance jarvis and mcnaughton 1986 some of the stations have similar a i despite differences in the absolute values of p e t and p for example davos and pully have a i of 0 84 and 0 88 respectively whereas p e t and p differ by 146 and 118 mm year 1 respectively in accordance with the budyko curve the evaporation fraction is slightly higher at pully at the humid end of the a i range are the stations magadino and glarus with a i of 0 57 and 0 58 respectively and differences in p e t and p of 175 and 344 and mm year 1 respectively however the evaporative fraction differs significantly between the two stations with higher t e p at glarus fig 6 c likewise there are large differences in the drought index values with greater values at magadino fig 5 c this may be explained by the different precipitation regimes precipitation at magadino is distributed between fewer events but with a greater mean intensity fig 3 d and e therefore even a deep soil might not be able to retain all incoming precipitation of a given event which increases runoff and decreases transpiration also a smaller fraction of precipitation is lost to interception which also decreases t e this highlights the importance of the temporal distribution of precipitation for long term water partitioning donohue et al 2012 this study has shown a differential effect of surface properties on water partitioning under different climates this might explain the difficulty of relating deviations from the budyko curve to specific surface properties for example studies that use a budyko type equation with an adjustable parameter have stratified observations into broad categories such as forested and grass dominated catchments zhang et al 2004 or catchments belonging to the same basin yang et al 2009 to calibrate this parameter the results of this study suggest that a potentially interesting strategy would be to divide observations into groups with similar climates but different surface characteristics to explore the relationships between climate soil and vegetation properties and water partitioning while some of the parameters identified as important are difficult to estimate such as the stomatal properties such a study might make use of publicly available datasets of lai soil properties and vegetation type 4 5 limitations of this study and outlook the geographical focus of the present study is switzerland although there are important differences between the stations considered here they represent only a small subset of the different climates of the world with our setup it is possible to repeat the analysis conducted here with input from other climates synthetic weather data obtained from a weather generator e g ivanov et al 2007 or grid cell level outputs of climate models however such analyses go beyond the scope of this study also this study has focused on long term output quantities while these are useful descriptors of a site s hydrology and ecohydrology other outputs are also relevant such as the temporal distribution of discharge or a seasonal drought index e g zierl 2004 for such outputs the sensitivity to the different parameters might not be the same as for long term values another limitation of this study is that the meteorological input is treated as an independent variable neglecting the effects of land surface properties on climate e g van der ent et al 2014 these effects are generally relevant at spatial scales larger than individual forest stands and small catchments ellison et al 2012 therefore the effects of vegetation and soil parameters discussed here only apply if the area under consideration is small enough or shielded enough so that local climate is not affected by changes in forest properties in other locations e g large scale afforestation or deforestation in forhytm plant available soil moisture is represented as a single storage this approach has been criticized as it neglects important aspects of soil water flow e g milly 1994 however simulation experiments have shown that with adequate parameterization such simple models perform relatively well compared to models with multiple soil layers federer et al 2003 another limitation related to the soil representation is that the model does not include a groundwater storage limiting its applicability to regions where groundwater substantially contributes to tree transpiration e g schilling et al 2014 5 conclusions this study examined how vegetation and soil parameters affect long term total evaporation te and a physiological drought index di in a water balance model applied to various locations in switzerland with contrasting climates while climate is a primary determinant for both output variables the spread of results obtained by varying surface parameters within their plausible ranges is quite large for a given climate variations in surface parameters within their plausible range may affect mean annual total evaporation by several hundreds of mm year 1 it was hypothesized h1 that the most important parameters would be leaf area index lai minimum stomatal resistance rsmin and soil water storage capacity sfc for water balance this hypothesis was confirmed for physiological drought rsmin was less important whereas stomatal sensitivity to dry air jvpd and a parameter controlling partitioning of incoming water between storage and runoff beta had a larger effect the second hypothesis h2 was that the main control on te and di would be exerted by climate and that the influence of vegetation parameters would vary with climate with a greater importance of lai and rsmin under more humid climates and of sfc under drier conditions the insensitivity of te to lai and stomatal characteristics at the dry site sion supports this hypothesis as does the saturation of the sfc te curves at the energy limited sites fig 7 however below the saturation threshold sfc also has a considerable effect on te at the most humid sites also for di this hypothesis could only be partially confirmed as for te sfc is important at all sites but there is a saturation effect at the more humid sites in accordance with h2 the importance of stomatal factors was greater under more humid conditions however the influence of lai is low to non existent at humid sites and greatest at the driest sites in conjunction with high sfc furthermore this study revealed that many of the parameters commonly used in water balance models have little effect on long term hydrology and ecohydrology and may be safely set to fixed values these findings highlight the necessity of coupling hydrological and vegetation models for future predictions of water resources and forest growth indeed two of the most important surface parameters for hydrology lai and sfc vary across climatological time scales and should therefore be treated as state variables in a coupled model also if enough data are available parameterizing minimum stomatal resistance as a function of species identity and or canopy height may improve long term forecasts of evaporation and water yield regarding drought modeling this study underlines the importance of considering the physiological effects of vapor pressure deficit on plant drought stress in addition to the effects of dry soil acknowledgements this research was funded by the swiss national science foundation no 153544 meteorological data was provided by the swiss federal office of meteorology and climatology meteoswiss we thank luzi bernhard wsl for providing the sample dataset included in the publicly available software package the authors would like to thank pius korner oikostat gmbh for assistance with the statistical analyses and james kirchner eth zurich for providing constructive comments finally we would like to thank the three anonymous reviewers whose comments greatly contributed to improve this article appendix a supplementary data the following are the supplementary data related to this article supplementary1 supplementary1 supplementary2 supplementary2 supplementary3 supplementary3 supplementary4 supplementary4 appendix a supplementary data supplementary data related to this article can be found at https doi org 10 1016 j envsoft 2018 01 016 
26426,hydroshare https www hydroshare org is an online collaborative system to support the open sharing of hydrologic data analytical tools and computer models hydrologic data and models are often large extending to multi gigabyte or terabyte scale and as a result the scalability of centralized data management poses challenges for a system such as hydroshare a distributed data management framework that enables distributed physical data storage and management in multiple locations thus becomes a necessity we use the irods integrated rule oriented data system data grid middleware as the distributed data storage and management back end in hydroshare irods provides a unified virtual file system for distributed physical storages in multiple locations and enables data federation across geographically dispersed institutions around the world in this paper we describe the irods based distributed data management approaches implemented in hydroshare to provide a practical demonstration of a production system for supporting big data in the environmental sciences keywords distributed data management big data data sharing hydrologic information systems collaborative environment irods 1 introduction to enable more rapid scientific advances and discovery it is critical to enable reproducible science and facilitate the ability for scientists to share their work and build on the work of others effective data discovery and reuse requires a comprehensive cyberinfrastructure that enables diverse data with different types to be annotated discovered accessed visualized analyzed published and serves as a platform for collaboration hydroshare http www hydroshare org is one example of that cyberinfrastructure it is a web based collaboration system for cataloging and sharing hydrologic data models and tools to enable more rapid advances in hydrologic understanding via collaborative data sharing analysis and modeling using hydroshare scientists can easily discover access share and collaboratively analyze hydrologic data and models and hence accelerate hydrologic scientific discovery development of hydroshare was funded by the u s national science foundation nsf through its software infrastructure for sustained innovation program awards 1148453 and 1148090 2012 2017 the consortium of universities for the advancement of hydrologic sciences inc cuahsi has assumed responsibility for operation of hydroshare as one of its water data services and a new nsf collaborative award 1664061 1664018 1664119 2017 2021 will further advance the modeling collaboration storage and extensibility capabilities of hydroshare this paper reports on the hydroshare distributed data storage and management system developed using an open source data grid middleware called irods integrated rule oriented data system moore 2008 russell et al 2016 hydroshare is constructed from several coupled components including a django front end written in the programming language python that serves as a user interface an irods distributed file system back end that stores files and data a solr search engine http lucene apache org solr that enables data discovery and a variety of application servers that access irods and solr via a representative state transfer rest application programming interface api this loose coupling of application servers allows extensibility as needs of hydrologic science evolve over time refer to section 2 and fig 1 for a more detailed description of these coupled components in hydroshare hydrologic data and models can be large often at multi gigabyte or terabyte scales to cope with large data sets we use the irods data grid middleware as the distributed network data storage and management back end in hydroshare irods provides a unified virtual file system for physical storage distributed across multiple locations and enables data federation across geographically dispersed institutions around the world using irods enables hydroshare to work with large files efficiently by leveraging irods parallel file transfer capability and addresses big data management challenges including system expansion ability to deliver data to analysis applications efficiently efficient data packaging and off site data replication for disaster recovery irods provides a distributed virtual framework for managing physical storages across multiple locations and enables storage federation across geographically dispersed institutions around the world it is not a prepackaged solution but rather a middleware with pluggable architecture that supports developer customizable policies at every point of the data management life cycle russell et al 2016 so that users are not limited by a pre defined set of features the flexibility and extensibility enabled by this pluggable architecture in irods allows us to move time consuming data operations to irods and to customize hydroshare quota management policies in irods in addition the storage federation capability in irods allows us to create a federated data storage system in hydroshare so that partner institutions can share the burden of storing large data sets in the following sections we first provide background for our work then describe how irods is used in hydroshare for managing big data in hydrological and environmental sciences in addition we discuss the strengths and weaknesses of our data management approach in the context of hydroshare this is followed by discussion of the approach use cases and future work finally we summarize our contributions and conclude the paper 2 background an overview of the functionality envisioned for hydroshare was given in tarboton et al 2014 and the initial software architecture for hydroshare was described in heard et al 2014 idaszak et al 2016 provided a case study of the application of modern software engineering to hydroshare horsburgh et al 2015 described the data model and content packaging scheme for diverse hydrologic datasets and models used by hydroshare to enable storage management sharing publication and annotation of the diverse types of data and models used by hydrologic scientists these diverse types of data and models are packaged into a resource bag using the bagit file packaging format boyko et al 2012 for storing resources on disk and for serializing them to zipped files for transfer we refer to this resource packaging operation as resource bagging hereafter for easier reference a resource is the granular unit used for data management and access control within hydroshare physically a resource is a directory in a file system that adheres to the structure of the bagit format hydroshare uses a resource centric approach in which resources are objects that can be created stored modified versioned shared annotated discovered accessed published and acted upon by web apps independent of hydroshare as shown in fig 1 hydroshare s functionality and architecture can be organized into three categories 1 irods based distributed resource storage and management 2 resource exploration and 3 actions on resources each is implemented using system components that interact through apis the loose coupling between hydroshare and web apps enables extensibility in that anyone can develop a web app that interacts with resources stored in hydroshare an example of a web app for visualizing spatial data in hydroshare is described in crawley et al 2017 2 1 related work vitolo et al 2015 recently gave an overview of using web based technologies for processing big data in the context of environmental sciences and highlighted the fact that using web and cloud based technologies for big data analysis is increasingly acknowledged in the environmental community there has been increased development and availability of data repositories and archival systems for the last several years including figshare hane 2013 the nsf oci 0940841 supported datanet federation consortium http datafed org dataone cao et al 2016 sead myers et al 2015 and cyverse merchant et al 2016 oliver et al 2013 these systems all have a similar basic structure a data store the ability to publish data for public consumption and ability to specify metadata for published data so that it can be discovered by other researchers involved in similar tasks hydroshare enables interoperability with other digital repositories via a standards based approach to data storage and metadata hydroshare s data model an adaptation of the open archive initiative s object reuse and exchange oai ore standard lagoze et al 2008 metadata structure dublin core with extensions dcmi 2012 and packaging scheme the bagit hierarchical file packaging format all use well known standards within the digital preservation and archival community hydroshare s structured and comprehensive resource types and metadata descriptions not only facilitate better interpretation by users but also enable users to write independent applications designed to operate on this structured content unlike many other data publication systems hydroshare enforces a strict compliance to metadata standards at all times and strict synchronization between metadata and the presence of specific resource files the reason for this requirement is that hydroshare allows authorized users to treat the resource as if published at any time and download use and then re upload the resource as part of the data life cycle even before the resource is formally published by contrast many publication systems prohibit download until metadata is synchronized with object contents that mode of operation would interfere with a core goal of hydroshare to allow resource sharing before or even without formal publication hydroshare can also interoperate with other data repositories via its irods based distributed data storage and management system irods is used by large scientific research projects across the country and around the globe for managing petabytes of data in hundreds of millions of files on distributed storage resources for example hedges et al 2009 presented a rule based data grid approach using irods for automatic data curation and preservation schnase et al 2011 presented their irods based approach for combining disparate data collections into a federated platform for implementing various data services in nasa center for climate simulation sukhija and datta 2013 presented a community grid web portal for storing managing and sharing large amounts of community health data in a data grid managed by irods using irods as the distributed data management back end in hydroshare enables hydroshare to inter operate with other data repositories e g cyverse at the data layer via irods in the following sections we describe the irods based distributed data storage and management architecture and approach in hydroshare and discuss strengths and weaknesses of the approach in the context of hydroshare to provide reference for other similar systems some use cases enabled by the irods based approach are also discussed 3 irods based big data management in hydroshare hydroshare was implemented using the django web framework with irods as back end storage for distributed data management in hydroshare a resource is stored in irods as a collection of data that is accessible as one unit physically a hydroshare resource is stored as a directory of files adhering to the bagit format specification the name of the directory a collection in irods terminology for a hydroshare resource is a randomly generated universally unique identifier uuid that is used to uniquely identify a resource in hydroshare fig 2 shows an example of a hydroshare resource stored in irods and conforming to bagit format a hydroshare resource differs from a regular directory of a computer file system in several ways the resource directory in hydroshare is tightly linked with a data catalog maintained in django which records both the structure of and the metadata for that directory hydroshare supports a number of resource types that constrain the contents of each hydroshare resource directory and metadata in a manner that makes the resulting hydroshare resource suitable for publication thus one must modify the files and metadata for a resource directory in concert additionally hydroshare allows a user to formally publish a resource as citable which has the effect of prohibiting all further changes and providing a digital object identifier doi suitable for data citation for this reason within an irods server files in hydroshare resources are not owned by a specific hydroshare irods user but by an independent single irods proxy user that the hydroshare software system controls in this manner the hydroshare system assures that the resource files and data catalog remain synchronized and immune from modification in irods outside of hydroshare the proxy user assures that resources cannot be changed outside the hydroshare environment if a resource was owned by a regular user in irods an irods client outside of hydroshare could be used and thus changes could not be prevented the decision to make hydroshare files owned by a dedicated irods proxy user gives rise to other practical issues including how user disk usage and quotas are managed hydroshare uses a hybrid approach that combines hydroshare custom software and native irods quota mechanisms for disk quota management as described in detail in section 3 3 one important difference between hydroshare and other data publication systems is that it also supports pre publication workflows involving many people and software applications the access control system allows users to share their data only with specific users form groups of users and share data with those groups both for the purpose of data use and collaborative data collection due to its inclusion of these dynamic and private pre publication datasets hydroshare uses more storage than a publication only system would use and supports all phases of the data creation and usage life cycle including but not limited to data publication thus another practical consideration in our design is that the project cannot afford to pay for storing all of the data that everyone might need to store irods provides a straightforward solution in its mechanism for federation which allows a set of geographically distributed disks to act like a single file storage device therefore independent users or their institutions can add storage to hydroshare federated storage where the collection of all available storage is managed as a single entity in hydroshare for the purpose of storing resources these basic building blocks irods the proxy user storage federation and a django based resource editor are the elements from which big data management is built the django based resource editor allows creation and manipulation of resources while the other components provide a storage medium that is scalable both in a technological and economic sense 3 1 working around http file transfer limits since uploading or downloading large multi gigabyte files through the http protocol from a web browser is problematic most web applications impose some limit on the size of the file to be uploaded or downloaded from a web browser in the hydroshare web interface we support direct upload or download of files from local disk up to 1 gb in size for files larger than 1 gb we leverage irods file transfer capability to transfer files of arbitrary size hünich and müller pfefferkorn 2010 gave a performance analysis of irods for managing large datasets with stress tests designed to test irods file transfer performance under the conditions of a large number of requests to transfer millions of files irods manages data objects and collections in independent administrative units called zones which are autonomous with their own security and users these zones can be federated to form a distributed data management system with customized access control protocol each irods zone contains an irods catalog enabled resource server which uses a relational database to organize the content of the zone and to maintain irods metadata files uploaded to the hydroshare django server or selected from an irods zone are efficiently transferred to the main hydroshare irods zone via an irods client called icommands for large files larger than 32 mb by default irods uses multiple threads to transfer data in parallel which provides irods with a significant speed advantage over standard file transfer protocols e g ftp 3 2 using irods federation in hydroshare we employ a distributed data management approach based on irods zone federation irods federation supports extensibility of the hydroshare storage and quota management system by providing partner organizations the option to store hydroshare resources on their own irods servers to increase storage capacity for their users beyond the finite capacity provided by hydroshare main storage to support such an extensible distributed data storage ecosystem in hydroshare for better managing future growth we are developing policies that describe how partner organizations can extend hydroshare main storage and are also in the final process of developing and testing a distributed storage quota management system this distributed storage quota management system will allow partner organizations to manage their own storage quota as needed once deployed in the near future the core of this federation based approach is to store hydroshare resources in different irods zones as independent administrative units these units can be located in geographically dispersed locations physically yet all these zones are logically federated with the main zone for centralized data management in hydroshare the three main advantages of this federation approach are security speed and physically distributed storage each zone is a separate data administrative unit that has its own irods server and catalog database which enables its own security boundary that is not exposed to other zones on the other hand all zones are federated via irods with authorization and access control that allows direct access to files across different zones via the irods proxy user in hydroshare in addition this distributed data storage and management approach allows us to execute resource bagging a time consuming operation especially for large resources on the server where the data resides boosting performance this was done by creating resource bagging code in irods to avoid having to move data to the django server fig 3 shows a schematic representation of the irods zone federation based distributed data management approach in hydroshare the main hydroshare irods zone and hydroshare irods user zone are federated internally and grouped as internal hydroshare federated zones on the file access level in the irods layer a proxy irods user owns all hydroshare resources in irods this prohibits users from making any changes to hydroshare resources except through the django user interface and rest api which act as the proxy irods user and enforces an ownership and access control model defined and managed in django couch et al 2015 federated irods servers are configured similarly but not identically to the main irods server for hydroshare each federated zone has its own dedicated local proxy irods user for the files it stores by default hydroshare stores new resources in the main hydroshare zone under the main proxy irods user however when a user asks hydroshare to create a resource from files stored in a federated irods zone the hydroshare resource will be created in the same federated irods zone and owned by this local proxy irods user which serves as the counterpart of the main proxy irods user in this local federated zone a partner s federated irods zone must be configured to allow hydroshare read and write access to its local proxy irods user account however the partner s local proxy irods user account is prohibited from accessing the main proxy irods user account thus the partner gives hydroshare the limited right to modify a local irods zone but does not gain the ability to directly modify the main hydroshare irods store changing a file in a hydroshare zone without permission and without interaction with the django application can corrupt the resource from the perspective of the hydroshare system this in turn would make future downloads of the resource invalid thus no irods users other than the proxy irods users are allowed to modify hydroshare resources directly a partner must agree not to modify its federated hydroshare zone except through the common hydroshare user interface and rest api that uses the main proxy irods user for file operations thus preserving data integrity of the hydroshare resources as aforementioned users can employ any irods zone as a data source to add files to hydroshare without being limited by file upload size from a web browser the irods zone may be an independent irods data store such as cyverse or a zone federated with the main hydroshare zone if users do not have an irods account in the hydroshare user zone they may go to their profile page in hydroshare and create an irods account in the hydroshare user zone for creating big data resources fig 4 shows a screen capture of assembled interface components in hydroshare for creating a resource using large files in the federated irods user zone hydroshare detects whether or not the selected files come from an irods zone federated with the main hydroshare zone automatically in a manner that is transparent to users and handles federated files differently as needed specifically if the selected files come from a federated irods zone e g the internal hydroshare user zone a move or copy option allows the hydroshare user to choose to have the selected files either moved or copied into the resource moving the files in the same irods zone is a logical and instant operation since the physical file on the same irods server is not moved but just registered logically to a different location in the irods catalog and thus the move option executes quickly on big data by contrast the copy operation copies the physical files efficiently via multiple threads on the same or a federated server which necessarily takes more time than the move option on big data the copy option applies to users who want to keep files in their personal irods user space for further use outside hydroshare 3 3 quota management the strong requirement for data integrity and synchronization between django and irods views of hydroshare resources requires the use of an irods proxy user that acts on behalf of django rather than being regular irods users thus quota management in hydroshare requires a hybrid approach involving both django and irods use of regular irods user files in personal irods user space in a federated irods zone is monitored via irods methods while ownership of hydroshare resources managed by the proxy user is determined by the django server django s concepts of resource ownership are communicated to irods by setting irods attribute value units avus which are key value metadata stored directly in irods and associated with any irods file folder user or storage resource specifically the django server records the quota user for each proxy owned hydroshare resource folder in its avus to communicate this ownership to irods thus much quota management can be done outside of hydroshare in irods using this extra metadata conversely irods sets different avus on the irods proxy user to communicate total quota usage for all hydroshare users back to django for quota notification and enforcement two quota related data models are managed on the hydroshare django front end server the user quota model records quota allocation and usage information for each hydroshare user the quota message model holds quota warning and enforcement messages and criteria variables which may be customized with different values as needed from the django administrative web console by a system administrator these quota warning and enforcement criteria variables include quota soft and hard limit percentages and grace period days that are all configurable from the administrative console table 1 shows actions taken in hydroshare under various conditions these actions apply to both internal and external federated zones in hydroshare when users exceed their quota they may no longer add more files to hydroshare until they reduce their quota usage below the allocated quota or have been granted increased quota allocation our hybrid approach allows distributed flexible and customizable quota management in hydroshare 3 3 1 encouraging data sharing via simplified quota policies the quota scheme in hydroshare differs from other quota schemes prevalent for cloud data sharing the dropbox policy of charging all users quotas for an object they share is noticeably absent in fact the designers of hydroshare felt that this dropbox policy discourages data sharing by instituting a penalty for users who receive the data instead in hydroshare the user that creates a resource is considered the responsible party and becomes the initial owner and quota holder for a resource other users may be designated as resource owners and an owner may transfer the holding of quota to another owner of the resource but at any time there is one responsible quota user for a resource this is independent of how many times and with how many users the resource is shared a resource shared with hundreds of users is still attributed to a single user for the purpose of quota management to understand the impact of this quota policy upon use of hydroshare one must understand the basis of the sharing model in hydroshare there are three levels of sharing view edit and owner a view user can see and copy a resource an edit user can make changes to data and or metadata and an owner can additionally make a resource public or publish it the quota management system attributes the quota to one owner even if there are multiple owners and hundreds of people have edit permission this enables crowd sourced data collection instigated by an owner handing out hundreds of edit permissions for which each editor is not penalized by an additional quota further the owner can also specify that all editors can themselves grant edit permission to others making the crowd potentially larger thus large groups of people can be utilized in data collection and organization in previously unforeseen ways e g curating collections of data and collecting raw data from citizen science efforts 3 3 2 quotas and federation the irods federation based distributed data storage and management ecosystem facilitates and enables an extensible and flexible storage quota management in that different quotas can be enforced for each partner s external federated storage although the quota policy in hydroshare includes working with users to accommodate their storage needs beyond their quota allocations a partner institution may have terabytes of data that they want to put into hydroshare beyond the system storage capacity provided by hydroshare s internal federated zones distributed quota management allows a partner institution to set up its own irods server to federate with hydroshare as part of external federated zones and manage quotas in this external zone fig 5 shows an example of administrative interface in hydroshare where user quotas can be configured by a system administrator for several federated zones 3 4 on demand resource bag creation and update another benefit enabled by the irods based distributed data storage and management is the performance gain obtained by leveraging irods commands and rules that operate directly on data where it resides this data centric approach takes operations to data to minimize data movement which is especially important for big data as shown in fig 2 a hydroshare resource collection conforms to the bagit format which includes bagit metadata and manifest for each content file with associated checksums for verification of resource content each hydroshare resource collection is zipped into a resource bag for data archive and easy transmission in the early stages of hydroshare development whenever the resource was created and updated this zipped resource bag was created on the django server which was subsequently transferred to the irods back end storage this introduced too much performance overhead due to file zipping operations and transfer and was not sustainable especially for big data to eliminate unnecessary performance overhead the bagit workflow was changed to be invoked on demand updated bags are created only when the user requests to download the bag to eliminate file transfer overhead we delegate the resource bagit operation to an irods bagit rule that we customized for hydroshare and that directly operates on the resource collection wherever it is stored in irods in the following we summarize our on demand resource bagging workflow a user creates a hydroshare resource a which in turn creates a resource collection directory hierarchy as shown in fig 2 in a hydroshare irods zone this includes all data files but excludes metadata files generated from django metadata initially two irods flags bag modified and resource modified are created on the resource collection and set to true a user updates the metadata for resource a the metadata is updated in the database on the django server but the resource metadata file is not created or updated in irods instead the resource modified flag is set to true for on demand file creation or update later a user adds files to or deletes files from resource a the content subdirectory is updated in irods to reflect the file updates but the metadata files are not created or updated in irods instead the resource modified flag is set to true for on demand metadata file creation or update later the resource metadata files are requested programmatically via a rest api method if the resource modified flag is true the requested metadata files are created or updated on the django server and transferred to irods then the files are transferred to the api requestor and this flag is set to false subsequent requests for the files check this flag a false value does not trigger file update a user requests to download the bag of resource a if the bag modified flag is true the following actions take place in sequence resource metadata files are created on the django server and transferred to irods then resource modified is set to false a custom irods bagit rule is executed to generate bagit metadata and manifest files with checksums conforming to bagit specification in the resource collection an irods command is executed to zip the whole resource collection into a zipped bag the bag modified flag is set to false the zipped bag is transferred from irods to the hydroshare web client another user requests to download the bag of resource a now that the bag modified flag is false the zipped bag is directly transferred from irods to the hydroshare web client this on demand resource bag creation and update workflow reduces computational overhead by ensuring the files are only created and transferred when needed leveraging irods rules and commands for resource bag creation to take operation directly to the data in irods gives us another layer of performance boost especially for large resources by eliminating the need for large file transfer in order to create each bag 4 discussion and future work irods based distributed data management not only facilitates data exchange and interaction between hydroshare and other irods based systems such as cyverse discovery environment but also enables hydroshare to make data readily available to other systems for data analysis and visualization services this section briefly discusses two use cases in hydroshare that illustrate possibilities enabled by the distributed data management approach other points relevant to bringing partners into hydroshare ecosystem potentially better leveraging irods ecosystem and other ongoing and future work are also discussed 4 1 national water model nwm data analysis in hydroshare the national oceanic and atmospheric administration noaa national water center nwc launched operational production of its new high resolution national water model nwm in 2016 noaa 2016 the nwm is a hydrological model that simulates observed and forecast streamflow over the entire continental united states the model runs on supercomputers producing large volumes of data with hourly simulation of current conditions as well as medium range and 30 day forecasts to help make the nwm forecasts more accessible to scientists and the public a rolling window of nwm data ranging from forty days to two years is registered and ingested into an irods zone in turn this data is made available to hydroshare apps such as nwm forecast explorer and viewer which allows browsing exploration and visualization of forecast data output from nwm in the future using distributed data management in hydroshare the nwm data storage irods zone may be federated with the main hydroshare irods zone to bring nwm data into the hydroshare federated data ecosystem which could enable easy creation of hydroshare resources using nwm data with structured metadata attached to provide another platform for disseminating structured nwm forecast data in hydroshare 4 2 web apps for processing analyzing and visualizing big data in hydroshare as stated in section 2 hydroshare web apps are independent components that interact with hydroshare through the hydroshare rest api on the one hand this loose coupling between hydroshare and web apps enables extensibility in that anyone may develop a web app which interacts with resources stored in hydroshare on the other hand this loose coupling creates challenges for sharing data between two independent systems especially for big data big data transfer via a native rest api is slow and problematic with transport file size limited by the rest timeout as described in section 3 1 in hydroshare we impose a 1 gb file size limit for direct file transfer via http or rest and leverage irods parallel file transfer capability for transmission of files larger than 1 gb we are currently investigating how to best leverage the irods federation and parallel file transfer capability in conjunction with the rest api to enable bidirectional file transfer between hydroshare and web apps one potential approach under discussion is to use the hydroshare irods user zone as the temporary intermediate landing area for big files to be transferred other potential approaches such as installing irods server on the web apps to federate with the main hydroshare irods zone are also being evaluated these potential approaches are aimed at leveraging the distributed irods federation capability to overcome the data transfer challenges inherent to any loosely coupled systems and thus provide another use case that would be facilitated by our irods federation based distributed data management ecosystem 4 3 bringing partners into hydroshare ecosystem although the irods federation based distributed data grid in hydroshare enables resource storage at partner institutions it imposes some commitments and technical requirements on them first a partnership with hydroshare involves commitments from both hydroshare and a partner the partner must agree to provide persistent storage that is sufficiently protected from disastrous data loss while hydroshare agrees to store the data for resources in the partner s storage since hydroshare is in essence guaranteeing that the dois that it issues when publishing data point to permanent resources the partner must support that guarantee the partnerships are not extended to individuals and an institutional commitment from e g a university or corporation is required in order to form a partnership in addition partnering imposes some technical requirements on partner institutions in that they need to install an irods server and federate it with the main hydroshare irods zone however the extra work required is justified by the extended storage capacity at their disposal hydroshare was built for managing hydrologic data and models at scale and thus extensibility and scalability of the system is of paramount importance to the success of the system in the near future we plan to work with several partner institutions such as cybergis at ncsa http cybergis illinois edu and the university of alabama near the national water center http water noaa gov to bring them into our external federated zones as part of hydroshare ecosystem 4 4 leveraging the irods ecosystem hydroshare directly utilizes only limited capabilities of irods much more advanced irods capabilities are available outside hydroshare including complex workflow management using irods independent of hydroshare one can predefine data replication processing and copying steps that create future data products for hydroshare and can even publish the results in hydroshare via irods workflows using the hydroshare rest api irods workflows can also involve data movement to and from supercomputing resources which may make it easier for researchers less well versed in supercomputing and cloud computing to take advantage of these resources irods federation enables several useful features including fast and secure file transfer between federated zones and the ability to automatically process files using irods rules irods is utilized in many supercomputing centers and organizations providing cloud computing enabling irods users to transfer data to and from available compute resources quickly and easily thus while the hydroshare django website provides a front end for data preparation irods as a component of hydroshare provides a back end for moving data efficiently to compute resources in a supercomputer for processing such as running hydrologic models using data stored in hydroshare 4 5 other ongoing and future work we are also working to make this distributed data management infrastructure in hydroshare more flexible for example we plan to allow users to customize the location where they want their resources to be stored currently hydroshare stores the resources in the main hydroshare zone or a federated zone depending on where the original resource content files came from for more flexible quota management it is desirable to give users an option to move their existing resources to a different federated zone within the hydroshare distributed data storage and management ecosystem since hydroshare was built as a modular system based on loose coupling of dispersed components and the hydrology specific functionalities were encapsulated into software components as django apps we are working on generalizing hydroshare to make the software infrastructure applicable to other science domains beyond just hydrological and environmental sciences additionally the loosely coupled irods based network file system for scalable and extensible big data management approaches presented in this paper provide solid foundation and extensibility that enable and facilitate this generalization 5 conclusion the irods based approaches used for big data management in hydroshare provide a practical solution for storing and managing big hydrological data and models some examples in hydroshare that may leverage the big data management approaches have been presented to provide specific reference use cases enabled by our distributed data management approaches the highlights of the design of the irods based distributed data management system in hydroshare are summarized below uses irods as a back end in hydroshare to facilitate replication to the off site data store for disaster recovery employs irods federation capability to enable a partner institution to add storage capacity into the distributed federated data storage ecosystem extending hydroshare storage capacity provides irods user space to enable users to upload large files using irods clients and to add them into hydroshare resources uses irods rules and commands for on demand resource bagging to take data operation close to data for enhanced performance enables more rapid resource file access by web apps via irods clients enables interoperability on the data level with other irods based systems provides access to community data such as nwm data that is registered and ingested in a separate irods zone that may be federated with hydroshare data store provides fast transfer of big data to and from supercomputers and cloud computing providers as of this writing the functionality reported here is deployed as part of hydroshare https www hydroshare org with source code open bsd 3 clause license and available on github https github com hydroshare hydroshare active development continues to improve quota management in hydroshare and interconnectivity with hydroshare apps as well as many other enhancements acknowledgments this work has been supported by the national science foundation under collaborative grants aci 1148453 1148090 1664018 1664061 and 1664119 for the development of hydroshare http www hydroshare org special thanks go to the irods team at renaissance computing institute renci for their valuable discussions and consultations 
26426,hydroshare https www hydroshare org is an online collaborative system to support the open sharing of hydrologic data analytical tools and computer models hydrologic data and models are often large extending to multi gigabyte or terabyte scale and as a result the scalability of centralized data management poses challenges for a system such as hydroshare a distributed data management framework that enables distributed physical data storage and management in multiple locations thus becomes a necessity we use the irods integrated rule oriented data system data grid middleware as the distributed data storage and management back end in hydroshare irods provides a unified virtual file system for distributed physical storages in multiple locations and enables data federation across geographically dispersed institutions around the world in this paper we describe the irods based distributed data management approaches implemented in hydroshare to provide a practical demonstration of a production system for supporting big data in the environmental sciences keywords distributed data management big data data sharing hydrologic information systems collaborative environment irods 1 introduction to enable more rapid scientific advances and discovery it is critical to enable reproducible science and facilitate the ability for scientists to share their work and build on the work of others effective data discovery and reuse requires a comprehensive cyberinfrastructure that enables diverse data with different types to be annotated discovered accessed visualized analyzed published and serves as a platform for collaboration hydroshare http www hydroshare org is one example of that cyberinfrastructure it is a web based collaboration system for cataloging and sharing hydrologic data models and tools to enable more rapid advances in hydrologic understanding via collaborative data sharing analysis and modeling using hydroshare scientists can easily discover access share and collaboratively analyze hydrologic data and models and hence accelerate hydrologic scientific discovery development of hydroshare was funded by the u s national science foundation nsf through its software infrastructure for sustained innovation program awards 1148453 and 1148090 2012 2017 the consortium of universities for the advancement of hydrologic sciences inc cuahsi has assumed responsibility for operation of hydroshare as one of its water data services and a new nsf collaborative award 1664061 1664018 1664119 2017 2021 will further advance the modeling collaboration storage and extensibility capabilities of hydroshare this paper reports on the hydroshare distributed data storage and management system developed using an open source data grid middleware called irods integrated rule oriented data system moore 2008 russell et al 2016 hydroshare is constructed from several coupled components including a django front end written in the programming language python that serves as a user interface an irods distributed file system back end that stores files and data a solr search engine http lucene apache org solr that enables data discovery and a variety of application servers that access irods and solr via a representative state transfer rest application programming interface api this loose coupling of application servers allows extensibility as needs of hydrologic science evolve over time refer to section 2 and fig 1 for a more detailed description of these coupled components in hydroshare hydrologic data and models can be large often at multi gigabyte or terabyte scales to cope with large data sets we use the irods data grid middleware as the distributed network data storage and management back end in hydroshare irods provides a unified virtual file system for physical storage distributed across multiple locations and enables data federation across geographically dispersed institutions around the world using irods enables hydroshare to work with large files efficiently by leveraging irods parallel file transfer capability and addresses big data management challenges including system expansion ability to deliver data to analysis applications efficiently efficient data packaging and off site data replication for disaster recovery irods provides a distributed virtual framework for managing physical storages across multiple locations and enables storage federation across geographically dispersed institutions around the world it is not a prepackaged solution but rather a middleware with pluggable architecture that supports developer customizable policies at every point of the data management life cycle russell et al 2016 so that users are not limited by a pre defined set of features the flexibility and extensibility enabled by this pluggable architecture in irods allows us to move time consuming data operations to irods and to customize hydroshare quota management policies in irods in addition the storage federation capability in irods allows us to create a federated data storage system in hydroshare so that partner institutions can share the burden of storing large data sets in the following sections we first provide background for our work then describe how irods is used in hydroshare for managing big data in hydrological and environmental sciences in addition we discuss the strengths and weaknesses of our data management approach in the context of hydroshare this is followed by discussion of the approach use cases and future work finally we summarize our contributions and conclude the paper 2 background an overview of the functionality envisioned for hydroshare was given in tarboton et al 2014 and the initial software architecture for hydroshare was described in heard et al 2014 idaszak et al 2016 provided a case study of the application of modern software engineering to hydroshare horsburgh et al 2015 described the data model and content packaging scheme for diverse hydrologic datasets and models used by hydroshare to enable storage management sharing publication and annotation of the diverse types of data and models used by hydrologic scientists these diverse types of data and models are packaged into a resource bag using the bagit file packaging format boyko et al 2012 for storing resources on disk and for serializing them to zipped files for transfer we refer to this resource packaging operation as resource bagging hereafter for easier reference a resource is the granular unit used for data management and access control within hydroshare physically a resource is a directory in a file system that adheres to the structure of the bagit format hydroshare uses a resource centric approach in which resources are objects that can be created stored modified versioned shared annotated discovered accessed published and acted upon by web apps independent of hydroshare as shown in fig 1 hydroshare s functionality and architecture can be organized into three categories 1 irods based distributed resource storage and management 2 resource exploration and 3 actions on resources each is implemented using system components that interact through apis the loose coupling between hydroshare and web apps enables extensibility in that anyone can develop a web app that interacts with resources stored in hydroshare an example of a web app for visualizing spatial data in hydroshare is described in crawley et al 2017 2 1 related work vitolo et al 2015 recently gave an overview of using web based technologies for processing big data in the context of environmental sciences and highlighted the fact that using web and cloud based technologies for big data analysis is increasingly acknowledged in the environmental community there has been increased development and availability of data repositories and archival systems for the last several years including figshare hane 2013 the nsf oci 0940841 supported datanet federation consortium http datafed org dataone cao et al 2016 sead myers et al 2015 and cyverse merchant et al 2016 oliver et al 2013 these systems all have a similar basic structure a data store the ability to publish data for public consumption and ability to specify metadata for published data so that it can be discovered by other researchers involved in similar tasks hydroshare enables interoperability with other digital repositories via a standards based approach to data storage and metadata hydroshare s data model an adaptation of the open archive initiative s object reuse and exchange oai ore standard lagoze et al 2008 metadata structure dublin core with extensions dcmi 2012 and packaging scheme the bagit hierarchical file packaging format all use well known standards within the digital preservation and archival community hydroshare s structured and comprehensive resource types and metadata descriptions not only facilitate better interpretation by users but also enable users to write independent applications designed to operate on this structured content unlike many other data publication systems hydroshare enforces a strict compliance to metadata standards at all times and strict synchronization between metadata and the presence of specific resource files the reason for this requirement is that hydroshare allows authorized users to treat the resource as if published at any time and download use and then re upload the resource as part of the data life cycle even before the resource is formally published by contrast many publication systems prohibit download until metadata is synchronized with object contents that mode of operation would interfere with a core goal of hydroshare to allow resource sharing before or even without formal publication hydroshare can also interoperate with other data repositories via its irods based distributed data storage and management system irods is used by large scientific research projects across the country and around the globe for managing petabytes of data in hundreds of millions of files on distributed storage resources for example hedges et al 2009 presented a rule based data grid approach using irods for automatic data curation and preservation schnase et al 2011 presented their irods based approach for combining disparate data collections into a federated platform for implementing various data services in nasa center for climate simulation sukhija and datta 2013 presented a community grid web portal for storing managing and sharing large amounts of community health data in a data grid managed by irods using irods as the distributed data management back end in hydroshare enables hydroshare to inter operate with other data repositories e g cyverse at the data layer via irods in the following sections we describe the irods based distributed data storage and management architecture and approach in hydroshare and discuss strengths and weaknesses of the approach in the context of hydroshare to provide reference for other similar systems some use cases enabled by the irods based approach are also discussed 3 irods based big data management in hydroshare hydroshare was implemented using the django web framework with irods as back end storage for distributed data management in hydroshare a resource is stored in irods as a collection of data that is accessible as one unit physically a hydroshare resource is stored as a directory of files adhering to the bagit format specification the name of the directory a collection in irods terminology for a hydroshare resource is a randomly generated universally unique identifier uuid that is used to uniquely identify a resource in hydroshare fig 2 shows an example of a hydroshare resource stored in irods and conforming to bagit format a hydroshare resource differs from a regular directory of a computer file system in several ways the resource directory in hydroshare is tightly linked with a data catalog maintained in django which records both the structure of and the metadata for that directory hydroshare supports a number of resource types that constrain the contents of each hydroshare resource directory and metadata in a manner that makes the resulting hydroshare resource suitable for publication thus one must modify the files and metadata for a resource directory in concert additionally hydroshare allows a user to formally publish a resource as citable which has the effect of prohibiting all further changes and providing a digital object identifier doi suitable for data citation for this reason within an irods server files in hydroshare resources are not owned by a specific hydroshare irods user but by an independent single irods proxy user that the hydroshare software system controls in this manner the hydroshare system assures that the resource files and data catalog remain synchronized and immune from modification in irods outside of hydroshare the proxy user assures that resources cannot be changed outside the hydroshare environment if a resource was owned by a regular user in irods an irods client outside of hydroshare could be used and thus changes could not be prevented the decision to make hydroshare files owned by a dedicated irods proxy user gives rise to other practical issues including how user disk usage and quotas are managed hydroshare uses a hybrid approach that combines hydroshare custom software and native irods quota mechanisms for disk quota management as described in detail in section 3 3 one important difference between hydroshare and other data publication systems is that it also supports pre publication workflows involving many people and software applications the access control system allows users to share their data only with specific users form groups of users and share data with those groups both for the purpose of data use and collaborative data collection due to its inclusion of these dynamic and private pre publication datasets hydroshare uses more storage than a publication only system would use and supports all phases of the data creation and usage life cycle including but not limited to data publication thus another practical consideration in our design is that the project cannot afford to pay for storing all of the data that everyone might need to store irods provides a straightforward solution in its mechanism for federation which allows a set of geographically distributed disks to act like a single file storage device therefore independent users or their institutions can add storage to hydroshare federated storage where the collection of all available storage is managed as a single entity in hydroshare for the purpose of storing resources these basic building blocks irods the proxy user storage federation and a django based resource editor are the elements from which big data management is built the django based resource editor allows creation and manipulation of resources while the other components provide a storage medium that is scalable both in a technological and economic sense 3 1 working around http file transfer limits since uploading or downloading large multi gigabyte files through the http protocol from a web browser is problematic most web applications impose some limit on the size of the file to be uploaded or downloaded from a web browser in the hydroshare web interface we support direct upload or download of files from local disk up to 1 gb in size for files larger than 1 gb we leverage irods file transfer capability to transfer files of arbitrary size hünich and müller pfefferkorn 2010 gave a performance analysis of irods for managing large datasets with stress tests designed to test irods file transfer performance under the conditions of a large number of requests to transfer millions of files irods manages data objects and collections in independent administrative units called zones which are autonomous with their own security and users these zones can be federated to form a distributed data management system with customized access control protocol each irods zone contains an irods catalog enabled resource server which uses a relational database to organize the content of the zone and to maintain irods metadata files uploaded to the hydroshare django server or selected from an irods zone are efficiently transferred to the main hydroshare irods zone via an irods client called icommands for large files larger than 32 mb by default irods uses multiple threads to transfer data in parallel which provides irods with a significant speed advantage over standard file transfer protocols e g ftp 3 2 using irods federation in hydroshare we employ a distributed data management approach based on irods zone federation irods federation supports extensibility of the hydroshare storage and quota management system by providing partner organizations the option to store hydroshare resources on their own irods servers to increase storage capacity for their users beyond the finite capacity provided by hydroshare main storage to support such an extensible distributed data storage ecosystem in hydroshare for better managing future growth we are developing policies that describe how partner organizations can extend hydroshare main storage and are also in the final process of developing and testing a distributed storage quota management system this distributed storage quota management system will allow partner organizations to manage their own storage quota as needed once deployed in the near future the core of this federation based approach is to store hydroshare resources in different irods zones as independent administrative units these units can be located in geographically dispersed locations physically yet all these zones are logically federated with the main zone for centralized data management in hydroshare the three main advantages of this federation approach are security speed and physically distributed storage each zone is a separate data administrative unit that has its own irods server and catalog database which enables its own security boundary that is not exposed to other zones on the other hand all zones are federated via irods with authorization and access control that allows direct access to files across different zones via the irods proxy user in hydroshare in addition this distributed data storage and management approach allows us to execute resource bagging a time consuming operation especially for large resources on the server where the data resides boosting performance this was done by creating resource bagging code in irods to avoid having to move data to the django server fig 3 shows a schematic representation of the irods zone federation based distributed data management approach in hydroshare the main hydroshare irods zone and hydroshare irods user zone are federated internally and grouped as internal hydroshare federated zones on the file access level in the irods layer a proxy irods user owns all hydroshare resources in irods this prohibits users from making any changes to hydroshare resources except through the django user interface and rest api which act as the proxy irods user and enforces an ownership and access control model defined and managed in django couch et al 2015 federated irods servers are configured similarly but not identically to the main irods server for hydroshare each federated zone has its own dedicated local proxy irods user for the files it stores by default hydroshare stores new resources in the main hydroshare zone under the main proxy irods user however when a user asks hydroshare to create a resource from files stored in a federated irods zone the hydroshare resource will be created in the same federated irods zone and owned by this local proxy irods user which serves as the counterpart of the main proxy irods user in this local federated zone a partner s federated irods zone must be configured to allow hydroshare read and write access to its local proxy irods user account however the partner s local proxy irods user account is prohibited from accessing the main proxy irods user account thus the partner gives hydroshare the limited right to modify a local irods zone but does not gain the ability to directly modify the main hydroshare irods store changing a file in a hydroshare zone without permission and without interaction with the django application can corrupt the resource from the perspective of the hydroshare system this in turn would make future downloads of the resource invalid thus no irods users other than the proxy irods users are allowed to modify hydroshare resources directly a partner must agree not to modify its federated hydroshare zone except through the common hydroshare user interface and rest api that uses the main proxy irods user for file operations thus preserving data integrity of the hydroshare resources as aforementioned users can employ any irods zone as a data source to add files to hydroshare without being limited by file upload size from a web browser the irods zone may be an independent irods data store such as cyverse or a zone federated with the main hydroshare zone if users do not have an irods account in the hydroshare user zone they may go to their profile page in hydroshare and create an irods account in the hydroshare user zone for creating big data resources fig 4 shows a screen capture of assembled interface components in hydroshare for creating a resource using large files in the federated irods user zone hydroshare detects whether or not the selected files come from an irods zone federated with the main hydroshare zone automatically in a manner that is transparent to users and handles federated files differently as needed specifically if the selected files come from a federated irods zone e g the internal hydroshare user zone a move or copy option allows the hydroshare user to choose to have the selected files either moved or copied into the resource moving the files in the same irods zone is a logical and instant operation since the physical file on the same irods server is not moved but just registered logically to a different location in the irods catalog and thus the move option executes quickly on big data by contrast the copy operation copies the physical files efficiently via multiple threads on the same or a federated server which necessarily takes more time than the move option on big data the copy option applies to users who want to keep files in their personal irods user space for further use outside hydroshare 3 3 quota management the strong requirement for data integrity and synchronization between django and irods views of hydroshare resources requires the use of an irods proxy user that acts on behalf of django rather than being regular irods users thus quota management in hydroshare requires a hybrid approach involving both django and irods use of regular irods user files in personal irods user space in a federated irods zone is monitored via irods methods while ownership of hydroshare resources managed by the proxy user is determined by the django server django s concepts of resource ownership are communicated to irods by setting irods attribute value units avus which are key value metadata stored directly in irods and associated with any irods file folder user or storage resource specifically the django server records the quota user for each proxy owned hydroshare resource folder in its avus to communicate this ownership to irods thus much quota management can be done outside of hydroshare in irods using this extra metadata conversely irods sets different avus on the irods proxy user to communicate total quota usage for all hydroshare users back to django for quota notification and enforcement two quota related data models are managed on the hydroshare django front end server the user quota model records quota allocation and usage information for each hydroshare user the quota message model holds quota warning and enforcement messages and criteria variables which may be customized with different values as needed from the django administrative web console by a system administrator these quota warning and enforcement criteria variables include quota soft and hard limit percentages and grace period days that are all configurable from the administrative console table 1 shows actions taken in hydroshare under various conditions these actions apply to both internal and external federated zones in hydroshare when users exceed their quota they may no longer add more files to hydroshare until they reduce their quota usage below the allocated quota or have been granted increased quota allocation our hybrid approach allows distributed flexible and customizable quota management in hydroshare 3 3 1 encouraging data sharing via simplified quota policies the quota scheme in hydroshare differs from other quota schemes prevalent for cloud data sharing the dropbox policy of charging all users quotas for an object they share is noticeably absent in fact the designers of hydroshare felt that this dropbox policy discourages data sharing by instituting a penalty for users who receive the data instead in hydroshare the user that creates a resource is considered the responsible party and becomes the initial owner and quota holder for a resource other users may be designated as resource owners and an owner may transfer the holding of quota to another owner of the resource but at any time there is one responsible quota user for a resource this is independent of how many times and with how many users the resource is shared a resource shared with hundreds of users is still attributed to a single user for the purpose of quota management to understand the impact of this quota policy upon use of hydroshare one must understand the basis of the sharing model in hydroshare there are three levels of sharing view edit and owner a view user can see and copy a resource an edit user can make changes to data and or metadata and an owner can additionally make a resource public or publish it the quota management system attributes the quota to one owner even if there are multiple owners and hundreds of people have edit permission this enables crowd sourced data collection instigated by an owner handing out hundreds of edit permissions for which each editor is not penalized by an additional quota further the owner can also specify that all editors can themselves grant edit permission to others making the crowd potentially larger thus large groups of people can be utilized in data collection and organization in previously unforeseen ways e g curating collections of data and collecting raw data from citizen science efforts 3 3 2 quotas and federation the irods federation based distributed data storage and management ecosystem facilitates and enables an extensible and flexible storage quota management in that different quotas can be enforced for each partner s external federated storage although the quota policy in hydroshare includes working with users to accommodate their storage needs beyond their quota allocations a partner institution may have terabytes of data that they want to put into hydroshare beyond the system storage capacity provided by hydroshare s internal federated zones distributed quota management allows a partner institution to set up its own irods server to federate with hydroshare as part of external federated zones and manage quotas in this external zone fig 5 shows an example of administrative interface in hydroshare where user quotas can be configured by a system administrator for several federated zones 3 4 on demand resource bag creation and update another benefit enabled by the irods based distributed data storage and management is the performance gain obtained by leveraging irods commands and rules that operate directly on data where it resides this data centric approach takes operations to data to minimize data movement which is especially important for big data as shown in fig 2 a hydroshare resource collection conforms to the bagit format which includes bagit metadata and manifest for each content file with associated checksums for verification of resource content each hydroshare resource collection is zipped into a resource bag for data archive and easy transmission in the early stages of hydroshare development whenever the resource was created and updated this zipped resource bag was created on the django server which was subsequently transferred to the irods back end storage this introduced too much performance overhead due to file zipping operations and transfer and was not sustainable especially for big data to eliminate unnecessary performance overhead the bagit workflow was changed to be invoked on demand updated bags are created only when the user requests to download the bag to eliminate file transfer overhead we delegate the resource bagit operation to an irods bagit rule that we customized for hydroshare and that directly operates on the resource collection wherever it is stored in irods in the following we summarize our on demand resource bagging workflow a user creates a hydroshare resource a which in turn creates a resource collection directory hierarchy as shown in fig 2 in a hydroshare irods zone this includes all data files but excludes metadata files generated from django metadata initially two irods flags bag modified and resource modified are created on the resource collection and set to true a user updates the metadata for resource a the metadata is updated in the database on the django server but the resource metadata file is not created or updated in irods instead the resource modified flag is set to true for on demand file creation or update later a user adds files to or deletes files from resource a the content subdirectory is updated in irods to reflect the file updates but the metadata files are not created or updated in irods instead the resource modified flag is set to true for on demand metadata file creation or update later the resource metadata files are requested programmatically via a rest api method if the resource modified flag is true the requested metadata files are created or updated on the django server and transferred to irods then the files are transferred to the api requestor and this flag is set to false subsequent requests for the files check this flag a false value does not trigger file update a user requests to download the bag of resource a if the bag modified flag is true the following actions take place in sequence resource metadata files are created on the django server and transferred to irods then resource modified is set to false a custom irods bagit rule is executed to generate bagit metadata and manifest files with checksums conforming to bagit specification in the resource collection an irods command is executed to zip the whole resource collection into a zipped bag the bag modified flag is set to false the zipped bag is transferred from irods to the hydroshare web client another user requests to download the bag of resource a now that the bag modified flag is false the zipped bag is directly transferred from irods to the hydroshare web client this on demand resource bag creation and update workflow reduces computational overhead by ensuring the files are only created and transferred when needed leveraging irods rules and commands for resource bag creation to take operation directly to the data in irods gives us another layer of performance boost especially for large resources by eliminating the need for large file transfer in order to create each bag 4 discussion and future work irods based distributed data management not only facilitates data exchange and interaction between hydroshare and other irods based systems such as cyverse discovery environment but also enables hydroshare to make data readily available to other systems for data analysis and visualization services this section briefly discusses two use cases in hydroshare that illustrate possibilities enabled by the distributed data management approach other points relevant to bringing partners into hydroshare ecosystem potentially better leveraging irods ecosystem and other ongoing and future work are also discussed 4 1 national water model nwm data analysis in hydroshare the national oceanic and atmospheric administration noaa national water center nwc launched operational production of its new high resolution national water model nwm in 2016 noaa 2016 the nwm is a hydrological model that simulates observed and forecast streamflow over the entire continental united states the model runs on supercomputers producing large volumes of data with hourly simulation of current conditions as well as medium range and 30 day forecasts to help make the nwm forecasts more accessible to scientists and the public a rolling window of nwm data ranging from forty days to two years is registered and ingested into an irods zone in turn this data is made available to hydroshare apps such as nwm forecast explorer and viewer which allows browsing exploration and visualization of forecast data output from nwm in the future using distributed data management in hydroshare the nwm data storage irods zone may be federated with the main hydroshare irods zone to bring nwm data into the hydroshare federated data ecosystem which could enable easy creation of hydroshare resources using nwm data with structured metadata attached to provide another platform for disseminating structured nwm forecast data in hydroshare 4 2 web apps for processing analyzing and visualizing big data in hydroshare as stated in section 2 hydroshare web apps are independent components that interact with hydroshare through the hydroshare rest api on the one hand this loose coupling between hydroshare and web apps enables extensibility in that anyone may develop a web app which interacts with resources stored in hydroshare on the other hand this loose coupling creates challenges for sharing data between two independent systems especially for big data big data transfer via a native rest api is slow and problematic with transport file size limited by the rest timeout as described in section 3 1 in hydroshare we impose a 1 gb file size limit for direct file transfer via http or rest and leverage irods parallel file transfer capability for transmission of files larger than 1 gb we are currently investigating how to best leverage the irods federation and parallel file transfer capability in conjunction with the rest api to enable bidirectional file transfer between hydroshare and web apps one potential approach under discussion is to use the hydroshare irods user zone as the temporary intermediate landing area for big files to be transferred other potential approaches such as installing irods server on the web apps to federate with the main hydroshare irods zone are also being evaluated these potential approaches are aimed at leveraging the distributed irods federation capability to overcome the data transfer challenges inherent to any loosely coupled systems and thus provide another use case that would be facilitated by our irods federation based distributed data management ecosystem 4 3 bringing partners into hydroshare ecosystem although the irods federation based distributed data grid in hydroshare enables resource storage at partner institutions it imposes some commitments and technical requirements on them first a partnership with hydroshare involves commitments from both hydroshare and a partner the partner must agree to provide persistent storage that is sufficiently protected from disastrous data loss while hydroshare agrees to store the data for resources in the partner s storage since hydroshare is in essence guaranteeing that the dois that it issues when publishing data point to permanent resources the partner must support that guarantee the partnerships are not extended to individuals and an institutional commitment from e g a university or corporation is required in order to form a partnership in addition partnering imposes some technical requirements on partner institutions in that they need to install an irods server and federate it with the main hydroshare irods zone however the extra work required is justified by the extended storage capacity at their disposal hydroshare was built for managing hydrologic data and models at scale and thus extensibility and scalability of the system is of paramount importance to the success of the system in the near future we plan to work with several partner institutions such as cybergis at ncsa http cybergis illinois edu and the university of alabama near the national water center http water noaa gov to bring them into our external federated zones as part of hydroshare ecosystem 4 4 leveraging the irods ecosystem hydroshare directly utilizes only limited capabilities of irods much more advanced irods capabilities are available outside hydroshare including complex workflow management using irods independent of hydroshare one can predefine data replication processing and copying steps that create future data products for hydroshare and can even publish the results in hydroshare via irods workflows using the hydroshare rest api irods workflows can also involve data movement to and from supercomputing resources which may make it easier for researchers less well versed in supercomputing and cloud computing to take advantage of these resources irods federation enables several useful features including fast and secure file transfer between federated zones and the ability to automatically process files using irods rules irods is utilized in many supercomputing centers and organizations providing cloud computing enabling irods users to transfer data to and from available compute resources quickly and easily thus while the hydroshare django website provides a front end for data preparation irods as a component of hydroshare provides a back end for moving data efficiently to compute resources in a supercomputer for processing such as running hydrologic models using data stored in hydroshare 4 5 other ongoing and future work we are also working to make this distributed data management infrastructure in hydroshare more flexible for example we plan to allow users to customize the location where they want their resources to be stored currently hydroshare stores the resources in the main hydroshare zone or a federated zone depending on where the original resource content files came from for more flexible quota management it is desirable to give users an option to move their existing resources to a different federated zone within the hydroshare distributed data storage and management ecosystem since hydroshare was built as a modular system based on loose coupling of dispersed components and the hydrology specific functionalities were encapsulated into software components as django apps we are working on generalizing hydroshare to make the software infrastructure applicable to other science domains beyond just hydrological and environmental sciences additionally the loosely coupled irods based network file system for scalable and extensible big data management approaches presented in this paper provide solid foundation and extensibility that enable and facilitate this generalization 5 conclusion the irods based approaches used for big data management in hydroshare provide a practical solution for storing and managing big hydrological data and models some examples in hydroshare that may leverage the big data management approaches have been presented to provide specific reference use cases enabled by our distributed data management approaches the highlights of the design of the irods based distributed data management system in hydroshare are summarized below uses irods as a back end in hydroshare to facilitate replication to the off site data store for disaster recovery employs irods federation capability to enable a partner institution to add storage capacity into the distributed federated data storage ecosystem extending hydroshare storage capacity provides irods user space to enable users to upload large files using irods clients and to add them into hydroshare resources uses irods rules and commands for on demand resource bagging to take data operation close to data for enhanced performance enables more rapid resource file access by web apps via irods clients enables interoperability on the data level with other irods based systems provides access to community data such as nwm data that is registered and ingested in a separate irods zone that may be federated with hydroshare data store provides fast transfer of big data to and from supercomputers and cloud computing providers as of this writing the functionality reported here is deployed as part of hydroshare https www hydroshare org with source code open bsd 3 clause license and available on github https github com hydroshare hydroshare active development continues to improve quota management in hydroshare and interconnectivity with hydroshare apps as well as many other enhancements acknowledgments this work has been supported by the national science foundation under collaborative grants aci 1148453 1148090 1664018 1664061 and 1664119 for the development of hydroshare http www hydroshare org special thanks go to the irods team at renaissance computing institute renci for their valuable discussions and consultations 
26427,this paper presents dem stream conflation dsc algorithm a scale independent robust technique of aligning vector streams with flowpaths dictated by raster dems designed as an alternative to both stream burning and threshold dependent stream segmentation techniques dsc utilizes the existing vector flowlines to identify the channel heads and a sink filled hydrologically conditioned dem to resolve the flowpaths the algorithm conceptually initiates the movement of water on a dem at the starting node of channel heads from which it traces the path of water to its ultimate watershed outlet each trace represents a stream which is in perfect alignment with the direction dictated by the raster dem the algorithm is tested with different dems and its efficacy is demonstrated through the replication of the original vector drainage pattern derivation of geomorphic attributes that are independent of tested dem scale and the visualization of monotonically decreasing longitudinal stream profiles 1 introduction a vast array of landforms in their many manifestations limit our ability to model and predict channel locations and yet an accurate and unambiguous spatial delineation of channel forms is necessary for many models of catchment hydrology pilotti et al 1996 integrated assessment of hydro geomorphic system often requires an accurate representation of topography primarily in the form of digital elevation models dems dems are used to quantify basin parameters such as catchment boundaries area length slope aspect curvature drainage density stream order and horton s ratios bhadra et al 2008 a stream network is a conduit that links the upstream catchment processes and its impact on the downstream streams and floodplains unambiguous and exact alignment of channel geometry and topographic dems therefore is necessary to model the routing of water and sediments the fate and transfer of contaminants and for many other integrated computer models to assess the catchment processes geomorphological research on drainage basins is replete with literature on modeling mapping and prediction of channel networks from dems and other digital data sources clubb et al 2014 montgomery and foufoulageorgiou 1993 passalacqua et al 2010 pelletier 2013 despite our rich knowledge of physical processes governing the initiation growth and development of channel networks no predictive model successfully replicates observed channel networks from a dem clubb et al 2015 lindsay 2016 montgomery and dietrich 1988 passalacqua and foufoula georgiou 2015 the constant area threshold method or some variant thereof e g the slope dependent area threshold approach is typically used to delineate stream networks from dems jenson 1991 montgomery and foufoulageorgiou 1993 omran et al 2016 this method implicitly assumes a certain minimum upstream contributing area to initiate channelization however this approach produces different realizations of stream network for different thresholds which is problematic when the upstream contributing area is not unique but varies spatially and is essentially unknown by assuming a single basin wide minimum threshold for the upstream contributing area we are effectively setting the basin wide drainage density a priori pelletier 2013 any additional geomorphic parameters generated from this derived stream network loses much of their physical interpretation as they are indirectly dependent upon the ill defined threshold at the outset helmlinger et al 1993 more recent methods of predicting channel networks from dems seek to identify channel head locations using curvature based techniques such as geonet passalacqua et al 2010 sangireddy et al 2016 pelletier 2013 and dreich clubb et al 2014 geonet uses a non linear perona malik filter perona and malik 1990 pelletier method deploys an adaptive wiener filter and dreich operates on the tangential curvature of transformed longitudinal stream profiles these methods have shown promising results in the identification of channel locations from high resolution dems however they also require two to three user defined parameters that may not be readily available moreover these methods are difficult to implement within a general scheme of catchment hydrologic modeling passalacqua and foufoula georgiou 2015 and clubb et al 2015 go so far as to claim that the intricacies of these algorithms are confusing even for the experts indeed the development of automated algorithms for channel detection from topographic dems is a challenging task still we need automated methods of deriving stream networks that are not dependent on arbitrary parameters in this paper we approach this challenge by supplementing raster dems with readily available vector data on stream networks examples of such vector data include stream features obtained through digitizing paper maps or aerial photography field surveys and other legacy systems these vector networks are not always collocated with dem defined channel centerlines but can still be a valuable source of information for inferring the channel locations an exact alignment between the vector network and the channels derived from dem is required in the models of catchment hydrology to model the transfer and conveyance of water sediment and chemicals uniquely from the watersheds drained by corresponding stream segment even though stream burning is a common practice to align the vector stream with dem in the process a hydrologically conditioned dem is further modified due to the etching of stream network on the dem the overarching objective of this paper is to develop conflation algorithms that fuses the known drainage pattern into a raster dem but without further modifying the hydrologically conditioned dem consequently rendering the topographic attributes derived from dem more representative of catchment characteristics the strength of our approach is that it preserves the existing topological relationships of the drainage network while simultaneously avoiding the perils of stream burning and the ambiguity related to choosing an arbitrary threshold value for channel initiation 2 background on stream conflation conflation refers to the alignment and integration of seemingly different but related sources of data to improve the quality of one or both sources the problem addressed herein is an example of vector to raster data conflation where two data sets referencing the same area are reconciled to obtain a consistent stream network that confirms the local topography defined by dems stream burning is a technique commonly used to address the issue of misalignment between vector stream networks and dems saunders 1999 one significant advantage to using the stream burning technique is that it improves the quality of the derived drainage networks in areas of flat topography or in the areas where a given dem is of poor quality da paz et al 2008 lindsay 2016 however this technique permanently alters the dem by lowering the elevation of dem pixels that intersect with the stream vector layer and thus severely compromising subsequent terrain analyses callow et al 2007 morphometric attributes such as local stream slope stream profile aspect and curvature calculated from stream burned dems are no longer representative of actual ground conditions consequently these attributes are not suitable for subsequent hydro geomorphic analyses of drainage basins other problems associated with this technique include the collision of adjacent streams and the occurrence of parallel streams in an otherwise well defined channel network lindsay 2016 several ad hoc techniques exist to adjust stream burned dems such that extracted geomorphological parameters remain useful and representative of catchment characteristics such techniques include the agree method of hellweger and maidment 1997 which adjusts areas adjacent to a stream to ensure modified dems slope towards streams the double dem burning technique promulgated by getirana et al 2009 techniques for handling lakes and wetlands presented by turcotte et al 2001 and kenny et al 2008 a carving technique introduced by soille et al 2003 for areas where a dem deviates more than a specified threshold from networks and the recently proffered topologicalbreachburn method to improve the fusion of vector stream network with topographic dems lindsay 2016 each of these techniques aims to minimize the adverse effects of stream burning nevertheless a hydrologically conditioned dem is further modified by these drainage enforcement methods stream burning implicitly assumes the vector stream network is of superior quality to the dem and tries to improve the dem by fusing a known drainage pattern with the availability of higher quality and higher resolution dems this notion no longer holds true newly acquired dems reflect current topographic conditions of watersheds and thus should better represent existing drainage patterns we thus introduce a dem stream conflation dsc algorithm as a practical alternative to the limitations of the stream burning technique dsc is based on the premise that any correction and modification of dem should be independent of etching a known drainage network a drainage network that the algorithm is tasked to derive in the first place second dsc aims to remove the subjectivity and the circular logic involved in deriving stream networks from an arbitrarily assumed contributing area threshold removing these two constraints minimize the alteration dem and simultaneously preserve the topology of the existing network the paper does not judge the quality of either a digitized vector drainage networks or that of topographic dems but seeks to answer to the following question given these two datasets with all their strengths and limitations can one devise a robust algorithm for augmenting both these products for an improved delineation of basin scale drainage networks the methodology presented in this paper provides a practical solution for the common problem of misalignment between vector stream networks and topographic dems rather than altering the general catchment modeling workflow this technique merely replaces ad hoc stream segmentation technique and improves the downstream processing steps that depend on the correct delineation of stream networks dsc is presented as a general framework that is scale independent and ensures the alignment of a vector stream networks with dems at any scale it is conceived as a way of bringing harmony to various sources of information on drainage networks such as field mapped channel heads digitized vector networks from aerial photographs satellite imagery and existing legacy data 3 material and method 3 1 study area and data the dsc algorithm is developed and tested on a catchment corresponding to a u s geological survey usgs stream gaging station 02167582 named bush river near prosperity in south carolina usa fig 1 the catchment located in the piedmont region of south carolina with an area of 298 square kilometers is a headwater watershed that is tributary to saluda river the relatively flat topography of the watershed is predominantly covered by forest and agriculture landuse classes a medium scale 1 100 000 national hydrography dataset nhd flowlines also commonly referred as bluelines is used as the source of data for vector stream layer the nhd is a comprehensive surface water vector database for the united states compiled from many sources and is continually updated stanislawski 2009 the topography data include commonly used dems such as national elevation dataset ned at 1 arc second 1 3 arc second and 1 9 arc second the shuttle radar topographic mission srtm at 3 arc second and 1 arc second and advanced spaceborne thermal emission and reflection radiometer aster global digital elevation model gdem version 2 at 1 arc second see table 1 the 1 3 arc second ned dem is the highest resolution seamless dem available for the conterminous united states highest resolution seamless dems with global coverage include the 1 arc second srtm and aster dems ned dems represent compilations from multiple sources produced by the usgs the source of srtm dem includes the interferometric radar flown onboard the endeavour mission in 2000 for 11 days the aster dem is a product of japan s ministry of economy trade and industry meti and the u s national aeronautics and space administration nasa from the stereo correlation of in track nadir and aft scenes collected by the infrared camera 3 2 methodology the flowchart in fig 2 outlines the overall steps for aligning vector stream networks with hydrologically conditioned dems the guiding principle of conflating raster dems with vector flowlines is that water should never flow from a dem pixel of lower elevation to one that is higher based on this conceptual notion the dsc algorithm initiates the flow of water on a given dem as a unit volume released at the starting node of each first order vector stream from which it traces the path of that water to its ultimate watershed outlet the loci of dem pixels traversed by water released from each first order stream equates to a network of streams corresponding to the original vector flowlines and these flowlines are in perfect alignment with the channel centerlines corresponding to a raster dem such streams follow paths of least resistance and their longitudinal profiles always exhibit monotonically decreasing elevations the design of this algorithm is motivated by the following necessities find a practical alternative to the threshold dependent ad hoc and arbitrary method of stream segmentation preserve high resolution topographic features of the hydrologically conditioned dem by avoiding the perils stream burning algorithm the dsc algorithms is aimed at working in tandem with the existing catchment modeling framework the utility of dsc is demonstrated by i replication of the original vector drainage pattern ii the derivation of a catchment scale geomorphological attributes and iii construction of monotonically decreasing longitudinal stream profiles we seek to maximize correspondence between the original and aligned drainage pattern and minimize the alterations of dem the algorithm is applied to commonly used dems of varying resolutions to establish its robustness the geomorphic attributes calculated to demonstrate the merits of dsc over the current flow accumulation based algorithms are ones commonly used for catchment scale rainfall runoff modeling using the geomorphological instantaneous unit hydrograph giuh approach kumar et al 2007 martinez et al 2010 rodriguez iturbe and valdes 1979 3 2 1 code development the dsc algorithm follows a standard geoprocessing workflow as sketched in fig 2 these tasks are automated by using arcpy python scripts in esri arcgis environment arcgis extensions such as spatial analyst and 3d analyst were used for processing of raster layers and extraction of elevation profiles the tracing of the flowpaths originating from the starting nodes of first order streams was achieved using custom numpy python routines van der walt et al 2011 routines for plotting the longitudinal profile of streams were developed using ipython pérez and granger 2007 and matplotlib python modules hunter 2007 other python libraries such as pandas geopandas and statsmodels were used for general analysis and presentation of results 3 2 2 raster processing of dem in catchment modeling typical dem processing steps include the filling of sinks the delineation of a deterministic flow direction fdr grid using d8 algorithm jenson and domingue 1988 ocallaghan and mark 1984 the calculation of a flow accumulation fac grid to ascertain the upstream contributing area for each grid and the segmentation of streams by specifying a minimum fac threshold for channelization to minimize alterations to this workflow the dsc algorithm follow this standard dem processing sequence replacing only the threshold dependent stream segmentation step with a stream network that is obtained by the technique presented in this paper this practical design choice allows us to seamlessly integrate the dsc algorithm within the existing catchment modeling frameworks 3 2 3 processing of vector flowlines to extract channel heads vector flowlines are used to infer locations of channel heads i e the starting nodes of first order streams a sequence of geoprocessing operations to find the channel head locations include the following extract the start fnode and end tnode nodes of every stream segment of the vector flowline intersect the fnodes and tnodes to get the interior fnodes switch the selection of fnodes to get the exterior fnodes the selected the fnodes are essentially the channel heads of the vector network these channel heads however may not match exactly with the channelized pixels represented by high fac grids of a dem the location uncertainty of channel heads is resolved with simple heuristics allowing a threshold of small buffer distance to snap the channel heads with high fac grid the locations of snapped flow accumulation grids are the assumed probable locations of where channels begin ideally these desired channel heads are surveyed in the field or ascertained from predictive models in geomorphology 3 2 4 tracing of aligned stream network the trace of channel heads to the outlet is based on the fdr grid both the fdr raster grid and channel heads are first exported to a numpy array a custom python routine was programmed to search for all the downstream pixels receiving flow from each of the identified channel heads the routine relies on the flow direction grid to resolve the flowpaths and the loop terminates when it reaches the outlet of the basin the resulting output of this function is a binary numpy array stream pixels are assigned a value of one and the remaining background pixels are assigned a value of zero this binary numpy array representing the stream network was then exported to esri raster grid and finally converted to a vector layer resulting stream networks should reflect known pattern of vector networks because they were predicated on the starting nodes of vector streams the network also matches the stream centerlines defined by dem because the network is traced by the fdr grid dictated by hydrologically conditioned dem 3 2 5 calculation of geomorphic attributes several geomorphic attributes were calculated to illustrate the variation of catchment specific geomorphic attributes due to the variation of contributing area thresholds dem source and dem resolution these attributes are compared with the terrain attributes derived using the dsc algorithm examined geomorphic attributes include stream order bifurcation ratio rb length ratio rl area ratio ra number of channel heads first order streams cumulative length of streams and the drainage density these geomorphic attributes form the basis of deriving the basin scale giuh bhadra et al 2008 rodriguez iturbe and valdes 1979 a runoff signature for the catchment basin given that ω is the order of stream the horton s ratios are defined mathematically as r b n ω n ω 1 r l l ω l ω 1 r a a ω a ω 1 where n is number of streams l is the average length of streams a is the average watershed area and subscript ω represent the order of the stream custom python routines were programmed to count the number of streams cumulative lengths of stream and drainage density calculation of horton s ratios were carried out by assigning the strahler ordering scheme to the network strahler 1952 and aggregating the number of stream length of stream and watershed areas drained by specific order of stream least squares fitting of the log transformed stream number average stream length and average watershed areas was used to obtain the values of rb rl and ra 3 2 6 construction of longitudinal stream profile a longitudinal steam profile is an elevation plot of stream vertices as a function of distance to the outlet while such profiles have profound significance in quantitative analysis of dominant forces driving the fluvial development of a basin antón et al 2014 our use of such profiles is purely illustrative we use these profiles to corroborate the general problem of stream misalignment and the efficacy of dsc in overcoming such limitations elevation values are extracted from the sink filled dem by using the 3d analyst arcpy function the downstream distance to the outlet and the elevation value for each of the stream vertices was tabulated using python scripts matplotlib python library was used to plot the actual longitudinal profiles of the stream generally the stream profiles extracted from dem require some smoothing operation to remove the unrealistic peaks but dsc aligned stream profiles do not require such corrections profiles of the original and aligned streams are constructed to corroborate the general problem of misalignment and the efficacy of dsc in overcoming such misalignment issues profiles of the dsc aligned streams extracted from both sink filled dem and the original dem is further sketched to show the amount of in filling of dem due to hydrological conditioning 4 results the premise of this work is based on the existence vector stream network to infer the general flow pattern and that of a hydrologically conditioned dem to resolve the flow direction the dsc algorithm reproduces the general flow pattern of vector flowlines that is coincident with the path of least resistance depicted by the dem dsc avoids the artifacts and further degradation of hydrologically conditioned dem due to stream burning and drainage enforcement algorithms this is achieved within a catchment and to that end a concrete application of deriving the geomorphic attributes of giuh model is presented presented first are illustrations showing the similarity between drainage patterns given by an original nhd network and a corresponding aligned network next geomorphic attributes calculated for streams segmented using the contributing area thresholds are compared with the ones derived following the dsc approach finally the robustness of the dsc conflation algorithms is demonstrated by sketching the longitudinal profiles of the dem aligned streams generated from separate dems 4 1 reproduce the known vector drainage pattern fig 3 shows a plan view of a original nhd streams and b the aligned nhd streams in a catchment in this plan view the two plots look identical the dsc algorithm indeed reproduced the original nhd drainage pattern the red circles in the fig 3 represent the interior nodes of the network ideally these nodes should only occur at the junction of two distinct streams the original nhd network is arbitrarily broken into separate segments as seen by randomly appearing interior nodes that are not the junction of two distinct stream segments these breaks are not errors per se each of the nhd segment is associated with a unique identifier nonetheless such random interruptions are problematic when using these networks for automated geomorphological analysis for instance horton s ratios cannot be calculated from this network data as the count of streams for different strahler s orders in not unique the dsc aligned stream network fig 3 b in contrast has no such random splits and is a continuous feature from the channel heads to the outlet and is therefore suitable for calculation geomorphic parameters notwithstanding this similarity the networks derived using dsc algorithm is still dependent on the quality of dems and the inadequacy of coarse dems in resolving the flowpaths manifest directly in the quality of the aligned stream network streams aligned with higher quality ned dem replicated the general nhd drainage pattern however the streams conflated with lower quality dems showed some deviation from the original nhd flowlines such flowpath oscillations were more pronounced for the streams conflated with aster dem despite these shortcomings of coarse dem the dsc derived drainage network are still functionally useful for geomorphological analysis as we will show in next section 4 2 comparison of geomorphic attributes tables 2 and 3 list the geomorphic attributes computed from a series of stream networks derived using contributing area thresholds of 1 3 5 and 7 km2 for a 30 m and 10 m ned dems respectively comparison of geomorphic attributes from the two tables reveal the relative insensitivity of these parameters to the resolution of dem the problems of contributing area technique however is apparent when comparing the variation of terrain attributes due to the variation of contributing area thresholds increasing the threshold of channelization changes the order of basin from 4th to 3rd order the values of horton s ratios channel lengths and drainage density similarly vary with contributing area thresholds differences in parameter values calculated are sufficient to beg questions as to which estimates are correct and what is a reasonable threshold for an upstream contributing area in fact many of these attributes stream length and drainage density for example follow a power law as suggested by helmlinger et al 1993 example of such a power law the variation of drainage density with contributing area threshold along with the best fitting line of power function is shown in fig 4 the high coefficient of determination r2 0 99 indeed corroborate the existence of power law still this well behaved functional relationship offers little respite in picking the most likely threshold values for channel initiation the contributing area threshold is in fact a parameter that varies in space and time and not known a priori nevertheless stream segmentation using threshold value is one of the most prevalent ways of deriving stream network from dems the impact of channel location uncertainty becomes even more pronounced when one uses these streams in models of catchment hydrology giuh for example different stream networks will result in different unit hydrographs for basin which directly impacts the magnitude and timing of runoff table 4 outlines the geomorphic attributes derived using the dsc algorithms for different types of dems in contrast to tables 2 and 3 we observe that most geomorphic attributes listed in table 4 are not sensitive to the dem source or its resolution when one examines natural stream networks the horton s ratios rb typically ranges between 3 and 5 mode of 4 rl generally varies from 1 5 to 3 and mode of 2 and ra typically varies from 3 to 6 kirchner 1993 values of horton s ratios calculated for different sources of dems in table 4 are close to the modes of natural systems the most significant variation is observed for stream lengths these differences manifest in the calculation of rl and drainage density the cumulative length of streams and hence drainage density increased slightly with the increase in resolution of dems such differences in stream length could be attributed to fractals the dem resolution sets the limits of measured length and this length increases systematically with the increase in dem resolution goulden et al 2014 a high resolution dem can better resolve the subtle meanders in the stream while the same stream will appear more straightened when obtained from a coarse dem 4 3 comparison of longitudinal profiles stream profiles are plotted to corroborate the issue of misalignment between vector streams with raster dems and to demonstrate the robustness of dsc algorithms in addressing these problems fig 5 a shows the longitudinal profiles of all the streams in the watershed ideally each profile should depict a monotonically decreasing elevation in the downslope direction however misalignments between the nhd stream network and topographic dems produce discontinuities in the profiles aligned profiles shown in fig 5 b follow the fluvial centerlines of hydrologically conditioned dem hence resulting in monotonically decreasing elevation profile the issue of misalignment is not limited to a specific source of dem or its resolution fig 6 for example shows the longitudinal profile of the one of the longest stream in the watershed extracted from different dems while the erroneous peaks are observed for all dems fig 6 a the profile discontinuities are more pronounced for the ones extracted from aster and srtm dems fig 6 b shows the longitudinal profiles of the streams aligned with dsc algorithm indeed the dsc algorithm corrected all the discontinuous appearing in fig 6 a nevertheless the corrected profiles are not exactly comparable the differences manifested in the stream profiles is the result of source dem used to assign the elevation profiles fig 6 c shows the profiles of dsc aligned streams extracted from the original dem the elevation difference between fig 6 b and c can be used to infer the amount of sink filling of dem to create a hydrologically conditioned dem it shows that aster dem has the most amount of the sink filling followed by srtm dem profile visualization as presented here has important scientific implications for geomorphological research being able to see the actual drop in the elevation of streams allow comparison of different catchments in terms of their hydrological behavior comparing the profile observed for the same catchment for various dems help us assess the quality and suitability of dems for hydrological research fig 6 for example clearly shows the systematic differences between dems a higher elevation profile is evident for both srtm and aster dems it is beyond the scope of this paper to discuss the reason but we can conjecture that strm data has some canopy penetration so the dem could reflect the presence of some vegetation aster dem is based on photogrammetric technique and hence the effect of vegetation is even more pronounced bare earth dem is required in hydrologic modeling for accurate delineation of the flowpaths our visualizations clearly show that srtm and aster dems do not adequately resolve the subtle elevation differences of the bare earth surface 5 discussion misalignment between vector stream network and topographic dem limits their use in the quantitative analysis and modeling of drainage basins the typical stream burning approach arbitrarily modifies the dem severely compromising the derivation of catchment attributes that depend on dem at the other extreme the threshold dependent stream network is associated with a high degree of uncertainty because of the difficulties in objectively defining the minimum support area threshold required for channel initiation we are not proposing to ameliorate this situation for the heterogeneity of land surface will not allow a single threshold value used throughout the landscape or even for a single basin but models of hydrology still demand unanimous delineations of streams and watersheds to make use of all kinds of available data on catchment we propose a dsc algorithm that leverages the strength of both the vector stream network and that of topographic dem until a more general approach for identifying streams are available the dsc algorithm will prove useful in the modeling of catchment hydrology the robustness of the dsc algorithms is demonstrated by replicating the known vector drainage pattern extracting a monotonically decreasing channel elevation profile and deriving a scale invariant geomorphic attributes this conflation algorithm does not require any user defined parameters nor does it make any assumptions about the quality of data the inferred channel network concurrently mimics the vector hydrography and follows the path of steepest descent and can be readily incorporated into the existing models of catchment hydrology our future work will extend the dsc algorithms to the dems conditioned through breaching and impact reduction approach lindsay and creed 2005 and to the flow paths resolved using least cost path search algorithms metz et al 2011 to reduce the adverse effects of dem conditioning acknowledgements this research was funded by the optech inc geosensing systems engineering endowment and the engineering school of sustainable infrastructure environment essie university of florida 
26427,this paper presents dem stream conflation dsc algorithm a scale independent robust technique of aligning vector streams with flowpaths dictated by raster dems designed as an alternative to both stream burning and threshold dependent stream segmentation techniques dsc utilizes the existing vector flowlines to identify the channel heads and a sink filled hydrologically conditioned dem to resolve the flowpaths the algorithm conceptually initiates the movement of water on a dem at the starting node of channel heads from which it traces the path of water to its ultimate watershed outlet each trace represents a stream which is in perfect alignment with the direction dictated by the raster dem the algorithm is tested with different dems and its efficacy is demonstrated through the replication of the original vector drainage pattern derivation of geomorphic attributes that are independent of tested dem scale and the visualization of monotonically decreasing longitudinal stream profiles 1 introduction a vast array of landforms in their many manifestations limit our ability to model and predict channel locations and yet an accurate and unambiguous spatial delineation of channel forms is necessary for many models of catchment hydrology pilotti et al 1996 integrated assessment of hydro geomorphic system often requires an accurate representation of topography primarily in the form of digital elevation models dems dems are used to quantify basin parameters such as catchment boundaries area length slope aspect curvature drainage density stream order and horton s ratios bhadra et al 2008 a stream network is a conduit that links the upstream catchment processes and its impact on the downstream streams and floodplains unambiguous and exact alignment of channel geometry and topographic dems therefore is necessary to model the routing of water and sediments the fate and transfer of contaminants and for many other integrated computer models to assess the catchment processes geomorphological research on drainage basins is replete with literature on modeling mapping and prediction of channel networks from dems and other digital data sources clubb et al 2014 montgomery and foufoulageorgiou 1993 passalacqua et al 2010 pelletier 2013 despite our rich knowledge of physical processes governing the initiation growth and development of channel networks no predictive model successfully replicates observed channel networks from a dem clubb et al 2015 lindsay 2016 montgomery and dietrich 1988 passalacqua and foufoula georgiou 2015 the constant area threshold method or some variant thereof e g the slope dependent area threshold approach is typically used to delineate stream networks from dems jenson 1991 montgomery and foufoulageorgiou 1993 omran et al 2016 this method implicitly assumes a certain minimum upstream contributing area to initiate channelization however this approach produces different realizations of stream network for different thresholds which is problematic when the upstream contributing area is not unique but varies spatially and is essentially unknown by assuming a single basin wide minimum threshold for the upstream contributing area we are effectively setting the basin wide drainage density a priori pelletier 2013 any additional geomorphic parameters generated from this derived stream network loses much of their physical interpretation as they are indirectly dependent upon the ill defined threshold at the outset helmlinger et al 1993 more recent methods of predicting channel networks from dems seek to identify channel head locations using curvature based techniques such as geonet passalacqua et al 2010 sangireddy et al 2016 pelletier 2013 and dreich clubb et al 2014 geonet uses a non linear perona malik filter perona and malik 1990 pelletier method deploys an adaptive wiener filter and dreich operates on the tangential curvature of transformed longitudinal stream profiles these methods have shown promising results in the identification of channel locations from high resolution dems however they also require two to three user defined parameters that may not be readily available moreover these methods are difficult to implement within a general scheme of catchment hydrologic modeling passalacqua and foufoula georgiou 2015 and clubb et al 2015 go so far as to claim that the intricacies of these algorithms are confusing even for the experts indeed the development of automated algorithms for channel detection from topographic dems is a challenging task still we need automated methods of deriving stream networks that are not dependent on arbitrary parameters in this paper we approach this challenge by supplementing raster dems with readily available vector data on stream networks examples of such vector data include stream features obtained through digitizing paper maps or aerial photography field surveys and other legacy systems these vector networks are not always collocated with dem defined channel centerlines but can still be a valuable source of information for inferring the channel locations an exact alignment between the vector network and the channels derived from dem is required in the models of catchment hydrology to model the transfer and conveyance of water sediment and chemicals uniquely from the watersheds drained by corresponding stream segment even though stream burning is a common practice to align the vector stream with dem in the process a hydrologically conditioned dem is further modified due to the etching of stream network on the dem the overarching objective of this paper is to develop conflation algorithms that fuses the known drainage pattern into a raster dem but without further modifying the hydrologically conditioned dem consequently rendering the topographic attributes derived from dem more representative of catchment characteristics the strength of our approach is that it preserves the existing topological relationships of the drainage network while simultaneously avoiding the perils of stream burning and the ambiguity related to choosing an arbitrary threshold value for channel initiation 2 background on stream conflation conflation refers to the alignment and integration of seemingly different but related sources of data to improve the quality of one or both sources the problem addressed herein is an example of vector to raster data conflation where two data sets referencing the same area are reconciled to obtain a consistent stream network that confirms the local topography defined by dems stream burning is a technique commonly used to address the issue of misalignment between vector stream networks and dems saunders 1999 one significant advantage to using the stream burning technique is that it improves the quality of the derived drainage networks in areas of flat topography or in the areas where a given dem is of poor quality da paz et al 2008 lindsay 2016 however this technique permanently alters the dem by lowering the elevation of dem pixels that intersect with the stream vector layer and thus severely compromising subsequent terrain analyses callow et al 2007 morphometric attributes such as local stream slope stream profile aspect and curvature calculated from stream burned dems are no longer representative of actual ground conditions consequently these attributes are not suitable for subsequent hydro geomorphic analyses of drainage basins other problems associated with this technique include the collision of adjacent streams and the occurrence of parallel streams in an otherwise well defined channel network lindsay 2016 several ad hoc techniques exist to adjust stream burned dems such that extracted geomorphological parameters remain useful and representative of catchment characteristics such techniques include the agree method of hellweger and maidment 1997 which adjusts areas adjacent to a stream to ensure modified dems slope towards streams the double dem burning technique promulgated by getirana et al 2009 techniques for handling lakes and wetlands presented by turcotte et al 2001 and kenny et al 2008 a carving technique introduced by soille et al 2003 for areas where a dem deviates more than a specified threshold from networks and the recently proffered topologicalbreachburn method to improve the fusion of vector stream network with topographic dems lindsay 2016 each of these techniques aims to minimize the adverse effects of stream burning nevertheless a hydrologically conditioned dem is further modified by these drainage enforcement methods stream burning implicitly assumes the vector stream network is of superior quality to the dem and tries to improve the dem by fusing a known drainage pattern with the availability of higher quality and higher resolution dems this notion no longer holds true newly acquired dems reflect current topographic conditions of watersheds and thus should better represent existing drainage patterns we thus introduce a dem stream conflation dsc algorithm as a practical alternative to the limitations of the stream burning technique dsc is based on the premise that any correction and modification of dem should be independent of etching a known drainage network a drainage network that the algorithm is tasked to derive in the first place second dsc aims to remove the subjectivity and the circular logic involved in deriving stream networks from an arbitrarily assumed contributing area threshold removing these two constraints minimize the alteration dem and simultaneously preserve the topology of the existing network the paper does not judge the quality of either a digitized vector drainage networks or that of topographic dems but seeks to answer to the following question given these two datasets with all their strengths and limitations can one devise a robust algorithm for augmenting both these products for an improved delineation of basin scale drainage networks the methodology presented in this paper provides a practical solution for the common problem of misalignment between vector stream networks and topographic dems rather than altering the general catchment modeling workflow this technique merely replaces ad hoc stream segmentation technique and improves the downstream processing steps that depend on the correct delineation of stream networks dsc is presented as a general framework that is scale independent and ensures the alignment of a vector stream networks with dems at any scale it is conceived as a way of bringing harmony to various sources of information on drainage networks such as field mapped channel heads digitized vector networks from aerial photographs satellite imagery and existing legacy data 3 material and method 3 1 study area and data the dsc algorithm is developed and tested on a catchment corresponding to a u s geological survey usgs stream gaging station 02167582 named bush river near prosperity in south carolina usa fig 1 the catchment located in the piedmont region of south carolina with an area of 298 square kilometers is a headwater watershed that is tributary to saluda river the relatively flat topography of the watershed is predominantly covered by forest and agriculture landuse classes a medium scale 1 100 000 national hydrography dataset nhd flowlines also commonly referred as bluelines is used as the source of data for vector stream layer the nhd is a comprehensive surface water vector database for the united states compiled from many sources and is continually updated stanislawski 2009 the topography data include commonly used dems such as national elevation dataset ned at 1 arc second 1 3 arc second and 1 9 arc second the shuttle radar topographic mission srtm at 3 arc second and 1 arc second and advanced spaceborne thermal emission and reflection radiometer aster global digital elevation model gdem version 2 at 1 arc second see table 1 the 1 3 arc second ned dem is the highest resolution seamless dem available for the conterminous united states highest resolution seamless dems with global coverage include the 1 arc second srtm and aster dems ned dems represent compilations from multiple sources produced by the usgs the source of srtm dem includes the interferometric radar flown onboard the endeavour mission in 2000 for 11 days the aster dem is a product of japan s ministry of economy trade and industry meti and the u s national aeronautics and space administration nasa from the stereo correlation of in track nadir and aft scenes collected by the infrared camera 3 2 methodology the flowchart in fig 2 outlines the overall steps for aligning vector stream networks with hydrologically conditioned dems the guiding principle of conflating raster dems with vector flowlines is that water should never flow from a dem pixel of lower elevation to one that is higher based on this conceptual notion the dsc algorithm initiates the flow of water on a given dem as a unit volume released at the starting node of each first order vector stream from which it traces the path of that water to its ultimate watershed outlet the loci of dem pixels traversed by water released from each first order stream equates to a network of streams corresponding to the original vector flowlines and these flowlines are in perfect alignment with the channel centerlines corresponding to a raster dem such streams follow paths of least resistance and their longitudinal profiles always exhibit monotonically decreasing elevations the design of this algorithm is motivated by the following necessities find a practical alternative to the threshold dependent ad hoc and arbitrary method of stream segmentation preserve high resolution topographic features of the hydrologically conditioned dem by avoiding the perils stream burning algorithm the dsc algorithms is aimed at working in tandem with the existing catchment modeling framework the utility of dsc is demonstrated by i replication of the original vector drainage pattern ii the derivation of a catchment scale geomorphological attributes and iii construction of monotonically decreasing longitudinal stream profiles we seek to maximize correspondence between the original and aligned drainage pattern and minimize the alterations of dem the algorithm is applied to commonly used dems of varying resolutions to establish its robustness the geomorphic attributes calculated to demonstrate the merits of dsc over the current flow accumulation based algorithms are ones commonly used for catchment scale rainfall runoff modeling using the geomorphological instantaneous unit hydrograph giuh approach kumar et al 2007 martinez et al 2010 rodriguez iturbe and valdes 1979 3 2 1 code development the dsc algorithm follows a standard geoprocessing workflow as sketched in fig 2 these tasks are automated by using arcpy python scripts in esri arcgis environment arcgis extensions such as spatial analyst and 3d analyst were used for processing of raster layers and extraction of elevation profiles the tracing of the flowpaths originating from the starting nodes of first order streams was achieved using custom numpy python routines van der walt et al 2011 routines for plotting the longitudinal profile of streams were developed using ipython pérez and granger 2007 and matplotlib python modules hunter 2007 other python libraries such as pandas geopandas and statsmodels were used for general analysis and presentation of results 3 2 2 raster processing of dem in catchment modeling typical dem processing steps include the filling of sinks the delineation of a deterministic flow direction fdr grid using d8 algorithm jenson and domingue 1988 ocallaghan and mark 1984 the calculation of a flow accumulation fac grid to ascertain the upstream contributing area for each grid and the segmentation of streams by specifying a minimum fac threshold for channelization to minimize alterations to this workflow the dsc algorithm follow this standard dem processing sequence replacing only the threshold dependent stream segmentation step with a stream network that is obtained by the technique presented in this paper this practical design choice allows us to seamlessly integrate the dsc algorithm within the existing catchment modeling frameworks 3 2 3 processing of vector flowlines to extract channel heads vector flowlines are used to infer locations of channel heads i e the starting nodes of first order streams a sequence of geoprocessing operations to find the channel head locations include the following extract the start fnode and end tnode nodes of every stream segment of the vector flowline intersect the fnodes and tnodes to get the interior fnodes switch the selection of fnodes to get the exterior fnodes the selected the fnodes are essentially the channel heads of the vector network these channel heads however may not match exactly with the channelized pixels represented by high fac grids of a dem the location uncertainty of channel heads is resolved with simple heuristics allowing a threshold of small buffer distance to snap the channel heads with high fac grid the locations of snapped flow accumulation grids are the assumed probable locations of where channels begin ideally these desired channel heads are surveyed in the field or ascertained from predictive models in geomorphology 3 2 4 tracing of aligned stream network the trace of channel heads to the outlet is based on the fdr grid both the fdr raster grid and channel heads are first exported to a numpy array a custom python routine was programmed to search for all the downstream pixels receiving flow from each of the identified channel heads the routine relies on the flow direction grid to resolve the flowpaths and the loop terminates when it reaches the outlet of the basin the resulting output of this function is a binary numpy array stream pixels are assigned a value of one and the remaining background pixels are assigned a value of zero this binary numpy array representing the stream network was then exported to esri raster grid and finally converted to a vector layer resulting stream networks should reflect known pattern of vector networks because they were predicated on the starting nodes of vector streams the network also matches the stream centerlines defined by dem because the network is traced by the fdr grid dictated by hydrologically conditioned dem 3 2 5 calculation of geomorphic attributes several geomorphic attributes were calculated to illustrate the variation of catchment specific geomorphic attributes due to the variation of contributing area thresholds dem source and dem resolution these attributes are compared with the terrain attributes derived using the dsc algorithm examined geomorphic attributes include stream order bifurcation ratio rb length ratio rl area ratio ra number of channel heads first order streams cumulative length of streams and the drainage density these geomorphic attributes form the basis of deriving the basin scale giuh bhadra et al 2008 rodriguez iturbe and valdes 1979 a runoff signature for the catchment basin given that ω is the order of stream the horton s ratios are defined mathematically as r b n ω n ω 1 r l l ω l ω 1 r a a ω a ω 1 where n is number of streams l is the average length of streams a is the average watershed area and subscript ω represent the order of the stream custom python routines were programmed to count the number of streams cumulative lengths of stream and drainage density calculation of horton s ratios were carried out by assigning the strahler ordering scheme to the network strahler 1952 and aggregating the number of stream length of stream and watershed areas drained by specific order of stream least squares fitting of the log transformed stream number average stream length and average watershed areas was used to obtain the values of rb rl and ra 3 2 6 construction of longitudinal stream profile a longitudinal steam profile is an elevation plot of stream vertices as a function of distance to the outlet while such profiles have profound significance in quantitative analysis of dominant forces driving the fluvial development of a basin antón et al 2014 our use of such profiles is purely illustrative we use these profiles to corroborate the general problem of stream misalignment and the efficacy of dsc in overcoming such limitations elevation values are extracted from the sink filled dem by using the 3d analyst arcpy function the downstream distance to the outlet and the elevation value for each of the stream vertices was tabulated using python scripts matplotlib python library was used to plot the actual longitudinal profiles of the stream generally the stream profiles extracted from dem require some smoothing operation to remove the unrealistic peaks but dsc aligned stream profiles do not require such corrections profiles of the original and aligned streams are constructed to corroborate the general problem of misalignment and the efficacy of dsc in overcoming such misalignment issues profiles of the dsc aligned streams extracted from both sink filled dem and the original dem is further sketched to show the amount of in filling of dem due to hydrological conditioning 4 results the premise of this work is based on the existence vector stream network to infer the general flow pattern and that of a hydrologically conditioned dem to resolve the flow direction the dsc algorithm reproduces the general flow pattern of vector flowlines that is coincident with the path of least resistance depicted by the dem dsc avoids the artifacts and further degradation of hydrologically conditioned dem due to stream burning and drainage enforcement algorithms this is achieved within a catchment and to that end a concrete application of deriving the geomorphic attributes of giuh model is presented presented first are illustrations showing the similarity between drainage patterns given by an original nhd network and a corresponding aligned network next geomorphic attributes calculated for streams segmented using the contributing area thresholds are compared with the ones derived following the dsc approach finally the robustness of the dsc conflation algorithms is demonstrated by sketching the longitudinal profiles of the dem aligned streams generated from separate dems 4 1 reproduce the known vector drainage pattern fig 3 shows a plan view of a original nhd streams and b the aligned nhd streams in a catchment in this plan view the two plots look identical the dsc algorithm indeed reproduced the original nhd drainage pattern the red circles in the fig 3 represent the interior nodes of the network ideally these nodes should only occur at the junction of two distinct streams the original nhd network is arbitrarily broken into separate segments as seen by randomly appearing interior nodes that are not the junction of two distinct stream segments these breaks are not errors per se each of the nhd segment is associated with a unique identifier nonetheless such random interruptions are problematic when using these networks for automated geomorphological analysis for instance horton s ratios cannot be calculated from this network data as the count of streams for different strahler s orders in not unique the dsc aligned stream network fig 3 b in contrast has no such random splits and is a continuous feature from the channel heads to the outlet and is therefore suitable for calculation geomorphic parameters notwithstanding this similarity the networks derived using dsc algorithm is still dependent on the quality of dems and the inadequacy of coarse dems in resolving the flowpaths manifest directly in the quality of the aligned stream network streams aligned with higher quality ned dem replicated the general nhd drainage pattern however the streams conflated with lower quality dems showed some deviation from the original nhd flowlines such flowpath oscillations were more pronounced for the streams conflated with aster dem despite these shortcomings of coarse dem the dsc derived drainage network are still functionally useful for geomorphological analysis as we will show in next section 4 2 comparison of geomorphic attributes tables 2 and 3 list the geomorphic attributes computed from a series of stream networks derived using contributing area thresholds of 1 3 5 and 7 km2 for a 30 m and 10 m ned dems respectively comparison of geomorphic attributes from the two tables reveal the relative insensitivity of these parameters to the resolution of dem the problems of contributing area technique however is apparent when comparing the variation of terrain attributes due to the variation of contributing area thresholds increasing the threshold of channelization changes the order of basin from 4th to 3rd order the values of horton s ratios channel lengths and drainage density similarly vary with contributing area thresholds differences in parameter values calculated are sufficient to beg questions as to which estimates are correct and what is a reasonable threshold for an upstream contributing area in fact many of these attributes stream length and drainage density for example follow a power law as suggested by helmlinger et al 1993 example of such a power law the variation of drainage density with contributing area threshold along with the best fitting line of power function is shown in fig 4 the high coefficient of determination r2 0 99 indeed corroborate the existence of power law still this well behaved functional relationship offers little respite in picking the most likely threshold values for channel initiation the contributing area threshold is in fact a parameter that varies in space and time and not known a priori nevertheless stream segmentation using threshold value is one of the most prevalent ways of deriving stream network from dems the impact of channel location uncertainty becomes even more pronounced when one uses these streams in models of catchment hydrology giuh for example different stream networks will result in different unit hydrographs for basin which directly impacts the magnitude and timing of runoff table 4 outlines the geomorphic attributes derived using the dsc algorithms for different types of dems in contrast to tables 2 and 3 we observe that most geomorphic attributes listed in table 4 are not sensitive to the dem source or its resolution when one examines natural stream networks the horton s ratios rb typically ranges between 3 and 5 mode of 4 rl generally varies from 1 5 to 3 and mode of 2 and ra typically varies from 3 to 6 kirchner 1993 values of horton s ratios calculated for different sources of dems in table 4 are close to the modes of natural systems the most significant variation is observed for stream lengths these differences manifest in the calculation of rl and drainage density the cumulative length of streams and hence drainage density increased slightly with the increase in resolution of dems such differences in stream length could be attributed to fractals the dem resolution sets the limits of measured length and this length increases systematically with the increase in dem resolution goulden et al 2014 a high resolution dem can better resolve the subtle meanders in the stream while the same stream will appear more straightened when obtained from a coarse dem 4 3 comparison of longitudinal profiles stream profiles are plotted to corroborate the issue of misalignment between vector streams with raster dems and to demonstrate the robustness of dsc algorithms in addressing these problems fig 5 a shows the longitudinal profiles of all the streams in the watershed ideally each profile should depict a monotonically decreasing elevation in the downslope direction however misalignments between the nhd stream network and topographic dems produce discontinuities in the profiles aligned profiles shown in fig 5 b follow the fluvial centerlines of hydrologically conditioned dem hence resulting in monotonically decreasing elevation profile the issue of misalignment is not limited to a specific source of dem or its resolution fig 6 for example shows the longitudinal profile of the one of the longest stream in the watershed extracted from different dems while the erroneous peaks are observed for all dems fig 6 a the profile discontinuities are more pronounced for the ones extracted from aster and srtm dems fig 6 b shows the longitudinal profiles of the streams aligned with dsc algorithm indeed the dsc algorithm corrected all the discontinuous appearing in fig 6 a nevertheless the corrected profiles are not exactly comparable the differences manifested in the stream profiles is the result of source dem used to assign the elevation profiles fig 6 c shows the profiles of dsc aligned streams extracted from the original dem the elevation difference between fig 6 b and c can be used to infer the amount of sink filling of dem to create a hydrologically conditioned dem it shows that aster dem has the most amount of the sink filling followed by srtm dem profile visualization as presented here has important scientific implications for geomorphological research being able to see the actual drop in the elevation of streams allow comparison of different catchments in terms of their hydrological behavior comparing the profile observed for the same catchment for various dems help us assess the quality and suitability of dems for hydrological research fig 6 for example clearly shows the systematic differences between dems a higher elevation profile is evident for both srtm and aster dems it is beyond the scope of this paper to discuss the reason but we can conjecture that strm data has some canopy penetration so the dem could reflect the presence of some vegetation aster dem is based on photogrammetric technique and hence the effect of vegetation is even more pronounced bare earth dem is required in hydrologic modeling for accurate delineation of the flowpaths our visualizations clearly show that srtm and aster dems do not adequately resolve the subtle elevation differences of the bare earth surface 5 discussion misalignment between vector stream network and topographic dem limits their use in the quantitative analysis and modeling of drainage basins the typical stream burning approach arbitrarily modifies the dem severely compromising the derivation of catchment attributes that depend on dem at the other extreme the threshold dependent stream network is associated with a high degree of uncertainty because of the difficulties in objectively defining the minimum support area threshold required for channel initiation we are not proposing to ameliorate this situation for the heterogeneity of land surface will not allow a single threshold value used throughout the landscape or even for a single basin but models of hydrology still demand unanimous delineations of streams and watersheds to make use of all kinds of available data on catchment we propose a dsc algorithm that leverages the strength of both the vector stream network and that of topographic dem until a more general approach for identifying streams are available the dsc algorithm will prove useful in the modeling of catchment hydrology the robustness of the dsc algorithms is demonstrated by replicating the known vector drainage pattern extracting a monotonically decreasing channel elevation profile and deriving a scale invariant geomorphic attributes this conflation algorithm does not require any user defined parameters nor does it make any assumptions about the quality of data the inferred channel network concurrently mimics the vector hydrography and follows the path of steepest descent and can be readily incorporated into the existing models of catchment hydrology our future work will extend the dsc algorithms to the dems conditioned through breaching and impact reduction approach lindsay and creed 2005 and to the flow paths resolved using least cost path search algorithms metz et al 2011 to reduce the adverse effects of dem conditioning acknowledgements this research was funded by the optech inc geosensing systems engineering endowment and the engineering school of sustainable infrastructure environment essie university of florida 
26428,the current state of the art in modeling forest cover change is to combine a detailed representation of biophysical processes with economic decision making principles yet there is an increasing consensus that the quality of political institutions is another relevant component in determining forest cover change patterns in this paper the global forest model is used to analyze whether including an index measuring the capacity of political institutions to guarantee sustainable natural resource management allows to improve the precision of the modeled forest cover trend the analysis shows that incorporating the index indeed allows reducing the gap between the estimated and observed forest cover trends for the 2000 to 2010 calibration period keywords global forest model forest cover change modeling institutional capacity for natural resource management 1 introduction deforestation accounts for 12 of anthropogenic co2 emissions smith et al 2014 causes biodiversity loss gibson et al 2011 soil erosion smith et al 2016 ground water stress and changes in local rainfall patterns garcia carreras and parker 2011 the literature has widely acknowledged the conversion of forest land to agricultural land as the main driver of deforestation busch and ferretti gallon 2017 gibbs et al 2010 mayaux et al 2013 this logic is typically reflected in land use change models in the global forest model g4m global v 4 0 a representative land owner makes a return maximizing land use decision based on a comparison of net present values of agricultural and forest land the biophysical properties and the agricultural suitability of the land are taken into account for the decision kindermann et al 2006 2008 after brazil s historic success in curbing deforestation by more than 70 tollefson 2015 through enhanced enforcement and fining of illegal deforestation cisneros et al 2015 hargrave and kis katos 2013 nepstad et al 2014 more recent literature on deforestation suggests that next to economic and biophysical factors the quality of political institutions is a key parameter influencing land use change decisions bhattarai and hammig 2001 bhattarai 2004 buitenzorgy and mol 2011 galinato and galinato 2012 koyuncu and yilmaz 2013 1 1 in spite of this success deforestation rates in the brazilian amazon have recently increased again by 29 between 2015 and 2016 inpe 2017 furthermore examples such as costa rica and colombia with similar gross national income income trends world bank 2015c but diverging forest cover trends from 1990 to 2015 suggest that non economic factors also significantly influence deforestation outcomes costa rica experienced a 7 5 forest cover gain and colombia a 9 forest cover loss fao 2015a b by providing intertemporal contracts institutions help generate regularity in social behavior and can prevent the overuse of common goods aoki 2001 in this article we refer to this capacity with the concept of environmental institutional quality it measures the extent to which existing political institutions lead to a sustainable use of common environmental resources in order to measure environmental institutional quality this paper builds on the fao and profor s 2011 forest governance framework that suggests that the quality of political institutions in the forest sector can be measured by three main components which are i regulatory frameworks ii planning and decision making processes and iii the implementation and enforcement of policies despite the increasing attention that is paid to the quality of political institutions in deforestation processes in the empirical literature it is still uncommon to take differences in the quality of institutions into account when modeling forest cover change trends benítez et al 2007 and wang et al 2016 represent notable exceptions magliocca et al 2015 make a strong case for using synthesis knowledge to improve process based land change models this resesarch project aims at taking this new trend in the empiricial literature into account for future forest cover change simulations of the global forest model in the global forest model all factors causing deviations of purely economically motivated land use change decisions are captured by the residual calibration factor this factor is multiplied by the estimated net present value of forestry to yield an adjusted net present value of forest land use this paper tests the hypothesis whether the residual calibration factor can be reduced by including an additional parameter into the model which measures the quality of political institutions that are relevant for the sustainable management of environmental resources like forests reducing the residual calibration factor would reduce unexplained factors influencing the forest cover change decisions and thus improve the representation of deforestation processes in the model the hypothesis is first tested through a regression analysis using the residual calibration factor for the 2000 to 2010 period as a dependent variable and an environmental institutional quality indicator as independent variables in a second step the indicator is applied to the model to evaluate in a third step whether this can substantially improve the simulation finally a test of the significance of the findings is conducted using forest cover data for 2015 the test indicates that for the countries selected a better match between the model forecast and observed forest cover change trends can be achieved by accounting for environmental institutional quality the remainder of the paper is organized as follows in section 2 the data and the construction of the environmental institutional quality indicator are presented section 3 presents the methodological steps taken to integrate the indicator into the model section 4 presents the results and section 5 discusses the relevance of the findings for other forest cover change models and ecological process models in general 2 data 2 1 environmental institutional quality index an in depth review of existing data sources reveals that comprehensive cross country datasets measuring differences in the quality of institutions affecting the management of natural resources and forests in particular are unavailable at the same time kishor and belle 2004 highlight that general governance indicators are unsuitable to measure the performance of institutions charged with the management of natural resources and forests in particular because general and specific environmental governance trends can be fundamentally different in the absence of specific measures on the quality of forest sector institutions an indicator is constructed relying upon the fao and profor s 2011 forest governance framework the index aims at representing the three pillars of the forest governance framework which are i the quality of regulatory frameworks ii the effectiveness of decision making processes and iii the enforcement of existing policies existing indicators on the quality of institutions are used as a proxy for these components and aggregated to form the composite environmental institutional quality index 2 2 in the absence of suitable specific measures on the quality of forest sector institutions we revert to more general measures on the quality environmental institutions in order to approximate the quality of forest institutions more precisely component 1 is represented by the indicator environmental policy developed by hartmann and reimann 2010 this indicator is defined as measuring the extent to which the externalization of costs or inadequate time horizons are avoided or restrained by environmental regulation hartmann and reimann 2010 indicator values are based on expert assessments and provided in an ordinal scale ranging from low 1 to high 10 component 2 is represented by the indicator number of days to start a business by porter et al 2008 which is complemented with the same indicator produced by the world bank 2015a taking data for niger the democratic republic of the congo belize tajikistan laos myanmar dominican republic brunei sierra leone togo uzbekistan liberia eritrea republic of congo gabon sudan central african republic belarus guyana bhutan suriname and gambia the indicator measures the time required to start a business by the number of calendar days needed to complete the procedures to legally operate a business world bank 2015a porter et al 2008 it refers to a standard business that is 100 domestically owned the indicator is used as a proxy for component 2 of the fao and profor s 2011 forest governance framework reflecting how long it takes for an administration to make a decision and thus how effective decision making processes are data is provided in cardinal units counting the number of days component 3 is represented by the indicator structural constraints devised by hartmann and reimann 2010 this indicator is defined as measuring structural difficulties that constrain the political leadership s governance capacity hartmann and reimann 2010 structural difficulties include a lack of educated labor force and severe infrastructural deficiencies hartmann and reimann 2010 it is therefore used as a proxy for the government s ability to implement existing environmental and forest conservation policies the indicator is based on an expert assessment on an ordinal scale ranging from 0 to 10 points a score of 10 corresponds to a low level of structural constraints table 1 presents details on data sources for each of the components the complete dataset is available upon request in order to construct the index the values of different indicators have to be normalized values for the variables number of days to start a business and structural constraints are rescaled such that for all components of the composite index a high value represents high environmental institutional quality in a second step all values are normalized to values between 0 and 1 in order to ensure that different components of the index are weighted equally all index components are then totaled and the resulting value is normalized again to make sure that upper and lower bounds for index values are defined average index values are calculated for two periods corresponding to the two simulation periods of the global forest model 2000 to 2010 for the available years and 2010 to 2015 the index is available for a total sample of 115 countries for the period 2000 to 2010 and for 116 countries for the period 2010 to 2015 indicator values range from 0 to 1 data is only available for economies in transition hartmann and reimann 2010 consequently developed countries countries in north america and western europa as well as japan australia and new zealand are excluded this limitation means that countries that score relatively well do so in comparison to all other economies in transition and not compared to developed countries furthermore the index does not provide results for very small countries especially small islands non independent territories and countries that were in a phase of civil war or unclear statehood during the calibration period this is also due to limited data availability for these countries fig 1 shows a frequency distribution of indicator values a detailed list of indicator values is available in the appendix 2 2 control variables in order to test how far the residual calibration factor can be explained by the quality index for environmental institutions account needs to be taken of alternative explanations the two main alternatives are geographic factors and differences in levels of economic development defries et al 2010 mather and needle 1998 2000 more precisely data on i land area in 1000 ha fao 2010 ii forest cover in 1000 ha fao 2010 iii gross domestic product purchasing power parity in current us world bank 2015b iv population density measured by the amount of people per sq km of land area world bank 2015d and v a dummy variable indicating whether there is tropical or subtropical vegetation in a country based on the fao s ecological zones fao 2000 are used to control for possible alternative explanations in the model averages for all control variables are calculated for the calibration period of the global forestry model 2000 2010 in order to test the regression model gross domestic product is controlled for despite the fact that it is already included in the global forest model because in the current model version gross domestic product only influences the forestry net present value indirectly through the price of wood however some economies have become less dependent on agricultural expansion for economic growth acemoglu 2008 as a result they could experience less deforestation pressure this effect can be controlled for by including an additional measure of gross domestic product into the model 3 methods the global forest model compares net present agricultural a i and forestry f i values for a grid cell resolution 0 5 0 5 to simulate the land use change decision of a representative land owner who may be a state or individual depending on the ownership regime gusti and kindermann 2011 kindermann et al 2006 2008 the subscript i indicates that the values vary for each country a net present value calculation allows to optimize investment decisions based on future expectable costs and revenues in the case of a forest manager it allows to optimize the length of the rotational period by choosing the age at which the net present value of the timber will be maximized perman et al 2003 the net present value calculation thereby allows evaluating competing long term investment options a deforestation decision is made when a i f i an afforestation decision is made when a i f i and no land use change decision is made when f i a i gusti 2015 rokityanskiy et al 2007 a i is estimated using a cobb douglas production function gusti et al 2008 the parameter is influenced by agricultural suitability population density the amount of forest area in neighboring grid cells past deforestation rates road density and the gross domestic product a i is estimated following kindermann et al 2006 and multiplied by the relative change in agricultural land prices provided by the global biosphere management model globiom havlík et al 2011 which is a global bottom up partial equilibrium land use change model the linkage between g4m and globiom is described in gusti and kindermann 2011 f i is calculated assuming that the representative forest manager optimizes the wood value which is influenced by harvesting costs transportation costs available forest biomass wood prices and the representative forest manager s discount rate as with the a i these parameters are estimated following kindermann et al 2006 and are adjusted at cell level to relative prices derived from an agricultural land use model cf gusti and kindermann 2011 the global biosphere management model havlík et al 2011 fig 2 provides a schematic illustration of the global forest model the model cannot account for spatial heterogeneity furthermore the model does not include non agricultural or non forestry land use forms the model also excludes forest areas under protected area status based on the world database on protected areas iucn and unep wcmc 2006 the global forest model is calibrated to match country level deforestation and afforestation data based on the fao s forest resources assessment for the period from 2000 to 2010 fao fra 2015 within a country values are assigned to cells according to hansen et al 2013 in the model the residual calibration factor r c f i captures all factors causing deviations of purely economically motivated land use change decisions these calibration values again vary from one country to the other hence we use the subscript i in our notation it is multiplied by the estimated net present value of forestry which yields an adjusted net present value of forestry as described by equation 1 1 f i a d j u s t e d r c f i f i e s t i m a t e d in order to estimate whether the residual calibration factor is likely to be explained by the environmental institutional quality index an ordinary least squares regression model is used 2 l n r c f i β 0 β 1 e i q i γ j c v i j ε i where e i q i is the environmental institutional quality index β 0 β 1 are coefficients that indicate the effect of the e i q i on l n r c f i holding all other factors fixed c v i j is a vector composed of the five control variables identified above c v 1 gdp purchasing power parity c v 2 land size c v 3 population density c v 4 and tropical and subtropical vegetation c v 5 γ is a coefficient that indicates the effect of each control variable j on the outcome variable holding all other factors fixed ε i is the error term a semi logarithmic specification is used based on the assumption that a one unit increase in environmental institutional quality leads to a percentage increase in the residual calibration factor and thus in the multiplier of the net present value of forestry different versions of the model in equation 2 are estimated i without control variables ii with each single control variable and iii with all control variables furthermore as a robustness test the regressions are also estimated for a restricted range of residual calibration factor values values between 0 05 and 15 the index is incorporated into the model using the following procedure the adjusted forestry net present value f i a d j u s t e d is calculated using the estimated forestry net present value multiplied by the old residual calibration factor as used in previous model applications r c f i o l d 3 f i a d j u s t e d r c f i o l d f i e s t i m a t e d the old residual calibration factor matches model simulations with observed deforestation trends and thereby accounts for all deviations from purely economic and biophysical land use change decision making parameters values of the r c f i o l d are multiplied with the composite index to achieve a residual calibration factor to be used in future model applications r c f i n e w the values are exponentially distributed therefore the logarithm of the residual calibration factor multiplied by the composite index is equal to the natural logarithm of r c f i n e w 4 l n r c f i o l d e i q i l n r c f i n e w from equation 4 it follows that 5 l n r c f i o l d l n r c f i n e w 1 e i q i the application of the index to the model provides a measure of the reduction in the residual calibration factor and thus model quality the percent reduction of the residual calibration factor at the country level is then calculated as 6 r e d u c t i o n 100 1 1 r c f i n e w 1 r c f i o l d in order to test the significance of the results found for the calibration period the percentage reduction of the residual calibration factor as given in equation 6 was again calculated using i data on environmental institutional quality for the period 2010 to 2015 to ii construct the environmental institutional quality index for the period 2010 to 2015 as derived from the regression results for the calibration period 2000 to 2010 4 results 4 1 regression analysis table 2 shows that the regression yields statistically significant results at the 0 1 level p value 0 001 when the model is tested with all control variables column 1 no control variables column 2 and each single control variable column 3 7 furthermore table 3 reports results of a robustness test with a restricted range 0 05 15 of residual calibration factor values and shows that these tests also yield statistically significant results 4 2 reduction of the residual calibration factor when using the environmental institutional quality index in the global forest model the residual calibration factor can on average be reduced by 43 for the 2000 to 2010 calibration period fig 3 shows the percentage reduction in the residual calibration factor per region regions are clustered according to the iso3166 list of countries iso 2016 with within continent differences for africa and south and latin america a relatively uniform reduction pattern for asia and the lowest influence of the environmental institutional quality index in eastern european countries a more detailed look at individual countries indicates differences within regions the reduction in the residual calibration factor is of 58 for indonesia while it is only of 22 for malaysia specifically that means that for indonesia the use of the environmental institutional quality index helps model forest cover change but for malaysia the index is not useful in reducing the residual calibration factor this is a strong indication that there must be explanations for the residual calibration factor in malaysia other than the quality of malaysia s environmental institutions which are currently not captured by the model 4 3 testing the index testing the index was complicated by two factors i missing values still present a challenge in interpreting the data provided by the 2015 forest resources assessment fao 2015a at the global level in order to provide data for countries or territories that did not provide an assessment at all the fao has used desk studies such desk study estimates correspond to 1 2 of the forest area macdicken 2015 in addition a range of countries have used projections in their national reports instead of actual inventories cf fao 2015b these projections are based on the 2010 data set ii although index values for the two calibration periods 2000 2010 and 2010 2015 are different for almost all countries no significant difference in the mean environmental institutional quality index could be observed 0 516 and 0 499 for 2000 to 2010 and 2010 to 2015 respectively mann and whitney test p 0 508 consequently the overall average percentage reduction in the residual calibration factor does not change significantly being 43 and 46 for 2000 to 2010 and 2010 to 2015 respectively mann and whitney test p 0 868 for individual countries however results exhibit an improvement of the model estimates for instance there is an increase in environmental institutional quality of about 26 in brazil e i q index of 0 306 and 0 387 for 2000 to 2010 and 2010 to 2015 respectively resulting in a decrease in estimated mean annual forest cover loss of 43 2282 vs 984 km2 per year for 2000 to 2010 and 2010 to 2015 respectively in line with the observed reduction in deforestation for paraguay on the other hand a decrease in environmental institutional quality by 13 index value of 0 452 and 0 293 for 2000 to 2010 and 2010 to 2015 respectively resulted in an estimated increase annual net forest cover loss of 35 242 and 325 km2 per year for 2000 to 2010 and 2010 to 2015 respectively 5 discussion the above analysis shows that accounting for differences in environmental institutional quality through the e i q i in the global forest model improves the representation of past deforestation trends while a wider application of this technique could be interesting for other ecological models data constraints currently considerably limit this potential this section discusses the findings of our analysis on the context of the broader land use change and environmental modeling literature as well as the implications of data constraints for such analysis in the future 5 1 implications for global forest modeling agarwal et al 2002 and turner et al 2016 highlight the importance of including a better representation of human decision making systems in process based forest models most innovations in forest modeling focus on the representation of ecological processes studies aim for example at better representing the effect of reduced precipitation under climate change on forests stocks fischer et al 2014 the effect of temperature rise on tree species liang and zhou 2010 or carbon storage dynamics liu and han 2009 others discuss the benefits of more complex physiological models over hybrid empirical physiological models of forest ecosystems jin et al 2016 however most model innovations stay within the realm of purely ecological processes and do not take the impact of human decision making systems into account in their analysis of the few models taking this aspect more explicitly into account most focus on behavioral aspects in the form of agent based models an 2012 alternatively they only analyze the effects of local political and institutional settings janssen et al 2000 lobianco et al 2015 rather than taking the influence of entire political systems into account in some specific cases data on national institutional quality have been incorporated into land use change models mainly through the channel of the discount rate during an earlier application of the global forest model benítez et al 2007 included country risk rating data in order to adjust discount rates to simulate afforestation investment a recent contribution by wang et al 2016 using an agro economical model also takes the quality of institutions into account by applying the discount rate in their study weak governance leads to a higher discount rate which disincentivizes investment into better technologies and consequently leads to the expansion of croplands which translates into deforestation this approach however is not based on an explicit biophysical and economic model of change in forest cover and only deals with one specific channel of influence technological change with deforestation conceived as an externality of cropland expansion with respect to the current state of the literature on forest cover change modeling it thus can be concluded that institutional quality is currently not systematically included into such analyses even though many authors agree that including this dimension more systematically makes a difference in terms of estimated deforestation outcomes this study contributes to the existing literature by analyzing the explanatory power of an index on environmental institutional quality and assessing whether contributes to reducing the residual calibration factor of the global forest model cf fig 2 while the difference in reduction of the residual calibration factor for northern and sub saharan africa 65 vs 39 for 2000 to 2010 respectively may be due to the difference in forest covered area 4 vs 40 on average per country the difference between central and south america may be accounted for by the difference in environmental institutional quality mean e i q index for 2000 to 2010 of 0 571 and 0 487 for central and south america respectively the implementation of the index into the global forest model represents a further refinement in assessing the process of deforestation preliminary tests of the extended model cf section 4 3 with yet partially uncomplete data macdicken 2015 already indicate the relevance of the inclusion of the environmental institutional quality index into the model with more data available over time and further changes in environmental institutional quality at the country regional and global level the significance of model improvement may be further demonstrated 5 2 data availability a growing number of datasets on general institutional quality has been developed over the last two decades for instance gastil 1990 gwartney et al 1996 johnson and sheehy 1995 kaufmann et al 2011 messick 1996 world bank 2014 however the time series involved are still short and older datasets have been particularly criticized for endogeneity and ordinality issues aron 2000 locke 2013 there are to date only a few datasets measuring in how far political institutions are capable to guarantee the sustainable management of environmental goods sauter 2014 brunel and levinson 2016 while datasets measuring environmental outcomes like the concentration of no2 or access to drinking water are increasingly available such as yale s environmental performance index emerson et al 2012 these indicators do not assess whether the environmental outcome is attributable to the quality of the political institutions the few existing datasets measuring for instance the stringency of environmental policies still faces limitations either because they only provide a single cross section cf the indicator on environmental stringency by dasgupta et al 2001 or because they are not based on discrete units but use surveys and provide data in ordinal scales such as the environmental policy index hartmann and reimann 2010 used in this report as a subcomponent or the world economic forums environmental policy stringency indicator browne et al 2012 furthermore to the best knowledge of the authors there is no available index which currently combines environmental policy the effectiveness of decision making on such policies and the enforcement of such policies even fewer data are available for the quality of forest sector policies and institutions existing initiatives to improve this situation mainly provide nominal data global witness 2009 wri 2015 which is however not comparable in a cross sectional analysis due to differences in nationally determined indicators and measurement standards for each country cf kishor and rosenbaum 2012 or un redd participatory governance assessment for instance situmorang et al 2012 a first attempt to provide cross country and time series data on the quality of forest institutions in discrete units is represented by the fao s datasets on the amount of people employed in the forest sector human resources within public forest institutions and forest revenue and public expenditure on forest fao 2010 while these datasets currently contain many missing entries they are likely to become more reliable and broadly available in the future departing from this situation the environmental institutional quality index constructed in this study builds on existing data on environmental policy and combines them with measures on the effectiveness of decision making and enforcement the index thus presents an innovation in this regard however in the absence of specific data on the quality of forest sector institutions results have to be treated with caution a second limitation of this analysis concerns the quality of forest cover data provided by the fao forest resources assessment that have been used for the calibration of the global forest model especially for earlier data different authors report heterogeneity in reporting standards definitions and data collection methods angelsen and kaimowitz 1999 bhattarai 2004 grainger 1996 mather and needle 1998 hansen et al 2013 provide deforestation data based on landsat satellite images and thus presents an alternative however it does not distinguish between plantations and natural forests tropek et al 2014 and counts all forms of forest cover change as deforestation fao data are therefore still widely used in forest cover change studies in summary the global forest model in the extended version including the environmental institutional quality index g4m global v 4 1 shows that the forest management strategy for a representative forest planner looks different for countries at different stages of institutional development this is taken into account by adjusting the value of forestry accordingly through the environmental institutional quality index capturing these non linear effects provides an improved reflection of the complex interaction of environmental institutions economic pressures on forests and deforestation provided that more and better data become available in the future the model could simulate the forest conserving effect of environmental institutional quality independent of economic deforestation drivers in addition models addressing processes other than forests e g hydrological models could benefit from applying the same methodology developed here in order to improve their match between model estimate and observation this approach could allow future ecological models to go beyond purely biophysical and economic parameters and move towards a more comprehensive representation of environmental degradation processes 6 conclusion incorporating an indicator on environmental institutional quality into the global forest model significantly reduces the residual calibration factor of the model for the period 2000 to 2010 first tests for the subsequent calibration period 2010 2015 using data from the fao 2015 forest resources assessment 2015a show that including the index can contribute to a better forecast of deforestation trends future research should concentrate on providing better data on the quality of institutions that are necessary to manage natural resources sustainably in particular more data would be necessary on the quality of specific institutions in the forest sector provided that more such data will be made available the here proposed approach could also be useful for other types of ecological models for instance hydrological soil or fisheries models improved data availability would also enable scenarios on different evolutions of the quality of environmental institutions to be constructed to determine their respective impact on the ecological system acknowledgments funding this work was financially supported by the german national member organization of the international institute for applied systems analysis iiasa and carried out during the young scientists summer program yssp 2015 it was furthermore supported by the project options market and risk reduction tools for redd funded by the norwegian agency for development cooperation norad appendix table 4 index values for the two calibration periods table 4 country e i q index 2000 2010 e i q index 2010 2015 mauritania 0 3171394 0 3673393 papua new guinea 0 397242 0 3200316 pakistan 0 3721446 0 3878617 democratic republic of the congo 0 0 0730059 nigeria 0 3254328 0 2786485 rwanda 0 4775212 0 4751759 liberia 0 2439197 0 3282564 ethiopia 0 3739209 0 3852964 nepal 0 3939269 0 361145 botswana 0 4354828 0 5439387 togo 0 2553422 0 2957524 benin 0 3671045 0 4067261 burundi 0 3016624 0 348381 el salvador 0 5285966 0 4975285 kenya 0 3973252 0 3742531 lesotho 0 3564456 0 3211012 burkina faso 0 3892538 0 3381198 namibia 0 455623 0 4776162 republic of the congo 0 2344352 0 2141114 senegal 0 4362165 0 5074613 eritrea 0 3093842 0 1046131 ghana 0 5171459 0 5322384 sierra leone 0 3404256 0 2940403 cambodia 0 2094748 0 0903175 cameroon 0 4537116 0 4468637 sri lanka 0 5155814 0 5065228 mali 0 3855268 0 3956202 chad 0 210749 0 1335523 zimbabwe 0 2122357 0 1504458 zambia 0 4673449 0 381339 singapore 1 0 9567183 thailand 0 6599068 0 586845 haiti 0 nicaragua 0 50863 0 4593461 honduras 0 4804755 0 4292507 venezuela 0 26084 0 1356171 malaysia 0 6873467 0 700047 myanmar 0 1650243 laos 0 2643547 0 3594023 algeria 0 4719794 0 4494916 indonesia 0 3375796 0 3797591 tajikistan 0 2592033 0 2863131 mexico 0 6058961 0 6014391 bolivia 0 4534022 0 376662 uganda 0 5104258 0 4256843 dominican republic 0 5174142 0 5356953 jamaica 0 7170074 0 6456125 bahrain 0 6617238 czech republic 0 938825 0 9591271 slovenia 0 9056307 1 slovakia 0 8934652 0 8577351 guatemala 0 4862107 0 3601595 madagascar 0 5631235 0 4000313 lebanon 0 509325 0 3970593 latvia 0 8653687 0 8754419 table 5 index values for the two calibration periods continued table 5 country e i q index 2000 2010 e i q index 2010 2015 latvia 0 8653687 0 8754419 moldova 0 4540012 0 5235101 belarus 0 5499613 0 6054799 poland 0 8415589 0 8256844 panama 0 6270987 0 6235257 kuwait 0 531165 0 5110277 bangladesh 0 4167516 0 5327546 lithuania 0 8814737 0 9223057 mauritius 0 7789161 0 7735648 croatia 0 8207038 0 8955733 azerbaijan 0 4634438 0 6014704 ecuador 0 4232783 0 4867511 iran 0 4513364 0 4559049 armenia 0 6212281 0 6058814 angola 0 2535988 0 3708744 south africa 0 66122 0 5967152 côte d ivoire 0 3283491 0 3345847 turkey 0 6914983 0 6706398 morocco 0 4739097 0 4572501 yemen 0 2734554 hungary 0 959854 0 9515407 costa rica 0 6696005 0 6983576 guinea 0 3402159 sudan 0 2735806 0 200871 qatar 0 7174708 0 7755827 romania 0 7935344 0 7902237 south korea 0 9171007 0 9463006 jordan 0 5447595 0 4587204 bulgaria 0 737747 0 7702487 ukraine 0 5610575 0 5509776 malawi 0 3186362 0 253496 central african republic 0 2935574 0 2317163 estonia 0 8754485 0 8977788 united arab emirates 0 626616 0 6542469 colombia 0 4310604 0 4336618 russia 0 4972755 0 4449241 kazakhstan 0 6145857 0 5717191 chile 0 7488309 0 7992648 argentina 0 6018605 0 5891444 mozambique 0 3887711 0 408697 bhutan 0 584792 0 5989641 china 0 5049224 0 4652588 peru 0 4705113 0 6214923 uruguay 0 7216804 0 8977788 paraguay 0 4518384 0 3933052 brazil 0 3061037 0 3870014 georgia 0 5749223 0 5707805 vietnam 0 4604315 0 5547631 philippines 0 4962905 0 5462224 oman 0 6586711 0 6646958 mongolia 0 4352315 0 4145785 albania 0 5147323 0 5567183 egypt 0 4931621 0 4721101 tanzania 0 3990634 0 3361489 serbia 0 6952302 0 7343814 saudi arabia 0 5708622 0 5743626 bosnia and herzegovina 0 5386382 0 5842953 india 0 5081084 0 5111216 macedonia 0 6102987 libya 0 6171345 0 5105584 kyrgyzstan 0 475841 0 417613 tunisia 0 6642132 0 5517285 uzbekistan 0 4350021 0 3954238 montenegro 0 6295896 niger 0 3107071 taiwan 0 8139259 
26428,the current state of the art in modeling forest cover change is to combine a detailed representation of biophysical processes with economic decision making principles yet there is an increasing consensus that the quality of political institutions is another relevant component in determining forest cover change patterns in this paper the global forest model is used to analyze whether including an index measuring the capacity of political institutions to guarantee sustainable natural resource management allows to improve the precision of the modeled forest cover trend the analysis shows that incorporating the index indeed allows reducing the gap between the estimated and observed forest cover trends for the 2000 to 2010 calibration period keywords global forest model forest cover change modeling institutional capacity for natural resource management 1 introduction deforestation accounts for 12 of anthropogenic co2 emissions smith et al 2014 causes biodiversity loss gibson et al 2011 soil erosion smith et al 2016 ground water stress and changes in local rainfall patterns garcia carreras and parker 2011 the literature has widely acknowledged the conversion of forest land to agricultural land as the main driver of deforestation busch and ferretti gallon 2017 gibbs et al 2010 mayaux et al 2013 this logic is typically reflected in land use change models in the global forest model g4m global v 4 0 a representative land owner makes a return maximizing land use decision based on a comparison of net present values of agricultural and forest land the biophysical properties and the agricultural suitability of the land are taken into account for the decision kindermann et al 2006 2008 after brazil s historic success in curbing deforestation by more than 70 tollefson 2015 through enhanced enforcement and fining of illegal deforestation cisneros et al 2015 hargrave and kis katos 2013 nepstad et al 2014 more recent literature on deforestation suggests that next to economic and biophysical factors the quality of political institutions is a key parameter influencing land use change decisions bhattarai and hammig 2001 bhattarai 2004 buitenzorgy and mol 2011 galinato and galinato 2012 koyuncu and yilmaz 2013 1 1 in spite of this success deforestation rates in the brazilian amazon have recently increased again by 29 between 2015 and 2016 inpe 2017 furthermore examples such as costa rica and colombia with similar gross national income income trends world bank 2015c but diverging forest cover trends from 1990 to 2015 suggest that non economic factors also significantly influence deforestation outcomes costa rica experienced a 7 5 forest cover gain and colombia a 9 forest cover loss fao 2015a b by providing intertemporal contracts institutions help generate regularity in social behavior and can prevent the overuse of common goods aoki 2001 in this article we refer to this capacity with the concept of environmental institutional quality it measures the extent to which existing political institutions lead to a sustainable use of common environmental resources in order to measure environmental institutional quality this paper builds on the fao and profor s 2011 forest governance framework that suggests that the quality of political institutions in the forest sector can be measured by three main components which are i regulatory frameworks ii planning and decision making processes and iii the implementation and enforcement of policies despite the increasing attention that is paid to the quality of political institutions in deforestation processes in the empirical literature it is still uncommon to take differences in the quality of institutions into account when modeling forest cover change trends benítez et al 2007 and wang et al 2016 represent notable exceptions magliocca et al 2015 make a strong case for using synthesis knowledge to improve process based land change models this resesarch project aims at taking this new trend in the empiricial literature into account for future forest cover change simulations of the global forest model in the global forest model all factors causing deviations of purely economically motivated land use change decisions are captured by the residual calibration factor this factor is multiplied by the estimated net present value of forestry to yield an adjusted net present value of forest land use this paper tests the hypothesis whether the residual calibration factor can be reduced by including an additional parameter into the model which measures the quality of political institutions that are relevant for the sustainable management of environmental resources like forests reducing the residual calibration factor would reduce unexplained factors influencing the forest cover change decisions and thus improve the representation of deforestation processes in the model the hypothesis is first tested through a regression analysis using the residual calibration factor for the 2000 to 2010 period as a dependent variable and an environmental institutional quality indicator as independent variables in a second step the indicator is applied to the model to evaluate in a third step whether this can substantially improve the simulation finally a test of the significance of the findings is conducted using forest cover data for 2015 the test indicates that for the countries selected a better match between the model forecast and observed forest cover change trends can be achieved by accounting for environmental institutional quality the remainder of the paper is organized as follows in section 2 the data and the construction of the environmental institutional quality indicator are presented section 3 presents the methodological steps taken to integrate the indicator into the model section 4 presents the results and section 5 discusses the relevance of the findings for other forest cover change models and ecological process models in general 2 data 2 1 environmental institutional quality index an in depth review of existing data sources reveals that comprehensive cross country datasets measuring differences in the quality of institutions affecting the management of natural resources and forests in particular are unavailable at the same time kishor and belle 2004 highlight that general governance indicators are unsuitable to measure the performance of institutions charged with the management of natural resources and forests in particular because general and specific environmental governance trends can be fundamentally different in the absence of specific measures on the quality of forest sector institutions an indicator is constructed relying upon the fao and profor s 2011 forest governance framework the index aims at representing the three pillars of the forest governance framework which are i the quality of regulatory frameworks ii the effectiveness of decision making processes and iii the enforcement of existing policies existing indicators on the quality of institutions are used as a proxy for these components and aggregated to form the composite environmental institutional quality index 2 2 in the absence of suitable specific measures on the quality of forest sector institutions we revert to more general measures on the quality environmental institutions in order to approximate the quality of forest institutions more precisely component 1 is represented by the indicator environmental policy developed by hartmann and reimann 2010 this indicator is defined as measuring the extent to which the externalization of costs or inadequate time horizons are avoided or restrained by environmental regulation hartmann and reimann 2010 indicator values are based on expert assessments and provided in an ordinal scale ranging from low 1 to high 10 component 2 is represented by the indicator number of days to start a business by porter et al 2008 which is complemented with the same indicator produced by the world bank 2015a taking data for niger the democratic republic of the congo belize tajikistan laos myanmar dominican republic brunei sierra leone togo uzbekistan liberia eritrea republic of congo gabon sudan central african republic belarus guyana bhutan suriname and gambia the indicator measures the time required to start a business by the number of calendar days needed to complete the procedures to legally operate a business world bank 2015a porter et al 2008 it refers to a standard business that is 100 domestically owned the indicator is used as a proxy for component 2 of the fao and profor s 2011 forest governance framework reflecting how long it takes for an administration to make a decision and thus how effective decision making processes are data is provided in cardinal units counting the number of days component 3 is represented by the indicator structural constraints devised by hartmann and reimann 2010 this indicator is defined as measuring structural difficulties that constrain the political leadership s governance capacity hartmann and reimann 2010 structural difficulties include a lack of educated labor force and severe infrastructural deficiencies hartmann and reimann 2010 it is therefore used as a proxy for the government s ability to implement existing environmental and forest conservation policies the indicator is based on an expert assessment on an ordinal scale ranging from 0 to 10 points a score of 10 corresponds to a low level of structural constraints table 1 presents details on data sources for each of the components the complete dataset is available upon request in order to construct the index the values of different indicators have to be normalized values for the variables number of days to start a business and structural constraints are rescaled such that for all components of the composite index a high value represents high environmental institutional quality in a second step all values are normalized to values between 0 and 1 in order to ensure that different components of the index are weighted equally all index components are then totaled and the resulting value is normalized again to make sure that upper and lower bounds for index values are defined average index values are calculated for two periods corresponding to the two simulation periods of the global forest model 2000 to 2010 for the available years and 2010 to 2015 the index is available for a total sample of 115 countries for the period 2000 to 2010 and for 116 countries for the period 2010 to 2015 indicator values range from 0 to 1 data is only available for economies in transition hartmann and reimann 2010 consequently developed countries countries in north america and western europa as well as japan australia and new zealand are excluded this limitation means that countries that score relatively well do so in comparison to all other economies in transition and not compared to developed countries furthermore the index does not provide results for very small countries especially small islands non independent territories and countries that were in a phase of civil war or unclear statehood during the calibration period this is also due to limited data availability for these countries fig 1 shows a frequency distribution of indicator values a detailed list of indicator values is available in the appendix 2 2 control variables in order to test how far the residual calibration factor can be explained by the quality index for environmental institutions account needs to be taken of alternative explanations the two main alternatives are geographic factors and differences in levels of economic development defries et al 2010 mather and needle 1998 2000 more precisely data on i land area in 1000 ha fao 2010 ii forest cover in 1000 ha fao 2010 iii gross domestic product purchasing power parity in current us world bank 2015b iv population density measured by the amount of people per sq km of land area world bank 2015d and v a dummy variable indicating whether there is tropical or subtropical vegetation in a country based on the fao s ecological zones fao 2000 are used to control for possible alternative explanations in the model averages for all control variables are calculated for the calibration period of the global forestry model 2000 2010 in order to test the regression model gross domestic product is controlled for despite the fact that it is already included in the global forest model because in the current model version gross domestic product only influences the forestry net present value indirectly through the price of wood however some economies have become less dependent on agricultural expansion for economic growth acemoglu 2008 as a result they could experience less deforestation pressure this effect can be controlled for by including an additional measure of gross domestic product into the model 3 methods the global forest model compares net present agricultural a i and forestry f i values for a grid cell resolution 0 5 0 5 to simulate the land use change decision of a representative land owner who may be a state or individual depending on the ownership regime gusti and kindermann 2011 kindermann et al 2006 2008 the subscript i indicates that the values vary for each country a net present value calculation allows to optimize investment decisions based on future expectable costs and revenues in the case of a forest manager it allows to optimize the length of the rotational period by choosing the age at which the net present value of the timber will be maximized perman et al 2003 the net present value calculation thereby allows evaluating competing long term investment options a deforestation decision is made when a i f i an afforestation decision is made when a i f i and no land use change decision is made when f i a i gusti 2015 rokityanskiy et al 2007 a i is estimated using a cobb douglas production function gusti et al 2008 the parameter is influenced by agricultural suitability population density the amount of forest area in neighboring grid cells past deforestation rates road density and the gross domestic product a i is estimated following kindermann et al 2006 and multiplied by the relative change in agricultural land prices provided by the global biosphere management model globiom havlík et al 2011 which is a global bottom up partial equilibrium land use change model the linkage between g4m and globiom is described in gusti and kindermann 2011 f i is calculated assuming that the representative forest manager optimizes the wood value which is influenced by harvesting costs transportation costs available forest biomass wood prices and the representative forest manager s discount rate as with the a i these parameters are estimated following kindermann et al 2006 and are adjusted at cell level to relative prices derived from an agricultural land use model cf gusti and kindermann 2011 the global biosphere management model havlík et al 2011 fig 2 provides a schematic illustration of the global forest model the model cannot account for spatial heterogeneity furthermore the model does not include non agricultural or non forestry land use forms the model also excludes forest areas under protected area status based on the world database on protected areas iucn and unep wcmc 2006 the global forest model is calibrated to match country level deforestation and afforestation data based on the fao s forest resources assessment for the period from 2000 to 2010 fao fra 2015 within a country values are assigned to cells according to hansen et al 2013 in the model the residual calibration factor r c f i captures all factors causing deviations of purely economically motivated land use change decisions these calibration values again vary from one country to the other hence we use the subscript i in our notation it is multiplied by the estimated net present value of forestry which yields an adjusted net present value of forestry as described by equation 1 1 f i a d j u s t e d r c f i f i e s t i m a t e d in order to estimate whether the residual calibration factor is likely to be explained by the environmental institutional quality index an ordinary least squares regression model is used 2 l n r c f i β 0 β 1 e i q i γ j c v i j ε i where e i q i is the environmental institutional quality index β 0 β 1 are coefficients that indicate the effect of the e i q i on l n r c f i holding all other factors fixed c v i j is a vector composed of the five control variables identified above c v 1 gdp purchasing power parity c v 2 land size c v 3 population density c v 4 and tropical and subtropical vegetation c v 5 γ is a coefficient that indicates the effect of each control variable j on the outcome variable holding all other factors fixed ε i is the error term a semi logarithmic specification is used based on the assumption that a one unit increase in environmental institutional quality leads to a percentage increase in the residual calibration factor and thus in the multiplier of the net present value of forestry different versions of the model in equation 2 are estimated i without control variables ii with each single control variable and iii with all control variables furthermore as a robustness test the regressions are also estimated for a restricted range of residual calibration factor values values between 0 05 and 15 the index is incorporated into the model using the following procedure the adjusted forestry net present value f i a d j u s t e d is calculated using the estimated forestry net present value multiplied by the old residual calibration factor as used in previous model applications r c f i o l d 3 f i a d j u s t e d r c f i o l d f i e s t i m a t e d the old residual calibration factor matches model simulations with observed deforestation trends and thereby accounts for all deviations from purely economic and biophysical land use change decision making parameters values of the r c f i o l d are multiplied with the composite index to achieve a residual calibration factor to be used in future model applications r c f i n e w the values are exponentially distributed therefore the logarithm of the residual calibration factor multiplied by the composite index is equal to the natural logarithm of r c f i n e w 4 l n r c f i o l d e i q i l n r c f i n e w from equation 4 it follows that 5 l n r c f i o l d l n r c f i n e w 1 e i q i the application of the index to the model provides a measure of the reduction in the residual calibration factor and thus model quality the percent reduction of the residual calibration factor at the country level is then calculated as 6 r e d u c t i o n 100 1 1 r c f i n e w 1 r c f i o l d in order to test the significance of the results found for the calibration period the percentage reduction of the residual calibration factor as given in equation 6 was again calculated using i data on environmental institutional quality for the period 2010 to 2015 to ii construct the environmental institutional quality index for the period 2010 to 2015 as derived from the regression results for the calibration period 2000 to 2010 4 results 4 1 regression analysis table 2 shows that the regression yields statistically significant results at the 0 1 level p value 0 001 when the model is tested with all control variables column 1 no control variables column 2 and each single control variable column 3 7 furthermore table 3 reports results of a robustness test with a restricted range 0 05 15 of residual calibration factor values and shows that these tests also yield statistically significant results 4 2 reduction of the residual calibration factor when using the environmental institutional quality index in the global forest model the residual calibration factor can on average be reduced by 43 for the 2000 to 2010 calibration period fig 3 shows the percentage reduction in the residual calibration factor per region regions are clustered according to the iso3166 list of countries iso 2016 with within continent differences for africa and south and latin america a relatively uniform reduction pattern for asia and the lowest influence of the environmental institutional quality index in eastern european countries a more detailed look at individual countries indicates differences within regions the reduction in the residual calibration factor is of 58 for indonesia while it is only of 22 for malaysia specifically that means that for indonesia the use of the environmental institutional quality index helps model forest cover change but for malaysia the index is not useful in reducing the residual calibration factor this is a strong indication that there must be explanations for the residual calibration factor in malaysia other than the quality of malaysia s environmental institutions which are currently not captured by the model 4 3 testing the index testing the index was complicated by two factors i missing values still present a challenge in interpreting the data provided by the 2015 forest resources assessment fao 2015a at the global level in order to provide data for countries or territories that did not provide an assessment at all the fao has used desk studies such desk study estimates correspond to 1 2 of the forest area macdicken 2015 in addition a range of countries have used projections in their national reports instead of actual inventories cf fao 2015b these projections are based on the 2010 data set ii although index values for the two calibration periods 2000 2010 and 2010 2015 are different for almost all countries no significant difference in the mean environmental institutional quality index could be observed 0 516 and 0 499 for 2000 to 2010 and 2010 to 2015 respectively mann and whitney test p 0 508 consequently the overall average percentage reduction in the residual calibration factor does not change significantly being 43 and 46 for 2000 to 2010 and 2010 to 2015 respectively mann and whitney test p 0 868 for individual countries however results exhibit an improvement of the model estimates for instance there is an increase in environmental institutional quality of about 26 in brazil e i q index of 0 306 and 0 387 for 2000 to 2010 and 2010 to 2015 respectively resulting in a decrease in estimated mean annual forest cover loss of 43 2282 vs 984 km2 per year for 2000 to 2010 and 2010 to 2015 respectively in line with the observed reduction in deforestation for paraguay on the other hand a decrease in environmental institutional quality by 13 index value of 0 452 and 0 293 for 2000 to 2010 and 2010 to 2015 respectively resulted in an estimated increase annual net forest cover loss of 35 242 and 325 km2 per year for 2000 to 2010 and 2010 to 2015 respectively 5 discussion the above analysis shows that accounting for differences in environmental institutional quality through the e i q i in the global forest model improves the representation of past deforestation trends while a wider application of this technique could be interesting for other ecological models data constraints currently considerably limit this potential this section discusses the findings of our analysis on the context of the broader land use change and environmental modeling literature as well as the implications of data constraints for such analysis in the future 5 1 implications for global forest modeling agarwal et al 2002 and turner et al 2016 highlight the importance of including a better representation of human decision making systems in process based forest models most innovations in forest modeling focus on the representation of ecological processes studies aim for example at better representing the effect of reduced precipitation under climate change on forests stocks fischer et al 2014 the effect of temperature rise on tree species liang and zhou 2010 or carbon storage dynamics liu and han 2009 others discuss the benefits of more complex physiological models over hybrid empirical physiological models of forest ecosystems jin et al 2016 however most model innovations stay within the realm of purely ecological processes and do not take the impact of human decision making systems into account in their analysis of the few models taking this aspect more explicitly into account most focus on behavioral aspects in the form of agent based models an 2012 alternatively they only analyze the effects of local political and institutional settings janssen et al 2000 lobianco et al 2015 rather than taking the influence of entire political systems into account in some specific cases data on national institutional quality have been incorporated into land use change models mainly through the channel of the discount rate during an earlier application of the global forest model benítez et al 2007 included country risk rating data in order to adjust discount rates to simulate afforestation investment a recent contribution by wang et al 2016 using an agro economical model also takes the quality of institutions into account by applying the discount rate in their study weak governance leads to a higher discount rate which disincentivizes investment into better technologies and consequently leads to the expansion of croplands which translates into deforestation this approach however is not based on an explicit biophysical and economic model of change in forest cover and only deals with one specific channel of influence technological change with deforestation conceived as an externality of cropland expansion with respect to the current state of the literature on forest cover change modeling it thus can be concluded that institutional quality is currently not systematically included into such analyses even though many authors agree that including this dimension more systematically makes a difference in terms of estimated deforestation outcomes this study contributes to the existing literature by analyzing the explanatory power of an index on environmental institutional quality and assessing whether contributes to reducing the residual calibration factor of the global forest model cf fig 2 while the difference in reduction of the residual calibration factor for northern and sub saharan africa 65 vs 39 for 2000 to 2010 respectively may be due to the difference in forest covered area 4 vs 40 on average per country the difference between central and south america may be accounted for by the difference in environmental institutional quality mean e i q index for 2000 to 2010 of 0 571 and 0 487 for central and south america respectively the implementation of the index into the global forest model represents a further refinement in assessing the process of deforestation preliminary tests of the extended model cf section 4 3 with yet partially uncomplete data macdicken 2015 already indicate the relevance of the inclusion of the environmental institutional quality index into the model with more data available over time and further changes in environmental institutional quality at the country regional and global level the significance of model improvement may be further demonstrated 5 2 data availability a growing number of datasets on general institutional quality has been developed over the last two decades for instance gastil 1990 gwartney et al 1996 johnson and sheehy 1995 kaufmann et al 2011 messick 1996 world bank 2014 however the time series involved are still short and older datasets have been particularly criticized for endogeneity and ordinality issues aron 2000 locke 2013 there are to date only a few datasets measuring in how far political institutions are capable to guarantee the sustainable management of environmental goods sauter 2014 brunel and levinson 2016 while datasets measuring environmental outcomes like the concentration of no2 or access to drinking water are increasingly available such as yale s environmental performance index emerson et al 2012 these indicators do not assess whether the environmental outcome is attributable to the quality of the political institutions the few existing datasets measuring for instance the stringency of environmental policies still faces limitations either because they only provide a single cross section cf the indicator on environmental stringency by dasgupta et al 2001 or because they are not based on discrete units but use surveys and provide data in ordinal scales such as the environmental policy index hartmann and reimann 2010 used in this report as a subcomponent or the world economic forums environmental policy stringency indicator browne et al 2012 furthermore to the best knowledge of the authors there is no available index which currently combines environmental policy the effectiveness of decision making on such policies and the enforcement of such policies even fewer data are available for the quality of forest sector policies and institutions existing initiatives to improve this situation mainly provide nominal data global witness 2009 wri 2015 which is however not comparable in a cross sectional analysis due to differences in nationally determined indicators and measurement standards for each country cf kishor and rosenbaum 2012 or un redd participatory governance assessment for instance situmorang et al 2012 a first attempt to provide cross country and time series data on the quality of forest institutions in discrete units is represented by the fao s datasets on the amount of people employed in the forest sector human resources within public forest institutions and forest revenue and public expenditure on forest fao 2010 while these datasets currently contain many missing entries they are likely to become more reliable and broadly available in the future departing from this situation the environmental institutional quality index constructed in this study builds on existing data on environmental policy and combines them with measures on the effectiveness of decision making and enforcement the index thus presents an innovation in this regard however in the absence of specific data on the quality of forest sector institutions results have to be treated with caution a second limitation of this analysis concerns the quality of forest cover data provided by the fao forest resources assessment that have been used for the calibration of the global forest model especially for earlier data different authors report heterogeneity in reporting standards definitions and data collection methods angelsen and kaimowitz 1999 bhattarai 2004 grainger 1996 mather and needle 1998 hansen et al 2013 provide deforestation data based on landsat satellite images and thus presents an alternative however it does not distinguish between plantations and natural forests tropek et al 2014 and counts all forms of forest cover change as deforestation fao data are therefore still widely used in forest cover change studies in summary the global forest model in the extended version including the environmental institutional quality index g4m global v 4 1 shows that the forest management strategy for a representative forest planner looks different for countries at different stages of institutional development this is taken into account by adjusting the value of forestry accordingly through the environmental institutional quality index capturing these non linear effects provides an improved reflection of the complex interaction of environmental institutions economic pressures on forests and deforestation provided that more and better data become available in the future the model could simulate the forest conserving effect of environmental institutional quality independent of economic deforestation drivers in addition models addressing processes other than forests e g hydrological models could benefit from applying the same methodology developed here in order to improve their match between model estimate and observation this approach could allow future ecological models to go beyond purely biophysical and economic parameters and move towards a more comprehensive representation of environmental degradation processes 6 conclusion incorporating an indicator on environmental institutional quality into the global forest model significantly reduces the residual calibration factor of the model for the period 2000 to 2010 first tests for the subsequent calibration period 2010 2015 using data from the fao 2015 forest resources assessment 2015a show that including the index can contribute to a better forecast of deforestation trends future research should concentrate on providing better data on the quality of institutions that are necessary to manage natural resources sustainably in particular more data would be necessary on the quality of specific institutions in the forest sector provided that more such data will be made available the here proposed approach could also be useful for other types of ecological models for instance hydrological soil or fisheries models improved data availability would also enable scenarios on different evolutions of the quality of environmental institutions to be constructed to determine their respective impact on the ecological system acknowledgments funding this work was financially supported by the german national member organization of the international institute for applied systems analysis iiasa and carried out during the young scientists summer program yssp 2015 it was furthermore supported by the project options market and risk reduction tools for redd funded by the norwegian agency for development cooperation norad appendix table 4 index values for the two calibration periods table 4 country e i q index 2000 2010 e i q index 2010 2015 mauritania 0 3171394 0 3673393 papua new guinea 0 397242 0 3200316 pakistan 0 3721446 0 3878617 democratic republic of the congo 0 0 0730059 nigeria 0 3254328 0 2786485 rwanda 0 4775212 0 4751759 liberia 0 2439197 0 3282564 ethiopia 0 3739209 0 3852964 nepal 0 3939269 0 361145 botswana 0 4354828 0 5439387 togo 0 2553422 0 2957524 benin 0 3671045 0 4067261 burundi 0 3016624 0 348381 el salvador 0 5285966 0 4975285 kenya 0 3973252 0 3742531 lesotho 0 3564456 0 3211012 burkina faso 0 3892538 0 3381198 namibia 0 455623 0 4776162 republic of the congo 0 2344352 0 2141114 senegal 0 4362165 0 5074613 eritrea 0 3093842 0 1046131 ghana 0 5171459 0 5322384 sierra leone 0 3404256 0 2940403 cambodia 0 2094748 0 0903175 cameroon 0 4537116 0 4468637 sri lanka 0 5155814 0 5065228 mali 0 3855268 0 3956202 chad 0 210749 0 1335523 zimbabwe 0 2122357 0 1504458 zambia 0 4673449 0 381339 singapore 1 0 9567183 thailand 0 6599068 0 586845 haiti 0 nicaragua 0 50863 0 4593461 honduras 0 4804755 0 4292507 venezuela 0 26084 0 1356171 malaysia 0 6873467 0 700047 myanmar 0 1650243 laos 0 2643547 0 3594023 algeria 0 4719794 0 4494916 indonesia 0 3375796 0 3797591 tajikistan 0 2592033 0 2863131 mexico 0 6058961 0 6014391 bolivia 0 4534022 0 376662 uganda 0 5104258 0 4256843 dominican republic 0 5174142 0 5356953 jamaica 0 7170074 0 6456125 bahrain 0 6617238 czech republic 0 938825 0 9591271 slovenia 0 9056307 1 slovakia 0 8934652 0 8577351 guatemala 0 4862107 0 3601595 madagascar 0 5631235 0 4000313 lebanon 0 509325 0 3970593 latvia 0 8653687 0 8754419 table 5 index values for the two calibration periods continued table 5 country e i q index 2000 2010 e i q index 2010 2015 latvia 0 8653687 0 8754419 moldova 0 4540012 0 5235101 belarus 0 5499613 0 6054799 poland 0 8415589 0 8256844 panama 0 6270987 0 6235257 kuwait 0 531165 0 5110277 bangladesh 0 4167516 0 5327546 lithuania 0 8814737 0 9223057 mauritius 0 7789161 0 7735648 croatia 0 8207038 0 8955733 azerbaijan 0 4634438 0 6014704 ecuador 0 4232783 0 4867511 iran 0 4513364 0 4559049 armenia 0 6212281 0 6058814 angola 0 2535988 0 3708744 south africa 0 66122 0 5967152 côte d ivoire 0 3283491 0 3345847 turkey 0 6914983 0 6706398 morocco 0 4739097 0 4572501 yemen 0 2734554 hungary 0 959854 0 9515407 costa rica 0 6696005 0 6983576 guinea 0 3402159 sudan 0 2735806 0 200871 qatar 0 7174708 0 7755827 romania 0 7935344 0 7902237 south korea 0 9171007 0 9463006 jordan 0 5447595 0 4587204 bulgaria 0 737747 0 7702487 ukraine 0 5610575 0 5509776 malawi 0 3186362 0 253496 central african republic 0 2935574 0 2317163 estonia 0 8754485 0 8977788 united arab emirates 0 626616 0 6542469 colombia 0 4310604 0 4336618 russia 0 4972755 0 4449241 kazakhstan 0 6145857 0 5717191 chile 0 7488309 0 7992648 argentina 0 6018605 0 5891444 mozambique 0 3887711 0 408697 bhutan 0 584792 0 5989641 china 0 5049224 0 4652588 peru 0 4705113 0 6214923 uruguay 0 7216804 0 8977788 paraguay 0 4518384 0 3933052 brazil 0 3061037 0 3870014 georgia 0 5749223 0 5707805 vietnam 0 4604315 0 5547631 philippines 0 4962905 0 5462224 oman 0 6586711 0 6646958 mongolia 0 4352315 0 4145785 albania 0 5147323 0 5567183 egypt 0 4931621 0 4721101 tanzania 0 3990634 0 3361489 serbia 0 6952302 0 7343814 saudi arabia 0 5708622 0 5743626 bosnia and herzegovina 0 5386382 0 5842953 india 0 5081084 0 5111216 macedonia 0 6102987 libya 0 6171345 0 5105584 kyrgyzstan 0 475841 0 417613 tunisia 0 6642132 0 5517285 uzbekistan 0 4350021 0 3954238 montenegro 0 6295896 niger 0 3107071 taiwan 0 8139259 
26429,water network partitioning wnp into district meter areas allows improving pressure management water budget leaks detection compared to classical redundantly looped networks anyway wnp can significantly worsen the hydraulic performance because often many gate valves are required and the reduced set of possible paths for water flow makes the network vulnerable especially to concentrated peaks of water request hence reliably modeling the spatial and temporal distribution of water demand would allow better understanding the effects of wnp improving both network design and management aiming at taking into account the behavior of a partitioned network under spatial and temporal variability of water demand a design procedure is proposed coupling a stochastic model of water demand with novel partitioning techniques based on spectral clustering the application of the procedure to a real medium sized network shows that demand variability may significantly affect the hydraulic performance of the partitioned network evaluated by means of topological and hydraulic indices keywords water network partitioning water demand spectral clustering district meter area list of symbols cdf cumulative distribution function c d i demand coefficient of the i th dma c d t demand coefficient c d spatial mean of the demand coefficient c p peak demand coefficient cv t ratio between standard deviation of the demand coefficient at time t and mean of the demand coefficient at time t dma district metered area e l l th edge e set of network edges f 0 t probability of the event of null water demand f t probability that the water demand is not null g graph ga genetic algorithm h nodes design pressure m h i node pressure m h max maximum node pressure m h mean mean node pressure m h min minimum node pressure m i r resilience index k subset index l pipes index m total number of edges n total number of vertices n i number of vertices of the i th dma n bv number of gate valves n ec total number of edge cuts n fm number of flow meters n us number of served users of objective function p k k th subset q t actual requested demand flow l s q i water demand at the i th node t time variable v i i th vertice v set of network vertices wnp water network partitioning wdn water distribution network z i geodetic elevation at the i th node μ q daily average requested demand flow l s μ cd t mean of the demand coefficient at time t μ cp peak coefficient of the mean trend of the water demand σ cd t standard deviation of the demand coefficient at time t γ specific weight of water 1 introduction water distribution networks wdn are crucial infrastructures for social and economic development adams 2006 in the last decades these water systems faced with rising water demand and topological modifications due to change in consumer profiles ageing of the components and sometimes unplanned urban development wdns can be regarded as complex networks mays 2000 di nardo et al 2017 for some aspects due essentially to the topological complexity of their layout the non linearity of their mathematical models and the dynamic behavior of water demand in particular water demand is affected by seasonal and climatic influences shvartser et al 1993 zhou et al 2002 herrera et al 2010 and by users habits and mobility blokker et al 2010 rozos et al 2016 this dynamic behavior of water demand can produce fast variations in pressure and flow within the network which may affect structural components as pipes and junctions of the distributions systems causing breakages and leakages puust et al 2010 furthermore water pressure in parts of the water system may be occasionally reduced with a significant decrease of the level of service for the users hence for an efficient wdn management it is necessary to deal with these issues by developing and implementing strategies to maximize consumer satisfaction and minimize the efforts to reduce the costs of water distribution kapelan et al 2006 an improved wdn management is indeed required to guarantee high levels of efficiency nowadays thanks to the exponential growth in the computational power there is potential to change the traditional approach to analysis design and management of wdn from passive to proactive based on the development of new monitoring and control technologies in particular in the last decades the scientific community has proposed different approaches to improve wdn management e g alvisi and franchini 2009 wang et al 2014 exploiting the low cost availability of new remotely controlled monitoring devices di nardo et al 2014 one of these innovative approaches consists of implementing the paradigm of divide and conquer in wdn defining permanent sub regions named district meter areas dma by inserting gate valves and flow meters along some properly selected network pipes this procedure defined also as water network partitioning wnp allows dividing the network into sub systems which make easier the identification of water losses the control of district pressure the protection of the users from accidental and intentional contamination the assessment of the water balance di nardo et al 2015 however the design of a wnp is a complex challenge for operators because at least three crucial requirements must be satisfied 1 network connectivity i e each demand node of the water network must be connected to at least one water source 2 nodal minimum pressure i e each node must have a pressure equal or higher than the minimum level that allows satisfying the water demand of users 3 the number of flow meters and gate valves must be minimized to reduce costs and management complexity the second requirement results often challenging as permanent partitioning changes the original topological layout of water systems reducing the overall available pipe section because of the closure of some pipes by gate valves causing the decrease of water pressure and thus worsening the level of service offered to users different procedures have been proposed in the literature to identify the optimal wnp layout recent reviews are given in perelman et al 2015 di nardo et al 2015 essentially based on heuristic algorithms and optimization procedures generally they consist of two phases a clustering aimed at defining the shape and the dimensions of the network subsets based on different approaches among which graph theory algorithms spectral clustering multi agent approach and community structure b dividing aimed at physically partitioning the network by selecting pipes for the insertion of flow meters or gate valves based on recursive bisection procedures or on genetic algorithms usually the partitioned layouts are tested with reference to the distributed peak water demand as it is considered as one of the most onerous operating conditions for the water network anyway water distribution networks must also deal with operating conditions which require the network to be capable of delivering high demand peaks to particular nodes such concentrated peak conditions can result very challenging for a partitioned system and require a more sophisticated approach to demand spatial temporal modeling than a homogeneously distributed peak in fact the peak demand phenomenon is usually represented as simplified working conditions assuming that the maximum water request by all served users occurs at the same time in addition simplified relationships of deterministic origin are often used to estimate the entity of the peak demand a broad overview of such deterministic relationships can be found in lingireddy et al 1998 zhang et al 2005 martínez solano et al 2008 although the random nature of the peak demand was highlighted already by bao and mays 1990 indeed in the scientific literature of the new millennium several papers e g tricarico et al 2007 buchberger et al 2012 gato trinidad and gan 2012 balacco et al 2017 propose to model the peak water demand according to a probabilistic approach several of the proposed models are not limited to the maximum daily demand but they rather describe the water request trend during the day modeling also the elementary pulses which sum up to compose the overall demand at nodes e g buchberger and wu 1995 alvisi et al 2003 blokker et al 2010 however approaches modeling elementary demand pulses require the estimation of many parameters strictly depending on the habits of the inhabitants buchberger and wells 1996 gargano et al 2016a moreover the spatial and temporal variability represents an onerous challenge which requires detailed information about the served users jankovic nisic et al 2004 not easily available aim of this paper is to propose a novel methodological approach to wnp taking into account in a simplified but effective way the spatial and temporal variability of water demand and its effects on the hydraulic performance of the partitioned network to such aim the effects of spatial and temporal variability of water demand on water network partitioning are stochastically modeled therefore partitioned wdn reliability representing the ability of performing the required functions under stated conditions for a specified period of time greco et al 2012 can be investigated with reference to realistic operating conditions the proposed methodology consisting of two parts one dealing with the design of wnp the other with the evaluation of the hydraulic performance of the partitioned network under spatially and temporally variable peak demand conditions was applied to the case of a medium sized real water distribution network serving the town of parete italy first the wnp was carried out with reference to the distributed peak condition with a novel two step technique di nardo et al 2017 in which the optimal layout of dma is defined by spectral clustering and the dividing phase is carried out by identifying the positioning of gate valves least affecting the hydraulic performance of the network second the variability of the water demand was introduced by means of a recently proposed stochastic model which adopts a mixed distribution to model with parsimonious parametrization the random peak requests and is capable of reliably reproducing demand peaks in various contexts gargano et al 2016b with a monte carlo technique realistic daily trends of the flow demanded by the users were generated for each dma thus obtaining spatially variable and time shifted realizations of water demand peaks the hydraulic performance of the partitioned network was evaluated with several metrics for each generated demand distribution with specific reference to the time interval in which demand peaks occurred in the various dmas the obtained results show that spatial temporal variability of water demand may lead to operating conditions more challenging for a partitioned network than the usually adopted distributed peak therefore especially for networks characterized by low power surplus the design of network partitioning should take into account the variability of water demand 2 network partitioning under random water demand distribution the applied procedure consists of four steps described in detail hereinafter first the partitioning of the network is carried out in two phases clustering step 1 and dividing step 2 then the probability distributions of water demand are defined and a monte carlo approach is used to generate time series of water demand for each dma step 3 finally the hydraulic performances of the partitioned network are evaluated by means of various robust indices step 4 2 1 clustering phase water supply networks wsn can be modeled as a graph g v e where v is the set of n vertices v i the junctions and the delivery nodes and e is the set of m edges e l the pipes a k way graph clustering problem consists in partitioning v vertices of g into k subsets p 1 p 2 p k di nardo et al 2013 clustering is usually defined in terms of weighted undirected graphs where weights correspond to either similarity scores or distances or more generally they express the strength of the link between elements in order to define sub graphs which take into account proximity and or similarity between elements optimal graph clustering can be achieved with many procedures boccaletti et al 2006 fortunato 2010 finding a clustered layout which minimizes or maximizes an objective function defined to emphasize one or more of the clustering aims in recent years and in many research fields spectral clustering based on graph laplacian matrix spectrum von luxburg 2007 has become one of the most used clustering algorithms because it can be solved by standard linear algebra software and so it is easily implemented in this paper a recently proposed procedure for wdn partitioning has been adopted di nardo et al 2017 which allows automatically defining the optimal network clustering i e characterized by dma with similar number of nodes n i and by an edge cut set with the smallest number of pipes n e c in particular the clustering phase has been carried out with a spectral clustering technique namely the normalized spectral clustering according to shi and malik 2000 such a clustering procedure is based on the eigenvalues of the graph laplacian matrix which for a given graph is defined as the difference between the diagonal matrix with the connectivity degrees of the nodes and the adjacency matrix von luxburg 2007 2 2 dividing phase once defined the number n f m of flow meters to be inserted in the network the number of boundary pipes to be closed by gate valves is n b v n e c n f m in order to simplify the water budget computation it is better to keep n f m as low as possible di nardo et al 2016 a heuristic procedure is required in this phase tindell et al 1992 because the choice of the optimal positioning of flow meters and gate valves is a np hard problem bodlaender et al 2010 in this paper in order to minimize the alteration of the hydraulic performance caused by the closure of some network pipes the following objective function o f has been defined 1 o f m a x γ i 1 n z i h i q i p corresponds to the total nodal power of the network di nardo and di natale 2011 in which γ is the specific weight of water z i h i and q i are respectively the geodetic elevation the pressure head and the water demand at the i th node it is assumed that dividing by maximizing this objective function allows best preserving the hydraulic performance of the network for the operating condition of distributed peak demand the maximum of o f has been searched with a genetic algorithm g a with the following parameters individuals are defined as strings of n e c binary chromosomes corresponding to the ordered pipes of the edge cut set the value 1 of the l th chromosome indicates that a gate valve is inserted along the l th pipe while 0 corresponds to the insertion of a flow meter the g a has been carried out with 500 generations of populations consisting of 500 individuals each with a crossover percentage of 80 2 3 stochastic model of water demand the peak water demand is usually represented as a conventional operating condition which occurs at the same time for the whole wdn instead the different habits of the users lead to non homogenous spatial distribution of the water demand with the maximum water requests occurring at different times in the various districts of the wdn the larger is the served municipality the more this effect becomes evident therefore the analysis of the peak phenomenon cannot be carried out with reference to a single time but requires taking into account a time interval or even more than one if more than one peak occurs during the day to combine the time shifted demand peaks in different districts of the wdn to such aim the stochastic approach of gargano et al 2016b has been used to generate synthetic daily time series of the water demand then time intervals wide enough to take into account the shifted demand peaks of the different districts have been considered the cumulative distribution function cdf of the adopted stochastic model mixes two distributions one expressing the probability of the event of null water demand at time t f o t the other the circumstance that the water demand is not null f t 2 f c d t f o t 1 f o t f t eq 2 gives the cdf of the dimensionless demand coefficient c d representing the ratio of the actual requested demand flow to its daily average μ q 3 c d t q t μ q at the time of the daily maximum demand eq 3 gives the peak demand coefficient c p statistical inference of measured demand time series of actual users allowed obtaining robust distributions for the two cdfs of eq 2 as well as some practical equations to estimate their parameters gargano et al 2016b in particular f o t is described by means of the bernoulli distribution where the occurrence probability of the null request can be estimated in relation to the number of served users 4 f o t exp 5 n u s 1000 μ c d t eq 4 was tested by means of actual data of monitored users which showed that the occurrence probability of null demand decreases with the mean demand coefficient μ c d fig 1 this trend is even more evident when the number of served users n us increases in addition fig 1 shows that eq 4 can be considered valid regardless of the life style of the residential users statistical inference also shows that the water demand when it is not null can be effectively modeled during the day by means of the normal distribution gargano et al 2016b therefore the logistic distribution which presents the same trend of the normal distribution swamee 2002 ashkar and aucoin 2012 has been assumed to describe f of eq 2 by integrating the density function of the logistic distribution the term f of eq 2 assumes the following expression 5 f t e x p π 3 c d t μ c d t σ c d t 1 1 where σ c d t is the standard deviation of the demand coefficient at time t the two component cdfs of the mixed distribution eq 2 are fully determined if the number of users n u s and the daily demand trend of the demand coefficient μ c d t are known in fact σ c d t can be estimated by means of the following equation 6 cv t σ c d t μ c d t 0 1 6 1 4 μ c d t n u s 3 4 eq 6 was obtained from observed data of residential users gargano et al 2016b and shows that when n us increases cv tends asymptotically to 0 1 which is consistent with other experimental evidences moughton et al 2007 gato trinidad and gan 2012 this approach to model the water demand requires the knowledge of the daily demand trend which is typical of the users lifestyle however it can be reliably estimated on the basis of few measurements gargano et al 2016b during the peak phenomenon f o t in eq 2 becomes negligible compared to f t and this is more evident when large number of users n us is considered therefore for the peak demand eq 2 is practically equal to eq 5 2 4 hydraulic performance of the partitioned network the hydraulic performance of the partitioned network is evaluated either globally or in each dma local performances are expressed by means of the following statistical indices which are evaluated in every dma minimum pressure head h m i n mean pressure head h m e a n maximum pressure head h m a x the overall performance of the network is quantified with the resilience index proposed by todini 2000 7 i r i 1 n n q i h i h r 1 n r q r h r i 1 n n q i h in eq 7 n n is the number of demand nodes n r the number of reservoirs q i and h i the demand and the head of the i th node q r and h r the discharge and the pressure head of the generic r th source point and h the design pressure head of the network 3 case study and results the effects of spatial temporal variability of water demand on the hydraulic performance of a partitioned network have been evaluated for the real case study of the water supply network of parete a town with 10 800 inhabitants located in a densely populated area near caserta italy the water network consisting of m 282 links and n 184 nodes has two sources and its main topological and hydraulic characteristics are reported in table 1 in particular h represents the design pressure head i e the minimum required pressure to guarantee water demand at nodes h m i n h m e a n and h m a x are respectively the actual minimum average and maximum pressure heads throughout the entire network under distributed peak conditions the hydraulic simulations required to evaluate the hydraulic performance of the network in the various considered operating conditions have been carried out using the freeware software epanet2 rossman 2000 the considered wdn is characterized under distributed peak conditions the peak coefficient of the overall network resulted equal to 2 0 by a resilience index todini 2000 i r 0 73 indicating that it should be capable of ensuring adequate service level even under unplanned operating conditions as well as after partitioning according to the guidelines of the water loss task force of the international water association about best practices in dma management iwa 2007 the number of users in each dma should be between about 1000 and 5 000 mainly depending on the level of leakage and on specific characteristics of the network e g size housing type infrastructure conditions for the considered case a network partitioning into six dmas with about 500 4000 users for each of them was chosen which was achieved with the procedure described in section 2 fig 2 shows the partitioned layout obtained with the spectral clustering with the different districts represented with different colors as expected under distributed peak conditions i e without considering a non homogeneous spatial distribution of water demand the partitioned network still performed well with i r 0 64 and the design pressure head requirement h i h was fulfilled at all the nodes for the six districts the peak water demand of the users was modeled by means of the approach proposed by gargano et al 2016b obtaining a synthetic demand time series for 1000 days to this aim the daily trends of the water demand were first defined which are shown in fig 3 for a time discretization interval of 10 min the water utility in charge of parete wdn provided flow measurements along major pipes of the network which allowed to define plausible trends of the water demand of the dmas fig 3a however all trends of fig 3a though different present a daily average equal to 1 and the peak coefficient of the mean trend of the water demand was estimated according to n u s by means of the following equation gargano et al 2017 8 μ c p 10 n u s 0 2 1 0 04 ln n u s 0 35 ln δ t in eq 8 the part in square brackets is a reduction coefficient taking into account the effect of the time aggregation scale on the peak coefficient moughton et al 2007 magini et al 2008 furthermore the plot of fig 3a shows the mean trend of the overall water demand of the town of parete n u s 10 800 such a trend was obtained as the weighted mean the weighting factors are given by the ratio of the number of users of each dma to the total number of users of parete of the average demand of each dma fig 3b the overall peak coefficient results equal to 1 92 a value in substantial agreement with the statistical estimates of the peak phenomenon for the considered number of inhabitants e g martínez solano et al 2008 gargano et al 2016b it is worth noting that statistical mean values of peak coefficient result quite smaller than the deterministic constant values traditionally adopted to simulate peak demand conditions tricarico et al 2007 table 2 gives the main characteristics of the six dma the obtained daily trends showed to be effective for the developed analysis in fact the robustness of the approach proposed by gargano et al 2016b allows using also qualitative trends in order to obtain realistic time series of the water demand for the case study the six districts show during the day similar but not equal trends fig 3b indeed the peak phenomenon looks slightly different and does not occur exactly at the same time of the day therefore the daily maximum water demand affects a wider time interval which for the case study spans roughly from 6 40 to 10 30 am table 3 gives the mean demand coefficient during this time interval and the other parameters of the mixed distribution it looks clear that the peak coefficients μ c p of the mean trends for the six dmas already reported in table 2 occur at different times of the day on the basis of the measurements of the flows entering the network at the two sources as well as of water demand by single users the mean daily trends of the demand coefficient for each dma were defined once n u s and μ c d t were assigned the probability distributions of water demand described in section 3 were defined for every district with a monte carlo technique it was thus possible to generate 1000 different daily water demand trends for every dma in order to evaluate the effects of the spatial temporal variability of water demand on the hydraulic performance of the partitioned wdn several hydraulic indices were calculated in particular to measure the overall performance of the entire network the resilience index i r todini 2000 has been calculated every 10 min for each of the 1000 generated combinations of the demand daily trends of the six dma fig 4 shows the box plot of i r t for the time interval between 6 40 and 10 30 am the plot shows that the worst operating conditions occur between 7 30 and 7 50 am peak interval and the vertical width of the box 25th to 75th percentile of the generated population of synthetic trends as well as of the buffers 5th to 95th percentile clearly indicates the effects of the modeled spatial temporal variability of the water demand in particular while the median values of i r of the peak interval result close to the value 0 64 obtained for distributed peak conditions the interplay of time shifted and space variable dma local peaks leads to i r 0 6 for around 25 of the considered trends such a result which does not represent an issue for the wdn of parete characterized by an overabundant pressure level may cause reduced level of service in case of less resilient networks moreover it is worth to note that the modeled effect of the spatial variability of demand corresponding to a variation of i r of about 0 12 at the peak i e the buffers in fig 4 is strictly related to the simplifying assumption of considering the aggregated demand of the users served by each dma the variability of the demand within dma is actually higher leading to local pressure deficit at some nodes which could result in somewhat larger effects on i r indeed the proposed methodology represents a trade off between the extreme complexity of attempting to describe the small scale variability of demand and the practical requirement of robust and easily applicable design and management tools however it should also be considered that this result refers to the specific case study the wdn of parete is compact and densely looped so that all the nodes are easily reachable from the two reservoirs it can be expected that the application of the proposed methodology to other wdn i e less looped elongated and supplied by a single reservoir could lead to higher effects in terms of resilience reduction to better discern the effects of spatial and temporal variability of water demand fig 5 shows the scatter plots of i r vs the spatial mean of the demand coefficient 9 c d i 1 6 n i c d i n in equation 9 n i and c d i represent the number of nodes and the demand coefficient of the i th dma respectively the shape of the dot clouds clearly indicates the strong relationship linking network resilience to the overall mean peak demand coefficient and shows that in some cases owing to the effects of the random variability of demand on c d values nearly as small as 0 4 are attained the vertical spread of the clouds larger than 0 05 in terms of variation of i r is instead specifically related to the effects of the random spatial distribution of the demand of the various dma it shows how even with the same request of water that is the same mean peak demand coefficient the differences in the simultaneous values of demand coefficients of the six districts may contribute to some extent to the decrease of the overall resilience of the network which can become significant for networks with small pressure excess above the minimum required to analyze local effects of the spatial temporal variability of the demand fig 6 shows the box plots of minimum mean and maximum pressure heads of the six dma for the numbering of the districts please refer to fig 1 as expected the pressure regimes in the districts directly connected to the sources namely dma 5 and 6 together with dma 1 which is also very close to one of the sources are the least sensitive to the variations of demand among the remaining districts the most affected by water demand variations is dma 3 in any case the pressure head differences between the 5th and 95th percentiles are less than 5 meters for all the considered indices and the pressure never drops below the minimum required pressure head h 25 m however it results that the random variability of the demand coefficient from district to district does not affect significantly the pressure regime within the various dma which is mainly related to their position with respect to the sources 4 conclusions the design of wdn partitioning is usually accomplished with respect to the conventional operating condition of distributed peak demand although it is expected that the actual spatial temporal distribution of water demand during the peak hours may significantly affect the hydraulic performances of a partitioned network in this respect the real wdn of parete near naples italy was partitioned into six districts with a recently proposed algorithm which identifies the best district layout with respect to the homogeneously distributed peak demand condition the hydraulic performance of the obtained partitioned layout was then tested under random spatial temporal variability of peak demand to such aim a recently proposed stochastic model of water demand was adopted the parameters of which can be estimated on the basis of the number of served users and on the knowledge of the mean daily trend of water demand with a monte carlo technique synthetic time series of water demand during the day were generated for every district hydraulic simulations of the partitioned wdn were carried out for every generated water demand series so that a statistical analysis of several indices of its hydraulic performance should be made the obtained results indicate that the random variability of water demand distribution affected the pressure regime in the network leading to values of nodal pressures as well as of the resilience of the network todini 2000 significantly smaller than the value obtained with reference to the homogeneously distributed peak condition in particular it was possible to distinguish the effects on network resilience due to the variability of the total water request from those related to simultaneous differences of water requested from different dma this result indicates that modeling the spatial temporal variability of water demand is the same as considering operating conditions more challenging for a partitioned network than the usually adopted distributed peak in this respect although the mean value of the peak coefficient is smaller than the constant deterministic values traditionally adopted to simulate peak demand condition the random variability leads anyway to consider more extreme conditions corresponding to high percentiles of the probability distribution of demand coefficient therefore especially for the case of wdn characterized by a small pressure excess compared to the required minimum design pressure at nodes the spatial temporal variability of water demand should be taken into account in the design of network partitioning however further investigation is required also with reference to other case studies to better define alternative standardized design procedures 
26429,water network partitioning wnp into district meter areas allows improving pressure management water budget leaks detection compared to classical redundantly looped networks anyway wnp can significantly worsen the hydraulic performance because often many gate valves are required and the reduced set of possible paths for water flow makes the network vulnerable especially to concentrated peaks of water request hence reliably modeling the spatial and temporal distribution of water demand would allow better understanding the effects of wnp improving both network design and management aiming at taking into account the behavior of a partitioned network under spatial and temporal variability of water demand a design procedure is proposed coupling a stochastic model of water demand with novel partitioning techniques based on spectral clustering the application of the procedure to a real medium sized network shows that demand variability may significantly affect the hydraulic performance of the partitioned network evaluated by means of topological and hydraulic indices keywords water network partitioning water demand spectral clustering district meter area list of symbols cdf cumulative distribution function c d i demand coefficient of the i th dma c d t demand coefficient c d spatial mean of the demand coefficient c p peak demand coefficient cv t ratio between standard deviation of the demand coefficient at time t and mean of the demand coefficient at time t dma district metered area e l l th edge e set of network edges f 0 t probability of the event of null water demand f t probability that the water demand is not null g graph ga genetic algorithm h nodes design pressure m h i node pressure m h max maximum node pressure m h mean mean node pressure m h min minimum node pressure m i r resilience index k subset index l pipes index m total number of edges n total number of vertices n i number of vertices of the i th dma n bv number of gate valves n ec total number of edge cuts n fm number of flow meters n us number of served users of objective function p k k th subset q t actual requested demand flow l s q i water demand at the i th node t time variable v i i th vertice v set of network vertices wnp water network partitioning wdn water distribution network z i geodetic elevation at the i th node μ q daily average requested demand flow l s μ cd t mean of the demand coefficient at time t μ cp peak coefficient of the mean trend of the water demand σ cd t standard deviation of the demand coefficient at time t γ specific weight of water 1 introduction water distribution networks wdn are crucial infrastructures for social and economic development adams 2006 in the last decades these water systems faced with rising water demand and topological modifications due to change in consumer profiles ageing of the components and sometimes unplanned urban development wdns can be regarded as complex networks mays 2000 di nardo et al 2017 for some aspects due essentially to the topological complexity of their layout the non linearity of their mathematical models and the dynamic behavior of water demand in particular water demand is affected by seasonal and climatic influences shvartser et al 1993 zhou et al 2002 herrera et al 2010 and by users habits and mobility blokker et al 2010 rozos et al 2016 this dynamic behavior of water demand can produce fast variations in pressure and flow within the network which may affect structural components as pipes and junctions of the distributions systems causing breakages and leakages puust et al 2010 furthermore water pressure in parts of the water system may be occasionally reduced with a significant decrease of the level of service for the users hence for an efficient wdn management it is necessary to deal with these issues by developing and implementing strategies to maximize consumer satisfaction and minimize the efforts to reduce the costs of water distribution kapelan et al 2006 an improved wdn management is indeed required to guarantee high levels of efficiency nowadays thanks to the exponential growth in the computational power there is potential to change the traditional approach to analysis design and management of wdn from passive to proactive based on the development of new monitoring and control technologies in particular in the last decades the scientific community has proposed different approaches to improve wdn management e g alvisi and franchini 2009 wang et al 2014 exploiting the low cost availability of new remotely controlled monitoring devices di nardo et al 2014 one of these innovative approaches consists of implementing the paradigm of divide and conquer in wdn defining permanent sub regions named district meter areas dma by inserting gate valves and flow meters along some properly selected network pipes this procedure defined also as water network partitioning wnp allows dividing the network into sub systems which make easier the identification of water losses the control of district pressure the protection of the users from accidental and intentional contamination the assessment of the water balance di nardo et al 2015 however the design of a wnp is a complex challenge for operators because at least three crucial requirements must be satisfied 1 network connectivity i e each demand node of the water network must be connected to at least one water source 2 nodal minimum pressure i e each node must have a pressure equal or higher than the minimum level that allows satisfying the water demand of users 3 the number of flow meters and gate valves must be minimized to reduce costs and management complexity the second requirement results often challenging as permanent partitioning changes the original topological layout of water systems reducing the overall available pipe section because of the closure of some pipes by gate valves causing the decrease of water pressure and thus worsening the level of service offered to users different procedures have been proposed in the literature to identify the optimal wnp layout recent reviews are given in perelman et al 2015 di nardo et al 2015 essentially based on heuristic algorithms and optimization procedures generally they consist of two phases a clustering aimed at defining the shape and the dimensions of the network subsets based on different approaches among which graph theory algorithms spectral clustering multi agent approach and community structure b dividing aimed at physically partitioning the network by selecting pipes for the insertion of flow meters or gate valves based on recursive bisection procedures or on genetic algorithms usually the partitioned layouts are tested with reference to the distributed peak water demand as it is considered as one of the most onerous operating conditions for the water network anyway water distribution networks must also deal with operating conditions which require the network to be capable of delivering high demand peaks to particular nodes such concentrated peak conditions can result very challenging for a partitioned system and require a more sophisticated approach to demand spatial temporal modeling than a homogeneously distributed peak in fact the peak demand phenomenon is usually represented as simplified working conditions assuming that the maximum water request by all served users occurs at the same time in addition simplified relationships of deterministic origin are often used to estimate the entity of the peak demand a broad overview of such deterministic relationships can be found in lingireddy et al 1998 zhang et al 2005 martínez solano et al 2008 although the random nature of the peak demand was highlighted already by bao and mays 1990 indeed in the scientific literature of the new millennium several papers e g tricarico et al 2007 buchberger et al 2012 gato trinidad and gan 2012 balacco et al 2017 propose to model the peak water demand according to a probabilistic approach several of the proposed models are not limited to the maximum daily demand but they rather describe the water request trend during the day modeling also the elementary pulses which sum up to compose the overall demand at nodes e g buchberger and wu 1995 alvisi et al 2003 blokker et al 2010 however approaches modeling elementary demand pulses require the estimation of many parameters strictly depending on the habits of the inhabitants buchberger and wells 1996 gargano et al 2016a moreover the spatial and temporal variability represents an onerous challenge which requires detailed information about the served users jankovic nisic et al 2004 not easily available aim of this paper is to propose a novel methodological approach to wnp taking into account in a simplified but effective way the spatial and temporal variability of water demand and its effects on the hydraulic performance of the partitioned network to such aim the effects of spatial and temporal variability of water demand on water network partitioning are stochastically modeled therefore partitioned wdn reliability representing the ability of performing the required functions under stated conditions for a specified period of time greco et al 2012 can be investigated with reference to realistic operating conditions the proposed methodology consisting of two parts one dealing with the design of wnp the other with the evaluation of the hydraulic performance of the partitioned network under spatially and temporally variable peak demand conditions was applied to the case of a medium sized real water distribution network serving the town of parete italy first the wnp was carried out with reference to the distributed peak condition with a novel two step technique di nardo et al 2017 in which the optimal layout of dma is defined by spectral clustering and the dividing phase is carried out by identifying the positioning of gate valves least affecting the hydraulic performance of the network second the variability of the water demand was introduced by means of a recently proposed stochastic model which adopts a mixed distribution to model with parsimonious parametrization the random peak requests and is capable of reliably reproducing demand peaks in various contexts gargano et al 2016b with a monte carlo technique realistic daily trends of the flow demanded by the users were generated for each dma thus obtaining spatially variable and time shifted realizations of water demand peaks the hydraulic performance of the partitioned network was evaluated with several metrics for each generated demand distribution with specific reference to the time interval in which demand peaks occurred in the various dmas the obtained results show that spatial temporal variability of water demand may lead to operating conditions more challenging for a partitioned network than the usually adopted distributed peak therefore especially for networks characterized by low power surplus the design of network partitioning should take into account the variability of water demand 2 network partitioning under random water demand distribution the applied procedure consists of four steps described in detail hereinafter first the partitioning of the network is carried out in two phases clustering step 1 and dividing step 2 then the probability distributions of water demand are defined and a monte carlo approach is used to generate time series of water demand for each dma step 3 finally the hydraulic performances of the partitioned network are evaluated by means of various robust indices step 4 2 1 clustering phase water supply networks wsn can be modeled as a graph g v e where v is the set of n vertices v i the junctions and the delivery nodes and e is the set of m edges e l the pipes a k way graph clustering problem consists in partitioning v vertices of g into k subsets p 1 p 2 p k di nardo et al 2013 clustering is usually defined in terms of weighted undirected graphs where weights correspond to either similarity scores or distances or more generally they express the strength of the link between elements in order to define sub graphs which take into account proximity and or similarity between elements optimal graph clustering can be achieved with many procedures boccaletti et al 2006 fortunato 2010 finding a clustered layout which minimizes or maximizes an objective function defined to emphasize one or more of the clustering aims in recent years and in many research fields spectral clustering based on graph laplacian matrix spectrum von luxburg 2007 has become one of the most used clustering algorithms because it can be solved by standard linear algebra software and so it is easily implemented in this paper a recently proposed procedure for wdn partitioning has been adopted di nardo et al 2017 which allows automatically defining the optimal network clustering i e characterized by dma with similar number of nodes n i and by an edge cut set with the smallest number of pipes n e c in particular the clustering phase has been carried out with a spectral clustering technique namely the normalized spectral clustering according to shi and malik 2000 such a clustering procedure is based on the eigenvalues of the graph laplacian matrix which for a given graph is defined as the difference between the diagonal matrix with the connectivity degrees of the nodes and the adjacency matrix von luxburg 2007 2 2 dividing phase once defined the number n f m of flow meters to be inserted in the network the number of boundary pipes to be closed by gate valves is n b v n e c n f m in order to simplify the water budget computation it is better to keep n f m as low as possible di nardo et al 2016 a heuristic procedure is required in this phase tindell et al 1992 because the choice of the optimal positioning of flow meters and gate valves is a np hard problem bodlaender et al 2010 in this paper in order to minimize the alteration of the hydraulic performance caused by the closure of some network pipes the following objective function o f has been defined 1 o f m a x γ i 1 n z i h i q i p corresponds to the total nodal power of the network di nardo and di natale 2011 in which γ is the specific weight of water z i h i and q i are respectively the geodetic elevation the pressure head and the water demand at the i th node it is assumed that dividing by maximizing this objective function allows best preserving the hydraulic performance of the network for the operating condition of distributed peak demand the maximum of o f has been searched with a genetic algorithm g a with the following parameters individuals are defined as strings of n e c binary chromosomes corresponding to the ordered pipes of the edge cut set the value 1 of the l th chromosome indicates that a gate valve is inserted along the l th pipe while 0 corresponds to the insertion of a flow meter the g a has been carried out with 500 generations of populations consisting of 500 individuals each with a crossover percentage of 80 2 3 stochastic model of water demand the peak water demand is usually represented as a conventional operating condition which occurs at the same time for the whole wdn instead the different habits of the users lead to non homogenous spatial distribution of the water demand with the maximum water requests occurring at different times in the various districts of the wdn the larger is the served municipality the more this effect becomes evident therefore the analysis of the peak phenomenon cannot be carried out with reference to a single time but requires taking into account a time interval or even more than one if more than one peak occurs during the day to combine the time shifted demand peaks in different districts of the wdn to such aim the stochastic approach of gargano et al 2016b has been used to generate synthetic daily time series of the water demand then time intervals wide enough to take into account the shifted demand peaks of the different districts have been considered the cumulative distribution function cdf of the adopted stochastic model mixes two distributions one expressing the probability of the event of null water demand at time t f o t the other the circumstance that the water demand is not null f t 2 f c d t f o t 1 f o t f t eq 2 gives the cdf of the dimensionless demand coefficient c d representing the ratio of the actual requested demand flow to its daily average μ q 3 c d t q t μ q at the time of the daily maximum demand eq 3 gives the peak demand coefficient c p statistical inference of measured demand time series of actual users allowed obtaining robust distributions for the two cdfs of eq 2 as well as some practical equations to estimate their parameters gargano et al 2016b in particular f o t is described by means of the bernoulli distribution where the occurrence probability of the null request can be estimated in relation to the number of served users 4 f o t exp 5 n u s 1000 μ c d t eq 4 was tested by means of actual data of monitored users which showed that the occurrence probability of null demand decreases with the mean demand coefficient μ c d fig 1 this trend is even more evident when the number of served users n us increases in addition fig 1 shows that eq 4 can be considered valid regardless of the life style of the residential users statistical inference also shows that the water demand when it is not null can be effectively modeled during the day by means of the normal distribution gargano et al 2016b therefore the logistic distribution which presents the same trend of the normal distribution swamee 2002 ashkar and aucoin 2012 has been assumed to describe f of eq 2 by integrating the density function of the logistic distribution the term f of eq 2 assumes the following expression 5 f t e x p π 3 c d t μ c d t σ c d t 1 1 where σ c d t is the standard deviation of the demand coefficient at time t the two component cdfs of the mixed distribution eq 2 are fully determined if the number of users n u s and the daily demand trend of the demand coefficient μ c d t are known in fact σ c d t can be estimated by means of the following equation 6 cv t σ c d t μ c d t 0 1 6 1 4 μ c d t n u s 3 4 eq 6 was obtained from observed data of residential users gargano et al 2016b and shows that when n us increases cv tends asymptotically to 0 1 which is consistent with other experimental evidences moughton et al 2007 gato trinidad and gan 2012 this approach to model the water demand requires the knowledge of the daily demand trend which is typical of the users lifestyle however it can be reliably estimated on the basis of few measurements gargano et al 2016b during the peak phenomenon f o t in eq 2 becomes negligible compared to f t and this is more evident when large number of users n us is considered therefore for the peak demand eq 2 is practically equal to eq 5 2 4 hydraulic performance of the partitioned network the hydraulic performance of the partitioned network is evaluated either globally or in each dma local performances are expressed by means of the following statistical indices which are evaluated in every dma minimum pressure head h m i n mean pressure head h m e a n maximum pressure head h m a x the overall performance of the network is quantified with the resilience index proposed by todini 2000 7 i r i 1 n n q i h i h r 1 n r q r h r i 1 n n q i h in eq 7 n n is the number of demand nodes n r the number of reservoirs q i and h i the demand and the head of the i th node q r and h r the discharge and the pressure head of the generic r th source point and h the design pressure head of the network 3 case study and results the effects of spatial temporal variability of water demand on the hydraulic performance of a partitioned network have been evaluated for the real case study of the water supply network of parete a town with 10 800 inhabitants located in a densely populated area near caserta italy the water network consisting of m 282 links and n 184 nodes has two sources and its main topological and hydraulic characteristics are reported in table 1 in particular h represents the design pressure head i e the minimum required pressure to guarantee water demand at nodes h m i n h m e a n and h m a x are respectively the actual minimum average and maximum pressure heads throughout the entire network under distributed peak conditions the hydraulic simulations required to evaluate the hydraulic performance of the network in the various considered operating conditions have been carried out using the freeware software epanet2 rossman 2000 the considered wdn is characterized under distributed peak conditions the peak coefficient of the overall network resulted equal to 2 0 by a resilience index todini 2000 i r 0 73 indicating that it should be capable of ensuring adequate service level even under unplanned operating conditions as well as after partitioning according to the guidelines of the water loss task force of the international water association about best practices in dma management iwa 2007 the number of users in each dma should be between about 1000 and 5 000 mainly depending on the level of leakage and on specific characteristics of the network e g size housing type infrastructure conditions for the considered case a network partitioning into six dmas with about 500 4000 users for each of them was chosen which was achieved with the procedure described in section 2 fig 2 shows the partitioned layout obtained with the spectral clustering with the different districts represented with different colors as expected under distributed peak conditions i e without considering a non homogeneous spatial distribution of water demand the partitioned network still performed well with i r 0 64 and the design pressure head requirement h i h was fulfilled at all the nodes for the six districts the peak water demand of the users was modeled by means of the approach proposed by gargano et al 2016b obtaining a synthetic demand time series for 1000 days to this aim the daily trends of the water demand were first defined which are shown in fig 3 for a time discretization interval of 10 min the water utility in charge of parete wdn provided flow measurements along major pipes of the network which allowed to define plausible trends of the water demand of the dmas fig 3a however all trends of fig 3a though different present a daily average equal to 1 and the peak coefficient of the mean trend of the water demand was estimated according to n u s by means of the following equation gargano et al 2017 8 μ c p 10 n u s 0 2 1 0 04 ln n u s 0 35 ln δ t in eq 8 the part in square brackets is a reduction coefficient taking into account the effect of the time aggregation scale on the peak coefficient moughton et al 2007 magini et al 2008 furthermore the plot of fig 3a shows the mean trend of the overall water demand of the town of parete n u s 10 800 such a trend was obtained as the weighted mean the weighting factors are given by the ratio of the number of users of each dma to the total number of users of parete of the average demand of each dma fig 3b the overall peak coefficient results equal to 1 92 a value in substantial agreement with the statistical estimates of the peak phenomenon for the considered number of inhabitants e g martínez solano et al 2008 gargano et al 2016b it is worth noting that statistical mean values of peak coefficient result quite smaller than the deterministic constant values traditionally adopted to simulate peak demand conditions tricarico et al 2007 table 2 gives the main characteristics of the six dma the obtained daily trends showed to be effective for the developed analysis in fact the robustness of the approach proposed by gargano et al 2016b allows using also qualitative trends in order to obtain realistic time series of the water demand for the case study the six districts show during the day similar but not equal trends fig 3b indeed the peak phenomenon looks slightly different and does not occur exactly at the same time of the day therefore the daily maximum water demand affects a wider time interval which for the case study spans roughly from 6 40 to 10 30 am table 3 gives the mean demand coefficient during this time interval and the other parameters of the mixed distribution it looks clear that the peak coefficients μ c p of the mean trends for the six dmas already reported in table 2 occur at different times of the day on the basis of the measurements of the flows entering the network at the two sources as well as of water demand by single users the mean daily trends of the demand coefficient for each dma were defined once n u s and μ c d t were assigned the probability distributions of water demand described in section 3 were defined for every district with a monte carlo technique it was thus possible to generate 1000 different daily water demand trends for every dma in order to evaluate the effects of the spatial temporal variability of water demand on the hydraulic performance of the partitioned wdn several hydraulic indices were calculated in particular to measure the overall performance of the entire network the resilience index i r todini 2000 has been calculated every 10 min for each of the 1000 generated combinations of the demand daily trends of the six dma fig 4 shows the box plot of i r t for the time interval between 6 40 and 10 30 am the plot shows that the worst operating conditions occur between 7 30 and 7 50 am peak interval and the vertical width of the box 25th to 75th percentile of the generated population of synthetic trends as well as of the buffers 5th to 95th percentile clearly indicates the effects of the modeled spatial temporal variability of the water demand in particular while the median values of i r of the peak interval result close to the value 0 64 obtained for distributed peak conditions the interplay of time shifted and space variable dma local peaks leads to i r 0 6 for around 25 of the considered trends such a result which does not represent an issue for the wdn of parete characterized by an overabundant pressure level may cause reduced level of service in case of less resilient networks moreover it is worth to note that the modeled effect of the spatial variability of demand corresponding to a variation of i r of about 0 12 at the peak i e the buffers in fig 4 is strictly related to the simplifying assumption of considering the aggregated demand of the users served by each dma the variability of the demand within dma is actually higher leading to local pressure deficit at some nodes which could result in somewhat larger effects on i r indeed the proposed methodology represents a trade off between the extreme complexity of attempting to describe the small scale variability of demand and the practical requirement of robust and easily applicable design and management tools however it should also be considered that this result refers to the specific case study the wdn of parete is compact and densely looped so that all the nodes are easily reachable from the two reservoirs it can be expected that the application of the proposed methodology to other wdn i e less looped elongated and supplied by a single reservoir could lead to higher effects in terms of resilience reduction to better discern the effects of spatial and temporal variability of water demand fig 5 shows the scatter plots of i r vs the spatial mean of the demand coefficient 9 c d i 1 6 n i c d i n in equation 9 n i and c d i represent the number of nodes and the demand coefficient of the i th dma respectively the shape of the dot clouds clearly indicates the strong relationship linking network resilience to the overall mean peak demand coefficient and shows that in some cases owing to the effects of the random variability of demand on c d values nearly as small as 0 4 are attained the vertical spread of the clouds larger than 0 05 in terms of variation of i r is instead specifically related to the effects of the random spatial distribution of the demand of the various dma it shows how even with the same request of water that is the same mean peak demand coefficient the differences in the simultaneous values of demand coefficients of the six districts may contribute to some extent to the decrease of the overall resilience of the network which can become significant for networks with small pressure excess above the minimum required to analyze local effects of the spatial temporal variability of the demand fig 6 shows the box plots of minimum mean and maximum pressure heads of the six dma for the numbering of the districts please refer to fig 1 as expected the pressure regimes in the districts directly connected to the sources namely dma 5 and 6 together with dma 1 which is also very close to one of the sources are the least sensitive to the variations of demand among the remaining districts the most affected by water demand variations is dma 3 in any case the pressure head differences between the 5th and 95th percentiles are less than 5 meters for all the considered indices and the pressure never drops below the minimum required pressure head h 25 m however it results that the random variability of the demand coefficient from district to district does not affect significantly the pressure regime within the various dma which is mainly related to their position with respect to the sources 4 conclusions the design of wdn partitioning is usually accomplished with respect to the conventional operating condition of distributed peak demand although it is expected that the actual spatial temporal distribution of water demand during the peak hours may significantly affect the hydraulic performances of a partitioned network in this respect the real wdn of parete near naples italy was partitioned into six districts with a recently proposed algorithm which identifies the best district layout with respect to the homogeneously distributed peak demand condition the hydraulic performance of the obtained partitioned layout was then tested under random spatial temporal variability of peak demand to such aim a recently proposed stochastic model of water demand was adopted the parameters of which can be estimated on the basis of the number of served users and on the knowledge of the mean daily trend of water demand with a monte carlo technique synthetic time series of water demand during the day were generated for every district hydraulic simulations of the partitioned wdn were carried out for every generated water demand series so that a statistical analysis of several indices of its hydraulic performance should be made the obtained results indicate that the random variability of water demand distribution affected the pressure regime in the network leading to values of nodal pressures as well as of the resilience of the network todini 2000 significantly smaller than the value obtained with reference to the homogeneously distributed peak condition in particular it was possible to distinguish the effects on network resilience due to the variability of the total water request from those related to simultaneous differences of water requested from different dma this result indicates that modeling the spatial temporal variability of water demand is the same as considering operating conditions more challenging for a partitioned network than the usually adopted distributed peak in this respect although the mean value of the peak coefficient is smaller than the constant deterministic values traditionally adopted to simulate peak demand condition the random variability leads anyway to consider more extreme conditions corresponding to high percentiles of the probability distribution of demand coefficient therefore especially for the case of wdn characterized by a small pressure excess compared to the required minimum design pressure at nodes the spatial temporal variability of water demand should be taken into account in the design of network partitioning however further investigation is required also with reference to other case studies to better define alternative standardized design procedures 
