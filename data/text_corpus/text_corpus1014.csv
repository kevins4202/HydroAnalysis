index,text
5070,soil salinization has become a widespread problem that seriously affects the sustainable development of agriculture to deal with the salt accumulation and leaching problems in practical agricultural systems a new soil water and solute transport model adopting the mass balance scheme is developed in this study the soil water movement module is based on a previously published soil water mass balance model named as ubmod the mobile immobile assumption has been adopted to develop the soil solute transport module which can describe the obvious anomalous transport phenomenon in practice the advection chemical reactions of solute solute transfer between the mobile and immobile regions and dispersion in the mobile region are considered in the solute transport module while only chemical reactions and solute transfer between the mobile and immobile regions are considered in the immobile region three cases were designed to evaluate the performance of the model by comparing the simulation results with those obtained by experimental results hydrus 1d and practical observations the results demonstrate that the developed model can solve the homogeneous and heterogeneous soil water movement and solute transport effectively and it has looser restrictions on the discretization of space and time than the numerical solution of richards equation and can keep the mass balance well which make it more suitable for practical conditions moreover the real world application of salt accumulation and leaching problems in hetao irrigation district inner mongolia china shows that the rmse of the simulated soil salt content with the immobile present region is about 20 better than that when ignoring the immobile present region therefore it is necessary to take the significant anomalous transport into account when studying the salt accumulation and leaching processes in practical agricultural systems keywords soil water movement solute transport mobile immobile assumption mass balance model salt accumulation and leaching 1 introduction soil salinization is a widespread problem more than 20 of the global irrigated areas 450 000 km2 are salt affected daliakopoulos et al 2016 qadir et al 2014 nellemann et al 2009 evapotranspiration is the predominant hydrological process contributing to the soil salt accumulation in those arid and semi arid agricultural areas with shallow water table depth as water evaporates from soil or transpires through plants salts are accumulated near the soil surface assouline et al 2015 the widely adopted method to control the soil salinization is leaching the salt downward through the root zone with additional irrigation water minhas et al 2020 ben gal et al 2008 corwin et al 2007 nevertheless the excessive irrigation water may lead to a shallow water table depth which in turn increases evapotranspiration and results in salt accumulation near the soil surface singh 2019 wichelns and qadir 2014 besides the salt transport process is affected by complicated practical hydrogeological conditions and intensive heterogeneity of the unsaturated zone therefore salt accumulation and leaching in practical agricultural systems is a sophisticated phenomenon agro hydrological models are effective tools for studying salt accumulation and leaching processes lekakis and antonopoulos 2015 plaut et al 2013 letey et al 2011 many numerical models based on the richards equation re to describe the unsaturated soil water flow and the advective dispersive equation ade to describe the solute transport have been established and widely used such as swap kroes et al 2017 hydrus šimůnek et al 2016 hanson et al 2008 swim huth et al 2012 feflow diersch 2013 the advantages of these models are their solid physical basis and they can give accurate results however very fine discretization of space and time is required to obtain an accurate solution of re because of the high non linearity of the equation in addition intensive input data and model parameters are also needed which are not always available in practice visconti et al 2014 moran et al 2004 moreover the stability of the numerical solution is also challenged when excessive irrigation water is applied into the dry soil repeatedly zha et al 2017 which is a common phenomenon in arid agricultural areas numerical problems can be alleviated by developing mass balance models these models are developed based on the principle of mass balance and some simplified or empirical expressions rather than the kinetic equations zha 2014 gandolfi et al 2006 the mass balance methods take advantage of computational efficiency small mass balance error model stability and usability especially in large scale modelling where data and fundamental understanding of the factors and processes are lacking ranatunga et al 2008 in fact these methods are widely used in crop models agricultural water and salt management models regional hydrological models such as aquacrop foster et al 2017 saltmod chang et al 2019 mao et al 2017 swat xiong et al 2019 arnold et al 2012 catsalt tuteja et al 2002 soilwat holzworth et al 2014 oasis mod model askri et al 2010 saltirsoil visconti et al 2011 the mass balance models can be classified into two kinds based on their treatment to unsaturated zone ranatunga et al 2008 the first kind treats the unsaturated zone or the root zone as a single layer such as saltmod catsalt oasis mod and saltirsoil however the assumption that the single layer filled with vertical homogeneous soil means it is difficult for these models to describe the salt accumulation and leaching processes accurately another kind of mass balance model is the multiple layers model which considers water and salt balance in a cascade of soil layers in unsaturated zone such as aquacrop swat and soilwat the tipping bucket method is used to describe the soil water movement driven by the gravitational potential constantin et al 2020 and empirical equations are used to describe the capillary rise from groundwater to soil water however the soil water movement driven by the matric potential is usually neglected this simplification limits the model application in arid agricultural areas where salt accumulates near the soil surface due to the strong and continuous evapotranspiration rengasamy 2006 valipour 2014 to overcome the deficiency mao et al 2018 developed a soil water balance model called as ubmod by adding an equation to describe the soil water movement driven by the matric potential the model is efficient and has satisfactory performance for coarse discretization of space and time which make it suitable for practical agricultural problems another concern is the intense heterogeneity of the porous media under practical conditions the widely applied ade method adopts the homogeneous hypothesis implicitly which cannot adequately account for the significant anomalous transport in heterogeneous porous media in practice sternagel et al 2019 jarvis 2007 köhne et al 2009 beven and germann 2013 to describe the anomalous transport the aquacrop model divides each soil layer into several regions where salt can be stored and each region represents a range of pore size of the heterogeneous porous media the field capacity has been used to distinguish small pores and macro pores and the soil water movement was assumed to only occur in macro pores salt diffusion can occur both in small pores and macro pores and salt diffusion in the region which belongs to small pores is slower than that in the region which belongs to macro pores raes et al 2018 the scheme handling the salt transport process in aquacrop is similar to the mobile immobile mim assumption which divides the porous media into mobile flowing region and immobile stagnant region the mobile immobile assumption was aimed at describing the anomalous transport phenomenon the performance of the mim method is better than the ade method when describing solute transport in both homogeneous and heterogeneous porous media li et al 2020 gao et al 2012 gao et al 2010 gao et al 2009 however it may arbitrary and rigid to divide the immobile region and the mobile region by the field capacity since experiments and observations show that the soil water movement can occur when the soil water content is smaller than the field capacity assouline and or 2014 in this study a new model to calculate the soil water and anomalous solute transport in agricultural areas is developed based on the mass conservation principle the water movement module is based on ubmod model which is a water balance model and considers the soil water movement driven by the gravitational potential external forces and the matric potential the model can simulate both upward and downward soil water movement in heterogeneous situations effectively the solute transport module is developed based on the mobile immobile assumption a specific soil water content θd is introduced to distinguish the mobile region and the immobile region instead of the field capacity the solute advection process chemical reactions process solute transfer process between the mobile and immobile regions and solute dispersive process in the mobile region are considered while only chemical reactions and solute transfer between the mobile and immobile regions are considered in the immobile region the merits and demerits of the developed model have been analyzed the objectives of this study are to 1 introduce the methodology of the developed soil water movement and solute transport mass balance model and 2 evaluate the performance of the model under synthetic and real world agricultural conditions 2 methodology and model development in this section the soil water movement module is first presented followed by the description of the solute transport module the numerical implementation of the solute transport module is given last 2 1 the soil water movement module the soil water movement module is based on ubmod model which has been elaborated in mao et al 2018 this section briefly describes the model to make this paper self contained the model divides the one dimensional soil profile and time into soil layers and time steps in each time step there are four major calculation procedures to describe the soil water movement as shown in fig 1 a firstly the allocation of infiltration water is calculated the soil water content of the profile is filled to be saturated from the surface soil layer to the underlying soil layer until all the infiltration water is consumed the model is developed according to the situation of arid and semi arid agricultural systems and the surface runoff is ignored therefore the irrigation and precipitation are all treated as infiltration the amount of allocated water for a given layer i is shown as follows 1 q i min m i θ s i θ i i i d i 1 where i indicates the vertical soil layer i 1 n n is the total number of soil layers qi is the amount of allocated water per unit area of layer i l mi is the thickness of layer i l θi is the initial soil water content of layer i l3l 3 θs i is the saturated water content of layer i l3l 3 i is the quantity of infiltration water per unit area l id i 1 is the consumed infiltration water per unit area by all upper layers above layer i l all the soil water content used in the article is the volumetric moisture then the soil water movement driven by the three forces the gravitational potential the source sink term for external forces and the matric potential is calculated sequentially the governing equation for the soil water movement driven by the gravitational potential is shown as follows 2 θ t k θ z where t is the time t k θ is the unsaturated hydraulic conductivity lt 1 as a function of soil water content θ z is the elevation in the vertical direction l the relationship between k θ and θ is characterized by empirical formulas with the purpose of simplifying calculation and eliminating parameters these empirical formulas are referred to as drainage functions and the commonly used ones are listed in mao et al 2018 the governing equation for the source sink term is 3 θ t w where w is the source sink term t 1 to account for soil evaporation and root uptake term of crop transpiration the fao penman monteith equation and dual crop coefficient approach are adopted to calculate the soil evaporation and crop transpiration in the absence of stress the calculated values are then assigned to soil layers according to the evaporation cumulative distribution function and the root density function the actual soil evaporation and crop transpiration are deduced based on the effects of soil water stress and salt stress besides the crop coefficient kc leaf area index lai and root depth hroot are calculated by a crop growth model which is used to simulate the crop growing processes the governing equation for soil water diffusive movement driven by the matric potential is 4 θ t z d θ θ z where d θ is the hydraulic diffusivity l2t 1 with the help of the diffusion equation eq 4 the water movement module can consider the upward soil water movement driven by the matric potential which is ignored by many water balance models a correction term is introduced to describe the vertical spatial variability of soils which makes the model applicable to heterogeneous situations the expanded equation can be expressed as 5 θ t z d θ θ z l 1 l θ p l p l z where pl l 1 2 l is a parameter of the soil water retention function and l is the total number of the parameters l 1 l θ p l p l z is the correction term the soil water movement process is split into four procedures for simplifying the calculation the assumptions adopted by the first procedure introduce a piston type soil water content profile which may lead to a large downward flux driven by the gravitational potential however it is an intermediate result and the bias will be corrected by the upward flux driven by the matric potential the errors introduced by the split method and assumptions are small when fine time steps and spatial steps are adopted however the model is unlikely to be accurate when larger time steps are used after an infiltration event mao et al 2018 the flow rate of the soil water can be obtained based on mass balance calculation after all the four procedures described above which is expressed as qf lt 1 2 2 the solute transport module the mobile immobile assumption has been adopted in the solute transport module for describing the significant anomalous transport phenomenon in heterogeneous porous media in this study the soil water content θd is introduced to distinguish the mobile and immobile regions which can be specified by users and is smaller than the field capacity θf the total soil water content is divided as 6 θ θ m θ im θ im θ d if θ θ d θ θ m θ im θ m 0 if θ θ d where θ is the total soil water content l3l 3 θm and θim are the soil water content in the mobile and immobile regions l3l 3 respectively β is used to indicate the fraction of immobile region β θim θs for a specific layer the solute advection process chemical reaction processes solute transfer process between the mobile and immobile regions and solute dispersive process in the mobile region are considered while only chemical reaction processes and solute transfer process between the mobile and immobile regions are considered in the immobile region the schematic major calculation procedures simulated in the solute transport module are presented in fig 1 b the governing equation of solute advective movement is shown as 7 θ m c m t θ m v m v m z where cm is the solute concentration in the mobile region ml 3 vmθm equals to the flow rate qf which is calculated by the soil water movement module the dissolve and adsorption zero and first order rate reactions of the liquid and solid solute are considered in the chemical reactions term the governing equation of chemical reactions in the mobile or immobile region is 8 θ k c k t ρ s k t μ w θ k c k μ s ρ s k γ w θ k γ s ρ s k c s k k m i m where ck k m im is the solute concentration in the mobile or immobile region ml 3 ρ is the bulk density ml 3 sk k m im is the concentration of the solid solute in the mobile or immobile region mm 1 μw is the first order rate constant for solutes in the liquid phase t 1 μs is the first order rate constant for solute absorbed onto the solid phase t 1 γw is the zero order rate constant for solutes in the liquid phase ml 2t 1 γs is the zero order rate constant for solutes absorbed onto the solid phase t 1 sk k m im is the sink term in the mobile or immobile region t 1 cs k k m im is the concentration of the sink term in the mobile or immobile region ml 3 the linear equation is used to represent the equilibrium interactions between the solution concentration and the absorbed solute concentration in the soil as sk pck k m im and p is an empirical constant then eq 8 can be express as follows 9 θ k r k c k t f k c k g k k m i m where rk k m im is the retardation factor in the mobile or immobile region and is defined as rk 1 ρp θk fk μwθk μsρp gk γwθk γsρ skcs k k m im the governing equations of solute transfer between the mobile and immobile regions are 10 θ im c im t α c m c im 11 θ m c m t α c m c im where α is the first order mass transfer coefficient between the two regions t 1 the governing equation of the solute dispersive in the mobile region is 12 θ m c m t 2 θ m d m c m z 2 where dm is the hydrodynamic dispersion coefficient in the mobile region l2t 1 which can be calculated as θmdm dl qf θmddτ where dl is the longitudinal dispersivity l qf is the absolute value of the flow rate lt 1 dd is the molecular diffusion coefficient l2t 1 τ is the tortuosity factor 2 3 the numerical implementation of the solute transport module the calculation processes of the solute transport module will be presented as follows and the flowchart illustrating the calculation processes at the time step of j 1 is shown in fig 2 the soil water movement module will be run firstly to obtain the soil water content θj 1 and the flow rate q f j 1 at the time step of j 1 according to the equations described in section 2 1 then the solute transport module will be calculated with the soil water content θj 1 and the flow rate q f j 1 at the time step of j 1 the governing equations to simulate the solute transport processes described in section 2 2 will be solved in sequence specifically the solute advective movement is solved firstly and the discrete scheme of eq 7 by the finite difference method is 13 a 1 c m i 1 j 1 s 1 b 1 c m i j 1 s 1 e 1 c m i 1 j 1 s 1 f 1 14 a 1 q i 1 2 j 1 1 ω η 15 b 1 m i θ m i j 1 δ t q i 1 2 j 1 1 ω 1 η q i 1 2 j 1 1 ω 1 η 16 e 1 q i 1 2 j 1 1 ω η 17 f 1 m i θ m i j c m i j δ t q i 1 2 j 1 ω η c m i 1 j 1 η c m i j q i 1 2 j 1 ω η c m i j 1 η c m i 1 j where i indicates the layer number j indicates the time level mi represents the thickness of the soil layer i l q i 1 2 j 1 is the flow rate between layer i 1 and layer i at the time step of j 1 lt 1 which has been calculated by the soil water movement module and the positive direction is downward while q i 1 2 j 1 is the flow rate between layer i and layer i 1 at the time step of j 1 lt 1 c m i j 1 s 1 is the concentration of the solute in the mobile region for the layer i after the procedure 1 at the time step of j 1 ml 3 η is the weight of upwind scheme and ω is the factor to indicate the explicit or implicit scheme the concentration of the solute in the immobile region c im j 1 s 1 ml 3 remains unchanged after procedure 1 which can be expressed as c im j 1 s 1 c im j where c im j is the final concentration of solute in the immobile region at the time step of j ml 3 then eq 9 can be calculated as 18 c k i j 1 s 2 c k i j 1 s 1 δ t f k i j 1 ω c k i j 1 s 1 g k i j 1 θ k i j 1 r k i j 1 1 δ t f k i j 1 1 ω θ k i j 1 r k i j 1 k m i m where c k i j 1 s 2 k m im is the concentration of the solute in the mobile or immobile region for the layer i after the procedure 2 at the time step of j 1 lt 1 in addition eq 10 and eq 11 can be calculated as 19 c m i j 1 s 3 c m i j 1 s 2 α δ t θ m i j 1 c m i j 1 s 2 c im i j 1 s 2 20 c im i j 1 s 3 c im i j 1 s 2 α δ t θ im i j 1 c m i j 1 s 2 c im i j 1 s 2 where c m i j 1 s 3 and c im i j 1 s 3 are the concentration of the solute in the mobile and immobile region for the layer i after the procedure 3 at the time step of j 1 lt 1 respectively at last the crank nicolson scheme is used to make eq 12 discrete as 21 a 2 c m i 1 j 1 s 4 b 2 c m i j 1 s 4 e 2 c m i 1 j 1 s 4 f 2 22 a 2 θ d m i 1 2 m i 1 m i 23 b 2 m i θ m i j 1 δ t θ d m i 1 2 m i 1 m i θ d m i 1 2 m i m i 1 24 e 2 θ d m i 1 2 m i m i 1 25 f 2 m i θ m i j 1 c m i j 1 s 3 δ t θ d m i 1 2 c m i 1 j 1 s 3 c m i j 1 s 3 m i 1 m i θ d m i 1 2 c m i 1 j 1 s 3 c m i j 1 s 3 m i 1 m i where c m i j 1 s 4 is the concentration of the solute in the mobile region for layer i after the procedure 4 at the time step of j 1 lt 1 the concentration of the solute in the immobile region c im j 1 s 4 ml 3 remains unchanged after the procedure 4 which can be expressed as c im j 1 s 4 c im j 1 s 3 the final concentration of solute at the time step of j 1 c k j 1 k m im can be obtained after all the four major procedures as c k j 1 c k j 1 s 4 k m im it is important to mention that the flow rate obtained by the soil water movement module should be checked before the calculation of the solute transport module to achieve acceptable numerical results these methods can exhibit significant artificial oscillatory and or excessive numerical dispersion due to the inherent disadvantage of the fixed grid finite difference method zheng and wang 1999 therefore the peclet number and courant number have been used to ensure the reasonable discretization of space and time the two dimensionless numbers have been defined as šimůnek et al 2009 26 pe q f δ x θ m d m 27 cr q f δ t θ m r m δ x where qf is the flow rate lt 1 δx l and δt t are the discretization of space and time respectively θm is the soil water content in the mobile region l3l 3 and rm is the retardation factor in the mobile region the upstream weight η is set as 1 when the peclet number exceeds 5 0 the courant number has been used to adjust the discretization of time step as shown in fig 2 the maximum cr value of the profile will be returned after the calculation of soil water movement when the maximum cr value exceeds 1 the discretization of time step will be decreased then the soil water movement module will be rerun with the adjusted time step until the cr 1 is satisfied 3 model evaluation in this section three cases are designed to evaluate model performance under complicated heterogeneity conditions the simulation results are compared with the published experimental results obtained values using hydrus 1d šimůnek et al 2009 and the practical observations for these cases the root mean squared error rmse schoups et al 2006 the mean absolute relative error are the determination coefficient r 2 and the refined version of willmott s dimensionless index of agreement dr willmott et al 2012 are used to quantitatively evaluate the misfit between the simulated results of the developed model and reference values which are calculated as 28 rmse 1 n num ii 1 n num y ii y ii 2 29 are 1 n num ii 1 n num y ii y ii y ii 100 30 r 2 1 ii 1 n num y ii y ii 2 ii 1 n num y ii y ii 2 31 d r 1 ii 1 num y ii y ii 2 ii 1 num y ii y ii when ii 1 num y ii y ii 2 ii 1 num y ii y ii 2 ii 1 num y ii y ii ii 1 num y ii y ii 1 when ii 1 num y ii y ii 2 ii 1 num y ii y ii where the subscript ii represents the serial number of results nnum represents the total number of results yii is the simulated result of the model yii is the reference result and y ii is the mean value of the reference results dr ranges from 1 to 1 and dr 0 5 indicates the sum of the calculation error magnitudes is small than one half of the model deviation and observed deviation magnitudes willmott et al 2012 3 1 case 1 laboratory tracer experiment under saturated conditions in this case the developed model was used to simulate the solute transport in the laboratory tracer experiment presented by huang et al 1995 there are two 12 5 m long horizontally placed soil columns with cross sectional area of 0 1 0 1 m2 one soil column is packed with homogeneous sandy soil while the other is a heterogeneous one packed with a wide range of soil materials the measured total porosity of the sandy soil used to fill the homogeneous column is 0 33 and the total porosity of the materials used to fill the heterogeneous column is 0 37 which is estimated based on the porosity of each material the breakthrough curves btcs of nacl in the columns were measured with electrical conductivity probes inserted at 50 or 100 cm intervals during the steady saturated water flow stage the steady darcian flow rates for each column were measured which indicate the water flux per unit time assuming soil water pass through all the portion of the cross section of the soil column the pore water velocities and dispersion coefficients were estimated by comparing the btcs of nacl with the analytical solutions of ade and the pore water velocities indicate the actual water flux per unit time assuming soil water only pass through the pores of the cross section of the soil column the effective porosity was estimated by dividing the steady darcian flow rates by the pore water velocities which represents the space occupied by the mobile water of the cross section the average effective porosities for the homogeneous column and the heterogeneous column are 0 33 and 0 23 respectively more detailed information about the experiment can be found from huang et al 1995 the total porosity of the homogeneous soil column 0 33 equals the effective porosity 0 33 which indicates that the immobile water content is zero for the homogeneous condition however the total porosity of the heterogeneous soil column 0 37 is significantly larger than the effective porosity 0 23 which indicates that there exists immobile water in the heterogeneous soil column therefore the immobile soil water content for the homogeneous soil column was set as zero when simulating by the developed model while the immobile soil water content for the heterogeneous soil column should not be ignored the flow rate and dispersion coefficient when simulating the solute transport process in the homogeneous soil column were from huang et al 1995 by comparing the btcs of nacl with the analytical solutions of ade for the heterogeneous soil column the fractions of immobile region β were calculated by the darcian flow rates and the pore water velocities the parameters α and dl were obtained by calibration the parameters used by the developed model are listed in table 1 fig 3 shows the comparison of the observed and simulated relative concentrations of the two columns in case 1 and the rmse are r 2 and dr values of the simulated relative concentrations are listed in table 1 for the homogeneous soil column the btcs of nacl are regular and sigmoidal the rmse are r 2 and dr of the simulated relative concentrations at x 2 0 m x 5 0 m x 8 0 m and x 11 0 m were 0 127 0 052 0 027 0 024 83 6 27 3 10 1 3 2 0 986 0 991 0 997 0 997 and 0 814 0 929 0 961 0 957 respectively the rmse r 2 and dr values indicate the satisfactory performance of the simulated relative concentrations the large errors of the are values are caused by the steep shape of the btcs of nacl above all the simulated relative concentrations match the observations well the developed model has a satisfactory performance when describing the solute transport process in the homogeneous soil column ignoring the immobile region for the heterogeneous soil column the btcs of nacl are irregular and non sigmoidal as shown in fig 3 b which has been referred to as the anomalous transport phenomenon when adopting the mim assumption the rmse are r 2 and dr at x 3 0 m x 7 0 m and x 11 0 m were 0 088 0 030 0 039 49 9 6 5 9 9 0 986 0 941 0 986 and 0 856 0 949 0 927 respectively which shows that the simulated relative concentrations fit well with the observations the simulated relative concentrations for the heterogeneous soil column ignoring the immobile region are also shown in fig 3 b when comparing the results at x 3 0 m for the heterogeneous column there is a significant tailing behavior and the model ignoring the immobile region fails to describe the phenomenon and the same results can be found at x 11 0 m in general the simulation results indicate the satisfactory performance of the developed model under both homogeneous and heterogeneous saturated solute transport conditions 3 2 case 2 synthetic heterogeneous case with atmospheric boundary condition this synthetic case was carried out to evaluate the performance of the developed model under the complex heterogeneous condition with different spatial and temporal discretization the soil column was set as 2 m in length filled with alternating layers of two types of soil each layer being 0 4 m thick the two soil types are sandy loam and silt loam and the filling starts with silt loam in the first layer the soil hydraulic parameters are listed in table 2 the lower boundary is impermeable and the upper boundary applied is the atmospheric boundary condition as shown in fig 4 including the daily precipitation and the actual soil evaporation there is no crop in this case the concentration of the precipitation was set as 1 g l the initial soil water content was unified as 0 25 cm3 cm3 while the initial concentration of the profile was unified as 0 5 g l the results calculated by hydrus 1d were used as references the immobile water was set as zero in this case to ensure consistent input conditions of the two models the hydraulic parameters used by hydrus 1d are also listed in table 2 the spatial discretization of hydrus 1d was set as 2 cm seven modeling scenarios with different space discretization and time steps were used for evaluating the model performance under coarse discretization of space and time and the different scenarios are 2 cm and 0 1 d 10 cm and 0 1 d 10 cm and 1 d 20 cm and 0 1 d 20 cm and 1 d 20 cm and 5 d 20 cm and 10 d in space and time in case 2 evaporation plays a major role in driving the soil water upward during the first half of calculation time while intense precipitation is adopted during the latter half of calculation time fig 5 a d shows the comparison of the soil water content profiles between hydrus 1d and the developed model at different times in case 2 while fig 5 e h shows the comparison of the soil salt content profiles between hydrus 1d and the developed model the soil water content profiles show very sharp change due to the alternating change of soil types the rmse are r 2 and dr values at different times for the soil water content when the spatial step is 2 cm and time step is 0 1 d are 0 024 cm3 cm3 0 029 cm3 cm3 0 039 cm3 cm3 0 028 cm3 cm3 6 2 9 1 10 0 5 9 0 952 0 935 0 846 0 923 and 0 931 0 910 0 837 0 909 the rmse are r 2 and dr values for the soil salt contents are 0 031 g kg 0 048 g kg 0 040 g kg 0 024 g kg 6 7 12 7 12 5 7 7 0 879 0 685 0 893 0 951 and 0 907 0 828 0 833 0 894 the mass balance errors of soil water and soil salt for the developed model are 1 5 10 28 and 2 6 10 5 respectively the mass balance errors of soil water and soil salt for hydrus 1d are 2 2 10 5 and 2 4 10 9 respectively it can be found that the simulated soil water contents and soil salt contents match the values calculated by hydrus 1d well the results show that the developed model can simulate soil water movement and solute transport satisfactorily under the condition of arid and semi arid agricultural system with a complicated atmospheric boundary and complex heterogeneous soil profile where all irrigation and precipitation are treated as infiltration the simulated soil water content and soil salt content profiles of the seven scenarios with different discretization of space and time in case 2 are compared with those from hydrus 1d as shown in fig 5 the time averaged rmse are r 2 and dr values of the soil water content profiles and soil salt content profiles are listed in table 3 it can be found that for all scenarios the rmse values of the soil water content profiles are smaller than 0 04 cm3 cm3 the are values smaller than 13 the r 2 values larger than 0 85 and the dr values larger than 0 82 the rmse values of the soil salt content profiles are smaller than 0 06 g kg the are values smaller than 16 the r 2 values larger than 0 8 and the dr values larger than 0 74 which indicate the acceptable performance of the model however with the increase of the discretization of space and time the results become worse the reason is that the larger discretization of space and time would lead to numerical dispersion and ignore the intermediate fluctuations of the soil water contents and soil salt contents in temporal and spatial moreover the water balance errors for all the scenarios are smaller than 1 10 27 while the solute balance errors are smaller than 1 10 4 as shown in table 3 which indicates the excellent mass balance of the developed model as a contrast two scenarios with coarse discretization of space and time 10 cm and 1 d for scenario 1 20 cm and 1 d for scenario 2 were calculated by hydrus 1d the iteration number of soil water movement module and the mass balance errors are shown in fig 6 a and fig 6 b respectively the black crosses in fig 6 show the non convergence of the calculation for soil water movement module the non convergence phenomena occur at the 139th day in scenario 1 and the 194th day in scenario 2 the mass balance errors of the solute transport module are much larger than those of the developed model the results show that using the numerical model with a coarse discretization of space and time may lead to unreasonable results for the unsaturated soil water movement and solute transport process while the developed model provides satisfactory calculation results and mass balance errors for different discretization of space and time 3 3 case 3 salt accumulation and leaching processes in hetao irrigation district this practical case was used to evaluate the performance of the developed model and investigate the effect of the scheme when calculating the soil salt accumulation and leaching processes by considering the immobile region 3 3 1 study area the developed model was used to calculate the salt accumulation and leaching processes in hetao irrigation district fig 7 shows the location of the study site the yonglian irrigation area 107 37 19 108 51 04 e 40 45 57 41 17 58 n inner mongolia china the irrigation area belongs to yichang sub district and is 12 km long from north to south and 3 km wide from east to west the whole domain size is 29 75 km2 the ground surface elevation decreases from 1028 9 m to 1025 4 m from the southwest to the northeast thirteen soil water and salt observation points were distributed in this area as shown in fig 7 a no 1 no 2 no 3 no 5 no 6 and no 13 locate on farmland area fm while no 4 and no 8 locate on useless land in the village ulv and no 7 no 9 no 10 no 11 and no 12 locate on bare soil area bs the purpose of the classification of observation points is due to their significant different upper boundary conditions a elaborated survey was conducted to obtain the vertical soil type distributions of the observation points as shown in fig 7 b intense heterogeneity can be found in the practical agricultural area soil types were determined based on the distributions of the soil particle size and the values of the residual soil water content θr the saturated soil water content θs and the saturated hydraulic conductivity ks for each soil type were taken from carsel and parrish 1988 which lists the descriptive statistics of the soil hydraulic parameters based on more than 5000 samples these soil hydraulic parameters are listed in table 4 the soil water contents were observed 3 times every month from may to october within the depth of 1 4 m in 2008 the soil salt contents were observed 3 times which were before crop growing period on april 26 2008 during the crop growing period on july 26 2008 and after the harvest period on october 6 2008 respectively the reference evapotranspiration et o in 2008 was calculated by the measured evaporation data from the 20 cm pan et 20 multiplying by the conversion coefficient 0 55 which was recommended by hao 2016 by comparing the monthly et o and et 20 with 8 years data in hetao irrigation district the precipitation irrigation and et o in 2008 are shown in fig 8 a the total precipitation is 299 3 mm the irrigation water during the crop growing season is 224 5 mm while the autumn irrigation water is 140 9 mm the precipitation does not contain dissolved solute while the salt concentration of the irrigation water diverted from the yellow river is 0 65 g l the irrigation water was only applied to the farmland it is difficult for irrigation to cause a lateral flow of groundwater during the crop growth period because of the high evapotranspiration mao et al 2019 the observed soil water contents and soil salt contents from all 13 observation points in 2008 were used to calibrate the model parameters the upper and lower boundary conditions were atmosphere boundary and impermeable boundary respectively the major crops in fm are sunflower wheat maize and beet and the cover proportions of the total farmland are 52 19 11 and 4 respectively since the spatial distribution of each crop was not recorded a set of synthetic crop parameters are assumed and adopted for all farmlands the crop growth period is divided into four stages which are initial stage crop development stage mid season stage and late season stage as fao 56 report described and the corresponding parameters e g crop coefficient kc leaf area index lai and root depth hroot for the four stages during the crop growth period were the weighted averaged values of the major crops maize wheat and sunflower with references to other studies in this region yang 2019 ren 2018 hao 2015 yan 2008 as shown in fig 8 b plants growing on bare soil and useless land in the village are relatively similar in the study area which are mainly sparsely distributed perennial shrubs and trees therefore the crop parameters for observation points on bare soil and useless land in the village do not vary as dramatically as those on farmland do and the values are small because of the sparse distribution the adopted values with reference to other studies in this region ren 2018 yang et al 2019 are shown in fig 8 b the initial conditions of soil water contents and soil salt contents during the calibration period were given based on the observation on april 26 2008 for each point as shown in fig 9 moreover there is a field autumn irrigation experiment and the place of the experiment is shown in fig 7 a the experiment began on october 16 2000 and the autumn irrigation event lasted 5 days with 180 mm irrigation water applied the experiment lasted two weeks the initial and ending soil water contents and soil salt contents were measured the data of soil water contents and soil salt contents obtained during the autumn irrigation experiment in 2000 were used for model validation the observed soil water contents and soil salt contents on october 16 2000 were used as the initial conditions during the validation period the upper and lower boundary conditions were flux boundary and impermeable boundary respectively there was no crop during the validation period the experimental site is in the middle of the field and the duration of the experiment is short therefore the effect of lateral flow is also ignored during the validation period to investigate the effect of considering the immobile region on the simulation results the developed model was calculated by ignoring the immobile region referenced as m1 and by considering the immobile region referenced as m2 the soil profile was set as 4 m in length and the spatial step was set as 10 cm while the time step was set as 1 d 3 3 2 model calibration and validation the observed soil water contents and soil salt contents from all 13 observation points in 2008 were used to calibrate the model parameters the observed soil water contents were used to calibrate the field capacity θf for each soil type the observed soil salt contents were used to calibrate the longitudinal dispersion dl for m1 ignoring the immobile region while the observed soil salt contents were used to calibrate the immobile soil water content fraction β and the longitudinal dispersion dl for m2 considering the immobile region the regional averaged soil water profiles classified by the locations of the 13 observation points during the calibration period on july 26 2008 and october 6 2008 are shown in fig 10 for july 26 2008 the regional averaged rmse are r 2 and dr of soil water contents for observation points on fm ulv and bs are 0 034 cm3 cm3 0 063 cm3 cm3 0 039 cm3 cm3 9 8 20 3 13 2 0 449 0 613 0 843 and 0 617 0 660 0 704 for october 6 2008 the regional averaged rmse are r 2 and dr for observation points on fm ulv and bs are 0 035 cm3 cm3 0 028 cm3 cm3 0 030 cm3 cm3 8 0 9 3 7 7 0 407 0 676 0 800 and 0 556 0 680 0 655 besides the rmse are r 2 and dr of soil water content profiles for observation points on fm ulv and bs at every observation time were calculated the spatio temporal averaged values are listed in table 5 it can be found that the spatio temporal averaged rmse values are smaller than 0 042 cm3 cm3 the are values smaller than 12 5 the r 2 values larger than 0 565 and the dr values large than 0 5 the rmse are and dr values are acceptable while the r 2 value is in moderate correlation range the regional averaged soil salt content profiles classified by the location of the 13 observation points during the calibration period on july 26 2008 and october 6 2008 are shown in fig 11 for july 26 2008 the regional averaged rmse are r 2 and dr of soil salt contents for observation points on fm ulv and bs for m1 ignoring the immobile region are 0 83 g kg 1 62 g kg 0 80 g kg 20 5 21 1 20 8 0 327 0 913 0 977 and 0 492 0 677 0 664 the r 2 value for observation points on fm is small which may be caused by the poor performance of the point near the soil surface and the strong variability of soil salt content while the rmse are and dr values indicate an acceptable simulated result for the whole profile the regional averaged rmse are r 2 and dr of soil salt content for observation points on fm ulv and bs for m2 considering the immobile region are 0 51 g kg 1 64 g kg 0 83 g kg 15 5 20 7 21 1 0 765 0 901 0 987 and 0 637 0 668 0 652 for october 16 2008 the regional averaged rmse are r 2 and dr of soil salt content for observation points on fm ulv and bs for m1 are 0 78 g kg 2 26 g kg 0 95 g kg 29 1 32 0 17 8 0 228 0 235 0 489 and 0 353 0 561 0 659 the regional averaged rmse are r 2 and dr of soil salt content for observation points on fm ulv and bs for m2 are 0 41 g kg 1 33 g kg 0 67 g kg 16 3 18 7 19 3 0 612 0 958 0 828 and 0 652 0 739 0 675 the r 2 and dr values for observation points on fm is small for m1 while the rmse and are values indicate an acceptable simulated result the rmse are r 2 and dr of soil salt content profiles for observation points on fm ulv and bs at every observation time were calculated the time averaged values for observation points on fm ulv and bs are listed in table 5 the spatio temporal averaged rmse values are smaller than 1 47 g kg for m1 the averaged are values smaller than 24 the dr values larger than 0 61 and the r 2 values larger than 0 7 for observation points on ulv and bs the spatio temporal averaged rmse values are smaller than 1 17 g kg for m2 the are values smaller than 20 the r 2 values larger than 0 7 and dr values larger than 0 75 overall the simulated soil water contents and soil salt contents agree well with the observed data during the calibration period the calibrated field capacity θf for each soil type are listed in table 4 the calibrated longitudinal dispersion dl is 0 4 m for m1 ignoring the immobile region while the calibrated longitudinal dispersion dl is 0 4 m and the immobile soil water content fraction β is 0 2 for m2 considering the immobile region the first order mass transfer coefficient α has a very slight impact on the simulation results which is 0 001 d 1 in the simulation for the longitudinal dispersion dl in hetao irrigation district li 2009 used feflow to study the soil water movement and solute transport process and the dl was set as 0 5 m zhao 2011 presented that the dl was 0 7 m based on the numerical simulation of modflow surfact ren 2018 adopted 0 1 m as the value of dl with their hydrus dualkc model the calibrated dl in this study is 0 4 m which is consistent with the order of magnitude previous studies for the immobile soil water content fraction β yang and cai 1991 recommended that the β for heterogeneous soil ranged from 0 2 to 0 6 jaynes et al 1995 concluded that the β for undisturbed soil varied from 0 to 0 35 gao et al 2008 proposed that the average value of β for the significant heterogeneous soil column was about 0 4 it can be found that the calibrated immobile soil water content fraction β in this study is consistent with the previous studies the calibrated parameters were used to simulate the soil water movement and soil salt transport for the autumn irrigation experiment in 2000 the comparison of the simulated soil water contents and soil salt contents and the observed data are shown in fig 12 the rmse are r 2 and dr values for the soil water contents after autumn irrigation are 0 041 cm3 cm3 10 00 0 052 and 0 042 the simulated soil water contents are almost unchanged for different depths while the observed value has a slight variation with depth which leads to the poor performance of r 2 and dr the simulated results are acceptable considering the satisfactory performance of rmse and are values the rmse are r 2 and dr values for the soil salt contents after autumn irrigation for m1 ignoring the immobile region are 0 28 g kg 23 1 0 477 and 0 418 the rmse are r 2 and dr values for the soil salt contents after autumn irrigation for m2 considering the immobile region are 0 25 g kg 17 5 0 750 and 0 695 these results show a good agreement between the observations and simulations which indicates the calibrated parameters are reasonable 3 3 3 the effect of the immobile region on salt transport the soil salt content profiles calculated by m1 ignoring the immobile region and m2 considering the immobile region are compared as follows during the calibration period the time averaged rmse are r 2 and dr values of soil salt content profiles for observation points on fm ulv and bs are listed in table 5 it can be found that the rmse are r 2 and dr values calculated by m2 for each land use type are better than the values calculated by m1 except the are value for bare soil the averaged rmse of soil salt contents for all land use types calculated by m2 is 0 72 g kg which is 21 9 smaller than the result calculated by m1 0 93 g kg during the validation period it can be also found that the rmse are r 2 and dr values calculated by m2 are better than the values calculated by m1 as a result it can be concluded that the results calculated by m2 are better than m1 these results show the existence of anomalous transport phenomenon in the study area which has been found in other agricultural areas dufilho and falco 2020 karup et al 2016 koestel and larsbo 2014 used an industrial x ray scanner to visualize the solute transport through saturated undisturbed soil and the results show that the solute transport bypasses more than 90 of the bulk soil volume rukh et al 2018 conducted experimental studies and drawn the conclusions that there were two sources of preferential flow i macropore flow under saturated conditions and ii bypass flow in the matrix due to regions of disconnected water under unsaturated conditions for the salt transport case in agricultural areas when considering the immobile region the salt prefers to accumulate near the soil surface while the salt is more easily leached to the deeper layers when ignoring the immobile region as shown in fig 11 and fig 12 which is not the case in heterogeneous soils the in situ monitoring experiments also indicate that the soil salt prefers to accumulate near the soil surface and is difficult to leach han 2017 yu 2014 li 2011 the reason is that the significant evapotranspiration and shallow groundwater table depth of the irrigation area lead to obvious upward flux during the crop growing season from may to october causing the soil salt accumulation near the soil surface when the irrigation or precipitation occurs the infiltration is probably a preferential flow process because of the intensive soil heterogeneity therefore part of soil salt may be leaching out of the soil while the other part may be still stored near the soil surface which is described as the salt stored in the immobile region in the developed model as a result the soil salt contents near the soil surface for the heterogeneous soil are bigger than the soil salt contents for the homogenous soil generally the scheme when calculating the soil salt transport process by considering the immobile region gives a better result under the practical conditions the regional averaged application during the calibration period shows that the rmse of the simulated soil salt content profiles when considering the immobile region is about 20 better than that when ignoring the immobile region therefore it is necessary to take significant anomalous transport into account when studying the salt accumulation and leaching processes in practical agricultural systems 4 conclusions in this paper a new soil water movement and solute transport model is developed for understanding the salt accumulation and leaching processes in practical agricultural systems the mobile immobile scheme is introduced to describe the obvious anomalous transport phenomenon in practice the merits and demerits of the model are discussed and the developed model is applied to the real world salt accumulation and leaching problem in hetao irrigation district conclusions are presented below 1 the developed model can describe solute transport well under heterogeneous conditions with the help of the mobile immobile assumption 2 the developed model can keep the mass balance well and has looser restrictions on the discretization of space and time than the numerical solution of richards equation which makes it more suitable for practical conditions 3 the real world application shows that the rmse of the simulated soil salt content profiles when considering the immobile region is about 20 better than that when ignoring the immobile region and it is necessary to take the significant anomalous transport into account for practical agricultural systems credit authorship contribution statement wei mao conceptualization methodology software validation writing original draft writing review editing yan zhu conceptualization funding acquisition methodology project administration validation writing original draft writing review editing jingwei wu funding acquisition project administration ming ye validation writing original draft jinzhong yang conceptualization funding acquisition methodology project administration validation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the study was partially supported by the national key research and development program of china 2017yfc0403301 and natural science foundation of china through grants 51779178 51790532 and the project of water conservancy science and technology plan in inner mongolia autonomous region grant no 213 03 99 303002 nsk2017 m1 
5070,soil salinization has become a widespread problem that seriously affects the sustainable development of agriculture to deal with the salt accumulation and leaching problems in practical agricultural systems a new soil water and solute transport model adopting the mass balance scheme is developed in this study the soil water movement module is based on a previously published soil water mass balance model named as ubmod the mobile immobile assumption has been adopted to develop the soil solute transport module which can describe the obvious anomalous transport phenomenon in practice the advection chemical reactions of solute solute transfer between the mobile and immobile regions and dispersion in the mobile region are considered in the solute transport module while only chemical reactions and solute transfer between the mobile and immobile regions are considered in the immobile region three cases were designed to evaluate the performance of the model by comparing the simulation results with those obtained by experimental results hydrus 1d and practical observations the results demonstrate that the developed model can solve the homogeneous and heterogeneous soil water movement and solute transport effectively and it has looser restrictions on the discretization of space and time than the numerical solution of richards equation and can keep the mass balance well which make it more suitable for practical conditions moreover the real world application of salt accumulation and leaching problems in hetao irrigation district inner mongolia china shows that the rmse of the simulated soil salt content with the immobile present region is about 20 better than that when ignoring the immobile present region therefore it is necessary to take the significant anomalous transport into account when studying the salt accumulation and leaching processes in practical agricultural systems keywords soil water movement solute transport mobile immobile assumption mass balance model salt accumulation and leaching 1 introduction soil salinization is a widespread problem more than 20 of the global irrigated areas 450 000 km2 are salt affected daliakopoulos et al 2016 qadir et al 2014 nellemann et al 2009 evapotranspiration is the predominant hydrological process contributing to the soil salt accumulation in those arid and semi arid agricultural areas with shallow water table depth as water evaporates from soil or transpires through plants salts are accumulated near the soil surface assouline et al 2015 the widely adopted method to control the soil salinization is leaching the salt downward through the root zone with additional irrigation water minhas et al 2020 ben gal et al 2008 corwin et al 2007 nevertheless the excessive irrigation water may lead to a shallow water table depth which in turn increases evapotranspiration and results in salt accumulation near the soil surface singh 2019 wichelns and qadir 2014 besides the salt transport process is affected by complicated practical hydrogeological conditions and intensive heterogeneity of the unsaturated zone therefore salt accumulation and leaching in practical agricultural systems is a sophisticated phenomenon agro hydrological models are effective tools for studying salt accumulation and leaching processes lekakis and antonopoulos 2015 plaut et al 2013 letey et al 2011 many numerical models based on the richards equation re to describe the unsaturated soil water flow and the advective dispersive equation ade to describe the solute transport have been established and widely used such as swap kroes et al 2017 hydrus šimůnek et al 2016 hanson et al 2008 swim huth et al 2012 feflow diersch 2013 the advantages of these models are their solid physical basis and they can give accurate results however very fine discretization of space and time is required to obtain an accurate solution of re because of the high non linearity of the equation in addition intensive input data and model parameters are also needed which are not always available in practice visconti et al 2014 moran et al 2004 moreover the stability of the numerical solution is also challenged when excessive irrigation water is applied into the dry soil repeatedly zha et al 2017 which is a common phenomenon in arid agricultural areas numerical problems can be alleviated by developing mass balance models these models are developed based on the principle of mass balance and some simplified or empirical expressions rather than the kinetic equations zha 2014 gandolfi et al 2006 the mass balance methods take advantage of computational efficiency small mass balance error model stability and usability especially in large scale modelling where data and fundamental understanding of the factors and processes are lacking ranatunga et al 2008 in fact these methods are widely used in crop models agricultural water and salt management models regional hydrological models such as aquacrop foster et al 2017 saltmod chang et al 2019 mao et al 2017 swat xiong et al 2019 arnold et al 2012 catsalt tuteja et al 2002 soilwat holzworth et al 2014 oasis mod model askri et al 2010 saltirsoil visconti et al 2011 the mass balance models can be classified into two kinds based on their treatment to unsaturated zone ranatunga et al 2008 the first kind treats the unsaturated zone or the root zone as a single layer such as saltmod catsalt oasis mod and saltirsoil however the assumption that the single layer filled with vertical homogeneous soil means it is difficult for these models to describe the salt accumulation and leaching processes accurately another kind of mass balance model is the multiple layers model which considers water and salt balance in a cascade of soil layers in unsaturated zone such as aquacrop swat and soilwat the tipping bucket method is used to describe the soil water movement driven by the gravitational potential constantin et al 2020 and empirical equations are used to describe the capillary rise from groundwater to soil water however the soil water movement driven by the matric potential is usually neglected this simplification limits the model application in arid agricultural areas where salt accumulates near the soil surface due to the strong and continuous evapotranspiration rengasamy 2006 valipour 2014 to overcome the deficiency mao et al 2018 developed a soil water balance model called as ubmod by adding an equation to describe the soil water movement driven by the matric potential the model is efficient and has satisfactory performance for coarse discretization of space and time which make it suitable for practical agricultural problems another concern is the intense heterogeneity of the porous media under practical conditions the widely applied ade method adopts the homogeneous hypothesis implicitly which cannot adequately account for the significant anomalous transport in heterogeneous porous media in practice sternagel et al 2019 jarvis 2007 köhne et al 2009 beven and germann 2013 to describe the anomalous transport the aquacrop model divides each soil layer into several regions where salt can be stored and each region represents a range of pore size of the heterogeneous porous media the field capacity has been used to distinguish small pores and macro pores and the soil water movement was assumed to only occur in macro pores salt diffusion can occur both in small pores and macro pores and salt diffusion in the region which belongs to small pores is slower than that in the region which belongs to macro pores raes et al 2018 the scheme handling the salt transport process in aquacrop is similar to the mobile immobile mim assumption which divides the porous media into mobile flowing region and immobile stagnant region the mobile immobile assumption was aimed at describing the anomalous transport phenomenon the performance of the mim method is better than the ade method when describing solute transport in both homogeneous and heterogeneous porous media li et al 2020 gao et al 2012 gao et al 2010 gao et al 2009 however it may arbitrary and rigid to divide the immobile region and the mobile region by the field capacity since experiments and observations show that the soil water movement can occur when the soil water content is smaller than the field capacity assouline and or 2014 in this study a new model to calculate the soil water and anomalous solute transport in agricultural areas is developed based on the mass conservation principle the water movement module is based on ubmod model which is a water balance model and considers the soil water movement driven by the gravitational potential external forces and the matric potential the model can simulate both upward and downward soil water movement in heterogeneous situations effectively the solute transport module is developed based on the mobile immobile assumption a specific soil water content θd is introduced to distinguish the mobile region and the immobile region instead of the field capacity the solute advection process chemical reactions process solute transfer process between the mobile and immobile regions and solute dispersive process in the mobile region are considered while only chemical reactions and solute transfer between the mobile and immobile regions are considered in the immobile region the merits and demerits of the developed model have been analyzed the objectives of this study are to 1 introduce the methodology of the developed soil water movement and solute transport mass balance model and 2 evaluate the performance of the model under synthetic and real world agricultural conditions 2 methodology and model development in this section the soil water movement module is first presented followed by the description of the solute transport module the numerical implementation of the solute transport module is given last 2 1 the soil water movement module the soil water movement module is based on ubmod model which has been elaborated in mao et al 2018 this section briefly describes the model to make this paper self contained the model divides the one dimensional soil profile and time into soil layers and time steps in each time step there are four major calculation procedures to describe the soil water movement as shown in fig 1 a firstly the allocation of infiltration water is calculated the soil water content of the profile is filled to be saturated from the surface soil layer to the underlying soil layer until all the infiltration water is consumed the model is developed according to the situation of arid and semi arid agricultural systems and the surface runoff is ignored therefore the irrigation and precipitation are all treated as infiltration the amount of allocated water for a given layer i is shown as follows 1 q i min m i θ s i θ i i i d i 1 where i indicates the vertical soil layer i 1 n n is the total number of soil layers qi is the amount of allocated water per unit area of layer i l mi is the thickness of layer i l θi is the initial soil water content of layer i l3l 3 θs i is the saturated water content of layer i l3l 3 i is the quantity of infiltration water per unit area l id i 1 is the consumed infiltration water per unit area by all upper layers above layer i l all the soil water content used in the article is the volumetric moisture then the soil water movement driven by the three forces the gravitational potential the source sink term for external forces and the matric potential is calculated sequentially the governing equation for the soil water movement driven by the gravitational potential is shown as follows 2 θ t k θ z where t is the time t k θ is the unsaturated hydraulic conductivity lt 1 as a function of soil water content θ z is the elevation in the vertical direction l the relationship between k θ and θ is characterized by empirical formulas with the purpose of simplifying calculation and eliminating parameters these empirical formulas are referred to as drainage functions and the commonly used ones are listed in mao et al 2018 the governing equation for the source sink term is 3 θ t w where w is the source sink term t 1 to account for soil evaporation and root uptake term of crop transpiration the fao penman monteith equation and dual crop coefficient approach are adopted to calculate the soil evaporation and crop transpiration in the absence of stress the calculated values are then assigned to soil layers according to the evaporation cumulative distribution function and the root density function the actual soil evaporation and crop transpiration are deduced based on the effects of soil water stress and salt stress besides the crop coefficient kc leaf area index lai and root depth hroot are calculated by a crop growth model which is used to simulate the crop growing processes the governing equation for soil water diffusive movement driven by the matric potential is 4 θ t z d θ θ z where d θ is the hydraulic diffusivity l2t 1 with the help of the diffusion equation eq 4 the water movement module can consider the upward soil water movement driven by the matric potential which is ignored by many water balance models a correction term is introduced to describe the vertical spatial variability of soils which makes the model applicable to heterogeneous situations the expanded equation can be expressed as 5 θ t z d θ θ z l 1 l θ p l p l z where pl l 1 2 l is a parameter of the soil water retention function and l is the total number of the parameters l 1 l θ p l p l z is the correction term the soil water movement process is split into four procedures for simplifying the calculation the assumptions adopted by the first procedure introduce a piston type soil water content profile which may lead to a large downward flux driven by the gravitational potential however it is an intermediate result and the bias will be corrected by the upward flux driven by the matric potential the errors introduced by the split method and assumptions are small when fine time steps and spatial steps are adopted however the model is unlikely to be accurate when larger time steps are used after an infiltration event mao et al 2018 the flow rate of the soil water can be obtained based on mass balance calculation after all the four procedures described above which is expressed as qf lt 1 2 2 the solute transport module the mobile immobile assumption has been adopted in the solute transport module for describing the significant anomalous transport phenomenon in heterogeneous porous media in this study the soil water content θd is introduced to distinguish the mobile and immobile regions which can be specified by users and is smaller than the field capacity θf the total soil water content is divided as 6 θ θ m θ im θ im θ d if θ θ d θ θ m θ im θ m 0 if θ θ d where θ is the total soil water content l3l 3 θm and θim are the soil water content in the mobile and immobile regions l3l 3 respectively β is used to indicate the fraction of immobile region β θim θs for a specific layer the solute advection process chemical reaction processes solute transfer process between the mobile and immobile regions and solute dispersive process in the mobile region are considered while only chemical reaction processes and solute transfer process between the mobile and immobile regions are considered in the immobile region the schematic major calculation procedures simulated in the solute transport module are presented in fig 1 b the governing equation of solute advective movement is shown as 7 θ m c m t θ m v m v m z where cm is the solute concentration in the mobile region ml 3 vmθm equals to the flow rate qf which is calculated by the soil water movement module the dissolve and adsorption zero and first order rate reactions of the liquid and solid solute are considered in the chemical reactions term the governing equation of chemical reactions in the mobile or immobile region is 8 θ k c k t ρ s k t μ w θ k c k μ s ρ s k γ w θ k γ s ρ s k c s k k m i m where ck k m im is the solute concentration in the mobile or immobile region ml 3 ρ is the bulk density ml 3 sk k m im is the concentration of the solid solute in the mobile or immobile region mm 1 μw is the first order rate constant for solutes in the liquid phase t 1 μs is the first order rate constant for solute absorbed onto the solid phase t 1 γw is the zero order rate constant for solutes in the liquid phase ml 2t 1 γs is the zero order rate constant for solutes absorbed onto the solid phase t 1 sk k m im is the sink term in the mobile or immobile region t 1 cs k k m im is the concentration of the sink term in the mobile or immobile region ml 3 the linear equation is used to represent the equilibrium interactions between the solution concentration and the absorbed solute concentration in the soil as sk pck k m im and p is an empirical constant then eq 8 can be express as follows 9 θ k r k c k t f k c k g k k m i m where rk k m im is the retardation factor in the mobile or immobile region and is defined as rk 1 ρp θk fk μwθk μsρp gk γwθk γsρ skcs k k m im the governing equations of solute transfer between the mobile and immobile regions are 10 θ im c im t α c m c im 11 θ m c m t α c m c im where α is the first order mass transfer coefficient between the two regions t 1 the governing equation of the solute dispersive in the mobile region is 12 θ m c m t 2 θ m d m c m z 2 where dm is the hydrodynamic dispersion coefficient in the mobile region l2t 1 which can be calculated as θmdm dl qf θmddτ where dl is the longitudinal dispersivity l qf is the absolute value of the flow rate lt 1 dd is the molecular diffusion coefficient l2t 1 τ is the tortuosity factor 2 3 the numerical implementation of the solute transport module the calculation processes of the solute transport module will be presented as follows and the flowchart illustrating the calculation processes at the time step of j 1 is shown in fig 2 the soil water movement module will be run firstly to obtain the soil water content θj 1 and the flow rate q f j 1 at the time step of j 1 according to the equations described in section 2 1 then the solute transport module will be calculated with the soil water content θj 1 and the flow rate q f j 1 at the time step of j 1 the governing equations to simulate the solute transport processes described in section 2 2 will be solved in sequence specifically the solute advective movement is solved firstly and the discrete scheme of eq 7 by the finite difference method is 13 a 1 c m i 1 j 1 s 1 b 1 c m i j 1 s 1 e 1 c m i 1 j 1 s 1 f 1 14 a 1 q i 1 2 j 1 1 ω η 15 b 1 m i θ m i j 1 δ t q i 1 2 j 1 1 ω 1 η q i 1 2 j 1 1 ω 1 η 16 e 1 q i 1 2 j 1 1 ω η 17 f 1 m i θ m i j c m i j δ t q i 1 2 j 1 ω η c m i 1 j 1 η c m i j q i 1 2 j 1 ω η c m i j 1 η c m i 1 j where i indicates the layer number j indicates the time level mi represents the thickness of the soil layer i l q i 1 2 j 1 is the flow rate between layer i 1 and layer i at the time step of j 1 lt 1 which has been calculated by the soil water movement module and the positive direction is downward while q i 1 2 j 1 is the flow rate between layer i and layer i 1 at the time step of j 1 lt 1 c m i j 1 s 1 is the concentration of the solute in the mobile region for the layer i after the procedure 1 at the time step of j 1 ml 3 η is the weight of upwind scheme and ω is the factor to indicate the explicit or implicit scheme the concentration of the solute in the immobile region c im j 1 s 1 ml 3 remains unchanged after procedure 1 which can be expressed as c im j 1 s 1 c im j where c im j is the final concentration of solute in the immobile region at the time step of j ml 3 then eq 9 can be calculated as 18 c k i j 1 s 2 c k i j 1 s 1 δ t f k i j 1 ω c k i j 1 s 1 g k i j 1 θ k i j 1 r k i j 1 1 δ t f k i j 1 1 ω θ k i j 1 r k i j 1 k m i m where c k i j 1 s 2 k m im is the concentration of the solute in the mobile or immobile region for the layer i after the procedure 2 at the time step of j 1 lt 1 in addition eq 10 and eq 11 can be calculated as 19 c m i j 1 s 3 c m i j 1 s 2 α δ t θ m i j 1 c m i j 1 s 2 c im i j 1 s 2 20 c im i j 1 s 3 c im i j 1 s 2 α δ t θ im i j 1 c m i j 1 s 2 c im i j 1 s 2 where c m i j 1 s 3 and c im i j 1 s 3 are the concentration of the solute in the mobile and immobile region for the layer i after the procedure 3 at the time step of j 1 lt 1 respectively at last the crank nicolson scheme is used to make eq 12 discrete as 21 a 2 c m i 1 j 1 s 4 b 2 c m i j 1 s 4 e 2 c m i 1 j 1 s 4 f 2 22 a 2 θ d m i 1 2 m i 1 m i 23 b 2 m i θ m i j 1 δ t θ d m i 1 2 m i 1 m i θ d m i 1 2 m i m i 1 24 e 2 θ d m i 1 2 m i m i 1 25 f 2 m i θ m i j 1 c m i j 1 s 3 δ t θ d m i 1 2 c m i 1 j 1 s 3 c m i j 1 s 3 m i 1 m i θ d m i 1 2 c m i 1 j 1 s 3 c m i j 1 s 3 m i 1 m i where c m i j 1 s 4 is the concentration of the solute in the mobile region for layer i after the procedure 4 at the time step of j 1 lt 1 the concentration of the solute in the immobile region c im j 1 s 4 ml 3 remains unchanged after the procedure 4 which can be expressed as c im j 1 s 4 c im j 1 s 3 the final concentration of solute at the time step of j 1 c k j 1 k m im can be obtained after all the four major procedures as c k j 1 c k j 1 s 4 k m im it is important to mention that the flow rate obtained by the soil water movement module should be checked before the calculation of the solute transport module to achieve acceptable numerical results these methods can exhibit significant artificial oscillatory and or excessive numerical dispersion due to the inherent disadvantage of the fixed grid finite difference method zheng and wang 1999 therefore the peclet number and courant number have been used to ensure the reasonable discretization of space and time the two dimensionless numbers have been defined as šimůnek et al 2009 26 pe q f δ x θ m d m 27 cr q f δ t θ m r m δ x where qf is the flow rate lt 1 δx l and δt t are the discretization of space and time respectively θm is the soil water content in the mobile region l3l 3 and rm is the retardation factor in the mobile region the upstream weight η is set as 1 when the peclet number exceeds 5 0 the courant number has been used to adjust the discretization of time step as shown in fig 2 the maximum cr value of the profile will be returned after the calculation of soil water movement when the maximum cr value exceeds 1 the discretization of time step will be decreased then the soil water movement module will be rerun with the adjusted time step until the cr 1 is satisfied 3 model evaluation in this section three cases are designed to evaluate model performance under complicated heterogeneity conditions the simulation results are compared with the published experimental results obtained values using hydrus 1d šimůnek et al 2009 and the practical observations for these cases the root mean squared error rmse schoups et al 2006 the mean absolute relative error are the determination coefficient r 2 and the refined version of willmott s dimensionless index of agreement dr willmott et al 2012 are used to quantitatively evaluate the misfit between the simulated results of the developed model and reference values which are calculated as 28 rmse 1 n num ii 1 n num y ii y ii 2 29 are 1 n num ii 1 n num y ii y ii y ii 100 30 r 2 1 ii 1 n num y ii y ii 2 ii 1 n num y ii y ii 2 31 d r 1 ii 1 num y ii y ii 2 ii 1 num y ii y ii when ii 1 num y ii y ii 2 ii 1 num y ii y ii 2 ii 1 num y ii y ii ii 1 num y ii y ii 1 when ii 1 num y ii y ii 2 ii 1 num y ii y ii where the subscript ii represents the serial number of results nnum represents the total number of results yii is the simulated result of the model yii is the reference result and y ii is the mean value of the reference results dr ranges from 1 to 1 and dr 0 5 indicates the sum of the calculation error magnitudes is small than one half of the model deviation and observed deviation magnitudes willmott et al 2012 3 1 case 1 laboratory tracer experiment under saturated conditions in this case the developed model was used to simulate the solute transport in the laboratory tracer experiment presented by huang et al 1995 there are two 12 5 m long horizontally placed soil columns with cross sectional area of 0 1 0 1 m2 one soil column is packed with homogeneous sandy soil while the other is a heterogeneous one packed with a wide range of soil materials the measured total porosity of the sandy soil used to fill the homogeneous column is 0 33 and the total porosity of the materials used to fill the heterogeneous column is 0 37 which is estimated based on the porosity of each material the breakthrough curves btcs of nacl in the columns were measured with electrical conductivity probes inserted at 50 or 100 cm intervals during the steady saturated water flow stage the steady darcian flow rates for each column were measured which indicate the water flux per unit time assuming soil water pass through all the portion of the cross section of the soil column the pore water velocities and dispersion coefficients were estimated by comparing the btcs of nacl with the analytical solutions of ade and the pore water velocities indicate the actual water flux per unit time assuming soil water only pass through the pores of the cross section of the soil column the effective porosity was estimated by dividing the steady darcian flow rates by the pore water velocities which represents the space occupied by the mobile water of the cross section the average effective porosities for the homogeneous column and the heterogeneous column are 0 33 and 0 23 respectively more detailed information about the experiment can be found from huang et al 1995 the total porosity of the homogeneous soil column 0 33 equals the effective porosity 0 33 which indicates that the immobile water content is zero for the homogeneous condition however the total porosity of the heterogeneous soil column 0 37 is significantly larger than the effective porosity 0 23 which indicates that there exists immobile water in the heterogeneous soil column therefore the immobile soil water content for the homogeneous soil column was set as zero when simulating by the developed model while the immobile soil water content for the heterogeneous soil column should not be ignored the flow rate and dispersion coefficient when simulating the solute transport process in the homogeneous soil column were from huang et al 1995 by comparing the btcs of nacl with the analytical solutions of ade for the heterogeneous soil column the fractions of immobile region β were calculated by the darcian flow rates and the pore water velocities the parameters α and dl were obtained by calibration the parameters used by the developed model are listed in table 1 fig 3 shows the comparison of the observed and simulated relative concentrations of the two columns in case 1 and the rmse are r 2 and dr values of the simulated relative concentrations are listed in table 1 for the homogeneous soil column the btcs of nacl are regular and sigmoidal the rmse are r 2 and dr of the simulated relative concentrations at x 2 0 m x 5 0 m x 8 0 m and x 11 0 m were 0 127 0 052 0 027 0 024 83 6 27 3 10 1 3 2 0 986 0 991 0 997 0 997 and 0 814 0 929 0 961 0 957 respectively the rmse r 2 and dr values indicate the satisfactory performance of the simulated relative concentrations the large errors of the are values are caused by the steep shape of the btcs of nacl above all the simulated relative concentrations match the observations well the developed model has a satisfactory performance when describing the solute transport process in the homogeneous soil column ignoring the immobile region for the heterogeneous soil column the btcs of nacl are irregular and non sigmoidal as shown in fig 3 b which has been referred to as the anomalous transport phenomenon when adopting the mim assumption the rmse are r 2 and dr at x 3 0 m x 7 0 m and x 11 0 m were 0 088 0 030 0 039 49 9 6 5 9 9 0 986 0 941 0 986 and 0 856 0 949 0 927 respectively which shows that the simulated relative concentrations fit well with the observations the simulated relative concentrations for the heterogeneous soil column ignoring the immobile region are also shown in fig 3 b when comparing the results at x 3 0 m for the heterogeneous column there is a significant tailing behavior and the model ignoring the immobile region fails to describe the phenomenon and the same results can be found at x 11 0 m in general the simulation results indicate the satisfactory performance of the developed model under both homogeneous and heterogeneous saturated solute transport conditions 3 2 case 2 synthetic heterogeneous case with atmospheric boundary condition this synthetic case was carried out to evaluate the performance of the developed model under the complex heterogeneous condition with different spatial and temporal discretization the soil column was set as 2 m in length filled with alternating layers of two types of soil each layer being 0 4 m thick the two soil types are sandy loam and silt loam and the filling starts with silt loam in the first layer the soil hydraulic parameters are listed in table 2 the lower boundary is impermeable and the upper boundary applied is the atmospheric boundary condition as shown in fig 4 including the daily precipitation and the actual soil evaporation there is no crop in this case the concentration of the precipitation was set as 1 g l the initial soil water content was unified as 0 25 cm3 cm3 while the initial concentration of the profile was unified as 0 5 g l the results calculated by hydrus 1d were used as references the immobile water was set as zero in this case to ensure consistent input conditions of the two models the hydraulic parameters used by hydrus 1d are also listed in table 2 the spatial discretization of hydrus 1d was set as 2 cm seven modeling scenarios with different space discretization and time steps were used for evaluating the model performance under coarse discretization of space and time and the different scenarios are 2 cm and 0 1 d 10 cm and 0 1 d 10 cm and 1 d 20 cm and 0 1 d 20 cm and 1 d 20 cm and 5 d 20 cm and 10 d in space and time in case 2 evaporation plays a major role in driving the soil water upward during the first half of calculation time while intense precipitation is adopted during the latter half of calculation time fig 5 a d shows the comparison of the soil water content profiles between hydrus 1d and the developed model at different times in case 2 while fig 5 e h shows the comparison of the soil salt content profiles between hydrus 1d and the developed model the soil water content profiles show very sharp change due to the alternating change of soil types the rmse are r 2 and dr values at different times for the soil water content when the spatial step is 2 cm and time step is 0 1 d are 0 024 cm3 cm3 0 029 cm3 cm3 0 039 cm3 cm3 0 028 cm3 cm3 6 2 9 1 10 0 5 9 0 952 0 935 0 846 0 923 and 0 931 0 910 0 837 0 909 the rmse are r 2 and dr values for the soil salt contents are 0 031 g kg 0 048 g kg 0 040 g kg 0 024 g kg 6 7 12 7 12 5 7 7 0 879 0 685 0 893 0 951 and 0 907 0 828 0 833 0 894 the mass balance errors of soil water and soil salt for the developed model are 1 5 10 28 and 2 6 10 5 respectively the mass balance errors of soil water and soil salt for hydrus 1d are 2 2 10 5 and 2 4 10 9 respectively it can be found that the simulated soil water contents and soil salt contents match the values calculated by hydrus 1d well the results show that the developed model can simulate soil water movement and solute transport satisfactorily under the condition of arid and semi arid agricultural system with a complicated atmospheric boundary and complex heterogeneous soil profile where all irrigation and precipitation are treated as infiltration the simulated soil water content and soil salt content profiles of the seven scenarios with different discretization of space and time in case 2 are compared with those from hydrus 1d as shown in fig 5 the time averaged rmse are r 2 and dr values of the soil water content profiles and soil salt content profiles are listed in table 3 it can be found that for all scenarios the rmse values of the soil water content profiles are smaller than 0 04 cm3 cm3 the are values smaller than 13 the r 2 values larger than 0 85 and the dr values larger than 0 82 the rmse values of the soil salt content profiles are smaller than 0 06 g kg the are values smaller than 16 the r 2 values larger than 0 8 and the dr values larger than 0 74 which indicate the acceptable performance of the model however with the increase of the discretization of space and time the results become worse the reason is that the larger discretization of space and time would lead to numerical dispersion and ignore the intermediate fluctuations of the soil water contents and soil salt contents in temporal and spatial moreover the water balance errors for all the scenarios are smaller than 1 10 27 while the solute balance errors are smaller than 1 10 4 as shown in table 3 which indicates the excellent mass balance of the developed model as a contrast two scenarios with coarse discretization of space and time 10 cm and 1 d for scenario 1 20 cm and 1 d for scenario 2 were calculated by hydrus 1d the iteration number of soil water movement module and the mass balance errors are shown in fig 6 a and fig 6 b respectively the black crosses in fig 6 show the non convergence of the calculation for soil water movement module the non convergence phenomena occur at the 139th day in scenario 1 and the 194th day in scenario 2 the mass balance errors of the solute transport module are much larger than those of the developed model the results show that using the numerical model with a coarse discretization of space and time may lead to unreasonable results for the unsaturated soil water movement and solute transport process while the developed model provides satisfactory calculation results and mass balance errors for different discretization of space and time 3 3 case 3 salt accumulation and leaching processes in hetao irrigation district this practical case was used to evaluate the performance of the developed model and investigate the effect of the scheme when calculating the soil salt accumulation and leaching processes by considering the immobile region 3 3 1 study area the developed model was used to calculate the salt accumulation and leaching processes in hetao irrigation district fig 7 shows the location of the study site the yonglian irrigation area 107 37 19 108 51 04 e 40 45 57 41 17 58 n inner mongolia china the irrigation area belongs to yichang sub district and is 12 km long from north to south and 3 km wide from east to west the whole domain size is 29 75 km2 the ground surface elevation decreases from 1028 9 m to 1025 4 m from the southwest to the northeast thirteen soil water and salt observation points were distributed in this area as shown in fig 7 a no 1 no 2 no 3 no 5 no 6 and no 13 locate on farmland area fm while no 4 and no 8 locate on useless land in the village ulv and no 7 no 9 no 10 no 11 and no 12 locate on bare soil area bs the purpose of the classification of observation points is due to their significant different upper boundary conditions a elaborated survey was conducted to obtain the vertical soil type distributions of the observation points as shown in fig 7 b intense heterogeneity can be found in the practical agricultural area soil types were determined based on the distributions of the soil particle size and the values of the residual soil water content θr the saturated soil water content θs and the saturated hydraulic conductivity ks for each soil type were taken from carsel and parrish 1988 which lists the descriptive statistics of the soil hydraulic parameters based on more than 5000 samples these soil hydraulic parameters are listed in table 4 the soil water contents were observed 3 times every month from may to october within the depth of 1 4 m in 2008 the soil salt contents were observed 3 times which were before crop growing period on april 26 2008 during the crop growing period on july 26 2008 and after the harvest period on october 6 2008 respectively the reference evapotranspiration et o in 2008 was calculated by the measured evaporation data from the 20 cm pan et 20 multiplying by the conversion coefficient 0 55 which was recommended by hao 2016 by comparing the monthly et o and et 20 with 8 years data in hetao irrigation district the precipitation irrigation and et o in 2008 are shown in fig 8 a the total precipitation is 299 3 mm the irrigation water during the crop growing season is 224 5 mm while the autumn irrigation water is 140 9 mm the precipitation does not contain dissolved solute while the salt concentration of the irrigation water diverted from the yellow river is 0 65 g l the irrigation water was only applied to the farmland it is difficult for irrigation to cause a lateral flow of groundwater during the crop growth period because of the high evapotranspiration mao et al 2019 the observed soil water contents and soil salt contents from all 13 observation points in 2008 were used to calibrate the model parameters the upper and lower boundary conditions were atmosphere boundary and impermeable boundary respectively the major crops in fm are sunflower wheat maize and beet and the cover proportions of the total farmland are 52 19 11 and 4 respectively since the spatial distribution of each crop was not recorded a set of synthetic crop parameters are assumed and adopted for all farmlands the crop growth period is divided into four stages which are initial stage crop development stage mid season stage and late season stage as fao 56 report described and the corresponding parameters e g crop coefficient kc leaf area index lai and root depth hroot for the four stages during the crop growth period were the weighted averaged values of the major crops maize wheat and sunflower with references to other studies in this region yang 2019 ren 2018 hao 2015 yan 2008 as shown in fig 8 b plants growing on bare soil and useless land in the village are relatively similar in the study area which are mainly sparsely distributed perennial shrubs and trees therefore the crop parameters for observation points on bare soil and useless land in the village do not vary as dramatically as those on farmland do and the values are small because of the sparse distribution the adopted values with reference to other studies in this region ren 2018 yang et al 2019 are shown in fig 8 b the initial conditions of soil water contents and soil salt contents during the calibration period were given based on the observation on april 26 2008 for each point as shown in fig 9 moreover there is a field autumn irrigation experiment and the place of the experiment is shown in fig 7 a the experiment began on october 16 2000 and the autumn irrigation event lasted 5 days with 180 mm irrigation water applied the experiment lasted two weeks the initial and ending soil water contents and soil salt contents were measured the data of soil water contents and soil salt contents obtained during the autumn irrigation experiment in 2000 were used for model validation the observed soil water contents and soil salt contents on october 16 2000 were used as the initial conditions during the validation period the upper and lower boundary conditions were flux boundary and impermeable boundary respectively there was no crop during the validation period the experimental site is in the middle of the field and the duration of the experiment is short therefore the effect of lateral flow is also ignored during the validation period to investigate the effect of considering the immobile region on the simulation results the developed model was calculated by ignoring the immobile region referenced as m1 and by considering the immobile region referenced as m2 the soil profile was set as 4 m in length and the spatial step was set as 10 cm while the time step was set as 1 d 3 3 2 model calibration and validation the observed soil water contents and soil salt contents from all 13 observation points in 2008 were used to calibrate the model parameters the observed soil water contents were used to calibrate the field capacity θf for each soil type the observed soil salt contents were used to calibrate the longitudinal dispersion dl for m1 ignoring the immobile region while the observed soil salt contents were used to calibrate the immobile soil water content fraction β and the longitudinal dispersion dl for m2 considering the immobile region the regional averaged soil water profiles classified by the locations of the 13 observation points during the calibration period on july 26 2008 and october 6 2008 are shown in fig 10 for july 26 2008 the regional averaged rmse are r 2 and dr of soil water contents for observation points on fm ulv and bs are 0 034 cm3 cm3 0 063 cm3 cm3 0 039 cm3 cm3 9 8 20 3 13 2 0 449 0 613 0 843 and 0 617 0 660 0 704 for october 6 2008 the regional averaged rmse are r 2 and dr for observation points on fm ulv and bs are 0 035 cm3 cm3 0 028 cm3 cm3 0 030 cm3 cm3 8 0 9 3 7 7 0 407 0 676 0 800 and 0 556 0 680 0 655 besides the rmse are r 2 and dr of soil water content profiles for observation points on fm ulv and bs at every observation time were calculated the spatio temporal averaged values are listed in table 5 it can be found that the spatio temporal averaged rmse values are smaller than 0 042 cm3 cm3 the are values smaller than 12 5 the r 2 values larger than 0 565 and the dr values large than 0 5 the rmse are and dr values are acceptable while the r 2 value is in moderate correlation range the regional averaged soil salt content profiles classified by the location of the 13 observation points during the calibration period on july 26 2008 and october 6 2008 are shown in fig 11 for july 26 2008 the regional averaged rmse are r 2 and dr of soil salt contents for observation points on fm ulv and bs for m1 ignoring the immobile region are 0 83 g kg 1 62 g kg 0 80 g kg 20 5 21 1 20 8 0 327 0 913 0 977 and 0 492 0 677 0 664 the r 2 value for observation points on fm is small which may be caused by the poor performance of the point near the soil surface and the strong variability of soil salt content while the rmse are and dr values indicate an acceptable simulated result for the whole profile the regional averaged rmse are r 2 and dr of soil salt content for observation points on fm ulv and bs for m2 considering the immobile region are 0 51 g kg 1 64 g kg 0 83 g kg 15 5 20 7 21 1 0 765 0 901 0 987 and 0 637 0 668 0 652 for october 16 2008 the regional averaged rmse are r 2 and dr of soil salt content for observation points on fm ulv and bs for m1 are 0 78 g kg 2 26 g kg 0 95 g kg 29 1 32 0 17 8 0 228 0 235 0 489 and 0 353 0 561 0 659 the regional averaged rmse are r 2 and dr of soil salt content for observation points on fm ulv and bs for m2 are 0 41 g kg 1 33 g kg 0 67 g kg 16 3 18 7 19 3 0 612 0 958 0 828 and 0 652 0 739 0 675 the r 2 and dr values for observation points on fm is small for m1 while the rmse and are values indicate an acceptable simulated result the rmse are r 2 and dr of soil salt content profiles for observation points on fm ulv and bs at every observation time were calculated the time averaged values for observation points on fm ulv and bs are listed in table 5 the spatio temporal averaged rmse values are smaller than 1 47 g kg for m1 the averaged are values smaller than 24 the dr values larger than 0 61 and the r 2 values larger than 0 7 for observation points on ulv and bs the spatio temporal averaged rmse values are smaller than 1 17 g kg for m2 the are values smaller than 20 the r 2 values larger than 0 7 and dr values larger than 0 75 overall the simulated soil water contents and soil salt contents agree well with the observed data during the calibration period the calibrated field capacity θf for each soil type are listed in table 4 the calibrated longitudinal dispersion dl is 0 4 m for m1 ignoring the immobile region while the calibrated longitudinal dispersion dl is 0 4 m and the immobile soil water content fraction β is 0 2 for m2 considering the immobile region the first order mass transfer coefficient α has a very slight impact on the simulation results which is 0 001 d 1 in the simulation for the longitudinal dispersion dl in hetao irrigation district li 2009 used feflow to study the soil water movement and solute transport process and the dl was set as 0 5 m zhao 2011 presented that the dl was 0 7 m based on the numerical simulation of modflow surfact ren 2018 adopted 0 1 m as the value of dl with their hydrus dualkc model the calibrated dl in this study is 0 4 m which is consistent with the order of magnitude previous studies for the immobile soil water content fraction β yang and cai 1991 recommended that the β for heterogeneous soil ranged from 0 2 to 0 6 jaynes et al 1995 concluded that the β for undisturbed soil varied from 0 to 0 35 gao et al 2008 proposed that the average value of β for the significant heterogeneous soil column was about 0 4 it can be found that the calibrated immobile soil water content fraction β in this study is consistent with the previous studies the calibrated parameters were used to simulate the soil water movement and soil salt transport for the autumn irrigation experiment in 2000 the comparison of the simulated soil water contents and soil salt contents and the observed data are shown in fig 12 the rmse are r 2 and dr values for the soil water contents after autumn irrigation are 0 041 cm3 cm3 10 00 0 052 and 0 042 the simulated soil water contents are almost unchanged for different depths while the observed value has a slight variation with depth which leads to the poor performance of r 2 and dr the simulated results are acceptable considering the satisfactory performance of rmse and are values the rmse are r 2 and dr values for the soil salt contents after autumn irrigation for m1 ignoring the immobile region are 0 28 g kg 23 1 0 477 and 0 418 the rmse are r 2 and dr values for the soil salt contents after autumn irrigation for m2 considering the immobile region are 0 25 g kg 17 5 0 750 and 0 695 these results show a good agreement between the observations and simulations which indicates the calibrated parameters are reasonable 3 3 3 the effect of the immobile region on salt transport the soil salt content profiles calculated by m1 ignoring the immobile region and m2 considering the immobile region are compared as follows during the calibration period the time averaged rmse are r 2 and dr values of soil salt content profiles for observation points on fm ulv and bs are listed in table 5 it can be found that the rmse are r 2 and dr values calculated by m2 for each land use type are better than the values calculated by m1 except the are value for bare soil the averaged rmse of soil salt contents for all land use types calculated by m2 is 0 72 g kg which is 21 9 smaller than the result calculated by m1 0 93 g kg during the validation period it can be also found that the rmse are r 2 and dr values calculated by m2 are better than the values calculated by m1 as a result it can be concluded that the results calculated by m2 are better than m1 these results show the existence of anomalous transport phenomenon in the study area which has been found in other agricultural areas dufilho and falco 2020 karup et al 2016 koestel and larsbo 2014 used an industrial x ray scanner to visualize the solute transport through saturated undisturbed soil and the results show that the solute transport bypasses more than 90 of the bulk soil volume rukh et al 2018 conducted experimental studies and drawn the conclusions that there were two sources of preferential flow i macropore flow under saturated conditions and ii bypass flow in the matrix due to regions of disconnected water under unsaturated conditions for the salt transport case in agricultural areas when considering the immobile region the salt prefers to accumulate near the soil surface while the salt is more easily leached to the deeper layers when ignoring the immobile region as shown in fig 11 and fig 12 which is not the case in heterogeneous soils the in situ monitoring experiments also indicate that the soil salt prefers to accumulate near the soil surface and is difficult to leach han 2017 yu 2014 li 2011 the reason is that the significant evapotranspiration and shallow groundwater table depth of the irrigation area lead to obvious upward flux during the crop growing season from may to october causing the soil salt accumulation near the soil surface when the irrigation or precipitation occurs the infiltration is probably a preferential flow process because of the intensive soil heterogeneity therefore part of soil salt may be leaching out of the soil while the other part may be still stored near the soil surface which is described as the salt stored in the immobile region in the developed model as a result the soil salt contents near the soil surface for the heterogeneous soil are bigger than the soil salt contents for the homogenous soil generally the scheme when calculating the soil salt transport process by considering the immobile region gives a better result under the practical conditions the regional averaged application during the calibration period shows that the rmse of the simulated soil salt content profiles when considering the immobile region is about 20 better than that when ignoring the immobile region therefore it is necessary to take significant anomalous transport into account when studying the salt accumulation and leaching processes in practical agricultural systems 4 conclusions in this paper a new soil water movement and solute transport model is developed for understanding the salt accumulation and leaching processes in practical agricultural systems the mobile immobile scheme is introduced to describe the obvious anomalous transport phenomenon in practice the merits and demerits of the model are discussed and the developed model is applied to the real world salt accumulation and leaching problem in hetao irrigation district conclusions are presented below 1 the developed model can describe solute transport well under heterogeneous conditions with the help of the mobile immobile assumption 2 the developed model can keep the mass balance well and has looser restrictions on the discretization of space and time than the numerical solution of richards equation which makes it more suitable for practical conditions 3 the real world application shows that the rmse of the simulated soil salt content profiles when considering the immobile region is about 20 better than that when ignoring the immobile region and it is necessary to take the significant anomalous transport into account for practical agricultural systems credit authorship contribution statement wei mao conceptualization methodology software validation writing original draft writing review editing yan zhu conceptualization funding acquisition methodology project administration validation writing original draft writing review editing jingwei wu funding acquisition project administration ming ye validation writing original draft jinzhong yang conceptualization funding acquisition methodology project administration validation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the study was partially supported by the national key research and development program of china 2017yfc0403301 and natural science foundation of china through grants 51779178 51790532 and the project of water conservancy science and technology plan in inner mongolia autonomous region grant no 213 03 99 303002 nsk2017 m1 
5071,we develop a bayesian hierarchical model bhm for estimating the statistical parameters for monthly average streamflows we assume monthly average streamflow can be characterized by a three parameter log normal distribution ln3 the three underlying statistical parameters are shift shape and location when estimating a parameter such as the shape of a given month the bhm utilizes historical observations not only from the month under consideration but also from all other months this is different from traditional statistical parameter estimation methods that only use historical observations for the month under consideration we apply the proposed bhm for parameter estimation to eight watersheds in the united states where historical unimpaired streamflows have been collected we also carry out parameter estimation using traditional methods such as the maximum likelihood estimation the method of moments and the l moment method using cross validation with test data log likelihood as the measure of performance the results show that bhm outperforms traditional estimation methods in addition we show that as available observation data decreases the more the proposed method improves relative to traditional methods since bhm utilizes information contained in the entire data set it is especially suited for parameter estimation where historical observations are limited furthermore we conduct a comparative analysis between bhm and an autoregressive model to demonstrate the advantage of bhm keywords bayesian hierarchical model bayesian statistics three parameter log normal distribution monthly average streamflow frequency analysis statistical parameters estimation 1 introduction frequency analysis is a useful statistical tool in hydrology it is implemented by fitting an assumed probability distribution to the observed data of a random variable stedinger 1980 xiong et al 2014 frequency analysis has been used to estimate extreme hydrologic events such as maximum streamflow and it can be used for estimating average streamflow as well in flood frequency analysis maximum streamflow is considered a random variable while frequency analysis for average streamflow treats the annual or monthly average streamflow as a random variable the assumed probability distributions for the two different types of frequency analysis are generally not identical the generalized extreme value distribution gev i e the generalized form of weibull and gumbel distributions and the log pearson type 3 distribution lp3 are standard choices for flood frequency analysis bobee 1975 rao 1980 hosking et al 1985a 1985b smith 1987 obee and ashkar 1991 rosbjerg and madsen 1995 stedinger and lu 1995 hosking and wallis 1996 vogel and wilson 1996 morrison and smith 2002 and griffis and stedinger 2007 singh 2013 compared with flood frequency analysis the choice of distribution for average streamflow is more flexible using the chi square goodness of fit statistic markovic 1965 compared the fit of normal n log normal ln2 three parameter log normal ln3 gamma gam and pearson type 3 p3 distributions for the annual average streamflow the results suggest that gam p3 ln2 and ln3 are all capable of fitting the distributions vogel and wilson 1996 further tested the above distributions of annual average streamflow in the u s using an l moment diagram they concluded that annual average streamflows are well approximated by p3 ln2 or ln3 distributions unlike annual average streamflows literature dealing with the choice of distribution for monthly average streamflow is sparse even though monthly average streamflow may be used more frequently than annual average streamflow for water resource management and reservoir operations yeh 1985 xu et al 2015a xu et al 2015b li et al 2019 since the time scale becomes shorter the volatility of monthly average streamflow would be higher than annual average streamflow therefore a three parameter distribution would be suitable for monthly average streamflow due to its greater flexibility thus both p3 and ln3 would be good choices for monthly average streamflow furthermore sangal and biswas 1970 suggested that ln3 can be applied successfully to the frequency analysis of both annual flows and monthly flows and they also reported that p3 and lp3 will not be reliable when data are limited yue and hashino 2007 demonstrated the ability of using ln3 to fit precipitation data bowers et al 2012 also showed that river flow data are typically better fitted by a log normal distribution than by a power law distribution therefore in this study we select three parameter log normal distribution ln3 to approximate monthly average streamflow we also conduct the shapiro wilk normality test to ensure this approximation is valid shapiro and wilk 1965 royston 1995 devineni et al 2013 many traditional estimation methods have been applied to estimate ln3 parameters hill 1963 showed that the global maximum likelihood estimation mle may approach infinity which is inadmissible cohen 1951 proposed the local maximum likelihood estimation lmle by equating partial derivatives of the log likelihood function to zero the studies of harter and moore 1966 calitz 1973 cohen and whitten 1980 and griffiths 1980 showed the validity of lmle and suggested that it should be considered the prime method of estimating ln3 parameters method of moments estimation mme is a simple method that estimates parameters by equating the first second and third sample moments with the population values however this method may suffer from a large sampling error introduced by the second and third sample moments cohen 1988 johnson et al 1994 moreover the log normal distribution may not be uniquely determined by its moments heyde 1963 inspired by the fact that the first order statistic in the sample exerts much greater influence on the shift parameter cohen and whitten 1980 proposed the modified method of moments estimation mmme which is similar to mme but substitutes a function of the first order statistic the l moment method l mom first introduced by hosking 1990 is also a popular way to estimate parameters it matches the linear combinations of order statistics i e l moments for parameter estimation which is analogous to mme but more robust to outliers combining the idea of mme and mle griffiths 1980 introduced the zero skewness method zeros this method first computes the shift parameter by equating the sample skewness of log transformed data to zero then estimates the other two parameters i e the shape and location parameters by mle thus the estimation of the shift parameter and the other two parameters in this method are separate steps this will be utilized and further discussed in the next section other popular methods for estimating ln3 parameters include the median method sangal and biswas 1970 method of least squares snyder and wallace 1974 and method of entropy singh et al 1986 singh and singh 1987 singh et al 1990 all of the above mentioned traditional methods can be applied to estimate ln3 parameters of monthly average streamflow for a given month however they only use historical observations for the month under consideration it is likely that the monthly average streamflow for different months are related because of the time correlations of streamflow in other words some useful information contained in the other months i e between group information is not utilized since traditional methods only can use the within group information therefore the goal of this paper is to develop a new ln3 estimation method for monthly average streamflow that uses both within group and between group information bayesian hierarchical models bhms are a class of statistical models known for modeling many statistical applications involving multiple parameters that can be regarded as related or connected in some way by the structure of the problem gelman et al 2013 this makes bhm a perfect model to capture the between group information when estimating the parameters of monthly average streamflow for different months commonly used statistical models often face the following difficulty with few parameters the models cannot fit data accurately whereas with a lot of parameters the overfitting problem arises however as pointed out by gelman et al 2013 bhms have enough parameters to fit data well while using a population distribution to structure some dependence into the parameters thereby avoiding overfitting a typical full bhm model structure is shown in fig 1 1 consider a set of j groups of experiments the data layer contains the data x j or statistics extracted from the data for each group j while the parameters layer includes the parameters that we want to estimate for all groups these two layers usually are linked with an implied likelihood function as a bayesian method prior distributions are needed for parameters parameters are modeled as random variables in bayesian inference which reflect the belief ones have about the parameters people often choose conjugate priors to facilitate derivations i e the posterior and the prior distributions are in the same family of distributions assume the prior distributions are σ j 2 iid p σ j 2 a b in which there are two additional parameters a b these parameters are called hyperparameters and they determine the shape of the priors thus we further use a hyperprior to specify the prior distributions of the hyperparameters note that the variables of the hyperpriors are hyperparameters e g a b while the variables of the priors are the parameters that we want to estimate e g σ j 2 therefore the difference between prior and hyperprior is that they are prior distributions for model parameters σ j 2 and hyperparameters a b respectively in terms of the model structure they are at different layers in the hierarchical models additionally bhm allows flexible inference approaches that come with many versions and variations even though all the variations share the same principle of using several modeling layers there are two main versions of bhm 1 full bayesian inference under the hierarchical model i e full bhm shown in fig 1 1 and 2 empirical bayes method i e empirical bhm shown in fig 1 2 the full bhm is the complete and rigorous model that contains data parameters hyperparameters and a hyperprior with a hyperprior in a full bhm we can first derive the posterior distribution of hyperparameters as p a b x then use the mcmc method to draw from this posterior distribution which accounts for the uncertainty introduced from the hyperparameters a b in contrast the empirical bhm does not specify a hyperprior instead it uses a point estimate for the hyperparameters a b e g maximum likelihood estimator mle in eq 1 1 a b arg max a b j 1 j p x j a b in other words in an empirical bhm the hyperparameter will be fixed after it is estimated which simplifies the estimating process although it loses some flexibility and uncertainties also in some cases it is not even feasible to estimate hyperparameters by mle since some optimization problems just don t have an optimum or are very difficult to solve many bhm application studies in hydrology have been published the bhm of multisite daily rainfall based on the binomial distribution and gaussian process lima and lall 2009 the spatio temporal bhm for extreme precipitation based on gev and copula sang and gelfand 2009 ghosh et al 2011 the bhm in assessing streamflow response to a climate change based on gev and generalized pareto distribution gpd wei et al 2012 the spatial bhm of extreme precipitation and extreme runoff based on gev and gpd cooley et al 2007 el adlouni and ouarda 2009 najafi and moradkhani 2013 yan and moradkhani 2015 steinschneider and lall 2015 bracken et al 2016 and the bhm of annual peak snow water equivalent swe annual peak flow and annual peak reservoir elevation based on gev bracken et al 2018 renard 2011 estimated annual maximum rainfall in a regional context by constructing a bhm based on gev and a regression model known as the link function between data and parameters devineni et al 2013 directly applied a bhm on a linear regression model to reconstruct the average summer streamflow at five gauges in the delaware river basin using eight regional tree ring chronologies results of all the aforementioned studies show the advantages of bhm over traditional methods since information contained in the data from different groups mostly locations are combined with the help of bhm however most existing bhm studies in hydrology focus on extreme hydrological variables i e maximum streamflow and rainfall this is because frequency analysis of extreme events is more useful than average streamflow for designing flood control structures for this purpose the most well known bhm framework is based on the generalized extreme value distribution i e bhm gev which is designed to model extreme random variables cooley et al 2007 el adlouni and ouarda 2009 sang and gelfand 2009 ghosh et al 2011 however we believe that normal events e g the monthly average streamflow are also very important especially for reservoir management and operation yeh 1985 xu et al 2015a xu et al 2015b li et al 2019 for example a better estimation of the monthly average streamflow certainly will lead to better reservoir operations for the purpose of hydropower production or water supply thus in this paper we propose a new bhm i e bhm ln3 for estimating the statistical parameters for monthly average streamflows based on ln3 distribution the proposed bhm also can be applied to any random variables that follow a ln3 distribution also when constructing a full bhm there can be two types of hyperpriors used the noninformative hyperprior i e flat hyperprior and the informative hyperprior a flat hyperprior is widely used when prior knowledge is not available for hyperparameters and most of the bhm application studies in hydrology adopt this type of hyperprior e g el adlouni and ouarda 2009 lima and lall 2009 renard 2011 ghosh et al 2011 yan and moradkhani 2015 in contrast the use of an informative hyperprior is much less frequent and most informative hyperpriors found in the literature are empirical for example in building a bhm for estimating extreme precipitation cooley et al 2007 assume a uniform 0 001 0 02 distribution on a hyperparameter based on empirical information in their bhm modeling of extreme precipitation bracken et al 2016 use a weakly informative normal hyperprior centered at zero with an empirical standard deviation thus in our paper we also develop a new informative hyperprior that is expected to extract information from the data skewness the proposed bhm under this informative hyperprior is compared with the frequently used flat hyperprior we employ a 4 folds cross validation cv to compare the proposed bhm with traditional ln3 estimation methods the test data log likelihood is used as the criterion for model selection and comparison the results show that our proposed bhm produces better parameter estimates than the selected traditional parameter estimation methods for all data sizes long medium and short the fewer the observation data the more the proposed method improves over the traditional methods we outline this paper as follows section 2 1 introduces the data structure and the division of two seasons section 2 2 describes the zero skewness method for estimating the shift parameter section 2 3 proposes the new bhm for estimating the shape parameter variance bhm and develops a new informative hyperprior section 2 4 discusses bhm for estimating the location parameter mean bhm section 2 5 summarizes the estimated three parameter log normal distribution ln3 based on bhm section 2 6 introduces log likelihood as the goodness of fit metric as well as illustrates the k folds cv and the model selection criteria section 3 applies the proposed method to eight watersheds in the united states section 4 compares bhm with an autoregressive model and investigates the potential loss of uncertainty we then provide final remarks and conclusions in section 5 2 methodology 2 1 data preparation 2 1 1 data structure and assumed data distribution the data used to conduct this research is the historical monthly average streamflow and it is structured as fig 2 where n is the total number of historical data series the monthly average streamflow x j is modeled as a random variable that follows a f distribution e g f can be a normal distribution log normal distribution etc x ij is a sample value of random variable x j and pa r j is a set of parameters of the distribution of x j i e the distribution of x j is f x j p a r j in this study we select a three parameter log normal distribution ln3 for f because 1 ln3 is a flexible distribution with a general skewness that can be used successfully for analyzing hydrologic data and 2 ln3 is highly related to a normal distribution by subtracting the shift parameter γ and then taking the log transformation a ln3 variable can be transformed into a normal variable which is the desired property for constructing bhm the probability density function pdf of the ln3 distribution is 2 f x p a r 1 x γ σ 2 π exp ln x γ θ 2 2 σ 2 where x is a random variable that follows the ln3 distribution i e f x par is a set of parameters i e par γ σ 2 θ γ is the shift parameter satisfying the constraint of γ x σ 2 is the shape parameter with σ 0 and θ is the location parameter the goal is to estimate the distribution f x j p a r j for the monthly average streamflow random variable x j for each month j j 1 2 12 2 1 2 division of data into a dry season and wet season the advantage of bhm is that it can make use of the between group s information however if information in the two groups are intrinsically far away from each other then bayesian analysis may not be able to improve the results for example the mean value of streamflow of july may be highly correlated with the mean value of streamflow of august yet it will be largely uncorrelated with the mean value of streamflow of january in many regions streamflow in july may be much lower than that of january therefore to maximize the advantage of bhm we divide the year into two seasons dry season and wet season we will construct a hierarchical model for each of the two seasons in our case study we consider june to november as the dry season and december to may as the wet season note that the way to divide the data is not fixed and this is not even required 2 2 zero skewness method for estimating the shift parameter γ the zero skewness method griffiths 1980 royston 1992 is a traditional method for estimating ln3 parameters it is a combination of moment method estimation mme and maximum likelihood estimation mle note that zero skewness refers to y i e the transformed data after we remove the skewness in x i e the original streamflow data and the only assumption made is that the original data x follows ln3 in this study we adopt this zero skewness method to estimate shift parameter γ as follows 1 since the original streamflow data i e x is assumed to follow ln3 distribution we first carry out a log transformation on x γ note here the shift parameter γ is unknown and will be estimated and the log transformed result is y i e y log x γ then the transformed data y should follow a normal distribution 2 since the skewness for normal distribution i e y is zero then 3 skewness y 0 using the estimator of the population skewness eq 3 can be future expressed as 4 1 n i 1 n y i y 3 1 n i 1 n y i y 2 3 2 0 where y i log x i γ and y is the mean value of y when estimating a normal distribution the skewness estimator used in eq 4 is unbiased and consistent kendall and stuart 1969 cramer 1997 joanes and gill 1998 doane and seward 2011 3 since eq 4 has only one unknown i e γ solving eq 4 kowarik 0000 millard 2013 yields the γ estimate the reason we estimate γ by the zero skewness method is because the estimation of γ is independent of the estimation of θ and σ 2 in this method this independence provides an opportunity to improve the estimation of θ and σ 2 with the proposed bhm after estimating γ by the zero skewness method we will then construct our bhms to estimate θ and σ 2 we first perform a log transformation on x ij γ j i e the original samples following ln3 minus γ to get y ij as fig 3 shows we now refer to our data as y ij to ensure that y j follows a normal distribution for each month j we conduct the shapiro wilk normality test shapiro and wilk 1965 royston 1995 devineni et al 2013 if y j passes the shapiro wilk normality test then y j is normally distributed with parameters θ j and σ j 2 and x j follows the three parameter log normal distribution 2 3 bayesian hierarchical model for estimating σ 2 variance bhm 2 3 1 structure of variance bhm a bhm is constructed for estimating the shape parameter σ 2 as shown in fig 4 after the log transformation the data now are y ij where i 1 n and j 1 j 6 6 months groups in each season our goal is to estimate the parameter σ j 2 which parameterizes the distribution of y j 5 y j log x j γ j n θ j σ j 2 where σ j 2 is the unknown shape parameter for month j and θ j is the unknown location parameter for month j a sufficient statistic is widely used in the bayesian analysis to facilitate derivations fraser 1963 kholevo 2001 steel 2007 in our proposed bhm model a sufficient statistic for the parameter σ j 2 is the sample variance s j 2 for each group j 6 s j 2 1 n 1 i 1 n y ij y j 2 based on the distribution ross 2006 we formulate 7 d s j 2 σ j 2 χ d 2 where d n 1 i e constant and χ d 2 is the chi squared distribution with d i e n 1 degrees of freedom a conjugate prior is used for estimating σ j 2 hoff 2009 8 σ j 2 v s 0 2 iid i n v χ 2 v s 0 2 j 1 j 6 where inv χ 2 v s 0 2 is an inverse chi squared distribution parameterized by v and s 0 2 hyperparameters it is also the conjugate prior in bayesian statistics when estimating a normal variance with unknown mean raiffa and schlaifer 1961 gelman et al 2013 based on eqs 7 and 8 the conditional posterior distribution of σ j 2 given the hyperparameters v s 0 2 can be derived as see appendix a 9 p σ j 2 v s 0 2 s j 2 i n v χ 2 v d v s 0 2 d s j 2 v d j 1 6 if we can draw a sufficient number of posterior hyperparameter samples i e v s 0 2 s 2 then the posterior of σ j 2 can be obtained by sampling from eq 9 therefore the posterior distribution of hyperparameters p v s 0 2 s 2 needs to be derived to perform a full bayesian analysis a hyperprior p v s 0 2 is needed for p v s 0 2 s 2 where s 2 is the set of all s j 2 i e s 2 s j 2 j 1 6 for different seasons i e dry and wet we propose different hyperpriors for now we assume the hyperprior is p v s 0 2 thus the posterior distribution of hyperparameters can be derived as see appendix b 10 p v s 0 2 s 2 p v s 0 2 j j 1 beta v 2 d 2 s 0 2 v 2 v 2 v s 0 2 d s j 2 2 v d 2 where beta x y is the beta function i e beta x y γ x γ y γ x y and γ x is the gamma function note that the posterior distribution p v s 0 2 s 2 is conditioned on s 2 s 1 2 s j 2 rather than a single s j 2 since information from all the months groups is being used to estimate hyperparameters v s 0 2 this is how bhm incorporates between group information into estimating a certain group s parameter σ j 2 gelman et al 2013 based on the distributions in eqs 9 10 and the law of total expectation wolpert 2010 we are now able to calculate the bayesian estimator σ j 2 b superscript b represents bayesian by the posterior mean of σ j 2 11 σ j 2 b e σ j 2 s 2 e e σ j 2 v s 0 2 s 2 s 2 e σ j 2 v s 0 2 s j 2 s 2 where σ j 2 is the conditional posterior mean of σ j 2 given v s 0 2 i e 12 σ j 2 v s 0 2 s j 2 e σ j 2 v s 0 2 s 2 v s 0 2 d s j 2 v d 2 v 2 v d 2 v s 0 2 v 2 d v d 2 s j 2 b σ 2 v s 0 2 v 2 1 b σ 2 s j 2 the second equality comes from the fact that the expected value i e e σ j 2 v s 0 2 of inv χ 2 v s 0 2 i e the inverse chi squared distribution is v s 0 2 v 2 the ratio v 2 v d 2 is the shrinkage factor b σ 2 0 1 for this variance bhm which indicates the magnitude of shrinkage from mle i e s j 2 to the prior expected value i e e σ j 2 v s 0 2 once we have simulated a large sample v k s 0 k 2 k 1 n we can approximate the expectation of eq 11 by monte carlo simulation we summarize the algorithm for estimating σ j 2 b in the following steps step 1 draw n a large number samples of v k s 0 k 2 from the posterior distribution of hyperparameters p v s 0 2 s 2 i e eq 10 based on the metropolis hastings algorithm a mcmc method metropolis et al 1953 step 2 for each v k s 0 k 2 calculate the expected value σ j 2 v k s 0 k 2 s j 2 using eq 12 step 3 calculate the mean of σ j 2 σ j 2 b 1 n k 1 n σ j 2 v k s 0 k 2 s j 2 according to the weak law of large numbers when n is sufficiently large σ j 2 b converges in probability to the bayesian estimator e σ j 2 s 2 derived from the proposed bhm model a key advantage of our proposed bhm is that σ j 2 b is estimated not only using the within group information but also the between group information thus it is expected that the results from bhm will have an expected mean square error mse that is less than or equal to the traditional mle i e e m s e σ j 2 b e m s e σ j 2 m l e due to its shrinkage efron and morris 1977 chaloner 1987 berger 2013 2 3 2 selection of hyperprior for variance bhm bhm requires a hyperprior p v s 0 2 to provide the prior knowledge of hyperparameters see eq 10 though how to select this hyperprior p v s 0 2 is an interesting question the choice of p v s 0 2 has negligible impact on the results since it merely represents the prior knowledge of the hyperparameters in this study we suggest two different hyperpriors for the variance of bhm the first is the noninformative hyperprior or flat hyperprior and the second is the informative hyperprior a flat hyperprior is widely used when prior knowledge is not available for either hyperparameter v s 0 2 or parameter σ 2 itself in other words a flat hyperprior will lead to the same possibility for every σ 2 value instead of focusing on any particular σ 2 value it is expected to work well unless the number of groups j is low gelman 2006 we derive our flat hyperprior as follows first we assume v and s 0 2 are independent in the prior 13 p v s 0 2 p v p s 0 2 then we assume v is uniformly distributed on 0 15 d where d n 1 thus we arrive at 14 p v s 0 2 p s 0 2 v 0 15 d to make a flat hyperprior we further assume p s 0 1 by a change of variable we can derive the flat hyperprior as 15 p v s 0 2 1 s 0 2 v 0 15 d a fairly wide but finite support i e 0 15 d for hyperparameter ν is specified to ensure 1 the posterior of the hyperparameters i e dis 10 is always proper i e integrable to a finite value based on the proposed flat hyperprior i e dis 15 gelman et al 2013 and 2 the shrinkage factor b σ 2 is sufficiently large when v approaches its maximum this will not limit the degree of shrinkage of the model for example when v approaches 15d b σ 2 0 1 will be close to 15 16 which is sufficiently large for most applications using a flat hyperprior is safe but rather conservative so if some additional information on parameter σ 2 can be extracted from the data or by expertise an informative hyperprior should be considered however very few bhm applications in hydrology have developed informative hyperpriors in this study we suggest a possible way of constructing an informative hyperprior by extracting prior information from the data skewness first the skewness of ln3 is defined as ske w j and it is a function of only one parameter σ j 2 16 ske w j e σ j 2 2 e σ j 2 1 based on the idea of mme the sample skewness of historical streamflow records b j j 1 6 can be calculated by 17 b j n n 1 n 2 i 1 n x ij x j 3 i 1 n x ij x j 2 3 2 where x ij is the monthly averaged historical streamflow in year i for month j x j is the mean of historical streamflow records for month j and n is total number of years of historical streamflow records eq 17 is also known as the adjusted fisher pearson standardized moment coefficient which is adopted by excel sas and spss as the default way to calculate skewness doane and seward 2011 although it is a biased estimator it provides an adjustment for sample size which makes it closer to an unbiased estimator joanes and gill 1998 doane and seward 2011 thus eq 17 is a good skewness estimator that can help alleviate the bias problem common to most skewness estimators as pointed out by wallis et al 1974 another potential issue for the estimators of skewness is the boundedness kirby 1974 that is the estimators may reach bound due to smaller sample size or hydroclimatic variability using the l moment estimator would alleviate this concern letting ske w j b j i e the exact moment matching with σ j 2 unknown we can obtain the prior estimate of σ j 2 from skewness in the data denoted as σ j 2 then we calculate the average of σ j 2 j 1 6 18 ave σ 2 1 6 j 1 6 σ j 2 now we have ave σ 2 as the prior knowledge of σ 2 and we proceed to extract the prior information of the hyperparameters v s 0 2 i e determine hyperprior p v s 0 2 we want our hyperprior to reflect the prior knowledge recall that our prior is an inverse chi squared distribution 19 σ j 2 v s 0 2 i n v χ 2 v s 0 2 the mode and expected value of this inverse chi squared distribution are 20 mode v s 0 2 v 2 21 expected v a l u e v s 0 2 v 2 v 2 since we want every σ j 2 sampled from eq 19 to be close to ave σ 2 we set the mode or the expected value of 19 equal to ave σ 2 which leads to 22 v s 0 2 v 2 a v e σ 2 reformulating eq 22 we arrive at 23 v s 0 2 v a v e σ 2 2 a v e σ 2 0 we expect samples from the hyperprior p v s 0 2 have a high chance of satisfying eq 23 our goal is then to find a distribution as our informative hyperprior this distribution should have its highest probability density on the points v s 0 2 that satisfy eq 23 we suggest a simple informative hyperprior that can achieve this goal in the form of 24 p v s 0 2 1 v s 0 2 v a v e σ 2 2 a v e σ 2 k where k is a constant coefficient and k 0 the choice of value for k as well as the choice of a positive or negative sign is not restricted in this process the hyperprior parameter σ j 2 in eq 24 is estimated only from the data skewness not from any other data information i e sample variance and mean used in the bhm model therefore using σ j 2 as the prior information of σ j 2 will not cause over fitting i e no reuse of the same data information after that we calculate ave σ 2 i e the average of six σ j 2 and equate it to the mean mode of the prior distribution from which we derive eq 23 this step specifies the prior information of v s 0 2 from the skewness based estimates σ j 2 based on that equation we finally propose eq 24 as our informative hyperprior note that the derived informative hyperprior is based on the assumption that all six months prior information of σ j 2 i e σ j 2 can be represented by ave σ 2 which requires all six σ j 2 to be concentrated on ave σ 2 i e var σ j 2 the variance of σ j 2 is small this requirement may only be satisfied for the months in the wet season since the months in the dry season typically have high skewness and thus large σ j 2 values which often may lead to large var σ j 2 values therefore although the choice of using the flat or informative hyperprior is rather flexible we only use the flat hyperprior for the months of the dry season for the months in the wet season we can either be conservative and use the flat hyperprior or adopt the informative hyperprior as proposed in sum for each watershed the following two scenarios of hyperprior will be compared 1 use the flat hyperprior for both the dry and wet season 2 use the flat hyperprior for the dry season and adopt the proposed informative hyperprior for the wet season 2 4 bayesian hierarchical model for estimating θ mean bhm another bhm mean bhm is used for estimating the location parameter θ as shown in fig 5 this mean bhm originally was discussed in gelman et al 2013 where the authors assumed the true variances σ j 2 are known however in this study we first estimate σ j 2 b from section 2 3 and then build the mean bhm conditioning on σ j 2 b we first represent the data y ij by its sample mean y j for each group j which is also a sufficient statistic for θ j 25 y j 1 n i 1 n y ij where n is the total number of historical records in each month then the likelihood function can be derived from 26 y j θ j σ j 2 n θ j σ j 2 where we define σ j 2 σ j 2 b n j and assume n 1 n 2 n j n for simplicity we use a conjugate prior to provide the prior information for estimating θ j 27 θ j u τ 2 iid n u τ 2 j 1 j 6 where n u τ 2 is a normal distribution parameterized by u and τ 2 hyperparameters it is also the conjugate prior in bayesian statistics when estimating the normal mean with known variance based on eqs 26 and 27 the conditional posterior distribution of θ j given hyperparameters u τ 2 can be formulated as 28 θ j u τ 2 y σ j 2 n θ j v j where 29 θ j 1 σ j 2 y j 1 τ 2 u 1 σ j 2 1 τ 2 1 τ 2 1 σ j 2 1 τ 2 u 1 σ j 2 1 σ j 2 1 τ 2 y j b θ u 1 b θ y j and 30 v j 1 1 σ j 2 1 τ 2 the ratio 1 τ 2 1 σ j 2 1 τ 2 is the shrinkage factor b θ 0 1 for this mean bhm which indicates the magnitude of shrinkage from mle i e y j to the prior expected value u i e e θ j u τ 2 if sufficient posterior hyperparameter samples i e u τ 2 y are available then the posterior of θ j can be obtained by sampling from eq 28 in such instances the posterior distribution of hyperparameters p u τ 2 y needs to be derived we assume the hyperprior is p u τ 2 the posterior distribution of the hyperparameters i e p u τ 2 y can be formulated as 31 p u τ 2 y p u τ 2 j j n y j u σ j 2 τ 2 where n y j u σ j 2 τ 2 represents the probability density function pdf of the normal distribution of y j with mean u and variance σ j 2 τ 2 and y is the set of all y j i e y y 1 y 6 also for the mean bhm we choose the flat hyperprior because the location parameter θ unlike the shape parameter σ 2 often is dispersed widely for different months gelman et al 2013 derived a flat hyperprior in the mean bhm as 32 p u τ 2 1 τ to improve sampling stability we propagate p u τ 2 y in factored form based on bayes rule 33 p u τ 2 y p τ 2 y p u τ 2 y compute the posterior distribution of τ 2 i e p τ 2 y as 34 p τ 2 y p u τ 2 y d u 1 τ v u 1 2 j 1 j 6 σ j 2 τ 2 1 2 exp y j u 2 2 σ j 2 τ 2 where 35 u j 1 j 1 σ j 2 τ 2 y j j 1 j 1 σ j 2 τ 2 and 36 v u j 1 j 1 σ j 2 τ 2 1 then the posterior distribution of u given τ 2 i e p u τ 2 y also can be calculated as 37 p u τ 2 y p u τ 2 y j 1 j n y j u σ j 2 τ 2 n u v u where n u v u represents the pdf of the normal distribution with mean u and variance v u u and v u are defined in eqs 35 and 36 with eqs 34 and 37 we are able to calculate the bayesian estimator θ j b superscript b represents bayesian under the l 2 loss function 38 θ j b e θ j y e e θ j u τ 2 y y e θ j u τ 2 y y where θ j i e the conditional posterior mean of θ j given u τ 2 is given in eq 29 we summarize the above procedure of estimating θ j b with the following algorithm step 1 draw n a large number samples of τ k 2 i e k 1 n from the posterior distribution of τ 2 i e p τ 2 y based on the metropolis hastings algorithm step 2 for each τ k 2 sample u k based on the posterior distribution of u given τ 2 i e p u τ k 2 y step 3 for each pair of u k τ k 2 compute θ j u k τ k 2 σ j 2 y j step 4 calculate the mean of θ j θ j b 1 n k 1 n θ j u k τ k 2 σ j 2 y j according to the weak law of large numbers when n is large enough θ j b converges to the bayesian estimator e θ j y this is a clear advantage of bhm over traditional estimators such as mle 2 5 estimated three parameter log normal distribution after obtaining θ j b and σ j 2 b from bhm the results of our proposed estimating method based on bhm can be summarized as 39 y j n θ j b σ j 2 b and its equivalent form 40 x j l n 3 γ j θ j b σ j 2 b with the pdf 41 f x j 1 x j γ j σ j b 2 π exp ln x j γ j θ j b 2 2 σ j 2 b 2 6 log likelihoods and k folds cross validation in this study we choose log likelihoods as the measure of performance i e goodness of fit metrics because we want to evaluate the difference between two distributions i e the estimated ln3 and the true test data distribution log likelihoods is one of the most widely used and well acknowledged metrics for the goodness of fit of different statistical models fisher 1992 edwards 1992 berger and wolpert 1988 it is especially useful for evaluating the performance of the estimated distributions myung 2003 when new observation data is collected its log likelihood value describes how well this distribution fits this new data or how likely this new observation data is drawn from this distribution thus the distribution with the highest log likelihood value can be regarded as the best distribution to explain the observation data and it is then the best one to characterize the variable monthly streamflow in this study this is a consequence of the fact that the kullback leibler divergence i e kl divergence is minimized when an estimated distribution is identical to the true distribution kullback and leibler 1951 kullback 1997 most of goodness of fit statistics are essentially log likelihood or built upon log likelihood the well known aic akaike information criterion akaike 1998 and bic bayesian information criterion schwarz 1978 also are formulated as the sum of log likelihood and minus penalties for complexity note that they are calculated with training data not test data and therefore use the model complexity penalty to approximate test data log likelihood in our case we have both the training and the test dataset so we believe using the test data log likelihood as the metric is the most interpretable and standard way to evaluate the distribution performance among different methods k folds cross validation k folds cv is a widely used technique for assessing statistical model performance kohavi 1995 refaeilzadeh et al 2009 compared with the traditional hold out method i e simply splitting the observation dataset into a training and a test set k folds cv is less affected by how the observation dataset is split since every observation data point gets to be used as the test data exactly once mclachlan et al 2005 thus in this study we employ a 4 folds cv and the steps are summarized as follows step 1 randomly divide the entire n years of observations into four folds i e each fold contains n 4 years of observations step 2 for the first test i e t 1 combine folds 1 2 and 3 as the training dataset i e the dataset that is used to estimate θ j b and σ j 2 b while fold 4 is used as the test dataset in the test process since the log likelihood is used as the metric in the test process for an estimated distribution f j the log likelihood based on the test dataset is computed as 42 l j t 1 log i v t f j x ij i v t f j x ij where v t i i t th t e s t d a t a s e t repeat the above procedure for t 2 t 3 and t 4 where the corresponding test sets are fold 3 fold 2 and fold 1 as fig 6 shows calculate the test data log likelihood l j t 2 l j t 3 and l j t 4 step 3 compute the mean of l j t t 1 2 3 4 as l j it is the final test data log likelihood for the estimated distribution f j step 4 compare the performance of different estimated distributions f j g j and h j j 1 12 by comparing their l j f j l j g j and l j h j the estimated distribution with the largest l j is considered the best for month j step 5 compare different estimating methods f g and h by comparing their cumulative test data log likelihood over 12 months i e j 1 12 l j f j j 1 12 l j g j and j 1 12 l j h j the estimating method with the largest j 1 12 l j is considered the best the magnitude of j 1 12 l j is related to the number of observation years i e number of data n to avoid the influence of the number of data n when comparing two different estimating methods f and g we calculate the relative improvement ri using eq 43 43 ri j 1 12 l j f j j 1 12 l j g j j 1 12 l j f j 100 where f is selected as the base method if ri is positive then f is ri improvement over g 3 case study 3 1 data information summary we select eight watersheds in the united states for our case study key information related to the selected sites is summarized in table 1 fig 7 shows the location map we collect the last 100 years the information may vary slightly due to availability of historical unimpaired monthly streamflow data from each site all data and the site information are collected from the usgs official website https waterdata usgs gov nwis uv referred module sw 3 2 shapiro wilk normality test on the transformed data after estimating the shift parameter γ j by the zero skewness method we transform x ij into y ij by subtracting γ j and taking the log if y j follows a normal distribution then our assumption that x j follows a three parameter log normal distribution is valid therefore we employ the shapiro wilk normality test shapiro and wilk 1965 to determine whether y j follows a normal distribution first from the 100 years of data we randomly sample a dataset of 75 years of observations then with a significance level α 0 05 we calculate the test statistic and p values for each month and each watershed if the p value is less than 0 05 then we reject the null hypothesis that y j follows a normal distribution table 2 records the data s p values for each month and watershed we see from table 2 that in only 6 out of 96 months 12 months per watershed y j may not have followed the normal distribution which is insignificant therefore we assume that the original data x j follows the three parameter log normal distribution 3 3 example of cv results of schoharie watershed using the 100 year dataset and the flat hyperpriors for both seasons we plot the log likelihood l j results from the 4 folds cv for each month in fig 8 we use the schoharie watershed as an example other watersheds yield similar results we compare the results from bhm with results obtained from the following five selected traditional parameter estimation methods local maximum likelihood estimation lmle l moment l mom method of moment estimation mme modified method of moment estimation mmme and zero skewness zeros in fig 8 we choose the bhm results as the baseline and plot the difference of log likelihood between bhm and the other traditional methods i e l j b l j f where b represents bhm f represents other traditional methods in other words for a traditional method if the difference for a given month is greater than zero then bhm provides better estimates from fig 8 we see that bhm outperforms all five traditional methods since the log likelihood differences are positive in almost all months the five traditional methods behave irregularly in different months including the obvious outliers provided by the mme in the dry season the results also show that bhm is more stable for instance the lmle method behaves similarly as bhm in december but it is clearly worse in january in other words the results from bhm can be regarded as the flat horizontal line of y 0 which is not only below the results from other methods but also exhibits the lowest volatility i e it can be trusted in all months kernel density estimation is a non parametric data smoothing technique that estimates the probability density function of a random variable based on a finite data sample rosenblatt 1956 parzen 1962 in fig 9 we compare the ln3 density estimations from bhm and several representative methods i e red bhm cyan mme purple outermost zeros skewness against the real test data kernel density estimation i e green innermost real test data we see in fig 8 that in january the log likelihood difference for mme is 2 while the log likelihood difference for zeros is around 1 in fig 9 we see that the ln3 distribution estimated from bhm best fits the real data kernel density as the figure shows the bhm estimation captures the peak most accurately followed by the zeros estimation while the mme estimation clearly deviates from the correct peak position furthermore both the left and right tails of the real data distribution are best matched by the bhm estimation shown from the green area on both sides therefore fig 9 enables us to easily interpret the log likelihood difference i e fig 8 table 5 7 it is also a demonstration of the advantage of our bhm over the selected traditional methods in addition we also calculate the moment information i e mean and variance for each ln3 estimated by the bhm and zeros methods the formulas used are shown in eqs 44 and 45 and the moment values are shown in tables 3 44 mean e θ σ 2 2 γ 45 varaince e σ 2 1 e 2 θ σ 2 for most months the variance differs significantly and the mean is also distinguishable also these results are just the mean i e first order moment and variance i e second order moment calculated as an example not to mention the larger difference in the higher order moments such as skewness and kurtosis therefore the differences between the two distributions in fig 9 i e red bhm and purple zeros are significant table 4 shows the estimated parameter values i e θ j b and σ j 2 b from the 4th test based on the proposed bhm and zero skewness method zeros in addition to the point estimates we use the equal tail method to calculate the 95 bayesian interval estimation for each parameter we see that the difference in σ j 2 is larger than the difference in θ j this indicates that the proposed bhm provides more shrinkage on the shape parameter σ j 2 than the location parameter θ j we further investigate this by calculating the shrinkage factors i e b σ 2 and b θ for bhm and the result shows that the average b σ 2 is 0 29 while the average b θ is only 0 02 on one hand due to the relatively large average b σ 2 value the result clearly explains why the shape parameter σ j 2 can be estimated better by bhm in addition it is evident that bhm allows one to determine whether there is useful between group information to be extracted if this is not the case such as with the estimation of θ j in this example bhm automatically assigns a small shrinkage factor b θ that barely shrinks the mle results it is also evident that the shrinkage factor b σ 2 of the wet season 0 554 is much higher than b σ 2 of the dry season 0 026 this clearly shows that the model achieves substantial shrinkage for variance estimation in the wet season also reflected by the observation that the bayesian estimates across the six months in the wet season dec may were quite close to each other the variances in the dry season and the mean estimates exhibit almost no shrinkage so they were very close to the mles confirming the notion that bhms can achieve data driven shrinkage automatically in sum the proposed bhm method rarely performs worse than the traditional methods based on mle this is due to the fact that if abundant between group information is detected bhm will take full advantage and shrink the mle results e g the σ j 2 in table 4 3 4 cv results of tests with different dataset sizes to further evaluate the performance of bhm under different dataset sizes we choose two different datasets the entire 100 years of observations a large size that represents a case where the data are sufficient and the most recent 60 years of observations a medium size that is available for most hydrological stations we use the flat hyperprior for both seasons and 4 folds cv the cumulative log likelihood and relative improvement eq 43 with bhm as the base model results for each method are shown in table 5 table 5 shows for both the 100 year and 60 year tests that bhm outperforms all other traditional methods in all eight watersheds except a similar performance of bhm and lmle in the 100 year test this is evident because the cumulative log likelihood of bhm is greater than the traditional methods and the relative improvements ri over the traditional methods are all positive additionally comparing the 60 year test to the 100 year test we can see the ri increases for most watersheds this indicates that bhm can provide more improvement over the traditional methods in the test with a smaller data size furthermore comparing bhm with zeros zero skewness we see that bhm produces better results for all watersheds and the ri increases as the data quantity decreases this is a direct demonstration of the advantage of bhm since zeros has the same shift parameter γ estimation as bhm but zeros estimates the shape and location parameters by mle instead of bhm 3 5 cv results of the test with the proposed informative hyperprior to evaluate the performance of the proposed informative hyperprior we conduct the same experiments for the 100 year wet season dataset for each watershed where the results of the proposed informative hyperprior and the flat hyperprior are compared the parameter of the proposed informative hyperprior k and the sign in eq 24 for each watershed is obtained by fine tuning the informative hyperpriors used for the wet season for each watershed are listed below for cheat pine and towanda 46 p v s 0 2 1 s 0 2 v a v e σ 2 v 2 a v e σ 2 for holston driftwood and nueces 47 p v s 0 2 1 s 0 2 v a v e σ 2 v 2 a v e σ 2 4 for schoharie 48 p v s 0 2 1 s 0 2 v a v e σ 2 v 2 a v e σ 2 1 8 for yosemite 49 p v s 0 2 1 s 0 2 v a v e σ 2 v 2 a v e σ 2 3 2 we note that the proposed hyperprior parameter for each watershed may not be optimal that is a better parameter may exist but how to find the optimal hyperprior parameter is beyond the scope of this paper we also note that compared to the data the influence of the hyperprior on bhm is minimal to see the difference between the flat hyperprior and the informative hyperprior we plot the samples from the posteriors of the hyperparameters i e p v s 0 2 s 2 based on two different hyperpriors in fig 10 using the 100 year cheat watershed wet season dataset as the example a total of 200 000 points are sampled from each posterior and the first 3000 samples are dropped as the burn in period in the mcmc process from fig 10 we see both posteriors are proper without any outliers and the informative hyperprior can provide a wider range of s 0 2 sample values than the flat hyperprior table 6 shows the cv results based on both hyperpriors table 6 shows that first for each watershed results generated from the traditional methods based on two hyperpriors are exactly the same this implies that changing the hyperprior will only impact the performance of bhm since only bhm requires a hyperprior second for each watershed bhm performs better than the traditional methods under both hyperpriors as the cumulative log likelihood values are larger third comparing the flat hyperprior results with the informative hyperprior results we see that for each watershed the latter s log likelihood value is a little higher than the former but the improvements are insignificant this indicates that adopting the informative hyperprior can still benefit bhm however compared to the data layer the improvements of using different hyperpriors on bhm should be minimal 3 6 cv results of the test with an extremely small dataset size not all rivers have a sufficiently long historical observation series i e 100 years or 60 years of observations in fact for many watersheds the historical observation series is very short and the data are very limited to compare bhm with the traditional methods based on a short time series we use the most recent 28 years i e small size of historical observations for each watershed then for the most recent 60 year and 28 year datasets we conduct the tests for each watershed and each method because the 28 year series is too short for many watersheds the months in the wet season i e dec may may have negative sample skewness which prohibits any method from estimating ln3 parameters thus in this section we use dry season months i e jun nov as the example for comparison to test if bhm performs better than the selected traditional methods we calculate the relative improvements for each method table 7 shows the test results the flat hyperprior is used in the test it is evident from table 7 that most ri s in the 28 year test are greater than the corresponding ri in the 60 year test this can be interpreted as 1 the base model bhm outperforms the selected traditional methods in most watersheds for both datasets and 2 compared with the medium size dataset 60 years the advantage of bhm over the traditional methods is more noticeable in the small size data set 28 years particularly relative to the mme mmme and zeros methods this is because bhm utilizes other months information which expands the information contained in the limited data thus bhm is especially suited for parameter estimation where historical observations are limited 4 discussion 4 1 comparison of bhm with an autoregressive model bhms are used to account for correlation dependence between different months it would be of interest to compare the performance of bhm with an autoregressive ar model as ar models are used to account for temporal dependence recall in our bhm that the temporal dependence is captured from the log transformed data y in different months i e y log x γ we therefore use the same data to build an ar model and compare results a typical ar q model can be expressed as 50 y t β 0 β 1 y t 1 β 2 y t 2 β q y t q ε this model only can capture linear dependence however our proposed bhm is a data driven model which means the data itself can decide the relation among different months and the correlation dependence can be of any type not limited to linear relation the ar model also defines a joint distribution over y 1 y 12 and we can compare it with our bhm by the test data likelihood consider the wet season i e y 12 y 5 of a given test watershed we propose the following steps for a comparative analysis 1 for simplicity we build an ar 1 model for the wet season i e dec jan may with training dataset e g y 5 β 0 β 1 y 4 ε assume the error term ε follows n 0 σ 2 and the variance σ 2 can be estimated by an unbiased estimator s 2 i e s 2 s s e n tratin 2 where sse is the sum square error and n train is the number of observations in the training dataset 2 based on the ar 1 model the example conditional density distribution can be expressed as y 5 y 4 n y 5 β 0 β 1 y 4 s 2 and similarly for y 12 y 11 y 4 y 3 3 we calculate test likelihood for the ar model using the test dataset for example the test likelihood of p y 5 y 4 is p y 5 y 4 i n test n y 5 i β 0 β 1 y 4 i s 2 where n test is the observation numbers in the test dataset and similarly for p y 12 y 11 p y 4 y 3 as p y 5 y 4 4 we use the training data to estimate the first month in the wet season i e december as a normal distribution i e y 12 n θ 12 σ 12 2 note this is a marginal density distribution we then use the test dataset to calculate its likelihood p y 12 i n test n y 12 i θ 12 σ 12 2 5 we calculate the joint probability density p y 12 y 1 y 5 based on the product rule p y 12 y 1 y 5 ar p y 12 p y 1 y 12 p y 5 y 4 this is also the joint likelihood of the ar model 6 from our bhm we have obtained y j n θ j b σ j 2 b from the training dataset for all six months and these distributions are independent so their joint probability density can be calculated as p y 12 y 1 y 5 bhm p y 12 p y 1 p y 5 then we use the test dataset to calculate the test likelihood of bhm which is also the joint likelihood of bhm 7 we compare two joint log likelihoods between ar 1 and bhm the method with the larger joint log likelihood would be a better model note that we calculate the joint likelihood for each method for comparison because we cannot directly compare y 5 y 4 n y 5 β 0 β 1 y 4 s 2 from the ar 1 model with y 5 n θ 5 b σ 5 2 b from the bhm this is because the former is a conditional distribution but the latter is a marginal distribution and they are not comparable thus we need to convert them to the joint distributions for the comparison i e as shown in steps 5 and 6 based on this procedure we have calculated the joint log likelihoods for ar 1 and bhm for all eight watersheds the results are shown in the table 8 from table 8 we see that the bhm performs better than ar 1 for most of the watersheds because the joint log likelihood of bhm is larger however for yosemite and nueces the ar 1 model has a larger joint log likelihood this implies that for these two watersheds monthly flows indeed follow an ar 1 model therefore despite its limitations the ar model is indeed a good model accounting for temporal dependence and it can perform very well in some watersheds however our proposed bhm is a more general data driven model and requires fewer assumptions 4 2 potential uncertainty loss due to sequential estimation our methodology of construing bhm follows a sequential approach we first estimated shift parameter γ and fixed it we then estimated σ 2 and also fixed it and finally we estimated θ a potential shortcoming of this approach is that not all parameter uncertainties may be properly reflected in the final estimates a full bayesian analysis based on the joint posterior i e p γ σ 2 θ y would be most ideal however it would be very difficult to carry this out in practice we investigate how much uncertainty we may lose with our sequential approach when estimating γ in the table 9 we calculate the 90 confidence interval of γ estimates using schoharie dry season 100 year data as an example table 9 shows that the loss of uncertainty for γ is negligible when compared with the magnitude of each month s real monthly average streamflow i e x according to the probability density function of ln3 i e eq 2 the potential uncertainty loss for γ can be measured by the uncertainty losses of 1 x γ and ln x γ because of the small differences in the last four rows in table 9 these uncertainty losses are insignificant especially for 1 x γ although some uncertainty loss indeed occurred in ln x γ the loss is minimum and negligible for most months in addition even though our sequential approach loses some uncertainty it doesn t lose information on shrinkage i e the shrinkage for estimating σ 2 and θ in fact the variance parameter i e shape parameter σ 2 is most likely the one that needs to be stabilized in other words σ 2 will benefit the most from the shrinkage i e bhm among all the parameters this is also the reason why our proposed variance bhm is important so if we assume γ is perfectly estimated then there is no uncertainty loss for the σ 2 estimation since it is first estimated in our sequential approach i e estimated before θ 5 conclusion in this paper we proposed a bayesian hierarchical model bhm for estimating the statistical parameters for monthly average streamflows we assumed that the monthly average streamflow follows a three parameter log normal distribution ln3 the three underlying statistical parameters associated with ln3 are shift shape and location we selected eight watersheds in the united states where historical unimpaired streamflows have been collected we first conducted a shapiro wilk normality test to validate the ln3 assumption we then developed the bhm and proposed an informative hyperprior we used cross validation cv to evaluate the performance of bhm against selected traditional parameter estimation method methods including local maximum likelihood estimation lmle l moment l mom method of moment estimation mme modified method of moment estimation mmme and zero skewness zeros we calculated the log likelihood cumulative log likelihood and relative improvement for all methods we performed comparative analyses using different dataset sizes and different hyperpriors the results show that the proposed bhm produced better parameter estimates than the selected traditional parameter estimation methods for all data sizes long medium and short the fewer the observation data the more the proposed method improves compared with the traditional methods the two reasons that bhm produced better parameter estimates are 1 bhm utilizes historical observations not only from the month under consideration but also from all other months and 2 due to shrinkage the bayesian estimator from bhm is guaranteed to be no worse than the mle based estimator the proposed bhm is especially suited for parameter estimation where historical observations are limited in addition when compared to an ar model the proposed bhm shows its advantage as a data driven model with fewer assumptions we have demonstrated the advantages of the proposed method for parameter estimation a disadvantage of the method is that it takes much longer running time to get the results primarily due to mcmc simulation for example the zeros method may take just a few seconds while the proposed method takes around 30 min per run the proposed sequential estimation approach is easy to carry out in practice but may incur loss of uncertainty however the loss is insignificant and negligible credit authorship contribution statement jinshu li conceptualization methodology software writing original draft qing zhou methodology william w g yeh methodology writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by an aecom endowment data used in this paper are public at the usgs official website https waterdata usgs gov nwis uv referred module sw the data are also openly available at https zenodo org record 3451496 xyqxx45khhe the authors would like to thank the two anonymous reviewers for their in depth reviews and constructive comments the remarks and summary of reviewer comments provided by the editor and associate editor also are greatly appreciated appendix a derivation of the posterior distribution of σ j 2 dist 9 from bayes rule 1a p σ j 2 v s 0 2 s j 2 p σ j 2 v s 0 2 s j 2 p v s 0 2 p σ j 2 v s 0 2 p s j 2 σ j 2 which is equivalent to 2a p σ j 2 v s 0 2 s j 2 p σ j 2 v s 0 2 p s j 2 σ j 2 based on the eq 8 and a change of variable we can derive 3a p s j 2 σ j 2 d 2 σ j 2 d 2 γ d 2 s j 2 d 2 1 e d s j 2 2 σ j 2 s j 2 d 2 1 σ j 2 d 2 e d s j 2 2 σ j 2 the pdf of inv χ 2 v s 0 2 is 4a p σ j 2 v s 0 2 s 0 2 v 2 v 2 γ v 2 σ j 2 v 2 1 e s 0 2 v 2 σ j 2 then based on eq 2a we have 5a p σ j 2 v s 0 2 s j 2 σ j 2 v d 2 1 e s 0 2 v d s j 2 2 σ j 2 which is equivalent to 6a p σ j 2 v s 0 2 s j 2 i n v χ 2 v d v s 0 2 d s j 2 v d this is exactly eq 9 appendix b derivation of the posterior distribution of hyperparameters p v s 0 2 s 2 i e eq 10 based on the bayes rule and the fact that s j 2 are independent with each other j 1 6 we have 1b p v s 0 2 s 2 p v s 0 2 s 2 p v s 0 2 p s 2 v s 0 2 p v s 0 2 j 1 j 6 p s j 2 v s 0 2 from eq 3a we already have 2b p s j 2 σ j 2 d 2 σ j 2 d 2 γ d 2 s j 2 d 2 1 e d s j 2 2 σ j 2 then we claim that 3b p s j 2 σ j 2 p s j 2 σ j 2 v s 0 2 this is because once σ j 2 is given s j 2 can be determined only by σ j 2 so it is independent of the parameters v and s 0 2 this condition can be summarized as 4b s j 2 v s 0 2 σ j 2 which implies eq 3b bayes rule with eq 3b implies 5b p s j 2 σ j 2 v s 0 2 p s j 2 σ j 2 p σ j 2 v s 0 2 based on eqs 5b and 4a we can derive 6b p s j 2 σ j 2 v s 0 2 d 2 σ j 2 d 2 γ d 2 s j 2 d 2 1 e d s j 2 2 σ j 2 s 0 2 v 2 v 2 γ v 2 σ j 2 v 2 1 e s 0 2 v 2 σ j 2 integrating σ j 2 out from eq 6b we have 7b p s j 2 v s 0 2 p s j 2 σ j 2 v s 0 2 d σ j 2 s 0 2 v 2 v 2 γ v 2 d 2 d 2 γ d 2 s j 2 d 2 1 γ v d 2 v s 0 2 d s j 2 2 v d 2 substituting eq 7b into eq 1b we have 8b p v s 0 2 s 2 p v s 0 2 j 1 j 6 s 0 2 v 2 v 2 γ v 2 γ v d 2 v s 0 2 d s j 2 2 v d 2 simplifying 8b by introducing the beta function we get 9b p v s 0 2 s 2 p v s 0 2 j 1 j 6 1 b e t a v 2 d 2 s 0 2 v 2 v 2 v s 0 2 d s j 2 2 v d 2 this is exactly eq 10 
5071,we develop a bayesian hierarchical model bhm for estimating the statistical parameters for monthly average streamflows we assume monthly average streamflow can be characterized by a three parameter log normal distribution ln3 the three underlying statistical parameters are shift shape and location when estimating a parameter such as the shape of a given month the bhm utilizes historical observations not only from the month under consideration but also from all other months this is different from traditional statistical parameter estimation methods that only use historical observations for the month under consideration we apply the proposed bhm for parameter estimation to eight watersheds in the united states where historical unimpaired streamflows have been collected we also carry out parameter estimation using traditional methods such as the maximum likelihood estimation the method of moments and the l moment method using cross validation with test data log likelihood as the measure of performance the results show that bhm outperforms traditional estimation methods in addition we show that as available observation data decreases the more the proposed method improves relative to traditional methods since bhm utilizes information contained in the entire data set it is especially suited for parameter estimation where historical observations are limited furthermore we conduct a comparative analysis between bhm and an autoregressive model to demonstrate the advantage of bhm keywords bayesian hierarchical model bayesian statistics three parameter log normal distribution monthly average streamflow frequency analysis statistical parameters estimation 1 introduction frequency analysis is a useful statistical tool in hydrology it is implemented by fitting an assumed probability distribution to the observed data of a random variable stedinger 1980 xiong et al 2014 frequency analysis has been used to estimate extreme hydrologic events such as maximum streamflow and it can be used for estimating average streamflow as well in flood frequency analysis maximum streamflow is considered a random variable while frequency analysis for average streamflow treats the annual or monthly average streamflow as a random variable the assumed probability distributions for the two different types of frequency analysis are generally not identical the generalized extreme value distribution gev i e the generalized form of weibull and gumbel distributions and the log pearson type 3 distribution lp3 are standard choices for flood frequency analysis bobee 1975 rao 1980 hosking et al 1985a 1985b smith 1987 obee and ashkar 1991 rosbjerg and madsen 1995 stedinger and lu 1995 hosking and wallis 1996 vogel and wilson 1996 morrison and smith 2002 and griffis and stedinger 2007 singh 2013 compared with flood frequency analysis the choice of distribution for average streamflow is more flexible using the chi square goodness of fit statistic markovic 1965 compared the fit of normal n log normal ln2 three parameter log normal ln3 gamma gam and pearson type 3 p3 distributions for the annual average streamflow the results suggest that gam p3 ln2 and ln3 are all capable of fitting the distributions vogel and wilson 1996 further tested the above distributions of annual average streamflow in the u s using an l moment diagram they concluded that annual average streamflows are well approximated by p3 ln2 or ln3 distributions unlike annual average streamflows literature dealing with the choice of distribution for monthly average streamflow is sparse even though monthly average streamflow may be used more frequently than annual average streamflow for water resource management and reservoir operations yeh 1985 xu et al 2015a xu et al 2015b li et al 2019 since the time scale becomes shorter the volatility of monthly average streamflow would be higher than annual average streamflow therefore a three parameter distribution would be suitable for monthly average streamflow due to its greater flexibility thus both p3 and ln3 would be good choices for monthly average streamflow furthermore sangal and biswas 1970 suggested that ln3 can be applied successfully to the frequency analysis of both annual flows and monthly flows and they also reported that p3 and lp3 will not be reliable when data are limited yue and hashino 2007 demonstrated the ability of using ln3 to fit precipitation data bowers et al 2012 also showed that river flow data are typically better fitted by a log normal distribution than by a power law distribution therefore in this study we select three parameter log normal distribution ln3 to approximate monthly average streamflow we also conduct the shapiro wilk normality test to ensure this approximation is valid shapiro and wilk 1965 royston 1995 devineni et al 2013 many traditional estimation methods have been applied to estimate ln3 parameters hill 1963 showed that the global maximum likelihood estimation mle may approach infinity which is inadmissible cohen 1951 proposed the local maximum likelihood estimation lmle by equating partial derivatives of the log likelihood function to zero the studies of harter and moore 1966 calitz 1973 cohen and whitten 1980 and griffiths 1980 showed the validity of lmle and suggested that it should be considered the prime method of estimating ln3 parameters method of moments estimation mme is a simple method that estimates parameters by equating the first second and third sample moments with the population values however this method may suffer from a large sampling error introduced by the second and third sample moments cohen 1988 johnson et al 1994 moreover the log normal distribution may not be uniquely determined by its moments heyde 1963 inspired by the fact that the first order statistic in the sample exerts much greater influence on the shift parameter cohen and whitten 1980 proposed the modified method of moments estimation mmme which is similar to mme but substitutes a function of the first order statistic the l moment method l mom first introduced by hosking 1990 is also a popular way to estimate parameters it matches the linear combinations of order statistics i e l moments for parameter estimation which is analogous to mme but more robust to outliers combining the idea of mme and mle griffiths 1980 introduced the zero skewness method zeros this method first computes the shift parameter by equating the sample skewness of log transformed data to zero then estimates the other two parameters i e the shape and location parameters by mle thus the estimation of the shift parameter and the other two parameters in this method are separate steps this will be utilized and further discussed in the next section other popular methods for estimating ln3 parameters include the median method sangal and biswas 1970 method of least squares snyder and wallace 1974 and method of entropy singh et al 1986 singh and singh 1987 singh et al 1990 all of the above mentioned traditional methods can be applied to estimate ln3 parameters of monthly average streamflow for a given month however they only use historical observations for the month under consideration it is likely that the monthly average streamflow for different months are related because of the time correlations of streamflow in other words some useful information contained in the other months i e between group information is not utilized since traditional methods only can use the within group information therefore the goal of this paper is to develop a new ln3 estimation method for monthly average streamflow that uses both within group and between group information bayesian hierarchical models bhms are a class of statistical models known for modeling many statistical applications involving multiple parameters that can be regarded as related or connected in some way by the structure of the problem gelman et al 2013 this makes bhm a perfect model to capture the between group information when estimating the parameters of monthly average streamflow for different months commonly used statistical models often face the following difficulty with few parameters the models cannot fit data accurately whereas with a lot of parameters the overfitting problem arises however as pointed out by gelman et al 2013 bhms have enough parameters to fit data well while using a population distribution to structure some dependence into the parameters thereby avoiding overfitting a typical full bhm model structure is shown in fig 1 1 consider a set of j groups of experiments the data layer contains the data x j or statistics extracted from the data for each group j while the parameters layer includes the parameters that we want to estimate for all groups these two layers usually are linked with an implied likelihood function as a bayesian method prior distributions are needed for parameters parameters are modeled as random variables in bayesian inference which reflect the belief ones have about the parameters people often choose conjugate priors to facilitate derivations i e the posterior and the prior distributions are in the same family of distributions assume the prior distributions are σ j 2 iid p σ j 2 a b in which there are two additional parameters a b these parameters are called hyperparameters and they determine the shape of the priors thus we further use a hyperprior to specify the prior distributions of the hyperparameters note that the variables of the hyperpriors are hyperparameters e g a b while the variables of the priors are the parameters that we want to estimate e g σ j 2 therefore the difference between prior and hyperprior is that they are prior distributions for model parameters σ j 2 and hyperparameters a b respectively in terms of the model structure they are at different layers in the hierarchical models additionally bhm allows flexible inference approaches that come with many versions and variations even though all the variations share the same principle of using several modeling layers there are two main versions of bhm 1 full bayesian inference under the hierarchical model i e full bhm shown in fig 1 1 and 2 empirical bayes method i e empirical bhm shown in fig 1 2 the full bhm is the complete and rigorous model that contains data parameters hyperparameters and a hyperprior with a hyperprior in a full bhm we can first derive the posterior distribution of hyperparameters as p a b x then use the mcmc method to draw from this posterior distribution which accounts for the uncertainty introduced from the hyperparameters a b in contrast the empirical bhm does not specify a hyperprior instead it uses a point estimate for the hyperparameters a b e g maximum likelihood estimator mle in eq 1 1 a b arg max a b j 1 j p x j a b in other words in an empirical bhm the hyperparameter will be fixed after it is estimated which simplifies the estimating process although it loses some flexibility and uncertainties also in some cases it is not even feasible to estimate hyperparameters by mle since some optimization problems just don t have an optimum or are very difficult to solve many bhm application studies in hydrology have been published the bhm of multisite daily rainfall based on the binomial distribution and gaussian process lima and lall 2009 the spatio temporal bhm for extreme precipitation based on gev and copula sang and gelfand 2009 ghosh et al 2011 the bhm in assessing streamflow response to a climate change based on gev and generalized pareto distribution gpd wei et al 2012 the spatial bhm of extreme precipitation and extreme runoff based on gev and gpd cooley et al 2007 el adlouni and ouarda 2009 najafi and moradkhani 2013 yan and moradkhani 2015 steinschneider and lall 2015 bracken et al 2016 and the bhm of annual peak snow water equivalent swe annual peak flow and annual peak reservoir elevation based on gev bracken et al 2018 renard 2011 estimated annual maximum rainfall in a regional context by constructing a bhm based on gev and a regression model known as the link function between data and parameters devineni et al 2013 directly applied a bhm on a linear regression model to reconstruct the average summer streamflow at five gauges in the delaware river basin using eight regional tree ring chronologies results of all the aforementioned studies show the advantages of bhm over traditional methods since information contained in the data from different groups mostly locations are combined with the help of bhm however most existing bhm studies in hydrology focus on extreme hydrological variables i e maximum streamflow and rainfall this is because frequency analysis of extreme events is more useful than average streamflow for designing flood control structures for this purpose the most well known bhm framework is based on the generalized extreme value distribution i e bhm gev which is designed to model extreme random variables cooley et al 2007 el adlouni and ouarda 2009 sang and gelfand 2009 ghosh et al 2011 however we believe that normal events e g the monthly average streamflow are also very important especially for reservoir management and operation yeh 1985 xu et al 2015a xu et al 2015b li et al 2019 for example a better estimation of the monthly average streamflow certainly will lead to better reservoir operations for the purpose of hydropower production or water supply thus in this paper we propose a new bhm i e bhm ln3 for estimating the statistical parameters for monthly average streamflows based on ln3 distribution the proposed bhm also can be applied to any random variables that follow a ln3 distribution also when constructing a full bhm there can be two types of hyperpriors used the noninformative hyperprior i e flat hyperprior and the informative hyperprior a flat hyperprior is widely used when prior knowledge is not available for hyperparameters and most of the bhm application studies in hydrology adopt this type of hyperprior e g el adlouni and ouarda 2009 lima and lall 2009 renard 2011 ghosh et al 2011 yan and moradkhani 2015 in contrast the use of an informative hyperprior is much less frequent and most informative hyperpriors found in the literature are empirical for example in building a bhm for estimating extreme precipitation cooley et al 2007 assume a uniform 0 001 0 02 distribution on a hyperparameter based on empirical information in their bhm modeling of extreme precipitation bracken et al 2016 use a weakly informative normal hyperprior centered at zero with an empirical standard deviation thus in our paper we also develop a new informative hyperprior that is expected to extract information from the data skewness the proposed bhm under this informative hyperprior is compared with the frequently used flat hyperprior we employ a 4 folds cross validation cv to compare the proposed bhm with traditional ln3 estimation methods the test data log likelihood is used as the criterion for model selection and comparison the results show that our proposed bhm produces better parameter estimates than the selected traditional parameter estimation methods for all data sizes long medium and short the fewer the observation data the more the proposed method improves over the traditional methods we outline this paper as follows section 2 1 introduces the data structure and the division of two seasons section 2 2 describes the zero skewness method for estimating the shift parameter section 2 3 proposes the new bhm for estimating the shape parameter variance bhm and develops a new informative hyperprior section 2 4 discusses bhm for estimating the location parameter mean bhm section 2 5 summarizes the estimated three parameter log normal distribution ln3 based on bhm section 2 6 introduces log likelihood as the goodness of fit metric as well as illustrates the k folds cv and the model selection criteria section 3 applies the proposed method to eight watersheds in the united states section 4 compares bhm with an autoregressive model and investigates the potential loss of uncertainty we then provide final remarks and conclusions in section 5 2 methodology 2 1 data preparation 2 1 1 data structure and assumed data distribution the data used to conduct this research is the historical monthly average streamflow and it is structured as fig 2 where n is the total number of historical data series the monthly average streamflow x j is modeled as a random variable that follows a f distribution e g f can be a normal distribution log normal distribution etc x ij is a sample value of random variable x j and pa r j is a set of parameters of the distribution of x j i e the distribution of x j is f x j p a r j in this study we select a three parameter log normal distribution ln3 for f because 1 ln3 is a flexible distribution with a general skewness that can be used successfully for analyzing hydrologic data and 2 ln3 is highly related to a normal distribution by subtracting the shift parameter γ and then taking the log transformation a ln3 variable can be transformed into a normal variable which is the desired property for constructing bhm the probability density function pdf of the ln3 distribution is 2 f x p a r 1 x γ σ 2 π exp ln x γ θ 2 2 σ 2 where x is a random variable that follows the ln3 distribution i e f x par is a set of parameters i e par γ σ 2 θ γ is the shift parameter satisfying the constraint of γ x σ 2 is the shape parameter with σ 0 and θ is the location parameter the goal is to estimate the distribution f x j p a r j for the monthly average streamflow random variable x j for each month j j 1 2 12 2 1 2 division of data into a dry season and wet season the advantage of bhm is that it can make use of the between group s information however if information in the two groups are intrinsically far away from each other then bayesian analysis may not be able to improve the results for example the mean value of streamflow of july may be highly correlated with the mean value of streamflow of august yet it will be largely uncorrelated with the mean value of streamflow of january in many regions streamflow in july may be much lower than that of january therefore to maximize the advantage of bhm we divide the year into two seasons dry season and wet season we will construct a hierarchical model for each of the two seasons in our case study we consider june to november as the dry season and december to may as the wet season note that the way to divide the data is not fixed and this is not even required 2 2 zero skewness method for estimating the shift parameter γ the zero skewness method griffiths 1980 royston 1992 is a traditional method for estimating ln3 parameters it is a combination of moment method estimation mme and maximum likelihood estimation mle note that zero skewness refers to y i e the transformed data after we remove the skewness in x i e the original streamflow data and the only assumption made is that the original data x follows ln3 in this study we adopt this zero skewness method to estimate shift parameter γ as follows 1 since the original streamflow data i e x is assumed to follow ln3 distribution we first carry out a log transformation on x γ note here the shift parameter γ is unknown and will be estimated and the log transformed result is y i e y log x γ then the transformed data y should follow a normal distribution 2 since the skewness for normal distribution i e y is zero then 3 skewness y 0 using the estimator of the population skewness eq 3 can be future expressed as 4 1 n i 1 n y i y 3 1 n i 1 n y i y 2 3 2 0 where y i log x i γ and y is the mean value of y when estimating a normal distribution the skewness estimator used in eq 4 is unbiased and consistent kendall and stuart 1969 cramer 1997 joanes and gill 1998 doane and seward 2011 3 since eq 4 has only one unknown i e γ solving eq 4 kowarik 0000 millard 2013 yields the γ estimate the reason we estimate γ by the zero skewness method is because the estimation of γ is independent of the estimation of θ and σ 2 in this method this independence provides an opportunity to improve the estimation of θ and σ 2 with the proposed bhm after estimating γ by the zero skewness method we will then construct our bhms to estimate θ and σ 2 we first perform a log transformation on x ij γ j i e the original samples following ln3 minus γ to get y ij as fig 3 shows we now refer to our data as y ij to ensure that y j follows a normal distribution for each month j we conduct the shapiro wilk normality test shapiro and wilk 1965 royston 1995 devineni et al 2013 if y j passes the shapiro wilk normality test then y j is normally distributed with parameters θ j and σ j 2 and x j follows the three parameter log normal distribution 2 3 bayesian hierarchical model for estimating σ 2 variance bhm 2 3 1 structure of variance bhm a bhm is constructed for estimating the shape parameter σ 2 as shown in fig 4 after the log transformation the data now are y ij where i 1 n and j 1 j 6 6 months groups in each season our goal is to estimate the parameter σ j 2 which parameterizes the distribution of y j 5 y j log x j γ j n θ j σ j 2 where σ j 2 is the unknown shape parameter for month j and θ j is the unknown location parameter for month j a sufficient statistic is widely used in the bayesian analysis to facilitate derivations fraser 1963 kholevo 2001 steel 2007 in our proposed bhm model a sufficient statistic for the parameter σ j 2 is the sample variance s j 2 for each group j 6 s j 2 1 n 1 i 1 n y ij y j 2 based on the distribution ross 2006 we formulate 7 d s j 2 σ j 2 χ d 2 where d n 1 i e constant and χ d 2 is the chi squared distribution with d i e n 1 degrees of freedom a conjugate prior is used for estimating σ j 2 hoff 2009 8 σ j 2 v s 0 2 iid i n v χ 2 v s 0 2 j 1 j 6 where inv χ 2 v s 0 2 is an inverse chi squared distribution parameterized by v and s 0 2 hyperparameters it is also the conjugate prior in bayesian statistics when estimating a normal variance with unknown mean raiffa and schlaifer 1961 gelman et al 2013 based on eqs 7 and 8 the conditional posterior distribution of σ j 2 given the hyperparameters v s 0 2 can be derived as see appendix a 9 p σ j 2 v s 0 2 s j 2 i n v χ 2 v d v s 0 2 d s j 2 v d j 1 6 if we can draw a sufficient number of posterior hyperparameter samples i e v s 0 2 s 2 then the posterior of σ j 2 can be obtained by sampling from eq 9 therefore the posterior distribution of hyperparameters p v s 0 2 s 2 needs to be derived to perform a full bayesian analysis a hyperprior p v s 0 2 is needed for p v s 0 2 s 2 where s 2 is the set of all s j 2 i e s 2 s j 2 j 1 6 for different seasons i e dry and wet we propose different hyperpriors for now we assume the hyperprior is p v s 0 2 thus the posterior distribution of hyperparameters can be derived as see appendix b 10 p v s 0 2 s 2 p v s 0 2 j j 1 beta v 2 d 2 s 0 2 v 2 v 2 v s 0 2 d s j 2 2 v d 2 where beta x y is the beta function i e beta x y γ x γ y γ x y and γ x is the gamma function note that the posterior distribution p v s 0 2 s 2 is conditioned on s 2 s 1 2 s j 2 rather than a single s j 2 since information from all the months groups is being used to estimate hyperparameters v s 0 2 this is how bhm incorporates between group information into estimating a certain group s parameter σ j 2 gelman et al 2013 based on the distributions in eqs 9 10 and the law of total expectation wolpert 2010 we are now able to calculate the bayesian estimator σ j 2 b superscript b represents bayesian by the posterior mean of σ j 2 11 σ j 2 b e σ j 2 s 2 e e σ j 2 v s 0 2 s 2 s 2 e σ j 2 v s 0 2 s j 2 s 2 where σ j 2 is the conditional posterior mean of σ j 2 given v s 0 2 i e 12 σ j 2 v s 0 2 s j 2 e σ j 2 v s 0 2 s 2 v s 0 2 d s j 2 v d 2 v 2 v d 2 v s 0 2 v 2 d v d 2 s j 2 b σ 2 v s 0 2 v 2 1 b σ 2 s j 2 the second equality comes from the fact that the expected value i e e σ j 2 v s 0 2 of inv χ 2 v s 0 2 i e the inverse chi squared distribution is v s 0 2 v 2 the ratio v 2 v d 2 is the shrinkage factor b σ 2 0 1 for this variance bhm which indicates the magnitude of shrinkage from mle i e s j 2 to the prior expected value i e e σ j 2 v s 0 2 once we have simulated a large sample v k s 0 k 2 k 1 n we can approximate the expectation of eq 11 by monte carlo simulation we summarize the algorithm for estimating σ j 2 b in the following steps step 1 draw n a large number samples of v k s 0 k 2 from the posterior distribution of hyperparameters p v s 0 2 s 2 i e eq 10 based on the metropolis hastings algorithm a mcmc method metropolis et al 1953 step 2 for each v k s 0 k 2 calculate the expected value σ j 2 v k s 0 k 2 s j 2 using eq 12 step 3 calculate the mean of σ j 2 σ j 2 b 1 n k 1 n σ j 2 v k s 0 k 2 s j 2 according to the weak law of large numbers when n is sufficiently large σ j 2 b converges in probability to the bayesian estimator e σ j 2 s 2 derived from the proposed bhm model a key advantage of our proposed bhm is that σ j 2 b is estimated not only using the within group information but also the between group information thus it is expected that the results from bhm will have an expected mean square error mse that is less than or equal to the traditional mle i e e m s e σ j 2 b e m s e σ j 2 m l e due to its shrinkage efron and morris 1977 chaloner 1987 berger 2013 2 3 2 selection of hyperprior for variance bhm bhm requires a hyperprior p v s 0 2 to provide the prior knowledge of hyperparameters see eq 10 though how to select this hyperprior p v s 0 2 is an interesting question the choice of p v s 0 2 has negligible impact on the results since it merely represents the prior knowledge of the hyperparameters in this study we suggest two different hyperpriors for the variance of bhm the first is the noninformative hyperprior or flat hyperprior and the second is the informative hyperprior a flat hyperprior is widely used when prior knowledge is not available for either hyperparameter v s 0 2 or parameter σ 2 itself in other words a flat hyperprior will lead to the same possibility for every σ 2 value instead of focusing on any particular σ 2 value it is expected to work well unless the number of groups j is low gelman 2006 we derive our flat hyperprior as follows first we assume v and s 0 2 are independent in the prior 13 p v s 0 2 p v p s 0 2 then we assume v is uniformly distributed on 0 15 d where d n 1 thus we arrive at 14 p v s 0 2 p s 0 2 v 0 15 d to make a flat hyperprior we further assume p s 0 1 by a change of variable we can derive the flat hyperprior as 15 p v s 0 2 1 s 0 2 v 0 15 d a fairly wide but finite support i e 0 15 d for hyperparameter ν is specified to ensure 1 the posterior of the hyperparameters i e dis 10 is always proper i e integrable to a finite value based on the proposed flat hyperprior i e dis 15 gelman et al 2013 and 2 the shrinkage factor b σ 2 is sufficiently large when v approaches its maximum this will not limit the degree of shrinkage of the model for example when v approaches 15d b σ 2 0 1 will be close to 15 16 which is sufficiently large for most applications using a flat hyperprior is safe but rather conservative so if some additional information on parameter σ 2 can be extracted from the data or by expertise an informative hyperprior should be considered however very few bhm applications in hydrology have developed informative hyperpriors in this study we suggest a possible way of constructing an informative hyperprior by extracting prior information from the data skewness first the skewness of ln3 is defined as ske w j and it is a function of only one parameter σ j 2 16 ske w j e σ j 2 2 e σ j 2 1 based on the idea of mme the sample skewness of historical streamflow records b j j 1 6 can be calculated by 17 b j n n 1 n 2 i 1 n x ij x j 3 i 1 n x ij x j 2 3 2 where x ij is the monthly averaged historical streamflow in year i for month j x j is the mean of historical streamflow records for month j and n is total number of years of historical streamflow records eq 17 is also known as the adjusted fisher pearson standardized moment coefficient which is adopted by excel sas and spss as the default way to calculate skewness doane and seward 2011 although it is a biased estimator it provides an adjustment for sample size which makes it closer to an unbiased estimator joanes and gill 1998 doane and seward 2011 thus eq 17 is a good skewness estimator that can help alleviate the bias problem common to most skewness estimators as pointed out by wallis et al 1974 another potential issue for the estimators of skewness is the boundedness kirby 1974 that is the estimators may reach bound due to smaller sample size or hydroclimatic variability using the l moment estimator would alleviate this concern letting ske w j b j i e the exact moment matching with σ j 2 unknown we can obtain the prior estimate of σ j 2 from skewness in the data denoted as σ j 2 then we calculate the average of σ j 2 j 1 6 18 ave σ 2 1 6 j 1 6 σ j 2 now we have ave σ 2 as the prior knowledge of σ 2 and we proceed to extract the prior information of the hyperparameters v s 0 2 i e determine hyperprior p v s 0 2 we want our hyperprior to reflect the prior knowledge recall that our prior is an inverse chi squared distribution 19 σ j 2 v s 0 2 i n v χ 2 v s 0 2 the mode and expected value of this inverse chi squared distribution are 20 mode v s 0 2 v 2 21 expected v a l u e v s 0 2 v 2 v 2 since we want every σ j 2 sampled from eq 19 to be close to ave σ 2 we set the mode or the expected value of 19 equal to ave σ 2 which leads to 22 v s 0 2 v 2 a v e σ 2 reformulating eq 22 we arrive at 23 v s 0 2 v a v e σ 2 2 a v e σ 2 0 we expect samples from the hyperprior p v s 0 2 have a high chance of satisfying eq 23 our goal is then to find a distribution as our informative hyperprior this distribution should have its highest probability density on the points v s 0 2 that satisfy eq 23 we suggest a simple informative hyperprior that can achieve this goal in the form of 24 p v s 0 2 1 v s 0 2 v a v e σ 2 2 a v e σ 2 k where k is a constant coefficient and k 0 the choice of value for k as well as the choice of a positive or negative sign is not restricted in this process the hyperprior parameter σ j 2 in eq 24 is estimated only from the data skewness not from any other data information i e sample variance and mean used in the bhm model therefore using σ j 2 as the prior information of σ j 2 will not cause over fitting i e no reuse of the same data information after that we calculate ave σ 2 i e the average of six σ j 2 and equate it to the mean mode of the prior distribution from which we derive eq 23 this step specifies the prior information of v s 0 2 from the skewness based estimates σ j 2 based on that equation we finally propose eq 24 as our informative hyperprior note that the derived informative hyperprior is based on the assumption that all six months prior information of σ j 2 i e σ j 2 can be represented by ave σ 2 which requires all six σ j 2 to be concentrated on ave σ 2 i e var σ j 2 the variance of σ j 2 is small this requirement may only be satisfied for the months in the wet season since the months in the dry season typically have high skewness and thus large σ j 2 values which often may lead to large var σ j 2 values therefore although the choice of using the flat or informative hyperprior is rather flexible we only use the flat hyperprior for the months of the dry season for the months in the wet season we can either be conservative and use the flat hyperprior or adopt the informative hyperprior as proposed in sum for each watershed the following two scenarios of hyperprior will be compared 1 use the flat hyperprior for both the dry and wet season 2 use the flat hyperprior for the dry season and adopt the proposed informative hyperprior for the wet season 2 4 bayesian hierarchical model for estimating θ mean bhm another bhm mean bhm is used for estimating the location parameter θ as shown in fig 5 this mean bhm originally was discussed in gelman et al 2013 where the authors assumed the true variances σ j 2 are known however in this study we first estimate σ j 2 b from section 2 3 and then build the mean bhm conditioning on σ j 2 b we first represent the data y ij by its sample mean y j for each group j which is also a sufficient statistic for θ j 25 y j 1 n i 1 n y ij where n is the total number of historical records in each month then the likelihood function can be derived from 26 y j θ j σ j 2 n θ j σ j 2 where we define σ j 2 σ j 2 b n j and assume n 1 n 2 n j n for simplicity we use a conjugate prior to provide the prior information for estimating θ j 27 θ j u τ 2 iid n u τ 2 j 1 j 6 where n u τ 2 is a normal distribution parameterized by u and τ 2 hyperparameters it is also the conjugate prior in bayesian statistics when estimating the normal mean with known variance based on eqs 26 and 27 the conditional posterior distribution of θ j given hyperparameters u τ 2 can be formulated as 28 θ j u τ 2 y σ j 2 n θ j v j where 29 θ j 1 σ j 2 y j 1 τ 2 u 1 σ j 2 1 τ 2 1 τ 2 1 σ j 2 1 τ 2 u 1 σ j 2 1 σ j 2 1 τ 2 y j b θ u 1 b θ y j and 30 v j 1 1 σ j 2 1 τ 2 the ratio 1 τ 2 1 σ j 2 1 τ 2 is the shrinkage factor b θ 0 1 for this mean bhm which indicates the magnitude of shrinkage from mle i e y j to the prior expected value u i e e θ j u τ 2 if sufficient posterior hyperparameter samples i e u τ 2 y are available then the posterior of θ j can be obtained by sampling from eq 28 in such instances the posterior distribution of hyperparameters p u τ 2 y needs to be derived we assume the hyperprior is p u τ 2 the posterior distribution of the hyperparameters i e p u τ 2 y can be formulated as 31 p u τ 2 y p u τ 2 j j n y j u σ j 2 τ 2 where n y j u σ j 2 τ 2 represents the probability density function pdf of the normal distribution of y j with mean u and variance σ j 2 τ 2 and y is the set of all y j i e y y 1 y 6 also for the mean bhm we choose the flat hyperprior because the location parameter θ unlike the shape parameter σ 2 often is dispersed widely for different months gelman et al 2013 derived a flat hyperprior in the mean bhm as 32 p u τ 2 1 τ to improve sampling stability we propagate p u τ 2 y in factored form based on bayes rule 33 p u τ 2 y p τ 2 y p u τ 2 y compute the posterior distribution of τ 2 i e p τ 2 y as 34 p τ 2 y p u τ 2 y d u 1 τ v u 1 2 j 1 j 6 σ j 2 τ 2 1 2 exp y j u 2 2 σ j 2 τ 2 where 35 u j 1 j 1 σ j 2 τ 2 y j j 1 j 1 σ j 2 τ 2 and 36 v u j 1 j 1 σ j 2 τ 2 1 then the posterior distribution of u given τ 2 i e p u τ 2 y also can be calculated as 37 p u τ 2 y p u τ 2 y j 1 j n y j u σ j 2 τ 2 n u v u where n u v u represents the pdf of the normal distribution with mean u and variance v u u and v u are defined in eqs 35 and 36 with eqs 34 and 37 we are able to calculate the bayesian estimator θ j b superscript b represents bayesian under the l 2 loss function 38 θ j b e θ j y e e θ j u τ 2 y y e θ j u τ 2 y y where θ j i e the conditional posterior mean of θ j given u τ 2 is given in eq 29 we summarize the above procedure of estimating θ j b with the following algorithm step 1 draw n a large number samples of τ k 2 i e k 1 n from the posterior distribution of τ 2 i e p τ 2 y based on the metropolis hastings algorithm step 2 for each τ k 2 sample u k based on the posterior distribution of u given τ 2 i e p u τ k 2 y step 3 for each pair of u k τ k 2 compute θ j u k τ k 2 σ j 2 y j step 4 calculate the mean of θ j θ j b 1 n k 1 n θ j u k τ k 2 σ j 2 y j according to the weak law of large numbers when n is large enough θ j b converges to the bayesian estimator e θ j y this is a clear advantage of bhm over traditional estimators such as mle 2 5 estimated three parameter log normal distribution after obtaining θ j b and σ j 2 b from bhm the results of our proposed estimating method based on bhm can be summarized as 39 y j n θ j b σ j 2 b and its equivalent form 40 x j l n 3 γ j θ j b σ j 2 b with the pdf 41 f x j 1 x j γ j σ j b 2 π exp ln x j γ j θ j b 2 2 σ j 2 b 2 6 log likelihoods and k folds cross validation in this study we choose log likelihoods as the measure of performance i e goodness of fit metrics because we want to evaluate the difference between two distributions i e the estimated ln3 and the true test data distribution log likelihoods is one of the most widely used and well acknowledged metrics for the goodness of fit of different statistical models fisher 1992 edwards 1992 berger and wolpert 1988 it is especially useful for evaluating the performance of the estimated distributions myung 2003 when new observation data is collected its log likelihood value describes how well this distribution fits this new data or how likely this new observation data is drawn from this distribution thus the distribution with the highest log likelihood value can be regarded as the best distribution to explain the observation data and it is then the best one to characterize the variable monthly streamflow in this study this is a consequence of the fact that the kullback leibler divergence i e kl divergence is minimized when an estimated distribution is identical to the true distribution kullback and leibler 1951 kullback 1997 most of goodness of fit statistics are essentially log likelihood or built upon log likelihood the well known aic akaike information criterion akaike 1998 and bic bayesian information criterion schwarz 1978 also are formulated as the sum of log likelihood and minus penalties for complexity note that they are calculated with training data not test data and therefore use the model complexity penalty to approximate test data log likelihood in our case we have both the training and the test dataset so we believe using the test data log likelihood as the metric is the most interpretable and standard way to evaluate the distribution performance among different methods k folds cross validation k folds cv is a widely used technique for assessing statistical model performance kohavi 1995 refaeilzadeh et al 2009 compared with the traditional hold out method i e simply splitting the observation dataset into a training and a test set k folds cv is less affected by how the observation dataset is split since every observation data point gets to be used as the test data exactly once mclachlan et al 2005 thus in this study we employ a 4 folds cv and the steps are summarized as follows step 1 randomly divide the entire n years of observations into four folds i e each fold contains n 4 years of observations step 2 for the first test i e t 1 combine folds 1 2 and 3 as the training dataset i e the dataset that is used to estimate θ j b and σ j 2 b while fold 4 is used as the test dataset in the test process since the log likelihood is used as the metric in the test process for an estimated distribution f j the log likelihood based on the test dataset is computed as 42 l j t 1 log i v t f j x ij i v t f j x ij where v t i i t th t e s t d a t a s e t repeat the above procedure for t 2 t 3 and t 4 where the corresponding test sets are fold 3 fold 2 and fold 1 as fig 6 shows calculate the test data log likelihood l j t 2 l j t 3 and l j t 4 step 3 compute the mean of l j t t 1 2 3 4 as l j it is the final test data log likelihood for the estimated distribution f j step 4 compare the performance of different estimated distributions f j g j and h j j 1 12 by comparing their l j f j l j g j and l j h j the estimated distribution with the largest l j is considered the best for month j step 5 compare different estimating methods f g and h by comparing their cumulative test data log likelihood over 12 months i e j 1 12 l j f j j 1 12 l j g j and j 1 12 l j h j the estimating method with the largest j 1 12 l j is considered the best the magnitude of j 1 12 l j is related to the number of observation years i e number of data n to avoid the influence of the number of data n when comparing two different estimating methods f and g we calculate the relative improvement ri using eq 43 43 ri j 1 12 l j f j j 1 12 l j g j j 1 12 l j f j 100 where f is selected as the base method if ri is positive then f is ri improvement over g 3 case study 3 1 data information summary we select eight watersheds in the united states for our case study key information related to the selected sites is summarized in table 1 fig 7 shows the location map we collect the last 100 years the information may vary slightly due to availability of historical unimpaired monthly streamflow data from each site all data and the site information are collected from the usgs official website https waterdata usgs gov nwis uv referred module sw 3 2 shapiro wilk normality test on the transformed data after estimating the shift parameter γ j by the zero skewness method we transform x ij into y ij by subtracting γ j and taking the log if y j follows a normal distribution then our assumption that x j follows a three parameter log normal distribution is valid therefore we employ the shapiro wilk normality test shapiro and wilk 1965 to determine whether y j follows a normal distribution first from the 100 years of data we randomly sample a dataset of 75 years of observations then with a significance level α 0 05 we calculate the test statistic and p values for each month and each watershed if the p value is less than 0 05 then we reject the null hypothesis that y j follows a normal distribution table 2 records the data s p values for each month and watershed we see from table 2 that in only 6 out of 96 months 12 months per watershed y j may not have followed the normal distribution which is insignificant therefore we assume that the original data x j follows the three parameter log normal distribution 3 3 example of cv results of schoharie watershed using the 100 year dataset and the flat hyperpriors for both seasons we plot the log likelihood l j results from the 4 folds cv for each month in fig 8 we use the schoharie watershed as an example other watersheds yield similar results we compare the results from bhm with results obtained from the following five selected traditional parameter estimation methods local maximum likelihood estimation lmle l moment l mom method of moment estimation mme modified method of moment estimation mmme and zero skewness zeros in fig 8 we choose the bhm results as the baseline and plot the difference of log likelihood between bhm and the other traditional methods i e l j b l j f where b represents bhm f represents other traditional methods in other words for a traditional method if the difference for a given month is greater than zero then bhm provides better estimates from fig 8 we see that bhm outperforms all five traditional methods since the log likelihood differences are positive in almost all months the five traditional methods behave irregularly in different months including the obvious outliers provided by the mme in the dry season the results also show that bhm is more stable for instance the lmle method behaves similarly as bhm in december but it is clearly worse in january in other words the results from bhm can be regarded as the flat horizontal line of y 0 which is not only below the results from other methods but also exhibits the lowest volatility i e it can be trusted in all months kernel density estimation is a non parametric data smoothing technique that estimates the probability density function of a random variable based on a finite data sample rosenblatt 1956 parzen 1962 in fig 9 we compare the ln3 density estimations from bhm and several representative methods i e red bhm cyan mme purple outermost zeros skewness against the real test data kernel density estimation i e green innermost real test data we see in fig 8 that in january the log likelihood difference for mme is 2 while the log likelihood difference for zeros is around 1 in fig 9 we see that the ln3 distribution estimated from bhm best fits the real data kernel density as the figure shows the bhm estimation captures the peak most accurately followed by the zeros estimation while the mme estimation clearly deviates from the correct peak position furthermore both the left and right tails of the real data distribution are best matched by the bhm estimation shown from the green area on both sides therefore fig 9 enables us to easily interpret the log likelihood difference i e fig 8 table 5 7 it is also a demonstration of the advantage of our bhm over the selected traditional methods in addition we also calculate the moment information i e mean and variance for each ln3 estimated by the bhm and zeros methods the formulas used are shown in eqs 44 and 45 and the moment values are shown in tables 3 44 mean e θ σ 2 2 γ 45 varaince e σ 2 1 e 2 θ σ 2 for most months the variance differs significantly and the mean is also distinguishable also these results are just the mean i e first order moment and variance i e second order moment calculated as an example not to mention the larger difference in the higher order moments such as skewness and kurtosis therefore the differences between the two distributions in fig 9 i e red bhm and purple zeros are significant table 4 shows the estimated parameter values i e θ j b and σ j 2 b from the 4th test based on the proposed bhm and zero skewness method zeros in addition to the point estimates we use the equal tail method to calculate the 95 bayesian interval estimation for each parameter we see that the difference in σ j 2 is larger than the difference in θ j this indicates that the proposed bhm provides more shrinkage on the shape parameter σ j 2 than the location parameter θ j we further investigate this by calculating the shrinkage factors i e b σ 2 and b θ for bhm and the result shows that the average b σ 2 is 0 29 while the average b θ is only 0 02 on one hand due to the relatively large average b σ 2 value the result clearly explains why the shape parameter σ j 2 can be estimated better by bhm in addition it is evident that bhm allows one to determine whether there is useful between group information to be extracted if this is not the case such as with the estimation of θ j in this example bhm automatically assigns a small shrinkage factor b θ that barely shrinks the mle results it is also evident that the shrinkage factor b σ 2 of the wet season 0 554 is much higher than b σ 2 of the dry season 0 026 this clearly shows that the model achieves substantial shrinkage for variance estimation in the wet season also reflected by the observation that the bayesian estimates across the six months in the wet season dec may were quite close to each other the variances in the dry season and the mean estimates exhibit almost no shrinkage so they were very close to the mles confirming the notion that bhms can achieve data driven shrinkage automatically in sum the proposed bhm method rarely performs worse than the traditional methods based on mle this is due to the fact that if abundant between group information is detected bhm will take full advantage and shrink the mle results e g the σ j 2 in table 4 3 4 cv results of tests with different dataset sizes to further evaluate the performance of bhm under different dataset sizes we choose two different datasets the entire 100 years of observations a large size that represents a case where the data are sufficient and the most recent 60 years of observations a medium size that is available for most hydrological stations we use the flat hyperprior for both seasons and 4 folds cv the cumulative log likelihood and relative improvement eq 43 with bhm as the base model results for each method are shown in table 5 table 5 shows for both the 100 year and 60 year tests that bhm outperforms all other traditional methods in all eight watersheds except a similar performance of bhm and lmle in the 100 year test this is evident because the cumulative log likelihood of bhm is greater than the traditional methods and the relative improvements ri over the traditional methods are all positive additionally comparing the 60 year test to the 100 year test we can see the ri increases for most watersheds this indicates that bhm can provide more improvement over the traditional methods in the test with a smaller data size furthermore comparing bhm with zeros zero skewness we see that bhm produces better results for all watersheds and the ri increases as the data quantity decreases this is a direct demonstration of the advantage of bhm since zeros has the same shift parameter γ estimation as bhm but zeros estimates the shape and location parameters by mle instead of bhm 3 5 cv results of the test with the proposed informative hyperprior to evaluate the performance of the proposed informative hyperprior we conduct the same experiments for the 100 year wet season dataset for each watershed where the results of the proposed informative hyperprior and the flat hyperprior are compared the parameter of the proposed informative hyperprior k and the sign in eq 24 for each watershed is obtained by fine tuning the informative hyperpriors used for the wet season for each watershed are listed below for cheat pine and towanda 46 p v s 0 2 1 s 0 2 v a v e σ 2 v 2 a v e σ 2 for holston driftwood and nueces 47 p v s 0 2 1 s 0 2 v a v e σ 2 v 2 a v e σ 2 4 for schoharie 48 p v s 0 2 1 s 0 2 v a v e σ 2 v 2 a v e σ 2 1 8 for yosemite 49 p v s 0 2 1 s 0 2 v a v e σ 2 v 2 a v e σ 2 3 2 we note that the proposed hyperprior parameter for each watershed may not be optimal that is a better parameter may exist but how to find the optimal hyperprior parameter is beyond the scope of this paper we also note that compared to the data the influence of the hyperprior on bhm is minimal to see the difference between the flat hyperprior and the informative hyperprior we plot the samples from the posteriors of the hyperparameters i e p v s 0 2 s 2 based on two different hyperpriors in fig 10 using the 100 year cheat watershed wet season dataset as the example a total of 200 000 points are sampled from each posterior and the first 3000 samples are dropped as the burn in period in the mcmc process from fig 10 we see both posteriors are proper without any outliers and the informative hyperprior can provide a wider range of s 0 2 sample values than the flat hyperprior table 6 shows the cv results based on both hyperpriors table 6 shows that first for each watershed results generated from the traditional methods based on two hyperpriors are exactly the same this implies that changing the hyperprior will only impact the performance of bhm since only bhm requires a hyperprior second for each watershed bhm performs better than the traditional methods under both hyperpriors as the cumulative log likelihood values are larger third comparing the flat hyperprior results with the informative hyperprior results we see that for each watershed the latter s log likelihood value is a little higher than the former but the improvements are insignificant this indicates that adopting the informative hyperprior can still benefit bhm however compared to the data layer the improvements of using different hyperpriors on bhm should be minimal 3 6 cv results of the test with an extremely small dataset size not all rivers have a sufficiently long historical observation series i e 100 years or 60 years of observations in fact for many watersheds the historical observation series is very short and the data are very limited to compare bhm with the traditional methods based on a short time series we use the most recent 28 years i e small size of historical observations for each watershed then for the most recent 60 year and 28 year datasets we conduct the tests for each watershed and each method because the 28 year series is too short for many watersheds the months in the wet season i e dec may may have negative sample skewness which prohibits any method from estimating ln3 parameters thus in this section we use dry season months i e jun nov as the example for comparison to test if bhm performs better than the selected traditional methods we calculate the relative improvements for each method table 7 shows the test results the flat hyperprior is used in the test it is evident from table 7 that most ri s in the 28 year test are greater than the corresponding ri in the 60 year test this can be interpreted as 1 the base model bhm outperforms the selected traditional methods in most watersheds for both datasets and 2 compared with the medium size dataset 60 years the advantage of bhm over the traditional methods is more noticeable in the small size data set 28 years particularly relative to the mme mmme and zeros methods this is because bhm utilizes other months information which expands the information contained in the limited data thus bhm is especially suited for parameter estimation where historical observations are limited 4 discussion 4 1 comparison of bhm with an autoregressive model bhms are used to account for correlation dependence between different months it would be of interest to compare the performance of bhm with an autoregressive ar model as ar models are used to account for temporal dependence recall in our bhm that the temporal dependence is captured from the log transformed data y in different months i e y log x γ we therefore use the same data to build an ar model and compare results a typical ar q model can be expressed as 50 y t β 0 β 1 y t 1 β 2 y t 2 β q y t q ε this model only can capture linear dependence however our proposed bhm is a data driven model which means the data itself can decide the relation among different months and the correlation dependence can be of any type not limited to linear relation the ar model also defines a joint distribution over y 1 y 12 and we can compare it with our bhm by the test data likelihood consider the wet season i e y 12 y 5 of a given test watershed we propose the following steps for a comparative analysis 1 for simplicity we build an ar 1 model for the wet season i e dec jan may with training dataset e g y 5 β 0 β 1 y 4 ε assume the error term ε follows n 0 σ 2 and the variance σ 2 can be estimated by an unbiased estimator s 2 i e s 2 s s e n tratin 2 where sse is the sum square error and n train is the number of observations in the training dataset 2 based on the ar 1 model the example conditional density distribution can be expressed as y 5 y 4 n y 5 β 0 β 1 y 4 s 2 and similarly for y 12 y 11 y 4 y 3 3 we calculate test likelihood for the ar model using the test dataset for example the test likelihood of p y 5 y 4 is p y 5 y 4 i n test n y 5 i β 0 β 1 y 4 i s 2 where n test is the observation numbers in the test dataset and similarly for p y 12 y 11 p y 4 y 3 as p y 5 y 4 4 we use the training data to estimate the first month in the wet season i e december as a normal distribution i e y 12 n θ 12 σ 12 2 note this is a marginal density distribution we then use the test dataset to calculate its likelihood p y 12 i n test n y 12 i θ 12 σ 12 2 5 we calculate the joint probability density p y 12 y 1 y 5 based on the product rule p y 12 y 1 y 5 ar p y 12 p y 1 y 12 p y 5 y 4 this is also the joint likelihood of the ar model 6 from our bhm we have obtained y j n θ j b σ j 2 b from the training dataset for all six months and these distributions are independent so their joint probability density can be calculated as p y 12 y 1 y 5 bhm p y 12 p y 1 p y 5 then we use the test dataset to calculate the test likelihood of bhm which is also the joint likelihood of bhm 7 we compare two joint log likelihoods between ar 1 and bhm the method with the larger joint log likelihood would be a better model note that we calculate the joint likelihood for each method for comparison because we cannot directly compare y 5 y 4 n y 5 β 0 β 1 y 4 s 2 from the ar 1 model with y 5 n θ 5 b σ 5 2 b from the bhm this is because the former is a conditional distribution but the latter is a marginal distribution and they are not comparable thus we need to convert them to the joint distributions for the comparison i e as shown in steps 5 and 6 based on this procedure we have calculated the joint log likelihoods for ar 1 and bhm for all eight watersheds the results are shown in the table 8 from table 8 we see that the bhm performs better than ar 1 for most of the watersheds because the joint log likelihood of bhm is larger however for yosemite and nueces the ar 1 model has a larger joint log likelihood this implies that for these two watersheds monthly flows indeed follow an ar 1 model therefore despite its limitations the ar model is indeed a good model accounting for temporal dependence and it can perform very well in some watersheds however our proposed bhm is a more general data driven model and requires fewer assumptions 4 2 potential uncertainty loss due to sequential estimation our methodology of construing bhm follows a sequential approach we first estimated shift parameter γ and fixed it we then estimated σ 2 and also fixed it and finally we estimated θ a potential shortcoming of this approach is that not all parameter uncertainties may be properly reflected in the final estimates a full bayesian analysis based on the joint posterior i e p γ σ 2 θ y would be most ideal however it would be very difficult to carry this out in practice we investigate how much uncertainty we may lose with our sequential approach when estimating γ in the table 9 we calculate the 90 confidence interval of γ estimates using schoharie dry season 100 year data as an example table 9 shows that the loss of uncertainty for γ is negligible when compared with the magnitude of each month s real monthly average streamflow i e x according to the probability density function of ln3 i e eq 2 the potential uncertainty loss for γ can be measured by the uncertainty losses of 1 x γ and ln x γ because of the small differences in the last four rows in table 9 these uncertainty losses are insignificant especially for 1 x γ although some uncertainty loss indeed occurred in ln x γ the loss is minimum and negligible for most months in addition even though our sequential approach loses some uncertainty it doesn t lose information on shrinkage i e the shrinkage for estimating σ 2 and θ in fact the variance parameter i e shape parameter σ 2 is most likely the one that needs to be stabilized in other words σ 2 will benefit the most from the shrinkage i e bhm among all the parameters this is also the reason why our proposed variance bhm is important so if we assume γ is perfectly estimated then there is no uncertainty loss for the σ 2 estimation since it is first estimated in our sequential approach i e estimated before θ 5 conclusion in this paper we proposed a bayesian hierarchical model bhm for estimating the statistical parameters for monthly average streamflows we assumed that the monthly average streamflow follows a three parameter log normal distribution ln3 the three underlying statistical parameters associated with ln3 are shift shape and location we selected eight watersheds in the united states where historical unimpaired streamflows have been collected we first conducted a shapiro wilk normality test to validate the ln3 assumption we then developed the bhm and proposed an informative hyperprior we used cross validation cv to evaluate the performance of bhm against selected traditional parameter estimation method methods including local maximum likelihood estimation lmle l moment l mom method of moment estimation mme modified method of moment estimation mmme and zero skewness zeros we calculated the log likelihood cumulative log likelihood and relative improvement for all methods we performed comparative analyses using different dataset sizes and different hyperpriors the results show that the proposed bhm produced better parameter estimates than the selected traditional parameter estimation methods for all data sizes long medium and short the fewer the observation data the more the proposed method improves compared with the traditional methods the two reasons that bhm produced better parameter estimates are 1 bhm utilizes historical observations not only from the month under consideration but also from all other months and 2 due to shrinkage the bayesian estimator from bhm is guaranteed to be no worse than the mle based estimator the proposed bhm is especially suited for parameter estimation where historical observations are limited in addition when compared to an ar model the proposed bhm shows its advantage as a data driven model with fewer assumptions we have demonstrated the advantages of the proposed method for parameter estimation a disadvantage of the method is that it takes much longer running time to get the results primarily due to mcmc simulation for example the zeros method may take just a few seconds while the proposed method takes around 30 min per run the proposed sequential estimation approach is easy to carry out in practice but may incur loss of uncertainty however the loss is insignificant and negligible credit authorship contribution statement jinshu li conceptualization methodology software writing original draft qing zhou methodology william w g yeh methodology writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by an aecom endowment data used in this paper are public at the usgs official website https waterdata usgs gov nwis uv referred module sw the data are also openly available at https zenodo org record 3451496 xyqxx45khhe the authors would like to thank the two anonymous reviewers for their in depth reviews and constructive comments the remarks and summary of reviewer comments provided by the editor and associate editor also are greatly appreciated appendix a derivation of the posterior distribution of σ j 2 dist 9 from bayes rule 1a p σ j 2 v s 0 2 s j 2 p σ j 2 v s 0 2 s j 2 p v s 0 2 p σ j 2 v s 0 2 p s j 2 σ j 2 which is equivalent to 2a p σ j 2 v s 0 2 s j 2 p σ j 2 v s 0 2 p s j 2 σ j 2 based on the eq 8 and a change of variable we can derive 3a p s j 2 σ j 2 d 2 σ j 2 d 2 γ d 2 s j 2 d 2 1 e d s j 2 2 σ j 2 s j 2 d 2 1 σ j 2 d 2 e d s j 2 2 σ j 2 the pdf of inv χ 2 v s 0 2 is 4a p σ j 2 v s 0 2 s 0 2 v 2 v 2 γ v 2 σ j 2 v 2 1 e s 0 2 v 2 σ j 2 then based on eq 2a we have 5a p σ j 2 v s 0 2 s j 2 σ j 2 v d 2 1 e s 0 2 v d s j 2 2 σ j 2 which is equivalent to 6a p σ j 2 v s 0 2 s j 2 i n v χ 2 v d v s 0 2 d s j 2 v d this is exactly eq 9 appendix b derivation of the posterior distribution of hyperparameters p v s 0 2 s 2 i e eq 10 based on the bayes rule and the fact that s j 2 are independent with each other j 1 6 we have 1b p v s 0 2 s 2 p v s 0 2 s 2 p v s 0 2 p s 2 v s 0 2 p v s 0 2 j 1 j 6 p s j 2 v s 0 2 from eq 3a we already have 2b p s j 2 σ j 2 d 2 σ j 2 d 2 γ d 2 s j 2 d 2 1 e d s j 2 2 σ j 2 then we claim that 3b p s j 2 σ j 2 p s j 2 σ j 2 v s 0 2 this is because once σ j 2 is given s j 2 can be determined only by σ j 2 so it is independent of the parameters v and s 0 2 this condition can be summarized as 4b s j 2 v s 0 2 σ j 2 which implies eq 3b bayes rule with eq 3b implies 5b p s j 2 σ j 2 v s 0 2 p s j 2 σ j 2 p σ j 2 v s 0 2 based on eqs 5b and 4a we can derive 6b p s j 2 σ j 2 v s 0 2 d 2 σ j 2 d 2 γ d 2 s j 2 d 2 1 e d s j 2 2 σ j 2 s 0 2 v 2 v 2 γ v 2 σ j 2 v 2 1 e s 0 2 v 2 σ j 2 integrating σ j 2 out from eq 6b we have 7b p s j 2 v s 0 2 p s j 2 σ j 2 v s 0 2 d σ j 2 s 0 2 v 2 v 2 γ v 2 d 2 d 2 γ d 2 s j 2 d 2 1 γ v d 2 v s 0 2 d s j 2 2 v d 2 substituting eq 7b into eq 1b we have 8b p v s 0 2 s 2 p v s 0 2 j 1 j 6 s 0 2 v 2 v 2 γ v 2 γ v d 2 v s 0 2 d s j 2 2 v d 2 simplifying 8b by introducing the beta function we get 9b p v s 0 2 s 2 p v s 0 2 j 1 j 6 1 b e t a v 2 d 2 s 0 2 v 2 v 2 v s 0 2 d s j 2 2 v d 2 this is exactly eq 10 
5072,development of robust approaches for calibrating daily rainfall runoff models to monthly streamflow data is of major practical interest such approaches would enable widely used hydrological modelling platforms that operate at daily time step to be applied in practical situations where precipitation is available at the daily scale but observed streamflow is available only at the monthly scale e g predicting inflows into large dams this study compares the performance of a hydrological model running at daily time step gr4j that is calibrated against daily and monthly streamflow data using a wide range of metrics fit of the daily and monthly flow duration curve daily and monthly pattern metrics and long term bias the comparison is undertaken for 508 australian catchments two evaluation periods and four objective functions including sum of squared errors of box cox transformed streamflow and the kling gupta efficiency monthly calibration performs similar or better than daily calibration in a majority of sites and periods in terms of bias and fit of the flow duration curve this result holds even when the flow duration curve is computed at the daily time step which constitutes a major finding of this study however performance of monthly calibration is worse than daily calibration for daily pattern metrics such as nash sutcliffe efficiency in a majority of sites and periods this performance loss can be reduced significantly by using regionalised values for the flow timing parameter of gr4j similar results are obtained for other pattern metrics and all objective functions these findings suggest that monthly calibration of rainfall runoff models to daily rainfall monthly streamflow is a viable alternative to daily calibration when no daily streamflow data are available keywords rainfall runoff model calibration monthly streamflow data objective function parameter regionalisation kriging 1 introduction conceptual lumped rainfall runoff models that operate at hourly or daily time steps are widely used in water forecasting water resources planning and operations pagano et al 2010 these models require parameter calibration optimised to fit observed data streamflow time series and climate inputs for particular catchments of interest typically the calibration data have the same temporal resolution time step as the intended model predictions however hydro meteorological data are not always available with such resolution due to the prohibitive cost of data acquisition or limited historical archives this paper considers the case where the model is intended for daily predictions climate inputs are available at the daily time step but observed streamflow data used for calibration are available at the monthly time step only the ability to calibrate a daily lumped rainfall runoff model using monthly streamflow data would enable widely used modelling platforms operating at a daily time step to be applied when only monthly data are available such applications are common in practice e g development of streamflow forecasts woldemeskel et al 2018 based on daily rainfall runoff models for inflow catchments to large dams in this scenario daily streamflow is rarely available but high quality monthly flows often are dam inflows can be estimated at a monthly time step from dam outflow and water levels by methods such as inverse pool routing zoppou 1999 d oria et al 2012 at shorter time steps e g daily weekly these streamflow estimation methods produce spurious oscillations due to uncertainty in water level data and the storage volume relationship deng et al 2015 and prevent their use for model calibration calibration of basin scale models welsh et al 2013 where a daily time step model is used to simulate catchment processes including inflows dam operations and water management rules steinfeld et al 2015 a lack of high quality daily dam inflow data creates an inconsistency between dam inflows and streamflow in other parts of the catchment where daily data are available and prevents the application of generic calibration algorithms even more problematic are basins where only monthly data are available for example when digitised from paper archives fry 2014 in these basins hydrological model development is limited primarily by the availability of high quality streamflow data and less so by climate data which can be obtained from global datasets e g satellite rainfall calibration of continental scale models donnelly et al 2016 where daily streamflow data are commonly available but often impacted by temporary storages in small reservoirs lakes or wetlands and thus difficult to use in a calibration process the impact of small storages generally cancels out for monthly totals previous studies where observed streamflow is aggregated prior to model calibration typically operate at a sub daily time scale but apply model calibration to aggregated daily streamflow data these studies have shown that calibration of rainfall runoff models is time step dependent with parameter estimates affected by the aggregation of climate forcings and observed streamflow data e g finnerty et al 1997 littlewood and croke 2008 wang et al 2009 ostrowski et al 2010 kavetski et al 2011 moreover this time dependence is often exacerbated by numerical model implementation and choice of objective function kavetski et al 2011 following the recommendation to use robust time stepping schemes reynolds et al 2017 reported some success in transferring the parameters of the rainfall runoff model hbv from daily to hourly time step without modification in two catchments in panama and wales these results are encouraging in the context of this study where a similar aim is contemplated for models calibrated at a monthly time step using a large dataset of 240 catchments in france ficchì et al 2016 demonstrated that calibrating the gr4j model at sub daily time steps outperforms daily calibration in terms of correlation against daily streamflow data but decreases performance in terms of long term bias section 4 1 in ficchì et al 2016 parameter impact and performance trade offs when calibrating sub daily models to daily streamflow data have received considerable attention but there is little research on the calibration of a daily rainfall runoff model to monthly streamflow data of the few studies that have compared models calibrated to daily and monthly data ye et al 1997 analysed the performance of three daily rainfall runoff models in three arid catchments only one of the three models gsfb was calibrated against monthly streamflow data and performed consistently worse than the ihacres and lascam models calibrated using daily streamflow data however three rainfall runoff models were used in that study gsfb iharces lascam making it difficult to ascertain whether performance loss was due to differences in the calibration time step or to the differences in the rainfall runoff model structure more recently wang et al 2011 compared the monthly wapaba model monthly climate inputs and calibrated to monthly streamflow against two daily models awbm and simhyd over 331 catchments in australia they concluded that the monthly model achieved similar performance to the daily models in terms of monthly correlation and nash sutcliffe efficiency and that the monthly model outperformed the daily models for long term bias and nash sutcliffe efficiency on log transformed flows however no evaluation of the underlying daily step performance was undertaken several studies have compared the performance of the same model calibrated at different time steps for example sudheer et al 2007 calibrated the semi distributed swat model to daily and monthly streamflow data over a 4 year period in a 681 km2 forested catchment in the central usa they reported that monthly calibration performed worse than daily for simulating both daily and monthly flows in terms of correlation nash sutcliffe efficiency and root mean squared error metrics computed at both daily and monthly time steps and concluded that a calibration with an annual monthly time step does not guarantee good performance at daily time step adla et al 2019 reached similar conclusions in a case study where the swat model was calibrated to a 5495 km2 catchment in north east india over a 20 year period using nash sutcliffe efficiency as the objective function they reported that a model calibrated against monthly streamflow data performs poorly when validated against daily streamflow data both sudheer et al 2007 and adla et al 2019 warn against monthly calibration suggesting that it leads to unrealistic daily simulations however their conclusions are based on results from two catchments and a single objective function in addition their study employed a considerably more complex model than other studies cited previously consequently there is a clear research gap in our understanding of the performance of daily rainfall runoff models calibrated to monthly streamflow data in terms of daily scale performance metrics over a wide range of catchments it is well known that the calibration of a rainfall runoff model to streamflow data at an aggregated scale may result in a loss of information leading to indistinguishable model parameters i e ill conditioned especially those associated with quick flow processes e g kavetski et al 2011 this loss of information is likely to happen when calibrating a daily rainfall runoff model to a monthly time step and will be evaluated as part of this paper in some studies focused purely on the daily scale a loss of information has been overcome using parameter regionalisation rojas serna et al 2016 pool et al 2017 for example rojas serna et al 2016 combined a traditional calibration approach with parameter regionalisation to supplement the lack of information in short daily streamflow records in the context of calibrating a daily rainfall runoff model to monthly data no studies have yet evaluated the ability of parameter regionalisation to overcome the loss of information due to data aggregation this study has the following aims 1 evaluate the impact of daily versus monthly calibration of a daily rainfall runoff model gr4j on streamflow predictive performance and parameter estimates over a large sample of catchments using a wide range of performance metrics computed at monthly and daily time steps 2 determine if parameter regionalisation combined with parameter calibration can be used to improve performance metrics when calibrating to monthly data 3 test the robustness of the findings using multiple objective functions the case study employs the rainfall runoff model gr4j perrin et al 2003 which is widely used operationally in france and australia woldemeskel et al 2018 robertson et al 2013 a total of 508 case study catchments in australia are investigated spanning a wide range of catchment properties and hydro climatological conditions this paper is organised as follows section 2 presents the theory of daily and monthly calibration and develops the approach to combine calibration and parameter regionalisation section 3 describes the empirical case studies including catchment data the rainfall runoff model the parameter optimisation approach and performance metrics section 4 presents the empirical case study results followed by their discussion in section 5 finally section 6 summarises the key conclusions 2 theory 2 1 hydrological model consider a hydrological model h that simulates daily streamflow on day t as a function of forcing data x parameters θ and initial conditions s 0 1 q t θ h θ x s 0 this daily model can be calibrated at the daily or monthly scale as described next 2 2 daily calibration in daily calibration θ is estimated by minimizing an objective function f q q θ formulated at the daily scale 2 θ opt argmin θ f q q θ where q q t t 1 t are the daily observed streamflow data q θ q t θ t 1 t are the corresponding model predictions and t is the number of days in the calibration period the objective functions used here are the sum of squared errors sse applied to box cox transformed streamflow and the kling gupta efficiency gupta et al 2009 as detailed in section 2 5 2 3 monthly calibration monthly calibration of a daily rainfall runoff model employs an objective function applied to monthly streamflow 3 θ opt argmin θ f q q θ where q q m m 1 m is the time series of monthly streamflow observations q θ are the corresponding monthly predictions and m is the number of months in the calibration period monthly predictions are obtained from daily predictions as follows 4 q m θ t i m q t θ where i m is the set of days in month m analogous aggregation is employed to obtain monthly observed streamflow data no attempt is made to gap fill the daily observed data if a daily streamflow observation is missing the whole month is flagged as missing it is emphasized that the only difference between the daily using eq 2 and monthly using eq 3 calibration schemes is the time aggregation of the streamflow data all other elements of the scheme are identical including the daily climate inputs the model daily simulation time step the general form of the objective function section 2 5 and the optimisation algorithm 2 4 combination of calibration and regionalisation calibration of a daily model to monthly streamflow data can increase the uncertainty in parameters associated with quick flow processes hence a regionalisation model is developed for such parameters using a kriging approach merz and blöschl 2004 and compared with an approach where all parameters are calibrated the regionalisation approach is detailed in appendix a when regionalisation is used the model parameter vector is partitioned into two parts θ θ c θ r where θ c is the subset of parameters estimated by calibration and θ r is the subset of parameters estimated by regionalisation to avoid artificial skill being introduced parameter regionalisation is implemented using a leave one out approach where regionalised parameters are estimated using a kriging model calibrated to all catchments except the target catchment consequently a separate kriging model is developed for each regionalised parameter for each catchment and for each calibration period note that the kriging based regionalisation approach used in this study does not take into account catchment descriptors a simple alternative using linear regression against catchment descriptors was tested but did not provide better performance results not reported 2 5 objective functions the main objective function used in this work is the sum of squared errors sse applied to box cox transformed streamflow 5 f y y θ j z y j θ λ a z y j λ a 2 where j is the time step index in days or months for daily and monthly calibration respectively and z is the box cox transformation with exponent λ and offset a 6 z y λ a y a λ 1 λ if λ 0 log y a otherwise where the offset a is intended to avoid numerical problems near y 0 when λ 0 and is set to a small value here we use a mean y 100 mcinerney et al 2018 where mean y is the empirical mean of y this objective function is applied with y q in daily calibration section 2 2 and with y q in monthly calibration section 2 3 the majority of the analysis study aims 1 2 are undertaken using a single objective function sse bc0 2 given by eq 5 with the box cox exponent λ set to 0 2 which reduces the impact of high flows on the objective function and thus provides a more balanced approach between high and low flows calibration chiew et al 1993 mcinerney et al 2017 to explore the impact of the objective function on the findings study aim 3 three alternative objective functions are considered two additional objective functions based on the box cox transformation sse bc0 0 shortened hereafter to sse log where λ 0 i e calibration on log transformed flows and sse bc1 0 shortened hereafter to sse where λ 1 i e calibration on un transformed flows the kling gupta efficiency or kge gupta et al 2009 7 g y y θ ρ y y θ 1 2 1 s d e v y θ s d e v y 2 1 m e a n y θ m e a n y 2 where ρ y y θ is the pearson correlation coefficient of simulated and observed streamflows s d e v y is the empirical standard deviation of y the kge objective function explicitly separates the contribution of bias ratio of variances and correlation and is increasingly used for hydrological calibration including in several recent multi time step studies ficchì et al 2016 reynolds et al 2017 in total 9 calibration schemes are compared in this paper as detailed in table 1 a calibration scheme is defined as the combination of objective function time step aggregation and parameter regionalisation approach 3 empirical case study methods 3 1 catchments this study is based on 508 catchments in australia with locations shown in fig 1 and characteristics listed in table 2 daily rainfall time series were extracted from the bureau of meteorology awap archive jones et al 2009 daily time series of potential evapotranspiration were estimated using the penman 1948 equation within the bureau of meteorology landscape model awra frost et al 2018 daily streamflow data were extracted from the water data online service bureau of meteorology 2019 this extensive catchment dataset covers all main australian climate regions the case study catchments span a wide range of hydro climate regimes with pearson s moment coefficient of skewness of daily rainfall varying from 2 4 to 16 4 catchment aridity index ratio of mean annual rainfall and mean annual potential evapotranspiration varying from 0 09 to 2 57 and runoff coefficient varying from 0 01 to 0 92 three catchments are selected to illustrate the findings of this study using hydrographs and flow duration curves macalister river at glencairn in victoria catchment 225219 dumaresq river at farnbro in queensland catchment 416310 and scott river at brennans ford in western australia catchment 609002 additional information for these catchments is provided in fig 1 and table 2 the catchment were selected to represent the diversity of australian hydro climate regions the list of all catchments and associated descriptors are provided in the first dataset of the supplementary material 3 2 rainfall runoff model the gr4j model perrin et al 2003 is a lumped daily scale rainfall runoff model used worldwide in water resources assessment studies and forecasting thiboult et al 2017 xu et al 2017 in australia this model and its hourly version gr4h berthet et al 2009 were selected based on extensive comparison with other alternatives pagano et al 2010 frost and wright 2018 to support several water forecasting products including the bureau of meteorology dynamic seasonal streamflow forecasting system woldemeskel et al 2018 and seven day forecasts robertson et al 2013 as well as to fill gaps in observed streamflow data in the hydrological reference station service zhang et al 2016 gr4j has four parameters listed in table 3 θ 1 mm is the size of a soil moisture accounting store θ 2 mm day is a gain loss term representing exchanges with neighbouring catchments θ 3 mm is the size of a routing store and θ 4 days is a timing parameter controlling the shape of a unit hydrograph parameter transformations listed in table 3 are employed to facilitate the search of the parameter space and reduce parameter correlation kavetski et al 2006 3 3 parameter optimisation the rainfall runoff model parameters are optimized in three steps i draw an initial population of 2000 transformed parameter sets from a multi variate normal density with mean μ and covariance matrix σ set to the following values estimated from previous calibration studies lerat 2018 8 μ 6 0 0 8 3 0 0 7 9 σ 1 16 0 40 0 15 0 20 1 60 0 30 0 17 1 68 0 30 0 60 ii find the parameter set with the best lowest value of the objective function iii apply the downhill simplex algorithm nelder and mead 1965 to the parameter set found in step ii to further refine the gr4j parameter estimates and provide the best fit to observed streamflow this parameter optimisation approach is selected because it builds on past experience of the authors with the gr4j model via the values of μ and σ and acts as a pragmatic compromise between a local optimisation method that can be trapped in secondary minimums duan et al 1992 and a global optimisation method that may suffer from slow convergence perrin et al 2008 in principle the values of the mean and covariance matrix used to initialise the optimisation may affect the final calibrated parameters by favouring certain portions of the parameter space sensitivity analysis was conducted by changing the mean and covariance matrix to values specific to each calibration configuration e g distinct values for monthly calibration no significant changes in the results parameter and objective function values were found consequently these tests are not reported here 3 4 cross validation procedure a temporal split sample validation procedure is implemented with available data split into two periods 1975 1992 and 1992 2015 calibration is performed on each period the model is then run on the other period to compute performance metrics this process yields two sets of validation periods and hence validation metrics for each catchment 3 5 performance assessment model performance is assessed in terms of streamflow predictions and parameter estimates as detailed next 3 5 1 streamflow performance metrics streamflow predictive performance is assessed using five metrics unless otherwise specified these metrics are applied to streamflow at both the daily i e y q and monthly i e y q time scales absolute bias in long term average streamflow is computed as 10 bias 1 mean y θ mean y note that this metric is independent of the evaluation time step the mean absolute relative error on flow duration curve abbreviated as fdc fit hereafter computed for a range of streamflow percentiles is expressed as 11 fdcfit p 1 p 2 1 n p k 1 n p 1 pct y θ p k pct y p k where pct y p is the pth percentile of series y p 1 and p 2 are the lowest and highest percentile considered n p is the number of percentile interpolation points and p k p 1 p 2 p 1 k 1 n p 1 is the linearly interpolated percentile n p is set to 50 sensitivity analysis was conducted using values n p 30 and 100 without significant changes to the results analysis not reported here the fdc fit metric is similar to the fdc diagnostic metric used by yilmaz et al 2008 but is restricted to a portion of the curve we apply this metric to three ranges of percentiles 0 to 10 i e p 1 0 and p 2 10 to quantify fdc fit in low flows 30 to 70 i e p 1 30 and p 2 70 for medium flows and 90 to 100 i e p 1 90 and p 2 100 for high flows pattern matching of predicted and observed hydrographs is quantified using spearman rank correlation 12 corr j r j θ mean r θ r j mean r sdev r θ sdev r where r j θ and r j are the ranks of the simulated and observed streamflow values respectively for time step j timing errors in the daily peaks are quantified using the metric introduced by ficchì et al 2016 13 terr 1 n a a 1 n a t a argmax t t a 5 t a 5 q t θ where n a is the number of years simulated t a is the time of the observed peak flows during water year a the simulated peak time is identified within a window of 5 days before and after t a to minimise the risk of selecting a peak from another flood event the water year rather than calendar year is used with start and end dates defined respectively as 5 months before and 5 months after the maximum mean inter annual monthly flow this definition avoids splitting a flood event across two years this metric is computed at daily evaluation time step only finally overall accuracy is quantified using the nash sutcliffe efficiency 14 nse 1 j y j θ y j 2 j mean y y j 2 the metrics described above can be categorised into three groups long term bias fdc fit metrics and pattern metrics as shown in table 4 3 5 2 performance difference a monthly calibration scheme is assessed by considering the proportion of sites and periods where its performance metrics is classified as worse similar or better in comparison to daily calibration these proportions are computed over the 508 catchments and 2 validation periods i e over a total of 1016 sites periods combinations metric values are considered similar if they differ by less than a practical significance threshold δ perf the choice of δ perf is subjective and context specific in this work we set it to 0 05 for all metrics based on previous experience of the authors this comparison approach is used for most results presented in section 4 and discussed in section 5 as it provides an efficient summary of performance over large datasets a limitation of this approach is that it does not convey the full range of performance differences across all catchments and validation periods due to aggregation into three categories performance metrics for all catchments evaluation periods and calibration schemes are briefly discussed in section 4 all metric values are provided in the supplementary material 3 5 3 spatial analysis of performance differences the spatial distribution of differences in performance is inspected visually by plotting the values on a map in addition an attempt was made to relate performance differences with catchment descriptors listed in table 2 3 5 4 parameter stability the use of monthly streamflow introduces important changes in the objective function and could potentially increase parameter instability between calibration periods this could lead to lower performance of the model for applications requiring extrapolation beyond the hydro climatic conditions encountered during calibration such as climate change studies vaze et al 2010 coron et al 2012 the stability of parameters across calibration periods is assessed as follows le lay et al 2007 15 s i a θ i a p 1 θ i a p 2 where s i a is the stability of the ith parameter estimated using calibration scheme a and θ i a p k is the value of the i th gr4j model parameter obtained after calibrating the model on period p k using calibration scheme a similar to the difference in performance metric described in section 3 5 2 a difference in parameter stability for two calibration schemes a and b is computed as the proportion of sites periods where parameter stability obtained with scheme a is worse i e larger similar or better i e lower than the stability of scheme b parameter stabilities are considered similar when they differ at most by a significance threshold δ par defined in the last column of table 3 3 6 case study procedure to achieve aim 1 i e to evaluate the performance of daily versus monthly calibration of a daily rainfall runoff model the gr4j model section 3 2 is calibrated to the 508 case study catchments section 3 1 using the sse bc0 2 objective function section 2 5 to both daily and monthly streamflow data sections 2 2 and 2 3 respectively a cross validation procedure is employed section 3 4 the performance evaluation uses a wide range of metrics of streamflow performance section 3 5 1 and summaries of performance differences section 3 5 2 parameter stability is also compared for monthly and daily calibration section 3 5 4 to achieve aim 2 i e to determine if parameter regionalisation combined with parameter calibration can improve performance we consider a hybrid calibration regionalisation approach section 2 4 for the gr4j parameter θ 4 the resulting model performance is compared against the performance achieved using pure calibration without regionalisation to achieve aim 3 i e to test the robustness of findings using alternative objective functions the gr4j model with regionalised parameters values the outcome of aim 2 is calibrated to daily and monthly data using four different objective functions section 2 5 and the resulting model performances compared to each other using the performance metrics listed earlier 4 results 4 1 monthly versus daily calibration methods table 5 presents the summary statistics of performance metrics for two calibration schemes 508 catchments and two validation periods here the daily and monthly calibration schemes employ the sse bc0 2 objective function all four gr4j parameters are calibrated table 1 performance differences comparing monthly and daily calibrations are shown in fig 2 the major finding is that monthly calibration performs similarly or better than daily calibration for daily fdc fit metrics in the majority of sites and periods fig 2 a reveals that monthly calibration performance is similar to daily in 24 40 and 36 of sites periods for low medium and high flow fdc fit respectively moreover monthly calibration outperforms daily calibration in 36 20 and 39 of sites periods for the same metrics respectively overall monthly calibration achieves similar or better fdc fit than daily calibration in 60 75 of the sites periods table 5 confirms these findings nearly all summary statistics of fdc fit on low and high flows are lower i e better for monthly calibration compared to daily all statistics on medium flows are higher i e worse for monthly compared to daily calibration but the difference remains below 0 06 percentage points except for the maximum value last column in table 5 a second finding is that monthly calibration performs worse than daily calibration for daily pattern metrics in a majority of sites periods as shown in fig 2 c daily calibration outperforms monthly in 51 56 and 69 of sites periods for correlation nse and peak time error respectively a third finding is that monthly calibration reaches similar or better performance than daily calibration for the monthly fdc fit monthly pattern and long term bias metrics fig 2 b indicates that monthly calibration outperforms daily in a large proportion of sites periods for long term bias 40 fdc fit on low flows 47 and high flows 42 both calibration schemes achieve similar performance on monthly patterns fig 2 d with 98 and 60 of sites periods where correlation and nse are similar respectively fig 3 a explores the spatial distribution of performance differences between monthly and daily calibration using the daily nse metric and the 1992 2015 validation period no obvious spatial pattern is seen in this figure although sites where monthly calibration outperforms daily green dots seem to cluster along the eastern coast of australia an attempt was made to relate daily nse differences with simple catchment descriptors listed in table 2 fig 3 b shows the distribution of daily rainfall skewness for sites periods where monthly calibration is respectively worse similar or better than daily calibration the figure suggests that rainfall skewness is higher for sites periods where monthly calibration performs better than daily calibration similar figures were obtained for correlation and peak timing errors no significant relationship was found for other metrics or descriptors 4 2 comparison of parameter values and stability from daily versus monthly calibrations fig 4 shows the distribution of gr4j parameters for daily and monthly calibration using the sse bc0 2 objective function the distribution of parameter stability for both schemes and the difference in parameter stability between monthly and daily calibrations monthly calibration has a noticeable impact on the distribution of parameter values compared to daily calibration as can be seen in all panels of fig 4 the production store capacity θ 1 tends to be lower for monthly calibration with median θ 1 reduced from 403 mm for daily to 373 mm for monthly fig 4 a the estimated routing store capacity θ 3 is also lower with median reducing from 11 mm for daily to 4 mm for monthly calibrations fig 4 g conversely estimates of the exchange coefficient θ 2 show an increase in the median from 0 2 mm d for daily to 0 1 mm d for monthly calibration fig 4 d finally the time base of unit hydrograph θ 4 does not show a significant difference between calibration schemes in terms of median value but the spread of the distribution is wider for monthly calibration compared to daily fig 4 j fig 4 c f i and l examine the difference in parameter stability between monthly and daily calibration see section 3 5 4 fig 4 l suggests that monthly calibration reduces the stability of gr4j parameter related to hydrograph timing θ 4 significantly with 74 of sites periods where stability of monthly calibrated parameters is worse than daily in contrast monthly calibration produces more stable estimates of θ 2 for 56 of sites periods for parameter θ 1 and θ 3 there is little change in its stability with an equal proportion of sites periods where stability decreases or increases this analysis shows that one of the major impacts of monthly calibration is to reduce the stability of the gr4j parameter θ 4 which controls the timing of the hydrograph in turn this finding suggests that calibration to aggregated monthly streamflow results in a significant loss of information relevant to the timing of hydrographs and is further discussed in section 5 2 4 3 impact of regionalised parameters on monthly calibration performance to overcome the poor stability of parameter θ 4 in the monthly calibration scheme its value was estimated using regionalisation based on neighbouring catchments see section 2 4 and appendix a fig 5 shows the proportion of sites periods where performance of monthly calibration is respectively worse than similar to or better than daily calibration for two monthly calibration configurations 1 monthly where all parameters are calibrated no regionalisation i e the scheme used in the preceding sections and 2 monthly θ 4 where θ 4 is regionalised the sse bc0 2 objective function is used for the two calibration schemes using regionalised estimates of θ 4 improves daily pattern metrics of monthly calibration significantly for daily correlation fig 5 d shows that the proportion of sites periods where monthly calibration is similar to or better than daily calibration increases from 49 when no regionalisation is used to 65 with regionalised θ 4 this proportion increases from 44 to 60 for nse fig 5 e and from 31 to 47 for peak time error fig 5 f fig 5 also shows that using regionalised θ 4 in the monthly calibration achieves similar performance to daily calibration similar to outcomes of 4 1 for all the other performance metrics namely daily and monthly fdc fit monthly pattern and long term bias the benefits of using regionalised timing parameters to improve the performance of monthly calibration are discussed further in section 5 2 4 4 impact of the choice of objective function on monthly calibration performance this section reports the performance of monthly calibration schemes when using alternative objective functions in order to establish the robustness of the findings in the earlier sections to keep the analysis focused only the performance of the monthly calibration schemes with a regionalised θ 4 is reported as it constitutes the best performing calibration setup identified in the previous section in addition only four performance metrics are discussed daily fdc fit on high flows daily nse monthly nse and long term bias to represent performance evaluation across the three metrics groups see table 4 and two simulation time steps additional figures for the remaining metrics are provided in the supplementary material fig 6 presents the distribution of performance metrics and proportion of sites and periods where monthly calibration is similar to or better than daily calibration using four objective functions sse log sse bc0 2 sse and kge the figure shows performance metrics and performance differences side by side in order to highlight that a distinct benchmark is used when computing performance difference for each objective function the key findings of the preceding sections are robust to the choice of the objective function monthly calibration performs similar or better than daily calibration for daily fdc fit on high flows monthly nse and long term bias fig 6 a shows that the proportion of sites periods where monthly calibration is similar or better than daily calibration in terms of high flow fdc fit is above 66 for all objective functions it remains above 87 and 81 for monthly nse fig 6 c and long term bias fig 6 d respectively for daily pattern metrics the key result is that the performance difference between monthly and daily calibration is in favour of monthly for sse log and sse bc0 2 objective functions and in favour of daily for other objective functions sse and kge in fig 6 b the proportion of sites periods where monthly calibration performs similarly or better than daily calibration as per nse metric decreases from 66 for sse log to 44 for kge these changes in the magnitude of performance differences are discussed further in section 5 1 4 5 hydrographs for selected catchments fig 7 shows the daily observed and simulated streamflow for the three representative catchments listed in section 3 1 and three calibration schemes daily monthly all parameters calibrated i e no parameter regionalised and monthly θ 4 parameter θ 4 regionalised the calibration period is set to 1975 1992 and the bc0 2 objective function is used the figure shows hydrographs for the two largest floods along with flow duration curves during the 1995 2015 validation period the calibrated values of the gr4j model parameters are indicated in table 6 for each calibration scheme the hydrographs in fig 7 highlight the advantages of using a regionalised estimate of θ 4 to better reproduce flood peak timing when using a monthly calibration scheme when all parameters are calibrated monthly in fig 7 a b e f i and j the daily hydrographs obtained using the monthly calibration scheme are systematically lagged behind with respect to the daily observed hydrographs in contrast fixing parameter θ 4 to regionalised values monthly θ 4 in fig 7 a b e f i and j greatly improves flood simulations as can be seen in the majority of hydrographs the overall flow duration curves in fig 7 c g and k suggest that monthly calibration can lead to improvement in the overall simulation of daily flow duration curves for the high flow portion of the flow duration curve shown in fig 7 h and l monthly calibration with or without regionalised θ 4 achieves an improvement over daily calibration this finding is particularly visible in fig 7 l where the simulated flow duration curve at brennans ford catchment 609002 obtained using the monthly calibration scheme matches closely the observed curve 5 discussion 5 1 for which performance metrics is a monthly calibration scheme better similar or worse than a daily calibration previous research has indicated that when a rainfall runoff model that operates at one time scale is calibrated to streamflow data aggregated to a larger time scale there is typically some loss of performance especially in the timing of hydrographs adla et al 2019 despite this known issue section 4 4 suggests that monthly calibration schemes reduces long term bias and improves monthly nse compared to daily calibrations for a majority of sites and periods and for all objective functions tested these results confirm the value of monthly calibration for a wide range of hydrological applications requiring an accurate simulation of monthly streamflow time series e g seasonal forecasts and or long term streamflow statistics e g climate change studies the results also suggest that monthly calibration is often though not always better than daily calibration for fdc fit metrics at the daily time step especially for high flow results in selected catchments in fig 7 provide examples of how a monthly calibration using the sse bc0 2 objective function achieves an improvement in daily fdc compared to a daily calibration this finding is surprising because monthly calibration does not access daily streamflow data though it could be explained by the fact that fdc contains no timing information hence reproducing it accurately seems achievable for a monthly calibration scheme to better understand performance differences between daily and monthly calibrations an attempt was made to relate them with catchment descriptors the results shown in fig 3 b suggest that a higher skew in daily rainfall favours monthly over daily calibration this might be explained by the difficulty of daily calibration to match hydrograph peaks in catchments with very intense rainfall events where rainfall timing may be poorly measured this constraint does not impact monthly calibration significantly due to the aggregated nature of the streamflow data used in the objective function the performance improvements achieved by monthly calibration for certain metrics could also be explained by considering the changes in gr4j parameter values monthly calibration tends to yield smaller values of the two gr4j storage parameters θ 1 and θ 3 fig 4 with a reduced storage capacity the rainfall runoff model responds quicker to rainfall and generates higher peak flows which in turn could lead to a better match of large observed flood peaks compared to a daily calibration scheme in addition monthly calibration achieves more stable estimates of the exchange parameter θ 2 section 4 2 which controls the amount of water lost or gained in a catchment this better parameter stability could explain the improvement in long term bias metrics the overall findings in terms of performance trends remain similar across objective functions for most metrics except daily pattern metrics as described in section 4 4 more specifically objective functions that balance the influence of low and high flows e g sse log and sse bc0 2 increase the benefit of monthly calibration in terms of daily patterns metrics consequently monthly calibration using the sse log and sse bc0 2 objective functions appears particularly appealing for applications where low flows are of major importance but where the modeller wishes to avoid sacrificing too much performance in high flows 5 2 mitigating loss of timing information in monthly calibration the ability of monthly calibration to improve certain daily and monthly performance statistics comes at the cost of degraded daily pattern matching as seen in fig 7 this issue is problematic for applications requiring an accurate simulation of peak timing like flood forecasting in addition monthly calibration schemes were shown to degrade the stability in the estimates of timing parameter θ 4 in gr4j across calibration periods this result is not surprising considering that monthly streamflow data carry little information about daily dynamics e g kavetski et al 2011 a practical solution to mitigate these two issues is to estimate θ 4 from regionalisation rather than calibration this solution assumes that daily streamflow data are available at nearby catchments for a daily calibration to be implemented there in the case of simulating dam inflows this assumption appears reasonable as gauging stations are generally installed close to the dam site to support reservoir design and operation the approach of estimating θ 4 using regionalisation reduces timing errors significantly compared to the standard approach where all parameters are calibrated without compromising other performance metrics it is of course possible that regionalisation leads to inaccurate estimates of θ 4 compared to daily calibration however our results presented in section 4 3 suggest that these inaccuracies do not compromise monthly calibration performance as a result it is our recommended approach for calibrating rainfall runoff model against monthly streamflow data 5 3 future research first it is of interest to verify if our findings regarding the value of monthly calibration for the parsimonious model gr4j hold for other rainfall runoff models particularly more complex models with a larger number of parameters and for spatially resolved models a particular challenge of more complex models is the likely difficulty in distinguishing between parameters with low stability θ 4 in this study that benefit from regionalisation versus other parameters the results obtained by sudheer et al 2007 and adla et al 2019 suggest that monthly calibration may be more challenging for semi distributed models compared to the type of models investigated in this study it is likely that such work will require the parameter stability concept used in this paper to be broadened towards measuring parameter identifiability for example following wagener et al 2003 second it is of interest to elucidate the reasons why monthly calibration can produce better daily performance metrics than daily calibration results presented in section 4 1 suggest that catchments with intense rainfall yield larger benefits from monthly calibration more investigation is needed on this point to confirm the findings separating timing errors from amplitude errors for example using the methods proposed by ehret and zehe 2011 or liu et al 2011 could be pivotal to further analysis as suggested by the sharp contrast between results on daily pattern metrics e g peak time errors versus other metrics considered in this study third the investigations could be extended to probabilistic prediction e g mcinerney et al 2017 and others monthly calibration generally requires simpler residual error models due to reduced autocorrelation huard and mailhot 2008 evin et al 2013 and hence offers an opportunity to simplify the calibration of probabilistic rainfall runoff models fourth no attempt was made in this paper to differentiate the two calibration periods based on their hydro climate characteristics which are known to affect parameter calibration vaze et al 2010 coron et al 2012 further analysis on this point is required to ensure that monthly calibration remains a valid alternative during extremely dry or wet periods for example in the context of changing climate finally more advanced regionalisation methods could be explored to better incorporate local catchment characteristics perform regionalisation simultaneously on multiple parameters select regionalised parameters based on formal parameter identifiability analysis see first paragraph in this section and improve the underlying geostatistical model bárdossy and li 2008 however even the simple regionalisation approach used in this study was of great value in improving monthly calibration 6 conclusions this paper explored the calibration of a daily rainfall runoff model to monthly streamflow data and whether it is possible to reduce the loss of performance or even achieve gains in performance under such conditions performance of daily and monthly calibrated models was compared based on long term bias daily and monthly flow duration curve fit daily and monthly correlation daily and monthly nse and daily peak time errors the comparison was undertaken in 508 australian catchments for two evaluation periods and using four objective functions in addition parameter regionalisation was applied to fix one gr4j parameter when calibrating against monthly streamflow data the following key conclusions were obtained 1 daily rainfall runoff models calibrated to monthly streamflow perform similarly or better than models calibrated to daily streamflow except for metrics related to daily patterns monthly calibration schemes reach comparable performance to daily calibrations for a wide range of metrics such as the fit of daily monthly flow duration curves in low medium and high flows monthly correlation and monthly nse with a majority of sites and periods reaching similar or better metric value monthly calibration outperforms daily calibration in a significant proportion of sites and periods for all monthly metrics long term bias and daily flow duration curves fit on high flow this finding is surprising because monthly calibration does not access daily streamflow data monthly calibration performs worse than daily calibration in most sites and periods for metrics related to daily pattern of the hydrograph such as nse correlation and peak time errors 2 daily patterns of monthly calibrated models can be improved significantly by using regionalised values for timing parameters when using monthly calibration schemes simulated hydrographs do not reproduce accurately the timing of flood peak and more generally the daily pattern this limitation can be alleviated by fixing the gr4j parameter controlling hydrograph timing to a regionalised value based on adjacent catchments the proportion of sites periods where monthly calibration is similar or better than daily calibration was increased from a range of 31 49 when calibrating all parameters to a range of 47 65 when using regionalised parameter values depending on the metric considered 3 findings are robust to the choice of the objective function with similar trends observed for four different objective functions the finding that monthly calibration performs similar to daily calibration for daily monthly flow duration curve fit and long term bias held for all four objective functions considered in this work sse log see bc02 sse and kge for daily pattern metrics the difference in performance between the two calibration schemes varies with objective function the magnitude of performance loss is higher for objective functions that favour high flows sse and kge than for objective functions that add more weight to the performance on low flows sse log and sse bc02 overall the findings indicate that monthly calibration is a viable alternative to daily calibration when no daily flow data is available importantly the findings hold over a large sample of australian catchments future work on extending the findings to broader classes of models is recommended credit authorship contribution statement julien lerat conceptualization methodology software visualization investigation writing original draft mark thyer methodology writing review editing supervision david mcinerney methodology writing review editing dmitri kavetski methodology writing review editing fitsum woldemeskel writing review editing christopher pickett heaps writing review editing daeyhok shin writing review editing paul feikema writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was undertaken with the support of the issf4 and soil moisture forecasting projects funded by the bureau of meteorology the authors acknowledge the support provided by the awap jones et al 2009 awra frost et al 2018 and water data online bom 2019 services in supplying high quality datasets used to build the set of study catchments included in this study we also thank louise wilson robert pipunic and zaved khan for their comments on early versions of the manuscript appendix a regionalisation of gr4j parameters using a kriging model regionalized values of gr4j model parameters for a particular catchment are obtained by interpolating from neighbour catchments using a kriging approach merz and blöschl 2004 applied to transformed parameter values the kriging regionalisation procedure operates as follows 1 transform the parameter values at all available gauged catchments as per table 3 let ν i k ϕ θ i k denote the value of the ith model parameter in catchment k after applying transformation ϕ 2 subtract the mean ν i of each transformed parameter value ν i k ν i k ν i 3 formulate a kriging model as a multivariate gaussian distribution with mean 0 and covariance matrix σ fitted to ν i ν i k k 1 n the elements of σ are parameterised as follows 16 c kl σ 2 exp d kl d if d kl d 5 0 otherwise where c kl is the covariance between ν i k and ν i l d kl is the distance between the centroid of catchments k and l and σ and d are kriging parameters which are inferred using a maximum likelihood approach 4 obtain the interpolated parameter value at the catchment of interest denoted k as 17 θ i k ϕ 1 ν i s σ 1 ν i where σ 1 is the matrix inverse of σ and s s k k 1 n is the vector of covariances between ν i k and ν i k computed as follows 18 s k σ 2 exp d k k d fig 8 shows an example of interpolating values of gr4j parameter θ 4 on a regular grid over the south eastern part of australia note that in this work kriging was implemented with a leave one out validation procedure where the catchment of interest k was set in turn to each of the gauged catchments appendix b supplementary material supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2020 125129 appendix b supplementary data the following are the supplementary data to this article supplementary data 1 supplementary data 2 supplementary data 3 supplementary data 4 supplementary data 5 supplementary data 6 supplementary data 7 supplementary data 8 supplementary data 9 supplementary data 10 supplementary data 11 supplementary data 12 supplementary data 13 supplementary data 14 supplementary data 15 
5072,development of robust approaches for calibrating daily rainfall runoff models to monthly streamflow data is of major practical interest such approaches would enable widely used hydrological modelling platforms that operate at daily time step to be applied in practical situations where precipitation is available at the daily scale but observed streamflow is available only at the monthly scale e g predicting inflows into large dams this study compares the performance of a hydrological model running at daily time step gr4j that is calibrated against daily and monthly streamflow data using a wide range of metrics fit of the daily and monthly flow duration curve daily and monthly pattern metrics and long term bias the comparison is undertaken for 508 australian catchments two evaluation periods and four objective functions including sum of squared errors of box cox transformed streamflow and the kling gupta efficiency monthly calibration performs similar or better than daily calibration in a majority of sites and periods in terms of bias and fit of the flow duration curve this result holds even when the flow duration curve is computed at the daily time step which constitutes a major finding of this study however performance of monthly calibration is worse than daily calibration for daily pattern metrics such as nash sutcliffe efficiency in a majority of sites and periods this performance loss can be reduced significantly by using regionalised values for the flow timing parameter of gr4j similar results are obtained for other pattern metrics and all objective functions these findings suggest that monthly calibration of rainfall runoff models to daily rainfall monthly streamflow is a viable alternative to daily calibration when no daily streamflow data are available keywords rainfall runoff model calibration monthly streamflow data objective function parameter regionalisation kriging 1 introduction conceptual lumped rainfall runoff models that operate at hourly or daily time steps are widely used in water forecasting water resources planning and operations pagano et al 2010 these models require parameter calibration optimised to fit observed data streamflow time series and climate inputs for particular catchments of interest typically the calibration data have the same temporal resolution time step as the intended model predictions however hydro meteorological data are not always available with such resolution due to the prohibitive cost of data acquisition or limited historical archives this paper considers the case where the model is intended for daily predictions climate inputs are available at the daily time step but observed streamflow data used for calibration are available at the monthly time step only the ability to calibrate a daily lumped rainfall runoff model using monthly streamflow data would enable widely used modelling platforms operating at a daily time step to be applied when only monthly data are available such applications are common in practice e g development of streamflow forecasts woldemeskel et al 2018 based on daily rainfall runoff models for inflow catchments to large dams in this scenario daily streamflow is rarely available but high quality monthly flows often are dam inflows can be estimated at a monthly time step from dam outflow and water levels by methods such as inverse pool routing zoppou 1999 d oria et al 2012 at shorter time steps e g daily weekly these streamflow estimation methods produce spurious oscillations due to uncertainty in water level data and the storage volume relationship deng et al 2015 and prevent their use for model calibration calibration of basin scale models welsh et al 2013 where a daily time step model is used to simulate catchment processes including inflows dam operations and water management rules steinfeld et al 2015 a lack of high quality daily dam inflow data creates an inconsistency between dam inflows and streamflow in other parts of the catchment where daily data are available and prevents the application of generic calibration algorithms even more problematic are basins where only monthly data are available for example when digitised from paper archives fry 2014 in these basins hydrological model development is limited primarily by the availability of high quality streamflow data and less so by climate data which can be obtained from global datasets e g satellite rainfall calibration of continental scale models donnelly et al 2016 where daily streamflow data are commonly available but often impacted by temporary storages in small reservoirs lakes or wetlands and thus difficult to use in a calibration process the impact of small storages generally cancels out for monthly totals previous studies where observed streamflow is aggregated prior to model calibration typically operate at a sub daily time scale but apply model calibration to aggregated daily streamflow data these studies have shown that calibration of rainfall runoff models is time step dependent with parameter estimates affected by the aggregation of climate forcings and observed streamflow data e g finnerty et al 1997 littlewood and croke 2008 wang et al 2009 ostrowski et al 2010 kavetski et al 2011 moreover this time dependence is often exacerbated by numerical model implementation and choice of objective function kavetski et al 2011 following the recommendation to use robust time stepping schemes reynolds et al 2017 reported some success in transferring the parameters of the rainfall runoff model hbv from daily to hourly time step without modification in two catchments in panama and wales these results are encouraging in the context of this study where a similar aim is contemplated for models calibrated at a monthly time step using a large dataset of 240 catchments in france ficchì et al 2016 demonstrated that calibrating the gr4j model at sub daily time steps outperforms daily calibration in terms of correlation against daily streamflow data but decreases performance in terms of long term bias section 4 1 in ficchì et al 2016 parameter impact and performance trade offs when calibrating sub daily models to daily streamflow data have received considerable attention but there is little research on the calibration of a daily rainfall runoff model to monthly streamflow data of the few studies that have compared models calibrated to daily and monthly data ye et al 1997 analysed the performance of three daily rainfall runoff models in three arid catchments only one of the three models gsfb was calibrated against monthly streamflow data and performed consistently worse than the ihacres and lascam models calibrated using daily streamflow data however three rainfall runoff models were used in that study gsfb iharces lascam making it difficult to ascertain whether performance loss was due to differences in the calibration time step or to the differences in the rainfall runoff model structure more recently wang et al 2011 compared the monthly wapaba model monthly climate inputs and calibrated to monthly streamflow against two daily models awbm and simhyd over 331 catchments in australia they concluded that the monthly model achieved similar performance to the daily models in terms of monthly correlation and nash sutcliffe efficiency and that the monthly model outperformed the daily models for long term bias and nash sutcliffe efficiency on log transformed flows however no evaluation of the underlying daily step performance was undertaken several studies have compared the performance of the same model calibrated at different time steps for example sudheer et al 2007 calibrated the semi distributed swat model to daily and monthly streamflow data over a 4 year period in a 681 km2 forested catchment in the central usa they reported that monthly calibration performed worse than daily for simulating both daily and monthly flows in terms of correlation nash sutcliffe efficiency and root mean squared error metrics computed at both daily and monthly time steps and concluded that a calibration with an annual monthly time step does not guarantee good performance at daily time step adla et al 2019 reached similar conclusions in a case study where the swat model was calibrated to a 5495 km2 catchment in north east india over a 20 year period using nash sutcliffe efficiency as the objective function they reported that a model calibrated against monthly streamflow data performs poorly when validated against daily streamflow data both sudheer et al 2007 and adla et al 2019 warn against monthly calibration suggesting that it leads to unrealistic daily simulations however their conclusions are based on results from two catchments and a single objective function in addition their study employed a considerably more complex model than other studies cited previously consequently there is a clear research gap in our understanding of the performance of daily rainfall runoff models calibrated to monthly streamflow data in terms of daily scale performance metrics over a wide range of catchments it is well known that the calibration of a rainfall runoff model to streamflow data at an aggregated scale may result in a loss of information leading to indistinguishable model parameters i e ill conditioned especially those associated with quick flow processes e g kavetski et al 2011 this loss of information is likely to happen when calibrating a daily rainfall runoff model to a monthly time step and will be evaluated as part of this paper in some studies focused purely on the daily scale a loss of information has been overcome using parameter regionalisation rojas serna et al 2016 pool et al 2017 for example rojas serna et al 2016 combined a traditional calibration approach with parameter regionalisation to supplement the lack of information in short daily streamflow records in the context of calibrating a daily rainfall runoff model to monthly data no studies have yet evaluated the ability of parameter regionalisation to overcome the loss of information due to data aggregation this study has the following aims 1 evaluate the impact of daily versus monthly calibration of a daily rainfall runoff model gr4j on streamflow predictive performance and parameter estimates over a large sample of catchments using a wide range of performance metrics computed at monthly and daily time steps 2 determine if parameter regionalisation combined with parameter calibration can be used to improve performance metrics when calibrating to monthly data 3 test the robustness of the findings using multiple objective functions the case study employs the rainfall runoff model gr4j perrin et al 2003 which is widely used operationally in france and australia woldemeskel et al 2018 robertson et al 2013 a total of 508 case study catchments in australia are investigated spanning a wide range of catchment properties and hydro climatological conditions this paper is organised as follows section 2 presents the theory of daily and monthly calibration and develops the approach to combine calibration and parameter regionalisation section 3 describes the empirical case studies including catchment data the rainfall runoff model the parameter optimisation approach and performance metrics section 4 presents the empirical case study results followed by their discussion in section 5 finally section 6 summarises the key conclusions 2 theory 2 1 hydrological model consider a hydrological model h that simulates daily streamflow on day t as a function of forcing data x parameters θ and initial conditions s 0 1 q t θ h θ x s 0 this daily model can be calibrated at the daily or monthly scale as described next 2 2 daily calibration in daily calibration θ is estimated by minimizing an objective function f q q θ formulated at the daily scale 2 θ opt argmin θ f q q θ where q q t t 1 t are the daily observed streamflow data q θ q t θ t 1 t are the corresponding model predictions and t is the number of days in the calibration period the objective functions used here are the sum of squared errors sse applied to box cox transformed streamflow and the kling gupta efficiency gupta et al 2009 as detailed in section 2 5 2 3 monthly calibration monthly calibration of a daily rainfall runoff model employs an objective function applied to monthly streamflow 3 θ opt argmin θ f q q θ where q q m m 1 m is the time series of monthly streamflow observations q θ are the corresponding monthly predictions and m is the number of months in the calibration period monthly predictions are obtained from daily predictions as follows 4 q m θ t i m q t θ where i m is the set of days in month m analogous aggregation is employed to obtain monthly observed streamflow data no attempt is made to gap fill the daily observed data if a daily streamflow observation is missing the whole month is flagged as missing it is emphasized that the only difference between the daily using eq 2 and monthly using eq 3 calibration schemes is the time aggregation of the streamflow data all other elements of the scheme are identical including the daily climate inputs the model daily simulation time step the general form of the objective function section 2 5 and the optimisation algorithm 2 4 combination of calibration and regionalisation calibration of a daily model to monthly streamflow data can increase the uncertainty in parameters associated with quick flow processes hence a regionalisation model is developed for such parameters using a kriging approach merz and blöschl 2004 and compared with an approach where all parameters are calibrated the regionalisation approach is detailed in appendix a when regionalisation is used the model parameter vector is partitioned into two parts θ θ c θ r where θ c is the subset of parameters estimated by calibration and θ r is the subset of parameters estimated by regionalisation to avoid artificial skill being introduced parameter regionalisation is implemented using a leave one out approach where regionalised parameters are estimated using a kriging model calibrated to all catchments except the target catchment consequently a separate kriging model is developed for each regionalised parameter for each catchment and for each calibration period note that the kriging based regionalisation approach used in this study does not take into account catchment descriptors a simple alternative using linear regression against catchment descriptors was tested but did not provide better performance results not reported 2 5 objective functions the main objective function used in this work is the sum of squared errors sse applied to box cox transformed streamflow 5 f y y θ j z y j θ λ a z y j λ a 2 where j is the time step index in days or months for daily and monthly calibration respectively and z is the box cox transformation with exponent λ and offset a 6 z y λ a y a λ 1 λ if λ 0 log y a otherwise where the offset a is intended to avoid numerical problems near y 0 when λ 0 and is set to a small value here we use a mean y 100 mcinerney et al 2018 where mean y is the empirical mean of y this objective function is applied with y q in daily calibration section 2 2 and with y q in monthly calibration section 2 3 the majority of the analysis study aims 1 2 are undertaken using a single objective function sse bc0 2 given by eq 5 with the box cox exponent λ set to 0 2 which reduces the impact of high flows on the objective function and thus provides a more balanced approach between high and low flows calibration chiew et al 1993 mcinerney et al 2017 to explore the impact of the objective function on the findings study aim 3 three alternative objective functions are considered two additional objective functions based on the box cox transformation sse bc0 0 shortened hereafter to sse log where λ 0 i e calibration on log transformed flows and sse bc1 0 shortened hereafter to sse where λ 1 i e calibration on un transformed flows the kling gupta efficiency or kge gupta et al 2009 7 g y y θ ρ y y θ 1 2 1 s d e v y θ s d e v y 2 1 m e a n y θ m e a n y 2 where ρ y y θ is the pearson correlation coefficient of simulated and observed streamflows s d e v y is the empirical standard deviation of y the kge objective function explicitly separates the contribution of bias ratio of variances and correlation and is increasingly used for hydrological calibration including in several recent multi time step studies ficchì et al 2016 reynolds et al 2017 in total 9 calibration schemes are compared in this paper as detailed in table 1 a calibration scheme is defined as the combination of objective function time step aggregation and parameter regionalisation approach 3 empirical case study methods 3 1 catchments this study is based on 508 catchments in australia with locations shown in fig 1 and characteristics listed in table 2 daily rainfall time series were extracted from the bureau of meteorology awap archive jones et al 2009 daily time series of potential evapotranspiration were estimated using the penman 1948 equation within the bureau of meteorology landscape model awra frost et al 2018 daily streamflow data were extracted from the water data online service bureau of meteorology 2019 this extensive catchment dataset covers all main australian climate regions the case study catchments span a wide range of hydro climate regimes with pearson s moment coefficient of skewness of daily rainfall varying from 2 4 to 16 4 catchment aridity index ratio of mean annual rainfall and mean annual potential evapotranspiration varying from 0 09 to 2 57 and runoff coefficient varying from 0 01 to 0 92 three catchments are selected to illustrate the findings of this study using hydrographs and flow duration curves macalister river at glencairn in victoria catchment 225219 dumaresq river at farnbro in queensland catchment 416310 and scott river at brennans ford in western australia catchment 609002 additional information for these catchments is provided in fig 1 and table 2 the catchment were selected to represent the diversity of australian hydro climate regions the list of all catchments and associated descriptors are provided in the first dataset of the supplementary material 3 2 rainfall runoff model the gr4j model perrin et al 2003 is a lumped daily scale rainfall runoff model used worldwide in water resources assessment studies and forecasting thiboult et al 2017 xu et al 2017 in australia this model and its hourly version gr4h berthet et al 2009 were selected based on extensive comparison with other alternatives pagano et al 2010 frost and wright 2018 to support several water forecasting products including the bureau of meteorology dynamic seasonal streamflow forecasting system woldemeskel et al 2018 and seven day forecasts robertson et al 2013 as well as to fill gaps in observed streamflow data in the hydrological reference station service zhang et al 2016 gr4j has four parameters listed in table 3 θ 1 mm is the size of a soil moisture accounting store θ 2 mm day is a gain loss term representing exchanges with neighbouring catchments θ 3 mm is the size of a routing store and θ 4 days is a timing parameter controlling the shape of a unit hydrograph parameter transformations listed in table 3 are employed to facilitate the search of the parameter space and reduce parameter correlation kavetski et al 2006 3 3 parameter optimisation the rainfall runoff model parameters are optimized in three steps i draw an initial population of 2000 transformed parameter sets from a multi variate normal density with mean μ and covariance matrix σ set to the following values estimated from previous calibration studies lerat 2018 8 μ 6 0 0 8 3 0 0 7 9 σ 1 16 0 40 0 15 0 20 1 60 0 30 0 17 1 68 0 30 0 60 ii find the parameter set with the best lowest value of the objective function iii apply the downhill simplex algorithm nelder and mead 1965 to the parameter set found in step ii to further refine the gr4j parameter estimates and provide the best fit to observed streamflow this parameter optimisation approach is selected because it builds on past experience of the authors with the gr4j model via the values of μ and σ and acts as a pragmatic compromise between a local optimisation method that can be trapped in secondary minimums duan et al 1992 and a global optimisation method that may suffer from slow convergence perrin et al 2008 in principle the values of the mean and covariance matrix used to initialise the optimisation may affect the final calibrated parameters by favouring certain portions of the parameter space sensitivity analysis was conducted by changing the mean and covariance matrix to values specific to each calibration configuration e g distinct values for monthly calibration no significant changes in the results parameter and objective function values were found consequently these tests are not reported here 3 4 cross validation procedure a temporal split sample validation procedure is implemented with available data split into two periods 1975 1992 and 1992 2015 calibration is performed on each period the model is then run on the other period to compute performance metrics this process yields two sets of validation periods and hence validation metrics for each catchment 3 5 performance assessment model performance is assessed in terms of streamflow predictions and parameter estimates as detailed next 3 5 1 streamflow performance metrics streamflow predictive performance is assessed using five metrics unless otherwise specified these metrics are applied to streamflow at both the daily i e y q and monthly i e y q time scales absolute bias in long term average streamflow is computed as 10 bias 1 mean y θ mean y note that this metric is independent of the evaluation time step the mean absolute relative error on flow duration curve abbreviated as fdc fit hereafter computed for a range of streamflow percentiles is expressed as 11 fdcfit p 1 p 2 1 n p k 1 n p 1 pct y θ p k pct y p k where pct y p is the pth percentile of series y p 1 and p 2 are the lowest and highest percentile considered n p is the number of percentile interpolation points and p k p 1 p 2 p 1 k 1 n p 1 is the linearly interpolated percentile n p is set to 50 sensitivity analysis was conducted using values n p 30 and 100 without significant changes to the results analysis not reported here the fdc fit metric is similar to the fdc diagnostic metric used by yilmaz et al 2008 but is restricted to a portion of the curve we apply this metric to three ranges of percentiles 0 to 10 i e p 1 0 and p 2 10 to quantify fdc fit in low flows 30 to 70 i e p 1 30 and p 2 70 for medium flows and 90 to 100 i e p 1 90 and p 2 100 for high flows pattern matching of predicted and observed hydrographs is quantified using spearman rank correlation 12 corr j r j θ mean r θ r j mean r sdev r θ sdev r where r j θ and r j are the ranks of the simulated and observed streamflow values respectively for time step j timing errors in the daily peaks are quantified using the metric introduced by ficchì et al 2016 13 terr 1 n a a 1 n a t a argmax t t a 5 t a 5 q t θ where n a is the number of years simulated t a is the time of the observed peak flows during water year a the simulated peak time is identified within a window of 5 days before and after t a to minimise the risk of selecting a peak from another flood event the water year rather than calendar year is used with start and end dates defined respectively as 5 months before and 5 months after the maximum mean inter annual monthly flow this definition avoids splitting a flood event across two years this metric is computed at daily evaluation time step only finally overall accuracy is quantified using the nash sutcliffe efficiency 14 nse 1 j y j θ y j 2 j mean y y j 2 the metrics described above can be categorised into three groups long term bias fdc fit metrics and pattern metrics as shown in table 4 3 5 2 performance difference a monthly calibration scheme is assessed by considering the proportion of sites and periods where its performance metrics is classified as worse similar or better in comparison to daily calibration these proportions are computed over the 508 catchments and 2 validation periods i e over a total of 1016 sites periods combinations metric values are considered similar if they differ by less than a practical significance threshold δ perf the choice of δ perf is subjective and context specific in this work we set it to 0 05 for all metrics based on previous experience of the authors this comparison approach is used for most results presented in section 4 and discussed in section 5 as it provides an efficient summary of performance over large datasets a limitation of this approach is that it does not convey the full range of performance differences across all catchments and validation periods due to aggregation into three categories performance metrics for all catchments evaluation periods and calibration schemes are briefly discussed in section 4 all metric values are provided in the supplementary material 3 5 3 spatial analysis of performance differences the spatial distribution of differences in performance is inspected visually by plotting the values on a map in addition an attempt was made to relate performance differences with catchment descriptors listed in table 2 3 5 4 parameter stability the use of monthly streamflow introduces important changes in the objective function and could potentially increase parameter instability between calibration periods this could lead to lower performance of the model for applications requiring extrapolation beyond the hydro climatic conditions encountered during calibration such as climate change studies vaze et al 2010 coron et al 2012 the stability of parameters across calibration periods is assessed as follows le lay et al 2007 15 s i a θ i a p 1 θ i a p 2 where s i a is the stability of the ith parameter estimated using calibration scheme a and θ i a p k is the value of the i th gr4j model parameter obtained after calibrating the model on period p k using calibration scheme a similar to the difference in performance metric described in section 3 5 2 a difference in parameter stability for two calibration schemes a and b is computed as the proportion of sites periods where parameter stability obtained with scheme a is worse i e larger similar or better i e lower than the stability of scheme b parameter stabilities are considered similar when they differ at most by a significance threshold δ par defined in the last column of table 3 3 6 case study procedure to achieve aim 1 i e to evaluate the performance of daily versus monthly calibration of a daily rainfall runoff model the gr4j model section 3 2 is calibrated to the 508 case study catchments section 3 1 using the sse bc0 2 objective function section 2 5 to both daily and monthly streamflow data sections 2 2 and 2 3 respectively a cross validation procedure is employed section 3 4 the performance evaluation uses a wide range of metrics of streamflow performance section 3 5 1 and summaries of performance differences section 3 5 2 parameter stability is also compared for monthly and daily calibration section 3 5 4 to achieve aim 2 i e to determine if parameter regionalisation combined with parameter calibration can improve performance we consider a hybrid calibration regionalisation approach section 2 4 for the gr4j parameter θ 4 the resulting model performance is compared against the performance achieved using pure calibration without regionalisation to achieve aim 3 i e to test the robustness of findings using alternative objective functions the gr4j model with regionalised parameters values the outcome of aim 2 is calibrated to daily and monthly data using four different objective functions section 2 5 and the resulting model performances compared to each other using the performance metrics listed earlier 4 results 4 1 monthly versus daily calibration methods table 5 presents the summary statistics of performance metrics for two calibration schemes 508 catchments and two validation periods here the daily and monthly calibration schemes employ the sse bc0 2 objective function all four gr4j parameters are calibrated table 1 performance differences comparing monthly and daily calibrations are shown in fig 2 the major finding is that monthly calibration performs similarly or better than daily calibration for daily fdc fit metrics in the majority of sites and periods fig 2 a reveals that monthly calibration performance is similar to daily in 24 40 and 36 of sites periods for low medium and high flow fdc fit respectively moreover monthly calibration outperforms daily calibration in 36 20 and 39 of sites periods for the same metrics respectively overall monthly calibration achieves similar or better fdc fit than daily calibration in 60 75 of the sites periods table 5 confirms these findings nearly all summary statistics of fdc fit on low and high flows are lower i e better for monthly calibration compared to daily all statistics on medium flows are higher i e worse for monthly compared to daily calibration but the difference remains below 0 06 percentage points except for the maximum value last column in table 5 a second finding is that monthly calibration performs worse than daily calibration for daily pattern metrics in a majority of sites periods as shown in fig 2 c daily calibration outperforms monthly in 51 56 and 69 of sites periods for correlation nse and peak time error respectively a third finding is that monthly calibration reaches similar or better performance than daily calibration for the monthly fdc fit monthly pattern and long term bias metrics fig 2 b indicates that monthly calibration outperforms daily in a large proportion of sites periods for long term bias 40 fdc fit on low flows 47 and high flows 42 both calibration schemes achieve similar performance on monthly patterns fig 2 d with 98 and 60 of sites periods where correlation and nse are similar respectively fig 3 a explores the spatial distribution of performance differences between monthly and daily calibration using the daily nse metric and the 1992 2015 validation period no obvious spatial pattern is seen in this figure although sites where monthly calibration outperforms daily green dots seem to cluster along the eastern coast of australia an attempt was made to relate daily nse differences with simple catchment descriptors listed in table 2 fig 3 b shows the distribution of daily rainfall skewness for sites periods where monthly calibration is respectively worse similar or better than daily calibration the figure suggests that rainfall skewness is higher for sites periods where monthly calibration performs better than daily calibration similar figures were obtained for correlation and peak timing errors no significant relationship was found for other metrics or descriptors 4 2 comparison of parameter values and stability from daily versus monthly calibrations fig 4 shows the distribution of gr4j parameters for daily and monthly calibration using the sse bc0 2 objective function the distribution of parameter stability for both schemes and the difference in parameter stability between monthly and daily calibrations monthly calibration has a noticeable impact on the distribution of parameter values compared to daily calibration as can be seen in all panels of fig 4 the production store capacity θ 1 tends to be lower for monthly calibration with median θ 1 reduced from 403 mm for daily to 373 mm for monthly fig 4 a the estimated routing store capacity θ 3 is also lower with median reducing from 11 mm for daily to 4 mm for monthly calibrations fig 4 g conversely estimates of the exchange coefficient θ 2 show an increase in the median from 0 2 mm d for daily to 0 1 mm d for monthly calibration fig 4 d finally the time base of unit hydrograph θ 4 does not show a significant difference between calibration schemes in terms of median value but the spread of the distribution is wider for monthly calibration compared to daily fig 4 j fig 4 c f i and l examine the difference in parameter stability between monthly and daily calibration see section 3 5 4 fig 4 l suggests that monthly calibration reduces the stability of gr4j parameter related to hydrograph timing θ 4 significantly with 74 of sites periods where stability of monthly calibrated parameters is worse than daily in contrast monthly calibration produces more stable estimates of θ 2 for 56 of sites periods for parameter θ 1 and θ 3 there is little change in its stability with an equal proportion of sites periods where stability decreases or increases this analysis shows that one of the major impacts of monthly calibration is to reduce the stability of the gr4j parameter θ 4 which controls the timing of the hydrograph in turn this finding suggests that calibration to aggregated monthly streamflow results in a significant loss of information relevant to the timing of hydrographs and is further discussed in section 5 2 4 3 impact of regionalised parameters on monthly calibration performance to overcome the poor stability of parameter θ 4 in the monthly calibration scheme its value was estimated using regionalisation based on neighbouring catchments see section 2 4 and appendix a fig 5 shows the proportion of sites periods where performance of monthly calibration is respectively worse than similar to or better than daily calibration for two monthly calibration configurations 1 monthly where all parameters are calibrated no regionalisation i e the scheme used in the preceding sections and 2 monthly θ 4 where θ 4 is regionalised the sse bc0 2 objective function is used for the two calibration schemes using regionalised estimates of θ 4 improves daily pattern metrics of monthly calibration significantly for daily correlation fig 5 d shows that the proportion of sites periods where monthly calibration is similar to or better than daily calibration increases from 49 when no regionalisation is used to 65 with regionalised θ 4 this proportion increases from 44 to 60 for nse fig 5 e and from 31 to 47 for peak time error fig 5 f fig 5 also shows that using regionalised θ 4 in the monthly calibration achieves similar performance to daily calibration similar to outcomes of 4 1 for all the other performance metrics namely daily and monthly fdc fit monthly pattern and long term bias the benefits of using regionalised timing parameters to improve the performance of monthly calibration are discussed further in section 5 2 4 4 impact of the choice of objective function on monthly calibration performance this section reports the performance of monthly calibration schemes when using alternative objective functions in order to establish the robustness of the findings in the earlier sections to keep the analysis focused only the performance of the monthly calibration schemes with a regionalised θ 4 is reported as it constitutes the best performing calibration setup identified in the previous section in addition only four performance metrics are discussed daily fdc fit on high flows daily nse monthly nse and long term bias to represent performance evaluation across the three metrics groups see table 4 and two simulation time steps additional figures for the remaining metrics are provided in the supplementary material fig 6 presents the distribution of performance metrics and proportion of sites and periods where monthly calibration is similar to or better than daily calibration using four objective functions sse log sse bc0 2 sse and kge the figure shows performance metrics and performance differences side by side in order to highlight that a distinct benchmark is used when computing performance difference for each objective function the key findings of the preceding sections are robust to the choice of the objective function monthly calibration performs similar or better than daily calibration for daily fdc fit on high flows monthly nse and long term bias fig 6 a shows that the proportion of sites periods where monthly calibration is similar or better than daily calibration in terms of high flow fdc fit is above 66 for all objective functions it remains above 87 and 81 for monthly nse fig 6 c and long term bias fig 6 d respectively for daily pattern metrics the key result is that the performance difference between monthly and daily calibration is in favour of monthly for sse log and sse bc0 2 objective functions and in favour of daily for other objective functions sse and kge in fig 6 b the proportion of sites periods where monthly calibration performs similarly or better than daily calibration as per nse metric decreases from 66 for sse log to 44 for kge these changes in the magnitude of performance differences are discussed further in section 5 1 4 5 hydrographs for selected catchments fig 7 shows the daily observed and simulated streamflow for the three representative catchments listed in section 3 1 and three calibration schemes daily monthly all parameters calibrated i e no parameter regionalised and monthly θ 4 parameter θ 4 regionalised the calibration period is set to 1975 1992 and the bc0 2 objective function is used the figure shows hydrographs for the two largest floods along with flow duration curves during the 1995 2015 validation period the calibrated values of the gr4j model parameters are indicated in table 6 for each calibration scheme the hydrographs in fig 7 highlight the advantages of using a regionalised estimate of θ 4 to better reproduce flood peak timing when using a monthly calibration scheme when all parameters are calibrated monthly in fig 7 a b e f i and j the daily hydrographs obtained using the monthly calibration scheme are systematically lagged behind with respect to the daily observed hydrographs in contrast fixing parameter θ 4 to regionalised values monthly θ 4 in fig 7 a b e f i and j greatly improves flood simulations as can be seen in the majority of hydrographs the overall flow duration curves in fig 7 c g and k suggest that monthly calibration can lead to improvement in the overall simulation of daily flow duration curves for the high flow portion of the flow duration curve shown in fig 7 h and l monthly calibration with or without regionalised θ 4 achieves an improvement over daily calibration this finding is particularly visible in fig 7 l where the simulated flow duration curve at brennans ford catchment 609002 obtained using the monthly calibration scheme matches closely the observed curve 5 discussion 5 1 for which performance metrics is a monthly calibration scheme better similar or worse than a daily calibration previous research has indicated that when a rainfall runoff model that operates at one time scale is calibrated to streamflow data aggregated to a larger time scale there is typically some loss of performance especially in the timing of hydrographs adla et al 2019 despite this known issue section 4 4 suggests that monthly calibration schemes reduces long term bias and improves monthly nse compared to daily calibrations for a majority of sites and periods and for all objective functions tested these results confirm the value of monthly calibration for a wide range of hydrological applications requiring an accurate simulation of monthly streamflow time series e g seasonal forecasts and or long term streamflow statistics e g climate change studies the results also suggest that monthly calibration is often though not always better than daily calibration for fdc fit metrics at the daily time step especially for high flow results in selected catchments in fig 7 provide examples of how a monthly calibration using the sse bc0 2 objective function achieves an improvement in daily fdc compared to a daily calibration this finding is surprising because monthly calibration does not access daily streamflow data though it could be explained by the fact that fdc contains no timing information hence reproducing it accurately seems achievable for a monthly calibration scheme to better understand performance differences between daily and monthly calibrations an attempt was made to relate them with catchment descriptors the results shown in fig 3 b suggest that a higher skew in daily rainfall favours monthly over daily calibration this might be explained by the difficulty of daily calibration to match hydrograph peaks in catchments with very intense rainfall events where rainfall timing may be poorly measured this constraint does not impact monthly calibration significantly due to the aggregated nature of the streamflow data used in the objective function the performance improvements achieved by monthly calibration for certain metrics could also be explained by considering the changes in gr4j parameter values monthly calibration tends to yield smaller values of the two gr4j storage parameters θ 1 and θ 3 fig 4 with a reduced storage capacity the rainfall runoff model responds quicker to rainfall and generates higher peak flows which in turn could lead to a better match of large observed flood peaks compared to a daily calibration scheme in addition monthly calibration achieves more stable estimates of the exchange parameter θ 2 section 4 2 which controls the amount of water lost or gained in a catchment this better parameter stability could explain the improvement in long term bias metrics the overall findings in terms of performance trends remain similar across objective functions for most metrics except daily pattern metrics as described in section 4 4 more specifically objective functions that balance the influence of low and high flows e g sse log and sse bc0 2 increase the benefit of monthly calibration in terms of daily patterns metrics consequently monthly calibration using the sse log and sse bc0 2 objective functions appears particularly appealing for applications where low flows are of major importance but where the modeller wishes to avoid sacrificing too much performance in high flows 5 2 mitigating loss of timing information in monthly calibration the ability of monthly calibration to improve certain daily and monthly performance statistics comes at the cost of degraded daily pattern matching as seen in fig 7 this issue is problematic for applications requiring an accurate simulation of peak timing like flood forecasting in addition monthly calibration schemes were shown to degrade the stability in the estimates of timing parameter θ 4 in gr4j across calibration periods this result is not surprising considering that monthly streamflow data carry little information about daily dynamics e g kavetski et al 2011 a practical solution to mitigate these two issues is to estimate θ 4 from regionalisation rather than calibration this solution assumes that daily streamflow data are available at nearby catchments for a daily calibration to be implemented there in the case of simulating dam inflows this assumption appears reasonable as gauging stations are generally installed close to the dam site to support reservoir design and operation the approach of estimating θ 4 using regionalisation reduces timing errors significantly compared to the standard approach where all parameters are calibrated without compromising other performance metrics it is of course possible that regionalisation leads to inaccurate estimates of θ 4 compared to daily calibration however our results presented in section 4 3 suggest that these inaccuracies do not compromise monthly calibration performance as a result it is our recommended approach for calibrating rainfall runoff model against monthly streamflow data 5 3 future research first it is of interest to verify if our findings regarding the value of monthly calibration for the parsimonious model gr4j hold for other rainfall runoff models particularly more complex models with a larger number of parameters and for spatially resolved models a particular challenge of more complex models is the likely difficulty in distinguishing between parameters with low stability θ 4 in this study that benefit from regionalisation versus other parameters the results obtained by sudheer et al 2007 and adla et al 2019 suggest that monthly calibration may be more challenging for semi distributed models compared to the type of models investigated in this study it is likely that such work will require the parameter stability concept used in this paper to be broadened towards measuring parameter identifiability for example following wagener et al 2003 second it is of interest to elucidate the reasons why monthly calibration can produce better daily performance metrics than daily calibration results presented in section 4 1 suggest that catchments with intense rainfall yield larger benefits from monthly calibration more investigation is needed on this point to confirm the findings separating timing errors from amplitude errors for example using the methods proposed by ehret and zehe 2011 or liu et al 2011 could be pivotal to further analysis as suggested by the sharp contrast between results on daily pattern metrics e g peak time errors versus other metrics considered in this study third the investigations could be extended to probabilistic prediction e g mcinerney et al 2017 and others monthly calibration generally requires simpler residual error models due to reduced autocorrelation huard and mailhot 2008 evin et al 2013 and hence offers an opportunity to simplify the calibration of probabilistic rainfall runoff models fourth no attempt was made in this paper to differentiate the two calibration periods based on their hydro climate characteristics which are known to affect parameter calibration vaze et al 2010 coron et al 2012 further analysis on this point is required to ensure that monthly calibration remains a valid alternative during extremely dry or wet periods for example in the context of changing climate finally more advanced regionalisation methods could be explored to better incorporate local catchment characteristics perform regionalisation simultaneously on multiple parameters select regionalised parameters based on formal parameter identifiability analysis see first paragraph in this section and improve the underlying geostatistical model bárdossy and li 2008 however even the simple regionalisation approach used in this study was of great value in improving monthly calibration 6 conclusions this paper explored the calibration of a daily rainfall runoff model to monthly streamflow data and whether it is possible to reduce the loss of performance or even achieve gains in performance under such conditions performance of daily and monthly calibrated models was compared based on long term bias daily and monthly flow duration curve fit daily and monthly correlation daily and monthly nse and daily peak time errors the comparison was undertaken in 508 australian catchments for two evaluation periods and using four objective functions in addition parameter regionalisation was applied to fix one gr4j parameter when calibrating against monthly streamflow data the following key conclusions were obtained 1 daily rainfall runoff models calibrated to monthly streamflow perform similarly or better than models calibrated to daily streamflow except for metrics related to daily patterns monthly calibration schemes reach comparable performance to daily calibrations for a wide range of metrics such as the fit of daily monthly flow duration curves in low medium and high flows monthly correlation and monthly nse with a majority of sites and periods reaching similar or better metric value monthly calibration outperforms daily calibration in a significant proportion of sites and periods for all monthly metrics long term bias and daily flow duration curves fit on high flow this finding is surprising because monthly calibration does not access daily streamflow data monthly calibration performs worse than daily calibration in most sites and periods for metrics related to daily pattern of the hydrograph such as nse correlation and peak time errors 2 daily patterns of monthly calibrated models can be improved significantly by using regionalised values for timing parameters when using monthly calibration schemes simulated hydrographs do not reproduce accurately the timing of flood peak and more generally the daily pattern this limitation can be alleviated by fixing the gr4j parameter controlling hydrograph timing to a regionalised value based on adjacent catchments the proportion of sites periods where monthly calibration is similar or better than daily calibration was increased from a range of 31 49 when calibrating all parameters to a range of 47 65 when using regionalised parameter values depending on the metric considered 3 findings are robust to the choice of the objective function with similar trends observed for four different objective functions the finding that monthly calibration performs similar to daily calibration for daily monthly flow duration curve fit and long term bias held for all four objective functions considered in this work sse log see bc02 sse and kge for daily pattern metrics the difference in performance between the two calibration schemes varies with objective function the magnitude of performance loss is higher for objective functions that favour high flows sse and kge than for objective functions that add more weight to the performance on low flows sse log and sse bc02 overall the findings indicate that monthly calibration is a viable alternative to daily calibration when no daily flow data is available importantly the findings hold over a large sample of australian catchments future work on extending the findings to broader classes of models is recommended credit authorship contribution statement julien lerat conceptualization methodology software visualization investigation writing original draft mark thyer methodology writing review editing supervision david mcinerney methodology writing review editing dmitri kavetski methodology writing review editing fitsum woldemeskel writing review editing christopher pickett heaps writing review editing daeyhok shin writing review editing paul feikema writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was undertaken with the support of the issf4 and soil moisture forecasting projects funded by the bureau of meteorology the authors acknowledge the support provided by the awap jones et al 2009 awra frost et al 2018 and water data online bom 2019 services in supplying high quality datasets used to build the set of study catchments included in this study we also thank louise wilson robert pipunic and zaved khan for their comments on early versions of the manuscript appendix a regionalisation of gr4j parameters using a kriging model regionalized values of gr4j model parameters for a particular catchment are obtained by interpolating from neighbour catchments using a kriging approach merz and blöschl 2004 applied to transformed parameter values the kriging regionalisation procedure operates as follows 1 transform the parameter values at all available gauged catchments as per table 3 let ν i k ϕ θ i k denote the value of the ith model parameter in catchment k after applying transformation ϕ 2 subtract the mean ν i of each transformed parameter value ν i k ν i k ν i 3 formulate a kriging model as a multivariate gaussian distribution with mean 0 and covariance matrix σ fitted to ν i ν i k k 1 n the elements of σ are parameterised as follows 16 c kl σ 2 exp d kl d if d kl d 5 0 otherwise where c kl is the covariance between ν i k and ν i l d kl is the distance between the centroid of catchments k and l and σ and d are kriging parameters which are inferred using a maximum likelihood approach 4 obtain the interpolated parameter value at the catchment of interest denoted k as 17 θ i k ϕ 1 ν i s σ 1 ν i where σ 1 is the matrix inverse of σ and s s k k 1 n is the vector of covariances between ν i k and ν i k computed as follows 18 s k σ 2 exp d k k d fig 8 shows an example of interpolating values of gr4j parameter θ 4 on a regular grid over the south eastern part of australia note that in this work kriging was implemented with a leave one out validation procedure where the catchment of interest k was set in turn to each of the gauged catchments appendix b supplementary material supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2020 125129 appendix b supplementary data the following are the supplementary data to this article supplementary data 1 supplementary data 2 supplementary data 3 supplementary data 4 supplementary data 5 supplementary data 6 supplementary data 7 supplementary data 8 supplementary data 9 supplementary data 10 supplementary data 11 supplementary data 12 supplementary data 13 supplementary data 14 supplementary data 15 
5073,in this study an interval stochastic bi level programming isbp method is developed for planning the water energy nexus wen system in isbp interval parameter programming ipp and two stage stochastic programming tsp are introduced into a bi level programming bp framework isbp can tackle dual uncertainties expressed as probability distributions and interval values as well as balance the tradeoff between two level decision makers an isbp wen model is then formulated for planning the wen system of jinan the capital of shandong province china in which the upper level model aims to maximize system benefit and the lower level model aims to minimize the electricity consumed for water allocation major findings are i dual uncertainties can affect the city s water allocation pattern and lead to different amounts of water shortage and electricity consumption ii 25 5 31 3 of water allocation target cannot be satisfied under the low water flow level implying that the city would face serious water shortage iii compared with surface water and reclaimed water groundwater is the scarcest source for the city and the proportion of groundwater deficit would be 41 2 49 9 under the low water flow level iv compared with the traditional single level model electricity consumption from isbp wen would be reduced by 3 9 5 1 these findings can help managers to identify the desired strategy between different stakeholders and provide numerical information for planning the wen system under dual uncertainties keywords bi level programming dual uncertainties stochastic analysis water energy nexus water resource allocation 1 introduction water scarcity problems have been intensified by rapid socioeconomic development and accelerated population growth more than 1 8 billion people are estimated to be affected by water scarcity and 663 million people even do not have sufficient drinking water unicef who 2015 water shortage will become more and more severe along with the decreasing available water resources and increasing water demands from multiple users e g residential industrial and agricultural zhang et al 2018 it is reported that the global agricultural water consumption will increase around 20 by 2050 water consumption from energy will rise by 12 because the global energy demand will increase by 36 in 2030 compared with 2010 lv et al 2018 accompany with growing water consumption energy used for extracting collecting distributing and treating water would increase significantly besides projects such as pumping deep groundwater and transferring long distance water would also consume plenty of energy it is estimated that pumping water consumes nearly 7 of energy worldwide which is the highest energy intensive process of water allocation hamiche et al 2016 the process of water allocation needs energy at the same time a large quantity of water is consumed in the electricity generation system the interdependency relationship can be referred as water energy nexus wen which is increasingly highlighted as a crucial consideration for future strategic policy and development plan making hardy et al 2012 khalkhali et al 2018 modelling a water system as a wen can provide insight about water utilization efficiency and open an opportunity for water and energy saving howells and rogner 2014 nogueira and perrella 2015 vakilifard et al 2018 xiang and jia 2019 the interdependence between water and energy necessitates the development of integrated approaches however uncertainties may exist in boundary conditions and model parameters which can lead to more complicated decision making processes for planning wen system previously researchers proposed some approaches to deal with uncertainties existed in water energy systems borgomeo et al 2018 li et al 2019 lindenschmidt and rokaya 2019 wu et al 2019 liu et al 2020 among them two stage stochastic programming tsp is effective in solving uncertain problems in which an analysis of policy scenario is desired and the related data are expressed as probability distributions li et al 2007 in tsp the first stage decision is made before the values of random variables are known then the second stage decision can be made after the random events have happened to minimize penalties that may appear due to any infeasibility maqsood et al 2005 nie et al 2018 however in real world problems it is difficult to express uncertainties using probabilistic distributions thus interval parameter programming ipp is introduced to the tsp framework leading to interval two stage stochastic programming itsp that can handle uncertainties expressed as probability distributions and interval numbers the wen system involves different managers with individual objectives and preferences which are conflicting in most cases these managers have different goals and controlling rights over water resource allocation problems however most of the previous studies related to itsp were developed with single level objective zhang and li 2014 fu et al 2017 khosrojerdi et al 2019 most single level models may have difficulty in solving the wen problems hierarchically because they often ignore the conflicts among interest obtainments without giving priority to any decision makers bi level programming bp which is formulated based on stackelberg games with a preset hierarchy can be introduced to deal with the above mentioned problems there are two decision makers involved in bp the upper level decision maker uldm i e leader and the lower level decision maker lldm i e follower the decision makers represent two different hierarchical levels in the process of decision making the uldm sets the objectives and decisions firstly then the lldm acquires his her optimal solutions which are calculated separately the results of lower level are submitted and revised by the uldm with a view to the whole benefits of the bp model and the process repeats until a satisfactory solution is obtained recently bp has been widely explored for planning water or energy systems zhang and vesselinov 2016 yao et al 2018 rashidizadeh kermani et al 2019 however few studies were found in using bp technique for planning wen system with the combination of itsp and bp an interval stochastic bi level programming isbp method which has advantages in hierarchical decision making uncertainties reflection and policy analysis is developed comparing to the conventional single level programming e g itsp isbp can analyze different objectives in the decision making process which could reflect the practical problem better especially suitable for conflict resolution ranarahu et al 2017 jin et al 2018 comparing to the conventional multi objective programming mop isbp can represent the mutual action between leader and follower explicitly in a mop problem an optimal solution or a pareto set has to be determined through utility theory or other weighting methods difficulties lie in the selection of correct utility functions and the quantification of tradeoffs among multiple objectives sankararao and gupta 2007 li et al 2017 generally isbp is effective in solving interactive decision making problems existed in a predominantly hierarchical structure in which the goal of uldm can be preferably met therefore the objective of this study is to develop an isbp method for planning wen system in combination with uncertainties and different decision making levels isbp integrates tsp ipp and bp into a general framework which can be used for tackling uncertainties and handling the tradeoffs between different decision makers hierarchically and quantitatively the developed method will then be applied to a real case for planning water energy nexus wen system of jinan the capital of shandong province china the results obtained can provide supports for i improving the understanding of water energy linkage under dual uncertainties existed as interval values and probability distributions ii identifying the optimal water allocation scheme and the amount of electricity consumption under different water flow levels and iii solving hierarchical decision making problem as well as making the tradeoff between system benefit and electricity consumption based on leader follower strategy 2 methodology bi level programming bp based on leader follower strategy is a nested optimization involving two decision makers the upper one and the lower one candler and townsley 1982 each of them has his her own objective function independently and influences the reactions of the other one let x r n 1 and y r n 2 be vectors of decision variables indicating upper and lower level choices respectively let f u r n 1 r n 2 r and f l r n 1 r n 2 r be the upper and lower level objective functions respectively g 1 r n 1 r n 2 r and g 1 r n 1 r n 2 r are bi level constraints the bp model can be formulated as follows 1a max x f u x y 1b s t g 1 x y 0 where 1c y arg max y f l x y 1d s t g 1 x y 0 although bp can solve tradeoffs between different decision makers it has limitations in handling uncertainties existed in the real world problems two stage stochastic programming tsp can tackle uncertain problems in which the related data are expressed as probability distributions interval parameter programming ipp can handle uncertainties existed as interval values therefore introducing tsp and ipp into the above bp an interval stochastic bi level programming isbp model can be formulated as follows upper level 2a max x y f u c t 1 x h 1 v p h d t 2 y s t 2b a r x b r r 1 2 m 1 2c a t x a t y w h t 1 2 m 2 h 1 2 v 2d x j 0 x j x j 1 2 n 1 2e y jh 0 y jh y j 1 2 n 2 h 1 2 v lower level 2f max x y f l c t 1 x h 1 v p h d t 2 y s t 2g a r x b r r 1 2 m 1 2h a t x a t y w h t m m 1 2 m 2 h 1 2 v 2i x j 0 x j x j 1 2 n 1 2j y jh 0 y jh y j 1 2 n 2 h 1 2 v where a r r m 1 n 1 a t r m 2 n 2 b r r m 1 1 c t 1 r 1 n 1 d t 2 r 1 n 2 a r r m 1 n 1 a t r m 2 n 2 b r r m 1 1 c t 1 r 1 n 1 d t 2 r 1 n 2 x r n 1 1 y r n 2 1 and r denote a set of interval parameters and or variables superscript donates interval parameters with upper and lower bounds c t 1 and c t 1 are net benefits to users during period t x is fixed allocation target which is promised to users p h is the probability for water flow level d t 2 and d t 1 represent the amount of water deficits by which water allocation targets are not satisfied y represents the reduction of net benefit caused by water deficit w h and w h are the amount of water demand for different users b r and b r are random variables equal to total water availability the solutions of bp problems may not be pareto optimal bard 1984 wen and hsu 1991 shih et al 1996 this is because a basic assumption of bp problem prohibits cooperation between decision makers marcott and savar 1991 an interactive algorithm is introduced to solve the isbp for obtaining the overall satisfactory solution through model 3 f u f u f u x u x u x u and y u y u y u can be obtained for the upper level model correspondingly f l f l f l x l x l x l and y l y l y l can be obtained for the lower level model since the solution x u is controlled by the upper level model it is difficult for the lower level model to receive optimal solutions under such strict conditions it is reasonable to have some leeway or tolerances that give the lldm a wider feasible domain to search for his her optimal solution therefore the solution x u should be allowed to fluctuate within a range x x u p 1 x u p 1 x x u p 1 x u p 1 in which p 1 is maximum tolerance decided by uldm p1 10 106 m3 the most preferred decision is x u the worst acceptable decision is x u p 1 and x u p 1 for the upper bound model the decision makers preference would linearly increase within the interval of x u p 1 x u and would linearly decrease within the interval of x u x u p 1 since the upper level model is a maximization problem the uldm would consider under all f u f u being acceptable and f u f u f u x l y l being unacceptable due to the fact that the lower level model is a minimization problem the lldm would consider that solutions satisfying f l f l would be acceptable while f l f l f l x u y u would be unacceptable according to the interactive algorithm the upper bound model can be formulated as follows 3a max λ s t 3b a x b 3c a x a y w 3d μ x x λ i 3e μ f u f u x y λ 3f μ f l f l x y λ 3g x y 0 3h λ 0 1 where 3i μ x x x x u p 1 p 1 if x u p 1 x x u x p 1 x p 1 if x u x x u p 1 0 if o t h e r w i s e 3j μ f u f u x y 1 i f f u f u f u f u f u f u i f f u f u f u 0 i f f u f u 3k μ f l f l x y 1 i f f l f l f l f l f l f l i f f l f l f l 0 i f f l f l where 3b and 3c are original constraints for isbp model μ x x is membership function for decision variables μ f u f u x y and μ f l f l x y are membership functions for upper and lower level model respectively then solutions x opt and y opt can be received through the model 4 the objective function values of the upper and lower level model are f uopt and f lopt respectively similarly through calculating x u y u f u f l f l x u y u x l y l f l and f u f u x l y l solutions of x opt y opt f uopt and f lopt corresponding to lower bounds of the objective can be obtained through the following model 4a max λ s t 4b a x b 4c a x a y w 4d μ x x λ i 4e μ f u f u x y λ 4f μ f l f l x y λ 4g x y 0 4h x x opt 4i y y opt 4j λ 0 1 where 4k μ x x x x u p 1 p 1 i f x u p 1 x x u x u p 1 x p 1 i f x u x x u p 1 0 i f o t h e r w i s e 4l μ f u f u x y 1 i f f u f u f u f u f u f u i f f u f u f u 0 i f f u f u 4m μ f l f l x y 1 i f f l f l f l f l f l f l i f f l f l f l 0 i f f l f l through solving models 4 and 5 solutions for the isbp model can be obtained i e x opt x opt x opt y opt y opt y opt f uopt f uopt f uopt and f lopt f lopt f lopt 3 case study 3 1 overview of the study system jinan 36 40 n 117 00 e is the provincial capital city of shandong province china covering an area of 7998 km2 it is located in the typical monsoon climate zone with the annual precipitation of 710 8 mm at the end of 2017 the population of jinan was about 6 4 million with a population growth rate of 8 3 per year the gross domestic product gdp was 720 1 billion rmb with the growth rate of 8 0 per year the growing population and the developing economy bring about extreme pressure to meet the city s water demand the total water supply was 1626 2 106 m3 in 2017 in which the groundwater consumption was 585 9 106 m3 the surface water supply was 958 8 106 m3 68 7 of the surface water was obtained from an inter basin water transfer project the other water sources accounted for 81 5 106 m3 due to the large population in jinan the water availability is only 256 m3 per capita which is merely 11 2 of the national level much less than the world s water scarcity threshold i e 1000 m3 per capita the economic development also leads to an increase in electricity consumption for the city the amounts of electricity consumption were 17 2 109 kwh in 2006 and 27 6 109 kwh in 2017 however the capacity of electricity production is limited which leads to electricity shortage frequently in 2017 40 2 of the electricity had to rely on import from the other places therefore the economic development in jinan is limited by the problems of water scarcity and electricity shortage currently groundwater surface water and reclaimed water are main water sources the multiple water sources and diverse water users lead to the complicated water allocation process plenty of energy has to be consumed in the process of water allocation including pumping transporting treating distributing and draining water however water and energy resources in jinan are limited due to the inextricable linkage between water and energy it is crucial for managers to make a rational water resource allocation plan in view of high economic benefit and low energy consumption in the water energy nexus wen system many system components are plagued with uncertainties due to inexact information natural process and human subjectivity li et al 2009 in this study the uncertain parameters are expressed as probability distributions and interval values an interval stochastic bi level programming isbp method is thus developed to plan the wen system of jinan under dual uncertainties 3 2 isbp wen modeling formulation as shown in fig 1 three water sources six users and three planning periods are involved in the optimization model in which two representative decision makers i e water system s decision maker and energy system s decision maker are also considered as a developing city promoting jinan s economic development is the primary mission therefore the upper level decision maker leader sets an objective to maximize the benefit produced by water resource allocation meanwhile the managers in jinan should reduce electricity consumption for energy saving accordingly the lower level decision maker follower sets a goal to minimize the amount of electricity consumed in the process of water resource allocation the two level decision makers goals are conflicting maximizing the system benefit means more water resources allocated to water users thus more electricity would be consumption the isbp wen model is subjected to a variety of water and energy related constraints total electricity demand pollutants emission control water quality constraints groundwater protection reclaimed water reuse water resource availability and the amount of water demand accordingly the isbp wen model can be formulated as follows upper level 5a max f i 1 i t 1 t n b it w g it w s it w r it i 1 i t 1 t k 1 k p tk c it d g itk d s itk d r itk lower level min f i 1 i t 1 t k 1 k p tk a e g it q g itk i 1 i t 1 t k 1 k p tk a e s it q s itk i 1 i t 1 t k 1 k p tk a e r it q r itk i 1 i t 1 t k 1 k p tk a e p it q g itk q s itk q r itk t 1 t k 1 k p tk α t a e m 1 t q g 1 t k q s 1 t k q r 1 t k t 1 t k 1 k p tk β t a e m 4 t q g 4 t k q s 4 t k q r 4 t k i 1 i t 1 t k 1 k p tk a e b it q g itk q s itk q r itk i 1 i t 1 t k 1 k p tk δ it a e d it q g itk q s itk q r itk the constraints for isbp wen model include 1 electricity demand constraint 5c q g 1 t k q s 1 t k q r 1 t k w d t i e d tk t e d tk t k 2 co2 emission constraint 5d c c t q g 1 t k q s 1 t k q r 1 t k w d t 1 θ t t m c c tk t k 3 water quality constraint 5e i 1 i ρ itk δ it q g itk i 1 i ρ itk δ it q s itk i 1 i ρ itk δ it q r itk 1 κ t q p tk i t k 4 groundwater protection constraint 5f i 1 i q g itk p g t m w g tk i t k 5 the utilization rate of reclaimed water 5g i 1 i q r itk p r t m w r tk i t k 6 surface water availability constraint 5h i 1 i q s itk m w s tk i t k 7 reclaimed water availability constraint 5i i 1 i q r itk m w r tk i t k 8 resource availability constraint 5j i 1 i q g itk q s itk q r itk t w tk i t k 9 water demand constraint 5k q g itk q s itk q r itk m w d itk i t k 10 nonnegative constraint 5l q g itk q s itk q r itk 0 i t k where w g it w s it w r it d g itk d s itk d r itk q g itk q s itk and q r itk are decision variables the detailed nomenclatures for the decision variables and parameters are provided in appendix for jinan groundwater and surface water would be delivered to six users electric power department industrial sector agricultural sector residential sector ecological water demand and municipal sector in three periods 2019 2021 each period with one year the reclaimed water would be delivered to four users electric power department industrial sector ecological water demand and municipal sector table 1 provides different water flow levels in the planning periods the related data are obtained from jinan water resources bulletin 2017 and modified according to the local management policy the probability ptk is introduced to demonstrate different water flow levels with the development of water transfer projects and the construction of the pipe nets the amount of surface water and reclaimed water will increase over the planning periods the flow of groundwater has been decreased due to the continuous decline of the groundwater table as shown in table 2 according to the jinan statistical yearbook 2017 jinan s government development planning and historical water consumption the water demands for different users can be set the water demands are used for restricting future optimized water allocation targets reclaimed water is not permitted to supply agricultural planting and residential living table 3 provides input parameters related to water and energy systems the related data are collected from jinan s statistical bulletin on national economic and social development 2017 and shandong statistical yearbook 2017 4 result and discussion table 4 presents the results of optimized water allocation targets to different users in the three planning periods different water flow scenarios would not have any impact on the optimal water allocation targets because the water allocation targets i e the first stage decisions were pre determined by managers before water flow levels were known with the known water flow levels the water deficits would be determined in the second stage to mitigate the economic losses results also show that the optimized surface water allocation target would reach its upper bound i e w s it in period 3 which demonstrates that the manager is optimistic about the surface water supply variations of water allocation targets reflect different policies for managing water resources if the water allocation targets approach their upper bounds the wen system would face more water shortages when the flow level is medium or low correspondingly the economic penalties due to water deficits would be high as shown in fig 2 jinan is a seriously water scarce city under low water flow level 25 5 31 3 of water allocation target cannot be satisfied over the planning periods correspondingly the penalty due to water shortage would be 107 6 143 0 109 rmb even under high water flow level 9 2 17 1 of water allocation target cannot be satisfied for different water users the municipal sector would face the most severe water shortage over the planning periods i e nearly 51 7 of targets cannot be satisfied however for the residential sector the water resources would be relatively adequate only 6 7 of water allocation targets cannot be satisfied under low water flow level low water deficits lead to low risk of violating the promised targets and thus low penalty which demonstrates advantageous conditions for water resource management correspondingly high water deficits would be raised under rigorously demanding conditions low water flow level which lead to high target violation risk and high penalty the results presented in fig 2 also show the deficits for different water sources under low water flow level the water deficit ratios for groundwater surface water and reclaimed water are 41 2 49 9 20 0 23 9 and 15 3 20 2 respectively implying that the city has serious shortage for groundwater for different users under medium and high water flow levels surface water deficits for industry are higher than the agricultural sector this is because industrial water allocation is mainly provided by groundwater and reclaimed water i e accounting to 61 9 64 1 and 30 6 34 5 respectively in addition since the isbp wen model aims to maximize system benefit while minimizing electricity consumption during water allocation the industry sector which consumes more electricity in treating wastewater would have higher deficits than the agricultural sector in most cases reclaimed water cannot be distributed to agricultural use due to the water quality requirement therefore there are no reclaim water allocation targets or deficits for agriculture generally with a view to economic and environmental factors reclaimed water should be allocated firstly followed by surface water and the groundwater should be the final consideration fig 3 shows the results of optimized water allocation scheme obtained from the isbp wen model results indicate that the amount of water resources allocated to the agricultural sector would decrease over the planning horizon under medium flow level the amounts of water allocated to agriculture are 621 1 667 3 106 m3 in period 1 and 563 2 619 3 106 m3 in periods 3 with an annual average decrease rate of 7 2 9 3 besides different water flow levels have significant effects on water allocation schemes in period 1 the amount of municipal water allocation would be 102 1 138 2 106 m3 under high flow level and 81 2 96 1 106 m3 under low flow level which indicates that dual uncertainties would affect the city s water allocation pattern in general results present a detailed water allocation scheme for different users in all possible scenarios which can provide effective policy guidance of water resource management to stakeholders in jinan fig 4 shows the solutions of water supply obtained from the isbp wen model and the traditional single level model aiming to maximize system benefit the total amount of reclaimed water supply of the isbp wen model would be 8 1 8 5 less than the single level model this is because treating reclaimed water would consume more electricity the isbp wen model aims to both increase the system benefit and decrease the electricity consumption such that the amount of reclaimed water would be reduced fig 5 shows water resource allocation pattern to different users for the isbp wfe model the amount of water resources allocated to residential and ecological sectors are 5 1 6 6 and 8 0 8 1 less than those of the single level model respectively the single level model leads to an increase in water allocation under high water flow level which would result in a high risk of water shortage under the medium or low water flows corresponding to high economic penalty conversely the isbp wen has advantages in making the tradeoff between different decision levels and balancing the conflict between different objectives according to the optimal solution obtained from the developed model the system benefit is 314 7 372 4 109 rmb and the electricity consumption is 2 7 3 0 109 kwh fig 7 shows the solutions of electricity consumption under different water flow levels from the traditional single level model and the isbp wen model results show that the agricultural sector is the most electricity consuming sector followed by the residential sector for example for the isbp wen model under medium water flow level the agricultural sector is responsible for 39 3 of electricity consumption for the residential sector it represents 28 3 this is because the agricultural sector consumes a large amount of water resources moreover outdated irrigation techniques intensify the wasting of resources therefore for the study city developing agricultural irrigation techniques can reduce electricity consumption effectively results also indicate that the electricity consumption from the isbp wen model i e 2886 9 3117 2 106 kwh would be 3 9 5 1 less than the single level model i e 2738 7 2996 1 106 kwh besides according to fig 6 the system benefit of the isbp wem model i e 314 7 372 4 109 rmb would be 1 2 4 5 less than the single level model i e 318 6 390 0 109 rmb although the single level model has higher system benefit it neglects the cost of electricity comsumption during water allocation which increases system risk and cannot balance the tradeoff beween different decision levels therefore the water allocation pattern from the isbp wen model is more advisable than that from the traditional single level model 5 conclusions in this study an interval stochastic bi level programming isbp method has been developed for planning the water energy nexus wen system under dual uncertainties isbp incorporates interval parameter programming ipp two stage stochastic programming tsp and bi level programming bp within a general framework the isbp cannot only tackle uncertainties expressed as interval values and probability distributions but also solve hierarchical decision making problem through applying the isbp method to plan wen system an isbp wen model is formulated for jinan the capital of shandong province china in which the upper level model aims to maximize system benefit and the lower level model aims to minimize electricity consumption issues of co2 emission control water quality control groundwater protection and electricity production are considered in the modeling development besides three water sources six water users three planning periods and three water flow levels are involved in the optimization model the isbp wen model can make a balance between system benefit and electricity consumption under uncertainties moreover solutions of the model provide an effective linkage between pre regulated water allocation targets and associated economic implications e g penalties caused by water deficits the results obtained reveal several findings as follows i jinan is a seriously water scarce city 9 2 17 1 of water allocation targets cannot be satisfied even under high water flow level ii under low water flow level municipal sector would face the most severe water shortage i e 51 7 of targets cannot be satisfied the water resource allocated to residential sector would be relatively adequate i e 6 7 of targets cannot be satisfied iii compared with surface water and reclaimed water groundwater is the scarcest source for jinan especially under low water flow level the proportion of groundwater deficit will be 41 2 49 9 iv uncertainties associated with different water flow levels have significant effects on water allocation pattern system benefit and electricity consumption v compared with the traditional single level model electricity consumption from isbp wen would reduce 3 9 5 1 this study is the first attempt to integrate itsp and bp techniques the results show that the developed method is an effective tool for planning the wen system however the isbp method is based on linear programming which has difficulty in solving nonlinear problems finally water scarcity problem accompanying with electricity consumption is a global challenge such that the isbp wen model can be applied to other regions credit authorship contribution statement y ma conceptualization methodology software writing original draft writing review editing y p li conceptualization funding acquisition supervision writing review editing g h huang conceptualization resources y r liu investigation data curation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was supported by the natural science foundation of china grant no 51779008 and the strategic priority research program of chinese academy of sciences grant no xda20060302 the authors are grateful to the editors and the anonymous reviewers for their insightful comments and suggestions appendix nomenclatures for parameters and variables i water users with i 1 for electrical i 2 for industrial i 3 for agricultural i 4 for residential i 5 for ecological i 6 for municipal t planning period t 1 2 3 k water flow levels with k 1 for low k 2 for medium k 3 for high n b it net benefit for user i in period t yuan m3 w g it fixed groundwater allocation for user i in period t m3 w s it fixed surface water allocation for user i in period t m3 w r it fixed reclaimed water allocation for user i in period t m3 p tk the probability of seasonal flow in period t c it penalty for user i in period t when promised water allocation target is not satisfied yuan m3 d g itk the amount of groundwater deficit for user i in period t when flow level is k m3 d s itk the amount of surface water deficit for user i in period t when flow level is k m3 d r itk the amount of reclaimed water deficit for user i in period t when flow level is k m3 α t the percentage of treating water to satisfy electrical use in period t β t the percentage of treating water to satisfy residential use in period t ae g it the amount of electricity used for pumping groundwater kwh m3 ae s it the amount of electricity used for pumping surface water kwh m3 ae r it the amount of electricity used for pumping reclaimed water kwh m3 ae p it the amount of electricity used for transporting water kwh m3 ae m it the amount of electricity used for treating water kwh m3 ae b it the amount of electricity used for distributing water kwh m3 ae d it the amount of electricity used for draining water to sewage treatment plant kwh m3 q g itk the amount of groundwater supplied to user i in period t under flow level k m3 q s itk the amount of surface water supplied to user i in period t under flow level k m3 q r itk the amount of reclaimed water supplied to user i in period t under flow level k m3 w d t unit electricity produced by consuming unit water in period t kwh m3 ie d tk the amount of purchasing electricity in period t kwh te d tk societal total electricity demand in period t kwh c c t the amount of co2 emissions in electricity production kg kwh θ t average efficiency for co2 abatement in electricity production in period t tmc c tk the maximum allowable co2 emissions in period t kg δ it the percentage of draining water for user i in period t ρ itk the concentration of cod in draining water for user i in period t kg m3 κ t the pollutant remove rate in period t q p tk the maximum allowable cod emissions in period t kg p g t the percentage of available groundwater in period t p r t the percentage of reclaimed water needed to be reused in period t mw g tk the amount of groundwater under flow level k in period t m3 mw s tk the amount of surface water under flow level k in period t m3 mw r tk the amount of reclaimed water under flow level k in period t m3 t w tk the total the amount of water resource in period t m3 mw d itk the minimum water demand for user i in period t under flow level k m3 
5073,in this study an interval stochastic bi level programming isbp method is developed for planning the water energy nexus wen system in isbp interval parameter programming ipp and two stage stochastic programming tsp are introduced into a bi level programming bp framework isbp can tackle dual uncertainties expressed as probability distributions and interval values as well as balance the tradeoff between two level decision makers an isbp wen model is then formulated for planning the wen system of jinan the capital of shandong province china in which the upper level model aims to maximize system benefit and the lower level model aims to minimize the electricity consumed for water allocation major findings are i dual uncertainties can affect the city s water allocation pattern and lead to different amounts of water shortage and electricity consumption ii 25 5 31 3 of water allocation target cannot be satisfied under the low water flow level implying that the city would face serious water shortage iii compared with surface water and reclaimed water groundwater is the scarcest source for the city and the proportion of groundwater deficit would be 41 2 49 9 under the low water flow level iv compared with the traditional single level model electricity consumption from isbp wen would be reduced by 3 9 5 1 these findings can help managers to identify the desired strategy between different stakeholders and provide numerical information for planning the wen system under dual uncertainties keywords bi level programming dual uncertainties stochastic analysis water energy nexus water resource allocation 1 introduction water scarcity problems have been intensified by rapid socioeconomic development and accelerated population growth more than 1 8 billion people are estimated to be affected by water scarcity and 663 million people even do not have sufficient drinking water unicef who 2015 water shortage will become more and more severe along with the decreasing available water resources and increasing water demands from multiple users e g residential industrial and agricultural zhang et al 2018 it is reported that the global agricultural water consumption will increase around 20 by 2050 water consumption from energy will rise by 12 because the global energy demand will increase by 36 in 2030 compared with 2010 lv et al 2018 accompany with growing water consumption energy used for extracting collecting distributing and treating water would increase significantly besides projects such as pumping deep groundwater and transferring long distance water would also consume plenty of energy it is estimated that pumping water consumes nearly 7 of energy worldwide which is the highest energy intensive process of water allocation hamiche et al 2016 the process of water allocation needs energy at the same time a large quantity of water is consumed in the electricity generation system the interdependency relationship can be referred as water energy nexus wen which is increasingly highlighted as a crucial consideration for future strategic policy and development plan making hardy et al 2012 khalkhali et al 2018 modelling a water system as a wen can provide insight about water utilization efficiency and open an opportunity for water and energy saving howells and rogner 2014 nogueira and perrella 2015 vakilifard et al 2018 xiang and jia 2019 the interdependence between water and energy necessitates the development of integrated approaches however uncertainties may exist in boundary conditions and model parameters which can lead to more complicated decision making processes for planning wen system previously researchers proposed some approaches to deal with uncertainties existed in water energy systems borgomeo et al 2018 li et al 2019 lindenschmidt and rokaya 2019 wu et al 2019 liu et al 2020 among them two stage stochastic programming tsp is effective in solving uncertain problems in which an analysis of policy scenario is desired and the related data are expressed as probability distributions li et al 2007 in tsp the first stage decision is made before the values of random variables are known then the second stage decision can be made after the random events have happened to minimize penalties that may appear due to any infeasibility maqsood et al 2005 nie et al 2018 however in real world problems it is difficult to express uncertainties using probabilistic distributions thus interval parameter programming ipp is introduced to the tsp framework leading to interval two stage stochastic programming itsp that can handle uncertainties expressed as probability distributions and interval numbers the wen system involves different managers with individual objectives and preferences which are conflicting in most cases these managers have different goals and controlling rights over water resource allocation problems however most of the previous studies related to itsp were developed with single level objective zhang and li 2014 fu et al 2017 khosrojerdi et al 2019 most single level models may have difficulty in solving the wen problems hierarchically because they often ignore the conflicts among interest obtainments without giving priority to any decision makers bi level programming bp which is formulated based on stackelberg games with a preset hierarchy can be introduced to deal with the above mentioned problems there are two decision makers involved in bp the upper level decision maker uldm i e leader and the lower level decision maker lldm i e follower the decision makers represent two different hierarchical levels in the process of decision making the uldm sets the objectives and decisions firstly then the lldm acquires his her optimal solutions which are calculated separately the results of lower level are submitted and revised by the uldm with a view to the whole benefits of the bp model and the process repeats until a satisfactory solution is obtained recently bp has been widely explored for planning water or energy systems zhang and vesselinov 2016 yao et al 2018 rashidizadeh kermani et al 2019 however few studies were found in using bp technique for planning wen system with the combination of itsp and bp an interval stochastic bi level programming isbp method which has advantages in hierarchical decision making uncertainties reflection and policy analysis is developed comparing to the conventional single level programming e g itsp isbp can analyze different objectives in the decision making process which could reflect the practical problem better especially suitable for conflict resolution ranarahu et al 2017 jin et al 2018 comparing to the conventional multi objective programming mop isbp can represent the mutual action between leader and follower explicitly in a mop problem an optimal solution or a pareto set has to be determined through utility theory or other weighting methods difficulties lie in the selection of correct utility functions and the quantification of tradeoffs among multiple objectives sankararao and gupta 2007 li et al 2017 generally isbp is effective in solving interactive decision making problems existed in a predominantly hierarchical structure in which the goal of uldm can be preferably met therefore the objective of this study is to develop an isbp method for planning wen system in combination with uncertainties and different decision making levels isbp integrates tsp ipp and bp into a general framework which can be used for tackling uncertainties and handling the tradeoffs between different decision makers hierarchically and quantitatively the developed method will then be applied to a real case for planning water energy nexus wen system of jinan the capital of shandong province china the results obtained can provide supports for i improving the understanding of water energy linkage under dual uncertainties existed as interval values and probability distributions ii identifying the optimal water allocation scheme and the amount of electricity consumption under different water flow levels and iii solving hierarchical decision making problem as well as making the tradeoff between system benefit and electricity consumption based on leader follower strategy 2 methodology bi level programming bp based on leader follower strategy is a nested optimization involving two decision makers the upper one and the lower one candler and townsley 1982 each of them has his her own objective function independently and influences the reactions of the other one let x r n 1 and y r n 2 be vectors of decision variables indicating upper and lower level choices respectively let f u r n 1 r n 2 r and f l r n 1 r n 2 r be the upper and lower level objective functions respectively g 1 r n 1 r n 2 r and g 1 r n 1 r n 2 r are bi level constraints the bp model can be formulated as follows 1a max x f u x y 1b s t g 1 x y 0 where 1c y arg max y f l x y 1d s t g 1 x y 0 although bp can solve tradeoffs between different decision makers it has limitations in handling uncertainties existed in the real world problems two stage stochastic programming tsp can tackle uncertain problems in which the related data are expressed as probability distributions interval parameter programming ipp can handle uncertainties existed as interval values therefore introducing tsp and ipp into the above bp an interval stochastic bi level programming isbp model can be formulated as follows upper level 2a max x y f u c t 1 x h 1 v p h d t 2 y s t 2b a r x b r r 1 2 m 1 2c a t x a t y w h t 1 2 m 2 h 1 2 v 2d x j 0 x j x j 1 2 n 1 2e y jh 0 y jh y j 1 2 n 2 h 1 2 v lower level 2f max x y f l c t 1 x h 1 v p h d t 2 y s t 2g a r x b r r 1 2 m 1 2h a t x a t y w h t m m 1 2 m 2 h 1 2 v 2i x j 0 x j x j 1 2 n 1 2j y jh 0 y jh y j 1 2 n 2 h 1 2 v where a r r m 1 n 1 a t r m 2 n 2 b r r m 1 1 c t 1 r 1 n 1 d t 2 r 1 n 2 a r r m 1 n 1 a t r m 2 n 2 b r r m 1 1 c t 1 r 1 n 1 d t 2 r 1 n 2 x r n 1 1 y r n 2 1 and r denote a set of interval parameters and or variables superscript donates interval parameters with upper and lower bounds c t 1 and c t 1 are net benefits to users during period t x is fixed allocation target which is promised to users p h is the probability for water flow level d t 2 and d t 1 represent the amount of water deficits by which water allocation targets are not satisfied y represents the reduction of net benefit caused by water deficit w h and w h are the amount of water demand for different users b r and b r are random variables equal to total water availability the solutions of bp problems may not be pareto optimal bard 1984 wen and hsu 1991 shih et al 1996 this is because a basic assumption of bp problem prohibits cooperation between decision makers marcott and savar 1991 an interactive algorithm is introduced to solve the isbp for obtaining the overall satisfactory solution through model 3 f u f u f u x u x u x u and y u y u y u can be obtained for the upper level model correspondingly f l f l f l x l x l x l and y l y l y l can be obtained for the lower level model since the solution x u is controlled by the upper level model it is difficult for the lower level model to receive optimal solutions under such strict conditions it is reasonable to have some leeway or tolerances that give the lldm a wider feasible domain to search for his her optimal solution therefore the solution x u should be allowed to fluctuate within a range x x u p 1 x u p 1 x x u p 1 x u p 1 in which p 1 is maximum tolerance decided by uldm p1 10 106 m3 the most preferred decision is x u the worst acceptable decision is x u p 1 and x u p 1 for the upper bound model the decision makers preference would linearly increase within the interval of x u p 1 x u and would linearly decrease within the interval of x u x u p 1 since the upper level model is a maximization problem the uldm would consider under all f u f u being acceptable and f u f u f u x l y l being unacceptable due to the fact that the lower level model is a minimization problem the lldm would consider that solutions satisfying f l f l would be acceptable while f l f l f l x u y u would be unacceptable according to the interactive algorithm the upper bound model can be formulated as follows 3a max λ s t 3b a x b 3c a x a y w 3d μ x x λ i 3e μ f u f u x y λ 3f μ f l f l x y λ 3g x y 0 3h λ 0 1 where 3i μ x x x x u p 1 p 1 if x u p 1 x x u x p 1 x p 1 if x u x x u p 1 0 if o t h e r w i s e 3j μ f u f u x y 1 i f f u f u f u f u f u f u i f f u f u f u 0 i f f u f u 3k μ f l f l x y 1 i f f l f l f l f l f l f l i f f l f l f l 0 i f f l f l where 3b and 3c are original constraints for isbp model μ x x is membership function for decision variables μ f u f u x y and μ f l f l x y are membership functions for upper and lower level model respectively then solutions x opt and y opt can be received through the model 4 the objective function values of the upper and lower level model are f uopt and f lopt respectively similarly through calculating x u y u f u f l f l x u y u x l y l f l and f u f u x l y l solutions of x opt y opt f uopt and f lopt corresponding to lower bounds of the objective can be obtained through the following model 4a max λ s t 4b a x b 4c a x a y w 4d μ x x λ i 4e μ f u f u x y λ 4f μ f l f l x y λ 4g x y 0 4h x x opt 4i y y opt 4j λ 0 1 where 4k μ x x x x u p 1 p 1 i f x u p 1 x x u x u p 1 x p 1 i f x u x x u p 1 0 i f o t h e r w i s e 4l μ f u f u x y 1 i f f u f u f u f u f u f u i f f u f u f u 0 i f f u f u 4m μ f l f l x y 1 i f f l f l f l f l f l f l i f f l f l f l 0 i f f l f l through solving models 4 and 5 solutions for the isbp model can be obtained i e x opt x opt x opt y opt y opt y opt f uopt f uopt f uopt and f lopt f lopt f lopt 3 case study 3 1 overview of the study system jinan 36 40 n 117 00 e is the provincial capital city of shandong province china covering an area of 7998 km2 it is located in the typical monsoon climate zone with the annual precipitation of 710 8 mm at the end of 2017 the population of jinan was about 6 4 million with a population growth rate of 8 3 per year the gross domestic product gdp was 720 1 billion rmb with the growth rate of 8 0 per year the growing population and the developing economy bring about extreme pressure to meet the city s water demand the total water supply was 1626 2 106 m3 in 2017 in which the groundwater consumption was 585 9 106 m3 the surface water supply was 958 8 106 m3 68 7 of the surface water was obtained from an inter basin water transfer project the other water sources accounted for 81 5 106 m3 due to the large population in jinan the water availability is only 256 m3 per capita which is merely 11 2 of the national level much less than the world s water scarcity threshold i e 1000 m3 per capita the economic development also leads to an increase in electricity consumption for the city the amounts of electricity consumption were 17 2 109 kwh in 2006 and 27 6 109 kwh in 2017 however the capacity of electricity production is limited which leads to electricity shortage frequently in 2017 40 2 of the electricity had to rely on import from the other places therefore the economic development in jinan is limited by the problems of water scarcity and electricity shortage currently groundwater surface water and reclaimed water are main water sources the multiple water sources and diverse water users lead to the complicated water allocation process plenty of energy has to be consumed in the process of water allocation including pumping transporting treating distributing and draining water however water and energy resources in jinan are limited due to the inextricable linkage between water and energy it is crucial for managers to make a rational water resource allocation plan in view of high economic benefit and low energy consumption in the water energy nexus wen system many system components are plagued with uncertainties due to inexact information natural process and human subjectivity li et al 2009 in this study the uncertain parameters are expressed as probability distributions and interval values an interval stochastic bi level programming isbp method is thus developed to plan the wen system of jinan under dual uncertainties 3 2 isbp wen modeling formulation as shown in fig 1 three water sources six users and three planning periods are involved in the optimization model in which two representative decision makers i e water system s decision maker and energy system s decision maker are also considered as a developing city promoting jinan s economic development is the primary mission therefore the upper level decision maker leader sets an objective to maximize the benefit produced by water resource allocation meanwhile the managers in jinan should reduce electricity consumption for energy saving accordingly the lower level decision maker follower sets a goal to minimize the amount of electricity consumed in the process of water resource allocation the two level decision makers goals are conflicting maximizing the system benefit means more water resources allocated to water users thus more electricity would be consumption the isbp wen model is subjected to a variety of water and energy related constraints total electricity demand pollutants emission control water quality constraints groundwater protection reclaimed water reuse water resource availability and the amount of water demand accordingly the isbp wen model can be formulated as follows upper level 5a max f i 1 i t 1 t n b it w g it w s it w r it i 1 i t 1 t k 1 k p tk c it d g itk d s itk d r itk lower level min f i 1 i t 1 t k 1 k p tk a e g it q g itk i 1 i t 1 t k 1 k p tk a e s it q s itk i 1 i t 1 t k 1 k p tk a e r it q r itk i 1 i t 1 t k 1 k p tk a e p it q g itk q s itk q r itk t 1 t k 1 k p tk α t a e m 1 t q g 1 t k q s 1 t k q r 1 t k t 1 t k 1 k p tk β t a e m 4 t q g 4 t k q s 4 t k q r 4 t k i 1 i t 1 t k 1 k p tk a e b it q g itk q s itk q r itk i 1 i t 1 t k 1 k p tk δ it a e d it q g itk q s itk q r itk the constraints for isbp wen model include 1 electricity demand constraint 5c q g 1 t k q s 1 t k q r 1 t k w d t i e d tk t e d tk t k 2 co2 emission constraint 5d c c t q g 1 t k q s 1 t k q r 1 t k w d t 1 θ t t m c c tk t k 3 water quality constraint 5e i 1 i ρ itk δ it q g itk i 1 i ρ itk δ it q s itk i 1 i ρ itk δ it q r itk 1 κ t q p tk i t k 4 groundwater protection constraint 5f i 1 i q g itk p g t m w g tk i t k 5 the utilization rate of reclaimed water 5g i 1 i q r itk p r t m w r tk i t k 6 surface water availability constraint 5h i 1 i q s itk m w s tk i t k 7 reclaimed water availability constraint 5i i 1 i q r itk m w r tk i t k 8 resource availability constraint 5j i 1 i q g itk q s itk q r itk t w tk i t k 9 water demand constraint 5k q g itk q s itk q r itk m w d itk i t k 10 nonnegative constraint 5l q g itk q s itk q r itk 0 i t k where w g it w s it w r it d g itk d s itk d r itk q g itk q s itk and q r itk are decision variables the detailed nomenclatures for the decision variables and parameters are provided in appendix for jinan groundwater and surface water would be delivered to six users electric power department industrial sector agricultural sector residential sector ecological water demand and municipal sector in three periods 2019 2021 each period with one year the reclaimed water would be delivered to four users electric power department industrial sector ecological water demand and municipal sector table 1 provides different water flow levels in the planning periods the related data are obtained from jinan water resources bulletin 2017 and modified according to the local management policy the probability ptk is introduced to demonstrate different water flow levels with the development of water transfer projects and the construction of the pipe nets the amount of surface water and reclaimed water will increase over the planning periods the flow of groundwater has been decreased due to the continuous decline of the groundwater table as shown in table 2 according to the jinan statistical yearbook 2017 jinan s government development planning and historical water consumption the water demands for different users can be set the water demands are used for restricting future optimized water allocation targets reclaimed water is not permitted to supply agricultural planting and residential living table 3 provides input parameters related to water and energy systems the related data are collected from jinan s statistical bulletin on national economic and social development 2017 and shandong statistical yearbook 2017 4 result and discussion table 4 presents the results of optimized water allocation targets to different users in the three planning periods different water flow scenarios would not have any impact on the optimal water allocation targets because the water allocation targets i e the first stage decisions were pre determined by managers before water flow levels were known with the known water flow levels the water deficits would be determined in the second stage to mitigate the economic losses results also show that the optimized surface water allocation target would reach its upper bound i e w s it in period 3 which demonstrates that the manager is optimistic about the surface water supply variations of water allocation targets reflect different policies for managing water resources if the water allocation targets approach their upper bounds the wen system would face more water shortages when the flow level is medium or low correspondingly the economic penalties due to water deficits would be high as shown in fig 2 jinan is a seriously water scarce city under low water flow level 25 5 31 3 of water allocation target cannot be satisfied over the planning periods correspondingly the penalty due to water shortage would be 107 6 143 0 109 rmb even under high water flow level 9 2 17 1 of water allocation target cannot be satisfied for different water users the municipal sector would face the most severe water shortage over the planning periods i e nearly 51 7 of targets cannot be satisfied however for the residential sector the water resources would be relatively adequate only 6 7 of water allocation targets cannot be satisfied under low water flow level low water deficits lead to low risk of violating the promised targets and thus low penalty which demonstrates advantageous conditions for water resource management correspondingly high water deficits would be raised under rigorously demanding conditions low water flow level which lead to high target violation risk and high penalty the results presented in fig 2 also show the deficits for different water sources under low water flow level the water deficit ratios for groundwater surface water and reclaimed water are 41 2 49 9 20 0 23 9 and 15 3 20 2 respectively implying that the city has serious shortage for groundwater for different users under medium and high water flow levels surface water deficits for industry are higher than the agricultural sector this is because industrial water allocation is mainly provided by groundwater and reclaimed water i e accounting to 61 9 64 1 and 30 6 34 5 respectively in addition since the isbp wen model aims to maximize system benefit while minimizing electricity consumption during water allocation the industry sector which consumes more electricity in treating wastewater would have higher deficits than the agricultural sector in most cases reclaimed water cannot be distributed to agricultural use due to the water quality requirement therefore there are no reclaim water allocation targets or deficits for agriculture generally with a view to economic and environmental factors reclaimed water should be allocated firstly followed by surface water and the groundwater should be the final consideration fig 3 shows the results of optimized water allocation scheme obtained from the isbp wen model results indicate that the amount of water resources allocated to the agricultural sector would decrease over the planning horizon under medium flow level the amounts of water allocated to agriculture are 621 1 667 3 106 m3 in period 1 and 563 2 619 3 106 m3 in periods 3 with an annual average decrease rate of 7 2 9 3 besides different water flow levels have significant effects on water allocation schemes in period 1 the amount of municipal water allocation would be 102 1 138 2 106 m3 under high flow level and 81 2 96 1 106 m3 under low flow level which indicates that dual uncertainties would affect the city s water allocation pattern in general results present a detailed water allocation scheme for different users in all possible scenarios which can provide effective policy guidance of water resource management to stakeholders in jinan fig 4 shows the solutions of water supply obtained from the isbp wen model and the traditional single level model aiming to maximize system benefit the total amount of reclaimed water supply of the isbp wen model would be 8 1 8 5 less than the single level model this is because treating reclaimed water would consume more electricity the isbp wen model aims to both increase the system benefit and decrease the electricity consumption such that the amount of reclaimed water would be reduced fig 5 shows water resource allocation pattern to different users for the isbp wfe model the amount of water resources allocated to residential and ecological sectors are 5 1 6 6 and 8 0 8 1 less than those of the single level model respectively the single level model leads to an increase in water allocation under high water flow level which would result in a high risk of water shortage under the medium or low water flows corresponding to high economic penalty conversely the isbp wen has advantages in making the tradeoff between different decision levels and balancing the conflict between different objectives according to the optimal solution obtained from the developed model the system benefit is 314 7 372 4 109 rmb and the electricity consumption is 2 7 3 0 109 kwh fig 7 shows the solutions of electricity consumption under different water flow levels from the traditional single level model and the isbp wen model results show that the agricultural sector is the most electricity consuming sector followed by the residential sector for example for the isbp wen model under medium water flow level the agricultural sector is responsible for 39 3 of electricity consumption for the residential sector it represents 28 3 this is because the agricultural sector consumes a large amount of water resources moreover outdated irrigation techniques intensify the wasting of resources therefore for the study city developing agricultural irrigation techniques can reduce electricity consumption effectively results also indicate that the electricity consumption from the isbp wen model i e 2886 9 3117 2 106 kwh would be 3 9 5 1 less than the single level model i e 2738 7 2996 1 106 kwh besides according to fig 6 the system benefit of the isbp wem model i e 314 7 372 4 109 rmb would be 1 2 4 5 less than the single level model i e 318 6 390 0 109 rmb although the single level model has higher system benefit it neglects the cost of electricity comsumption during water allocation which increases system risk and cannot balance the tradeoff beween different decision levels therefore the water allocation pattern from the isbp wen model is more advisable than that from the traditional single level model 5 conclusions in this study an interval stochastic bi level programming isbp method has been developed for planning the water energy nexus wen system under dual uncertainties isbp incorporates interval parameter programming ipp two stage stochastic programming tsp and bi level programming bp within a general framework the isbp cannot only tackle uncertainties expressed as interval values and probability distributions but also solve hierarchical decision making problem through applying the isbp method to plan wen system an isbp wen model is formulated for jinan the capital of shandong province china in which the upper level model aims to maximize system benefit and the lower level model aims to minimize electricity consumption issues of co2 emission control water quality control groundwater protection and electricity production are considered in the modeling development besides three water sources six water users three planning periods and three water flow levels are involved in the optimization model the isbp wen model can make a balance between system benefit and electricity consumption under uncertainties moreover solutions of the model provide an effective linkage between pre regulated water allocation targets and associated economic implications e g penalties caused by water deficits the results obtained reveal several findings as follows i jinan is a seriously water scarce city 9 2 17 1 of water allocation targets cannot be satisfied even under high water flow level ii under low water flow level municipal sector would face the most severe water shortage i e 51 7 of targets cannot be satisfied the water resource allocated to residential sector would be relatively adequate i e 6 7 of targets cannot be satisfied iii compared with surface water and reclaimed water groundwater is the scarcest source for jinan especially under low water flow level the proportion of groundwater deficit will be 41 2 49 9 iv uncertainties associated with different water flow levels have significant effects on water allocation pattern system benefit and electricity consumption v compared with the traditional single level model electricity consumption from isbp wen would reduce 3 9 5 1 this study is the first attempt to integrate itsp and bp techniques the results show that the developed method is an effective tool for planning the wen system however the isbp method is based on linear programming which has difficulty in solving nonlinear problems finally water scarcity problem accompanying with electricity consumption is a global challenge such that the isbp wen model can be applied to other regions credit authorship contribution statement y ma conceptualization methodology software writing original draft writing review editing y p li conceptualization funding acquisition supervision writing review editing g h huang conceptualization resources y r liu investigation data curation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research was supported by the natural science foundation of china grant no 51779008 and the strategic priority research program of chinese academy of sciences grant no xda20060302 the authors are grateful to the editors and the anonymous reviewers for their insightful comments and suggestions appendix nomenclatures for parameters and variables i water users with i 1 for electrical i 2 for industrial i 3 for agricultural i 4 for residential i 5 for ecological i 6 for municipal t planning period t 1 2 3 k water flow levels with k 1 for low k 2 for medium k 3 for high n b it net benefit for user i in period t yuan m3 w g it fixed groundwater allocation for user i in period t m3 w s it fixed surface water allocation for user i in period t m3 w r it fixed reclaimed water allocation for user i in period t m3 p tk the probability of seasonal flow in period t c it penalty for user i in period t when promised water allocation target is not satisfied yuan m3 d g itk the amount of groundwater deficit for user i in period t when flow level is k m3 d s itk the amount of surface water deficit for user i in period t when flow level is k m3 d r itk the amount of reclaimed water deficit for user i in period t when flow level is k m3 α t the percentage of treating water to satisfy electrical use in period t β t the percentage of treating water to satisfy residential use in period t ae g it the amount of electricity used for pumping groundwater kwh m3 ae s it the amount of electricity used for pumping surface water kwh m3 ae r it the amount of electricity used for pumping reclaimed water kwh m3 ae p it the amount of electricity used for transporting water kwh m3 ae m it the amount of electricity used for treating water kwh m3 ae b it the amount of electricity used for distributing water kwh m3 ae d it the amount of electricity used for draining water to sewage treatment plant kwh m3 q g itk the amount of groundwater supplied to user i in period t under flow level k m3 q s itk the amount of surface water supplied to user i in period t under flow level k m3 q r itk the amount of reclaimed water supplied to user i in period t under flow level k m3 w d t unit electricity produced by consuming unit water in period t kwh m3 ie d tk the amount of purchasing electricity in period t kwh te d tk societal total electricity demand in period t kwh c c t the amount of co2 emissions in electricity production kg kwh θ t average efficiency for co2 abatement in electricity production in period t tmc c tk the maximum allowable co2 emissions in period t kg δ it the percentage of draining water for user i in period t ρ itk the concentration of cod in draining water for user i in period t kg m3 κ t the pollutant remove rate in period t q p tk the maximum allowable cod emissions in period t kg p g t the percentage of available groundwater in period t p r t the percentage of reclaimed water needed to be reused in period t mw g tk the amount of groundwater under flow level k in period t m3 mw s tk the amount of surface water under flow level k in period t m3 mw r tk the amount of reclaimed water under flow level k in period t m3 t w tk the total the amount of water resource in period t m3 mw d itk the minimum water demand for user i in period t under flow level k m3 
5074,biochar is known to improve soil physical properties but its role in influencing soil erosion and nutrient losses as well as biochar itself loss is poorly understood the objectives of this study were to determine the magnitude of soil biochar and nitrogen losses in runoff and quantify the degree of sediment enrichment with biochar and nitrogen in a soil amended with biochar a loessial soil was amended with five rates of nitrogen rich biochar 0 1 3 5 and 7 w w that had 0 25 mm particles and incubated for 8 months a companion study compared three biochar particle sizes 0 25 0 25 1 and 1 2 mm applied at 3 rate a series of simulated rainfall events 90 mm h 1 were applied to the soil which was held in a box at a slope of 27 the results showed that biochar addition of 1 or 3 reduced soil loss rates while the 7 biochar addition rate increased soil loss biochar loss rate was proportional to the biochar addition rate when the biochar particle size was 0 25 mm coarser biochar particles 1 2 mm are retained in the soil better than the finer 0 25 mm biochar particles total nitrogen loss and sediment enrichment with nitrogen and biochar were also lowest with the coarse biochar particles 1 2 mm addition the finer biochar particle sizes 0 25 mm were more vulnerable to erosion losses and its application caused greater total nitrogen enrichment in sediment when finer biochar particles 0 25 mm are used 1 biochar application leads to the best results for soils with risks of erosion but 7 biochar increased the risk of soil biochar and total nitrogen losses our study overall shows that knowledge of the pros and cons of applying biochar should be carefully considered before providing biochar application recommendations as a soil supplement on loess hillslopes abbreviations toc total organic carbon loc labile organic carbon roc total organic carbon resistant to oxidation k sat soil hydraulic conductivity keywords biochar soil loss total nitrogen loss biochar loss enrichment ratio 1 introduction loss of soil mineral nutrients and organic matter to erosion from croplands is a serious global issue but this is even more serious in the loess plateau of china liu et al 2014 wei et al 2007 wang et al 2014 which is the largest continuous area of loess in the world feng et al 2010 in fact soil erosion and associated nutrient losses because of overgrazing intensive cultivation low manure input residue removal and monocropping is the primary problem confronting the agricultural sector in this vulnerable region serious soil erosion and limited soil and water conservation practices in these soils has led to degraded croplands and low soil fertility wei et al 2006 zhou et al 2006 the current practice to maintain the productivity of the soil in the region is to apply excessive amounts of nitrogenous fertilizers fan et al 2005 but the focus on just nitrogen fertilization disregarding conservation practices in such vulnerable soils will likely aggravate not mitigate the problem and promote nitrogen pollution of the local and regional water system qiao et al 2012 to curb the loss of soil and nutrients from the sloping lands of the loess plateau many researchers have suggested and tested the use of biochar han et al 2016 liu et al 2012 li et al 2019 xiao et al 2016 zhang et al 2017 which is a porous solid residue obtained through pyrolysis of biomass the basis for this suggestion emanates from the well established effects of biochar on soil properties soil incorporating biochar has been known to improve soil physical and hydrological properties including reducing soil bulk density increasing porosity and improving aggregate stability burrell et al 2016 fischer et al 2019 głąb et al 2016 biochar has also been shown to benefit water retention hydraulic conductivity shear strength and penetration resistance andrenelli et al 2016 bayabil et al 2015 omondi et al 2016 suliman et al 2017 while these effects of biochar suggest that its use in sloping soils would reduce erosion the results so far have been inconsistent jien and wang 2013 for example found biochar application to a highly weathered soil decreased bulk density increased soil hydraulic conductivity k sat by 1 8 times and increased the mean weight diameter of soil aggregates as a result soil loss was reduced by as much as 64 from incorporating biochar at a 5 application rate abrol et al 2016 found that a 2 w w biochar application relative to no biochar application increased the water infiltration rate of a sealing prone non calcareous loamy sand soil 1 7 fold and this led to a 3 6 fold reduction in soil loss in a rainfall simulation study in another rainfall simulation study sadeghi et al 2016 found biochar applied at 8 t ha 1 to a sandy clay loam soil 48 h before subjecting the soil to the simulated rain reduced the total runoff volume and soil loss chen et al 2020 and zhou et al 2018 applied nanoparticles of biochar at low rates 1 to a loess soil in the field and reported reduction in total runoff and soil loss peng et al 2019 found the runoff rate from biochar amended soil did not differ from unamended soil but the soil erosion resistance was enhanced by biochar amendment doan et al 2015 found biochar reduced soil and water loss when applied to an acrisol soil with low organic carbon and nitrogen content these studies suggest that biochar applied at the proper rate improves soil physical properties increases the infiltration of rain reduces runoff and loss of soil to erosion this effectiveness may be proportional to the application rate as high as 10 abrol et al 2016 doan et al 2015 jien and wang 2013 kumar et al 2019 li et al 2017 sadeghi et al 2016 hseu et al 2014 other studies however have reported that biochar enhances or had no effect on erosion in a 3 year study li et al 2017 reported that biochar reduced runoff and soil loss in an orchard soil but caused an increase of soil loss when applied to a cropland under tillage conditions in a subtropical region in china as mitigation strategies to minimize aggravated soil loss by the application of biochar in tilled soils li et al 2017 suggested adding straws or polyacrylamide gel materials peng et al 2016 found that biochar had no effect on soil erosion because biochar was mainly eroded in the soil which was a red clay soil kumar et al 2019 argued that the hydrophobic properties of biochar can exacerbate soil erosion in under certain conditions in the loess plateau of china zhang et al 2019 warned that the use of a high biochar application rate 8 in sloping soils can reduce runoff but aggravate the risk oferosion likewise li et al 2019 showed that a high biochar application rate 7 w w in sloping loess soils can increase erosion although they found lower application rates reduced soil loss the bases for these inconsistencies may be many but the amount of applied biochar used in the various studies seems to be critical for example chen et al 2020 who reported positive effects of biochar on soil loss to erosion used 1 nanoparticle biochar rates on the other hand li et al 2019 and zhang et al 2019 who reported that biochar increased erosion used rates as high as 8 the beneficial effects of biochar on soil physical and hydrological properties are also known to vary with biochar application rates in general the positive effects of biochar on soil physical and hydrological properties are reported to increase with increasing biochar application rates jien and wang 2013 villagra mendoza and horn 2018 the positive biochar effect on soil physical and hydrologic properties has been known to be at application rates that did not exceed 5 there are reports that show these benefits may be lost if these rates exceeded 7 for example dugan et al 2010 found that high biochar application rate of 10 had no effect on soil water holding capacity li et al 2019 also reported 7 biochar application to loess reduced k sat which can lead to low infiltration and increase surface runoff the beneficial effects of biochar on soil physical and hydrological properties are also known to depend on the size of biochar particles for example obia et al 2016 reported that among three biochar particles the largest 1 5 mm and smallest 0 5 mm had equally stronger positive effects on soil physical properties than the medium sized biochar particles 0 5 1 mm reddy et al 2015 also found that the hydraulic conductivity and shear strength of soil increased with a decrease in biochar particle sizes these reports suggest that the rate of application and the size of the biochar particles effective for erosion control fall within a narrow range which remains to be unknown in addition to the ambiguity of the effect of biochar on soil erosion how much of the biochar applied for purposes of controlling erosion and total nitrogen from the biochar are lost to runoff has not been investigated stopping erosion in full by amending soils with biochar should not be expected and this implies that some of the applied biochar and the nitrogen it contains will be lost to runoff since biochar is a low density material and can easily be carried in runoff wang et al 2013 previous studies showed that the application of biochar can effectively reduce nitrate loss in water from runoff gu et al 2018 odhiambo and mihara 2018 saarnio et al 2018 williams 2016 however these studies only measured nitrogen loss in the water from runoff and neglected biochar loss as well as nitrogen loss from eroded biochar whether the loss of biochar and total nitrogen in sediment is proportional to the amount of mineral soil loss remains unclear and to our knowledge has yet to be investigated the objectives of this study were to determine the magnitude of soil and biochar losses in runoff and quantify the degree of sediment enrichment with biochar and nitrogen in a soil amended with biochar the results obtained from this research will provide scientific guidance for local farmers and policy makers to determine whether or not biochar is a viable option for improving the crop productivity of degraded loessial soil on the cultivated loess slopes 2 materials and methods 2 1 soil and biochar the cultivated loess used in this study was a silt loam 30 2 sand 60 9 silt and 8 9 clay collected from the upper 0 20 cm depth in ansai district shaanxi province china located in the northern section of the loess plateau 36 51 n 109 19 e this region has a semi arid climate with mean annual temperature of 8 8 c and average annual precipitation of about 549 mm zhang et al 2003 which falls mostly as short term high intensity rainstorms zhang and liu 2005 from june to september the collected soil was air dried gently crushed and allowed to pass through 5 mm sieve to remove all aboveground biomass anything green leafy and stored in closed plastic containers until used the biochar for the study was produced from young clipped apple branches subjected to pyrolysis at a temperature of approximately 550 c by the shaanxi yixing technology co ltd xi an china the biochar after cooling to room temperature was ground and passed through 0 25 1 0 and 2 0 mm sieves to obtain batches with biochar particle sizes of 0 25 0 25 1 and 1 2 mm diameter the ph of the soil and biochar was measured using electrochemical analysis at deionized water soil or biochar ratio of 5 1 total carbon was determined using the walkley black method total nitrogen was measured using the kjeldahl method bremner 1960 total phosphorus was assayed miranda et al 2001 using a continuous flow analytical system skalar san the netherlands total potassium content was determined after extraction with h2so4 and hclo4 using a flame photometer tcvn 4053 81 the particle size distribution of the soil was measured by marvin laser particle size meter 2000 the specific surface area and porosity of biochar were obtained based on the scanning electron micrograph sem the basic chemical and physical properties of the soil and biochar are presented in table 1 2 2 experimental design and simulated rainfall experiment two complementary experiments were conducted the first experiment consisted of soil that received biochar with particle sizes of 0 25 0 25 1 and 1 2 mm applied at 3 of the soil weight w w to explore the effect of biochar particle size the second experiment consisted of soil that received 0 25 mm biochar at 0 1 3 5 and 7 of the soil weight w w to determine the effect of biochar application rate approximately 137 kg soil and the designated biochar application rates and particle sizes according to the treatment were mixed thoroughly the mixture was then watered to a field capacity of approximately 20 packed to a bulk density of about 1 15 g cm 3 based on the measured field capacity about 20 2 and bulk density about 1 15 g cm 3 and placed in 160 l polyethylene plastic containers the containers are typical for mineralization incubation studies and allowed oxygen diffusion but not water drainage the plastic containers were covered with lids to reduce evaporation and were kept in the laboratory for 8 months under room temperature 20 25 c the water content of the soil biochar mixture was maintained by adding water as needed every week during the incubation period our incubation period of 8 months was longer than other reported studies hseu et al 2014 jien and wang 2013 sadeghi et al 2016 to ensure enough interaction between biochar and soil during the incubation at the end of the 8 month incubation the biochar amended and control soils were air dried again and crushed to pass through a 5 0 mm sieve the prepared soils were then wetted to 10 water content and then packed uniformly into the experimental micro plots steel boxes measuring 1 m long 0 4 m wide and 0 4 m deep these plots were then subjected to simulated rainfall for 60 min a rainfall intensity of 90 mm h 1 and a slope gradient of 27 were chosen to represent common rainfall intensities and average slope in the loess plateau of china additional details on the micro plots and simulated rainfall is given elsewhere li et al 2019 2 3 sampling and analyses 2 3 1 runoff and sediment runoff from the micro plots was collected in containers large enough to accommodate estimated runoff runoff from each micro plot was collected every 1 2 and 3 min for a total of 23 runoff samples each collected runoff sample was allowed to settle for approximately 24 h and then a siphon and filter paper 1 2 µm were used to separate the liquid and sediment soil biochar once separated the sediment was air dried to a constant weight weighed to determine the total loss of biochar and soil sediment lsed crushed to pass a 2 mm sieve and stored for chemical analysis the solid fraction sediment recovered from the runoff contained eroded biochar and soil a two step process was used to estimate the amount of each of these two components of the eroded solids biochar and soil first a calibration curve that relates the total organic carbon resistant to oxidation roc in biochar to the weight of biochar was established then the amount of biochar in the sediment eroded solid fraction was calculated from this calibration after determining the roc amount in the sediment the roc of a sample was determined as the difference between total organic c toc and labile organic c loc total organic carbon toc and loc of the biochar used in the study were measured as follows first the toc of the biochar was measured by the wet oxidation technique which utilizes exothermic heating and oxidation of organic carbon of the sample with k2cr2o7 and concentrated h2so4 in this procedure one set of biochar ground to pass a 0 15 mm sieve and weighing 0 002 0 004 0 006 0 008 0 010 0 012 and 0 014 g was placed in 500 ml erlenmeyer flasks and 5 ml of 0 800 mol l 1 k2cr2o7 solution was added and mixed by swirling this was followed by adding 5 ml concentrated h2so4 and mixing gently the mixture was then put in a hot paraffin oil bath pan at 170 180 for 5 min after removing from the hot bath and cooling to room temperature the solution was back titrated with 0 2 m feso4 the toc g g 1 of biochar was calculated based on the consumed amount of 0 2 m feso4 to measure the loc of biochar a procedure recommended by blair et al 1995 which involves an oxidation method with kmno4 333 mm was followed a set of ground biochar weighing 0 002 0 004 0 006 0 008 0 010 0 012 and 0 014 g was mixed and reacted with 25 ml of 333 mm kmno4 solution in a 50 ml plastic screw top centrifuge tubes the biochar suspension was vibrated for 1 h at a speed of 12 rpm an aliquot of 1 ml of liquid supernatant after centrifuging for 5 min at 2000 rpm was removed and diluted to 250 ml then the absorbance was measured on an uv vis spectrophotometer tu 1810 persee china 2010 at 565 nm the change in the concentration of kmno4 was used to estimate the amount of loc g g 1 assuming that 1 mm mno4 was consumed in the oxidation of 9 mg of carbon the toc and loc were measured in triplicates for each biochar sample the roc content g g 1 of biochar was calculated as 1 roc toc loc then the calibration curve shown in fig 1 was established to estimate the biochar fraction in the eroded sediment biochar soil the same procedure used to determine roc in biochar was used to determine roc in the sediment as follows dried sediment samples were prepared by removing all aboveground biomass anything green leafy and crushing to pass a 0 15 mm sieve the toc g g 1 and loc g g 1 of the sediment samples was measured on 0 5 g samples by the same procedure used for estimating the toc and loc of biochar then the roc g g 1 of sediment was calculated using eq 1 we assumed that all roc in the sediment was from the biochar since the loess soil contained very low organic c 1 94 the amount of eroded biochar in the sediment which is the amount of biochar loss lbc g to runoff was calculated from the calibration curve in fig 1 the biochar loss rate lrbc and soil loss rate lrsoil to runoff were determined by the following equations 2 lr bc l bc t a 3 lr soil l sed l bc t a where lbc is the total biochar loss from the plot g lsed is the total loss of biochar and soil sediment from the plot g t is the period of rainfall min a is the plot area m2 2 3 2 total nitrogen loss the total nitrogen in biochar tnbc control soil tnsoil soil biochar mixture tn bc soil and sediment tnsed was measured using the kjeldahl method bremner 1960 in triplicates for each treatment total nitrogen loss rate as biochar tnlrbc and as soil tnlrsoil were calculated by the following equations 4 tnlr bc l bc tn bc t a 5 tnlr soil tn sed l sed l bc tn bc t a where tnbc is the total nitrogen content of biochar mg g 1 tnsed is the total nitrogen content of sediment mg g 1 enrichment ratio used to estimate the nutrient loss associated with soil erosion was obtained by dividing the nutrient content in sediment by the content in initial soil the enrichment ratios of total nitrogen ertn from sediment in this study were calculated using the total nitrogen in sediment tnsed total nitrogen in the original soil biochar mixture tn bc soil as follows 6 er tn tn sed tn bc soil similarly the biochar content in the sediment bcsed and the enrichment ratio of biochar erbc were calculated in order to evaluate the biochar loss in runoff the equation was as follows 7 er bc bc sed bc bc soil where bcsed is the biochar content in sediments g g 1 bcbc soil is the added biochar content in original soil biochar mixture g g 1 2 4 statistical analysis biochar loss lbc total nitrogen in biochar tnbc control soil tnsoil soil biochar mixture tn bc soil and sediment tnsed were all measured with triplicates for each sample these data were analyzed using a combination of excel and spss as a one way anova and least significant difference lsd tests at 0 05 significant level 3 results 3 1 effect of biochar on soil total nitrogen the total nitrogen content of biochar 4 55 g kg 1 was up to 20 times greater than that of the unamended soil 0 22 g kg 1 table 1 as a result adding biochar to the loess significantly elevated soil total nitrogen relative to the control p 0 05 the increase of soil total nitrogen was proportional to the increase of biochar addition rate biochar particle sizes did not significantly p 0 05 affect total nitrogen of soil biochar mixture table 2 3 2 soil and biochar loss to runoff soil and biochar loss rates in all treatments increased rapidly after runoff was initiated reached a peak 5 to 8 min later and then declined to a quasi steady state after approximately 20 min of simulated rainfall fig 2 biochar loss rates fluctuated stronger than soil loss rates from the peak to the quasi steady state biochar loss rate increased with increasing biochar addition rate relative to the control the lower biochar addition rates of 1 and 3 reduced soil loss rates while the higher biochar addition of 7 increased soil loss rate among the different biochar particle sizes added at 3 the 0 25 and 1 2 mm biochar particles reduced soil loss rate relative to the control the 0 25 1 mm biochar particles did not have an obvious effect on soil loss rate relative to the control fig 3 b the lowest biochar loss rate occurred with the 1 2 mm particles fig 3d showing that coarse biochar particles are less susceptible to runoff loss than finer particles biochar enrichment ratio which measures the level of biochar in the eroded soil relative to the original biochar amended soil was less than 1 for all treatments except for the 5 biochar addition the treatment with 5 biochar addition had biochar enrichment ratio of 1 2 which means that sediments from this treatment had higher concentration of biochar than the soil biochar before the simulated rain table 3 the 1 biochar addition had the lowest biochar enrichment ratio of 0 72 among the particle size classes biochar enrichment ratio increased with decreasing biochar particle sizes which shows finer biochar particles are more likely to be lost in runoff than larger particle coarser particles 3 3 total nitrogen loss 3 3 1 total nitrogen content and enrichment ratio in sediment total nitrogen content of sediment was enhanced by biochar addition and increased proportionally with the biochar addition rate figs 4 and 5 among the three particle size treatments sediment total nitrogen content was highest for the 0 25 mm particles and decreased with increasing biochar particle size the 1 2 mm particle size had the lowest sediment total nitrogen content likely because biochar loss in runoff was lowest with this size class the total nitrogen enrichment ratio of the biochar addition rates was greater than 1 and fluctuated for some treatments during the first 20 min of simulated rainfall fig 4c after this period the total nitrogen enrichment ratio was generally less than 1 and varied only slightly the 1 biochar addition had the lowest mean the total nitrogen enrichment ratio among the different biochar addition rates difference in the total nitrogen enrichment ratio among 3 5 and 7 biochar addition rates were not significant among the different biochar particle sizes the total nitrogen enrichment ratio much similar to the biochar enrichment ratio increased as biochar particle size decreased fig 5d the total nitrogen enrichment ratio for the biochar particle sizes of 0 25 1 and 1 2 mm was not only lower than that of the control treatment but was also less than 1 showing that no enrichment occurred in the eroded sediment when biochar with these particle sizes were applied to the soil 3 3 2 total nitrogen loss rate through soil and biochar the total nitrogen loss rate refers to the amount of total nitrogen lost through eroded soil and biochar per unit area in a given period of time in general all biochar rate treatments displayed similar trends in total nitrogen loss rate through soil and biochar across time fig 6 two distinct rate stages were identified a rapid increase in the first 2 25 min of rainfall and a quasi steady state or decrease with some fluctuations in the last 25 60 min the loss of total nitrogen increased with increasing amount of applied biochar reaching maximum with the 7 addition rate fig 7 this response of total nitrogen loss rate is because the biochar loss rate also increased with increasing biochar addition rate fig 3 unlike the total nitrogen loss in eroded biochar the total nitrogen loss in eroded soil from treatments that received less than 5 biochar did not exceed that of the control thus the combined total nitrogen loss rate through sediment biochar soil increased with increasing amount of biochar application as the biochar used in this study was by far more nitrogen rich than the soil table 1 the biochar addition of 7 resulted in the greatest total nitrogen loss rate in eroded sediment biochar soil and the 1 biochar addition had the lowest total nitrogen loss rate through sediment even below that of the control among the biochar particle size treatments total nitrogen loss rate through eroded soil was lowest for the largest biochar particles 1 2 mm and increased with decreasing biochar particle size fig 7 among the three treatments only the largest biochar particles had lower total nitrogen loss through eroded soil than the control the loss of total nitrogen in eroded biochar was also lowest with the largest particles 1 2 mm when combined the largest biochar particles had about the same total nitrogen loss in eroded soil and biochar sediment as the control the two other particle sizes 0 25 mm and 0 25 1 mm however had higher total nitrogen in the sediment than the control primarily because these two particle sizes caused greater biochar loss than the largest biochar particles biochar loss contributed up to 67 of the total nitrogen loss to erosion while it contributed only about 5 of the total eroded sediment biochar soil fig 8 4 discussion biochar has been receiving substantial research attention as a soil amendment in the last decade or two during this time many have shown that it improves soil physical properties burrell et al 2016 głąb et al 2016 jeffery et al 2011 research on the effect of biochar on soil erosion has not produced clear and consistent results our study has shown that the addition of reasonably low biochar addition rates to soil 1 or 3 w w generally reduce soil loss to runoff which was consistent with some findings from other studies hseu et al 2014 jien and wang 2013 kumar et al 2019 li et al 2017 peng et al 2019 this effect of biochar may be attributed to its effect on soil properties and on exogenic erosional forces on slope lands jien and wang 2013 wong et al 2018 there are published results that show 1 or 3 biochar addition can increase k sat li et al 2019 such an increase enhances the vertical movement of water and infiltration abrol et al 2016 and results in reduced surface runoff rates during raifall hseu et al 2014 jien and wang 2013 li et al 2017 furthermore biochar can reduce soil erodibility by increasing the content and stability of soil aggregates burrell et al 2016 li et al 2019 however in our study biochar at a high application rate of 7 resulted in greater soil loss the reason likely was that higher biochar application rates increased the water repellency głąb et al 2016 with little or no effect on k sat li et al 2019 leading to greater surface runoff and more severe soil erosion relative to the lower biochar application rates 1 and 3 these results indicate that care should be taken when applying biochar so that biochar amounts that aggravate erosion are not applied to erosion prone soils such as those of the loess plateau of china this study showed that the enrichment ratio of the sediment with biochar was mostly 1 0 except for the 5 biochar application rate table 3 our study is the first to show that the proportion of biochar in the soil that remained in the box was greater than the biochar proportion in the eroded sediment however biochar retention in the soil to which it was applied depends on the rate and particle size of the biochar figs 2 and 3 show that biochar is increasingly eroded with increasing biochar application rate thus the lowest biochar loss rate was occurred at 1 biochar addition more interestingly biochar with finer particle sizes 0 25 mm was more vulnerable to loss in runoff and sediments than biochar with larger particles 1 2 mm it suggested that larger biochar particles have a greater chance of being retained in the soil to which they were applied than smaller particles under the same biochar application rate this implies that biochar rates and particle sizes should be both considered for practical application purposes in soils with substantial runoff risks the total nitrogen loss rate in the eroded soil which does not include the total nitrogen in eroded biochar was reduced or remained unaffected by biochar addition rate of 5 or less relative to the control fig 7 the reason for this reduction might be because soil loss was reduced by biochar addition that did not exceed 5 similar results were reported by chen et al 2020 who found that the application of nano particle biochar at low rate effectively reduced runoff sediment yield and nitrate loss in runoff and sediment biochar application of 7 on the other hand increased total nitrogen loss rate in the eroded soil because this rate promoted and caused the highest soil loss fig 3 the loss of total nitrogen in eroded biochar which does not include the total nitrogen in eroded soil was directly proportional to the biochar addition rate fig 8 this is because more biochar was lost to runoff as the addition rate increased the combined total nitrogen loss from eroded soil and biochar also was proportional to the biochar addition rate these results are not consistent with previous studies that reported biochar addition reduced total nitrogen loss in the water from runoff doan et al 2015 li et al 2017 lee et al 2018 the different results on the effect of biochar amendment on total nitrogen loss could be due to differences in the methods used for estimating total nitrogen loss all of the previous experiments measured total nitrogen in the liquid fraction of the eroded material and disregard the total nitrogen in the sediment while we are the first time to measured total nitrogen loss in the entire eroded material sediment after concentrating and drying it we also separated the total nitrogen loss in the eroded biochar from that of the eroded soil making our work more detailed and unique although biochar addition increased total nitrogen loss in the sediment soil biochar and the effect increased with increasing biochar addition total nitrogen enrichment ratio remained relatively unchanged across the biochar addition rates this shows that the enrichment of the sediment with total nitrogen remained about the same regardless of the rate of biochar addition particle size of biochar affected total nitrogen content total nitrogen loss rate and total nitrogen enrichment ratio in eroded sediment the results showed that total nitrogen loss was lowest with the largest particle size 1 2 mm and highest with the smallest particle sizes 0 25 mm fig 7 the reason is that biochar with finer particle sizes was more vulnerable to loss in runoff and sediments than biochar with larger particles 1 2 mm fig 3 our results overall are encouraging in that locally available biomass materials may be converted to biochar and put to use for reducing loss of soil to erosion and also as a source of nitrogen in the loess plateau of china large amounts of clipped apple branches are generated as part of the local apple production the disposal of these clippings can be a burden for the local farmer the results from our study however show that these clippings can be converted to biochar and used not only to reduce soil erosion but also as a source of nitrogen for cultivated crops because biochar derived from young apple branch clippings has high total nitrogen and generally increased soil total nitrogen content table 2 the results show that producing biochar with larger particle sizes leads to better results than finer particle sizes the largest particle size in our study 1 2 mm had the least total nitrogen loss and the lowest enrichment of total nitrogen and biochar table 3 figs 5 and 7 the finer particle sizes 0 25 mm were more vulnerable to erosion losses and had greater total nitrogen enrichment figs 3 and 5 when finer particles 0 25 mm are used our result show that a rate of application of 1 of the soil mass leads to the best results for soils with risks of erosion because this application rate reduced the amount of eroded soil although it is not a significant source of nitrogen the use of higher application rates 5 and 7 of the fine biochar particles carry some risk of increasing the loss of soil biochar and total nitrogen through sediments which could flow into rivers slowly release nitrogen and cause pollution to surface waters our results show that biochar can contain substantial amount of nitrogen and that this nitrogen is vulnerable to loss as part of the biochar not all biochar will contain as much nitrogen as the biochar we used in our study which was derived from clipped apple branches the nitrogen content of biochar will likely depend on the kind of biomass material used to generate the biochar however our research shows neglecting the nitrogen content of biochar used in agricultural soils and the loss of biochar derived nitrogen to runoff could lead to serious environmental consequences exacerbating the problems of nitrogen over application on farmlands our results could serve as bases for developing complete biochar use guidance for farmers practitioners and policy makers when determining whether biochar is a viable option for soil and water conservation and for improving crop productivity in vulnerable soils this study was conducted in containers under controlled conditions and the incubation time of only 8 months may be considered relatively short furthermore only total nitrogen was measured in the study thus long term field experiments as opposed to box studies under controlled conditions that investigate not only nitrogen but also other mineral elements including p k ca mg may be necessary to assess the full potential of environmental and production benefits of applying biochar to degraded soils 5 conclusions this study explored the influence of biochar applied at different rates and particle sizes on the loss of soil biochar and total nitrogen from a loessial soil with 27 slope under simulated rainfall conditions the results demonstrated that addition of apple branch based biochar reduced total soil erosion if applied at rates of 3 or less application rates higher than 5 seem to promote soil erosion and therefore adopting such a practice is not advisable in soils with substantial erosion risk our study also shows biochar with larger particles is retained in the soil better than biochar with smaller particles thus the use of a coarse biochar applied at lower rates may be a promising amendment for improving degraded loess soils and reducing rapid soil degradation due to soil erosion however some risk of increasing total nitrogen loss mainly through biochar loss is a concern therefore the pros and cons of applying biochar on loessial soils should be carefully considered before providing biochar application recommendations as a soil supplement on loess hillslopes credit authorship contribution statement yuanyuan li conceptualization validation formal analysis investigation data curation writing original draft visualization gary feng supervision haile tewolde reviewing editing formal analysis supervision mingyi yang supervision fengbao zhang conceptualization methodology project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this work was supported by the national natural science foundation of china 41877080 and 41671281 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2020 125318 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
5074,biochar is known to improve soil physical properties but its role in influencing soil erosion and nutrient losses as well as biochar itself loss is poorly understood the objectives of this study were to determine the magnitude of soil biochar and nitrogen losses in runoff and quantify the degree of sediment enrichment with biochar and nitrogen in a soil amended with biochar a loessial soil was amended with five rates of nitrogen rich biochar 0 1 3 5 and 7 w w that had 0 25 mm particles and incubated for 8 months a companion study compared three biochar particle sizes 0 25 0 25 1 and 1 2 mm applied at 3 rate a series of simulated rainfall events 90 mm h 1 were applied to the soil which was held in a box at a slope of 27 the results showed that biochar addition of 1 or 3 reduced soil loss rates while the 7 biochar addition rate increased soil loss biochar loss rate was proportional to the biochar addition rate when the biochar particle size was 0 25 mm coarser biochar particles 1 2 mm are retained in the soil better than the finer 0 25 mm biochar particles total nitrogen loss and sediment enrichment with nitrogen and biochar were also lowest with the coarse biochar particles 1 2 mm addition the finer biochar particle sizes 0 25 mm were more vulnerable to erosion losses and its application caused greater total nitrogen enrichment in sediment when finer biochar particles 0 25 mm are used 1 biochar application leads to the best results for soils with risks of erosion but 7 biochar increased the risk of soil biochar and total nitrogen losses our study overall shows that knowledge of the pros and cons of applying biochar should be carefully considered before providing biochar application recommendations as a soil supplement on loess hillslopes abbreviations toc total organic carbon loc labile organic carbon roc total organic carbon resistant to oxidation k sat soil hydraulic conductivity keywords biochar soil loss total nitrogen loss biochar loss enrichment ratio 1 introduction loss of soil mineral nutrients and organic matter to erosion from croplands is a serious global issue but this is even more serious in the loess plateau of china liu et al 2014 wei et al 2007 wang et al 2014 which is the largest continuous area of loess in the world feng et al 2010 in fact soil erosion and associated nutrient losses because of overgrazing intensive cultivation low manure input residue removal and monocropping is the primary problem confronting the agricultural sector in this vulnerable region serious soil erosion and limited soil and water conservation practices in these soils has led to degraded croplands and low soil fertility wei et al 2006 zhou et al 2006 the current practice to maintain the productivity of the soil in the region is to apply excessive amounts of nitrogenous fertilizers fan et al 2005 but the focus on just nitrogen fertilization disregarding conservation practices in such vulnerable soils will likely aggravate not mitigate the problem and promote nitrogen pollution of the local and regional water system qiao et al 2012 to curb the loss of soil and nutrients from the sloping lands of the loess plateau many researchers have suggested and tested the use of biochar han et al 2016 liu et al 2012 li et al 2019 xiao et al 2016 zhang et al 2017 which is a porous solid residue obtained through pyrolysis of biomass the basis for this suggestion emanates from the well established effects of biochar on soil properties soil incorporating biochar has been known to improve soil physical and hydrological properties including reducing soil bulk density increasing porosity and improving aggregate stability burrell et al 2016 fischer et al 2019 głąb et al 2016 biochar has also been shown to benefit water retention hydraulic conductivity shear strength and penetration resistance andrenelli et al 2016 bayabil et al 2015 omondi et al 2016 suliman et al 2017 while these effects of biochar suggest that its use in sloping soils would reduce erosion the results so far have been inconsistent jien and wang 2013 for example found biochar application to a highly weathered soil decreased bulk density increased soil hydraulic conductivity k sat by 1 8 times and increased the mean weight diameter of soil aggregates as a result soil loss was reduced by as much as 64 from incorporating biochar at a 5 application rate abrol et al 2016 found that a 2 w w biochar application relative to no biochar application increased the water infiltration rate of a sealing prone non calcareous loamy sand soil 1 7 fold and this led to a 3 6 fold reduction in soil loss in a rainfall simulation study in another rainfall simulation study sadeghi et al 2016 found biochar applied at 8 t ha 1 to a sandy clay loam soil 48 h before subjecting the soil to the simulated rain reduced the total runoff volume and soil loss chen et al 2020 and zhou et al 2018 applied nanoparticles of biochar at low rates 1 to a loess soil in the field and reported reduction in total runoff and soil loss peng et al 2019 found the runoff rate from biochar amended soil did not differ from unamended soil but the soil erosion resistance was enhanced by biochar amendment doan et al 2015 found biochar reduced soil and water loss when applied to an acrisol soil with low organic carbon and nitrogen content these studies suggest that biochar applied at the proper rate improves soil physical properties increases the infiltration of rain reduces runoff and loss of soil to erosion this effectiveness may be proportional to the application rate as high as 10 abrol et al 2016 doan et al 2015 jien and wang 2013 kumar et al 2019 li et al 2017 sadeghi et al 2016 hseu et al 2014 other studies however have reported that biochar enhances or had no effect on erosion in a 3 year study li et al 2017 reported that biochar reduced runoff and soil loss in an orchard soil but caused an increase of soil loss when applied to a cropland under tillage conditions in a subtropical region in china as mitigation strategies to minimize aggravated soil loss by the application of biochar in tilled soils li et al 2017 suggested adding straws or polyacrylamide gel materials peng et al 2016 found that biochar had no effect on soil erosion because biochar was mainly eroded in the soil which was a red clay soil kumar et al 2019 argued that the hydrophobic properties of biochar can exacerbate soil erosion in under certain conditions in the loess plateau of china zhang et al 2019 warned that the use of a high biochar application rate 8 in sloping soils can reduce runoff but aggravate the risk oferosion likewise li et al 2019 showed that a high biochar application rate 7 w w in sloping loess soils can increase erosion although they found lower application rates reduced soil loss the bases for these inconsistencies may be many but the amount of applied biochar used in the various studies seems to be critical for example chen et al 2020 who reported positive effects of biochar on soil loss to erosion used 1 nanoparticle biochar rates on the other hand li et al 2019 and zhang et al 2019 who reported that biochar increased erosion used rates as high as 8 the beneficial effects of biochar on soil physical and hydrological properties are also known to vary with biochar application rates in general the positive effects of biochar on soil physical and hydrological properties are reported to increase with increasing biochar application rates jien and wang 2013 villagra mendoza and horn 2018 the positive biochar effect on soil physical and hydrologic properties has been known to be at application rates that did not exceed 5 there are reports that show these benefits may be lost if these rates exceeded 7 for example dugan et al 2010 found that high biochar application rate of 10 had no effect on soil water holding capacity li et al 2019 also reported 7 biochar application to loess reduced k sat which can lead to low infiltration and increase surface runoff the beneficial effects of biochar on soil physical and hydrological properties are also known to depend on the size of biochar particles for example obia et al 2016 reported that among three biochar particles the largest 1 5 mm and smallest 0 5 mm had equally stronger positive effects on soil physical properties than the medium sized biochar particles 0 5 1 mm reddy et al 2015 also found that the hydraulic conductivity and shear strength of soil increased with a decrease in biochar particle sizes these reports suggest that the rate of application and the size of the biochar particles effective for erosion control fall within a narrow range which remains to be unknown in addition to the ambiguity of the effect of biochar on soil erosion how much of the biochar applied for purposes of controlling erosion and total nitrogen from the biochar are lost to runoff has not been investigated stopping erosion in full by amending soils with biochar should not be expected and this implies that some of the applied biochar and the nitrogen it contains will be lost to runoff since biochar is a low density material and can easily be carried in runoff wang et al 2013 previous studies showed that the application of biochar can effectively reduce nitrate loss in water from runoff gu et al 2018 odhiambo and mihara 2018 saarnio et al 2018 williams 2016 however these studies only measured nitrogen loss in the water from runoff and neglected biochar loss as well as nitrogen loss from eroded biochar whether the loss of biochar and total nitrogen in sediment is proportional to the amount of mineral soil loss remains unclear and to our knowledge has yet to be investigated the objectives of this study were to determine the magnitude of soil and biochar losses in runoff and quantify the degree of sediment enrichment with biochar and nitrogen in a soil amended with biochar the results obtained from this research will provide scientific guidance for local farmers and policy makers to determine whether or not biochar is a viable option for improving the crop productivity of degraded loessial soil on the cultivated loess slopes 2 materials and methods 2 1 soil and biochar the cultivated loess used in this study was a silt loam 30 2 sand 60 9 silt and 8 9 clay collected from the upper 0 20 cm depth in ansai district shaanxi province china located in the northern section of the loess plateau 36 51 n 109 19 e this region has a semi arid climate with mean annual temperature of 8 8 c and average annual precipitation of about 549 mm zhang et al 2003 which falls mostly as short term high intensity rainstorms zhang and liu 2005 from june to september the collected soil was air dried gently crushed and allowed to pass through 5 mm sieve to remove all aboveground biomass anything green leafy and stored in closed plastic containers until used the biochar for the study was produced from young clipped apple branches subjected to pyrolysis at a temperature of approximately 550 c by the shaanxi yixing technology co ltd xi an china the biochar after cooling to room temperature was ground and passed through 0 25 1 0 and 2 0 mm sieves to obtain batches with biochar particle sizes of 0 25 0 25 1 and 1 2 mm diameter the ph of the soil and biochar was measured using electrochemical analysis at deionized water soil or biochar ratio of 5 1 total carbon was determined using the walkley black method total nitrogen was measured using the kjeldahl method bremner 1960 total phosphorus was assayed miranda et al 2001 using a continuous flow analytical system skalar san the netherlands total potassium content was determined after extraction with h2so4 and hclo4 using a flame photometer tcvn 4053 81 the particle size distribution of the soil was measured by marvin laser particle size meter 2000 the specific surface area and porosity of biochar were obtained based on the scanning electron micrograph sem the basic chemical and physical properties of the soil and biochar are presented in table 1 2 2 experimental design and simulated rainfall experiment two complementary experiments were conducted the first experiment consisted of soil that received biochar with particle sizes of 0 25 0 25 1 and 1 2 mm applied at 3 of the soil weight w w to explore the effect of biochar particle size the second experiment consisted of soil that received 0 25 mm biochar at 0 1 3 5 and 7 of the soil weight w w to determine the effect of biochar application rate approximately 137 kg soil and the designated biochar application rates and particle sizes according to the treatment were mixed thoroughly the mixture was then watered to a field capacity of approximately 20 packed to a bulk density of about 1 15 g cm 3 based on the measured field capacity about 20 2 and bulk density about 1 15 g cm 3 and placed in 160 l polyethylene plastic containers the containers are typical for mineralization incubation studies and allowed oxygen diffusion but not water drainage the plastic containers were covered with lids to reduce evaporation and were kept in the laboratory for 8 months under room temperature 20 25 c the water content of the soil biochar mixture was maintained by adding water as needed every week during the incubation period our incubation period of 8 months was longer than other reported studies hseu et al 2014 jien and wang 2013 sadeghi et al 2016 to ensure enough interaction between biochar and soil during the incubation at the end of the 8 month incubation the biochar amended and control soils were air dried again and crushed to pass through a 5 0 mm sieve the prepared soils were then wetted to 10 water content and then packed uniformly into the experimental micro plots steel boxes measuring 1 m long 0 4 m wide and 0 4 m deep these plots were then subjected to simulated rainfall for 60 min a rainfall intensity of 90 mm h 1 and a slope gradient of 27 were chosen to represent common rainfall intensities and average slope in the loess plateau of china additional details on the micro plots and simulated rainfall is given elsewhere li et al 2019 2 3 sampling and analyses 2 3 1 runoff and sediment runoff from the micro plots was collected in containers large enough to accommodate estimated runoff runoff from each micro plot was collected every 1 2 and 3 min for a total of 23 runoff samples each collected runoff sample was allowed to settle for approximately 24 h and then a siphon and filter paper 1 2 µm were used to separate the liquid and sediment soil biochar once separated the sediment was air dried to a constant weight weighed to determine the total loss of biochar and soil sediment lsed crushed to pass a 2 mm sieve and stored for chemical analysis the solid fraction sediment recovered from the runoff contained eroded biochar and soil a two step process was used to estimate the amount of each of these two components of the eroded solids biochar and soil first a calibration curve that relates the total organic carbon resistant to oxidation roc in biochar to the weight of biochar was established then the amount of biochar in the sediment eroded solid fraction was calculated from this calibration after determining the roc amount in the sediment the roc of a sample was determined as the difference between total organic c toc and labile organic c loc total organic carbon toc and loc of the biochar used in the study were measured as follows first the toc of the biochar was measured by the wet oxidation technique which utilizes exothermic heating and oxidation of organic carbon of the sample with k2cr2o7 and concentrated h2so4 in this procedure one set of biochar ground to pass a 0 15 mm sieve and weighing 0 002 0 004 0 006 0 008 0 010 0 012 and 0 014 g was placed in 500 ml erlenmeyer flasks and 5 ml of 0 800 mol l 1 k2cr2o7 solution was added and mixed by swirling this was followed by adding 5 ml concentrated h2so4 and mixing gently the mixture was then put in a hot paraffin oil bath pan at 170 180 for 5 min after removing from the hot bath and cooling to room temperature the solution was back titrated with 0 2 m feso4 the toc g g 1 of biochar was calculated based on the consumed amount of 0 2 m feso4 to measure the loc of biochar a procedure recommended by blair et al 1995 which involves an oxidation method with kmno4 333 mm was followed a set of ground biochar weighing 0 002 0 004 0 006 0 008 0 010 0 012 and 0 014 g was mixed and reacted with 25 ml of 333 mm kmno4 solution in a 50 ml plastic screw top centrifuge tubes the biochar suspension was vibrated for 1 h at a speed of 12 rpm an aliquot of 1 ml of liquid supernatant after centrifuging for 5 min at 2000 rpm was removed and diluted to 250 ml then the absorbance was measured on an uv vis spectrophotometer tu 1810 persee china 2010 at 565 nm the change in the concentration of kmno4 was used to estimate the amount of loc g g 1 assuming that 1 mm mno4 was consumed in the oxidation of 9 mg of carbon the toc and loc were measured in triplicates for each biochar sample the roc content g g 1 of biochar was calculated as 1 roc toc loc then the calibration curve shown in fig 1 was established to estimate the biochar fraction in the eroded sediment biochar soil the same procedure used to determine roc in biochar was used to determine roc in the sediment as follows dried sediment samples were prepared by removing all aboveground biomass anything green leafy and crushing to pass a 0 15 mm sieve the toc g g 1 and loc g g 1 of the sediment samples was measured on 0 5 g samples by the same procedure used for estimating the toc and loc of biochar then the roc g g 1 of sediment was calculated using eq 1 we assumed that all roc in the sediment was from the biochar since the loess soil contained very low organic c 1 94 the amount of eroded biochar in the sediment which is the amount of biochar loss lbc g to runoff was calculated from the calibration curve in fig 1 the biochar loss rate lrbc and soil loss rate lrsoil to runoff were determined by the following equations 2 lr bc l bc t a 3 lr soil l sed l bc t a where lbc is the total biochar loss from the plot g lsed is the total loss of biochar and soil sediment from the plot g t is the period of rainfall min a is the plot area m2 2 3 2 total nitrogen loss the total nitrogen in biochar tnbc control soil tnsoil soil biochar mixture tn bc soil and sediment tnsed was measured using the kjeldahl method bremner 1960 in triplicates for each treatment total nitrogen loss rate as biochar tnlrbc and as soil tnlrsoil were calculated by the following equations 4 tnlr bc l bc tn bc t a 5 tnlr soil tn sed l sed l bc tn bc t a where tnbc is the total nitrogen content of biochar mg g 1 tnsed is the total nitrogen content of sediment mg g 1 enrichment ratio used to estimate the nutrient loss associated with soil erosion was obtained by dividing the nutrient content in sediment by the content in initial soil the enrichment ratios of total nitrogen ertn from sediment in this study were calculated using the total nitrogen in sediment tnsed total nitrogen in the original soil biochar mixture tn bc soil as follows 6 er tn tn sed tn bc soil similarly the biochar content in the sediment bcsed and the enrichment ratio of biochar erbc were calculated in order to evaluate the biochar loss in runoff the equation was as follows 7 er bc bc sed bc bc soil where bcsed is the biochar content in sediments g g 1 bcbc soil is the added biochar content in original soil biochar mixture g g 1 2 4 statistical analysis biochar loss lbc total nitrogen in biochar tnbc control soil tnsoil soil biochar mixture tn bc soil and sediment tnsed were all measured with triplicates for each sample these data were analyzed using a combination of excel and spss as a one way anova and least significant difference lsd tests at 0 05 significant level 3 results 3 1 effect of biochar on soil total nitrogen the total nitrogen content of biochar 4 55 g kg 1 was up to 20 times greater than that of the unamended soil 0 22 g kg 1 table 1 as a result adding biochar to the loess significantly elevated soil total nitrogen relative to the control p 0 05 the increase of soil total nitrogen was proportional to the increase of biochar addition rate biochar particle sizes did not significantly p 0 05 affect total nitrogen of soil biochar mixture table 2 3 2 soil and biochar loss to runoff soil and biochar loss rates in all treatments increased rapidly after runoff was initiated reached a peak 5 to 8 min later and then declined to a quasi steady state after approximately 20 min of simulated rainfall fig 2 biochar loss rates fluctuated stronger than soil loss rates from the peak to the quasi steady state biochar loss rate increased with increasing biochar addition rate relative to the control the lower biochar addition rates of 1 and 3 reduced soil loss rates while the higher biochar addition of 7 increased soil loss rate among the different biochar particle sizes added at 3 the 0 25 and 1 2 mm biochar particles reduced soil loss rate relative to the control the 0 25 1 mm biochar particles did not have an obvious effect on soil loss rate relative to the control fig 3 b the lowest biochar loss rate occurred with the 1 2 mm particles fig 3d showing that coarse biochar particles are less susceptible to runoff loss than finer particles biochar enrichment ratio which measures the level of biochar in the eroded soil relative to the original biochar amended soil was less than 1 for all treatments except for the 5 biochar addition the treatment with 5 biochar addition had biochar enrichment ratio of 1 2 which means that sediments from this treatment had higher concentration of biochar than the soil biochar before the simulated rain table 3 the 1 biochar addition had the lowest biochar enrichment ratio of 0 72 among the particle size classes biochar enrichment ratio increased with decreasing biochar particle sizes which shows finer biochar particles are more likely to be lost in runoff than larger particle coarser particles 3 3 total nitrogen loss 3 3 1 total nitrogen content and enrichment ratio in sediment total nitrogen content of sediment was enhanced by biochar addition and increased proportionally with the biochar addition rate figs 4 and 5 among the three particle size treatments sediment total nitrogen content was highest for the 0 25 mm particles and decreased with increasing biochar particle size the 1 2 mm particle size had the lowest sediment total nitrogen content likely because biochar loss in runoff was lowest with this size class the total nitrogen enrichment ratio of the biochar addition rates was greater than 1 and fluctuated for some treatments during the first 20 min of simulated rainfall fig 4c after this period the total nitrogen enrichment ratio was generally less than 1 and varied only slightly the 1 biochar addition had the lowest mean the total nitrogen enrichment ratio among the different biochar addition rates difference in the total nitrogen enrichment ratio among 3 5 and 7 biochar addition rates were not significant among the different biochar particle sizes the total nitrogen enrichment ratio much similar to the biochar enrichment ratio increased as biochar particle size decreased fig 5d the total nitrogen enrichment ratio for the biochar particle sizes of 0 25 1 and 1 2 mm was not only lower than that of the control treatment but was also less than 1 showing that no enrichment occurred in the eroded sediment when biochar with these particle sizes were applied to the soil 3 3 2 total nitrogen loss rate through soil and biochar the total nitrogen loss rate refers to the amount of total nitrogen lost through eroded soil and biochar per unit area in a given period of time in general all biochar rate treatments displayed similar trends in total nitrogen loss rate through soil and biochar across time fig 6 two distinct rate stages were identified a rapid increase in the first 2 25 min of rainfall and a quasi steady state or decrease with some fluctuations in the last 25 60 min the loss of total nitrogen increased with increasing amount of applied biochar reaching maximum with the 7 addition rate fig 7 this response of total nitrogen loss rate is because the biochar loss rate also increased with increasing biochar addition rate fig 3 unlike the total nitrogen loss in eroded biochar the total nitrogen loss in eroded soil from treatments that received less than 5 biochar did not exceed that of the control thus the combined total nitrogen loss rate through sediment biochar soil increased with increasing amount of biochar application as the biochar used in this study was by far more nitrogen rich than the soil table 1 the biochar addition of 7 resulted in the greatest total nitrogen loss rate in eroded sediment biochar soil and the 1 biochar addition had the lowest total nitrogen loss rate through sediment even below that of the control among the biochar particle size treatments total nitrogen loss rate through eroded soil was lowest for the largest biochar particles 1 2 mm and increased with decreasing biochar particle size fig 7 among the three treatments only the largest biochar particles had lower total nitrogen loss through eroded soil than the control the loss of total nitrogen in eroded biochar was also lowest with the largest particles 1 2 mm when combined the largest biochar particles had about the same total nitrogen loss in eroded soil and biochar sediment as the control the two other particle sizes 0 25 mm and 0 25 1 mm however had higher total nitrogen in the sediment than the control primarily because these two particle sizes caused greater biochar loss than the largest biochar particles biochar loss contributed up to 67 of the total nitrogen loss to erosion while it contributed only about 5 of the total eroded sediment biochar soil fig 8 4 discussion biochar has been receiving substantial research attention as a soil amendment in the last decade or two during this time many have shown that it improves soil physical properties burrell et al 2016 głąb et al 2016 jeffery et al 2011 research on the effect of biochar on soil erosion has not produced clear and consistent results our study has shown that the addition of reasonably low biochar addition rates to soil 1 or 3 w w generally reduce soil loss to runoff which was consistent with some findings from other studies hseu et al 2014 jien and wang 2013 kumar et al 2019 li et al 2017 peng et al 2019 this effect of biochar may be attributed to its effect on soil properties and on exogenic erosional forces on slope lands jien and wang 2013 wong et al 2018 there are published results that show 1 or 3 biochar addition can increase k sat li et al 2019 such an increase enhances the vertical movement of water and infiltration abrol et al 2016 and results in reduced surface runoff rates during raifall hseu et al 2014 jien and wang 2013 li et al 2017 furthermore biochar can reduce soil erodibility by increasing the content and stability of soil aggregates burrell et al 2016 li et al 2019 however in our study biochar at a high application rate of 7 resulted in greater soil loss the reason likely was that higher biochar application rates increased the water repellency głąb et al 2016 with little or no effect on k sat li et al 2019 leading to greater surface runoff and more severe soil erosion relative to the lower biochar application rates 1 and 3 these results indicate that care should be taken when applying biochar so that biochar amounts that aggravate erosion are not applied to erosion prone soils such as those of the loess plateau of china this study showed that the enrichment ratio of the sediment with biochar was mostly 1 0 except for the 5 biochar application rate table 3 our study is the first to show that the proportion of biochar in the soil that remained in the box was greater than the biochar proportion in the eroded sediment however biochar retention in the soil to which it was applied depends on the rate and particle size of the biochar figs 2 and 3 show that biochar is increasingly eroded with increasing biochar application rate thus the lowest biochar loss rate was occurred at 1 biochar addition more interestingly biochar with finer particle sizes 0 25 mm was more vulnerable to loss in runoff and sediments than biochar with larger particles 1 2 mm it suggested that larger biochar particles have a greater chance of being retained in the soil to which they were applied than smaller particles under the same biochar application rate this implies that biochar rates and particle sizes should be both considered for practical application purposes in soils with substantial runoff risks the total nitrogen loss rate in the eroded soil which does not include the total nitrogen in eroded biochar was reduced or remained unaffected by biochar addition rate of 5 or less relative to the control fig 7 the reason for this reduction might be because soil loss was reduced by biochar addition that did not exceed 5 similar results were reported by chen et al 2020 who found that the application of nano particle biochar at low rate effectively reduced runoff sediment yield and nitrate loss in runoff and sediment biochar application of 7 on the other hand increased total nitrogen loss rate in the eroded soil because this rate promoted and caused the highest soil loss fig 3 the loss of total nitrogen in eroded biochar which does not include the total nitrogen in eroded soil was directly proportional to the biochar addition rate fig 8 this is because more biochar was lost to runoff as the addition rate increased the combined total nitrogen loss from eroded soil and biochar also was proportional to the biochar addition rate these results are not consistent with previous studies that reported biochar addition reduced total nitrogen loss in the water from runoff doan et al 2015 li et al 2017 lee et al 2018 the different results on the effect of biochar amendment on total nitrogen loss could be due to differences in the methods used for estimating total nitrogen loss all of the previous experiments measured total nitrogen in the liquid fraction of the eroded material and disregard the total nitrogen in the sediment while we are the first time to measured total nitrogen loss in the entire eroded material sediment after concentrating and drying it we also separated the total nitrogen loss in the eroded biochar from that of the eroded soil making our work more detailed and unique although biochar addition increased total nitrogen loss in the sediment soil biochar and the effect increased with increasing biochar addition total nitrogen enrichment ratio remained relatively unchanged across the biochar addition rates this shows that the enrichment of the sediment with total nitrogen remained about the same regardless of the rate of biochar addition particle size of biochar affected total nitrogen content total nitrogen loss rate and total nitrogen enrichment ratio in eroded sediment the results showed that total nitrogen loss was lowest with the largest particle size 1 2 mm and highest with the smallest particle sizes 0 25 mm fig 7 the reason is that biochar with finer particle sizes was more vulnerable to loss in runoff and sediments than biochar with larger particles 1 2 mm fig 3 our results overall are encouraging in that locally available biomass materials may be converted to biochar and put to use for reducing loss of soil to erosion and also as a source of nitrogen in the loess plateau of china large amounts of clipped apple branches are generated as part of the local apple production the disposal of these clippings can be a burden for the local farmer the results from our study however show that these clippings can be converted to biochar and used not only to reduce soil erosion but also as a source of nitrogen for cultivated crops because biochar derived from young apple branch clippings has high total nitrogen and generally increased soil total nitrogen content table 2 the results show that producing biochar with larger particle sizes leads to better results than finer particle sizes the largest particle size in our study 1 2 mm had the least total nitrogen loss and the lowest enrichment of total nitrogen and biochar table 3 figs 5 and 7 the finer particle sizes 0 25 mm were more vulnerable to erosion losses and had greater total nitrogen enrichment figs 3 and 5 when finer particles 0 25 mm are used our result show that a rate of application of 1 of the soil mass leads to the best results for soils with risks of erosion because this application rate reduced the amount of eroded soil although it is not a significant source of nitrogen the use of higher application rates 5 and 7 of the fine biochar particles carry some risk of increasing the loss of soil biochar and total nitrogen through sediments which could flow into rivers slowly release nitrogen and cause pollution to surface waters our results show that biochar can contain substantial amount of nitrogen and that this nitrogen is vulnerable to loss as part of the biochar not all biochar will contain as much nitrogen as the biochar we used in our study which was derived from clipped apple branches the nitrogen content of biochar will likely depend on the kind of biomass material used to generate the biochar however our research shows neglecting the nitrogen content of biochar used in agricultural soils and the loss of biochar derived nitrogen to runoff could lead to serious environmental consequences exacerbating the problems of nitrogen over application on farmlands our results could serve as bases for developing complete biochar use guidance for farmers practitioners and policy makers when determining whether biochar is a viable option for soil and water conservation and for improving crop productivity in vulnerable soils this study was conducted in containers under controlled conditions and the incubation time of only 8 months may be considered relatively short furthermore only total nitrogen was measured in the study thus long term field experiments as opposed to box studies under controlled conditions that investigate not only nitrogen but also other mineral elements including p k ca mg may be necessary to assess the full potential of environmental and production benefits of applying biochar to degraded soils 5 conclusions this study explored the influence of biochar applied at different rates and particle sizes on the loss of soil biochar and total nitrogen from a loessial soil with 27 slope under simulated rainfall conditions the results demonstrated that addition of apple branch based biochar reduced total soil erosion if applied at rates of 3 or less application rates higher than 5 seem to promote soil erosion and therefore adopting such a practice is not advisable in soils with substantial erosion risk our study also shows biochar with larger particles is retained in the soil better than biochar with smaller particles thus the use of a coarse biochar applied at lower rates may be a promising amendment for improving degraded loess soils and reducing rapid soil degradation due to soil erosion however some risk of increasing total nitrogen loss mainly through biochar loss is a concern therefore the pros and cons of applying biochar on loessial soils should be carefully considered before providing biochar application recommendations as a soil supplement on loess hillslopes credit authorship contribution statement yuanyuan li conceptualization validation formal analysis investigation data curation writing original draft visualization gary feng supervision haile tewolde reviewing editing formal analysis supervision mingyi yang supervision fengbao zhang conceptualization methodology project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this work was supported by the national natural science foundation of china 41877080 and 41671281 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2020 125318 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
